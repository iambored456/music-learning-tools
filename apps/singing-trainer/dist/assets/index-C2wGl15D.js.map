{"version":3,"file":"index-C2wGl15D.js","sources":["../../../../node_modules/.pnpm/esm-env@1.2.2/node_modules/esm-env/false.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/shared/utils.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/constants.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/shared/errors.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/errors.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/constants.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/warnings.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/reactivity/equality.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/flags/index.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/context.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/task.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/error-handling.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/reactivity/batch.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/reactivity/create-subscriber.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/blocks/boundary.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/reactivity/async.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/reactivity/deriveds.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/reactivity/sources.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/proxy.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/operations.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/misc.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/bindings/shared.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/reactivity/effects.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/runtime.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/utils.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/events.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/reconciler.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/template.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/render.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/blocks/branches.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/blocks/if.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/blocks/each.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/shared/attributes.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/class.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/style.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/bindings/select.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/attributes.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/bindings/input.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/bindings/this.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/dom/elements/bindings/universal.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/reactivity/store.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/client/reactivity/props.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/index-client.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/version.js","../../../../node_modules/.pnpm/svelte@5.46.1/node_modules/svelte/src/internal/disclose-version.js","../../../../packages/ui-components/src/canvas/PitchGrid/renderers/coordinateUtils.ts","../../../../packages/ui-components/src/canvas/PitchGrid/renderers/gridLines.ts","../../../../packages/pitch-data/src/pitchData.ts","../../../../packages/pitch-data/src/pitchUtils.ts","../../../../packages/pitch-data/src/pitchTrailColors.ts","../../../../packages/ui-components/src/canvas/PitchGrid/renderers/notes.ts","../../../../packages/ui-components/src/canvas/PitchGrid/renderers/legend.ts","../../../../packages/pitch-viewport/src/index.ts","../../../../packages/ui-components/src/canvas/PitchGrid/PitchGrid.svelte","../../../../packages/singing-trainer-ui/src/lib/stores/appState.svelte.ts","../../../../packages/singing-trainer-ui/src/lib/stores/pitchState.svelte.ts","../../../../packages/student-notation-engine/src/state/actions/rhythmActions.ts","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/version.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-extended-exponential-ramp-to-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-extended-linear-ramp-to-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-set-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-set-value-curve-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/get-target-value-at-time.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/guards/exponential-ramp-to-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/guards/linear-ramp-to-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/guards/any-ramp-to-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/guards/set-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/guards/set-value-curve-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/get-value-of-automation-event-at-index-at-time.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/get-end-time-and-value-of-previous-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/guards/cancel-and-hold-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/guards/cancel-scheduled-values-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/get-event-time.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/get-exponential-ramp-value-at-time.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/get-linear-ramp-value-at-time.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/interpolate-value.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/get-value-curve-value-at-time.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/guards/set-target-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/classes/automation-event-list.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-cancel-and-hold-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-cancel-scheduled-values-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-exponential-ramp-to-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-linear-ramp-to-value-automation-event.js","../../../../node_modules/.pnpm/automation-events@7.1.13/node_modules/automation-events/build/es2019/functions/create-set-target-automation-event.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/abort-error.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/add-active-input-connection-to-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/add-audio-node-connections.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/add-audio-param-connections.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/globals.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/is-constructible.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/split-import-statements.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/add-audio-worklet-module.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/get-value-for-key.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/pick-element-from-set.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/delete-passive-input-connection-to-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/get-event-listeners-of-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/set-internal-state-to-active.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/audio-worklet-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/set-internal-state-to-passive.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/set-internal-state-to-passive-when-necessary.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/add-connection-to-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/add-passive-input-connection-to-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/add-silent-connection.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/add-unrendered-audio-worklet-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/analyser-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/is-owned-by-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/analyser-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-buffer-copy-channel-methods-out-of-bounds-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/index-size-error.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-audio-buffer-get-channel-data-method.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-buffer-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/constants.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/is-active-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-buffer-source-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-buffer-source-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/audio-buffer-source-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/biquad-filter-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/constant-source-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/gain-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/oscillator-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/stereo-panner-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/get-audio-node-connections.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/get-audio-param-connections.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/deactivate-active-audio-node-input-connections.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/deactivate-audio-graph.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/is-valid-latency-hint.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-context-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-destination-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-destination-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-listener-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/audio-node-output-connection.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/insert-element-in-set.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/add-active-input-connection-to-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/add-passive-input-connection-to-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/native-audio-node-faker.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/connect-native-audio-node-to-native-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/delete-active-input-connection.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/delete-active-input-connection-to-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/delete-event-listeners-of-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/delete-passive-input-connection-to-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/disconnect-native-audio-node-from-native-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/get-native-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/get-native-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/is-part-of-a-cycle.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/is-passive-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-node-disconnect-method-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/visit-each-audio-node-once.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/native-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-audio-node-disconnect-method.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-param-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-param-renderer.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/read-only-map.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-worklet-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/copy-from-channel.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/copy-to-channel.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/create-nested-arrays.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/get-audio-worklet-processor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/audio-worklet-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/base-audio-context-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/biquad-filter-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/biquad-filter-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/cache-test-result.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/channel-merger-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/channel-merger-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/channel-splitter-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/channel-splitter-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/connect-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/connect-multiple-outputs.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/connected-native-audio-buffer-source-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/constant-source-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/constant-source-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/convert-number-to-unsigned-long.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/convolver-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/convolver-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/create-native-offline-audio-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/data-clone-error.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/detach-array-buffer.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/decode-audio-data.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/decrement-cycle-counter.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/delay-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/delay-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/delete-active-input-connection-to-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/delete-unrendered-audio-worklet-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/guards/delay-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/detect-cycles.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/disconnect-multiple-outputs.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/dynamics-compressor-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/dynamics-compressor-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/encoding-error.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/evaluate-source.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/event-target-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/expose-current-frame-and-current-time.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/fetch-source.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/gain-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/gain-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/get-active-audio-worklet-node-inputs.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/get-audio-node-renderer.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/get-audio-node-tail-time.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/get-audio-param-renderer.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/get-backup-offline-audio-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/invalid-state-error.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/get-native-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/get-or-create-backup-offline-audio-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/get-unrendered-audio-worklet-nodes.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/invalid-access-error.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-iir-filter-node-get-frequency-response-method.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/iir-filter-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/filter-buffer.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/iir-filter-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/increment-cycle-counter-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-any-audio-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-any-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-any-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-any-offline-audio-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-native-audio-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-native-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-native-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-native-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-native-offline-audio-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/is-secure-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/media-element-audio-source-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/media-stream-audio-destination-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/media-stream-audio-source-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/media-stream-track-audio-source-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/minimal-base-audio-context-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-promise-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/monitor-connections.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/assign-native-audio-node-option.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/assign-native-audio-node-options.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-analyser-node-get-float-time-domain-data-method-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-analyser-node-get-float-time-domain-data-method.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-analyser-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-audio-buffer-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/assign-native-audio-node-audio-param-value.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-audio-buffer-source-node-start-method-consecutive-calls.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-audio-scheduled-source-node-start-method-negative-parameters.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-audio-scheduled-source-node-stop-method-negative-parameters.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-audio-buffer-source-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-audio-context-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-audio-destination-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-audio-worklet-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-clonability-of-audio-worklet-node-options.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-audio-worklet-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/compute-buffer-size.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/clone-audio-worklet-node-options.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/create-audio-worklet-processor-promise.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/create-audio-worklet-processor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-audio-worklet-node-faker-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-biquad-filter-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-channel-merger-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-channel-splitter-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-channel-splitter-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-constant-source-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/intercept-connections.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-constant-source-node-faker-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-convolver-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-delay-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-dynamics-compressor-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-gain-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-iir-filter-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-iir-filter-node-faker-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-media-element-audio-source-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-media-stream-audio-destination-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-media-stream-audio-source-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-media-stream-track-audio-source-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-offline-audio-context-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-oscillator-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-panner-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-panner-node-faker-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-periodic-wave-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-script-processor-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-stereo-panner-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-stereo-panner-node-faker-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-wave-shaper-node-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/native-wave-shaper-node-faker-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/not-supported-error.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/offline-audio-context-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/oscillator-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/oscillator-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/panner-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/panner-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/periodic-wave-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/render-automation.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/render-inputs-of-audio-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/render-inputs-of-audio-param.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/render-native-offline-audio-context.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/set-active-audio-worklet-node-inputs.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/set-audio-node-tail-time.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/start-rendering.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/stereo-panner-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/stereo-panner-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/test-audio-buffer-constructor-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/test-audio-worklet-processor-post-message-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/test-offline-audio-context-current-time-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/unknown-error.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/wave-shaper-node-constructor.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/wave-shaper-node-renderer-factory.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/window.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/wrap-audio-buffer-copy-channel-methods.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/wrap-audio-buffer-copy-channel-methods-out-of-bounds.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/wrap-audio-buffer-source-node-stop-method-nullified-buffer.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/factories/wrap-channel-merger-node.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/get-first-sample.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/is-dc-curve.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/overwrite-accessors.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/sanitize-audio-worklet-node-options.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/sanitize-channel-splitter-options.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/sanitize-periodic-wave-options.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/set-value-at-time-until-possible.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-buffer-source-node-start-method-consecutive-calls-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-buffer-source-node-start-method-offset-clamping-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-buffer-source-node-stop-method-nullified-buffer-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-scheduled-source-node-start-method-negative-parameters-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-scheduled-source-node-stop-method-consecutive-calls-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-scheduled-source-node-stop-method-negative-parameters-support.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/test-audio-worklet-node-options-clonability.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-audio-buffer-source-node-start-method-offset-clamping.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-audio-scheduled-source-node-stop-method-consecutive-calls.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/helpers/wrap-event-listener.js","../../../../node_modules/.pnpm/standardized-audio-context@25.3.77/node_modules/standardized-audio-context/build/es2019/module.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/TypeCheck.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/Debug.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/AudioContext.js","../../../../node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.es6.mjs","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/clock/Ticker.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/AdvancedTypeCheck.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/Defaults.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/Tone.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/Math.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/Timeline.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/ContextInitialization.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/Emitter.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/BaseContext.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/Context.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/DummyContext.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/Interface.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/ToneAudioBuffer.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/OfflineContext.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/Global.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/type/Conversions.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/type/TimeBase.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/type/Time.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/type/Frequency.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/type/TransportTime.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/ToneWithContext.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/StateTimeline.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/Param.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/ToneAudioNode.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/Gain.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/OneShotSource.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/signal/ToneConstantSource.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/signal/Signal.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/clock/TickParam.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/clock/TickSignal.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/clock/TickSource.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/clock/Clock.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/channel/Volume.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/Destination.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/Listener.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/context/ToneAudioBuffers.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/type/Midi.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/type/Ticks.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/Draw.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/IntervalTimeline.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/TimelineValue.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/signal/SignalOperator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/signal/WaveShaper.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/signal/Pow.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/clock/TransportEvent.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/clock/TransportRepeatEvent.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/clock/Transport.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/Source.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/buffer/ToneBufferSource.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/UserMedia.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/OscillatorInterface.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/ToneOscillatorNode.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/Oscillator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/signal/AudioToGain.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/signal/Multiply.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/AMOscillator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/FMOscillator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/PulseOscillator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/FatOscillator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/PWMOscillator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/oscillator/OmniOscillator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/util/Decorator.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/source/buffer/Player.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/envelope/Envelope.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/instrument/Instrument.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/instrument/Monophonic.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/envelope/AmplitudeEnvelope.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/instrument/Synth.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/instrument/MembraneSynth.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/worklet/WorkletGlobalScope.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/worklet/ToneAudioWorkletProcessor.worklet.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/worklet/SingleIOProcessor.worklet.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/core/worklet/DelayLine.worklet.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/filter/FeedbackCombFilter.worklet.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/instrument/PolySynth.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/instrument/Sampler.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/channel/Panner.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/effect/BitCrusher.worklet.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/channel/Split.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/analysis/Analyser.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/channel/Solo.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/channel/PanVol.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/component/channel/Channel.js","../../../../node_modules/.pnpm/tone@15.1.22/node_modules/tone/build/esm/index.js","../../../../packages/student-notation-engine/src/highway/feedbackCollector.ts","../../../../packages/student-notation-engine/src/highway/noteHighwayService.ts","../../../../packages/singing-trainer-ui/src/lib/stores/highwayState.svelte.ts","../../../../packages/singing-trainer-ui/src/lib/stores/demoExerciseState.svelte.ts","../../../../packages/singing-trainer-ui/src/lib/components/SingingCanvas.svelte","../../../../node_modules/.pnpm/fft.js@4.0.4/node_modules/fft.js/lib/fft.js","../../../../node_modules/.pnpm/pitchy@4.1.0/node_modules/pitchy/index.js","../../../../packages/pitch-utils/dist/index.js","../../../../packages/singing-trainer-ui/src/lib/services/referenceAudio.ts","../../../../packages/singing-trainer-ui/src/lib/services/pitchDetection.ts","../../../../packages/singing-trainer-ui/src/lib/services/droneAudio.ts","../../../../packages/singing-trainer-ui/src/lib/components/controls/TonicSelector.svelte","../../../../packages/singing-trainer-ui/src/lib/components/controls/DroneControls.svelte","../../../../packages/ui-components/src/pitch-wheels/PitchWheel.svelte","../../../../packages/ui-components/src/pitch-wheels/PresetButtons.svelte","../../../../packages/ui-components/src/pitch-wheels/pitchWheelUtils.ts","../../../../packages/ui-components/src/pitch-wheels/DualPitchWheel.svelte","../../../../packages/singing-trainer-ui/src/lib/components/controls/RangeControl.svelte","../../../../packages/singing-trainer-ui/src/lib/components/controls/PitchHighlightToggle.svelte","../../../../packages/singing-trainer-ui/src/lib/components/controls/DemoExerciseControls.svelte","../../../../packages/singing-trainer-ui/src/lib/types/ultrastar.ts","../../../../packages/singing-trainer-ui/src/lib/services/ultrastarParser.ts","../../../../packages/singing-trainer-ui/src/lib/stores/ultrastarState.svelte.ts","../../../../packages/singing-trainer-ui/src/lib/services/youtubePlayer.ts","../../../../packages/singing-trainer-ui/src/lib/stores/youtubeState.svelte.ts","../../../../packages/singing-trainer-ui/src/lib/services/transportSync.ts","../../../../packages/singing-trainer-ui/src/lib/components/youtube/YouTubePlayer.svelte","../../../../packages/singing-trainer-ui/src/lib/components/controls/SyncControls.svelte","../../../../packages/singing-trainer-ui/src/lib/components/controls/UltrastarControls.svelte","../../../../packages/singing-trainer-ui/src/lib/components/feedback/PitchReadout.svelte","../../../../packages/singing-trainer-ui/src/lib/stores/resultsState.svelte.ts","../../../../packages/singing-trainer-ui/src/lib/components/feedback/ResultsModal.svelte","../../../../packages/handoff/src/types.ts","../../../../packages/handoff/src/storage.ts","../../../../packages/handoff/src/navigation.ts","../../../../packages/singing-trainer-ui/src/lib/stores/handoffState.svelte.ts","../../../../packages/singing-trainer-ui/src/App.svelte","../../../../packages/singing-trainer-ui/src/index.ts","../../src/main.ts"],"sourcesContent":["export default false;\n","// Store the references to globals in case someone tries to monkey patch these, causing the below\n// to de-opt (this occurs often when using popular extensions).\nexport var is_array = Array.isArray;\nexport var index_of = Array.prototype.indexOf;\nexport var array_from = Array.from;\nexport var object_keys = Object.keys;\nexport var define_property = Object.defineProperty;\nexport var get_descriptor = Object.getOwnPropertyDescriptor;\nexport var get_descriptors = Object.getOwnPropertyDescriptors;\nexport var object_prototype = Object.prototype;\nexport var array_prototype = Array.prototype;\nexport var get_prototype_of = Object.getPrototypeOf;\nexport var is_extensible = Object.isExtensible;\n\n/**\n * @param {any} thing\n * @returns {thing is Function}\n */\nexport function is_function(thing) {\n\treturn typeof thing === 'function';\n}\n\nexport const noop = () => {};\n\n// Adapted from https://github.com/then/is-promise/blob/master/index.js\n// Distributed under MIT License https://github.com/then/is-promise/blob/master/LICENSE\n\n/**\n * @template [T=any]\n * @param {any} value\n * @returns {value is PromiseLike<T>}\n */\nexport function is_promise(value) {\n\treturn typeof value?.then === 'function';\n}\n\n/** @param {Function} fn */\nexport function run(fn) {\n\treturn fn();\n}\n\n/** @param {Array<() => void>} arr */\nexport function run_all(arr) {\n\tfor (var i = 0; i < arr.length; i++) {\n\t\tarr[i]();\n\t}\n}\n\n/**\n * TODO replace with Promise.withResolvers once supported widely enough\n * @template [T=void]\n */\nexport function deferred() {\n\t/** @type {(value: T) => void} */\n\tvar resolve;\n\n\t/** @type {(reason: any) => void} */\n\tvar reject;\n\n\t/** @type {Promise<T>} */\n\tvar promise = new Promise((res, rej) => {\n\t\tresolve = res;\n\t\treject = rej;\n\t});\n\n\t// @ts-expect-error\n\treturn { promise, resolve, reject };\n}\n\n/**\n * @template V\n * @param {V} value\n * @param {V | (() => V)} fallback\n * @param {boolean} [lazy]\n * @returns {V}\n */\nexport function fallback(value, fallback, lazy = false) {\n\treturn value === undefined\n\t\t? lazy\n\t\t\t? /** @type {() => V} */ (fallback)()\n\t\t\t: /** @type {V} */ (fallback)\n\t\t: value;\n}\n\n/**\n * When encountering a situation like `let [a, b, c] = $derived(blah())`,\n * we need to stash an intermediate value that `a`, `b`, and `c` derive\n * from, in case it's an iterable\n * @template T\n * @param {ArrayLike<T> | Iterable<T>} value\n * @param {number} [n]\n * @returns {Array<T>}\n */\nexport function to_array(value, n) {\n\t// return arrays unchanged\n\tif (Array.isArray(value)) {\n\t\treturn value;\n\t}\n\n\t// if value is not iterable, or `n` is unspecified (indicates a rest\n\t// element, which means we're not concerned about unbounded iterables)\n\t// convert to an array with `Array.from`\n\tif (n === undefined || !(Symbol.iterator in value)) {\n\t\treturn Array.from(value);\n\t}\n\n\t// otherwise, populate an array with `n` values\n\n\t/** @type {T[]} */\n\tconst array = [];\n\n\tfor (const element of value) {\n\t\tarray.push(element);\n\t\tif (array.length === n) break;\n\t}\n\n\treturn array;\n}\n","// General flags\nexport const DERIVED = 1 << 1;\nexport const EFFECT = 1 << 2;\nexport const RENDER_EFFECT = 1 << 3;\n/**\n * An effect that does not destroy its child effects when it reruns.\n * Runs as part of render effects, i.e. not eagerly as part of tree traversal or effect flushing.\n */\nexport const MANAGED_EFFECT = 1 << 24;\n/**\n * An effect that does not destroy its child effects when it reruns (like MANAGED_EFFECT).\n * Runs eagerly as part of tree traversal or effect flushing.\n */\nexport const BLOCK_EFFECT = 1 << 4;\nexport const BRANCH_EFFECT = 1 << 5;\nexport const ROOT_EFFECT = 1 << 6;\nexport const BOUNDARY_EFFECT = 1 << 7;\n/**\n * Indicates that a reaction is connected to an effect root  either it is an effect,\n * or it is a derived that is depended on by at least one effect. If a derived has\n * no dependents, we can disconnect it from the graph, allowing it to either be\n * GC'd or reconnected later if an effect comes to depend on it again\n */\nexport const CONNECTED = 1 << 9;\nexport const CLEAN = 1 << 10;\nexport const DIRTY = 1 << 11;\nexport const MAYBE_DIRTY = 1 << 12;\nexport const INERT = 1 << 13;\nexport const DESTROYED = 1 << 14;\n\n// Flags exclusive to effects\n/** Set once an effect that should run synchronously has run */\nexport const EFFECT_RAN = 1 << 15;\n/**\n * 'Transparent' effects do not create a transition boundary.\n * This is on a block effect 99% of the time but may also be on a branch effect if its parent block effect was pruned\n */\nexport const EFFECT_TRANSPARENT = 1 << 16;\nexport const EAGER_EFFECT = 1 << 17;\nexport const HEAD_EFFECT = 1 << 18;\nexport const EFFECT_PRESERVED = 1 << 19;\nexport const USER_EFFECT = 1 << 20;\nexport const EFFECT_OFFSCREEN = 1 << 25;\n\n// Flags exclusive to deriveds\n/**\n * Tells that we marked this derived and its reactions as visited during the \"mark as (maybe) dirty\"-phase.\n * Will be lifted during execution of the derived and during checking its dirty state (both are necessary\n * because a derived might be checked but not executed).\n */\nexport const WAS_MARKED = 1 << 15;\n\n// Flags used for async\nexport const REACTION_IS_UPDATING = 1 << 21;\nexport const ASYNC = 1 << 22;\n\nexport const ERROR_VALUE = 1 << 23;\n\nexport const STATE_SYMBOL = Symbol('$state');\nexport const LEGACY_PROPS = Symbol('legacy props');\nexport const LOADING_ATTR_SYMBOL = Symbol('');\nexport const PROXY_PATH_SYMBOL = Symbol('proxy path');\n\n/** allow users to ignore aborted signal errors if `reason.name === 'StaleReactionError` */\nexport const STALE_REACTION = new (class StaleReactionError extends Error {\n\tname = 'StaleReactionError';\n\tmessage = 'The reaction that called `getAbortSignal()` was re-run or destroyed';\n})();\n\nexport const ELEMENT_NODE = 1;\nexport const TEXT_NODE = 3;\nexport const COMMENT_NODE = 8;\nexport const DOCUMENT_FRAGMENT_NODE = 11;\n","/* This file is generated by scripts/process-messages/index.js. Do not edit! */\n\nimport { DEV } from 'esm-env';\n\n/**\n * Cannot use `%name%(...)` unless the `experimental.async` compiler option is `true`\n * @param {string} name\n * @returns {never}\n */\nexport function experimental_async_required(name) {\n\tif (DEV) {\n\t\tconst error = new Error(`experimental_async_required\\nCannot use \\`${name}(...)\\` unless the \\`experimental.async\\` compiler option is \\`true\\`\\nhttps://svelte.dev/e/experimental_async_required`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/experimental_async_required`);\n\t}\n}\n\n/**\n * Cannot use `{@render children(...)}` if the parent component uses `let:` directives. Consider using a named snippet instead\n * @returns {never}\n */\nexport function invalid_default_snippet() {\n\tif (DEV) {\n\t\tconst error = new Error(`invalid_default_snippet\\nCannot use \\`{@render children(...)}\\` if the parent component uses \\`let:\\` directives. Consider using a named snippet instead\\nhttps://svelte.dev/e/invalid_default_snippet`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/invalid_default_snippet`);\n\t}\n}\n\n/**\n * A snippet function was passed invalid arguments. Snippets should only be instantiated via `{@render ...}`\n * @returns {never}\n */\nexport function invalid_snippet_arguments() {\n\tif (DEV) {\n\t\tconst error = new Error(`invalid_snippet_arguments\\nA snippet function was passed invalid arguments. Snippets should only be instantiated via \\`{@render ...}\\`\\nhttps://svelte.dev/e/invalid_snippet_arguments`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/invalid_snippet_arguments`);\n\t}\n}\n\n/**\n * `%name%(...)` can only be used during component initialisation\n * @param {string} name\n * @returns {never}\n */\nexport function lifecycle_outside_component(name) {\n\tif (DEV) {\n\t\tconst error = new Error(`lifecycle_outside_component\\n\\`${name}(...)\\` can only be used during component initialisation\\nhttps://svelte.dev/e/lifecycle_outside_component`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/lifecycle_outside_component`);\n\t}\n}\n\n/**\n * Context was not set in a parent component\n * @returns {never}\n */\nexport function missing_context() {\n\tif (DEV) {\n\t\tconst error = new Error(`missing_context\\nContext was not set in a parent component\\nhttps://svelte.dev/e/missing_context`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/missing_context`);\n\t}\n}\n\n/**\n * Attempted to render a snippet without a `{@render}` block. This would cause the snippet code to be stringified instead of its content being rendered to the DOM. To fix this, change `{snippet}` to `{@render snippet()}`.\n * @returns {never}\n */\nexport function snippet_without_render_tag() {\n\tif (DEV) {\n\t\tconst error = new Error(`snippet_without_render_tag\\nAttempted to render a snippet without a \\`{@render}\\` block. This would cause the snippet code to be stringified instead of its content being rendered to the DOM. To fix this, change \\`{snippet}\\` to \\`{@render snippet()}\\`.\\nhttps://svelte.dev/e/snippet_without_render_tag`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/snippet_without_render_tag`);\n\t}\n}\n\n/**\n * `%name%` is not a store with a `subscribe` method\n * @param {string} name\n * @returns {never}\n */\nexport function store_invalid_shape(name) {\n\tif (DEV) {\n\t\tconst error = new Error(`store_invalid_shape\\n\\`${name}\\` is not a store with a \\`subscribe\\` method\\nhttps://svelte.dev/e/store_invalid_shape`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/store_invalid_shape`);\n\t}\n}\n\n/**\n * The `this` prop on `<svelte:element>` must be a string, if defined\n * @returns {never}\n */\nexport function svelte_element_invalid_this_value() {\n\tif (DEV) {\n\t\tconst error = new Error(`svelte_element_invalid_this_value\\nThe \\`this\\` prop on \\`<svelte:element>\\` must be a string, if defined\\nhttps://svelte.dev/e/svelte_element_invalid_this_value`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/svelte_element_invalid_this_value`);\n\t}\n}","/* This file is generated by scripts/process-messages/index.js. Do not edit! */\n\nimport { DEV } from 'esm-env';\n\nexport *  from '../shared/errors.js';\n\n/**\n * Cannot create a `$derived(...)` with an `await` expression outside of an effect tree\n * @returns {never}\n */\nexport function async_derived_orphan() {\n\tif (DEV) {\n\t\tconst error = new Error(`async_derived_orphan\\nCannot create a \\`$derived(...)\\` with an \\`await\\` expression outside of an effect tree\\nhttps://svelte.dev/e/async_derived_orphan`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/async_derived_orphan`);\n\t}\n}\n\n/**\n * Using `bind:value` together with a checkbox input is not allowed. Use `bind:checked` instead\n * @returns {never}\n */\nexport function bind_invalid_checkbox_value() {\n\tif (DEV) {\n\t\tconst error = new Error(`bind_invalid_checkbox_value\\nUsing \\`bind:value\\` together with a checkbox input is not allowed. Use \\`bind:checked\\` instead\\nhttps://svelte.dev/e/bind_invalid_checkbox_value`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/bind_invalid_checkbox_value`);\n\t}\n}\n\n/**\n * Component %component% has an export named `%key%` that a consumer component is trying to access using `bind:%key%`, which is disallowed. Instead, use `bind:this` (e.g. `<%name% bind:this={component} />`) and then access the property on the bound component instance (e.g. `component.%key%`)\n * @param {string} component\n * @param {string} key\n * @param {string} name\n * @returns {never}\n */\nexport function bind_invalid_export(component, key, name) {\n\tif (DEV) {\n\t\tconst error = new Error(`bind_invalid_export\\nComponent ${component} has an export named \\`${key}\\` that a consumer component is trying to access using \\`bind:${key}\\`, which is disallowed. Instead, use \\`bind:this\\` (e.g. \\`<${name} bind:this={component} />\\`) and then access the property on the bound component instance (e.g. \\`component.${key}\\`)\\nhttps://svelte.dev/e/bind_invalid_export`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/bind_invalid_export`);\n\t}\n}\n\n/**\n * A component is attempting to bind to a non-bindable property `%key%` belonging to %component% (i.e. `<%name% bind:%key%={...}>`). To mark a property as bindable: `let { %key% = $bindable() } = $props()`\n * @param {string} key\n * @param {string} component\n * @param {string} name\n * @returns {never}\n */\nexport function bind_not_bindable(key, component, name) {\n\tif (DEV) {\n\t\tconst error = new Error(`bind_not_bindable\\nA component is attempting to bind to a non-bindable property \\`${key}\\` belonging to ${component} (i.e. \\`<${name} bind:${key}={...}>\\`). To mark a property as bindable: \\`let { ${key} = $bindable() } = $props()\\`\\nhttps://svelte.dev/e/bind_not_bindable`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/bind_not_bindable`);\n\t}\n}\n\n/**\n * Calling `%method%` on a component instance (of %component%) is no longer valid in Svelte 5\n * @param {string} method\n * @param {string} component\n * @returns {never}\n */\nexport function component_api_changed(method, component) {\n\tif (DEV) {\n\t\tconst error = new Error(`component_api_changed\\nCalling \\`${method}\\` on a component instance (of ${component}) is no longer valid in Svelte 5\\nhttps://svelte.dev/e/component_api_changed`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/component_api_changed`);\n\t}\n}\n\n/**\n * Attempted to instantiate %component% with `new %name%`, which is no longer valid in Svelte 5. If this component is not under your control, set the `compatibility.componentApi` compiler option to `4` to keep it working.\n * @param {string} component\n * @param {string} name\n * @returns {never}\n */\nexport function component_api_invalid_new(component, name) {\n\tif (DEV) {\n\t\tconst error = new Error(`component_api_invalid_new\\nAttempted to instantiate ${component} with \\`new ${name}\\`, which is no longer valid in Svelte 5. If this component is not under your control, set the \\`compatibility.componentApi\\` compiler option to \\`4\\` to keep it working.\\nhttps://svelte.dev/e/component_api_invalid_new`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/component_api_invalid_new`);\n\t}\n}\n\n/**\n * A derived value cannot reference itself recursively\n * @returns {never}\n */\nexport function derived_references_self() {\n\tif (DEV) {\n\t\tconst error = new Error(`derived_references_self\\nA derived value cannot reference itself recursively\\nhttps://svelte.dev/e/derived_references_self`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/derived_references_self`);\n\t}\n}\n\n/**\n * Keyed each block has duplicate key `%value%` at indexes %a% and %b%\n * @param {string} a\n * @param {string} b\n * @param {string | undefined | null} [value]\n * @returns {never}\n */\nexport function each_key_duplicate(a, b, value) {\n\tif (DEV) {\n\t\tconst error = new Error(`each_key_duplicate\\n${value\n\t\t\t? `Keyed each block has duplicate key \\`${value}\\` at indexes ${a} and ${b}`\n\t\t\t: `Keyed each block has duplicate key at indexes ${a} and ${b}`}\\nhttps://svelte.dev/e/each_key_duplicate`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/each_key_duplicate`);\n\t}\n}\n\n/**\n * `%rune%` cannot be used inside an effect cleanup function\n * @param {string} rune\n * @returns {never}\n */\nexport function effect_in_teardown(rune) {\n\tif (DEV) {\n\t\tconst error = new Error(`effect_in_teardown\\n\\`${rune}\\` cannot be used inside an effect cleanup function\\nhttps://svelte.dev/e/effect_in_teardown`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/effect_in_teardown`);\n\t}\n}\n\n/**\n * Effect cannot be created inside a `$derived` value that was not itself created inside an effect\n * @returns {never}\n */\nexport function effect_in_unowned_derived() {\n\tif (DEV) {\n\t\tconst error = new Error(`effect_in_unowned_derived\\nEffect cannot be created inside a \\`$derived\\` value that was not itself created inside an effect\\nhttps://svelte.dev/e/effect_in_unowned_derived`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/effect_in_unowned_derived`);\n\t}\n}\n\n/**\n * `%rune%` can only be used inside an effect (e.g. during component initialisation)\n * @param {string} rune\n * @returns {never}\n */\nexport function effect_orphan(rune) {\n\tif (DEV) {\n\t\tconst error = new Error(`effect_orphan\\n\\`${rune}\\` can only be used inside an effect (e.g. during component initialisation)\\nhttps://svelte.dev/e/effect_orphan`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/effect_orphan`);\n\t}\n}\n\n/**\n * `$effect.pending()` can only be called inside an effect or derived\n * @returns {never}\n */\nexport function effect_pending_outside_reaction() {\n\tif (DEV) {\n\t\tconst error = new Error(`effect_pending_outside_reaction\\n\\`$effect.pending()\\` can only be called inside an effect or derived\\nhttps://svelte.dev/e/effect_pending_outside_reaction`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/effect_pending_outside_reaction`);\n\t}\n}\n\n/**\n * Maximum update depth exceeded. This typically indicates that an effect reads and writes the same piece of state\n * @returns {never}\n */\nexport function effect_update_depth_exceeded() {\n\tif (DEV) {\n\t\tconst error = new Error(`effect_update_depth_exceeded\\nMaximum update depth exceeded. This typically indicates that an effect reads and writes the same piece of state\\nhttps://svelte.dev/e/effect_update_depth_exceeded`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/effect_update_depth_exceeded`);\n\t}\n}\n\n/**\n * Cannot use `flushSync` inside an effect\n * @returns {never}\n */\nexport function flush_sync_in_effect() {\n\tif (DEV) {\n\t\tconst error = new Error(`flush_sync_in_effect\\nCannot use \\`flushSync\\` inside an effect\\nhttps://svelte.dev/e/flush_sync_in_effect`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/flush_sync_in_effect`);\n\t}\n}\n\n/**\n * Cannot commit a fork that was already discarded\n * @returns {never}\n */\nexport function fork_discarded() {\n\tif (DEV) {\n\t\tconst error = new Error(`fork_discarded\\nCannot commit a fork that was already discarded\\nhttps://svelte.dev/e/fork_discarded`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/fork_discarded`);\n\t}\n}\n\n/**\n * Cannot create a fork inside an effect or when state changes are pending\n * @returns {never}\n */\nexport function fork_timing() {\n\tif (DEV) {\n\t\tconst error = new Error(`fork_timing\\nCannot create a fork inside an effect or when state changes are pending\\nhttps://svelte.dev/e/fork_timing`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/fork_timing`);\n\t}\n}\n\n/**\n * `getAbortSignal()` can only be called inside an effect or derived\n * @returns {never}\n */\nexport function get_abort_signal_outside_reaction() {\n\tif (DEV) {\n\t\tconst error = new Error(`get_abort_signal_outside_reaction\\n\\`getAbortSignal()\\` can only be called inside an effect or derived\\nhttps://svelte.dev/e/get_abort_signal_outside_reaction`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/get_abort_signal_outside_reaction`);\n\t}\n}\n\n/**\n * Expected to find a hydratable with key `%key%` during hydration, but did not.\n * @param {string} key\n * @returns {never}\n */\nexport function hydratable_missing_but_required(key) {\n\tif (DEV) {\n\t\tconst error = new Error(`hydratable_missing_but_required\\nExpected to find a hydratable with key \\`${key}\\` during hydration, but did not.\\nhttps://svelte.dev/e/hydratable_missing_but_required`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/hydratable_missing_but_required`);\n\t}\n}\n\n/**\n * Failed to hydrate the application\n * @returns {never}\n */\nexport function hydration_failed() {\n\tif (DEV) {\n\t\tconst error = new Error(`hydration_failed\\nFailed to hydrate the application\\nhttps://svelte.dev/e/hydration_failed`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/hydration_failed`);\n\t}\n}\n\n/**\n * Could not `{@render}` snippet due to the expression being `null` or `undefined`. Consider using optional chaining `{@render snippet?.()}`\n * @returns {never}\n */\nexport function invalid_snippet() {\n\tif (DEV) {\n\t\tconst error = new Error(`invalid_snippet\\nCould not \\`{@render}\\` snippet due to the expression being \\`null\\` or \\`undefined\\`. Consider using optional chaining \\`{@render snippet?.()}\\`\\nhttps://svelte.dev/e/invalid_snippet`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/invalid_snippet`);\n\t}\n}\n\n/**\n * `%name%(...)` cannot be used in runes mode\n * @param {string} name\n * @returns {never}\n */\nexport function lifecycle_legacy_only(name) {\n\tif (DEV) {\n\t\tconst error = new Error(`lifecycle_legacy_only\\n\\`${name}(...)\\` cannot be used in runes mode\\nhttps://svelte.dev/e/lifecycle_legacy_only`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/lifecycle_legacy_only`);\n\t}\n}\n\n/**\n * Cannot do `bind:%key%={undefined}` when `%key%` has a fallback value\n * @param {string} key\n * @returns {never}\n */\nexport function props_invalid_value(key) {\n\tif (DEV) {\n\t\tconst error = new Error(`props_invalid_value\\nCannot do \\`bind:${key}={undefined}\\` when \\`${key}\\` has a fallback value\\nhttps://svelte.dev/e/props_invalid_value`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/props_invalid_value`);\n\t}\n}\n\n/**\n * Rest element properties of `$props()` such as `%property%` are readonly\n * @param {string} property\n * @returns {never}\n */\nexport function props_rest_readonly(property) {\n\tif (DEV) {\n\t\tconst error = new Error(`props_rest_readonly\\nRest element properties of \\`$props()\\` such as \\`${property}\\` are readonly\\nhttps://svelte.dev/e/props_rest_readonly`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/props_rest_readonly`);\n\t}\n}\n\n/**\n * The `%rune%` rune is only available inside `.svelte` and `.svelte.js/ts` files\n * @param {string} rune\n * @returns {never}\n */\nexport function rune_outside_svelte(rune) {\n\tif (DEV) {\n\t\tconst error = new Error(`rune_outside_svelte\\nThe \\`${rune}\\` rune is only available inside \\`.svelte\\` and \\`.svelte.js/ts\\` files\\nhttps://svelte.dev/e/rune_outside_svelte`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/rune_outside_svelte`);\n\t}\n}\n\n/**\n * `setContext` must be called when a component first initializes, not in a subsequent effect or after an `await` expression\n * @returns {never}\n */\nexport function set_context_after_init() {\n\tif (DEV) {\n\t\tconst error = new Error(`set_context_after_init\\n\\`setContext\\` must be called when a component first initializes, not in a subsequent effect or after an \\`await\\` expression\\nhttps://svelte.dev/e/set_context_after_init`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/set_context_after_init`);\n\t}\n}\n\n/**\n * Property descriptors defined on `$state` objects must contain `value` and always be `enumerable`, `configurable` and `writable`.\n * @returns {never}\n */\nexport function state_descriptors_fixed() {\n\tif (DEV) {\n\t\tconst error = new Error(`state_descriptors_fixed\\nProperty descriptors defined on \\`$state\\` objects must contain \\`value\\` and always be \\`enumerable\\`, \\`configurable\\` and \\`writable\\`.\\nhttps://svelte.dev/e/state_descriptors_fixed`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/state_descriptors_fixed`);\n\t}\n}\n\n/**\n * Cannot set prototype of `$state` object\n * @returns {never}\n */\nexport function state_prototype_fixed() {\n\tif (DEV) {\n\t\tconst error = new Error(`state_prototype_fixed\\nCannot set prototype of \\`$state\\` object\\nhttps://svelte.dev/e/state_prototype_fixed`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/state_prototype_fixed`);\n\t}\n}\n\n/**\n * Updating state inside `$derived(...)`, `$inspect(...)` or a template expression is forbidden. If the value should not be reactive, declare it without `$state`\n * @returns {never}\n */\nexport function state_unsafe_mutation() {\n\tif (DEV) {\n\t\tconst error = new Error(`state_unsafe_mutation\\nUpdating state inside \\`$derived(...)\\`, \\`$inspect(...)\\` or a template expression is forbidden. If the value should not be reactive, declare it without \\`$state\\`\\nhttps://svelte.dev/e/state_unsafe_mutation`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/state_unsafe_mutation`);\n\t}\n}\n\n/**\n * A `<svelte:boundary>` `reset` function cannot be called while an error is still being handled\n * @returns {never}\n */\nexport function svelte_boundary_reset_onerror() {\n\tif (DEV) {\n\t\tconst error = new Error(`svelte_boundary_reset_onerror\\nA \\`<svelte:boundary>\\` \\`reset\\` function cannot be called while an error is still being handled\\nhttps://svelte.dev/e/svelte_boundary_reset_onerror`);\n\n\t\terror.name = 'Svelte error';\n\n\t\tthrow error;\n\t} else {\n\t\tthrow new Error(`https://svelte.dev/e/svelte_boundary_reset_onerror`);\n\t}\n}","export const EACH_ITEM_REACTIVE = 1;\nexport const EACH_INDEX_REACTIVE = 1 << 1;\n/** See EachBlock interface metadata.is_controlled for an explanation what this is */\nexport const EACH_IS_CONTROLLED = 1 << 2;\nexport const EACH_IS_ANIMATED = 1 << 3;\nexport const EACH_ITEM_IMMUTABLE = 1 << 4;\n\nexport const PROPS_IS_IMMUTABLE = 1;\nexport const PROPS_IS_RUNES = 1 << 1;\nexport const PROPS_IS_UPDATED = 1 << 2;\nexport const PROPS_IS_BINDABLE = 1 << 3;\nexport const PROPS_IS_LAZY_INITIAL = 1 << 4;\n\nexport const TRANSITION_IN = 1;\nexport const TRANSITION_OUT = 1 << 1;\nexport const TRANSITION_GLOBAL = 1 << 2;\n\nexport const TEMPLATE_FRAGMENT = 1;\nexport const TEMPLATE_USE_IMPORT_NODE = 1 << 1;\nexport const TEMPLATE_USE_SVG = 1 << 2;\nexport const TEMPLATE_USE_MATHML = 1 << 3;\n\nexport const HYDRATION_START = '[';\n/** used to indicate that an `{:else}...` block was rendered */\nexport const HYDRATION_START_ELSE = '[!';\nexport const HYDRATION_END = ']';\nexport const HYDRATION_ERROR = {};\n\nexport const ELEMENT_IS_NAMESPACED = 1;\nexport const ELEMENT_PRESERVE_ATTRIBUTE_CASE = 1 << 1;\nexport const ELEMENT_IS_INPUT = 1 << 2;\n\nexport const UNINITIALIZED = Symbol();\n\n// Dev-time component properties\nexport const FILENAME = Symbol('filename');\nexport const HMR = Symbol('hmr');\n\nexport const NAMESPACE_HTML = 'http://www.w3.org/1999/xhtml';\nexport const NAMESPACE_SVG = 'http://www.w3.org/2000/svg';\nexport const NAMESPACE_MATHML = 'http://www.w3.org/1998/Math/MathML';\n\n// we use a list of ignorable runtime warnings because not every runtime warning\n// can be ignored and we want to keep the validation for svelte-ignore in place\nexport const IGNORABLE_RUNTIME_WARNINGS = /** @type {const} */ ([\n\t'await_waterfall',\n\t'await_reactivity_loss',\n\t'state_snapshot_uncloneable',\n\t'binding_property_non_reactive',\n\t'hydration_attribute_changed',\n\t'hydration_html_changed',\n\t'ownership_invalid_binding',\n\t'ownership_invalid_mutation'\n]);\n\n/**\n * Whitespace inside one of these elements will not result in\n * a whitespace node being created in any circumstances. (This\n * list is almost certainly very incomplete)\n * TODO this is currently unused\n */\nexport const ELEMENTS_WITHOUT_TEXT = ['audio', 'datalist', 'dl', 'optgroup', 'select', 'video'];\n\nexport const ATTACHMENT_KEY = '@attach';\n","/* This file is generated by scripts/process-messages/index.js. Do not edit! */\n\nimport { DEV } from 'esm-env';\n\nvar bold = 'font-weight: bold';\nvar normal = 'font-weight: normal';\n\n/**\n * Assignment to `%property%` property (%location%) will evaluate to the right-hand side, not the value of `%property%` following the assignment. This may result in unexpected behaviour.\n * @param {string} property\n * @param {string} location\n */\nexport function assignment_value_stale(property, location) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] assignment_value_stale\\n%cAssignment to \\`${property}\\` property (${location}) will evaluate to the right-hand side, not the value of \\`${property}\\` following the assignment. This may result in unexpected behaviour.\\nhttps://svelte.dev/e/assignment_value_stale`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/assignment_value_stale`);\n\t}\n}\n\n/**\n * Detected reactivity loss when reading `%name%`. This happens when state is read in an async function after an earlier `await`\n * @param {string} name\n */\nexport function await_reactivity_loss(name) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] await_reactivity_loss\\n%cDetected reactivity loss when reading \\`${name}\\`. This happens when state is read in an async function after an earlier \\`await\\`\\nhttps://svelte.dev/e/await_reactivity_loss`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/await_reactivity_loss`);\n\t}\n}\n\n/**\n * An async derived, `%name%` (%location%) was not read immediately after it resolved. This often indicates an unnecessary waterfall, which can slow down your app\n * @param {string} name\n * @param {string} location\n */\nexport function await_waterfall(name, location) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] await_waterfall\\n%cAn async derived, \\`${name}\\` (${location}) was not read immediately after it resolved. This often indicates an unnecessary waterfall, which can slow down your app\\nhttps://svelte.dev/e/await_waterfall`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/await_waterfall`);\n\t}\n}\n\n/**\n * `%binding%` (%location%) is binding to a non-reactive property\n * @param {string} binding\n * @param {string | undefined | null} [location]\n */\nexport function binding_property_non_reactive(binding, location) {\n\tif (DEV) {\n\t\tconsole.warn(\n\t\t\t`%c[svelte] binding_property_non_reactive\\n%c${location\n\t\t\t\t? `\\`${binding}\\` (${location}) is binding to a non-reactive property`\n\t\t\t\t: `\\`${binding}\\` is binding to a non-reactive property`}\\nhttps://svelte.dev/e/binding_property_non_reactive`,\n\t\t\tbold,\n\t\t\tnormal\n\t\t);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/binding_property_non_reactive`);\n\t}\n}\n\n/**\n * Your `console.%method%` contained `$state` proxies. Consider using `$inspect(...)` or `$state.snapshot(...)` instead\n * @param {string} method\n */\nexport function console_log_state(method) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] console_log_state\\n%cYour \\`console.${method}\\` contained \\`$state\\` proxies. Consider using \\`$inspect(...)\\` or \\`$state.snapshot(...)\\` instead\\nhttps://svelte.dev/e/console_log_state`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/console_log_state`);\n\t}\n}\n\n/**\n * %handler% should be a function. Did you mean to %suggestion%?\n * @param {string} handler\n * @param {string} suggestion\n */\nexport function event_handler_invalid(handler, suggestion) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] event_handler_invalid\\n%c${handler} should be a function. Did you mean to ${suggestion}?\\nhttps://svelte.dev/e/event_handler_invalid`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/event_handler_invalid`);\n\t}\n}\n\n/**\n * Expected to find a hydratable with key `%key%` during hydration, but did not.\n * @param {string} key\n */\nexport function hydratable_missing_but_expected(key) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] hydratable_missing_but_expected\\n%cExpected to find a hydratable with key \\`${key}\\` during hydration, but did not.\\nhttps://svelte.dev/e/hydratable_missing_but_expected`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/hydratable_missing_but_expected`);\n\t}\n}\n\n/**\n * The `%attribute%` attribute on `%html%` changed its value between server and client renders. The client value, `%value%`, will be ignored in favour of the server value\n * @param {string} attribute\n * @param {string} html\n * @param {string} value\n */\nexport function hydration_attribute_changed(attribute, html, value) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] hydration_attribute_changed\\n%cThe \\`${attribute}\\` attribute on \\`${html}\\` changed its value between server and client renders. The client value, \\`${value}\\`, will be ignored in favour of the server value\\nhttps://svelte.dev/e/hydration_attribute_changed`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/hydration_attribute_changed`);\n\t}\n}\n\n/**\n * The value of an `{@html ...}` block %location% changed between server and client renders. The client value will be ignored in favour of the server value\n * @param {string | undefined | null} [location]\n */\nexport function hydration_html_changed(location) {\n\tif (DEV) {\n\t\tconsole.warn(\n\t\t\t`%c[svelte] hydration_html_changed\\n%c${location\n\t\t\t\t? `The value of an \\`{@html ...}\\` block ${location} changed between server and client renders. The client value will be ignored in favour of the server value`\n\t\t\t\t: 'The value of an `{@html ...}` block changed between server and client renders. The client value will be ignored in favour of the server value'}\\nhttps://svelte.dev/e/hydration_html_changed`,\n\t\t\tbold,\n\t\t\tnormal\n\t\t);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/hydration_html_changed`);\n\t}\n}\n\n/**\n * Hydration failed because the initial UI does not match what was rendered on the server. The error occurred near %location%\n * @param {string | undefined | null} [location]\n */\nexport function hydration_mismatch(location) {\n\tif (DEV) {\n\t\tconsole.warn(\n\t\t\t`%c[svelte] hydration_mismatch\\n%c${location\n\t\t\t\t? `Hydration failed because the initial UI does not match what was rendered on the server. The error occurred near ${location}`\n\t\t\t\t: 'Hydration failed because the initial UI does not match what was rendered on the server'}\\nhttps://svelte.dev/e/hydration_mismatch`,\n\t\t\tbold,\n\t\t\tnormal\n\t\t);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/hydration_mismatch`);\n\t}\n}\n\n/**\n * The `render` function passed to `createRawSnippet` should return HTML for a single element\n */\nexport function invalid_raw_snippet_render() {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] invalid_raw_snippet_render\\n%cThe \\`render\\` function passed to \\`createRawSnippet\\` should return HTML for a single element\\nhttps://svelte.dev/e/invalid_raw_snippet_render`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/invalid_raw_snippet_render`);\n\t}\n}\n\n/**\n * Detected a migrated `$:` reactive block in `%filename%` that both accesses and updates the same reactive value. This may cause recursive updates when converted to an `$effect`.\n * @param {string} filename\n */\nexport function legacy_recursive_reactive_block(filename) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] legacy_recursive_reactive_block\\n%cDetected a migrated \\`$:\\` reactive block in \\`${filename}\\` that both accesses and updates the same reactive value. This may cause recursive updates when converted to an \\`$effect\\`.\\nhttps://svelte.dev/e/legacy_recursive_reactive_block`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/legacy_recursive_reactive_block`);\n\t}\n}\n\n/**\n * Tried to unmount a component that was not mounted\n */\nexport function lifecycle_double_unmount() {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] lifecycle_double_unmount\\n%cTried to unmount a component that was not mounted\\nhttps://svelte.dev/e/lifecycle_double_unmount`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/lifecycle_double_unmount`);\n\t}\n}\n\n/**\n * %parent% passed property `%prop%` to %child% with `bind:`, but its parent component %owner% did not declare `%prop%` as a binding. Consider creating a binding between %owner% and %parent% (e.g. `bind:%prop%={...}` instead of `%prop%={...}`)\n * @param {string} parent\n * @param {string} prop\n * @param {string} child\n * @param {string} owner\n */\nexport function ownership_invalid_binding(parent, prop, child, owner) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] ownership_invalid_binding\\n%c${parent} passed property \\`${prop}\\` to ${child} with \\`bind:\\`, but its parent component ${owner} did not declare \\`${prop}\\` as a binding. Consider creating a binding between ${owner} and ${parent} (e.g. \\`bind:${prop}={...}\\` instead of \\`${prop}={...}\\`)\\nhttps://svelte.dev/e/ownership_invalid_binding`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/ownership_invalid_binding`);\n\t}\n}\n\n/**\n * Mutating unbound props (`%name%`, at %location%) is strongly discouraged. Consider using `bind:%prop%={...}` in %parent% (or using a callback) instead\n * @param {string} name\n * @param {string} location\n * @param {string} prop\n * @param {string} parent\n */\nexport function ownership_invalid_mutation(name, location, prop, parent) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] ownership_invalid_mutation\\n%cMutating unbound props (\\`${name}\\`, at ${location}) is strongly discouraged. Consider using \\`bind:${prop}={...}\\` in ${parent} (or using a callback) instead\\nhttps://svelte.dev/e/ownership_invalid_mutation`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/ownership_invalid_mutation`);\n\t}\n}\n\n/**\n * The `value` property of a `<select multiple>` element should be an array, but it received a non-array value. The selection will be kept as is.\n */\nexport function select_multiple_invalid_value() {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] select_multiple_invalid_value\\n%cThe \\`value\\` property of a \\`<select multiple>\\` element should be an array, but it received a non-array value. The selection will be kept as is.\\nhttps://svelte.dev/e/select_multiple_invalid_value`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/select_multiple_invalid_value`);\n\t}\n}\n\n/**\n * Reactive `$state(...)` proxies and the values they proxy have different identities. Because of this, comparisons with `%operator%` will produce unexpected results\n * @param {string} operator\n */\nexport function state_proxy_equality_mismatch(operator) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] state_proxy_equality_mismatch\\n%cReactive \\`$state(...)\\` proxies and the values they proxy have different identities. Because of this, comparisons with \\`${operator}\\` will produce unexpected results\\nhttps://svelte.dev/e/state_proxy_equality_mismatch`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/state_proxy_equality_mismatch`);\n\t}\n}\n\n/**\n * Tried to unmount a state proxy, rather than a component\n */\nexport function state_proxy_unmount() {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] state_proxy_unmount\\n%cTried to unmount a state proxy, rather than a component\\nhttps://svelte.dev/e/state_proxy_unmount`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/state_proxy_unmount`);\n\t}\n}\n\n/**\n * A `<svelte:boundary>` `reset` function only resets the boundary the first time it is called\n */\nexport function svelte_boundary_reset_noop() {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] svelte_boundary_reset_noop\\n%cA \\`<svelte:boundary>\\` \\`reset\\` function only resets the boundary the first time it is called\\nhttps://svelte.dev/e/svelte_boundary_reset_noop`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/svelte_boundary_reset_noop`);\n\t}\n}\n\n/**\n * The `slide` transition does not work correctly for elements with `display: %value%`\n * @param {string} value\n */\nexport function transition_slide_display(value) {\n\tif (DEV) {\n\t\tconsole.warn(`%c[svelte] transition_slide_display\\n%cThe \\`slide\\` transition does not work correctly for elements with \\`display: ${value}\\`\\nhttps://svelte.dev/e/transition_slide_display`, bold, normal);\n\t} else {\n\t\tconsole.warn(`https://svelte.dev/e/transition_slide_display`);\n\t}\n}","/** @import { Equals } from '#client' */\n\n/** @type {Equals} */\nexport function equals(value) {\n\treturn value === this.v;\n}\n\n/**\n * @param {unknown} a\n * @param {unknown} b\n * @returns {boolean}\n */\nexport function safe_not_equal(a, b) {\n\treturn a != a\n\t\t? b == b\n\t\t: a !== b || (a !== null && typeof a === 'object') || typeof a === 'function';\n}\n\n/**\n * @param {unknown} a\n * @param {unknown} b\n * @returns {boolean}\n */\nexport function not_equal(a, b) {\n\treturn a !== b;\n}\n\n/** @type {Equals} */\nexport function safe_equals(value) {\n\treturn !safe_not_equal(value, this.v);\n}\n","/** True if experimental.async=true */\nexport let async_mode_flag = false;\n/** True if we're not certain that we only have Svelte 5 code in the compilation */\nexport let legacy_mode_flag = false;\n/** True if $inspect.trace is used */\nexport let tracing_mode_flag = false;\n\nexport function enable_async_mode_flag() {\n\tasync_mode_flag = true;\n}\n\n/** ONLY USE THIS DURING TESTING */\nexport function disable_async_mode_flag() {\n\tasync_mode_flag = false;\n}\n\nexport function enable_legacy_mode_flag() {\n\tlegacy_mode_flag = true;\n}\n\nexport function enable_tracing_mode_flag() {\n\ttracing_mode_flag = true;\n}\n","/** @import { ComponentContext, DevStackEntry, Effect } from '#client' */\nimport { DEV } from 'esm-env';\nimport * as e from './errors.js';\nimport { active_effect, active_reaction } from './runtime.js';\nimport { create_user_effect } from './reactivity/effects.js';\nimport { async_mode_flag, legacy_mode_flag } from '../flags/index.js';\nimport { FILENAME } from '../../constants.js';\nimport { BRANCH_EFFECT, EFFECT_RAN } from './constants.js';\n\n/** @type {ComponentContext | null} */\nexport let component_context = null;\n\n/** @param {ComponentContext | null} context */\nexport function set_component_context(context) {\n\tcomponent_context = context;\n}\n\n/** @type {DevStackEntry | null} */\nexport let dev_stack = null;\n\n/** @param {DevStackEntry | null} stack */\nexport function set_dev_stack(stack) {\n\tdev_stack = stack;\n}\n\n/**\n * Execute a callback with a new dev stack entry\n * @param {() => any} callback - Function to execute\n * @param {DevStackEntry['type']} type - Type of block/component\n * @param {any} component - Component function\n * @param {number} line - Line number\n * @param {number} column - Column number\n * @param {Record<string, any>} [additional] - Any additional properties to add to the dev stack entry\n * @returns {any}\n */\nexport function add_svelte_meta(callback, type, component, line, column, additional) {\n\tconst parent = dev_stack;\n\n\tdev_stack = {\n\t\ttype,\n\t\tfile: component[FILENAME],\n\t\tline,\n\t\tcolumn,\n\t\tparent,\n\t\t...additional\n\t};\n\n\ttry {\n\t\treturn callback();\n\t} finally {\n\t\tdev_stack = parent;\n\t}\n}\n\n/**\n * The current component function. Different from current component context:\n * ```html\n * <!-- App.svelte -->\n * <Foo>\n *   <Bar /> <!-- context == Foo.svelte, function == App.svelte -->\n * </Foo>\n * ```\n * @type {ComponentContext['function']}\n */\nexport let dev_current_component_function = null;\n\n/** @param {ComponentContext['function']} fn */\nexport function set_dev_current_component_function(fn) {\n\tdev_current_component_function = fn;\n}\n\n/**\n * Returns a `[get, set]` pair of functions for working with context in a type-safe way.\n *\n * `get` will throw an error if no parent component called `set`.\n *\n * @template T\n * @returns {[() => T, (context: T) => T]}\n * @since 5.40.0\n */\nexport function createContext() {\n\tconst key = {};\n\n\treturn [\n\t\t() => {\n\t\t\tif (!hasContext(key)) {\n\t\t\t\te.missing_context();\n\t\t\t}\n\n\t\t\treturn getContext(key);\n\t\t},\n\t\t(context) => setContext(key, context)\n\t];\n}\n\n/**\n * Retrieves the context that belongs to the closest parent component with the specified `key`.\n * Must be called during component initialisation.\n *\n * [`createContext`](https://svelte.dev/docs/svelte/svelte#createContext) is a type-safe alternative.\n *\n * @template T\n * @param {any} key\n * @returns {T}\n */\nexport function getContext(key) {\n\tconst context_map = get_or_init_context_map('getContext');\n\tconst result = /** @type {T} */ (context_map.get(key));\n\treturn result;\n}\n\n/**\n * Associates an arbitrary `context` object with the current component and the specified `key`\n * and returns that object. The context is then available to children of the component\n * (including slotted content) with `getContext`.\n *\n * Like lifecycle functions, this must be called during component initialisation.\n *\n * [`createContext`](https://svelte.dev/docs/svelte/svelte#createContext) is a type-safe alternative.\n *\n * @template T\n * @param {any} key\n * @param {T} context\n * @returns {T}\n */\nexport function setContext(key, context) {\n\tconst context_map = get_or_init_context_map('setContext');\n\n\tif (async_mode_flag) {\n\t\tvar flags = /** @type {Effect} */ (active_effect).f;\n\t\tvar valid =\n\t\t\t!active_reaction &&\n\t\t\t(flags & BRANCH_EFFECT) !== 0 &&\n\t\t\t// pop() runs synchronously, so this indicates we're setting context after an await\n\t\t\t!(/** @type {ComponentContext} */ (component_context).i);\n\n\t\tif (!valid) {\n\t\t\te.set_context_after_init();\n\t\t}\n\t}\n\n\tcontext_map.set(key, context);\n\treturn context;\n}\n\n/**\n * Checks whether a given `key` has been set in the context of a parent component.\n * Must be called during component initialisation.\n *\n * @param {any} key\n * @returns {boolean}\n */\nexport function hasContext(key) {\n\tconst context_map = get_or_init_context_map('hasContext');\n\treturn context_map.has(key);\n}\n\n/**\n * Retrieves the whole context map that belongs to the closest parent component.\n * Must be called during component initialisation. Useful, for example, if you\n * programmatically create a component and want to pass the existing context to it.\n *\n * @template {Map<any, any>} [T=Map<any, any>]\n * @returns {T}\n */\nexport function getAllContexts() {\n\tconst context_map = get_or_init_context_map('getAllContexts');\n\treturn /** @type {T} */ (context_map);\n}\n\n/**\n * @param {Record<string, unknown>} props\n * @param {any} runes\n * @param {Function} [fn]\n * @returns {void}\n */\nexport function push(props, runes = false, fn) {\n\tcomponent_context = {\n\t\tp: component_context,\n\t\ti: false,\n\t\tc: null,\n\t\te: null,\n\t\ts: props,\n\t\tx: null,\n\t\tl: legacy_mode_flag && !runes ? { s: null, u: null, $: [] } : null\n\t};\n\n\tif (DEV) {\n\t\t// component function\n\t\tcomponent_context.function = fn;\n\t\tdev_current_component_function = fn;\n\t}\n}\n\n/**\n * @template {Record<string, any>} T\n * @param {T} [component]\n * @returns {T}\n */\nexport function pop(component) {\n\tvar context = /** @type {ComponentContext} */ (component_context);\n\tvar effects = context.e;\n\n\tif (effects !== null) {\n\t\tcontext.e = null;\n\n\t\tfor (var fn of effects) {\n\t\t\tcreate_user_effect(fn);\n\t\t}\n\t}\n\n\tif (component !== undefined) {\n\t\tcontext.x = component;\n\t}\n\n\tcontext.i = true;\n\n\tcomponent_context = context.p;\n\n\tif (DEV) {\n\t\tdev_current_component_function = component_context?.function ?? null;\n\t}\n\n\treturn component ?? /** @type {T} */ ({});\n}\n\n/** @returns {boolean} */\nexport function is_runes() {\n\treturn !legacy_mode_flag || (component_context !== null && component_context.l === null);\n}\n\n/**\n * @param {string} name\n * @returns {Map<unknown, unknown>}\n */\nfunction get_or_init_context_map(name) {\n\tif (component_context === null) {\n\t\te.lifecycle_outside_component(name);\n\t}\n\n\treturn (component_context.c ??= new Map(get_parent_context(component_context) || undefined));\n}\n\n/**\n * @param {ComponentContext} component_context\n * @returns {Map<unknown, unknown> | null}\n */\nfunction get_parent_context(component_context) {\n\tlet parent = component_context.p;\n\twhile (parent !== null) {\n\t\tconst context_map = parent.c;\n\t\tif (context_map !== null) {\n\t\t\treturn context_map;\n\t\t}\n\t\tparent = parent.p;\n\t}\n\treturn null;\n}\n","import { run_all } from '../../shared/utils.js';\nimport { is_flushing_sync } from '../reactivity/batch.js';\n\n/** @type {Array<() => void>} */\nlet micro_tasks = [];\n\nfunction run_micro_tasks() {\n\tvar tasks = micro_tasks;\n\tmicro_tasks = [];\n\trun_all(tasks);\n}\n\n/**\n * @param {() => void} fn\n */\nexport function queue_micro_task(fn) {\n\tif (micro_tasks.length === 0 && !is_flushing_sync) {\n\t\tvar tasks = micro_tasks;\n\t\tqueueMicrotask(() => {\n\t\t\t// If this is false, a flushSync happened in the meantime. Do _not_ run new scheduled microtasks in that case\n\t\t\t// as the ordering of microtasks would be broken at that point - consider this case:\n\t\t\t// - queue_micro_task schedules microtask A to flush task X\n\t\t\t// - synchronously after, flushSync runs, processing task X\n\t\t\t// - synchronously after, some other microtask B is scheduled, but not through queue_micro_task but for example a Promise.resolve() in user code\n\t\t\t// - synchronously after, queue_micro_task schedules microtask C to flush task Y\n\t\t\t// - one tick later, microtask A now resolves, flushing task Y before microtask B, which is incorrect\n\t\t\t// This if check prevents that race condition (that realistically will only happen in tests)\n\t\t\tif (tasks === micro_tasks) run_micro_tasks();\n\t\t});\n\t}\n\n\tmicro_tasks.push(fn);\n}\n\n/**\n * Synchronously run any queued tasks.\n */\nexport function flush_tasks() {\n\twhile (micro_tasks.length > 0) {\n\t\trun_micro_tasks();\n\t}\n}\n","/** @import { Derived, Effect } from '#client' */\n/** @import { Boundary } from './dom/blocks/boundary.js' */\nimport { DEV } from 'esm-env';\nimport { FILENAME } from '../../constants.js';\nimport { is_firefox } from './dom/operations.js';\nimport { ERROR_VALUE, BOUNDARY_EFFECT, EFFECT_RAN } from './constants.js';\nimport { define_property, get_descriptor } from '../shared/utils.js';\nimport { active_effect, active_reaction } from './runtime.js';\n\nconst adjustments = new WeakMap();\n\n/**\n * @param {unknown} error\n */\nexport function handle_error(error) {\n\tvar effect = active_effect;\n\n\t// for unowned deriveds, don't throw until we read the value\n\tif (effect === null) {\n\t\t/** @type {Derived} */ (active_reaction).f |= ERROR_VALUE;\n\t\treturn error;\n\t}\n\n\tif (DEV && error instanceof Error && !adjustments.has(error)) {\n\t\tadjustments.set(error, get_adjustments(error, effect));\n\t}\n\n\tif ((effect.f & EFFECT_RAN) === 0) {\n\t\t// if the error occurred while creating this subtree, we let it\n\t\t// bubble up until it hits a boundary that can handle it\n\t\tif ((effect.f & BOUNDARY_EFFECT) === 0) {\n\t\t\tif (DEV && !effect.parent && error instanceof Error) {\n\t\t\t\tapply_adjustments(error);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\n\t\t/** @type {Boundary} */ (effect.b).error(error);\n\t} else {\n\t\t// otherwise we bubble up the effect tree ourselves\n\t\tinvoke_error_boundary(error, effect);\n\t}\n}\n\n/**\n * @param {unknown} error\n * @param {Effect | null} effect\n */\nexport function invoke_error_boundary(error, effect) {\n\twhile (effect !== null) {\n\t\tif ((effect.f & BOUNDARY_EFFECT) !== 0) {\n\t\t\ttry {\n\t\t\t\t/** @type {Boundary} */ (effect.b).error(error);\n\t\t\t\treturn;\n\t\t\t} catch (e) {\n\t\t\t\terror = e;\n\t\t\t}\n\t\t}\n\n\t\teffect = effect.parent;\n\t}\n\n\tif (DEV && error instanceof Error) {\n\t\tapply_adjustments(error);\n\t}\n\n\tthrow error;\n}\n\n/**\n * Add useful information to the error message/stack in development\n * @param {Error} error\n * @param {Effect} effect\n */\nfunction get_adjustments(error, effect) {\n\tconst message_descriptor = get_descriptor(error, 'message');\n\n\t// if the message was already changed and it's not configurable we can't change it\n\t// or it will throw a different error swallowing the original error\n\tif (message_descriptor && !message_descriptor.configurable) return;\n\n\tvar indent = is_firefox ? '  ' : '\\t';\n\tvar component_stack = `\\n${indent}in ${effect.fn?.name || '<unknown>'}`;\n\tvar context = effect.ctx;\n\n\twhile (context !== null) {\n\t\tcomponent_stack += `\\n${indent}in ${context.function?.[FILENAME].split('/').pop()}`;\n\t\tcontext = context.p;\n\t}\n\n\treturn {\n\t\tmessage: error.message + `\\n${component_stack}\\n`,\n\t\tstack: error.stack\n\t\t\t?.split('\\n')\n\t\t\t.filter((line) => !line.includes('svelte/src/internal'))\n\t\t\t.join('\\n')\n\t};\n}\n\n/**\n * @param {Error} error\n */\nfunction apply_adjustments(error) {\n\tconst adjusted = adjustments.get(error);\n\n\tif (adjusted) {\n\t\tdefine_property(error, 'message', {\n\t\t\tvalue: adjusted.message\n\t\t});\n\n\t\tdefine_property(error, 'stack', {\n\t\t\tvalue: adjusted.stack\n\t\t});\n\t}\n}\n","/** @import { Fork } from 'svelte' */\n/** @import { Derived, Effect, Reaction, Source, Value } from '#client' */\nimport {\n\tBLOCK_EFFECT,\n\tBRANCH_EFFECT,\n\tCLEAN,\n\tDESTROYED,\n\tDIRTY,\n\tEFFECT,\n\tASYNC,\n\tINERT,\n\tRENDER_EFFECT,\n\tROOT_EFFECT,\n\tMAYBE_DIRTY,\n\tDERIVED,\n\tBOUNDARY_EFFECT,\n\tEAGER_EFFECT,\n\tHEAD_EFFECT,\n\tERROR_VALUE,\n\tWAS_MARKED,\n\tMANAGED_EFFECT\n} from '#client/constants';\nimport { async_mode_flag } from '../../flags/index.js';\nimport { deferred, define_property } from '../../shared/utils.js';\nimport {\n\tactive_effect,\n\tget,\n\tis_dirty,\n\tis_updating_effect,\n\tset_is_updating_effect,\n\tset_signal_status,\n\tupdate_effect\n} from '../runtime.js';\nimport * as e from '../errors.js';\nimport { flush_tasks, queue_micro_task } from '../dom/task.js';\nimport { DEV } from 'esm-env';\nimport { invoke_error_boundary } from '../error-handling.js';\nimport { flush_eager_effects, old_values, set_eager_effects, source, update } from './sources.js';\nimport { eager_effect, unlink_effect } from './effects.js';\n\n/**\n * @typedef {{\n *   parent: EffectTarget | null;\n *   effect: Effect | null;\n *   effects: Effect[];\n *   render_effects: Effect[];\n * }} EffectTarget\n */\n\n/** @type {Set<Batch>} */\nconst batches = new Set();\n\n/** @type {Batch | null} */\nexport let current_batch = null;\n\n/**\n * This is needed to avoid overwriting inputs in non-async mode\n * TODO 6.0 remove this, as non-async mode will go away\n * @type {Batch | null}\n */\nexport let previous_batch = null;\n\n/**\n * When time travelling (i.e. working in one batch, while other batches\n * still have ongoing work), we ignore the real values of affected\n * signals in favour of their values within the batch\n * @type {Map<Value, any> | null}\n */\nexport let batch_values = null;\n\n// TODO this should really be a property of `batch`\n/** @type {Effect[]} */\nlet queued_root_effects = [];\n\n/** @type {Effect | null} */\nlet last_scheduled_effect = null;\n\nlet is_flushing = false;\nexport let is_flushing_sync = false;\n\nexport class Batch {\n\tcommitted = false;\n\n\t/**\n\t * The current values of any sources that are updated in this batch\n\t * They keys of this map are identical to `this.#previous`\n\t * @type {Map<Source, any>}\n\t */\n\tcurrent = new Map();\n\n\t/**\n\t * The values of any sources that are updated in this batch _before_ those updates took place.\n\t * They keys of this map are identical to `this.#current`\n\t * @type {Map<Source, any>}\n\t */\n\tprevious = new Map();\n\n\t/**\n\t * When the batch is committed (and the DOM is updated), we need to remove old branches\n\t * and append new ones by calling the functions added inside (if/each/key/etc) blocks\n\t * @type {Set<() => void>}\n\t */\n\t#commit_callbacks = new Set();\n\n\t/**\n\t * If a fork is discarded, we need to destroy any effects that are no longer needed\n\t * @type {Set<(batch: Batch) => void>}\n\t */\n\t#discard_callbacks = new Set();\n\n\t/**\n\t * The number of async effects that are currently in flight\n\t */\n\t#pending = 0;\n\n\t/**\n\t * The number of async effects that are currently in flight, _not_ inside a pending boundary\n\t */\n\t#blocking_pending = 0;\n\n\t/**\n\t * A deferred that resolves when the batch is committed, used with `settled()`\n\t * TODO replace with Promise.withResolvers once supported widely enough\n\t * @type {{ promise: Promise<void>, resolve: (value?: any) => void, reject: (reason: unknown) => void } | null}\n\t */\n\t#deferred = null;\n\n\t/**\n\t * Deferred effects (which run after async work has completed) that are DIRTY\n\t * @type {Set<Effect>}\n\t */\n\t#dirty_effects = new Set();\n\n\t/**\n\t * Deferred effects that are MAYBE_DIRTY\n\t * @type {Set<Effect>}\n\t */\n\t#maybe_dirty_effects = new Set();\n\n\t/**\n\t * A set of branches that still exist, but will be destroyed when this batch\n\t * is committed  we skip over these during `process`\n\t * @type {Set<Effect>}\n\t */\n\tskipped_effects = new Set();\n\n\tis_fork = false;\n\n\tis_deferred() {\n\t\treturn this.is_fork || this.#blocking_pending > 0;\n\t}\n\n\t/**\n\t *\n\t * @param {Effect[]} root_effects\n\t */\n\tprocess(root_effects) {\n\t\tqueued_root_effects = [];\n\n\t\tprevious_batch = null;\n\n\t\tthis.apply();\n\n\t\t/** @type {EffectTarget} */\n\t\tvar target = {\n\t\t\tparent: null,\n\t\t\teffect: null,\n\t\t\teffects: [],\n\t\t\trender_effects: []\n\t\t};\n\n\t\tfor (const root of root_effects) {\n\t\t\tthis.#traverse_effect_tree(root, target);\n\t\t\t// Note: #traverse_effect_tree runs block effects eagerly, which can schedule effects,\n\t\t\t// which means queued_root_effects now may be filled again.\n\n\t\t\t// Helpful for debugging reactivity loss that has to do with branches being skipped:\n\t\t\t// log_inconsistent_branches(root);\n\t\t}\n\n\t\tif (!this.is_fork) {\n\t\t\tthis.#resolve();\n\t\t}\n\n\t\tif (this.is_deferred()) {\n\t\t\tthis.#defer_effects(target.effects);\n\t\t\tthis.#defer_effects(target.render_effects);\n\t\t} else {\n\t\t\t// If sources are written to, then work needs to happen in a separate batch, else prior sources would be mixed with\n\t\t\t// newly updated sources, which could lead to infinite loops when effects run over and over again.\n\t\t\tprevious_batch = this;\n\t\t\tcurrent_batch = null;\n\n\t\t\tflush_queued_effects(target.render_effects);\n\t\t\tflush_queued_effects(target.effects);\n\n\t\t\tprevious_batch = null;\n\n\t\t\tthis.#deferred?.resolve();\n\t\t}\n\n\t\tbatch_values = null;\n\t}\n\n\t/**\n\t * Traverse the effect tree, executing effects or stashing\n\t * them for later execution as appropriate\n\t * @param {Effect} root\n\t * @param {EffectTarget} target\n\t */\n\t#traverse_effect_tree(root, target) {\n\t\troot.f ^= CLEAN;\n\n\t\tvar effect = root.first;\n\n\t\twhile (effect !== null) {\n\t\t\tvar flags = effect.f;\n\t\t\tvar is_branch = (flags & (BRANCH_EFFECT | ROOT_EFFECT)) !== 0;\n\t\t\tvar is_skippable_branch = is_branch && (flags & CLEAN) !== 0;\n\n\t\t\tvar skip = is_skippable_branch || (flags & INERT) !== 0 || this.skipped_effects.has(effect);\n\n\t\t\tif ((effect.f & BOUNDARY_EFFECT) !== 0 && effect.b?.is_pending()) {\n\t\t\t\ttarget = {\n\t\t\t\t\tparent: target,\n\t\t\t\t\teffect,\n\t\t\t\t\teffects: [],\n\t\t\t\t\trender_effects: []\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!skip && effect.fn !== null) {\n\t\t\t\tif (is_branch) {\n\t\t\t\t\teffect.f ^= CLEAN;\n\t\t\t\t} else if ((flags & EFFECT) !== 0) {\n\t\t\t\t\ttarget.effects.push(effect);\n\t\t\t\t} else if (async_mode_flag && (flags & (RENDER_EFFECT | MANAGED_EFFECT)) !== 0) {\n\t\t\t\t\ttarget.render_effects.push(effect);\n\t\t\t\t} else if (is_dirty(effect)) {\n\t\t\t\t\tif ((effect.f & BLOCK_EFFECT) !== 0) this.#dirty_effects.add(effect);\n\t\t\t\t\tupdate_effect(effect);\n\t\t\t\t}\n\n\t\t\t\tvar child = effect.first;\n\n\t\t\t\tif (child !== null) {\n\t\t\t\t\teffect = child;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar parent = effect.parent;\n\t\t\teffect = effect.next;\n\n\t\t\twhile (effect === null && parent !== null) {\n\t\t\t\tif (parent === target.effect) {\n\t\t\t\t\t// TODO rather than traversing into pending boundaries and deferring the effects,\n\t\t\t\t\t// could we just attach the effects _to_ the pending boundary and schedule them\n\t\t\t\t\t// once the boundary is ready?\n\t\t\t\t\tthis.#defer_effects(target.effects);\n\t\t\t\t\tthis.#defer_effects(target.render_effects);\n\n\t\t\t\t\ttarget = /** @type {EffectTarget} */ (target.parent);\n\t\t\t\t}\n\n\t\t\t\teffect = parent.next;\n\t\t\t\tparent = parent.parent;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @param {Effect[]} effects\n\t */\n\t#defer_effects(effects) {\n\t\tfor (const e of effects) {\n\t\t\tif ((e.f & DIRTY) !== 0) {\n\t\t\t\tthis.#dirty_effects.add(e);\n\t\t\t} else if ((e.f & MAYBE_DIRTY) !== 0) {\n\t\t\t\tthis.#maybe_dirty_effects.add(e);\n\t\t\t}\n\n\t\t\t// Since we're not executing these effects now, we need to clear any WAS_MARKED flags\n\t\t\t// so that other batches can correctly reach these effects during their own traversal\n\t\t\tthis.#clear_marked(e.deps);\n\n\t\t\t// mark as clean so they get scheduled if they depend on pending async state\n\t\t\tset_signal_status(e, CLEAN);\n\t\t}\n\t}\n\n\t/**\n\t * @param {Value[] | null} deps\n\t */\n\t#clear_marked(deps) {\n\t\tif (deps === null) return;\n\n\t\tfor (const dep of deps) {\n\t\t\tif ((dep.f & DERIVED) === 0 || (dep.f & WAS_MARKED) === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tdep.f ^= WAS_MARKED;\n\n\t\t\tthis.#clear_marked(/** @type {Derived} */ (dep).deps);\n\t\t}\n\t}\n\n\t/**\n\t * Associate a change to a given source with the current\n\t * batch, noting its previous and current values\n\t * @param {Source} source\n\t * @param {any} value\n\t */\n\tcapture(source, value) {\n\t\tif (!this.previous.has(source)) {\n\t\t\tthis.previous.set(source, value);\n\t\t}\n\n\t\t// Don't save errors in `batch_values`, or they won't be thrown in `runtime.js#get`\n\t\tif ((source.f & ERROR_VALUE) === 0) {\n\t\t\tthis.current.set(source, source.v);\n\t\t\tbatch_values?.set(source, source.v);\n\t\t}\n\t}\n\n\tactivate() {\n\t\tcurrent_batch = this;\n\t\tthis.apply();\n\t}\n\n\tdeactivate() {\n\t\t// If we're not the current batch, don't deactivate,\n\t\t// else we could create zombie batches that are never flushed\n\t\tif (current_batch !== this) return;\n\n\t\tcurrent_batch = null;\n\t\tbatch_values = null;\n\t}\n\n\tflush() {\n\t\tthis.activate();\n\n\t\tif (queued_root_effects.length > 0) {\n\t\t\tflush_effects();\n\n\t\t\tif (current_batch !== null && current_batch !== this) {\n\t\t\t\t// this can happen if a new batch was created during `flush_effects()`\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (this.#pending === 0) {\n\t\t\tthis.process([]); // TODO this feels awkward\n\t\t}\n\n\t\tthis.deactivate();\n\t}\n\n\tdiscard() {\n\t\tfor (const fn of this.#discard_callbacks) fn(this);\n\t\tthis.#discard_callbacks.clear();\n\t}\n\n\t#resolve() {\n\t\tif (this.#blocking_pending === 0) {\n\t\t\t// append/remove branches\n\t\t\tfor (const fn of this.#commit_callbacks) fn();\n\t\t\tthis.#commit_callbacks.clear();\n\t\t}\n\n\t\tif (this.#pending === 0) {\n\t\t\tthis.#commit();\n\t\t}\n\t}\n\n\t#commit() {\n\t\t// If there are other pending batches, they now need to be 'rebased' \n\t\t// in other words, we re-run block/async effects with the newly\n\t\t// committed state, unless the batch in question has a more\n\t\t// recent value for a given source\n\t\tif (batches.size > 1) {\n\t\t\tthis.previous.clear();\n\n\t\t\tvar previous_batch_values = batch_values;\n\t\t\tvar is_earlier = true;\n\n\t\t\t/** @type {EffectTarget} */\n\t\t\tvar dummy_target = {\n\t\t\t\tparent: null,\n\t\t\t\teffect: null,\n\t\t\t\teffects: [],\n\t\t\t\trender_effects: []\n\t\t\t};\n\n\t\t\tfor (const batch of batches) {\n\t\t\t\tif (batch === this) {\n\t\t\t\t\tis_earlier = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t/** @type {Source[]} */\n\t\t\t\tconst sources = [];\n\n\t\t\t\tfor (const [source, value] of this.current) {\n\t\t\t\t\tif (batch.current.has(source)) {\n\t\t\t\t\t\tif (is_earlier && value !== batch.current.get(source)) {\n\t\t\t\t\t\t\t// bring the value up to date\n\t\t\t\t\t\t\tbatch.current.set(source, value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// same value or later batch has more recent value,\n\t\t\t\t\t\t\t// no need to re-run these effects\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tsources.push(source);\n\t\t\t\t}\n\n\t\t\t\tif (sources.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Re-run async/block effects that depend on distinct values changed in both batches\n\t\t\t\tconst others = [...batch.current.keys()].filter((s) => !this.current.has(s));\n\t\t\t\tif (others.length > 0) {\n\t\t\t\t\t// Avoid running queued root effects on the wrong branch\n\t\t\t\t\tvar prev_queued_root_effects = queued_root_effects;\n\t\t\t\t\tqueued_root_effects = [];\n\n\t\t\t\t\t/** @type {Set<Value>} */\n\t\t\t\t\tconst marked = new Set();\n\t\t\t\t\t/** @type {Map<Reaction, boolean>} */\n\t\t\t\t\tconst checked = new Map();\n\t\t\t\t\tfor (const source of sources) {\n\t\t\t\t\t\tmark_effects(source, others, marked, checked);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (queued_root_effects.length > 0) {\n\t\t\t\t\t\tcurrent_batch = batch;\n\t\t\t\t\t\tbatch.apply();\n\n\t\t\t\t\t\tfor (const root of queued_root_effects) {\n\t\t\t\t\t\t\tbatch.#traverse_effect_tree(root, dummy_target);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// TODO do we need to do anything with `target`? defer block effects?\n\n\t\t\t\t\t\tbatch.deactivate();\n\t\t\t\t\t}\n\n\t\t\t\t\tqueued_root_effects = prev_queued_root_effects;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcurrent_batch = null;\n\t\t\tbatch_values = previous_batch_values;\n\t\t}\n\n\t\tthis.committed = true;\n\t\tbatches.delete(this);\n\t}\n\n\t/**\n\t *\n\t * @param {boolean} blocking\n\t */\n\tincrement(blocking) {\n\t\tthis.#pending += 1;\n\t\tif (blocking) this.#blocking_pending += 1;\n\t}\n\n\t/**\n\t *\n\t * @param {boolean} blocking\n\t */\n\tdecrement(blocking) {\n\t\tthis.#pending -= 1;\n\t\tif (blocking) this.#blocking_pending -= 1;\n\n\t\tthis.revive();\n\t}\n\n\trevive() {\n\t\tfor (const e of this.#dirty_effects) {\n\t\t\tthis.#maybe_dirty_effects.delete(e);\n\t\t\tset_signal_status(e, DIRTY);\n\t\t\tschedule_effect(e);\n\t\t}\n\n\t\tfor (const e of this.#maybe_dirty_effects) {\n\t\t\tset_signal_status(e, MAYBE_DIRTY);\n\t\t\tschedule_effect(e);\n\t\t}\n\n\t\tthis.flush();\n\t}\n\n\t/** @param {() => void} fn */\n\toncommit(fn) {\n\t\tthis.#commit_callbacks.add(fn);\n\t}\n\n\t/** @param {(batch: Batch) => void} fn */\n\tondiscard(fn) {\n\t\tthis.#discard_callbacks.add(fn);\n\t}\n\n\tsettled() {\n\t\treturn (this.#deferred ??= deferred()).promise;\n\t}\n\n\tstatic ensure() {\n\t\tif (current_batch === null) {\n\t\t\tconst batch = (current_batch = new Batch());\n\t\t\tbatches.add(current_batch);\n\n\t\t\tif (!is_flushing_sync) {\n\t\t\t\tBatch.enqueue(() => {\n\t\t\t\t\tif (current_batch !== batch) {\n\t\t\t\t\t\t// a flushSync happened in the meantime\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbatch.flush();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn current_batch;\n\t}\n\n\t/** @param {() => void} task */\n\tstatic enqueue(task) {\n\t\tqueue_micro_task(task);\n\t}\n\n\tapply() {\n\t\tif (!async_mode_flag || (!this.is_fork && batches.size === 1)) return;\n\n\t\t// if there are multiple batches, we are 'time travelling' \n\t\t// we need to override values with the ones in this batch...\n\t\tbatch_values = new Map(this.current);\n\n\t\t// ...and undo changes belonging to other batches\n\t\tfor (const batch of batches) {\n\t\t\tif (batch === this) continue;\n\n\t\t\tfor (const [source, previous] of batch.previous) {\n\t\t\t\tif (!batch_values.has(source)) {\n\t\t\t\t\tbatch_values.set(source, previous);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Synchronously flush any pending updates.\n * Returns void if no callback is provided, otherwise returns the result of calling the callback.\n * @template [T=void]\n * @param {(() => T) | undefined} [fn]\n * @returns {T}\n */\nexport function flushSync(fn) {\n\tvar was_flushing_sync = is_flushing_sync;\n\tis_flushing_sync = true;\n\n\ttry {\n\t\tvar result;\n\n\t\tif (fn) {\n\t\t\tif (current_batch !== null) {\n\t\t\t\tflush_effects();\n\t\t\t}\n\n\t\t\tresult = fn();\n\t\t}\n\n\t\twhile (true) {\n\t\t\tflush_tasks();\n\n\t\t\tif (queued_root_effects.length === 0) {\n\t\t\t\tcurrent_batch?.flush();\n\n\t\t\t\t// we need to check again, in case we just updated an `$effect.pending()`\n\t\t\t\tif (queued_root_effects.length === 0) {\n\t\t\t\t\t// this would be reset in `flush_effects()` but since we are early returning here,\n\t\t\t\t\t// we need to reset it here as well in case the first time there's 0 queued root effects\n\t\t\t\t\tlast_scheduled_effect = null;\n\n\t\t\t\t\treturn /** @type {T} */ (result);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tflush_effects();\n\t\t}\n\t} finally {\n\t\tis_flushing_sync = was_flushing_sync;\n\t}\n}\n\nfunction flush_effects() {\n\tvar was_updating_effect = is_updating_effect;\n\tis_flushing = true;\n\n\tvar source_stacks = DEV ? new Set() : null;\n\n\ttry {\n\t\tvar flush_count = 0;\n\t\tset_is_updating_effect(true);\n\n\t\twhile (queued_root_effects.length > 0) {\n\t\t\tvar batch = Batch.ensure();\n\n\t\t\tif (flush_count++ > 1000) {\n\t\t\t\tif (DEV) {\n\t\t\t\t\tvar updates = new Map();\n\n\t\t\t\t\tfor (const source of batch.current.keys()) {\n\t\t\t\t\t\tfor (const [stack, update] of source.updated ?? []) {\n\t\t\t\t\t\t\tvar entry = updates.get(stack);\n\n\t\t\t\t\t\t\tif (!entry) {\n\t\t\t\t\t\t\t\tentry = { error: update.error, count: 0 };\n\t\t\t\t\t\t\t\tupdates.set(stack, entry);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tentry.count += update.count;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const update of updates.values()) {\n\t\t\t\t\t\tif (update.error) {\n\t\t\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\t\t\tconsole.error(update.error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tinfinite_loop_guard();\n\t\t\t}\n\n\t\t\tbatch.process(queued_root_effects);\n\t\t\told_values.clear();\n\n\t\t\tif (DEV) {\n\t\t\t\tfor (const source of batch.current.keys()) {\n\t\t\t\t\t/** @type {Set<Source>} */ (source_stacks).add(source);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} finally {\n\t\tis_flushing = false;\n\t\tset_is_updating_effect(was_updating_effect);\n\n\t\tlast_scheduled_effect = null;\n\n\t\tif (DEV) {\n\t\t\tfor (const source of /** @type {Set<Source>} */ (source_stacks)) {\n\t\t\t\tsource.updated = null;\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction infinite_loop_guard() {\n\ttry {\n\t\te.effect_update_depth_exceeded();\n\t} catch (error) {\n\t\tif (DEV) {\n\t\t\t// stack contains no useful information, replace it\n\t\t\tdefine_property(error, 'stack', { value: '' });\n\t\t}\n\n\t\t// Best effort: invoke the boundary nearest the most recent\n\t\t// effect and hope that it's relevant to the infinite loop\n\t\tinvoke_error_boundary(error, last_scheduled_effect);\n\t}\n}\n\n/** @type {Set<Effect> | null} */\nexport let eager_block_effects = null;\n\n/**\n * @param {Array<Effect>} effects\n * @returns {void}\n */\nfunction flush_queued_effects(effects) {\n\tvar length = effects.length;\n\tif (length === 0) return;\n\n\tvar i = 0;\n\n\twhile (i < length) {\n\t\tvar effect = effects[i++];\n\n\t\tif ((effect.f & (DESTROYED | INERT)) === 0 && is_dirty(effect)) {\n\t\t\teager_block_effects = new Set();\n\n\t\t\tupdate_effect(effect);\n\n\t\t\t// Effects with no dependencies or teardown do not get added to the effect tree.\n\t\t\t// Deferred effects (e.g. `$effect(...)`) _are_ added to the tree because we\n\t\t\t// don't know if we need to keep them until they are executed. Doing the check\n\t\t\t// here (rather than in `update_effect`) allows us to skip the work for\n\t\t\t// immediate effects.\n\t\t\tif (effect.deps === null && effect.first === null && effect.nodes === null) {\n\t\t\t\t// if there's no teardown or abort controller we completely unlink\n\t\t\t\t// the effect from the graph\n\t\t\t\tif (effect.teardown === null && effect.ac === null) {\n\t\t\t\t\t// remove this effect from the graph\n\t\t\t\t\tunlink_effect(effect);\n\t\t\t\t} else {\n\t\t\t\t\t// keep the effect in the graph, but free up some memory\n\t\t\t\t\teffect.fn = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If update_effect() has a flushSync() in it, we may have flushed another flush_queued_effects(),\n\t\t\t// which already handled this logic and did set eager_block_effects to null.\n\t\t\tif (eager_block_effects?.size > 0) {\n\t\t\t\told_values.clear();\n\n\t\t\t\tfor (const e of eager_block_effects) {\n\t\t\t\t\t// Skip eager effects that have already been unmounted\n\t\t\t\t\tif ((e.f & (DESTROYED | INERT)) !== 0) continue;\n\n\t\t\t\t\t// Run effects in order from ancestor to descendant, else we could run into nullpointers\n\t\t\t\t\t/** @type {Effect[]} */\n\t\t\t\t\tconst ordered_effects = [e];\n\t\t\t\t\tlet ancestor = e.parent;\n\t\t\t\t\twhile (ancestor !== null) {\n\t\t\t\t\t\tif (eager_block_effects.has(ancestor)) {\n\t\t\t\t\t\t\teager_block_effects.delete(ancestor);\n\t\t\t\t\t\t\tordered_effects.push(ancestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tancestor = ancestor.parent;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let j = ordered_effects.length - 1; j >= 0; j--) {\n\t\t\t\t\t\tconst e = ordered_effects[j];\n\t\t\t\t\t\t// Skip eager effects that have already been unmounted\n\t\t\t\t\t\tif ((e.f & (DESTROYED | INERT)) !== 0) continue;\n\t\t\t\t\t\tupdate_effect(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\teager_block_effects.clear();\n\t\t\t}\n\t\t}\n\t}\n\n\teager_block_effects = null;\n}\n\n/**\n * This is similar to `mark_reactions`, but it only marks async/block effects\n * depending on `value` and at least one of the other `sources`, so that\n * these effects can re-run after another batch has been committed\n * @param {Value} value\n * @param {Source[]} sources\n * @param {Set<Value>} marked\n * @param {Map<Reaction, boolean>} checked\n */\nfunction mark_effects(value, sources, marked, checked) {\n\tif (marked.has(value)) return;\n\tmarked.add(value);\n\n\tif (value.reactions !== null) {\n\t\tfor (const reaction of value.reactions) {\n\t\t\tconst flags = reaction.f;\n\n\t\t\tif ((flags & DERIVED) !== 0) {\n\t\t\t\tmark_effects(/** @type {Derived} */ (reaction), sources, marked, checked);\n\t\t\t} else if (\n\t\t\t\t(flags & (ASYNC | BLOCK_EFFECT)) !== 0 &&\n\t\t\t\t(flags & DIRTY) === 0 &&\n\t\t\t\tdepends_on(reaction, sources, checked)\n\t\t\t) {\n\t\t\t\tset_signal_status(reaction, DIRTY);\n\t\t\t\tschedule_effect(/** @type {Effect} */ (reaction));\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * When committing a fork, we need to trigger eager effects so that\n * any `$state.eager(...)` expressions update immediately. This\n * function allows us to discover them\n * @param {Value} value\n * @param {Set<Effect>} effects\n */\nfunction mark_eager_effects(value, effects) {\n\tif (value.reactions === null) return;\n\n\tfor (const reaction of value.reactions) {\n\t\tconst flags = reaction.f;\n\n\t\tif ((flags & DERIVED) !== 0) {\n\t\t\tmark_eager_effects(/** @type {Derived} */ (reaction), effects);\n\t\t} else if ((flags & EAGER_EFFECT) !== 0) {\n\t\t\tset_signal_status(reaction, DIRTY);\n\t\t\teffects.add(/** @type {Effect} */ (reaction));\n\t\t}\n\t}\n}\n\n/**\n * @param {Reaction} reaction\n * @param {Source[]} sources\n * @param {Map<Reaction, boolean>} checked\n */\nfunction depends_on(reaction, sources, checked) {\n\tconst depends = checked.get(reaction);\n\tif (depends !== undefined) return depends;\n\n\tif (reaction.deps !== null) {\n\t\tfor (const dep of reaction.deps) {\n\t\t\tif (sources.includes(dep)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif ((dep.f & DERIVED) !== 0 && depends_on(/** @type {Derived} */ (dep), sources, checked)) {\n\t\t\t\tchecked.set(/** @type {Derived} */ (dep), true);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\tchecked.set(reaction, false);\n\n\treturn false;\n}\n\n/**\n * @param {Effect} signal\n * @returns {void}\n */\nexport function schedule_effect(signal) {\n\tvar effect = (last_scheduled_effect = signal);\n\n\twhile (effect.parent !== null) {\n\t\teffect = effect.parent;\n\t\tvar flags = effect.f;\n\n\t\t// if the effect is being scheduled because a parent (each/await/etc) block\n\t\t// updated an internal source, bail out or we'll cause a second flush\n\t\tif (\n\t\t\tis_flushing &&\n\t\t\teffect === active_effect &&\n\t\t\t(flags & BLOCK_EFFECT) !== 0 &&\n\t\t\t(flags & HEAD_EFFECT) === 0\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((flags & (ROOT_EFFECT | BRANCH_EFFECT)) !== 0) {\n\t\t\tif ((flags & CLEAN) === 0) return;\n\t\t\teffect.f ^= CLEAN;\n\t\t}\n\t}\n\n\tqueued_root_effects.push(effect);\n}\n\n/** @type {Source<number>[]} */\nlet eager_versions = [];\n\nfunction eager_flush() {\n\ttry {\n\t\tflushSync(() => {\n\t\t\tfor (const version of eager_versions) {\n\t\t\t\tupdate(version);\n\t\t\t}\n\t\t});\n\t} finally {\n\t\teager_versions = [];\n\t}\n}\n\n/**\n * Implementation of `$state.eager(fn())`\n * @template T\n * @param {() => T} fn\n * @returns {T}\n */\nexport function eager(fn) {\n\tvar version = source(0);\n\tvar initial = true;\n\tvar value = /** @type {T} */ (undefined);\n\n\tget(version);\n\n\teager_effect(() => {\n\t\tif (initial) {\n\t\t\t// the first time this runs, we create an eager effect\n\t\t\t// that will run eagerly whenever the expression changes\n\t\t\tvar previous_batch_values = batch_values;\n\n\t\t\ttry {\n\t\t\t\tbatch_values = null;\n\t\t\t\tvalue = fn();\n\t\t\t} finally {\n\t\t\t\tbatch_values = previous_batch_values;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// the second time this effect runs, it's to schedule a\n\t\t// `version` update. since this will recreate the effect,\n\t\t// we don't need to evaluate the expression here\n\t\tif (eager_versions.length === 0) {\n\t\t\tqueue_micro_task(eager_flush);\n\t\t}\n\n\t\teager_versions.push(version);\n\t});\n\n\tinitial = false;\n\n\treturn value;\n}\n\n/**\n * Creates a 'fork', in which state changes are evaluated but not applied to the DOM.\n * This is useful for speculatively loading data (for example) when you suspect that\n * the user is about to take some action.\n *\n * Frameworks like SvelteKit can use this to preload data when the user touches or\n * hovers over a link, making any subsequent navigation feel instantaneous.\n *\n * The `fn` parameter is a synchronous function that modifies some state. The\n * state changes will be reverted after the fork is initialised, then reapplied\n * if and when the fork is eventually committed.\n *\n * When it becomes clear that a fork will _not_ be committed (e.g. because the\n * user navigated elsewhere), it must be discarded to avoid leaking memory.\n *\n * @param {() => void} fn\n * @returns {Fork}\n * @since 5.42\n */\nexport function fork(fn) {\n\tif (!async_mode_flag) {\n\t\te.experimental_async_required('fork');\n\t}\n\n\tif (current_batch !== null) {\n\t\te.fork_timing();\n\t}\n\n\tvar batch = Batch.ensure();\n\tbatch.is_fork = true;\n\tbatch_values = new Map();\n\n\tvar committed = false;\n\tvar settled = batch.settled();\n\n\tflushSync(fn);\n\n\tbatch_values = null;\n\n\t// revert state changes\n\tfor (var [source, value] of batch.previous) {\n\t\tsource.v = value;\n\t}\n\n\treturn {\n\t\tcommit: async () => {\n\t\t\tif (committed) {\n\t\t\t\tawait settled;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!batches.has(batch)) {\n\t\t\t\te.fork_discarded();\n\t\t\t}\n\n\t\t\tcommitted = true;\n\n\t\t\tbatch.is_fork = false;\n\n\t\t\t// apply changes\n\t\t\tfor (var [source, value] of batch.current) {\n\t\t\t\tsource.v = value;\n\t\t\t}\n\n\t\t\t// trigger any `$state.eager(...)` expressions with the new state.\n\t\t\t// eager effects don't get scheduled like other effects, so we\n\t\t\t// can't just encounter them during traversal, we need to\n\t\t\t// proactively flush them\n\t\t\t// TODO maybe there's a better implementation?\n\t\t\tflushSync(() => {\n\t\t\t\t/** @type {Set<Effect>} */\n\t\t\t\tvar eager_effects = new Set();\n\n\t\t\t\tfor (var source of batch.current.keys()) {\n\t\t\t\t\tmark_eager_effects(source, eager_effects);\n\t\t\t\t}\n\n\t\t\t\tset_eager_effects(eager_effects);\n\t\t\t\tflush_eager_effects();\n\t\t\t});\n\n\t\t\tbatch.revive();\n\t\t\tawait settled;\n\t\t},\n\t\tdiscard: () => {\n\t\t\tif (!committed && batches.has(batch)) {\n\t\t\t\tbatches.delete(batch);\n\t\t\t\tbatch.discard();\n\t\t\t}\n\t\t}\n\t};\n}\n\n/**\n * Forcibly remove all current batches, to prevent cross-talk between tests\n */\nexport function clear() {\n\tbatches.clear();\n}\n","import { get, tick, untrack } from '../internal/client/runtime.js';\nimport { effect_tracking, render_effect } from '../internal/client/reactivity/effects.js';\nimport { source, increment } from '../internal/client/reactivity/sources.js';\nimport { tag } from '../internal/client/dev/tracing.js';\nimport { DEV } from 'esm-env';\nimport { queue_micro_task } from '../internal/client/dom/task.js';\n\n/**\n * Returns a `subscribe` function that integrates external event-based systems with Svelte's reactivity.\n * It's particularly useful for integrating with web APIs like `MediaQuery`, `IntersectionObserver`, or `WebSocket`.\n *\n * If `subscribe` is called inside an effect (including indirectly, for example inside a getter),\n * the `start` callback will be called with an `update` function. Whenever `update` is called, the effect re-runs.\n *\n * If `start` returns a cleanup function, it will be called when the effect is destroyed.\n *\n * If `subscribe` is called in multiple effects, `start` will only be called once as long as the effects\n * are active, and the returned teardown function will only be called when all effects are destroyed.\n *\n * It's best understood with an example. Here's an implementation of [`MediaQuery`](https://svelte.dev/docs/svelte/svelte-reactivity#MediaQuery):\n *\n * ```js\n * import { createSubscriber } from 'svelte/reactivity';\n * import { on } from 'svelte/events';\n *\n * export class MediaQuery {\n * \t#query;\n * \t#subscribe;\n *\n * \tconstructor(query) {\n * \t\tthis.#query = window.matchMedia(`(${query})`);\n *\n * \t\tthis.#subscribe = createSubscriber((update) => {\n * \t\t\t// when the `change` event occurs, re-run any effects that read `this.current`\n * \t\t\tconst off = on(this.#query, 'change', update);\n *\n * \t\t\t// stop listening when all the effects are destroyed\n * \t\t\treturn () => off();\n * \t\t});\n * \t}\n *\n * \tget current() {\n * \t\t// This makes the getter reactive, if read in an effect\n * \t\tthis.#subscribe();\n *\n * \t\t// Return the current state of the query, whether or not we're in an effect\n * \t\treturn this.#query.matches;\n * \t}\n * }\n * ```\n * @param {(update: () => void) => (() => void) | void} start\n * @since 5.7.0\n */\nexport function createSubscriber(start) {\n\tlet subscribers = 0;\n\tlet version = source(0);\n\t/** @type {(() => void) | void} */\n\tlet stop;\n\n\tif (DEV) {\n\t\ttag(version, 'createSubscriber version');\n\t}\n\n\treturn () => {\n\t\tif (effect_tracking()) {\n\t\t\tget(version);\n\n\t\t\trender_effect(() => {\n\t\t\t\tif (subscribers === 0) {\n\t\t\t\t\tstop = untrack(() => start(() => increment(version)));\n\t\t\t\t}\n\n\t\t\t\tsubscribers += 1;\n\n\t\t\t\treturn () => {\n\t\t\t\t\tqueue_micro_task(() => {\n\t\t\t\t\t\t// Only count down after a microtask, else we would reach 0 before our own render effect reruns,\n\t\t\t\t\t\t// but reach 1 again when the tick callback of the prior teardown runs. That would mean we\n\t\t\t\t\t\t// re-subcribe unnecessarily and create a memory leak because the old subscription is never cleaned up.\n\t\t\t\t\t\tsubscribers -= 1;\n\n\t\t\t\t\t\tif (subscribers === 0) {\n\t\t\t\t\t\t\tstop?.();\n\t\t\t\t\t\t\tstop = undefined;\n\t\t\t\t\t\t\t// Increment the version to ensure any dependent deriveds are marked dirty when the subscription is picked up again later.\n\t\t\t\t\t\t\t// If we didn't do this then the comparison of write versions would determine that the derived has a later version than\n\t\t\t\t\t\t\t// the subscriber, and it would not be re-run.\n\t\t\t\t\t\t\tincrement(version);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t};\n}\n","/** @import { Effect, Source, TemplateNode, } from '#client' */\nimport {\n\tBOUNDARY_EFFECT,\n\tCOMMENT_NODE,\n\tEFFECT_PRESERVED,\n\tEFFECT_TRANSPARENT\n} from '#client/constants';\nimport { HYDRATION_START_ELSE } from '../../../../constants.js';\nimport { component_context, set_component_context } from '../../context.js';\nimport { handle_error, invoke_error_boundary } from '../../error-handling.js';\nimport {\n\tblock,\n\tbranch,\n\tdestroy_effect,\n\tmove_effect,\n\tpause_effect\n} from '../../reactivity/effects.js';\nimport {\n\tactive_effect,\n\tactive_reaction,\n\tget,\n\tset_active_effect,\n\tset_active_reaction\n} from '../../runtime.js';\nimport {\n\thydrate_next,\n\thydrate_node,\n\thydrating,\n\tnext,\n\tskip_nodes,\n\tset_hydrate_node\n} from '../hydration.js';\nimport { queue_micro_task } from '../task.js';\nimport * as e from '../../errors.js';\nimport * as w from '../../warnings.js';\nimport { DEV } from 'esm-env';\nimport { Batch } from '../../reactivity/batch.js';\nimport { internal_set, source } from '../../reactivity/sources.js';\nimport { tag } from '../../dev/tracing.js';\nimport { createSubscriber } from '../../../../reactivity/create-subscriber.js';\nimport { create_text } from '../operations.js';\n\n/**\n * @typedef {{\n * \t onerror?: (error: unknown, reset: () => void) => void;\n *   failed?: (anchor: Node, error: () => unknown, reset: () => () => void) => void;\n *   pending?: (anchor: Node) => void;\n * }} BoundaryProps\n */\n\nvar flags = EFFECT_TRANSPARENT | EFFECT_PRESERVED | BOUNDARY_EFFECT;\n\n/**\n * @param {TemplateNode} node\n * @param {BoundaryProps} props\n * @param {((anchor: Node) => void)} children\n * @returns {void}\n */\nexport function boundary(node, props, children) {\n\tnew Boundary(node, props, children);\n}\n\nexport class Boundary {\n\t/** @type {Boundary | null} */\n\tparent;\n\n\t#pending = false;\n\n\t/** @type {TemplateNode} */\n\t#anchor;\n\n\t/** @type {TemplateNode | null} */\n\t#hydrate_open = hydrating ? hydrate_node : null;\n\n\t/** @type {BoundaryProps} */\n\t#props;\n\n\t/** @type {((anchor: Node) => void)} */\n\t#children;\n\n\t/** @type {Effect} */\n\t#effect;\n\n\t/** @type {Effect | null} */\n\t#main_effect = null;\n\n\t/** @type {Effect | null} */\n\t#pending_effect = null;\n\n\t/** @type {Effect | null} */\n\t#failed_effect = null;\n\n\t/** @type {DocumentFragment | null} */\n\t#offscreen_fragment = null;\n\n\t/** @type {TemplateNode | null} */\n\t#pending_anchor = null;\n\n\t#local_pending_count = 0;\n\t#pending_count = 0;\n\n\t#is_creating_fallback = false;\n\n\t/**\n\t * A source containing the number of pending async deriveds/expressions.\n\t * Only created if `$effect.pending()` is used inside the boundary,\n\t * otherwise updating the source results in needless `Batch.ensure()`\n\t * calls followed by no-op flushes\n\t * @type {Source<number> | null}\n\t */\n\t#effect_pending = null;\n\n\t#effect_pending_subscriber = createSubscriber(() => {\n\t\tthis.#effect_pending = source(this.#local_pending_count);\n\n\t\tif (DEV) {\n\t\t\ttag(this.#effect_pending, '$effect.pending()');\n\t\t}\n\n\t\treturn () => {\n\t\t\tthis.#effect_pending = null;\n\t\t};\n\t});\n\n\t/**\n\t * @param {TemplateNode} node\n\t * @param {BoundaryProps} props\n\t * @param {((anchor: Node) => void)} children\n\t */\n\tconstructor(node, props, children) {\n\t\tthis.#anchor = node;\n\t\tthis.#props = props;\n\t\tthis.#children = children;\n\n\t\tthis.parent = /** @type {Effect} */ (active_effect).b;\n\n\t\tthis.#pending = !!this.#props.pending;\n\n\t\tthis.#effect = block(() => {\n\t\t\t/** @type {Effect} */ (active_effect).b = this;\n\n\t\t\tif (hydrating) {\n\t\t\t\tconst comment = this.#hydrate_open;\n\t\t\t\thydrate_next();\n\n\t\t\t\tconst server_rendered_pending =\n\t\t\t\t\t/** @type {Comment} */ (comment).nodeType === COMMENT_NODE &&\n\t\t\t\t\t/** @type {Comment} */ (comment).data === HYDRATION_START_ELSE;\n\n\t\t\t\tif (server_rendered_pending) {\n\t\t\t\t\tthis.#hydrate_pending_content();\n\t\t\t\t} else {\n\t\t\t\t\tthis.#hydrate_resolved_content();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar anchor = this.#get_anchor();\n\n\t\t\t\ttry {\n\t\t\t\t\tthis.#main_effect = branch(() => children(anchor));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.error(error);\n\t\t\t\t}\n\n\t\t\t\tif (this.#pending_count > 0) {\n\t\t\t\t\tthis.#show_pending_snippet();\n\t\t\t\t} else {\n\t\t\t\t\tthis.#pending = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn () => {\n\t\t\t\tthis.#pending_anchor?.remove();\n\t\t\t};\n\t\t}, flags);\n\n\t\tif (hydrating) {\n\t\t\tthis.#anchor = hydrate_node;\n\t\t}\n\t}\n\n\t#hydrate_resolved_content() {\n\t\ttry {\n\t\t\tthis.#main_effect = branch(() => this.#children(this.#anchor));\n\t\t} catch (error) {\n\t\t\tthis.error(error);\n\t\t}\n\n\t\t// Since server rendered resolved content, we never show pending state\n\t\t// Even if client-side async operations are still running, the content is already displayed\n\t\tthis.#pending = false;\n\t}\n\n\t#hydrate_pending_content() {\n\t\tconst pending = this.#props.pending;\n\t\tif (!pending) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#pending_effect = branch(() => pending(this.#anchor));\n\n\t\tBatch.enqueue(() => {\n\t\t\tvar anchor = this.#get_anchor();\n\n\t\t\tthis.#main_effect = this.#run(() => {\n\t\t\t\tBatch.ensure();\n\t\t\t\treturn branch(() => this.#children(anchor));\n\t\t\t});\n\n\t\t\tif (this.#pending_count > 0) {\n\t\t\t\tthis.#show_pending_snippet();\n\t\t\t} else {\n\t\t\t\tpause_effect(/** @type {Effect} */ (this.#pending_effect), () => {\n\t\t\t\t\tthis.#pending_effect = null;\n\t\t\t\t});\n\n\t\t\t\tthis.#pending = false;\n\t\t\t}\n\t\t});\n\t}\n\n\t#get_anchor() {\n\t\tvar anchor = this.#anchor;\n\n\t\tif (this.#pending) {\n\t\t\tthis.#pending_anchor = create_text();\n\t\t\tthis.#anchor.before(this.#pending_anchor);\n\n\t\t\tanchor = this.#pending_anchor;\n\t\t}\n\n\t\treturn anchor;\n\t}\n\n\t/**\n\t * Returns `true` if the effect exists inside a boundary whose pending snippet is shown\n\t * @returns {boolean}\n\t */\n\tis_pending() {\n\t\treturn this.#pending || (!!this.parent && this.parent.is_pending());\n\t}\n\n\thas_pending_snippet() {\n\t\treturn !!this.#props.pending;\n\t}\n\n\t/**\n\t * @param {() => Effect | null} fn\n\t */\n\t#run(fn) {\n\t\tvar previous_effect = active_effect;\n\t\tvar previous_reaction = active_reaction;\n\t\tvar previous_ctx = component_context;\n\n\t\tset_active_effect(this.#effect);\n\t\tset_active_reaction(this.#effect);\n\t\tset_component_context(this.#effect.ctx);\n\n\t\ttry {\n\t\t\treturn fn();\n\t\t} catch (e) {\n\t\t\thandle_error(e);\n\t\t\treturn null;\n\t\t} finally {\n\t\t\tset_active_effect(previous_effect);\n\t\t\tset_active_reaction(previous_reaction);\n\t\t\tset_component_context(previous_ctx);\n\t\t}\n\t}\n\n\t#show_pending_snippet() {\n\t\tconst pending = /** @type {(anchor: Node) => void} */ (this.#props.pending);\n\n\t\tif (this.#main_effect !== null) {\n\t\t\tthis.#offscreen_fragment = document.createDocumentFragment();\n\t\t\tthis.#offscreen_fragment.append(/** @type {TemplateNode} */ (this.#pending_anchor));\n\t\t\tmove_effect(this.#main_effect, this.#offscreen_fragment);\n\t\t}\n\n\t\tif (this.#pending_effect === null) {\n\t\t\tthis.#pending_effect = branch(() => pending(this.#anchor));\n\t\t}\n\t}\n\n\t/**\n\t * Updates the pending count associated with the currently visible pending snippet,\n\t * if any, such that we can replace the snippet with content once work is done\n\t * @param {1 | -1} d\n\t */\n\t#update_pending_count(d) {\n\t\tif (!this.has_pending_snippet()) {\n\t\t\tif (this.parent) {\n\t\t\t\tthis.parent.#update_pending_count(d);\n\t\t\t}\n\n\t\t\t// if there's no parent, we're in a scope with no pending snippet\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#pending_count += d;\n\n\t\tif (this.#pending_count === 0) {\n\t\t\tthis.#pending = false;\n\n\t\t\tif (this.#pending_effect) {\n\t\t\t\tpause_effect(this.#pending_effect, () => {\n\t\t\t\t\tthis.#pending_effect = null;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.#offscreen_fragment) {\n\t\t\t\tthis.#anchor.before(this.#offscreen_fragment);\n\t\t\t\tthis.#offscreen_fragment = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Update the source that powers `$effect.pending()` inside this boundary,\n\t * and controls when the current `pending` snippet (if any) is removed.\n\t * Do not call from inside the class\n\t * @param {1 | -1} d\n\t */\n\tupdate_pending_count(d) {\n\t\tthis.#update_pending_count(d);\n\n\t\tthis.#local_pending_count += d;\n\n\t\tif (this.#effect_pending) {\n\t\t\tinternal_set(this.#effect_pending, this.#local_pending_count);\n\t\t}\n\t}\n\n\tget_effect_pending() {\n\t\tthis.#effect_pending_subscriber();\n\t\treturn get(/** @type {Source<number>} */ (this.#effect_pending));\n\t}\n\n\t/** @param {unknown} error */\n\terror(error) {\n\t\tvar onerror = this.#props.onerror;\n\t\tlet failed = this.#props.failed;\n\n\t\t// If we have nothing to capture the error, or if we hit an error while\n\t\t// rendering the fallback, re-throw for another boundary to handle\n\t\tif (this.#is_creating_fallback || (!onerror && !failed)) {\n\t\t\tthrow error;\n\t\t}\n\n\t\tif (this.#main_effect) {\n\t\t\tdestroy_effect(this.#main_effect);\n\t\t\tthis.#main_effect = null;\n\t\t}\n\n\t\tif (this.#pending_effect) {\n\t\t\tdestroy_effect(this.#pending_effect);\n\t\t\tthis.#pending_effect = null;\n\t\t}\n\n\t\tif (this.#failed_effect) {\n\t\t\tdestroy_effect(this.#failed_effect);\n\t\t\tthis.#failed_effect = null;\n\t\t}\n\n\t\tif (hydrating) {\n\t\t\tset_hydrate_node(/** @type {TemplateNode} */ (this.#hydrate_open));\n\t\t\tnext();\n\t\t\tset_hydrate_node(skip_nodes());\n\t\t}\n\n\t\tvar did_reset = false;\n\t\tvar calling_on_error = false;\n\n\t\tconst reset = () => {\n\t\t\tif (did_reset) {\n\t\t\t\tw.svelte_boundary_reset_noop();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdid_reset = true;\n\n\t\t\tif (calling_on_error) {\n\t\t\t\te.svelte_boundary_reset_onerror();\n\t\t\t}\n\n\t\t\t// If the failure happened while flushing effects, current_batch can be null\n\t\t\tBatch.ensure();\n\n\t\t\tthis.#local_pending_count = 0;\n\n\t\t\tif (this.#failed_effect !== null) {\n\t\t\t\tpause_effect(this.#failed_effect, () => {\n\t\t\t\t\tthis.#failed_effect = null;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// we intentionally do not try to find the nearest pending boundary. If this boundary has one, we'll render it on reset\n\t\t\t// but it would be really weird to show the parent's boundary on a child reset.\n\t\t\tthis.#pending = this.has_pending_snippet();\n\n\t\t\tthis.#main_effect = this.#run(() => {\n\t\t\t\tthis.#is_creating_fallback = false;\n\t\t\t\treturn branch(() => this.#children(this.#anchor));\n\t\t\t});\n\n\t\t\tif (this.#pending_count > 0) {\n\t\t\t\tthis.#show_pending_snippet();\n\t\t\t} else {\n\t\t\t\tthis.#pending = false;\n\t\t\t}\n\t\t};\n\n\t\tvar previous_reaction = active_reaction;\n\n\t\ttry {\n\t\t\tset_active_reaction(null);\n\t\t\tcalling_on_error = true;\n\t\t\tonerror?.(error, reset);\n\t\t\tcalling_on_error = false;\n\t\t} catch (error) {\n\t\t\tinvoke_error_boundary(error, this.#effect && this.#effect.parent);\n\t\t} finally {\n\t\t\tset_active_reaction(previous_reaction);\n\t\t}\n\n\t\tif (failed) {\n\t\t\tqueue_micro_task(() => {\n\t\t\t\tthis.#failed_effect = this.#run(() => {\n\t\t\t\t\tBatch.ensure();\n\t\t\t\t\tthis.#is_creating_fallback = true;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn branch(() => {\n\t\t\t\t\t\t\tfailed(\n\t\t\t\t\t\t\t\tthis.#anchor,\n\t\t\t\t\t\t\t\t() => error,\n\t\t\t\t\t\t\t\t() => reset\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tinvoke_error_boundary(error, /** @type {Effect} */ (this.#effect.parent));\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tthis.#is_creating_fallback = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport function get_boundary() {\n\treturn /** @type {Boundary} */ (/** @type {Effect} */ (active_effect).b);\n}\n\nexport function pending() {\n\tif (active_effect === null) {\n\t\te.effect_pending_outside_reaction();\n\t}\n\n\tvar boundary = active_effect.b;\n\n\tif (boundary === null) {\n\t\treturn 0; // TODO eventually we will need this to be global\n\t}\n\n\treturn boundary.get_effect_pending();\n}\n","/** @import { Effect, TemplateNode, Value } from '#client' */\nimport { DESTROYED, STALE_REACTION } from '#client/constants';\nimport { DEV } from 'esm-env';\nimport {\n\tcomponent_context,\n\tdev_stack,\n\tis_runes,\n\tset_component_context,\n\tset_dev_stack\n} from '../context.js';\nimport { get_boundary } from '../dom/blocks/boundary.js';\nimport { invoke_error_boundary } from '../error-handling.js';\nimport {\n\tactive_effect,\n\tactive_reaction,\n\tset_active_effect,\n\tset_active_reaction\n} from '../runtime.js';\nimport { Batch, current_batch } from './batch.js';\nimport {\n\tasync_derived,\n\tcurrent_async_effect,\n\tderived,\n\tderived_safe_equal,\n\tset_from_async_derived\n} from './deriveds.js';\nimport { aborted } from './effects.js';\nimport { hydrate_next, hydrating, set_hydrate_node, skip_nodes } from '../dom/hydration.js';\n\n/**\n * @param {Array<Promise<void>>} blockers\n * @param {Array<() => any>} sync\n * @param {Array<() => Promise<any>>} async\n * @param {(values: Value[]) => any} fn\n */\nexport function flatten(blockers, sync, async, fn) {\n\tconst d = is_runes() ? derived : derived_safe_equal;\n\n\tif (async.length === 0 && blockers.length === 0) {\n\t\tfn(sync.map(d));\n\t\treturn;\n\t}\n\n\tvar batch = current_batch;\n\tvar parent = /** @type {Effect} */ (active_effect);\n\n\tvar restore = capture();\n\n\tfunction run() {\n\t\tPromise.all(async.map((expression) => async_derived(expression)))\n\t\t\t.then((result) => {\n\t\t\t\trestore();\n\n\t\t\t\ttry {\n\t\t\t\t\tfn([...sync.map(d), ...result]);\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// ignore errors in blocks that have already been destroyed\n\t\t\t\t\tif ((parent.f & DESTROYED) === 0) {\n\t\t\t\t\t\tinvoke_error_boundary(error, parent);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbatch?.deactivate();\n\t\t\t\tunset_context();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tinvoke_error_boundary(error, parent);\n\t\t\t});\n\t}\n\n\tif (blockers.length > 0) {\n\t\tPromise.all(blockers).then(() => {\n\t\t\trestore();\n\n\t\t\ttry {\n\t\t\t\treturn run();\n\t\t\t} finally {\n\t\t\t\tbatch?.deactivate();\n\t\t\t\tunset_context();\n\t\t\t}\n\t\t});\n\t} else {\n\t\trun();\n\t}\n}\n\n/**\n * @param {Array<Promise<void>>} blockers\n * @param {(values: Value[]) => any} fn\n */\nexport function run_after_blockers(blockers, fn) {\n\tflatten(blockers, [], [], fn);\n}\n\n/**\n * Captures the current effect context so that we can restore it after\n * some asynchronous work has happened (so that e.g. `await a + b`\n * causes `b` to be registered as a dependency).\n */\nexport function capture() {\n\tvar previous_effect = active_effect;\n\tvar previous_reaction = active_reaction;\n\tvar previous_component_context = component_context;\n\tvar previous_batch = current_batch;\n\n\tif (DEV) {\n\t\tvar previous_dev_stack = dev_stack;\n\t}\n\n\treturn function restore(activate_batch = true) {\n\t\tset_active_effect(previous_effect);\n\t\tset_active_reaction(previous_reaction);\n\t\tset_component_context(previous_component_context);\n\t\tif (activate_batch) previous_batch?.activate();\n\n\t\tif (DEV) {\n\t\t\tset_from_async_derived(null);\n\t\t\tset_dev_stack(previous_dev_stack);\n\t\t}\n\t};\n}\n\n/**\n * Wraps an `await` expression in such a way that the effect context that was\n * active before the expression evaluated can be reapplied afterwards \n * `await a + b` becomes `(await $.save(a))() + b`\n * @template T\n * @param {Promise<T>} promise\n * @returns {Promise<() => T>}\n */\nexport async function save(promise) {\n\tvar restore = capture();\n\tvar value = await promise;\n\n\treturn () => {\n\t\trestore();\n\t\treturn value;\n\t};\n}\n\n/**\n * Reset `current_async_effect` after the `promise` resolves, so\n * that we can emit `await_reactivity_loss` warnings\n * @template T\n * @param {Promise<T>} promise\n * @returns {Promise<() => T>}\n */\nexport async function track_reactivity_loss(promise) {\n\tvar previous_async_effect = current_async_effect;\n\tvar value = await promise;\n\n\treturn () => {\n\t\tset_from_async_derived(previous_async_effect);\n\t\treturn value;\n\t};\n}\n\n/**\n * Used in `for await` loops in DEV, so\n * that we can emit `await_reactivity_loss` warnings\n * after each `async_iterator` result resolves and\n * after the `async_iterator` return resolves (if it runs)\n * @template T\n * @template TReturn\n * @param {Iterable<T> | AsyncIterable<T>} iterable\n * @returns {AsyncGenerator<T, TReturn | undefined>}\n */\nexport async function* for_await_track_reactivity_loss(iterable) {\n\t// This is based on the algorithms described in ECMA-262:\n\t// ForIn/OfBodyEvaluation\n\t// https://tc39.es/ecma262/multipage/ecmascript-language-statements-and-declarations.html#sec-runtime-semantics-forin-div-ofbodyevaluation-lhs-stmt-iterator-lhskind-labelset\n\t// AsyncIteratorClose\n\t// https://tc39.es/ecma262/multipage/abstract-operations.html#sec-asynciteratorclose\n\n\t/** @type {AsyncIterator<T, TReturn>} */\n\t// @ts-ignore\n\tconst iterator = iterable[Symbol.asyncIterator]?.() ?? iterable[Symbol.iterator]?.();\n\n\tif (iterator === undefined) {\n\t\tthrow new TypeError('value is not async iterable');\n\t}\n\n\t/** Whether the completion of the iterator was \"normal\", meaning it wasn't ended via `break` or a similar method */\n\tlet normal_completion = false;\n\ttry {\n\t\twhile (true) {\n\t\t\tconst { done, value } = (await track_reactivity_loss(iterator.next()))();\n\t\t\tif (done) {\n\t\t\t\tnormal_completion = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tyield value;\n\t\t}\n\t} finally {\n\t\t// If the iterator had a normal completion and `return` is defined on the iterator, call it and return the value\n\t\tif (normal_completion && iterator.return !== undefined) {\n\t\t\t// eslint-disable-next-line no-unsafe-finally\n\t\t\treturn /** @type {TReturn} */ ((await track_reactivity_loss(iterator.return()))().value);\n\t\t}\n\t}\n}\n\nexport function unset_context() {\n\tset_active_effect(null);\n\tset_active_reaction(null);\n\tset_component_context(null);\n\n\tif (DEV) {\n\t\tset_from_async_derived(null);\n\t\tset_dev_stack(null);\n\t}\n}\n\n/**\n * @param {TemplateNode} anchor\n * @param {(target: TemplateNode) => Promise<void>} fn\n */\nexport async function async_body(anchor, fn) {\n\tvar boundary = get_boundary();\n\tvar batch = /** @type {Batch} */ (current_batch);\n\tvar blocking = !boundary.is_pending();\n\n\tboundary.update_pending_count(1);\n\tbatch.increment(blocking);\n\n\tvar active = /** @type {Effect} */ (active_effect);\n\n\tvar was_hydrating = hydrating;\n\tvar next_hydrate_node = undefined;\n\n\tif (was_hydrating) {\n\t\thydrate_next();\n\t\tnext_hydrate_node = skip_nodes(false);\n\t}\n\n\ttry {\n\t\tvar promise = fn(anchor);\n\t} finally {\n\t\tif (next_hydrate_node) {\n\t\t\tset_hydrate_node(next_hydrate_node);\n\t\t\thydrate_next();\n\t\t}\n\t}\n\n\ttry {\n\t\tawait promise;\n\t} catch (error) {\n\t\tif (!aborted(active)) {\n\t\t\tinvoke_error_boundary(error, active);\n\t\t}\n\t} finally {\n\t\tboundary.update_pending_count(-1);\n\t\tbatch.decrement(blocking);\n\n\t\tunset_context();\n\t}\n}\n\n/**\n * @param {Array<() => void | Promise<void>>} thunks\n */\nexport function run(thunks) {\n\tconst restore = capture();\n\n\tvar boundary = get_boundary();\n\tvar batch = /** @type {Batch} */ (current_batch);\n\tvar blocking = !boundary.is_pending();\n\n\tboundary.update_pending_count(1);\n\tbatch.increment(blocking);\n\n\tvar active = /** @type {Effect} */ (active_effect);\n\n\t/** @type {null | { error: any }} */\n\tvar errored = null;\n\n\t/** @param {any} error */\n\tconst handle_error = (error) => {\n\t\terrored = { error }; // wrap in object in case a promise rejects with a falsy value\n\n\t\tif (!aborted(active)) {\n\t\t\tinvoke_error_boundary(error, active);\n\t\t}\n\t};\n\n\tvar promise = Promise.resolve(thunks[0]()).catch(handle_error);\n\n\tvar promises = [promise];\n\n\tfor (const fn of thunks.slice(1)) {\n\t\tpromise = promise\n\t\t\t.then(() => {\n\t\t\t\tif (errored) {\n\t\t\t\t\tthrow errored.error;\n\t\t\t\t}\n\n\t\t\t\tif (aborted(active)) {\n\t\t\t\t\tthrow STALE_REACTION;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\trestore();\n\t\t\t\t\treturn fn();\n\t\t\t\t} finally {\n\t\t\t\t\t// TODO do we need it here as well as below?\n\t\t\t\t\tunset_context();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(handle_error)\n\t\t\t.finally(() => {\n\t\t\t\tunset_context();\n\t\t\t});\n\n\t\tpromises.push(promise);\n\t}\n\n\tpromise\n\t\t// wait one more tick, so that template effects are\n\t\t// guaranteed to run before `$effect(...)`\n\t\t.then(() => Promise.resolve())\n\t\t.finally(() => {\n\t\t\tboundary.update_pending_count(-1);\n\t\t\tbatch.decrement(blocking);\n\t\t});\n\n\treturn promises;\n}\n","/** @import { Derived, Effect, Source } from '#client' */\n/** @import { Batch } from './batch.js'; */\nimport { DEV } from 'esm-env';\nimport {\n\tERROR_VALUE,\n\tCLEAN,\n\tDERIVED,\n\tDIRTY,\n\tEFFECT_PRESERVED,\n\tMAYBE_DIRTY,\n\tSTALE_REACTION,\n\tASYNC,\n\tWAS_MARKED,\n\tCONNECTED,\n\tDESTROYED\n} from '#client/constants';\nimport {\n\tactive_reaction,\n\tactive_effect,\n\tset_signal_status,\n\tupdate_reaction,\n\tincrement_write_version,\n\tset_active_effect,\n\tpush_reaction_value,\n\tis_destroying_effect\n} from '../runtime.js';\nimport { equals, safe_equals } from './equality.js';\nimport * as e from '../errors.js';\nimport * as w from '../warnings.js';\nimport { async_effect, destroy_effect, effect_tracking, teardown } from './effects.js';\nimport { eager_effects, internal_set, set_eager_effects, source } from './sources.js';\nimport { get_error } from '../../shared/dev.js';\nimport { async_mode_flag, tracing_mode_flag } from '../../flags/index.js';\nimport { Boundary } from '../dom/blocks/boundary.js';\nimport { component_context } from '../context.js';\nimport { UNINITIALIZED } from '../../../constants.js';\nimport { batch_values, current_batch } from './batch.js';\nimport { unset_context } from './async.js';\nimport { deferred } from '../../shared/utils.js';\n\n/** @type {Effect | null} */\nexport let current_async_effect = null;\n\n/** @param {Effect | null} v */\nexport function set_from_async_derived(v) {\n\tcurrent_async_effect = v;\n}\n\nexport const recent_async_deriveds = new Set();\n\n/**\n * @template V\n * @param {() => V} fn\n * @returns {Derived<V>}\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function derived(fn) {\n\tvar flags = DERIVED | DIRTY;\n\tvar parent_derived =\n\t\tactive_reaction !== null && (active_reaction.f & DERIVED) !== 0\n\t\t\t? /** @type {Derived} */ (active_reaction)\n\t\t\t: null;\n\n\tif (active_effect !== null) {\n\t\t// Since deriveds are evaluated lazily, any effects created inside them are\n\t\t// created too late to ensure that the parent effect is added to the tree\n\t\tactive_effect.f |= EFFECT_PRESERVED;\n\t}\n\n\t/** @type {Derived<V>} */\n\tconst signal = {\n\t\tctx: component_context,\n\t\tdeps: null,\n\t\teffects: null,\n\t\tequals,\n\t\tf: flags,\n\t\tfn,\n\t\treactions: null,\n\t\trv: 0,\n\t\tv: /** @type {V} */ (UNINITIALIZED),\n\t\twv: 0,\n\t\tparent: parent_derived ?? active_effect,\n\t\tac: null\n\t};\n\n\tif (DEV && tracing_mode_flag) {\n\t\tsignal.created = get_error('created at');\n\t}\n\n\treturn signal;\n}\n\n/**\n * @template V\n * @param {() => V | Promise<V>} fn\n * @param {string} [location] If provided, print a warning if the value is not read immediately after update\n * @returns {Promise<Source<V>>}\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function async_derived(fn, location) {\n\tlet parent = /** @type {Effect | null} */ (active_effect);\n\n\tif (parent === null) {\n\t\te.async_derived_orphan();\n\t}\n\n\tvar boundary = /** @type {Boundary} */ (parent.b);\n\n\tvar promise = /** @type {Promise<V>} */ (/** @type {unknown} */ (undefined));\n\tvar signal = source(/** @type {V} */ (UNINITIALIZED));\n\n\t// only suspend in async deriveds created on initialisation\n\tvar should_suspend = !active_reaction;\n\n\t/** @type {Map<Batch, ReturnType<typeof deferred<V>>>} */\n\tvar deferreds = new Map();\n\n\tasync_effect(() => {\n\t\tif (DEV) current_async_effect = active_effect;\n\n\t\t/** @type {ReturnType<typeof deferred<V>>} */\n\t\tvar d = deferred();\n\t\tpromise = d.promise;\n\n\t\ttry {\n\t\t\t// If this code is changed at some point, make sure to still access the then property\n\t\t\t// of fn() to read any signals it might access, so that we track them as dependencies.\n\t\t\t// We call `unset_context` to undo any `save` calls that happen inside `fn()`\n\t\t\tPromise.resolve(fn())\n\t\t\t\t.then(d.resolve, d.reject)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (batch === current_batch && batch.committed) {\n\t\t\t\t\t\t// if the batch was rejected as stale, we need to cleanup\n\t\t\t\t\t\t// after any `$.save(...)` calls inside `fn()`\n\t\t\t\t\t\tbatch.deactivate();\n\t\t\t\t\t}\n\n\t\t\t\t\tunset_context();\n\t\t\t\t});\n\t\t} catch (error) {\n\t\t\td.reject(error);\n\t\t\tunset_context();\n\t\t}\n\n\t\tif (DEV) current_async_effect = null;\n\n\t\tvar batch = /** @type {Batch} */ (current_batch);\n\n\t\tif (should_suspend) {\n\t\t\tvar blocking = !boundary.is_pending();\n\n\t\t\tboundary.update_pending_count(1);\n\t\t\tbatch.increment(blocking);\n\n\t\t\tdeferreds.get(batch)?.reject(STALE_REACTION);\n\t\t\tdeferreds.delete(batch); // delete to ensure correct order in Map iteration below\n\t\t\tdeferreds.set(batch, d);\n\t\t}\n\n\t\t/**\n\t\t * @param {any} value\n\t\t * @param {unknown} error\n\t\t */\n\t\tconst handler = (value, error = undefined) => {\n\t\t\tcurrent_async_effect = null;\n\n\t\t\tbatch.activate();\n\n\t\t\tif (error) {\n\t\t\t\tif (error !== STALE_REACTION) {\n\t\t\t\t\tsignal.f |= ERROR_VALUE;\n\n\t\t\t\t\t// @ts-expect-error the error is the wrong type, but we don't care\n\t\t\t\t\tinternal_set(signal, error);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ((signal.f & ERROR_VALUE) !== 0) {\n\t\t\t\t\tsignal.f ^= ERROR_VALUE;\n\t\t\t\t}\n\n\t\t\t\tinternal_set(signal, value);\n\n\t\t\t\t// All prior async derived runs are now stale\n\t\t\t\tfor (const [b, d] of deferreds) {\n\t\t\t\t\tdeferreds.delete(b);\n\t\t\t\t\tif (b === batch) break;\n\t\t\t\t\td.reject(STALE_REACTION);\n\t\t\t\t}\n\n\t\t\t\tif (DEV && location !== undefined) {\n\t\t\t\t\trecent_async_deriveds.add(signal);\n\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tif (recent_async_deriveds.has(signal)) {\n\t\t\t\t\t\t\tw.await_waterfall(/** @type {string} */ (signal.label), location);\n\t\t\t\t\t\t\trecent_async_deriveds.delete(signal);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (should_suspend) {\n\t\t\t\tboundary.update_pending_count(-1);\n\t\t\t\tbatch.decrement(blocking);\n\t\t\t}\n\t\t};\n\n\t\td.promise.then(handler, (e) => handler(null, e || 'unknown'));\n\t});\n\n\tteardown(() => {\n\t\tfor (const d of deferreds.values()) {\n\t\t\td.reject(STALE_REACTION);\n\t\t}\n\t});\n\n\tif (DEV) {\n\t\t// add a flag that lets this be printed as a derived\n\t\t// when using `$inspect.trace()`\n\t\tsignal.f |= ASYNC;\n\t}\n\n\treturn new Promise((fulfil) => {\n\t\t/** @param {Promise<V>} p */\n\t\tfunction next(p) {\n\t\t\tfunction go() {\n\t\t\t\tif (p === promise) {\n\t\t\t\t\tfulfil(signal);\n\t\t\t\t} else {\n\t\t\t\t\t// if the effect re-runs before the initial promise\n\t\t\t\t\t// resolves, delay resolution until we have a value\n\t\t\t\t\tnext(promise);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tp.then(go, go);\n\t\t}\n\n\t\tnext(promise);\n\t});\n}\n\n/**\n * @template V\n * @param {() => V} fn\n * @returns {Derived<V>}\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function user_derived(fn) {\n\tconst d = derived(fn);\n\n\tif (!async_mode_flag) push_reaction_value(d);\n\n\treturn d;\n}\n\n/**\n * @template V\n * @param {() => V} fn\n * @returns {Derived<V>}\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function derived_safe_equal(fn) {\n\tconst signal = derived(fn);\n\tsignal.equals = safe_equals;\n\treturn signal;\n}\n\n/**\n * @param {Derived} derived\n * @returns {void}\n */\nexport function destroy_derived_effects(derived) {\n\tvar effects = derived.effects;\n\n\tif (effects !== null) {\n\t\tderived.effects = null;\n\n\t\tfor (var i = 0; i < effects.length; i += 1) {\n\t\t\tdestroy_effect(/** @type {Effect} */ (effects[i]));\n\t\t}\n\t}\n}\n\n/**\n * The currently updating deriveds, used to detect infinite recursion\n * in dev mode and provide a nicer error than 'too much recursion'\n * @type {Derived[]}\n */\nlet stack = [];\n\n/**\n * @param {Derived} derived\n * @returns {Effect | null}\n */\nfunction get_derived_parent_effect(derived) {\n\tvar parent = derived.parent;\n\twhile (parent !== null) {\n\t\tif ((parent.f & DERIVED) === 0) {\n\t\t\t// The original parent effect might've been destroyed but the derived\n\t\t\t// is used elsewhere now - do not return the destroyed effect in that case\n\t\t\treturn (parent.f & DESTROYED) === 0 ? /** @type {Effect} */ (parent) : null;\n\t\t}\n\t\tparent = parent.parent;\n\t}\n\treturn null;\n}\n\n/**\n * @template T\n * @param {Derived} derived\n * @returns {T}\n */\nexport function execute_derived(derived) {\n\tvar value;\n\tvar prev_active_effect = active_effect;\n\n\tset_active_effect(get_derived_parent_effect(derived));\n\n\tif (DEV) {\n\t\tlet prev_eager_effects = eager_effects;\n\t\tset_eager_effects(new Set());\n\t\ttry {\n\t\t\tif (stack.includes(derived)) {\n\t\t\t\te.derived_references_self();\n\t\t\t}\n\n\t\t\tstack.push(derived);\n\n\t\t\tderived.f &= ~WAS_MARKED;\n\t\t\tdestroy_derived_effects(derived);\n\t\t\tvalue = update_reaction(derived);\n\t\t} finally {\n\t\t\tset_active_effect(prev_active_effect);\n\t\t\tset_eager_effects(prev_eager_effects);\n\t\t\tstack.pop();\n\t\t}\n\t} else {\n\t\ttry {\n\t\t\tderived.f &= ~WAS_MARKED;\n\t\t\tdestroy_derived_effects(derived);\n\t\t\tvalue = update_reaction(derived);\n\t\t} finally {\n\t\t\tset_active_effect(prev_active_effect);\n\t\t}\n\t}\n\n\treturn value;\n}\n\n/**\n * @param {Derived} derived\n * @returns {void}\n */\nexport function update_derived(derived) {\n\tvar value = execute_derived(derived);\n\n\tif (!derived.equals(value)) {\n\t\t// in a fork, we don't update the underlying value, just `batch_values`.\n\t\t// the underlying value will be updated when the fork is committed.\n\t\t// otherwise, the next time we get here after a 'real world' state\n\t\t// change, `derived.equals` may incorrectly return `true`\n\t\tif (!current_batch?.is_fork) {\n\t\t\tderived.v = value;\n\t\t}\n\n\t\tderived.wv = increment_write_version();\n\t}\n\n\t// don't mark derived clean if we're reading it inside a\n\t// cleanup function, or it will cache a stale value\n\tif (is_destroying_effect) {\n\t\treturn;\n\t}\n\n\t// During time traveling we don't want to reset the status so that\n\t// traversal of the graph in the other batches still happens\n\tif (batch_values !== null) {\n\t\t// only cache the value if we're in a tracking context, otherwise we won't\n\t\t// clear the cache in `mark_reactions` when dependencies are updated\n\t\tif (effect_tracking() || current_batch?.is_fork) {\n\t\t\tbatch_values.set(derived, value);\n\t\t}\n\t} else {\n\t\tvar status = (derived.f & CONNECTED) === 0 ? MAYBE_DIRTY : CLEAN;\n\t\tset_signal_status(derived, status);\n\t}\n}\n","/** @import { Derived, Effect, Source, Value } from '#client' */\nimport { DEV } from 'esm-env';\nimport {\n\tactive_reaction,\n\tactive_effect,\n\tuntracked_writes,\n\tget,\n\tset_untracked_writes,\n\tset_signal_status,\n\tuntrack,\n\tincrement_write_version,\n\tupdate_effect,\n\tcurrent_sources,\n\tis_dirty,\n\tuntracking,\n\tis_destroying_effect,\n\tpush_reaction_value,\n\tset_is_updating_effect,\n\tis_updating_effect\n} from '../runtime.js';\nimport { equals, safe_equals } from './equality.js';\nimport {\n\tCLEAN,\n\tDERIVED,\n\tDIRTY,\n\tBRANCH_EFFECT,\n\tEAGER_EFFECT,\n\tMAYBE_DIRTY,\n\tBLOCK_EFFECT,\n\tROOT_EFFECT,\n\tASYNC,\n\tWAS_MARKED,\n\tCONNECTED\n} from '#client/constants';\nimport * as e from '../errors.js';\nimport { legacy_mode_flag, tracing_mode_flag } from '../../flags/index.js';\nimport { tag_proxy } from '../dev/tracing.js';\nimport { get_error } from '../../shared/dev.js';\nimport { component_context, is_runes } from '../context.js';\nimport { Batch, batch_values, eager_block_effects, schedule_effect } from './batch.js';\nimport { proxy } from '../proxy.js';\nimport { execute_derived } from './deriveds.js';\n\n/** @type {Set<any>} */\nexport let eager_effects = new Set();\n\n/** @type {Map<Source, any>} */\nexport const old_values = new Map();\n\n/**\n * @param {Set<any>} v\n */\nexport function set_eager_effects(v) {\n\teager_effects = v;\n}\n\nlet eager_effects_deferred = false;\n\nexport function set_eager_effects_deferred() {\n\teager_effects_deferred = true;\n}\n\n/**\n * @template V\n * @param {V} v\n * @param {Error | null} [stack]\n * @returns {Source<V>}\n */\n// TODO rename this to `state` throughout the codebase\nexport function source(v, stack) {\n\t/** @type {Value} */\n\tvar signal = {\n\t\tf: 0, // TODO ideally we could skip this altogether, but it causes type errors\n\t\tv,\n\t\treactions: null,\n\t\tequals,\n\t\trv: 0,\n\t\twv: 0\n\t};\n\n\tif (DEV && tracing_mode_flag) {\n\t\tsignal.created = stack ?? get_error('created at');\n\t\tsignal.updated = null;\n\t\tsignal.set_during_effect = false;\n\t\tsignal.trace = null;\n\t}\n\n\treturn signal;\n}\n\n/**\n * @template V\n * @param {V} v\n * @param {Error | null} [stack]\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function state(v, stack) {\n\tconst s = source(v, stack);\n\n\tpush_reaction_value(s);\n\n\treturn s;\n}\n\n/**\n * @template V\n * @param {V} initial_value\n * @param {boolean} [immutable]\n * @returns {Source<V>}\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function mutable_source(initial_value, immutable = false, trackable = true) {\n\tconst s = source(initial_value);\n\tif (!immutable) {\n\t\ts.equals = safe_equals;\n\t}\n\n\t// bind the signal to the component context, in case we need to\n\t// track updates to trigger beforeUpdate/afterUpdate callbacks\n\tif (legacy_mode_flag && trackable && component_context !== null && component_context.l !== null) {\n\t\t(component_context.l.s ??= []).push(s);\n\t}\n\n\treturn s;\n}\n\n/**\n * @template V\n * @param {Value<V>} source\n * @param {V} value\n */\nexport function mutate(source, value) {\n\tset(\n\t\tsource,\n\t\tuntrack(() => get(source))\n\t);\n\treturn value;\n}\n\n/**\n * @template V\n * @param {Source<V>} source\n * @param {V} value\n * @param {boolean} [should_proxy]\n * @returns {V}\n */\nexport function set(source, value, should_proxy = false) {\n\tif (\n\t\tactive_reaction !== null &&\n\t\t// since we are untracking the function inside `$inspect.with` we need to add this check\n\t\t// to ensure we error if state is set inside an inspect effect\n\t\t(!untracking || (active_reaction.f & EAGER_EFFECT) !== 0) &&\n\t\tis_runes() &&\n\t\t(active_reaction.f & (DERIVED | BLOCK_EFFECT | ASYNC | EAGER_EFFECT)) !== 0 &&\n\t\t!current_sources?.includes(source)\n\t) {\n\t\te.state_unsafe_mutation();\n\t}\n\n\tlet new_value = should_proxy ? proxy(value) : value;\n\n\tif (DEV) {\n\t\ttag_proxy(new_value, /** @type {string} */ (source.label));\n\t}\n\n\treturn internal_set(source, new_value);\n}\n\n/**\n * @template V\n * @param {Source<V>} source\n * @param {V} value\n * @returns {V}\n */\nexport function internal_set(source, value) {\n\tif (!source.equals(value)) {\n\t\tvar old_value = source.v;\n\n\t\tif (is_destroying_effect) {\n\t\t\told_values.set(source, value);\n\t\t} else {\n\t\t\told_values.set(source, old_value);\n\t\t}\n\n\t\tsource.v = value;\n\n\t\tvar batch = Batch.ensure();\n\t\tbatch.capture(source, old_value);\n\n\t\tif (DEV) {\n\t\t\tif (tracing_mode_flag || active_effect !== null) {\n\t\t\t\tsource.updated ??= new Map();\n\n\t\t\t\t// For performance reasons, when not using $inspect.trace, we only start collecting stack traces\n\t\t\t\t// after the same source has been updated more than 5 times in the same flush cycle.\n\t\t\t\tconst count = (source.updated.get('')?.count ?? 0) + 1;\n\t\t\t\tsource.updated.set('', { error: /** @type {any} */ (null), count });\n\n\t\t\t\tif (tracing_mode_flag || count > 5) {\n\t\t\t\t\tconst error = get_error('updated at');\n\n\t\t\t\t\tif (error !== null) {\n\t\t\t\t\t\tlet entry = source.updated.get(error.stack);\n\n\t\t\t\t\t\tif (!entry) {\n\t\t\t\t\t\t\tentry = { error, count: 0 };\n\t\t\t\t\t\t\tsource.updated.set(error.stack, entry);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tentry.count++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (active_effect !== null) {\n\t\t\t\tsource.set_during_effect = true;\n\t\t\t}\n\t\t}\n\n\t\tif ((source.f & DERIVED) !== 0) {\n\t\t\t// if we are assigning to a dirty derived we set it to clean/maybe dirty but we also eagerly execute it to track the dependencies\n\t\t\tif ((source.f & DIRTY) !== 0) {\n\t\t\t\texecute_derived(/** @type {Derived} */ (source));\n\t\t\t}\n\n\t\t\tset_signal_status(source, (source.f & CONNECTED) !== 0 ? CLEAN : MAYBE_DIRTY);\n\t\t}\n\n\t\tsource.wv = increment_write_version();\n\n\t\t// For debugging, in case you want to know which reactions are being scheduled:\n\t\t// log_reactions(source);\n\t\tmark_reactions(source, DIRTY);\n\n\t\t// It's possible that the current reaction might not have up-to-date dependencies\n\t\t// whilst it's actively running. So in the case of ensuring it registers the reaction\n\t\t// properly for itself, we need to ensure the current effect actually gets\n\t\t// scheduled. i.e: `$effect(() => x++)`\n\t\tif (\n\t\t\tis_runes() &&\n\t\t\tactive_effect !== null &&\n\t\t\t(active_effect.f & CLEAN) !== 0 &&\n\t\t\t(active_effect.f & (BRANCH_EFFECT | ROOT_EFFECT)) === 0\n\t\t) {\n\t\t\tif (untracked_writes === null) {\n\t\t\t\tset_untracked_writes([source]);\n\t\t\t} else {\n\t\t\t\tuntracked_writes.push(source);\n\t\t\t}\n\t\t}\n\n\t\tif (!batch.is_fork && eager_effects.size > 0 && !eager_effects_deferred) {\n\t\t\tflush_eager_effects();\n\t\t}\n\t}\n\n\treturn value;\n}\n\nexport function flush_eager_effects() {\n\teager_effects_deferred = false;\n\tvar prev_is_updating_effect = is_updating_effect;\n\tset_is_updating_effect(true);\n\n\tconst inspects = Array.from(eager_effects);\n\n\ttry {\n\t\tfor (const effect of inspects) {\n\t\t\t// Mark clean inspect-effects as maybe dirty and then check their dirtiness\n\t\t\t// instead of just updating the effects - this way we avoid overfiring.\n\t\t\tif ((effect.f & CLEAN) !== 0) {\n\t\t\t\tset_signal_status(effect, MAYBE_DIRTY);\n\t\t\t}\n\n\t\t\tif (is_dirty(effect)) {\n\t\t\t\tupdate_effect(effect);\n\t\t\t}\n\t\t}\n\t} finally {\n\t\tset_is_updating_effect(prev_is_updating_effect);\n\t}\n\n\teager_effects.clear();\n}\n\n/**\n * @template {number | bigint} T\n * @param {Source<T>} source\n * @param {1 | -1} [d]\n * @returns {T}\n */\nexport function update(source, d = 1) {\n\tvar value = get(source);\n\tvar result = d === 1 ? value++ : value--;\n\n\tset(source, value);\n\n\t// @ts-expect-error\n\treturn result;\n}\n\n/**\n * @template {number | bigint} T\n * @param {Source<T>} source\n * @param {1 | -1} [d]\n * @returns {T}\n */\nexport function update_pre(source, d = 1) {\n\tvar value = get(source);\n\n\t// @ts-expect-error\n\treturn set(source, d === 1 ? ++value : --value);\n}\n\n/**\n * Silently (without using `get`) increment a source\n * @param {Source<number>} source\n */\nexport function increment(source) {\n\tset(source, source.v + 1);\n}\n\n/**\n * @param {Value} signal\n * @param {number} status should be DIRTY or MAYBE_DIRTY\n * @returns {void}\n */\nfunction mark_reactions(signal, status) {\n\tvar reactions = signal.reactions;\n\tif (reactions === null) return;\n\n\tvar runes = is_runes();\n\tvar length = reactions.length;\n\n\tfor (var i = 0; i < length; i++) {\n\t\tvar reaction = reactions[i];\n\t\tvar flags = reaction.f;\n\n\t\t// In legacy mode, skip the current effect to prevent infinite loops\n\t\tif (!runes && reaction === active_effect) continue;\n\n\t\t// Inspect effects need to run immediately, so that the stack trace makes sense\n\t\tif (DEV && (flags & EAGER_EFFECT) !== 0) {\n\t\t\teager_effects.add(reaction);\n\t\t\tcontinue;\n\t\t}\n\n\t\tvar not_dirty = (flags & DIRTY) === 0;\n\n\t\t// don't set a DIRTY reaction to MAYBE_DIRTY\n\t\tif (not_dirty) {\n\t\t\tset_signal_status(reaction, status);\n\t\t}\n\n\t\tif ((flags & DERIVED) !== 0) {\n\t\t\tvar derived = /** @type {Derived} */ (reaction);\n\n\t\t\tbatch_values?.delete(derived);\n\n\t\t\tif ((flags & WAS_MARKED) === 0) {\n\t\t\t\t// Only connected deriveds can be reliably unmarked right away\n\t\t\t\tif (flags & CONNECTED) {\n\t\t\t\t\treaction.f |= WAS_MARKED;\n\t\t\t\t}\n\n\t\t\t\tmark_reactions(derived, MAYBE_DIRTY);\n\t\t\t}\n\t\t} else if (not_dirty) {\n\t\t\tif ((flags & BLOCK_EFFECT) !== 0 && eager_block_effects !== null) {\n\t\t\t\teager_block_effects.add(/** @type {Effect} */ (reaction));\n\t\t\t}\n\n\t\t\tschedule_effect(/** @type {Effect} */ (reaction));\n\t\t}\n\t}\n}\n","/** @import { Source } from '#client' */\nimport { DEV } from 'esm-env';\nimport {\n\tget,\n\tactive_effect,\n\tupdate_version,\n\tactive_reaction,\n\tset_update_version,\n\tset_active_reaction\n} from './runtime.js';\nimport {\n\tarray_prototype,\n\tget_descriptor,\n\tget_prototype_of,\n\tis_array,\n\tobject_prototype\n} from '../shared/utils.js';\nimport {\n\tstate as source,\n\tset,\n\tincrement,\n\tflush_eager_effects,\n\tset_eager_effects_deferred\n} from './reactivity/sources.js';\nimport { PROXY_PATH_SYMBOL, STATE_SYMBOL } from '#client/constants';\nimport { UNINITIALIZED } from '../../constants.js';\nimport * as e from './errors.js';\nimport { tag } from './dev/tracing.js';\nimport { get_error } from '../shared/dev.js';\nimport { tracing_mode_flag } from '../flags/index.js';\n\n// TODO move all regexes into shared module?\nconst regex_is_valid_identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n/**\n * @template T\n * @param {T} value\n * @returns {T}\n */\nexport function proxy(value) {\n\t// if non-proxyable, or is already a proxy, return `value`\n\tif (typeof value !== 'object' || value === null || STATE_SYMBOL in value) {\n\t\treturn value;\n\t}\n\n\tconst prototype = get_prototype_of(value);\n\n\tif (prototype !== object_prototype && prototype !== array_prototype) {\n\t\treturn value;\n\t}\n\n\t/** @type {Map<any, Source<any>>} */\n\tvar sources = new Map();\n\tvar is_proxied_array = is_array(value);\n\tvar version = source(0);\n\n\tvar stack = DEV && tracing_mode_flag ? get_error('created at') : null;\n\tvar parent_version = update_version;\n\n\t/**\n\t * Executes the proxy in the context of the reaction it was originally created in, if any\n\t * @template T\n\t * @param {() => T} fn\n\t */\n\tvar with_parent = (fn) => {\n\t\tif (update_version === parent_version) {\n\t\t\treturn fn();\n\t\t}\n\n\t\t// child source is being created after the initial proxy \n\t\t// prevent it from being associated with the current reaction\n\t\tvar reaction = active_reaction;\n\t\tvar version = update_version;\n\n\t\tset_active_reaction(null);\n\t\tset_update_version(parent_version);\n\n\t\tvar result = fn();\n\n\t\tset_active_reaction(reaction);\n\t\tset_update_version(version);\n\n\t\treturn result;\n\t};\n\n\tif (is_proxied_array) {\n\t\t// We need to create the length source eagerly to ensure that\n\t\t// mutations to the array are properly synced with our proxy\n\t\tsources.set('length', source(/** @type {any[]} */ (value).length, stack));\n\t\tif (DEV) {\n\t\t\tvalue = /** @type {any} */ (inspectable_array(/** @type {any[]} */ (value)));\n\t\t}\n\t}\n\n\t/** Used in dev for $inspect.trace() */\n\tvar path = '';\n\tlet updating = false;\n\t/** @param {string} new_path */\n\tfunction update_path(new_path) {\n\t\tif (updating) return;\n\t\tupdating = true;\n\t\tpath = new_path;\n\n\t\ttag(version, `${path} version`);\n\n\t\t// rename all child sources and child proxies\n\t\tfor (const [prop, source] of sources) {\n\t\t\ttag(source, get_label(path, prop));\n\t\t}\n\t\tupdating = false;\n\t}\n\n\treturn new Proxy(/** @type {any} */ (value), {\n\t\tdefineProperty(_, prop, descriptor) {\n\t\t\tif (\n\t\t\t\t!('value' in descriptor) ||\n\t\t\t\tdescriptor.configurable === false ||\n\t\t\t\tdescriptor.enumerable === false ||\n\t\t\t\tdescriptor.writable === false\n\t\t\t) {\n\t\t\t\t// we disallow non-basic descriptors, because unless they are applied to the\n\t\t\t\t// target object  which we avoid, so that state can be forked  we will run\n\t\t\t\t// afoul of the various invariants\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/getOwnPropertyDescriptor#invariants\n\t\t\t\te.state_descriptors_fixed();\n\t\t\t}\n\t\t\tvar s = sources.get(prop);\n\t\t\tif (s === undefined) {\n\t\t\t\ts = with_parent(() => {\n\t\t\t\t\tvar s = source(descriptor.value, stack);\n\t\t\t\t\tsources.set(prop, s);\n\t\t\t\t\tif (DEV && typeof prop === 'string') {\n\t\t\t\t\t\ttag(s, get_label(path, prop));\n\t\t\t\t\t}\n\t\t\t\t\treturn s;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tset(s, descriptor.value, true);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tdeleteProperty(target, prop) {\n\t\t\tvar s = sources.get(prop);\n\n\t\t\tif (s === undefined) {\n\t\t\t\tif (prop in target) {\n\t\t\t\t\tconst s = with_parent(() => source(UNINITIALIZED, stack));\n\t\t\t\t\tsources.set(prop, s);\n\t\t\t\t\tincrement(version);\n\n\t\t\t\t\tif (DEV) {\n\t\t\t\t\t\ttag(s, get_label(path, prop));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset(s, UNINITIALIZED);\n\t\t\t\tincrement(version);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tget(target, prop, receiver) {\n\t\t\tif (prop === STATE_SYMBOL) {\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tif (DEV && prop === PROXY_PATH_SYMBOL) {\n\t\t\t\treturn update_path;\n\t\t\t}\n\n\t\t\tvar s = sources.get(prop);\n\t\t\tvar exists = prop in target;\n\n\t\t\t// create a source, but only if it's an own property and not a prototype property\n\t\t\tif (s === undefined && (!exists || get_descriptor(target, prop)?.writable)) {\n\t\t\t\ts = with_parent(() => {\n\t\t\t\t\tvar p = proxy(exists ? target[prop] : UNINITIALIZED);\n\t\t\t\t\tvar s = source(p, stack);\n\n\t\t\t\t\tif (DEV) {\n\t\t\t\t\t\ttag(s, get_label(path, prop));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn s;\n\t\t\t\t});\n\n\t\t\t\tsources.set(prop, s);\n\t\t\t}\n\n\t\t\tif (s !== undefined) {\n\t\t\t\tvar v = get(s);\n\t\t\t\treturn v === UNINITIALIZED ? undefined : v;\n\t\t\t}\n\n\t\t\treturn Reflect.get(target, prop, receiver);\n\t\t},\n\n\t\tgetOwnPropertyDescriptor(target, prop) {\n\t\t\tvar descriptor = Reflect.getOwnPropertyDescriptor(target, prop);\n\n\t\t\tif (descriptor && 'value' in descriptor) {\n\t\t\t\tvar s = sources.get(prop);\n\t\t\t\tif (s) descriptor.value = get(s);\n\t\t\t} else if (descriptor === undefined) {\n\t\t\t\tvar source = sources.get(prop);\n\t\t\t\tvar value = source?.v;\n\n\t\t\t\tif (source !== undefined && value !== UNINITIALIZED) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\twritable: true\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn descriptor;\n\t\t},\n\n\t\thas(target, prop) {\n\t\t\tif (prop === STATE_SYMBOL) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar s = sources.get(prop);\n\t\t\tvar has = (s !== undefined && s.v !== UNINITIALIZED) || Reflect.has(target, prop);\n\n\t\t\tif (\n\t\t\t\ts !== undefined ||\n\t\t\t\t(active_effect !== null && (!has || get_descriptor(target, prop)?.writable))\n\t\t\t) {\n\t\t\t\tif (s === undefined) {\n\t\t\t\t\ts = with_parent(() => {\n\t\t\t\t\t\tvar p = has ? proxy(target[prop]) : UNINITIALIZED;\n\t\t\t\t\t\tvar s = source(p, stack);\n\n\t\t\t\t\t\tif (DEV) {\n\t\t\t\t\t\t\ttag(s, get_label(path, prop));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn s;\n\t\t\t\t\t});\n\n\t\t\t\t\tsources.set(prop, s);\n\t\t\t\t}\n\n\t\t\t\tvar value = get(s);\n\t\t\t\tif (value === UNINITIALIZED) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn has;\n\t\t},\n\n\t\tset(target, prop, value, receiver) {\n\t\t\tvar s = sources.get(prop);\n\t\t\tvar has = prop in target;\n\n\t\t\t// variable.length = value -> clear all signals with index >= value\n\t\t\tif (is_proxied_array && prop === 'length') {\n\t\t\t\tfor (var i = value; i < /** @type {Source<number>} */ (s).v; i += 1) {\n\t\t\t\t\tvar other_s = sources.get(i + '');\n\t\t\t\t\tif (other_s !== undefined) {\n\t\t\t\t\t\tset(other_s, UNINITIALIZED);\n\t\t\t\t\t} else if (i in target) {\n\t\t\t\t\t\t// If the item exists in the original, we need to create an uninitialized source,\n\t\t\t\t\t\t// else a later read of the property would result in a source being created with\n\t\t\t\t\t\t// the value of the original item at that index.\n\t\t\t\t\t\tother_s = with_parent(() => source(UNINITIALIZED, stack));\n\t\t\t\t\t\tsources.set(i + '', other_s);\n\n\t\t\t\t\t\tif (DEV) {\n\t\t\t\t\t\t\ttag(other_s, get_label(path, i));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If we haven't yet created a source for this property, we need to ensure\n\t\t\t// we do so otherwise if we read it later, then the write won't be tracked and\n\t\t\t// the heuristics of effects will be different vs if we had read the proxied\n\t\t\t// object property before writing to that property.\n\t\t\tif (s === undefined) {\n\t\t\t\tif (!has || get_descriptor(target, prop)?.writable) {\n\t\t\t\t\ts = with_parent(() => source(undefined, stack));\n\n\t\t\t\t\tif (DEV) {\n\t\t\t\t\t\ttag(s, get_label(path, prop));\n\t\t\t\t\t}\n\t\t\t\t\tset(s, proxy(value));\n\n\t\t\t\t\tsources.set(prop, s);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\thas = s.v !== UNINITIALIZED;\n\n\t\t\t\tvar p = with_parent(() => proxy(value));\n\t\t\t\tset(s, p);\n\t\t\t}\n\n\t\t\tvar descriptor = Reflect.getOwnPropertyDescriptor(target, prop);\n\n\t\t\t// Set the new value before updating any signals so that any listeners get the new value\n\t\t\tif (descriptor?.set) {\n\t\t\t\tdescriptor.set.call(receiver, value);\n\t\t\t}\n\n\t\t\tif (!has) {\n\t\t\t\t// If we have mutated an array directly, we might need to\n\t\t\t\t// signal that length has also changed. Do it before updating metadata\n\t\t\t\t// to ensure that iterating over the array as a result of a metadata update\n\t\t\t\t// will not cause the length to be out of sync.\n\t\t\t\tif (is_proxied_array && typeof prop === 'string') {\n\t\t\t\t\tvar ls = /** @type {Source<number>} */ (sources.get('length'));\n\t\t\t\t\tvar n = Number(prop);\n\n\t\t\t\t\tif (Number.isInteger(n) && n >= ls.v) {\n\t\t\t\t\t\tset(ls, n + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tincrement(version);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\townKeys(target) {\n\t\t\tget(version);\n\n\t\t\tvar own_keys = Reflect.ownKeys(target).filter((key) => {\n\t\t\t\tvar source = sources.get(key);\n\t\t\t\treturn source === undefined || source.v !== UNINITIALIZED;\n\t\t\t});\n\n\t\t\tfor (var [key, source] of sources) {\n\t\t\t\tif (source.v !== UNINITIALIZED && !(key in target)) {\n\t\t\t\t\town_keys.push(key);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn own_keys;\n\t\t},\n\n\t\tsetPrototypeOf() {\n\t\t\te.state_prototype_fixed();\n\t\t}\n\t});\n}\n\n/**\n * @param {string} path\n * @param {string | symbol} prop\n */\nfunction get_label(path, prop) {\n\tif (typeof prop === 'symbol') return `${path}[Symbol(${prop.description ?? ''})]`;\n\tif (regex_is_valid_identifier.test(prop)) return `${path}.${prop}`;\n\treturn /^\\d+$/.test(prop) ? `${path}[${prop}]` : `${path}['${prop}']`;\n}\n\n/**\n * @param {any} value\n */\nexport function get_proxied_value(value) {\n\ttry {\n\t\tif (value !== null && typeof value === 'object' && STATE_SYMBOL in value) {\n\t\t\treturn value[STATE_SYMBOL];\n\t\t}\n\t} catch {\n\t\t// the above if check can throw an error if the value in question\n\t\t// is the contentWindow of an iframe on another domain, in which\n\t\t// case we want to just return the value (because it's definitely\n\t\t// not a proxied value) so we don't break any JavaScript interacting\n\t\t// with that iframe (such as various payment companies client side\n\t\t// JavaScript libraries interacting with their iframes on the same\n\t\t// domain)\n\t}\n\n\treturn value;\n}\n\n/**\n * @param {any} a\n * @param {any} b\n */\nexport function is(a, b) {\n\treturn Object.is(get_proxied_value(a), get_proxied_value(b));\n}\n\nconst ARRAY_MUTATING_METHODS = new Set([\n\t'copyWithin',\n\t'fill',\n\t'pop',\n\t'push',\n\t'reverse',\n\t'shift',\n\t'sort',\n\t'splice',\n\t'unshift'\n]);\n\n/**\n * Wrap array mutating methods so $inspect is triggered only once and\n * to prevent logging an array in intermediate state (e.g. with an empty slot)\n * @param {any[]} array\n */\nfunction inspectable_array(array) {\n\treturn new Proxy(array, {\n\t\tget(target, prop, receiver) {\n\t\t\tvar value = Reflect.get(target, prop, receiver);\n\t\t\tif (!ARRAY_MUTATING_METHODS.has(/** @type {string} */ (prop))) {\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * @this {any[]}\n\t\t\t * @param {any[]} args\n\t\t\t */\n\t\t\treturn function (...args) {\n\t\t\t\tset_eager_effects_deferred();\n\t\t\t\tvar result = value.apply(this, args);\n\t\t\t\tflush_eager_effects();\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\t});\n}\n","/** @import { Effect, TemplateNode } from '#client' */\nimport { hydrate_node, hydrating, set_hydrate_node } from './hydration.js';\nimport { DEV } from 'esm-env';\nimport { init_array_prototype_warnings } from '../dev/equality.js';\nimport { get_descriptor, is_extensible } from '../../shared/utils.js';\nimport { active_effect } from '../runtime.js';\nimport { async_mode_flag } from '../../flags/index.js';\nimport { TEXT_NODE, EFFECT_RAN } from '#client/constants';\nimport { eager_block_effects } from '../reactivity/batch.js';\n\n// export these for reference in the compiled code, making global name deduplication unnecessary\n/** @type {Window} */\nexport var $window;\n\n/** @type {Document} */\nexport var $document;\n\n/** @type {boolean} */\nexport var is_firefox;\n\n/** @type {() => Node | null} */\nvar first_child_getter;\n/** @type {() => Node | null} */\nvar next_sibling_getter;\n\n/**\n * Initialize these lazily to avoid issues when using the runtime in a server context\n * where these globals are not available while avoiding a separate server entry point\n */\nexport function init_operations() {\n\tif ($window !== undefined) {\n\t\treturn;\n\t}\n\n\t$window = window;\n\t$document = document;\n\tis_firefox = /Firefox/.test(navigator.userAgent);\n\n\tvar element_prototype = Element.prototype;\n\tvar node_prototype = Node.prototype;\n\tvar text_prototype = Text.prototype;\n\n\t// @ts-ignore\n\tfirst_child_getter = get_descriptor(node_prototype, 'firstChild').get;\n\t// @ts-ignore\n\tnext_sibling_getter = get_descriptor(node_prototype, 'nextSibling').get;\n\n\tif (is_extensible(element_prototype)) {\n\t\t// the following assignments improve perf of lookups on DOM nodes\n\t\t// @ts-expect-error\n\t\telement_prototype.__click = undefined;\n\t\t// @ts-expect-error\n\t\telement_prototype.__className = undefined;\n\t\t// @ts-expect-error\n\t\telement_prototype.__attributes = null;\n\t\t// @ts-expect-error\n\t\telement_prototype.__style = undefined;\n\t\t// @ts-expect-error\n\t\telement_prototype.__e = undefined;\n\t}\n\n\tif (is_extensible(text_prototype)) {\n\t\t// @ts-expect-error\n\t\ttext_prototype.__t = undefined;\n\t}\n\n\tif (DEV) {\n\t\t// @ts-expect-error\n\t\telement_prototype.__svelte_meta = null;\n\n\t\tinit_array_prototype_warnings();\n\t}\n}\n\n/**\n * @param {string} value\n * @returns {Text}\n */\nexport function create_text(value = '') {\n\treturn document.createTextNode(value);\n}\n\n/**\n * @template {Node} N\n * @param {N} node\n */\n/*@__NO_SIDE_EFFECTS__*/\nexport function get_first_child(node) {\n\treturn /** @type {TemplateNode | null} */ (first_child_getter.call(node));\n}\n\n/**\n * @template {Node} N\n * @param {N} node\n */\n/*@__NO_SIDE_EFFECTS__*/\nexport function get_next_sibling(node) {\n\treturn /** @type {TemplateNode | null} */ (next_sibling_getter.call(node));\n}\n\n/**\n * Don't mark this as side-effect-free, hydration needs to walk all nodes\n * @template {Node} N\n * @param {N} node\n * @param {boolean} is_text\n * @returns {TemplateNode | null}\n */\nexport function child(node, is_text) {\n\tif (!hydrating) {\n\t\treturn get_first_child(node);\n\t}\n\n\tvar child = get_first_child(hydrate_node);\n\n\t// Child can be null if we have an element with a single child, like `<p>{text}</p>`, where `text` is empty\n\tif (child === null) {\n\t\tchild = hydrate_node.appendChild(create_text());\n\t} else if (is_text && child.nodeType !== TEXT_NODE) {\n\t\tvar text = create_text();\n\t\tchild?.before(text);\n\t\tset_hydrate_node(text);\n\t\treturn text;\n\t}\n\n\tset_hydrate_node(child);\n\treturn child;\n}\n\n/**\n * Don't mark this as side-effect-free, hydration needs to walk all nodes\n * @param {TemplateNode} node\n * @param {boolean} [is_text]\n * @returns {TemplateNode | null}\n */\nexport function first_child(node, is_text = false) {\n\tif (!hydrating) {\n\t\tvar first = get_first_child(node);\n\n\t\t// TODO prevent user comments with the empty string when preserveComments is true\n\t\tif (first instanceof Comment && first.data === '') return get_next_sibling(first);\n\n\t\treturn first;\n\t}\n\n\t// if an {expression} is empty during SSR, there might be no\n\t// text node to hydrate  we must therefore create one\n\tif (is_text && hydrate_node?.nodeType !== TEXT_NODE) {\n\t\tvar text = create_text();\n\n\t\thydrate_node?.before(text);\n\t\tset_hydrate_node(text);\n\t\treturn text;\n\t}\n\n\treturn hydrate_node;\n}\n\n/**\n * Don't mark this as side-effect-free, hydration needs to walk all nodes\n * @param {TemplateNode} node\n * @param {number} count\n * @param {boolean} is_text\n * @returns {TemplateNode | null}\n */\nexport function sibling(node, count = 1, is_text = false) {\n\tlet next_sibling = hydrating ? hydrate_node : node;\n\tvar last_sibling;\n\n\twhile (count--) {\n\t\tlast_sibling = next_sibling;\n\t\tnext_sibling = /** @type {TemplateNode} */ (get_next_sibling(next_sibling));\n\t}\n\n\tif (!hydrating) {\n\t\treturn next_sibling;\n\t}\n\n\t// if a sibling {expression} is empty during SSR, there might be no\n\t// text node to hydrate  we must therefore create one\n\tif (is_text && next_sibling?.nodeType !== TEXT_NODE) {\n\t\tvar text = create_text();\n\t\t// If the next sibling is `null` and we're handling text then it's because\n\t\t// the SSR content was empty for the text, so we need to generate a new text\n\t\t// node and insert it after the last sibling\n\t\tif (next_sibling === null) {\n\t\t\tlast_sibling?.after(text);\n\t\t} else {\n\t\t\tnext_sibling.before(text);\n\t\t}\n\t\tset_hydrate_node(text);\n\t\treturn text;\n\t}\n\n\tset_hydrate_node(next_sibling);\n\treturn next_sibling;\n}\n\n/**\n * @template {Node} N\n * @param {N} node\n * @returns {void}\n */\nexport function clear_text_content(node) {\n\tnode.textContent = '';\n}\n\n/**\n * Returns `true` if we're updating the current block, for example `condition` in\n * an `{#if condition}` block just changed. In this case, the branch should be\n * appended (or removed) at the same time as other updates within the\n * current `<svelte:boundary>`\n */\nexport function should_defer_append() {\n\tif (!async_mode_flag) return false;\n\tif (eager_block_effects !== null) return false;\n\n\tvar flags = /** @type {Effect} */ (active_effect).f;\n\treturn (flags & EFFECT_RAN) !== 0;\n}\n\n/**\n *\n * @param {string} tag\n * @param {string} [namespace]\n * @param {string} [is]\n * @returns\n */\nexport function create_element(tag, namespace, is) {\n\tlet options = is ? { is } : undefined;\n\tif (namespace) {\n\t\treturn document.createElementNS(namespace, tag, options);\n\t}\n\treturn document.createElement(tag, options);\n}\n\nexport function create_fragment() {\n\treturn document.createDocumentFragment();\n}\n\n/**\n * @param {string} data\n * @returns\n */\nexport function create_comment(data = '') {\n\treturn document.createComment(data);\n}\n\n/**\n * @param {Element} element\n * @param {string} key\n * @param {string} value\n * @returns\n */\nexport function set_attribute(element, key, value = '') {\n\tif (key.startsWith('xlink:')) {\n\t\telement.setAttributeNS('http://www.w3.org/1999/xlink', key, value);\n\t\treturn;\n\t}\n\treturn element.setAttribute(key, value);\n}\n","import { hydrating } from '../hydration.js';\nimport { clear_text_content, get_first_child } from '../operations.js';\nimport { queue_micro_task } from '../task.js';\n\n/**\n * @param {HTMLElement} dom\n * @param {boolean} value\n * @returns {void}\n */\nexport function autofocus(dom, value) {\n\tif (value) {\n\t\tconst body = document.body;\n\t\tdom.autofocus = true;\n\n\t\tqueue_micro_task(() => {\n\t\t\tif (document.activeElement === body) {\n\t\t\t\tdom.focus();\n\t\t\t}\n\t\t});\n\t}\n}\n\n/**\n * The child of a textarea actually corresponds to the defaultValue property, so we need\n * to remove it upon hydration to avoid a bug when someone resets the form value.\n * @param {HTMLTextAreaElement} dom\n * @returns {void}\n */\nexport function remove_textarea_child(dom) {\n\tif (hydrating && get_first_child(dom) !== null) {\n\t\tclear_text_content(dom);\n\t}\n}\n\nlet listening_to_form_reset = false;\n\nexport function add_form_reset_listener() {\n\tif (!listening_to_form_reset) {\n\t\tlistening_to_form_reset = true;\n\t\tdocument.addEventListener(\n\t\t\t'reset',\n\t\t\t(evt) => {\n\t\t\t\t// Needs to happen one tick later or else the dom properties of the form\n\t\t\t\t// elements have not updated to their reset values yet\n\t\t\t\tPromise.resolve().then(() => {\n\t\t\t\t\tif (!evt.defaultPrevented) {\n\t\t\t\t\t\tfor (const e of /**@type {HTMLFormElement} */ (evt.target).elements) {\n\t\t\t\t\t\t\t// @ts-expect-error\n\t\t\t\t\t\t\te.__on_r?.();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t// In the capture phase to guarantee we get noticed of it (no possibility of stopPropagation)\n\t\t\t{ capture: true }\n\t\t);\n\t}\n}\n","import { teardown } from '../../../reactivity/effects.js';\nimport {\n\tactive_effect,\n\tactive_reaction,\n\tset_active_effect,\n\tset_active_reaction\n} from '../../../runtime.js';\nimport { add_form_reset_listener } from '../misc.js';\n\n/**\n * Fires the handler once immediately (unless corresponding arg is set to `false`),\n * then listens to the given events until the render effect context is destroyed\n * @param {EventTarget} target\n * @param {Array<string>} events\n * @param {(event?: Event) => void} handler\n * @param {any} call_handler_immediately\n */\nexport function listen(target, events, handler, call_handler_immediately = true) {\n\tif (call_handler_immediately) {\n\t\thandler();\n\t}\n\n\tfor (var name of events) {\n\t\ttarget.addEventListener(name, handler);\n\t}\n\n\tteardown(() => {\n\t\tfor (var name of events) {\n\t\t\ttarget.removeEventListener(name, handler);\n\t\t}\n\t});\n}\n\n/**\n * @template T\n * @param {() => T} fn\n */\nexport function without_reactive_context(fn) {\n\tvar previous_reaction = active_reaction;\n\tvar previous_effect = active_effect;\n\tset_active_reaction(null);\n\tset_active_effect(null);\n\ttry {\n\t\treturn fn();\n\t} finally {\n\t\tset_active_reaction(previous_reaction);\n\t\tset_active_effect(previous_effect);\n\t}\n}\n\n/**\n * Listen to the given event, and then instantiate a global form reset listener if not already done,\n * to notify all bindings when the form is reset\n * @param {HTMLElement} element\n * @param {string} event\n * @param {(is_reset?: true) => void} handler\n * @param {(is_reset?: true) => void} [on_reset]\n */\nexport function listen_to_event_and_reset_event(element, event, handler, on_reset = handler) {\n\telement.addEventListener(event, () => without_reactive_context(handler));\n\t// @ts-expect-error\n\tconst prev = element.__on_r;\n\tif (prev) {\n\t\t// special case for checkbox that can have multiple binds (group & checked)\n\t\t// @ts-expect-error\n\t\telement.__on_r = () => {\n\t\t\tprev();\n\t\t\ton_reset(true);\n\t\t};\n\t} else {\n\t\t// @ts-expect-error\n\t\telement.__on_r = () => on_reset(true);\n\t}\n\n\tadd_form_reset_listener();\n}\n","/** @import { ComponentContext, ComponentContextLegacy, Derived, Effect, TemplateNode, TransitionManager } from '#client' */\nimport {\n\tis_dirty,\n\tactive_effect,\n\tactive_reaction,\n\tupdate_effect,\n\tget,\n\tis_destroying_effect,\n\tremove_reactions,\n\tset_active_reaction,\n\tset_is_destroying_effect,\n\tset_signal_status,\n\tuntrack,\n\tuntracking\n} from '../runtime.js';\nimport {\n\tDIRTY,\n\tBRANCH_EFFECT,\n\tRENDER_EFFECT,\n\tEFFECT,\n\tDESTROYED,\n\tINERT,\n\tEFFECT_RAN,\n\tBLOCK_EFFECT,\n\tROOT_EFFECT,\n\tEFFECT_TRANSPARENT,\n\tDERIVED,\n\tCLEAN,\n\tEAGER_EFFECT,\n\tHEAD_EFFECT,\n\tMAYBE_DIRTY,\n\tEFFECT_PRESERVED,\n\tSTALE_REACTION,\n\tUSER_EFFECT,\n\tASYNC,\n\tCONNECTED,\n\tMANAGED_EFFECT\n} from '#client/constants';\nimport * as e from '../errors.js';\nimport { DEV } from 'esm-env';\nimport { define_property } from '../../shared/utils.js';\nimport { get_next_sibling } from '../dom/operations.js';\nimport { component_context, dev_current_component_function, dev_stack } from '../context.js';\nimport { Batch, current_batch, schedule_effect } from './batch.js';\nimport { flatten } from './async.js';\nimport { without_reactive_context } from '../dom/elements/bindings/shared.js';\n\n/**\n * @param {'$effect' | '$effect.pre' | '$inspect'} rune\n */\nexport function validate_effect(rune) {\n\tif (active_effect === null) {\n\t\tif (active_reaction === null) {\n\t\t\te.effect_orphan(rune);\n\t\t}\n\n\t\te.effect_in_unowned_derived();\n\t}\n\n\tif (is_destroying_effect) {\n\t\te.effect_in_teardown(rune);\n\t}\n}\n\n/**\n * @param {Effect} effect\n * @param {Effect} parent_effect\n */\nfunction push_effect(effect, parent_effect) {\n\tvar parent_last = parent_effect.last;\n\tif (parent_last === null) {\n\t\tparent_effect.last = parent_effect.first = effect;\n\t} else {\n\t\tparent_last.next = effect;\n\t\teffect.prev = parent_last;\n\t\tparent_effect.last = effect;\n\t}\n}\n\n/**\n * @param {number} type\n * @param {null | (() => void | (() => void))} fn\n * @param {boolean} sync\n * @returns {Effect}\n */\nfunction create_effect(type, fn, sync) {\n\tvar parent = active_effect;\n\n\tif (DEV) {\n\t\t// Ensure the parent is never an inspect effect\n\t\twhile (parent !== null && (parent.f & EAGER_EFFECT) !== 0) {\n\t\t\tparent = parent.parent;\n\t\t}\n\t}\n\n\tif (parent !== null && (parent.f & INERT) !== 0) {\n\t\ttype |= INERT;\n\t}\n\n\t/** @type {Effect} */\n\tvar effect = {\n\t\tctx: component_context,\n\t\tdeps: null,\n\t\tnodes: null,\n\t\tf: type | DIRTY | CONNECTED,\n\t\tfirst: null,\n\t\tfn,\n\t\tlast: null,\n\t\tnext: null,\n\t\tparent,\n\t\tb: parent && parent.b,\n\t\tprev: null,\n\t\tteardown: null,\n\t\twv: 0,\n\t\tac: null\n\t};\n\n\tif (DEV) {\n\t\teffect.component_function = dev_current_component_function;\n\t}\n\n\tif (sync) {\n\t\ttry {\n\t\t\tupdate_effect(effect);\n\t\t\teffect.f |= EFFECT_RAN;\n\t\t} catch (e) {\n\t\t\tdestroy_effect(effect);\n\t\t\tthrow e;\n\t\t}\n\t} else if (fn !== null) {\n\t\tschedule_effect(effect);\n\t}\n\n\t/** @type {Effect | null} */\n\tvar e = effect;\n\n\t// if an effect has already ran and doesn't need to be kept in the tree\n\t// (because it won't re-run, has no DOM, and has no teardown etc)\n\t// then we skip it and go to its child (if any)\n\tif (\n\t\tsync &&\n\t\te.deps === null &&\n\t\te.teardown === null &&\n\t\te.nodes === null &&\n\t\te.first === e.last && // either `null`, or a singular child\n\t\t(e.f & EFFECT_PRESERVED) === 0\n\t) {\n\t\te = e.first;\n\t\tif ((type & BLOCK_EFFECT) !== 0 && (type & EFFECT_TRANSPARENT) !== 0 && e !== null) {\n\t\t\te.f |= EFFECT_TRANSPARENT;\n\t\t}\n\t}\n\n\tif (e !== null) {\n\t\te.parent = parent;\n\n\t\tif (parent !== null) {\n\t\t\tpush_effect(e, parent);\n\t\t}\n\n\t\t// if we're in a derived, add the effect there too\n\t\tif (\n\t\t\tactive_reaction !== null &&\n\t\t\t(active_reaction.f & DERIVED) !== 0 &&\n\t\t\t(type & ROOT_EFFECT) === 0\n\t\t) {\n\t\t\tvar derived = /** @type {Derived} */ (active_reaction);\n\t\t\t(derived.effects ??= []).push(e);\n\t\t}\n\t}\n\n\treturn effect;\n}\n\n/**\n * Internal representation of `$effect.tracking()`\n * @returns {boolean}\n */\nexport function effect_tracking() {\n\treturn active_reaction !== null && !untracking;\n}\n\n/**\n * @param {() => void} fn\n */\nexport function teardown(fn) {\n\tconst effect = create_effect(RENDER_EFFECT, null, false);\n\tset_signal_status(effect, CLEAN);\n\teffect.teardown = fn;\n\treturn effect;\n}\n\n/**\n * Internal representation of `$effect(...)`\n * @param {() => void | (() => void)} fn\n */\nexport function user_effect(fn) {\n\tvalidate_effect('$effect');\n\n\tif (DEV) {\n\t\tdefine_property(fn, 'name', {\n\t\t\tvalue: '$effect'\n\t\t});\n\t}\n\n\t// Non-nested `$effect(...)` in a component should be deferred\n\t// until the component is mounted\n\tvar flags = /** @type {Effect} */ (active_effect).f;\n\tvar defer = !active_reaction && (flags & BRANCH_EFFECT) !== 0 && (flags & EFFECT_RAN) === 0;\n\n\tif (defer) {\n\t\t// Top-level `$effect(...)` in an unmounted component  defer until mount\n\t\tvar context = /** @type {ComponentContext} */ (component_context);\n\t\t(context.e ??= []).push(fn);\n\t} else {\n\t\t// Everything else  create immediately\n\t\treturn create_user_effect(fn);\n\t}\n}\n\n/**\n * @param {() => void | (() => void)} fn\n */\nexport function create_user_effect(fn) {\n\treturn create_effect(EFFECT | USER_EFFECT, fn, false);\n}\n\n/**\n * Internal representation of `$effect.pre(...)`\n * @param {() => void | (() => void)} fn\n * @returns {Effect}\n */\nexport function user_pre_effect(fn) {\n\tvalidate_effect('$effect.pre');\n\tif (DEV) {\n\t\tdefine_property(fn, 'name', {\n\t\t\tvalue: '$effect.pre'\n\t\t});\n\t}\n\treturn create_effect(RENDER_EFFECT | USER_EFFECT, fn, true);\n}\n\n/** @param {() => void | (() => void)} fn */\nexport function eager_effect(fn) {\n\treturn create_effect(EAGER_EFFECT, fn, true);\n}\n\n/**\n * Internal representation of `$effect.root(...)`\n * @param {() => void | (() => void)} fn\n * @returns {() => void}\n */\nexport function effect_root(fn) {\n\tBatch.ensure();\n\tconst effect = create_effect(ROOT_EFFECT | EFFECT_PRESERVED, fn, true);\n\n\treturn () => {\n\t\tdestroy_effect(effect);\n\t};\n}\n\n/**\n * An effect root whose children can transition out\n * @param {() => void} fn\n * @returns {(options?: { outro?: boolean }) => Promise<void>}\n */\nexport function component_root(fn) {\n\tBatch.ensure();\n\tconst effect = create_effect(ROOT_EFFECT | EFFECT_PRESERVED, fn, true);\n\n\treturn (options = {}) => {\n\t\treturn new Promise((fulfil) => {\n\t\t\tif (options.outro) {\n\t\t\t\tpause_effect(effect, () => {\n\t\t\t\t\tdestroy_effect(effect);\n\t\t\t\t\tfulfil(undefined);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tdestroy_effect(effect);\n\t\t\t\tfulfil(undefined);\n\t\t\t}\n\t\t});\n\t};\n}\n\n/**\n * @param {() => void | (() => void)} fn\n * @returns {Effect}\n */\nexport function effect(fn) {\n\treturn create_effect(EFFECT, fn, false);\n}\n\n/**\n * Internal representation of `$: ..`\n * @param {() => any} deps\n * @param {() => void | (() => void)} fn\n */\nexport function legacy_pre_effect(deps, fn) {\n\tvar context = /** @type {ComponentContextLegacy} */ (component_context);\n\n\t/** @type {{ effect: null | Effect, ran: boolean, deps: () => any }} */\n\tvar token = { effect: null, ran: false, deps };\n\n\tcontext.l.$.push(token);\n\n\ttoken.effect = render_effect(() => {\n\t\tdeps();\n\n\t\t// If this legacy pre effect has already run before the end of the reset, then\n\t\t// bail out to emulate the same behavior.\n\t\tif (token.ran) return;\n\n\t\ttoken.ran = true;\n\t\tuntrack(fn);\n\t});\n}\n\nexport function legacy_pre_effect_reset() {\n\tvar context = /** @type {ComponentContextLegacy} */ (component_context);\n\n\trender_effect(() => {\n\t\t// Run dirty `$:` statements\n\t\tfor (var token of context.l.$) {\n\t\t\ttoken.deps();\n\n\t\t\tvar effect = token.effect;\n\n\t\t\t// If the effect is CLEAN, then make it MAYBE_DIRTY. This ensures we traverse through\n\t\t\t// the effects dependencies and correctly ensure each dependency is up-to-date.\n\t\t\tif ((effect.f & CLEAN) !== 0) {\n\t\t\t\tset_signal_status(effect, MAYBE_DIRTY);\n\t\t\t}\n\n\t\t\tif (is_dirty(effect)) {\n\t\t\t\tupdate_effect(effect);\n\t\t\t}\n\n\t\t\ttoken.ran = false;\n\t\t}\n\t});\n}\n\n/**\n * @param {() => void | (() => void)} fn\n * @returns {Effect}\n */\nexport function async_effect(fn) {\n\treturn create_effect(ASYNC | EFFECT_PRESERVED, fn, true);\n}\n\n/**\n * @param {() => void | (() => void)} fn\n * @returns {Effect}\n */\nexport function render_effect(fn, flags = 0) {\n\treturn create_effect(RENDER_EFFECT | flags, fn, true);\n}\n\n/**\n * @param {(...expressions: any) => void | (() => void)} fn\n * @param {Array<() => any>} sync\n * @param {Array<() => Promise<any>>} async\n * @param {Array<Promise<void>>} blockers\n */\nexport function template_effect(fn, sync = [], async = [], blockers = []) {\n\tflatten(blockers, sync, async, (values) => {\n\t\tcreate_effect(RENDER_EFFECT, () => fn(...values.map(get)), true);\n\t});\n}\n\n/**\n * Like `template_effect`, but with an effect which is deferred until the batch commits\n * @param {(...expressions: any) => void | (() => void)} fn\n * @param {Array<() => any>} sync\n * @param {Array<() => Promise<any>>} async\n * @param {Array<Promise<void>>} blockers\n */\nexport function deferred_template_effect(fn, sync = [], async = [], blockers = []) {\n\tvar batch = /** @type {Batch} */ (current_batch);\n\tvar is_async = async.length > 0 || blockers.length > 0;\n\n\tif (is_async) batch.increment(true);\n\n\tflatten(blockers, sync, async, (values) => {\n\t\tcreate_effect(EFFECT, () => fn(...values.map(get)), false);\n\t\tif (is_async) batch.decrement(true);\n\t});\n}\n\n/**\n * @param {(() => void)} fn\n * @param {number} flags\n */\nexport function block(fn, flags = 0) {\n\tvar effect = create_effect(BLOCK_EFFECT | flags, fn, true);\n\tif (DEV) {\n\t\teffect.dev_stack = dev_stack;\n\t}\n\treturn effect;\n}\n\n/**\n * @param {(() => void)} fn\n * @param {number} flags\n */\nexport function managed(fn, flags = 0) {\n\tvar effect = create_effect(MANAGED_EFFECT | flags, fn, true);\n\tif (DEV) {\n\t\teffect.dev_stack = dev_stack;\n\t}\n\treturn effect;\n}\n\n/**\n * @param {(() => void)} fn\n */\nexport function branch(fn) {\n\treturn create_effect(BRANCH_EFFECT | EFFECT_PRESERVED, fn, true);\n}\n\n/**\n * @param {Effect} effect\n */\nexport function execute_effect_teardown(effect) {\n\tvar teardown = effect.teardown;\n\tif (teardown !== null) {\n\t\tconst previously_destroying_effect = is_destroying_effect;\n\t\tconst previous_reaction = active_reaction;\n\t\tset_is_destroying_effect(true);\n\t\tset_active_reaction(null);\n\t\ttry {\n\t\t\tteardown.call(null);\n\t\t} finally {\n\t\t\tset_is_destroying_effect(previously_destroying_effect);\n\t\t\tset_active_reaction(previous_reaction);\n\t\t}\n\t}\n}\n\n/**\n * @param {Effect} signal\n * @param {boolean} remove_dom\n * @returns {void}\n */\nexport function destroy_effect_children(signal, remove_dom = false) {\n\tvar effect = signal.first;\n\tsignal.first = signal.last = null;\n\n\twhile (effect !== null) {\n\t\tconst controller = effect.ac;\n\n\t\tif (controller !== null) {\n\t\t\twithout_reactive_context(() => {\n\t\t\t\tcontroller.abort(STALE_REACTION);\n\t\t\t});\n\t\t}\n\n\t\tvar next = effect.next;\n\n\t\tif ((effect.f & ROOT_EFFECT) !== 0) {\n\t\t\t// this is now an independent root\n\t\t\teffect.parent = null;\n\t\t} else {\n\t\t\tdestroy_effect(effect, remove_dom);\n\t\t}\n\n\t\teffect = next;\n\t}\n}\n\n/**\n * @param {Effect} signal\n * @returns {void}\n */\nexport function destroy_block_effect_children(signal) {\n\tvar effect = signal.first;\n\n\twhile (effect !== null) {\n\t\tvar next = effect.next;\n\t\tif ((effect.f & BRANCH_EFFECT) === 0) {\n\t\t\tdestroy_effect(effect);\n\t\t}\n\t\teffect = next;\n\t}\n}\n\n/**\n * @param {Effect} effect\n * @param {boolean} [remove_dom]\n * @returns {void}\n */\nexport function destroy_effect(effect, remove_dom = true) {\n\tvar removed = false;\n\n\tif (\n\t\t(remove_dom || (effect.f & HEAD_EFFECT) !== 0) &&\n\t\teffect.nodes !== null &&\n\t\teffect.nodes.end !== null\n\t) {\n\t\tremove_effect_dom(effect.nodes.start, /** @type {TemplateNode} */ (effect.nodes.end));\n\t\tremoved = true;\n\t}\n\n\tdestroy_effect_children(effect, remove_dom && !removed);\n\tremove_reactions(effect, 0);\n\tset_signal_status(effect, DESTROYED);\n\n\tvar transitions = effect.nodes && effect.nodes.t;\n\n\tif (transitions !== null) {\n\t\tfor (const transition of transitions) {\n\t\t\ttransition.stop();\n\t\t}\n\t}\n\n\texecute_effect_teardown(effect);\n\n\tvar parent = effect.parent;\n\n\t// If the parent doesn't have any children, then skip this work altogether\n\tif (parent !== null && parent.first !== null) {\n\t\tunlink_effect(effect);\n\t}\n\n\tif (DEV) {\n\t\teffect.component_function = null;\n\t}\n\n\t// `first` and `child` are nulled out in destroy_effect_children\n\t// we don't null out `parent` so that error propagation can work correctly\n\teffect.next =\n\t\teffect.prev =\n\t\teffect.teardown =\n\t\teffect.ctx =\n\t\teffect.deps =\n\t\teffect.fn =\n\t\teffect.nodes =\n\t\teffect.ac =\n\t\t\tnull;\n}\n\n/**\n *\n * @param {TemplateNode | null} node\n * @param {TemplateNode} end\n */\nexport function remove_effect_dom(node, end) {\n\twhile (node !== null) {\n\t\t/** @type {TemplateNode | null} */\n\t\tvar next = node === end ? null : get_next_sibling(node);\n\n\t\tnode.remove();\n\t\tnode = next;\n\t}\n}\n\n/**\n * Detach an effect from the effect tree, freeing up memory and\n * reducing the amount of work that happens on subsequent traversals\n * @param {Effect} effect\n */\nexport function unlink_effect(effect) {\n\tvar parent = effect.parent;\n\tvar prev = effect.prev;\n\tvar next = effect.next;\n\n\tif (prev !== null) prev.next = next;\n\tif (next !== null) next.prev = prev;\n\n\tif (parent !== null) {\n\t\tif (parent.first === effect) parent.first = next;\n\t\tif (parent.last === effect) parent.last = prev;\n\t}\n}\n\n/**\n * When a block effect is removed, we don't immediately destroy it or yank it\n * out of the DOM, because it might have transitions. Instead, we 'pause' it.\n * It stays around (in memory, and in the DOM) until outro transitions have\n * completed, and if the state change is reversed then we _resume_ it.\n * A paused effect does not update, and the DOM subtree becomes inert.\n * @param {Effect} effect\n * @param {() => void} [callback]\n * @param {boolean} [destroy]\n */\nexport function pause_effect(effect, callback, destroy = true) {\n\t/** @type {TransitionManager[]} */\n\tvar transitions = [];\n\n\tpause_children(effect, transitions, true);\n\n\tvar fn = () => {\n\t\tif (destroy) destroy_effect(effect);\n\t\tif (callback) callback();\n\t};\n\n\tvar remaining = transitions.length;\n\tif (remaining > 0) {\n\t\tvar check = () => --remaining || fn();\n\t\tfor (var transition of transitions) {\n\t\t\ttransition.out(check);\n\t\t}\n\t} else {\n\t\tfn();\n\t}\n}\n\n/**\n * @param {Effect} effect\n * @param {TransitionManager[]} transitions\n * @param {boolean} local\n */\nfunction pause_children(effect, transitions, local) {\n\tif ((effect.f & INERT) !== 0) return;\n\teffect.f ^= INERT;\n\n\tvar t = effect.nodes && effect.nodes.t;\n\n\tif (t !== null) {\n\t\tfor (const transition of t) {\n\t\t\tif (transition.is_global || local) {\n\t\t\t\ttransitions.push(transition);\n\t\t\t}\n\t\t}\n\t}\n\n\tvar child = effect.first;\n\n\twhile (child !== null) {\n\t\tvar sibling = child.next;\n\t\tvar transparent =\n\t\t\t(child.f & EFFECT_TRANSPARENT) !== 0 ||\n\t\t\t// If this is a branch effect without a block effect parent,\n\t\t\t// it means the parent block effect was pruned. In that case,\n\t\t\t// transparency information was transferred to the branch effect.\n\t\t\t((child.f & BRANCH_EFFECT) !== 0 && (effect.f & BLOCK_EFFECT) !== 0);\n\t\t// TODO we don't need to call pause_children recursively with a linked list in place\n\t\t// it's slightly more involved though as we have to account for `transparent` changing\n\t\t// through the tree.\n\t\tpause_children(child, transitions, transparent ? local : false);\n\t\tchild = sibling;\n\t}\n}\n\n/**\n * The opposite of `pause_effect`. We call this if (for example)\n * `x` becomes falsy then truthy: `{#if x}...{/if}`\n * @param {Effect} effect\n */\nexport function resume_effect(effect) {\n\tresume_children(effect, true);\n}\n\n/**\n * @param {Effect} effect\n * @param {boolean} local\n */\nfunction resume_children(effect, local) {\n\tif ((effect.f & INERT) === 0) return;\n\teffect.f ^= INERT;\n\n\t// If a dependency of this effect changed while it was paused,\n\t// schedule the effect to update. we don't use `is_dirty`\n\t// here because we don't want to eagerly recompute a derived like\n\t// `{#if foo}{foo.bar()}{/if}` if `foo` is now `undefined\n\tif ((effect.f & CLEAN) === 0) {\n\t\tset_signal_status(effect, DIRTY);\n\t\tschedule_effect(effect);\n\t}\n\n\tvar child = effect.first;\n\n\twhile (child !== null) {\n\t\tvar sibling = child.next;\n\t\tvar transparent = (child.f & EFFECT_TRANSPARENT) !== 0 || (child.f & BRANCH_EFFECT) !== 0;\n\t\t// TODO we don't need to call resume_children recursively with a linked list in place\n\t\t// it's slightly more involved though as we have to account for `transparent` changing\n\t\t// through the tree.\n\t\tresume_children(child, transparent ? local : false);\n\t\tchild = sibling;\n\t}\n\n\tvar t = effect.nodes && effect.nodes.t;\n\n\tif (t !== null) {\n\t\tfor (const transition of t) {\n\t\t\tif (transition.is_global || local) {\n\t\t\t\ttransition.in();\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function aborted(effect = /** @type {Effect} */ (active_effect)) {\n\treturn (effect.f & DESTROYED) !== 0;\n}\n\n/**\n * @param {Effect} effect\n * @param {DocumentFragment} fragment\n */\nexport function move_effect(effect, fragment) {\n\tif (!effect.nodes) return;\n\n\t/** @type {TemplateNode | null} */\n\tvar node = effect.nodes.start;\n\tvar end = effect.nodes.end;\n\n\twhile (node !== null) {\n\t\t/** @type {TemplateNode | null} */\n\t\tvar next = node === end ? null : get_next_sibling(node);\n\n\t\tfragment.append(node);\n\t\tnode = next;\n\t}\n}\n","/** @import { Derived, Effect, Reaction, Signal, Source, Value } from '#client' */\nimport { DEV } from 'esm-env';\nimport { get_descriptors, get_prototype_of, index_of } from '../shared/utils.js';\nimport {\n\tdestroy_block_effect_children,\n\tdestroy_effect_children,\n\teffect_tracking,\n\texecute_effect_teardown\n} from './reactivity/effects.js';\nimport {\n\tDIRTY,\n\tMAYBE_DIRTY,\n\tCLEAN,\n\tDERIVED,\n\tDESTROYED,\n\tBRANCH_EFFECT,\n\tSTATE_SYMBOL,\n\tBLOCK_EFFECT,\n\tROOT_EFFECT,\n\tCONNECTED,\n\tREACTION_IS_UPDATING,\n\tSTALE_REACTION,\n\tERROR_VALUE,\n\tWAS_MARKED,\n\tMANAGED_EFFECT\n} from './constants.js';\nimport { old_values } from './reactivity/sources.js';\nimport {\n\tdestroy_derived_effects,\n\texecute_derived,\n\tcurrent_async_effect,\n\trecent_async_deriveds,\n\tupdate_derived\n} from './reactivity/deriveds.js';\nimport { async_mode_flag, tracing_mode_flag } from '../flags/index.js';\nimport { tracing_expressions } from './dev/tracing.js';\nimport { get_error } from '../shared/dev.js';\nimport {\n\tcomponent_context,\n\tdev_current_component_function,\n\tdev_stack,\n\tis_runes,\n\tset_component_context,\n\tset_dev_current_component_function,\n\tset_dev_stack\n} from './context.js';\nimport * as w from './warnings.js';\nimport {\n\tBatch,\n\tbatch_values,\n\tcurrent_batch,\n\tflushSync,\n\tschedule_effect\n} from './reactivity/batch.js';\nimport { handle_error } from './error-handling.js';\nimport { UNINITIALIZED } from '../../constants.js';\nimport { captured_signals } from './legacy.js';\nimport { without_reactive_context } from './dom/elements/bindings/shared.js';\n\nexport let is_updating_effect = false;\n\n/** @param {boolean} value */\nexport function set_is_updating_effect(value) {\n\tis_updating_effect = value;\n}\n\nexport let is_destroying_effect = false;\n\n/** @param {boolean} value */\nexport function set_is_destroying_effect(value) {\n\tis_destroying_effect = value;\n}\n\n/** @type {null | Reaction} */\nexport let active_reaction = null;\n\nexport let untracking = false;\n\n/** @param {null | Reaction} reaction */\nexport function set_active_reaction(reaction) {\n\tactive_reaction = reaction;\n}\n\n/** @type {null | Effect} */\nexport let active_effect = null;\n\n/** @param {null | Effect} effect */\nexport function set_active_effect(effect) {\n\tactive_effect = effect;\n}\n\n/**\n * When sources are created within a reaction, reading and writing\n * them within that reaction should not cause a re-run\n * @type {null | Source[]}\n */\nexport let current_sources = null;\n\n/** @param {Value} value */\nexport function push_reaction_value(value) {\n\tif (active_reaction !== null && (!async_mode_flag || (active_reaction.f & DERIVED) !== 0)) {\n\t\tif (current_sources === null) {\n\t\t\tcurrent_sources = [value];\n\t\t} else {\n\t\t\tcurrent_sources.push(value);\n\t\t}\n\t}\n}\n\n/**\n * The dependencies of the reaction that is currently being executed. In many cases,\n * the dependencies are unchanged between runs, and so this will be `null` unless\n * and until a new dependency is accessed  we track this via `skipped_deps`\n * @type {null | Value[]}\n */\nlet new_deps = null;\n\nlet skipped_deps = 0;\n\n/**\n * Tracks writes that the effect it's executed in doesn't listen to yet,\n * so that the dependency can be added to the effect later on if it then reads it\n * @type {null | Source[]}\n */\nexport let untracked_writes = null;\n\n/** @param {null | Source[]} value */\nexport function set_untracked_writes(value) {\n\tuntracked_writes = value;\n}\n\n/**\n * @type {number} Used by sources and deriveds for handling updates.\n * Version starts from 1 so that unowned deriveds differentiate between a created effect and a run one for tracing\n **/\nexport let write_version = 1;\n\n/** @type {number} Used to version each read of a source of derived to avoid duplicating depedencies inside a reaction */\nlet read_version = 0;\n\nexport let update_version = read_version;\n\n/** @param {number} value */\nexport function set_update_version(value) {\n\tupdate_version = value;\n}\n\nexport function increment_write_version() {\n\treturn ++write_version;\n}\n\n/**\n * Determines whether a derived or effect is dirty.\n * If it is MAYBE_DIRTY, will set the status to CLEAN\n * @param {Reaction} reaction\n * @returns {boolean}\n */\nexport function is_dirty(reaction) {\n\tvar flags = reaction.f;\n\n\tif ((flags & DIRTY) !== 0) {\n\t\treturn true;\n\t}\n\n\tif (flags & DERIVED) {\n\t\treaction.f &= ~WAS_MARKED;\n\t}\n\n\tif ((flags & MAYBE_DIRTY) !== 0) {\n\t\tvar dependencies = reaction.deps;\n\n\t\tif (dependencies !== null) {\n\t\t\tvar length = dependencies.length;\n\n\t\t\tfor (var i = 0; i < length; i++) {\n\t\t\t\tvar dependency = dependencies[i];\n\n\t\t\t\tif (is_dirty(/** @type {Derived} */ (dependency))) {\n\t\t\t\t\tupdate_derived(/** @type {Derived} */ (dependency));\n\t\t\t\t}\n\n\t\t\t\tif (dependency.wv > reaction.wv) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\t(flags & CONNECTED) !== 0 &&\n\t\t\t// During time traveling we don't want to reset the status so that\n\t\t\t// traversal of the graph in the other batches still happens\n\t\t\tbatch_values === null\n\t\t) {\n\t\t\tset_signal_status(reaction, CLEAN);\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/**\n * @param {Value} signal\n * @param {Effect} effect\n * @param {boolean} [root]\n */\nfunction schedule_possible_effect_self_invalidation(signal, effect, root = true) {\n\tvar reactions = signal.reactions;\n\tif (reactions === null) return;\n\n\tif (!async_mode_flag && current_sources?.includes(signal)) {\n\t\treturn;\n\t}\n\n\tfor (var i = 0; i < reactions.length; i++) {\n\t\tvar reaction = reactions[i];\n\n\t\tif ((reaction.f & DERIVED) !== 0) {\n\t\t\tschedule_possible_effect_self_invalidation(/** @type {Derived} */ (reaction), effect, false);\n\t\t} else if (effect === reaction) {\n\t\t\tif (root) {\n\t\t\t\tset_signal_status(reaction, DIRTY);\n\t\t\t} else if ((reaction.f & CLEAN) !== 0) {\n\t\t\t\tset_signal_status(reaction, MAYBE_DIRTY);\n\t\t\t}\n\t\t\tschedule_effect(/** @type {Effect} */ (reaction));\n\t\t}\n\t}\n}\n\n/** @param {Reaction} reaction */\nexport function update_reaction(reaction) {\n\tvar previous_deps = new_deps;\n\tvar previous_skipped_deps = skipped_deps;\n\tvar previous_untracked_writes = untracked_writes;\n\tvar previous_reaction = active_reaction;\n\tvar previous_sources = current_sources;\n\tvar previous_component_context = component_context;\n\tvar previous_untracking = untracking;\n\tvar previous_update_version = update_version;\n\n\tvar flags = reaction.f;\n\n\tnew_deps = /** @type {null | Value[]} */ (null);\n\tskipped_deps = 0;\n\tuntracked_writes = null;\n\tactive_reaction = (flags & (BRANCH_EFFECT | ROOT_EFFECT)) === 0 ? reaction : null;\n\n\tcurrent_sources = null;\n\tset_component_context(reaction.ctx);\n\tuntracking = false;\n\tupdate_version = ++read_version;\n\n\tif (reaction.ac !== null) {\n\t\twithout_reactive_context(() => {\n\t\t\t/** @type {AbortController} */ (reaction.ac).abort(STALE_REACTION);\n\t\t});\n\n\t\treaction.ac = null;\n\t}\n\n\ttry {\n\t\treaction.f |= REACTION_IS_UPDATING;\n\t\tvar fn = /** @type {Function} */ (reaction.fn);\n\t\tvar result = fn();\n\t\tvar deps = reaction.deps;\n\n\t\tif (new_deps !== null) {\n\t\t\tvar i;\n\n\t\t\tremove_reactions(reaction, skipped_deps);\n\n\t\t\tif (deps !== null && skipped_deps > 0) {\n\t\t\t\tdeps.length = skipped_deps + new_deps.length;\n\t\t\t\tfor (i = 0; i < new_deps.length; i++) {\n\t\t\t\t\tdeps[skipped_deps + i] = new_deps[i];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treaction.deps = deps = new_deps;\n\t\t\t}\n\n\t\t\tif (effect_tracking() && (reaction.f & CONNECTED) !== 0) {\n\t\t\t\tfor (i = skipped_deps; i < deps.length; i++) {\n\t\t\t\t\t(deps[i].reactions ??= []).push(reaction);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (deps !== null && skipped_deps < deps.length) {\n\t\t\tremove_reactions(reaction, skipped_deps);\n\t\t\tdeps.length = skipped_deps;\n\t\t}\n\n\t\t// If we're inside an effect and we have untracked writes, then we need to\n\t\t// ensure that if any of those untracked writes result in re-invalidation\n\t\t// of the current effect, then that happens accordingly\n\t\tif (\n\t\t\tis_runes() &&\n\t\t\tuntracked_writes !== null &&\n\t\t\t!untracking &&\n\t\t\tdeps !== null &&\n\t\t\t(reaction.f & (DERIVED | MAYBE_DIRTY | DIRTY)) === 0\n\t\t) {\n\t\t\tfor (i = 0; i < /** @type {Source[]} */ (untracked_writes).length; i++) {\n\t\t\t\tschedule_possible_effect_self_invalidation(\n\t\t\t\t\tuntracked_writes[i],\n\t\t\t\t\t/** @type {Effect} */ (reaction)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// If we are returning to an previous reaction then\n\t\t// we need to increment the read version to ensure that\n\t\t// any dependencies in this reaction aren't marked with\n\t\t// the same version\n\t\tif (previous_reaction !== null && previous_reaction !== reaction) {\n\t\t\tread_version++;\n\n\t\t\tif (untracked_writes !== null) {\n\t\t\t\tif (previous_untracked_writes === null) {\n\t\t\t\t\tprevious_untracked_writes = untracked_writes;\n\t\t\t\t} else {\n\t\t\t\t\tprevious_untracked_writes.push(.../** @type {Source[]} */ (untracked_writes));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ((reaction.f & ERROR_VALUE) !== 0) {\n\t\t\treaction.f ^= ERROR_VALUE;\n\t\t}\n\n\t\treturn result;\n\t} catch (error) {\n\t\treturn handle_error(error);\n\t} finally {\n\t\treaction.f ^= REACTION_IS_UPDATING;\n\t\tnew_deps = previous_deps;\n\t\tskipped_deps = previous_skipped_deps;\n\t\tuntracked_writes = previous_untracked_writes;\n\t\tactive_reaction = previous_reaction;\n\t\tcurrent_sources = previous_sources;\n\t\tset_component_context(previous_component_context);\n\t\tuntracking = previous_untracking;\n\t\tupdate_version = previous_update_version;\n\t}\n}\n\n/**\n * @template V\n * @param {Reaction} signal\n * @param {Value<V>} dependency\n * @returns {void}\n */\nfunction remove_reaction(signal, dependency) {\n\tlet reactions = dependency.reactions;\n\tif (reactions !== null) {\n\t\tvar index = index_of.call(reactions, signal);\n\t\tif (index !== -1) {\n\t\t\tvar new_length = reactions.length - 1;\n\t\t\tif (new_length === 0) {\n\t\t\t\treactions = dependency.reactions = null;\n\t\t\t} else {\n\t\t\t\t// Swap with last element and then remove.\n\t\t\t\treactions[index] = reactions[new_length];\n\t\t\t\treactions.pop();\n\t\t\t}\n\t\t}\n\t}\n\n\t// If the derived has no reactions, then we can disconnect it from the graph,\n\t// allowing it to either reconnect in the future, or be GC'd by the VM.\n\tif (\n\t\treactions === null &&\n\t\t(dependency.f & DERIVED) !== 0 &&\n\t\t// Destroying a child effect while updating a parent effect can cause a dependency to appear\n\t\t// to be unused, when in fact it is used by the currently-updating parent. Checking `new_deps`\n\t\t// allows us to skip the expensive work of disconnecting and immediately reconnecting it\n\t\t(new_deps === null || !new_deps.includes(dependency))\n\t) {\n\t\tset_signal_status(dependency, MAYBE_DIRTY);\n\t\t// If we are working with a derived that is owned by an effect, then mark it as being\n\t\t// disconnected and remove the mark flag, as it cannot be reliably removed otherwise\n\t\tif ((dependency.f & CONNECTED) !== 0) {\n\t\t\tdependency.f ^= CONNECTED;\n\t\t\tdependency.f &= ~WAS_MARKED;\n\t\t}\n\t\t// Disconnect any reactions owned by this reaction\n\t\tdestroy_derived_effects(/** @type {Derived} **/ (dependency));\n\t\tremove_reactions(/** @type {Derived} **/ (dependency), 0);\n\t}\n}\n\n/**\n * @param {Reaction} signal\n * @param {number} start_index\n * @returns {void}\n */\nexport function remove_reactions(signal, start_index) {\n\tvar dependencies = signal.deps;\n\tif (dependencies === null) return;\n\n\tfor (var i = start_index; i < dependencies.length; i++) {\n\t\tremove_reaction(signal, dependencies[i]);\n\t}\n}\n\n/**\n * @param {Effect} effect\n * @returns {void}\n */\nexport function update_effect(effect) {\n\tvar flags = effect.f;\n\n\tif ((flags & DESTROYED) !== 0) {\n\t\treturn;\n\t}\n\n\tset_signal_status(effect, CLEAN);\n\n\tvar previous_effect = active_effect;\n\tvar was_updating_effect = is_updating_effect;\n\n\tactive_effect = effect;\n\tis_updating_effect = true;\n\n\tif (DEV) {\n\t\tvar previous_component_fn = dev_current_component_function;\n\t\tset_dev_current_component_function(effect.component_function);\n\t\tvar previous_stack = /** @type {any} */ (dev_stack);\n\t\t// only block effects have a dev stack, keep the current one otherwise\n\t\tset_dev_stack(effect.dev_stack ?? dev_stack);\n\t}\n\n\ttry {\n\t\tif ((flags & (BLOCK_EFFECT | MANAGED_EFFECT)) !== 0) {\n\t\t\tdestroy_block_effect_children(effect);\n\t\t} else {\n\t\t\tdestroy_effect_children(effect);\n\t\t}\n\n\t\texecute_effect_teardown(effect);\n\t\tvar teardown = update_reaction(effect);\n\t\teffect.teardown = typeof teardown === 'function' ? teardown : null;\n\t\teffect.wv = write_version;\n\n\t\t// In DEV, increment versions of any sources that were written to during the effect,\n\t\t// so that they are correctly marked as dirty when the effect re-runs\n\t\tif (DEV && tracing_mode_flag && (effect.f & DIRTY) !== 0 && effect.deps !== null) {\n\t\t\tfor (var dep of effect.deps) {\n\t\t\t\tif (dep.set_during_effect) {\n\t\t\t\t\tdep.wv = increment_write_version();\n\t\t\t\t\tdep.set_during_effect = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} finally {\n\t\tis_updating_effect = was_updating_effect;\n\t\tactive_effect = previous_effect;\n\n\t\tif (DEV) {\n\t\t\tset_dev_current_component_function(previous_component_fn);\n\t\t\tset_dev_stack(previous_stack);\n\t\t}\n\t}\n}\n\n/**\n * Returns a promise that resolves once any pending state changes have been applied.\n * @returns {Promise<void>}\n */\nexport async function tick() {\n\tif (async_mode_flag) {\n\t\treturn new Promise((f) => {\n\t\t\t// Race them against each other - in almost all cases requestAnimationFrame will fire first,\n\t\t\t// but e.g. in case the window is not focused or a view transition happens, requestAnimationFrame\n\t\t\t// will be delayed and setTimeout helps us resolve fast enough in that case\n\t\t\trequestAnimationFrame(() => f());\n\t\t\tsetTimeout(() => f());\n\t\t});\n\t}\n\n\tawait Promise.resolve();\n\n\t// By calling flushSync we guarantee that any pending state changes are applied after one tick.\n\t// TODO look into whether we can make flushing subsequent updates synchronously in the future.\n\tflushSync();\n}\n\n/**\n * Returns a promise that resolves once any state changes, and asynchronous work resulting from them,\n * have resolved and the DOM has been updated\n * @returns {Promise<void>}\n * @since 5.36\n */\nexport function settled() {\n\treturn Batch.ensure().settled();\n}\n\n/**\n * @template V\n * @param {Value<V>} signal\n * @returns {V}\n */\nexport function get(signal) {\n\tvar flags = signal.f;\n\tvar is_derived = (flags & DERIVED) !== 0;\n\n\tcaptured_signals?.add(signal);\n\n\t// Register the dependency on the current reaction signal.\n\tif (active_reaction !== null && !untracking) {\n\t\t// if we're in a derived that is being read inside an _async_ derived,\n\t\t// it's possible that the effect was already destroyed. In this case,\n\t\t// we don't add the dependency, because that would create a memory leak\n\t\tvar destroyed = active_effect !== null && (active_effect.f & DESTROYED) !== 0;\n\n\t\tif (!destroyed && !current_sources?.includes(signal)) {\n\t\t\tvar deps = active_reaction.deps;\n\n\t\t\tif ((active_reaction.f & REACTION_IS_UPDATING) !== 0) {\n\t\t\t\t// we're in the effect init/update cycle\n\t\t\t\tif (signal.rv < read_version) {\n\t\t\t\t\tsignal.rv = read_version;\n\n\t\t\t\t\t// If the signal is accessing the same dependencies in the same\n\t\t\t\t\t// order as it did last time, increment `skipped_deps`\n\t\t\t\t\t// rather than updating `new_deps`, which creates GC cost\n\t\t\t\t\tif (new_deps === null && deps !== null && deps[skipped_deps] === signal) {\n\t\t\t\t\t\tskipped_deps++;\n\t\t\t\t\t} else if (new_deps === null) {\n\t\t\t\t\t\tnew_deps = [signal];\n\t\t\t\t\t} else if (!new_deps.includes(signal)) {\n\t\t\t\t\t\tnew_deps.push(signal);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// we're adding a dependency outside the init/update cycle\n\t\t\t\t// (i.e. after an `await`)\n\t\t\t\t(active_reaction.deps ??= []).push(signal);\n\n\t\t\t\tvar reactions = signal.reactions;\n\n\t\t\t\tif (reactions === null) {\n\t\t\t\t\tsignal.reactions = [active_reaction];\n\t\t\t\t} else if (!reactions.includes(active_reaction)) {\n\t\t\t\t\treactions.push(active_reaction);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (DEV) {\n\t\t// TODO reinstate this, but make it actually work\n\t\t// if (current_async_effect) {\n\t\t// \tvar tracking = (current_async_effect.f & REACTION_IS_UPDATING) !== 0;\n\t\t// \tvar was_read = current_async_effect.deps?.includes(signal);\n\n\t\t// \tif (!tracking && !untracking && !was_read) {\n\t\t// \t\tw.await_reactivity_loss(/** @type {string} */ (signal.label));\n\n\t\t// \t\tvar trace = get_error('traced at');\n\t\t// \t\t// eslint-disable-next-line no-console\n\t\t// \t\tif (trace) console.warn(trace);\n\t\t// \t}\n\t\t// }\n\n\t\trecent_async_deriveds.delete(signal);\n\n\t\tif (\n\t\t\ttracing_mode_flag &&\n\t\t\t!untracking &&\n\t\t\ttracing_expressions !== null &&\n\t\t\tactive_reaction !== null &&\n\t\t\ttracing_expressions.reaction === active_reaction\n\t\t) {\n\t\t\t// Used when mapping state between special blocks like `each`\n\t\t\tif (signal.trace) {\n\t\t\t\tsignal.trace();\n\t\t\t} else {\n\t\t\t\tvar trace = get_error('traced at');\n\n\t\t\t\tif (trace) {\n\t\t\t\t\tvar entry = tracing_expressions.entries.get(signal);\n\n\t\t\t\t\tif (entry === undefined) {\n\t\t\t\t\t\tentry = { traces: [] };\n\t\t\t\t\t\ttracing_expressions.entries.set(signal, entry);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar last = entry.traces[entry.traces.length - 1];\n\n\t\t\t\t\t// traces can be duplicated, e.g. by `snapshot` invoking both\n\t\t\t\t\t// both `getOwnPropertyDescriptor` and `get` traps at once\n\t\t\t\t\tif (trace.stack !== last?.stack) {\n\t\t\t\t\t\tentry.traces.push(trace);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (is_destroying_effect) {\n\t\tif (old_values.has(signal)) {\n\t\t\treturn old_values.get(signal);\n\t\t}\n\n\t\tif (is_derived) {\n\t\t\tvar derived = /** @type {Derived} */ (signal);\n\n\t\t\tvar value = derived.v;\n\n\t\t\t// if the derived is dirty and has reactions, or depends on the values that just changed, re-execute\n\t\t\t// (a derived can be maybe_dirty due to the effect destroy removing its last reaction)\n\t\t\tif (\n\t\t\t\t((derived.f & CLEAN) === 0 && derived.reactions !== null) ||\n\t\t\t\tdepends_on_old_values(derived)\n\t\t\t) {\n\t\t\t\tvalue = execute_derived(derived);\n\t\t\t}\n\n\t\t\told_values.set(derived, value);\n\n\t\t\treturn value;\n\t\t}\n\t} else if (\n\t\tis_derived &&\n\t\t(!batch_values?.has(signal) || (current_batch?.is_fork && !effect_tracking()))\n\t) {\n\t\tderived = /** @type {Derived} */ (signal);\n\n\t\tif (is_dirty(derived)) {\n\t\t\tupdate_derived(derived);\n\t\t}\n\n\t\tif (is_updating_effect && effect_tracking() && (derived.f & CONNECTED) === 0) {\n\t\t\treconnect(derived);\n\t\t}\n\t}\n\n\tif (batch_values?.has(signal)) {\n\t\treturn batch_values.get(signal);\n\t}\n\n\tif ((signal.f & ERROR_VALUE) !== 0) {\n\t\tthrow signal.v;\n\t}\n\n\treturn signal.v;\n}\n\n/**\n * (Re)connect a disconnected derived, so that it is notified\n * of changes in `mark_reactions`\n * @param {Derived} derived\n */\nfunction reconnect(derived) {\n\tif (derived.deps === null) return;\n\n\tderived.f ^= CONNECTED;\n\n\tfor (const dep of derived.deps) {\n\t\t(dep.reactions ??= []).push(derived);\n\n\t\tif ((dep.f & DERIVED) !== 0 && (dep.f & CONNECTED) === 0) {\n\t\t\treconnect(/** @type {Derived} */ (dep));\n\t\t}\n\t}\n}\n\n/** @param {Derived} derived */\nfunction depends_on_old_values(derived) {\n\tif (derived.v === UNINITIALIZED) return true; // we don't know, so assume the worst\n\tif (derived.deps === null) return false;\n\n\tfor (const dep of derived.deps) {\n\t\tif (old_values.has(dep)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ((dep.f & DERIVED) !== 0 && depends_on_old_values(/** @type {Derived} */ (dep))) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/**\n * Like `get`, but checks for `undefined`. Used for `var` declarations because they can be accessed before being declared\n * @template V\n * @param {Value<V> | undefined} signal\n * @returns {V | undefined}\n */\nexport function safe_get(signal) {\n\treturn signal && get(signal);\n}\n\n/**\n * When used inside a [`$derived`](https://svelte.dev/docs/svelte/$derived) or [`$effect`](https://svelte.dev/docs/svelte/$effect),\n * any state read inside `fn` will not be treated as a dependency.\n *\n * ```ts\n * $effect(() => {\n *   // this will run when `data` changes, but not when `time` changes\n *   save(data, {\n *     timestamp: untrack(() => time)\n *   });\n * });\n * ```\n * @template T\n * @param {() => T} fn\n * @returns {T}\n */\nexport function untrack(fn) {\n\tvar previous_untracking = untracking;\n\ttry {\n\t\tuntracking = true;\n\t\treturn fn();\n\t} finally {\n\t\tuntracking = previous_untracking;\n\t}\n}\n\nconst STATUS_MASK = ~(DIRTY | MAYBE_DIRTY | CLEAN);\n\n/**\n * @param {Signal} signal\n * @param {number} status\n * @returns {void}\n */\nexport function set_signal_status(signal, status) {\n\tsignal.f = (signal.f & STATUS_MASK) | status;\n}\n\n/**\n * @param {Record<string | symbol, unknown>} obj\n * @param {Array<string | symbol>} keys\n * @returns {Record<string | symbol, unknown>}\n */\nexport function exclude_from_object(obj, keys) {\n\t/** @type {Record<string | symbol, unknown>} */\n\tvar result = {};\n\n\tfor (var key in obj) {\n\t\tif (!keys.includes(key)) {\n\t\t\tresult[key] = obj[key];\n\t\t}\n\t}\n\n\tfor (var symbol of Object.getOwnPropertySymbols(obj)) {\n\t\tif (Object.propertyIsEnumerable.call(obj, symbol) && !keys.includes(symbol)) {\n\t\t\tresult[symbol] = obj[symbol];\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * Possibly traverse an object and read all its properties so that they're all reactive in case this is `$state`.\n * Does only check first level of an object for performance reasons (heuristic should be good for 99% of all cases).\n * @param {any} value\n * @returns {void}\n */\nexport function deep_read_state(value) {\n\tif (typeof value !== 'object' || !value || value instanceof EventTarget) {\n\t\treturn;\n\t}\n\n\tif (STATE_SYMBOL in value) {\n\t\tdeep_read(value);\n\t} else if (!Array.isArray(value)) {\n\t\tfor (let key in value) {\n\t\t\tconst prop = value[key];\n\t\t\tif (typeof prop === 'object' && prop && STATE_SYMBOL in prop) {\n\t\t\t\tdeep_read(prop);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Deeply traverse an object and read all its properties\n * so that they're all reactive in case this is `$state`\n * @param {any} value\n * @param {Set<any>} visited\n * @returns {void}\n */\nexport function deep_read(value, visited = new Set()) {\n\tif (\n\t\ttypeof value === 'object' &&\n\t\tvalue !== null &&\n\t\t// We don't want to traverse DOM elements\n\t\t!(value instanceof EventTarget) &&\n\t\t!visited.has(value)\n\t) {\n\t\tvisited.add(value);\n\t\t// When working with a possible SvelteDate, this\n\t\t// will ensure we capture changes to it.\n\t\tif (value instanceof Date) {\n\t\t\tvalue.getTime();\n\t\t}\n\t\tfor (let key in value) {\n\t\t\ttry {\n\t\t\t\tdeep_read(value[key], visited);\n\t\t\t} catch (e) {\n\t\t\t\t// continue\n\t\t\t}\n\t\t}\n\t\tconst proto = get_prototype_of(value);\n\t\tif (\n\t\t\tproto !== Object.prototype &&\n\t\t\tproto !== Array.prototype &&\n\t\t\tproto !== Map.prototype &&\n\t\t\tproto !== Set.prototype &&\n\t\t\tproto !== Date.prototype\n\t\t) {\n\t\t\tconst descriptors = get_descriptors(proto);\n\t\t\tfor (let key in descriptors) {\n\t\t\t\tconst get = descriptors[key].get;\n\t\t\t\tif (get) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tget.call(value);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// continue\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","const regex_return_characters = /\\r/g;\n\n/**\n * @param {string} str\n * @returns {string}\n */\nexport function hash(str) {\n\tstr = str.replace(regex_return_characters, '');\n\tlet hash = 5381;\n\tlet i = str.length;\n\n\twhile (i--) hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n\treturn (hash >>> 0).toString(36);\n}\n\nconst VOID_ELEMENT_NAMES = [\n\t'area',\n\t'base',\n\t'br',\n\t'col',\n\t'command',\n\t'embed',\n\t'hr',\n\t'img',\n\t'input',\n\t'keygen',\n\t'link',\n\t'meta',\n\t'param',\n\t'source',\n\t'track',\n\t'wbr'\n];\n\n/**\n * Returns `true` if `name` is of a void element\n * @param {string} name\n */\nexport function is_void(name) {\n\treturn VOID_ELEMENT_NAMES.includes(name) || name.toLowerCase() === '!doctype';\n}\n\nconst RESERVED_WORDS = [\n\t'arguments',\n\t'await',\n\t'break',\n\t'case',\n\t'catch',\n\t'class',\n\t'const',\n\t'continue',\n\t'debugger',\n\t'default',\n\t'delete',\n\t'do',\n\t'else',\n\t'enum',\n\t'eval',\n\t'export',\n\t'extends',\n\t'false',\n\t'finally',\n\t'for',\n\t'function',\n\t'if',\n\t'implements',\n\t'import',\n\t'in',\n\t'instanceof',\n\t'interface',\n\t'let',\n\t'new',\n\t'null',\n\t'package',\n\t'private',\n\t'protected',\n\t'public',\n\t'return',\n\t'static',\n\t'super',\n\t'switch',\n\t'this',\n\t'throw',\n\t'true',\n\t'try',\n\t'typeof',\n\t'var',\n\t'void',\n\t'while',\n\t'with',\n\t'yield'\n];\n\n/**\n * Returns `true` if `word` is a reserved JavaScript keyword\n * @param {string} word\n */\nexport function is_reserved(word) {\n\treturn RESERVED_WORDS.includes(word);\n}\n\n/**\n * @param {string} name\n */\nexport function is_capture_event(name) {\n\treturn name.endsWith('capture') && name !== 'gotpointercapture' && name !== 'lostpointercapture';\n}\n\n/** List of Element events that will be delegated */\nconst DELEGATED_EVENTS = [\n\t'beforeinput',\n\t'click',\n\t'change',\n\t'dblclick',\n\t'contextmenu',\n\t'focusin',\n\t'focusout',\n\t'input',\n\t'keydown',\n\t'keyup',\n\t'mousedown',\n\t'mousemove',\n\t'mouseout',\n\t'mouseover',\n\t'mouseup',\n\t'pointerdown',\n\t'pointermove',\n\t'pointerout',\n\t'pointerover',\n\t'pointerup',\n\t'touchend',\n\t'touchmove',\n\t'touchstart'\n];\n\n/**\n * Returns `true` if `event_name` is a delegated event\n * @param {string} event_name\n */\nexport function can_delegate_event(event_name) {\n\treturn DELEGATED_EVENTS.includes(event_name);\n}\n\n/**\n * Attributes that are boolean, i.e. they are present or not present.\n */\nconst DOM_BOOLEAN_ATTRIBUTES = [\n\t'allowfullscreen',\n\t'async',\n\t'autofocus',\n\t'autoplay',\n\t'checked',\n\t'controls',\n\t'default',\n\t'disabled',\n\t'formnovalidate',\n\t'indeterminate',\n\t'inert',\n\t'ismap',\n\t'loop',\n\t'multiple',\n\t'muted',\n\t'nomodule',\n\t'novalidate',\n\t'open',\n\t'playsinline',\n\t'readonly',\n\t'required',\n\t'reversed',\n\t'seamless',\n\t'selected',\n\t'webkitdirectory',\n\t'defer',\n\t'disablepictureinpicture',\n\t'disableremoteplayback'\n];\n\n/**\n * Returns `true` if `name` is a boolean attribute\n * @param {string} name\n */\nexport function is_boolean_attribute(name) {\n\treturn DOM_BOOLEAN_ATTRIBUTES.includes(name);\n}\n\n/**\n * @type {Record<string, string>}\n * List of attribute names that should be aliased to their property names\n * because they behave differently between setting them as an attribute and\n * setting them as a property.\n */\nconst ATTRIBUTE_ALIASES = {\n\t// no `class: 'className'` because we handle that separately\n\tformnovalidate: 'formNoValidate',\n\tismap: 'isMap',\n\tnomodule: 'noModule',\n\tplaysinline: 'playsInline',\n\treadonly: 'readOnly',\n\tdefaultvalue: 'defaultValue',\n\tdefaultchecked: 'defaultChecked',\n\tsrcobject: 'srcObject',\n\tnovalidate: 'noValidate',\n\tallowfullscreen: 'allowFullscreen',\n\tdisablepictureinpicture: 'disablePictureInPicture',\n\tdisableremoteplayback: 'disableRemotePlayback'\n};\n\n/**\n * @param {string} name\n */\nexport function normalize_attribute(name) {\n\tname = name.toLowerCase();\n\treturn ATTRIBUTE_ALIASES[name] ?? name;\n}\n\nconst DOM_PROPERTIES = [\n\t...DOM_BOOLEAN_ATTRIBUTES,\n\t'formNoValidate',\n\t'isMap',\n\t'noModule',\n\t'playsInline',\n\t'readOnly',\n\t'value',\n\t'volume',\n\t'defaultValue',\n\t'defaultChecked',\n\t'srcObject',\n\t'noValidate',\n\t'allowFullscreen',\n\t'disablePictureInPicture',\n\t'disableRemotePlayback'\n];\n\n/**\n * @param {string} name\n */\nexport function is_dom_property(name) {\n\treturn DOM_PROPERTIES.includes(name);\n}\n\nconst NON_STATIC_PROPERTIES = ['autofocus', 'muted', 'defaultValue', 'defaultChecked'];\n\n/**\n * Returns `true` if the given attribute cannot be set through the template\n * string, i.e. needs some kind of JavaScript handling to work.\n * @param {string} name\n */\nexport function cannot_be_set_statically(name) {\n\treturn NON_STATIC_PROPERTIES.includes(name);\n}\n\n/**\n * Subset of delegated events which should be passive by default.\n * These two are already passive via browser defaults on window, document and body.\n * But since\n * - we're delegating them\n * - they happen often\n * - they apply to mobile which is generally less performant\n * we're marking them as passive by default for other elements, too.\n */\nconst PASSIVE_EVENTS = ['touchstart', 'touchmove'];\n\n/**\n * Returns `true` if `name` is a passive event\n * @param {string} name\n */\nexport function is_passive_event(name) {\n\treturn PASSIVE_EVENTS.includes(name);\n}\n\nconst CONTENT_EDITABLE_BINDINGS = ['textContent', 'innerHTML', 'innerText'];\n\n/** @param {string} name */\nexport function is_content_editable_binding(name) {\n\treturn CONTENT_EDITABLE_BINDINGS.includes(name);\n}\n\nconst LOAD_ERROR_ELEMENTS = [\n\t'body',\n\t'embed',\n\t'iframe',\n\t'img',\n\t'link',\n\t'object',\n\t'script',\n\t'style',\n\t'track'\n];\n\n/**\n * Returns `true` if the element emits `load` and `error` events\n * @param {string} name\n */\nexport function is_load_error_element(name) {\n\treturn LOAD_ERROR_ELEMENTS.includes(name);\n}\n\nconst SVG_ELEMENTS = [\n\t'altGlyph',\n\t'altGlyphDef',\n\t'altGlyphItem',\n\t'animate',\n\t'animateColor',\n\t'animateMotion',\n\t'animateTransform',\n\t'circle',\n\t'clipPath',\n\t'color-profile',\n\t'cursor',\n\t'defs',\n\t'desc',\n\t'discard',\n\t'ellipse',\n\t'feBlend',\n\t'feColorMatrix',\n\t'feComponentTransfer',\n\t'feComposite',\n\t'feConvolveMatrix',\n\t'feDiffuseLighting',\n\t'feDisplacementMap',\n\t'feDistantLight',\n\t'feDropShadow',\n\t'feFlood',\n\t'feFuncA',\n\t'feFuncB',\n\t'feFuncG',\n\t'feFuncR',\n\t'feGaussianBlur',\n\t'feImage',\n\t'feMerge',\n\t'feMergeNode',\n\t'feMorphology',\n\t'feOffset',\n\t'fePointLight',\n\t'feSpecularLighting',\n\t'feSpotLight',\n\t'feTile',\n\t'feTurbulence',\n\t'filter',\n\t'font',\n\t'font-face',\n\t'font-face-format',\n\t'font-face-name',\n\t'font-face-src',\n\t'font-face-uri',\n\t'foreignObject',\n\t'g',\n\t'glyph',\n\t'glyphRef',\n\t'hatch',\n\t'hatchpath',\n\t'hkern',\n\t'image',\n\t'line',\n\t'linearGradient',\n\t'marker',\n\t'mask',\n\t'mesh',\n\t'meshgradient',\n\t'meshpatch',\n\t'meshrow',\n\t'metadata',\n\t'missing-glyph',\n\t'mpath',\n\t'path',\n\t'pattern',\n\t'polygon',\n\t'polyline',\n\t'radialGradient',\n\t'rect',\n\t'set',\n\t'solidcolor',\n\t'stop',\n\t'svg',\n\t'switch',\n\t'symbol',\n\t'text',\n\t'textPath',\n\t'tref',\n\t'tspan',\n\t'unknown',\n\t'use',\n\t'view',\n\t'vkern'\n];\n\n/** @param {string} name */\nexport function is_svg(name) {\n\treturn SVG_ELEMENTS.includes(name);\n}\n\nconst MATHML_ELEMENTS = [\n\t'annotation',\n\t'annotation-xml',\n\t'maction',\n\t'math',\n\t'merror',\n\t'mfrac',\n\t'mi',\n\t'mmultiscripts',\n\t'mn',\n\t'mo',\n\t'mover',\n\t'mpadded',\n\t'mphantom',\n\t'mprescripts',\n\t'mroot',\n\t'mrow',\n\t'ms',\n\t'mspace',\n\t'msqrt',\n\t'mstyle',\n\t'msub',\n\t'msubsup',\n\t'msup',\n\t'mtable',\n\t'mtd',\n\t'mtext',\n\t'mtr',\n\t'munder',\n\t'munderover',\n\t'semantics'\n];\n\n/** @param {string} name */\nexport function is_mathml(name) {\n\treturn MATHML_ELEMENTS.includes(name);\n}\n\nconst STATE_CREATION_RUNES = /** @type {const} */ ([\n\t'$state',\n\t'$state.raw',\n\t'$derived',\n\t'$derived.by'\n]);\n\nconst RUNES = /** @type {const} */ ([\n\t...STATE_CREATION_RUNES,\n\t'$state.eager',\n\t'$state.snapshot',\n\t'$props',\n\t'$props.id',\n\t'$bindable',\n\t'$effect',\n\t'$effect.pre',\n\t'$effect.tracking',\n\t'$effect.root',\n\t'$effect.pending',\n\t'$inspect',\n\t'$inspect().with',\n\t'$inspect.trace',\n\t'$host'\n]);\n\n/** @typedef {typeof RUNES[number]} RuneName */\n\n/**\n * @param {string} name\n * @returns {name is RuneName}\n */\nexport function is_rune(name) {\n\treturn RUNES.includes(/** @type {RuneName} */ (name));\n}\n\n/** @typedef {typeof STATE_CREATION_RUNES[number]} StateCreationRuneName */\n\n/**\n * @param {string} name\n * @returns {name is StateCreationRuneName}\n */\nexport function is_state_creation_rune(name) {\n\treturn STATE_CREATION_RUNES.includes(/** @type {StateCreationRuneName} */ (name));\n}\n\n/** List of elements that require raw contents and should not have SSR comments put in them */\nconst RAW_TEXT_ELEMENTS = /** @type {const} */ (['textarea', 'script', 'style', 'title']);\n\n/** @param {string} name */\nexport function is_raw_text_element(name) {\n\treturn RAW_TEXT_ELEMENTS.includes(/** @type {typeof RAW_TEXT_ELEMENTS[number]} */ (name));\n}\n\n/**\n * Prevent devtools trying to make `location` a clickable link by inserting a zero-width space\n * @template {string | undefined} T\n * @param {T} location\n * @returns {T};\n */\nexport function sanitize_location(location) {\n\treturn /** @type {T} */ (location?.replace(/\\//g, '/\\u200b'));\n}\n","import { teardown } from '../../reactivity/effects.js';\nimport { define_property } from '../../../shared/utils.js';\nimport { hydrating } from '../hydration.js';\nimport { queue_micro_task } from '../task.js';\nimport { FILENAME } from '../../../../constants.js';\nimport * as w from '../../warnings.js';\nimport {\n\tactive_effect,\n\tactive_reaction,\n\tset_active_effect,\n\tset_active_reaction\n} from '../../runtime.js';\nimport { without_reactive_context } from './bindings/shared.js';\n\n/** @type {Set<string>} */\nexport const all_registered_events = new Set();\n\n/** @type {Set<(events: Array<string>) => void>} */\nexport const root_event_handles = new Set();\n\n/**\n * SSR adds onload and onerror attributes to catch those events before the hydration.\n * This function detects those cases, removes the attributes and replays the events.\n * @param {HTMLElement} dom\n */\nexport function replay_events(dom) {\n\tif (!hydrating) return;\n\n\tdom.removeAttribute('onload');\n\tdom.removeAttribute('onerror');\n\t// @ts-expect-error\n\tconst event = dom.__e;\n\tif (event !== undefined) {\n\t\t// @ts-expect-error\n\t\tdom.__e = undefined;\n\t\tqueueMicrotask(() => {\n\t\t\tif (dom.isConnected) {\n\t\t\t\tdom.dispatchEvent(event);\n\t\t\t}\n\t\t});\n\t}\n}\n\n/**\n * @param {string} event_name\n * @param {EventTarget} dom\n * @param {EventListener} [handler]\n * @param {AddEventListenerOptions} [options]\n */\nexport function create_event(event_name, dom, handler, options = {}) {\n\t/**\n\t * @this {EventTarget}\n\t */\n\tfunction target_handler(/** @type {Event} */ event) {\n\t\tif (!options.capture) {\n\t\t\t// Only call in the bubble phase, else delegated events would be called before the capturing events\n\t\t\thandle_event_propagation.call(dom, event);\n\t\t}\n\t\tif (!event.cancelBubble) {\n\t\t\treturn without_reactive_context(() => {\n\t\t\t\treturn handler?.call(this, event);\n\t\t\t});\n\t\t}\n\t}\n\n\t// Chrome has a bug where pointer events don't work when attached to a DOM element that has been cloned\n\t// with cloneNode() and the DOM element is disconnected from the document. To ensure the event works, we\n\t// defer the attachment till after it's been appended to the document. TODO: remove this once Chrome fixes\n\t// this bug. The same applies to wheel events and touch events.\n\tif (\n\t\tevent_name.startsWith('pointer') ||\n\t\tevent_name.startsWith('touch') ||\n\t\tevent_name === 'wheel'\n\t) {\n\t\tqueue_micro_task(() => {\n\t\t\tdom.addEventListener(event_name, target_handler, options);\n\t\t});\n\t} else {\n\t\tdom.addEventListener(event_name, target_handler, options);\n\t}\n\n\treturn target_handler;\n}\n\n/**\n * Attaches an event handler to an element and returns a function that removes the handler. Using this\n * rather than `addEventListener` will preserve the correct order relative to handlers added declaratively\n * (with attributes like `onclick`), which use event delegation for performance reasons\n *\n * @param {EventTarget} element\n * @param {string} type\n * @param {EventListener} handler\n * @param {AddEventListenerOptions} [options]\n */\nexport function on(element, type, handler, options = {}) {\n\tvar target_handler = create_event(type, element, handler, options);\n\n\treturn () => {\n\t\telement.removeEventListener(type, target_handler, options);\n\t};\n}\n\n/**\n * @param {string} event_name\n * @param {Element} dom\n * @param {EventListener} [handler]\n * @param {boolean} [capture]\n * @param {boolean} [passive]\n * @returns {void}\n */\nexport function event(event_name, dom, handler, capture, passive) {\n\tvar options = { capture, passive };\n\tvar target_handler = create_event(event_name, dom, handler, options);\n\n\tif (\n\t\tdom === document.body ||\n\t\t// @ts-ignore\n\t\tdom === window ||\n\t\t// @ts-ignore\n\t\tdom === document ||\n\t\t// Firefox has quirky behavior, it can happen that we still get \"canplay\" events when the element is already removed\n\t\tdom instanceof HTMLMediaElement\n\t) {\n\t\tteardown(() => {\n\t\t\tdom.removeEventListener(event_name, target_handler, options);\n\t\t});\n\t}\n}\n\n/**\n * @param {Array<string>} events\n * @returns {void}\n */\nexport function delegate(events) {\n\tfor (var i = 0; i < events.length; i++) {\n\t\tall_registered_events.add(events[i]);\n\t}\n\n\tfor (var fn of root_event_handles) {\n\t\tfn(events);\n\t}\n}\n\n// used to store the reference to the currently propagated event\n// to prevent garbage collection between microtasks in Firefox\n// If the event object is GCed too early, the expando __root property\n// set on the event object is lost, causing the event delegation\n// to process the event twice\nlet last_propagated_event = null;\n\n/**\n * @this {EventTarget}\n * @param {Event} event\n * @returns {void}\n */\nexport function handle_event_propagation(event) {\n\tvar handler_element = this;\n\tvar owner_document = /** @type {Node} */ (handler_element).ownerDocument;\n\tvar event_name = event.type;\n\tvar path = event.composedPath?.() || [];\n\tvar current_target = /** @type {null | Element} */ (path[0] || event.target);\n\n\tlast_propagated_event = event;\n\n\t// composedPath contains list of nodes the event has propagated through.\n\t// We check __root to skip all nodes below it in case this is a\n\t// parent of the __root node, which indicates that there's nested\n\t// mounted apps. In this case we don't want to trigger events multiple times.\n\tvar path_idx = 0;\n\n\t// the `last_propagated_event === event` check is redundant, but\n\t// without it the variable will be DCE'd and things will\n\t// fail mysteriously in Firefox\n\t// @ts-expect-error is added below\n\tvar handled_at = last_propagated_event === event && event.__root;\n\n\tif (handled_at) {\n\t\tvar at_idx = path.indexOf(handled_at);\n\t\tif (\n\t\t\tat_idx !== -1 &&\n\t\t\t(handler_element === document || handler_element === /** @type {any} */ (window))\n\t\t) {\n\t\t\t// This is the fallback document listener or a window listener, but the event was already handled\n\t\t\t// -> ignore, but set handle_at to document/window so that we're resetting the event\n\t\t\t// chain in case someone manually dispatches the same event object again.\n\t\t\t// @ts-expect-error\n\t\t\tevent.__root = handler_element;\n\t\t\treturn;\n\t\t}\n\n\t\t// We're deliberately not skipping if the index is higher, because\n\t\t// someone could create an event programmatically and emit it multiple times,\n\t\t// in which case we want to handle the whole propagation chain properly each time.\n\t\t// (this will only be a false negative if the event is dispatched multiple times and\n\t\t// the fallback document listener isn't reached in between, but that's super rare)\n\t\tvar handler_idx = path.indexOf(handler_element);\n\t\tif (handler_idx === -1) {\n\t\t\t// handle_idx can theoretically be -1 (happened in some JSDOM testing scenarios with an event listener on the window object)\n\t\t\t// so guard against that, too, and assume that everything was handled at this point.\n\t\t\treturn;\n\t\t}\n\n\t\tif (at_idx <= handler_idx) {\n\t\t\tpath_idx = at_idx;\n\t\t}\n\t}\n\n\tcurrent_target = /** @type {Element} */ (path[path_idx] || event.target);\n\t// there can only be one delegated event per element, and we either already handled the current target,\n\t// or this is the very first target in the chain which has a non-delegated listener, in which case it's safe\n\t// to handle a possible delegated event on it later (through the root delegation listener for example).\n\tif (current_target === handler_element) return;\n\n\t// Proxy currentTarget to correct target\n\tdefine_property(event, 'currentTarget', {\n\t\tconfigurable: true,\n\t\tget() {\n\t\t\treturn current_target || owner_document;\n\t\t}\n\t});\n\n\t// This started because of Chromium issue https://chromestatus.com/feature/5128696823545856,\n\t// where removal or moving of of the DOM can cause sync `blur` events to fire, which can cause logic\n\t// to run inside the current `active_reaction`, which isn't what we want at all. However, on reflection,\n\t// it's probably best that all event handled by Svelte have this behaviour, as we don't really want\n\t// an event handler to run in the context of another reaction or effect.\n\tvar previous_reaction = active_reaction;\n\tvar previous_effect = active_effect;\n\tset_active_reaction(null);\n\tset_active_effect(null);\n\n\ttry {\n\t\t/**\n\t\t * @type {unknown}\n\t\t */\n\t\tvar throw_error;\n\t\t/**\n\t\t * @type {unknown[]}\n\t\t */\n\t\tvar other_errors = [];\n\n\t\twhile (current_target !== null) {\n\t\t\t/** @type {null | Element} */\n\t\t\tvar parent_element =\n\t\t\t\tcurrent_target.assignedSlot ||\n\t\t\t\tcurrent_target.parentNode ||\n\t\t\t\t/** @type {any} */ (current_target).host ||\n\t\t\t\tnull;\n\n\t\t\ttry {\n\t\t\t\t// @ts-expect-error\n\t\t\t\tvar delegated = current_target['__' + event_name];\n\n\t\t\t\tif (\n\t\t\t\t\tdelegated != null &&\n\t\t\t\t\t(!(/** @type {any} */ (current_target).disabled) ||\n\t\t\t\t\t\t// DOM could've been updated already by the time this is reached, so we check this as well\n\t\t\t\t\t\t// -> the target could not have been disabled because it emits the event in the first place\n\t\t\t\t\t\tevent.target === current_target)\n\t\t\t\t) {\n\t\t\t\t\tdelegated.call(current_target, event);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tif (throw_error) {\n\t\t\t\t\tother_errors.push(error);\n\t\t\t\t} else {\n\t\t\t\t\tthrow_error = error;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (event.cancelBubble || parent_element === handler_element || parent_element === null) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcurrent_target = parent_element;\n\t\t}\n\n\t\tif (throw_error) {\n\t\t\tfor (let error of other_errors) {\n\t\t\t\t// Throw the rest of the errors, one-by-one on a microtask\n\t\t\t\tqueueMicrotask(() => {\n\t\t\t\t\tthrow error;\n\t\t\t\t});\n\t\t\t}\n\t\t\tthrow throw_error;\n\t\t}\n\t} finally {\n\t\t// @ts-expect-error is used above\n\t\tevent.__root = handler_element;\n\t\t// @ts-ignore remove proxy on currentTarget\n\t\tdelete event.currentTarget;\n\t\tset_active_reaction(previous_reaction);\n\t\tset_active_effect(previous_effect);\n\t}\n}\n\n/**\n * In dev, warn if an event handler is not a function, as it means the\n * user probably called the handler or forgot to add a `() =>`\n * @param {() => (event: Event, ...args: any) => void} thunk\n * @param {EventTarget} element\n * @param {[Event, ...any]} args\n * @param {any} component\n * @param {[number, number]} [loc]\n * @param {boolean} [remove_parens]\n */\nexport function apply(\n\tthunk,\n\telement,\n\targs,\n\tcomponent,\n\tloc,\n\thas_side_effects = false,\n\tremove_parens = false\n) {\n\tlet handler;\n\tlet error;\n\n\ttry {\n\t\thandler = thunk();\n\t} catch (e) {\n\t\terror = e;\n\t}\n\n\tif (typeof handler !== 'function' && (has_side_effects || handler != null || error)) {\n\t\tconst filename = component?.[FILENAME];\n\t\tconst location = loc ? ` at ${filename}:${loc[0]}:${loc[1]}` : ` in ${filename}`;\n\t\tconst phase = args[0]?.eventPhase < Event.BUBBLING_PHASE ? 'capture' : '';\n\t\tconst event_name = args[0]?.type + phase;\n\t\tconst description = `\\`${event_name}\\` handler${location}`;\n\t\tconst suggestion = remove_parens ? 'remove the trailing `()`' : 'add a leading `() =>`';\n\n\t\tw.event_handler_invalid(description, suggestion);\n\n\t\tif (error) {\n\t\t\tthrow error;\n\t\t}\n\t}\n\thandler?.apply(element, args);\n}\n","/** @param {string} html */\nexport function create_fragment_from_html(html) {\n\tvar elem = document.createElement('template');\n\telem.innerHTML = html.replaceAll('<!>', '<!---->'); // XHTML compliance\n\treturn elem.content;\n}\n","/** @import { Effect, EffectNodes, TemplateNode } from '#client' */\n/** @import { TemplateStructure } from './types' */\nimport { hydrate_next, hydrate_node, hydrating, set_hydrate_node } from './hydration.js';\nimport {\n\tcreate_text,\n\tget_first_child,\n\tis_firefox,\n\tcreate_element,\n\tcreate_fragment,\n\tcreate_comment,\n\tset_attribute\n} from './operations.js';\nimport { create_fragment_from_html } from './reconciler.js';\nimport { active_effect } from '../runtime.js';\nimport {\n\tNAMESPACE_MATHML,\n\tNAMESPACE_SVG,\n\tTEMPLATE_FRAGMENT,\n\tTEMPLATE_USE_IMPORT_NODE,\n\tTEMPLATE_USE_MATHML,\n\tTEMPLATE_USE_SVG\n} from '../../../constants.js';\nimport { COMMENT_NODE, DOCUMENT_FRAGMENT_NODE, EFFECT_RAN, TEXT_NODE } from '#client/constants';\n\n/**\n * @param {TemplateNode} start\n * @param {TemplateNode | null} end\n */\nexport function assign_nodes(start, end) {\n\tvar effect = /** @type {Effect} */ (active_effect);\n\tif (effect.nodes === null) {\n\t\teffect.nodes = { start, end, a: null, t: null };\n\t}\n}\n\n/**\n * @param {string} content\n * @param {number} flags\n * @returns {() => Node | Node[]}\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function from_html(content, flags) {\n\tvar is_fragment = (flags & TEMPLATE_FRAGMENT) !== 0;\n\tvar use_import_node = (flags & TEMPLATE_USE_IMPORT_NODE) !== 0;\n\n\t/** @type {Node} */\n\tvar node;\n\n\t/**\n\t * Whether or not the first item is a text/element node. If not, we need to\n\t * create an additional comment node to act as `effect.nodes.start`\n\t */\n\tvar has_start = !content.startsWith('<!>');\n\n\treturn () => {\n\t\tif (hydrating) {\n\t\t\tassign_nodes(hydrate_node, null);\n\t\t\treturn hydrate_node;\n\t\t}\n\n\t\tif (node === undefined) {\n\t\t\tnode = create_fragment_from_html(has_start ? content : '<!>' + content);\n\t\t\tif (!is_fragment) node = /** @type {TemplateNode} */ (get_first_child(node));\n\t\t}\n\n\t\tvar clone = /** @type {TemplateNode} */ (\n\t\t\tuse_import_node || is_firefox ? document.importNode(node, true) : node.cloneNode(true)\n\t\t);\n\n\t\tif (is_fragment) {\n\t\t\tvar start = /** @type {TemplateNode} */ (get_first_child(clone));\n\t\t\tvar end = /** @type {TemplateNode} */ (clone.lastChild);\n\n\t\t\tassign_nodes(start, end);\n\t\t} else {\n\t\t\tassign_nodes(clone, clone);\n\t\t}\n\n\t\treturn clone;\n\t};\n}\n\n/**\n * @param {string} content\n * @param {number} flags\n * @param {'svg' | 'math'} ns\n * @returns {() => Node | Node[]}\n */\n/*#__NO_SIDE_EFFECTS__*/\nfunction from_namespace(content, flags, ns = 'svg') {\n\t/**\n\t * Whether or not the first item is a text/element node. If not, we need to\n\t * create an additional comment node to act as `effect.nodes.start`\n\t */\n\tvar has_start = !content.startsWith('<!>');\n\n\tvar is_fragment = (flags & TEMPLATE_FRAGMENT) !== 0;\n\tvar wrapped = `<${ns}>${has_start ? content : '<!>' + content}</${ns}>`;\n\n\t/** @type {Element | DocumentFragment} */\n\tvar node;\n\n\treturn () => {\n\t\tif (hydrating) {\n\t\t\tassign_nodes(hydrate_node, null);\n\t\t\treturn hydrate_node;\n\t\t}\n\n\t\tif (!node) {\n\t\t\tvar fragment = /** @type {DocumentFragment} */ (create_fragment_from_html(wrapped));\n\t\t\tvar root = /** @type {Element} */ (get_first_child(fragment));\n\n\t\t\tif (is_fragment) {\n\t\t\t\tnode = document.createDocumentFragment();\n\t\t\t\twhile (get_first_child(root)) {\n\t\t\t\t\tnode.appendChild(/** @type {TemplateNode} */ (get_first_child(root)));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnode = /** @type {Element} */ (get_first_child(root));\n\t\t\t}\n\t\t}\n\n\t\tvar clone = /** @type {TemplateNode} */ (node.cloneNode(true));\n\n\t\tif (is_fragment) {\n\t\t\tvar start = /** @type {TemplateNode} */ (get_first_child(clone));\n\t\t\tvar end = /** @type {TemplateNode} */ (clone.lastChild);\n\n\t\t\tassign_nodes(start, end);\n\t\t} else {\n\t\t\tassign_nodes(clone, clone);\n\t\t}\n\n\t\treturn clone;\n\t};\n}\n\n/**\n * @param {string} content\n * @param {number} flags\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function from_svg(content, flags) {\n\treturn from_namespace(content, flags, 'svg');\n}\n\n/**\n * @param {string} content\n * @param {number} flags\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function from_mathml(content, flags) {\n\treturn from_namespace(content, flags, 'math');\n}\n\n/**\n * @param {TemplateStructure[]} structure\n * @param {typeof NAMESPACE_SVG | typeof NAMESPACE_MATHML | undefined} [ns]\n */\nfunction fragment_from_tree(structure, ns) {\n\tvar fragment = create_fragment();\n\n\tfor (var item of structure) {\n\t\tif (typeof item === 'string') {\n\t\t\tfragment.append(create_text(item));\n\t\t\tcontinue;\n\t\t}\n\n\t\t// if `preserveComments === true`, comments are represented as `['// <data>']`\n\t\tif (item === undefined || item[0][0] === '/') {\n\t\t\tfragment.append(create_comment(item ? item[0].slice(3) : ''));\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst [name, attributes, ...children] = item;\n\n\t\tconst namespace = name === 'svg' ? NAMESPACE_SVG : name === 'math' ? NAMESPACE_MATHML : ns;\n\n\t\tvar element = create_element(name, namespace, attributes?.is);\n\n\t\tfor (var key in attributes) {\n\t\t\tset_attribute(element, key, attributes[key]);\n\t\t}\n\n\t\tif (children.length > 0) {\n\t\t\tvar target =\n\t\t\t\telement.tagName === 'TEMPLATE'\n\t\t\t\t\t? /** @type {HTMLTemplateElement} */ (element).content\n\t\t\t\t\t: element;\n\n\t\t\ttarget.append(\n\t\t\t\tfragment_from_tree(children, element.tagName === 'foreignObject' ? undefined : namespace)\n\t\t\t);\n\t\t}\n\n\t\tfragment.append(element);\n\t}\n\n\treturn fragment;\n}\n\n/**\n * @param {TemplateStructure[]} structure\n * @param {number} flags\n * @returns {() => Node | Node[]}\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function from_tree(structure, flags) {\n\tvar is_fragment = (flags & TEMPLATE_FRAGMENT) !== 0;\n\tvar use_import_node = (flags & TEMPLATE_USE_IMPORT_NODE) !== 0;\n\n\t/** @type {Node} */\n\tvar node;\n\n\treturn () => {\n\t\tif (hydrating) {\n\t\t\tassign_nodes(hydrate_node, null);\n\t\t\treturn hydrate_node;\n\t\t}\n\n\t\tif (node === undefined) {\n\t\t\tconst ns =\n\t\t\t\t(flags & TEMPLATE_USE_SVG) !== 0\n\t\t\t\t\t? NAMESPACE_SVG\n\t\t\t\t\t: (flags & TEMPLATE_USE_MATHML) !== 0\n\t\t\t\t\t\t? NAMESPACE_MATHML\n\t\t\t\t\t\t: undefined;\n\n\t\t\tnode = fragment_from_tree(structure, ns);\n\t\t\tif (!is_fragment) node = /** @type {TemplateNode} */ (get_first_child(node));\n\t\t}\n\n\t\tvar clone = /** @type {TemplateNode} */ (\n\t\t\tuse_import_node || is_firefox ? document.importNode(node, true) : node.cloneNode(true)\n\t\t);\n\n\t\tif (is_fragment) {\n\t\t\tvar start = /** @type {TemplateNode} */ (get_first_child(clone));\n\t\t\tvar end = /** @type {TemplateNode} */ (clone.lastChild);\n\n\t\t\tassign_nodes(start, end);\n\t\t} else {\n\t\t\tassign_nodes(clone, clone);\n\t\t}\n\n\t\treturn clone;\n\t};\n}\n\n/**\n * @param {() => Element | DocumentFragment} fn\n */\nexport function with_script(fn) {\n\treturn () => run_scripts(fn());\n}\n\n/**\n * Creating a document fragment from HTML that contains script tags will not execute\n * the scripts. We need to replace the script tags with new ones so that they are executed.\n * @param {Element | DocumentFragment} node\n * @returns {Node | Node[]}\n */\nfunction run_scripts(node) {\n\t// scripts were SSR'd, in which case they will run\n\tif (hydrating) return node;\n\n\tconst is_fragment = node.nodeType === DOCUMENT_FRAGMENT_NODE;\n\tconst scripts =\n\t\t/** @type {HTMLElement} */ (node).tagName === 'SCRIPT'\n\t\t\t? [/** @type {HTMLScriptElement} */ (node)]\n\t\t\t: node.querySelectorAll('script');\n\n\tconst effect = /** @type {Effect & { nodes: EffectNodes }} */ (active_effect);\n\n\tfor (const script of scripts) {\n\t\tconst clone = document.createElement('script');\n\t\tfor (var attribute of script.attributes) {\n\t\t\tclone.setAttribute(attribute.name, attribute.value);\n\t\t}\n\n\t\tclone.textContent = script.textContent;\n\n\t\t// The script has changed - if it's at the edges, the effect now points at dead nodes\n\t\tif (is_fragment ? node.firstChild === script : node === script) {\n\t\t\teffect.nodes.start = clone;\n\t\t}\n\t\tif (is_fragment ? node.lastChild === script : node === script) {\n\t\t\teffect.nodes.end = clone;\n\t\t}\n\n\t\tscript.replaceWith(clone);\n\t}\n\treturn node;\n}\n\n/**\n * Don't mark this as side-effect-free, hydration needs to walk all nodes\n * @param {any} value\n */\nexport function text(value = '') {\n\tif (!hydrating) {\n\t\tvar t = create_text(value + '');\n\t\tassign_nodes(t, t);\n\t\treturn t;\n\t}\n\n\tvar node = hydrate_node;\n\n\tif (node.nodeType !== TEXT_NODE) {\n\t\t// if an {expression} is empty during SSR, we need to insert an empty text node\n\t\tnode.before((node = create_text()));\n\t\tset_hydrate_node(node);\n\t}\n\n\tassign_nodes(node, node);\n\treturn node;\n}\n\n/**\n * @returns {TemplateNode | DocumentFragment}\n */\nexport function comment() {\n\t// we're not delegating to `template` here for performance reasons\n\tif (hydrating) {\n\t\tassign_nodes(hydrate_node, null);\n\t\treturn hydrate_node;\n\t}\n\n\tvar frag = document.createDocumentFragment();\n\tvar start = document.createComment('');\n\tvar anchor = create_text();\n\tfrag.append(start, anchor);\n\n\tassign_nodes(start, anchor);\n\n\treturn frag;\n}\n\n/**\n * Assign the created (or in hydration mode, traversed) dom elements to the current block\n * and insert the elements into the dom (in client mode).\n * @param {Text | Comment | Element} anchor\n * @param {DocumentFragment | Element} dom\n */\nexport function append(anchor, dom) {\n\tif (hydrating) {\n\t\tvar effect = /** @type {Effect & { nodes: EffectNodes }} */ (active_effect);\n\n\t\t// When hydrating and outer component and an inner component is async, i.e. blocked on a promise,\n\t\t// then by the time the inner resolves we have already advanced to the end of the hydrated nodes\n\t\t// of the parent component. Check for defined for that reason to avoid rewinding the parent's end marker.\n\t\tif ((effect.f & EFFECT_RAN) === 0 || effect.nodes.end === null) {\n\t\t\teffect.nodes.end = hydrate_node;\n\t\t}\n\n\t\thydrate_next();\n\t\treturn;\n\t}\n\n\tif (anchor === null) {\n\t\t// edge case  void `<svelte:element>` with content\n\t\treturn;\n\t}\n\n\tanchor.before(/** @type {Node} */ (dom));\n}\n\n/**\n * Create (or hydrate) an unique UID for the component instance.\n */\nexport function props_id() {\n\tif (\n\t\thydrating &&\n\t\thydrate_node &&\n\t\thydrate_node.nodeType === COMMENT_NODE &&\n\t\thydrate_node.textContent?.startsWith(`$`)\n\t) {\n\t\tconst id = hydrate_node.textContent.substring(1);\n\t\thydrate_next();\n\t\treturn id;\n\t}\n\n\t// @ts-expect-error This way we ensure the id is unique even across Svelte runtimes\n\t(window.__svelte ??= {}).uid ??= 1;\n\n\t// @ts-expect-error\n\treturn `c${window.__svelte.uid++}`;\n}\n","/** @import { ComponentContext, Effect, EffectNodes, TemplateNode } from '#client' */\n/** @import { Component, ComponentType, SvelteComponent, MountOptions } from '../../index.js' */\nimport { DEV } from 'esm-env';\nimport {\n\tclear_text_content,\n\tcreate_text,\n\tget_first_child,\n\tget_next_sibling,\n\tinit_operations\n} from './dom/operations.js';\nimport { HYDRATION_END, HYDRATION_ERROR, HYDRATION_START } from '../../constants.js';\nimport { active_effect } from './runtime.js';\nimport { push, pop, component_context } from './context.js';\nimport { component_root } from './reactivity/effects.js';\nimport { hydrate_node, hydrating, set_hydrate_node, set_hydrating } from './dom/hydration.js';\nimport { array_from } from '../shared/utils.js';\nimport {\n\tall_registered_events,\n\thandle_event_propagation,\n\troot_event_handles\n} from './dom/elements/events.js';\nimport * as w from './warnings.js';\nimport * as e from './errors.js';\nimport { assign_nodes } from './dom/template.js';\nimport { is_passive_event } from '../../utils.js';\nimport { COMMENT_NODE, STATE_SYMBOL } from './constants.js';\nimport { boundary } from './dom/blocks/boundary.js';\n\n/**\n * This is normally true  block effects should run their intro transitions \n * but is false during hydration (unless `options.intro` is `true`) and\n * when creating the children of a `<svelte:element>` that just changed tag\n */\nexport let should_intro = true;\n\n/** @param {boolean} value */\nexport function set_should_intro(value) {\n\tshould_intro = value;\n}\n\n/**\n * @param {Element} text\n * @param {string} value\n * @returns {void}\n */\nexport function set_text(text, value) {\n\t// For objects, we apply string coercion (which might make things like $state array references in the template reactive) before diffing\n\tvar str = value == null ? '' : typeof value === 'object' ? value + '' : value;\n\t// @ts-expect-error\n\tif (str !== (text.__t ??= text.nodeValue)) {\n\t\t// @ts-expect-error\n\t\ttext.__t = str;\n\t\ttext.nodeValue = str + '';\n\t}\n}\n\n/**\n * Mounts a component to the given target and returns the exports and potentially the props (if compiled with `accessors: true`) of the component.\n * Transitions will play during the initial render unless the `intro` option is set to `false`.\n *\n * @template {Record<string, any>} Props\n * @template {Record<string, any>} Exports\n * @param {ComponentType<SvelteComponent<Props>> | Component<Props, Exports, any>} component\n * @param {MountOptions<Props>} options\n * @returns {Exports}\n */\nexport function mount(component, options) {\n\treturn _mount(component, options);\n}\n\n/**\n * Hydrates a component on the given target and returns the exports and potentially the props (if compiled with `accessors: true`) of the component\n *\n * @template {Record<string, any>} Props\n * @template {Record<string, any>} Exports\n * @param {ComponentType<SvelteComponent<Props>> | Component<Props, Exports, any>} component\n * @param {{} extends Props ? {\n * \t\ttarget: Document | Element | ShadowRoot;\n * \t\tprops?: Props;\n * \t\tevents?: Record<string, (e: any) => any>;\n *  \tcontext?: Map<any, any>;\n * \t\tintro?: boolean;\n * \t\trecover?: boolean;\n * \t} : {\n * \t\ttarget: Document | Element | ShadowRoot;\n * \t\tprops: Props;\n * \t\tevents?: Record<string, (e: any) => any>;\n *  \tcontext?: Map<any, any>;\n * \t\tintro?: boolean;\n * \t\trecover?: boolean;\n * \t}} options\n * @returns {Exports}\n */\nexport function hydrate(component, options) {\n\tinit_operations();\n\toptions.intro = options.intro ?? false;\n\tconst target = options.target;\n\tconst was_hydrating = hydrating;\n\tconst previous_hydrate_node = hydrate_node;\n\n\ttry {\n\t\tvar anchor = get_first_child(target);\n\n\t\twhile (\n\t\t\tanchor &&\n\t\t\t(anchor.nodeType !== COMMENT_NODE || /** @type {Comment} */ (anchor).data !== HYDRATION_START)\n\t\t) {\n\t\t\tanchor = get_next_sibling(anchor);\n\t\t}\n\n\t\tif (!anchor) {\n\t\t\tthrow HYDRATION_ERROR;\n\t\t}\n\n\t\tset_hydrating(true);\n\t\tset_hydrate_node(/** @type {Comment} */ (anchor));\n\n\t\tconst instance = _mount(component, { ...options, anchor });\n\n\t\tset_hydrating(false);\n\n\t\treturn /**  @type {Exports} */ (instance);\n\t} catch (error) {\n\t\t// re-throw Svelte errors - they are certainly not related to hydration\n\t\tif (\n\t\t\terror instanceof Error &&\n\t\t\terror.message.split('\\n').some((line) => line.startsWith('https://svelte.dev/e/'))\n\t\t) {\n\t\t\tthrow error;\n\t\t}\n\t\tif (error !== HYDRATION_ERROR) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn('Failed to hydrate: ', error);\n\t\t}\n\n\t\tif (options.recover === false) {\n\t\t\te.hydration_failed();\n\t\t}\n\n\t\t// If an error occurred above, the operations might not yet have been initialised.\n\t\tinit_operations();\n\t\tclear_text_content(target);\n\n\t\tset_hydrating(false);\n\t\treturn mount(component, options);\n\t} finally {\n\t\tset_hydrating(was_hydrating);\n\t\tset_hydrate_node(previous_hydrate_node);\n\t}\n}\n\n/** @type {Map<string, number>} */\nconst document_listeners = new Map();\n\n/**\n * @template {Record<string, any>} Exports\n * @param {ComponentType<SvelteComponent<any>> | Component<any>} Component\n * @param {MountOptions} options\n * @returns {Exports}\n */\nfunction _mount(Component, { target, anchor, props = {}, events, context, intro = true }) {\n\tinit_operations();\n\n\t/** @type {Set<string>} */\n\tvar registered_events = new Set();\n\n\t/** @param {Array<string>} events */\n\tvar event_handle = (events) => {\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tvar event_name = events[i];\n\n\t\t\tif (registered_events.has(event_name)) continue;\n\t\t\tregistered_events.add(event_name);\n\n\t\t\tvar passive = is_passive_event(event_name);\n\n\t\t\t// Add the event listener to both the container and the document.\n\t\t\t// The container listener ensures we catch events from within in case\n\t\t\t// the outer content stops propagation of the event.\n\t\t\ttarget.addEventListener(event_name, handle_event_propagation, { passive });\n\n\t\t\tvar n = document_listeners.get(event_name);\n\n\t\t\tif (n === undefined) {\n\t\t\t\t// The document listener ensures we catch events that originate from elements that were\n\t\t\t\t// manually moved outside of the container (e.g. via manual portals).\n\t\t\t\tdocument.addEventListener(event_name, handle_event_propagation, { passive });\n\t\t\t\tdocument_listeners.set(event_name, 1);\n\t\t\t} else {\n\t\t\t\tdocument_listeners.set(event_name, n + 1);\n\t\t\t}\n\t\t}\n\t};\n\n\tevent_handle(array_from(all_registered_events));\n\troot_event_handles.add(event_handle);\n\n\t/** @type {Exports} */\n\t// @ts-expect-error will be defined because the render effect runs synchronously\n\tvar component = undefined;\n\n\tvar unmount = component_root(() => {\n\t\tvar anchor_node = anchor ?? target.appendChild(create_text());\n\n\t\tboundary(\n\t\t\t/** @type {TemplateNode} */ (anchor_node),\n\t\t\t{\n\t\t\t\tpending: () => {}\n\t\t\t},\n\t\t\t(anchor_node) => {\n\t\t\t\tif (context) {\n\t\t\t\t\tpush({});\n\t\t\t\t\tvar ctx = /** @type {ComponentContext} */ (component_context);\n\t\t\t\t\tctx.c = context;\n\t\t\t\t}\n\n\t\t\t\tif (events) {\n\t\t\t\t\t// We can't spread the object or else we'd lose the state proxy stuff, if it is one\n\t\t\t\t\t/** @type {any} */ (props).$$events = events;\n\t\t\t\t}\n\n\t\t\t\tif (hydrating) {\n\t\t\t\t\tassign_nodes(/** @type {TemplateNode} */ (anchor_node), null);\n\t\t\t\t}\n\n\t\t\t\tshould_intro = intro;\n\t\t\t\t// @ts-expect-error the public typings are not what the actual function looks like\n\t\t\t\tcomponent = Component(anchor_node, props) || {};\n\t\t\t\tshould_intro = true;\n\n\t\t\t\tif (hydrating) {\n\t\t\t\t\t/** @type {Effect & { nodes: EffectNodes }} */ (active_effect).nodes.end = hydrate_node;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\thydrate_node === null ||\n\t\t\t\t\t\thydrate_node.nodeType !== COMMENT_NODE ||\n\t\t\t\t\t\t/** @type {Comment} */ (hydrate_node).data !== HYDRATION_END\n\t\t\t\t\t) {\n\t\t\t\t\t\tw.hydration_mismatch();\n\t\t\t\t\t\tthrow HYDRATION_ERROR;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (context) {\n\t\t\t\t\tpop();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn () => {\n\t\t\tfor (var event_name of registered_events) {\n\t\t\t\ttarget.removeEventListener(event_name, handle_event_propagation);\n\n\t\t\t\tvar n = /** @type {number} */ (document_listeners.get(event_name));\n\n\t\t\t\tif (--n === 0) {\n\t\t\t\t\tdocument.removeEventListener(event_name, handle_event_propagation);\n\t\t\t\t\tdocument_listeners.delete(event_name);\n\t\t\t\t} else {\n\t\t\t\t\tdocument_listeners.set(event_name, n);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\troot_event_handles.delete(event_handle);\n\n\t\t\tif (anchor_node !== anchor) {\n\t\t\t\tanchor_node.parentNode?.removeChild(anchor_node);\n\t\t\t}\n\t\t};\n\t});\n\n\tmounted_components.set(component, unmount);\n\treturn component;\n}\n\n/**\n * References of the components that were mounted or hydrated.\n * Uses a `WeakMap` to avoid memory leaks.\n */\nlet mounted_components = new WeakMap();\n\n/**\n * Unmounts a component that was previously mounted using `mount` or `hydrate`.\n *\n * Since 5.13.0, if `options.outro` is `true`, [transitions](https://svelte.dev/docs/svelte/transition) will play before the component is removed from the DOM.\n *\n * Returns a `Promise` that resolves after transitions have completed if `options.outro` is true, or immediately otherwise (prior to 5.13.0, returns `void`).\n *\n * ```js\n * import { mount, unmount } from 'svelte';\n * import App from './App.svelte';\n *\n * const app = mount(App, { target: document.body });\n *\n * // later...\n * unmount(app, { outro: true });\n * ```\n * @param {Record<string, any>} component\n * @param {{ outro?: boolean }} [options]\n * @returns {Promise<void>}\n */\nexport function unmount(component, options) {\n\tconst fn = mounted_components.get(component);\n\n\tif (fn) {\n\t\tmounted_components.delete(component);\n\t\treturn fn(options);\n\t}\n\n\tif (DEV) {\n\t\tif (STATE_SYMBOL in component) {\n\t\t\tw.state_proxy_unmount();\n\t\t} else {\n\t\t\tw.lifecycle_double_unmount();\n\t\t}\n\t}\n\n\treturn Promise.resolve();\n}\n","/** @import { Effect, TemplateNode } from '#client' */\nimport { Batch, current_batch } from '../../reactivity/batch.js';\nimport {\n\tbranch,\n\tdestroy_effect,\n\tmove_effect,\n\tpause_effect,\n\tresume_effect\n} from '../../reactivity/effects.js';\nimport { hydrate_node, hydrating } from '../hydration.js';\nimport { create_text, should_defer_append } from '../operations.js';\n\n/**\n * @typedef {{ effect: Effect, fragment: DocumentFragment }} Branch\n */\n\n/**\n * @template Key\n */\nexport class BranchManager {\n\t/** @type {TemplateNode} */\n\tanchor;\n\n\t/** @type {Map<Batch, Key>} */\n\t#batches = new Map();\n\n\t/**\n\t * Map of keys to effects that are currently rendered in the DOM.\n\t * These effects are visible and actively part of the document tree.\n\t * Example:\n\t * ```\n\t * {#if condition}\n\t * \tfoo\n\t * {:else}\n\t * \tbar\n\t * {/if}\n\t * ```\n\t * Can result in the entries `true->Effect` and `false->Effect`\n\t * @type {Map<Key, Effect>}\n\t */\n\t#onscreen = new Map();\n\n\t/**\n\t * Similar to #onscreen with respect to the keys, but contains branches that are not yet\n\t * in the DOM, because their insertion is deferred.\n\t * @type {Map<Key, Branch>}\n\t */\n\t#offscreen = new Map();\n\n\t/**\n\t * Keys of effects that are currently outroing\n\t * @type {Set<Key>}\n\t */\n\t#outroing = new Set();\n\n\t/**\n\t * Whether to pause (i.e. outro) on change, or destroy immediately.\n\t * This is necessary for `<svelte:element>`\n\t */\n\t#transition = true;\n\n\t/**\n\t * @param {TemplateNode} anchor\n\t * @param {boolean} transition\n\t */\n\tconstructor(anchor, transition = true) {\n\t\tthis.anchor = anchor;\n\t\tthis.#transition = transition;\n\t}\n\n\t#commit = () => {\n\t\tvar batch = /** @type {Batch} */ (current_batch);\n\n\t\t// if this batch was made obsolete, bail\n\t\tif (!this.#batches.has(batch)) return;\n\n\t\tvar key = /** @type {Key} */ (this.#batches.get(batch));\n\n\t\tvar onscreen = this.#onscreen.get(key);\n\n\t\tif (onscreen) {\n\t\t\t// effect is already in the DOM  abort any current outro\n\t\t\tresume_effect(onscreen);\n\t\t\tthis.#outroing.delete(key);\n\t\t} else {\n\t\t\t// effect is currently offscreen. put it in the DOM\n\t\t\tvar offscreen = this.#offscreen.get(key);\n\n\t\t\tif (offscreen) {\n\t\t\t\tthis.#onscreen.set(key, offscreen.effect);\n\t\t\t\tthis.#offscreen.delete(key);\n\n\t\t\t\t// remove the anchor...\n\t\t\t\t/** @type {TemplateNode} */ (offscreen.fragment.lastChild).remove();\n\n\t\t\t\t// ...and append the fragment\n\t\t\t\tthis.anchor.before(offscreen.fragment);\n\t\t\t\tonscreen = offscreen.effect;\n\t\t\t}\n\t\t}\n\n\t\tfor (const [b, k] of this.#batches) {\n\t\t\tthis.#batches.delete(b);\n\n\t\t\tif (b === batch) {\n\t\t\t\t// keep values for newer batches\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst offscreen = this.#offscreen.get(k);\n\n\t\t\tif (offscreen) {\n\t\t\t\t// for older batches, destroy offscreen effects\n\t\t\t\t// as they will never be committed\n\t\t\t\tdestroy_effect(offscreen.effect);\n\t\t\t\tthis.#offscreen.delete(k);\n\t\t\t}\n\t\t}\n\n\t\t// outro/destroy all onscreen effects...\n\t\tfor (const [k, effect] of this.#onscreen) {\n\t\t\t// ...except the one that was just committed\n\t\t\t//    or those that are already outroing (else the transition is aborted and the effect destroyed right away)\n\t\t\tif (k === key || this.#outroing.has(k)) continue;\n\n\t\t\tconst on_destroy = () => {\n\t\t\t\tconst keys = Array.from(this.#batches.values());\n\n\t\t\t\tif (keys.includes(k)) {\n\t\t\t\t\t// keep the effect offscreen, as another batch will need it\n\t\t\t\t\tvar fragment = document.createDocumentFragment();\n\t\t\t\t\tmove_effect(effect, fragment);\n\n\t\t\t\t\tfragment.append(create_text()); // TODO can we avoid this?\n\n\t\t\t\t\tthis.#offscreen.set(k, { effect, fragment });\n\t\t\t\t} else {\n\t\t\t\t\tdestroy_effect(effect);\n\t\t\t\t}\n\n\t\t\t\tthis.#outroing.delete(k);\n\t\t\t\tthis.#onscreen.delete(k);\n\t\t\t};\n\n\t\t\tif (this.#transition || !onscreen) {\n\t\t\t\tthis.#outroing.add(k);\n\t\t\t\tpause_effect(effect, on_destroy, false);\n\t\t\t} else {\n\t\t\t\ton_destroy();\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * @param {Batch} batch\n\t */\n\t#discard = (batch) => {\n\t\tthis.#batches.delete(batch);\n\n\t\tconst keys = Array.from(this.#batches.values());\n\n\t\tfor (const [k, branch] of this.#offscreen) {\n\t\t\tif (!keys.includes(k)) {\n\t\t\t\tdestroy_effect(branch.effect);\n\t\t\t\tthis.#offscreen.delete(k);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t *\n\t * @param {any} key\n\t * @param {null | ((target: TemplateNode) => void)} fn\n\t */\n\tensure(key, fn) {\n\t\tvar batch = /** @type {Batch} */ (current_batch);\n\t\tvar defer = should_defer_append();\n\n\t\tif (fn && !this.#onscreen.has(key) && !this.#offscreen.has(key)) {\n\t\t\tif (defer) {\n\t\t\t\tvar fragment = document.createDocumentFragment();\n\t\t\t\tvar target = create_text();\n\n\t\t\t\tfragment.append(target);\n\n\t\t\t\tthis.#offscreen.set(key, {\n\t\t\t\t\teffect: branch(() => fn(target)),\n\t\t\t\t\tfragment\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.#onscreen.set(\n\t\t\t\t\tkey,\n\t\t\t\t\tbranch(() => fn(this.anchor))\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.#batches.set(batch, key);\n\n\t\tif (defer) {\n\t\t\tfor (const [k, effect] of this.#onscreen) {\n\t\t\t\tif (k === key) {\n\t\t\t\t\tbatch.skipped_effects.delete(effect);\n\t\t\t\t} else {\n\t\t\t\t\tbatch.skipped_effects.add(effect);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const [k, branch] of this.#offscreen) {\n\t\t\t\tif (k === key) {\n\t\t\t\t\tbatch.skipped_effects.delete(branch.effect);\n\t\t\t\t} else {\n\t\t\t\t\tbatch.skipped_effects.add(branch.effect);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbatch.oncommit(this.#commit);\n\t\t\tbatch.ondiscard(this.#discard);\n\t\t} else {\n\t\t\tif (hydrating) {\n\t\t\t\tthis.anchor = hydrate_node;\n\t\t\t}\n\n\t\t\tthis.#commit();\n\t\t}\n\t}\n}\n","/** @import { TemplateNode } from '#client' */\nimport { EFFECT_TRANSPARENT } from '#client/constants';\nimport {\n\thydrate_next,\n\thydrating,\n\tread_hydration_instruction,\n\tskip_nodes,\n\tset_hydrate_node,\n\tset_hydrating\n} from '../hydration.js';\nimport { block } from '../../reactivity/effects.js';\nimport { HYDRATION_START_ELSE } from '../../../../constants.js';\nimport { BranchManager } from './branches.js';\n\n// TODO reinstate https://github.com/sveltejs/svelte/pull/15250\n\n/**\n * @param {TemplateNode} node\n * @param {(branch: (fn: (anchor: Node) => void, flag?: boolean) => void) => void} fn\n * @param {boolean} [elseif] True if this is an `{:else if ...}` block rather than an `{#if ...}`, as that affects which transitions are considered 'local'\n * @returns {void}\n */\nexport function if_block(node, fn, elseif = false) {\n\tif (hydrating) {\n\t\thydrate_next();\n\t}\n\n\tvar branches = new BranchManager(node);\n\tvar flags = elseif ? EFFECT_TRANSPARENT : 0;\n\n\t/**\n\t * @param {boolean} condition,\n\t * @param {null | ((anchor: Node) => void)} fn\n\t */\n\tfunction update_branch(condition, fn) {\n\t\tif (hydrating) {\n\t\t\tconst is_else = read_hydration_instruction(node) === HYDRATION_START_ELSE;\n\n\t\t\tif (condition === is_else) {\n\t\t\t\t// Hydration mismatch: remove everything inside the anchor and start fresh.\n\t\t\t\t// This could happen with `{#if browser}...{/if}`, for example\n\t\t\t\tvar anchor = skip_nodes();\n\n\t\t\t\tset_hydrate_node(anchor);\n\t\t\t\tbranches.anchor = anchor;\n\n\t\t\t\tset_hydrating(false);\n\t\t\t\tbranches.ensure(condition, fn);\n\t\t\t\tset_hydrating(true);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tbranches.ensure(condition, fn);\n\t}\n\n\tblock(() => {\n\t\tvar has_branch = false;\n\n\t\tfn((fn, flag = true) => {\n\t\t\thas_branch = true;\n\t\t\tupdate_branch(flag, fn);\n\t\t});\n\n\t\tif (!has_branch) {\n\t\t\tupdate_branch(false, null);\n\t\t}\n\t}, flags);\n}\n","/** @import { EachItem, EachOutroGroup, EachState, Effect, EffectNodes, MaybeSource, Source, TemplateNode, TransitionManager, Value } from '#client' */\n/** @import { Batch } from '../../reactivity/batch.js'; */\nimport {\n\tEACH_INDEX_REACTIVE,\n\tEACH_IS_ANIMATED,\n\tEACH_IS_CONTROLLED,\n\tEACH_ITEM_IMMUTABLE,\n\tEACH_ITEM_REACTIVE,\n\tHYDRATION_END,\n\tHYDRATION_START_ELSE\n} from '../../../../constants.js';\nimport {\n\thydrate_next,\n\thydrate_node,\n\thydrating,\n\tread_hydration_instruction,\n\tskip_nodes,\n\tset_hydrate_node,\n\tset_hydrating\n} from '../hydration.js';\nimport {\n\tclear_text_content,\n\tcreate_text,\n\tget_first_child,\n\tget_next_sibling,\n\tshould_defer_append\n} from '../operations.js';\nimport {\n\tblock,\n\tbranch,\n\tdestroy_effect,\n\tpause_effect,\n\tresume_effect\n} from '../../reactivity/effects.js';\nimport { source, mutable_source, internal_set } from '../../reactivity/sources.js';\nimport { array_from, is_array } from '../../../shared/utils.js';\nimport { COMMENT_NODE, EFFECT_OFFSCREEN, INERT } from '#client/constants';\nimport { queue_micro_task } from '../task.js';\nimport { get } from '../../runtime.js';\nimport { DEV } from 'esm-env';\nimport { derived_safe_equal } from '../../reactivity/deriveds.js';\nimport { current_batch } from '../../reactivity/batch.js';\n\n// When making substantive changes to this file, validate them with the each block stress test:\n// https://svelte.dev/playground/1972b2cf46564476ad8c8c6405b23b7b\n// This test also exists in this repo, as `packages/svelte/tests/manual/each-stress-test`\n\n/**\n * @param {any} _\n * @param {number} i\n */\nexport function index(_, i) {\n\treturn i;\n}\n\n/**\n * Pause multiple effects simultaneously, and coordinate their\n * subsequent destruction. Used in each blocks\n * @param {EachState} state\n * @param {Effect[]} to_destroy\n * @param {null | Node} controlled_anchor\n */\nfunction pause_effects(state, to_destroy, controlled_anchor) {\n\t/** @type {TransitionManager[]} */\n\tvar transitions = [];\n\tvar length = to_destroy.length;\n\n\t/** @type {EachOutroGroup} */\n\tvar group;\n\tvar remaining = to_destroy.length;\n\n\tfor (var i = 0; i < length; i++) {\n\t\tlet effect = to_destroy[i];\n\n\t\tpause_effect(\n\t\t\teffect,\n\t\t\t() => {\n\t\t\t\tif (group) {\n\t\t\t\t\tgroup.pending.delete(effect);\n\t\t\t\t\tgroup.done.add(effect);\n\n\t\t\t\t\tif (group.pending.size === 0) {\n\t\t\t\t\t\tvar groups = /** @type {Set<EachOutroGroup>} */ (state.outrogroups);\n\n\t\t\t\t\t\tdestroy_effects(array_from(group.done));\n\t\t\t\t\t\tgroups.delete(group);\n\n\t\t\t\t\t\tif (groups.size === 0) {\n\t\t\t\t\t\t\tstate.outrogroups = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tremaining -= 1;\n\t\t\t\t}\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t}\n\n\tif (remaining === 0) {\n\t\t// If we're in a controlled each block (i.e. the block is the only child of an\n\t\t// element), and we are removing all items, _and_ there are no out transitions,\n\t\t// we can use the fast path  emptying the element and replacing the anchor\n\t\tvar fast_path = transitions.length === 0 && controlled_anchor !== null;\n\n\t\tif (fast_path) {\n\t\t\tvar anchor = /** @type {Element} */ (controlled_anchor);\n\t\t\tvar parent_node = /** @type {Element} */ (anchor.parentNode);\n\n\t\t\tclear_text_content(parent_node);\n\t\t\tparent_node.append(anchor);\n\n\t\t\tstate.items.clear();\n\t\t}\n\n\t\tdestroy_effects(to_destroy, !fast_path);\n\t} else {\n\t\tgroup = {\n\t\t\tpending: new Set(to_destroy),\n\t\t\tdone: new Set()\n\t\t};\n\n\t\t(state.outrogroups ??= new Set()).add(group);\n\t}\n}\n\n/**\n * @param {Effect[]} to_destroy\n * @param {boolean} remove_dom\n */\nfunction destroy_effects(to_destroy, remove_dom = true) {\n\t// TODO only destroy effects if no pending batch needs them. otherwise,\n\t// just re-add the `EFFECT_OFFSCREEN` flag\n\tfor (var i = 0; i < to_destroy.length; i++) {\n\t\tdestroy_effect(to_destroy[i], remove_dom);\n\t}\n}\n\n/** @type {TemplateNode} */\nvar offscreen_anchor;\n\n/**\n * @template V\n * @param {Element | Comment} node The next sibling node, or the parent node if this is a 'controlled' block\n * @param {number} flags\n * @param {() => V[]} get_collection\n * @param {(value: V, index: number) => any} get_key\n * @param {(anchor: Node, item: MaybeSource<V>, index: MaybeSource<number>) => void} render_fn\n * @param {null | ((anchor: Node) => void)} fallback_fn\n * @returns {void}\n */\nexport function each(node, flags, get_collection, get_key, render_fn, fallback_fn = null) {\n\tvar anchor = node;\n\n\t/** @type {Map<any, EachItem>} */\n\tvar items = new Map();\n\n\tvar is_controlled = (flags & EACH_IS_CONTROLLED) !== 0;\n\n\tif (is_controlled) {\n\t\tvar parent_node = /** @type {Element} */ (node);\n\n\t\tanchor = hydrating\n\t\t\t? set_hydrate_node(get_first_child(parent_node))\n\t\t\t: parent_node.appendChild(create_text());\n\t}\n\n\tif (hydrating) {\n\t\thydrate_next();\n\t}\n\n\t/** @type {Effect | null} */\n\tvar fallback = null;\n\n\t// TODO: ideally we could use derived for runes mode but because of the ability\n\t// to use a store which can be mutated, we can't do that here as mutating a store\n\t// will still result in the collection array being the same from the store\n\tvar each_array = derived_safe_equal(() => {\n\t\tvar collection = get_collection();\n\n\t\treturn is_array(collection) ? collection : collection == null ? [] : array_from(collection);\n\t});\n\n\t/** @type {V[]} */\n\tvar array;\n\n\tvar first_run = true;\n\n\tfunction commit() {\n\t\tstate.fallback = fallback;\n\t\treconcile(state, array, anchor, flags, get_key);\n\n\t\tif (fallback !== null) {\n\t\t\tif (array.length === 0) {\n\t\t\t\tif ((fallback.f & EFFECT_OFFSCREEN) === 0) {\n\t\t\t\t\tresume_effect(fallback);\n\t\t\t\t} else {\n\t\t\t\t\tfallback.f ^= EFFECT_OFFSCREEN;\n\t\t\t\t\tmove(fallback, null, anchor);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpause_effect(fallback, () => {\n\t\t\t\t\t// TODO only null out if no pending batch needs it,\n\t\t\t\t\t// otherwise re-add `fallback.fragment` and move the\n\t\t\t\t\t// effect into it\n\t\t\t\t\tfallback = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tvar effect = block(() => {\n\t\tarray = /** @type {V[]} */ (get(each_array));\n\t\tvar length = array.length;\n\n\t\t/** `true` if there was a hydration mismatch. Needs to be a `let` or else it isn't treeshaken out */\n\t\tlet mismatch = false;\n\n\t\tif (hydrating) {\n\t\t\tvar is_else = read_hydration_instruction(anchor) === HYDRATION_START_ELSE;\n\n\t\t\tif (is_else !== (length === 0)) {\n\t\t\t\t// hydration mismatch  remove the server-rendered DOM and start over\n\t\t\t\tanchor = skip_nodes();\n\n\t\t\t\tset_hydrate_node(anchor);\n\t\t\t\tset_hydrating(false);\n\t\t\t\tmismatch = true;\n\t\t\t}\n\t\t}\n\n\t\tvar keys = new Set();\n\t\tvar batch = /** @type {Batch} */ (current_batch);\n\t\tvar defer = should_defer_append();\n\n\t\tfor (var index = 0; index < length; index += 1) {\n\t\t\tif (\n\t\t\t\thydrating &&\n\t\t\t\thydrate_node.nodeType === COMMENT_NODE &&\n\t\t\t\t/** @type {Comment} */ (hydrate_node).data === HYDRATION_END\n\t\t\t) {\n\t\t\t\t// The server rendered fewer items than expected,\n\t\t\t\t// so break out and continue appending non-hydrated items\n\t\t\t\tanchor = /** @type {Comment} */ (hydrate_node);\n\t\t\t\tmismatch = true;\n\t\t\t\tset_hydrating(false);\n\t\t\t}\n\n\t\t\tvar value = array[index];\n\t\t\tvar key = get_key(value, index);\n\n\t\t\tvar item = first_run ? null : items.get(key);\n\n\t\t\tif (item) {\n\t\t\t\t// update before reconciliation, to trigger any async updates\n\t\t\t\tif (item.v) internal_set(item.v, value);\n\t\t\t\tif (item.i) internal_set(item.i, index);\n\n\t\t\t\tif (defer) {\n\t\t\t\t\tbatch.skipped_effects.delete(item.e);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem = create_item(\n\t\t\t\t\titems,\n\t\t\t\t\tfirst_run ? anchor : (offscreen_anchor ??= create_text()),\n\t\t\t\t\tvalue,\n\t\t\t\t\tkey,\n\t\t\t\t\tindex,\n\t\t\t\t\trender_fn,\n\t\t\t\t\tflags,\n\t\t\t\t\tget_collection\n\t\t\t\t);\n\n\t\t\t\tif (!first_run) {\n\t\t\t\t\titem.e.f |= EFFECT_OFFSCREEN;\n\t\t\t\t}\n\n\t\t\t\titems.set(key, item);\n\t\t\t}\n\n\t\t\tkeys.add(key);\n\t\t}\n\n\t\tif (length === 0 && fallback_fn && !fallback) {\n\t\t\tif (first_run) {\n\t\t\t\tfallback = branch(() => fallback_fn(anchor));\n\t\t\t} else {\n\t\t\t\tfallback = branch(() => fallback_fn((offscreen_anchor ??= create_text())));\n\t\t\t\tfallback.f |= EFFECT_OFFSCREEN;\n\t\t\t}\n\t\t}\n\n\t\t// remove excess nodes\n\t\tif (hydrating && length > 0) {\n\t\t\tset_hydrate_node(skip_nodes());\n\t\t}\n\n\t\tif (!first_run) {\n\t\t\tif (defer) {\n\t\t\t\tfor (const [key, item] of items) {\n\t\t\t\t\tif (!keys.has(key)) {\n\t\t\t\t\t\tbatch.skipped_effects.add(item.e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbatch.oncommit(commit);\n\t\t\t\tbatch.ondiscard(() => {\n\t\t\t\t\t// TODO presumably we need to do something here?\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcommit();\n\t\t\t}\n\t\t}\n\n\t\tif (mismatch) {\n\t\t\t// continue in hydration mode\n\t\t\tset_hydrating(true);\n\t\t}\n\n\t\t// When we mount the each block for the first time, the collection won't be\n\t\t// connected to this effect as the effect hasn't finished running yet and its deps\n\t\t// won't be assigned. However, it's possible that when reconciling the each block\n\t\t// that a mutation occurred and it's made the collection MAYBE_DIRTY, so reading the\n\t\t// collection again can provide consistency to the reactive graph again as the deriveds\n\t\t// will now be `CLEAN`.\n\t\tget(each_array);\n\t});\n\n\t/** @type {EachState} */\n\tvar state = { effect, flags, items, outrogroups: null, fallback };\n\n\tfirst_run = false;\n\n\tif (hydrating) {\n\t\tanchor = hydrate_node;\n\t}\n}\n\n/**\n * Add, remove, or reorder items output by an each block as its input changes\n * @template V\n * @param {EachState} state\n * @param {Array<V>} array\n * @param {Element | Comment | Text} anchor\n * @param {number} flags\n * @param {(value: V, index: number) => any} get_key\n * @returns {void}\n */\nfunction reconcile(state, array, anchor, flags, get_key) {\n\tvar is_animated = (flags & EACH_IS_ANIMATED) !== 0;\n\n\tvar length = array.length;\n\tvar items = state.items;\n\tvar current = state.effect.first;\n\n\t/** @type {undefined | Set<Effect>} */\n\tvar seen;\n\n\t/** @type {Effect | null} */\n\tvar prev = null;\n\n\t/** @type {undefined | Set<Effect>} */\n\tvar to_animate;\n\n\t/** @type {Effect[]} */\n\tvar matched = [];\n\n\t/** @type {Effect[]} */\n\tvar stashed = [];\n\n\t/** @type {V} */\n\tvar value;\n\n\t/** @type {any} */\n\tvar key;\n\n\t/** @type {Effect | undefined} */\n\tvar effect;\n\n\t/** @type {number} */\n\tvar i;\n\n\tif (is_animated) {\n\t\tfor (i = 0; i < length; i += 1) {\n\t\t\tvalue = array[i];\n\t\t\tkey = get_key(value, i);\n\t\t\teffect = /** @type {EachItem} */ (items.get(key)).e;\n\n\t\t\t// offscreen == coming in now, no animation in that case,\n\t\t\t// else this would happen https://github.com/sveltejs/svelte/issues/17181\n\t\t\tif ((effect.f & EFFECT_OFFSCREEN) === 0) {\n\t\t\t\teffect.nodes?.a?.measure();\n\t\t\t\t(to_animate ??= new Set()).add(effect);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (i = 0; i < length; i += 1) {\n\t\tvalue = array[i];\n\t\tkey = get_key(value, i);\n\n\t\teffect = /** @type {EachItem} */ (items.get(key)).e;\n\n\t\tif (state.outrogroups !== null) {\n\t\t\tfor (const group of state.outrogroups) {\n\t\t\t\tgroup.pending.delete(effect);\n\t\t\t\tgroup.done.delete(effect);\n\t\t\t}\n\t\t}\n\n\t\tif ((effect.f & EFFECT_OFFSCREEN) !== 0) {\n\t\t\teffect.f ^= EFFECT_OFFSCREEN;\n\n\t\t\tif (effect === current) {\n\t\t\t\tmove(effect, null, anchor);\n\t\t\t} else {\n\t\t\t\tvar next = prev ? prev.next : current;\n\n\t\t\t\tif (effect === state.effect.last) {\n\t\t\t\t\tstate.effect.last = effect.prev;\n\t\t\t\t}\n\n\t\t\t\tif (effect.prev) effect.prev.next = effect.next;\n\t\t\t\tif (effect.next) effect.next.prev = effect.prev;\n\t\t\t\tlink(state, prev, effect);\n\t\t\t\tlink(state, effect, next);\n\n\t\t\t\tmove(effect, next, anchor);\n\t\t\t\tprev = effect;\n\n\t\t\t\tmatched = [];\n\t\t\t\tstashed = [];\n\n\t\t\t\tcurrent = prev.next;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tif ((effect.f & INERT) !== 0) {\n\t\t\tresume_effect(effect);\n\t\t\tif (is_animated) {\n\t\t\t\teffect.nodes?.a?.unfix();\n\t\t\t\t(to_animate ??= new Set()).delete(effect);\n\t\t\t}\n\t\t}\n\n\t\tif (effect !== current) {\n\t\t\tif (seen !== undefined && seen.has(effect)) {\n\t\t\t\tif (matched.length < stashed.length) {\n\t\t\t\t\t// more efficient to move later items to the front\n\t\t\t\t\tvar start = stashed[0];\n\t\t\t\t\tvar j;\n\n\t\t\t\t\tprev = start.prev;\n\n\t\t\t\t\tvar a = matched[0];\n\t\t\t\t\tvar b = matched[matched.length - 1];\n\n\t\t\t\t\tfor (j = 0; j < matched.length; j += 1) {\n\t\t\t\t\t\tmove(matched[j], start, anchor);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (j = 0; j < stashed.length; j += 1) {\n\t\t\t\t\t\tseen.delete(stashed[j]);\n\t\t\t\t\t}\n\n\t\t\t\t\tlink(state, a.prev, b.next);\n\t\t\t\t\tlink(state, prev, a);\n\t\t\t\t\tlink(state, b, start);\n\n\t\t\t\t\tcurrent = start;\n\t\t\t\t\tprev = b;\n\t\t\t\t\ti -= 1;\n\n\t\t\t\t\tmatched = [];\n\t\t\t\t\tstashed = [];\n\t\t\t\t} else {\n\t\t\t\t\t// more efficient to move earlier items to the back\n\t\t\t\t\tseen.delete(effect);\n\t\t\t\t\tmove(effect, current, anchor);\n\n\t\t\t\t\tlink(state, effect.prev, effect.next);\n\t\t\t\t\tlink(state, effect, prev === null ? state.effect.first : prev.next);\n\t\t\t\t\tlink(state, prev, effect);\n\n\t\t\t\t\tprev = effect;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmatched = [];\n\t\t\tstashed = [];\n\n\t\t\twhile (current !== null && current !== effect) {\n\t\t\t\t(seen ??= new Set()).add(current);\n\t\t\t\tstashed.push(current);\n\t\t\t\tcurrent = current.next;\n\t\t\t}\n\n\t\t\tif (current === null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tif ((effect.f & EFFECT_OFFSCREEN) === 0) {\n\t\t\tmatched.push(effect);\n\t\t}\n\n\t\tprev = effect;\n\t\tcurrent = effect.next;\n\t}\n\n\tif (state.outrogroups !== null) {\n\t\tfor (const group of state.outrogroups) {\n\t\t\tif (group.pending.size === 0) {\n\t\t\t\tdestroy_effects(array_from(group.done));\n\t\t\t\tstate.outrogroups?.delete(group);\n\t\t\t}\n\t\t}\n\n\t\tif (state.outrogroups.size === 0) {\n\t\t\tstate.outrogroups = null;\n\t\t}\n\t}\n\n\tif (current !== null || seen !== undefined) {\n\t\t/** @type {Effect[]} */\n\t\tvar to_destroy = [];\n\n\t\tif (seen !== undefined) {\n\t\t\tfor (effect of seen) {\n\t\t\t\tif ((effect.f & INERT) === 0) {\n\t\t\t\t\tto_destroy.push(effect);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\twhile (current !== null) {\n\t\t\t// If the each block isn't inert, then inert effects are currently outroing and will be removed once the transition is finished\n\t\t\tif ((current.f & INERT) === 0 && current !== state.fallback) {\n\t\t\t\tto_destroy.push(current);\n\t\t\t}\n\n\t\t\tcurrent = current.next;\n\t\t}\n\n\t\tvar destroy_length = to_destroy.length;\n\n\t\tif (destroy_length > 0) {\n\t\t\tvar controlled_anchor = (flags & EACH_IS_CONTROLLED) !== 0 && length === 0 ? anchor : null;\n\n\t\t\tif (is_animated) {\n\t\t\t\tfor (i = 0; i < destroy_length; i += 1) {\n\t\t\t\t\tto_destroy[i].nodes?.a?.measure();\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < destroy_length; i += 1) {\n\t\t\t\t\tto_destroy[i].nodes?.a?.fix();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpause_effects(state, to_destroy, controlled_anchor);\n\t\t}\n\t}\n\n\tif (is_animated) {\n\t\tqueue_micro_task(() => {\n\t\t\tif (to_animate === undefined) return;\n\t\t\tfor (effect of to_animate) {\n\t\t\t\teffect.nodes?.a?.apply();\n\t\t\t}\n\t\t});\n\t}\n}\n\n/**\n * @template V\n * @param {Map<any, EachItem>} items\n * @param {Node} anchor\n * @param {V} value\n * @param {unknown} key\n * @param {number} index\n * @param {(anchor: Node, item: V | Source<V>, index: number | Value<number>, collection: () => V[]) => void} render_fn\n * @param {number} flags\n * @param {() => V[]} get_collection\n * @returns {EachItem}\n */\nfunction create_item(items, anchor, value, key, index, render_fn, flags, get_collection) {\n\tvar v =\n\t\t(flags & EACH_ITEM_REACTIVE) !== 0\n\t\t\t? (flags & EACH_ITEM_IMMUTABLE) === 0\n\t\t\t\t? mutable_source(value, false, false)\n\t\t\t\t: source(value)\n\t\t\t: null;\n\n\tvar i = (flags & EACH_INDEX_REACTIVE) !== 0 ? source(index) : null;\n\n\tif (DEV && v) {\n\t\t// For tracing purposes, we need to link the source signal we create with the\n\t\t// collection + index so that tracing works as intended\n\t\tv.trace = () => {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\t\t\tget_collection()[i?.v ?? index];\n\t\t};\n\t}\n\n\treturn {\n\t\tv,\n\t\ti,\n\t\te: branch(() => {\n\t\t\trender_fn(anchor, v ?? value, i ?? index, get_collection);\n\n\t\t\treturn () => {\n\t\t\t\titems.delete(key);\n\t\t\t};\n\t\t})\n\t};\n}\n\n/**\n * @param {Effect} effect\n * @param {Effect | null} next\n * @param {Text | Element | Comment} anchor\n */\nfunction move(effect, next, anchor) {\n\tif (!effect.nodes) return;\n\n\tvar node = effect.nodes.start;\n\tvar end = effect.nodes.end;\n\n\tvar dest =\n\t\tnext && (next.f & EFFECT_OFFSCREEN) === 0\n\t\t\t? /** @type {EffectNodes} */ (next.nodes).start\n\t\t\t: anchor;\n\n\twhile (node !== null) {\n\t\tvar next_node = /** @type {TemplateNode} */ (get_next_sibling(node));\n\t\tdest.before(node);\n\n\t\tif (node === end) {\n\t\t\treturn;\n\t\t}\n\n\t\tnode = next_node;\n\t}\n}\n\n/**\n * @param {EachState} state\n * @param {Effect | null} prev\n * @param {Effect | null} next\n */\nfunction link(state, prev, next) {\n\tif (prev === null) {\n\t\tstate.effect.first = next;\n\t} else {\n\t\tprev.next = next;\n\t}\n\n\tif (next === null) {\n\t\tstate.effect.last = prev;\n\t} else {\n\t\tnext.prev = prev;\n\t}\n}\n","import { escape_html } from '../../escaping.js';\nimport { clsx as _clsx } from 'clsx';\n\n/**\n * `<div translate={false}>` should be rendered as `<div translate=\"no\">` and _not_\n * `<div translate=\"false\">`, which is equivalent to `<div translate=\"yes\">`. There\n * may be other odd cases that need to be added to this list in future\n * @type {Record<string, Map<any, string>>}\n */\nconst replacements = {\n\ttranslate: new Map([\n\t\t[true, 'yes'],\n\t\t[false, 'no']\n\t])\n};\n\n/**\n * @template V\n * @param {string} name\n * @param {V} value\n * @param {boolean} [is_boolean]\n * @returns {string}\n */\nexport function attr(name, value, is_boolean = false) {\n\t// attribute hidden for values other than \"until-found\" behaves like a boolean attribute\n\tif (name === 'hidden' && value !== 'until-found') {\n\t\tis_boolean = true;\n\t}\n\tif (value == null || (!value && is_boolean)) return '';\n\tconst normalized = (name in replacements && replacements[name].get(value)) || value;\n\tconst assignment = is_boolean ? '' : `=\"${escape_html(normalized, true)}\"`;\n\treturn ` ${name}${assignment}`;\n}\n\n/**\n * Small wrapper around clsx to preserve Svelte's (weird) handling of falsy values.\n * TODO Svelte 6 revisit this, and likely turn all falsy values into the empty string (what clsx also does)\n * @param  {any} value\n */\nexport function clsx(value) {\n\tif (typeof value === 'object') {\n\t\treturn _clsx(value);\n\t} else {\n\t\treturn value ?? '';\n\t}\n}\n\nconst whitespace = [...' \\t\\n\\r\\f\\u00a0\\u000b\\ufeff'];\n\n/**\n * @param {any} value\n * @param {string | null} [hash]\n * @param {Record<string, boolean>} [directives]\n * @returns {string | null}\n */\nexport function to_class(value, hash, directives) {\n\tvar classname = value == null ? '' : '' + value;\n\n\tif (hash) {\n\t\tclassname = classname ? classname + ' ' + hash : hash;\n\t}\n\n\tif (directives) {\n\t\tfor (var key in directives) {\n\t\t\tif (directives[key]) {\n\t\t\t\tclassname = classname ? classname + ' ' + key : key;\n\t\t\t} else if (classname.length) {\n\t\t\t\tvar len = key.length;\n\t\t\t\tvar a = 0;\n\n\t\t\t\twhile ((a = classname.indexOf(key, a)) >= 0) {\n\t\t\t\t\tvar b = a + len;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t(a === 0 || whitespace.includes(classname[a - 1])) &&\n\t\t\t\t\t\t(b === classname.length || whitespace.includes(classname[b]))\n\t\t\t\t\t) {\n\t\t\t\t\t\tclassname = (a === 0 ? '' : classname.substring(0, a)) + classname.substring(b + 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ta = b;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn classname === '' ? null : classname;\n}\n\n/**\n *\n * @param {Record<string,any>} styles\n * @param {boolean} important\n */\nfunction append_styles(styles, important = false) {\n\tvar separator = important ? ' !important;' : ';';\n\tvar css = '';\n\n\tfor (var key in styles) {\n\t\tvar value = styles[key];\n\t\tif (value != null && value !== '') {\n\t\t\tcss += ' ' + key + ': ' + value + separator;\n\t\t}\n\t}\n\n\treturn css;\n}\n\n/**\n * @param {string} name\n * @returns {string}\n */\nfunction to_css_name(name) {\n\tif (name[0] !== '-' || name[1] !== '-') {\n\t\treturn name.toLowerCase();\n\t}\n\treturn name;\n}\n\n/**\n * @param {any} value\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [styles]\n * @returns {string | null}\n */\nexport function to_style(value, styles) {\n\tif (styles) {\n\t\tvar new_style = '';\n\n\t\t/** @type {Record<string,any> | undefined} */\n\t\tvar normal_styles;\n\n\t\t/** @type {Record<string,any> | undefined} */\n\t\tvar important_styles;\n\n\t\tif (Array.isArray(styles)) {\n\t\t\tnormal_styles = styles[0];\n\t\t\timportant_styles = styles[1];\n\t\t} else {\n\t\t\tnormal_styles = styles;\n\t\t}\n\n\t\tif (value) {\n\t\t\tvalue = String(value)\n\t\t\t\t.replaceAll(/\\s*\\/\\*.*?\\*\\/\\s*/g, '')\n\t\t\t\t.trim();\n\n\t\t\t/** @type {boolean | '\"' | \"'\"} */\n\t\t\tvar in_str = false;\n\t\t\tvar in_apo = 0;\n\t\t\tvar in_comment = false;\n\n\t\t\tvar reserved_names = [];\n\n\t\t\tif (normal_styles) {\n\t\t\t\treserved_names.push(...Object.keys(normal_styles).map(to_css_name));\n\t\t\t}\n\t\t\tif (important_styles) {\n\t\t\t\treserved_names.push(...Object.keys(important_styles).map(to_css_name));\n\t\t\t}\n\n\t\t\tvar start_index = 0;\n\t\t\tvar name_index = -1;\n\n\t\t\tconst len = value.length;\n\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\tvar c = value[i];\n\n\t\t\t\tif (in_comment) {\n\t\t\t\t\tif (c === '/' && value[i - 1] === '*') {\n\t\t\t\t\t\tin_comment = false;\n\t\t\t\t\t}\n\t\t\t\t} else if (in_str) {\n\t\t\t\t\tif (in_str === c) {\n\t\t\t\t\t\tin_str = false;\n\t\t\t\t\t}\n\t\t\t\t} else if (c === '/' && value[i + 1] === '*') {\n\t\t\t\t\tin_comment = true;\n\t\t\t\t} else if (c === '\"' || c === \"'\") {\n\t\t\t\t\tin_str = c;\n\t\t\t\t} else if (c === '(') {\n\t\t\t\t\tin_apo++;\n\t\t\t\t} else if (c === ')') {\n\t\t\t\t\tin_apo--;\n\t\t\t\t}\n\n\t\t\t\tif (!in_comment && in_str === false && in_apo === 0) {\n\t\t\t\t\tif (c === ':' && name_index === -1) {\n\t\t\t\t\t\tname_index = i;\n\t\t\t\t\t} else if (c === ';' || i === len - 1) {\n\t\t\t\t\t\tif (name_index !== -1) {\n\t\t\t\t\t\t\tvar name = to_css_name(value.substring(start_index, name_index).trim());\n\n\t\t\t\t\t\t\tif (!reserved_names.includes(name)) {\n\t\t\t\t\t\t\t\tif (c !== ';') {\n\t\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar property = value.substring(start_index, i).trim();\n\t\t\t\t\t\t\t\tnew_style += ' ' + property + ';';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstart_index = i + 1;\n\t\t\t\t\t\tname_index = -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (normal_styles) {\n\t\t\tnew_style += append_styles(normal_styles);\n\t\t}\n\n\t\tif (important_styles) {\n\t\t\tnew_style += append_styles(important_styles, true);\n\t\t}\n\n\t\tnew_style = new_style.trim();\n\t\treturn new_style === '' ? null : new_style;\n\t}\n\n\treturn value == null ? null : String(value);\n}\n","import { to_class } from '../../../shared/attributes.js';\nimport { hydrating } from '../hydration.js';\n\n/**\n * @param {Element} dom\n * @param {boolean | number} is_html\n * @param {string | null} value\n * @param {string} [hash]\n * @param {Record<string, any>} [prev_classes]\n * @param {Record<string, any>} [next_classes]\n * @returns {Record<string, boolean> | undefined}\n */\nexport function set_class(dom, is_html, value, hash, prev_classes, next_classes) {\n\t// @ts-expect-error need to add __className to patched prototype\n\tvar prev = dom.__className;\n\n\tif (\n\t\thydrating ||\n\t\tprev !== value ||\n\t\tprev === undefined // for edge case of `class={undefined}`\n\t) {\n\t\tvar next_class_name = to_class(value, hash, next_classes);\n\n\t\tif (!hydrating || next_class_name !== dom.getAttribute('class')) {\n\t\t\t// Removing the attribute when the value is only an empty string causes\n\t\t\t// performance issues vs simply making the className an empty string. So\n\t\t\t// we should only remove the class if the value is nullish\n\t\t\t// and there no hash/directives :\n\t\t\tif (next_class_name == null) {\n\t\t\t\tdom.removeAttribute('class');\n\t\t\t} else if (is_html) {\n\t\t\t\tdom.className = next_class_name;\n\t\t\t} else {\n\t\t\t\tdom.setAttribute('class', next_class_name);\n\t\t\t}\n\t\t}\n\n\t\t// @ts-expect-error need to add __className to patched prototype\n\t\tdom.__className = value;\n\t} else if (next_classes && prev_classes !== next_classes) {\n\t\tfor (var key in next_classes) {\n\t\t\tvar is_present = !!next_classes[key];\n\n\t\t\tif (prev_classes == null || is_present !== !!prev_classes[key]) {\n\t\t\t\tdom.classList.toggle(key, is_present);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn next_classes;\n}\n","import { to_style } from '../../../shared/attributes.js';\nimport { hydrating } from '../hydration.js';\n\n/**\n * @param {Element & ElementCSSInlineStyle} dom\n * @param {Record<string, any>} prev\n * @param {Record<string, any>} next\n * @param {string} [priority]\n */\nfunction update_styles(dom, prev = {}, next, priority) {\n\tfor (var key in next) {\n\t\tvar value = next[key];\n\n\t\tif (prev[key] !== value) {\n\t\t\tif (next[key] == null) {\n\t\t\t\tdom.style.removeProperty(key);\n\t\t\t} else {\n\t\t\t\tdom.style.setProperty(key, value, priority);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} dom\n * @param {string | null} value\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [prev_styles]\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [next_styles]\n */\nexport function set_style(dom, value, prev_styles, next_styles) {\n\t// @ts-expect-error\n\tvar prev = dom.__style;\n\n\tif (hydrating || prev !== value) {\n\t\tvar next_style_attr = to_style(value, next_styles);\n\n\t\tif (!hydrating || next_style_attr !== dom.getAttribute('style')) {\n\t\t\tif (next_style_attr == null) {\n\t\t\t\tdom.removeAttribute('style');\n\t\t\t} else {\n\t\t\t\tdom.style.cssText = next_style_attr;\n\t\t\t}\n\t\t}\n\n\t\t// @ts-expect-error\n\t\tdom.__style = value;\n\t} else if (next_styles) {\n\t\tif (Array.isArray(next_styles)) {\n\t\t\tupdate_styles(dom, prev_styles?.[0], next_styles[0]);\n\t\t\tupdate_styles(dom, prev_styles?.[1], next_styles[1], 'important');\n\t\t} else {\n\t\t\tupdate_styles(dom, prev_styles, next_styles);\n\t\t}\n\t}\n\n\treturn next_styles;\n}\n","import { effect, teardown } from '../../../reactivity/effects.js';\nimport { listen_to_event_and_reset_event } from './shared.js';\nimport { is } from '../../../proxy.js';\nimport { is_array } from '../../../../shared/utils.js';\nimport * as w from '../../../warnings.js';\nimport { Batch, current_batch, previous_batch } from '../../../reactivity/batch.js';\n\n/**\n * Selects the correct option(s) (depending on whether this is a multiple select)\n * @template V\n * @param {HTMLSelectElement} select\n * @param {V} value\n * @param {boolean} mounting\n */\nexport function select_option(select, value, mounting = false) {\n\tif (select.multiple) {\n\t\t// If value is null or undefined, keep the selection as is\n\t\tif (value == undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If not an array, warn and keep the selection as is\n\t\tif (!is_array(value)) {\n\t\t\treturn w.select_multiple_invalid_value();\n\t\t}\n\n\t\t// Otherwise, update the selection\n\t\tfor (var option of select.options) {\n\t\t\toption.selected = value.includes(get_option_value(option));\n\t\t}\n\n\t\treturn;\n\t}\n\n\tfor (option of select.options) {\n\t\tvar option_value = get_option_value(option);\n\t\tif (is(option_value, value)) {\n\t\t\toption.selected = true;\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (!mounting || value !== undefined) {\n\t\tselect.selectedIndex = -1; // no option should be selected\n\t}\n}\n\n/**\n * Selects the correct option(s) if `value` is given,\n * and then sets up a mutation observer to sync the\n * current selection to the dom when it changes. Such\n * changes could for example occur when options are\n * inside an `#each` block.\n * @param {HTMLSelectElement} select\n */\nexport function init_select(select) {\n\tvar observer = new MutationObserver(() => {\n\t\t// @ts-ignore\n\t\tselect_option(select, select.__value);\n\t\t// Deliberately don't update the potential binding value,\n\t\t// the model should be preserved unless explicitly changed\n\t});\n\n\tobserver.observe(select, {\n\t\t// Listen to option element changes\n\t\tchildList: true,\n\t\tsubtree: true, // because of <optgroup>\n\t\t// Listen to option element value attribute changes\n\t\t// (doesn't get notified of select value changes,\n\t\t// because that property is not reflected as an attribute)\n\t\tattributes: true,\n\t\tattributeFilter: ['value']\n\t});\n\n\tteardown(() => {\n\t\tobserver.disconnect();\n\t});\n}\n\n/**\n * @param {HTMLSelectElement} select\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_select_value(select, get, set = get) {\n\tvar batches = new WeakSet();\n\tvar mounting = true;\n\n\tlisten_to_event_and_reset_event(select, 'change', (is_reset) => {\n\t\tvar query = is_reset ? '[selected]' : ':checked';\n\t\t/** @type {unknown} */\n\t\tvar value;\n\n\t\tif (select.multiple) {\n\t\t\tvalue = [].map.call(select.querySelectorAll(query), get_option_value);\n\t\t} else {\n\t\t\t/** @type {HTMLOptionElement | null} */\n\t\t\tvar selected_option =\n\t\t\t\tselect.querySelector(query) ??\n\t\t\t\t// will fall back to first non-disabled option if no option is selected\n\t\t\t\tselect.querySelector('option:not([disabled])');\n\t\t\tvalue = selected_option && get_option_value(selected_option);\n\t\t}\n\n\t\tset(value);\n\n\t\tif (current_batch !== null) {\n\t\t\tbatches.add(current_batch);\n\t\t}\n\t});\n\n\t// Needs to be an effect, not a render_effect, so that in case of each loops the logic runs after the each block has updated\n\teffect(() => {\n\t\tvar value = get();\n\n\t\tif (select === document.activeElement) {\n\t\t\t// we need both, because in non-async mode, render effects run before previous_batch is set\n\t\t\tvar batch = /** @type {Batch} */ (previous_batch ?? current_batch);\n\n\t\t\t// Don't update the <select> if it is focused. We can get here if, for example,\n\t\t\t// an update is deferred because of async work depending on the select:\n\t\t\t//\n\t\t\t// <select bind:value={selected}>...</select>\n\t\t\t// <p>{await find(selected)}</p>\n\t\t\tif (batches.has(batch)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tselect_option(select, value, mounting);\n\n\t\t// Mounting and value undefined -> take selection from dom\n\t\tif (mounting && value === undefined) {\n\t\t\t/** @type {HTMLOptionElement | null} */\n\t\t\tvar selected_option = select.querySelector(':checked');\n\t\t\tif (selected_option !== null) {\n\t\t\t\tvalue = get_option_value(selected_option);\n\t\t\t\tset(value);\n\t\t\t}\n\t\t}\n\n\t\t// @ts-ignore\n\t\tselect.__value = value;\n\t\tmounting = false;\n\t});\n\n\tinit_select(select);\n}\n\n/** @param {HTMLOptionElement} option */\nfunction get_option_value(option) {\n\t// __value only exists if the <option> has a value attribute\n\tif ('__value' in option) {\n\t\treturn option.__value;\n\t} else {\n\t\treturn option.value;\n\t}\n}\n","/** @import { Effect } from '#client' */\nimport { DEV } from 'esm-env';\nimport { hydrating, set_hydrating } from '../hydration.js';\nimport { get_descriptors, get_prototype_of } from '../../../shared/utils.js';\nimport { create_event, delegate } from './events.js';\nimport { add_form_reset_listener, autofocus } from './misc.js';\nimport * as w from '../../warnings.js';\nimport { LOADING_ATTR_SYMBOL } from '#client/constants';\nimport { queue_micro_task } from '../task.js';\nimport { is_capture_event, can_delegate_event, normalize_attribute } from '../../../../utils.js';\nimport {\n\tactive_effect,\n\tactive_reaction,\n\tget,\n\tset_active_effect,\n\tset_active_reaction\n} from '../../runtime.js';\nimport { attach } from './attachments.js';\nimport { clsx } from '../../../shared/attributes.js';\nimport { set_class } from './class.js';\nimport { set_style } from './style.js';\nimport { ATTACHMENT_KEY, NAMESPACE_HTML, UNINITIALIZED } from '../../../../constants.js';\nimport { branch, destroy_effect, effect, managed } from '../../reactivity/effects.js';\nimport { init_select, select_option } from './bindings/select.js';\nimport { flatten } from '../../reactivity/async.js';\n\nexport const CLASS = Symbol('class');\nexport const STYLE = Symbol('style');\n\nconst IS_CUSTOM_ELEMENT = Symbol('is custom element');\nconst IS_HTML = Symbol('is html');\n\n/**\n * The value/checked attribute in the template actually corresponds to the defaultValue property, so we need\n * to remove it upon hydration to avoid a bug when someone resets the form value.\n * @param {HTMLInputElement} input\n * @returns {void}\n */\nexport function remove_input_defaults(input) {\n\tif (!hydrating) return;\n\n\tvar already_removed = false;\n\n\t// We try and remove the default attributes later, rather than sync during hydration.\n\t// Doing it sync during hydration has a negative impact on performance, but deferring the\n\t// work in an idle task alleviates this greatly. If a form reset event comes in before\n\t// the idle callback, then we ensure the input defaults are cleared just before.\n\tvar remove_defaults = () => {\n\t\tif (already_removed) return;\n\t\talready_removed = true;\n\n\t\t// Remove the attributes but preserve the values\n\t\tif (input.hasAttribute('value')) {\n\t\t\tvar value = input.value;\n\t\t\tset_attribute(input, 'value', null);\n\t\t\tinput.value = value;\n\t\t}\n\n\t\tif (input.hasAttribute('checked')) {\n\t\t\tvar checked = input.checked;\n\t\t\tset_attribute(input, 'checked', null);\n\t\t\tinput.checked = checked;\n\t\t}\n\t};\n\n\t// @ts-expect-error\n\tinput.__on_r = remove_defaults;\n\tqueue_micro_task(remove_defaults);\n\tadd_form_reset_listener();\n}\n\n/**\n * @param {Element} element\n * @param {any} value\n */\nexport function set_value(element, value) {\n\tvar attributes = get_attributes(element);\n\n\tif (\n\t\tattributes.value ===\n\t\t\t(attributes.value =\n\t\t\t\t// treat null and undefined the same for the initial value\n\t\t\t\tvalue ?? undefined) ||\n\t\t// @ts-expect-error\n\t\t// `progress` elements always need their value set when it's `0`\n\t\t(element.value === value && (value !== 0 || element.nodeName !== 'PROGRESS'))\n\t) {\n\t\treturn;\n\t}\n\n\t// @ts-expect-error\n\telement.value = value ?? '';\n}\n\n/**\n * @param {Element} element\n * @param {boolean} checked\n */\nexport function set_checked(element, checked) {\n\tvar attributes = get_attributes(element);\n\n\tif (\n\t\tattributes.checked ===\n\t\t(attributes.checked =\n\t\t\t// treat null and undefined the same for the initial value\n\t\t\tchecked ?? undefined)\n\t) {\n\t\treturn;\n\t}\n\n\t// @ts-expect-error\n\telement.checked = checked;\n}\n\n/**\n * Sets the `selected` attribute on an `option` element.\n * Not set through the property because that doesn't reflect to the DOM,\n * which means it wouldn't be taken into account when a form is reset.\n * @param {HTMLOptionElement} element\n * @param {boolean} selected\n */\nexport function set_selected(element, selected) {\n\tif (selected) {\n\t\t// The selected option could've changed via user selection, and\n\t\t// setting the value without this check would set it back.\n\t\tif (!element.hasAttribute('selected')) {\n\t\t\telement.setAttribute('selected', '');\n\t\t}\n\t} else {\n\t\telement.removeAttribute('selected');\n\t}\n}\n\n/**\n * Applies the default checked property without influencing the current checked property.\n * @param {HTMLInputElement} element\n * @param {boolean} checked\n */\nexport function set_default_checked(element, checked) {\n\tconst existing_value = element.checked;\n\telement.defaultChecked = checked;\n\telement.checked = existing_value;\n}\n\n/**\n * Applies the default value property without influencing the current value property.\n * @param {HTMLInputElement | HTMLTextAreaElement} element\n * @param {string} value\n */\nexport function set_default_value(element, value) {\n\tconst existing_value = element.value;\n\telement.defaultValue = value;\n\telement.value = existing_value;\n}\n\n/**\n * @param {Element} element\n * @param {string} attribute\n * @param {string | null} value\n * @param {boolean} [skip_warning]\n */\nexport function set_attribute(element, attribute, value, skip_warning) {\n\tvar attributes = get_attributes(element);\n\n\tif (hydrating) {\n\t\tattributes[attribute] = element.getAttribute(attribute);\n\n\t\tif (\n\t\t\tattribute === 'src' ||\n\t\t\tattribute === 'srcset' ||\n\t\t\t(attribute === 'href' && element.nodeName === 'LINK')\n\t\t) {\n\t\t\tif (!skip_warning) {\n\t\t\t\tcheck_src_in_dev_hydration(element, attribute, value ?? '');\n\t\t\t}\n\n\t\t\t// If we reset these attributes, they would result in another network request, which we want to avoid.\n\t\t\t// We assume they are the same between client and server as checking if they are equal is expensive\n\t\t\t// (we can't just compare the strings as they can be different between client and server but result in the\n\t\t\t// same url, so we would need to create hidden anchor elements to compare them)\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (attributes[attribute] === (attributes[attribute] = value)) return;\n\n\tif (attribute === 'loading') {\n\t\t// @ts-expect-error\n\t\telement[LOADING_ATTR_SYMBOL] = value;\n\t}\n\n\tif (value == null) {\n\t\telement.removeAttribute(attribute);\n\t} else if (typeof value !== 'string' && get_setters(element).includes(attribute)) {\n\t\t// @ts-ignore\n\t\telement[attribute] = value;\n\t} else {\n\t\telement.setAttribute(attribute, value);\n\t}\n}\n\n/**\n * @param {Element} dom\n * @param {string} attribute\n * @param {string} value\n */\nexport function set_xlink_attribute(dom, attribute, value) {\n\tdom.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\n/**\n * @param {HTMLElement} node\n * @param {string} prop\n * @param {any} value\n */\nexport function set_custom_element_data(node, prop, value) {\n\t// We need to ensure that setting custom element props, which can\n\t// invoke lifecycle methods on other custom elements, does not also\n\t// associate those lifecycle methods with the current active reaction\n\t// or effect\n\tvar previous_reaction = active_reaction;\n\tvar previous_effect = active_effect;\n\n\t// If we're hydrating but the custom element is from Svelte, and it already scaffolded,\n\t// then it might run block logic in hydration mode, which we have to prevent.\n\tlet was_hydrating = hydrating;\n\tif (hydrating) {\n\t\tset_hydrating(false);\n\t}\n\n\tset_active_reaction(null);\n\tset_active_effect(null);\n\n\ttry {\n\t\tif (\n\t\t\t// `style` should use `set_attribute` rather than the setter\n\t\t\tprop !== 'style' &&\n\t\t\t// Don't compute setters for custom elements while they aren't registered yet,\n\t\t\t// because during their upgrade/instantiation they might add more setters.\n\t\t\t// Instead, fall back to a simple \"an object, then set as property\" heuristic.\n\t\t\t(setters_cache.has(node.getAttribute('is') || node.nodeName) ||\n\t\t\t// customElements may not be available in browser extension contexts\n\t\t\t!customElements ||\n\t\t\tcustomElements.get(node.getAttribute('is') || node.tagName.toLowerCase())\n\t\t\t\t? get_setters(node).includes(prop)\n\t\t\t\t: value && typeof value === 'object')\n\t\t) {\n\t\t\t// @ts-expect-error\n\t\t\tnode[prop] = value;\n\t\t} else {\n\t\t\t// We did getters etc checks already, stringify before passing to set_attribute\n\t\t\t// to ensure it doesn't invoke the same logic again, and potentially populating\n\t\t\t// the setters cache too early.\n\t\t\tset_attribute(node, prop, value == null ? value : String(value));\n\t\t}\n\t} finally {\n\t\tset_active_reaction(previous_reaction);\n\t\tset_active_effect(previous_effect);\n\t\tif (was_hydrating) {\n\t\t\tset_hydrating(true);\n\t\t}\n\t}\n}\n\n/**\n * Spreads attributes onto a DOM element, taking into account the currently set attributes\n * @param {Element & ElementCSSInlineStyle} element\n * @param {Record<string | symbol, any> | undefined} prev\n * @param {Record<string | symbol, any>} next New attributes - this function mutates this object\n * @param {string} [css_hash]\n * @param {boolean} [should_remove_defaults]\n * @param {boolean} [skip_warning]\n * @returns {Record<string, any>}\n */\nfunction set_attributes(\n\telement,\n\tprev,\n\tnext,\n\tcss_hash,\n\tshould_remove_defaults = false,\n\tskip_warning = false\n) {\n\tif (hydrating && should_remove_defaults && element.tagName === 'INPUT') {\n\t\tvar input = /** @type {HTMLInputElement} */ (element);\n\t\tvar attribute = input.type === 'checkbox' ? 'defaultChecked' : 'defaultValue';\n\n\t\tif (!(attribute in next)) {\n\t\t\tremove_input_defaults(input);\n\t\t}\n\t}\n\n\tvar attributes = get_attributes(element);\n\n\tvar is_custom_element = attributes[IS_CUSTOM_ELEMENT];\n\tvar preserve_attribute_case = !attributes[IS_HTML];\n\n\t// If we're hydrating but the custom element is from Svelte, and it already scaffolded,\n\t// then it might run block logic in hydration mode, which we have to prevent.\n\tlet is_hydrating_custom_element = hydrating && is_custom_element;\n\tif (is_hydrating_custom_element) {\n\t\tset_hydrating(false);\n\t}\n\n\tvar current = prev || {};\n\tvar is_option_element = element.tagName === 'OPTION';\n\n\tfor (var key in prev) {\n\t\tif (!(key in next)) {\n\t\t\tnext[key] = null;\n\t\t}\n\t}\n\n\tif (next.class) {\n\t\tnext.class = clsx(next.class);\n\t} else if (css_hash || next[CLASS]) {\n\t\tnext.class = null; /* force call to set_class() */\n\t}\n\n\tif (next[STYLE]) {\n\t\tnext.style ??= null; /* force call to set_style() */\n\t}\n\n\tvar setters = get_setters(element);\n\n\t// since key is captured we use const\n\tfor (const key in next) {\n\t\t// let instead of var because referenced in a closure\n\t\tlet value = next[key];\n\n\t\t// Up here because we want to do this for the initial value, too, even if it's undefined,\n\t\t// and this wouldn't be reached in case of undefined because of the equality check below\n\t\tif (is_option_element && key === 'value' && value == null) {\n\t\t\t// The <option> element is a special case because removing the value attribute means\n\t\t\t// the value is set to the text content of the option element, and setting the value\n\t\t\t// to null or undefined means the value is set to the string \"null\" or \"undefined\".\n\t\t\t// To align with how we handle this case in non-spread-scenarios, this logic is needed.\n\t\t\t// There's a super-edge-case bug here that is left in in favor of smaller code size:\n\t\t\t// Because of the \"set missing props to null\" logic above, we can't differentiate\n\t\t\t// between a missing value and an explicitly set value of null or undefined. That means\n\t\t\t// that once set, the value attribute of an <option> element can't be removed. This is\n\t\t\t// a very rare edge case, and removing the attribute altogether isn't possible either\n\t\t\t// for the <option value={undefined}> case, so we're not losing any functionality here.\n\t\t\t// @ts-ignore\n\t\t\telement.value = element.__value = '';\n\t\t\tcurrent[key] = value;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (key === 'class') {\n\t\t\tvar is_html = element.namespaceURI === 'http://www.w3.org/1999/xhtml';\n\t\t\tset_class(element, is_html, value, css_hash, prev?.[CLASS], next[CLASS]);\n\t\t\tcurrent[key] = value;\n\t\t\tcurrent[CLASS] = next[CLASS];\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (key === 'style') {\n\t\t\tset_style(element, value, prev?.[STYLE], next[STYLE]);\n\t\t\tcurrent[key] = value;\n\t\t\tcurrent[STYLE] = next[STYLE];\n\t\t\tcontinue;\n\t\t}\n\n\t\tvar prev_value = current[key];\n\n\t\t// Skip if value is unchanged, unless it's `undefined` and the element still has the attribute\n\t\tif (value === prev_value && !(value === undefined && element.hasAttribute(key))) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tcurrent[key] = value;\n\n\t\tvar prefix = key[0] + key[1]; // this is faster than key.slice(0, 2)\n\t\tif (prefix === '$$') continue;\n\n\t\tif (prefix === 'on') {\n\t\t\t/** @type {{ capture?: true }} */\n\t\t\tconst opts = {};\n\t\t\tconst event_handle_key = '$$' + key;\n\t\t\tlet event_name = key.slice(2);\n\t\t\tvar delegated = can_delegate_event(event_name);\n\n\t\t\tif (is_capture_event(event_name)) {\n\t\t\t\tevent_name = event_name.slice(0, -7);\n\t\t\t\topts.capture = true;\n\t\t\t}\n\n\t\t\tif (!delegated && prev_value) {\n\t\t\t\t// Listening to same event but different handler -> our handle function below takes care of this\n\t\t\t\t// If we were to remove and add listeners in this case, it could happen that the event is \"swallowed\"\n\t\t\t\t// (the browser seems to not know yet that a new one exists now) and doesn't reach the handler\n\t\t\t\t// https://github.com/sveltejs/svelte/issues/11903\n\t\t\t\tif (value != null) continue;\n\n\t\t\t\telement.removeEventListener(event_name, current[event_handle_key], opts);\n\t\t\t\tcurrent[event_handle_key] = null;\n\t\t\t}\n\n\t\t\tif (value != null) {\n\t\t\t\tif (!delegated) {\n\t\t\t\t\t/**\n\t\t\t\t\t * @this {any}\n\t\t\t\t\t * @param {Event} evt\n\t\t\t\t\t */\n\t\t\t\t\tfunction handle(evt) {\n\t\t\t\t\t\tcurrent[key].call(this, evt);\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrent[event_handle_key] = create_event(event_name, element, handle, opts);\n\t\t\t\t} else {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\telement[`__${event_name}`] = value;\n\t\t\t\t\tdelegate([event_name]);\n\t\t\t\t}\n\t\t\t} else if (delegated) {\n\t\t\t\t// @ts-ignore\n\t\t\t\telement[`__${event_name}`] = undefined;\n\t\t\t}\n\t\t} else if (key === 'style') {\n\t\t\t// avoid using the setter\n\t\t\tset_attribute(element, key, value);\n\t\t} else if (key === 'autofocus') {\n\t\t\tautofocus(/** @type {HTMLElement} */ (element), Boolean(value));\n\t\t} else if (!is_custom_element && (key === '__value' || (key === 'value' && value != null))) {\n\t\t\t// @ts-ignore We're not running this for custom elements because __value is actually\n\t\t\t// how Lit stores the current value on the element, and messing with that would break things.\n\t\t\telement.value = element.__value = value;\n\t\t} else if (key === 'selected' && is_option_element) {\n\t\t\tset_selected(/** @type {HTMLOptionElement} */ (element), value);\n\t\t} else {\n\t\t\tvar name = key;\n\t\t\tif (!preserve_attribute_case) {\n\t\t\t\tname = normalize_attribute(name);\n\t\t\t}\n\n\t\t\tvar is_default = name === 'defaultValue' || name === 'defaultChecked';\n\n\t\t\tif (value == null && !is_custom_element && !is_default) {\n\t\t\t\tattributes[key] = null;\n\n\t\t\t\tif (name === 'value' || name === 'checked') {\n\t\t\t\t\t// removing value/checked also removes defaultValue/defaultChecked  preserve\n\t\t\t\t\tlet input = /** @type {HTMLInputElement} */ (element);\n\t\t\t\t\tconst use_default = prev === undefined;\n\t\t\t\t\tif (name === 'value') {\n\t\t\t\t\t\tlet previous = input.defaultValue;\n\t\t\t\t\t\tinput.removeAttribute(name);\n\t\t\t\t\t\tinput.defaultValue = previous;\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tinput.value = input.__value = use_default ? previous : null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet previous = input.defaultChecked;\n\t\t\t\t\t\tinput.removeAttribute(name);\n\t\t\t\t\t\tinput.defaultChecked = previous;\n\t\t\t\t\t\tinput.checked = use_default ? previous : false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\telement.removeAttribute(key);\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tis_default ||\n\t\t\t\t(setters.includes(name) && (is_custom_element || typeof value !== 'string'))\n\t\t\t) {\n\t\t\t\t// @ts-ignore\n\t\t\t\telement[name] = value;\n\t\t\t\t// remove it from attributes's cache\n\t\t\t\tif (name in attributes) attributes[name] = UNINITIALIZED;\n\t\t\t} else if (typeof value !== 'function') {\n\t\t\t\tset_attribute(element, name, value, skip_warning);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (is_hydrating_custom_element) {\n\t\tset_hydrating(true);\n\t}\n\n\treturn current;\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} element\n * @param {(...expressions: any) => Record<string | symbol, any>} fn\n * @param {Array<() => any>} sync\n * @param {Array<() => Promise<any>>} async\n * @param {Array<Promise<void>>} blockers\n * @param {string} [css_hash]\n * @param {boolean} [should_remove_defaults]\n * @param {boolean} [skip_warning]\n */\nexport function attribute_effect(\n\telement,\n\tfn,\n\tsync = [],\n\tasync = [],\n\tblockers = [],\n\tcss_hash,\n\tshould_remove_defaults = false,\n\tskip_warning = false\n) {\n\tflatten(blockers, sync, async, (values) => {\n\t\t/** @type {Record<string | symbol, any> | undefined} */\n\t\tvar prev = undefined;\n\n\t\t/** @type {Record<symbol, Effect>} */\n\t\tvar effects = {};\n\n\t\tvar is_select = element.nodeName === 'SELECT';\n\t\tvar inited = false;\n\n\t\tmanaged(() => {\n\t\t\tvar next = fn(...values.map(get));\n\t\t\t/** @type {Record<string | symbol, any>} */\n\t\t\tvar current = set_attributes(\n\t\t\t\telement,\n\t\t\t\tprev,\n\t\t\t\tnext,\n\t\t\t\tcss_hash,\n\t\t\t\tshould_remove_defaults,\n\t\t\t\tskip_warning\n\t\t\t);\n\n\t\t\tif (inited && is_select && 'value' in next) {\n\t\t\t\tselect_option(/** @type {HTMLSelectElement} */ (element), next.value);\n\t\t\t}\n\n\t\t\tfor (let symbol of Object.getOwnPropertySymbols(effects)) {\n\t\t\t\tif (!next[symbol]) destroy_effect(effects[symbol]);\n\t\t\t}\n\n\t\t\tfor (let symbol of Object.getOwnPropertySymbols(next)) {\n\t\t\t\tvar n = next[symbol];\n\n\t\t\t\tif (symbol.description === ATTACHMENT_KEY && (!prev || n !== prev[symbol])) {\n\t\t\t\t\tif (effects[symbol]) destroy_effect(effects[symbol]);\n\t\t\t\t\teffects[symbol] = branch(() => attach(element, () => n));\n\t\t\t\t}\n\n\t\t\t\tcurrent[symbol] = n;\n\t\t\t}\n\n\t\t\tprev = current;\n\t\t});\n\n\t\tif (is_select) {\n\t\t\tvar select = /** @type {HTMLSelectElement} */ (element);\n\n\t\t\teffect(() => {\n\t\t\t\tselect_option(select, /** @type {Record<string | symbol, any>} */ (prev).value, true);\n\t\t\t\tinit_select(select);\n\t\t\t});\n\t\t}\n\n\t\tinited = true;\n\t});\n}\n\n/**\n *\n * @param {Element} element\n */\nfunction get_attributes(element) {\n\treturn /** @type {Record<string | symbol, unknown>} **/ (\n\t\t// @ts-expect-error\n\t\telement.__attributes ??= {\n\t\t\t[IS_CUSTOM_ELEMENT]: element.nodeName.includes('-'),\n\t\t\t[IS_HTML]: element.namespaceURI === NAMESPACE_HTML\n\t\t}\n\t);\n}\n\n/** @type {Map<string, string[]>} */\nvar setters_cache = new Map();\n\n/** @param {Element} element */\nfunction get_setters(element) {\n\tvar cache_key = element.getAttribute('is') || element.nodeName;\n\tvar setters = setters_cache.get(cache_key);\n\tif (setters) return setters;\n\tsetters_cache.set(cache_key, (setters = []));\n\n\tvar descriptors;\n\tvar proto = element; // In the case of custom elements there might be setters on the instance\n\tvar element_proto = Element.prototype;\n\n\t// Stop at Element, from there on there's only unnecessary setters we're not interested in\n\t// Do not use contructor.name here as that's unreliable in some browser environments\n\twhile (element_proto !== proto) {\n\t\tdescriptors = get_descriptors(proto);\n\n\t\tfor (var key in descriptors) {\n\t\t\tif (descriptors[key].set) {\n\t\t\t\tsetters.push(key);\n\t\t\t}\n\t\t}\n\n\t\tproto = get_prototype_of(proto);\n\t}\n\n\treturn setters;\n}\n\n/**\n * @param {any} element\n * @param {string} attribute\n * @param {string} value\n */\nfunction check_src_in_dev_hydration(element, attribute, value) {\n\tif (!DEV) return;\n\tif (attribute === 'srcset' && srcset_url_equal(element, value)) return;\n\tif (src_url_equal(element.getAttribute(attribute) ?? '', value)) return;\n\n\tw.hydration_attribute_changed(\n\t\tattribute,\n\t\telement.outerHTML.replace(element.innerHTML, element.innerHTML && '...'),\n\t\tString(value)\n\t);\n}\n\n/**\n * @param {string} element_src\n * @param {string} url\n * @returns {boolean}\n */\nfunction src_url_equal(element_src, url) {\n\tif (element_src === url) return true;\n\treturn new URL(element_src, document.baseURI).href === new URL(url, document.baseURI).href;\n}\n\n/** @param {string} srcset */\nfunction split_srcset(srcset) {\n\treturn srcset.split(',').map((src) => src.trim().split(' ').filter(Boolean));\n}\n\n/**\n * @param {HTMLSourceElement | HTMLImageElement} element\n * @param {string} srcset\n * @returns {boolean}\n */\nfunction srcset_url_equal(element, srcset) {\n\tvar element_urls = split_srcset(element.srcset);\n\tvar urls = split_srcset(srcset);\n\n\treturn (\n\t\turls.length === element_urls.length &&\n\t\turls.every(\n\t\t\t([url, width], i) =>\n\t\t\t\twidth === element_urls[i][1] &&\n\t\t\t\t// We need to test both ways because Vite will create an a full URL with\n\t\t\t\t// `new URL(asset, import.meta.url).href` for the client when `base: './'`, and the\n\t\t\t\t// relative URLs inside srcset are not automatically resolved to absolute URLs by\n\t\t\t\t// browsers (in contrast to img.src). This means both SSR and DOM code could\n\t\t\t\t// contain relative or absolute URLs.\n\t\t\t\t(src_url_equal(element_urls[i][0], url) || src_url_equal(url, element_urls[i][0]))\n\t\t)\n\t);\n}\n","/** @import { Batch } from '../../../reactivity/batch.js' */\nimport { DEV } from 'esm-env';\nimport { render_effect, teardown } from '../../../reactivity/effects.js';\nimport { listen_to_event_and_reset_event } from './shared.js';\nimport * as e from '../../../errors.js';\nimport { is } from '../../../proxy.js';\nimport { queue_micro_task } from '../../task.js';\nimport { hydrating } from '../../hydration.js';\nimport { tick, untrack } from '../../../runtime.js';\nimport { is_runes } from '../../../context.js';\nimport { current_batch, previous_batch } from '../../../reactivity/batch.js';\n\n/**\n * @param {HTMLInputElement} input\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_value(input, get, set = get) {\n\tvar batches = new WeakSet();\n\n\tlisten_to_event_and_reset_event(input, 'input', async (is_reset) => {\n\t\tif (DEV && input.type === 'checkbox') {\n\t\t\t// TODO should this happen in prod too?\n\t\t\te.bind_invalid_checkbox_value();\n\t\t}\n\n\t\t/** @type {any} */\n\t\tvar value = is_reset ? input.defaultValue : input.value;\n\t\tvalue = is_numberlike_input(input) ? to_number(value) : value;\n\t\tset(value);\n\n\t\tif (current_batch !== null) {\n\t\t\tbatches.add(current_batch);\n\t\t}\n\n\t\t// Because `{#each ...}` blocks work by updating sources inside the flush,\n\t\t// we need to wait a tick before checking to see if we should forcibly\n\t\t// update the input and reset the selection state\n\t\tawait tick();\n\n\t\t// Respect any validation in accessors\n\t\tif (value !== (value = get())) {\n\t\t\tvar start = input.selectionStart;\n\t\t\tvar end = input.selectionEnd;\n\t\t\tvar length = input.value.length;\n\n\t\t\t// the value is coerced on assignment\n\t\t\tinput.value = value ?? '';\n\n\t\t\t// Restore selection\n\t\t\tif (end !== null) {\n\t\t\t\tvar new_length = input.value.length;\n\t\t\t\t// If cursor was at end and new input is longer, move cursor to new end\n\t\t\t\tif (start === end && end === length && new_length > length) {\n\t\t\t\t\tinput.selectionStart = new_length;\n\t\t\t\t\tinput.selectionEnd = new_length;\n\t\t\t\t} else {\n\t\t\t\t\tinput.selectionStart = start;\n\t\t\t\t\tinput.selectionEnd = Math.min(end, new_length);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tif (\n\t\t// If we are hydrating and the value has since changed,\n\t\t// then use the updated value from the input instead.\n\t\t(hydrating && input.defaultValue !== input.value) ||\n\t\t// If defaultValue is set, then value == defaultValue\n\t\t// TODO Svelte 6: remove input.value check and set to empty string?\n\t\t(untrack(get) == null && input.value)\n\t) {\n\t\tset(is_numberlike_input(input) ? to_number(input.value) : input.value);\n\n\t\tif (current_batch !== null) {\n\t\t\tbatches.add(current_batch);\n\t\t}\n\t}\n\n\trender_effect(() => {\n\t\tif (DEV && input.type === 'checkbox') {\n\t\t\t// TODO should this happen in prod too?\n\t\t\te.bind_invalid_checkbox_value();\n\t\t}\n\n\t\tvar value = get();\n\n\t\tif (input === document.activeElement) {\n\t\t\t// we need both, because in non-async mode, render effects run before previous_batch is set\n\t\t\tvar batch = /** @type {Batch} */ (previous_batch ?? current_batch);\n\n\t\t\t// Never rewrite the contents of a focused input. We can get here if, for example,\n\t\t\t// an update is deferred because of async work depending on the input:\n\t\t\t//\n\t\t\t// <input bind:value={query}>\n\t\t\t// <p>{await find(query)}</p>\n\t\t\tif (batches.has(batch)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (is_numberlike_input(input) && value === to_number(input.value)) {\n\t\t\t// handles 0 vs 00 case (see https://github.com/sveltejs/svelte/issues/9959)\n\t\t\treturn;\n\t\t}\n\n\t\tif (input.type === 'date' && !value && !input.value) {\n\t\t\t// Handles the case where a temporarily invalid date is set (while typing, for example with a leading 0 for the day)\n\t\t\t// and prevents this state from clearing the other parts of the date input (see https://github.com/sveltejs/svelte/issues/7897)\n\t\t\treturn;\n\t\t}\n\n\t\t// don't set the value of the input if it's the same to allow\n\t\t// minlength to work properly\n\t\tif (value !== input.value) {\n\t\t\t// @ts-expect-error the value is coerced on assignment\n\t\t\tinput.value = value ?? '';\n\t\t}\n\t});\n}\n\n/** @type {Set<HTMLInputElement[]>} */\nconst pending = new Set();\n\n/**\n * @param {HTMLInputElement[]} inputs\n * @param {null | [number]} group_index\n * @param {HTMLInputElement} input\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_group(inputs, group_index, input, get, set = get) {\n\tvar is_checkbox = input.getAttribute('type') === 'checkbox';\n\tvar binding_group = inputs;\n\n\t// needs to be let or related code isn't treeshaken out if it's always false\n\tlet hydration_mismatch = false;\n\n\tif (group_index !== null) {\n\t\tfor (var index of group_index) {\n\t\t\t// @ts-expect-error\n\t\t\tbinding_group = binding_group[index] ??= [];\n\t\t}\n\t}\n\n\tbinding_group.push(input);\n\n\tlisten_to_event_and_reset_event(\n\t\tinput,\n\t\t'change',\n\t\t() => {\n\t\t\t// @ts-ignore\n\t\t\tvar value = input.__value;\n\n\t\t\tif (is_checkbox) {\n\t\t\t\tvalue = get_binding_group_value(binding_group, value, input.checked);\n\t\t\t}\n\n\t\t\tset(value);\n\t\t},\n\t\t// TODO better default value handling\n\t\t() => set(is_checkbox ? [] : null)\n\t);\n\n\trender_effect(() => {\n\t\tvar value = get();\n\n\t\t// If we are hydrating and the value has since changed, then use the update value\n\t\t// from the input instead.\n\t\tif (hydrating && input.defaultChecked !== input.checked) {\n\t\t\thydration_mismatch = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (is_checkbox) {\n\t\t\tvalue = value || [];\n\t\t\t// @ts-ignore\n\t\t\tinput.checked = value.includes(input.__value);\n\t\t} else {\n\t\t\t// @ts-ignore\n\t\t\tinput.checked = is(input.__value, value);\n\t\t}\n\t});\n\n\tteardown(() => {\n\t\tvar index = binding_group.indexOf(input);\n\n\t\tif (index !== -1) {\n\t\t\tbinding_group.splice(index, 1);\n\t\t}\n\t});\n\n\tif (!pending.has(binding_group)) {\n\t\tpending.add(binding_group);\n\n\t\tqueue_micro_task(() => {\n\t\t\t// necessary to maintain binding group order in all insertion scenarios\n\t\t\tbinding_group.sort((a, b) => (a.compareDocumentPosition(b) === 4 ? -1 : 1));\n\t\t\tpending.delete(binding_group);\n\t\t});\n\t}\n\n\tqueue_micro_task(() => {\n\t\tif (hydration_mismatch) {\n\t\t\tvar value;\n\n\t\t\tif (is_checkbox) {\n\t\t\t\tvalue = get_binding_group_value(binding_group, value, input.checked);\n\t\t\t} else {\n\t\t\t\tvar hydration_input = binding_group.find((input) => input.checked);\n\t\t\t\t// @ts-ignore\n\t\t\t\tvalue = hydration_input?.__value;\n\t\t\t}\n\n\t\t\tset(value);\n\t\t}\n\t});\n}\n\n/**\n * @param {HTMLInputElement} input\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_checked(input, get, set = get) {\n\tlisten_to_event_and_reset_event(input, 'change', (is_reset) => {\n\t\tvar value = is_reset ? input.defaultChecked : input.checked;\n\t\tset(value);\n\t});\n\n\tif (\n\t\t// If we are hydrating and the value has since changed,\n\t\t// then use the update value from the input instead.\n\t\t(hydrating && input.defaultChecked !== input.checked) ||\n\t\t// If defaultChecked is set, then checked == defaultChecked\n\t\tuntrack(get) == null\n\t) {\n\t\tset(input.checked);\n\t}\n\n\trender_effect(() => {\n\t\tvar value = get();\n\t\tinput.checked = Boolean(value);\n\t});\n}\n\n/**\n * @template V\n * @param {Array<HTMLInputElement>} group\n * @param {V} __value\n * @param {boolean} checked\n * @returns {V[]}\n */\nfunction get_binding_group_value(group, __value, checked) {\n\t/** @type {Set<V>} */\n\tvar value = new Set();\n\n\tfor (var i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) {\n\t\t\t// @ts-ignore\n\t\t\tvalue.add(group[i].__value);\n\t\t}\n\t}\n\n\tif (!checked) {\n\t\tvalue.delete(__value);\n\t}\n\n\treturn Array.from(value);\n}\n\n/**\n * @param {HTMLInputElement} input\n */\nfunction is_numberlike_input(input) {\n\tvar type = input.type;\n\treturn type === 'number' || type === 'range';\n}\n\n/**\n * @param {string} value\n */\nfunction to_number(value) {\n\treturn value === '' ? null : +value;\n}\n\n/**\n * @param {HTMLInputElement} input\n * @param {() => FileList | null} get\n * @param {(value: FileList | null) => void} set\n */\nexport function bind_files(input, get, set = get) {\n\tlisten_to_event_and_reset_event(input, 'change', () => {\n\t\tset(input.files);\n\t});\n\n\tif (\n\t\t// If we are hydrating and the value has since changed,\n\t\t// then use the updated value from the input instead.\n\t\thydrating &&\n\t\tinput.files\n\t) {\n\t\tset(input.files);\n\t}\n\n\trender_effect(() => {\n\t\tinput.files = get();\n\t});\n}\n","import { STATE_SYMBOL } from '#client/constants';\nimport { effect, render_effect } from '../../../reactivity/effects.js';\nimport { untrack } from '../../../runtime.js';\nimport { queue_micro_task } from '../../task.js';\n\n/**\n * @param {any} bound_value\n * @param {Element} element_or_component\n * @returns {boolean}\n */\nfunction is_bound_this(bound_value, element_or_component) {\n\treturn (\n\t\tbound_value === element_or_component || bound_value?.[STATE_SYMBOL] === element_or_component\n\t);\n}\n\n/**\n * @param {any} element_or_component\n * @param {(value: unknown, ...parts: unknown[]) => void} update\n * @param {(...parts: unknown[]) => unknown} get_value\n * @param {() => unknown[]} [get_parts] Set if the this binding is used inside an each block,\n * \t\t\t\t\t\t\t\t\t\treturns all the parts of the each block context that are used in the expression\n * @returns {void}\n */\nexport function bind_this(element_or_component = {}, update, get_value, get_parts) {\n\teffect(() => {\n\t\t/** @type {unknown[]} */\n\t\tvar old_parts;\n\n\t\t/** @type {unknown[]} */\n\t\tvar parts;\n\n\t\trender_effect(() => {\n\t\t\told_parts = parts;\n\t\t\t// We only track changes to the parts, not the value itself to avoid unnecessary reruns.\n\t\t\tparts = get_parts?.() || [];\n\n\t\t\tuntrack(() => {\n\t\t\t\tif (element_or_component !== get_value(...parts)) {\n\t\t\t\t\tupdate(element_or_component, ...parts);\n\t\t\t\t\t// If this is an effect rerun (cause: each block context changes), then nullify the binding at\n\t\t\t\t\t// the previous position if it isn't already taken over by a different effect.\n\t\t\t\t\tif (old_parts && is_bound_this(get_value(...old_parts), element_or_component)) {\n\t\t\t\t\t\tupdate(null, ...old_parts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn () => {\n\t\t\t// We cannot use effects in the teardown phase, we we use a microtask instead.\n\t\t\tqueue_micro_task(() => {\n\t\t\t\tif (parts && is_bound_this(get_value(...parts), element_or_component)) {\n\t\t\t\t\tupdate(null, ...parts);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t});\n\n\treturn element_or_component;\n}\n","import { render_effect, teardown } from '../../../reactivity/effects.js';\nimport { listen } from './shared.js';\n\n/**\n * @param {'innerHTML' | 'textContent' | 'innerText'} property\n * @param {HTMLElement} element\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_content_editable(property, element, get, set = get) {\n\telement.addEventListener('input', () => {\n\t\t// @ts-ignore\n\t\tset(element[property]);\n\t});\n\n\trender_effect(() => {\n\t\tvar value = get();\n\n\t\tif (element[property] !== value) {\n\t\t\tif (value == null) {\n\t\t\t\t// @ts-ignore\n\t\t\t\tvar non_null_value = element[property];\n\t\t\t\tset(non_null_value);\n\t\t\t} else {\n\t\t\t\t// @ts-ignore\n\t\t\t\telement[property] = value + '';\n\t\t\t}\n\t\t}\n\t});\n}\n\n/**\n * @param {string} property\n * @param {string} event_name\n * @param {Element} element\n * @param {(value: unknown) => void} set\n * @param {() => unknown} [get]\n * @returns {void}\n */\nexport function bind_property(property, event_name, element, set, get) {\n\tvar handler = () => {\n\t\t// @ts-ignore\n\t\tset(element[property]);\n\t};\n\n\telement.addEventListener(event_name, handler);\n\n\tif (get) {\n\t\trender_effect(() => {\n\t\t\t// @ts-ignore\n\t\t\telement[property] = get();\n\t\t});\n\t} else {\n\t\thandler();\n\t}\n\n\t// @ts-ignore\n\tif (element === document.body || element === window || element === document) {\n\t\tteardown(() => {\n\t\t\telement.removeEventListener(event_name, handler);\n\t\t});\n\t}\n}\n\n/**\n * @param {HTMLElement} element\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_focused(element, set) {\n\tlisten(element, ['focus', 'blur'], () => {\n\t\tset(element === document.activeElement);\n\t});\n}\n","/** @import { StoreReferencesContainer } from '#client' */\n/** @import { Store } from '#shared' */\nimport { subscribe_to_store } from '../../../store/utils.js';\nimport { get as get_store } from '../../../store/shared/index.js';\nimport { define_property, noop } from '../../shared/utils.js';\nimport { get } from '../runtime.js';\nimport { teardown } from './effects.js';\nimport { mutable_source, set } from './sources.js';\nimport { DEV } from 'esm-env';\n\n/**\n * Whether or not the prop currently being read is a store binding, as in\n * `<Child bind:x={$y} />`. If it is, we treat the prop as mutable even in\n * runes mode, and skip `binding_property_non_reactive` validation\n */\nlet is_store_binding = false;\n\nlet IS_UNMOUNTED = Symbol();\n\n/**\n * Gets the current value of a store. If the store isn't subscribed to yet, it will create a proxy\n * signal that will be updated when the store is. The store references container is needed to\n * track reassignments to stores and to track the correct component context.\n * @template V\n * @param {Store<V> | null | undefined} store\n * @param {string} store_name\n * @param {StoreReferencesContainer} stores\n * @returns {V}\n */\nexport function store_get(store, store_name, stores) {\n\tconst entry = (stores[store_name] ??= {\n\t\tstore: null,\n\t\tsource: mutable_source(undefined),\n\t\tunsubscribe: noop\n\t});\n\n\tif (DEV) {\n\t\tentry.source.label = store_name;\n\t}\n\n\t// if the component that setup this is already unmounted we don't want to register a subscription\n\tif (entry.store !== store && !(IS_UNMOUNTED in stores)) {\n\t\tentry.unsubscribe();\n\t\tentry.store = store ?? null;\n\n\t\tif (store == null) {\n\t\t\tentry.source.v = undefined; // see synchronous callback comment below\n\t\t\tentry.unsubscribe = noop;\n\t\t} else {\n\t\t\tvar is_synchronous_callback = true;\n\n\t\t\tentry.unsubscribe = subscribe_to_store(store, (v) => {\n\t\t\t\tif (is_synchronous_callback) {\n\t\t\t\t\t// If the first updates to the store value (possibly multiple of them) are synchronously\n\t\t\t\t\t// inside a derived, we will hit the `state_unsafe_mutation` error if we `set` the value\n\t\t\t\t\tentry.source.v = v;\n\t\t\t\t} else {\n\t\t\t\t\tset(entry.source, v);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tis_synchronous_callback = false;\n\t\t}\n\t}\n\n\t// if the component that setup this stores is already unmounted the source will be out of sync\n\t// so we just use the `get` for the stores, less performant but it avoids to create a memory leak\n\t// and it will keep the value consistent\n\tif (store && IS_UNMOUNTED in stores) {\n\t\treturn get_store(store);\n\t}\n\n\treturn get(entry.source);\n}\n\n/**\n * Unsubscribe from a store if it's not the same as the one in the store references container.\n * We need this in addition to `store_get` because someone could unsubscribe from a store but\n * then never subscribe to the new one (if any), causing the subscription to stay open wrongfully.\n * @param {Store<any> | null | undefined} store\n * @param {string} store_name\n * @param {StoreReferencesContainer} stores\n */\nexport function store_unsub(store, store_name, stores) {\n\t/** @type {StoreReferencesContainer[''] | undefined} */\n\tlet entry = stores[store_name];\n\n\tif (entry && entry.store !== store) {\n\t\t// Don't reset store yet, so that store_get above can resubscribe to new store if necessary\n\t\tentry.unsubscribe();\n\t\tentry.unsubscribe = noop;\n\t}\n\n\treturn store;\n}\n\n/**\n * Sets the new value of a store and returns that value.\n * @template V\n * @param {Store<V>} store\n * @param {V} value\n * @returns {V}\n */\nexport function store_set(store, value) {\n\tstore.set(value);\n\treturn value;\n}\n\n/**\n * @param {StoreReferencesContainer} stores\n * @param {string} store_name\n */\nexport function invalidate_store(stores, store_name) {\n\tvar entry = stores[store_name];\n\tif (entry.store !== null) {\n\t\tstore_set(entry.store, entry.source.v);\n\t}\n}\n\n/**\n * Unsubscribes from all auto-subscribed stores on destroy\n * @returns {[StoreReferencesContainer, ()=>void]}\n */\nexport function setup_stores() {\n\t/** @type {StoreReferencesContainer} */\n\tconst stores = {};\n\n\tfunction cleanup() {\n\t\tteardown(() => {\n\t\t\tfor (var store_name in stores) {\n\t\t\t\tconst ref = stores[store_name];\n\t\t\t\tref.unsubscribe();\n\t\t\t}\n\t\t\tdefine_property(stores, IS_UNMOUNTED, {\n\t\t\t\tenumerable: false,\n\t\t\t\tvalue: true\n\t\t\t});\n\t\t});\n\t}\n\n\treturn [stores, cleanup];\n}\n\n/**\n * Updates a store with a new value.\n * @param {Store<V>} store  the store to update\n * @param {any} expression  the expression that mutates the store\n * @param {V} new_value  the new store value\n * @template V\n */\nexport function store_mutate(store, expression, new_value) {\n\tstore.set(new_value);\n\treturn expression;\n}\n\n/**\n * @param {Store<number>} store\n * @param {number} store_value\n * @param {1 | -1} [d]\n * @returns {number}\n */\nexport function update_store(store, store_value, d = 1) {\n\tstore.set(store_value + d);\n\treturn store_value;\n}\n\n/**\n * @param {Store<number>} store\n * @param {number} store_value\n * @param {1 | -1} [d]\n * @returns {number}\n */\nexport function update_pre_store(store, store_value, d = 1) {\n\tconst value = store_value + d;\n\tstore.set(value);\n\treturn value;\n}\n\n/**\n * Called inside prop getters to communicate that the prop is a store binding\n */\nexport function mark_store_binding() {\n\tis_store_binding = true;\n}\n\n/**\n * Returns a tuple that indicates whether `fn()` reads a prop that is a store binding.\n * Used to prevent `binding_property_non_reactive` validation false positives and\n * ensure that these props are treated as mutable even in runes mode\n * @template T\n * @param {() => T} fn\n * @returns {[T, boolean]}\n */\nexport function capture_store_binding(fn) {\n\tvar previous_is_store_binding = is_store_binding;\n\n\ttry {\n\t\tis_store_binding = false;\n\t\treturn [fn(), is_store_binding];\n\t} finally {\n\t\tis_store_binding = previous_is_store_binding;\n\t}\n}\n","/** @import { Effect, Source } from './types.js' */\nimport { DEV } from 'esm-env';\nimport {\n\tPROPS_IS_BINDABLE,\n\tPROPS_IS_IMMUTABLE,\n\tPROPS_IS_LAZY_INITIAL,\n\tPROPS_IS_RUNES,\n\tPROPS_IS_UPDATED\n} from '../../../constants.js';\nimport { get_descriptor, is_function } from '../../shared/utils.js';\nimport { set, source, update } from './sources.js';\nimport { derived, derived_safe_equal } from './deriveds.js';\nimport {\n\tactive_effect,\n\tget,\n\tis_destroying_effect,\n\tset_active_effect,\n\tuntrack\n} from '../runtime.js';\nimport * as e from '../errors.js';\nimport { DESTROYED, LEGACY_PROPS, STATE_SYMBOL } from '#client/constants';\nimport { proxy } from '../proxy.js';\nimport { capture_store_binding } from './store.js';\nimport { legacy_mode_flag } from '../../flags/index.js';\n\n/**\n * @param {((value?: number) => number)} fn\n * @param {1 | -1} [d]\n * @returns {number}\n */\nexport function update_prop(fn, d = 1) {\n\tconst value = fn();\n\tfn(value + d);\n\treturn value;\n}\n\n/**\n * @param {((value?: number) => number)} fn\n * @param {1 | -1} [d]\n * @returns {number}\n */\nexport function update_pre_prop(fn, d = 1) {\n\tconst value = fn() + d;\n\tfn(value);\n\treturn value;\n}\n\n/**\n * The proxy handler for rest props (i.e. `const { x, ...rest } = $props()`).\n * Is passed the full `$$props` object and excludes the named props.\n * @type {ProxyHandler<{ props: Record<string | symbol, unknown>, exclude: Array<string | symbol>, name?: string }>}}\n */\nconst rest_props_handler = {\n\tget(target, key) {\n\t\tif (target.exclude.includes(key)) return;\n\t\treturn target.props[key];\n\t},\n\tset(target, key) {\n\t\tif (DEV) {\n\t\t\t// TODO should this happen in prod too?\n\t\t\te.props_rest_readonly(`${target.name}.${String(key)}`);\n\t\t}\n\n\t\treturn false;\n\t},\n\tgetOwnPropertyDescriptor(target, key) {\n\t\tif (target.exclude.includes(key)) return;\n\t\tif (key in target.props) {\n\t\t\treturn {\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: target.props[key]\n\t\t\t};\n\t\t}\n\t},\n\thas(target, key) {\n\t\tif (target.exclude.includes(key)) return false;\n\t\treturn key in target.props;\n\t},\n\townKeys(target) {\n\t\treturn Reflect.ownKeys(target.props).filter((key) => !target.exclude.includes(key));\n\t}\n};\n\n/**\n * @param {Record<string, unknown>} props\n * @param {string[]} exclude\n * @param {string} [name]\n * @returns {Record<string, unknown>}\n */\n/*#__NO_SIDE_EFFECTS__*/\nexport function rest_props(props, exclude, name) {\n\treturn new Proxy(\n\t\tDEV ? { props, exclude, name, other: {}, to_proxy: [] } : { props, exclude },\n\t\trest_props_handler\n\t);\n}\n\n/**\n * The proxy handler for legacy $$restProps and $$props\n * @type {ProxyHandler<{ props: Record<string | symbol, unknown>, exclude: Array<string | symbol>, special: Record<string | symbol, (v?: unknown) => unknown>, version: Source<number>, parent_effect: Effect }>}}\n */\nconst legacy_rest_props_handler = {\n\tget(target, key) {\n\t\tif (target.exclude.includes(key)) return;\n\t\tget(target.version);\n\t\treturn key in target.special ? target.special[key]() : target.props[key];\n\t},\n\tset(target, key, value) {\n\t\tif (!(key in target.special)) {\n\t\t\tvar previous_effect = active_effect;\n\n\t\t\ttry {\n\t\t\t\tset_active_effect(target.parent_effect);\n\n\t\t\t\t// Handle props that can temporarily get out of sync with the parent\n\t\t\t\t/** @type {Record<string, (v?: unknown) => unknown>} */\n\t\t\t\ttarget.special[key] = prop(\n\t\t\t\t\t{\n\t\t\t\t\t\tget [key]() {\n\t\t\t\t\t\t\treturn target.props[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t/** @type {string} */ (key),\n\t\t\t\t\tPROPS_IS_UPDATED\n\t\t\t\t);\n\t\t\t} finally {\n\t\t\t\tset_active_effect(previous_effect);\n\t\t\t}\n\t\t}\n\n\t\ttarget.special[key](value);\n\t\tupdate(target.version); // $$props is coarse-grained: when $$props.x is updated, usages of $$props.y etc are also rerun\n\t\treturn true;\n\t},\n\tgetOwnPropertyDescriptor(target, key) {\n\t\tif (target.exclude.includes(key)) return;\n\t\tif (key in target.props) {\n\t\t\treturn {\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true,\n\t\t\t\tvalue: target.props[key]\n\t\t\t};\n\t\t}\n\t},\n\tdeleteProperty(target, key) {\n\t\t// Svelte 4 allowed for deletions on $$restProps\n\t\tif (target.exclude.includes(key)) return true;\n\t\ttarget.exclude.push(key);\n\t\tupdate(target.version);\n\t\treturn true;\n\t},\n\thas(target, key) {\n\t\tif (target.exclude.includes(key)) return false;\n\t\treturn key in target.props;\n\t},\n\townKeys(target) {\n\t\treturn Reflect.ownKeys(target.props).filter((key) => !target.exclude.includes(key));\n\t}\n};\n\n/**\n * @param {Record<string, unknown>} props\n * @param {string[]} exclude\n * @returns {Record<string, unknown>}\n */\nexport function legacy_rest_props(props, exclude) {\n\treturn new Proxy(\n\t\t{\n\t\t\tprops,\n\t\t\texclude,\n\t\t\tspecial: {},\n\t\t\tversion: source(0),\n\t\t\t// TODO this is only necessary because we need to track component\n\t\t\t// destruction inside `prop`, because of `bind:this`, but it\n\t\t\t// seems likely that we can simplify `bind:this` instead\n\t\t\tparent_effect: /** @type {Effect} */ (active_effect)\n\t\t},\n\t\tlegacy_rest_props_handler\n\t);\n}\n\n/**\n * The proxy handler for spread props. Handles the incoming array of props\n * that looks like `() => { dynamic: props }, { static: prop }, ..` and wraps\n * them so that the whole thing is passed to the component as the `$$props` argument.\n * @type {ProxyHandler<{ props: Array<Record<string | symbol, unknown> | (() => Record<string | symbol, unknown>)> }>}}\n */\nconst spread_props_handler = {\n\tget(target, key) {\n\t\tlet i = target.props.length;\n\t\twhile (i--) {\n\t\t\tlet p = target.props[i];\n\t\t\tif (is_function(p)) p = p();\n\t\t\tif (typeof p === 'object' && p !== null && key in p) return p[key];\n\t\t}\n\t},\n\tset(target, key, value) {\n\t\tlet i = target.props.length;\n\t\twhile (i--) {\n\t\t\tlet p = target.props[i];\n\t\t\tif (is_function(p)) p = p();\n\t\t\tconst desc = get_descriptor(p, key);\n\t\t\tif (desc && desc.set) {\n\t\t\t\tdesc.set(value);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\tgetOwnPropertyDescriptor(target, key) {\n\t\tlet i = target.props.length;\n\t\twhile (i--) {\n\t\t\tlet p = target.props[i];\n\t\t\tif (is_function(p)) p = p();\n\t\t\tif (typeof p === 'object' && p !== null && key in p) {\n\t\t\t\tconst descriptor = get_descriptor(p, key);\n\t\t\t\tif (descriptor && !descriptor.configurable) {\n\t\t\t\t\t// Prevent a \"Non-configurability Report Error\": The target is an array, it does\n\t\t\t\t\t// not actually contain this property. If it is now described as non-configurable,\n\t\t\t\t\t// the proxy throws a validation error. Setting it to true avoids that.\n\t\t\t\t\tdescriptor.configurable = true;\n\t\t\t\t}\n\t\t\t\treturn descriptor;\n\t\t\t}\n\t\t}\n\t},\n\thas(target, key) {\n\t\t// To prevent a false positive `is_entry_props` in the `prop` function\n\t\tif (key === STATE_SYMBOL || key === LEGACY_PROPS) return false;\n\n\t\tfor (let p of target.props) {\n\t\t\tif (is_function(p)) p = p();\n\t\t\tif (p != null && key in p) return true;\n\t\t}\n\n\t\treturn false;\n\t},\n\townKeys(target) {\n\t\t/** @type {Array<string | symbol>} */\n\t\tconst keys = [];\n\n\t\tfor (let p of target.props) {\n\t\t\tif (is_function(p)) p = p();\n\t\t\tif (!p) continue;\n\n\t\t\tfor (const key in p) {\n\t\t\t\tif (!keys.includes(key)) keys.push(key);\n\t\t\t}\n\n\t\t\tfor (const key of Object.getOwnPropertySymbols(p)) {\n\t\t\t\tif (!keys.includes(key)) keys.push(key);\n\t\t\t}\n\t\t}\n\n\t\treturn keys;\n\t}\n};\n\n/**\n * @param {Array<Record<string, unknown> | (() => Record<string, unknown>)>} props\n * @returns {any}\n */\nexport function spread_props(...props) {\n\treturn new Proxy({ props }, spread_props_handler);\n}\n\n/**\n * This function is responsible for synchronizing a possibly bound prop with the inner component state.\n * It is used whenever the compiler sees that the component writes to the prop, or when it has a default prop_value.\n * @template V\n * @param {Record<string, unknown>} props\n * @param {string} key\n * @param {number} flags\n * @param {V | (() => V)} [fallback]\n * @returns {(() => V | ((arg: V) => V) | ((arg: V, mutation: boolean) => V))}\n */\nexport function prop(props, key, flags, fallback) {\n\tvar runes = !legacy_mode_flag || (flags & PROPS_IS_RUNES) !== 0;\n\tvar bindable = (flags & PROPS_IS_BINDABLE) !== 0;\n\tvar lazy = (flags & PROPS_IS_LAZY_INITIAL) !== 0;\n\n\tvar fallback_value = /** @type {V} */ (fallback);\n\tvar fallback_dirty = true;\n\n\tvar get_fallback = () => {\n\t\tif (fallback_dirty) {\n\t\t\tfallback_dirty = false;\n\n\t\t\tfallback_value = lazy\n\t\t\t\t? untrack(/** @type {() => V} */ (fallback))\n\t\t\t\t: /** @type {V} */ (fallback);\n\t\t}\n\n\t\treturn fallback_value;\n\t};\n\n\t/** @type {((v: V) => void) | undefined} */\n\tvar setter;\n\n\tif (bindable) {\n\t\t// Can be the case when someone does `mount(Component, props)` with `let props = $state({...})`\n\t\t// or `createClassComponent(Component, props)`\n\t\tvar is_entry_props = STATE_SYMBOL in props || LEGACY_PROPS in props;\n\n\t\tsetter =\n\t\t\tget_descriptor(props, key)?.set ??\n\t\t\t(is_entry_props && key in props ? (v) => (props[key] = v) : undefined);\n\t}\n\n\tvar initial_value;\n\tvar is_store_sub = false;\n\n\tif (bindable) {\n\t\t[initial_value, is_store_sub] = capture_store_binding(() => /** @type {V} */ (props[key]));\n\t} else {\n\t\tinitial_value = /** @type {V} */ (props[key]);\n\t}\n\n\tif (initial_value === undefined && fallback !== undefined) {\n\t\tinitial_value = get_fallback();\n\n\t\tif (setter) {\n\t\t\tif (runes) e.props_invalid_value(key);\n\t\t\tsetter(initial_value);\n\t\t}\n\t}\n\n\t/** @type {() => V} */\n\tvar getter;\n\n\tif (runes) {\n\t\tgetter = () => {\n\t\t\tvar value = /** @type {V} */ (props[key]);\n\t\t\tif (value === undefined) return get_fallback();\n\t\t\tfallback_dirty = true;\n\t\t\treturn value;\n\t\t};\n\t} else {\n\t\tgetter = () => {\n\t\t\tvar value = /** @type {V} */ (props[key]);\n\n\t\t\tif (value !== undefined) {\n\t\t\t\t// in legacy mode, we don't revert to the fallback value\n\t\t\t\t// if the prop goes from defined to undefined. The easiest\n\t\t\t\t// way to model this is to make the fallback undefined\n\t\t\t\t// as soon as the prop has a value\n\t\t\t\tfallback_value = /** @type {V} */ (undefined);\n\t\t\t}\n\n\t\t\treturn value === undefined ? fallback_value : value;\n\t\t};\n\t}\n\n\t// prop is never written to  we only need a getter\n\tif (runes && (flags & PROPS_IS_UPDATED) === 0) {\n\t\treturn getter;\n\t}\n\n\t// prop is written to, but the parent component had `bind:foo` which\n\t// means we can just call `$$props.foo = value` directly\n\tif (setter) {\n\t\tvar legacy_parent = props.$$legacy;\n\t\treturn /** @type {() => V} */ (\n\t\t\tfunction (/** @type {V} */ value, /** @type {boolean} */ mutation) {\n\t\t\t\tif (arguments.length > 0) {\n\t\t\t\t\t// We don't want to notify if the value was mutated and the parent is in runes mode.\n\t\t\t\t\t// In that case the state proxy (if it exists) should take care of the notification.\n\t\t\t\t\t// If the parent is not in runes mode, we need to notify on mutation, too, that the prop\n\t\t\t\t\t// has changed because the parent will not be able to detect the change otherwise.\n\t\t\t\t\tif (!runes || !mutation || legacy_parent || is_store_sub) {\n\t\t\t\t\t\t/** @type {Function} */ (setter)(mutation ? getter() : value);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\n\t\t\t\treturn getter();\n\t\t\t}\n\t\t);\n\t}\n\n\t// Either prop is written to, but there's no binding, which means we\n\t// create a derived that we can write to locally.\n\t// Or we are in legacy mode where we always create a derived to replicate that\n\t// Svelte 4 did not trigger updates when a primitive value was updated to the same value.\n\tvar overridden = false;\n\n\tvar d = ((flags & PROPS_IS_IMMUTABLE) !== 0 ? derived : derived_safe_equal)(() => {\n\t\toverridden = false;\n\t\treturn getter();\n\t});\n\n\tif (DEV) {\n\t\td.label = key;\n\t}\n\n\t// Capture the initial value if it's bindable\n\tif (bindable) get(d);\n\n\tvar parent_effect = /** @type {Effect} */ (active_effect);\n\n\treturn /** @type {() => V} */ (\n\t\tfunction (/** @type {any} */ value, /** @type {boolean} */ mutation) {\n\t\t\tif (arguments.length > 0) {\n\t\t\t\tconst new_value = mutation ? get(d) : runes && bindable ? proxy(value) : value;\n\n\t\t\t\tset(d, new_value);\n\t\t\t\toverridden = true;\n\n\t\t\t\tif (fallback_value !== undefined) {\n\t\t\t\t\tfallback_value = new_value;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\t// special case  avoid recalculating the derived if we're in a\n\t\t\t// teardown function and the prop was overridden locally, or the\n\t\t\t// component was already destroyed (this latter part is necessary\n\t\t\t// because `bind:this` can read props after the component has\n\t\t\t// been destroyed. TODO simplify `bind:this`\n\t\t\tif ((is_destroying_effect && overridden) || (parent_effect.f & DESTROYED) !== 0) {\n\t\t\t\treturn d.v;\n\t\t\t}\n\n\t\t\treturn get(d);\n\t\t}\n\t);\n}\n","/** @import { ComponentContext, ComponentContextLegacy } from '#client' */\n/** @import { EventDispatcher } from './index.js' */\n/** @import { NotFunction } from './internal/types.js' */\nimport { active_reaction, untrack } from './internal/client/runtime.js';\nimport { is_array } from './internal/shared/utils.js';\nimport { user_effect } from './internal/client/index.js';\nimport * as e from './internal/client/errors.js';\nimport { legacy_mode_flag } from './internal/flags/index.js';\nimport { component_context } from './internal/client/context.js';\nimport { DEV } from 'esm-env';\n\nif (DEV) {\n\t/**\n\t * @param {string} rune\n\t */\n\tfunction throw_rune_error(rune) {\n\t\tif (!(rune in globalThis)) {\n\t\t\t// TODO if people start adjusting the \"this can contain runes\" config through v-p-s more, adjust this message\n\t\t\t/** @type {any} */\n\t\t\tlet value; // let's hope noone modifies this global, but belts and braces\n\t\t\tObject.defineProperty(globalThis, rune, {\n\t\t\t\tconfigurable: true,\n\t\t\t\t// eslint-disable-next-line getter-return\n\t\t\t\tget: () => {\n\t\t\t\t\tif (value !== undefined) {\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\n\t\t\t\t\te.rune_outside_svelte(rune);\n\t\t\t\t},\n\t\t\t\tset: (v) => {\n\t\t\t\t\tvalue = v;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tthrow_rune_error('$state');\n\tthrow_rune_error('$effect');\n\tthrow_rune_error('$derived');\n\tthrow_rune_error('$inspect');\n\tthrow_rune_error('$props');\n\tthrow_rune_error('$bindable');\n}\n\n/**\n * Returns an [`AbortSignal`](https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal) that aborts when the current [derived](https://svelte.dev/docs/svelte/$derived) or [effect](https://svelte.dev/docs/svelte/$effect) re-runs or is destroyed.\n *\n * Must be called while a derived or effect is running.\n *\n * ```svelte\n * <script>\n * \timport { getAbortSignal } from 'svelte';\n *\n * \tlet { id } = $props();\n *\n * \tasync function getData(id) {\n * \t\tconst response = await fetch(`/items/${id}`, {\n * \t\t\tsignal: getAbortSignal()\n * \t\t});\n *\n * \t\treturn await response.json();\n * \t}\n *\n * \tconst data = $derived(await getData(id));\n * </script>\n * ```\n */\nexport function getAbortSignal() {\n\tif (active_reaction === null) {\n\t\te.get_abort_signal_outside_reaction();\n\t}\n\n\treturn (active_reaction.ac ??= new AbortController()).signal;\n}\n\n/**\n * `onMount`, like [`$effect`](https://svelte.dev/docs/svelte/$effect), schedules a function to run as soon as the component has been mounted to the DOM.\n * Unlike `$effect`, the provided function only runs once.\n *\n * It must be called during the component's initialisation (but doesn't need to live _inside_ the component;\n * it can be called from an external module). If a function is returned _synchronously_ from `onMount`,\n * it will be called when the component is unmounted.\n *\n * `onMount` functions do not run during [server-side rendering](https://svelte.dev/docs/svelte/svelte-server#render).\n *\n * @template T\n * @param {() => NotFunction<T> | Promise<NotFunction<T>> | (() => any)} fn\n * @returns {void}\n */\nexport function onMount(fn) {\n\tif (component_context === null) {\n\t\te.lifecycle_outside_component('onMount');\n\t}\n\n\tif (legacy_mode_flag && component_context.l !== null) {\n\t\tinit_update_callbacks(component_context).m.push(fn);\n\t} else {\n\t\tuser_effect(() => {\n\t\t\tconst cleanup = untrack(fn);\n\t\t\tif (typeof cleanup === 'function') return /** @type {() => void} */ (cleanup);\n\t\t});\n\t}\n}\n\n/**\n * Schedules a callback to run immediately before the component is unmounted.\n *\n * Out of `onMount`, `beforeUpdate`, `afterUpdate` and `onDestroy`, this is the\n * only one that runs inside a server-side component.\n *\n * @param {() => any} fn\n * @returns {void}\n */\nexport function onDestroy(fn) {\n\tif (component_context === null) {\n\t\te.lifecycle_outside_component('onDestroy');\n\t}\n\n\tonMount(() => () => untrack(fn));\n}\n\n/**\n * @template [T=any]\n * @param {string} type\n * @param {T} [detail]\n * @param {any}params_0\n * @returns {CustomEvent<T>}\n */\nfunction create_custom_event(type, detail, { bubbles = false, cancelable = false } = {}) {\n\treturn new CustomEvent(type, { detail, bubbles, cancelable });\n}\n\n/**\n * Creates an event dispatcher that can be used to dispatch [component events](https://svelte.dev/docs/svelte/legacy-on#Component-events).\n * Event dispatchers are functions that can take two arguments: `name` and `detail`.\n *\n * Component events created with `createEventDispatcher` create a\n * [CustomEvent](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent).\n * These events do not [bubble](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events#Event_bubbling_and_capture).\n * The `detail` argument corresponds to the [CustomEvent.detail](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/detail)\n * property and can contain any type of data.\n *\n * The event dispatcher can be typed to narrow the allowed event names and the type of the `detail` argument:\n * ```ts\n * const dispatch = createEventDispatcher<{\n *  loaded: null; // does not take a detail argument\n *  change: string; // takes a detail argument of type string, which is required\n *  optional: number | null; // takes an optional detail argument of type number\n * }>();\n * ```\n *\n * @deprecated Use callback props and/or the `$host()` rune instead  see [migration guide](https://svelte.dev/docs/svelte/v5-migration-guide#Event-changes-Component-events)\n * @template {Record<string, any>} [EventMap = any]\n * @returns {EventDispatcher<EventMap>}\n */\nexport function createEventDispatcher() {\n\tconst active_component_context = component_context;\n\tif (active_component_context === null) {\n\t\te.lifecycle_outside_component('createEventDispatcher');\n\t}\n\n\t/**\n\t * @param [detail]\n\t * @param [options]\n\t */\n\treturn (type, detail, options) => {\n\t\tconst events = /** @type {Record<string, Function | Function[]>} */ (\n\t\t\tactive_component_context.s.$$events\n\t\t)?.[/** @type {string} */ (type)];\n\n\t\tif (events) {\n\t\t\tconst callbacks = is_array(events) ? events.slice() : [events];\n\t\t\t// TODO are there situations where events could be dispatched\n\t\t\t// in a server (non-DOM) environment?\n\t\t\tconst event = create_custom_event(/** @type {string} */ (type), detail, options);\n\t\t\tfor (const fn of callbacks) {\n\t\t\t\tfn.call(active_component_context.x, event);\n\t\t\t}\n\t\t\treturn !event.defaultPrevented;\n\t\t}\n\n\t\treturn true;\n\t};\n}\n\n// TODO mark beforeUpdate and afterUpdate as deprecated in Svelte 6\n\n/**\n * Schedules a callback to run immediately before the component is updated after any state change.\n *\n * The first time the callback runs will be before the initial `onMount`.\n *\n * In runes mode use `$effect.pre` instead.\n *\n * @deprecated Use [`$effect.pre`](https://svelte.dev/docs/svelte/$effect#$effect.pre) instead\n * @param {() => void} fn\n * @returns {void}\n */\nexport function beforeUpdate(fn) {\n\tif (component_context === null) {\n\t\te.lifecycle_outside_component('beforeUpdate');\n\t}\n\n\tif (component_context.l === null) {\n\t\te.lifecycle_legacy_only('beforeUpdate');\n\t}\n\n\tinit_update_callbacks(component_context).b.push(fn);\n}\n\n/**\n * Schedules a callback to run immediately after the component has been updated.\n *\n * The first time the callback runs will be after the initial `onMount`.\n *\n * In runes mode use `$effect` instead.\n *\n * @deprecated Use [`$effect`](https://svelte.dev/docs/svelte/$effect) instead\n * @param {() => void} fn\n * @returns {void}\n */\nexport function afterUpdate(fn) {\n\tif (component_context === null) {\n\t\te.lifecycle_outside_component('afterUpdate');\n\t}\n\n\tif (component_context.l === null) {\n\t\te.lifecycle_legacy_only('afterUpdate');\n\t}\n\n\tinit_update_callbacks(component_context).a.push(fn);\n}\n\n/**\n * Legacy-mode: Init callbacks object for onMount/beforeUpdate/afterUpdate\n * @param {ComponentContext} context\n */\nfunction init_update_callbacks(context) {\n\tvar l = /** @type {ComponentContextLegacy} */ (context).l;\n\treturn (l.u ??= { a: [], b: [], m: [] });\n}\n\nexport { flushSync, fork } from './internal/client/reactivity/batch.js';\nexport {\n\tcreateContext,\n\tgetContext,\n\tgetAllContexts,\n\thasContext,\n\tsetContext\n} from './internal/client/context.js';\nexport { hydratable } from './internal/client/hydratable.js';\nexport { hydrate, mount, unmount } from './internal/client/render.js';\nexport { tick, untrack, settled } from './internal/client/runtime.js';\nexport { createRawSnippet } from './internal/client/dom/blocks/snippet.js';\n","// generated during release, do not modify\n\n/**\n * The current version, as set in package.json.\n * @type {string}\n */\nexport const VERSION = '5.46.1';\nexport const PUBLIC_VERSION = '5';\n","import { PUBLIC_VERSION } from '../version.js';\n\nif (typeof window !== 'undefined') {\n\t// @ts-expect-error\n\t((window.__svelte ??= {}).v ??= new Set()).add(PUBLIC_VERSION);\n}\n","/**\r\n * Coordinate Utilities\r\n *\r\n * Pure functions for converting between pitch/time and canvas coordinates.\r\n * All dependencies are passed explicitly as parameters - no global store access.\r\n */\r\n\r\nimport type { PitchRowData, ModulationMarker } from '@mlt/types';\r\nimport type { CoordinateUtils, PitchGridViewport, LineStyle } from '../types.js';\r\n\r\n// ============================================================================\r\n// Configuration Types\r\n// ============================================================================\r\n\r\nexport interface CoordinateConfig {\r\n  /** Base cell width in pixels */\r\n  cellWidth: number;\r\n  /** Base cell height in pixels */\r\n  cellHeight: number;\r\n  /** Width multipliers for each canvas-space column */\r\n  columnWidths: number[];\r\n  /** Current viewport configuration */\r\n  viewport: PitchGridViewport;\r\n  /** Modulation markers (optional, for notation mode) */\r\n  tempoModulationMarkers?: ModulationMarker[];\r\n  /** Base microbeat pixel width (optional) */\r\n  baseMicrobeatPx?: number;\r\n}\r\n\r\nexport interface TimeBasedCoordinateConfig {\r\n  /** Base cell width in pixels */\r\n  cellWidth: number;\r\n  /** Base cell height in pixels */\r\n  cellHeight: number;\r\n  /** Current viewport configuration */\r\n  viewport: PitchGridViewport;\r\n  /** Scroll speed in pixels per second */\r\n  pixelsPerSecond: number;\r\n  /** X position of the \"now line\" (for highway mode) */\r\n  nowLineX?: number;\r\n  /** Current time in ms (for highway mode) */\r\n  currentTimeMs?: number;\r\n}\r\n\r\n// ============================================================================\r\n// Coordinate Factory Functions\r\n// ============================================================================\r\n\r\n/**\r\n * Create coordinate utilities for column-based layout (notation/playback modes).\r\n */\r\nexport function createColumnCoordinates(config: CoordinateConfig): CoordinateUtils {\r\n  const { cellHeight, columnWidths, viewport } = config;\r\n  const halfUnit = cellHeight / 2;\r\n\r\n  // Build cumulative column positions for fast lookup\r\n  const columnPositions = buildColumnPositions(columnWidths, config.cellWidth);\r\n\r\n  return {\r\n    getRowY(rowIndex: number): number {\r\n      const relativeRowIndex = rowIndex - viewport.startRow;\r\n      // Row centers are at half-cell intervals, offset by half a cell\r\n      return (relativeRowIndex + 1) * halfUnit;\r\n    },\r\n\r\n    getRowFromY(canvasY: number): number {\r\n      const relativeRowIndex = (canvasY / halfUnit) - 1;\r\n      return Math.round(relativeRowIndex) + viewport.startRow;\r\n    },\r\n\r\n    getColumnX(columnIndex: number): number {\r\n      if (columnIndex < 0) return 0;\r\n      if (columnIndex >= columnPositions.length) {\r\n        return columnPositions[columnPositions.length - 1] ?? 0;\r\n      }\r\n      return columnPositions[columnIndex] ?? 0;\r\n    },\r\n\r\n    getColumnFromX(canvasX: number): number {\r\n      // Binary search for the column\r\n      let left = 0;\r\n      let right = columnPositions.length - 1;\r\n\r\n      while (left < right) {\r\n        const mid = Math.floor((left + right) / 2);\r\n        if ((columnPositions[mid] ?? 0) <= canvasX) {\r\n          left = mid + 1;\r\n        } else {\r\n          right = mid;\r\n        }\r\n      }\r\n\r\n      return Math.max(0, left - 1);\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Create coordinate utilities for time-based layout (singing/highway modes).\r\n */\r\nexport function createTimeCoordinates(config: TimeBasedCoordinateConfig): CoordinateUtils {\r\n  const { cellHeight, viewport, pixelsPerSecond, nowLineX = 100, currentTimeMs = 0 } = config;\r\n  const halfUnit = cellHeight / 2;\r\n\r\n  return {\r\n    getRowY(rowIndex: number): number {\r\n      const relativeRowIndex = rowIndex - viewport.startRow;\r\n      // Row centers are at half-cell intervals, offset by half a cell\r\n      return (relativeRowIndex + 1) * halfUnit;\r\n    },\r\n\r\n    getRowFromY(canvasY: number): number {\r\n      const relativeRowIndex = (canvasY / halfUnit) - 1;\r\n      return Math.round(relativeRowIndex) + viewport.startRow;\r\n    },\r\n\r\n    getColumnX(_columnIndex: number): number {\r\n      // Not used in time-based modes\r\n      return 0;\r\n    },\r\n\r\n    getColumnFromX(_canvasX: number): number {\r\n      // Not used in time-based modes\r\n      return 0;\r\n    },\r\n\r\n    getTimeX(timeMs: number): number {\r\n      // In highway mode: notes flow right-to-left toward nowLineX\r\n      // At currentTimeMs, the position is nowLineX\r\n      const timeDelta = timeMs - currentTimeMs;\r\n      return nowLineX + (timeDelta / 1000) * pixelsPerSecond;\r\n    },\r\n\r\n    getTimeFromX(canvasX: number): number {\r\n      const timeDelta = ((canvasX - nowLineX) / pixelsPerSecond) * 1000;\r\n      return currentTimeMs + timeDelta;\r\n    },\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// Helper Functions\r\n// ============================================================================\r\n\r\n/**\r\n * Build cumulative column X positions from column widths.\r\n */\r\nfunction buildColumnPositions(columnWidths: number[], cellWidth: number): number[] {\r\n  const positions: number[] = [0];\r\n  let x = 0;\r\n\r\n  for (let i = 0; i < columnWidths.length; i++) {\r\n    const width = (columnWidths[i] ?? 1) * cellWidth;\r\n    x += width;\r\n    positions.push(x);\r\n  }\r\n\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Get visible row range with padding for smooth edge behavior.\r\n */\r\nexport function getVisibleRowRangeWithPadding(\r\n  viewport: PitchGridViewport,\r\n  fullRowData: PitchRowData[]\r\n): { startRow: number; endRow: number; paddedStartRow: number; paddedEndRow: number } {\r\n  const { startRow, endRow } = viewport;\r\n  const maxRowIndex = Math.max(0, fullRowData.length - 1);\r\n\r\n  return {\r\n    startRow,\r\n    endRow,\r\n    paddedStartRow: Math.max(0, startRow - 1),\r\n    paddedEndRow: Math.min(maxRowIndex, endRow + 1),\r\n  };\r\n}\r\n\r\n/**\r\n * Check if a row is visible (within viewport plus padding).\r\n */\r\nexport function isRowVisible(\r\n  globalRow: number,\r\n  viewport: PitchGridViewport,\r\n  cellHeight: number,\r\n  coords: CoordinateUtils\r\n): boolean {\r\n  const y = coords.getRowY(globalRow);\r\n  const padding = cellHeight;\r\n  return y >= -padding && y <= (viewport.containerHeight + padding);\r\n}\r\n\r\n// ============================================================================\r\n// Line Style Utilities\r\n// ============================================================================\r\n\r\n/**\r\n * Get pitch class from a pitch string (e.g., \"C4\" -> \"C\", \"B/A4\" -> \"B/A\").\r\n */\r\nexport function getPitchClass(pitchWithOctave: string): string {\r\n  let pc = (pitchWithOctave || '').replace(/\\d/g, '').trim();\r\n  pc = pc.replace(/b/g, 'b-').replace(/#/g, 'b_');\r\n  return pc;\r\n}\r\n\r\n/**\r\n * Get line style for a pitch class.\r\n * Used for horizontal grid lines.\r\n */\r\nexport function getLineStyleFromPitchClass(pitchClass: string): LineStyle {\r\n  switch (pitchClass) {\r\n    case 'C':\r\n      return { lineWidth: 3.33, dash: [], color: '#adb5bd' };\r\n    case 'E':\r\n      return { lineWidth: 1, dash: [5, 5], color: '#adb5bd' };\r\n    case 'G':\r\n      return { lineWidth: 1, dash: [], color: '#dee2e6' };\r\n    case 'B':\r\n    case 'A':\r\n    case 'F':\r\n    case 'Eb/Db':\r\n    case 'Db/C#':\r\n      return { lineWidth: 1, dash: [], color: '#ced4da' };\r\n    default:\r\n      return { lineWidth: 1, dash: [], color: '#ced4da' };\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// MIDI Conversion Utilities\r\n// ============================================================================\r\n\r\n/**\r\n * Convert MIDI note number to row index in fullRowData.\r\n * fullRowData is ordered C8 (index 0) to A0 (index 87).\r\n */\r\nexport function midiToRowIndex(midi: number, fullRowData: PitchRowData[]): number {\r\n  // MIDI 108 = C8 (index 0), MIDI 21 = A0 (index 87)\r\n  // Each semitone down increases the index by 1\r\n  const c8Midi = 108;\r\n  const rowIndex = c8Midi - Math.round(midi);\r\n\r\n  if (rowIndex < 0 || rowIndex >= fullRowData.length) {\r\n    return -1;\r\n  }\r\n\r\n  return rowIndex;\r\n}\r\n\r\n/**\r\n * Convert row index to MIDI note number.\r\n */\r\nexport function rowIndexToMidi(rowIndex: number, fullRowData: PitchRowData[]): number {\r\n  if (rowIndex < 0 || rowIndex >= fullRowData.length) {\r\n    return -1;\r\n  }\r\n\r\n  // MIDI 108 = C8 (index 0)\r\n  const c8Midi = 108;\r\n  return c8Midi - rowIndex;\r\n}\r\n\r\n/**\r\n * Convert frequency to MIDI note number.\r\n */\r\nexport function frequencyToMidi(frequency: number): number {\r\n  return 12 * Math.log2(frequency / 440) + 69;\r\n}\r\n\r\n/**\r\n * Convert MIDI note number to frequency.\r\n */\r\nexport function midiToFrequency(midi: number): number {\r\n  return 440 * Math.pow(2, (midi - 69) / 12);\r\n}\r\n","/**\n * Grid Lines Renderer\n *\n * Pure rendering functions for horizontal and vertical grid lines.\n * All dependencies are passed explicitly as parameters.\n */\n\nimport type { PitchRowData, MacrobeatGrouping, MacrobeatBoundaryStyle, TonicSign } from '@mlt/types';\nimport type { CoordinateUtils } from '../types.js';\nimport { getPitchClass, getLineStyleFromPitchClass } from './coordinateUtils.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface HorizontalLinesConfig {\n  fullRowData: PitchRowData[];\n  cellHeight: number;\n  viewportHeight: number;\n  viewportWidth: number;\n  colorMode: 'color' | 'bw';\n}\n\nexport interface VerticalLinesConfig {\n  columnWidths: number[];\n  cellWidth: number;\n  viewportHeight: number;\n  macrobeatGroupings: MacrobeatGrouping[];\n  macrobeatBoundaryStyles: MacrobeatBoundaryStyle[];\n  placedTonicSigns: TonicSign[];\n}\n\nexport interface TimeBasedVerticalLinesConfig {\n  viewportWidth: number;\n  viewportHeight: number;\n  beatIntervalMs: number;\n  measureIntervalMs?: number;\n  visibleTimeRange: { startMs: number; endMs: number };\n  nowLineX?: number;\n  /** Time offset for beat alignment (e.g., lead-in time) */\n  beatTimeOffsetMs?: number;\n}\n\n// ============================================================================\n// Anacrusis Colors (CSS variable fallback)\n// ============================================================================\n\nconst DEFAULT_ANACRUSIS_COLORS = {\n  stroke: '#c7cfd8',\n  background: 'rgba(207, 214, 222, 0.32)',\n};\n\nlet cachedAnacrusisColors: typeof DEFAULT_ANACRUSIS_COLORS | null = null;\n\nfunction getAnacrusisColors(): typeof DEFAULT_ANACRUSIS_COLORS {\n  if (cachedAnacrusisColors) return cachedAnacrusisColors;\n  if (typeof window === 'undefined') return DEFAULT_ANACRUSIS_COLORS;\n\n  try {\n    const styles = window.getComputedStyle(document.documentElement);\n    cachedAnacrusisColors = {\n      stroke: styles.getPropertyValue('--c-anacrusis-border').trim() || DEFAULT_ANACRUSIS_COLORS.stroke,\n      background: styles.getPropertyValue('--c-anacrusis-bg').trim() || DEFAULT_ANACRUSIS_COLORS.background,\n    };\n  } catch {\n    cachedAnacrusisColors = DEFAULT_ANACRUSIS_COLORS;\n  }\n\n  return cachedAnacrusisColors;\n}\n\n// ============================================================================\n// Horizontal Lines (Pitch Lines)\n// ============================================================================\n\n/**\n * Draw horizontal grid lines for visible rows.\n */\nexport function drawHorizontalLines(\n  ctx: CanvasRenderingContext2D,\n  config: HorizontalLinesConfig,\n  coords: CoordinateUtils,\n  startRow: number,\n  endRow: number,\n  startX: number = 0,\n  endX?: number\n): void {\n  const { fullRowData, viewportHeight, viewportWidth, cellHeight } = config;\n  const finalEndX = endX ?? viewportWidth;\n\n  // Pitch classes to skip (for cleaner visual appearance)\n  const pitchClassesToSkip = ['B', 'A', 'F', 'E/D', 'D/C'];\n\n  for (let rowIndex = startRow; rowIndex <= endRow; rowIndex++) {\n    const row = fullRowData[rowIndex];\n    if (!row) continue;\n\n    // Skip boundary padding rows\n    if (row.isBoundary) continue;\n\n    const y = coords.getRowY(rowIndex);\n\n    // Skip if outside viewport (with small buffer)\n    if (y < -10 || y > viewportHeight + 10) continue;\n\n    const pitchClass = getPitchClass(row.pitch);\n\n    // Skip certain pitch classes for cleaner appearance\n    if (pitchClassesToSkip.includes(pitchClass)) continue;\n\n    const style = getLineStyleFromPitchClass(pitchClass);\n\n    if (pitchClass === 'G') {\n      // G-line: Draw filled rectangle\n      ctx.save();\n      ctx.fillStyle = style.color;\n      ctx.fillRect(startX, y - cellHeight / 2, finalEndX - startX, cellHeight);\n      ctx.restore();\n    } else {\n      // All other lines: Draw stroke\n      ctx.beginPath();\n      ctx.moveTo(startX, y);\n      ctx.lineTo(finalEndX, y);\n      ctx.lineWidth = style.lineWidth;\n      ctx.strokeStyle = style.color;\n      ctx.setLineDash(style.dash);\n      ctx.stroke();\n      ctx.setLineDash([]);\n    }\n  }\n}\n\n/**\n * Draw simple horizontal lines for singing/highway modes.\n * These modes don't need the complex anacrusis/tonic column handling.\n */\nexport function drawSimpleHorizontalLines(\n  ctx: CanvasRenderingContext2D,\n  config: HorizontalLinesConfig,\n  coords: CoordinateUtils,\n  startRow: number,\n  endRow: number\n): void {\n  drawHorizontalLines(ctx, config, coords, startRow, endRow, 0, config.viewportWidth);\n}\n\n// ============================================================================\n// Vertical Lines (Beat/Measure Lines) - Notation Mode\n// ============================================================================\n\n/**\n * Draw vertical grid lines for column-based layout (notation/playback modes).\n */\nexport function drawVerticalLines(\n  ctx: CanvasRenderingContext2D,\n  config: VerticalLinesConfig,\n  coords: CoordinateUtils,\n  macrobeatBoundaries: number[]\n): void {\n  const { columnWidths, viewportHeight, macrobeatBoundaryStyles, placedTonicSigns } = config;\n  const totalColumns = columnWidths.length;\n\n  for (let canvasCol = 0; canvasCol <= totalColumns; canvasCol++) {\n    const isGridStartOrEnd = canvasCol === 0 || canvasCol === totalColumns;\n    const isTonicColumnStart = isTonicColumn(canvasCol, placedTonicSigns);\n    const isTonicColumnEnd = placedTonicSigns.some(ts => canvasCol === ts.columnIndex + 2);\n    const isMacrobeatEnd = macrobeatBoundaries.includes(canvasCol);\n    const shouldDraw = shouldDrawVerticalLineAtColumn(canvasCol, placedTonicSigns);\n\n    if (!shouldDraw) continue;\n\n    let style: { lineWidth: number; strokeStyle: string; dash: number[] } | null = null;\n\n    if (isGridStartOrEnd || isTonicColumnStart || isTonicColumnEnd) {\n      style = { lineWidth: 2, strokeStyle: '#adb5bd', dash: [] };\n    } else if (isMacrobeatEnd) {\n      const mbIndex = macrobeatBoundaries.indexOf(canvasCol);\n      const boundaryStyle = macrobeatBoundaryStyles[mbIndex] ?? 'dashed';\n\n      if (boundaryStyle === 'anacrusis') {\n        const { stroke } = getAnacrusisColors();\n        style = { lineWidth: 1, strokeStyle: stroke, dash: [4, 4] };\n      } else {\n        style = {\n          lineWidth: 1,\n          strokeStyle: '#adb5bd',\n          dash: boundaryStyle === 'solid' ? [] : [5, 5],\n        };\n      }\n    }\n\n    if (!style) continue;\n\n    const x = coords.getColumnX(canvasCol);\n    ctx.beginPath();\n    ctx.moveTo(x, 0);\n    ctx.lineTo(x, viewportHeight);\n    ctx.lineWidth = style.lineWidth;\n    ctx.strokeStyle = style.strokeStyle;\n    ctx.setLineDash(style.dash);\n    ctx.stroke();\n  }\n\n  ctx.setLineDash([]);\n}\n\n// ============================================================================\n// Vertical Lines (Beat/Measure Lines) - Time-Based Mode\n// ============================================================================\n\n/**\n * Draw vertical grid lines for time-based layout (singing/highway modes).\n */\nexport function drawTimeBasedVerticalLines(\n  ctx: CanvasRenderingContext2D,\n  config: TimeBasedVerticalLinesConfig,\n  coords: CoordinateUtils\n): void {\n  const { viewportHeight, beatIntervalMs, measureIntervalMs, visibleTimeRange, nowLineX, beatTimeOffsetMs = 0 } = config;\n\n  // Calculate beat positions within visible time range, accounting for time offset\n  // Beats should align with: offset, offset + beatIntervalMs, offset + 2*beatIntervalMs, etc.\n  const adjustedStart = visibleTimeRange.startMs - beatTimeOffsetMs;\n  const adjustedEnd = visibleTimeRange.endMs - beatTimeOffsetMs;\n  const firstBeatIndex = Math.floor(adjustedStart / beatIntervalMs);\n  const lastBeatIndex = Math.ceil(adjustedEnd / beatIntervalMs);\n\n  for (let beatIndex = firstBeatIndex; beatIndex <= lastBeatIndex; beatIndex++) {\n    const timeMs = beatTimeOffsetMs + (beatIndex * beatIntervalMs);\n    const x = coords.getTimeX?.(timeMs);\n    if (x === undefined) continue;\n\n    // Determine if this is a measure boundary (every 4 beats from the offset)\n    const isMeasure = measureIntervalMs\n      ? ((timeMs - beatTimeOffsetMs) % measureIntervalMs === 0)\n      : false;\n\n    ctx.beginPath();\n    ctx.moveTo(x, 0);\n    ctx.lineTo(x, viewportHeight);\n    ctx.lineWidth = isMeasure ? 2 : 1;\n    ctx.strokeStyle = isMeasure ? '#adb5bd' : '#dee2e6';\n    ctx.setLineDash(isMeasure ? [] : [5, 5]);\n    ctx.stroke();\n  }\n\n  ctx.setLineDash([]);\n\n  // Draw \"now line\" if specified (highway mode)\n  if (nowLineX !== undefined) {\n    ctx.beginPath();\n    ctx.moveTo(nowLineX, 0);\n    ctx.lineTo(nowLineX, viewportHeight);\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = '#00ff00';\n    ctx.setLineDash([]);\n    ctx.stroke();\n  }\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Check if a column is the start of a tonic column.\n */\nfunction isTonicColumn(columnIndex: number, placedTonicSigns: TonicSign[]): boolean {\n  return placedTonicSigns.some(ts => ts.columnIndex === columnIndex);\n}\n\n/**\n * Check if a vertical line should be drawn at this column.\n * Skip drawing in the middle of tonic columns (columnIndex + 1).\n */\nfunction shouldDrawVerticalLineAtColumn(columnIndex: number, placedTonicSigns: TonicSign[]): boolean {\n  // Skip the middle column of tonic signs (they span 2 columns)\n  return !placedTonicSigns.some(ts => ts.columnIndex + 1 === columnIndex);\n}\n","/**\n * FULL PITCH GAMUT DATA\n * =====================\n * The single source of truth for all pitch information across Music Learning Tools.\n *\n * STRUCTURE:\n * Contains pitch rows from C8 (highest) to A0 (lowest audible pitch).\n * Each object contains:\n * - pitch: The display name for the pitch (e.g., \"B/A7\") - combined notation for accidentals, single for naturals.\n * - flatName: The flat enharmonic spelling (e.g., \"B7\") - same as pitch for naturals.\n * - sharpName: The sharp enharmonic spelling (e.g., \"A7\") - same as pitch for naturals.\n * - toneNote: The scientific pitch notation compatible with Tone.js (e.g., \"Bb7\").\n * - frequency: The frequency in Hz.\n * - column: The pitch-row parity column ('A' or 'B') used by the pitch-to-Y axis mapping.\n * - hex: The specific color code for this exact pitch.\n * - isAccidental: Boolean flag indicating if this is a black key (accidental note).\n * - midi: MIDI note number (21-108 for A0-C8).\n * - pitchClass: Pitch class (0-11, where C=0).\n * - octave: Octave number (-1 to 8).\n *\n * MUSICAL RANGE:\n * - Audible range: Rows 0..87 (C8 to A0) - standard 88-key piano range\n * - MIDI numbers: 108 (C8) to 21 (A0)\n */\nimport type { PitchRowData } from '@mlt/types';\n\nexport const fullRowData: PitchRowData[] = [\n  // === AUDIBLE PITCH RANGE (C8 to A0) ===\n  { pitch: 'C8', flatName: 'C8', sharpName: 'C8', toneNote: 'C8', frequency: 4186.01, column: 'A', hex: '#fcfcfc', isAccidental: false, midi: 108, pitchClass: 0, octave: 8 },\n  { pitch: 'B7', flatName: 'B7', sharpName: 'B7', toneNote: 'B7', frequency: 3951.07, column: 'B', hex: '#fcf7fc', isAccidental: false, midi: 107, pitchClass: 11, octave: 7 },\n  { pitch: 'B/A7', flatName: 'B7', sharpName: 'A7', toneNote: 'Bb7', frequency: 3729.31, column: 'A', hex: '#f7f5fd', isAccidental: true, midi: 106, pitchClass: 10, octave: 7 },\n  { pitch: 'A7', flatName: 'A7', sharpName: 'A7', toneNote: 'A7', frequency: 3520.00, column: 'B', hex: '#f0f4ff', isAccidental: false, midi: 105, pitchClass: 9, octave: 7 },\n  { pitch: 'A/G7', flatName: 'A7', sharpName: 'G7', toneNote: 'Ab7', frequency: 3322.44, column: 'A', hex: '#e6f3fd', isAccidental: true, midi: 104, pitchClass: 8, octave: 7 },\n  { pitch: 'G7', flatName: 'G7', sharpName: 'G7', toneNote: 'G7', frequency: 3135.96, column: 'B', hex: '#def3f7', isAccidental: false, midi: 103, pitchClass: 7, octave: 7 },\n  { pitch: 'G/F7', flatName: 'G7', sharpName: 'F7', toneNote: 'Gb7', frequency: 2959.96, column: 'A', hex: '#daf2ec', isAccidental: true, midi: 102, pitchClass: 6, octave: 7 },\n  { pitch: 'F7', flatName: 'F7', sharpName: 'F7', toneNote: 'F7', frequency: 2793.83, column: 'B', hex: '#dcefdf', isAccidental: false, midi: 101, pitchClass: 5, octave: 7 },\n  { pitch: 'E7', flatName: 'E7', sharpName: 'E7', toneNote: 'E7', frequency: 2637.02, column: 'A', hex: '#e3ebd1', isAccidental: false, midi: 100, pitchClass: 4, octave: 7 },\n  { pitch: 'E/D7', flatName: 'E7', sharpName: 'D7', toneNote: 'Eb7', frequency: 2489.02, column: 'B', hex: '#eee4c8', isAccidental: true, midi: 99, pitchClass: 3, octave: 7 },\n  { pitch: 'D7', flatName: 'D7', sharpName: 'D7', toneNote: 'D7', frequency: 2349.32, column: 'A', hex: '#f8dcc6', isAccidental: false, midi: 98, pitchClass: 2, octave: 7 },\n  { pitch: 'D/C7', flatName: 'D7', sharpName: 'C7', toneNote: 'Db7', frequency: 2217.46, column: 'B', hex: '#fcd4cd', isAccidental: true, midi: 97, pitchClass: 1, octave: 7 },\n  { pitch: 'C7', flatName: 'C7', sharpName: 'C7', toneNote: 'C7', frequency: 2093.00, column: 'A', hex: '#facfdb', isAccidental: false, midi: 96, pitchClass: 0, octave: 7 },\n  { pitch: 'B6', flatName: 'B6', sharpName: 'B6', toneNote: 'B6', frequency: 1975.53, column: 'B', hex: '#efcdeb', isAccidental: false, midi: 95, pitchClass: 11, octave: 6 },\n  { pitch: 'B/A6', flatName: 'B6', sharpName: 'A6', toneNote: 'Bb6', frequency: 1864.66, column: 'A', hex: '#ddcff9', isAccidental: true, midi: 94, pitchClass: 10, octave: 6 },\n  { pitch: 'A6', flatName: 'A6', sharpName: 'A6', toneNote: 'A6', frequency: 1760.00, column: 'B', hex: '#c4d3ff', isAccidental: false, midi: 93, pitchClass: 9, octave: 6 },\n  { pitch: 'A/G6', flatName: 'A6', sharpName: 'G6', toneNote: 'Ab6', frequency: 1661.22, column: 'A', hex: '#abd9fa', isAccidental: true, midi: 92, pitchClass: 8, octave: 6 },\n  { pitch: 'G6', flatName: 'G6', sharpName: 'G6', toneNote: 'G6', frequency: 1567.94, column: 'B', hex: '#98dde9', isAccidental: false, midi: 91, pitchClass: 7, octave: 6 },\n  { pitch: 'G/F6', flatName: 'G6', sharpName: 'F6', toneNote: 'Gb6', frequency: 1479.98, column: 'A', hex: '#96ddcf', isAccidental: true, midi: 90, pitchClass: 6, octave: 6 },\n  { pitch: 'F6', flatName: 'F6', sharpName: 'F6', toneNote: 'F6', frequency: 1396.91, column: 'B', hex: '#a6d9b0', isAccidental: false, midi: 89, pitchClass: 5, octave: 6 },\n  { pitch: 'E6', flatName: 'E6', sharpName: 'E6', toneNote: 'E6', frequency: 1318.51, column: 'A', hex: '#c0d093', isAccidental: false, midi: 88, pitchClass: 4, octave: 6 },\n  { pitch: 'E/D6', flatName: 'E6', sharpName: 'D6', toneNote: 'Eb6', frequency: 1244.51, column: 'B', hex: '#dbc383', isAccidental: true, midi: 87, pitchClass: 3, octave: 6 },\n  { pitch: 'D6', flatName: 'D6', sharpName: 'D6', toneNote: 'D6', frequency: 1174.66, column: 'A', hex: '#efb586', isAccidental: false, midi: 86, pitchClass: 2, octave: 6 },\n  { pitch: 'D/C6', flatName: 'D6', sharpName: 'C6', toneNote: 'Db6', frequency: 1108.73, column: 'B', hex: '#f8a99c', isAccidental: true, midi: 85, pitchClass: 1, octave: 6 },\n  { pitch: 'C6', flatName: 'C6', sharpName: 'C6', toneNote: 'C6', frequency: 1046.50, column: 'A', hex: '#f3a2bb', isAccidental: false, midi: 84, pitchClass: 0, octave: 6 },\n  { pitch: 'B5', flatName: 'B5', sharpName: 'B5', toneNote: 'B5', frequency: 987.77, column: 'B', hex: '#e1a3db', isAccidental: false, midi: 83, pitchClass: 11, octave: 5 },\n  { pitch: 'B/A5', flatName: 'B5', sharpName: 'A5', toneNote: 'Bb5', frequency: 932.33, column: 'A', hex: '#c3a9f4', isAccidental: true, midi: 82, pitchClass: 10, octave: 5 },\n  { pitch: 'A5', flatName: 'A5', sharpName: 'A5', toneNote: 'A5', frequency: 880.00, column: 'B', hex: '#9ab2ff', isAccidental: false, midi: 81, pitchClass: 9, octave: 5 },\n  { pitch: 'A/G5', flatName: 'A5', sharpName: 'G5', toneNote: 'Ab5', frequency: 830.61, column: 'A', hex: '#67bdf7', isAccidental: true, midi: 80, pitchClass: 8, octave: 5 },\n  { pitch: 'G5', flatName: 'G5', sharpName: 'G5', toneNote: 'G5', frequency: 783.99, column: 'B', hex: '#30c6dc', isAccidental: false, midi: 79, pitchClass: 7, octave: 5 },\n  { pitch: 'G/F5', flatName: 'G5', sharpName: 'F5', toneNote: 'Gb5', frequency: 739.99, column: 'A', hex: '#32c8b2', isAccidental: true, midi: 78, pitchClass: 6, octave: 5 },\n  { pitch: 'F5', flatName: 'F5', sharpName: 'F5', toneNote: 'F5', frequency: 698.46, column: 'B', hex: '#6dc281', isAccidental: false, midi: 77, pitchClass: 5, octave: 5 },\n  { pitch: 'E5', flatName: 'E5', sharpName: 'E5', toneNote: 'E5', frequency: 659.25, column: 'A', hex: '#a0b556', isAccidental: false, midi: 76, pitchClass: 4, octave: 5 },\n  { pitch: 'E/D5', flatName: 'E5', sharpName: 'D5', toneNote: 'Eb5', frequency: 622.25, column: 'B', hex: '#c5a33f', isAccidental: true, midi: 75, pitchClass: 3, octave: 5 },\n  { pitch: 'D5', flatName: 'D5', sharpName: 'D5', toneNote: 'D5', frequency: 587.33, column: 'A', hex: '#dc9150', isAccidental: false, midi: 74, pitchClass: 2, octave: 5 },\n  { pitch: 'D/C5', flatName: 'D5', sharpName: 'C5', toneNote: 'Db5', frequency: 554.37, column: 'B', hex: '#e38475', isAccidental: true, midi: 73, pitchClass: 1, octave: 5 },\n  { pitch: 'C5', flatName: 'C5', sharpName: 'C5', toneNote: 'C5', frequency: 523.25, column: 'A', hex: '#dc7f9d', isAccidental: false, midi: 72, pitchClass: 0, octave: 5 },\n  { pitch: 'B4', flatName: 'B4', sharpName: 'B4', toneNote: 'B4', frequency: 493.88, column: 'B', hex: '#c781c0', isAccidental: false, midi: 71, pitchClass: 11, octave: 4 },\n  { pitch: 'B/A4', flatName: 'B4', sharpName: 'A4', toneNote: 'Bb4', frequency: 466.16, column: 'A', hex: '#a68ad8', isAccidental: true, midi: 70, pitchClass: 10, octave: 4 },\n  { pitch: 'A4', flatName: 'A4', sharpName: 'A4', toneNote: 'A4', frequency: 440.00, column: 'B', hex: '#7d94e0', isAccidental: false, midi: 69, pitchClass: 9, octave: 4 },\n  { pitch: 'A/G4', flatName: 'A4', sharpName: 'G4', toneNote: 'Ab4', frequency: 415.30, column: 'A', hex: '#4c9fd5', isAccidental: true, midi: 68, pitchClass: 8, octave: 4 },\n  { pitch: 'G4', flatName: 'G4', sharpName: 'G4', toneNote: 'G4', frequency: 392.00, column: 'B', hex: '#0fa6ba', isAccidental: false, midi: 67, pitchClass: 7, octave: 4 },\n  { pitch: 'G/F4', flatName: 'G4', sharpName: 'F4', toneNote: 'Gb4', frequency: 369.99, column: 'A', hex: '#24a794', isAccidental: true, midi: 66, pitchClass: 6, octave: 4 },\n  { pitch: 'F4', flatName: 'F4', sharpName: 'F4', toneNote: 'F4', frequency: 349.23, column: 'B', hex: '#5aa26a', isAccidental: false, midi: 65, pitchClass: 5, octave: 4 },\n  { pitch: 'E4', flatName: 'E4', sharpName: 'E4', toneNote: 'E4', frequency: 329.63, column: 'A', hex: '#849646', isAccidental: false, midi: 64, pitchClass: 4, octave: 4 },\n  { pitch: 'E/D4', flatName: 'E4', sharpName: 'D4', toneNote: 'Eb4', frequency: 311.13, column: 'B', hex: '#a38733', isAccidental: true, midi: 63, pitchClass: 3, octave: 4 },\n  { pitch: 'D4', flatName: 'D4', sharpName: 'D4', toneNote: 'D4', frequency: 293.66, column: 'A', hex: '#b67740', isAccidental: false, midi: 62, pitchClass: 2, octave: 4 },\n  { pitch: 'D/C4', flatName: 'D4', sharpName: 'C4', toneNote: 'Db4', frequency: 277.18, column: 'B', hex: '#bc6c5f', isAccidental: true, midi: 61, pitchClass: 1, octave: 4 },\n  { pitch: 'C4', flatName: 'C4', sharpName: 'C4', toneNote: 'C4', frequency: 261.63, column: 'A', hex: '#b56880', isAccidental: false, midi: 60, pitchClass: 0, octave: 4 },\n  { pitch: 'B3', flatName: 'B3', sharpName: 'B3', toneNote: 'B3', frequency: 246.94, column: 'B', hex: '#a3699e', isAccidental: false, midi: 59, pitchClass: 11, octave: 3 },\n  { pitch: 'B/A3', flatName: 'B3', sharpName: 'A3', toneNote: 'Bb3', frequency: 233.08, column: 'A', hex: '#8870b1', isAccidental: true, midi: 58, pitchClass: 10, octave: 3 },\n  { pitch: 'A3', flatName: 'A3', sharpName: 'A3', toneNote: 'A3', frequency: 220.00, column: 'B', hex: '#6578b7', isAccidental: false, midi: 57, pitchClass: 9, octave: 3 },\n  { pitch: 'A/G3', flatName: 'A3', sharpName: 'G3', toneNote: 'Ab3', frequency: 207.65, column: 'A', hex: '#3c81ad', isAccidental: true, midi: 56, pitchClass: 8, octave: 3 },\n  { pitch: 'G3', flatName: 'G3', sharpName: 'G3', toneNote: 'G3', frequency: 196.00, column: 'B', hex: '#0e8696', isAccidental: false, midi: 55, pitchClass: 7, octave: 3 },\n  { pitch: 'G/F3', flatName: 'G3', sharpName: 'F3', toneNote: 'Gb3', frequency: 185.00, column: 'A', hex: '#1b8777', isAccidental: true, midi: 54, pitchClass: 6, octave: 3 },\n  { pitch: 'F3', flatName: 'F3', sharpName: 'F3', toneNote: 'F3', frequency: 174.61, column: 'B', hex: '#478255', isAccidental: false, midi: 53, pitchClass: 5, octave: 3 },\n  { pitch: 'E3', flatName: 'E3', sharpName: 'E3', toneNote: 'E3', frequency: 164.81, column: 'A', hex: '#697836', isAccidental: false, midi: 52, pitchClass: 4, octave: 3 },\n  { pitch: 'E/D3', flatName: 'E3', sharpName: 'D3', toneNote: 'Eb3', frequency: 155.56, column: 'B', hex: '#836b27', isAccidental: true, midi: 51, pitchClass: 3, octave: 3 },\n  { pitch: 'D3', flatName: 'D3', sharpName: 'D3', toneNote: 'D3', frequency: 146.83, column: 'A', hex: '#925e32', isAccidental: false, midi: 50, pitchClass: 2, octave: 3 },\n  { pitch: 'D/C3', flatName: 'D3', sharpName: 'C3', toneNote: 'Db3', frequency: 138.59, column: 'B', hex: '#96554b', isAccidental: true, midi: 49, pitchClass: 1, octave: 3 },\n  { pitch: 'C3', flatName: 'C3', sharpName: 'C3', toneNote: 'C3', frequency: 130.81, column: 'A', hex: '#905165', isAccidental: false, midi: 48, pitchClass: 0, octave: 3 },\n  { pitch: 'B2', flatName: 'B2', sharpName: 'B2', toneNote: 'B2', frequency: 123.47, column: 'B', hex: '#80527c', isAccidental: false, midi: 47, pitchClass: 11, octave: 2 },\n  { pitch: 'B/A2', flatName: 'B2', sharpName: 'A2', toneNote: 'Bb2', frequency: 116.54, column: 'A', hex: '#6a578c', isAccidental: true, midi: 46, pitchClass: 10, octave: 2 },\n  { pitch: 'A2', flatName: 'A2', sharpName: 'A2', toneNote: 'A2', frequency: 110.00, column: 'B', hex: '#4e5e90', isAccidental: false, midi: 45, pitchClass: 9, octave: 2 },\n  { pitch: 'A/G2', flatName: 'A2', sharpName: 'G2', toneNote: 'Ab2', frequency: 103.83, column: 'A', hex: '#2d6488', isAccidental: true, midi: 44, pitchClass: 8, octave: 2 },\n  { pitch: 'G2', flatName: 'G2', sharpName: 'G2', toneNote: 'G2', frequency: 98.00, column: 'B', hex: '#096875', isAccidental: false, midi: 43, pitchClass: 7, octave: 2 },\n  { pitch: 'G/F2', flatName: 'G2', sharpName: 'F2', toneNote: 'Gb2', frequency: 92.50, column: 'A', hex: '#13685b', isAccidental: true, midi: 42, pitchClass: 6, octave: 2 },\n  { pitch: 'F2', flatName: 'F2', sharpName: 'F2', toneNote: 'F2', frequency: 87.31, column: 'B', hex: '#356440', isAccidental: false, midi: 41, pitchClass: 5, octave: 2 },\n  { pitch: 'E2', flatName: 'E2', sharpName: 'E2', toneNote: 'E2', frequency: 82.41, column: 'A', hex: '#505c28', isAccidental: false, midi: 40, pitchClass: 4, octave: 2 },\n  { pitch: 'E/D2', flatName: 'E2', sharpName: 'D2', toneNote: 'Eb2', frequency: 77.78, column: 'B', hex: '#63511c', isAccidental: true, midi: 39, pitchClass: 3, octave: 2 },\n  { pitch: 'D2', flatName: 'D2', sharpName: 'D2', toneNote: 'D2', frequency: 73.42, column: 'A', hex: '#6e4724', isAccidental: false, midi: 38, pitchClass: 2, octave: 2 },\n  { pitch: 'D/C2', flatName: 'D2', sharpName: 'C2', toneNote: 'Db2', frequency: 69.30, column: 'B', hex: '#713f37', isAccidental: true, midi: 37, pitchClass: 1, octave: 2 },\n  { pitch: 'C2', flatName: 'C2', sharpName: 'C2', toneNote: 'C2', frequency: 65.41, column: 'A', hex: '#6c3c4b', isAccidental: false, midi: 36, pitchClass: 0, octave: 2 },\n  { pitch: 'B1', flatName: 'B1', sharpName: 'B1', toneNote: 'B1', frequency: 61.74, column: 'B', hex: '#603c5d', isAccidental: false, midi: 35, pitchClass: 11, octave: 1 },\n  { pitch: 'B/A1', flatName: 'B1', sharpName: 'A1', toneNote: 'Bb1', frequency: 58.27, column: 'A', hex: '#4e4068', isAccidental: true, midi: 34, pitchClass: 10, octave: 1 },\n  { pitch: 'A1', flatName: 'A1', sharpName: 'A1', toneNote: 'A1', frequency: 55.00, column: 'B', hex: '#38446b', isAccidental: false, midi: 33, pitchClass: 9, octave: 1 },\n  { pitch: 'A/G1', flatName: 'A1', sharpName: 'G1', toneNote: 'Ab1', frequency: 51.91, column: 'A', hex: '#1f4964', isAccidental: true, midi: 32, pitchClass: 8, octave: 1 },\n  { pitch: 'G1', flatName: 'G1', sharpName: 'G1', toneNote: 'G1', frequency: 49.00, column: 'B', hex: '#044b55', isAccidental: false, midi: 31, pitchClass: 7, octave: 1 },\n  { pitch: 'G/F1', flatName: 'G1', sharpName: 'F1', toneNote: 'Gb1', frequency: 46.25, column: 'A', hex: '#0c4b41', isAccidental: true, midi: 30, pitchClass: 6, octave: 1 },\n  { pitch: 'F1', flatName: 'F1', sharpName: 'F1', toneNote: 'F1', frequency: 43.65, column: 'B', hex: '#24472c', isAccidental: false, midi: 29, pitchClass: 5, octave: 1 },\n  { pitch: 'E1', flatName: 'E1', sharpName: 'E1', toneNote: 'E1', frequency: 41.20, column: 'A', hex: '#38401a', isAccidental: false, midi: 28, pitchClass: 4, octave: 1 },\n  { pitch: 'E/D1', flatName: 'E1', sharpName: 'D1', toneNote: 'Eb1', frequency: 38.89, column: 'B', hex: '#463811', isAccidental: true, midi: 27, pitchClass: 3, octave: 1 },\n  { pitch: 'D1', flatName: 'D1', sharpName: 'D1', toneNote: 'D1', frequency: 36.71, column: 'A', hex: '#4d3017', isAccidental: false, midi: 26, pitchClass: 2, octave: 1 },\n  { pitch: 'D/C1', flatName: 'D1', sharpName: 'C1', toneNote: 'Db1', frequency: 34.65, column: 'B', hex: '#4f2a24', isAccidental: true, midi: 25, pitchClass: 1, octave: 1 },\n  { pitch: 'C1', flatName: 'C1', sharpName: 'C1', toneNote: 'C1', frequency: 32.70, column: 'A', hex: '#4a2733', isAccidental: false, midi: 24, pitchClass: 0, octave: 1 },\n  { pitch: 'B0', flatName: 'B0', sharpName: 'B0', toneNote: 'B0', frequency: 30.87, column: 'B', hex: '#41273f', isAccidental: false, midi: 23, pitchClass: 11, octave: 0 },\n  { pitch: 'B/A0', flatName: 'B0', sharpName: 'A0', toneNote: 'Bb0', frequency: 29.14, column: 'A', hex: '#342a46', isAccidental: true, midi: 22, pitchClass: 10, octave: 0 },\n  { pitch: 'A0', flatName: 'A0', sharpName: 'A0', toneNote: 'A0', frequency: 27.50, column: 'B', hex: '#242c48', isAccidental: false, midi: 21, pitchClass: 9, octave: 0 },\n];\n","/**\n * Pitch Data Utilities\n *\n * Helper functions for working with the full pitch gamut.\n */\nimport type { PitchRowData } from '@mlt/types';\nimport { fullRowData } from './pitchData.js';\n\n// Pre-build lookup maps for O(1) access\nconst toneNoteToIndex = new Map<string, number>();\nconst midiToIndex = new Map<number, number>();\n\nfullRowData.forEach((row, index) => {\n  toneNoteToIndex.set(row.toneNote, index);\n  if (row.midi !== undefined) {\n    midiToIndex.set(row.midi, index);\n  }\n});\n\n/**\n * Get pitch row data by Tone.js note name (e.g., 'C4', 'Bb5')\n */\nexport function getPitchByToneNote(toneNote: string): PitchRowData | undefined {\n  const index = toneNoteToIndex.get(toneNote);\n  return index !== undefined ? fullRowData[index] : undefined;\n}\n\n/**\n * Get pitch row data by index in fullRowData (0 = C8, 87 = A0)\n */\nexport function getPitchByIndex(index: number): PitchRowData | undefined {\n  return fullRowData[index];\n}\n\n/**\n * Get the index of a pitch by its Tone.js note name\n */\nexport function getPitchIndex(toneNote: string): number {\n  return toneNoteToIndex.get(toneNote) ?? -1;\n}\n\n/**\n * Get pitch row data by MIDI note number (21-108)\n */\nexport function getPitchByMidi(midi: number): PitchRowData | undefined {\n  const index = midiToIndex.get(midi);\n  return index !== undefined ? fullRowData[index] : undefined;\n}\n\n/**\n * Get MIDI note number from Tone.js note name\n */\nexport function getMidiFromToneNote(toneNote: string): number | undefined {\n  const pitch = getPitchByToneNote(toneNote);\n  return pitch?.midi;\n}\n\n/**\n * Resolve pitch range from Tone.js note names\n * Returns start/end indices in fullRowData (topIndex < bottomIndex since C8 is index 0)\n */\nexport function resolvePitchRange(\n  topToneNote: string,\n  bottomToneNote: string\n): { topIndex: number; bottomIndex: number } | null {\n  const topIndex = getPitchIndex(topToneNote);\n  const bottomIndex = getPitchIndex(bottomToneNote);\n\n  if (topIndex === -1 || bottomIndex === -1) {\n    return null;\n  }\n\n  return {\n    topIndex: Math.min(topIndex, bottomIndex),\n    bottomIndex: Math.max(topIndex, bottomIndex),\n  };\n}\n\n/**\n * Get a slice of row data for a specific pitch range\n * @param topToneNote - Highest pitch (e.g., 'C6')\n * @param bottomToneNote - Lowest pitch (e.g., 'C3')\n */\nexport function getRowDataForRange(\n  topToneNote: string,\n  bottomToneNote: string\n): PitchRowData[] {\n  const range = resolvePitchRange(topToneNote, bottomToneNote);\n  if (!range) return [];\n  return fullRowData.slice(range.topIndex, range.bottomIndex + 1);\n}\n\n/**\n * Generate row data for a MIDI range (useful for singing trainer)\n * @param minMidi - Lowest MIDI note (e.g., 48 for C3)\n * @param maxMidi - Highest MIDI note (e.g., 84 for C6)\n */\nexport function generateRowDataForMidiRange(\n  minMidi: number,\n  maxMidi: number\n): PitchRowData[] {\n  const rows: PitchRowData[] = [];\n\n  // Iterate from high to low (fullRowData order is C8 to A0)\n  for (let midi = maxMidi; midi >= minMidi; midi--) {\n    const pitch = getPitchByMidi(midi);\n    if (pitch) {\n      rows.push(pitch);\n    }\n  }\n\n  return rows;\n}\n\n// ============================================================================\n// MIDI Range Helpers\n// ============================================================================\n\n/**\n * A MIDI range representing a span of pitches.\n */\nexport interface MidiRange {\n  /** Lowest MIDI note number */\n  minMidi: number;\n  /** Highest MIDI note number */\n  maxMidi: number;\n}\n\n/**\n * Get MIDI range from Tone.js note names.\n * @param lowNote - Lower pitch (e.g., 'C3')\n * @param highNote - Higher pitch (e.g., 'C5')\n * @returns MidiRange or null if notes are invalid\n *\n * @example\n * getMidiRangeFromToneNotes('C3', 'C5') // { minMidi: 48, maxMidi: 72 }\n * getMidiRangeFromToneNotes('A2', 'A4') // { minMidi: 45, maxMidi: 69 }\n */\nexport function getMidiRangeFromToneNotes(\n  lowNote: string,\n  highNote: string\n): MidiRange | null {\n  const lowMidi = getMidiFromToneNote(lowNote);\n  const highMidi = getMidiFromToneNote(highNote);\n\n  if (lowMidi === undefined || highMidi === undefined) {\n    return null;\n  }\n\n  return {\n    minMidi: Math.min(lowMidi, highMidi),\n    maxMidi: Math.max(lowMidi, highMidi),\n  };\n}\n\n/**\n * Get Tone.js note names from a MIDI range.\n * @param range - MIDI range object\n * @returns Object with lowNote and highNote, or null if invalid\n *\n * @example\n * getToneNotesFromMidiRange({ minMidi: 48, maxMidi: 72 }) // { lowNote: 'C3', highNote: 'C5' }\n */\nexport function getToneNotesFromMidiRange(\n  range: MidiRange\n): { lowNote: string; highNote: string } | null {\n  const lowPitch = getPitchByMidi(range.minMidi);\n  const highPitch = getPitchByMidi(range.maxMidi);\n\n  if (!lowPitch || !highPitch) {\n    return null;\n  }\n\n  return {\n    lowNote: lowPitch.toneNote,\n    highNote: highPitch.toneNote,\n  };\n}\n\n/**\n * Expand a MIDI range by a number of semitones in each direction.\n * Clamps to valid piano range (21-108).\n *\n * @example\n * expandMidiRange({ minMidi: 48, maxMidi: 72 }, 12) // { minMidi: 36, maxMidi: 84 }\n */\nexport function expandMidiRange(range: MidiRange, semitones: number): MidiRange {\n  return {\n    minMidi: Math.max(21, range.minMidi - semitones),\n    maxMidi: Math.min(108, range.maxMidi + semitones),\n  };\n}\n\n/**\n * Shift a MIDI range up or down by a number of semitones.\n * Clamps to valid piano range (21-108).\n *\n * @example\n * shiftMidiRange({ minMidi: 48, maxMidi: 72 }, 12)  // { minMidi: 60, maxMidi: 84 }\n * shiftMidiRange({ minMidi: 48, maxMidi: 72 }, -12) // { minMidi: 36, maxMidi: 60 }\n */\nexport function shiftMidiRange(range: MidiRange, semitones: number): MidiRange {\n  const newMin = range.minMidi + semitones;\n  const newMax = range.maxMidi + semitones;\n\n  // Clamp to valid range while maintaining the span\n  if (newMin < 21) {\n    const adjustment = 21 - newMin;\n    return { minMidi: 21, maxMidi: newMax + adjustment };\n  }\n  if (newMax > 108) {\n    const adjustment = newMax - 108;\n    return { minMidi: newMin - adjustment, maxMidi: 108 };\n  }\n\n  return { minMidi: newMin, maxMidi: newMax };\n}\n\n/**\n * Get the number of semitones (pitches) in a MIDI range.\n *\n * @example\n * getMidiRangeSpan({ minMidi: 48, maxMidi: 72 }) // 25 (includes both endpoints)\n */\nexport function getMidiRangeSpan(range: MidiRange): number {\n  return range.maxMidi - range.minMidi + 1;\n}\n\n/**\n * Check if a MIDI note is within a range.\n *\n * @example\n * isMidiInRange(60, { minMidi: 48, maxMidi: 72 }) // true\n * isMidiInRange(36, { minMidi: 48, maxMidi: 72 }) // false\n */\nexport function isMidiInRange(midi: number, range: MidiRange): boolean {\n  return midi >= range.minMidi && midi <= range.maxMidi;\n}\n\n/**\n * Clamp a MIDI note to be within a range.\n *\n * @example\n * clampMidiToRange(36, { minMidi: 48, maxMidi: 72 }) // 48\n * clampMidiToRange(60, { minMidi: 48, maxMidi: 72 }) // 60\n * clampMidiToRange(84, { minMidi: 48, maxMidi: 72 }) // 72\n */\nexport function clampMidiToRange(midi: number, range: MidiRange): number {\n  return Math.max(range.minMidi, Math.min(range.maxMidi, midi));\n}\n\n// ============================================================================\n// Preset Pitch Ranges\n// ============================================================================\n\n/**\n * Common pitch ranges for different voice types and instruments.\n * Each range includes MIDI numbers and Tone.js note names.\n */\nexport const PITCH_RANGES = {\n  /** Full 88-key piano range */\n  PIANO: { minMidi: 21, maxMidi: 108, lowNote: 'A0', highNote: 'C8' },\n  /** Typical soprano voice range */\n  SOPRANO: { minMidi: 60, maxMidi: 84, lowNote: 'C4', highNote: 'C6' },\n  /** Typical alto voice range */\n  ALTO: { minMidi: 53, maxMidi: 77, lowNote: 'F3', highNote: 'F5' },\n  /** Typical tenor voice range */\n  TENOR: { minMidi: 48, maxMidi: 72, lowNote: 'C3', highNote: 'C5' },\n  /** Typical bass voice range */\n  BASS: { minMidi: 40, maxMidi: 64, lowNote: 'E2', highNote: 'E4' },\n  /** General singing range (covers most voices) */\n  SINGING: { minMidi: 48, maxMidi: 84, lowNote: 'C3', highNote: 'C6' },\n  /** Comfortable speaking range */\n  SPEAKING: { minMidi: 55, maxMidi: 70, lowNote: 'G3', highNote: 'Bb4' },\n  /** Extended vocal range (trained singers) */\n  EXTENDED_VOCAL: { minMidi: 36, maxMidi: 96, lowNote: 'C2', highNote: 'C7' },\n} as const;\n\n/** Type for preset range keys */\nexport type PitchRangePreset = keyof typeof PITCH_RANGES;\n\n/**\n * Get a MidiRange from a preset name.\n *\n * @example\n * getMidiRangeFromPreset('TENOR') // { minMidi: 48, maxMidi: 72 }\n */\nexport function getMidiRangeFromPreset(preset: PitchRangePreset): MidiRange {\n  const range = PITCH_RANGES[preset];\n  return { minMidi: range.minMidi, maxMidi: range.maxMidi };\n}\n","/**\n * Pitch Trail Color Utilities\n *\n * Color interpolation system for real-time pitch visualization.\n * Extracted from amateur-singing-trainer for use across apps.\n *\n * Features:\n * - 12-color palette mapped to pitch classes (C through B)\n * - Continuous color interpolation based on fractional MIDI values\n * - Tonic-aware coloring (colors rotate based on selected key)\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type RGB = [number, number, number];\n\nexport interface PitchTrailColorConfig {\n  /** Current tonic pitch class (0-11, where C=0) */\n  tonicPitchClass: number;\n}\n\n// ============================================================================\n// Color Palette\n// ============================================================================\n\n/**\n * 12-color palette for pitch classes.\n * Maps to C, C#/Db, D, D#/Eb, E, F, F#/Gb, G, G#/Ab, A, A#/Bb, B\n *\n * These colors are designed to:\n * - Be visually distinct from each other\n * - Create smooth gradients when interpolated\n * - Work well on both light and dark backgrounds\n */\nexport const PITCH_CLASS_COLORS: readonly string[] = [\n  '#ef8aab', // C  - Pink\n  '#f48e7d', // C# - Coral\n  '#e89955', // D  - Orange\n  '#cdaa42', // D# - Gold\n  '#a4ba57', // E  - Lime\n  '#6ec482', // F  - Green\n  '#2dc8b1', // F# - Teal\n  '#16c3da', // G  - Cyan\n  '#58b8f6', // G# - Sky Blue\n  '#8fa9ff', // A  - Blue\n  '#ba9bf2', // A# - Purple\n  '#db8fd4', // B  - Magenta\n] as const;\n\nconst FALLBACK_COLOR = PITCH_CLASS_COLORS[0] ?? '#000000';\n\n// ============================================================================\n// Color Conversion Utilities\n// ============================================================================\n\n/**\n * Convert hex color string to RGB array.\n */\nexport function hexToRgb(hex: string): RGB {\n  const bigint = parseInt(hex.slice(1), 16);\n  return [(bigint >> 16) & 255, (bigint >> 8) & 255, bigint & 255];\n}\n\n/**\n * Convert RGB array to hex color string.\n */\nexport function rgbToHex(rgb: RGB): string {\n  return (\n    '#' +\n    rgb\n      .map((v) => {\n        const clamped = Math.max(0, Math.min(255, Math.round(v)));\n        return clamped.toString(16).padStart(2, '0');\n      })\n      .join('')\n  );\n}\n\n/**\n * Interpolate between two RGB colors.\n *\n * @param c1 - Start color\n * @param c2 - End color\n * @param factor - Interpolation factor (0 = c1, 1 = c2)\n */\nexport function interpolateRgb(c1: RGB, c2: RGB, factor: number): RGB {\n  const clampedFactor = Math.max(0, Math.min(1, factor));\n  return c1.map((v, i) => {\n    const c2Value = c2[i] ?? v;\n    return Math.round(v + clampedFactor * (c2Value - v));\n  }) as RGB;\n}\n\n// ============================================================================\n// Pitch Color Functions\n// ============================================================================\n\n/**\n * Get the base color for a pitch class (0-11).\n *\n * @param pitchClass - Pitch class (0-11, where C=0)\n * @param tonicPitchClass - Optional tonic for relative coloring (default: 0 = C)\n * @returns Hex color string\n */\nexport function getPitchClassColor(pitchClass: number, tonicPitchClass = 0): string {\n  const relativePitchClass = ((pitchClass - tonicPitchClass) % 12 + 12) % 12;\n  return PITCH_CLASS_COLORS[relativePitchClass] ?? FALLBACK_COLOR;\n}\n\n/**\n * Get an interpolated color for a continuous MIDI value.\n * This provides smooth color transitions between semitones.\n *\n * @param midiValue - MIDI note number (can be fractional for microtonal accuracy)\n * @param tonicPitchClass - Optional tonic for relative coloring (default: 0 = C)\n * @returns RGB color array\n */\nexport function getInterpolatedPitchColor(midiValue: number, tonicPitchClass = 0): RGB {\n  const midiFloor = Math.floor(midiValue);\n  const fraction = midiValue - midiFloor;\n\n  // Calculate relative pitch classes (adjusted for tonic)\n  const pitchClass = ((midiFloor % 12) - tonicPitchClass + 12) % 12;\n  const nextPitchClass = (pitchClass + 1) % 12;\n\n  // Get colors for current and next semitone\n  const baseColor = hexToRgb(PITCH_CLASS_COLORS[pitchClass] ?? FALLBACK_COLOR);\n  const nextColor = hexToRgb(PITCH_CLASS_COLORS[nextPitchClass] ?? FALLBACK_COLOR);\n\n  // Interpolate based on the fractional part\n  return interpolateRgb(baseColor, nextColor, fraction);\n}\n\n/**\n * Get an interpolated color as a hex string.\n *\n * @param midiValue - MIDI note number (can be fractional)\n * @param tonicPitchClass - Optional tonic for relative coloring (default: 0 = C)\n * @returns Hex color string\n */\nexport function getInterpolatedPitchColorHex(midiValue: number, tonicPitchClass = 0): string {\n  return rgbToHex(getInterpolatedPitchColor(midiValue, tonicPitchClass));\n}\n\n/**\n * Get an RGBA color string for a pitch with opacity based on clarity.\n *\n * @param midiValue - MIDI note number (can be fractional)\n * @param clarity - Detection confidence (0-1)\n * @param tonicPitchClass - Optional tonic for relative coloring (default: 0 = C)\n * @param maxOpacity - Maximum opacity (default: 0.9)\n * @returns RGBA color string\n */\nexport function getPitchColorWithClarity(\n  midiValue: number,\n  clarity: number,\n  tonicPitchClass = 0,\n  maxOpacity = 0.9\n): string {\n  const rgb = getInterpolatedPitchColor(midiValue, tonicPitchClass);\n  const opacity = Math.min(clarity * maxOpacity, 1);\n  return `rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, ${opacity})`;\n}\n\n// ============================================================================\n// Tonic Utilities\n// ============================================================================\n\n/**\n * Map of note names to pitch classes.\n */\nexport const NOTE_TO_PITCH_CLASS: Record<string, number> = {\n  C: 0,\n  'C#': 1,\n  Db: 1,\n  D: 2,\n  'D#': 3,\n  Eb: 3,\n  E: 4,\n  F: 5,\n  'F#': 6,\n  Gb: 6,\n  G: 7,\n  'G#': 8,\n  Ab: 8,\n  A: 9,\n  'A#': 10,\n  Bb: 10,\n  B: 11,\n};\n\n/**\n * Get pitch class from a note name string.\n *\n * @param noteName - Note name (e.g., \"C\", \"F#\", \"Bb\")\n * @returns Pitch class (0-11), or 0 if not recognized\n */\nexport function getTonicPitchClass(noteName: string): number {\n  // Remove octave number if present\n  const cleanName = noteName.replace(/\\d+$/, '');\n  return NOTE_TO_PITCH_CLASS[cleanName] ?? 0;\n}\n","/**\n * Notes Renderer\n *\n * Pure rendering functions for note shapes on the pitch grid.\n * All dependencies are passed explicitly as parameters.\n */\n\nimport type { PlacedNote, TonicSign, DegreeDisplayMode, LongNoteStyle, AccidentalMode } from '@mlt/types';\nimport type { CoordinateUtils, PitchHistoryPoint, TargetNote, PitchTrailConfig } from '../types.js';\nimport { getInterpolatedPitchColor, type RGB, type PitchRowData } from '@mlt/pitch-data';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst OVAL_NOTE_FONT_RATIO = 0.7;\nconst FILLED_NOTE_FONT_RATIO = 0.9;\nconst MIN_FONT_SIZE = 4;\nconst MIN_STROKE_WIDTH_THICK = 1;\nconst STROKE_WIDTH_RATIO = 0.15;\nconst TAIL_LINE_WIDTH_RATIO = 0.2;\nconst MIN_TAIL_LINE_WIDTH = 1;\nconst SHADOW_BLUR_RADIUS = 1.5;\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface NoteRenderConfig {\n  cellWidth: number;\n  cellHeight: number;\n  columnWidths: number[];\n  degreeDisplayMode: DegreeDisplayMode;\n  accidentalMode: AccidentalMode;\n  longNoteStyle: LongNoteStyle;\n  colorMode: 'color' | 'bw';\n}\n\nexport interface NoteRenderContext {\n  config: NoteRenderConfig;\n  coords: CoordinateUtils;\n  allNotes: PlacedNote[];\n  /** Optional: Function to get scale degree label for a note */\n  getScaleDegreeLabel?: (note: PlacedNote) => { label: string | null; isAccidental: boolean };\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nfunction hasRenderableDimensions(width: number, height: number): boolean {\n  return Number.isFinite(width) && width > 0 && Number.isFinite(height) && height > 0;\n}\n\n/**\n * Determines if a note has a visible tail (duration extends beyond base shape).\n */\nfunction hasVisibleTail(note: PlacedNote): boolean {\n  if (!note || typeof note.startColumnIndex !== 'number' || typeof note.endColumnIndex !== 'number') {\n    return false;\n  }\n  const baselineEnd = note.shape === 'circle'\n    ? note.startColumnIndex + 1\n    : note.startColumnIndex;\n  return note.endColumnIndex > baselineEnd;\n}\n\n/**\n * Get timestamp from UUID for sorting notes at same position.\n */\nfunction getUuidTimestamp(value?: string): number {\n  const timestampSegment = value?.split('-')[1];\n  return Number.parseInt(timestampSegment ?? '0', 10);\n}\n\n/**\n * Calculate horizontal offset for stacked notes at same position.\n */\nfunction calculateColorOffset(\n  note: PlacedNote,\n  allNotes: PlacedNote[],\n  cellWidth: number\n): number {\n  const offsetAmount = cellWidth * 0.25;\n  const noteUuid = note.uuid;\n\n  if (!noteUuid) return 0;\n\n  const notesAtSamePosition = allNotes.filter(otherNote =>\n    !otherNote.isDrum &&\n    otherNote.row === note.row &&\n    otherNote.startColumnIndex === note.startColumnIndex &&\n    otherNote.uuid &&\n    otherNote.uuid !== noteUuid\n  );\n\n  if (notesAtSamePosition.length === 0) return 0;\n\n  const allNotesAtPosition = [note, ...notesAtSamePosition];\n  allNotesAtPosition.sort((a, b) => getUuidTimestamp(a.uuid) - getUuidTimestamp(b.uuid));\n\n  const currentNoteIndex = allNotesAtPosition.findIndex(n => n.uuid === noteUuid);\n  return currentNoteIndex * offsetAmount;\n}\n\n/**\n * Calculate Y offset for stacked note tails.\n */\nfunction calculateTailYOffset(\n  note: PlacedNote,\n  allNotes: PlacedNote[],\n  cellHeight: number\n): number {\n  const tailOffsetAmount = (cellHeight / 2) * 0.12;\n  const noteUuid = note.uuid;\n\n  if (!noteUuid) return 0;\n\n  const notesWithTailsAtSamePosition = allNotes.filter(otherNote =>\n    !otherNote.isDrum &&\n    otherNote.row === note.row &&\n    otherNote.startColumnIndex === note.startColumnIndex &&\n    otherNote.uuid &&\n    otherNote.uuid !== noteUuid &&\n    hasVisibleTail(otherNote)\n  );\n\n  if (notesWithTailsAtSamePosition.length === 0) return 0;\n\n  const allNotesWithTailsAtPosition = [note, ...notesWithTailsAtSamePosition];\n  allNotesWithTailsAtPosition.sort((a, b) => getUuidTimestamp(a.uuid) - getUuidTimestamp(b.uuid));\n\n  const currentNoteIndex = allNotesWithTailsAtPosition.findIndex(n => n.uuid === noteUuid);\n  return currentNoteIndex * tailOffsetAmount;\n}\n\n// ============================================================================\n// Scale Degree Text\n// ============================================================================\n\ninterface DegreeFontResult {\n  multiplier: number;\n  category: 'natural' | 'single-accidental' | 'both-accidentals';\n}\n\nfunction getDegreeFontMultiplier(label: string | null): DegreeFontResult {\n  if (!label) return { multiplier: 1.0, category: 'natural' };\n\n  const hasFlat = label.includes('\\u266D');\n  const hasSharp = label.includes('\\u266F');\n  const hasBothAccidentals = label.includes('/');\n\n  if (!hasFlat && !hasSharp) {\n    return { multiplier: 1.0, category: 'natural' };\n  }\n  if (hasBothAccidentals) {\n    return { multiplier: 0.75, category: 'both-accidentals' };\n  }\n  return { multiplier: 0.88, category: 'single-accidental' };\n}\n\nfunction drawScaleDegreeText(\n  ctx: CanvasRenderingContext2D,\n  noteLabel: string,\n  shape: 'oval' | 'circle',\n  centerX: number,\n  centerY: number,\n  noteWidth: number\n): void {\n  const { multiplier: contentMultiplier, category } = getDegreeFontMultiplier(noteLabel);\n  let baseFontSize: number;\n\n  if (shape === 'circle') {\n    const circleBaseSize = noteWidth * 2 * FILLED_NOTE_FONT_RATIO;\n    switch (category) {\n      case 'natural':\n        baseFontSize = circleBaseSize;\n        break;\n      case 'single-accidental':\n        baseFontSize = circleBaseSize * 0.8;\n        break;\n      case 'both-accidentals':\n        baseFontSize = circleBaseSize * 0.4;\n        break;\n      default:\n        baseFontSize = circleBaseSize * contentMultiplier;\n    }\n  } else {\n    const ovalBaseSize = noteWidth * 2 * OVAL_NOTE_FONT_RATIO;\n    switch (category) {\n      case 'natural':\n        baseFontSize = ovalBaseSize * 1.5;\n        break;\n      case 'single-accidental':\n        baseFontSize = ovalBaseSize * 1.2;\n        break;\n      case 'both-accidentals':\n        baseFontSize = ovalBaseSize;\n        break;\n      default:\n        baseFontSize = ovalBaseSize * contentMultiplier;\n    }\n  }\n\n  if (baseFontSize < MIN_FONT_SIZE) return;\n\n  ctx.fillStyle = '#212529';\n  ctx.font = `bold ${baseFontSize}px 'Atkinson Hyperlegible', sans-serif`;\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n\n  if (shape === 'oval' && category === 'both-accidentals' && noteLabel.includes('/')) {\n    const parts = noteLabel.split('/');\n    const lineHeight = baseFontSize * 1.1;\n    const totalHeight = lineHeight * (parts.length - 1);\n    const startY = centerY - (totalHeight / 2);\n\n    parts.forEach((part, index) => {\n      const y = startY + (index * lineHeight);\n      const opticalOffset = baseFontSize * 0.08;\n      ctx.fillText(part.trim(), centerX, y + opticalOffset);\n    });\n  } else {\n    const opticalOffset = baseFontSize * 0.08;\n    ctx.fillText(noteLabel, centerX, centerY + opticalOffset);\n  }\n}\n\n// ============================================================================\n// Stadium Shape (for long notes - style 2)\n// ============================================================================\n\nfunction drawStadiumShape(\n  ctx: CanvasRenderingContext2D,\n  note: PlacedNote,\n  leftCenterX: number,\n  rightCenterX: number,\n  centerY: number,\n  ry: number,\n  strokeWidth: number\n): void {\n  ctx.save();\n  ctx.beginPath();\n  ctx.arc(leftCenterX, centerY, ry, Math.PI / 2, -Math.PI / 2, false);\n  ctx.lineTo(rightCenterX, centerY - ry);\n  ctx.arc(rightCenterX, centerY, ry, -Math.PI / 2, Math.PI / 2, false);\n  ctx.lineTo(leftCenterX, centerY + ry);\n  ctx.closePath();\n\n  ctx.strokeStyle = note.color;\n  ctx.lineWidth = strokeWidth;\n  ctx.shadowColor = note.color;\n  ctx.shadowBlur = SHADOW_BLUR_RADIUS;\n  ctx.stroke();\n  ctx.shadowBlur = 0;\n  ctx.shadowColor = 'transparent';\n  ctx.restore();\n}\n\n// ============================================================================\n// Main Rendering Functions\n// ============================================================================\n\n/**\n * Draw a single-column oval note.\n */\nexport function drawSingleColumnOvalNote(\n  ctx: CanvasRenderingContext2D,\n  context: NoteRenderContext,\n  note: PlacedNote,\n  rowIndex: number\n): void {\n  const { config, coords, allNotes, getScaleDegreeLabel } = context;\n  const { cellWidth, cellHeight, columnWidths, degreeDisplayMode } = config;\n\n  const y = coords.getRowY(rowIndex);\n  const x = coords.getColumnX(note.startColumnIndex);\n\n  // Calculate cell width for this column\n  const widthMultiplier = columnWidths[note.startColumnIndex] ?? 1;\n  const currentCellWidth = widthMultiplier * cellWidth;\n\n  if (!hasRenderableDimensions(currentCellWidth, cellHeight)) return;\n\n  const xOffset = calculateColorOffset(note, allNotes, cellWidth);\n  const dynamicStrokeWidth = Math.max(0.5, currentCellWidth * 0.15);\n  const cx = x + currentCellWidth / 2 + xOffset;\n  const rx = (currentCellWidth / 2) - (dynamicStrokeWidth / 2);\n  const ry = (cellHeight / 2) - (dynamicStrokeWidth / 2);\n\n  if (!hasRenderableDimensions(rx, ry)) return;\n\n  ctx.save();\n  ctx.beginPath();\n  ctx.ellipse(cx, y, rx, ry, 0, 0, 2 * Math.PI);\n  ctx.strokeStyle = note.color;\n  ctx.lineWidth = dynamicStrokeWidth;\n  ctx.shadowColor = note.color;\n  ctx.shadowBlur = SHADOW_BLUR_RADIUS;\n  ctx.stroke();\n  ctx.shadowBlur = 0;\n  ctx.shadowColor = 'transparent';\n  ctx.restore();\n\n  // Draw scale degree text\n  if (degreeDisplayMode !== 'off' && getScaleDegreeLabel) {\n    const { label } = getScaleDegreeLabel(note);\n    if (label) {\n      drawScaleDegreeText(ctx, label, 'oval', cx, y, rx);\n    }\n  }\n}\n\n/**\n * Draw a two-column (circle) note, optionally with a tail or stadium shape.\n */\nexport function drawTwoColumnOvalNote(\n  ctx: CanvasRenderingContext2D,\n  context: NoteRenderContext,\n  note: PlacedNote,\n  rowIndex: number\n): void {\n  const { config, coords, allNotes, getScaleDegreeLabel } = context;\n  const { cellWidth, cellHeight, degreeDisplayMode, longNoteStyle } = config;\n\n  const y = coords.getRowY(rowIndex);\n  const xStart = coords.getColumnX(note.startColumnIndex);\n  const xNext = coords.getColumnX(note.startColumnIndex + 1);\n  const actualCellWidth = xNext - xStart;\n\n  if (!hasRenderableDimensions(actualCellWidth, cellHeight)) return;\n\n  const xOffset = calculateColorOffset(note, allNotes, cellWidth);\n  const centerX = xStart + actualCellWidth + xOffset;\n  const dynamicStrokeWidth = Math.max(MIN_STROKE_WIDTH_THICK, actualCellWidth * STROKE_WIDTH_RATIO);\n  const ry = (cellHeight / 2) - (dynamicStrokeWidth / 2);\n\n  const hasTail = hasVisibleTail(note);\n\n  // Style 2: Stadium shape\n  if (hasTail && longNoteStyle === 'style2') {\n    const leftCenterX = centerX;\n    const rightCenterX = coords.getColumnX(note.endColumnIndex);\n\n    if (hasRenderableDimensions(rightCenterX - leftCenterX, ry)) {\n      drawStadiumShape(ctx, note, leftCenterX, rightCenterX, y, ry, dynamicStrokeWidth);\n\n      // Draw scale degree in center of stadium\n      if (degreeDisplayMode !== 'off' && getScaleDegreeLabel) {\n        const { label } = getScaleDegreeLabel(note);\n        if (label) {\n          const stadiumCenterX = (leftCenterX + rightCenterX) / 2;\n          drawScaleDegreeText(ctx, label, 'circle', stadiumCenterX, y, ry);\n        }\n      }\n    }\n    return;\n  }\n\n  // Style 1: Tail line + circle\n  if (hasTail) {\n    const originalEndX = coords.getColumnX(note.endColumnIndex + 1);\n    const tailYOffset = calculateTailYOffset(note, allNotes, cellHeight);\n    const tailY = y + tailYOffset;\n\n    ctx.beginPath();\n    ctx.moveTo(centerX, tailY);\n    ctx.lineTo(originalEndX, tailY);\n    ctx.strokeStyle = note.color;\n    ctx.lineWidth = Math.max(MIN_TAIL_LINE_WIDTH, actualCellWidth * TAIL_LINE_WIDTH_RATIO);\n    ctx.stroke();\n  }\n\n  const rx = actualCellWidth - (dynamicStrokeWidth / 2);\n  if (!hasRenderableDimensions(rx, ry)) return;\n\n  ctx.save();\n  ctx.beginPath();\n  ctx.ellipse(centerX, y, rx, ry, 0, 0, 2 * Math.PI);\n  ctx.strokeStyle = note.color;\n  ctx.lineWidth = dynamicStrokeWidth;\n  ctx.shadowColor = note.color;\n  ctx.shadowBlur = SHADOW_BLUR_RADIUS;\n  ctx.stroke();\n  ctx.shadowBlur = 0;\n  ctx.shadowColor = 'transparent';\n  ctx.restore();\n\n  if (degreeDisplayMode !== 'off' && getScaleDegreeLabel) {\n    const { label } = getScaleDegreeLabel(note);\n    if (label) {\n      drawScaleDegreeText(ctx, label, 'circle', centerX, y, rx);\n    }\n  }\n}\n\n/**\n * Draw a tonic sign (Roman numeral circle).\n */\nexport function drawTonicShape(\n  ctx: CanvasRenderingContext2D,\n  context: NoteRenderContext,\n  tonicSign: TonicSign\n): void {\n  const { config, coords } = context;\n  const { cellWidth, cellHeight } = config;\n\n  const y = coords.getRowY(tonicSign.globalRow ?? tonicSign.row);\n  const x = coords.getColumnX(tonicSign.columnIndex);\n  const xNext = coords.getColumnX(tonicSign.columnIndex + 1);\n  const actualCellWidth = xNext - x;\n\n  const width = actualCellWidth * 2;\n  const centerX = x + width / 2;\n  const radius = (Math.min(width, cellHeight) / 2) * 0.9;\n\n  if (radius < 2) return;\n\n  ctx.beginPath();\n  ctx.arc(centerX, y, radius, 0, 2 * Math.PI);\n  ctx.strokeStyle = '#212529';\n  ctx.lineWidth = Math.max(0.5, actualCellWidth * 0.05);\n  ctx.stroke();\n\n  if (tonicSign.tonicNumber == null) return;\n\n  const numberText = tonicSign.tonicNumber.toString();\n  const fontSize = radius * 1.5;\n  if (fontSize < 6) return;\n\n  ctx.fillStyle = '#212529';\n  ctx.font = `bold ${fontSize}px 'Atkinson Hyperlegible', sans-serif`;\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText(numberText, centerX, y);\n}\n\n// ============================================================================\n// Singing Mode: User Pitch Rendering\n// ============================================================================\n\nexport interface UserPitchRenderConfig {\n  cellHeight: number;\n  viewportWidth: number;\n  nowLineX?: number;\n  pixelsPerSecond: number;\n  timeWindowMs: number;\n  colorMode: 'color' | 'bw';\n  /** Pitch trail visual configuration */\n  trailConfig?: PitchTrailConfig;\n}\n\n// ============================================================================\n// Pitch Trail Default Configuration\n// ============================================================================\n\nconst DEFAULT_TRAIL_CONFIG: Required<PitchTrailConfig> = {\n  timeWindowMs: 4000,\n  pixelsPerSecond: 200,\n  circleRadius: 9.5,\n  proximityThreshold: 35,\n  maxConnections: 3,\n  connectorLineWidth: 2.5,\n  connectorColor: 'rgba(0,0,0,0.4)',\n  useTonicRelativeColors: true,\n  tonicPitchClass: 0,\n  clarityThreshold: 0.5,\n  maxOpacity: 0.9,\n};\n\n/**\n * Merge user trail config with defaults.\n */\nfunction getTrailConfig(config?: PitchTrailConfig): Required<PitchTrailConfig> {\n  return { ...DEFAULT_TRAIL_CONFIG, ...config };\n}\n\n// PitchHistoryPoint is imported from types.js\n\n/**\n * Draw the user's current pitch indicator at the \"now line\" (highway mode).\n * Uses interpolated pitch-class colors for visual consistency with the trail.\n */\nexport function drawUserPitchIndicator(\n  ctx: CanvasRenderingContext2D,\n  coords: CoordinateUtils,\n  midi: number,\n  clarity: number,\n  nowLineX: number,\n  config: UserPitchRenderConfig,\n  fullRowData: PitchRowData[]\n): void {\n  const trail = getTrailConfig(config.trailConfig);\n  if (clarity < trail.clarityThreshold || midi <= 0) return;\n\n  const { cellHeight, colorMode } = config;\n\n  // Use continuous Y positioning for sub-semitone accuracy\n  const y = getMidiY(coords, midi, cellHeight, fullRowData);\n  const radius = (cellHeight / 2) * 0.8;\n\n  // Get interpolated color based on fractional MIDI value\n  const color: RGB =\n    colorMode === 'bw'\n      ? [128, 128, 128]\n      : getInterpolatedPitchColor(midi, trail.tonicPitchClass);\n\n  ctx.save();\n\n  // Draw glow\n  ctx.beginPath();\n  ctx.arc(nowLineX, y, radius + 4, 0, 2 * Math.PI);\n  ctx.fillStyle = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${clarity * 0.3})`;\n  ctx.fill();\n\n  // Draw solid indicator\n  ctx.beginPath();\n  ctx.arc(nowLineX, y, radius, 0, 2 * Math.PI);\n  ctx.fillStyle = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${clarity})`;\n  ctx.fill();\n\n  ctx.restore();\n}\n\n/**\n * Internal type for computed trail points.\n */\ninterface TrailPoint {\n  x: number;\n  y: number;\n  clarity: number;\n  color: RGB;\n}\n\n/**\n * Compute the Y position for a MIDI value using continuous positioning.\n * This allows for sub-semitone accuracy in the visualization.\n */\nfunction getMidiY(\n  coords: CoordinateUtils,\n  midi: number,\n  cellHeight: number,\n  fullRowData: PitchRowData[]\n): number {\n  if (fullRowData.length === 0 || !fullRowData[0]) return 0;\n\n  const midiFloor = Math.floor(midi);\n  const fraction = midi - midiFloor;\n\n  // Use actual MIDI range from fullRowData\n  const firstRow = fullRowData[0];\n  const maxMidi = firstRow.midi ?? 108; // Highest pitch in range (default to C8)\n  const rowIndex = maxMidi - midiFloor;\n\n  // Handle out-of-range MIDI values\n  if (rowIndex < 0 || rowIndex >= fullRowData.length) {\n    return rowIndex < 0 ? 0 : coords.getRowY(fullRowData.length - 1);\n  }\n\n  const baseY = coords.getRowY(rowIndex);\n\n  // Offset by the fraction (negative because higher MIDI = lower row index = higher on screen)\n  // Each semitone step moves by half a cell (row spacing)\n  const rowStep = cellHeight / 2;\n  return baseY - fraction * rowStep;\n}\n\n/**\n * Draw the user's pitch history as a trace (stationary/singing mode).\n *\n * Enhanced version with:\n * - Interpolated pitch-class colors\n * - Proximity-based connector lines\n * - Clarity-based opacity\n * - Configurable visual parameters\n */\nexport function drawUserPitchTrace(\n  ctx: CanvasRenderingContext2D,\n  coords: CoordinateUtils,\n  history: PitchHistoryPoint[],\n  currentTime: number,\n  config: UserPitchRenderConfig,\n  fullRowData: PitchRowData[]\n): void {\n  const { viewportWidth, cellHeight, colorMode } = config;\n  const trail = getTrailConfig(config.trailConfig);\n\n  // Use trail config values, with fallbacks to top-level config\n  const timeWindowMs = trail.timeWindowMs;\n  const pixelsPerSecond = trail.pixelsPerSecond;\n\n  // Use nowLineX as origin if provided (highway mode), otherwise use right edge (stationary mode)\n  const trailOriginX = config.nowLineX ?? viewportWidth;\n\n  // Filter to visible time window and transform to screen coordinates\n  const notePoints: TrailPoint[] = history\n    .filter(p => p.midi > 0 && p.clarity >= trail.clarityThreshold)\n    .map(point => {\n      const age = currentTime - point.time;\n      // Skip points outside time window\n      if (age >= timeWindowMs || age < 0) return null;\n\n      // Trail extends leftward from origin point (nowLineX for highway, right edge for stationary)\n      const x = trailOriginX - (age / 1000) * pixelsPerSecond;\n\n      // Use continuous Y positioning for sub-semitone accuracy\n      const y = getMidiY(coords, point.midi, cellHeight, fullRowData);\n\n      // Get interpolated color based on fractional MIDI value\n      const color: RGB =\n        colorMode === 'bw'\n          ? [128, 128, 128]\n          : getInterpolatedPitchColor(point.midi, trail.tonicPitchClass);\n\n      return {\n        x,\n        y,\n        clarity: point.clarity,\n        color,\n      };\n    })\n    .filter((p): p is TrailPoint => p !== null && p.x >= 0);\n\n  if (notePoints.length === 0) return;\n\n  ctx.save();\n\n  // Phase 1: Draw connector lines between proximate points\n  ctx.strokeStyle = trail.connectorColor;\n  ctx.lineWidth = trail.connectorLineWidth;\n  ctx.beginPath();\n\n  for (let i = 0; i < notePoints.length; i++) {\n    let connections = 0;\n    for (let j = i + 1; j < notePoints.length && connections < trail.maxConnections; j++) {\n      const dx = notePoints[i].x - notePoints[j].x;\n      const dy = notePoints[i].y - notePoints[j].y;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n\n      if (dist <= trail.proximityThreshold) {\n        ctx.moveTo(notePoints[i].x, notePoints[i].y);\n        ctx.lineTo(notePoints[j].x, notePoints[j].y);\n        connections++;\n      }\n    }\n  }\n  ctx.stroke();\n\n  // Phase 2: Draw colored circles at each point\n  for (const pt of notePoints) {\n    const opacity = Math.min(pt.clarity * trail.maxOpacity, 1);\n    ctx.fillStyle = `rgba(${pt.color[0]}, ${pt.color[1]}, ${pt.color[2]}, ${opacity})`;\n    ctx.beginPath();\n    ctx.arc(pt.x, pt.y, trail.circleRadius, 0, 2 * Math.PI);\n    ctx.fill();\n  }\n\n  ctx.restore();\n}\n\n// ============================================================================\n// Target Notes (for exercises)\n// ============================================================================\n\n// TargetNote is imported from types.js\n\n/**\n * Draw target notes on the highway (Guitar Hero style).\n */\nexport function drawTargetNotes(\n  ctx: CanvasRenderingContext2D,\n  coords: CoordinateUtils,\n  targetNotes: TargetNote[],\n  currentTimeMs: number,\n  config: UserPitchRenderConfig,\n  fullRowData?: PitchRowData[],\n  userMidi?: number | null,\n  userClarity?: number\n): void {\n  const { cellHeight, nowLineX = 100, pixelsPerSecond } = config;\n  const pitchToleranceSemitones = 0.5; // Half semitone tolerance for hit detection\n\n  for (const note of targetNotes) {\n    // Calculate X position based on time\n    const startX = (nowLineX ?? 100) + ((note.startTimeMs - currentTimeMs) / 1000) * pixelsPerSecond;\n    const endX = startX + (note.durationMs / 1000) * pixelsPerSecond;\n\n    // Skip if completely off-screen\n    if (endX < 0 || startX > config.viewportWidth) continue;\n\n    // Find row index from fullRowData if provided, otherwise use default calculation\n    let rowIndex: number;\n    if (fullRowData) {\n      rowIndex = fullRowData.findIndex(row => row.midi === note.midi);\n      if (rowIndex === -1) {\n        // Note MIDI is outside the current viewport range, skip it\n        continue;\n      }\n    } else {\n      // Fallback to default calculation (assumes fullRowData starts at C8)\n      rowIndex = Math.round(108 - note.midi);\n    }\n\n    const y = coords.getRowY(rowIndex);\n    const ry = (cellHeight / 2) - 2;\n    const color = note.color ?? '#4CAF50';\n\n    // Check if this note is currently being hit (at judgment line and pitch matches)\n    const isAtJudgmentLine = startX <= nowLineX && endX >= nowLineX;\n    const pitchMatches = userMidi !== null &&\n                         userMidi !== undefined &&\n                         (userClarity ?? 0) > 0.5 &&\n                         Math.abs(userMidi - note.midi) <= pitchToleranceSemitones;\n    const isBeingHit = isAtJudgmentLine && pitchMatches;\n\n    // Draw stadium shape\n    ctx.save();\n    ctx.beginPath();\n    ctx.arc(startX, y, ry, Math.PI / 2, -Math.PI / 2, false);\n    ctx.lineTo(endX, y - ry);\n    ctx.arc(endX, y, ry, -Math.PI / 2, Math.PI / 2, false);\n    ctx.lineTo(startX, y + ry);\n    ctx.closePath();\n\n    if (isBeingHit) {\n      // Enhanced glow effect when hitting the note\n      ctx.strokeStyle = '#FFD700'; // Gold color for hit\n      ctx.lineWidth = 5;\n      ctx.shadowColor = '#FFD700';\n      ctx.shadowBlur = 20;\n      ctx.stroke();\n\n      // Add inner fill for extra visibility\n      ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';\n      ctx.fill();\n\n      // Draw particle burst effect\n      drawHitParticles(ctx, nowLineX, y, ry);\n    } else {\n      ctx.strokeStyle = color;\n      ctx.lineWidth = 3;\n      ctx.shadowColor = color;\n      ctx.shadowBlur = 8;\n      ctx.stroke();\n    }\n\n    ctx.shadowBlur = 0;\n    ctx.restore();\n\n    // Draw label if provided (at left edge of note)\n    if (note.label) {\n      const labelX = startX + ry + 4; // Position inside the left cap\n      ctx.fillStyle = isBeingHit ? '#FFD700' : '#212529'; // Gold when hit\n      ctx.font = `bold ${Math.max(16, ry * 1.2)}px 'Atkinson Hyperlegible', sans-serif`;\n      ctx.textAlign = 'left';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(note.label, labelX, y);\n    }\n  }\n}\n\n/**\n * Draw particle burst effect for hit notes\n */\nfunction drawHitParticles(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number\n): void {\n  const particleCount = 8;\n  const particleSize = 3;\n  const burstRadius = radius * 1.5;\n\n  ctx.save();\n  ctx.fillStyle = '#FFD700';\n  ctx.shadowColor = '#FFD700';\n  ctx.shadowBlur = 6;\n\n  for (let i = 0; i < particleCount; i++) {\n    const angle = (i / particleCount) * Math.PI * 2;\n    const px = x + Math.cos(angle) * burstRadius;\n    const py = y + Math.sin(angle) * burstRadius;\n\n    ctx.beginPath();\n    ctx.arc(px, py, particleSize, 0, Math.PI * 2);\n    ctx.fill();\n  }\n\n  ctx.restore();\n}\n","/**\n * Legend Renderer\n *\n * Pure rendering functions for pitch grid legends (Y-axis labels).\n * All dependencies are passed explicitly as parameters - no store access.\n */\n\nimport type { PitchRowData, AccidentalMode } from '@mlt/types';\nimport type { CoordinateUtils } from '../types.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface LegendRenderConfig {\n  /** Full pitch data array */\n  fullRowData: PitchRowData[];\n  /** Cell width in pixels */\n  cellWidth: number;\n  /** Cell height in pixels */\n  cellHeight: number;\n  /** Width of each legend column (A and B) in pixels */\n  legendColumnWidth: number;\n  /** Color mode for rendering */\n  colorMode: 'color' | 'bw';\n  /** Whether to show frequency labels instead of pitch names */\n  showFrequencyLabels: boolean;\n  /** Whether to show octave numbers in labels */\n  showOctaveLabels: boolean;\n  /** Accidental display mode */\n  accidentalMode: AccidentalMode;\n  /** Set of pitch classes that should be focused (0-11), null = show all */\n  focusedPitchClasses: Set<number> | null;\n  /** Whether focus coloring is enabled */\n  focusColorsEnabled: boolean;\n  /** Optional highlight overlay for a specific pitch */\n  highlight?: {\n    pitchClass: number | null;\n    midi?: number | null;\n    opacity: number;\n    color?: string;\n  };\n}\n\nexport interface LegendRenderOptions {\n  /** Starting row index to render */\n  startRow: number;\n  /** Ending row index to render */\n  endRow: number;\n  /** Coordinate utilities */\n  coords: CoordinateUtils;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Strip octave suffix from a label.\n */\nfunction stripOctaveSuffix(label: string): string {\n  const withoutOctave = label.replace(/\\d+$/, '');\n  return withoutOctave.length > 0 ? withoutOctave : label;\n}\n\n/**\n * Snap a value to the nearest device pixel for crisp rendering.\n */\nfunction snapToDevicePixel(value: number, pixelRatio: number): number {\n  if (!Number.isFinite(pixelRatio) || pixelRatio <= 0) {\n    return value;\n  }\n  return Math.round(value * pixelRatio) / pixelRatio;\n}\n\n/**\n * Calculate font size based on cell dimensions and label length.\n */\nfunction getLegendFontSize(\n  cellWidth: number,\n  cellHeight: number,\n  labelLength: number,\n  pixelRatio: number\n): number {\n  const baseFontSize = Math.max(10, Math.min(cellWidth * 1.2, cellHeight * 1.2));\n  const sizeMultiplier = labelLength <= 3 ? 1 : 0.7;\n  const resolutionBoost = pixelRatio <= 1 ? 1.08 : 1;\n  return snapToDevicePixel(baseFontSize * sizeMultiplier * resolutionBoost, pixelRatio);\n}\n\n/**\n * Get the canvas pixel ratio for HiDPI displays.\n */\nfunction getCanvasPixelRatio(canvas: HTMLCanvasElement): number {\n  const ctx = canvas.getContext('2d');\n  if (!ctx) return 1;\n\n  // Check if canvas has been scaled for HiDPI\n  const transform = ctx.getTransform();\n  return transform.a || window.devicePixelRatio || 1;\n}\n\n/**\n * Get pitch class (0-11) from a pitch row.\n */\nfunction getPitchClassFromRow(row: PitchRowData): number {\n  // If midi is available, use it\n  if (typeof row.midi === 'number') {\n    return row.midi % 12;\n  }\n  // If pitchClass is available, use it\n  if (typeof row.pitchClass === 'number') {\n    return row.pitchClass;\n  }\n  // Fall back to parsing the pitch name\n  const noteMap: Record<string, number> = {\n    'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11\n  };\n  const baseNote = row.pitch.charAt(0).toUpperCase();\n  let pc = noteMap[baseNote] ?? 0;\n  if (row.pitch.includes('#') || row.pitch.includes('')) pc++;\n  if (row.pitch.includes('b') || row.pitch.includes('')) pc--;\n  return ((pc % 12) + 12) % 12;\n}\n\n/**\n * Determine if a row should be focused based on pitch class.\n */\nfunction isRowFocused(\n  row: PitchRowData,\n  focusedPitchClasses: Set<number> | null\n): boolean {\n  if (!focusedPitchClasses || focusedPitchClasses.size === 0) {\n    return true; // No focus filter = all rows focused\n  }\n  const pc = getPitchClassFromRow(row);\n  return focusedPitchClasses.has(pc);\n}\n\n/**\n * Process a label based on accidental mode and display settings.\n */\nfunction processLabel(\n  row: PitchRowData,\n  config: LegendRenderConfig\n): string | null {\n  const { showFrequencyLabels, showOctaveLabels, accidentalMode, focusColorsEnabled, focusedPitchClasses } = config;\n\n  const finalizeLabel = (value: string): string =>\n    showOctaveLabels ? value : stripOctaveSuffix(value);\n\n  // Hz mode\n  if (showFrequencyLabels) {\n    // When focus is active, hide non-focused rows\n    if (focusColorsEnabled && focusedPitchClasses && focusedPitchClasses.size > 0) {\n      if (!isRowFocused(row, focusedPitchClasses)) {\n        return null;\n      }\n    }\n    return String(Math.round(row.frequency));\n  }\n\n  // Use direct field access for pitch names\n  const { flatName, sharpName, isAccidental } = row;\n  const { sharp, flat } = accidentalMode;\n\n  // For natural notes, flatName === sharpName\n  if (!isAccidental) {\n    return finalizeLabel(flatName);\n  }\n\n  // Accidental handling\n  if (sharp && flat) {\n    return finalizeLabel(row.pitch); // Combined notation like 'Bb/A#7'\n  } else if (sharp && !flat) {\n    return finalizeLabel(sharpName);\n  } else if (flat && !sharp) {\n    return finalizeLabel(flatName);\n  } else {\n    // Both off - hide accidentals\n    return null;\n  }\n}\n\n// ============================================================================\n// Main Rendering Functions\n// ============================================================================\n\n/**\n * Draw a single legend (left or right) to its own canvas.\n */\nexport function drawLegend(\n  ctx: CanvasRenderingContext2D,\n  config: LegendRenderConfig,\n  options: LegendRenderOptions,\n  columnsOrder: readonly ('A' | 'B')[]\n): void {\n  const { fullRowData, cellWidth, cellHeight, legendColumnWidth, colorMode, focusColorsEnabled, focusedPitchClasses, accidentalMode } = config;\n  const { startRow, endRow, coords } = options;\n\n  const pixelRatio = getCanvasPixelRatio(ctx.canvas);\n  const snap = (value: number): number => snapToDevicePixel(value, pixelRatio);\n\n  // Each legend has two columns (A and B), split evenly\n  const colWidth = legendColumnWidth;\n\n  let cumulativeX = 0;\n\n  for (const colLabel of columnsOrder) {\n    for (let rowIndex = startRow; rowIndex <= endRow; rowIndex++) {\n      const row = fullRowData[rowIndex];\n      if (!row || row.isBoundary) continue;\n\n      // Only render rows that match this column\n      if (row.column !== colLabel) continue;\n\n      const y = coords.getRowY(rowIndex);\n      const isFocused = isRowFocused(row, focusedPitchClasses);\n\n      // Check if accidentals are hidden\n      const isAccidentalHidden = !accidentalMode.sharp && !accidentalMode.flat;\n      const shouldHideAccidental = row.isAccidental && isAccidentalHidden;\n\n      // Get the label to draw\n      const label = processLabel(row, config);\n      if (label === null) continue;\n\n      // Determine background color\n      let bgColor = colorMode === 'bw' ? '#ffffff' : (row.hex || '#ffffff');\n      if (focusColorsEnabled && !isFocused) {\n        bgColor = '#ffffff';\n      }\n\n      // Determine text alpha\n      let textAlpha = 'FF';\n      if (shouldHideAccidental) {\n        textAlpha = '00';\n      } else if (focusColorsEnabled && !isFocused) {\n        textAlpha = '55';\n      }\n\n      // Draw background\n      ctx.fillStyle = shouldHideAccidental ? 'rgba(255,255,255,0)' : bgColor;\n      ctx.fillRect(cumulativeX, y - cellHeight / 2, colWidth, cellHeight);\n\n      // Optional highlight overlay\n      const highlight = config.highlight;\n      if (highlight && highlight.opacity > 0.01) {\n        let shouldHighlight = false;\n        if (typeof highlight.midi === 'number') {\n          shouldHighlight = typeof row.midi === 'number' && row.midi === Math.round(highlight.midi);\n        } else if (typeof highlight.pitchClass === 'number') {\n          const rowPitchClass = getPitchClassFromRow(row);\n          shouldHighlight = rowPitchClass === highlight.pitchClass;\n        }\n\n        if (shouldHighlight) {\n          ctx.save();\n          ctx.globalAlpha = Math.min(Math.max(highlight.opacity, 0), 1);\n          ctx.fillStyle = highlight.color ?? '#ffff00';\n          ctx.fillRect(cumulativeX, y - cellHeight / 2, colWidth, cellHeight);\n          ctx.restore();\n        }\n      }\n\n      // Draw text\n      const fontSize = getLegendFontSize(cellWidth, cellHeight, label.length, pixelRatio);\n\n      ctx.font = `bold ${fontSize}px 'Atkinson Hyperlegible', sans-serif`;\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n\n      const textX = snap(cumulativeX + colWidth / 2);\n      const textY = snap(y);\n\n      // Text stroke (outline)\n      ctx.strokeStyle = `#212529${textAlpha}`;\n      ctx.lineWidth = Math.max(1.2, 2.5 / pixelRatio);\n      ctx.lineJoin = 'round';\n      ctx.strokeText(label, textX, textY);\n\n      // Text fill\n      ctx.fillStyle = `#ffffff${textAlpha}`;\n      ctx.fillText(label, textX, textY);\n    }\n\n    cumulativeX += colWidth;\n  }\n}\n\n/**\n * Draw both left and right legends to separate canvases.\n */\nexport function drawLegendsToSeparateCanvases(\n  leftCtx: CanvasRenderingContext2D | null,\n  rightCtx: CanvasRenderingContext2D | null,\n  config: LegendRenderConfig,\n  options: LegendRenderOptions\n): void {\n  // Left legend: B column first, then A (reading from right to left towards grid)\n  if (leftCtx) {\n    // Clear the canvas\n    leftCtx.clearRect(0, 0, leftCtx.canvas.width, leftCtx.canvas.height);\n    drawLegend(leftCtx, config, options, ['B', 'A'] as const);\n  }\n\n  // Right legend: A column first, then B (reading from left to right away from grid)\n  if (rightCtx) {\n    rightCtx.clearRect(0, 0, rightCtx.canvas.width, rightCtx.canvas.height);\n    drawLegend(rightCtx, config, options, ['A', 'B'] as const);\n  }\n}\n\n/**\n * Calculate which pitch classes should be focused based on placed tonic signs.\n * This is a helper that can be used by the app to build the focusedPitchClasses set.\n */\nexport function calculateFocusedPitchClasses(\n  tonicPitchClasses: number[],\n  scaleIntervals: number[] = [0, 2, 4, 5, 7, 9, 11] // Major scale by default\n): Set<number> {\n  const focused = new Set<number>();\n\n  for (const tonicPc of tonicPitchClasses) {\n    for (const interval of scaleIntervals) {\n      focused.add((tonicPc + interval) % 12);\n    }\n  }\n\n  return focused;\n}\n","/**\n * @mlt/pitch-viewport\n *\n * Shared viewport math utilities for pitch grids.\n * Pure functions only - no DOM dependencies.\n */\n\nimport type { PitchRowData } from '@mlt/types';\n\n// ============================================================================\n// Core Types\n// ============================================================================\n\nexport interface PitchRange {\n  topIndex: number;\n  bottomIndex: number;\n}\n\nexport type ZoomDirection = 'in' | 'out';\n\nexport interface ViewportMathOptions {\n  totalRanks: number;\n  minSpan?: number;\n  zoomStep?: number;\n}\n\nexport interface ZoomToFitOptions {\n  baseUnit: number;\n  paddingRows?: number;\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nexport const DEFAULT_MIN_VIEWPORT_ROWS = 9;\nexport const DEFAULT_ZOOM_STEP_ROWS = 2;\nexport const MAX_ADAPTIVE_ZOOM_STEP_ROWS = 5;\n\n// ============================================================================\n// Helpers\n// ============================================================================\n\nfunction clampInt(value: number, min: number, max: number): number {\n  if (!Number.isFinite(value)) {\n    return min;\n  }\n  return Math.max(min, Math.min(max, Math.round(value)));\n}\n\nfunction normalizeBaseUnit(baseUnit: number): number {\n  if (!Number.isFinite(baseUnit)) {\n    return 1;\n  }\n  return Math.max(1, baseUnit);\n}\n\n// ============================================================================\n// Range Math\n// ============================================================================\n\n/**\n * Returns a simple, ratio-based zoom step so wide ranges zoom faster and tight ranges zoom slower.\n */\nexport function getAdaptiveZoomStep(\n  span: number,\n  totalRanks: number,\n  { maxStep = MAX_ADAPTIVE_ZOOM_STEP_ROWS }: { maxStep?: number } = {}\n): number {\n  const normalizedTotal = Math.max(1, Math.round(totalRanks));\n  const normalizedSpan = Math.max(1, Math.round(span));\n  const ratio = normalizedSpan / normalizedTotal;\n\n  let step = 1;\n  if (ratio >= 0.85) {\n    step = 5;\n  } else if (ratio >= 0.65) {\n    step = 4;\n  } else if (ratio >= 0.45) {\n    step = 3;\n  } else if (ratio >= 0.25) {\n    step = 2;\n  } else {\n    step = 1;\n  }\n\n  const normalizedMax = Math.max(1, Math.round(maxStep));\n  return Math.max(1, Math.min(normalizedMax, step));\n}\n\nfunction rangeFromCenter(center: number, span: number, totalRanks: number): PitchRange {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const normalizedSpan = Math.max(1, Math.round(span));\n  const half = (normalizedSpan - 1) / 2;\n  let topIndex = Math.round(center - half);\n  let bottomIndex = topIndex + normalizedSpan - 1;\n\n  if (topIndex < 0) {\n    bottomIndex += -topIndex;\n    topIndex = 0;\n  }\n  if (bottomIndex > maxIndex) {\n    const overshoot = bottomIndex - maxIndex;\n    topIndex -= overshoot;\n    bottomIndex = maxIndex;\n  }\n  topIndex = clampInt(topIndex, 0, maxIndex);\n  bottomIndex = clampInt(bottomIndex, topIndex, maxIndex);\n  return { topIndex, bottomIndex };\n}\n\nexport function getSpan(range: PitchRange): number {\n  return (range.bottomIndex - range.topIndex) + 1;\n}\n\nexport function clampToGamut(range: Partial<PitchRange>, totalRanks: number): PitchRange {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const topIndex = clampInt(range.topIndex ?? 0, 0, maxIndex);\n  const bottomIndex = clampInt(range.bottomIndex ?? maxIndex, 0, maxIndex);\n  if (bottomIndex < topIndex) {\n    return { topIndex: bottomIndex, bottomIndex: topIndex };\n  }\n  return { topIndex, bottomIndex };\n}\n\n/**\n * Ensures the range is valid and has at least `minSpan` rows by expanding around its center.\n */\nexport function normalizeRange(\n  range: Partial<PitchRange>,\n  totalRanks: number,\n  minSpan: number = DEFAULT_MIN_VIEWPORT_ROWS\n): PitchRange {\n  const clamped = clampToGamut(range, totalRanks);\n  const normalizedMinSpan = Math.max(1, Math.round(minSpan));\n  const span = getSpan(clamped);\n  if (span >= normalizedMinSpan) {\n    return clamped;\n  }\n\n  const center = (clamped.topIndex + clamped.bottomIndex) / 2;\n  return rangeFromCenter(center, normalizedMinSpan, totalRanks);\n}\n\nexport function getNormalizedRange(\n  range: PitchRange | undefined,\n  totalRanks: number,\n  minSpan: number = DEFAULT_MIN_VIEWPORT_ROWS\n): PitchRange {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const current = range || { topIndex: 0, bottomIndex: maxIndex };\n  return normalizeRange(current, totalRanks, minSpan);\n}\n\n/**\n * Sets the top endpoint while keeping the bottom fixed (wheel semantics).\n */\nexport function setTopEndpoint(\n  current: PitchRange,\n  requestedTop: number,\n  totalRanks: number,\n  minSpan: number = DEFAULT_MIN_VIEWPORT_ROWS\n): PitchRange {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const bottomIndex = clampInt(current.bottomIndex, 0, maxIndex);\n  const normalizedMinSpan = Math.max(1, Math.round(minSpan));\n  const maxTop = Math.max(0, bottomIndex - (normalizedMinSpan - 1));\n  const topIndex = clampInt(requestedTop, 0, maxTop);\n  return { topIndex, bottomIndex };\n}\n\n/**\n * Sets the bottom endpoint while keeping the top fixed (wheel semantics).\n */\nexport function setBottomEndpoint(\n  current: PitchRange,\n  requestedBottom: number,\n  totalRanks: number,\n  minSpan: number = DEFAULT_MIN_VIEWPORT_ROWS\n): PitchRange {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const topIndex = clampInt(current.topIndex, 0, maxIndex);\n  const normalizedMinSpan = Math.max(1, Math.round(minSpan));\n  const minBottom = Math.min(maxIndex, topIndex + (normalizedMinSpan - 1));\n  const bottomIndex = clampInt(requestedBottom, minBottom, maxIndex);\n  return { topIndex, bottomIndex };\n}\n\n/**\n * Computes the constrained top index without mutating state.\n */\nexport function computeConstrainedTopIndex(\n  currentBottomIndex: number,\n  requestedTop: number,\n  totalRanks: number,\n  minSpan: number = DEFAULT_MIN_VIEWPORT_ROWS\n): number {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const bottomIndex = clampInt(currentBottomIndex, 0, maxIndex);\n  const normalizedMinSpan = Math.max(1, Math.round(minSpan));\n  const maxTop = Math.max(0, bottomIndex - (normalizedMinSpan - 1));\n  return clampInt(requestedTop, 0, maxTop);\n}\n\n/**\n * Computes the constrained bottom index without mutating state.\n */\nexport function computeConstrainedBottomIndex(\n  currentTopIndex: number,\n  requestedBottom: number,\n  totalRanks: number,\n  minSpan: number = DEFAULT_MIN_VIEWPORT_ROWS\n): number {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const topIndex = clampInt(currentTopIndex, 0, maxIndex);\n  const normalizedMinSpan = Math.max(1, Math.round(minSpan));\n  const minBottom = Math.min(maxIndex, topIndex + (normalizedMinSpan - 1));\n  return clampInt(requestedBottom, minBottom, maxIndex);\n}\n\n/**\n * Pans the viewport range by `deltaRows`, keeping its span constant.\n */\nexport function shiftRangeBy(\n  current: PitchRange,\n  deltaRows: number,\n  totalRanks: number\n): PitchRange {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const span = Math.max(1, getSpan(current));\n  const maxTop = Math.max(0, (maxIndex + 1) - span);\n\n  const nextTop = clampInt(current.topIndex + deltaRows, 0, maxTop);\n  const nextBottom = Math.min(maxIndex, nextTop + span - 1);\n  return { topIndex: nextTop, bottomIndex: nextBottom };\n}\n\n/**\n * Zooms the range in/out by moving both endpoints.\n */\nexport function zoomRange(\n  current: PitchRange,\n  direction: ZoomDirection,\n  { totalRanks, minSpan = DEFAULT_MIN_VIEWPORT_ROWS, zoomStep = DEFAULT_ZOOM_STEP_ROWS }: ViewportMathOptions\n): PitchRange {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const normalizedMinSpan = Math.max(1, Math.round(minSpan));\n  const step = Math.max(0, Math.round(zoomStep));\n  const clamped = clampToGamut(current, totalRanks);\n\n  if (step === 0) {\n    return normalizeRange(clamped, totalRanks, normalizedMinSpan);\n  }\n\n  const span = getSpan(clamped);\n\n  if (direction === 'in') {\n    if (span <= normalizedMinSpan) {\n      return normalizeRange(clamped, totalRanks, normalizedMinSpan);\n    }\n\n    const targetSpan = Math.max(normalizedMinSpan, span - (2 * step));\n    const center = (clamped.topIndex + clamped.bottomIndex) / 2;\n    return rangeFromCenter(center, targetSpan, totalRanks);\n  }\n\n  const expandedTop = clamped.topIndex - step;\n  const expandedBottom = clamped.bottomIndex + step;\n\n  const topIndex = clampInt(expandedTop, 0, maxIndex);\n  const bottomIndex = clampInt(expandedBottom, 0, maxIndex);\n\n  return normalizeRange({ topIndex, bottomIndex }, totalRanks, normalizedMinSpan);\n}\n\n// ============================================================================\n// Viewport Fit/Interpolation\n// ============================================================================\n\n/**\n * Calculate the zoom level needed to fit a given number of rows in a container.\n */\nexport function calculateZoomToFitRowCount(\n  containerHeight: number,\n  rowCount: number,\n  { baseUnit, paddingRows = 1 }: ZoomToFitOptions\n): number {\n  if (!containerHeight || containerHeight <= 0 || !rowCount || rowCount <= 0) {\n    return 1.0;\n  }\n\n  const effectiveRows = Math.max(1, Math.round(rowCount) + Math.max(0, Math.round(paddingRows)));\n  const normalizedBaseUnit = normalizeBaseUnit(baseUnit);\n  return (2 * containerHeight) / (effectiveRows * normalizedBaseUnit);\n}\n\n/**\n * Calculate viewport bounds from a pitch range.\n */\nexport function calculateViewportBounds(\n  pitchRange: PitchRange | undefined,\n  totalRanks: number,\n  cellHeight: number\n): { startRank: number; endRank: number; scrollOffset: number } {\n  const maxIndex = Math.max(0, totalRanks - 1);\n  const halfUnit = cellHeight / 2;\n\n  const normalized = normalizeRange(\n    pitchRange || { topIndex: 0, bottomIndex: maxIndex },\n    totalRanks,\n    DEFAULT_MIN_VIEWPORT_ROWS\n  );\n\n  const startRank = Math.max(0, Math.min(maxIndex, normalized.topIndex ?? 0));\n  const bottomIndex = Math.max(startRank, Math.min(maxIndex, normalized.bottomIndex ?? maxIndex));\n  const endRank = Math.min(totalRanks, bottomIndex + 1);\n  const scrollOffset = startRank * halfUnit;\n\n  return { startRank, endRank, scrollOffset };\n}\n\n/**\n * Create an interpolated range for smooth animations.\n */\nexport function interpolateRange(\n  startRange: PitchRange,\n  targetRange: PitchRange,\n  t: number,\n  totalRanks: number\n): PitchRange {\n  const interpolatedTop = Math.round(\n    startRange.topIndex + (targetRange.topIndex - startRange.topIndex) * t\n  );\n  const interpolatedBottom = Math.round(\n    startRange.bottomIndex + (targetRange.bottomIndex - startRange.bottomIndex) * t\n  );\n\n  return normalizeRange(\n    { topIndex: interpolatedTop, bottomIndex: interpolatedBottom },\n    totalRanks,\n    DEFAULT_MIN_VIEWPORT_ROWS\n  );\n}\n\n/**\n * Cubic ease-in-out function for smooth animations.\n */\nexport function easeInOutCubic(t: number): number {\n  return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;\n}\n\n// ============================================================================\n// Viewport Windowing (cell-height-driven)\n// ============================================================================\n\nexport interface ViewportWindow {\n  startRow: number;\n  endRow: number;\n  cellHeight: number;\n  visibleRows: number;\n}\n\nexport interface ViewportWindowConfig {\n  containerHeight: number;\n  fullRowData: PitchRowData[];\n  preferredCellHeight?: number;\n  minCellHeight?: number;\n  centerOnMidi?: number;\n}\n\nconst DEFAULT_PREFERRED_CELL_HEIGHT = 40;\nconst DEFAULT_MIN_CELL_HEIGHT = 20;\n\n/**\n * Calculate optimal viewport window that fills container height.\n */\nexport function calculateViewportWindow(config: ViewportWindowConfig): ViewportWindow {\n  const {\n    containerHeight,\n    fullRowData,\n    preferredCellHeight = DEFAULT_PREFERRED_CELL_HEIGHT,\n    minCellHeight = DEFAULT_MIN_CELL_HEIGHT,\n    centerOnMidi,\n  } = config;\n\n  const totalRows = fullRowData.length;\n\n  if (totalRows === 0) {\n    return { startRow: 0, endRow: 0, cellHeight: preferredCellHeight, visibleRows: 0 };\n  }\n\n  const normalizedMinCellHeight = Math.max(1, minCellHeight);\n  const normalizedPreferredCellHeight = Math.max(normalizedMinCellHeight, preferredCellHeight);\n\n  const maxVisibleRowsForCellHeight = (height: number): number => {\n    if (containerHeight <= 0 || height <= 0) {\n      return 0;\n    }\n    const halfUnit = height / 2;\n    return Math.max(0, Math.floor(containerHeight / halfUnit) - 1);\n  };\n\n  const maxVisibleRowsAtPreferred = maxVisibleRowsForCellHeight(normalizedPreferredCellHeight);\n  const maxVisibleRowsAtMinimum = maxVisibleRowsForCellHeight(normalizedMinCellHeight);\n\n  if (totalRows <= maxVisibleRowsAtPreferred && maxVisibleRowsAtPreferred > 0) {\n    const cellHeight = (2 * containerHeight) / (totalRows + 1);\n    return {\n      startRow: 0,\n      endRow: totalRows - 1,\n      cellHeight,\n      visibleRows: totalRows,\n    };\n  }\n\n  if (totalRows <= maxVisibleRowsAtMinimum && maxVisibleRowsAtMinimum > 0) {\n    const cellHeight = (2 * containerHeight) / (totalRows + 1);\n    return {\n      startRow: 0,\n      endRow: totalRows - 1,\n      cellHeight,\n      visibleRows: totalRows,\n    };\n  }\n\n  const visibleRows = Math.max(1, maxVisibleRowsAtMinimum);\n  let startRow = 0;\n  let endRow = visibleRows - 1;\n\n  if (centerOnMidi !== undefined && fullRowData[0]) {\n    const firstRow = fullRowData[0];\n    const maxMidi = firstRow.midi ?? 108;\n    const centerRowIndex = maxMidi - Math.round(centerOnMidi);\n\n    if (centerRowIndex >= 0 && centerRowIndex < totalRows) {\n      const halfVisible = Math.floor(visibleRows / 2);\n      startRow = Math.max(0, centerRowIndex - halfVisible);\n      endRow = Math.min(totalRows - 1, startRow + visibleRows - 1);\n\n      if (endRow === totalRows - 1) {\n        startRow = Math.max(0, endRow - visibleRows + 1);\n      }\n    }\n  }\n\n  const cellHeight = (2 * containerHeight) / (visibleRows + 1);\n\n  return {\n    startRow,\n    endRow,\n    cellHeight,\n    visibleRows,\n  };\n}\n\n/**\n * Scroll viewport up by specified number of rows.\n */\nexport function scrollViewportUp(\n  currentWindow: ViewportWindow,\n  totalRows: number,\n  scrollRows: number = 1\n): ViewportWindow {\n  const newStartRow = Math.max(0, currentWindow.startRow - scrollRows);\n  const newEndRow = newStartRow + currentWindow.visibleRows - 1;\n\n  return {\n    ...currentWindow,\n    startRow: newStartRow,\n    endRow: newEndRow,\n  };\n}\n\n/**\n * Scroll viewport down by specified number of rows.\n */\nexport function scrollViewportDown(\n  currentWindow: ViewportWindow,\n  totalRows: number,\n  scrollRows: number = 1\n): ViewportWindow {\n  const maxStartRow = Math.max(0, totalRows - currentWindow.visibleRows);\n  const newStartRow = Math.min(maxStartRow, currentWindow.startRow + scrollRows);\n  const newEndRow = Math.min(totalRows - 1, newStartRow + currentWindow.visibleRows - 1);\n\n  return {\n    ...currentWindow,\n    startRow: newStartRow,\n    endRow: newEndRow,\n  };\n}\n","<script lang=\"ts\">\r\n  /**\r\n   * PitchGrid Component\r\n   *\r\n   * A shared pitch grid visualization component that supports multiple modes:\r\n   * - 'notation': Full editing with interactors (Student Notation)\r\n   * - 'playback': Read-only playback display (Student Notation)\r\n   * - 'singing': Real-time pitch visualization (Singing Trainer - stationary)\r\n   * - 'highway': Note highway with flowing targets (Singing Trainer - Guitar Hero)\r\n   */\r\n\r\n  import { onMount, onDestroy } from 'svelte';\r\n  import type {\r\n    PitchGridMode,\r\n    PitchGridViewport,\r\n    CoordinateUtils,\r\n    LegendHighlightConfig,\r\n    SingingModeConfig,\r\n    HighwayModeConfig,\r\n    PitchHistoryPoint,\r\n    TargetNote,\r\n  } from './types.js';\r\n  import type {\r\n    PitchRowData,\r\n    PlacedNote,\r\n    TonicSign,\r\n    MacrobeatGrouping,\r\n    MacrobeatBoundaryStyle,\r\n    ModulationMarker,\r\n    AccidentalMode,\r\n    DegreeDisplayMode,\r\n    LongNoteStyle,\r\n  } from '@mlt/types';\r\n  import {\r\n    createColumnCoordinates,\r\n    createTimeCoordinates,\r\n    getVisibleRowRangeWithPadding,\r\n    isRowVisible,\r\n  } from './renderers/coordinateUtils.js';\r\n  import {\r\n    drawHorizontalLines,\r\n    drawVerticalLines,\r\n    drawTimeBasedVerticalLines,\r\n    type HorizontalLinesConfig,\r\n    type VerticalLinesConfig,\r\n    type TimeBasedVerticalLinesConfig,\r\n  } from './renderers/gridLines.js';\r\n  import {\r\n    drawSingleColumnOvalNote,\r\n    drawTwoColumnOvalNote,\r\n    drawTonicShape,\r\n    drawUserPitchIndicator,\r\n    drawUserPitchTrace,\r\n    drawTargetNotes,\r\n    type NoteRenderContext,\r\n    type NoteRenderConfig,\r\n    type UserPitchRenderConfig,\r\n  } from './renderers/notes.js';\r\n  import {\r\n    drawLegendsToSeparateCanvases,\r\n    type LegendRenderConfig,\r\n  } from './renderers/legend.js';\r\n\r\n  // ============================================================================\r\n  // Props - Using interface for cleaner typing\r\n  // ============================================================================\r\n\r\n  interface Props {\r\n    // Core props (all modes)\r\n    mode: PitchGridMode;\r\n    fullRowData: PitchRowData[];\r\n    viewport: PitchGridViewport;\r\n    cellWidth: number;\r\n    cellHeight: number;\r\n    colorMode?: 'color' | 'bw';\r\n    degreeDisplayMode?: DegreeDisplayMode;\r\n    accidentalMode?: AccidentalMode;\r\n    showFrequencyLabels?: boolean;\r\n    showOctaveLabels?: boolean;\r\n    showRightLegend?: boolean;\r\n    legendHighlight?: LegendHighlightConfig;\r\n\r\n    // Notation/Playback mode props\r\n    placedNotes?: PlacedNote[];\r\n    placedTonicSigns?: TonicSign[];\r\n    columnWidths?: number[];\r\n    macrobeatGroupings?: MacrobeatGrouping[];\r\n    macrobeatBoundaryStyles?: MacrobeatBoundaryStyle[];\r\n    tempoModulationMarkers?: ModulationMarker[];\r\n    longNoteStyle?: LongNoteStyle;\r\n\r\n    // Singing mode props\r\n    singingConfig?: SingingModeConfig;\r\n\r\n    // Highway mode props\r\n    highwayConfig?: HighwayModeConfig;\r\n    beatIntervalMs?: number;\r\n    beatTimeOffsetMs?: number;\r\n  }\r\n\r\n  let {\r\n    mode,\r\n    fullRowData,\r\n    viewport,\r\n    cellWidth,\r\n    cellHeight,\r\n    colorMode = 'color',\r\n    degreeDisplayMode = 'off',\r\n    accidentalMode = { sharp: true, flat: true },\r\n    showFrequencyLabels = false,\r\n    showOctaveLabels = true,\r\n    showRightLegend = true,\r\n    legendHighlight,\r\n    placedNotes = [],\r\n    placedTonicSigns = [],\r\n    columnWidths = [],\r\n    macrobeatGroupings = [],\r\n    macrobeatBoundaryStyles = [],\r\n    tempoModulationMarkers,\r\n    longNoteStyle = 'style1',\r\n    singingConfig,\r\n    highwayConfig,\r\n    beatIntervalMs = 500,\r\n    beatTimeOffsetMs = 0,\r\n  }: Props = $props();\r\n\r\n  // ============================================================================\r\n  // Canvas Refs (these are element bindings, not reactive state)\r\n  // ============================================================================\r\n\r\n  let mainCanvas: HTMLCanvasElement | undefined = $state(undefined);\r\n  let legendLeftCanvas: HTMLCanvasElement | undefined = $state(undefined);\r\n  let legendRightCanvas: HTMLCanvasElement | undefined = $state(undefined);\r\n  let ctx: CanvasRenderingContext2D | null = $state(null);\r\n  let leftCtx: CanvasRenderingContext2D | null = $state(null);\r\n  let rightCtx: CanvasRenderingContext2D | null = $state(null);\r\n  let animationFrameId: number | null = $state(null);\r\n\r\n  // Legend column width in cell units (matches Student Notation sizing)\r\n  const LEGEND_COLUMN_WIDTH_UNITS = 3;\r\n  const legendColumnWidth = $derived(cellWidth * LEGEND_COLUMN_WIDTH_UNITS);\r\n  const legendCanvasWidth = $derived(legendColumnWidth * 2);\r\n  const showLegends = $derived(showOctaveLabels || showFrequencyLabels);\r\n  const legendTotalWidth = $derived(showLegends ? legendCanvasWidth * (showRightLegend ? 2 : 1) : 0);\r\n  const gridWidth = $derived(Math.max(0, viewport.containerWidth - legendTotalWidth));\r\n\r\n  // ============================================================================\r\n  // Derived State\r\n  // ============================================================================\r\n\r\n  const isNotationMode = $derived(mode === 'notation' || mode === 'playback');\r\n  const isSingingMode = $derived(mode === 'singing');\r\n  const isHighwayMode = $derived(mode === 'highway');\r\n\r\n  // ============================================================================\r\n  // Coordinate Utilities\r\n  // ============================================================================\r\n\r\n  function getCoordinates(): CoordinateUtils {\r\n    if (isNotationMode) {\r\n      return createColumnCoordinates({\r\n        cellWidth,\r\n        cellHeight,\r\n        columnWidths,\r\n        viewport,\r\n        tempoModulationMarkers,\r\n      });\r\n    } else {\r\n      const config = isHighwayMode ? highwayConfig : singingConfig;\r\n\r\n      return createTimeCoordinates({\r\n        cellWidth,\r\n        cellHeight,\r\n        viewport,\r\n        pixelsPerSecond: config?.pixelsPerSecond ?? 200,\r\n        nowLineX: (config as HighwayModeConfig)?.nowLineX ?? 100,\r\n        currentTimeMs: (config as HighwayModeConfig)?.currentTimeMs ?? 0,\r\n      });\r\n    }\r\n  }\r\n\r\n  // ============================================================================\r\n  // Rendering\r\n  // ============================================================================\r\n\r\n  function render(): void {\r\n    if (!ctx || !mainCanvas) return;\r\n\r\n    const coords = getCoordinates();\r\n    const { paddedStartRow, paddedEndRow } = getVisibleRowRangeWithPadding(viewport, fullRowData);\r\n\r\n    // Clear canvas\r\n    ctx.clearRect(0, 0, gridWidth, viewport.containerHeight);\r\n\r\n    // Draw horizontal grid lines\r\n    const horizontalConfig: HorizontalLinesConfig = {\r\n      fullRowData,\r\n      cellHeight,\r\n      viewportHeight: viewport.containerHeight,\r\n      viewportWidth: gridWidth,\r\n      colorMode,\r\n    };\r\n    drawHorizontalLines(ctx, horizontalConfig, coords, paddedStartRow, paddedEndRow);\r\n\r\n    // Mode-specific rendering\r\n    if (isNotationMode) {\r\n      renderNotationMode(ctx, coords);\r\n    } else if (isSingingMode) {\r\n      renderSingingMode(ctx, coords);\r\n    } else if (isHighwayMode) {\r\n      renderHighwayMode(ctx, coords);\r\n    }\r\n\r\n    // Render legends if enabled and contexts are available\r\n    if (showLegends && (leftCtx || rightCtx)) {\r\n      renderLegends(coords, paddedStartRow, paddedEndRow);\r\n    }\r\n  }\r\n\r\n  function renderNotationMode(\r\n    renderCtx: CanvasRenderingContext2D,\r\n    coords: CoordinateUtils\r\n  ): void {\r\n    // Draw vertical lines\r\n    const macrobeatBoundaries = calculateMacrobeatBoundaries(macrobeatGroupings);\r\n    const verticalConfig: VerticalLinesConfig = {\r\n      columnWidths,\r\n      cellWidth,\r\n      viewportHeight: viewport.containerHeight,\r\n      macrobeatGroupings,\r\n      macrobeatBoundaryStyles,\r\n      placedTonicSigns,\r\n    };\r\n    drawVerticalLines(renderCtx, verticalConfig, coords, macrobeatBoundaries);\r\n\r\n    // Filter visible notes\r\n    const visibleNotes = placedNotes.filter(note => {\r\n      if (note.isDrum || note.globalRow === undefined) return false;\r\n      return isRowVisible(note.globalRow, viewport, cellHeight, coords);\r\n    });\r\n\r\n    // Filter visible tonic signs\r\n    const visibleTonicSigns = placedTonicSigns.filter(sign => {\r\n      if (sign.globalRow === undefined) return false;\r\n      return isRowVisible(sign.globalRow, viewport, cellHeight, coords);\r\n    });\r\n\r\n    // Create render context\r\n    const noteConfig: NoteRenderConfig = {\r\n      cellWidth,\r\n      cellHeight,\r\n      columnWidths,\r\n      degreeDisplayMode,\r\n      accidentalMode,\r\n      longNoteStyle,\r\n      colorMode,\r\n    };\r\n\r\n    const noteContext: NoteRenderContext = {\r\n      config: noteConfig,\r\n      coords,\r\n      allNotes: placedNotes,\r\n    };\r\n\r\n    // Draw notes\r\n    for (const note of visibleNotes) {\r\n      if (note.shape === 'oval') {\r\n        drawSingleColumnOvalNote(renderCtx, noteContext, note, note.globalRow!);\r\n      } else if (note.shape === 'circle') {\r\n        drawTwoColumnOvalNote(renderCtx, noteContext, note, note.globalRow!);\r\n      }\r\n    }\r\n\r\n    // Draw tonic signs\r\n    for (const sign of visibleTonicSigns) {\r\n      drawTonicShape(renderCtx, noteContext, sign);\r\n    }\r\n  }\r\n\r\n  function renderSingingMode(renderCtx: CanvasRenderingContext2D, coords: CoordinateUtils): void {\r\n    if (!singingConfig) return;\r\n\r\n    const userPitchConfig: UserPitchRenderConfig = {\r\n      cellHeight,\r\n      viewportWidth: gridWidth,\r\n      pixelsPerSecond: singingConfig.pixelsPerSecond ?? 200,\r\n      timeWindowMs: singingConfig.timeWindowMs ?? 4000,\r\n      colorMode,\r\n      trailConfig: singingConfig.trailConfig,\r\n    };\r\n\r\n    // Draw user pitch trace\r\n    if (singingConfig.pitchHistory && singingConfig.pitchHistory.length > 0) {\r\n      drawUserPitchTrace(\r\n        renderCtx,\r\n        coords,\r\n        singingConfig.pitchHistory,\r\n        performance.now(),\r\n        userPitchConfig,\r\n        fullRowData\r\n      );\r\n    }\r\n\r\n    // Draw target notes if any\r\n    if (singingConfig.targetNotes && singingConfig.targetNotes.length > 0) {\r\n      drawTargetNotes(\r\n        renderCtx,\r\n        coords,\r\n        singingConfig.targetNotes,\r\n        performance.now(),\r\n        userPitchConfig,\r\n        fullRowData\r\n      );\r\n    }\r\n\r\n    // Draw current pitch indicator at right edge (for stationary mode)\r\n    if (singingConfig.userPitch && singingConfig.userPitch.clarity > 0.5) {\r\n      drawUserPitchIndicator(\r\n        renderCtx,\r\n        coords,\r\n        singingConfig.userPitch.midi,\r\n        singingConfig.userPitch.clarity,\r\n        gridWidth - 20,\r\n        userPitchConfig,\r\n        fullRowData\r\n      );\r\n    }\r\n  }\r\n\r\n  function renderHighwayMode(renderCtx: CanvasRenderingContext2D, coords: CoordinateUtils): void {\r\n    if (!highwayConfig) return;\r\n\r\n    const userPitchConfig: UserPitchRenderConfig = {\r\n      cellHeight,\r\n      viewportWidth: viewport.containerWidth,\r\n      nowLineX: highwayConfig.nowLineX,\r\n      pixelsPerSecond: highwayConfig.pixelsPerSecond ?? 200,\r\n      timeWindowMs: highwayConfig.timeWindowMs ?? 4000,\r\n      colorMode,\r\n      trailConfig: highwayConfig.trailConfig,\r\n    };\r\n\r\n    // Check if we have scrolling grid data (Student Notation mode)\r\n    const hasScrollingGrid = highwayConfig.scrollingGridData && highwayConfig.scrollOffset !== undefined;\r\n\r\n    if (hasScrollingGrid) {\r\n      // Render scrolling grid mode (Student Notation style)\r\n      renderScrollingGrid(renderCtx, coords);\r\n    } else {\r\n      // Render target notes mode (Singing Trainer style - original behavior)\r\n      // Draw time-based vertical lines\r\n      const visibleTimeRange = {\r\n        startMs: highwayConfig.currentTimeMs - 1000,\r\n        endMs: highwayConfig.currentTimeMs + (gridWidth / (highwayConfig.pixelsPerSecond ?? 200)) * 1000,\r\n      };\r\n\r\n      const verticalConfig: TimeBasedVerticalLinesConfig = {\r\n        viewportWidth: gridWidth,\r\n        viewportHeight: viewport.containerHeight,\r\n        beatIntervalMs,\r\n        visibleTimeRange,\r\n        nowLineX: highwayConfig.nowLineX,\r\n        beatTimeOffsetMs,\r\n      };\r\n      drawTimeBasedVerticalLines(renderCtx, verticalConfig, coords);\r\n\r\n      // Draw target notes with user pitch for hit detection\r\n      if (highwayConfig.targetNotes && highwayConfig.targetNotes.length > 0) {\r\n        drawTargetNotes(\r\n          renderCtx,\r\n          coords,\r\n          highwayConfig.targetNotes,\r\n          highwayConfig.currentTimeMs,\r\n          userPitchConfig,\r\n          fullRowData,\r\n          highwayConfig.userPitch?.midi ?? null,\r\n          highwayConfig.userPitch?.clarity ?? 0\r\n        );\r\n      }\r\n    }\r\n\r\n    // Draw judgment line (both modes)\r\n    drawJudgmentLine(renderCtx, highwayConfig.nowLineX, viewport.containerHeight);\r\n\r\n    // Draw onramp countdown if active\r\n    if (highwayConfig.showOnrampCountdown && highwayConfig.onrampBeatsRemaining !== undefined) {\r\n      drawOnrampCountdown(renderCtx, highwayConfig.onrampBeatsRemaining);\r\n    }\r\n\r\n    // Draw user pitch indicator at now line\r\n    if (highwayConfig.userPitch && highwayConfig.userPitch.clarity > 0.5) {\r\n      drawUserPitchIndicator(\r\n        renderCtx,\r\n        coords,\r\n        highwayConfig.userPitch.midi,\r\n        highwayConfig.userPitch.clarity,\r\n        highwayConfig.nowLineX,\r\n        userPitchConfig,\r\n        fullRowData\r\n      );\r\n    }\r\n  }\r\n\r\n  function renderScrollingGrid(renderCtx: CanvasRenderingContext2D, coords: CoordinateUtils): void {\r\n    if (!highwayConfig?.scrollingGridData || highwayConfig.scrollOffset === undefined) return;\r\n\r\n    const gridData = highwayConfig.scrollingGridData;\r\n    const scrollOffset = highwayConfig.scrollOffset;\r\n\r\n    // Draw scrolling vertical lines (macrobeat boundaries, bar lines)\r\n    const macrobeatBoundaries = calculateMacrobeatBoundaries(gridData.macrobeatGroupings);\r\n    for (let i = 0; i < macrobeatBoundaries.length; i++) {\r\n      const columnIndex = macrobeatBoundaries[i];\r\n      const x = (columnIndex * cellWidth) - scrollOffset;\r\n\r\n      // Only draw if visible\r\n      if (x >= -cellWidth && x <= gridWidth + cellWidth) {\r\n        const boundaryStyle = gridData.macrobeatBoundaryStyles[i] || 'solid';\r\n        const lineWidth = boundaryStyle === 'solid' ? 2 : 1;\r\n        const dash = boundaryStyle === 'dashed' ? [5, 5] : [];\r\n\r\n        renderCtx.strokeStyle = '#495057';\r\n        renderCtx.lineWidth = lineWidth;\r\n        renderCtx.setLineDash(dash);\r\n        renderCtx.beginPath();\r\n        renderCtx.moveTo(x, 0);\r\n        renderCtx.lineTo(x, viewport.containerHeight);\r\n        renderCtx.stroke();\r\n        renderCtx.setLineDash([]);\r\n      }\r\n    }\r\n\r\n    // Draw scrolling notes\r\n    const noteConfig: NoteRenderConfig = {\r\n      cellWidth,\r\n      cellHeight,\r\n      columnWidths: gridData.columnWidths,\r\n      degreeDisplayMode,\r\n      accidentalMode,\r\n      longNoteStyle,\r\n      colorMode,\r\n    };\r\n\r\n    for (const note of gridData.placedNotes) {\r\n      if (note.isDrum || note.globalRow === undefined) continue;\r\n      if (!isRowVisible(note.globalRow, viewport, cellHeight, coords)) continue;\r\n\r\n      // Calculate scrolled X position\r\n      const noteStartX = (note.startColumnIndex * cellWidth) - scrollOffset;\r\n      const noteEndX = (note.endColumnIndex * cellWidth) - scrollOffset;\r\n\r\n      // Only render if visible\r\n      if (noteEndX >= -cellWidth && noteStartX <= gridWidth + cellWidth) {\r\n        // Create a temporary scrolled coords utility\r\n        const scrolledCoords = {\r\n          ...coords,\r\n          getColumnX: (colIndex: number) => (colIndex * cellWidth) - scrollOffset,\r\n        };\r\n\r\n        const noteContext: NoteRenderContext = {\r\n          config: noteConfig,\r\n          coords: scrolledCoords,\r\n          allNotes: gridData.placedNotes,\r\n        };\r\n\r\n        if (note.shape === 'oval') {\r\n          drawSingleColumnOvalNote(renderCtx, noteContext, note, note.globalRow);\r\n        } else if (note.shape === 'circle') {\r\n          drawTwoColumnOvalNote(renderCtx, noteContext, note, note.globalRow);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function drawJudgmentLine(ctx: CanvasRenderingContext2D, x: number, height: number): void {\r\n    ctx.strokeStyle = 'rgba(255, 0, 0, 0.9)';\r\n    ctx.lineWidth = 3;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, 0);\r\n    ctx.lineTo(x, height);\r\n    ctx.stroke();\r\n  }\r\n\r\n  function drawOnrampCountdown(ctx: CanvasRenderingContext2D, beatsRemaining: number): void {\r\n    // Simple countdown display at top center\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n    ctx.fillRect(gridWidth / 2 - 40, 10, 80, 50);\r\n\r\n    ctx.fillStyle = '#ffffff';\r\n    ctx.font = 'bold 36px sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.textBaseline = 'middle';\r\n    ctx.fillText(beatsRemaining.toString(), gridWidth / 2, 35);\r\n  }\r\n\r\n  function renderLegends(coords: CoordinateUtils, startRow: number, endRow: number): void {\r\n    const legendConfig: LegendRenderConfig = {\r\n      fullRowData,\r\n      cellWidth,\r\n      cellHeight,\r\n      legendColumnWidth,\r\n      colorMode,\r\n      showFrequencyLabels,\r\n      showOctaveLabels,\r\n      accidentalMode,\r\n      focusedPitchClasses: null, // No focus filtering in basic mode\r\n      focusColorsEnabled: false,\r\n      highlight: legendHighlight,\r\n    };\r\n\r\n    const legendOptions = {\r\n      startRow,\r\n      endRow,\r\n      coords,\r\n    };\r\n\r\n    drawLegendsToSeparateCanvases(leftCtx, rightCtx, legendConfig, legendOptions);\r\n  }\r\n\r\n  // ============================================================================\r\n  // Helpers\r\n  // ============================================================================\r\n\r\n  function calculateMacrobeatBoundaries(groupings: (2 | 3)[]): number[] {\r\n    const boundaries: number[] = [];\r\n    let column = 0;\r\n\r\n    for (const grouping of groupings) {\r\n      column += grouping;\r\n      boundaries.push(column);\r\n    }\r\n\r\n    return boundaries;\r\n  }\r\n\r\n  // ============================================================================\r\n  // Animation Loop (for singing/highway modes)\r\n  // ============================================================================\r\n\r\n  function startAnimationLoop(): void {\r\n    if (animationFrameId) return;\r\n\r\n    function loop(): void {\r\n      render();\r\n      animationFrameId = requestAnimationFrame(loop);\r\n    }\r\n\r\n    animationFrameId = requestAnimationFrame(loop);\r\n  }\r\n\r\n  function stopAnimationLoop(): void {\r\n    if (animationFrameId) {\r\n      cancelAnimationFrame(animationFrameId);\r\n      animationFrameId = null;\r\n    }\r\n  }\r\n\r\n  // ============================================================================\r\n  // Canvas Setup\r\n  // ============================================================================\r\n\r\n  function setupCanvas(): void {\r\n    if (!mainCanvas) return;\r\n\r\n    ctx = mainCanvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    // Set canvas size\r\n    const dpr = window.devicePixelRatio || 1;\r\n    mainCanvas.width = gridWidth * dpr;\r\n    mainCanvas.height = viewport.containerHeight * dpr;\r\n    mainCanvas.style.width = `${gridWidth}px`;\r\n    mainCanvas.style.height = `${viewport.containerHeight}px`;\r\n    ctx.scale(dpr, dpr);\r\n\r\n    // Set up legend canvases if they exist\r\n    if (legendLeftCanvas) {\r\n      leftCtx = legendLeftCanvas.getContext('2d');\r\n      if (leftCtx) {\r\n        legendLeftCanvas.width = legendCanvasWidth * dpr;\r\n        legendLeftCanvas.height = viewport.containerHeight * dpr;\r\n        legendLeftCanvas.style.width = `${legendCanvasWidth}px`;\r\n        legendLeftCanvas.style.height = `${viewport.containerHeight}px`;\r\n        leftCtx.scale(dpr, dpr);\r\n      }\r\n    }\r\n\r\n    if (legendRightCanvas) {\r\n      rightCtx = legendRightCanvas.getContext('2d');\r\n      if (rightCtx) {\r\n        legendRightCanvas.width = legendCanvasWidth * dpr;\r\n        legendRightCanvas.height = viewport.containerHeight * dpr;\r\n        legendRightCanvas.style.width = `${legendCanvasWidth}px`;\r\n        legendRightCanvas.style.height = `${viewport.containerHeight}px`;\r\n        rightCtx.scale(dpr, dpr);\r\n      }\r\n    }\r\n\r\n    // Initial render\r\n    render();\r\n\r\n    // Start animation loop for real-time modes\r\n    if (isSingingMode || isHighwayMode) {\r\n      startAnimationLoop();\r\n    }\r\n  }\r\n\r\n  // ============================================================================\r\n  // Lifecycle\r\n  // ============================================================================\r\n\r\n  onMount(() => {\r\n    setupCanvas();\r\n  });\r\n\r\n  onDestroy(() => {\r\n    stopAnimationLoop();\r\n  });\r\n\r\n  // Re-render when props change (for notation mode)\r\n  $effect(() => {\r\n    // Track relevant props\r\n    void mode;\r\n    void viewport;\r\n    void cellWidth;\r\n    void cellHeight;\r\n    void colorMode;\r\n    void degreeDisplayMode;\r\n    void placedNotes;\r\n    void placedTonicSigns;\r\n    void columnWidths;\r\n\r\n    if (ctx && isNotationMode) {\r\n      render();\r\n    }\r\n  });\r\n\r\n  // Handle mode changes\r\n  $effect(() => {\r\n    void mode; // Track mode changes\r\n\r\n    if (isSingingMode || isHighwayMode) {\r\n      startAnimationLoop();\r\n    } else {\r\n      stopAnimationLoop();\r\n      if (ctx) render();\r\n    }\r\n  });\r\n\r\n  // Re-setup canvas when viewport dimensions change\r\n  $effect(() => {\r\n    void viewport.containerWidth;\r\n    void viewport.containerHeight;\r\n\r\n    if (ctx && mainCanvas) {\r\n      setupCanvas();\r\n    }\r\n  });\r\n</script>\r\n\r\n<div class=\"pitch-grid-container\">\r\n  {#if showLegends}\r\n    <canvas\r\n      bind:this={legendLeftCanvas}\r\n      class=\"pitch-grid-legend pitch-grid-legend--left\"\r\n    ></canvas>\r\n  {/if}\r\n\r\n  <canvas\r\n    bind:this={mainCanvas}\r\n    class=\"pitch-grid-canvas\"\r\n  ></canvas>\r\n\r\n  {#if showLegends && showRightLegend}\r\n    <canvas\r\n      bind:this={legendRightCanvas}\r\n      class=\"pitch-grid-legend pitch-grid-legend--right\"\r\n    ></canvas>\r\n  {/if}\r\n</div>\r\n\r\n<style>\r\n  .pitch-grid-container {\r\n    display: flex;\r\n    width: 100%;\r\n    height: 100%;\r\n    position: relative;\r\n  }\r\n\r\n  .pitch-grid-canvas {\r\n    flex: 1;\r\n    display: block;\r\n  }\r\n\r\n  .pitch-grid-legend {\r\n    width: 60px;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .pitch-grid-legend--left {\r\n    border-right: 1px solid #dee2e6;\r\n  }\r\n\r\n  .pitch-grid-legend--right {\r\n    border-left: 1px solid #dee2e6;\r\n  }\r\n</style>\r\n","/**\n * App State Store - Svelte 5 Runes\n *\n * Main application state for the Singing Trainer.\n */\n\nexport type VisualizationMode = 'stationary' | 'highway';\nexport type TonicNote =\n  | 'C'\n  | 'C#'\n  | 'Db'\n  | 'D'\n  | 'D#'\n  | 'Eb'\n  | 'E'\n  | 'F'\n  | 'F#'\n  | 'Gb'\n  | 'G'\n  | 'G#'\n  | 'Ab'\n  | 'A'\n  | 'A#'\n  | 'Bb'\n  | 'B';\n\nexport interface DroneState {\n  isPlaying: boolean;\n  octave: number;\n  volume: number;\n}\n\nexport interface YAxisRange {\n  minMidi: number;\n  maxMidi: number;\n}\n\nexport interface AppState {\n  isDetecting: boolean;\n  visualizationMode: VisualizationMode;\n  tonic: TonicNote;\n  useDegrees: boolean;\n  showAccidentals: boolean;\n  pitchHighlightEnabled: boolean;\n  yAxisRange: YAxisRange;\n  drone: DroneState;\n}\n\nconst DEFAULT_STATE: AppState = {\n  isDetecting: false,\n  visualizationMode: 'highway',\n  tonic: 'C',\n  useDegrees: false,\n  showAccidentals: true,\n  pitchHighlightEnabled: true,\n  yAxisRange: { minMidi: 40, maxMidi: 72 }, // E2 to C5\n  drone: { isPlaying: false, octave: 3, volume: -12 },\n};\n\nfunction createAppState() {\n  let state = $state<AppState>({ ...DEFAULT_STATE });\n\n  return {\n    get state() {\n      return state;\n    },\n\n    toggleDetecting() {\n      state.isDetecting = !state.isDetecting;\n    },\n\n    setDetecting(isDetecting: boolean) {\n      state.isDetecting = isDetecting;\n    },\n\n    setVisualizationMode(mode: VisualizationMode) {\n      state.visualizationMode = mode;\n    },\n\n    setTonic(tonic: TonicNote) {\n      state.tonic = tonic;\n    },\n\n    setUseDegrees(useDegrees: boolean) {\n      state.useDegrees = useDegrees;\n    },\n\n    setShowAccidentals(show: boolean) {\n      state.showAccidentals = show;\n    },\n\n    togglePitchHighlight() {\n      state.pitchHighlightEnabled = !state.pitchHighlightEnabled;\n    },\n\n    setPitchHighlightEnabled(enabled: boolean) {\n      state.pitchHighlightEnabled = enabled;\n    },\n\n    setYAxisRange(range: YAxisRange) {\n      state.yAxisRange = range;\n    },\n\n    expandYAxisUpper() {\n      if (state.yAxisRange.maxMidi < 108) {\n        state.yAxisRange = { ...state.yAxisRange, maxMidi: state.yAxisRange.maxMidi + 1 };\n      }\n    },\n\n    contractYAxisUpper() {\n      if (state.yAxisRange.maxMidi > state.yAxisRange.minMidi + 6) {\n        state.yAxisRange = { ...state.yAxisRange, maxMidi: state.yAxisRange.maxMidi - 1 };\n      }\n    },\n\n    expandYAxisLower() {\n      if (state.yAxisRange.minMidi > 21) {\n        state.yAxisRange = { ...state.yAxisRange, minMidi: state.yAxisRange.minMidi - 1 };\n      }\n    },\n\n    contractYAxisLower() {\n      if (state.yAxisRange.minMidi < state.yAxisRange.maxMidi - 6) {\n        state.yAxisRange = { ...state.yAxisRange, minMidi: state.yAxisRange.minMidi + 1 };\n      }\n    },\n\n    toggleDrone() {\n      state.drone = { ...state.drone, isPlaying: !state.drone.isPlaying };\n    },\n\n    setDroneOctave(octave: number) {\n      state.drone = { ...state.drone, octave };\n    },\n\n    setDroneVolume(volume: number) {\n      state.drone = { ...state.drone, volume };\n    },\n\n    reset() {\n      state = { ...DEFAULT_STATE };\n    },\n  };\n}\n\nexport const appState = createAppState();\n","/**\n * Pitch State Store - Svelte 5 Runes\n *\n * Real-time pitch detection state including current pitch and history.\n */\n\nexport interface DetectedPitch {\n  frequency: number;\n  midi: number;\n  clarity: number;\n  pitchClass: number;\n}\n\nexport interface PitchHistoryPoint {\n  frequency: number;\n  midi: number;\n  time: number;\n  clarity: number;\n}\n\nexport interface StablePitch {\n  pitchClass: number | null;\n  midi: number | null;\n  opacity: number;\n  size: number;\n}\n\nexport interface PitchState {\n  currentPitch: DetectedPitch | null;\n  history: PitchHistoryPoint[];\n  stablePitch: StablePitch;\n}\n\nconst MAX_HISTORY_LENGTH = 200; // Cap history to bound trail render cost\n\nconst DEFAULT_STATE: PitchState = {\n  currentPitch: null,\n  history: [],\n  stablePitch: { pitchClass: null, midi: null, opacity: 0, size: 1.0 },\n};\n\nfunction createPitchState() {\n  let state = $state<PitchState>({ ...DEFAULT_STATE });\n\n  return {\n    get state() {\n      return state;\n    },\n\n    setCurrentPitch(pitch: DetectedPitch | null) {\n      state.currentPitch = pitch;\n    },\n\n    addHistoryPoint(point: PitchHistoryPoint) {\n      state.history.push(point);\n      if (state.history.length > MAX_HISTORY_LENGTH) {\n        state.history.shift();\n      }\n    },\n\n    setStablePitch(stable: StablePitch) {\n      state.stablePitch = stable;\n    },\n\n    clearHistory() {\n      state.history = [];\n    },\n\n    reset() {\n      state = { ...DEFAULT_STATE };\n    },\n  };\n}\n\nexport const pitchState = createPitchState();\n","/**\r\n * Rhythm Actions Module\r\n *\r\n * Framework-agnostic rhythm and time signature manipulation actions.\r\n * All coordinate transformations use injectable columnMapService callbacks.\r\n */\r\n\r\nimport { createModulationMarker, MODULATION_RATIOS } from '../../rhythm/modulationMapping.js';\r\nimport type {\r\n  AnacrusisCache,\r\n  CanvasSpaceColumn,\r\n  MacrobeatBoundaryStyle,\r\n  MacrobeatGrouping,\r\n  ModulationMarker,\r\n  ModulationRatio,\r\n  PlacedNote,\r\n  SixteenthStampPlacement,\r\n  TripletStampPlacement,\r\n  Store,\r\n  TonicSign,\r\n  TonicSignGroups\r\n} from '@mlt/types';\r\nimport type { ColumnMap } from '../../services/columnMapService.js';\r\n\r\n/**\r\n * Callbacks for rhythm actions to access external services\r\n */\r\nexport interface RhythmActionCallbacks {\r\n  /** Get column map for coordinate conversions */\r\n  getColumnMap?: (state: any) => ColumnMap;\r\n  /** Convert visual column to time index */\r\n  visualToTimeIndex?: (state: any, visualIndex: number, groupings: MacrobeatGrouping[]) => number | null;\r\n  /** Convert time index to visual column */\r\n  timeIndexToVisualColumn?: (state: any, timeIndex: number, groupings: MacrobeatGrouping[]) => number | null;\r\n  /** Get time boundary after a macrobeat */\r\n  getTimeBoundaryAfterMacrobeat?: (state: any, index: number, groupings: MacrobeatGrouping[]) => number;\r\n  /** Logger function */\r\n  log?: (level: 'debug' | 'info' | 'warn' | 'error', context: string, message: string, data?: unknown, category?: string) => void;\r\n}\r\n\r\n// Anacrusis constants\r\nexport const ANACRUSIS_ON_GROUPINGS: MacrobeatGrouping[] = new Array<MacrobeatGrouping>(19).fill(2);\r\nexport const ANACRUSIS_ON_STYLES: MacrobeatBoundaryStyle[] = [\r\n  'anacrusis', 'anacrusis', 'solid', 'dashed', 'dashed', 'dashed', 'solid',\r\n  'dashed', 'dashed', 'dashed', 'solid', 'dashed', 'dashed', 'dashed', 'solid',\r\n  'dashed', 'dashed', 'dashed', 'solid'\r\n];\r\nexport const ANACRUSIS_OFF_GROUPINGS: MacrobeatGrouping[] = new Array<MacrobeatGrouping>(16).fill(2);\r\nexport const ANACRUSIS_OFF_STYLES: MacrobeatBoundaryStyle[] = [\r\n  'dashed', 'dashed', 'dashed', 'solid',\r\n  'dashed', 'dashed', 'dashed', 'solid',\r\n  'dashed', 'dashed', 'dashed', 'solid',\r\n  'dashed', 'dashed', 'dashed' // Last measure completed by isLastBeat logic\r\n];\r\n\r\ntype GroupingArray = MacrobeatGrouping[];\r\ntype BoundaryStyleArray = MacrobeatBoundaryStyle[];\r\n\r\n/**\r\n * Helper to recompute tonic sign column indices after rhythm structure changes\r\n */\r\nfunction recomputeTonicColumns(\r\n  state: { tonicSignGroups?: TonicSignGroups },\r\n  getColumnMap: (state: any) => ColumnMap\r\n): void {\r\n  const map = getColumnMap(state);\r\n  const tonicStartByUuid = new Map<string, number>();\r\n\r\n  map.entries.forEach(entry => {\r\n    if (entry.type === 'tonic' && entry.tonicSignUuid && typeof entry.canvasIndex === 'number') {\r\n      tonicStartByUuid.set(entry.tonicSignUuid, entry.canvasIndex);\r\n    }\r\n  });\r\n\r\n  Object.entries(state.tonicSignGroups || {}).forEach(([uuid, group]) => {\r\n    const start = tonicStartByUuid.get(uuid);\r\n    if (start === undefined) { return; }\r\n    group.forEach((sign: TonicSign) => {\r\n      sign.columnIndex = start as CanvasSpaceColumn;\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Creates rhythm action methods with dependency injection\r\n */\r\n// Default empty column map for fallback\r\nconst EMPTY_COLUMN_MAP: ColumnMap = {\r\n  entries: [],\r\n  visualToCanvas: new Map(),\r\n  visualToTime: new Map(),\r\n  canvasToVisual: new Map(),\r\n  canvasToTime: new Map(),\r\n  timeToCanvas: new Map(),\r\n  timeToVisual: new Map(),\r\n  macrobeatBoundaries: [],\r\n  totalVisualColumns: 0,\r\n  totalCanvasColumns: 0,\r\n  totalTimeColumns: 0,\r\n  totalWidthUnmodulated: 0\r\n};\r\n\r\nexport function createRhythmActions(callbacks: RhythmActionCallbacks = {}) {\r\n  const {\r\n    getColumnMap = () => EMPTY_COLUMN_MAP,\r\n    visualToTimeIndex = () => null,\r\n    timeIndexToVisualColumn = () => null,\r\n    getTimeBoundaryAfterMacrobeat = () => 0,\r\n    log = () => {}\r\n  } = callbacks;\r\n\r\n  return {\r\n    setAnacrusis(this: Store, enabled: boolean): void {\r\n      if (this.state.hasAnacrusis === enabled) { return; }\r\n\r\n      const oldGroupings: GroupingArray = [...this.state.macrobeatGroupings];\r\n      const oldBoundaryStyles: BoundaryStyleArray = [...this.state.macrobeatBoundaryStyles];\r\n      const oldTotalBeats = oldGroupings.reduce((sum, val) => sum + val, 0);\r\n\r\n      let newGroupings: GroupingArray;\r\n      let newBoundaryStyles: BoundaryStyleArray;\r\n\r\n      if (!enabled) {\r\n        const firstSolidIndex = oldBoundaryStyles.findIndex(style => style === 'solid');\r\n        let removalCount = 0;\r\n\r\n        if (firstSolidIndex !== -1) {\r\n          removalCount = firstSolidIndex + 1;\r\n        } else {\r\n          while (\r\n            removalCount < oldBoundaryStyles.length &&\r\n            oldBoundaryStyles[removalCount] === 'anacrusis'\r\n          ) {\r\n            removalCount++;\r\n          }\r\n        }\r\n\r\n        removalCount = Math.min(removalCount, oldGroupings.length);\r\n\r\n        const removedGroupings = oldGroupings.slice(0, removalCount);\r\n        const removedStyles = oldBoundaryStyles.slice(0, removalCount);\r\n\r\n        if (removalCount > 0) {\r\n          this._anacrusisCache = {\r\n            groupings: removedGroupings,\r\n            boundaryStyles: removedStyles\r\n          };\r\n        } else {\r\n          this._anacrusisCache = null;\r\n        }\r\n\r\n        newGroupings = oldGroupings.slice(removalCount);\r\n        newBoundaryStyles = oldBoundaryStyles\r\n          .slice(removalCount)\r\n          .map(style => (style === 'anacrusis' ? 'dashed' : style));\r\n\r\n        if (newGroupings.length === 0) {\r\n          newGroupings = [...ANACRUSIS_OFF_GROUPINGS];\r\n          newBoundaryStyles = [...ANACRUSIS_OFF_STYLES];\r\n        }\r\n\r\n        log('debug', 'rhythmActions', 'Disabled anacrusis', {\r\n          removalCount,\r\n          removedColumns: removedGroupings.reduce((sum, val) => sum + val, 0)\r\n        }, 'state');\r\n      } else {\r\n        const cache: AnacrusisCache | null | undefined = this._anacrusisCache;\r\n        const anacrusisLength = ANACRUSIS_ON_GROUPINGS.length - ANACRUSIS_OFF_GROUPINGS.length;\r\n        const defaultGroupings = ANACRUSIS_ON_GROUPINGS.slice(0, anacrusisLength);\r\n        const defaultStyles = ANACRUSIS_ON_STYLES.slice(0, anacrusisLength);\r\n\r\n        const groupingsToInsert = cache?.groupings?.length\r\n          ? [...cache.groupings]\r\n          : [...defaultGroupings];\r\n        const stylesToInsert = cache?.boundaryStyles?.length\r\n          ? [...cache.boundaryStyles]\r\n          : [...defaultStyles];\r\n\r\n        newGroupings = [...groupingsToInsert, ...oldGroupings];\r\n        newBoundaryStyles = [...stylesToInsert, ...oldBoundaryStyles];\r\n\r\n        if (!cache?.boundaryStyles?.length) {\r\n          for (let i = 0; i < stylesToInsert.length; i++) {\r\n            newBoundaryStyles[i] = i < stylesToInsert.length - 1 ? 'anacrusis' : 'solid';\r\n          }\r\n        }\r\n\r\n        this._anacrusisCache = null;\r\n\r\n        log('debug', 'rhythmActions', 'Enabled anacrusis', {\r\n          insertedCount: groupingsToInsert.length,\r\n          insertedColumns: groupingsToInsert.reduce((sum, val) => sum + val, 0)\r\n        }, 'state');\r\n      }\r\n\r\n      const newTotalBeats = newGroupings.reduce((sum, val) => sum + val, 0);\r\n      const timeShift = newTotalBeats - oldTotalBeats;\r\n\r\n      this.state.hasAnacrusis = enabled;\r\n      this.state.macrobeatGroupings = [...newGroupings];\r\n      this.state.macrobeatBoundaryStyles = [...newBoundaryStyles];\r\n      recomputeTonicColumns(this.state, getColumnMap);\r\n\r\n      if (timeShift !== 0) {\r\n        const notesToRemove: PlacedNote[] = [];\r\n\r\n        this.state.placedNotes.forEach(note => {\r\n          const startTime = visualToTimeIndex(this.state, note.startColumnIndex, oldGroupings);\r\n          const endTime = visualToTimeIndex(this.state, note.endColumnIndex, oldGroupings);\r\n\r\n          if (startTime === null || endTime === null) {\r\n            return;\r\n          }\r\n\r\n          const newStartTime = startTime + timeShift;\r\n          const newEndTime = endTime + timeShift;\r\n\r\n          if (newStartTime < 0) {\r\n            notesToRemove.push(note);\r\n            return;\r\n          }\r\n\r\n          const newStartColumn = timeIndexToVisualColumn(this.state, newStartTime, newGroupings);\r\n          const newEndColumn = timeIndexToVisualColumn(this.state, newEndTime, newGroupings);\r\n\r\n          if (newStartColumn === null || newEndColumn === null) {\r\n            notesToRemove.push(note);\r\n            return;\r\n          }\r\n\r\n          note.startColumnIndex = newStartColumn as CanvasSpaceColumn;\r\n          note.endColumnIndex = newEndColumn as CanvasSpaceColumn;\r\n        });\r\n\r\n        notesToRemove.forEach(noteToRemove => {\r\n          const index = this.state.placedNotes.indexOf(noteToRemove);\r\n          if (index > -1) {\r\n            this.state.placedNotes.splice(index, 1);\r\n          }\r\n        });\r\n\r\n        const stampsToRemove: SixteenthStampPlacement[] = [];\r\n\r\n        this.state.sixteenthStampPlacements.forEach(stamp => {\r\n          const startTime = visualToTimeIndex(this.state, stamp.startColumn, oldGroupings);\r\n          const endTime = visualToTimeIndex(this.state, stamp.endColumn, oldGroupings);\r\n\r\n          if (startTime === null || endTime === null) {\r\n            return;\r\n          }\r\n\r\n          const newStartTime = startTime + timeShift;\r\n          const newEndTime = endTime + timeShift;\r\n\r\n          if (newStartTime < 0) {\r\n            stampsToRemove.push(stamp);\r\n            return;\r\n          }\r\n\r\n          const newStartColumn = timeIndexToVisualColumn(this.state, newStartTime, newGroupings);\r\n          const newEndColumn = timeIndexToVisualColumn(this.state, newEndTime, newGroupings);\r\n\r\n          if (newStartColumn === null || newEndColumn === null) {\r\n            stampsToRemove.push(stamp);\r\n            return;\r\n          }\r\n\r\n          stamp.startColumn = newStartColumn as CanvasSpaceColumn;\r\n          stamp.endColumn = newEndColumn as CanvasSpaceColumn;\r\n        });\r\n\r\n        stampsToRemove.forEach(stampToRemove => {\r\n          const index = this.state.sixteenthStampPlacements.indexOf(stampToRemove);\r\n          if (index > -1) {\r\n            this.state.sixteenthStampPlacements.splice(index, 1);\r\n          }\r\n        });\r\n\r\n        const tripletsToRemove: TripletStampPlacement[] = [];\r\n\r\n        if (this.state.tripletStampPlacements) {\r\n          this.state.tripletStampPlacements.forEach(triplet => {\r\n            const newStartTime = triplet.startTimeIndex + timeShift;\r\n            if (newStartTime < 0) {\r\n              tripletsToRemove.push(triplet);\r\n            } else {\r\n              triplet.startTimeIndex = newStartTime;\r\n            }\r\n          });\r\n\r\n          tripletsToRemove.forEach(tripletToRemove => {\r\n            const index = this.state.tripletStampPlacements.indexOf(tripletToRemove);\r\n            if (index > -1) {\r\n              this.state.tripletStampPlacements.splice(index, 1);\r\n            }\r\n          });\r\n        }\r\n\r\n        // Update modulation markers to reflect the new grid layout\r\n        const markersToRemove: ModulationMarker[] = [];\r\n        const anacrusisShift = enabled\r\n          ? (newGroupings.length - oldGroupings.length)\r\n          : -(oldGroupings.length - newGroupings.length);\r\n\r\n        this.state.tempoModulationMarkers.forEach(marker => {\r\n          const newMeasureIndex = marker.measureIndex + anacrusisShift;\r\n\r\n          if (newMeasureIndex < 0) {\r\n            markersToRemove.push(marker);\r\n            return;\r\n          }\r\n\r\n          marker.measureIndex = newMeasureIndex;\r\n          marker.columnIndex = null;\r\n          marker.xPosition = null;\r\n          marker.macrobeatIndex = null;\r\n        });\r\n\r\n        markersToRemove.forEach(markerToRemove => {\r\n          const index = this.state.tempoModulationMarkers.indexOf(markerToRemove);\r\n          if (index > -1) {\r\n            this.state.tempoModulationMarkers.splice(index, 1);\r\n          }\r\n        });\r\n      }\r\n\r\n      this.emit('anacrusisChanged', enabled);\r\n      this.emit('notesChanged');\r\n      this.emit('sixteenthStampPlacementsChanged');\r\n      this.emit('tripletStampPlacementsChanged');\r\n      this.emit('tempoModulationMarkersChanged');\r\n      this.emit('rhythmStructureChanged');\r\n      this.recordState();\r\n    },\r\n\r\n    toggleMacrobeatGrouping(this: Store, index: number): void {\r\n      if (index === undefined || index < 0 || index >= this.state.macrobeatGroupings.length) {\r\n        log('error', 'rhythmActions', `Invalid index for toggleMacrobeatGrouping: ${index}`, null, 'state');\r\n        return;\r\n      }\r\n\r\n      const oldGroupings = [...this.state.macrobeatGroupings];\r\n      const currentValue = oldGroupings[index]!;\r\n      const newValue = currentValue === 2 ? 3 : 2;\r\n      const delta = newValue - currentValue;\r\n\r\n      const newGroupings = [...oldGroupings];\r\n      newGroupings[index] = newValue;\r\n\r\n      const boundaryTime = getTimeBoundaryAfterMacrobeat(this.state, index, oldGroupings);\r\n\r\n      const notesToRemove: PlacedNote[] = [];\r\n\r\n      this.state.placedNotes.forEach(note => {\r\n        const startTime = visualToTimeIndex(this.state, note.startColumnIndex, oldGroupings);\r\n        const endTime = visualToTimeIndex(this.state, note.endColumnIndex, oldGroupings);\r\n\r\n        if (startTime === null || endTime === null) {\r\n          return;\r\n        }\r\n\r\n        if (startTime >= boundaryTime) {\r\n          const newStartTime = startTime + delta;\r\n          const newEndTime = endTime + delta;\r\n          const newStartCol = timeIndexToVisualColumn(this.state, newStartTime, newGroupings);\r\n          const newEndCol = timeIndexToVisualColumn(this.state, newEndTime, newGroupings);\r\n          if (newStartCol !== null && newEndCol !== null) {\r\n            note.startColumnIndex = newStartCol as CanvasSpaceColumn;\r\n            note.endColumnIndex = newEndCol as CanvasSpaceColumn;\r\n          } else {\r\n            notesToRemove.push(note);\r\n          }\r\n        }\r\n      });\r\n\r\n      if (notesToRemove.length) {\r\n        notesToRemove.forEach(n => {\r\n          const idx = this.state.placedNotes.indexOf(n);\r\n          if (idx > -1) { this.state.placedNotes.splice(idx, 1); }\r\n        });\r\n      }\r\n\r\n      this.state.macrobeatGroupings = newGroupings;\r\n      recomputeTonicColumns(this.state, getColumnMap);\r\n\r\n      this.emit('notesChanged');\r\n      this.emit('rhythmStructureChanged');\r\n\r\n      this.recordState();\r\n    },\r\n\r\n    cycleMacrobeatBoundaryStyle(this: Store, index: number): void {\r\n      if (index === undefined || index < 0 || index >= this.state.macrobeatBoundaryStyles.length) {\r\n        log('error', 'rhythmActions', `Invalid index for cycleMacrobeatBoundaryStyle: ${index}`, null, 'state');\r\n        return;\r\n      }\r\n\r\n      const isInAnacrusis = this._isBoundaryInAnacrusis(index);\r\n\r\n      let styles: BoundaryStyleArray;\r\n      if (isInAnacrusis) {\r\n        styles = ['dashed', 'solid', 'anacrusis'];\r\n      } else {\r\n        styles = ['dashed', 'solid'];\r\n      }\r\n\r\n      const currentStyle = this.state.macrobeatBoundaryStyles[index] ?? 'dashed';\r\n      const currentIndex = styles.indexOf(currentStyle);\r\n\r\n      const nextIndex = currentIndex === -1 ? 0 : (currentIndex + 1) % styles.length;\r\n      const nextStyle = styles[nextIndex] ?? 'dashed';\r\n      this.state.macrobeatBoundaryStyles[index] = nextStyle;\r\n\r\n      this.emit('rhythmStructureChanged');\r\n      this.recordState();\r\n    },\r\n\r\n    _isBoundaryInAnacrusis(this: Store, boundaryIndex: number): boolean {\r\n      if (!this.state.hasAnacrusis) { return false; }\r\n\r\n      for (let i = 0; i <= boundaryIndex; i++) {\r\n        if (this.state.macrobeatBoundaryStyles[i] === 'solid') {\r\n          return i === boundaryIndex;\r\n        }\r\n      }\r\n      return true;\r\n    },\r\n\r\n    increaseMacrobeatCount(this: Store): void {\r\n      this.state.macrobeatGroupings.push(2);\r\n      this.state.macrobeatBoundaryStyles.push('dashed');\r\n      this.emit('rhythmStructureChanged');\r\n      this.recordState();\r\n    },\r\n\r\n    decreaseMacrobeatCount(this: Store): void {\r\n      if (this.state.macrobeatGroupings.length > 1) {\r\n        const lastMacrobeatIndex = this.state.macrobeatGroupings.length - 1;\r\n        const boundaryTime = getTimeBoundaryAfterMacrobeat(\r\n          this.state,\r\n          lastMacrobeatIndex - 1,\r\n          this.state.macrobeatGroupings\r\n        );\r\n\r\n        const notesToRemove: PlacedNote[] = [];\r\n        this.state.placedNotes.forEach(note => {\r\n          const startTime = visualToTimeIndex(this.state, note.startColumnIndex, this.state.macrobeatGroupings);\r\n          if (startTime !== null && startTime >= boundaryTime) {\r\n            notesToRemove.push(note);\r\n          }\r\n        });\r\n\r\n        notesToRemove.forEach(note => {\r\n          const idx = this.state.placedNotes.indexOf(note);\r\n          if (idx > -1) {\r\n            this.state.placedNotes.splice(idx, 1);\r\n          }\r\n        });\r\n\r\n        const stampsToRemove: SixteenthStampPlacement[] = [];\r\n        this.state.sixteenthStampPlacements.forEach(stamp => {\r\n          const startTime = visualToTimeIndex(this.state, stamp.startColumn, this.state.macrobeatGroupings);\r\n          if (startTime !== null && startTime >= boundaryTime) {\r\n            stampsToRemove.push(stamp);\r\n          }\r\n        });\r\n\r\n        stampsToRemove.forEach(stamp => {\r\n          const idx = this.state.sixteenthStampPlacements.indexOf(stamp);\r\n          if (idx > -1) {\r\n            this.state.sixteenthStampPlacements.splice(idx, 1);\r\n          }\r\n        });\r\n\r\n        const tripletsToRemove: TripletStampPlacement[] = [];\r\n        if (this.state.tripletStampPlacements) {\r\n          this.state.tripletStampPlacements.forEach(triplet => {\r\n            if (triplet.startTimeIndex >= boundaryTime) {\r\n              tripletsToRemove.push(triplet);\r\n            }\r\n          });\r\n\r\n          tripletsToRemove.forEach(triplet => {\r\n            const idx = this.state.tripletStampPlacements.indexOf(triplet);\r\n            if (idx > -1) {\r\n              this.state.tripletStampPlacements.splice(idx, 1);\r\n            }\r\n          });\r\n        }\r\n\r\n        this.state.macrobeatGroupings.pop();\r\n        this.state.macrobeatBoundaryStyles.pop();\r\n\r\n        if (notesToRemove.length > 0) {\r\n          this.emit('notesChanged');\r\n        }\r\n        if (stampsToRemove.length > 0) {\r\n          this.emit('sixteenthStampPlacementsChanged');\r\n        }\r\n        if (tripletsToRemove.length > 0) {\r\n          this.emit('tripletStampPlacementsChanged');\r\n        }\r\n        this.emit('rhythmStructureChanged');\r\n        this.recordState();\r\n      }\r\n    },\r\n\r\n    updateTimeSignature(this: Store, measureIndex: number, newGroupings: GroupingArray): void {\r\n      if (!Array.isArray(newGroupings) || newGroupings.length === 0) {\r\n        log('error', 'rhythmActions', 'Invalid groupings provided to updateTimeSignature', null, 'state');\r\n        return;\r\n      }\r\n\r\n      let measureStartIndex = 0;\r\n      let measureEndIndex = 0;\r\n      let currentMeasure = 0;\r\n\r\n      for (let i = 0; i < this.state.macrobeatGroupings.length; i++) {\r\n        if (currentMeasure === measureIndex) {\r\n          measureStartIndex = i;\r\n          break;\r\n        }\r\n\r\n        const isLastBeat = (i === this.state.macrobeatGroupings.length - 1);\r\n        const boundaryStyle = this.state.macrobeatBoundaryStyles[i];\r\n        const isSolidBoundary = (boundaryStyle === 'solid');\r\n\r\n        if (isSolidBoundary || isLastBeat) {\r\n          currentMeasure++;\r\n        }\r\n      }\r\n\r\n      currentMeasure = 0;\r\n      for (let i = 0; i < this.state.macrobeatGroupings.length; i++) {\r\n        if (currentMeasure === measureIndex) {\r\n          const isLastBeat = (i === this.state.macrobeatGroupings.length - 1);\r\n          const boundaryStyle = this.state.macrobeatBoundaryStyles[i];\r\n          const isSolidBoundary = (boundaryStyle === 'solid');\r\n\r\n          if (isSolidBoundary || isLastBeat) {\r\n            measureEndIndex = i;\r\n            break;\r\n          }\r\n        } else if (currentMeasure < measureIndex) {\r\n          const isLastBeat = (i === this.state.macrobeatGroupings.length - 1);\r\n          const boundaryStyle = this.state.macrobeatBoundaryStyles[i];\r\n          const isSolidBoundary = (boundaryStyle === 'solid');\r\n\r\n          if (isSolidBoundary || isLastBeat) {\r\n            currentMeasure++;\r\n          }\r\n        }\r\n      }\r\n\r\n      const oldLength = measureEndIndex - measureStartIndex + 1;\r\n      const newLength = newGroupings.length;\r\n      const oldTimeSpan = this.state.macrobeatGroupings.slice(measureStartIndex, measureEndIndex + 1)\r\n        .reduce((sum, val) => sum + val, 0);\r\n      const newTimeSpan = newGroupings.reduce((sum, val) => sum + val, 0);\r\n      const timeShift = newTimeSpan - oldTimeSpan;\r\n\r\n      const boundaryTime = getTimeBoundaryAfterMacrobeat(this.state, measureEndIndex, this.state.macrobeatGroupings);\r\n\r\n      if (timeShift !== 0) {\r\n        const nextMacrobeatGroupings = (() => {\r\n          const tmp: GroupingArray = [...this.state.macrobeatGroupings];\r\n          tmp.splice(measureStartIndex, oldLength, ...newGroupings);\r\n          return tmp;\r\n        })();\r\n\r\n        const notesToRemove: PlacedNote[] = [];\r\n\r\n        this.state.placedNotes.forEach(note => {\r\n          const startTime = visualToTimeIndex(this.state, note.startColumnIndex, this.state.macrobeatGroupings);\r\n          const endTime = visualToTimeIndex(this.state, note.endColumnIndex, this.state.macrobeatGroupings);\r\n\r\n          if (startTime === null || endTime === null) {\r\n            return;\r\n          }\r\n\r\n          if (startTime >= boundaryTime) {\r\n            const newStartTime = startTime + timeShift;\r\n            const newEndTime = endTime + timeShift;\r\n            const newStartCol = timeIndexToVisualColumn(this.state, newStartTime, nextMacrobeatGroupings);\r\n            const newEndCol = timeIndexToVisualColumn(this.state, newEndTime, nextMacrobeatGroupings);\r\n\r\n            if (newStartCol !== null && newEndCol !== null) {\r\n              note.startColumnIndex = newStartCol as CanvasSpaceColumn;\r\n              note.endColumnIndex = newEndCol as CanvasSpaceColumn;\r\n            } else {\r\n              notesToRemove.push(note);\r\n            }\r\n          }\r\n        });\r\n\r\n        if (notesToRemove.length) {\r\n          notesToRemove.forEach(n => {\r\n            const idx = this.state.placedNotes.indexOf(n);\r\n            if (idx > -1) { this.state.placedNotes.splice(idx, 1); }\r\n          });\r\n        }\r\n      }\r\n\r\n      const newGroupingsCopy = [...newGroupings];\r\n      const newStylesArray = new Array<MacrobeatBoundaryStyle>(Math.max(newLength - 1, 0)).fill('dashed');\r\n\r\n      if (measureEndIndex < this.state.macrobeatBoundaryStyles.length) {\r\n        const originalFinalStyle = this.state.macrobeatBoundaryStyles[measureEndIndex] ?? 'dashed';\r\n        newStylesArray.push(originalFinalStyle);\r\n      }\r\n\r\n      this.state.macrobeatGroupings.splice(measureStartIndex, oldLength, ...newGroupingsCopy);\r\n      this.state.macrobeatBoundaryStyles.splice(measureStartIndex, oldLength - 1, ...newStylesArray);\r\n\r\n      this.emit('notesChanged');\r\n      this.emit('rhythmStructureChanged');\r\n      this.recordState();\r\n    },\r\n\r\n    addModulationMarker(\r\n      this: Store,\r\n      measureIndex: number,\r\n      ratio: ModulationRatio,\r\n      xPosition: number | null = null,\r\n      columnIndex: CanvasSpaceColumn | null = null,\r\n      macrobeatIndex: number | null = null\r\n    ): string | null {\r\n      if (!Object.values(MODULATION_RATIOS).includes(ratio)) {\r\n        log('error', 'rhythmActions', `Invalid modulation ratio: ${ratio}`, null, 'state');\r\n        return null;\r\n      }\r\n\r\n      const existingMarkerIndex = this.state.tempoModulationMarkers.findIndex((marker: ModulationMarker) => {\r\n        if (marker.measureIndex === measureIndex) {\r\n          return true;\r\n        }\r\n\r\n        if (macrobeatIndex !== null && marker.macrobeatIndex === macrobeatIndex) {\r\n          return true;\r\n        }\r\n\r\n        if (columnIndex !== null && marker.columnIndex === columnIndex) {\r\n          return true;\r\n        }\r\n\r\n        return false;\r\n      });\r\n\r\n      if (existingMarkerIndex !== -1) {\r\n        const existingMarker = this.state.tempoModulationMarkers[existingMarkerIndex]!;\r\n        log('info', 'rhythmActions', `Replacing existing modulation marker ${existingMarker.id} at measure ${measureIndex} (old ratio: ${existingMarker.ratio}, new ratio: ${ratio})`, null, 'state');\r\n\r\n        existingMarker.ratio = ratio;\r\n        existingMarker.xPosition = xPosition;\r\n        if (columnIndex !== null) { existingMarker.columnIndex = columnIndex; }\r\n        if (macrobeatIndex !== null) { existingMarker.macrobeatIndex = macrobeatIndex; }\r\n\r\n        this.emit('tempoModulationMarkersChanged');\r\n        this.recordState();\r\n\r\n        return existingMarker.id;\r\n      }\r\n\r\n      const marker = createModulationMarker(measureIndex, ratio, xPosition, columnIndex, macrobeatIndex);\r\n      this.state.tempoModulationMarkers.push(marker);\r\n\r\n      this.state.tempoModulationMarkers.sort((a, b) => a.measureIndex - b.measureIndex);\r\n\r\n      this.emit('tempoModulationMarkersChanged');\r\n      this.recordState();\r\n\r\n      log('info', 'rhythmActions', `Added modulation marker ${marker.id} at measure ${measureIndex} with ratio=${ratio}, columnIndex=${columnIndex}`, null, 'state');\r\n      return marker.id;\r\n    },\r\n\r\n    removeModulationMarker(this: Store, markerId: string): void {\r\n      const index = this.state.tempoModulationMarkers.findIndex(m => m.id === markerId);\r\n      if (index === -1) {\r\n        log('warn', 'rhythmActions', `Modulation marker not found: ${markerId}`, null, 'state');\r\n        return;\r\n      }\r\n\r\n      this.state.tempoModulationMarkers.splice(index, 1);\r\n      this.emit('tempoModulationMarkersChanged');\r\n      this.recordState();\r\n\r\n      log('info', 'rhythmActions', `Removed modulation marker ${markerId}`, null, 'state');\r\n    },\r\n\r\n    setModulationRatio(this: Store, markerId: string, ratio: ModulationRatio): void {\r\n      if (!Object.values(MODULATION_RATIOS).includes(ratio)) {\r\n        log('error', 'rhythmActions', `Invalid modulation ratio: ${ratio}`, null, 'state');\r\n        return;\r\n      }\r\n\r\n      const marker = this.state.tempoModulationMarkers.find(m => m.id === markerId);\r\n      if (!marker) {\r\n        log('warn', 'rhythmActions', `Modulation marker not found: ${markerId}`, null, 'state');\r\n        return;\r\n      }\r\n\r\n      marker.ratio = ratio;\r\n      this.emit('tempoModulationMarkersChanged');\r\n      this.recordState();\r\n\r\n      log('info', 'rhythmActions', `Updated modulation marker ${markerId} ratio to ${ratio}`, null, 'state');\r\n    },\r\n\r\n    moveModulationMarker(this: Store, markerId: string, measureIndex: number): void {\r\n      const marker = this.state.tempoModulationMarkers.find(m => m.id === markerId);\r\n      if (!marker) {\r\n        log('warn', 'rhythmActions', `Modulation marker not found: ${markerId}`, null, 'state');\r\n        return;\r\n      }\r\n\r\n      marker.measureIndex = measureIndex;\r\n\r\n      this.state.tempoModulationMarkers.sort((a, b) => a.measureIndex - b.measureIndex);\r\n\r\n      this.emit('tempoModulationMarkersChanged');\r\n      this.recordState();\r\n\r\n      log('info', 'rhythmActions', `Moved modulation marker ${markerId} to measure ${measureIndex}`, null, 'state');\r\n    },\r\n\r\n    toggleModulationMarker(this: Store, markerId: string): void {\r\n      const marker = this.state.tempoModulationMarkers.find(m => m.id === markerId);\r\n      if (!marker) {\r\n        log('warn', 'rhythmActions', `Modulation marker not found: ${markerId}`, null, 'state');\r\n        return;\r\n      }\r\n\r\n      marker.active = !marker.active;\r\n      this.emit('tempoModulationMarkersChanged');\r\n      this.recordState();\r\n\r\n      log('info', 'rhythmActions', `Toggled modulation marker ${markerId} active state to ${marker.active}`, null, 'state');\r\n    },\r\n\r\n    clearModulationMarkers(this: Store): void {\r\n      const removedCount = this.state.tempoModulationMarkers.length;\r\n      this.state.tempoModulationMarkers = [];\r\n      this.emit('tempoModulationMarkersChanged');\r\n      this.recordState();\r\n\r\n      log('info', 'rhythmActions', `Cleared ${removedCount} modulation markers`, null, 'state');\r\n    }\r\n  };\r\n}\r\n","export const version = \"15.1.22\";\n//# sourceMappingURL=version.js.map","export const createExtendedExponentialRampToValueAutomationEvent = (value, endTime, insertTime) => {\n    return { endTime, insertTime, type: 'exponentialRampToValue', value };\n};\n//# sourceMappingURL=create-extended-exponential-ramp-to-value-automation-event.js.map","export const createExtendedLinearRampToValueAutomationEvent = (value, endTime, insertTime) => {\n    return { endTime, insertTime, type: 'linearRampToValue', value };\n};\n//# sourceMappingURL=create-extended-linear-ramp-to-value-automation-event.js.map","export const createSetValueAutomationEvent = (value, startTime) => {\n    return { startTime, type: 'setValue', value };\n};\n//# sourceMappingURL=create-set-value-automation-event.js.map","export const createSetValueCurveAutomationEvent = (values, startTime, duration) => {\n    return { duration, startTime, type: 'setValueCurve', values };\n};\n//# sourceMappingURL=create-set-value-curve-automation-event.js.map","export const getTargetValueAtTime = (time, valueAtStartTime, { startTime, target, timeConstant }) => {\n    return target + (valueAtStartTime - target) * Math.exp((startTime - time) / timeConstant);\n};\n//# sourceMappingURL=get-target-value-at-time.js.map","export const isExponentialRampToValueAutomationEvent = (automationEvent) => {\n    return automationEvent.type === 'exponentialRampToValue';\n};\n//# sourceMappingURL=exponential-ramp-to-value-automation-event.js.map","export const isLinearRampToValueAutomationEvent = (automationEvent) => {\n    return automationEvent.type === 'linearRampToValue';\n};\n//# sourceMappingURL=linear-ramp-to-value-automation-event.js.map","import { isExponentialRampToValueAutomationEvent } from './exponential-ramp-to-value-automation-event';\nimport { isLinearRampToValueAutomationEvent } from './linear-ramp-to-value-automation-event';\nexport const isAnyRampToValueAutomationEvent = (automationEvent) => {\n    return isExponentialRampToValueAutomationEvent(automationEvent) || isLinearRampToValueAutomationEvent(automationEvent);\n};\n//# sourceMappingURL=any-ramp-to-value-automation-event.js.map","export const isSetValueAutomationEvent = (automationEvent) => {\n    return automationEvent.type === 'setValue';\n};\n//# sourceMappingURL=set-value-automation-event.js.map","export const isSetValueCurveAutomationEvent = (automationEvent) => {\n    return automationEvent.type === 'setValueCurve';\n};\n//# sourceMappingURL=set-value-curve-automation-event.js.map","import { getTargetValueAtTime } from '../functions/get-target-value-at-time';\nimport { isAnyRampToValueAutomationEvent } from '../guards/any-ramp-to-value-automation-event';\nimport { isSetValueAutomationEvent } from '../guards/set-value-automation-event';\nimport { isSetValueCurveAutomationEvent } from '../guards/set-value-curve-automation-event';\nexport const getValueOfAutomationEventAtIndexAtTime = (automationEvents, index, time, defaultValue) => {\n    const automationEvent = automationEvents[index];\n    return automationEvent === undefined\n        ? defaultValue\n        : isAnyRampToValueAutomationEvent(automationEvent) || isSetValueAutomationEvent(automationEvent)\n            ? automationEvent.value\n            : isSetValueCurveAutomationEvent(automationEvent)\n                ? automationEvent.values[automationEvent.values.length - 1]\n                : getTargetValueAtTime(time, getValueOfAutomationEventAtIndexAtTime(automationEvents, index - 1, automationEvent.startTime, defaultValue), automationEvent);\n};\n//# sourceMappingURL=get-value-of-automation-event-at-index-at-time.js.map","import { getValueOfAutomationEventAtIndexAtTime } from '../functions/get-value-of-automation-event-at-index-at-time';\nimport { isAnyRampToValueAutomationEvent } from '../guards/any-ramp-to-value-automation-event';\nimport { isSetValueAutomationEvent } from '../guards/set-value-automation-event';\nimport { isSetValueCurveAutomationEvent } from '../guards/set-value-curve-automation-event';\nexport const getEndTimeAndValueOfPreviousAutomationEvent = (automationEvents, index, currentAutomationEvent, nextAutomationEvent, defaultValue) => {\n    return currentAutomationEvent === undefined\n        ? [nextAutomationEvent.insertTime, defaultValue]\n        : isAnyRampToValueAutomationEvent(currentAutomationEvent)\n            ? [currentAutomationEvent.endTime, currentAutomationEvent.value]\n            : isSetValueAutomationEvent(currentAutomationEvent)\n                ? [currentAutomationEvent.startTime, currentAutomationEvent.value]\n                : isSetValueCurveAutomationEvent(currentAutomationEvent)\n                    ? [\n                        currentAutomationEvent.startTime + currentAutomationEvent.duration,\n                        currentAutomationEvent.values[currentAutomationEvent.values.length - 1]\n                    ]\n                    : [\n                        currentAutomationEvent.startTime,\n                        getValueOfAutomationEventAtIndexAtTime(automationEvents, index - 1, currentAutomationEvent.startTime, defaultValue)\n                    ];\n};\n//# sourceMappingURL=get-end-time-and-value-of-previous-automation-event.js.map","export const isCancelAndHoldAutomationEvent = (automationEvent) => {\n    return automationEvent.type === 'cancelAndHold';\n};\n//# sourceMappingURL=cancel-and-hold-automation-event.js.map","export const isCancelScheduledValuesAutomationEvent = (automationEvent) => {\n    return automationEvent.type === 'cancelScheduledValues';\n};\n//# sourceMappingURL=cancel-scheduled-values-automation-event.js.map","import { isCancelAndHoldAutomationEvent } from '../guards/cancel-and-hold-automation-event';\nimport { isCancelScheduledValuesAutomationEvent } from '../guards/cancel-scheduled-values-automation-event';\nimport { isExponentialRampToValueAutomationEvent } from '../guards/exponential-ramp-to-value-automation-event';\nimport { isLinearRampToValueAutomationEvent } from '../guards/linear-ramp-to-value-automation-event';\nexport const getEventTime = (automationEvent) => {\n    if (isCancelAndHoldAutomationEvent(automationEvent) || isCancelScheduledValuesAutomationEvent(automationEvent)) {\n        return automationEvent.cancelTime;\n    }\n    if (isExponentialRampToValueAutomationEvent(automationEvent) || isLinearRampToValueAutomationEvent(automationEvent)) {\n        return automationEvent.endTime;\n    }\n    return automationEvent.startTime;\n};\n//# sourceMappingURL=get-event-time.js.map","export const getExponentialRampValueAtTime = (time, startTime, valueAtStartTime, { endTime, value }) => {\n    if (valueAtStartTime === value) {\n        return value;\n    }\n    if ((0 < valueAtStartTime && 0 < value) || (valueAtStartTime < 0 && value < 0)) {\n        return valueAtStartTime * (value / valueAtStartTime) ** ((time - startTime) / (endTime - startTime));\n    }\n    return 0;\n};\n//# sourceMappingURL=get-exponential-ramp-value-at-time.js.map","export const getLinearRampValueAtTime = (time, startTime, valueAtStartTime, { endTime, value }) => {\n    return valueAtStartTime + ((time - startTime) / (endTime - startTime)) * (value - valueAtStartTime);\n};\n//# sourceMappingURL=get-linear-ramp-value-at-time.js.map","export const interpolateValue = (values, theoreticIndex) => {\n    const lowerIndex = Math.floor(theoreticIndex);\n    const upperIndex = Math.ceil(theoreticIndex);\n    if (lowerIndex === upperIndex) {\n        return values[lowerIndex];\n    }\n    return (1 - (theoreticIndex - lowerIndex)) * values[lowerIndex] + (1 - (upperIndex - theoreticIndex)) * values[upperIndex];\n};\n//# sourceMappingURL=interpolate-value.js.map","import { interpolateValue } from './interpolate-value';\nexport const getValueCurveValueAtTime = (time, { duration, startTime, values }) => {\n    const theoreticIndex = ((time - startTime) / duration) * (values.length - 1);\n    return interpolateValue(values, theoreticIndex);\n};\n//# sourceMappingURL=get-value-curve-value-at-time.js.map","export const isSetTargetAutomationEvent = (automationEvent) => {\n    return automationEvent.type === 'setTarget';\n};\n//# sourceMappingURL=set-target-automation-event.js.map","import { createExtendedExponentialRampToValueAutomationEvent } from '../functions/create-extended-exponential-ramp-to-value-automation-event';\nimport { createExtendedLinearRampToValueAutomationEvent } from '../functions/create-extended-linear-ramp-to-value-automation-event';\nimport { createSetValueAutomationEvent } from '../functions/create-set-value-automation-event';\nimport { createSetValueCurveAutomationEvent } from '../functions/create-set-value-curve-automation-event';\nimport { getEndTimeAndValueOfPreviousAutomationEvent } from '../functions/get-end-time-and-value-of-previous-automation-event';\nimport { getEventTime } from '../functions/get-event-time';\nimport { getExponentialRampValueAtTime } from '../functions/get-exponential-ramp-value-at-time';\nimport { getLinearRampValueAtTime } from '../functions/get-linear-ramp-value-at-time';\nimport { getTargetValueAtTime } from '../functions/get-target-value-at-time';\nimport { getValueCurveValueAtTime } from '../functions/get-value-curve-value-at-time';\nimport { getValueOfAutomationEventAtIndexAtTime } from '../functions/get-value-of-automation-event-at-index-at-time';\nimport { isAnyRampToValueAutomationEvent } from '../guards/any-ramp-to-value-automation-event';\nimport { isCancelAndHoldAutomationEvent } from '../guards/cancel-and-hold-automation-event';\nimport { isCancelScheduledValuesAutomationEvent } from '../guards/cancel-scheduled-values-automation-event';\nimport { isExponentialRampToValueAutomationEvent } from '../guards/exponential-ramp-to-value-automation-event';\nimport { isLinearRampToValueAutomationEvent } from '../guards/linear-ramp-to-value-automation-event';\nimport { isSetTargetAutomationEvent } from '../guards/set-target-automation-event';\nimport { isSetValueAutomationEvent } from '../guards/set-value-automation-event';\nimport { isSetValueCurveAutomationEvent } from '../guards/set-value-curve-automation-event';\nexport class AutomationEventList {\n    constructor(defaultValue) {\n        this._automationEvents = [];\n        this._currenTime = 0;\n        this._defaultValue = defaultValue;\n    }\n    [Symbol.iterator]() {\n        return this._automationEvents[Symbol.iterator]();\n    }\n    add(automationEvent) {\n        const eventTime = getEventTime(automationEvent);\n        if (isCancelAndHoldAutomationEvent(automationEvent) || isCancelScheduledValuesAutomationEvent(automationEvent)) {\n            const index = this._automationEvents.findIndex((currentAutomationEvent) => {\n                if (isCancelScheduledValuesAutomationEvent(automationEvent) && isSetValueCurveAutomationEvent(currentAutomationEvent)) {\n                    return currentAutomationEvent.startTime + currentAutomationEvent.duration >= eventTime;\n                }\n                return getEventTime(currentAutomationEvent) >= eventTime;\n            });\n            const removedAutomationEvent = this._automationEvents[index];\n            if (index !== -1) {\n                this._automationEvents = this._automationEvents.slice(0, index);\n            }\n            if (isCancelAndHoldAutomationEvent(automationEvent)) {\n                const lastAutomationEvent = this._automationEvents[this._automationEvents.length - 1];\n                if (removedAutomationEvent !== undefined && isAnyRampToValueAutomationEvent(removedAutomationEvent)) {\n                    if (lastAutomationEvent !== undefined && isSetTargetAutomationEvent(lastAutomationEvent)) {\n                        throw new Error('The internal list is malformed.');\n                    }\n                    const startTime = lastAutomationEvent === undefined\n                        ? removedAutomationEvent.insertTime\n                        : isSetValueCurveAutomationEvent(lastAutomationEvent)\n                            ? lastAutomationEvent.startTime + lastAutomationEvent.duration\n                            : getEventTime(lastAutomationEvent);\n                    const startValue = lastAutomationEvent === undefined\n                        ? this._defaultValue\n                        : isSetValueCurveAutomationEvent(lastAutomationEvent)\n                            ? lastAutomationEvent.values[lastAutomationEvent.values.length - 1]\n                            : lastAutomationEvent.value;\n                    const value = isExponentialRampToValueAutomationEvent(removedAutomationEvent)\n                        ? getExponentialRampValueAtTime(eventTime, startTime, startValue, removedAutomationEvent)\n                        : getLinearRampValueAtTime(eventTime, startTime, startValue, removedAutomationEvent);\n                    const truncatedAutomationEvent = isExponentialRampToValueAutomationEvent(removedAutomationEvent)\n                        ? createExtendedExponentialRampToValueAutomationEvent(value, eventTime, this._currenTime)\n                        : createExtendedLinearRampToValueAutomationEvent(value, eventTime, this._currenTime);\n                    this._automationEvents.push(truncatedAutomationEvent);\n                }\n                if (lastAutomationEvent !== undefined && isSetTargetAutomationEvent(lastAutomationEvent)) {\n                    this._automationEvents.push(createSetValueAutomationEvent(this.getValue(eventTime), eventTime));\n                }\n                if (lastAutomationEvent !== undefined &&\n                    isSetValueCurveAutomationEvent(lastAutomationEvent) &&\n                    lastAutomationEvent.startTime + lastAutomationEvent.duration > eventTime) {\n                    const duration = eventTime - lastAutomationEvent.startTime;\n                    const ratio = (lastAutomationEvent.values.length - 1) / lastAutomationEvent.duration;\n                    const length = Math.max(2, 1 + Math.ceil(duration * ratio));\n                    const fraction = (duration / (length - 1)) * ratio;\n                    const values = lastAutomationEvent.values.slice(0, length);\n                    if (fraction < 1) {\n                        for (let i = 1; i < length; i += 1) {\n                            const factor = (fraction * i) % 1;\n                            values[i] = lastAutomationEvent.values[i - 1] * (1 - factor) + lastAutomationEvent.values[i] * factor;\n                        }\n                    }\n                    this._automationEvents[this._automationEvents.length - 1] = createSetValueCurveAutomationEvent(values, lastAutomationEvent.startTime, duration);\n                }\n            }\n        }\n        else {\n            const index = this._automationEvents.findIndex((currentAutomationEvent) => getEventTime(currentAutomationEvent) > eventTime);\n            const previousAutomationEvent = index === -1 ? this._automationEvents[this._automationEvents.length - 1] : this._automationEvents[index - 1];\n            if (previousAutomationEvent !== undefined &&\n                isSetValueCurveAutomationEvent(previousAutomationEvent) &&\n                getEventTime(previousAutomationEvent) + previousAutomationEvent.duration > eventTime) {\n                return false;\n            }\n            const persistentAutomationEvent = isExponentialRampToValueAutomationEvent(automationEvent)\n                ? createExtendedExponentialRampToValueAutomationEvent(automationEvent.value, automationEvent.endTime, this._currenTime)\n                : isLinearRampToValueAutomationEvent(automationEvent)\n                    ? createExtendedLinearRampToValueAutomationEvent(automationEvent.value, eventTime, this._currenTime)\n                    : automationEvent;\n            if (index === -1) {\n                this._automationEvents.push(persistentAutomationEvent);\n            }\n            else {\n                if (isSetValueCurveAutomationEvent(automationEvent) &&\n                    eventTime + automationEvent.duration > getEventTime(this._automationEvents[index])) {\n                    return false;\n                }\n                this._automationEvents.splice(index, 0, persistentAutomationEvent);\n            }\n        }\n        return true;\n    }\n    flush(time) {\n        const index = this._automationEvents.findIndex((currentAutomationEvent) => getEventTime(currentAutomationEvent) > time);\n        if (index > 1) {\n            const remainingAutomationEvents = this._automationEvents.slice(index - 1);\n            const firstRemainingAutomationEvent = remainingAutomationEvents[0];\n            if (isSetTargetAutomationEvent(firstRemainingAutomationEvent)) {\n                remainingAutomationEvents.unshift(createSetValueAutomationEvent(getValueOfAutomationEventAtIndexAtTime(this._automationEvents, index - 2, firstRemainingAutomationEvent.startTime, this._defaultValue), firstRemainingAutomationEvent.startTime));\n            }\n            this._automationEvents = remainingAutomationEvents;\n        }\n    }\n    getValue(time) {\n        if (this._automationEvents.length === 0) {\n            return this._defaultValue;\n        }\n        const indexOfNextEvent = this._automationEvents.findIndex((automationEvent) => getEventTime(automationEvent) > time);\n        const nextAutomationEvent = this._automationEvents[indexOfNextEvent];\n        const indexOfCurrentEvent = (indexOfNextEvent === -1 ? this._automationEvents.length : indexOfNextEvent) - 1;\n        const currentAutomationEvent = this._automationEvents[indexOfCurrentEvent];\n        if (currentAutomationEvent !== undefined &&\n            isSetTargetAutomationEvent(currentAutomationEvent) &&\n            (nextAutomationEvent === undefined ||\n                !isAnyRampToValueAutomationEvent(nextAutomationEvent) ||\n                nextAutomationEvent.insertTime > time)) {\n            return getTargetValueAtTime(time, getValueOfAutomationEventAtIndexAtTime(this._automationEvents, indexOfCurrentEvent - 1, currentAutomationEvent.startTime, this._defaultValue), currentAutomationEvent);\n        }\n        if (currentAutomationEvent !== undefined &&\n            isSetValueAutomationEvent(currentAutomationEvent) &&\n            (nextAutomationEvent === undefined || !isAnyRampToValueAutomationEvent(nextAutomationEvent))) {\n            return currentAutomationEvent.value;\n        }\n        if (currentAutomationEvent !== undefined &&\n            isSetValueCurveAutomationEvent(currentAutomationEvent) &&\n            (nextAutomationEvent === undefined ||\n                !isAnyRampToValueAutomationEvent(nextAutomationEvent) ||\n                currentAutomationEvent.startTime + currentAutomationEvent.duration > time)) {\n            if (time < currentAutomationEvent.startTime + currentAutomationEvent.duration) {\n                return getValueCurveValueAtTime(time, currentAutomationEvent);\n            }\n            return currentAutomationEvent.values[currentAutomationEvent.values.length - 1];\n        }\n        if (currentAutomationEvent !== undefined &&\n            isAnyRampToValueAutomationEvent(currentAutomationEvent) &&\n            (nextAutomationEvent === undefined || !isAnyRampToValueAutomationEvent(nextAutomationEvent))) {\n            return currentAutomationEvent.value;\n        }\n        if (nextAutomationEvent !== undefined && isExponentialRampToValueAutomationEvent(nextAutomationEvent)) {\n            const [startTime, value] = getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents, indexOfCurrentEvent, currentAutomationEvent, nextAutomationEvent, this._defaultValue);\n            return getExponentialRampValueAtTime(time, startTime, value, nextAutomationEvent);\n        }\n        if (nextAutomationEvent !== undefined && isLinearRampToValueAutomationEvent(nextAutomationEvent)) {\n            const [startTime, value] = getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents, indexOfCurrentEvent, currentAutomationEvent, nextAutomationEvent, this._defaultValue);\n            return getLinearRampValueAtTime(time, startTime, value, nextAutomationEvent);\n        }\n        return this._defaultValue;\n    }\n}\n//# sourceMappingURL=automation-event-list.js.map","export const createCancelAndHoldAutomationEvent = (cancelTime) => {\n    return { cancelTime, type: 'cancelAndHold' };\n};\n//# sourceMappingURL=create-cancel-and-hold-automation-event.js.map","export const createCancelScheduledValuesAutomationEvent = (cancelTime) => {\n    return { cancelTime, type: 'cancelScheduledValues' };\n};\n//# sourceMappingURL=create-cancel-scheduled-values-automation-event.js.map","export const createExponentialRampToValueAutomationEvent = (value, endTime) => {\n    return { endTime, type: 'exponentialRampToValue', value };\n};\n//# sourceMappingURL=create-exponential-ramp-to-value-automation-event.js.map","export const createLinearRampToValueAutomationEvent = (value, endTime) => {\n    return { endTime, type: 'linearRampToValue', value };\n};\n//# sourceMappingURL=create-linear-ramp-to-value-automation-event.js.map","export const createSetTargetAutomationEvent = (target, startTime, timeConstant) => {\n    return { startTime, target, timeConstant, type: 'setTarget' };\n};\n//# sourceMappingURL=create-set-target-automation-event.js.map","export const createAbortError = () => new DOMException('', 'AbortError');\n//# sourceMappingURL=abort-error.js.map","export const createAddActiveInputConnectionToAudioNode = (insertElementInSet) => {\n    return (activeInputs, source, [output, input, eventListener], ignoreDuplicates) => {\n        insertElementInSet(activeInputs[input], [source, output, eventListener], (activeInputConnection) => activeInputConnection[0] === source && activeInputConnection[1] === output, ignoreDuplicates);\n    };\n};\n//# sourceMappingURL=add-active-input-connection-to-audio-node.js.map","export const createAddAudioNodeConnections = (audioNodeConnectionsStore) => {\n    return (audioNode, audioNodeRenderer, nativeAudioNode) => {\n        const activeInputs = [];\n        for (let i = 0; i < nativeAudioNode.numberOfInputs; i += 1) {\n            activeInputs.push(new Set());\n        }\n        audioNodeConnectionsStore.set(audioNode, {\n            activeInputs,\n            outputs: new Set(),\n            passiveInputs: new WeakMap(),\n            renderer: audioNodeRenderer\n        });\n    };\n};\n//# sourceMappingURL=add-audio-node-connections.js.map","export const createAddAudioParamConnections = (audioParamConnectionsStore) => {\n    return (audioParam, audioParamRenderer) => {\n        audioParamConnectionsStore.set(audioParam, { activeInputs: new Set(), passiveInputs: new WeakMap(), renderer: audioParamRenderer });\n    };\n};\n//# sourceMappingURL=add-audio-param-connections.js.map","export const ACTIVE_AUDIO_NODE_STORE = new WeakSet();\nexport const AUDIO_NODE_CONNECTIONS_STORE = new WeakMap();\nexport const AUDIO_NODE_STORE = new WeakMap();\nexport const AUDIO_PARAM_CONNECTIONS_STORE = new WeakMap();\nexport const AUDIO_PARAM_STORE = new WeakMap();\nexport const CONTEXT_STORE = new WeakMap();\nexport const EVENT_LISTENERS = new WeakMap();\nexport const CYCLE_COUNTERS = new WeakMap();\n// This clunky name is borrowed from the spec. :-)\nexport const NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS = new WeakMap();\nexport const NODE_TO_PROCESSOR_MAPS = new WeakMap();\n//# sourceMappingURL=globals.js.map","const handler = {\n    construct() {\n        return handler;\n    }\n};\nexport const isConstructible = (constructible) => {\n    try {\n        const proxy = new Proxy(constructible, handler);\n        new proxy(); // tslint:disable-line:no-unused-expression\n    }\n    catch {\n        return false;\n    }\n    return true;\n};\n//# sourceMappingURL=is-constructible.js.map","/*\n * This massive regex tries to cover all the following cases.\n *\n * import './path';\n * import defaultImport from './path';\n * import { namedImport } from './path';\n * import { namedImport as renamendImport } from './path';\n * import * as namespaceImport from './path';\n * import defaultImport, { namedImport } from './path';\n * import defaultImport, { namedImport as renamendImport } from './path';\n * import defaultImport, * as namespaceImport from './path';\n */\nconst IMPORT_STATEMENT_REGEX = /^import(?:(?:[\\s]+[\\w]+|(?:[\\s]+[\\w]+[\\s]*,)?[\\s]*\\{[\\s]*[\\w]+(?:[\\s]+as[\\s]+[\\w]+)?(?:[\\s]*,[\\s]*[\\w]+(?:[\\s]+as[\\s]+[\\w]+)?)*[\\s]*}|(?:[\\s]+[\\w]+[\\s]*,)?[\\s]*\\*[\\s]+as[\\s]+[\\w]+)[\\s]+from)?(?:[\\s]*)(\"([^\"\\\\]|\\\\.)+\"|'([^'\\\\]|\\\\.)+')(?:[\\s]*);?/; // tslint:disable-line:max-line-length\nexport const splitImportStatements = (source, url) => {\n    const importStatements = [];\n    let sourceWithoutImportStatements = source.replace(/^[\\s]+/, '');\n    let result = sourceWithoutImportStatements.match(IMPORT_STATEMENT_REGEX);\n    while (result !== null) {\n        const unresolvedUrl = result[1].slice(1, -1);\n        const importStatementWithResolvedUrl = result[0]\n            .replace(/([\\s]+)?;?$/, '')\n            .replace(unresolvedUrl, new URL(unresolvedUrl, url).toString());\n        importStatements.push(importStatementWithResolvedUrl);\n        sourceWithoutImportStatements = sourceWithoutImportStatements.slice(result[0].length).replace(/^[\\s]+/, '');\n        result = sourceWithoutImportStatements.match(IMPORT_STATEMENT_REGEX);\n    }\n    return [importStatements.join(';'), sourceWithoutImportStatements];\n};\n//# sourceMappingURL=split-import-statements.js.map","import { NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS } from '../globals';\nimport { isConstructible } from '../helpers/is-constructible';\nimport { splitImportStatements } from '../helpers/split-import-statements';\nconst verifyParameterDescriptors = (parameterDescriptors) => {\n    if (parameterDescriptors !== undefined && !Array.isArray(parameterDescriptors)) {\n        throw new TypeError('The parameterDescriptors property of given value for processorCtor is not an array.');\n    }\n};\nconst verifyProcessorCtor = (processorCtor) => {\n    if (!isConstructible(processorCtor)) {\n        throw new TypeError('The given value for processorCtor should be a constructor.');\n    }\n    if (processorCtor.prototype === null || typeof processorCtor.prototype !== 'object') {\n        throw new TypeError('The given value for processorCtor should have a prototype.');\n    }\n};\nexport const createAddAudioWorkletModule = (cacheTestResult, createNotSupportedError, evaluateSource, exposeCurrentFrameAndCurrentTime, fetchSource, getNativeContext, getOrCreateBackupOfflineAudioContext, isNativeOfflineAudioContext, nativeAudioWorkletNodeConstructor, ongoingRequests, resolvedRequests, testAudioWorkletProcessorPostMessageSupport, window) => {\n    let index = 0;\n    return (context, moduleURL, options = { credentials: 'omit' }) => {\n        const resolvedRequestsOfContext = resolvedRequests.get(context);\n        if (resolvedRequestsOfContext !== undefined && resolvedRequestsOfContext.has(moduleURL)) {\n            return Promise.resolve();\n        }\n        const ongoingRequestsOfContext = ongoingRequests.get(context);\n        if (ongoingRequestsOfContext !== undefined) {\n            const promiseOfOngoingRequest = ongoingRequestsOfContext.get(moduleURL);\n            if (promiseOfOngoingRequest !== undefined) {\n                return promiseOfOngoingRequest;\n            }\n        }\n        const nativeContext = getNativeContext(context);\n        // Bug #59: Safari does not implement the audioWorklet property.\n        const promise = nativeContext.audioWorklet === undefined\n            ? fetchSource(moduleURL)\n                .then(([source, absoluteUrl]) => {\n                const [importStatements, sourceWithoutImportStatements] = splitImportStatements(source, absoluteUrl);\n                /*\n                 * This is the unminified version of the code used below:\n                 *\n                 * ```js\n                 * ${ importStatements };\n                 * ((a, b) => {\n                 *     (a[b] = a[b] || [ ]).push(\n                 *         (AudioWorkletProcessor, global, registerProcessor, sampleRate, self, window) => {\n                 *             ${ sourceWithoutImportStatements }\n                 *         }\n                 *     );\n                 * })(window, '_AWGS');\n                 * ```\n                 */\n                // tslint:disable-next-line:max-line-length\n                const wrappedSource = `${importStatements};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${sourceWithoutImportStatements}\n})})(window,'_AWGS')`;\n                // @todo Evaluating the given source code is a possible security problem.\n                return evaluateSource(wrappedSource);\n            })\n                .then(() => {\n                const evaluateAudioWorkletGlobalScope = window._AWGS.pop();\n                if (evaluateAudioWorkletGlobalScope === undefined) {\n                    // Bug #182 Chrome and Edge do throw an instance of a SyntaxError instead of a DOMException.\n                    throw new SyntaxError();\n                }\n                exposeCurrentFrameAndCurrentTime(nativeContext.currentTime, nativeContext.sampleRate, () => evaluateAudioWorkletGlobalScope(class AudioWorkletProcessor {\n                }, undefined, (name, processorCtor) => {\n                    if (name.trim() === '') {\n                        throw createNotSupportedError();\n                    }\n                    const nodeNameToProcessorConstructorMap = NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(nativeContext);\n                    if (nodeNameToProcessorConstructorMap !== undefined) {\n                        if (nodeNameToProcessorConstructorMap.has(name)) {\n                            throw createNotSupportedError();\n                        }\n                        verifyProcessorCtor(processorCtor);\n                        verifyParameterDescriptors(processorCtor.parameterDescriptors);\n                        nodeNameToProcessorConstructorMap.set(name, processorCtor);\n                    }\n                    else {\n                        verifyProcessorCtor(processorCtor);\n                        verifyParameterDescriptors(processorCtor.parameterDescriptors);\n                        NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.set(nativeContext, new Map([[name, processorCtor]]));\n                    }\n                }, nativeContext.sampleRate, undefined, undefined));\n            })\n            : Promise.all([\n                fetchSource(moduleURL),\n                Promise.resolve(cacheTestResult(testAudioWorkletProcessorPostMessageSupport, testAudioWorkletProcessorPostMessageSupport))\n            ]).then(([[source, absoluteUrl], isSupportingPostMessage]) => {\n                const currentIndex = index + 1;\n                index = currentIndex;\n                const [importStatements, sourceWithoutImportStatements] = splitImportStatements(source, absoluteUrl);\n                /*\n                 * Bug #179: Firefox does not allow to transfer any buffer which has been passed to the process() method as an argument.\n                 *\n                 * This is the unminified version of the code used below.\n                 *\n                 * ```js\n                 * class extends AudioWorkletProcessor {\n                 *\n                 *     __buffers = new WeakSet();\n                 *\n                 *     constructor () {\n                 *         super();\n                 *\n                 *         this.port.postMessage = ((postMessage) => {\n                 *             return (message, transferables) => {\n                 *                 const filteredTransferables = (transferables)\n                 *                     ? transferables.filter((transferable) => !this.__buffers.has(transferable))\n                 *                     : transferables;\n                 *\n                 *                 return postMessage.call(this.port, message, filteredTransferables);\n                 *              };\n                 *         })(this.port.postMessage);\n                 *     }\n                 * }\n                 * ```\n                 */\n                const patchedAudioWorkletProcessor = isSupportingPostMessage\n                    ? 'AudioWorkletProcessor'\n                    : 'class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}';\n                /*\n                 * Bug #170: Chrome and Edge do call process() with an array with empty channelData for each input if no input is connected.\n                 *\n                 * Bug #179: Firefox does not allow to transfer any buffer which has been passed to the process() method as an argument.\n                 *\n                 * Bug #190: Safari doesn't throw an error when loading an unparsable module.\n                 *\n                 * This is the unminified version of the code used below:\n                 *\n                 * ```js\n                 * `${ importStatements };\n                 * ((AudioWorkletProcessor, registerProcessor) => {${ sourceWithoutImportStatements }\n                 * })(\n                 *     ${patchedAudioWorkletProcessor },\n                 *     (name, processorCtor) => registerProcessor(name, class extends processorCtor {\n                 *\n                 *         __collectBuffers = (array) => {\n                 *             array.forEach((element) => this.__buffers.add(element.buffer));\n                 *         };\n                 *\n                 *         process (inputs, outputs, parameters) {\n                 *             inputs.forEach(this.__collectBuffers);\n                 *             outputs.forEach(this.__collectBuffers);\n                 *             this.__collectBuffers(Object.values(parameters));\n                 *\n                 *             return super.process(\n                 *                 (inputs.map((input) => input.some((channelData) => channelData.length === 0)) ? [ ] : input),\n                 *                 outputs,\n                 *                 parameters\n                 *             );\n                 *         }\n                 *\n                 *     })\n                 * );\n                 *\n                 * registerProcessor(`__sac${currentIndex}`, class extends AudioWorkletProcessor{\n                 *\n                 *     process () {\n                 *         return false;\n                 *     }\n                 *\n                 * })`\n                 * ```\n                 */\n                const memberDefinition = isSupportingPostMessage ? '' : '__c = (a) => a.forEach(e=>this.__b.add(e.buffer));';\n                const bufferRegistration = isSupportingPostMessage\n                    ? ''\n                    : 'i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));';\n                const wrappedSource = `${importStatements};((AudioWorkletProcessor,registerProcessor)=>{${sourceWithoutImportStatements}\n})(${patchedAudioWorkletProcessor},(n,p)=>registerProcessor(n,class extends p{${memberDefinition}process(i,o,p){${bufferRegistration}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${currentIndex}',class extends AudioWorkletProcessor{process(){return !1}})`;\n                const blob = new Blob([wrappedSource], { type: 'application/javascript; charset=utf-8' });\n                const url = URL.createObjectURL(blob);\n                return nativeContext.audioWorklet\n                    .addModule(url, options)\n                    .then(() => {\n                    if (isNativeOfflineAudioContext(nativeContext)) {\n                        return nativeContext;\n                    }\n                    // Bug #186: Chrome and Edge do not allow to create an AudioWorkletNode on a closed AudioContext.\n                    const backupOfflineAudioContext = getOrCreateBackupOfflineAudioContext(nativeContext);\n                    return backupOfflineAudioContext.audioWorklet.addModule(url, options).then(() => backupOfflineAudioContext);\n                })\n                    .then((nativeContextOrBackupOfflineAudioContext) => {\n                    if (nativeAudioWorkletNodeConstructor === null) {\n                        throw new SyntaxError();\n                    }\n                    try {\n                        // Bug #190: Safari doesn't throw an error when loading an unparsable module.\n                        new nativeAudioWorkletNodeConstructor(nativeContextOrBackupOfflineAudioContext, `__sac${currentIndex}`); // tslint:disable-line:no-unused-expression\n                    }\n                    catch {\n                        throw new SyntaxError();\n                    }\n                })\n                    .finally(() => URL.revokeObjectURL(url));\n            });\n        if (ongoingRequestsOfContext === undefined) {\n            ongoingRequests.set(context, new Map([[moduleURL, promise]]));\n        }\n        else {\n            ongoingRequestsOfContext.set(moduleURL, promise);\n        }\n        promise\n            .then(() => {\n            const updatedResolvedRequestsOfContext = resolvedRequests.get(context);\n            if (updatedResolvedRequestsOfContext === undefined) {\n                resolvedRequests.set(context, new Set([moduleURL]));\n            }\n            else {\n                updatedResolvedRequestsOfContext.add(moduleURL);\n            }\n        })\n            .finally(() => {\n            const updatedOngoingRequestsOfContext = ongoingRequests.get(context);\n            if (updatedOngoingRequestsOfContext !== undefined) {\n                updatedOngoingRequestsOfContext.delete(moduleURL);\n            }\n        });\n        return promise;\n    };\n};\n//# sourceMappingURL=add-audio-worklet-module.js.map","export const getValueForKey = (map, key) => {\n    const value = map.get(key);\n    if (value === undefined) {\n        throw new Error('A value with the given key could not be found.');\n    }\n    return value;\n};\n//# sourceMappingURL=get-value-for-key.js.map","export const pickElementFromSet = (set, predicate) => {\n    const matchingElements = Array.from(set).filter(predicate);\n    if (matchingElements.length > 1) {\n        throw Error('More than one element was found.');\n    }\n    if (matchingElements.length === 0) {\n        throw Error('No element was found.');\n    }\n    const [matchingElement] = matchingElements;\n    set.delete(matchingElement);\n    return matchingElement;\n};\n//# sourceMappingURL=pick-element-from-set.js.map","import { getValueForKey } from './get-value-for-key';\nimport { pickElementFromSet } from './pick-element-from-set';\nexport const deletePassiveInputConnectionToAudioNode = (passiveInputs, source, output, input) => {\n    const passiveInputConnections = getValueForKey(passiveInputs, source);\n    const matchingConnection = pickElementFromSet(passiveInputConnections, (passiveInputConnection) => passiveInputConnection[0] === output && passiveInputConnection[1] === input);\n    if (passiveInputConnections.size === 0) {\n        passiveInputs.delete(source);\n    }\n    return matchingConnection;\n};\n//# sourceMappingURL=delete-passive-input-connection-to-audio-node.js.map","import { EVENT_LISTENERS } from '../globals';\nimport { getValueForKey } from './get-value-for-key';\nexport const getEventListenersOfAudioNode = (audioNode) => {\n    return getValueForKey(EVENT_LISTENERS, audioNode);\n};\n//# sourceMappingURL=get-event-listeners-of-audio-node.js.map","import { ACTIVE_AUDIO_NODE_STORE } from '../globals';\nimport { getEventListenersOfAudioNode } from './get-event-listeners-of-audio-node';\nexport const setInternalStateToActive = (audioNode) => {\n    if (ACTIVE_AUDIO_NODE_STORE.has(audioNode)) {\n        throw new Error('The AudioNode is already stored.');\n    }\n    ACTIVE_AUDIO_NODE_STORE.add(audioNode);\n    getEventListenersOfAudioNode(audioNode).forEach((eventListener) => eventListener(true));\n};\n//# sourceMappingURL=set-internal-state-to-active.js.map","export const isAudioWorkletNode = (audioNode) => {\n    return 'port' in audioNode;\n};\n//# sourceMappingURL=audio-worklet-node.js.map","import { ACTIVE_AUDIO_NODE_STORE } from '../globals';\nimport { getEventListenersOfAudioNode } from './get-event-listeners-of-audio-node';\nexport const setInternalStateToPassive = (audioNode) => {\n    if (!ACTIVE_AUDIO_NODE_STORE.has(audioNode)) {\n        throw new Error('The AudioNode is not stored.');\n    }\n    ACTIVE_AUDIO_NODE_STORE.delete(audioNode);\n    getEventListenersOfAudioNode(audioNode).forEach((eventListener) => eventListener(false));\n};\n//# sourceMappingURL=set-internal-state-to-passive.js.map","import { isAudioWorkletNode } from '../guards/audio-worklet-node';\nimport { setInternalStateToPassive } from './set-internal-state-to-passive';\n// Set the internalState of the audioNode to 'passive' if it is not an AudioWorkletNode and if it has no 'active' input connections.\nexport const setInternalStateToPassiveWhenNecessary = (audioNode, activeInputs) => {\n    if (!isAudioWorkletNode(audioNode) && activeInputs.every((connections) => connections.size === 0)) {\n        setInternalStateToPassive(audioNode);\n    }\n};\n//# sourceMappingURL=set-internal-state-to-passive-when-necessary.js.map","import { deletePassiveInputConnectionToAudioNode } from '../helpers/delete-passive-input-connection-to-audio-node';\nimport { setInternalStateToActive } from '../helpers/set-internal-state-to-active';\nimport { setInternalStateToPassiveWhenNecessary } from '../helpers/set-internal-state-to-passive-when-necessary';\nexport const createAddConnectionToAudioNode = (addActiveInputConnectionToAudioNode, addPassiveInputConnectionToAudioNode, connectNativeAudioNodeToNativeAudioNode, deleteActiveInputConnectionToAudioNode, disconnectNativeAudioNodeFromNativeAudioNode, getAudioNodeConnections, getAudioNodeTailTime, getEventListenersOfAudioNode, getNativeAudioNode, insertElementInSet, isActiveAudioNode, isPartOfACycle, isPassiveAudioNode) => {\n    const tailTimeTimeoutIds = new WeakMap();\n    return (source, destination, output, input, isOffline) => {\n        const { activeInputs, passiveInputs } = getAudioNodeConnections(destination);\n        const { outputs } = getAudioNodeConnections(source);\n        const eventListeners = getEventListenersOfAudioNode(source);\n        const eventListener = (isActive) => {\n            const nativeDestinationAudioNode = getNativeAudioNode(destination);\n            const nativeSourceAudioNode = getNativeAudioNode(source);\n            if (isActive) {\n                const partialConnection = deletePassiveInputConnectionToAudioNode(passiveInputs, source, output, input);\n                addActiveInputConnectionToAudioNode(activeInputs, source, partialConnection, false);\n                if (!isOffline && !isPartOfACycle(source)) {\n                    connectNativeAudioNodeToNativeAudioNode(nativeSourceAudioNode, nativeDestinationAudioNode, output, input);\n                }\n                if (isPassiveAudioNode(destination)) {\n                    setInternalStateToActive(destination);\n                }\n            }\n            else {\n                const partialConnection = deleteActiveInputConnectionToAudioNode(activeInputs, source, output, input);\n                addPassiveInputConnectionToAudioNode(passiveInputs, input, partialConnection, false);\n                if (!isOffline && !isPartOfACycle(source)) {\n                    disconnectNativeAudioNodeFromNativeAudioNode(nativeSourceAudioNode, nativeDestinationAudioNode, output, input);\n                }\n                const tailTime = getAudioNodeTailTime(destination);\n                if (tailTime === 0) {\n                    if (isActiveAudioNode(destination)) {\n                        setInternalStateToPassiveWhenNecessary(destination, activeInputs);\n                    }\n                }\n                else {\n                    const tailTimeTimeoutId = tailTimeTimeoutIds.get(destination);\n                    if (tailTimeTimeoutId !== undefined) {\n                        clearTimeout(tailTimeTimeoutId);\n                    }\n                    tailTimeTimeoutIds.set(destination, setTimeout(() => {\n                        if (isActiveAudioNode(destination)) {\n                            setInternalStateToPassiveWhenNecessary(destination, activeInputs);\n                        }\n                    }, tailTime * 1000));\n                }\n            }\n        };\n        if (insertElementInSet(outputs, [destination, output, input], (outputConnection) => outputConnection[0] === destination && outputConnection[1] === output && outputConnection[2] === input, true)) {\n            eventListeners.add(eventListener);\n            if (isActiveAudioNode(source)) {\n                addActiveInputConnectionToAudioNode(activeInputs, source, [output, input, eventListener], true);\n            }\n            else {\n                addPassiveInputConnectionToAudioNode(passiveInputs, input, [source, output, eventListener], true);\n            }\n            return true;\n        }\n        return false;\n    };\n};\n//# sourceMappingURL=add-connection-to-audio-node.js.map","export const createAddPassiveInputConnectionToAudioNode = (insertElementInSet) => {\n    return (passiveInputs, input, [source, output, eventListener], ignoreDuplicates) => {\n        const passiveInputConnections = passiveInputs.get(source);\n        if (passiveInputConnections === undefined) {\n            passiveInputs.set(source, new Set([[output, input, eventListener]]));\n        }\n        else {\n            insertElementInSet(passiveInputConnections, [output, input, eventListener], (passiveInputConnection) => passiveInputConnection[0] === output && passiveInputConnection[1] === input, ignoreDuplicates);\n        }\n    };\n};\n//# sourceMappingURL=add-passive-input-connection-to-audio-node.js.map","export const createAddSilentConnection = (createNativeGainNode) => {\n    return (nativeContext, nativeAudioScheduledSourceNode) => {\n        const nativeGainNode = createNativeGainNode(nativeContext, {\n            channelCount: 1,\n            channelCountMode: 'explicit',\n            channelInterpretation: 'discrete',\n            gain: 0\n        });\n        nativeAudioScheduledSourceNode.connect(nativeGainNode).connect(nativeContext.destination);\n        const disconnect = () => {\n            nativeAudioScheduledSourceNode.removeEventListener('ended', disconnect);\n            nativeAudioScheduledSourceNode.disconnect(nativeGainNode);\n            nativeGainNode.disconnect();\n        };\n        nativeAudioScheduledSourceNode.addEventListener('ended', disconnect);\n    };\n};\n//# sourceMappingURL=add-silent-connection.js.map","export const createAddUnrenderedAudioWorkletNode = (getUnrenderedAudioWorkletNodes) => {\n    return (nativeContext, audioWorkletNode) => {\n        getUnrenderedAudioWorkletNodes(nativeContext).add(audioWorkletNode);\n    };\n};\n//# sourceMappingURL=add-unrendered-audio-worklet-node.js.map","const DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'max',\n    channelInterpretation: 'speakers',\n    fftSize: 2048,\n    maxDecibels: -30,\n    minDecibels: -100,\n    smoothingTimeConstant: 0.8\n};\nexport const createAnalyserNodeConstructor = (audionNodeConstructor, createAnalyserNodeRenderer, createIndexSizeError, createNativeAnalyserNode, getNativeContext, isNativeOfflineAudioContext) => {\n    return class AnalyserNode extends audionNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeAnalyserNode = createNativeAnalyserNode(nativeContext, mergedOptions);\n            const analyserNodeRenderer = ((isNativeOfflineAudioContext(nativeContext) ? createAnalyserNodeRenderer() : null));\n            super(context, false, nativeAnalyserNode, analyserNodeRenderer);\n            this._nativeAnalyserNode = nativeAnalyserNode;\n        }\n        get fftSize() {\n            return this._nativeAnalyserNode.fftSize;\n        }\n        set fftSize(value) {\n            this._nativeAnalyserNode.fftSize = value;\n        }\n        get frequencyBinCount() {\n            return this._nativeAnalyserNode.frequencyBinCount;\n        }\n        get maxDecibels() {\n            return this._nativeAnalyserNode.maxDecibels;\n        }\n        set maxDecibels(value) {\n            // Bug #118: Safari does not throw an error if maxDecibels is not more than minDecibels.\n            const maxDecibels = this._nativeAnalyserNode.maxDecibels;\n            this._nativeAnalyserNode.maxDecibels = value;\n            if (!(value > this._nativeAnalyserNode.minDecibels)) {\n                this._nativeAnalyserNode.maxDecibels = maxDecibels;\n                throw createIndexSizeError();\n            }\n        }\n        get minDecibels() {\n            return this._nativeAnalyserNode.minDecibels;\n        }\n        set minDecibels(value) {\n            // Bug #118: Safari does not throw an error if maxDecibels is not more than minDecibels.\n            const minDecibels = this._nativeAnalyserNode.minDecibels;\n            this._nativeAnalyserNode.minDecibels = value;\n            if (!(this._nativeAnalyserNode.maxDecibels > value)) {\n                this._nativeAnalyserNode.minDecibels = minDecibels;\n                throw createIndexSizeError();\n            }\n        }\n        get smoothingTimeConstant() {\n            return this._nativeAnalyserNode.smoothingTimeConstant;\n        }\n        set smoothingTimeConstant(value) {\n            this._nativeAnalyserNode.smoothingTimeConstant = value;\n        }\n        getByteFrequencyData(array) {\n            this._nativeAnalyserNode.getByteFrequencyData(array);\n        }\n        getByteTimeDomainData(array) {\n            this._nativeAnalyserNode.getByteTimeDomainData(array);\n        }\n        getFloatFrequencyData(array) {\n            this._nativeAnalyserNode.getFloatFrequencyData(array);\n        }\n        getFloatTimeDomainData(array) {\n            this._nativeAnalyserNode.getFloatTimeDomainData(array);\n        }\n    };\n};\n//# sourceMappingURL=analyser-node-constructor.js.map","export const isOwnedByContext = (nativeAudioNode, nativeContext) => {\n    return nativeAudioNode.context === nativeContext;\n};\n//# sourceMappingURL=is-owned-by-context.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createAnalyserNodeRendererFactory = (createNativeAnalyserNode, getNativeAudioNode, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeAnalyserNodes = new WeakMap();\n        const createAnalyserNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeAnalyserNode = getNativeAudioNode(proxy);\n            // If the initially used nativeAnalyserNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeAnalyserNodeIsOwnedByContext = isOwnedByContext(nativeAnalyserNode, nativeOfflineAudioContext);\n            if (!nativeAnalyserNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeAnalyserNode.channelCount,\n                    channelCountMode: nativeAnalyserNode.channelCountMode,\n                    channelInterpretation: nativeAnalyserNode.channelInterpretation,\n                    fftSize: nativeAnalyserNode.fftSize,\n                    maxDecibels: nativeAnalyserNode.maxDecibels,\n                    minDecibels: nativeAnalyserNode.minDecibels,\n                    smoothingTimeConstant: nativeAnalyserNode.smoothingTimeConstant\n                };\n                nativeAnalyserNode = createNativeAnalyserNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeAnalyserNodes.set(nativeOfflineAudioContext, nativeAnalyserNode);\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeAnalyserNode);\n            return nativeAnalyserNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeAnalyserNode = renderedNativeAnalyserNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeAnalyserNode !== undefined) {\n                    return Promise.resolve(renderedNativeAnalyserNode);\n                }\n                return createAnalyserNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=analyser-node-renderer-factory.js.map","export const testAudioBufferCopyChannelMethodsOutOfBoundsSupport = (nativeAudioBuffer) => {\n    try {\n        nativeAudioBuffer.copyToChannel(new Float32Array(1), 0, -1);\n    }\n    catch {\n        return false;\n    }\n    return true;\n};\n//# sourceMappingURL=test-audio-buffer-copy-channel-methods-out-of-bounds-support.js.map","export const createIndexSizeError = () => new DOMException('', 'IndexSizeError');\n//# sourceMappingURL=index-size-error.js.map","import { createIndexSizeError } from '../factories/index-size-error';\nexport const wrapAudioBufferGetChannelDataMethod = (audioBuffer) => {\n    audioBuffer.getChannelData = ((getChannelData) => {\n        return (channel) => {\n            try {\n                return getChannelData.call(audioBuffer, channel);\n            }\n            catch (err) {\n                if (err.code === 12) {\n                    throw createIndexSizeError();\n                }\n                throw err;\n            }\n        };\n    })(audioBuffer.getChannelData);\n};\n//# sourceMappingURL=wrap-audio-buffer-get-channel-data-method.js.map","import { testAudioBufferCopyChannelMethodsOutOfBoundsSupport } from '../helpers/test-audio-buffer-copy-channel-methods-out-of-bounds-support';\nimport { wrapAudioBufferGetChannelDataMethod } from '../helpers/wrap-audio-buffer-get-channel-data-method';\nconst DEFAULT_OPTIONS = {\n    numberOfChannels: 1\n};\nexport const createAudioBufferConstructor = (audioBufferStore, cacheTestResult, createNotSupportedError, nativeAudioBufferConstructor, nativeOfflineAudioContextConstructor, testNativeAudioBufferConstructorSupport, wrapAudioBufferCopyChannelMethods, wrapAudioBufferCopyChannelMethodsOutOfBounds) => {\n    let nativeOfflineAudioContext = null;\n    return class AudioBuffer {\n        constructor(options) {\n            if (nativeOfflineAudioContextConstructor === null) {\n                throw new Error('Missing the native OfflineAudioContext constructor.');\n            }\n            const { length, numberOfChannels, sampleRate } = { ...DEFAULT_OPTIONS, ...options };\n            if (nativeOfflineAudioContext === null) {\n                nativeOfflineAudioContext = new nativeOfflineAudioContextConstructor(1, 1, 44100);\n            }\n            /*\n             * Bug #99: Firefox does not throw a NotSupportedError when the numberOfChannels is zero. But it only does it when using the\n             * factory function. But since Firefox also supports the constructor everything should be fine.\n             */\n            const audioBuffer = nativeAudioBufferConstructor !== null &&\n                cacheTestResult(testNativeAudioBufferConstructorSupport, testNativeAudioBufferConstructorSupport)\n                ? new nativeAudioBufferConstructor({ length, numberOfChannels, sampleRate })\n                : nativeOfflineAudioContext.createBuffer(numberOfChannels, length, sampleRate);\n            // Bug #99: Safari does not throw an error when the numberOfChannels is zero.\n            if (audioBuffer.numberOfChannels === 0) {\n                throw createNotSupportedError();\n            }\n            // Bug #5: Safari does not support copyFromChannel() and copyToChannel().\n            // Bug #100: Safari does throw a wrong error when calling getChannelData() with an out-of-bounds value.\n            if (typeof audioBuffer.copyFromChannel !== 'function') {\n                wrapAudioBufferCopyChannelMethods(audioBuffer);\n                wrapAudioBufferGetChannelDataMethod(audioBuffer);\n                // Bug #157: Firefox does not allow the bufferOffset to be out-of-bounds.\n            }\n            else if (!cacheTestResult(testAudioBufferCopyChannelMethodsOutOfBoundsSupport, () => testAudioBufferCopyChannelMethodsOutOfBoundsSupport(audioBuffer))) {\n                wrapAudioBufferCopyChannelMethodsOutOfBounds(audioBuffer);\n            }\n            audioBufferStore.add(audioBuffer);\n            /*\n             * This does violate all good pratices but it is necessary to allow this AudioBuffer to be used with native\n             * (Offline)AudioContexts.\n             */\n            return audioBuffer;\n        }\n        static [Symbol.hasInstance](instance) {\n            return ((instance !== null && typeof instance === 'object' && Object.getPrototypeOf(instance) === AudioBuffer.prototype) ||\n                audioBufferStore.has(instance));\n        }\n    };\n};\n//# sourceMappingURL=audio-buffer-constructor.js.map","export const MOST_NEGATIVE_SINGLE_FLOAT = -3.4028234663852886e38;\nexport const MOST_POSITIVE_SINGLE_FLOAT = -MOST_NEGATIVE_SINGLE_FLOAT;\n//# sourceMappingURL=constants.js.map","import { ACTIVE_AUDIO_NODE_STORE } from '../globals';\nexport const isActiveAudioNode = (audioNode) => ACTIVE_AUDIO_NODE_STORE.has(audioNode);\n//# sourceMappingURL=is-active-audio-node.js.map","import { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nimport { isActiveAudioNode } from '../helpers/is-active-audio-node';\nimport { setInternalStateToActive } from '../helpers/set-internal-state-to-active';\nimport { setInternalStateToPassive } from '../helpers/set-internal-state-to-passive';\nconst DEFAULT_OPTIONS = {\n    buffer: null,\n    channelCount: 2,\n    channelCountMode: 'max',\n    channelInterpretation: 'speakers',\n    // Bug #149: Safari does not yet support the detune AudioParam.\n    loop: false,\n    loopEnd: 0,\n    loopStart: 0,\n    playbackRate: 1\n};\nexport const createAudioBufferSourceNodeConstructor = (audioNodeConstructor, createAudioBufferSourceNodeRenderer, createAudioParam, createInvalidStateError, createNativeAudioBufferSourceNode, getNativeContext, isNativeOfflineAudioContext, wrapEventListener) => {\n    return class AudioBufferSourceNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeAudioBufferSourceNode = createNativeAudioBufferSourceNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const audioBufferSourceNodeRenderer = ((isOffline ? createAudioBufferSourceNodeRenderer() : null));\n            super(context, false, nativeAudioBufferSourceNode, audioBufferSourceNodeRenderer);\n            this._audioBufferSourceNodeRenderer = audioBufferSourceNodeRenderer;\n            this._isBufferNullified = false;\n            this._isBufferSet = mergedOptions.buffer !== null;\n            this._nativeAudioBufferSourceNode = nativeAudioBufferSourceNode;\n            this._onended = null;\n            // Bug #73: Safari does not export the correct values for maxValue and minValue.\n            this._playbackRate = createAudioParam(this, isOffline, nativeAudioBufferSourceNode.playbackRate, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n        }\n        get buffer() {\n            if (this._isBufferNullified) {\n                return null;\n            }\n            return this._nativeAudioBufferSourceNode.buffer;\n        }\n        set buffer(value) {\n            this._nativeAudioBufferSourceNode.buffer = value;\n            // Bug #72: Only Chrome & Edge do not allow to reassign the buffer yet.\n            if (value !== null) {\n                if (this._isBufferSet) {\n                    throw createInvalidStateError();\n                }\n                this._isBufferSet = true;\n            }\n        }\n        get loop() {\n            return this._nativeAudioBufferSourceNode.loop;\n        }\n        set loop(value) {\n            this._nativeAudioBufferSourceNode.loop = value;\n        }\n        get loopEnd() {\n            return this._nativeAudioBufferSourceNode.loopEnd;\n        }\n        set loopEnd(value) {\n            this._nativeAudioBufferSourceNode.loopEnd = value;\n        }\n        get loopStart() {\n            return this._nativeAudioBufferSourceNode.loopStart;\n        }\n        set loopStart(value) {\n            this._nativeAudioBufferSourceNode.loopStart = value;\n        }\n        get onended() {\n            return this._onended;\n        }\n        set onended(value) {\n            const wrappedListener = typeof value === 'function' ? wrapEventListener(this, value) : null;\n            this._nativeAudioBufferSourceNode.onended = wrappedListener;\n            const nativeOnEnded = this._nativeAudioBufferSourceNode.onended;\n            this._onended = nativeOnEnded !== null && nativeOnEnded === wrappedListener ? value : nativeOnEnded;\n        }\n        get playbackRate() {\n            return this._playbackRate;\n        }\n        start(when = 0, offset = 0, duration) {\n            this._nativeAudioBufferSourceNode.start(when, offset, duration);\n            if (this._audioBufferSourceNodeRenderer !== null) {\n                this._audioBufferSourceNodeRenderer.start = duration === undefined ? [when, offset] : [when, offset, duration];\n            }\n            if (this.context.state !== 'closed') {\n                setInternalStateToActive(this);\n                const resetInternalStateToPassive = () => {\n                    this._nativeAudioBufferSourceNode.removeEventListener('ended', resetInternalStateToPassive);\n                    if (isActiveAudioNode(this)) {\n                        setInternalStateToPassive(this);\n                    }\n                };\n                this._nativeAudioBufferSourceNode.addEventListener('ended', resetInternalStateToPassive);\n            }\n        }\n        stop(when = 0) {\n            this._nativeAudioBufferSourceNode.stop(when);\n            if (this._audioBufferSourceNodeRenderer !== null) {\n                this._audioBufferSourceNodeRenderer.stop = when;\n            }\n        }\n    };\n};\n//# sourceMappingURL=audio-buffer-source-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createAudioBufferSourceNodeRendererFactory = (connectAudioParam, createNativeAudioBufferSourceNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeAudioBufferSourceNodes = new WeakMap();\n        let start = null;\n        let stop = null;\n        const createAudioBufferSourceNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeAudioBufferSourceNode = getNativeAudioNode(proxy);\n            /*\n             * If the initially used nativeAudioBufferSourceNode was not constructed on the same OfflineAudioContext it needs to be created\n             * again.\n             */\n            const nativeAudioBufferSourceNodeIsOwnedByContext = isOwnedByContext(nativeAudioBufferSourceNode, nativeOfflineAudioContext);\n            if (!nativeAudioBufferSourceNodeIsOwnedByContext) {\n                const options = {\n                    buffer: nativeAudioBufferSourceNode.buffer,\n                    channelCount: nativeAudioBufferSourceNode.channelCount,\n                    channelCountMode: nativeAudioBufferSourceNode.channelCountMode,\n                    channelInterpretation: nativeAudioBufferSourceNode.channelInterpretation,\n                    // Bug #149: Safari does not yet support the detune AudioParam.\n                    loop: nativeAudioBufferSourceNode.loop,\n                    loopEnd: nativeAudioBufferSourceNode.loopEnd,\n                    loopStart: nativeAudioBufferSourceNode.loopStart,\n                    playbackRate: nativeAudioBufferSourceNode.playbackRate.value\n                };\n                nativeAudioBufferSourceNode = createNativeAudioBufferSourceNode(nativeOfflineAudioContext, options);\n                if (start !== null) {\n                    nativeAudioBufferSourceNode.start(...start);\n                }\n                if (stop !== null) {\n                    nativeAudioBufferSourceNode.stop(stop);\n                }\n            }\n            renderedNativeAudioBufferSourceNodes.set(nativeOfflineAudioContext, nativeAudioBufferSourceNode);\n            if (!nativeAudioBufferSourceNodeIsOwnedByContext) {\n                // Bug #149: Safari does not yet support the detune AudioParam.\n                await renderAutomation(nativeOfflineAudioContext, proxy.playbackRate, nativeAudioBufferSourceNode.playbackRate);\n            }\n            else {\n                // Bug #149: Safari does not yet support the detune AudioParam.\n                await connectAudioParam(nativeOfflineAudioContext, proxy.playbackRate, nativeAudioBufferSourceNode.playbackRate);\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeAudioBufferSourceNode);\n            return nativeAudioBufferSourceNode;\n        };\n        return {\n            set start(value) {\n                start = value;\n            },\n            set stop(value) {\n                stop = value;\n            },\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeAudioBufferSourceNode = renderedNativeAudioBufferSourceNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeAudioBufferSourceNode !== undefined) {\n                    return Promise.resolve(renderedNativeAudioBufferSourceNode);\n                }\n                return createAudioBufferSourceNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=audio-buffer-source-node-renderer-factory.js.map","export const isAudioBufferSourceNode = (audioNode) => {\n    return 'playbackRate' in audioNode;\n};\n//# sourceMappingURL=audio-buffer-source-node.js.map","export const isBiquadFilterNode = (audioNode) => {\n    return 'frequency' in audioNode && 'gain' in audioNode;\n};\n//# sourceMappingURL=biquad-filter-node.js.map","export const isConstantSourceNode = (audioNode) => {\n    return 'offset' in audioNode;\n};\n//# sourceMappingURL=constant-source-node.js.map","export const isGainNode = (audioNode) => {\n    return !('frequency' in audioNode) && 'gain' in audioNode;\n};\n//# sourceMappingURL=gain-node.js.map","export const isOscillatorNode = (audioNode) => {\n    return 'detune' in audioNode && 'frequency' in audioNode && !('gain' in audioNode);\n};\n//# sourceMappingURL=oscillator-node.js.map","export const isStereoPannerNode = (audioNode) => {\n    return 'pan' in audioNode;\n};\n//# sourceMappingURL=stereo-panner-node.js.map","import { AUDIO_NODE_CONNECTIONS_STORE } from '../globals';\nimport { getValueForKey } from './get-value-for-key';\nexport const getAudioNodeConnections = (audioNode) => {\n    return getValueForKey(AUDIO_NODE_CONNECTIONS_STORE, audioNode);\n};\n//# sourceMappingURL=get-audio-node-connections.js.map","import { AUDIO_PARAM_CONNECTIONS_STORE } from '../globals';\nimport { getValueForKey } from './get-value-for-key';\nexport const getAudioParamConnections = (audioParam) => {\n    return getValueForKey(AUDIO_PARAM_CONNECTIONS_STORE, audioParam);\n};\n//# sourceMappingURL=get-audio-param-connections.js.map","import { isAudioBufferSourceNode } from '../guards/audio-buffer-source-node';\nimport { isAudioWorkletNode } from '../guards/audio-worklet-node';\nimport { isBiquadFilterNode } from '../guards/biquad-filter-node';\nimport { isConstantSourceNode } from '../guards/constant-source-node';\nimport { isGainNode } from '../guards/gain-node';\nimport { isOscillatorNode } from '../guards/oscillator-node';\nimport { isStereoPannerNode } from '../guards/stereo-panner-node';\nimport { getAudioNodeConnections } from './get-audio-node-connections';\nimport { getAudioParamConnections } from './get-audio-param-connections';\nimport { isActiveAudioNode } from './is-active-audio-node';\nimport { setInternalStateToPassive } from './set-internal-state-to-passive';\nexport const deactivateActiveAudioNodeInputConnections = (audioNode, trace) => {\n    const { activeInputs } = getAudioNodeConnections(audioNode);\n    activeInputs.forEach((connections) => connections.forEach(([source]) => {\n        if (!trace.includes(audioNode)) {\n            deactivateActiveAudioNodeInputConnections(source, [...trace, audioNode]);\n        }\n    }));\n    const audioParams = isAudioBufferSourceNode(audioNode)\n        ? [\n            // Bug #149: Safari does not yet support the detune AudioParam.\n            audioNode.playbackRate\n        ]\n        : isAudioWorkletNode(audioNode)\n            ? Array.from(audioNode.parameters.values())\n            : isBiquadFilterNode(audioNode)\n                ? [audioNode.Q, audioNode.detune, audioNode.frequency, audioNode.gain]\n                : isConstantSourceNode(audioNode)\n                    ? [audioNode.offset]\n                    : isGainNode(audioNode)\n                        ? [audioNode.gain]\n                        : isOscillatorNode(audioNode)\n                            ? [audioNode.detune, audioNode.frequency]\n                            : isStereoPannerNode(audioNode)\n                                ? [audioNode.pan]\n                                : [];\n    for (const audioParam of audioParams) {\n        const audioParamConnections = getAudioParamConnections(audioParam);\n        if (audioParamConnections !== undefined) {\n            audioParamConnections.activeInputs.forEach(([source]) => deactivateActiveAudioNodeInputConnections(source, trace));\n        }\n    }\n    if (isActiveAudioNode(audioNode)) {\n        setInternalStateToPassive(audioNode);\n    }\n};\n//# sourceMappingURL=deactivate-active-audio-node-input-connections.js.map","import { deactivateActiveAudioNodeInputConnections } from './deactivate-active-audio-node-input-connections';\nexport const deactivateAudioGraph = (context) => {\n    deactivateActiveAudioNodeInputConnections(context.destination, []);\n};\n//# sourceMappingURL=deactivate-audio-graph.js.map","export const isValidLatencyHint = (latencyHint) => {\n    return (latencyHint === undefined ||\n        typeof latencyHint === 'number' ||\n        (typeof latencyHint === 'string' && (latencyHint === 'balanced' || latencyHint === 'interactive' || latencyHint === 'playback')));\n};\n//# sourceMappingURL=is-valid-latency-hint.js.map","import { deactivateAudioGraph } from '../helpers/deactivate-audio-graph';\nimport { isValidLatencyHint } from '../helpers/is-valid-latency-hint';\nexport const createAudioContextConstructor = (baseAudioContextConstructor, createInvalidStateError, createNotSupportedError, createUnknownError, mediaElementAudioSourceNodeConstructor, mediaStreamAudioDestinationNodeConstructor, mediaStreamAudioSourceNodeConstructor, mediaStreamTrackAudioSourceNodeConstructor, nativeAudioContextConstructor) => {\n    return class AudioContext extends baseAudioContextConstructor {\n        constructor(options = {}) {\n            if (nativeAudioContextConstructor === null) {\n                throw new Error('Missing the native AudioContext constructor.');\n            }\n            let nativeAudioContext;\n            try {\n                nativeAudioContext = new nativeAudioContextConstructor(options);\n            }\n            catch (err) {\n                // Bug #192 Safari does throw a SyntaxError if the sampleRate is not supported.\n                if (err.code === 12 && err.message === 'sampleRate is not in range') {\n                    throw createNotSupportedError();\n                }\n                throw err;\n            }\n            // Bug #131 Safari returns null when there are four other AudioContexts running already.\n            if (nativeAudioContext === null) {\n                throw createUnknownError();\n            }\n            // Bug #51 Only Chrome and Edge throw an error if the given latencyHint is invalid.\n            if (!isValidLatencyHint(options.latencyHint)) {\n                throw new TypeError(`The provided value '${options.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);\n            }\n            // Bug #150 Safari does not support setting the sampleRate.\n            if (options.sampleRate !== undefined && nativeAudioContext.sampleRate !== options.sampleRate) {\n                throw createNotSupportedError();\n            }\n            super(nativeAudioContext, 2);\n            const { latencyHint } = options;\n            const { sampleRate } = nativeAudioContext;\n            // @todo The values for 'balanced', 'interactive' and 'playback' are just copied from Chrome's implementation.\n            this._baseLatency =\n                typeof nativeAudioContext.baseLatency === 'number'\n                    ? nativeAudioContext.baseLatency\n                    : latencyHint === 'balanced'\n                        ? 512 / sampleRate\n                        : latencyHint === 'interactive' || latencyHint === undefined\n                            ? 256 / sampleRate\n                            : latencyHint === 'playback'\n                                ? 1024 / sampleRate\n                                : /*\n                                   * @todo The min (256) and max (16384) values are taken from the allowed bufferSize values of a\n                                   * ScriptProcessorNode.\n                                   */\n                                    (Math.max(2, Math.min(128, Math.round((latencyHint * sampleRate) / 128))) * 128) / sampleRate;\n            this._nativeAudioContext = nativeAudioContext;\n            // Bug #188: Safari will set the context's state to 'interrupted' in case the user switches tabs.\n            if (nativeAudioContextConstructor.name === 'webkitAudioContext') {\n                this._nativeGainNode = nativeAudioContext.createGain();\n                this._nativeOscillatorNode = nativeAudioContext.createOscillator();\n                this._nativeGainNode.gain.value = 1e-37;\n                this._nativeOscillatorNode.connect(this._nativeGainNode).connect(nativeAudioContext.destination);\n                this._nativeOscillatorNode.start();\n            }\n            else {\n                this._nativeGainNode = null;\n                this._nativeOscillatorNode = null;\n            }\n            this._state = null;\n            /*\n             * Bug #34: Chrome and Edge pretend to be running right away, but fire an onstatechange event when the state actually changes\n             * to 'running'.\n             */\n            if (nativeAudioContext.state === 'running') {\n                this._state = 'suspended';\n                const revokeState = () => {\n                    if (this._state === 'suspended') {\n                        this._state = null;\n                    }\n                    nativeAudioContext.removeEventListener('statechange', revokeState);\n                };\n                nativeAudioContext.addEventListener('statechange', revokeState);\n            }\n        }\n        get baseLatency() {\n            return this._baseLatency;\n        }\n        get state() {\n            return this._state !== null ? this._state : this._nativeAudioContext.state;\n        }\n        close() {\n            // Bug #35: Firefox does not throw an error if the AudioContext was closed before.\n            if (this.state === 'closed') {\n                return this._nativeAudioContext.close().then(() => {\n                    throw createInvalidStateError();\n                });\n            }\n            // Bug #34: If the state was set to suspended before it should be revoked now.\n            if (this._state === 'suspended') {\n                this._state = null;\n            }\n            return this._nativeAudioContext.close().then(() => {\n                if (this._nativeGainNode !== null && this._nativeOscillatorNode !== null) {\n                    this._nativeOscillatorNode.stop();\n                    this._nativeGainNode.disconnect();\n                    this._nativeOscillatorNode.disconnect();\n                }\n                deactivateAudioGraph(this);\n            });\n        }\n        createMediaElementSource(mediaElement) {\n            return new mediaElementAudioSourceNodeConstructor(this, { mediaElement });\n        }\n        createMediaStreamDestination() {\n            return new mediaStreamAudioDestinationNodeConstructor(this);\n        }\n        createMediaStreamSource(mediaStream) {\n            return new mediaStreamAudioSourceNodeConstructor(this, { mediaStream });\n        }\n        createMediaStreamTrackSource(mediaStreamTrack) {\n            return new mediaStreamTrackAudioSourceNodeConstructor(this, { mediaStreamTrack });\n        }\n        resume() {\n            if (this._state === 'suspended') {\n                return new Promise((resolve, reject) => {\n                    const resolvePromise = () => {\n                        this._nativeAudioContext.removeEventListener('statechange', resolvePromise);\n                        if (this._nativeAudioContext.state === 'running') {\n                            resolve();\n                        }\n                        else {\n                            this.resume().then(resolve, reject);\n                        }\n                    };\n                    this._nativeAudioContext.addEventListener('statechange', resolvePromise);\n                });\n            }\n            return this._nativeAudioContext.resume().catch((err) => {\n                // Bug #55: Chrome and Edge do throw an InvalidAccessError instead of an InvalidStateError.\n                // Bug #56: Safari invokes the catch handler but without an error.\n                if (err === undefined || err.code === 15) {\n                    throw createInvalidStateError();\n                }\n                throw err;\n            });\n        }\n        suspend() {\n            return this._nativeAudioContext.suspend().catch((err) => {\n                // Bug #56: Safari invokes the catch handler but without an error.\n                if (err === undefined) {\n                    throw createInvalidStateError();\n                }\n                throw err;\n            });\n        }\n    };\n};\n//# sourceMappingURL=audio-context-constructor.js.map","export const createAudioDestinationNodeConstructor = (audioNodeConstructor, createAudioDestinationNodeRenderer, createIndexSizeError, createInvalidStateError, createNativeAudioDestinationNode, getNativeContext, isNativeOfflineAudioContext, renderInputsOfAudioNode) => {\n    return class AudioDestinationNode extends audioNodeConstructor {\n        constructor(context, channelCount) {\n            const nativeContext = getNativeContext(context);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const nativeAudioDestinationNode = createNativeAudioDestinationNode(nativeContext, channelCount, isOffline);\n            const audioDestinationNodeRenderer = ((isOffline ? createAudioDestinationNodeRenderer(renderInputsOfAudioNode) : null));\n            super(context, false, nativeAudioDestinationNode, audioDestinationNodeRenderer);\n            this._isNodeOfNativeOfflineAudioContext = isOffline;\n            this._nativeAudioDestinationNode = nativeAudioDestinationNode;\n        }\n        get channelCount() {\n            return this._nativeAudioDestinationNode.channelCount;\n        }\n        set channelCount(value) {\n            // Bug #52: Chrome, Edge & Safari do not throw an exception at all.\n            // Bug #54: Firefox does throw an IndexSizeError.\n            if (this._isNodeOfNativeOfflineAudioContext) {\n                throw createInvalidStateError();\n            }\n            // Bug #47: The AudioDestinationNode in Safari does not initialize the maxChannelCount property correctly.\n            if (value > this._nativeAudioDestinationNode.maxChannelCount) {\n                throw createIndexSizeError();\n            }\n            this._nativeAudioDestinationNode.channelCount = value;\n        }\n        get channelCountMode() {\n            return this._nativeAudioDestinationNode.channelCountMode;\n        }\n        set channelCountMode(value) {\n            // Bug #53: No browser does throw an exception yet.\n            if (this._isNodeOfNativeOfflineAudioContext) {\n                throw createInvalidStateError();\n            }\n            this._nativeAudioDestinationNode.channelCountMode = value;\n        }\n        get maxChannelCount() {\n            return this._nativeAudioDestinationNode.maxChannelCount;\n        }\n    };\n};\n//# sourceMappingURL=audio-destination-node-constructor.js.map","export const createAudioDestinationNodeRenderer = (renderInputsOfAudioNode) => {\n    const renderedNativeAudioDestinationNodes = new WeakMap();\n    const createAudioDestinationNode = async (proxy, nativeOfflineAudioContext) => {\n        const nativeAudioDestinationNode = nativeOfflineAudioContext.destination;\n        renderedNativeAudioDestinationNodes.set(nativeOfflineAudioContext, nativeAudioDestinationNode);\n        await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeAudioDestinationNode);\n        return nativeAudioDestinationNode;\n    };\n    return {\n        render(proxy, nativeOfflineAudioContext) {\n            const renderedNativeAudioDestinationNode = renderedNativeAudioDestinationNodes.get(nativeOfflineAudioContext);\n            if (renderedNativeAudioDestinationNode !== undefined) {\n                return Promise.resolve(renderedNativeAudioDestinationNode);\n            }\n            return createAudioDestinationNode(proxy, nativeOfflineAudioContext);\n        }\n    };\n};\n//# sourceMappingURL=audio-destination-node-renderer-factory.js.map","import { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nexport const createAudioListenerFactory = (createAudioParam, createNativeChannelMergerNode, createNativeConstantSourceNode, createNativeScriptProcessorNode, createNotSupportedError, getFirstSample, isNativeOfflineAudioContext, overwriteAccessors) => {\n    return (context, nativeContext) => {\n        const nativeListener = nativeContext.listener;\n        // Bug #117: Only Chrome & Edge support the new interface already.\n        const createFakeAudioParams = () => {\n            const buffer = new Float32Array(1);\n            const channelMergerNode = createNativeChannelMergerNode(nativeContext, {\n                channelCount: 1,\n                channelCountMode: 'explicit',\n                channelInterpretation: 'speakers',\n                numberOfInputs: 9\n            });\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            let isScriptProcessorNodeCreated = false;\n            let lastOrientation = [0, 0, -1, 0, 1, 0];\n            let lastPosition = [0, 0, 0];\n            const createScriptProcessorNode = () => {\n                if (isScriptProcessorNodeCreated) {\n                    return;\n                }\n                isScriptProcessorNodeCreated = true;\n                const scriptProcessorNode = createNativeScriptProcessorNode(nativeContext, 256, 9, 0);\n                // tslint:disable-next-line:deprecation\n                scriptProcessorNode.onaudioprocess = ({ inputBuffer }) => {\n                    const orientation = [\n                        getFirstSample(inputBuffer, buffer, 0),\n                        getFirstSample(inputBuffer, buffer, 1),\n                        getFirstSample(inputBuffer, buffer, 2),\n                        getFirstSample(inputBuffer, buffer, 3),\n                        getFirstSample(inputBuffer, buffer, 4),\n                        getFirstSample(inputBuffer, buffer, 5)\n                    ];\n                    if (orientation.some((value, index) => value !== lastOrientation[index])) {\n                        nativeListener.setOrientation(...orientation); // tslint:disable-line:deprecation\n                        lastOrientation = orientation;\n                    }\n                    const positon = [\n                        getFirstSample(inputBuffer, buffer, 6),\n                        getFirstSample(inputBuffer, buffer, 7),\n                        getFirstSample(inputBuffer, buffer, 8)\n                    ];\n                    if (positon.some((value, index) => value !== lastPosition[index])) {\n                        nativeListener.setPosition(...positon); // tslint:disable-line:deprecation\n                        lastPosition = positon;\n                    }\n                };\n                channelMergerNode.connect(scriptProcessorNode);\n            };\n            const createSetOrientation = (index) => (value) => {\n                if (value !== lastOrientation[index]) {\n                    lastOrientation[index] = value;\n                    nativeListener.setOrientation(...lastOrientation); // tslint:disable-line:deprecation\n                }\n            };\n            const createSetPosition = (index) => (value) => {\n                if (value !== lastPosition[index]) {\n                    lastPosition[index] = value;\n                    nativeListener.setPosition(...lastPosition); // tslint:disable-line:deprecation\n                }\n            };\n            const createFakeAudioParam = (input, initialValue, setValue) => {\n                const constantSourceNode = createNativeConstantSourceNode(nativeContext, {\n                    channelCount: 1,\n                    channelCountMode: 'explicit',\n                    channelInterpretation: 'discrete',\n                    offset: initialValue\n                });\n                constantSourceNode.connect(channelMergerNode, 0, input);\n                // @todo This should be stopped when the context is closed.\n                constantSourceNode.start();\n                Object.defineProperty(constantSourceNode.offset, 'defaultValue', {\n                    get() {\n                        return initialValue;\n                    }\n                });\n                /*\n                 * Bug #62 & #74: Safari does not support ConstantSourceNodes and does not export the correct values for maxValue and\n                 * minValue for GainNodes.\n                 */\n                const audioParam = createAudioParam({ context }, isOffline, constantSourceNode.offset, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n                overwriteAccessors(audioParam, 'value', (get) => () => get.call(audioParam), (set) => (value) => {\n                    try {\n                        set.call(audioParam, value);\n                    }\n                    catch (err) {\n                        if (err.code !== 9) {\n                            throw err;\n                        }\n                    }\n                    createScriptProcessorNode();\n                    if (isOffline) {\n                        // Bug #117: Using setOrientation() and setPosition() doesn't work with an OfflineAudioContext.\n                        setValue(value);\n                    }\n                });\n                audioParam.cancelAndHoldAtTime = ((cancelAndHoldAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = cancelAndHoldAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.cancelAndHoldAtTime);\n                audioParam.cancelScheduledValues = ((cancelScheduledValues) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = cancelScheduledValues.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.cancelScheduledValues);\n                audioParam.exponentialRampToValueAtTime = ((exponentialRampToValueAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = exponentialRampToValueAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.exponentialRampToValueAtTime);\n                audioParam.linearRampToValueAtTime = ((linearRampToValueAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = linearRampToValueAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.linearRampToValueAtTime);\n                audioParam.setTargetAtTime = ((setTargetAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = setTargetAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.setTargetAtTime);\n                audioParam.setValueAtTime = ((setValueAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = setValueAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.setValueAtTime);\n                audioParam.setValueCurveAtTime = ((setValueCurveAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = setValueCurveAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.setValueCurveAtTime);\n                return audioParam;\n            };\n            return {\n                forwardX: createFakeAudioParam(0, 0, createSetOrientation(0)),\n                forwardY: createFakeAudioParam(1, 0, createSetOrientation(1)),\n                forwardZ: createFakeAudioParam(2, -1, createSetOrientation(2)),\n                positionX: createFakeAudioParam(6, 0, createSetPosition(0)),\n                positionY: createFakeAudioParam(7, 0, createSetPosition(1)),\n                positionZ: createFakeAudioParam(8, 0, createSetPosition(2)),\n                upX: createFakeAudioParam(3, 0, createSetOrientation(3)),\n                upY: createFakeAudioParam(4, 1, createSetOrientation(4)),\n                upZ: createFakeAudioParam(5, 0, createSetOrientation(5))\n            };\n        };\n        const { forwardX, forwardY, forwardZ, positionX, positionY, positionZ, upX, upY, upZ } = nativeListener.forwardX === undefined ? createFakeAudioParams() : nativeListener;\n        return {\n            get forwardX() {\n                return forwardX;\n            },\n            get forwardY() {\n                return forwardY;\n            },\n            get forwardZ() {\n                return forwardZ;\n            },\n            get positionX() {\n                return positionX;\n            },\n            get positionY() {\n                return positionY;\n            },\n            get positionZ() {\n                return positionZ;\n            },\n            get upX() {\n                return upX;\n            },\n            get upY() {\n                return upY;\n            },\n            get upZ() {\n                return upZ;\n            }\n        };\n    };\n};\n//# sourceMappingURL=audio-listener-factory.js.map","export const isAudioNode = (audioNodeOrAudioParam) => {\n    return 'context' in audioNodeOrAudioParam;\n};\n//# sourceMappingURL=audio-node.js.map","import { isAudioNode } from './audio-node';\nexport const isAudioNodeOutputConnection = (outputConnection) => {\n    return isAudioNode(outputConnection[0]);\n};\n//# sourceMappingURL=audio-node-output-connection.js.map","export const insertElementInSet = (set, element, predicate, ignoreDuplicates) => {\n    for (const lmnt of set) {\n        if (predicate(lmnt)) {\n            if (ignoreDuplicates) {\n                return false;\n            }\n            throw Error('The set contains at least one similar element.');\n        }\n    }\n    set.add(element);\n    return true;\n};\n//# sourceMappingURL=insert-element-in-set.js.map","import { insertElementInSet } from './insert-element-in-set';\nexport const addActiveInputConnectionToAudioParam = (activeInputs, source, [output, eventListener], ignoreDuplicates) => {\n    insertElementInSet(activeInputs, [source, output, eventListener], (activeInputConnection) => activeInputConnection[0] === source && activeInputConnection[1] === output, ignoreDuplicates);\n};\n//# sourceMappingURL=add-active-input-connection-to-audio-param.js.map","import { insertElementInSet } from './insert-element-in-set';\nexport const addPassiveInputConnectionToAudioParam = (passiveInputs, [source, output, eventListener], ignoreDuplicates) => {\n    const passiveInputConnections = passiveInputs.get(source);\n    if (passiveInputConnections === undefined) {\n        passiveInputs.set(source, new Set([[output, eventListener]]));\n    }\n    else {\n        insertElementInSet(passiveInputConnections, [output, eventListener], (passiveInputConnection) => passiveInputConnection[0] === output, ignoreDuplicates);\n    }\n};\n//# sourceMappingURL=add-passive-input-connection-to-audio-param.js.map","export const isNativeAudioNodeFaker = (nativeAudioNodeOrNativeAudioNodeFaker) => {\n    return 'inputs' in nativeAudioNodeOrNativeAudioNodeFaker;\n};\n//# sourceMappingURL=native-audio-node-faker.js.map","import { isNativeAudioNodeFaker } from '../guards/native-audio-node-faker';\nexport const connectNativeAudioNodeToNativeAudioNode = (nativeSourceAudioNode, nativeDestinationAudioNode, output, input) => {\n    if (isNativeAudioNodeFaker(nativeDestinationAudioNode)) {\n        const fakeNativeDestinationAudioNode = nativeDestinationAudioNode.inputs[input];\n        nativeSourceAudioNode.connect(fakeNativeDestinationAudioNode, output, 0);\n        return [fakeNativeDestinationAudioNode, output, 0];\n    }\n    nativeSourceAudioNode.connect(nativeDestinationAudioNode, output, input);\n    return [nativeDestinationAudioNode, output, input];\n};\n//# sourceMappingURL=connect-native-audio-node-to-native-audio-node.js.map","export const deleteActiveInputConnection = (activeInputConnections, source, output) => {\n    for (const activeInputConnection of activeInputConnections) {\n        if (activeInputConnection[0] === source && activeInputConnection[1] === output) {\n            activeInputConnections.delete(activeInputConnection);\n            return activeInputConnection;\n        }\n    }\n    return null;\n};\n//# sourceMappingURL=delete-active-input-connection.js.map","import { pickElementFromSet } from './pick-element-from-set';\nexport const deleteActiveInputConnectionToAudioParam = (activeInputs, source, output) => {\n    return pickElementFromSet(activeInputs, (activeInputConnection) => activeInputConnection[0] === source && activeInputConnection[1] === output);\n};\n//# sourceMappingURL=delete-active-input-connection-to-audio-param.js.map","import { getEventListenersOfAudioNode } from './get-event-listeners-of-audio-node';\nexport const deleteEventListenerOfAudioNode = (audioNode, eventListener) => {\n    const eventListeners = getEventListenersOfAudioNode(audioNode);\n    if (!eventListeners.delete(eventListener)) {\n        throw new Error('Missing the expected event listener.');\n    }\n};\n//# sourceMappingURL=delete-event-listeners-of-audio-node.js.map","import { getValueForKey } from './get-value-for-key';\nimport { pickElementFromSet } from './pick-element-from-set';\nexport const deletePassiveInputConnectionToAudioParam = (passiveInputs, source, output) => {\n    const passiveInputConnections = getValueForKey(passiveInputs, source);\n    const matchingConnection = pickElementFromSet(passiveInputConnections, (passiveInputConnection) => passiveInputConnection[0] === output);\n    if (passiveInputConnections.size === 0) {\n        passiveInputs.delete(source);\n    }\n    return matchingConnection;\n};\n//# sourceMappingURL=delete-passive-input-connection-to-audio-param.js.map","import { isNativeAudioNodeFaker } from '../guards/native-audio-node-faker';\nexport const disconnectNativeAudioNodeFromNativeAudioNode = (nativeSourceAudioNode, nativeDestinationAudioNode, output, input) => {\n    if (isNativeAudioNodeFaker(nativeDestinationAudioNode)) {\n        nativeSourceAudioNode.disconnect(nativeDestinationAudioNode.inputs[input], output, 0);\n    }\n    else {\n        nativeSourceAudioNode.disconnect(nativeDestinationAudioNode, output, input);\n    }\n};\n//# sourceMappingURL=disconnect-native-audio-node-from-native-audio-node.js.map","import { AUDIO_NODE_STORE } from '../globals';\nimport { getValueForKey } from './get-value-for-key';\nexport const getNativeAudioNode = (audioNode) => {\n    return getValueForKey(AUDIO_NODE_STORE, audioNode);\n};\n//# sourceMappingURL=get-native-audio-node.js.map","import { AUDIO_PARAM_STORE } from '../globals';\nimport { getValueForKey } from './get-value-for-key';\nexport const getNativeAudioParam = (audioParam) => {\n    return getValueForKey(AUDIO_PARAM_STORE, audioParam);\n};\n//# sourceMappingURL=get-native-audio-param.js.map","import { CYCLE_COUNTERS } from '../globals';\nexport const isPartOfACycle = (audioNode) => {\n    return CYCLE_COUNTERS.has(audioNode);\n};\n//# sourceMappingURL=is-part-of-a-cycle.js.map","import { ACTIVE_AUDIO_NODE_STORE } from '../globals';\nexport const isPassiveAudioNode = (audioNode) => {\n    return !ACTIVE_AUDIO_NODE_STORE.has(audioNode);\n};\n//# sourceMappingURL=is-passive-audio-node.js.map","export const testAudioNodeDisconnectMethodSupport = (nativeAudioContext, nativeAudioWorkletNodeConstructor) => {\n    return new Promise((resolve) => {\n        /*\n         * This bug existed in Safari up until v14.0.2. Since AudioWorklets were not supported in Safari until v14.1 the presence of the\n         * constructor for an AudioWorkletNode can be used here to skip the test.\n         */\n        if (nativeAudioWorkletNodeConstructor !== null) {\n            resolve(true);\n        }\n        else {\n            const analyzer = nativeAudioContext.createScriptProcessor(256, 1, 1); // tslint:disable-line deprecation\n            const dummy = nativeAudioContext.createGain();\n            // Bug #95: Safari does not play one sample buffers.\n            const ones = nativeAudioContext.createBuffer(1, 2, 44100);\n            const channelData = ones.getChannelData(0);\n            channelData[0] = 1;\n            channelData[1] = 1;\n            const source = nativeAudioContext.createBufferSource();\n            source.buffer = ones;\n            source.loop = true;\n            source.connect(analyzer).connect(nativeAudioContext.destination);\n            source.connect(dummy);\n            source.disconnect(dummy);\n            // tslint:disable-next-line:deprecation\n            analyzer.onaudioprocess = (event) => {\n                const chnnlDt = event.inputBuffer.getChannelData(0); // tslint:disable-line deprecation\n                if (Array.prototype.some.call(chnnlDt, (sample) => sample === 1)) {\n                    resolve(true);\n                }\n                else {\n                    resolve(false);\n                }\n                source.stop();\n                analyzer.onaudioprocess = null; // tslint:disable-line:deprecation\n                source.disconnect(analyzer);\n                analyzer.disconnect(nativeAudioContext.destination);\n            };\n            source.start();\n        }\n    });\n};\n//# sourceMappingURL=test-audio-node-disconnect-method-support.js.map","export const visitEachAudioNodeOnce = (cycles, visitor) => {\n    const counts = new Map();\n    for (const cycle of cycles) {\n        for (const audioNode of cycle) {\n            const count = counts.get(audioNode);\n            counts.set(audioNode, count === undefined ? 1 : count + 1);\n        }\n    }\n    counts.forEach((count, audioNode) => visitor(audioNode, count));\n};\n//# sourceMappingURL=visit-each-audio-node-once.js.map","export const isNativeAudioNode = (nativeAudioNodeOrAudioParam) => {\n    return 'context' in nativeAudioNodeOrAudioParam;\n};\n//# sourceMappingURL=native-audio-node.js.map","import { isNativeAudioNode } from '../guards/native-audio-node';\nexport const wrapAudioNodeDisconnectMethod = (nativeAudioNode) => {\n    const connections = new Map();\n    nativeAudioNode.connect = ((connect) => {\n        // tslint:disable-next-line:invalid-void no-inferrable-types\n        return (destination, output = 0, input = 0) => {\n            const returnValue = isNativeAudioNode(destination) ? connect(destination, output, input) : connect(destination, output);\n            // Save the new connection only if the calls to connect above didn't throw an error.\n            const connectionsToDestination = connections.get(destination);\n            if (connectionsToDestination === undefined) {\n                connections.set(destination, [{ input, output }]);\n            }\n            else {\n                if (connectionsToDestination.every((connection) => connection.input !== input || connection.output !== output)) {\n                    connectionsToDestination.push({ input, output });\n                }\n            }\n            return returnValue;\n        };\n    })(nativeAudioNode.connect.bind(nativeAudioNode));\n    nativeAudioNode.disconnect = ((disconnect) => {\n        return (destinationOrOutput, output, input) => {\n            disconnect.apply(nativeAudioNode);\n            if (destinationOrOutput === undefined) {\n                connections.clear();\n            }\n            else if (typeof destinationOrOutput === 'number') {\n                for (const [destination, connectionsToDestination] of connections) {\n                    const filteredConnections = connectionsToDestination.filter((connection) => connection.output !== destinationOrOutput);\n                    if (filteredConnections.length === 0) {\n                        connections.delete(destination);\n                    }\n                    else {\n                        connections.set(destination, filteredConnections);\n                    }\n                }\n            }\n            else if (connections.has(destinationOrOutput)) {\n                if (output === undefined) {\n                    connections.delete(destinationOrOutput);\n                }\n                else {\n                    const connectionsToDestination = connections.get(destinationOrOutput);\n                    if (connectionsToDestination !== undefined) {\n                        const filteredConnections = connectionsToDestination.filter((connection) => connection.output !== output && (connection.input !== input || input === undefined));\n                        if (filteredConnections.length === 0) {\n                            connections.delete(destinationOrOutput);\n                        }\n                        else {\n                            connections.set(destinationOrOutput, filteredConnections);\n                        }\n                    }\n                }\n            }\n            for (const [destination, connectionsToDestination] of connections) {\n                connectionsToDestination.forEach((connection) => {\n                    if (isNativeAudioNode(destination)) {\n                        nativeAudioNode.connect(destination, connection.output, connection.input);\n                    }\n                    else {\n                        nativeAudioNode.connect(destination, connection.output);\n                    }\n                });\n            }\n        };\n    })(nativeAudioNode.disconnect);\n};\n//# sourceMappingURL=wrap-audio-node-disconnect-method.js.map","import { AUDIO_NODE_STORE, EVENT_LISTENERS } from '../globals';\nimport { isAudioNode } from '../guards/audio-node';\nimport { isAudioNodeOutputConnection } from '../guards/audio-node-output-connection';\nimport { addActiveInputConnectionToAudioParam } from '../helpers/add-active-input-connection-to-audio-param';\nimport { addPassiveInputConnectionToAudioParam } from '../helpers/add-passive-input-connection-to-audio-param';\nimport { connectNativeAudioNodeToNativeAudioNode } from '../helpers/connect-native-audio-node-to-native-audio-node';\nimport { deleteActiveInputConnection } from '../helpers/delete-active-input-connection';\nimport { deleteActiveInputConnectionToAudioParam } from '../helpers/delete-active-input-connection-to-audio-param';\nimport { deleteEventListenerOfAudioNode } from '../helpers/delete-event-listeners-of-audio-node';\nimport { deletePassiveInputConnectionToAudioNode } from '../helpers/delete-passive-input-connection-to-audio-node';\nimport { deletePassiveInputConnectionToAudioParam } from '../helpers/delete-passive-input-connection-to-audio-param';\nimport { disconnectNativeAudioNodeFromNativeAudioNode } from '../helpers/disconnect-native-audio-node-from-native-audio-node';\nimport { getAudioNodeConnections } from '../helpers/get-audio-node-connections';\nimport { getAudioParamConnections } from '../helpers/get-audio-param-connections';\nimport { getEventListenersOfAudioNode } from '../helpers/get-event-listeners-of-audio-node';\nimport { getNativeAudioNode } from '../helpers/get-native-audio-node';\nimport { getNativeAudioParam } from '../helpers/get-native-audio-param';\nimport { insertElementInSet } from '../helpers/insert-element-in-set';\nimport { isActiveAudioNode } from '../helpers/is-active-audio-node';\nimport { isPartOfACycle } from '../helpers/is-part-of-a-cycle';\nimport { isPassiveAudioNode } from '../helpers/is-passive-audio-node';\nimport { setInternalStateToActive } from '../helpers/set-internal-state-to-active';\nimport { setInternalStateToPassiveWhenNecessary } from '../helpers/set-internal-state-to-passive-when-necessary';\nimport { testAudioNodeDisconnectMethodSupport } from '../helpers/test-audio-node-disconnect-method-support';\nimport { visitEachAudioNodeOnce } from '../helpers/visit-each-audio-node-once';\nimport { wrapAudioNodeDisconnectMethod } from '../helpers/wrap-audio-node-disconnect-method';\nconst addConnectionToAudioParamOfAudioContext = (source, destination, output, isOffline) => {\n    const { activeInputs, passiveInputs } = getAudioParamConnections(destination);\n    const { outputs } = getAudioNodeConnections(source);\n    const eventListeners = getEventListenersOfAudioNode(source);\n    const eventListener = (isActive) => {\n        const nativeAudioNode = getNativeAudioNode(source);\n        const nativeAudioParam = getNativeAudioParam(destination);\n        if (isActive) {\n            const partialConnection = deletePassiveInputConnectionToAudioParam(passiveInputs, source, output);\n            addActiveInputConnectionToAudioParam(activeInputs, source, partialConnection, false);\n            if (!isOffline && !isPartOfACycle(source)) {\n                nativeAudioNode.connect(nativeAudioParam, output);\n            }\n        }\n        else {\n            const partialConnection = deleteActiveInputConnectionToAudioParam(activeInputs, source, output);\n            addPassiveInputConnectionToAudioParam(passiveInputs, partialConnection, false);\n            if (!isOffline && !isPartOfACycle(source)) {\n                nativeAudioNode.disconnect(nativeAudioParam, output);\n            }\n        }\n    };\n    if (insertElementInSet(outputs, [destination, output], (outputConnection) => outputConnection[0] === destination && outputConnection[1] === output, true)) {\n        eventListeners.add(eventListener);\n        if (isActiveAudioNode(source)) {\n            addActiveInputConnectionToAudioParam(activeInputs, source, [output, eventListener], true);\n        }\n        else {\n            addPassiveInputConnectionToAudioParam(passiveInputs, [source, output, eventListener], true);\n        }\n        return true;\n    }\n    return false;\n};\nconst deleteInputConnectionOfAudioNode = (source, destination, output, input) => {\n    const { activeInputs, passiveInputs } = getAudioNodeConnections(destination);\n    const activeInputConnection = deleteActiveInputConnection(activeInputs[input], source, output);\n    if (activeInputConnection === null) {\n        const passiveInputConnection = deletePassiveInputConnectionToAudioNode(passiveInputs, source, output, input);\n        return [passiveInputConnection[2], false];\n    }\n    return [activeInputConnection[2], true];\n};\nconst deleteInputConnectionOfAudioParam = (source, destination, output) => {\n    const { activeInputs, passiveInputs } = getAudioParamConnections(destination);\n    const activeInputConnection = deleteActiveInputConnection(activeInputs, source, output);\n    if (activeInputConnection === null) {\n        const passiveInputConnection = deletePassiveInputConnectionToAudioParam(passiveInputs, source, output);\n        return [passiveInputConnection[1], false];\n    }\n    return [activeInputConnection[2], true];\n};\nconst deleteInputsOfAudioNode = (source, isOffline, destination, output, input) => {\n    const [listener, isActive] = deleteInputConnectionOfAudioNode(source, destination, output, input);\n    if (listener !== null) {\n        deleteEventListenerOfAudioNode(source, listener);\n        if (isActive && !isOffline && !isPartOfACycle(source)) {\n            disconnectNativeAudioNodeFromNativeAudioNode(getNativeAudioNode(source), getNativeAudioNode(destination), output, input);\n        }\n    }\n    if (isActiveAudioNode(destination)) {\n        const { activeInputs } = getAudioNodeConnections(destination);\n        setInternalStateToPassiveWhenNecessary(destination, activeInputs);\n    }\n};\nconst deleteInputsOfAudioParam = (source, isOffline, destination, output) => {\n    const [listener, isActive] = deleteInputConnectionOfAudioParam(source, destination, output);\n    if (listener !== null) {\n        deleteEventListenerOfAudioNode(source, listener);\n        if (isActive && !isOffline && !isPartOfACycle(source)) {\n            getNativeAudioNode(source).disconnect(getNativeAudioParam(destination), output);\n        }\n    }\n};\nconst deleteAnyConnection = (source, isOffline) => {\n    const audioNodeConnectionsOfSource = getAudioNodeConnections(source);\n    const destinations = [];\n    for (const outputConnection of audioNodeConnectionsOfSource.outputs) {\n        if (isAudioNodeOutputConnection(outputConnection)) {\n            deleteInputsOfAudioNode(source, isOffline, ...outputConnection);\n        }\n        else {\n            deleteInputsOfAudioParam(source, isOffline, ...outputConnection);\n        }\n        destinations.push(outputConnection[0]);\n    }\n    audioNodeConnectionsOfSource.outputs.clear();\n    return destinations;\n};\nconst deleteConnectionAtOutput = (source, isOffline, output) => {\n    const audioNodeConnectionsOfSource = getAudioNodeConnections(source);\n    const destinations = [];\n    for (const outputConnection of audioNodeConnectionsOfSource.outputs) {\n        if (outputConnection[1] === output) {\n            if (isAudioNodeOutputConnection(outputConnection)) {\n                deleteInputsOfAudioNode(source, isOffline, ...outputConnection);\n            }\n            else {\n                deleteInputsOfAudioParam(source, isOffline, ...outputConnection);\n            }\n            destinations.push(outputConnection[0]);\n            audioNodeConnectionsOfSource.outputs.delete(outputConnection);\n        }\n    }\n    return destinations;\n};\nconst deleteConnectionToDestination = (source, isOffline, destination, output, input) => {\n    const audioNodeConnectionsOfSource = getAudioNodeConnections(source);\n    return Array.from(audioNodeConnectionsOfSource.outputs)\n        .filter((outputConnection) => outputConnection[0] === destination &&\n        (output === undefined || outputConnection[1] === output) &&\n        (input === undefined || outputConnection[2] === input))\n        .map((outputConnection) => {\n        if (isAudioNodeOutputConnection(outputConnection)) {\n            deleteInputsOfAudioNode(source, isOffline, ...outputConnection);\n        }\n        else {\n            deleteInputsOfAudioParam(source, isOffline, ...outputConnection);\n        }\n        audioNodeConnectionsOfSource.outputs.delete(outputConnection);\n        return outputConnection[0];\n    });\n};\nexport const createAudioNodeConstructor = (addAudioNodeConnections, addConnectionToAudioNode, cacheTestResult, createIncrementCycleCounter, createIndexSizeError, createInvalidAccessError, createNotSupportedError, decrementCycleCounter, detectCycles, eventTargetConstructor, getNativeContext, isNativeAudioContext, isNativeAudioNode, isNativeAudioParam, isNativeOfflineAudioContext, nativeAudioWorkletNodeConstructor) => {\n    return class AudioNode extends eventTargetConstructor {\n        constructor(context, isActive, nativeAudioNode, audioNodeRenderer) {\n            super(nativeAudioNode);\n            this._context = context;\n            this._nativeAudioNode = nativeAudioNode;\n            const nativeContext = getNativeContext(context);\n            // Bug #12: Safari does not support to disconnect a specific destination.\n            if (isNativeAudioContext(nativeContext) &&\n                true !==\n                    cacheTestResult(testAudioNodeDisconnectMethodSupport, () => {\n                        return testAudioNodeDisconnectMethodSupport(nativeContext, nativeAudioWorkletNodeConstructor);\n                    })) {\n                wrapAudioNodeDisconnectMethod(nativeAudioNode);\n            }\n            AUDIO_NODE_STORE.set(this, nativeAudioNode);\n            EVENT_LISTENERS.set(this, new Set());\n            if (context.state !== 'closed' && isActive) {\n                setInternalStateToActive(this);\n            }\n            addAudioNodeConnections(this, audioNodeRenderer, nativeAudioNode);\n        }\n        get channelCount() {\n            return this._nativeAudioNode.channelCount;\n        }\n        set channelCount(value) {\n            this._nativeAudioNode.channelCount = value;\n        }\n        get channelCountMode() {\n            return this._nativeAudioNode.channelCountMode;\n        }\n        set channelCountMode(value) {\n            this._nativeAudioNode.channelCountMode = value;\n        }\n        get channelInterpretation() {\n            return this._nativeAudioNode.channelInterpretation;\n        }\n        set channelInterpretation(value) {\n            this._nativeAudioNode.channelInterpretation = value;\n        }\n        get context() {\n            return this._context;\n        }\n        get numberOfInputs() {\n            return this._nativeAudioNode.numberOfInputs;\n        }\n        get numberOfOutputs() {\n            return this._nativeAudioNode.numberOfOutputs;\n        }\n        // tslint:disable-next-line:invalid-void\n        connect(destination, output = 0, input = 0) {\n            // Bug #174: Safari does expose a wrong numberOfOutputs for MediaStreamAudioDestinationNodes.\n            if (output < 0 || output >= this._nativeAudioNode.numberOfOutputs) {\n                throw createIndexSizeError();\n            }\n            const nativeContext = getNativeContext(this._context);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            if (isNativeAudioNode(destination) || isNativeAudioParam(destination)) {\n                throw createInvalidAccessError();\n            }\n            if (isAudioNode(destination)) {\n                const nativeDestinationAudioNode = getNativeAudioNode(destination);\n                try {\n                    const connection = connectNativeAudioNodeToNativeAudioNode(this._nativeAudioNode, nativeDestinationAudioNode, output, input);\n                    const isPassive = isPassiveAudioNode(this);\n                    if (isOffline || isPassive) {\n                        this._nativeAudioNode.disconnect(...connection);\n                    }\n                    if (this.context.state !== 'closed' && !isPassive && isPassiveAudioNode(destination)) {\n                        setInternalStateToActive(destination);\n                    }\n                }\n                catch (err) {\n                    // Bug #41: Safari does not throw the correct exception so far.\n                    if (err.code === 12) {\n                        throw createInvalidAccessError();\n                    }\n                    throw err;\n                }\n                const isNewConnectionToAudioNode = addConnectionToAudioNode(this, destination, output, input, isOffline);\n                // Bug #164: Only Firefox detects cycles so far.\n                if (isNewConnectionToAudioNode) {\n                    const cycles = detectCycles([this], destination);\n                    visitEachAudioNodeOnce(cycles, createIncrementCycleCounter(isOffline));\n                }\n                return destination;\n            }\n            const nativeAudioParam = getNativeAudioParam(destination);\n            /*\n             * Bug #73, #147 & #153: Safari does not support to connect an input signal to the playbackRate AudioParam of an\n             * AudioBufferSourceNode. This can't be easily detected and that's why the outdated name property is used here to identify\n             * Safari. In addition to that the maxValue property is used to only detect the affected versions below v14.0.2.\n             */\n            if (nativeAudioParam.name === 'playbackRate' && nativeAudioParam.maxValue === 1024) {\n                throw createNotSupportedError();\n            }\n            try {\n                this._nativeAudioNode.connect(nativeAudioParam, output);\n                if (isOffline || isPassiveAudioNode(this)) {\n                    this._nativeAudioNode.disconnect(nativeAudioParam, output);\n                }\n            }\n            catch (err) {\n                // Bug #58: Safari doesn't throw an InvalidAccessError yet.\n                if (err.code === 12) {\n                    throw createInvalidAccessError();\n                }\n                throw err;\n            }\n            const isNewConnectionToAudioParam = addConnectionToAudioParamOfAudioContext(this, destination, output, isOffline);\n            // Bug #164: Only Firefox detects cycles so far.\n            if (isNewConnectionToAudioParam) {\n                const cycles = detectCycles([this], destination);\n                visitEachAudioNodeOnce(cycles, createIncrementCycleCounter(isOffline));\n            }\n        }\n        disconnect(destinationOrOutput, output, input) {\n            let destinations;\n            const nativeContext = getNativeContext(this._context);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            if (destinationOrOutput === undefined) {\n                destinations = deleteAnyConnection(this, isOffline);\n            }\n            else if (typeof destinationOrOutput === 'number') {\n                if (destinationOrOutput < 0 || destinationOrOutput >= this.numberOfOutputs) {\n                    throw createIndexSizeError();\n                }\n                destinations = deleteConnectionAtOutput(this, isOffline, destinationOrOutput);\n            }\n            else {\n                if (output !== undefined && (output < 0 || output >= this.numberOfOutputs)) {\n                    throw createIndexSizeError();\n                }\n                if (isAudioNode(destinationOrOutput) && input !== undefined && (input < 0 || input >= destinationOrOutput.numberOfInputs)) {\n                    throw createIndexSizeError();\n                }\n                destinations = deleteConnectionToDestination(this, isOffline, destinationOrOutput, output, input);\n                if (destinations.length === 0) {\n                    throw createInvalidAccessError();\n                }\n            }\n            // Bug #164: Only Firefox detects cycles so far.\n            for (const destination of destinations) {\n                const cycles = detectCycles([this], destination);\n                visitEachAudioNodeOnce(cycles, decrementCycleCounter);\n            }\n        }\n    };\n};\n//# sourceMappingURL=audio-node-constructor.js.map","import { AutomationEventList } from 'automation-events';\nexport const createAudioParamFactory = (addAudioParamConnections, audioParamAudioNodeStore, audioParamStore, createAudioParamRenderer, createCancelAndHoldAutomationEvent, createCancelScheduledValuesAutomationEvent, createExponentialRampToValueAutomationEvent, createLinearRampToValueAutomationEvent, createSetTargetAutomationEvent, createSetValueAutomationEvent, createSetValueCurveAutomationEvent, nativeAudioContextConstructor, setValueAtTimeUntilPossible) => {\n    return (audioNode, isAudioParamOfOfflineAudioContext, nativeAudioParam, maxValue = null, minValue = null) => {\n        // Bug #196 Only Safari sets the defaultValue to the initial value.\n        const defaultValue = nativeAudioParam.value;\n        const automationEventList = new AutomationEventList(defaultValue);\n        const audioParamRenderer = isAudioParamOfOfflineAudioContext ? createAudioParamRenderer(automationEventList) : null;\n        const audioParam = {\n            get defaultValue() {\n                return defaultValue;\n            },\n            get maxValue() {\n                return maxValue === null ? nativeAudioParam.maxValue : maxValue;\n            },\n            get minValue() {\n                return minValue === null ? nativeAudioParam.minValue : minValue;\n            },\n            get value() {\n                return nativeAudioParam.value;\n            },\n            set value(value) {\n                nativeAudioParam.value = value;\n                // Bug #98: Firefox & Safari do not yet treat the value setter like a call to setValueAtTime().\n                audioParam.setValueAtTime(value, audioNode.context.currentTime);\n            },\n            cancelAndHoldAtTime(cancelTime) {\n                // Bug #28: Firefox & Safari do not yet implement cancelAndHoldAtTime().\n                if (typeof nativeAudioParam.cancelAndHoldAtTime === 'function') {\n                    if (audioParamRenderer === null) {\n                        automationEventList.flush(audioNode.context.currentTime);\n                    }\n                    automationEventList.add(createCancelAndHoldAutomationEvent(cancelTime));\n                    nativeAudioParam.cancelAndHoldAtTime(cancelTime);\n                }\n                else {\n                    const previousLastEvent = Array.from(automationEventList).pop();\n                    if (audioParamRenderer === null) {\n                        automationEventList.flush(audioNode.context.currentTime);\n                    }\n                    automationEventList.add(createCancelAndHoldAutomationEvent(cancelTime));\n                    const currentLastEvent = Array.from(automationEventList).pop();\n                    nativeAudioParam.cancelScheduledValues(cancelTime);\n                    if (previousLastEvent !== currentLastEvent && currentLastEvent !== undefined) {\n                        if (currentLastEvent.type === 'exponentialRampToValue') {\n                            nativeAudioParam.exponentialRampToValueAtTime(currentLastEvent.value, currentLastEvent.endTime);\n                        }\n                        else if (currentLastEvent.type === 'linearRampToValue') {\n                            nativeAudioParam.linearRampToValueAtTime(currentLastEvent.value, currentLastEvent.endTime);\n                        }\n                        else if (currentLastEvent.type === 'setValue') {\n                            nativeAudioParam.setValueAtTime(currentLastEvent.value, currentLastEvent.startTime);\n                        }\n                        else if (currentLastEvent.type === 'setValueCurve') {\n                            nativeAudioParam.setValueCurveAtTime(currentLastEvent.values, currentLastEvent.startTime, currentLastEvent.duration);\n                        }\n                    }\n                }\n                return audioParam;\n            },\n            cancelScheduledValues(cancelTime) {\n                if (audioParamRenderer === null) {\n                    automationEventList.flush(audioNode.context.currentTime);\n                }\n                automationEventList.add(createCancelScheduledValuesAutomationEvent(cancelTime));\n                nativeAudioParam.cancelScheduledValues(cancelTime);\n                return audioParam;\n            },\n            exponentialRampToValueAtTime(value, endTime) {\n                // Bug #45: Safari does not throw an error yet.\n                if (value === 0) {\n                    throw new RangeError();\n                }\n                // Bug #187: Safari does not throw an error yet.\n                if (!Number.isFinite(endTime) || endTime < 0) {\n                    throw new RangeError();\n                }\n                const currentTime = audioNode.context.currentTime;\n                if (audioParamRenderer === null) {\n                    automationEventList.flush(currentTime);\n                }\n                // Bug #194: Firefox does not implicitly call setValueAtTime() if there is no previous event.\n                if (Array.from(automationEventList).length === 0) {\n                    automationEventList.add(createSetValueAutomationEvent(defaultValue, currentTime));\n                    nativeAudioParam.setValueAtTime(defaultValue, currentTime);\n                }\n                automationEventList.add(createExponentialRampToValueAutomationEvent(value, endTime));\n                nativeAudioParam.exponentialRampToValueAtTime(value, endTime);\n                return audioParam;\n            },\n            linearRampToValueAtTime(value, endTime) {\n                const currentTime = audioNode.context.currentTime;\n                if (audioParamRenderer === null) {\n                    automationEventList.flush(currentTime);\n                }\n                // Bug #195: Firefox does not implicitly call setValueAtTime() if there is no previous event.\n                if (Array.from(automationEventList).length === 0) {\n                    automationEventList.add(createSetValueAutomationEvent(defaultValue, currentTime));\n                    nativeAudioParam.setValueAtTime(defaultValue, currentTime);\n                }\n                automationEventList.add(createLinearRampToValueAutomationEvent(value, endTime));\n                nativeAudioParam.linearRampToValueAtTime(value, endTime);\n                return audioParam;\n            },\n            setTargetAtTime(target, startTime, timeConstant) {\n                if (audioParamRenderer === null) {\n                    automationEventList.flush(audioNode.context.currentTime);\n                }\n                automationEventList.add(createSetTargetAutomationEvent(target, startTime, timeConstant));\n                nativeAudioParam.setTargetAtTime(target, startTime, timeConstant);\n                return audioParam;\n            },\n            setValueAtTime(value, startTime) {\n                if (audioParamRenderer === null) {\n                    automationEventList.flush(audioNode.context.currentTime);\n                }\n                automationEventList.add(createSetValueAutomationEvent(value, startTime));\n                nativeAudioParam.setValueAtTime(value, startTime);\n                return audioParam;\n            },\n            setValueCurveAtTime(values, startTime, duration) {\n                // Bug 183: Safari only accepts a Float32Array.\n                const convertedValues = values instanceof Float32Array ? values : new Float32Array(values);\n                /*\n                 * Bug #152: Safari does not correctly interpolate the values of the curve.\n                 * @todo Unfortunately there is no way to test for this behavior in a synchronous fashion which is why testing for the\n                 * existence of the webkitAudioContext is used as a workaround here.\n                 */\n                if (nativeAudioContextConstructor !== null && nativeAudioContextConstructor.name === 'webkitAudioContext') {\n                    const endTime = startTime + duration;\n                    const sampleRate = audioNode.context.sampleRate;\n                    const firstSample = Math.ceil(startTime * sampleRate);\n                    const lastSample = Math.floor(endTime * sampleRate);\n                    const numberOfInterpolatedValues = lastSample - firstSample;\n                    const interpolatedValues = new Float32Array(numberOfInterpolatedValues);\n                    for (let i = 0; i < numberOfInterpolatedValues; i += 1) {\n                        const theoreticIndex = ((convertedValues.length - 1) / duration) * ((firstSample + i) / sampleRate - startTime);\n                        const lowerIndex = Math.floor(theoreticIndex);\n                        const upperIndex = Math.ceil(theoreticIndex);\n                        interpolatedValues[i] =\n                            lowerIndex === upperIndex\n                                ? convertedValues[lowerIndex]\n                                : (1 - (theoreticIndex - lowerIndex)) * convertedValues[lowerIndex] +\n                                    (1 - (upperIndex - theoreticIndex)) * convertedValues[upperIndex];\n                    }\n                    if (audioParamRenderer === null) {\n                        automationEventList.flush(audioNode.context.currentTime);\n                    }\n                    automationEventList.add(createSetValueCurveAutomationEvent(interpolatedValues, startTime, duration));\n                    nativeAudioParam.setValueCurveAtTime(interpolatedValues, startTime, duration);\n                    const timeOfLastSample = lastSample / sampleRate;\n                    if (timeOfLastSample < endTime) {\n                        setValueAtTimeUntilPossible(audioParam, interpolatedValues[interpolatedValues.length - 1], timeOfLastSample);\n                    }\n                    setValueAtTimeUntilPossible(audioParam, convertedValues[convertedValues.length - 1], endTime);\n                }\n                else {\n                    if (audioParamRenderer === null) {\n                        automationEventList.flush(audioNode.context.currentTime);\n                    }\n                    automationEventList.add(createSetValueCurveAutomationEvent(convertedValues, startTime, duration));\n                    nativeAudioParam.setValueCurveAtTime(convertedValues, startTime, duration);\n                }\n                return audioParam;\n            }\n        };\n        audioParamStore.set(audioParam, nativeAudioParam);\n        audioParamAudioNodeStore.set(audioParam, audioNode);\n        addAudioParamConnections(audioParam, audioParamRenderer);\n        return audioParam;\n    };\n};\n//# sourceMappingURL=audio-param-factory.js.map","export const createAudioParamRenderer = (automationEventList) => {\n    return {\n        replay(audioParam) {\n            for (const automationEvent of automationEventList) {\n                if (automationEvent.type === 'exponentialRampToValue') {\n                    const { endTime, value } = automationEvent;\n                    audioParam.exponentialRampToValueAtTime(value, endTime);\n                }\n                else if (automationEvent.type === 'linearRampToValue') {\n                    const { endTime, value } = automationEvent;\n                    audioParam.linearRampToValueAtTime(value, endTime);\n                }\n                else if (automationEvent.type === 'setTarget') {\n                    const { startTime, target, timeConstant } = automationEvent;\n                    audioParam.setTargetAtTime(target, startTime, timeConstant);\n                }\n                else if (automationEvent.type === 'setValue') {\n                    const { startTime, value } = automationEvent;\n                    audioParam.setValueAtTime(value, startTime);\n                }\n                else if (automationEvent.type === 'setValueCurve') {\n                    const { duration, startTime, values } = automationEvent;\n                    audioParam.setValueCurveAtTime(values, startTime, duration);\n                }\n                else {\n                    throw new Error(\"Can't apply an unknown automation.\");\n                }\n            }\n        }\n    };\n};\n//# sourceMappingURL=audio-param-renderer.js.map","export class ReadOnlyMap {\n    constructor(parameters) {\n        this._map = new Map(parameters);\n    }\n    get size() {\n        return this._map.size;\n    }\n    entries() {\n        return this._map.entries();\n    }\n    forEach(callback, thisArg = null) {\n        return this._map.forEach((value, key) => callback.call(thisArg, value, key, this));\n    }\n    get(name) {\n        return this._map.get(name);\n    }\n    has(name) {\n        return this._map.has(name);\n    }\n    keys() {\n        return this._map.keys();\n    }\n    values() {\n        return this._map.values();\n    }\n}\n//# sourceMappingURL=read-only-map.js.map","import { NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS } from '../globals';\nimport { ReadOnlyMap } from '../read-only-map';\nconst DEFAULT_OPTIONS = {\n    channelCount: 2,\n    // Bug #61: The channelCountMode should be 'max' according to the spec but is set to 'explicit' to achieve consistent behavior.\n    channelCountMode: 'explicit',\n    channelInterpretation: 'speakers',\n    numberOfInputs: 1,\n    numberOfOutputs: 1,\n    parameterData: {},\n    processorOptions: {}\n};\nexport const createAudioWorkletNodeConstructor = (addUnrenderedAudioWorkletNode, audioNodeConstructor, createAudioParam, createAudioWorkletNodeRenderer, createNativeAudioWorkletNode, getAudioNodeConnections, getBackupOfflineAudioContext, getNativeContext, isNativeOfflineAudioContext, nativeAudioWorkletNodeConstructor, sanitizeAudioWorkletNodeOptions, setActiveAudioWorkletNodeInputs, testAudioWorkletNodeOptionsClonability, wrapEventListener) => {\n    return class AudioWorkletNode extends audioNodeConstructor {\n        constructor(context, name, options) {\n            var _a;\n            const nativeContext = getNativeContext(context);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const mergedOptions = sanitizeAudioWorkletNodeOptions({ ...DEFAULT_OPTIONS, ...options });\n            // Bug #191: Safari doesn't throw an error if the options aren't clonable.\n            testAudioWorkletNodeOptionsClonability(mergedOptions);\n            const nodeNameToProcessorConstructorMap = NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(nativeContext);\n            const processorConstructor = nodeNameToProcessorConstructorMap === null || nodeNameToProcessorConstructorMap === void 0 ? void 0 : nodeNameToProcessorConstructorMap.get(name);\n            // Bug #186: Chrome and Edge do not allow to create an AudioWorkletNode on a closed AudioContext.\n            const nativeContextOrBackupOfflineAudioContext = isOffline || nativeContext.state !== 'closed'\n                ? nativeContext\n                : (_a = getBackupOfflineAudioContext(nativeContext)) !== null && _a !== void 0 ? _a : nativeContext;\n            const nativeAudioWorkletNode = createNativeAudioWorkletNode(nativeContextOrBackupOfflineAudioContext, isOffline ? null : context.baseLatency, nativeAudioWorkletNodeConstructor, name, processorConstructor, mergedOptions);\n            const audioWorkletNodeRenderer = ((isOffline ? createAudioWorkletNodeRenderer(name, mergedOptions, processorConstructor) : null));\n            /*\n             * @todo Add a mechanism to switch an AudioWorkletNode to passive once the process() function of the AudioWorkletProcessor\n             * returns false.\n             */\n            super(context, true, nativeAudioWorkletNode, audioWorkletNodeRenderer);\n            const parameters = [];\n            nativeAudioWorkletNode.parameters.forEach((nativeAudioParam, nm) => {\n                const audioParam = createAudioParam(this, isOffline, nativeAudioParam);\n                parameters.push([nm, audioParam]);\n            });\n            this._nativeAudioWorkletNode = nativeAudioWorkletNode;\n            this._onprocessorerror = null;\n            this._parameters = new ReadOnlyMap(parameters);\n            /*\n             * Bug #86 & #87: Invoking the renderer of an AudioWorkletNode might be necessary if it has no direct or indirect connection to\n             * the destination.\n             */\n            if (isOffline) {\n                addUnrenderedAudioWorkletNode(nativeContext, this);\n            }\n            const { activeInputs } = getAudioNodeConnections(this);\n            setActiveAudioWorkletNodeInputs(nativeAudioWorkletNode, activeInputs);\n        }\n        get onprocessorerror() {\n            return this._onprocessorerror;\n        }\n        set onprocessorerror(value) {\n            const wrappedListener = typeof value === 'function' ? wrapEventListener(this, value) : null;\n            this._nativeAudioWorkletNode.onprocessorerror = wrappedListener;\n            const nativeOnProcessorError = this._nativeAudioWorkletNode.onprocessorerror;\n            this._onprocessorerror =\n                nativeOnProcessorError !== null && nativeOnProcessorError === wrappedListener\n                    ? value\n                    : nativeOnProcessorError;\n        }\n        get parameters() {\n            if (this._parameters === null) {\n                // @todo The definition that TypeScript uses of the AudioParamMap is lacking many methods.\n                return this._nativeAudioWorkletNode.parameters;\n            }\n            return this._parameters;\n        }\n        get port() {\n            return this._nativeAudioWorkletNode.port;\n        }\n    };\n};\n//# sourceMappingURL=audio-worklet-node-constructor.js.map","export function copyFromChannel(audioBuffer, \n// @todo There is currently no way to define something like { [ key: number | string ]: Float32Array }\nparent, key, channelNumber, bufferOffset) {\n    if (typeof audioBuffer.copyFromChannel === 'function') {\n        // The byteLength will be 0 when the ArrayBuffer was transferred.\n        if (parent[key].byteLength === 0) {\n            parent[key] = new Float32Array(128);\n        }\n        audioBuffer.copyFromChannel(parent[key], channelNumber, bufferOffset);\n        // Bug #5: Safari does not support copyFromChannel().\n    }\n    else {\n        const channelData = audioBuffer.getChannelData(channelNumber);\n        // The byteLength will be 0 when the ArrayBuffer was transferred.\n        if (parent[key].byteLength === 0) {\n            parent[key] = channelData.slice(bufferOffset, bufferOffset + 128);\n        }\n        else {\n            const slicedInput = new Float32Array(channelData.buffer, bufferOffset * Float32Array.BYTES_PER_ELEMENT, 128);\n            parent[key].set(slicedInput);\n        }\n    }\n}\n//# sourceMappingURL=copy-from-channel.js.map","export const copyToChannel = (audioBuffer, parent, key, channelNumber, bufferOffset) => {\n    if (typeof audioBuffer.copyToChannel === 'function') {\n        // The byteLength will be 0 when the ArrayBuffer was transferred.\n        if (parent[key].byteLength !== 0) {\n            audioBuffer.copyToChannel(parent[key], channelNumber, bufferOffset);\n        }\n        // Bug #5: Safari does not support copyToChannel().\n    }\n    else {\n        // The byteLength will be 0 when the ArrayBuffer was transferred.\n        if (parent[key].byteLength !== 0) {\n            audioBuffer.getChannelData(channelNumber).set(parent[key], bufferOffset);\n        }\n    }\n};\n//# sourceMappingURL=copy-to-channel.js.map","export const createNestedArrays = (x, y) => {\n    const arrays = [];\n    for (let i = 0; i < x; i += 1) {\n        const array = [];\n        const length = typeof y === 'number' ? y : y[i];\n        for (let j = 0; j < length; j += 1) {\n            array.push(new Float32Array(128));\n        }\n        arrays.push(array);\n    }\n    return arrays;\n};\n//# sourceMappingURL=create-nested-arrays.js.map","import { NODE_TO_PROCESSOR_MAPS } from '../globals';\nimport { getNativeAudioNode } from './get-native-audio-node';\nimport { getValueForKey } from './get-value-for-key';\nexport const getAudioWorkletProcessor = (nativeOfflineAudioContext, proxy) => {\n    const nodeToProcessorMap = getValueForKey(NODE_TO_PROCESSOR_MAPS, nativeOfflineAudioContext);\n    const nativeAudioWorkletNode = getNativeAudioNode(proxy);\n    return getValueForKey(nodeToProcessorMap, nativeAudioWorkletNode);\n};\n//# sourceMappingURL=get-audio-worklet-processor.js.map","import { copyFromChannel } from '../helpers/copy-from-channel';\nimport { copyToChannel } from '../helpers/copy-to-channel';\nimport { createNestedArrays } from '../helpers/create-nested-arrays';\nimport { getAudioNodeConnections } from '../helpers/get-audio-node-connections';\nimport { getAudioWorkletProcessor } from '../helpers/get-audio-worklet-processor';\nimport { isOwnedByContext } from '../helpers/is-owned-by-context';\nconst processBuffer = async (proxy, renderedBuffer, nativeOfflineAudioContext, options, outputChannelCount, processorConstructor, exposeCurrentFrameAndCurrentTime) => {\n    // Ceil the length to the next full render quantum.\n    // Bug #17: Safari does not yet expose the length.\n    const length = renderedBuffer === null ? Math.ceil(proxy.context.length / 128) * 128 : renderedBuffer.length;\n    const numberOfInputChannels = options.channelCount * options.numberOfInputs;\n    const numberOfOutputChannels = outputChannelCount.reduce((sum, value) => sum + value, 0);\n    const processedBuffer = numberOfOutputChannels === 0\n        ? null\n        : nativeOfflineAudioContext.createBuffer(numberOfOutputChannels, length, nativeOfflineAudioContext.sampleRate);\n    if (processorConstructor === undefined) {\n        throw new Error('Missing the processor constructor.');\n    }\n    const audioNodeConnections = getAudioNodeConnections(proxy);\n    const audioWorkletProcessor = await getAudioWorkletProcessor(nativeOfflineAudioContext, proxy);\n    const inputs = createNestedArrays(options.numberOfInputs, options.channelCount);\n    const outputs = createNestedArrays(options.numberOfOutputs, outputChannelCount);\n    const parameters = Array.from(proxy.parameters.keys()).reduce((prmtrs, name) => ({ ...prmtrs, [name]: new Float32Array(128) }), {});\n    for (let i = 0; i < length; i += 128) {\n        if (options.numberOfInputs > 0 && renderedBuffer !== null) {\n            for (let j = 0; j < options.numberOfInputs; j += 1) {\n                for (let k = 0; k < options.channelCount; k += 1) {\n                    copyFromChannel(renderedBuffer, inputs[j], k, k, i);\n                }\n            }\n        }\n        if (processorConstructor.parameterDescriptors !== undefined && renderedBuffer !== null) {\n            processorConstructor.parameterDescriptors.forEach(({ name }, index) => {\n                copyFromChannel(renderedBuffer, parameters, name, numberOfInputChannels + index, i);\n            });\n        }\n        for (let j = 0; j < options.numberOfInputs; j += 1) {\n            for (let k = 0; k < outputChannelCount[j]; k += 1) {\n                // The byteLength will be 0 when the ArrayBuffer was transferred.\n                if (outputs[j][k].byteLength === 0) {\n                    outputs[j][k] = new Float32Array(128);\n                }\n            }\n        }\n        try {\n            const potentiallyEmptyInputs = inputs.map((input, index) => {\n                if (audioNodeConnections.activeInputs[index].size === 0) {\n                    return [];\n                }\n                return input;\n            });\n            const activeSourceFlag = exposeCurrentFrameAndCurrentTime(i / nativeOfflineAudioContext.sampleRate, nativeOfflineAudioContext.sampleRate, () => audioWorkletProcessor.process(potentiallyEmptyInputs, outputs, parameters));\n            if (processedBuffer !== null) {\n                for (let j = 0, outputChannelSplitterNodeOutput = 0; j < options.numberOfOutputs; j += 1) {\n                    for (let k = 0; k < outputChannelCount[j]; k += 1) {\n                        copyToChannel(processedBuffer, outputs[j], k, outputChannelSplitterNodeOutput + k, i);\n                    }\n                    outputChannelSplitterNodeOutput += outputChannelCount[j];\n                }\n            }\n            if (!activeSourceFlag) {\n                break;\n            }\n        }\n        catch (error) {\n            proxy.dispatchEvent(new ErrorEvent('processorerror', {\n                colno: error.colno,\n                filename: error.filename,\n                lineno: error.lineno,\n                message: error.message\n            }));\n            break;\n        }\n    }\n    return processedBuffer;\n};\nexport const createAudioWorkletNodeRendererFactory = (connectAudioParam, connectMultipleOutputs, createNativeAudioBufferSourceNode, createNativeChannelMergerNode, createNativeChannelSplitterNode, createNativeConstantSourceNode, createNativeGainNode, deleteUnrenderedAudioWorkletNode, disconnectMultipleOutputs, exposeCurrentFrameAndCurrentTime, getNativeAudioNode, nativeAudioWorkletNodeConstructor, nativeOfflineAudioContextConstructor, renderAutomation, renderInputsOfAudioNode, renderNativeOfflineAudioContext) => {\n    return (name, options, processorConstructor) => {\n        const renderedNativeAudioNodes = new WeakMap();\n        let processedBufferPromise = null;\n        const createAudioNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeAudioWorkletNode = getNativeAudioNode(proxy);\n            let nativeOutputNodes = null;\n            const nativeAudioWorkletNodeIsOwnedByContext = isOwnedByContext(nativeAudioWorkletNode, nativeOfflineAudioContext);\n            const outputChannelCount = Array.isArray(options.outputChannelCount)\n                ? options.outputChannelCount\n                : Array.from(options.outputChannelCount);\n            // Bug #61: Only Chrome, Edge & Firefox have an implementation of the AudioWorkletNode yet.\n            if (nativeAudioWorkletNodeConstructor === null) {\n                const numberOfOutputChannels = outputChannelCount.reduce((sum, value) => sum + value, 0);\n                const outputChannelSplitterNode = createNativeChannelSplitterNode(nativeOfflineAudioContext, {\n                    channelCount: Math.max(1, numberOfOutputChannels),\n                    channelCountMode: 'explicit',\n                    channelInterpretation: 'discrete',\n                    numberOfOutputs: Math.max(1, numberOfOutputChannels)\n                });\n                const outputChannelMergerNodes = [];\n                for (let i = 0; i < proxy.numberOfOutputs; i += 1) {\n                    outputChannelMergerNodes.push(createNativeChannelMergerNode(nativeOfflineAudioContext, {\n                        channelCount: 1,\n                        channelCountMode: 'explicit',\n                        channelInterpretation: 'speakers',\n                        numberOfInputs: outputChannelCount[i]\n                    }));\n                }\n                const outputGainNode = createNativeGainNode(nativeOfflineAudioContext, {\n                    channelCount: options.channelCount,\n                    channelCountMode: options.channelCountMode,\n                    channelInterpretation: options.channelInterpretation,\n                    gain: 1\n                });\n                outputGainNode.connect = connectMultipleOutputs.bind(null, outputChannelMergerNodes);\n                outputGainNode.disconnect = disconnectMultipleOutputs.bind(null, outputChannelMergerNodes);\n                nativeOutputNodes = [outputChannelSplitterNode, outputChannelMergerNodes, outputGainNode];\n            }\n            else if (!nativeAudioWorkletNodeIsOwnedByContext) {\n                nativeAudioWorkletNode = new nativeAudioWorkletNodeConstructor(nativeOfflineAudioContext, name);\n            }\n            renderedNativeAudioNodes.set(nativeOfflineAudioContext, nativeOutputNodes === null ? nativeAudioWorkletNode : nativeOutputNodes[2]);\n            if (nativeOutputNodes !== null) {\n                if (processedBufferPromise === null) {\n                    if (processorConstructor === undefined) {\n                        throw new Error('Missing the processor constructor.');\n                    }\n                    if (nativeOfflineAudioContextConstructor === null) {\n                        throw new Error('Missing the native OfflineAudioContext constructor.');\n                    }\n                    // Bug #47: The AudioDestinationNode in Safari gets not initialized correctly.\n                    const numberOfInputChannels = proxy.channelCount * proxy.numberOfInputs;\n                    const numberOfParameters = processorConstructor.parameterDescriptors === undefined ? 0 : processorConstructor.parameterDescriptors.length;\n                    const numberOfChannels = numberOfInputChannels + numberOfParameters;\n                    const renderBuffer = async () => {\n                        const partialOfflineAudioContext = new nativeOfflineAudioContextConstructor(numberOfChannels, \n                        // Ceil the length to the next full render quantum.\n                        // Bug #17: Safari does not yet expose the length.\n                        Math.ceil(proxy.context.length / 128) * 128, nativeOfflineAudioContext.sampleRate);\n                        const gainNodes = [];\n                        const inputChannelSplitterNodes = [];\n                        for (let i = 0; i < options.numberOfInputs; i += 1) {\n                            gainNodes.push(createNativeGainNode(partialOfflineAudioContext, {\n                                channelCount: options.channelCount,\n                                channelCountMode: options.channelCountMode,\n                                channelInterpretation: options.channelInterpretation,\n                                gain: 1\n                            }));\n                            inputChannelSplitterNodes.push(createNativeChannelSplitterNode(partialOfflineAudioContext, {\n                                channelCount: options.channelCount,\n                                channelCountMode: 'explicit',\n                                channelInterpretation: 'discrete',\n                                numberOfOutputs: options.channelCount\n                            }));\n                        }\n                        const constantSourceNodes = await Promise.all(Array.from(proxy.parameters.values()).map(async (audioParam) => {\n                            const constantSourceNode = createNativeConstantSourceNode(partialOfflineAudioContext, {\n                                channelCount: 1,\n                                channelCountMode: 'explicit',\n                                channelInterpretation: 'discrete',\n                                offset: audioParam.value\n                            });\n                            await renderAutomation(partialOfflineAudioContext, audioParam, constantSourceNode.offset);\n                            return constantSourceNode;\n                        }));\n                        const inputChannelMergerNode = createNativeChannelMergerNode(partialOfflineAudioContext, {\n                            channelCount: 1,\n                            channelCountMode: 'explicit',\n                            channelInterpretation: 'speakers',\n                            numberOfInputs: Math.max(1, numberOfInputChannels + numberOfParameters)\n                        });\n                        for (let i = 0; i < options.numberOfInputs; i += 1) {\n                            gainNodes[i].connect(inputChannelSplitterNodes[i]);\n                            for (let j = 0; j < options.channelCount; j += 1) {\n                                inputChannelSplitterNodes[i].connect(inputChannelMergerNode, j, i * options.channelCount + j);\n                            }\n                        }\n                        for (const [index, constantSourceNode] of constantSourceNodes.entries()) {\n                            constantSourceNode.connect(inputChannelMergerNode, 0, numberOfInputChannels + index);\n                            constantSourceNode.start(0);\n                        }\n                        inputChannelMergerNode.connect(partialOfflineAudioContext.destination);\n                        await Promise.all(gainNodes.map((gainNode) => renderInputsOfAudioNode(proxy, partialOfflineAudioContext, gainNode)));\n                        return renderNativeOfflineAudioContext(partialOfflineAudioContext);\n                    };\n                    processedBufferPromise = processBuffer(proxy, numberOfChannels === 0 ? null : await renderBuffer(), nativeOfflineAudioContext, options, outputChannelCount, processorConstructor, exposeCurrentFrameAndCurrentTime);\n                }\n                const processedBuffer = await processedBufferPromise;\n                const audioBufferSourceNode = createNativeAudioBufferSourceNode(nativeOfflineAudioContext, {\n                    buffer: null,\n                    channelCount: 2,\n                    channelCountMode: 'max',\n                    channelInterpretation: 'speakers',\n                    loop: false,\n                    loopEnd: 0,\n                    loopStart: 0,\n                    playbackRate: 1\n                });\n                const [outputChannelSplitterNode, outputChannelMergerNodes, outputGainNode] = nativeOutputNodes;\n                if (processedBuffer !== null) {\n                    audioBufferSourceNode.buffer = processedBuffer;\n                    audioBufferSourceNode.start(0);\n                }\n                audioBufferSourceNode.connect(outputChannelSplitterNode);\n                for (let i = 0, outputChannelSplitterNodeOutput = 0; i < proxy.numberOfOutputs; i += 1) {\n                    const outputChannelMergerNode = outputChannelMergerNodes[i];\n                    for (let j = 0; j < outputChannelCount[i]; j += 1) {\n                        outputChannelSplitterNode.connect(outputChannelMergerNode, outputChannelSplitterNodeOutput + j, j);\n                    }\n                    outputChannelSplitterNodeOutput += outputChannelCount[i];\n                }\n                return outputGainNode;\n            }\n            if (!nativeAudioWorkletNodeIsOwnedByContext) {\n                for (const [nm, audioParam] of proxy.parameters.entries()) {\n                    await renderAutomation(nativeOfflineAudioContext, audioParam, \n                    // @todo The definition that TypeScript uses of the AudioParamMap is lacking many methods.\n                    nativeAudioWorkletNode.parameters.get(nm));\n                }\n            }\n            else {\n                for (const [nm, audioParam] of proxy.parameters.entries()) {\n                    await connectAudioParam(nativeOfflineAudioContext, audioParam, \n                    // @todo The definition that TypeScript uses of the AudioParamMap is lacking many methods.\n                    nativeAudioWorkletNode.parameters.get(nm));\n                }\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeAudioWorkletNode);\n            return nativeAudioWorkletNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                deleteUnrenderedAudioWorkletNode(nativeOfflineAudioContext, proxy);\n                const renderedNativeAudioWorkletNodeOrGainNode = renderedNativeAudioNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeAudioWorkletNodeOrGainNode !== undefined) {\n                    return Promise.resolve(renderedNativeAudioWorkletNodeOrGainNode);\n                }\n                return createAudioNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=audio-worklet-node-renderer-factory.js.map","export const createBaseAudioContextConstructor = (addAudioWorkletModule, analyserNodeConstructor, audioBufferConstructor, audioBufferSourceNodeConstructor, biquadFilterNodeConstructor, channelMergerNodeConstructor, channelSplitterNodeConstructor, constantSourceNodeConstructor, convolverNodeConstructor, decodeAudioData, delayNodeConstructor, dynamicsCompressorNodeConstructor, gainNodeConstructor, iIRFilterNodeConstructor, minimalBaseAudioContextConstructor, oscillatorNodeConstructor, pannerNodeConstructor, periodicWaveConstructor, stereoPannerNodeConstructor, waveShaperNodeConstructor) => {\n    return class BaseAudioContext extends minimalBaseAudioContextConstructor {\n        constructor(_nativeContext, numberOfChannels) {\n            super(_nativeContext, numberOfChannels);\n            this._nativeContext = _nativeContext;\n            this._audioWorklet =\n                addAudioWorkletModule === undefined\n                    ? undefined\n                    : {\n                        addModule: (moduleURL, options) => {\n                            return addAudioWorkletModule(this, moduleURL, options);\n                        }\n                    };\n        }\n        get audioWorklet() {\n            return this._audioWorklet;\n        }\n        createAnalyser() {\n            return new analyserNodeConstructor(this);\n        }\n        createBiquadFilter() {\n            return new biquadFilterNodeConstructor(this);\n        }\n        createBuffer(numberOfChannels, length, sampleRate) {\n            return new audioBufferConstructor({ length, numberOfChannels, sampleRate });\n        }\n        createBufferSource() {\n            return new audioBufferSourceNodeConstructor(this);\n        }\n        createChannelMerger(numberOfInputs = 6) {\n            return new channelMergerNodeConstructor(this, { numberOfInputs });\n        }\n        createChannelSplitter(numberOfOutputs = 6) {\n            return new channelSplitterNodeConstructor(this, { numberOfOutputs });\n        }\n        createConstantSource() {\n            return new constantSourceNodeConstructor(this);\n        }\n        createConvolver() {\n            return new convolverNodeConstructor(this);\n        }\n        createDelay(maxDelayTime = 1) {\n            return new delayNodeConstructor(this, { maxDelayTime });\n        }\n        createDynamicsCompressor() {\n            return new dynamicsCompressorNodeConstructor(this);\n        }\n        createGain() {\n            return new gainNodeConstructor(this);\n        }\n        createIIRFilter(feedforward, feedback) {\n            return new iIRFilterNodeConstructor(this, { feedback, feedforward });\n        }\n        createOscillator() {\n            return new oscillatorNodeConstructor(this);\n        }\n        createPanner() {\n            return new pannerNodeConstructor(this);\n        }\n        createPeriodicWave(real, imag, constraints = { disableNormalization: false }) {\n            return new periodicWaveConstructor(this, { ...constraints, imag, real });\n        }\n        createStereoPanner() {\n            return new stereoPannerNodeConstructor(this);\n        }\n        createWaveShaper() {\n            return new waveShaperNodeConstructor(this);\n        }\n        decodeAudioData(audioData, successCallback, errorCallback) {\n            return decodeAudioData(this._nativeContext, audioData).then((audioBuffer) => {\n                if (typeof successCallback === 'function') {\n                    successCallback(audioBuffer);\n                }\n                return audioBuffer;\n            }, (err) => {\n                if (typeof errorCallback === 'function') {\n                    errorCallback(err);\n                }\n                throw err;\n            });\n        }\n    };\n};\n//# sourceMappingURL=base-audio-context-constructor.js.map","import { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nconst DEFAULT_OPTIONS = {\n    Q: 1,\n    channelCount: 2,\n    channelCountMode: 'max',\n    channelInterpretation: 'speakers',\n    detune: 0,\n    frequency: 350,\n    gain: 0,\n    type: 'lowpass'\n};\nexport const createBiquadFilterNodeConstructor = (audioNodeConstructor, createAudioParam, createBiquadFilterNodeRenderer, createInvalidAccessError, createNativeBiquadFilterNode, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime) => {\n    return class BiquadFilterNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeBiquadFilterNode = createNativeBiquadFilterNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const biquadFilterNodeRenderer = (isOffline ? createBiquadFilterNodeRenderer() : null);\n            super(context, false, nativeBiquadFilterNode, biquadFilterNodeRenderer);\n            // Bug #80: Safari does not export the correct values for maxValue and minValue.\n            this._Q = createAudioParam(this, isOffline, nativeBiquadFilterNode.Q, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n            // Bug #78: Firefox & Safari do not export the correct values for maxValue and minValue.\n            this._detune = createAudioParam(this, isOffline, nativeBiquadFilterNode.detune, 1200 * Math.log2(MOST_POSITIVE_SINGLE_FLOAT), -1200 * Math.log2(MOST_POSITIVE_SINGLE_FLOAT));\n            // Bug #77: Firefox & Safari do not export the correct value for minValue.\n            this._frequency = createAudioParam(this, isOffline, nativeBiquadFilterNode.frequency, context.sampleRate / 2, 0);\n            // Bug #79: Firefox & Safari do not export the correct values for maxValue and minValue.\n            this._gain = createAudioParam(this, isOffline, nativeBiquadFilterNode.gain, 40 * Math.log10(MOST_POSITIVE_SINGLE_FLOAT), MOST_NEGATIVE_SINGLE_FLOAT);\n            this._nativeBiquadFilterNode = nativeBiquadFilterNode;\n            // @todo Determine a meaningful tail-time instead of just using one second.\n            setAudioNodeTailTime(this, 1);\n        }\n        get detune() {\n            return this._detune;\n        }\n        get frequency() {\n            return this._frequency;\n        }\n        get gain() {\n            return this._gain;\n        }\n        get Q() {\n            return this._Q;\n        }\n        get type() {\n            return this._nativeBiquadFilterNode.type;\n        }\n        set type(value) {\n            this._nativeBiquadFilterNode.type = value;\n        }\n        getFrequencyResponse(frequencyHz, magResponse, phaseResponse) {\n            // Bug #189: Safari does throw an InvalidStateError.\n            try {\n                this._nativeBiquadFilterNode.getFrequencyResponse(frequencyHz, magResponse, phaseResponse);\n            }\n            catch (err) {\n                if (err.code === 11) {\n                    throw createInvalidAccessError();\n                }\n                throw err;\n            }\n            // Bug #68: Safari does not throw an error if the parameters differ in their length.\n            if (frequencyHz.length !== magResponse.length || magResponse.length !== phaseResponse.length) {\n                throw createInvalidAccessError();\n            }\n        }\n    };\n};\n//# sourceMappingURL=biquad-filter-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createBiquadFilterNodeRendererFactory = (connectAudioParam, createNativeBiquadFilterNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeBiquadFilterNodes = new WeakMap();\n        const createBiquadFilterNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeBiquadFilterNode = getNativeAudioNode(proxy);\n            /*\n             * If the initially used nativeBiquadFilterNode was not constructed on the same OfflineAudioContext it needs to be created\n             * again.\n             */\n            const nativeBiquadFilterNodeIsOwnedByContext = isOwnedByContext(nativeBiquadFilterNode, nativeOfflineAudioContext);\n            if (!nativeBiquadFilterNodeIsOwnedByContext) {\n                const options = {\n                    Q: nativeBiquadFilterNode.Q.value,\n                    channelCount: nativeBiquadFilterNode.channelCount,\n                    channelCountMode: nativeBiquadFilterNode.channelCountMode,\n                    channelInterpretation: nativeBiquadFilterNode.channelInterpretation,\n                    detune: nativeBiquadFilterNode.detune.value,\n                    frequency: nativeBiquadFilterNode.frequency.value,\n                    gain: nativeBiquadFilterNode.gain.value,\n                    type: nativeBiquadFilterNode.type\n                };\n                nativeBiquadFilterNode = createNativeBiquadFilterNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeBiquadFilterNodes.set(nativeOfflineAudioContext, nativeBiquadFilterNode);\n            if (!nativeBiquadFilterNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.Q, nativeBiquadFilterNode.Q);\n                await renderAutomation(nativeOfflineAudioContext, proxy.detune, nativeBiquadFilterNode.detune);\n                await renderAutomation(nativeOfflineAudioContext, proxy.frequency, nativeBiquadFilterNode.frequency);\n                await renderAutomation(nativeOfflineAudioContext, proxy.gain, nativeBiquadFilterNode.gain);\n            }\n            else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.Q, nativeBiquadFilterNode.Q);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.detune, nativeBiquadFilterNode.detune);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.frequency, nativeBiquadFilterNode.frequency);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.gain, nativeBiquadFilterNode.gain);\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeBiquadFilterNode);\n            return nativeBiquadFilterNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeBiquadFilterNode = renderedNativeBiquadFilterNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeBiquadFilterNode !== undefined) {\n                    return Promise.resolve(renderedNativeBiquadFilterNode);\n                }\n                return createBiquadFilterNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=biquad-filter-node-renderer-factory.js.map","export const createCacheTestResult = (ongoingTests, testResults) => {\n    return (tester, test) => {\n        const cachedTestResult = testResults.get(tester);\n        if (cachedTestResult !== undefined) {\n            return cachedTestResult;\n        }\n        const ongoingTest = ongoingTests.get(tester);\n        if (ongoingTest !== undefined) {\n            return ongoingTest;\n        }\n        try {\n            const synchronousTestResult = test();\n            if (synchronousTestResult instanceof Promise) {\n                ongoingTests.set(tester, synchronousTestResult);\n                return synchronousTestResult\n                    .catch(() => false)\n                    .then((finalTestResult) => {\n                    ongoingTests.delete(tester);\n                    testResults.set(tester, finalTestResult);\n                    return finalTestResult;\n                });\n            }\n            testResults.set(tester, synchronousTestResult);\n            return synchronousTestResult;\n        }\n        catch {\n            testResults.set(tester, false);\n            return false;\n        }\n    };\n};\n//# sourceMappingURL=cache-test-result.js.map","const DEFAULT_OPTIONS = {\n    channelCount: 1,\n    channelCountMode: 'explicit',\n    channelInterpretation: 'speakers',\n    numberOfInputs: 6\n};\nexport const createChannelMergerNodeConstructor = (audioNodeConstructor, createChannelMergerNodeRenderer, createNativeChannelMergerNode, getNativeContext, isNativeOfflineAudioContext) => {\n    return class ChannelMergerNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeChannelMergerNode = createNativeChannelMergerNode(nativeContext, mergedOptions);\n            const channelMergerNodeRenderer = ((isNativeOfflineAudioContext(nativeContext) ? createChannelMergerNodeRenderer() : null));\n            super(context, false, nativeChannelMergerNode, channelMergerNodeRenderer);\n        }\n    };\n};\n//# sourceMappingURL=channel-merger-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createChannelMergerNodeRendererFactory = (createNativeChannelMergerNode, getNativeAudioNode, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeAudioNodes = new WeakMap();\n        const createAudioNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeAudioNode = getNativeAudioNode(proxy);\n            // If the initially used nativeAudioNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeAudioNodeIsOwnedByContext = isOwnedByContext(nativeAudioNode, nativeOfflineAudioContext);\n            if (!nativeAudioNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeAudioNode.channelCount,\n                    channelCountMode: nativeAudioNode.channelCountMode,\n                    channelInterpretation: nativeAudioNode.channelInterpretation,\n                    numberOfInputs: nativeAudioNode.numberOfInputs\n                };\n                nativeAudioNode = createNativeChannelMergerNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeAudioNodes.set(nativeOfflineAudioContext, nativeAudioNode);\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeAudioNode);\n            return nativeAudioNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeAudioNode = renderedNativeAudioNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeAudioNode !== undefined) {\n                    return Promise.resolve(renderedNativeAudioNode);\n                }\n                return createAudioNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=channel-merger-node-renderer-factory.js.map","const DEFAULT_OPTIONS = {\n    channelCount: 6,\n    channelCountMode: 'explicit',\n    channelInterpretation: 'discrete',\n    numberOfOutputs: 6\n};\nexport const createChannelSplitterNodeConstructor = (audioNodeConstructor, createChannelSplitterNodeRenderer, createNativeChannelSplitterNode, getNativeContext, isNativeOfflineAudioContext, sanitizeChannelSplitterOptions) => {\n    return class ChannelSplitterNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = sanitizeChannelSplitterOptions({ ...DEFAULT_OPTIONS, ...options });\n            const nativeChannelSplitterNode = createNativeChannelSplitterNode(nativeContext, mergedOptions);\n            const channelSplitterNodeRenderer = ((isNativeOfflineAudioContext(nativeContext) ? createChannelSplitterNodeRenderer() : null));\n            super(context, false, nativeChannelSplitterNode, channelSplitterNodeRenderer);\n        }\n    };\n};\n//# sourceMappingURL=channel-splitter-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createChannelSplitterNodeRendererFactory = (createNativeChannelSplitterNode, getNativeAudioNode, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeAudioNodes = new WeakMap();\n        const createAudioNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeAudioNode = getNativeAudioNode(proxy);\n            // If the initially used nativeAudioNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeAudioNodeIsOwnedByContext = isOwnedByContext(nativeAudioNode, nativeOfflineAudioContext);\n            if (!nativeAudioNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeAudioNode.channelCount,\n                    channelCountMode: nativeAudioNode.channelCountMode,\n                    channelInterpretation: nativeAudioNode.channelInterpretation,\n                    numberOfOutputs: nativeAudioNode.numberOfOutputs\n                };\n                nativeAudioNode = createNativeChannelSplitterNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeAudioNodes.set(nativeOfflineAudioContext, nativeAudioNode);\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeAudioNode);\n            return nativeAudioNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeAudioNode = renderedNativeAudioNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeAudioNode !== undefined) {\n                    return Promise.resolve(renderedNativeAudioNode);\n                }\n                return createAudioNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=channel-splitter-node-renderer-factory.js.map","export const createConnectAudioParam = (renderInputsOfAudioParam) => {\n    return (nativeOfflineAudioContext, audioParam, nativeAudioParam) => {\n        return renderInputsOfAudioParam(audioParam, nativeOfflineAudioContext, nativeAudioParam);\n    };\n};\n//# sourceMappingURL=connect-audio-param.js.map","import { isNativeAudioNode } from '../guards/native-audio-node';\nexport const createConnectMultipleOutputs = (createIndexSizeError) => {\n    return (outputAudioNodes, destination, output = 0, input = 0) => {\n        const outputAudioNode = outputAudioNodes[output];\n        if (outputAudioNode === undefined) {\n            throw createIndexSizeError();\n        }\n        if (isNativeAudioNode(destination)) {\n            return outputAudioNode.connect(destination, 0, input);\n        }\n        return outputAudioNode.connect(destination, 0);\n    };\n};\n//# sourceMappingURL=connect-multiple-outputs.js.map","export const createConnectedNativeAudioBufferSourceNodeFactory = (createNativeAudioBufferSourceNode) => {\n    return (nativeContext, nativeAudioNode) => {\n        const nativeAudioBufferSourceNode = createNativeAudioBufferSourceNode(nativeContext, {\n            buffer: null,\n            channelCount: 2,\n            channelCountMode: 'max',\n            channelInterpretation: 'speakers',\n            loop: false,\n            loopEnd: 0,\n            loopStart: 0,\n            playbackRate: 1\n        });\n        const nativeAudioBuffer = nativeContext.createBuffer(1, 2, 44100);\n        nativeAudioBufferSourceNode.buffer = nativeAudioBuffer;\n        nativeAudioBufferSourceNode.loop = true;\n        nativeAudioBufferSourceNode.connect(nativeAudioNode);\n        nativeAudioBufferSourceNode.start();\n        return () => {\n            nativeAudioBufferSourceNode.stop();\n            nativeAudioBufferSourceNode.disconnect(nativeAudioNode);\n        };\n    };\n};\n//# sourceMappingURL=connected-native-audio-buffer-source-node-factory.js.map","import { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nimport { isActiveAudioNode } from '../helpers/is-active-audio-node';\nimport { setInternalStateToActive } from '../helpers/set-internal-state-to-active';\nimport { setInternalStateToPassive } from '../helpers/set-internal-state-to-passive';\nconst DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'max',\n    channelInterpretation: 'speakers',\n    offset: 1\n};\nexport const createConstantSourceNodeConstructor = (audioNodeConstructor, createAudioParam, createConstantSourceNodeRendererFactory, createNativeConstantSourceNode, getNativeContext, isNativeOfflineAudioContext, wrapEventListener) => {\n    return class ConstantSourceNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeConstantSourceNode = createNativeConstantSourceNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const constantSourceNodeRenderer = ((isOffline ? createConstantSourceNodeRendererFactory() : null));\n            super(context, false, nativeConstantSourceNode, constantSourceNodeRenderer);\n            this._constantSourceNodeRenderer = constantSourceNodeRenderer;\n            this._nativeConstantSourceNode = nativeConstantSourceNode;\n            /*\n             * Bug #62 & #74: Safari does not support ConstantSourceNodes and does not export the correct values for maxValue and minValue\n             * for GainNodes.\n             */\n            this._offset = createAudioParam(this, isOffline, nativeConstantSourceNode.offset, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n            this._onended = null;\n        }\n        get offset() {\n            return this._offset;\n        }\n        get onended() {\n            return this._onended;\n        }\n        set onended(value) {\n            const wrappedListener = typeof value === 'function' ? wrapEventListener(this, value) : null;\n            this._nativeConstantSourceNode.onended = wrappedListener;\n            const nativeOnEnded = this._nativeConstantSourceNode.onended;\n            this._onended = nativeOnEnded !== null && nativeOnEnded === wrappedListener ? value : nativeOnEnded;\n        }\n        start(when = 0) {\n            this._nativeConstantSourceNode.start(when);\n            if (this._constantSourceNodeRenderer !== null) {\n                this._constantSourceNodeRenderer.start = when;\n            }\n            if (this.context.state !== 'closed') {\n                setInternalStateToActive(this);\n                const resetInternalStateToPassive = () => {\n                    this._nativeConstantSourceNode.removeEventListener('ended', resetInternalStateToPassive);\n                    if (isActiveAudioNode(this)) {\n                        setInternalStateToPassive(this);\n                    }\n                };\n                this._nativeConstantSourceNode.addEventListener('ended', resetInternalStateToPassive);\n            }\n        }\n        stop(when = 0) {\n            this._nativeConstantSourceNode.stop(when);\n            if (this._constantSourceNodeRenderer !== null) {\n                this._constantSourceNodeRenderer.stop = when;\n            }\n        }\n    };\n};\n//# sourceMappingURL=constant-source-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createConstantSourceNodeRendererFactory = (connectAudioParam, createNativeConstantSourceNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeConstantSourceNodes = new WeakMap();\n        let start = null;\n        let stop = null;\n        const createConstantSourceNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeConstantSourceNode = getNativeAudioNode(proxy);\n            /*\n             * If the initially used nativeConstantSourceNode was not constructed on the same OfflineAudioContext it needs to be created\n             * again.\n             */\n            const nativeConstantSourceNodeIsOwnedByContext = isOwnedByContext(nativeConstantSourceNode, nativeOfflineAudioContext);\n            if (!nativeConstantSourceNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeConstantSourceNode.channelCount,\n                    channelCountMode: nativeConstantSourceNode.channelCountMode,\n                    channelInterpretation: nativeConstantSourceNode.channelInterpretation,\n                    offset: nativeConstantSourceNode.offset.value\n                };\n                nativeConstantSourceNode = createNativeConstantSourceNode(nativeOfflineAudioContext, options);\n                if (start !== null) {\n                    nativeConstantSourceNode.start(start);\n                }\n                if (stop !== null) {\n                    nativeConstantSourceNode.stop(stop);\n                }\n            }\n            renderedNativeConstantSourceNodes.set(nativeOfflineAudioContext, nativeConstantSourceNode);\n            if (!nativeConstantSourceNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.offset, nativeConstantSourceNode.offset);\n            }\n            else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.offset, nativeConstantSourceNode.offset);\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeConstantSourceNode);\n            return nativeConstantSourceNode;\n        };\n        return {\n            set start(value) {\n                start = value;\n            },\n            set stop(value) {\n                stop = value;\n            },\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeConstantSourceNode = renderedNativeConstantSourceNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeConstantSourceNode !== undefined) {\n                    return Promise.resolve(renderedNativeConstantSourceNode);\n                }\n                return createConstantSourceNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=constant-source-node-renderer-factory.js.map","export const createConvertNumberToUnsignedLong = (unit32Array) => {\n    return (value) => {\n        unit32Array[0] = value;\n        return unit32Array[0];\n    };\n};\n//# sourceMappingURL=convert-number-to-unsigned-long.js.map","const DEFAULT_OPTIONS = {\n    buffer: null,\n    channelCount: 2,\n    channelCountMode: 'clamped-max',\n    channelInterpretation: 'speakers',\n    disableNormalization: false\n};\nexport const createConvolverNodeConstructor = (audioNodeConstructor, createConvolverNodeRenderer, createNativeConvolverNode, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime) => {\n    return class ConvolverNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeConvolverNode = createNativeConvolverNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const convolverNodeRenderer = (isOffline ? createConvolverNodeRenderer() : null);\n            super(context, false, nativeConvolverNode, convolverNodeRenderer);\n            this._isBufferNullified = false;\n            this._nativeConvolverNode = nativeConvolverNode;\n            if (mergedOptions.buffer !== null) {\n                setAudioNodeTailTime(this, mergedOptions.buffer.duration);\n            }\n        }\n        get buffer() {\n            if (this._isBufferNullified) {\n                return null;\n            }\n            return this._nativeConvolverNode.buffer;\n        }\n        set buffer(value) {\n            this._nativeConvolverNode.buffer = value;\n            // Bug #115: Safari does not allow to set the buffer to null.\n            if (value === null && this._nativeConvolverNode.buffer !== null) {\n                const nativeContext = this._nativeConvolverNode.context;\n                this._nativeConvolverNode.buffer = nativeContext.createBuffer(1, 1, nativeContext.sampleRate);\n                this._isBufferNullified = true;\n                setAudioNodeTailTime(this, 0);\n            }\n            else {\n                this._isBufferNullified = false;\n                setAudioNodeTailTime(this, this._nativeConvolverNode.buffer === null ? 0 : this._nativeConvolverNode.buffer.duration);\n            }\n        }\n        get normalize() {\n            return this._nativeConvolverNode.normalize;\n        }\n        set normalize(value) {\n            this._nativeConvolverNode.normalize = value;\n        }\n    };\n};\n//# sourceMappingURL=convolver-node-constructor.js.map","import { isNativeAudioNodeFaker } from '../guards/native-audio-node-faker';\nimport { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createConvolverNodeRendererFactory = (createNativeConvolverNode, getNativeAudioNode, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeConvolverNodes = new WeakMap();\n        const createConvolverNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeConvolverNode = getNativeAudioNode(proxy);\n            // If the initially used nativeConvolverNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeConvolverNodeIsOwnedByContext = isOwnedByContext(nativeConvolverNode, nativeOfflineAudioContext);\n            if (!nativeConvolverNodeIsOwnedByContext) {\n                const options = {\n                    buffer: nativeConvolverNode.buffer,\n                    channelCount: nativeConvolverNode.channelCount,\n                    channelCountMode: nativeConvolverNode.channelCountMode,\n                    channelInterpretation: nativeConvolverNode.channelInterpretation,\n                    disableNormalization: !nativeConvolverNode.normalize\n                };\n                nativeConvolverNode = createNativeConvolverNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeConvolverNodes.set(nativeOfflineAudioContext, nativeConvolverNode);\n            if (isNativeAudioNodeFaker(nativeConvolverNode)) {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeConvolverNode.inputs[0]);\n            }\n            else {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeConvolverNode);\n            }\n            return nativeConvolverNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeConvolverNode = renderedNativeConvolverNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeConvolverNode !== undefined) {\n                    return Promise.resolve(renderedNativeConvolverNode);\n                }\n                return createConvolverNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=convolver-node-renderer-factory.js.map","export const createCreateNativeOfflineAudioContext = (createNotSupportedError, nativeOfflineAudioContextConstructor) => {\n    return (numberOfChannels, length, sampleRate) => {\n        if (nativeOfflineAudioContextConstructor === null) {\n            throw new Error('Missing the native OfflineAudioContext constructor.');\n        }\n        try {\n            return new nativeOfflineAudioContextConstructor(numberOfChannels, length, sampleRate);\n        }\n        catch (err) {\n            // Bug #143, #144 & #146: Safari throws a SyntaxError when numberOfChannels, length or sampleRate are invalid.\n            if (err.name === 'SyntaxError') {\n                throw createNotSupportedError();\n            }\n            throw err;\n        }\n    };\n};\n//# sourceMappingURL=create-native-offline-audio-context.js.map","export const createDataCloneError = () => new DOMException('', 'DataCloneError');\n//# sourceMappingURL=data-clone-error.js.map","export const detachArrayBuffer = (arrayBuffer) => {\n    const { port1, port2 } = new MessageChannel();\n    return new Promise((resolve) => {\n        const closeAndResolve = () => {\n            port2.onmessage = null;\n            port1.close();\n            port2.close();\n            resolve();\n        };\n        port2.onmessage = () => closeAndResolve();\n        try {\n            port1.postMessage(arrayBuffer, [arrayBuffer]);\n        }\n        catch {\n            // Ignore errors.\n        }\n        finally {\n            closeAndResolve();\n        }\n    });\n};\n//# sourceMappingURL=detach-array-buffer.js.map","import { detachArrayBuffer } from '../helpers/detach-array-buffer';\nimport { wrapAudioBufferGetChannelDataMethod } from '../helpers/wrap-audio-buffer-get-channel-data-method';\nexport const createDecodeAudioData = (audioBufferStore, cacheTestResult, createDataCloneError, createEncodingError, detachedArrayBuffers, getNativeContext, isNativeContext, testAudioBufferCopyChannelMethodsOutOfBoundsSupport, testPromiseSupport, wrapAudioBufferCopyChannelMethods, wrapAudioBufferCopyChannelMethodsOutOfBounds) => {\n    return (anyContext, audioData) => {\n        const nativeContext = isNativeContext(anyContext) ? anyContext : getNativeContext(anyContext);\n        // Bug #43: Only Chrome and Edge do throw a DataCloneError.\n        if (detachedArrayBuffers.has(audioData)) {\n            const err = createDataCloneError();\n            return Promise.reject(err);\n        }\n        // The audioData parameter maybe of a type which can't be added to a WeakSet.\n        try {\n            detachedArrayBuffers.add(audioData);\n        }\n        catch {\n            // Ignore errors.\n        }\n        // Bug #21: Safari does not support promises yet.\n        if (cacheTestResult(testPromiseSupport, () => testPromiseSupport(nativeContext))) {\n            return nativeContext.decodeAudioData(audioData).then((audioBuffer) => {\n                // Bug #133: Safari does neuter the ArrayBuffer.\n                detachArrayBuffer(audioData).catch(() => {\n                    // Ignore errors.\n                });\n                // Bug #157: Firefox does not allow the bufferOffset to be out-of-bounds.\n                if (!cacheTestResult(testAudioBufferCopyChannelMethodsOutOfBoundsSupport, () => testAudioBufferCopyChannelMethodsOutOfBoundsSupport(audioBuffer))) {\n                    wrapAudioBufferCopyChannelMethodsOutOfBounds(audioBuffer);\n                }\n                audioBufferStore.add(audioBuffer);\n                return audioBuffer;\n            });\n        }\n        // Bug #21: Safari does not return a Promise yet.\n        return new Promise((resolve, reject) => {\n            const complete = async () => {\n                // Bug #133: Safari does neuter the ArrayBuffer.\n                try {\n                    await detachArrayBuffer(audioData);\n                }\n                catch {\n                    // Ignore errors.\n                }\n            };\n            const fail = (err) => {\n                reject(err);\n                complete();\n            };\n            // Bug #26: Safari throws a synchronous error.\n            try {\n                // Bug #1: Safari requires a successCallback.\n                nativeContext.decodeAudioData(audioData, (audioBuffer) => {\n                    // Bug #5: Safari does not support copyFromChannel() and copyToChannel().\n                    // Bug #100: Safari does throw a wrong error when calling getChannelData() with an out-of-bounds value.\n                    if (typeof audioBuffer.copyFromChannel !== 'function') {\n                        wrapAudioBufferCopyChannelMethods(audioBuffer);\n                        wrapAudioBufferGetChannelDataMethod(audioBuffer);\n                    }\n                    audioBufferStore.add(audioBuffer);\n                    complete().then(() => resolve(audioBuffer));\n                }, (err) => {\n                    // Bug #4: Safari returns null instead of an error.\n                    if (err === null) {\n                        fail(createEncodingError());\n                    }\n                    else {\n                        fail(err);\n                    }\n                });\n            }\n            catch (err) {\n                fail(err);\n            }\n        });\n    };\n};\n//# sourceMappingURL=decode-audio-data.js.map","import { isAudioNodeOutputConnection } from '../guards/audio-node-output-connection';\nexport const createDecrementCycleCounter = (connectNativeAudioNodeToNativeAudioNode, cycleCounters, getAudioNodeConnections, getNativeAudioNode, getNativeAudioParam, getNativeContext, isActiveAudioNode, isNativeOfflineAudioContext) => {\n    return (audioNode, count) => {\n        const cycleCounter = cycleCounters.get(audioNode);\n        if (cycleCounter === undefined) {\n            throw new Error('Missing the expected cycle count.');\n        }\n        const nativeContext = getNativeContext(audioNode.context);\n        const isOffline = isNativeOfflineAudioContext(nativeContext);\n        if (cycleCounter === count) {\n            cycleCounters.delete(audioNode);\n            if (!isOffline && isActiveAudioNode(audioNode)) {\n                const nativeSourceAudioNode = getNativeAudioNode(audioNode);\n                const { outputs } = getAudioNodeConnections(audioNode);\n                for (const output of outputs) {\n                    if (isAudioNodeOutputConnection(output)) {\n                        const nativeDestinationAudioNode = getNativeAudioNode(output[0]);\n                        connectNativeAudioNodeToNativeAudioNode(nativeSourceAudioNode, nativeDestinationAudioNode, output[1], output[2]);\n                    }\n                    else {\n                        const nativeDestinationAudioParam = getNativeAudioParam(output[0]);\n                        nativeSourceAudioNode.connect(nativeDestinationAudioParam, output[1]);\n                    }\n                }\n            }\n        }\n        else {\n            cycleCounters.set(audioNode, cycleCounter - count);\n        }\n    };\n};\n//# sourceMappingURL=decrement-cycle-counter.js.map","const DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'max',\n    channelInterpretation: 'speakers',\n    delayTime: 0,\n    maxDelayTime: 1\n};\nexport const createDelayNodeConstructor = (audioNodeConstructor, createAudioParam, createDelayNodeRenderer, createNativeDelayNode, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime) => {\n    return class DelayNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeDelayNode = createNativeDelayNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const delayNodeRenderer = (isOffline ? createDelayNodeRenderer(mergedOptions.maxDelayTime) : null);\n            super(context, false, nativeDelayNode, delayNodeRenderer);\n            this._delayTime = createAudioParam(this, isOffline, nativeDelayNode.delayTime);\n            setAudioNodeTailTime(this, mergedOptions.maxDelayTime);\n        }\n        get delayTime() {\n            return this._delayTime;\n        }\n    };\n};\n//# sourceMappingURL=delay-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createDelayNodeRendererFactory = (connectAudioParam, createNativeDelayNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode) => {\n    return (maxDelayTime) => {\n        const renderedNativeDelayNodes = new WeakMap();\n        const createDelayNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeDelayNode = getNativeAudioNode(proxy);\n            // If the initially used nativeDelayNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeDelayNodeIsOwnedByContext = isOwnedByContext(nativeDelayNode, nativeOfflineAudioContext);\n            if (!nativeDelayNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeDelayNode.channelCount,\n                    channelCountMode: nativeDelayNode.channelCountMode,\n                    channelInterpretation: nativeDelayNode.channelInterpretation,\n                    delayTime: nativeDelayNode.delayTime.value,\n                    maxDelayTime\n                };\n                nativeDelayNode = createNativeDelayNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeDelayNodes.set(nativeOfflineAudioContext, nativeDelayNode);\n            if (!nativeDelayNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.delayTime, nativeDelayNode.delayTime);\n            }\n            else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.delayTime, nativeDelayNode.delayTime);\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeDelayNode);\n            return nativeDelayNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeDelayNode = renderedNativeDelayNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeDelayNode !== undefined) {\n                    return Promise.resolve(renderedNativeDelayNode);\n                }\n                return createDelayNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=delay-node-renderer-factory.js.map","export const createDeleteActiveInputConnectionToAudioNode = (pickElementFromSet) => {\n    return (activeInputs, source, output, input) => {\n        return pickElementFromSet(activeInputs[input], (activeInputConnection) => activeInputConnection[0] === source && activeInputConnection[1] === output);\n    };\n};\n//# sourceMappingURL=delete-active-input-connection-to-audio-node.js.map","export const createDeleteUnrenderedAudioWorkletNode = (getUnrenderedAudioWorkletNodes) => {\n    return (nativeContext, audioWorkletNode) => {\n        getUnrenderedAudioWorkletNodes(nativeContext).delete(audioWorkletNode);\n    };\n};\n//# sourceMappingURL=delete-unrendered-audio-worklet-node.js.map","export const isDelayNode = (audioNode) => {\n    return 'delayTime' in audioNode;\n};\n//# sourceMappingURL=delay-node.js.map","import { isAudioNode } from '../guards/audio-node';\nimport { isDelayNode } from '../guards/delay-node';\nexport const createDetectCycles = (audioParamAudioNodeStore, getAudioNodeConnections, getValueForKey) => {\n    return function detectCycles(chain, nextLink) {\n        const audioNode = isAudioNode(nextLink) ? nextLink : getValueForKey(audioParamAudioNodeStore, nextLink);\n        if (isDelayNode(audioNode)) {\n            return [];\n        }\n        if (chain[0] === audioNode) {\n            return [chain];\n        }\n        if (chain.includes(audioNode)) {\n            return [];\n        }\n        const { outputs } = getAudioNodeConnections(audioNode);\n        return Array.from(outputs)\n            .map((outputConnection) => detectCycles([...chain, audioNode], outputConnection[0]))\n            .reduce((mergedCycles, nestedCycles) => mergedCycles.concat(nestedCycles), []);\n    };\n};\n//# sourceMappingURL=detect-cycles.js.map","import { isNativeAudioNode } from '../guards/native-audio-node';\nconst getOutputAudioNodeAtIndex = (createIndexSizeError, outputAudioNodes, output) => {\n    const outputAudioNode = outputAudioNodes[output];\n    if (outputAudioNode === undefined) {\n        throw createIndexSizeError();\n    }\n    return outputAudioNode;\n};\nexport const createDisconnectMultipleOutputs = (createIndexSizeError) => {\n    return (outputAudioNodes, destinationOrOutput = undefined, output = undefined, input = 0) => {\n        if (destinationOrOutput === undefined) {\n            return outputAudioNodes.forEach((outputAudioNode) => outputAudioNode.disconnect());\n        }\n        if (typeof destinationOrOutput === 'number') {\n            return getOutputAudioNodeAtIndex(createIndexSizeError, outputAudioNodes, destinationOrOutput).disconnect();\n        }\n        if (isNativeAudioNode(destinationOrOutput)) {\n            if (output === undefined) {\n                return outputAudioNodes.forEach((outputAudioNode) => outputAudioNode.disconnect(destinationOrOutput));\n            }\n            if (input === undefined) {\n                return getOutputAudioNodeAtIndex(createIndexSizeError, outputAudioNodes, output).disconnect(destinationOrOutput, 0);\n            }\n            return getOutputAudioNodeAtIndex(createIndexSizeError, outputAudioNodes, output).disconnect(destinationOrOutput, 0, input);\n        }\n        if (output === undefined) {\n            return outputAudioNodes.forEach((outputAudioNode) => outputAudioNode.disconnect(destinationOrOutput));\n        }\n        return getOutputAudioNodeAtIndex(createIndexSizeError, outputAudioNodes, output).disconnect(destinationOrOutput, 0);\n    };\n};\n//# sourceMappingURL=disconnect-multiple-outputs.js.map","const DEFAULT_OPTIONS = {\n    attack: 0.003,\n    channelCount: 2,\n    channelCountMode: 'clamped-max',\n    channelInterpretation: 'speakers',\n    knee: 30,\n    ratio: 12,\n    release: 0.25,\n    threshold: -24\n};\nexport const createDynamicsCompressorNodeConstructor = (audioNodeConstructor, createAudioParam, createDynamicsCompressorNodeRenderer, createNativeDynamicsCompressorNode, createNotSupportedError, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime) => {\n    return class DynamicsCompressorNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeDynamicsCompressorNode = createNativeDynamicsCompressorNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const dynamicsCompressorNodeRenderer = (isOffline ? createDynamicsCompressorNodeRenderer() : null);\n            super(context, false, nativeDynamicsCompressorNode, dynamicsCompressorNodeRenderer);\n            this._attack = createAudioParam(this, isOffline, nativeDynamicsCompressorNode.attack);\n            this._knee = createAudioParam(this, isOffline, nativeDynamicsCompressorNode.knee);\n            this._nativeDynamicsCompressorNode = nativeDynamicsCompressorNode;\n            this._ratio = createAudioParam(this, isOffline, nativeDynamicsCompressorNode.ratio);\n            this._release = createAudioParam(this, isOffline, nativeDynamicsCompressorNode.release);\n            this._threshold = createAudioParam(this, isOffline, nativeDynamicsCompressorNode.threshold);\n            setAudioNodeTailTime(this, 0.006);\n        }\n        get attack() {\n            return this._attack;\n        }\n        // Bug #108: Safari allows a channelCount of three and above which is why the getter and setter needs to be overwritten here.\n        get channelCount() {\n            return this._nativeDynamicsCompressorNode.channelCount;\n        }\n        set channelCount(value) {\n            const previousChannelCount = this._nativeDynamicsCompressorNode.channelCount;\n            this._nativeDynamicsCompressorNode.channelCount = value;\n            if (value > 2) {\n                this._nativeDynamicsCompressorNode.channelCount = previousChannelCount;\n                throw createNotSupportedError();\n            }\n        }\n        /*\n         * Bug #109: Only Chrome and Firefox disallow a channelCountMode of 'max' yet which is why the getter and setter needs to be\n         * overwritten here.\n         */\n        get channelCountMode() {\n            return this._nativeDynamicsCompressorNode.channelCountMode;\n        }\n        set channelCountMode(value) {\n            const previousChannelCount = this._nativeDynamicsCompressorNode.channelCountMode;\n            this._nativeDynamicsCompressorNode.channelCountMode = value;\n            if (value === 'max') {\n                this._nativeDynamicsCompressorNode.channelCountMode = previousChannelCount;\n                throw createNotSupportedError();\n            }\n        }\n        get knee() {\n            return this._knee;\n        }\n        get ratio() {\n            return this._ratio;\n        }\n        get reduction() {\n            // Bug #111: Safari returns an AudioParam instead of a number.\n            if (typeof this._nativeDynamicsCompressorNode.reduction.value === 'number') {\n                return this._nativeDynamicsCompressorNode.reduction.value;\n            }\n            return this._nativeDynamicsCompressorNode.reduction;\n        }\n        get release() {\n            return this._release;\n        }\n        get threshold() {\n            return this._threshold;\n        }\n    };\n};\n//# sourceMappingURL=dynamics-compressor-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createDynamicsCompressorNodeRendererFactory = (connectAudioParam, createNativeDynamicsCompressorNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeDynamicsCompressorNodes = new WeakMap();\n        const createDynamicsCompressorNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeDynamicsCompressorNode = getNativeAudioNode(proxy);\n            /*\n             * If the initially used nativeDynamicsCompressorNode was not constructed on the same OfflineAudioContext it needs to be\n             * created again.\n             */\n            const nativeDynamicsCompressorNodeIsOwnedByContext = isOwnedByContext(nativeDynamicsCompressorNode, nativeOfflineAudioContext);\n            if (!nativeDynamicsCompressorNodeIsOwnedByContext) {\n                const options = {\n                    attack: nativeDynamicsCompressorNode.attack.value,\n                    channelCount: nativeDynamicsCompressorNode.channelCount,\n                    channelCountMode: nativeDynamicsCompressorNode.channelCountMode,\n                    channelInterpretation: nativeDynamicsCompressorNode.channelInterpretation,\n                    knee: nativeDynamicsCompressorNode.knee.value,\n                    ratio: nativeDynamicsCompressorNode.ratio.value,\n                    release: nativeDynamicsCompressorNode.release.value,\n                    threshold: nativeDynamicsCompressorNode.threshold.value\n                };\n                nativeDynamicsCompressorNode = createNativeDynamicsCompressorNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeDynamicsCompressorNodes.set(nativeOfflineAudioContext, nativeDynamicsCompressorNode);\n            if (!nativeDynamicsCompressorNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.attack, nativeDynamicsCompressorNode.attack);\n                await renderAutomation(nativeOfflineAudioContext, proxy.knee, nativeDynamicsCompressorNode.knee);\n                await renderAutomation(nativeOfflineAudioContext, proxy.ratio, nativeDynamicsCompressorNode.ratio);\n                await renderAutomation(nativeOfflineAudioContext, proxy.release, nativeDynamicsCompressorNode.release);\n                await renderAutomation(nativeOfflineAudioContext, proxy.threshold, nativeDynamicsCompressorNode.threshold);\n            }\n            else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.attack, nativeDynamicsCompressorNode.attack);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.knee, nativeDynamicsCompressorNode.knee);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.ratio, nativeDynamicsCompressorNode.ratio);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.release, nativeDynamicsCompressorNode.release);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.threshold, nativeDynamicsCompressorNode.threshold);\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeDynamicsCompressorNode);\n            return nativeDynamicsCompressorNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeDynamicsCompressorNode = renderedNativeDynamicsCompressorNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeDynamicsCompressorNode !== undefined) {\n                    return Promise.resolve(renderedNativeDynamicsCompressorNode);\n                }\n                return createDynamicsCompressorNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=dynamics-compressor-node-renderer-factory.js.map","export const createEncodingError = () => new DOMException('', 'EncodingError');\n//# sourceMappingURL=encoding-error.js.map","export const createEvaluateSource = (window) => {\n    return (source) => new Promise((resolve, reject) => {\n        if (window === null) {\n            // Bug #182 Chrome and Edge do throw an instance of a SyntaxError instead of a DOMException.\n            reject(new SyntaxError());\n            return;\n        }\n        const head = window.document.head;\n        if (head === null) {\n            // Bug #182 Chrome and Edge do throw an instance of a SyntaxError instead of a DOMException.\n            reject(new SyntaxError());\n        }\n        else {\n            const script = window.document.createElement('script');\n            // @todo Safari doesn't like URLs with a type of 'application/javascript; charset=utf-8'.\n            const blob = new Blob([source], { type: 'application/javascript' });\n            const url = URL.createObjectURL(blob);\n            const originalOnErrorHandler = window.onerror;\n            const removeErrorEventListenerAndRevokeUrl = () => {\n                window.onerror = originalOnErrorHandler;\n                URL.revokeObjectURL(url);\n            };\n            window.onerror = (message, src, lineno, colno, error) => {\n                // @todo Edge thinks the source is the one of the html document.\n                if (src === url || (src === window.location.href && lineno === 1 && colno === 1)) {\n                    removeErrorEventListenerAndRevokeUrl();\n                    reject(error);\n                    return false;\n                }\n                if (originalOnErrorHandler !== null) {\n                    return originalOnErrorHandler(message, src, lineno, colno, error);\n                }\n            };\n            script.onerror = () => {\n                removeErrorEventListenerAndRevokeUrl();\n                // Bug #182 Chrome and Edge do throw an instance of a SyntaxError instead of a DOMException.\n                reject(new SyntaxError());\n            };\n            script.onload = () => {\n                removeErrorEventListenerAndRevokeUrl();\n                resolve();\n            };\n            script.src = url;\n            script.type = 'module';\n            head.appendChild(script);\n        }\n    });\n};\n//# sourceMappingURL=evaluate-source.js.map","export const createEventTargetConstructor = (wrapEventListener) => {\n    return class EventTarget {\n        constructor(_nativeEventTarget) {\n            this._nativeEventTarget = _nativeEventTarget;\n            this._listeners = new WeakMap();\n        }\n        addEventListener(type, listener, options) {\n            if (listener !== null) {\n                let wrappedEventListener = this._listeners.get(listener);\n                if (wrappedEventListener === undefined) {\n                    wrappedEventListener = wrapEventListener(this, listener);\n                    if (typeof listener === 'function') {\n                        this._listeners.set(listener, wrappedEventListener);\n                    }\n                }\n                this._nativeEventTarget.addEventListener(type, wrappedEventListener, options);\n            }\n        }\n        dispatchEvent(event) {\n            return this._nativeEventTarget.dispatchEvent(event);\n        }\n        removeEventListener(type, listener, options) {\n            const wrappedEventListener = listener === null ? undefined : this._listeners.get(listener);\n            this._nativeEventTarget.removeEventListener(type, wrappedEventListener === undefined ? null : wrappedEventListener, options);\n        }\n    };\n};\n//# sourceMappingURL=event-target-constructor.js.map","export const createExposeCurrentFrameAndCurrentTime = (window) => {\n    return (currentTime, sampleRate, fn) => {\n        Object.defineProperties(window, {\n            currentFrame: {\n                configurable: true,\n                get() {\n                    return Math.round(currentTime * sampleRate);\n                }\n            },\n            currentTime: {\n                configurable: true,\n                get() {\n                    return currentTime;\n                }\n            }\n        });\n        try {\n            return fn();\n        }\n        finally {\n            if (window !== null) {\n                delete window.currentFrame;\n                delete window.currentTime;\n            }\n        }\n    };\n};\n//# sourceMappingURL=expose-current-frame-and-current-time.js.map","export const createFetchSource = (createAbortError) => {\n    return async (url) => {\n        try {\n            const response = await fetch(url);\n            if (response.ok) {\n                return [await response.text(), response.url];\n            }\n        }\n        catch {\n            // Ignore errors.\n        } // tslint:disable-line:no-empty\n        throw createAbortError();\n    };\n};\n//# sourceMappingURL=fetch-source.js.map","import { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nconst DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'max',\n    channelInterpretation: 'speakers',\n    gain: 1\n};\nexport const createGainNodeConstructor = (audioNodeConstructor, createAudioParam, createGainNodeRenderer, createNativeGainNode, getNativeContext, isNativeOfflineAudioContext) => {\n    return class GainNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeGainNode = createNativeGainNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const gainNodeRenderer = (isOffline ? createGainNodeRenderer() : null);\n            super(context, false, nativeGainNode, gainNodeRenderer);\n            // Bug #74: Safari does not export the correct values for maxValue and minValue.\n            this._gain = createAudioParam(this, isOffline, nativeGainNode.gain, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n        }\n        get gain() {\n            return this._gain;\n        }\n    };\n};\n//# sourceMappingURL=gain-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createGainNodeRendererFactory = (connectAudioParam, createNativeGainNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeGainNodes = new WeakMap();\n        const createGainNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeGainNode = getNativeAudioNode(proxy);\n            // If the initially used nativeGainNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeGainNodeIsOwnedByContext = isOwnedByContext(nativeGainNode, nativeOfflineAudioContext);\n            if (!nativeGainNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeGainNode.channelCount,\n                    channelCountMode: nativeGainNode.channelCountMode,\n                    channelInterpretation: nativeGainNode.channelInterpretation,\n                    gain: nativeGainNode.gain.value\n                };\n                nativeGainNode = createNativeGainNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeGainNodes.set(nativeOfflineAudioContext, nativeGainNode);\n            if (!nativeGainNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.gain, nativeGainNode.gain);\n            }\n            else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.gain, nativeGainNode.gain);\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeGainNode);\n            return nativeGainNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeGainNode = renderedNativeGainNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeGainNode !== undefined) {\n                    return Promise.resolve(renderedNativeGainNode);\n                }\n                return createGainNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=gain-node-renderer-factory.js.map","export const createGetActiveAudioWorkletNodeInputs = (activeAudioWorkletNodeInputsStore, getValueForKey) => {\n    return (nativeAudioWorkletNode) => getValueForKey(activeAudioWorkletNodeInputsStore, nativeAudioWorkletNode);\n};\n//# sourceMappingURL=get-active-audio-worklet-node-inputs.js.map","export const createGetAudioNodeRenderer = (getAudioNodeConnections) => {\n    return (audioNode) => {\n        const audioNodeConnections = getAudioNodeConnections(audioNode);\n        if (audioNodeConnections.renderer === null) {\n            throw new Error('Missing the renderer of the given AudioNode in the audio graph.');\n        }\n        return audioNodeConnections.renderer;\n    };\n};\n//# sourceMappingURL=get-audio-node-renderer.js.map","export const createGetAudioNodeTailTime = (audioNodeTailTimeStore) => {\n    return (audioNode) => { var _a; return (_a = audioNodeTailTimeStore.get(audioNode)) !== null && _a !== void 0 ? _a : 0; };\n};\n//# sourceMappingURL=get-audio-node-tail-time.js.map","export const createGetAudioParamRenderer = (getAudioParamConnections) => {\n    return (audioParam) => {\n        const audioParamConnections = getAudioParamConnections(audioParam);\n        if (audioParamConnections.renderer === null) {\n            throw new Error('Missing the renderer of the given AudioParam in the audio graph.');\n        }\n        return audioParamConnections.renderer;\n    };\n};\n//# sourceMappingURL=get-audio-param-renderer.js.map","export const createGetBackupOfflineAudioContext = (backupOfflineAudioContextStore) => {\n    return (nativeContext) => {\n        return backupOfflineAudioContextStore.get(nativeContext);\n    };\n};\n//# sourceMappingURL=get-backup-offline-audio-context.js.map","export const createInvalidStateError = () => new DOMException('', 'InvalidStateError');\n//# sourceMappingURL=invalid-state-error.js.map","import { createInvalidStateError } from './invalid-state-error';\nexport const createGetNativeContext = (contextStore) => {\n    return (context) => {\n        const nativeContext = contextStore.get(context);\n        if (nativeContext === undefined) {\n            throw createInvalidStateError();\n        }\n        return (nativeContext);\n    };\n};\n//# sourceMappingURL=get-native-context.js.map","export const createGetOrCreateBackupOfflineAudioContext = (backupOfflineAudioContextStore, nativeOfflineAudioContextConstructor) => {\n    return (nativeContext) => {\n        let backupOfflineAudioContext = backupOfflineAudioContextStore.get(nativeContext);\n        if (backupOfflineAudioContext !== undefined) {\n            return backupOfflineAudioContext;\n        }\n        if (nativeOfflineAudioContextConstructor === null) {\n            throw new Error('Missing the native OfflineAudioContext constructor.');\n        }\n        // Bug #141: Safari does not support creating an OfflineAudioContext with less than 44100 Hz.\n        backupOfflineAudioContext = new nativeOfflineAudioContextConstructor(1, 1, 44100);\n        backupOfflineAudioContextStore.set(nativeContext, backupOfflineAudioContext);\n        return backupOfflineAudioContext;\n    };\n};\n//# sourceMappingURL=get-or-create-backup-offline-audio-context.js.map","export const createGetUnrenderedAudioWorkletNodes = (unrenderedAudioWorkletNodeStore) => {\n    return (nativeContext) => {\n        const unrenderedAudioWorkletNodes = unrenderedAudioWorkletNodeStore.get(nativeContext);\n        if (unrenderedAudioWorkletNodes === undefined) {\n            throw new Error('The context has no set of AudioWorkletNodes.');\n        }\n        return unrenderedAudioWorkletNodes;\n    };\n};\n//# sourceMappingURL=get-unrendered-audio-worklet-nodes.js.map","export const createInvalidAccessError = () => new DOMException('', 'InvalidAccessError');\n//# sourceMappingURL=invalid-access-error.js.map","import { createInvalidAccessError } from '../factories/invalid-access-error';\nexport const wrapIIRFilterNodeGetFrequencyResponseMethod = (nativeIIRFilterNode) => {\n    nativeIIRFilterNode.getFrequencyResponse = ((getFrequencyResponse) => {\n        return (frequencyHz, magResponse, phaseResponse) => {\n            if (frequencyHz.length !== magResponse.length || magResponse.length !== phaseResponse.length) {\n                throw createInvalidAccessError();\n            }\n            return getFrequencyResponse.call(nativeIIRFilterNode, frequencyHz, magResponse, phaseResponse);\n        };\n    })(nativeIIRFilterNode.getFrequencyResponse);\n};\n//# sourceMappingURL=wrap-iir-filter-node-get-frequency-response-method.js.map","import { wrapIIRFilterNodeGetFrequencyResponseMethod } from '../helpers/wrap-iir-filter-node-get-frequency-response-method';\nconst DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'max',\n    channelInterpretation: 'speakers'\n};\nexport const createIIRFilterNodeConstructor = (audioNodeConstructor, createNativeIIRFilterNode, createIIRFilterNodeRenderer, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime) => {\n    return class IIRFilterNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeIIRFilterNode = createNativeIIRFilterNode(nativeContext, isOffline ? null : context.baseLatency, mergedOptions);\n            const iirFilterNodeRenderer = ((isOffline ? createIIRFilterNodeRenderer(mergedOptions.feedback, mergedOptions.feedforward) : null));\n            super(context, false, nativeIIRFilterNode, iirFilterNodeRenderer);\n            // Bug #23 & #24: FirefoxDeveloper does not throw an InvalidAccessError.\n            // @todo Write a test which allows other browsers to remain unpatched.\n            wrapIIRFilterNodeGetFrequencyResponseMethod(nativeIIRFilterNode);\n            this._nativeIIRFilterNode = nativeIIRFilterNode;\n            // @todo Determine a meaningful tail-time instead of just using one second.\n            setAudioNodeTailTime(this, 1);\n        }\n        getFrequencyResponse(frequencyHz, magResponse, phaseResponse) {\n            return this._nativeIIRFilterNode.getFrequencyResponse(frequencyHz, magResponse, phaseResponse);\n        }\n    };\n};\n//# sourceMappingURL=iir-filter-node-constructor.js.map","// This implementation as shamelessly inspired by source code of\n// tslint:disable-next-line:max-line-length\n// {@link https://chromium.googlesource.com/chromium/src.git/+/master/third_party/WebKit/Source/platform/audio/IIRFilter.cpp|Chromium's IIRFilter}.\nexport const filterBuffer = (feedback, feedbackLength, feedforward, feedforwardLength, minLength, xBuffer, yBuffer, bufferIndex, bufferLength, input, output) => {\n    const inputLength = input.length;\n    let i = bufferIndex;\n    for (let j = 0; j < inputLength; j += 1) {\n        let y = feedforward[0] * input[j];\n        for (let k = 1; k < minLength; k += 1) {\n            const x = (i - k) & (bufferLength - 1); // tslint:disable-line:no-bitwise\n            y += feedforward[k] * xBuffer[x];\n            y -= feedback[k] * yBuffer[x];\n        }\n        for (let k = minLength; k < feedforwardLength; k += 1) {\n            y += feedforward[k] * xBuffer[(i - k) & (bufferLength - 1)]; // tslint:disable-line:no-bitwise\n        }\n        for (let k = minLength; k < feedbackLength; k += 1) {\n            y -= feedback[k] * yBuffer[(i - k) & (bufferLength - 1)]; // tslint:disable-line:no-bitwise\n        }\n        xBuffer[i] = input[j];\n        yBuffer[i] = y;\n        i = (i + 1) & (bufferLength - 1); // tslint:disable-line:no-bitwise\n        output[j] = y;\n    }\n    return i;\n};\n//# sourceMappingURL=filter-buffer.js.map","import { filterBuffer } from '../helpers/filter-buffer';\nimport { isOwnedByContext } from '../helpers/is-owned-by-context';\nconst filterFullBuffer = (renderedBuffer, nativeOfflineAudioContext, feedback, feedforward) => {\n    const convertedFeedback = feedback instanceof Float64Array ? feedback : new Float64Array(feedback);\n    const convertedFeedforward = feedforward instanceof Float64Array ? feedforward : new Float64Array(feedforward);\n    const feedbackLength = convertedFeedback.length;\n    const feedforwardLength = convertedFeedforward.length;\n    const minLength = Math.min(feedbackLength, feedforwardLength);\n    if (convertedFeedback[0] !== 1) {\n        for (let i = 0; i < feedbackLength; i += 1) {\n            convertedFeedforward[i] /= convertedFeedback[0];\n        }\n        for (let i = 1; i < feedforwardLength; i += 1) {\n            convertedFeedback[i] /= convertedFeedback[0];\n        }\n    }\n    const bufferLength = 32;\n    const xBuffer = new Float32Array(bufferLength);\n    const yBuffer = new Float32Array(bufferLength);\n    const filteredBuffer = nativeOfflineAudioContext.createBuffer(renderedBuffer.numberOfChannels, renderedBuffer.length, renderedBuffer.sampleRate);\n    const numberOfChannels = renderedBuffer.numberOfChannels;\n    for (let i = 0; i < numberOfChannels; i += 1) {\n        const input = renderedBuffer.getChannelData(i);\n        const output = filteredBuffer.getChannelData(i);\n        xBuffer.fill(0);\n        yBuffer.fill(0);\n        filterBuffer(convertedFeedback, feedbackLength, convertedFeedforward, feedforwardLength, minLength, xBuffer, yBuffer, 0, bufferLength, input, output);\n    }\n    return filteredBuffer;\n};\nexport const createIIRFilterNodeRendererFactory = (createNativeAudioBufferSourceNode, getNativeAudioNode, nativeOfflineAudioContextConstructor, renderInputsOfAudioNode, renderNativeOfflineAudioContext) => {\n    return (feedback, feedforward) => {\n        const renderedNativeAudioNodes = new WeakMap();\n        let filteredBufferPromise = null;\n        const createAudioNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeAudioBufferSourceNode = null;\n            let nativeIIRFilterNode = getNativeAudioNode(proxy);\n            // If the initially used nativeIIRFilterNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeIIRFilterNodeIsOwnedByContext = isOwnedByContext(nativeIIRFilterNode, nativeOfflineAudioContext);\n            // Bug #9: Safari does not support IIRFilterNodes.\n            if (nativeOfflineAudioContext.createIIRFilter === undefined) {\n                nativeAudioBufferSourceNode = createNativeAudioBufferSourceNode(nativeOfflineAudioContext, {\n                    buffer: null,\n                    channelCount: 2,\n                    channelCountMode: 'max',\n                    channelInterpretation: 'speakers',\n                    loop: false,\n                    loopEnd: 0,\n                    loopStart: 0,\n                    playbackRate: 1\n                });\n            }\n            else if (!nativeIIRFilterNodeIsOwnedByContext) {\n                // @todo TypeScript defines the parameters of createIIRFilter() as arrays of numbers.\n                nativeIIRFilterNode = nativeOfflineAudioContext.createIIRFilter(feedforward, feedback);\n            }\n            renderedNativeAudioNodes.set(nativeOfflineAudioContext, nativeAudioBufferSourceNode === null ? nativeIIRFilterNode : nativeAudioBufferSourceNode);\n            if (nativeAudioBufferSourceNode !== null) {\n                if (filteredBufferPromise === null) {\n                    if (nativeOfflineAudioContextConstructor === null) {\n                        throw new Error('Missing the native OfflineAudioContext constructor.');\n                    }\n                    const partialOfflineAudioContext = new nativeOfflineAudioContextConstructor(\n                    // Bug #47: The AudioDestinationNode in Safari gets not initialized correctly.\n                    proxy.context.destination.channelCount, \n                    // Bug #17: Safari does not yet expose the length.\n                    proxy.context.length, nativeOfflineAudioContext.sampleRate);\n                    filteredBufferPromise = (async () => {\n                        await renderInputsOfAudioNode(proxy, partialOfflineAudioContext, partialOfflineAudioContext.destination);\n                        const renderedBuffer = await renderNativeOfflineAudioContext(partialOfflineAudioContext);\n                        return filterFullBuffer(renderedBuffer, nativeOfflineAudioContext, feedback, feedforward);\n                    })();\n                }\n                const filteredBuffer = await filteredBufferPromise;\n                nativeAudioBufferSourceNode.buffer = filteredBuffer;\n                nativeAudioBufferSourceNode.start(0);\n                return nativeAudioBufferSourceNode;\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeIIRFilterNode);\n            return nativeIIRFilterNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeAudioNode = renderedNativeAudioNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeAudioNode !== undefined) {\n                    return Promise.resolve(renderedNativeAudioNode);\n                }\n                return createAudioNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=iir-filter-node-renderer-factory.js.map","import { isAudioNodeOutputConnection } from '../guards/audio-node-output-connection';\nexport const createIncrementCycleCounterFactory = (cycleCounters, disconnectNativeAudioNodeFromNativeAudioNode, getAudioNodeConnections, getNativeAudioNode, getNativeAudioParam, isActiveAudioNode) => {\n    return (isOffline) => {\n        return (audioNode, count) => {\n            const cycleCounter = cycleCounters.get(audioNode);\n            if (cycleCounter === undefined) {\n                if (!isOffline && isActiveAudioNode(audioNode)) {\n                    const nativeSourceAudioNode = getNativeAudioNode(audioNode);\n                    const { outputs } = getAudioNodeConnections(audioNode);\n                    for (const output of outputs) {\n                        if (isAudioNodeOutputConnection(output)) {\n                            const nativeDestinationAudioNode = getNativeAudioNode(output[0]);\n                            disconnectNativeAudioNodeFromNativeAudioNode(nativeSourceAudioNode, nativeDestinationAudioNode, output[1], output[2]);\n                        }\n                        else {\n                            const nativeDestinationAudioParam = getNativeAudioParam(output[0]);\n                            nativeSourceAudioNode.disconnect(nativeDestinationAudioParam, output[1]);\n                        }\n                    }\n                }\n                cycleCounters.set(audioNode, count);\n            }\n            else {\n                cycleCounters.set(audioNode, cycleCounter + count);\n            }\n        };\n    };\n};\n//# sourceMappingURL=increment-cycle-counter-factory.js.map","export const createIsAnyAudioContext = (contextStore, isNativeAudioContext) => {\n    return (anything) => {\n        const nativeContext = contextStore.get(anything);\n        return isNativeAudioContext(nativeContext) || isNativeAudioContext(anything);\n    };\n};\n//# sourceMappingURL=is-any-audio-context.js.map","export const createIsAnyAudioNode = (audioNodeStore, isNativeAudioNode) => {\n    return (anything) => audioNodeStore.has(anything) || isNativeAudioNode(anything);\n};\n//# sourceMappingURL=is-any-audio-node.js.map","export const createIsAnyAudioParam = (audioParamStore, isNativeAudioParam) => {\n    return (anything) => audioParamStore.has(anything) || isNativeAudioParam(anything);\n};\n//# sourceMappingURL=is-any-audio-param.js.map","export const createIsAnyOfflineAudioContext = (contextStore, isNativeOfflineAudioContext) => {\n    return (anything) => {\n        const nativeContext = contextStore.get(anything);\n        return isNativeOfflineAudioContext(nativeContext) || isNativeOfflineAudioContext(anything);\n    };\n};\n//# sourceMappingURL=is-any-offline-audio-context.js.map","export const createIsNativeAudioContext = (nativeAudioContextConstructor) => {\n    return (anything) => {\n        return nativeAudioContextConstructor !== null && anything instanceof nativeAudioContextConstructor;\n    };\n};\n//# sourceMappingURL=is-native-audio-context.js.map","export const createIsNativeAudioNode = (window) => {\n    return (anything) => {\n        return window !== null && typeof window.AudioNode === 'function' && anything instanceof window.AudioNode;\n    };\n};\n//# sourceMappingURL=is-native-audio-node.js.map","export const createIsNativeAudioParam = (window) => {\n    return (anything) => {\n        return window !== null && typeof window.AudioParam === 'function' && anything instanceof window.AudioParam;\n    };\n};\n//# sourceMappingURL=is-native-audio-param.js.map","export const createIsNativeContext = (isNativeAudioContext, isNativeOfflineAudioContext) => {\n    return (anything) => {\n        return isNativeAudioContext(anything) || isNativeOfflineAudioContext(anything);\n    };\n};\n//# sourceMappingURL=is-native-context.js.map","export const createIsNativeOfflineAudioContext = (nativeOfflineAudioContextConstructor) => {\n    return (anything) => {\n        return nativeOfflineAudioContextConstructor !== null && anything instanceof nativeOfflineAudioContextConstructor;\n    };\n};\n//# sourceMappingURL=is-native-offline-audio-context.js.map","export const createIsSecureContext = (window) => window !== null && window.isSecureContext;\n//# sourceMappingURL=is-secure-context.js.map","export const createMediaElementAudioSourceNodeConstructor = (audioNodeConstructor, createNativeMediaElementAudioSourceNode, getNativeContext, isNativeOfflineAudioContext) => {\n    return class MediaElementAudioSourceNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const nativeMediaElementAudioSourceNode = createNativeMediaElementAudioSourceNode(nativeContext, options);\n            // Bug #171: Safari allows to create a MediaElementAudioSourceNode with an OfflineAudioContext.\n            if (isNativeOfflineAudioContext(nativeContext)) {\n                throw TypeError();\n            }\n            super(context, true, nativeMediaElementAudioSourceNode, null);\n            this._nativeMediaElementAudioSourceNode = nativeMediaElementAudioSourceNode;\n        }\n        get mediaElement() {\n            return this._nativeMediaElementAudioSourceNode.mediaElement;\n        }\n    };\n};\n//# sourceMappingURL=media-element-audio-source-node-constructor.js.map","const DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'explicit',\n    channelInterpretation: 'speakers'\n};\nexport const createMediaStreamAudioDestinationNodeConstructor = (audioNodeConstructor, createNativeMediaStreamAudioDestinationNode, getNativeContext, isNativeOfflineAudioContext) => {\n    return class MediaStreamAudioDestinationNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            // Bug #173: Safari allows to create a MediaStreamAudioDestinationNode with an OfflineAudioContext.\n            if (isNativeOfflineAudioContext(nativeContext)) {\n                throw new TypeError();\n            }\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeMediaStreamAudioDestinationNode = createNativeMediaStreamAudioDestinationNode(nativeContext, mergedOptions);\n            super(context, false, nativeMediaStreamAudioDestinationNode, null);\n            this._nativeMediaStreamAudioDestinationNode = nativeMediaStreamAudioDestinationNode;\n        }\n        get stream() {\n            return this._nativeMediaStreamAudioDestinationNode.stream;\n        }\n    };\n};\n//# sourceMappingURL=media-stream-audio-destination-node-constructor.js.map","export const createMediaStreamAudioSourceNodeConstructor = (audioNodeConstructor, createNativeMediaStreamAudioSourceNode, getNativeContext, isNativeOfflineAudioContext) => {\n    return class MediaStreamAudioSourceNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const nativeMediaStreamAudioSourceNode = createNativeMediaStreamAudioSourceNode(nativeContext, options);\n            // Bug #172: Safari allows to create a MediaStreamAudioSourceNode with an OfflineAudioContext.\n            if (isNativeOfflineAudioContext(nativeContext)) {\n                throw new TypeError();\n            }\n            super(context, true, nativeMediaStreamAudioSourceNode, null);\n            this._nativeMediaStreamAudioSourceNode = nativeMediaStreamAudioSourceNode;\n        }\n        get mediaStream() {\n            return this._nativeMediaStreamAudioSourceNode.mediaStream;\n        }\n    };\n};\n//# sourceMappingURL=media-stream-audio-source-node-constructor.js.map","export const createMediaStreamTrackAudioSourceNodeConstructor = (audioNodeConstructor, createNativeMediaStreamTrackAudioSourceNode, getNativeContext) => {\n    return class MediaStreamTrackAudioSourceNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const nativeMediaStreamTrackAudioSourceNode = createNativeMediaStreamTrackAudioSourceNode(nativeContext, options);\n            super(context, true, nativeMediaStreamTrackAudioSourceNode, null);\n        }\n    };\n};\n//# sourceMappingURL=media-stream-track-audio-source-node-constructor.js.map","import { CONTEXT_STORE } from '../globals';\nexport const createMinimalBaseAudioContextConstructor = (audioDestinationNodeConstructor, createAudioListener, eventTargetConstructor, isNativeOfflineAudioContext, unrenderedAudioWorkletNodeStore, wrapEventListener) => {\n    return class MinimalBaseAudioContext extends eventTargetConstructor {\n        constructor(_nativeContext, numberOfChannels) {\n            super(_nativeContext);\n            this._nativeContext = _nativeContext;\n            CONTEXT_STORE.set(this, _nativeContext);\n            if (isNativeOfflineAudioContext(_nativeContext)) {\n                unrenderedAudioWorkletNodeStore.set(_nativeContext, new Set());\n            }\n            this._destination = new audioDestinationNodeConstructor(this, numberOfChannels);\n            this._listener = createAudioListener(this, _nativeContext);\n            this._onstatechange = null;\n        }\n        get currentTime() {\n            return this._nativeContext.currentTime;\n        }\n        get destination() {\n            return this._destination;\n        }\n        get listener() {\n            return this._listener;\n        }\n        get onstatechange() {\n            return this._onstatechange;\n        }\n        set onstatechange(value) {\n            const wrappedListener = typeof value === 'function' ? wrapEventListener(this, value) : null;\n            this._nativeContext.onstatechange = wrappedListener;\n            const nativeOnStateChange = this._nativeContext.onstatechange;\n            this._onstatechange = nativeOnStateChange !== null && nativeOnStateChange === wrappedListener ? value : nativeOnStateChange;\n        }\n        get sampleRate() {\n            return this._nativeContext.sampleRate;\n        }\n        get state() {\n            return this._nativeContext.state;\n        }\n    };\n};\n//# sourceMappingURL=minimal-base-audio-context-constructor.js.map","export const testPromiseSupport = (nativeContext) => {\n    // This 12 numbers represent the 48 bytes of an empty WAVE file with a single sample.\n    const uint32Array = new Uint32Array([1179011410, 40, 1163280727, 544501094, 16, 131073, 44100, 176400, 1048580, 1635017060, 4, 0]);\n    try {\n        // Bug #1: Safari requires a successCallback.\n        const promise = nativeContext.decodeAudioData(uint32Array.buffer, () => {\n            // Ignore the success callback.\n        });\n        if (promise === undefined) {\n            return false;\n        }\n        promise.catch(() => {\n            // Ignore rejected errors.\n        });\n        return true;\n    }\n    catch {\n        // Ignore errors.\n    }\n    return false;\n};\n//# sourceMappingURL=test-promise-support.js.map","export const createMonitorConnections = (insertElementInSet, isNativeAudioNode) => {\n    return (nativeAudioNode, whenConnected, whenDisconnected) => {\n        const connections = new Set();\n        nativeAudioNode.connect = ((connect) => {\n            // tslint:disable-next-line:invalid-void no-inferrable-types\n            return (destination, output = 0, input = 0) => {\n                const wasDisconnected = connections.size === 0;\n                if (isNativeAudioNode(destination)) {\n                    // @todo TypeScript cannot infer the overloaded signature with 3 arguments yet.\n                    connect.call(nativeAudioNode, destination, output, input);\n                    insertElementInSet(connections, [destination, output, input], (connection) => connection[0] === destination && connection[1] === output && connection[2] === input, true);\n                    if (wasDisconnected) {\n                        whenConnected();\n                    }\n                    return destination;\n                }\n                connect.call(nativeAudioNode, destination, output);\n                insertElementInSet(connections, [destination, output], (connection) => connection[0] === destination && connection[1] === output, true);\n                if (wasDisconnected) {\n                    whenConnected();\n                }\n                return;\n            };\n        })(nativeAudioNode.connect);\n        nativeAudioNode.disconnect = ((disconnect) => {\n            return (destinationOrOutput, output, input) => {\n                const wasConnected = connections.size > 0;\n                if (destinationOrOutput === undefined) {\n                    disconnect.apply(nativeAudioNode);\n                    connections.clear();\n                }\n                else if (typeof destinationOrOutput === 'number') {\n                    // @todo TypeScript cannot infer the overloaded signature with 1 argument yet.\n                    disconnect.call(nativeAudioNode, destinationOrOutput);\n                    for (const connection of connections) {\n                        if (connection[1] === destinationOrOutput) {\n                            connections.delete(connection);\n                        }\n                    }\n                }\n                else {\n                    if (isNativeAudioNode(destinationOrOutput)) {\n                        // @todo TypeScript cannot infer the overloaded signature with 3 arguments yet.\n                        disconnect.call(nativeAudioNode, destinationOrOutput, output, input);\n                    }\n                    else {\n                        // @todo TypeScript cannot infer the overloaded signature with 2 arguments yet.\n                        disconnect.call(nativeAudioNode, destinationOrOutput, output);\n                    }\n                    for (const connection of connections) {\n                        if (connection[0] === destinationOrOutput &&\n                            (output === undefined || connection[1] === output) &&\n                            (input === undefined || connection[2] === input)) {\n                            connections.delete(connection);\n                        }\n                    }\n                }\n                const isDisconnected = connections.size === 0;\n                if (wasConnected && isDisconnected) {\n                    whenDisconnected();\n                }\n            };\n        })(nativeAudioNode.disconnect);\n        return nativeAudioNode;\n    };\n};\n//# sourceMappingURL=monitor-connections.js.map","export const assignNativeAudioNodeOption = (nativeAudioNode, options, option) => {\n    const value = options[option];\n    if (value !== undefined && value !== nativeAudioNode[option]) {\n        nativeAudioNode[option] = value;\n    }\n};\n//# sourceMappingURL=assign-native-audio-node-option.js.map","import { assignNativeAudioNodeOption } from './assign-native-audio-node-option';\nexport const assignNativeAudioNodeOptions = (nativeAudioNode, options) => {\n    assignNativeAudioNodeOption(nativeAudioNode, options, 'channelCount');\n    assignNativeAudioNodeOption(nativeAudioNode, options, 'channelCountMode');\n    assignNativeAudioNodeOption(nativeAudioNode, options, 'channelInterpretation');\n};\n//# sourceMappingURL=assign-native-audio-node-options.js.map","export const testAnalyserNodeGetFloatTimeDomainDataMethodSupport = (nativeAnalyserNode) => {\n    return typeof nativeAnalyserNode.getFloatTimeDomainData === 'function';\n};\n//# sourceMappingURL=test-analyser-node-get-float-time-domain-data-method-support.js.map","export const wrapAnalyserNodeGetFloatTimeDomainDataMethod = (nativeAnalyserNode) => {\n    nativeAnalyserNode.getFloatTimeDomainData = (array) => {\n        const byteTimeDomainData = new Uint8Array(array.length);\n        nativeAnalyserNode.getByteTimeDomainData(byteTimeDomainData);\n        const length = Math.max(byteTimeDomainData.length, nativeAnalyserNode.fftSize);\n        for (let i = 0; i < length; i += 1) {\n            array[i] = (byteTimeDomainData[i] - 128) * 0.0078125;\n        }\n        return array;\n    };\n};\n//# sourceMappingURL=wrap-analyser-node-get-float-time-domain-data-method.js.map","import { assignNativeAudioNodeOption } from '../helpers/assign-native-audio-node-option';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { testAnalyserNodeGetFloatTimeDomainDataMethodSupport } from '../helpers/test-analyser-node-get-float-time-domain-data-method-support';\nimport { wrapAnalyserNodeGetFloatTimeDomainDataMethod } from '../helpers/wrap-analyser-node-get-float-time-domain-data-method';\nexport const createNativeAnalyserNodeFactory = (cacheTestResult, createIndexSizeError) => {\n    return (nativeContext, options) => {\n        const nativeAnalyserNode = nativeContext.createAnalyser();\n        // Bug #37: Firefox does not create an AnalyserNode with the default properties.\n        assignNativeAudioNodeOptions(nativeAnalyserNode, options);\n        // Bug #118: Safari does not throw an error if maxDecibels is not more than minDecibels.\n        if (!(options.maxDecibels > options.minDecibels)) {\n            throw createIndexSizeError();\n        }\n        assignNativeAudioNodeOption(nativeAnalyserNode, options, 'fftSize');\n        assignNativeAudioNodeOption(nativeAnalyserNode, options, 'maxDecibels');\n        assignNativeAudioNodeOption(nativeAnalyserNode, options, 'minDecibels');\n        assignNativeAudioNodeOption(nativeAnalyserNode, options, 'smoothingTimeConstant');\n        // Bug #36: Safari does not support getFloatTimeDomainData() yet.\n        if (!cacheTestResult(testAnalyserNodeGetFloatTimeDomainDataMethodSupport, () => testAnalyserNodeGetFloatTimeDomainDataMethodSupport(nativeAnalyserNode))) {\n            wrapAnalyserNodeGetFloatTimeDomainDataMethod(nativeAnalyserNode);\n        }\n        return nativeAnalyserNode;\n    };\n};\n//# sourceMappingURL=native-analyser-node-factory.js.map","export const createNativeAudioBufferConstructor = (window) => {\n    if (window === null) {\n        return null;\n    }\n    if (window.hasOwnProperty('AudioBuffer')) {\n        return window.AudioBuffer;\n    }\n    return null;\n};\n//# sourceMappingURL=native-audio-buffer-constructor.js.map","export const assignNativeAudioNodeAudioParamValue = (nativeAudioNode, options, audioParam) => {\n    const value = options[audioParam];\n    if (value !== undefined && value !== nativeAudioNode[audioParam].value) {\n        nativeAudioNode[audioParam].value = value;\n    }\n};\n//# sourceMappingURL=assign-native-audio-node-audio-param-value.js.map","import { createInvalidStateError } from '../factories/invalid-state-error';\nexport const wrapAudioBufferSourceNodeStartMethodConsecutiveCalls = (nativeAudioBufferSourceNode) => {\n    nativeAudioBufferSourceNode.start = ((start) => {\n        let isScheduled = false;\n        return (when = 0, offset = 0, duration) => {\n            if (isScheduled) {\n                throw createInvalidStateError();\n            }\n            start.call(nativeAudioBufferSourceNode, when, offset, duration);\n            isScheduled = true;\n        };\n    })(nativeAudioBufferSourceNode.start);\n};\n//# sourceMappingURL=wrap-audio-buffer-source-node-start-method-consecutive-calls.js.map","export const wrapAudioScheduledSourceNodeStartMethodNegativeParameters = (nativeAudioScheduledSourceNode) => {\n    nativeAudioScheduledSourceNode.start = ((start) => {\n        return (when = 0, offset = 0, duration) => {\n            if ((typeof duration === 'number' && duration < 0) || offset < 0 || when < 0) {\n                throw new RangeError(\"The parameters can't be negative.\");\n            }\n            // @todo TypeScript cannot infer the overloaded signature with 3 arguments yet.\n            start.call(nativeAudioScheduledSourceNode, when, offset, duration);\n        };\n    })(nativeAudioScheduledSourceNode.start);\n};\n//# sourceMappingURL=wrap-audio-scheduled-source-node-start-method-negative-parameters.js.map","export const wrapAudioScheduledSourceNodeStopMethodNegativeParameters = (nativeAudioScheduledSourceNode) => {\n    nativeAudioScheduledSourceNode.stop = ((stop) => {\n        return (when = 0) => {\n            if (when < 0) {\n                throw new RangeError(\"The parameter can't be negative.\");\n            }\n            stop.call(nativeAudioScheduledSourceNode, when);\n        };\n    })(nativeAudioScheduledSourceNode.stop);\n};\n//# sourceMappingURL=wrap-audio-scheduled-source-node-stop-method-negative-parameters.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOption } from '../helpers/assign-native-audio-node-option';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { wrapAudioBufferSourceNodeStartMethodConsecutiveCalls } from '../helpers/wrap-audio-buffer-source-node-start-method-consecutive-calls';\nimport { wrapAudioScheduledSourceNodeStartMethodNegativeParameters } from '../helpers/wrap-audio-scheduled-source-node-start-method-negative-parameters';\nimport { wrapAudioScheduledSourceNodeStopMethodNegativeParameters } from '../helpers/wrap-audio-scheduled-source-node-stop-method-negative-parameters';\nexport const createNativeAudioBufferSourceNodeFactory = (addSilentConnection, cacheTestResult, testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport, testAudioBufferSourceNodeStartMethodOffsetClampingSupport, testAudioBufferSourceNodeStopMethodNullifiedBufferSupport, testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport, testAudioScheduledSourceNodeStopMethodNegativeParametersSupport, wrapAudioBufferSourceNodeStartMethodOffsetClampling, wrapAudioBufferSourceNodeStopMethodNullifiedBuffer, wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls) => {\n    return (nativeContext, options) => {\n        const nativeAudioBufferSourceNode = nativeContext.createBufferSource();\n        assignNativeAudioNodeOptions(nativeAudioBufferSourceNode, options);\n        assignNativeAudioNodeAudioParamValue(nativeAudioBufferSourceNode, options, 'playbackRate');\n        assignNativeAudioNodeOption(nativeAudioBufferSourceNode, options, 'buffer');\n        // Bug #149: Safari does not yet support the detune AudioParam.\n        assignNativeAudioNodeOption(nativeAudioBufferSourceNode, options, 'loop');\n        assignNativeAudioNodeOption(nativeAudioBufferSourceNode, options, 'loopEnd');\n        assignNativeAudioNodeOption(nativeAudioBufferSourceNode, options, 'loopStart');\n        // Bug #69: Safari does allow calls to start() of an already scheduled AudioBufferSourceNode.\n        if (!cacheTestResult(testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport, () => testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport(nativeContext))) {\n            wrapAudioBufferSourceNodeStartMethodConsecutiveCalls(nativeAudioBufferSourceNode);\n        }\n        // Bug #154 & #155: Safari does not handle offsets which are equal to or greater than the duration of the buffer.\n        if (!cacheTestResult(testAudioBufferSourceNodeStartMethodOffsetClampingSupport, () => testAudioBufferSourceNodeStartMethodOffsetClampingSupport(nativeContext))) {\n            wrapAudioBufferSourceNodeStartMethodOffsetClampling(nativeAudioBufferSourceNode);\n        }\n        // Bug #162: Safari does throw an error when stop() is called on an AudioBufferSourceNode which has no buffer assigned to it.\n        if (!cacheTestResult(testAudioBufferSourceNodeStopMethodNullifiedBufferSupport, () => testAudioBufferSourceNodeStopMethodNullifiedBufferSupport(nativeContext))) {\n            wrapAudioBufferSourceNodeStopMethodNullifiedBuffer(nativeAudioBufferSourceNode, nativeContext);\n        }\n        // Bug #44: Safari does not throw a RangeError yet.\n        if (!cacheTestResult(testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, () => testAudioScheduledSourceNodeStartMethodNegativeParametersSupport(nativeContext))) {\n            wrapAudioScheduledSourceNodeStartMethodNegativeParameters(nativeAudioBufferSourceNode);\n        }\n        // Bug #19: Safari does not ignore calls to stop() of an already stopped AudioBufferSourceNode.\n        if (!cacheTestResult(testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport, () => testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport(nativeContext))) {\n            wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls(nativeAudioBufferSourceNode, nativeContext);\n        }\n        // Bug #44: Only Firefox does not throw a RangeError yet.\n        if (!cacheTestResult(testAudioScheduledSourceNodeStopMethodNegativeParametersSupport, () => testAudioScheduledSourceNodeStopMethodNegativeParametersSupport(nativeContext))) {\n            wrapAudioScheduledSourceNodeStopMethodNegativeParameters(nativeAudioBufferSourceNode);\n        }\n        // Bug #175: Safari will not fire an ended event if the AudioBufferSourceNode is unconnected.\n        addSilentConnection(nativeContext, nativeAudioBufferSourceNode);\n        return nativeAudioBufferSourceNode;\n    };\n};\n//# sourceMappingURL=native-audio-buffer-source-node-factory.js.map","export const createNativeAudioContextConstructor = (window) => {\n    if (window === null) {\n        return null;\n    }\n    if (window.hasOwnProperty('AudioContext')) {\n        return window.AudioContext;\n    }\n    return window.hasOwnProperty('webkitAudioContext') ? window.webkitAudioContext : null;\n};\n//# sourceMappingURL=native-audio-context-constructor.js.map","export const createNativeAudioDestinationNodeFactory = (createNativeGainNode, overwriteAccessors) => {\n    return (nativeContext, channelCount, isNodeOfNativeOfflineAudioContext) => {\n        const nativeAudioDestinationNode = nativeContext.destination;\n        // Bug #132: Safari does not have the correct channelCount.\n        if (nativeAudioDestinationNode.channelCount !== channelCount) {\n            try {\n                nativeAudioDestinationNode.channelCount = channelCount;\n            }\n            catch {\n                // Bug #169: Safari throws an error on each attempt to change the channelCount.\n            }\n        }\n        // Bug #83: Safari does not have the correct channelCountMode.\n        if (isNodeOfNativeOfflineAudioContext && nativeAudioDestinationNode.channelCountMode !== 'explicit') {\n            nativeAudioDestinationNode.channelCountMode = 'explicit';\n        }\n        // Bug #47: The AudioDestinationNode in Safari does not initialize the maxChannelCount property correctly.\n        if (nativeAudioDestinationNode.maxChannelCount === 0) {\n            Object.defineProperty(nativeAudioDestinationNode, 'maxChannelCount', {\n                value: channelCount\n            });\n        }\n        // Bug #168: No browser does yet have an AudioDestinationNode with an output.\n        const gainNode = createNativeGainNode(nativeContext, {\n            channelCount,\n            channelCountMode: nativeAudioDestinationNode.channelCountMode,\n            channelInterpretation: nativeAudioDestinationNode.channelInterpretation,\n            gain: 1\n        });\n        overwriteAccessors(gainNode, 'channelCount', (get) => () => get.call(gainNode), (set) => (value) => {\n            set.call(gainNode, value);\n            try {\n                nativeAudioDestinationNode.channelCount = value;\n            }\n            catch (err) {\n                // Bug #169: Safari throws an error on each attempt to change the channelCount.\n                if (value > nativeAudioDestinationNode.maxChannelCount) {\n                    throw err;\n                }\n            }\n        });\n        overwriteAccessors(gainNode, 'channelCountMode', (get) => () => get.call(gainNode), (set) => (value) => {\n            set.call(gainNode, value);\n            nativeAudioDestinationNode.channelCountMode = value;\n        });\n        overwriteAccessors(gainNode, 'channelInterpretation', (get) => () => get.call(gainNode), (set) => (value) => {\n            set.call(gainNode, value);\n            nativeAudioDestinationNode.channelInterpretation = value;\n        });\n        Object.defineProperty(gainNode, 'maxChannelCount', {\n            get: () => nativeAudioDestinationNode.maxChannelCount\n        });\n        // @todo This should be disconnected when the context is closed.\n        gainNode.connect(nativeAudioDestinationNode);\n        return gainNode;\n    };\n};\n//# sourceMappingURL=native-audio-destination-node.js.map","export const createNativeAudioWorkletNodeConstructor = (window) => {\n    if (window === null) {\n        return null;\n    }\n    return window.hasOwnProperty('AudioWorkletNode') ? window.AudioWorkletNode : null;\n};\n//# sourceMappingURL=native-audio-worklet-node-constructor.js.map","export const testClonabilityOfAudioWorkletNodeOptions = (audioWorkletNodeOptions) => {\n    const { port1 } = new MessageChannel();\n    try {\n        // This will throw an error if the audioWorkletNodeOptions are not clonable.\n        port1.postMessage(audioWorkletNodeOptions);\n    }\n    finally {\n        port1.close();\n    }\n};\n//# sourceMappingURL=test-clonability-of-audio-worklet-node-options.js.map","import { testClonabilityOfAudioWorkletNodeOptions } from '../helpers/test-clonability-of-audio-worklet-node-options';\nexport const createNativeAudioWorkletNodeFactory = (createInvalidStateError, createNativeAudioWorkletNodeFaker, createNativeGainNode, createNotSupportedError, monitorConnections) => {\n    return (nativeContext, baseLatency, nativeAudioWorkletNodeConstructor, name, processorConstructor, options) => {\n        if (nativeAudioWorkletNodeConstructor !== null) {\n            try {\n                const nativeAudioWorkletNode = new nativeAudioWorkletNodeConstructor(nativeContext, name, options);\n                const patchedEventListeners = new Map();\n                let onprocessorerror = null;\n                Object.defineProperties(nativeAudioWorkletNode, {\n                    /*\n                     * Bug #61: Overwriting the property accessors for channelCount and channelCountMode is necessary as long as some\n                     * browsers have no native implementation to achieve a consistent behavior.\n                     */\n                    channelCount: {\n                        get: () => options.channelCount,\n                        set: () => {\n                            throw createInvalidStateError();\n                        }\n                    },\n                    channelCountMode: {\n                        get: () => 'explicit',\n                        set: () => {\n                            throw createInvalidStateError();\n                        }\n                    },\n                    // Bug #156: Chrome and Edge do not yet fire an ErrorEvent.\n                    onprocessorerror: {\n                        get: () => onprocessorerror,\n                        set: (value) => {\n                            if (typeof onprocessorerror === 'function') {\n                                nativeAudioWorkletNode.removeEventListener('processorerror', onprocessorerror);\n                            }\n                            onprocessorerror = typeof value === 'function' ? value : null;\n                            if (typeof onprocessorerror === 'function') {\n                                nativeAudioWorkletNode.addEventListener('processorerror', onprocessorerror);\n                            }\n                        }\n                    }\n                });\n                nativeAudioWorkletNode.addEventListener = ((addEventListener) => {\n                    return (...args) => {\n                        if (args[0] === 'processorerror') {\n                            const unpatchedEventListener = typeof args[1] === 'function'\n                                ? args[1]\n                                : typeof args[1] === 'object' && args[1] !== null && typeof args[1].handleEvent === 'function'\n                                    ? args[1].handleEvent\n                                    : null;\n                            if (unpatchedEventListener !== null) {\n                                const patchedEventListener = patchedEventListeners.get(args[1]);\n                                if (patchedEventListener !== undefined) {\n                                    args[1] = patchedEventListener;\n                                }\n                                else {\n                                    args[1] = (event) => {\n                                        // Bug #178: Chrome and Edge do fire an event of type error.\n                                        if (event.type === 'error') {\n                                            Object.defineProperties(event, {\n                                                type: { value: 'processorerror' }\n                                            });\n                                            unpatchedEventListener(event);\n                                        }\n                                        else {\n                                            unpatchedEventListener(new ErrorEvent(args[0], { ...event }));\n                                        }\n                                    };\n                                    patchedEventListeners.set(unpatchedEventListener, args[1]);\n                                }\n                            }\n                        }\n                        // Bug #178: Chrome and Edge do fire an event of type error.\n                        addEventListener.call(nativeAudioWorkletNode, 'error', args[1], args[2]);\n                        return addEventListener.call(nativeAudioWorkletNode, ...args);\n                    };\n                })(nativeAudioWorkletNode.addEventListener);\n                nativeAudioWorkletNode.removeEventListener = ((removeEventListener) => {\n                    return (...args) => {\n                        if (args[0] === 'processorerror') {\n                            const patchedEventListener = patchedEventListeners.get(args[1]);\n                            if (patchedEventListener !== undefined) {\n                                patchedEventListeners.delete(args[1]);\n                                args[1] = patchedEventListener;\n                            }\n                        }\n                        // Bug #178: Chrome and Edge do fire an event of type error.\n                        removeEventListener.call(nativeAudioWorkletNode, 'error', args[1], args[2]);\n                        return removeEventListener.call(nativeAudioWorkletNode, args[0], args[1], args[2]);\n                    };\n                })(nativeAudioWorkletNode.removeEventListener);\n                /*\n                 * Bug #86: Chrome and Edge do not invoke the process() function if the corresponding AudioWorkletNode is unconnected but\n                 * has an output.\n                 */\n                if (options.numberOfOutputs !== 0) {\n                    const nativeGainNode = createNativeGainNode(nativeContext, {\n                        channelCount: 1,\n                        channelCountMode: 'explicit',\n                        channelInterpretation: 'discrete',\n                        gain: 0\n                    });\n                    nativeAudioWorkletNode.connect(nativeGainNode).connect(nativeContext.destination);\n                    const whenConnected = () => nativeGainNode.disconnect();\n                    const whenDisconnected = () => nativeGainNode.connect(nativeContext.destination);\n                    // @todo Disconnect the connection when the process() function of the AudioWorkletNode returns false.\n                    return monitorConnections(nativeAudioWorkletNode, whenConnected, whenDisconnected);\n                }\n                return nativeAudioWorkletNode;\n            }\n            catch (err) {\n                // Bug #60: Chrome & Edge throw an InvalidStateError instead of a NotSupportedError.\n                if (err.code === 11) {\n                    throw createNotSupportedError();\n                }\n                throw err;\n            }\n        }\n        // Bug #61: Only Chrome & Edge have an implementation of the AudioWorkletNode yet.\n        if (processorConstructor === undefined) {\n            throw createNotSupportedError();\n        }\n        testClonabilityOfAudioWorkletNodeOptions(options);\n        return createNativeAudioWorkletNodeFaker(nativeContext, baseLatency, processorConstructor, options);\n    };\n};\n//# sourceMappingURL=native-audio-worklet-node-factory.js.map","export const computeBufferSize = (baseLatency, sampleRate) => {\n    if (baseLatency === null) {\n        return 512;\n    }\n    return Math.max(512, Math.min(16384, Math.pow(2, Math.round(Math.log2(baseLatency * sampleRate)))));\n};\n//# sourceMappingURL=compute-buffer-size.js.map","export const cloneAudioWorkletNodeOptions = (audioWorkletNodeOptions) => {\n    return new Promise((resolve, reject) => {\n        const { port1, port2 } = new MessageChannel();\n        port1.onmessage = ({ data }) => {\n            port1.close();\n            port2.close();\n            resolve(data);\n        };\n        port1.onmessageerror = ({ data }) => {\n            port1.close();\n            port2.close();\n            reject(data);\n        };\n        // This will throw an error if the audioWorkletNodeOptions are not clonable.\n        port2.postMessage(audioWorkletNodeOptions);\n    });\n};\n//# sourceMappingURL=clone-audio-worklet-node-options.js.map","import { cloneAudioWorkletNodeOptions } from './clone-audio-worklet-node-options';\nexport const createAudioWorkletProcessorPromise = async (processorConstructor, audioWorkletNodeOptions) => {\n    const clonedAudioWorkletNodeOptions = await cloneAudioWorkletNodeOptions(audioWorkletNodeOptions);\n    return new processorConstructor(clonedAudioWorkletNodeOptions);\n};\n//# sourceMappingURL=create-audio-worklet-processor-promise.js.map","import { NODE_TO_PROCESSOR_MAPS } from '../globals';\nimport { createAudioWorkletProcessorPromise } from './create-audio-worklet-processor-promise';\nexport const createAudioWorkletProcessor = (nativeContext, nativeAudioWorkletNode, processorConstructor, audioWorkletNodeOptions) => {\n    let nodeToProcessorMap = NODE_TO_PROCESSOR_MAPS.get(nativeContext);\n    if (nodeToProcessorMap === undefined) {\n        nodeToProcessorMap = new WeakMap();\n        NODE_TO_PROCESSOR_MAPS.set(nativeContext, nodeToProcessorMap);\n    }\n    const audioWorkletProcessorPromise = createAudioWorkletProcessorPromise(processorConstructor, audioWorkletNodeOptions);\n    nodeToProcessorMap.set(nativeAudioWorkletNode, audioWorkletProcessorPromise);\n    return audioWorkletProcessorPromise;\n};\n//# sourceMappingURL=create-audio-worklet-processor.js.map","import { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nimport { computeBufferSize } from '../helpers/compute-buffer-size';\nimport { copyFromChannel } from '../helpers/copy-from-channel';\nimport { copyToChannel } from '../helpers/copy-to-channel';\nimport { createAudioWorkletProcessor } from '../helpers/create-audio-worklet-processor';\nimport { createNestedArrays } from '../helpers/create-nested-arrays';\nimport { ReadOnlyMap } from '../read-only-map';\nexport const createNativeAudioWorkletNodeFakerFactory = (connectMultipleOutputs, createIndexSizeError, createInvalidStateError, createNativeChannelMergerNode, createNativeChannelSplitterNode, createNativeConstantSourceNode, createNativeGainNode, createNativeScriptProcessorNode, createNotSupportedError, disconnectMultipleOutputs, exposeCurrentFrameAndCurrentTime, getActiveAudioWorkletNodeInputs, monitorConnections) => {\n    return (nativeContext, baseLatency, processorConstructor, options) => {\n        if (options.numberOfInputs === 0 && options.numberOfOutputs === 0) {\n            throw createNotSupportedError();\n        }\n        const outputChannelCount = Array.isArray(options.outputChannelCount)\n            ? options.outputChannelCount\n            : Array.from(options.outputChannelCount);\n        // @todo Check if any of the channelCount values is greater than the implementation's maximum number of channels.\n        if (outputChannelCount.some((channelCount) => channelCount < 1)) {\n            throw createNotSupportedError();\n        }\n        if (outputChannelCount.length !== options.numberOfOutputs) {\n            throw createIndexSizeError();\n        }\n        // Bug #61: This is not part of the standard but required for the faker to work.\n        if (options.channelCountMode !== 'explicit') {\n            throw createNotSupportedError();\n        }\n        const numberOfInputChannels = options.channelCount * options.numberOfInputs;\n        const numberOfOutputChannels = outputChannelCount.reduce((sum, value) => sum + value, 0);\n        const numberOfParameters = processorConstructor.parameterDescriptors === undefined ? 0 : processorConstructor.parameterDescriptors.length;\n        // Bug #61: This is not part of the standard but required for the faker to work.\n        if (numberOfInputChannels + numberOfParameters > 6 || numberOfOutputChannels > 6) {\n            throw createNotSupportedError();\n        }\n        const messageChannel = new MessageChannel();\n        const gainNodes = [];\n        const inputChannelSplitterNodes = [];\n        for (let i = 0; i < options.numberOfInputs; i += 1) {\n            gainNodes.push(createNativeGainNode(nativeContext, {\n                channelCount: options.channelCount,\n                channelCountMode: options.channelCountMode,\n                channelInterpretation: options.channelInterpretation,\n                gain: 1\n            }));\n            inputChannelSplitterNodes.push(createNativeChannelSplitterNode(nativeContext, {\n                channelCount: options.channelCount,\n                channelCountMode: 'explicit',\n                channelInterpretation: 'discrete',\n                numberOfOutputs: options.channelCount\n            }));\n        }\n        const constantSourceNodes = [];\n        if (processorConstructor.parameterDescriptors !== undefined) {\n            for (const { defaultValue, maxValue, minValue, name } of processorConstructor.parameterDescriptors) {\n                const constantSourceNode = createNativeConstantSourceNode(nativeContext, {\n                    channelCount: 1,\n                    channelCountMode: 'explicit',\n                    channelInterpretation: 'discrete',\n                    offset: options.parameterData[name] !== undefined\n                        ? options.parameterData[name]\n                        : defaultValue === undefined\n                            ? 0\n                            : defaultValue\n                });\n                Object.defineProperties(constantSourceNode.offset, {\n                    defaultValue: {\n                        get: () => (defaultValue === undefined ? 0 : defaultValue)\n                    },\n                    maxValue: {\n                        get: () => (maxValue === undefined ? MOST_POSITIVE_SINGLE_FLOAT : maxValue)\n                    },\n                    minValue: {\n                        get: () => (minValue === undefined ? MOST_NEGATIVE_SINGLE_FLOAT : minValue)\n                    }\n                });\n                constantSourceNodes.push(constantSourceNode);\n            }\n        }\n        const inputChannelMergerNode = createNativeChannelMergerNode(nativeContext, {\n            channelCount: 1,\n            channelCountMode: 'explicit',\n            channelInterpretation: 'speakers',\n            numberOfInputs: Math.max(1, numberOfInputChannels + numberOfParameters)\n        });\n        const bufferSize = computeBufferSize(baseLatency, nativeContext.sampleRate);\n        const scriptProcessorNode = createNativeScriptProcessorNode(nativeContext, bufferSize, numberOfInputChannels + numberOfParameters, \n        // Bug #87: Only Firefox will fire an AudioProcessingEvent if there is no connected output.\n        Math.max(1, numberOfOutputChannels));\n        const outputChannelSplitterNode = createNativeChannelSplitterNode(nativeContext, {\n            channelCount: Math.max(1, numberOfOutputChannels),\n            channelCountMode: 'explicit',\n            channelInterpretation: 'discrete',\n            numberOfOutputs: Math.max(1, numberOfOutputChannels)\n        });\n        const outputChannelMergerNodes = [];\n        for (let i = 0; i < options.numberOfOutputs; i += 1) {\n            outputChannelMergerNodes.push(createNativeChannelMergerNode(nativeContext, {\n                channelCount: 1,\n                channelCountMode: 'explicit',\n                channelInterpretation: 'speakers',\n                numberOfInputs: outputChannelCount[i]\n            }));\n        }\n        for (let i = 0; i < options.numberOfInputs; i += 1) {\n            gainNodes[i].connect(inputChannelSplitterNodes[i]);\n            for (let j = 0; j < options.channelCount; j += 1) {\n                inputChannelSplitterNodes[i].connect(inputChannelMergerNode, j, i * options.channelCount + j);\n            }\n        }\n        const parameterMap = new ReadOnlyMap(processorConstructor.parameterDescriptors === undefined\n            ? []\n            : processorConstructor.parameterDescriptors.map(({ name }, index) => {\n                const constantSourceNode = constantSourceNodes[index];\n                constantSourceNode.connect(inputChannelMergerNode, 0, numberOfInputChannels + index);\n                constantSourceNode.start(0);\n                return [name, constantSourceNode.offset];\n            }));\n        inputChannelMergerNode.connect(scriptProcessorNode);\n        let channelInterpretation = options.channelInterpretation;\n        let onprocessorerror = null;\n        // Bug #87: Expose at least one output to make this node connectable.\n        const outputAudioNodes = options.numberOfOutputs === 0 ? [scriptProcessorNode] : outputChannelMergerNodes;\n        const nativeAudioWorkletNodeFaker = {\n            get bufferSize() {\n                return bufferSize;\n            },\n            get channelCount() {\n                return options.channelCount;\n            },\n            set channelCount(_) {\n                // Bug #61: This is not part of the standard but required for the faker to work.\n                throw createInvalidStateError();\n            },\n            get channelCountMode() {\n                return options.channelCountMode;\n            },\n            set channelCountMode(_) {\n                // Bug #61: This is not part of the standard but required for the faker to work.\n                throw createInvalidStateError();\n            },\n            get channelInterpretation() {\n                return channelInterpretation;\n            },\n            set channelInterpretation(value) {\n                for (const gainNode of gainNodes) {\n                    gainNode.channelInterpretation = value;\n                }\n                channelInterpretation = value;\n            },\n            get context() {\n                return scriptProcessorNode.context;\n            },\n            get inputs() {\n                return gainNodes;\n            },\n            get numberOfInputs() {\n                return options.numberOfInputs;\n            },\n            get numberOfOutputs() {\n                return options.numberOfOutputs;\n            },\n            get onprocessorerror() {\n                return onprocessorerror;\n            },\n            set onprocessorerror(value) {\n                if (typeof onprocessorerror === 'function') {\n                    nativeAudioWorkletNodeFaker.removeEventListener('processorerror', onprocessorerror);\n                }\n                onprocessorerror = typeof value === 'function' ? value : null;\n                if (typeof onprocessorerror === 'function') {\n                    nativeAudioWorkletNodeFaker.addEventListener('processorerror', onprocessorerror);\n                }\n            },\n            get parameters() {\n                return parameterMap;\n            },\n            get port() {\n                return messageChannel.port2;\n            },\n            addEventListener(...args) {\n                return scriptProcessorNode.addEventListener(args[0], args[1], args[2]);\n            },\n            connect: connectMultipleOutputs.bind(null, outputAudioNodes),\n            disconnect: disconnectMultipleOutputs.bind(null, outputAudioNodes),\n            dispatchEvent(...args) {\n                return scriptProcessorNode.dispatchEvent(args[0]);\n            },\n            removeEventListener(...args) {\n                return scriptProcessorNode.removeEventListener(args[0], args[1], args[2]);\n            }\n        };\n        const patchedEventListeners = new Map();\n        messageChannel.port1.addEventListener = ((addEventListener) => {\n            return (...args) => {\n                if (args[0] === 'message') {\n                    const unpatchedEventListener = typeof args[1] === 'function'\n                        ? args[1]\n                        : typeof args[1] === 'object' && args[1] !== null && typeof args[1].handleEvent === 'function'\n                            ? args[1].handleEvent\n                            : null;\n                    if (unpatchedEventListener !== null) {\n                        const patchedEventListener = patchedEventListeners.get(args[1]);\n                        if (patchedEventListener !== undefined) {\n                            args[1] = patchedEventListener;\n                        }\n                        else {\n                            args[1] = (event) => {\n                                exposeCurrentFrameAndCurrentTime(nativeContext.currentTime, nativeContext.sampleRate, () => unpatchedEventListener(event));\n                            };\n                            patchedEventListeners.set(unpatchedEventListener, args[1]);\n                        }\n                    }\n                }\n                return addEventListener.call(messageChannel.port1, args[0], args[1], args[2]);\n            };\n        })(messageChannel.port1.addEventListener);\n        messageChannel.port1.removeEventListener = ((removeEventListener) => {\n            return (...args) => {\n                if (args[0] === 'message') {\n                    const patchedEventListener = patchedEventListeners.get(args[1]);\n                    if (patchedEventListener !== undefined) {\n                        patchedEventListeners.delete(args[1]);\n                        args[1] = patchedEventListener;\n                    }\n                }\n                return removeEventListener.call(messageChannel.port1, args[0], args[1], args[2]);\n            };\n        })(messageChannel.port1.removeEventListener);\n        let onmessage = null;\n        Object.defineProperty(messageChannel.port1, 'onmessage', {\n            get: () => onmessage,\n            set: (value) => {\n                if (typeof onmessage === 'function') {\n                    messageChannel.port1.removeEventListener('message', onmessage);\n                }\n                onmessage = typeof value === 'function' ? value : null;\n                if (typeof onmessage === 'function') {\n                    messageChannel.port1.addEventListener('message', onmessage);\n                    messageChannel.port1.start();\n                }\n            }\n        });\n        processorConstructor.prototype.port = messageChannel.port1;\n        let audioWorkletProcessor = null;\n        const audioWorkletProcessorPromise = createAudioWorkletProcessor(nativeContext, nativeAudioWorkletNodeFaker, processorConstructor, options);\n        audioWorkletProcessorPromise.then((dWrkltPrcssr) => (audioWorkletProcessor = dWrkltPrcssr));\n        const inputs = createNestedArrays(options.numberOfInputs, options.channelCount);\n        const outputs = createNestedArrays(options.numberOfOutputs, outputChannelCount);\n        const parameters = processorConstructor.parameterDescriptors === undefined\n            ? []\n            : processorConstructor.parameterDescriptors.reduce((prmtrs, { name }) => ({ ...prmtrs, [name]: new Float32Array(128) }), {});\n        let isActive = true;\n        const disconnectOutputsGraph = () => {\n            if (options.numberOfOutputs > 0) {\n                scriptProcessorNode.disconnect(outputChannelSplitterNode);\n            }\n            for (let i = 0, outputChannelSplitterNodeOutput = 0; i < options.numberOfOutputs; i += 1) {\n                const outputChannelMergerNode = outputChannelMergerNodes[i];\n                for (let j = 0; j < outputChannelCount[i]; j += 1) {\n                    outputChannelSplitterNode.disconnect(outputChannelMergerNode, outputChannelSplitterNodeOutput + j, j);\n                }\n                outputChannelSplitterNodeOutput += outputChannelCount[i];\n            }\n        };\n        const activeInputIndexes = new Map();\n        // tslint:disable-next-line:deprecation\n        scriptProcessorNode.onaudioprocess = ({ inputBuffer, outputBuffer }) => {\n            if (audioWorkletProcessor !== null) {\n                const activeInputs = getActiveAudioWorkletNodeInputs(nativeAudioWorkletNodeFaker);\n                for (let i = 0; i < bufferSize; i += 128) {\n                    for (let j = 0; j < options.numberOfInputs; j += 1) {\n                        for (let k = 0; k < options.channelCount; k += 1) {\n                            copyFromChannel(inputBuffer, inputs[j], k, k, i);\n                        }\n                    }\n                    if (processorConstructor.parameterDescriptors !== undefined) {\n                        processorConstructor.parameterDescriptors.forEach(({ name }, index) => {\n                            copyFromChannel(inputBuffer, parameters, name, numberOfInputChannels + index, i);\n                        });\n                    }\n                    for (let j = 0; j < options.numberOfInputs; j += 1) {\n                        for (let k = 0; k < outputChannelCount[j]; k += 1) {\n                            // The byteLength will be 0 when the ArrayBuffer was transferred.\n                            if (outputs[j][k].byteLength === 0) {\n                                outputs[j][k] = new Float32Array(128);\n                            }\n                        }\n                    }\n                    try {\n                        const potentiallyEmptyInputs = inputs.map((input, index) => {\n                            const activeInput = activeInputs[index];\n                            if (activeInput.size > 0) {\n                                activeInputIndexes.set(index, bufferSize / 128);\n                                return input;\n                            }\n                            const count = activeInputIndexes.get(index);\n                            if (count === undefined) {\n                                return [];\n                            }\n                            if (input.every((channelData) => channelData.every((sample) => sample === 0))) {\n                                if (count === 1) {\n                                    activeInputIndexes.delete(index);\n                                }\n                                else {\n                                    activeInputIndexes.set(index, count - 1);\n                                }\n                            }\n                            return input;\n                        });\n                        const activeSourceFlag = exposeCurrentFrameAndCurrentTime(nativeContext.currentTime + i / nativeContext.sampleRate, nativeContext.sampleRate, () => audioWorkletProcessor.process(potentiallyEmptyInputs, outputs, parameters));\n                        isActive = activeSourceFlag;\n                        for (let j = 0, outputChannelSplitterNodeOutput = 0; j < options.numberOfOutputs; j += 1) {\n                            for (let k = 0; k < outputChannelCount[j]; k += 1) {\n                                copyToChannel(outputBuffer, outputs[j], k, outputChannelSplitterNodeOutput + k, i);\n                            }\n                            outputChannelSplitterNodeOutput += outputChannelCount[j];\n                        }\n                    }\n                    catch (error) {\n                        isActive = false;\n                        nativeAudioWorkletNodeFaker.dispatchEvent(new ErrorEvent('processorerror', {\n                            colno: error.colno,\n                            filename: error.filename,\n                            lineno: error.lineno,\n                            message: error.message\n                        }));\n                    }\n                    if (!isActive) {\n                        for (let j = 0; j < options.numberOfInputs; j += 1) {\n                            gainNodes[j].disconnect(inputChannelSplitterNodes[j]);\n                            for (let k = 0; k < options.channelCount; k += 1) {\n                                inputChannelSplitterNodes[i].disconnect(inputChannelMergerNode, k, j * options.channelCount + k);\n                            }\n                        }\n                        if (processorConstructor.parameterDescriptors !== undefined) {\n                            const length = processorConstructor.parameterDescriptors.length;\n                            for (let j = 0; j < length; j += 1) {\n                                const constantSourceNode = constantSourceNodes[j];\n                                constantSourceNode.disconnect(inputChannelMergerNode, 0, numberOfInputChannels + j);\n                                constantSourceNode.stop();\n                            }\n                        }\n                        inputChannelMergerNode.disconnect(scriptProcessorNode);\n                        scriptProcessorNode.onaudioprocess = null; // tslint:disable-line:deprecation\n                        if (isConnected) {\n                            disconnectOutputsGraph();\n                        }\n                        else {\n                            disconnectFakeGraph();\n                        }\n                        break;\n                    }\n                }\n            }\n        };\n        let isConnected = false;\n        // Bug #87: Only Firefox will fire an AudioProcessingEvent if there is no connected output.\n        const nativeGainNode = createNativeGainNode(nativeContext, {\n            channelCount: 1,\n            channelCountMode: 'explicit',\n            channelInterpretation: 'discrete',\n            gain: 0\n        });\n        const connectFakeGraph = () => scriptProcessorNode.connect(nativeGainNode).connect(nativeContext.destination);\n        const disconnectFakeGraph = () => {\n            scriptProcessorNode.disconnect(nativeGainNode);\n            nativeGainNode.disconnect();\n        };\n        const whenConnected = () => {\n            if (isActive) {\n                disconnectFakeGraph();\n                if (options.numberOfOutputs > 0) {\n                    scriptProcessorNode.connect(outputChannelSplitterNode);\n                }\n                for (let i = 0, outputChannelSplitterNodeOutput = 0; i < options.numberOfOutputs; i += 1) {\n                    const outputChannelMergerNode = outputChannelMergerNodes[i];\n                    for (let j = 0; j < outputChannelCount[i]; j += 1) {\n                        outputChannelSplitterNode.connect(outputChannelMergerNode, outputChannelSplitterNodeOutput + j, j);\n                    }\n                    outputChannelSplitterNodeOutput += outputChannelCount[i];\n                }\n            }\n            isConnected = true;\n        };\n        const whenDisconnected = () => {\n            if (isActive) {\n                connectFakeGraph();\n                disconnectOutputsGraph();\n            }\n            isConnected = false;\n        };\n        connectFakeGraph();\n        return monitorConnections(nativeAudioWorkletNodeFaker, whenConnected, whenDisconnected);\n    };\n};\n//# sourceMappingURL=native-audio-worklet-node-faker-factory.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOption } from '../helpers/assign-native-audio-node-option';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeBiquadFilterNode = (nativeContext, options) => {\n    const nativeBiquadFilterNode = nativeContext.createBiquadFilter();\n    assignNativeAudioNodeOptions(nativeBiquadFilterNode, options);\n    assignNativeAudioNodeAudioParamValue(nativeBiquadFilterNode, options, 'Q');\n    assignNativeAudioNodeAudioParamValue(nativeBiquadFilterNode, options, 'detune');\n    assignNativeAudioNodeAudioParamValue(nativeBiquadFilterNode, options, 'frequency');\n    assignNativeAudioNodeAudioParamValue(nativeBiquadFilterNode, options, 'gain');\n    assignNativeAudioNodeOption(nativeBiquadFilterNode, options, 'type');\n    return nativeBiquadFilterNode;\n};\n//# sourceMappingURL=native-biquad-filter-node.js.map","import { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeChannelMergerNodeFactory = (nativeAudioContextConstructor, wrapChannelMergerNode) => {\n    return (nativeContext, options) => {\n        const nativeChannelMergerNode = nativeContext.createChannelMerger(options.numberOfInputs);\n        /*\n         * Bug #20: Safari requires a connection of any kind to treat the input signal correctly.\n         * @todo Unfortunately there is no way to test for this behavior in a synchronous fashion which is why testing for the existence of\n         * the webkitAudioContext is used as a workaround here.\n         */\n        if (nativeAudioContextConstructor !== null && nativeAudioContextConstructor.name === 'webkitAudioContext') {\n            wrapChannelMergerNode(nativeContext, nativeChannelMergerNode);\n        }\n        assignNativeAudioNodeOptions(nativeChannelMergerNode, options);\n        return nativeChannelMergerNode;\n    };\n};\n//# sourceMappingURL=native-channel-merger-node-factory.js.map","import { createInvalidStateError } from '../factories/invalid-state-error';\nexport const wrapChannelSplitterNode = (channelSplitterNode) => {\n    const channelCount = channelSplitterNode.numberOfOutputs;\n    // Bug #97: Safari does not throw an error when attempting to change the channelCount to something other than its initial value.\n    Object.defineProperty(channelSplitterNode, 'channelCount', {\n        get: () => channelCount,\n        set: (value) => {\n            if (value !== channelCount) {\n                throw createInvalidStateError();\n            }\n        }\n    });\n    // Bug #30: Safari does not throw an error when attempting to change the channelCountMode to something other than explicit.\n    Object.defineProperty(channelSplitterNode, 'channelCountMode', {\n        get: () => 'explicit',\n        set: (value) => {\n            if (value !== 'explicit') {\n                throw createInvalidStateError();\n            }\n        }\n    });\n    // Bug #32: Safari does not throw an error when attempting to change the channelInterpretation to something other than discrete.\n    Object.defineProperty(channelSplitterNode, 'channelInterpretation', {\n        get: () => 'discrete',\n        set: (value) => {\n            if (value !== 'discrete') {\n                throw createInvalidStateError();\n            }\n        }\n    });\n};\n//# sourceMappingURL=wrap-channel-splitter-node.js.map","import { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { wrapChannelSplitterNode } from '../helpers/wrap-channel-splitter-node';\nexport const createNativeChannelSplitterNode = (nativeContext, options) => {\n    const nativeChannelSplitterNode = nativeContext.createChannelSplitter(options.numberOfOutputs);\n    // Bug #96: Safari does not have the correct channelCount.\n    // Bug #29: Safari does not have the correct channelCountMode.\n    // Bug #31: Safari does not have the correct channelInterpretation.\n    assignNativeAudioNodeOptions(nativeChannelSplitterNode, options);\n    // Bug #29, #30, #31, #32, #96 & #97: Only Chrome, Edge & Firefox partially support the spec yet.\n    wrapChannelSplitterNode(nativeChannelSplitterNode);\n    return nativeChannelSplitterNode;\n};\n//# sourceMappingURL=native-channel-splitter-node.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { wrapAudioScheduledSourceNodeStartMethodNegativeParameters } from '../helpers/wrap-audio-scheduled-source-node-start-method-negative-parameters';\nimport { wrapAudioScheduledSourceNodeStopMethodNegativeParameters } from '../helpers/wrap-audio-scheduled-source-node-stop-method-negative-parameters';\nexport const createNativeConstantSourceNodeFactory = (addSilentConnection, cacheTestResult, createNativeConstantSourceNodeFaker, testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, testAudioScheduledSourceNodeStopMethodNegativeParametersSupport) => {\n    return (nativeContext, options) => {\n        // Bug #62: Safari does not support ConstantSourceNodes.\n        if (nativeContext.createConstantSource === undefined) {\n            return createNativeConstantSourceNodeFaker(nativeContext, options);\n        }\n        const nativeConstantSourceNode = nativeContext.createConstantSource();\n        assignNativeAudioNodeOptions(nativeConstantSourceNode, options);\n        assignNativeAudioNodeAudioParamValue(nativeConstantSourceNode, options, 'offset');\n        // Bug #44: Safari does not throw a RangeError yet.\n        if (!cacheTestResult(testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, () => testAudioScheduledSourceNodeStartMethodNegativeParametersSupport(nativeContext))) {\n            wrapAudioScheduledSourceNodeStartMethodNegativeParameters(nativeConstantSourceNode);\n        }\n        // Bug #44: Only Firefox does not throw a RangeError yet.\n        if (!cacheTestResult(testAudioScheduledSourceNodeStopMethodNegativeParametersSupport, () => testAudioScheduledSourceNodeStopMethodNegativeParametersSupport(nativeContext))) {\n            wrapAudioScheduledSourceNodeStopMethodNegativeParameters(nativeConstantSourceNode);\n        }\n        // Bug #175: Safari will not fire an ended event if the ConstantSourceNode is unconnected.\n        addSilentConnection(nativeContext, nativeConstantSourceNode);\n        return nativeConstantSourceNode;\n    };\n};\n//# sourceMappingURL=native-constant-source-node-factory.js.map","export const interceptConnections = (original, interceptor) => {\n    original.connect = interceptor.connect.bind(interceptor);\n    original.disconnect = interceptor.disconnect.bind(interceptor);\n    return original;\n};\n//# sourceMappingURL=intercept-connections.js.map","import { interceptConnections } from '../helpers/intercept-connections';\nexport const createNativeConstantSourceNodeFakerFactory = (addSilentConnection, createNativeAudioBufferSourceNode, createNativeGainNode, monitorConnections) => {\n    return (nativeContext, { offset, ...audioNodeOptions }) => {\n        const audioBuffer = nativeContext.createBuffer(1, 2, 44100);\n        const audioBufferSourceNode = createNativeAudioBufferSourceNode(nativeContext, {\n            buffer: null,\n            channelCount: 2,\n            channelCountMode: 'max',\n            channelInterpretation: 'speakers',\n            loop: false,\n            loopEnd: 0,\n            loopStart: 0,\n            playbackRate: 1\n        });\n        const gainNode = createNativeGainNode(nativeContext, { ...audioNodeOptions, gain: offset });\n        // Bug #5: Safari does not support copyFromChannel() and copyToChannel().\n        const channelData = audioBuffer.getChannelData(0);\n        // Bug #95: Safari does not play or loop one sample buffers.\n        channelData[0] = 1;\n        channelData[1] = 1;\n        audioBufferSourceNode.buffer = audioBuffer;\n        audioBufferSourceNode.loop = true;\n        const nativeConstantSourceNodeFaker = {\n            get bufferSize() {\n                return undefined;\n            },\n            get channelCount() {\n                return gainNode.channelCount;\n            },\n            set channelCount(value) {\n                gainNode.channelCount = value;\n            },\n            get channelCountMode() {\n                return gainNode.channelCountMode;\n            },\n            set channelCountMode(value) {\n                gainNode.channelCountMode = value;\n            },\n            get channelInterpretation() {\n                return gainNode.channelInterpretation;\n            },\n            set channelInterpretation(value) {\n                gainNode.channelInterpretation = value;\n            },\n            get context() {\n                return gainNode.context;\n            },\n            get inputs() {\n                return [];\n            },\n            get numberOfInputs() {\n                return audioBufferSourceNode.numberOfInputs;\n            },\n            get numberOfOutputs() {\n                return gainNode.numberOfOutputs;\n            },\n            get offset() {\n                return gainNode.gain;\n            },\n            get onended() {\n                return audioBufferSourceNode.onended;\n            },\n            set onended(value) {\n                audioBufferSourceNode.onended = value;\n            },\n            addEventListener(...args) {\n                return audioBufferSourceNode.addEventListener(args[0], args[1], args[2]);\n            },\n            dispatchEvent(...args) {\n                return audioBufferSourceNode.dispatchEvent(args[0]);\n            },\n            removeEventListener(...args) {\n                return audioBufferSourceNode.removeEventListener(args[0], args[1], args[2]);\n            },\n            start(when = 0) {\n                audioBufferSourceNode.start.call(audioBufferSourceNode, when);\n            },\n            stop(when = 0) {\n                audioBufferSourceNode.stop.call(audioBufferSourceNode, when);\n            }\n        };\n        const whenConnected = () => audioBufferSourceNode.connect(gainNode);\n        const whenDisconnected = () => audioBufferSourceNode.disconnect(gainNode);\n        // Bug #175: Safari will not fire an ended event if the AudioBufferSourceNode is unconnected.\n        addSilentConnection(nativeContext, audioBufferSourceNode);\n        return monitorConnections(interceptConnections(nativeConstantSourceNodeFaker, gainNode), whenConnected, whenDisconnected);\n    };\n};\n//# sourceMappingURL=native-constant-source-node-faker-factory.js.map","import { assignNativeAudioNodeOption } from '../helpers/assign-native-audio-node-option';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeConvolverNodeFactory = (createNotSupportedError, overwriteAccessors) => {\n    return (nativeContext, options) => {\n        const nativeConvolverNode = nativeContext.createConvolver();\n        assignNativeAudioNodeOptions(nativeConvolverNode, options);\n        // The normalize property needs to be set before setting the buffer.\n        if (options.disableNormalization === nativeConvolverNode.normalize) {\n            nativeConvolverNode.normalize = !options.disableNormalization;\n        }\n        assignNativeAudioNodeOption(nativeConvolverNode, options, 'buffer');\n        // Bug #113: Safari does allow to set the channelCount to a value larger than 2.\n        if (options.channelCount > 2) {\n            throw createNotSupportedError();\n        }\n        overwriteAccessors(nativeConvolverNode, 'channelCount', (get) => () => get.call(nativeConvolverNode), (set) => (value) => {\n            if (value > 2) {\n                throw createNotSupportedError();\n            }\n            return set.call(nativeConvolverNode, value);\n        });\n        // Bug #114: Safari allows to set the channelCountMode to 'max'.\n        if (options.channelCountMode === 'max') {\n            throw createNotSupportedError();\n        }\n        overwriteAccessors(nativeConvolverNode, 'channelCountMode', (get) => () => get.call(nativeConvolverNode), (set) => (value) => {\n            if (value === 'max') {\n                throw createNotSupportedError();\n            }\n            return set.call(nativeConvolverNode, value);\n        });\n        return nativeConvolverNode;\n    };\n};\n//# sourceMappingURL=native-convolver-node-factory.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeDelayNode = (nativeContext, options) => {\n    const nativeDelayNode = nativeContext.createDelay(options.maxDelayTime);\n    assignNativeAudioNodeOptions(nativeDelayNode, options);\n    assignNativeAudioNodeAudioParamValue(nativeDelayNode, options, 'delayTime');\n    return nativeDelayNode;\n};\n//# sourceMappingURL=native-delay-node.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeDynamicsCompressorNodeFactory = (createNotSupportedError) => {\n    return (nativeContext, options) => {\n        const nativeDynamicsCompressorNode = nativeContext.createDynamicsCompressor();\n        assignNativeAudioNodeOptions(nativeDynamicsCompressorNode, options);\n        // Bug #108: Safari allows a channelCount of three and above.\n        if (options.channelCount > 2) {\n            throw createNotSupportedError();\n        }\n        // Bug #109: Only Chrome and Firefox disallow a channelCountMode of 'max'.\n        if (options.channelCountMode === 'max') {\n            throw createNotSupportedError();\n        }\n        assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode, options, 'attack');\n        assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode, options, 'knee');\n        assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode, options, 'ratio');\n        assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode, options, 'release');\n        assignNativeAudioNodeAudioParamValue(nativeDynamicsCompressorNode, options, 'threshold');\n        return nativeDynamicsCompressorNode;\n    };\n};\n//# sourceMappingURL=native-dynamics-compressor-node-factory.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeGainNode = (nativeContext, options) => {\n    const nativeGainNode = nativeContext.createGain();\n    assignNativeAudioNodeOptions(nativeGainNode, options);\n    assignNativeAudioNodeAudioParamValue(nativeGainNode, options, 'gain');\n    return nativeGainNode;\n};\n//# sourceMappingURL=native-gain-node.js.map","import { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeIIRFilterNodeFactory = (createNativeIIRFilterNodeFaker) => {\n    return (nativeContext, baseLatency, options) => {\n        // Bug #9: Safari does not support IIRFilterNodes.\n        if (nativeContext.createIIRFilter === undefined) {\n            return createNativeIIRFilterNodeFaker(nativeContext, baseLatency, options);\n        }\n        // @todo TypeScript defines the parameters of createIIRFilter() as arrays of numbers.\n        const nativeIIRFilterNode = nativeContext.createIIRFilter(options.feedforward, options.feedback);\n        assignNativeAudioNodeOptions(nativeIIRFilterNode, options);\n        return nativeIIRFilterNode;\n    };\n};\n//# sourceMappingURL=native-iir-filter-node-factory.js.map","import { computeBufferSize } from '../helpers/compute-buffer-size';\nimport { filterBuffer } from '../helpers/filter-buffer';\nimport { interceptConnections } from '../helpers/intercept-connections';\nfunction divide(a, b) {\n    const denominator = b[0] * b[0] + b[1] * b[1];\n    return [(a[0] * b[0] + a[1] * b[1]) / denominator, (a[1] * b[0] - a[0] * b[1]) / denominator];\n}\nfunction multiply(a, b) {\n    return [a[0] * b[0] - a[1] * b[1], a[0] * b[1] + a[1] * b[0]];\n}\nfunction evaluatePolynomial(coefficient, z) {\n    let result = [0, 0];\n    for (let i = coefficient.length - 1; i >= 0; i -= 1) {\n        result = multiply(result, z);\n        result[0] += coefficient[i];\n    }\n    return result;\n}\nexport const createNativeIIRFilterNodeFakerFactory = (createInvalidAccessError, createInvalidStateError, createNativeScriptProcessorNode, createNotSupportedError) => {\n    return (nativeContext, baseLatency, { channelCount, channelCountMode, channelInterpretation, feedback, feedforward }) => {\n        const bufferSize = computeBufferSize(baseLatency, nativeContext.sampleRate);\n        const convertedFeedback = feedback instanceof Float64Array ? feedback : new Float64Array(feedback);\n        const convertedFeedforward = feedforward instanceof Float64Array ? feedforward : new Float64Array(feedforward);\n        const feedbackLength = convertedFeedback.length;\n        const feedforwardLength = convertedFeedforward.length;\n        const minLength = Math.min(feedbackLength, feedforwardLength);\n        if (feedbackLength === 0 || feedbackLength > 20) {\n            throw createNotSupportedError();\n        }\n        if (convertedFeedback[0] === 0) {\n            throw createInvalidStateError();\n        }\n        if (feedforwardLength === 0 || feedforwardLength > 20) {\n            throw createNotSupportedError();\n        }\n        if (convertedFeedforward[0] === 0) {\n            throw createInvalidStateError();\n        }\n        if (convertedFeedback[0] !== 1) {\n            for (let i = 0; i < feedforwardLength; i += 1) {\n                convertedFeedforward[i] /= convertedFeedback[0];\n            }\n            for (let i = 1; i < feedbackLength; i += 1) {\n                convertedFeedback[i] /= convertedFeedback[0];\n            }\n        }\n        const scriptProcessorNode = createNativeScriptProcessorNode(nativeContext, bufferSize, channelCount, channelCount);\n        scriptProcessorNode.channelCount = channelCount;\n        scriptProcessorNode.channelCountMode = channelCountMode;\n        scriptProcessorNode.channelInterpretation = channelInterpretation;\n        const bufferLength = 32;\n        const bufferIndexes = [];\n        const xBuffers = [];\n        const yBuffers = [];\n        for (let i = 0; i < channelCount; i += 1) {\n            bufferIndexes.push(0);\n            const xBuffer = new Float32Array(bufferLength);\n            const yBuffer = new Float32Array(bufferLength);\n            xBuffer.fill(0);\n            yBuffer.fill(0);\n            xBuffers.push(xBuffer);\n            yBuffers.push(yBuffer);\n        }\n        // tslint:disable-next-line:deprecation\n        scriptProcessorNode.onaudioprocess = (event) => {\n            const inputBuffer = event.inputBuffer;\n            const outputBuffer = event.outputBuffer;\n            const numberOfChannels = inputBuffer.numberOfChannels;\n            for (let i = 0; i < numberOfChannels; i += 1) {\n                const input = inputBuffer.getChannelData(i);\n                const output = outputBuffer.getChannelData(i);\n                bufferIndexes[i] = filterBuffer(convertedFeedback, feedbackLength, convertedFeedforward, feedforwardLength, minLength, xBuffers[i], yBuffers[i], bufferIndexes[i], bufferLength, input, output);\n            }\n        };\n        const nyquist = nativeContext.sampleRate / 2;\n        const nativeIIRFilterNodeFaker = {\n            get bufferSize() {\n                return bufferSize;\n            },\n            get channelCount() {\n                return scriptProcessorNode.channelCount;\n            },\n            set channelCount(value) {\n                scriptProcessorNode.channelCount = value;\n            },\n            get channelCountMode() {\n                return scriptProcessorNode.channelCountMode;\n            },\n            set channelCountMode(value) {\n                scriptProcessorNode.channelCountMode = value;\n            },\n            get channelInterpretation() {\n                return scriptProcessorNode.channelInterpretation;\n            },\n            set channelInterpretation(value) {\n                scriptProcessorNode.channelInterpretation = value;\n            },\n            get context() {\n                return scriptProcessorNode.context;\n            },\n            get inputs() {\n                return [scriptProcessorNode];\n            },\n            get numberOfInputs() {\n                return scriptProcessorNode.numberOfInputs;\n            },\n            get numberOfOutputs() {\n                return scriptProcessorNode.numberOfOutputs;\n            },\n            addEventListener(...args) {\n                // @todo Dissallow adding an audioprocess listener.\n                return scriptProcessorNode.addEventListener(args[0], args[1], args[2]);\n            },\n            dispatchEvent(...args) {\n                return scriptProcessorNode.dispatchEvent(args[0]);\n            },\n            getFrequencyResponse(frequencyHz, magResponse, phaseResponse) {\n                if (frequencyHz.length !== magResponse.length || magResponse.length !== phaseResponse.length) {\n                    throw createInvalidAccessError();\n                }\n                const length = frequencyHz.length;\n                for (let i = 0; i < length; i += 1) {\n                    const omega = -Math.PI * (frequencyHz[i] / nyquist);\n                    const z = [Math.cos(omega), Math.sin(omega)];\n                    const numerator = evaluatePolynomial(convertedFeedforward, z);\n                    const denominator = evaluatePolynomial(convertedFeedback, z);\n                    const response = divide(numerator, denominator);\n                    magResponse[i] = Math.sqrt(response[0] * response[0] + response[1] * response[1]);\n                    phaseResponse[i] = Math.atan2(response[1], response[0]);\n                }\n            },\n            removeEventListener(...args) {\n                return scriptProcessorNode.removeEventListener(args[0], args[1], args[2]);\n            }\n        };\n        return interceptConnections(nativeIIRFilterNodeFaker, scriptProcessorNode);\n    };\n};\n//# sourceMappingURL=native-iir-filter-node-faker-factory.js.map","export const createNativeMediaElementAudioSourceNode = (nativeAudioContext, options) => {\n    return nativeAudioContext.createMediaElementSource(options.mediaElement);\n};\n//# sourceMappingURL=native-media-element-audio-source-node.js.map","import { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeMediaStreamAudioDestinationNode = (nativeAudioContext, options) => {\n    const nativeMediaStreamAudioDestinationNode = nativeAudioContext.createMediaStreamDestination();\n    assignNativeAudioNodeOptions(nativeMediaStreamAudioDestinationNode, options);\n    // Bug #174: Safari does expose a wrong numberOfOutputs.\n    if (nativeMediaStreamAudioDestinationNode.numberOfOutputs === 1) {\n        Object.defineProperty(nativeMediaStreamAudioDestinationNode, 'numberOfOutputs', { get: () => 0 });\n    }\n    return nativeMediaStreamAudioDestinationNode;\n};\n//# sourceMappingURL=native-media-stream-audio-destination-node.js.map","export const createNativeMediaStreamAudioSourceNode = (nativeAudioContext, { mediaStream }) => {\n    const audioStreamTracks = mediaStream.getAudioTracks();\n    /*\n     * Bug #151: Safari does not use the audio track as input anymore if it gets removed from the mediaStream after construction.\n     * Bug #159: Safari picks the first audio track if the MediaStream has more than one audio track.\n     */\n    audioStreamTracks.sort((a, b) => (a.id < b.id ? -1 : a.id > b.id ? 1 : 0));\n    const filteredAudioStreamTracks = audioStreamTracks.slice(0, 1);\n    const nativeMediaStreamAudioSourceNode = nativeAudioContext.createMediaStreamSource(new MediaStream(filteredAudioStreamTracks));\n    /*\n     * Bug #151 & #159: The given mediaStream gets reconstructed before it gets passed to the native node which is why the accessor needs\n     * to be overwritten as it would otherwise expose the reconstructed version.\n     */\n    Object.defineProperty(nativeMediaStreamAudioSourceNode, 'mediaStream', { value: mediaStream });\n    return nativeMediaStreamAudioSourceNode;\n};\n//# sourceMappingURL=native-media-stream-audio-source-node.js.map","export const createNativeMediaStreamTrackAudioSourceNodeFactory = (createInvalidStateError, isNativeOfflineAudioContext) => {\n    return (nativeAudioContext, { mediaStreamTrack }) => {\n        // Bug #121: Only Firefox does yet support the MediaStreamTrackAudioSourceNode.\n        if (typeof nativeAudioContext.createMediaStreamTrackSource === 'function') {\n            return nativeAudioContext.createMediaStreamTrackSource(mediaStreamTrack);\n        }\n        const mediaStream = new MediaStream([mediaStreamTrack]);\n        const nativeMediaStreamAudioSourceNode = nativeAudioContext.createMediaStreamSource(mediaStream);\n        // Bug #120: Firefox does not throw an error if the mediaStream has no audio track.\n        if (mediaStreamTrack.kind !== 'audio') {\n            throw createInvalidStateError();\n        }\n        // Bug #172: Safari allows to create a MediaStreamAudioSourceNode with an OfflineAudioContext.\n        if (isNativeOfflineAudioContext(nativeAudioContext)) {\n            throw new TypeError();\n        }\n        return nativeMediaStreamAudioSourceNode;\n    };\n};\n//# sourceMappingURL=native-media-stream-track-audio-source-node-factory.js.map","export const createNativeOfflineAudioContextConstructor = (window) => {\n    if (window === null) {\n        return null;\n    }\n    if (window.hasOwnProperty('OfflineAudioContext')) {\n        return window.OfflineAudioContext;\n    }\n    return window.hasOwnProperty('webkitOfflineAudioContext') ? window.webkitOfflineAudioContext : null;\n};\n//# sourceMappingURL=native-offline-audio-context-constructor.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOption } from '../helpers/assign-native-audio-node-option';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { wrapAudioScheduledSourceNodeStartMethodNegativeParameters } from '../helpers/wrap-audio-scheduled-source-node-start-method-negative-parameters';\nimport { wrapAudioScheduledSourceNodeStopMethodNegativeParameters } from '../helpers/wrap-audio-scheduled-source-node-stop-method-negative-parameters';\nexport const createNativeOscillatorNodeFactory = (addSilentConnection, cacheTestResult, testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport, testAudioScheduledSourceNodeStopMethodNegativeParametersSupport, wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls) => {\n    return (nativeContext, options) => {\n        const nativeOscillatorNode = nativeContext.createOscillator();\n        assignNativeAudioNodeOptions(nativeOscillatorNode, options);\n        assignNativeAudioNodeAudioParamValue(nativeOscillatorNode, options, 'detune');\n        assignNativeAudioNodeAudioParamValue(nativeOscillatorNode, options, 'frequency');\n        if (options.periodicWave !== undefined) {\n            nativeOscillatorNode.setPeriodicWave(options.periodicWave);\n        }\n        else {\n            assignNativeAudioNodeOption(nativeOscillatorNode, options, 'type');\n        }\n        // Bug #44: Only Chrome & Edge throw a RangeError yet.\n        if (!cacheTestResult(testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, () => testAudioScheduledSourceNodeStartMethodNegativeParametersSupport(nativeContext))) {\n            wrapAudioScheduledSourceNodeStartMethodNegativeParameters(nativeOscillatorNode);\n        }\n        // Bug #19: Safari does not ignore calls to stop() of an already stopped AudioBufferSourceNode.\n        if (!cacheTestResult(testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport, () => testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport(nativeContext))) {\n            wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls(nativeOscillatorNode, nativeContext);\n        }\n        // Bug #44: Only Firefox does not throw a RangeError yet.\n        if (!cacheTestResult(testAudioScheduledSourceNodeStopMethodNegativeParametersSupport, () => testAudioScheduledSourceNodeStopMethodNegativeParametersSupport(nativeContext))) {\n            wrapAudioScheduledSourceNodeStopMethodNegativeParameters(nativeOscillatorNode);\n        }\n        // Bug #175: Safari will not fire an ended event if the OscillatorNode is unconnected.\n        addSilentConnection(nativeContext, nativeOscillatorNode);\n        return nativeOscillatorNode;\n    };\n};\n//# sourceMappingURL=native-oscillator-node-factory.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOption } from '../helpers/assign-native-audio-node-option';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativePannerNodeFactory = (createNativePannerNodeFaker) => {\n    return (nativeContext, options) => {\n        const nativePannerNode = nativeContext.createPanner();\n        // Bug #124: Safari does not support modifying the orientation and the position with AudioParams.\n        if (nativePannerNode.orientationX === undefined) {\n            return createNativePannerNodeFaker(nativeContext, options);\n        }\n        assignNativeAudioNodeOptions(nativePannerNode, options);\n        assignNativeAudioNodeAudioParamValue(nativePannerNode, options, 'orientationX');\n        assignNativeAudioNodeAudioParamValue(nativePannerNode, options, 'orientationY');\n        assignNativeAudioNodeAudioParamValue(nativePannerNode, options, 'orientationZ');\n        assignNativeAudioNodeAudioParamValue(nativePannerNode, options, 'positionX');\n        assignNativeAudioNodeAudioParamValue(nativePannerNode, options, 'positionY');\n        assignNativeAudioNodeAudioParamValue(nativePannerNode, options, 'positionZ');\n        assignNativeAudioNodeOption(nativePannerNode, options, 'coneInnerAngle');\n        assignNativeAudioNodeOption(nativePannerNode, options, 'coneOuterAngle');\n        assignNativeAudioNodeOption(nativePannerNode, options, 'coneOuterGain');\n        assignNativeAudioNodeOption(nativePannerNode, options, 'distanceModel');\n        assignNativeAudioNodeOption(nativePannerNode, options, 'maxDistance');\n        assignNativeAudioNodeOption(nativePannerNode, options, 'panningModel');\n        assignNativeAudioNodeOption(nativePannerNode, options, 'refDistance');\n        assignNativeAudioNodeOption(nativePannerNode, options, 'rolloffFactor');\n        return nativePannerNode;\n    };\n};\n//# sourceMappingURL=native-panner-node-factory.js.map","import { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { interceptConnections } from '../helpers/intercept-connections';\nexport const createNativePannerNodeFakerFactory = (connectNativeAudioNodeToNativeAudioNode, createInvalidStateError, createNativeChannelMergerNode, createNativeGainNode, createNativeScriptProcessorNode, createNativeWaveShaperNode, createNotSupportedError, disconnectNativeAudioNodeFromNativeAudioNode, getFirstSample, monitorConnections) => {\n    return (nativeContext, { coneInnerAngle, coneOuterAngle, coneOuterGain, distanceModel, maxDistance, orientationX, orientationY, orientationZ, panningModel, positionX, positionY, positionZ, refDistance, rolloffFactor, ...audioNodeOptions }) => {\n        const pannerNode = nativeContext.createPanner();\n        // Bug #125: Safari does not throw an error yet.\n        if (audioNodeOptions.channelCount > 2) {\n            throw createNotSupportedError();\n        }\n        // Bug #126: Safari does not throw an error yet.\n        if (audioNodeOptions.channelCountMode === 'max') {\n            throw createNotSupportedError();\n        }\n        assignNativeAudioNodeOptions(pannerNode, audioNodeOptions);\n        const SINGLE_CHANNEL_OPTIONS = {\n            channelCount: 1,\n            channelCountMode: 'explicit',\n            channelInterpretation: 'discrete'\n        };\n        const channelMergerNode = createNativeChannelMergerNode(nativeContext, {\n            ...SINGLE_CHANNEL_OPTIONS,\n            channelInterpretation: 'speakers',\n            numberOfInputs: 6\n        });\n        const inputGainNode = createNativeGainNode(nativeContext, { ...audioNodeOptions, gain: 1 });\n        const orientationXGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 1 });\n        const orientationYGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        const orientationZGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        const positionXGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        const positionYGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        const positionZGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        const scriptProcessorNode = createNativeScriptProcessorNode(nativeContext, 256, 6, 1);\n        const waveShaperNode = createNativeWaveShaperNode(nativeContext, {\n            ...SINGLE_CHANNEL_OPTIONS,\n            curve: new Float32Array([1, 1]),\n            oversample: 'none'\n        });\n        let lastOrientation = [orientationX, orientationY, orientationZ];\n        let lastPosition = [positionX, positionY, positionZ];\n        const buffer = new Float32Array(1);\n        // tslint:disable-next-line:deprecation\n        scriptProcessorNode.onaudioprocess = ({ inputBuffer }) => {\n            const orientation = [\n                getFirstSample(inputBuffer, buffer, 0),\n                getFirstSample(inputBuffer, buffer, 1),\n                getFirstSample(inputBuffer, buffer, 2)\n            ];\n            if (orientation.some((value, index) => value !== lastOrientation[index])) {\n                pannerNode.setOrientation(...orientation); // tslint:disable-line:deprecation\n                lastOrientation = orientation;\n            }\n            const positon = [\n                getFirstSample(inputBuffer, buffer, 3),\n                getFirstSample(inputBuffer, buffer, 4),\n                getFirstSample(inputBuffer, buffer, 5)\n            ];\n            if (positon.some((value, index) => value !== lastPosition[index])) {\n                pannerNode.setPosition(...positon); // tslint:disable-line:deprecation\n                lastPosition = positon;\n            }\n        };\n        Object.defineProperty(orientationYGainNode.gain, 'defaultValue', { get: () => 0 });\n        Object.defineProperty(orientationZGainNode.gain, 'defaultValue', { get: () => 0 });\n        Object.defineProperty(positionXGainNode.gain, 'defaultValue', { get: () => 0 });\n        Object.defineProperty(positionYGainNode.gain, 'defaultValue', { get: () => 0 });\n        Object.defineProperty(positionZGainNode.gain, 'defaultValue', { get: () => 0 });\n        const nativePannerNodeFaker = {\n            get bufferSize() {\n                return undefined;\n            },\n            get channelCount() {\n                return pannerNode.channelCount;\n            },\n            set channelCount(value) {\n                // Bug #125: Safari does not throw an error yet.\n                if (value > 2) {\n                    throw createNotSupportedError();\n                }\n                inputGainNode.channelCount = value;\n                pannerNode.channelCount = value;\n            },\n            get channelCountMode() {\n                return pannerNode.channelCountMode;\n            },\n            set channelCountMode(value) {\n                // Bug #126: Safari does not throw an error yet.\n                if (value === 'max') {\n                    throw createNotSupportedError();\n                }\n                inputGainNode.channelCountMode = value;\n                pannerNode.channelCountMode = value;\n            },\n            get channelInterpretation() {\n                return pannerNode.channelInterpretation;\n            },\n            set channelInterpretation(value) {\n                inputGainNode.channelInterpretation = value;\n                pannerNode.channelInterpretation = value;\n            },\n            get coneInnerAngle() {\n                return pannerNode.coneInnerAngle;\n            },\n            set coneInnerAngle(value) {\n                pannerNode.coneInnerAngle = value;\n            },\n            get coneOuterAngle() {\n                return pannerNode.coneOuterAngle;\n            },\n            set coneOuterAngle(value) {\n                pannerNode.coneOuterAngle = value;\n            },\n            get coneOuterGain() {\n                return pannerNode.coneOuterGain;\n            },\n            set coneOuterGain(value) {\n                // Bug #127: Safari does not throw an InvalidStateError yet.\n                if (value < 0 || value > 1) {\n                    throw createInvalidStateError();\n                }\n                pannerNode.coneOuterGain = value;\n            },\n            get context() {\n                return pannerNode.context;\n            },\n            get distanceModel() {\n                return pannerNode.distanceModel;\n            },\n            set distanceModel(value) {\n                pannerNode.distanceModel = value;\n            },\n            get inputs() {\n                return [inputGainNode];\n            },\n            get maxDistance() {\n                return pannerNode.maxDistance;\n            },\n            set maxDistance(value) {\n                // Bug #128: Safari does not throw an error yet.\n                if (value < 0) {\n                    throw new RangeError();\n                }\n                pannerNode.maxDistance = value;\n            },\n            get numberOfInputs() {\n                return pannerNode.numberOfInputs;\n            },\n            get numberOfOutputs() {\n                return pannerNode.numberOfOutputs;\n            },\n            get orientationX() {\n                return orientationXGainNode.gain;\n            },\n            get orientationY() {\n                return orientationYGainNode.gain;\n            },\n            get orientationZ() {\n                return orientationZGainNode.gain;\n            },\n            get panningModel() {\n                return pannerNode.panningModel;\n            },\n            set panningModel(value) {\n                pannerNode.panningModel = value;\n            },\n            get positionX() {\n                return positionXGainNode.gain;\n            },\n            get positionY() {\n                return positionYGainNode.gain;\n            },\n            get positionZ() {\n                return positionZGainNode.gain;\n            },\n            get refDistance() {\n                return pannerNode.refDistance;\n            },\n            set refDistance(value) {\n                // Bug #129: Safari does not throw an error yet.\n                if (value < 0) {\n                    throw new RangeError();\n                }\n                pannerNode.refDistance = value;\n            },\n            get rolloffFactor() {\n                return pannerNode.rolloffFactor;\n            },\n            set rolloffFactor(value) {\n                // Bug #130: Safari does not throw an error yet.\n                if (value < 0) {\n                    throw new RangeError();\n                }\n                pannerNode.rolloffFactor = value;\n            },\n            addEventListener(...args) {\n                return inputGainNode.addEventListener(args[0], args[1], args[2]);\n            },\n            dispatchEvent(...args) {\n                return inputGainNode.dispatchEvent(args[0]);\n            },\n            removeEventListener(...args) {\n                return inputGainNode.removeEventListener(args[0], args[1], args[2]);\n            }\n        };\n        if (coneInnerAngle !== nativePannerNodeFaker.coneInnerAngle) {\n            nativePannerNodeFaker.coneInnerAngle = coneInnerAngle;\n        }\n        if (coneOuterAngle !== nativePannerNodeFaker.coneOuterAngle) {\n            nativePannerNodeFaker.coneOuterAngle = coneOuterAngle;\n        }\n        if (coneOuterGain !== nativePannerNodeFaker.coneOuterGain) {\n            nativePannerNodeFaker.coneOuterGain = coneOuterGain;\n        }\n        if (distanceModel !== nativePannerNodeFaker.distanceModel) {\n            nativePannerNodeFaker.distanceModel = distanceModel;\n        }\n        if (maxDistance !== nativePannerNodeFaker.maxDistance) {\n            nativePannerNodeFaker.maxDistance = maxDistance;\n        }\n        if (orientationX !== nativePannerNodeFaker.orientationX.value) {\n            nativePannerNodeFaker.orientationX.value = orientationX;\n        }\n        if (orientationY !== nativePannerNodeFaker.orientationY.value) {\n            nativePannerNodeFaker.orientationY.value = orientationY;\n        }\n        if (orientationZ !== nativePannerNodeFaker.orientationZ.value) {\n            nativePannerNodeFaker.orientationZ.value = orientationZ;\n        }\n        if (panningModel !== nativePannerNodeFaker.panningModel) {\n            nativePannerNodeFaker.panningModel = panningModel;\n        }\n        if (positionX !== nativePannerNodeFaker.positionX.value) {\n            nativePannerNodeFaker.positionX.value = positionX;\n        }\n        if (positionY !== nativePannerNodeFaker.positionY.value) {\n            nativePannerNodeFaker.positionY.value = positionY;\n        }\n        if (positionZ !== nativePannerNodeFaker.positionZ.value) {\n            nativePannerNodeFaker.positionZ.value = positionZ;\n        }\n        if (refDistance !== nativePannerNodeFaker.refDistance) {\n            nativePannerNodeFaker.refDistance = refDistance;\n        }\n        if (rolloffFactor !== nativePannerNodeFaker.rolloffFactor) {\n            nativePannerNodeFaker.rolloffFactor = rolloffFactor;\n        }\n        if (lastOrientation[0] !== 1 || lastOrientation[1] !== 0 || lastOrientation[2] !== 0) {\n            pannerNode.setOrientation(...lastOrientation); // tslint:disable-line:deprecation\n        }\n        if (lastPosition[0] !== 0 || lastPosition[1] !== 0 || lastPosition[2] !== 0) {\n            pannerNode.setPosition(...lastPosition); // tslint:disable-line:deprecation\n        }\n        const whenConnected = () => {\n            inputGainNode.connect(pannerNode);\n            // Bug #119: Safari does not fully support the WaveShaperNode.\n            connectNativeAudioNodeToNativeAudioNode(inputGainNode, waveShaperNode, 0, 0);\n            waveShaperNode.connect(orientationXGainNode).connect(channelMergerNode, 0, 0);\n            waveShaperNode.connect(orientationYGainNode).connect(channelMergerNode, 0, 1);\n            waveShaperNode.connect(orientationZGainNode).connect(channelMergerNode, 0, 2);\n            waveShaperNode.connect(positionXGainNode).connect(channelMergerNode, 0, 3);\n            waveShaperNode.connect(positionYGainNode).connect(channelMergerNode, 0, 4);\n            waveShaperNode.connect(positionZGainNode).connect(channelMergerNode, 0, 5);\n            channelMergerNode.connect(scriptProcessorNode).connect(nativeContext.destination);\n        };\n        const whenDisconnected = () => {\n            inputGainNode.disconnect(pannerNode);\n            // Bug #119: Safari does not fully support the WaveShaperNode.\n            disconnectNativeAudioNodeFromNativeAudioNode(inputGainNode, waveShaperNode, 0, 0);\n            waveShaperNode.disconnect(orientationXGainNode);\n            orientationXGainNode.disconnect(channelMergerNode);\n            waveShaperNode.disconnect(orientationYGainNode);\n            orientationYGainNode.disconnect(channelMergerNode);\n            waveShaperNode.disconnect(orientationZGainNode);\n            orientationZGainNode.disconnect(channelMergerNode);\n            waveShaperNode.disconnect(positionXGainNode);\n            positionXGainNode.disconnect(channelMergerNode);\n            waveShaperNode.disconnect(positionYGainNode);\n            positionYGainNode.disconnect(channelMergerNode);\n            waveShaperNode.disconnect(positionZGainNode);\n            positionZGainNode.disconnect(channelMergerNode);\n            channelMergerNode.disconnect(scriptProcessorNode);\n            scriptProcessorNode.disconnect(nativeContext.destination);\n        };\n        return monitorConnections(interceptConnections(nativePannerNodeFaker, pannerNode), whenConnected, whenDisconnected);\n    };\n};\n//# sourceMappingURL=native-panner-node-faker-factory.js.map","export const createNativePeriodicWaveFactory = (createIndexSizeError) => {\n    return (nativeContext, { disableNormalization, imag, real }) => {\n        // Bug #180: Safari does not allow to use ordinary arrays.\n        const convertedImag = imag instanceof Float32Array ? imag : new Float32Array(imag);\n        const convertedReal = real instanceof Float32Array ? real : new Float32Array(real);\n        const nativePeriodicWave = nativeContext.createPeriodicWave(convertedReal, convertedImag, { disableNormalization });\n        // Bug #181: Safari does not throw an IndexSizeError so far if the given arrays have less than two values.\n        if (Array.from(imag).length < 2) {\n            throw createIndexSizeError();\n        }\n        return nativePeriodicWave;\n    };\n};\n//# sourceMappingURL=native-periodic-wave-factory.js.map","export const createNativeScriptProcessorNode = (nativeContext, bufferSize, numberOfInputChannels, numberOfOutputChannels) => {\n    return nativeContext.createScriptProcessor(bufferSize, numberOfInputChannels, numberOfOutputChannels); // tslint:disable-line deprecation\n};\n//# sourceMappingURL=native-script-processor-node.js.map","import { assignNativeAudioNodeAudioParamValue } from '../helpers/assign-native-audio-node-audio-param-value';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeStereoPannerNodeFactory = (createNativeStereoPannerNodeFaker, createNotSupportedError) => {\n    return (nativeContext, options) => {\n        const channelCountMode = options.channelCountMode;\n        /*\n         * Bug #105: The channelCountMode of 'clamped-max' should be supported. However it is not possible to write a polyfill for Safari\n         * which supports it and therefore it can't be supported at all.\n         */\n        if (channelCountMode === 'clamped-max') {\n            throw createNotSupportedError();\n        }\n        // Bug #105: Safari does not support the StereoPannerNode.\n        if (nativeContext.createStereoPanner === undefined) {\n            return createNativeStereoPannerNodeFaker(nativeContext, options);\n        }\n        const nativeStereoPannerNode = nativeContext.createStereoPanner();\n        assignNativeAudioNodeOptions(nativeStereoPannerNode, options);\n        assignNativeAudioNodeAudioParamValue(nativeStereoPannerNode, options, 'pan');\n        /*\n         * Bug #105: The channelCountMode of 'clamped-max' should be supported. However it is not possible to write a polyfill for Safari\n         * which supports it and therefore it can't be supported at all.\n         */\n        Object.defineProperty(nativeStereoPannerNode, 'channelCountMode', {\n            get: () => channelCountMode,\n            set: (value) => {\n                if (value !== channelCountMode) {\n                    throw createNotSupportedError();\n                }\n            }\n        });\n        return nativeStereoPannerNode;\n    };\n};\n//# sourceMappingURL=native-stereo-panner-node-factory.js.map","import { interceptConnections } from '../helpers/intercept-connections';\nexport const createNativeStereoPannerNodeFakerFactory = (createNativeChannelMergerNode, createNativeChannelSplitterNode, createNativeGainNode, createNativeWaveShaperNode, createNotSupportedError, monitorConnections) => {\n    // The curve has a size of 14bit plus 1 value to have an exact representation for zero. This value has been determined experimentally.\n    const CURVE_SIZE = 16385;\n    const DC_CURVE = new Float32Array([1, 1]);\n    const HALF_PI = Math.PI / 2;\n    const SINGLE_CHANNEL_OPTIONS = { channelCount: 1, channelCountMode: 'explicit', channelInterpretation: 'discrete' };\n    const SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS = { ...SINGLE_CHANNEL_OPTIONS, oversample: 'none' };\n    const buildInternalGraphForMono = (nativeContext, inputGainNode, panGainNode, channelMergerNode) => {\n        const leftWaveShaperCurve = new Float32Array(CURVE_SIZE);\n        const rightWaveShaperCurve = new Float32Array(CURVE_SIZE);\n        for (let i = 0; i < CURVE_SIZE; i += 1) {\n            const x = (i / (CURVE_SIZE - 1)) * HALF_PI;\n            leftWaveShaperCurve[i] = Math.cos(x);\n            rightWaveShaperCurve[i] = Math.sin(x);\n        }\n        const leftGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        // Bug #119: Safari does not fully support the WaveShaperNode.\n        const leftWaveShaperNode = (createNativeWaveShaperNode(nativeContext, { ...SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS, curve: leftWaveShaperCurve }));\n        // Bug #119: Safari does not fully support the WaveShaperNode.\n        const panWaveShaperNode = (createNativeWaveShaperNode(nativeContext, { ...SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS, curve: DC_CURVE }));\n        const rightGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        // Bug #119: Safari does not fully support the WaveShaperNode.\n        const rightWaveShaperNode = (createNativeWaveShaperNode(nativeContext, { ...SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS, curve: rightWaveShaperCurve }));\n        return {\n            connectGraph() {\n                inputGainNode.connect(leftGainNode);\n                inputGainNode.connect(panWaveShaperNode.inputs === undefined ? panWaveShaperNode : panWaveShaperNode.inputs[0]);\n                inputGainNode.connect(rightGainNode);\n                panWaveShaperNode.connect(panGainNode);\n                panGainNode.connect(leftWaveShaperNode.inputs === undefined ? leftWaveShaperNode : leftWaveShaperNode.inputs[0]);\n                panGainNode.connect(rightWaveShaperNode.inputs === undefined ? rightWaveShaperNode : rightWaveShaperNode.inputs[0]);\n                leftWaveShaperNode.connect(leftGainNode.gain);\n                rightWaveShaperNode.connect(rightGainNode.gain);\n                leftGainNode.connect(channelMergerNode, 0, 0);\n                rightGainNode.connect(channelMergerNode, 0, 1);\n            },\n            disconnectGraph() {\n                inputGainNode.disconnect(leftGainNode);\n                inputGainNode.disconnect(panWaveShaperNode.inputs === undefined ? panWaveShaperNode : panWaveShaperNode.inputs[0]);\n                inputGainNode.disconnect(rightGainNode);\n                panWaveShaperNode.disconnect(panGainNode);\n                panGainNode.disconnect(leftWaveShaperNode.inputs === undefined ? leftWaveShaperNode : leftWaveShaperNode.inputs[0]);\n                panGainNode.disconnect(rightWaveShaperNode.inputs === undefined ? rightWaveShaperNode : rightWaveShaperNode.inputs[0]);\n                leftWaveShaperNode.disconnect(leftGainNode.gain);\n                rightWaveShaperNode.disconnect(rightGainNode.gain);\n                leftGainNode.disconnect(channelMergerNode, 0, 0);\n                rightGainNode.disconnect(channelMergerNode, 0, 1);\n            }\n        };\n    };\n    const buildInternalGraphForStereo = (nativeContext, inputGainNode, panGainNode, channelMergerNode) => {\n        const leftInputForLeftOutputWaveShaperCurve = new Float32Array(CURVE_SIZE);\n        const leftInputForRightOutputWaveShaperCurve = new Float32Array(CURVE_SIZE);\n        const rightInputForLeftOutputWaveShaperCurve = new Float32Array(CURVE_SIZE);\n        const rightInputForRightOutputWaveShaperCurve = new Float32Array(CURVE_SIZE);\n        const centerIndex = Math.floor(CURVE_SIZE / 2);\n        for (let i = 0; i < CURVE_SIZE; i += 1) {\n            if (i > centerIndex) {\n                const x = ((i - centerIndex) / (CURVE_SIZE - 1 - centerIndex)) * HALF_PI;\n                leftInputForLeftOutputWaveShaperCurve[i] = Math.cos(x);\n                leftInputForRightOutputWaveShaperCurve[i] = Math.sin(x);\n                rightInputForLeftOutputWaveShaperCurve[i] = 0;\n                rightInputForRightOutputWaveShaperCurve[i] = 1;\n            }\n            else {\n                const x = (i / (CURVE_SIZE - 1 - centerIndex)) * HALF_PI;\n                leftInputForLeftOutputWaveShaperCurve[i] = 1;\n                leftInputForRightOutputWaveShaperCurve[i] = 0;\n                rightInputForLeftOutputWaveShaperCurve[i] = Math.cos(x);\n                rightInputForRightOutputWaveShaperCurve[i] = Math.sin(x);\n            }\n        }\n        const channelSplitterNode = createNativeChannelSplitterNode(nativeContext, {\n            channelCount: 2,\n            channelCountMode: 'explicit',\n            channelInterpretation: 'discrete',\n            numberOfOutputs: 2\n        });\n        const leftInputForLeftOutputGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        // Bug #119: Safari does not fully support the WaveShaperNode.\n        const leftInputForLeftOutputWaveShaperNode = createNativeWaveShaperNode(nativeContext, {\n            ...SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS,\n            curve: leftInputForLeftOutputWaveShaperCurve\n        });\n        const leftInputForRightOutputGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        // Bug #119: Safari does not fully support the WaveShaperNode.\n        const leftInputForRightOutputWaveShaperNode = createNativeWaveShaperNode(nativeContext, {\n            ...SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS,\n            curve: leftInputForRightOutputWaveShaperCurve\n        });\n        // Bug #119: Safari does not fully support the WaveShaperNode.\n        const panWaveShaperNode = (createNativeWaveShaperNode(nativeContext, { ...SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS, curve: DC_CURVE }));\n        const rightInputForLeftOutputGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        // Bug #119: Safari does not fully support the WaveShaperNode.\n        const rightInputForLeftOutputWaveShaperNode = createNativeWaveShaperNode(nativeContext, {\n            ...SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS,\n            curve: rightInputForLeftOutputWaveShaperCurve\n        });\n        const rightInputForRightOutputGainNode = createNativeGainNode(nativeContext, { ...SINGLE_CHANNEL_OPTIONS, gain: 0 });\n        // Bug #119: Safari does not fully support the WaveShaperNode.\n        const rightInputForRightOutputWaveShaperNode = createNativeWaveShaperNode(nativeContext, {\n            ...SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS,\n            curve: rightInputForRightOutputWaveShaperCurve\n        });\n        return {\n            connectGraph() {\n                inputGainNode.connect(channelSplitterNode);\n                inputGainNode.connect(panWaveShaperNode.inputs === undefined ? panWaveShaperNode : panWaveShaperNode.inputs[0]);\n                channelSplitterNode.connect(leftInputForLeftOutputGainNode, 0);\n                channelSplitterNode.connect(leftInputForRightOutputGainNode, 0);\n                channelSplitterNode.connect(rightInputForLeftOutputGainNode, 1);\n                channelSplitterNode.connect(rightInputForRightOutputGainNode, 1);\n                panWaveShaperNode.connect(panGainNode);\n                panGainNode.connect(leftInputForLeftOutputWaveShaperNode.inputs === undefined\n                    ? leftInputForLeftOutputWaveShaperNode\n                    : leftInputForLeftOutputWaveShaperNode.inputs[0]);\n                panGainNode.connect(leftInputForRightOutputWaveShaperNode.inputs === undefined\n                    ? leftInputForRightOutputWaveShaperNode\n                    : leftInputForRightOutputWaveShaperNode.inputs[0]);\n                panGainNode.connect(rightInputForLeftOutputWaveShaperNode.inputs === undefined\n                    ? rightInputForLeftOutputWaveShaperNode\n                    : rightInputForLeftOutputWaveShaperNode.inputs[0]);\n                panGainNode.connect(rightInputForRightOutputWaveShaperNode.inputs === undefined\n                    ? rightInputForRightOutputWaveShaperNode\n                    : rightInputForRightOutputWaveShaperNode.inputs[0]);\n                leftInputForLeftOutputWaveShaperNode.connect(leftInputForLeftOutputGainNode.gain);\n                leftInputForRightOutputWaveShaperNode.connect(leftInputForRightOutputGainNode.gain);\n                rightInputForLeftOutputWaveShaperNode.connect(rightInputForLeftOutputGainNode.gain);\n                rightInputForRightOutputWaveShaperNode.connect(rightInputForRightOutputGainNode.gain);\n                leftInputForLeftOutputGainNode.connect(channelMergerNode, 0, 0);\n                rightInputForLeftOutputGainNode.connect(channelMergerNode, 0, 0);\n                leftInputForRightOutputGainNode.connect(channelMergerNode, 0, 1);\n                rightInputForRightOutputGainNode.connect(channelMergerNode, 0, 1);\n            },\n            disconnectGraph() {\n                inputGainNode.disconnect(channelSplitterNode);\n                inputGainNode.disconnect(panWaveShaperNode.inputs === undefined ? panWaveShaperNode : panWaveShaperNode.inputs[0]);\n                channelSplitterNode.disconnect(leftInputForLeftOutputGainNode, 0);\n                channelSplitterNode.disconnect(leftInputForRightOutputGainNode, 0);\n                channelSplitterNode.disconnect(rightInputForLeftOutputGainNode, 1);\n                channelSplitterNode.disconnect(rightInputForRightOutputGainNode, 1);\n                panWaveShaperNode.disconnect(panGainNode);\n                panGainNode.disconnect(leftInputForLeftOutputWaveShaperNode.inputs === undefined\n                    ? leftInputForLeftOutputWaveShaperNode\n                    : leftInputForLeftOutputWaveShaperNode.inputs[0]);\n                panGainNode.disconnect(leftInputForRightOutputWaveShaperNode.inputs === undefined\n                    ? leftInputForRightOutputWaveShaperNode\n                    : leftInputForRightOutputWaveShaperNode.inputs[0]);\n                panGainNode.disconnect(rightInputForLeftOutputWaveShaperNode.inputs === undefined\n                    ? rightInputForLeftOutputWaveShaperNode\n                    : rightInputForLeftOutputWaveShaperNode.inputs[0]);\n                panGainNode.disconnect(rightInputForRightOutputWaveShaperNode.inputs === undefined\n                    ? rightInputForRightOutputWaveShaperNode\n                    : rightInputForRightOutputWaveShaperNode.inputs[0]);\n                leftInputForLeftOutputWaveShaperNode.disconnect(leftInputForLeftOutputGainNode.gain);\n                leftInputForRightOutputWaveShaperNode.disconnect(leftInputForRightOutputGainNode.gain);\n                rightInputForLeftOutputWaveShaperNode.disconnect(rightInputForLeftOutputGainNode.gain);\n                rightInputForRightOutputWaveShaperNode.disconnect(rightInputForRightOutputGainNode.gain);\n                leftInputForLeftOutputGainNode.disconnect(channelMergerNode, 0, 0);\n                rightInputForLeftOutputGainNode.disconnect(channelMergerNode, 0, 0);\n                leftInputForRightOutputGainNode.disconnect(channelMergerNode, 0, 1);\n                rightInputForRightOutputGainNode.disconnect(channelMergerNode, 0, 1);\n            }\n        };\n    };\n    const buildInternalGraph = (nativeContext, channelCount, inputGainNode, panGainNode, channelMergerNode) => {\n        if (channelCount === 1) {\n            return buildInternalGraphForMono(nativeContext, inputGainNode, panGainNode, channelMergerNode);\n        }\n        if (channelCount === 2) {\n            return buildInternalGraphForStereo(nativeContext, inputGainNode, panGainNode, channelMergerNode);\n        }\n        throw createNotSupportedError();\n    };\n    return (nativeContext, { channelCount, channelCountMode, pan, ...audioNodeOptions }) => {\n        if (channelCountMode === 'max') {\n            throw createNotSupportedError();\n        }\n        const channelMergerNode = createNativeChannelMergerNode(nativeContext, {\n            ...audioNodeOptions,\n            channelCount: 1,\n            channelCountMode,\n            numberOfInputs: 2\n        });\n        const inputGainNode = createNativeGainNode(nativeContext, { ...audioNodeOptions, channelCount, channelCountMode, gain: 1 });\n        const panGainNode = createNativeGainNode(nativeContext, {\n            channelCount: 1,\n            channelCountMode: 'explicit',\n            channelInterpretation: 'discrete',\n            gain: pan\n        });\n        let { connectGraph, disconnectGraph } = buildInternalGraph(nativeContext, channelCount, inputGainNode, panGainNode, channelMergerNode);\n        Object.defineProperty(panGainNode.gain, 'defaultValue', { get: () => 0 });\n        Object.defineProperty(panGainNode.gain, 'maxValue', { get: () => 1 });\n        Object.defineProperty(panGainNode.gain, 'minValue', { get: () => -1 });\n        const nativeStereoPannerNodeFakerFactory = {\n            get bufferSize() {\n                return undefined;\n            },\n            get channelCount() {\n                return inputGainNode.channelCount;\n            },\n            set channelCount(value) {\n                if (inputGainNode.channelCount !== value) {\n                    if (isConnected) {\n                        disconnectGraph();\n                    }\n                    ({ connectGraph, disconnectGraph } = buildInternalGraph(nativeContext, value, inputGainNode, panGainNode, channelMergerNode));\n                    if (isConnected) {\n                        connectGraph();\n                    }\n                }\n                inputGainNode.channelCount = value;\n            },\n            get channelCountMode() {\n                return inputGainNode.channelCountMode;\n            },\n            set channelCountMode(value) {\n                if (value === 'clamped-max' || value === 'max') {\n                    throw createNotSupportedError();\n                }\n                inputGainNode.channelCountMode = value;\n            },\n            get channelInterpretation() {\n                return inputGainNode.channelInterpretation;\n            },\n            set channelInterpretation(value) {\n                inputGainNode.channelInterpretation = value;\n            },\n            get context() {\n                return inputGainNode.context;\n            },\n            get inputs() {\n                return [inputGainNode];\n            },\n            get numberOfInputs() {\n                return inputGainNode.numberOfInputs;\n            },\n            get numberOfOutputs() {\n                return inputGainNode.numberOfOutputs;\n            },\n            get pan() {\n                return panGainNode.gain;\n            },\n            addEventListener(...args) {\n                return inputGainNode.addEventListener(args[0], args[1], args[2]);\n            },\n            dispatchEvent(...args) {\n                return inputGainNode.dispatchEvent(args[0]);\n            },\n            removeEventListener(...args) {\n                return inputGainNode.removeEventListener(args[0], args[1], args[2]);\n            }\n        };\n        let isConnected = false;\n        const whenConnected = () => {\n            connectGraph();\n            isConnected = true;\n        };\n        const whenDisconnected = () => {\n            disconnectGraph();\n            isConnected = false;\n        };\n        return monitorConnections(interceptConnections(nativeStereoPannerNodeFakerFactory, channelMergerNode), whenConnected, whenDisconnected);\n    };\n};\n//# sourceMappingURL=native-stereo-panner-node-faker-factory.js.map","import { assignNativeAudioNodeOption } from '../helpers/assign-native-audio-node-option';\nimport { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nexport const createNativeWaveShaperNodeFactory = (createConnectedNativeAudioBufferSourceNode, createInvalidStateError, createNativeWaveShaperNodeFaker, isDCCurve, monitorConnections, nativeAudioContextConstructor, overwriteAccessors) => {\n    return (nativeContext, options) => {\n        const nativeWaveShaperNode = nativeContext.createWaveShaper();\n        /*\n         * Bug #119: Safari does not correctly map the values.\n         * @todo Unfortunately there is no way to test for this behavior in a synchronous fashion which is why testing for the existence of\n         * the webkitAudioContext is used as a workaround here. Testing for the automationRate property is necessary because this workaround\n         * isn't necessary anymore since v14.0.2 of Safari.\n         */\n        if (nativeAudioContextConstructor !== null &&\n            nativeAudioContextConstructor.name === 'webkitAudioContext' &&\n            nativeContext.createGain().gain.automationRate === undefined) {\n            return createNativeWaveShaperNodeFaker(nativeContext, options);\n        }\n        assignNativeAudioNodeOptions(nativeWaveShaperNode, options);\n        const curve = options.curve === null || options.curve instanceof Float32Array ? options.curve : new Float32Array(options.curve);\n        // Bug #104: Chrome and Edge will throw an InvalidAccessError when the curve has less than two samples.\n        if (curve !== null && curve.length < 2) {\n            throw createInvalidStateError();\n        }\n        // Only values of type Float32Array can be assigned to the curve property.\n        assignNativeAudioNodeOption(nativeWaveShaperNode, { curve }, 'curve');\n        assignNativeAudioNodeOption(nativeWaveShaperNode, options, 'oversample');\n        let disconnectNativeAudioBufferSourceNode = null;\n        let isConnected = false;\n        overwriteAccessors(nativeWaveShaperNode, 'curve', (get) => () => get.call(nativeWaveShaperNode), (set) => (value) => {\n            set.call(nativeWaveShaperNode, value);\n            if (isConnected) {\n                if (isDCCurve(value) && disconnectNativeAudioBufferSourceNode === null) {\n                    disconnectNativeAudioBufferSourceNode = createConnectedNativeAudioBufferSourceNode(nativeContext, nativeWaveShaperNode);\n                }\n                else if (!isDCCurve(value) && disconnectNativeAudioBufferSourceNode !== null) {\n                    disconnectNativeAudioBufferSourceNode();\n                    disconnectNativeAudioBufferSourceNode = null;\n                }\n            }\n            return value;\n        });\n        const whenConnected = () => {\n            isConnected = true;\n            if (isDCCurve(nativeWaveShaperNode.curve)) {\n                disconnectNativeAudioBufferSourceNode = createConnectedNativeAudioBufferSourceNode(nativeContext, nativeWaveShaperNode);\n            }\n        };\n        const whenDisconnected = () => {\n            isConnected = false;\n            if (disconnectNativeAudioBufferSourceNode !== null) {\n                disconnectNativeAudioBufferSourceNode();\n                disconnectNativeAudioBufferSourceNode = null;\n            }\n        };\n        return monitorConnections(nativeWaveShaperNode, whenConnected, whenDisconnected);\n    };\n};\n//# sourceMappingURL=native-wave-shaper-node-factory.js.map","import { assignNativeAudioNodeOptions } from '../helpers/assign-native-audio-node-options';\nimport { interceptConnections } from '../helpers/intercept-connections';\nexport const createNativeWaveShaperNodeFakerFactory = (createConnectedNativeAudioBufferSourceNode, createInvalidStateError, createNativeGainNode, isDCCurve, monitorConnections) => {\n    return (nativeContext, { curve, oversample, ...audioNodeOptions }) => {\n        const negativeWaveShaperNode = nativeContext.createWaveShaper();\n        const positiveWaveShaperNode = nativeContext.createWaveShaper();\n        assignNativeAudioNodeOptions(negativeWaveShaperNode, audioNodeOptions);\n        assignNativeAudioNodeOptions(positiveWaveShaperNode, audioNodeOptions);\n        const inputGainNode = createNativeGainNode(nativeContext, { ...audioNodeOptions, gain: 1 });\n        const invertGainNode = createNativeGainNode(nativeContext, { ...audioNodeOptions, gain: -1 });\n        const outputGainNode = createNativeGainNode(nativeContext, { ...audioNodeOptions, gain: 1 });\n        const revertGainNode = createNativeGainNode(nativeContext, { ...audioNodeOptions, gain: -1 });\n        let disconnectNativeAudioBufferSourceNode = null;\n        let isConnected = false;\n        let unmodifiedCurve = null;\n        const nativeWaveShaperNodeFaker = {\n            get bufferSize() {\n                return undefined;\n            },\n            get channelCount() {\n                return negativeWaveShaperNode.channelCount;\n            },\n            set channelCount(value) {\n                inputGainNode.channelCount = value;\n                invertGainNode.channelCount = value;\n                negativeWaveShaperNode.channelCount = value;\n                outputGainNode.channelCount = value;\n                positiveWaveShaperNode.channelCount = value;\n                revertGainNode.channelCount = value;\n            },\n            get channelCountMode() {\n                return negativeWaveShaperNode.channelCountMode;\n            },\n            set channelCountMode(value) {\n                inputGainNode.channelCountMode = value;\n                invertGainNode.channelCountMode = value;\n                negativeWaveShaperNode.channelCountMode = value;\n                outputGainNode.channelCountMode = value;\n                positiveWaveShaperNode.channelCountMode = value;\n                revertGainNode.channelCountMode = value;\n            },\n            get channelInterpretation() {\n                return negativeWaveShaperNode.channelInterpretation;\n            },\n            set channelInterpretation(value) {\n                inputGainNode.channelInterpretation = value;\n                invertGainNode.channelInterpretation = value;\n                negativeWaveShaperNode.channelInterpretation = value;\n                outputGainNode.channelInterpretation = value;\n                positiveWaveShaperNode.channelInterpretation = value;\n                revertGainNode.channelInterpretation = value;\n            },\n            get context() {\n                return negativeWaveShaperNode.context;\n            },\n            get curve() {\n                return unmodifiedCurve;\n            },\n            set curve(value) {\n                // Bug #102: Safari does not throw an InvalidStateError when the curve has less than two samples.\n                if (value !== null && value.length < 2) {\n                    throw createInvalidStateError();\n                }\n                if (value === null) {\n                    negativeWaveShaperNode.curve = value;\n                    positiveWaveShaperNode.curve = value;\n                }\n                else {\n                    const curveLength = value.length;\n                    const negativeCurve = new Float32Array(curveLength + 2 - (curveLength % 2));\n                    const positiveCurve = new Float32Array(curveLength + 2 - (curveLength % 2));\n                    negativeCurve[0] = value[0];\n                    positiveCurve[0] = -value[curveLength - 1];\n                    const length = Math.ceil((curveLength + 1) / 2);\n                    const centerIndex = (curveLength + 1) / 2 - 1;\n                    for (let i = 1; i < length; i += 1) {\n                        const theoreticIndex = (i / length) * centerIndex;\n                        const lowerIndex = Math.floor(theoreticIndex);\n                        const upperIndex = Math.ceil(theoreticIndex);\n                        negativeCurve[i] =\n                            lowerIndex === upperIndex\n                                ? value[lowerIndex]\n                                : (1 - (theoreticIndex - lowerIndex)) * value[lowerIndex] +\n                                    (1 - (upperIndex - theoreticIndex)) * value[upperIndex];\n                        positiveCurve[i] =\n                            lowerIndex === upperIndex\n                                ? -value[curveLength - 1 - lowerIndex]\n                                : -((1 - (theoreticIndex - lowerIndex)) * value[curveLength - 1 - lowerIndex]) -\n                                    (1 - (upperIndex - theoreticIndex)) * value[curveLength - 1 - upperIndex];\n                    }\n                    negativeCurve[length] = curveLength % 2 === 1 ? value[length - 1] : (value[length - 2] + value[length - 1]) / 2;\n                    negativeWaveShaperNode.curve = negativeCurve;\n                    positiveWaveShaperNode.curve = positiveCurve;\n                }\n                unmodifiedCurve = value;\n                if (isConnected) {\n                    if (isDCCurve(unmodifiedCurve) && disconnectNativeAudioBufferSourceNode === null) {\n                        disconnectNativeAudioBufferSourceNode = createConnectedNativeAudioBufferSourceNode(nativeContext, inputGainNode);\n                    }\n                    else if (disconnectNativeAudioBufferSourceNode !== null) {\n                        disconnectNativeAudioBufferSourceNode();\n                        disconnectNativeAudioBufferSourceNode = null;\n                    }\n                }\n            },\n            get inputs() {\n                return [inputGainNode];\n            },\n            get numberOfInputs() {\n                return negativeWaveShaperNode.numberOfInputs;\n            },\n            get numberOfOutputs() {\n                return negativeWaveShaperNode.numberOfOutputs;\n            },\n            get oversample() {\n                return negativeWaveShaperNode.oversample;\n            },\n            set oversample(value) {\n                negativeWaveShaperNode.oversample = value;\n                positiveWaveShaperNode.oversample = value;\n            },\n            addEventListener(...args) {\n                return inputGainNode.addEventListener(args[0], args[1], args[2]);\n            },\n            dispatchEvent(...args) {\n                return inputGainNode.dispatchEvent(args[0]);\n            },\n            removeEventListener(...args) {\n                return inputGainNode.removeEventListener(args[0], args[1], args[2]);\n            }\n        };\n        if (curve !== null) {\n            // Only values of type Float32Array can be assigned to the curve property.\n            nativeWaveShaperNodeFaker.curve = curve instanceof Float32Array ? curve : new Float32Array(curve);\n        }\n        if (oversample !== nativeWaveShaperNodeFaker.oversample) {\n            nativeWaveShaperNodeFaker.oversample = oversample;\n        }\n        const whenConnected = () => {\n            inputGainNode.connect(negativeWaveShaperNode).connect(outputGainNode);\n            inputGainNode.connect(invertGainNode).connect(positiveWaveShaperNode).connect(revertGainNode).connect(outputGainNode);\n            isConnected = true;\n            if (isDCCurve(unmodifiedCurve)) {\n                disconnectNativeAudioBufferSourceNode = createConnectedNativeAudioBufferSourceNode(nativeContext, inputGainNode);\n            }\n        };\n        const whenDisconnected = () => {\n            inputGainNode.disconnect(negativeWaveShaperNode);\n            negativeWaveShaperNode.disconnect(outputGainNode);\n            inputGainNode.disconnect(invertGainNode);\n            invertGainNode.disconnect(positiveWaveShaperNode);\n            positiveWaveShaperNode.disconnect(revertGainNode);\n            revertGainNode.disconnect(outputGainNode);\n            isConnected = false;\n            if (disconnectNativeAudioBufferSourceNode !== null) {\n                disconnectNativeAudioBufferSourceNode();\n                disconnectNativeAudioBufferSourceNode = null;\n            }\n        };\n        return monitorConnections(interceptConnections(nativeWaveShaperNodeFaker, outputGainNode), whenConnected, whenDisconnected);\n    };\n};\n//# sourceMappingURL=native-wave-shaper-node-faker-factory.js.map","export const createNotSupportedError = () => new DOMException('', 'NotSupportedError');\n//# sourceMappingURL=not-supported-error.js.map","import { deactivateAudioGraph } from '../helpers/deactivate-audio-graph';\nimport { testPromiseSupport } from '../helpers/test-promise-support';\nconst DEFAULT_OPTIONS = {\n    numberOfChannels: 1\n};\nexport const createOfflineAudioContextConstructor = (baseAudioContextConstructor, cacheTestResult, createInvalidStateError, createNativeOfflineAudioContext, startRendering) => {\n    return class OfflineAudioContext extends baseAudioContextConstructor {\n        constructor(a, b, c) {\n            let options;\n            if (typeof a === 'number' && b !== undefined && c !== undefined) {\n                options = { length: b, numberOfChannels: a, sampleRate: c };\n            }\n            else if (typeof a === 'object') {\n                options = a;\n            }\n            else {\n                throw new Error('The given parameters are not valid.');\n            }\n            const { length, numberOfChannels, sampleRate } = { ...DEFAULT_OPTIONS, ...options };\n            const nativeOfflineAudioContext = createNativeOfflineAudioContext(numberOfChannels, length, sampleRate);\n            // #21 Safari does not support promises and therefore would fire the statechange event before the promise can be resolved.\n            if (!cacheTestResult(testPromiseSupport, () => testPromiseSupport(nativeOfflineAudioContext))) {\n                nativeOfflineAudioContext.addEventListener('statechange', (() => {\n                    let i = 0;\n                    const delayStateChangeEvent = (event) => {\n                        if (this._state === 'running') {\n                            if (i > 0) {\n                                nativeOfflineAudioContext.removeEventListener('statechange', delayStateChangeEvent);\n                                event.stopImmediatePropagation();\n                                this._waitForThePromiseToSettle(event);\n                            }\n                            else {\n                                i += 1;\n                            }\n                        }\n                    };\n                    return delayStateChangeEvent;\n                })());\n            }\n            super(nativeOfflineAudioContext, numberOfChannels);\n            this._length = length;\n            this._nativeOfflineAudioContext = nativeOfflineAudioContext;\n            this._state = null;\n        }\n        get length() {\n            // Bug #17: Safari does not yet expose the length.\n            if (this._nativeOfflineAudioContext.length === undefined) {\n                return this._length;\n            }\n            return this._nativeOfflineAudioContext.length;\n        }\n        get state() {\n            return this._state === null ? this._nativeOfflineAudioContext.state : this._state;\n        }\n        startRendering() {\n            /*\n             * Bug #9 & #59: It is theoretically possible that startRendering() will first render a partialOfflineAudioContext. Therefore\n             * the state of the nativeOfflineAudioContext might no transition to running immediately.\n             */\n            if (this._state === 'running') {\n                return Promise.reject(createInvalidStateError());\n            }\n            this._state = 'running';\n            return startRendering(this.destination, this._nativeOfflineAudioContext).finally(() => {\n                this._state = null;\n                deactivateAudioGraph(this);\n            });\n        }\n        _waitForThePromiseToSettle(event) {\n            if (this._state === null) {\n                this._nativeOfflineAudioContext.dispatchEvent(event);\n            }\n            else {\n                setTimeout(() => this._waitForThePromiseToSettle(event));\n            }\n        }\n    };\n};\n//# sourceMappingURL=offline-audio-context-constructor.js.map","import { isActiveAudioNode } from '../helpers/is-active-audio-node';\nimport { setInternalStateToActive } from '../helpers/set-internal-state-to-active';\nimport { setInternalStateToPassive } from '../helpers/set-internal-state-to-passive';\nconst DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'max', // This attribute has no effect for nodes with no inputs.\n    channelInterpretation: 'speakers', // This attribute has no effect for nodes with no inputs.\n    detune: 0,\n    frequency: 440,\n    periodicWave: undefined,\n    type: 'sine'\n};\nexport const createOscillatorNodeConstructor = (audioNodeConstructor, createAudioParam, createNativeOscillatorNode, createOscillatorNodeRenderer, getNativeContext, isNativeOfflineAudioContext, wrapEventListener) => {\n    return class OscillatorNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeOscillatorNode = createNativeOscillatorNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const oscillatorNodeRenderer = (isOffline ? createOscillatorNodeRenderer() : null);\n            const nyquist = context.sampleRate / 2;\n            super(context, false, nativeOscillatorNode, oscillatorNodeRenderer);\n            // Bug #81: Firefox & Safari do not export the correct values for maxValue and minValue.\n            this._detune = createAudioParam(this, isOffline, nativeOscillatorNode.detune, 153600, -153600);\n            // Bug #76: Safari does not export the correct values for maxValue and minValue.\n            this._frequency = createAudioParam(this, isOffline, nativeOscillatorNode.frequency, nyquist, -nyquist);\n            this._nativeOscillatorNode = nativeOscillatorNode;\n            this._onended = null;\n            this._oscillatorNodeRenderer = oscillatorNodeRenderer;\n            if (this._oscillatorNodeRenderer !== null && mergedOptions.periodicWave !== undefined) {\n                this._oscillatorNodeRenderer.periodicWave =\n                    mergedOptions.periodicWave;\n            }\n        }\n        get detune() {\n            return this._detune;\n        }\n        get frequency() {\n            return this._frequency;\n        }\n        get onended() {\n            return this._onended;\n        }\n        set onended(value) {\n            const wrappedListener = typeof value === 'function' ? wrapEventListener(this, value) : null;\n            this._nativeOscillatorNode.onended = wrappedListener;\n            const nativeOnEnded = this._nativeOscillatorNode.onended;\n            this._onended = nativeOnEnded !== null && nativeOnEnded === wrappedListener ? value : nativeOnEnded;\n        }\n        get type() {\n            return this._nativeOscillatorNode.type;\n        }\n        set type(value) {\n            this._nativeOscillatorNode.type = value;\n            if (this._oscillatorNodeRenderer !== null) {\n                this._oscillatorNodeRenderer.periodicWave = null;\n            }\n        }\n        setPeriodicWave(periodicWave) {\n            this._nativeOscillatorNode.setPeriodicWave(periodicWave);\n            if (this._oscillatorNodeRenderer !== null) {\n                this._oscillatorNodeRenderer.periodicWave = periodicWave;\n            }\n        }\n        start(when = 0) {\n            this._nativeOscillatorNode.start(when);\n            if (this._oscillatorNodeRenderer !== null) {\n                this._oscillatorNodeRenderer.start = when;\n            }\n            if (this.context.state !== 'closed') {\n                setInternalStateToActive(this);\n                const resetInternalStateToPassive = () => {\n                    this._nativeOscillatorNode.removeEventListener('ended', resetInternalStateToPassive);\n                    if (isActiveAudioNode(this)) {\n                        setInternalStateToPassive(this);\n                    }\n                };\n                this._nativeOscillatorNode.addEventListener('ended', resetInternalStateToPassive);\n            }\n        }\n        stop(when = 0) {\n            this._nativeOscillatorNode.stop(when);\n            if (this._oscillatorNodeRenderer !== null) {\n                this._oscillatorNodeRenderer.stop = when;\n            }\n        }\n    };\n};\n//# sourceMappingURL=oscillator-node-constructor.js.map","import { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createOscillatorNodeRendererFactory = (connectAudioParam, createNativeOscillatorNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeOscillatorNodes = new WeakMap();\n        let periodicWave = null;\n        let start = null;\n        let stop = null;\n        const createOscillatorNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeOscillatorNode = getNativeAudioNode(proxy);\n            // If the initially used nativeOscillatorNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeOscillatorNodeIsOwnedByContext = isOwnedByContext(nativeOscillatorNode, nativeOfflineAudioContext);\n            if (!nativeOscillatorNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeOscillatorNode.channelCount,\n                    channelCountMode: nativeOscillatorNode.channelCountMode,\n                    channelInterpretation: nativeOscillatorNode.channelInterpretation,\n                    detune: nativeOscillatorNode.detune.value,\n                    frequency: nativeOscillatorNode.frequency.value,\n                    periodicWave: periodicWave === null ? undefined : periodicWave,\n                    type: nativeOscillatorNode.type\n                };\n                nativeOscillatorNode = createNativeOscillatorNode(nativeOfflineAudioContext, options);\n                if (start !== null) {\n                    nativeOscillatorNode.start(start);\n                }\n                if (stop !== null) {\n                    nativeOscillatorNode.stop(stop);\n                }\n            }\n            renderedNativeOscillatorNodes.set(nativeOfflineAudioContext, nativeOscillatorNode);\n            if (!nativeOscillatorNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.detune, nativeOscillatorNode.detune);\n                await renderAutomation(nativeOfflineAudioContext, proxy.frequency, nativeOscillatorNode.frequency);\n            }\n            else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.detune, nativeOscillatorNode.detune);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.frequency, nativeOscillatorNode.frequency);\n            }\n            await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeOscillatorNode);\n            return nativeOscillatorNode;\n        };\n        return {\n            set periodicWave(value) {\n                periodicWave = value;\n            },\n            set start(value) {\n                start = value;\n            },\n            set stop(value) {\n                stop = value;\n            },\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeOscillatorNode = renderedNativeOscillatorNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeOscillatorNode !== undefined) {\n                    return Promise.resolve(renderedNativeOscillatorNode);\n                }\n                return createOscillatorNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=oscillator-node-renderer-factory.js.map","import { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nconst DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'clamped-max',\n    channelInterpretation: 'speakers',\n    coneInnerAngle: 360,\n    coneOuterAngle: 360,\n    coneOuterGain: 0,\n    distanceModel: 'inverse',\n    maxDistance: 10000,\n    orientationX: 1,\n    orientationY: 0,\n    orientationZ: 0,\n    panningModel: 'equalpower',\n    positionX: 0,\n    positionY: 0,\n    positionZ: 0,\n    refDistance: 1,\n    rolloffFactor: 1\n};\nexport const createPannerNodeConstructor = (audioNodeConstructor, createAudioParam, createNativePannerNode, createPannerNodeRenderer, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime) => {\n    return class PannerNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativePannerNode = createNativePannerNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const pannerNodeRenderer = (isOffline ? createPannerNodeRenderer() : null);\n            super(context, false, nativePannerNode, pannerNodeRenderer);\n            this._nativePannerNode = nativePannerNode;\n            // Bug #74: Safari does not export the correct values for maxValue and minValue.\n            this._orientationX = createAudioParam(this, isOffline, nativePannerNode.orientationX, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n            this._orientationY = createAudioParam(this, isOffline, nativePannerNode.orientationY, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n            this._orientationZ = createAudioParam(this, isOffline, nativePannerNode.orientationZ, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n            this._positionX = createAudioParam(this, isOffline, nativePannerNode.positionX, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n            this._positionY = createAudioParam(this, isOffline, nativePannerNode.positionY, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n            this._positionZ = createAudioParam(this, isOffline, nativePannerNode.positionZ, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n            // @todo Determine a meaningful tail-time instead of just using one second.\n            setAudioNodeTailTime(this, 1);\n        }\n        get coneInnerAngle() {\n            return this._nativePannerNode.coneInnerAngle;\n        }\n        set coneInnerAngle(value) {\n            this._nativePannerNode.coneInnerAngle = value;\n        }\n        get coneOuterAngle() {\n            return this._nativePannerNode.coneOuterAngle;\n        }\n        set coneOuterAngle(value) {\n            this._nativePannerNode.coneOuterAngle = value;\n        }\n        get coneOuterGain() {\n            return this._nativePannerNode.coneOuterGain;\n        }\n        set coneOuterGain(value) {\n            this._nativePannerNode.coneOuterGain = value;\n        }\n        get distanceModel() {\n            return this._nativePannerNode.distanceModel;\n        }\n        set distanceModel(value) {\n            this._nativePannerNode.distanceModel = value;\n        }\n        get maxDistance() {\n            return this._nativePannerNode.maxDistance;\n        }\n        set maxDistance(value) {\n            this._nativePannerNode.maxDistance = value;\n        }\n        get orientationX() {\n            return this._orientationX;\n        }\n        get orientationY() {\n            return this._orientationY;\n        }\n        get orientationZ() {\n            return this._orientationZ;\n        }\n        get panningModel() {\n            return this._nativePannerNode.panningModel;\n        }\n        set panningModel(value) {\n            this._nativePannerNode.panningModel = value;\n        }\n        get positionX() {\n            return this._positionX;\n        }\n        get positionY() {\n            return this._positionY;\n        }\n        get positionZ() {\n            return this._positionZ;\n        }\n        get refDistance() {\n            return this._nativePannerNode.refDistance;\n        }\n        set refDistance(value) {\n            this._nativePannerNode.refDistance = value;\n        }\n        get rolloffFactor() {\n            return this._nativePannerNode.rolloffFactor;\n        }\n        set rolloffFactor(value) {\n            this._nativePannerNode.rolloffFactor = value;\n        }\n    };\n};\n//# sourceMappingURL=panner-node-constructor.js.map","import { isNativeAudioNodeFaker } from '../guards/native-audio-node-faker';\nimport { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createPannerNodeRendererFactory = (connectAudioParam, createNativeChannelMergerNode, createNativeConstantSourceNode, createNativeGainNode, createNativePannerNode, getNativeAudioNode, nativeOfflineAudioContextConstructor, renderAutomation, renderInputsOfAudioNode, renderNativeOfflineAudioContext) => {\n    return () => {\n        const renderedNativeAudioNodes = new WeakMap();\n        let renderedBufferPromise = null;\n        const createAudioNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeGainNode = null;\n            let nativePannerNode = getNativeAudioNode(proxy);\n            const commonAudioNodeOptions = {\n                channelCount: nativePannerNode.channelCount,\n                channelCountMode: nativePannerNode.channelCountMode,\n                channelInterpretation: nativePannerNode.channelInterpretation\n            };\n            const commonNativePannerNodeOptions = {\n                ...commonAudioNodeOptions,\n                coneInnerAngle: nativePannerNode.coneInnerAngle,\n                coneOuterAngle: nativePannerNode.coneOuterAngle,\n                coneOuterGain: nativePannerNode.coneOuterGain,\n                distanceModel: nativePannerNode.distanceModel,\n                maxDistance: nativePannerNode.maxDistance,\n                panningModel: nativePannerNode.panningModel,\n                refDistance: nativePannerNode.refDistance,\n                rolloffFactor: nativePannerNode.rolloffFactor\n            };\n            // If the initially used nativePannerNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativePannerNodeIsOwnedByContext = isOwnedByContext(nativePannerNode, nativeOfflineAudioContext);\n            // Bug #124: Safari does not support modifying the orientation and the position with AudioParams.\n            if ('bufferSize' in nativePannerNode) {\n                nativeGainNode = createNativeGainNode(nativeOfflineAudioContext, { ...commonAudioNodeOptions, gain: 1 });\n            }\n            else if (!nativePannerNodeIsOwnedByContext) {\n                const options = {\n                    ...commonNativePannerNodeOptions,\n                    orientationX: nativePannerNode.orientationX.value,\n                    orientationY: nativePannerNode.orientationY.value,\n                    orientationZ: nativePannerNode.orientationZ.value,\n                    positionX: nativePannerNode.positionX.value,\n                    positionY: nativePannerNode.positionY.value,\n                    positionZ: nativePannerNode.positionZ.value\n                };\n                nativePannerNode = createNativePannerNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeAudioNodes.set(nativeOfflineAudioContext, nativeGainNode === null ? nativePannerNode : nativeGainNode);\n            if (nativeGainNode !== null) {\n                if (renderedBufferPromise === null) {\n                    if (nativeOfflineAudioContextConstructor === null) {\n                        throw new Error('Missing the native OfflineAudioContext constructor.');\n                    }\n                    const partialOfflineAudioContext = new nativeOfflineAudioContextConstructor(6, \n                    // Bug #17: Safari does not yet expose the length.\n                    proxy.context.length, nativeOfflineAudioContext.sampleRate);\n                    const nativeChannelMergerNode = createNativeChannelMergerNode(partialOfflineAudioContext, {\n                        channelCount: 1,\n                        channelCountMode: 'explicit',\n                        channelInterpretation: 'speakers',\n                        numberOfInputs: 6\n                    });\n                    nativeChannelMergerNode.connect(partialOfflineAudioContext.destination);\n                    renderedBufferPromise = (async () => {\n                        const nativeConstantSourceNodes = await Promise.all([\n                            proxy.orientationX,\n                            proxy.orientationY,\n                            proxy.orientationZ,\n                            proxy.positionX,\n                            proxy.positionY,\n                            proxy.positionZ\n                        ].map(async (audioParam, index) => {\n                            const nativeConstantSourceNode = createNativeConstantSourceNode(partialOfflineAudioContext, {\n                                channelCount: 1,\n                                channelCountMode: 'explicit',\n                                channelInterpretation: 'discrete',\n                                offset: index === 0 ? 1 : 0\n                            });\n                            await renderAutomation(partialOfflineAudioContext, audioParam, nativeConstantSourceNode.offset);\n                            return nativeConstantSourceNode;\n                        }));\n                        for (let i = 0; i < 6; i += 1) {\n                            nativeConstantSourceNodes[i].connect(nativeChannelMergerNode, 0, i);\n                            nativeConstantSourceNodes[i].start(0);\n                        }\n                        return renderNativeOfflineAudioContext(partialOfflineAudioContext);\n                    })();\n                }\n                const renderedBuffer = await renderedBufferPromise;\n                const inputGainNode = createNativeGainNode(nativeOfflineAudioContext, { ...commonAudioNodeOptions, gain: 1 });\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, inputGainNode);\n                const channelDatas = [];\n                for (let i = 0; i < renderedBuffer.numberOfChannels; i += 1) {\n                    channelDatas.push(renderedBuffer.getChannelData(i));\n                }\n                let lastOrientation = [channelDatas[0][0], channelDatas[1][0], channelDatas[2][0]];\n                let lastPosition = [channelDatas[3][0], channelDatas[4][0], channelDatas[5][0]];\n                let gateGainNode = createNativeGainNode(nativeOfflineAudioContext, { ...commonAudioNodeOptions, gain: 1 });\n                let partialPannerNode = createNativePannerNode(nativeOfflineAudioContext, {\n                    ...commonNativePannerNodeOptions,\n                    orientationX: lastOrientation[0],\n                    orientationY: lastOrientation[1],\n                    orientationZ: lastOrientation[2],\n                    positionX: lastPosition[0],\n                    positionY: lastPosition[1],\n                    positionZ: lastPosition[2]\n                });\n                inputGainNode.connect(gateGainNode).connect(partialPannerNode.inputs[0]);\n                partialPannerNode.connect(nativeGainNode);\n                for (let i = 128; i < renderedBuffer.length; i += 128) {\n                    const orientation = [channelDatas[0][i], channelDatas[1][i], channelDatas[2][i]];\n                    const positon = [channelDatas[3][i], channelDatas[4][i], channelDatas[5][i]];\n                    if (orientation.some((value, index) => value !== lastOrientation[index]) ||\n                        positon.some((value, index) => value !== lastPosition[index])) {\n                        lastOrientation = orientation;\n                        lastPosition = positon;\n                        const currentTime = i / nativeOfflineAudioContext.sampleRate;\n                        gateGainNode.gain.setValueAtTime(0, currentTime);\n                        gateGainNode = createNativeGainNode(nativeOfflineAudioContext, { ...commonAudioNodeOptions, gain: 0 });\n                        partialPannerNode = createNativePannerNode(nativeOfflineAudioContext, {\n                            ...commonNativePannerNodeOptions,\n                            orientationX: lastOrientation[0],\n                            orientationY: lastOrientation[1],\n                            orientationZ: lastOrientation[2],\n                            positionX: lastPosition[0],\n                            positionY: lastPosition[1],\n                            positionZ: lastPosition[2]\n                        });\n                        gateGainNode.gain.setValueAtTime(1, currentTime);\n                        inputGainNode.connect(gateGainNode).connect(partialPannerNode.inputs[0]);\n                        partialPannerNode.connect(nativeGainNode);\n                    }\n                }\n                return nativeGainNode;\n            }\n            if (!nativePannerNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.orientationX, nativePannerNode.orientationX);\n                await renderAutomation(nativeOfflineAudioContext, proxy.orientationY, nativePannerNode.orientationY);\n                await renderAutomation(nativeOfflineAudioContext, proxy.orientationZ, nativePannerNode.orientationZ);\n                await renderAutomation(nativeOfflineAudioContext, proxy.positionX, nativePannerNode.positionX);\n                await renderAutomation(nativeOfflineAudioContext, proxy.positionY, nativePannerNode.positionY);\n                await renderAutomation(nativeOfflineAudioContext, proxy.positionZ, nativePannerNode.positionZ);\n            }\n            else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.orientationX, nativePannerNode.orientationX);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.orientationY, nativePannerNode.orientationY);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.orientationZ, nativePannerNode.orientationZ);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.positionX, nativePannerNode.positionX);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.positionY, nativePannerNode.positionY);\n                await connectAudioParam(nativeOfflineAudioContext, proxy.positionZ, nativePannerNode.positionZ);\n            }\n            if (isNativeAudioNodeFaker(nativePannerNode)) {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativePannerNode.inputs[0]);\n            }\n            else {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativePannerNode);\n            }\n            return nativePannerNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeGainNodeOrNativePannerNode = renderedNativeAudioNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeGainNodeOrNativePannerNode !== undefined) {\n                    return Promise.resolve(renderedNativeGainNodeOrNativePannerNode);\n                }\n                return createAudioNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=panner-node-renderer-factory.js.map","const DEFAULT_OPTIONS = {\n    disableNormalization: false\n};\nexport const createPeriodicWaveConstructor = (createNativePeriodicWave, getNativeContext, periodicWaveStore, sanitizePeriodicWaveOptions) => {\n    return class PeriodicWave {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = sanitizePeriodicWaveOptions({ ...DEFAULT_OPTIONS, ...options });\n            const periodicWave = createNativePeriodicWave(nativeContext, mergedOptions);\n            periodicWaveStore.add(periodicWave);\n            // This does violate all good pratices but it is used here to simplify the handling of periodic waves.\n            return periodicWave;\n        }\n        static [Symbol.hasInstance](instance) {\n            return ((instance !== null && typeof instance === 'object' && Object.getPrototypeOf(instance) === PeriodicWave.prototype) ||\n                periodicWaveStore.has(instance));\n        }\n    };\n};\n//# sourceMappingURL=periodic-wave-constructor.js.map","export const createRenderAutomation = (getAudioParamRenderer, renderInputsOfAudioParam) => {\n    return (nativeOfflineAudioContext, audioParam, nativeAudioParam) => {\n        const audioParamRenderer = getAudioParamRenderer(audioParam);\n        audioParamRenderer.replay(nativeAudioParam);\n        return renderInputsOfAudioParam(audioParam, nativeOfflineAudioContext, nativeAudioParam);\n    };\n};\n//# sourceMappingURL=render-automation.js.map","export const createRenderInputsOfAudioNode = (getAudioNodeConnections, getAudioNodeRenderer, isPartOfACycle) => {\n    return async (audioNode, nativeOfflineAudioContext, nativeAudioNode) => {\n        const audioNodeConnections = getAudioNodeConnections(audioNode);\n        await Promise.all(audioNodeConnections.activeInputs\n            .map((connections, input) => Array.from(connections).map(async ([source, output]) => {\n            const audioNodeRenderer = getAudioNodeRenderer(source);\n            const renderedNativeAudioNode = await audioNodeRenderer.render(source, nativeOfflineAudioContext);\n            const destination = audioNode.context.destination;\n            if (!isPartOfACycle(source) && (audioNode !== destination || !isPartOfACycle(audioNode))) {\n                renderedNativeAudioNode.connect(nativeAudioNode, output, input);\n            }\n        }))\n            .reduce((allRenderingPromises, renderingPromises) => [...allRenderingPromises, ...renderingPromises], []));\n    };\n};\n//# sourceMappingURL=render-inputs-of-audio-node.js.map","export const createRenderInputsOfAudioParam = (getAudioNodeRenderer, getAudioParamConnections, isPartOfACycle) => {\n    return async (audioParam, nativeOfflineAudioContext, nativeAudioParam) => {\n        const audioParamConnections = getAudioParamConnections(audioParam);\n        await Promise.all(Array.from(audioParamConnections.activeInputs).map(async ([source, output]) => {\n            const audioNodeRenderer = getAudioNodeRenderer(source);\n            const renderedNativeAudioNode = await audioNodeRenderer.render(source, nativeOfflineAudioContext);\n            if (!isPartOfACycle(source)) {\n                renderedNativeAudioNode.connect(nativeAudioParam, output);\n            }\n        }));\n    };\n};\n//# sourceMappingURL=render-inputs-of-audio-param.js.map","import { testPromiseSupport } from '../helpers/test-promise-support';\nexport const createRenderNativeOfflineAudioContext = (cacheTestResult, createNativeGainNode, createNativeScriptProcessorNode, testOfflineAudioContextCurrentTimeSupport) => {\n    return (nativeOfflineAudioContext) => {\n        // Bug #21: Safari does not support promises yet.\n        if (cacheTestResult(testPromiseSupport, () => testPromiseSupport(nativeOfflineAudioContext))) {\n            // Bug #158: Chrome and Edge do not advance currentTime if it is not accessed while rendering the audio.\n            return Promise.resolve(cacheTestResult(testOfflineAudioContextCurrentTimeSupport, testOfflineAudioContextCurrentTimeSupport)).then((isOfflineAudioContextCurrentTimeSupported) => {\n                if (!isOfflineAudioContextCurrentTimeSupported) {\n                    const scriptProcessorNode = createNativeScriptProcessorNode(nativeOfflineAudioContext, 512, 0, 1);\n                    nativeOfflineAudioContext.oncomplete = () => {\n                        scriptProcessorNode.onaudioprocess = null; // tslint:disable-line:deprecation\n                        scriptProcessorNode.disconnect();\n                    };\n                    scriptProcessorNode.onaudioprocess = () => nativeOfflineAudioContext.currentTime; // tslint:disable-line:deprecation\n                    scriptProcessorNode.connect(nativeOfflineAudioContext.destination);\n                }\n                return nativeOfflineAudioContext.startRendering();\n            });\n        }\n        return new Promise((resolve) => {\n            // Bug #48: Safari does not render an OfflineAudioContext without any connected node.\n            const gainNode = createNativeGainNode(nativeOfflineAudioContext, {\n                channelCount: 1,\n                channelCountMode: 'explicit',\n                channelInterpretation: 'discrete',\n                gain: 0\n            });\n            nativeOfflineAudioContext.oncomplete = (event) => {\n                gainNode.disconnect();\n                resolve(event.renderedBuffer);\n            };\n            gainNode.connect(nativeOfflineAudioContext.destination);\n            nativeOfflineAudioContext.startRendering();\n        });\n    };\n};\n//# sourceMappingURL=render-native-offline-audio-context.js.map","export const createSetActiveAudioWorkletNodeInputs = (activeAudioWorkletNodeInputsStore) => {\n    return (nativeAudioWorkletNode, activeInputs) => {\n        activeAudioWorkletNodeInputsStore.set(nativeAudioWorkletNode, activeInputs);\n    };\n};\n//# sourceMappingURL=set-active-audio-worklet-node-inputs.js.map","export const createSetAudioNodeTailTime = (audioNodeTailTimeStore) => {\n    return (audioNode, tailTime) => audioNodeTailTimeStore.set(audioNode, tailTime);\n};\n//# sourceMappingURL=set-audio-node-tail-time.js.map","import { wrapAudioBufferGetChannelDataMethod } from '../helpers/wrap-audio-buffer-get-channel-data-method';\nexport const createStartRendering = (audioBufferStore, cacheTestResult, getAudioNodeRenderer, getUnrenderedAudioWorkletNodes, renderNativeOfflineAudioContext, testAudioBufferCopyChannelMethodsOutOfBoundsSupport, wrapAudioBufferCopyChannelMethods, wrapAudioBufferCopyChannelMethodsOutOfBounds) => {\n    return (destination, nativeOfflineAudioContext) => getAudioNodeRenderer(destination)\n        .render(destination, nativeOfflineAudioContext)\n        /*\n         * Bug #86 & #87: Invoking the renderer of an AudioWorkletNode might be necessary if it has no direct or indirect connection to the\n         * destination.\n         */\n        .then(() => Promise.all(Array.from(getUnrenderedAudioWorkletNodes(nativeOfflineAudioContext)).map((audioWorkletNode) => getAudioNodeRenderer(audioWorkletNode).render(audioWorkletNode, nativeOfflineAudioContext))))\n        .then(() => renderNativeOfflineAudioContext(nativeOfflineAudioContext))\n        .then((audioBuffer) => {\n        // Bug #5: Safari does not support copyFromChannel() and copyToChannel().\n        // Bug #100: Safari does throw a wrong error when calling getChannelData() with an out-of-bounds value.\n        if (typeof audioBuffer.copyFromChannel !== 'function') {\n            wrapAudioBufferCopyChannelMethods(audioBuffer);\n            wrapAudioBufferGetChannelDataMethod(audioBuffer);\n            // Bug #157: Firefox does not allow the bufferOffset to be out-of-bounds.\n        }\n        else if (!cacheTestResult(testAudioBufferCopyChannelMethodsOutOfBoundsSupport, () => testAudioBufferCopyChannelMethodsOutOfBoundsSupport(audioBuffer))) {\n            wrapAudioBufferCopyChannelMethodsOutOfBounds(audioBuffer);\n        }\n        audioBufferStore.add(audioBuffer);\n        return audioBuffer;\n    });\n};\n//# sourceMappingURL=start-rendering.js.map","const DEFAULT_OPTIONS = {\n    channelCount: 2,\n    /*\n     * Bug #105: The channelCountMode should be 'clamped-max' according to the spec but is set to 'explicit' to achieve consistent\n     * behavior.\n     */\n    channelCountMode: 'explicit',\n    channelInterpretation: 'speakers',\n    pan: 0\n};\nexport const createStereoPannerNodeConstructor = (audioNodeConstructor, createAudioParam, createNativeStereoPannerNode, createStereoPannerNodeRenderer, getNativeContext, isNativeOfflineAudioContext) => {\n    return class StereoPannerNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeStereoPannerNode = createNativeStereoPannerNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const stereoPannerNodeRenderer = (isOffline ? createStereoPannerNodeRenderer() : null);\n            super(context, false, nativeStereoPannerNode, stereoPannerNodeRenderer);\n            this._pan = createAudioParam(this, isOffline, nativeStereoPannerNode.pan);\n        }\n        get pan() {\n            return this._pan;\n        }\n    };\n};\n//# sourceMappingURL=stereo-panner-node-constructor.js.map","import { isNativeAudioNodeFaker } from '../guards/native-audio-node-faker';\nimport { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createStereoPannerNodeRendererFactory = (connectAudioParam, createNativeStereoPannerNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeStereoPannerNodes = new WeakMap();\n        const createStereoPannerNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeStereoPannerNode = getNativeAudioNode(proxy);\n            /*\n             * If the initially used nativeStereoPannerNode was not constructed on the same OfflineAudioContext it needs to be created\n             * again.\n             */\n            const nativeStereoPannerNodeIsOwnedByContext = isOwnedByContext(nativeStereoPannerNode, nativeOfflineAudioContext);\n            if (!nativeStereoPannerNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeStereoPannerNode.channelCount,\n                    channelCountMode: nativeStereoPannerNode.channelCountMode,\n                    channelInterpretation: nativeStereoPannerNode.channelInterpretation,\n                    pan: nativeStereoPannerNode.pan.value\n                };\n                nativeStereoPannerNode = createNativeStereoPannerNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeStereoPannerNodes.set(nativeOfflineAudioContext, nativeStereoPannerNode);\n            if (!nativeStereoPannerNodeIsOwnedByContext) {\n                await renderAutomation(nativeOfflineAudioContext, proxy.pan, nativeStereoPannerNode.pan);\n            }\n            else {\n                await connectAudioParam(nativeOfflineAudioContext, proxy.pan, nativeStereoPannerNode.pan);\n            }\n            if (isNativeAudioNodeFaker(nativeStereoPannerNode)) {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeStereoPannerNode.inputs[0]);\n            }\n            else {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeStereoPannerNode);\n            }\n            return nativeStereoPannerNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeStereoPannerNode = renderedNativeStereoPannerNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeStereoPannerNode !== undefined) {\n                    return Promise.resolve(renderedNativeStereoPannerNode);\n                }\n                return createStereoPannerNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=stereo-panner-node-renderer-factory.js.map","// Bug #33: Safari exposes an AudioBuffer but it can't be used as a constructor.\nexport const createTestAudioBufferConstructorSupport = (nativeAudioBufferConstructor) => {\n    return () => {\n        if (nativeAudioBufferConstructor === null) {\n            return false;\n        }\n        try {\n            new nativeAudioBufferConstructor({ length: 1, sampleRate: 44100 }); // tslint:disable-line:no-unused-expression\n        }\n        catch {\n            return false;\n        }\n        return true;\n    };\n};\n//# sourceMappingURL=test-audio-buffer-constructor-support.js.map","// Bug #179: Firefox does not allow to transfer any buffer which has been passed to the process() method as an argument.\nexport const createTestAudioWorkletProcessorPostMessageSupport = (nativeAudioWorkletNodeConstructor, nativeOfflineAudioContextConstructor) => {\n    return async () => {\n        // Bug #61: If there is no native AudioWorkletNode it gets faked and therefore it is no problem if the it doesn't exist.\n        if (nativeAudioWorkletNodeConstructor === null) {\n            return true;\n        }\n        if (nativeOfflineAudioContextConstructor === null) {\n            return false;\n        }\n        const blob = new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor(\"a\",A)'], {\n            type: 'application/javascript; charset=utf-8'\n        });\n        // Bug #141: Safari does not support creating an OfflineAudioContext with less than 44100 Hz.\n        const offlineAudioContext = new nativeOfflineAudioContextConstructor(1, 128, 44100);\n        const url = URL.createObjectURL(blob);\n        let isEmittingMessageEvents = false;\n        let isEmittingProcessorErrorEvents = false;\n        try {\n            await offlineAudioContext.audioWorklet.addModule(url);\n            const audioWorkletNode = new nativeAudioWorkletNodeConstructor(offlineAudioContext, 'a', { numberOfOutputs: 0 });\n            const oscillator = offlineAudioContext.createOscillator();\n            audioWorkletNode.port.onmessage = () => (isEmittingMessageEvents = true);\n            audioWorkletNode.onprocessorerror = () => (isEmittingProcessorErrorEvents = true);\n            oscillator.connect(audioWorkletNode);\n            oscillator.start(0);\n            await offlineAudioContext.startRendering();\n            // Bug #197: Safari does not deliver the messages before the promise returned by startRendering() resolves.\n            await new Promise((resolve) => setTimeout(resolve));\n        }\n        catch {\n            // Ignore errors.\n        }\n        finally {\n            URL.revokeObjectURL(url);\n        }\n        return isEmittingMessageEvents && !isEmittingProcessorErrorEvents;\n    };\n};\n//# sourceMappingURL=test-audio-worklet-processor-post-message-support.js.map","export const createTestOfflineAudioContextCurrentTimeSupport = (createNativeGainNode, nativeOfflineAudioContextConstructor) => {\n    return () => {\n        if (nativeOfflineAudioContextConstructor === null) {\n            return Promise.resolve(false);\n        }\n        const nativeOfflineAudioContext = new nativeOfflineAudioContextConstructor(1, 1, 44100);\n        // Bug #48: Safari does not render an OfflineAudioContext without any connected node.\n        const gainNode = createNativeGainNode(nativeOfflineAudioContext, {\n            channelCount: 1,\n            channelCountMode: 'explicit',\n            channelInterpretation: 'discrete',\n            gain: 0\n        });\n        // Bug #21: Safari does not support promises yet.\n        return new Promise((resolve) => {\n            nativeOfflineAudioContext.oncomplete = () => {\n                gainNode.disconnect();\n                resolve(nativeOfflineAudioContext.currentTime !== 0);\n            };\n            nativeOfflineAudioContext.startRendering();\n        });\n    };\n};\n//# sourceMappingURL=test-offline-audio-context-current-time-support.js.map","export const createUnknownError = () => new DOMException('', 'UnknownError');\n//# sourceMappingURL=unknown-error.js.map","const DEFAULT_OPTIONS = {\n    channelCount: 2,\n    channelCountMode: 'max',\n    channelInterpretation: 'speakers',\n    curve: null,\n    oversample: 'none'\n};\nexport const createWaveShaperNodeConstructor = (audioNodeConstructor, createInvalidStateError, createNativeWaveShaperNode, createWaveShaperNodeRenderer, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime) => {\n    return class WaveShaperNode extends audioNodeConstructor {\n        constructor(context, options) {\n            const nativeContext = getNativeContext(context);\n            const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n            const nativeWaveShaperNode = createNativeWaveShaperNode(nativeContext, mergedOptions);\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            const waveShaperNodeRenderer = (isOffline ? createWaveShaperNodeRenderer() : null);\n            // @todo Add a mechanism to only switch a WaveShaperNode to active while it is connected.\n            super(context, true, nativeWaveShaperNode, waveShaperNodeRenderer);\n            this._isCurveNullified = false;\n            this._nativeWaveShaperNode = nativeWaveShaperNode;\n            // @todo Determine a meaningful tail-time instead of just using one second.\n            setAudioNodeTailTime(this, 1);\n        }\n        get curve() {\n            if (this._isCurveNullified) {\n                return null;\n            }\n            return this._nativeWaveShaperNode.curve;\n        }\n        set curve(value) {\n            // Bug #103: Safari does not allow to set the curve to null.\n            if (value === null) {\n                this._isCurveNullified = true;\n                this._nativeWaveShaperNode.curve = new Float32Array([0, 0]);\n            }\n            else {\n                // Bug #102: Safari does not throw an InvalidStateError when the curve has less than two samples.\n                // Bug #104: Chrome and Edge will throw an InvalidAccessError when the curve has less than two samples.\n                if (value.length < 2) {\n                    throw createInvalidStateError();\n                }\n                this._isCurveNullified = false;\n                this._nativeWaveShaperNode.curve = value;\n            }\n        }\n        get oversample() {\n            return this._nativeWaveShaperNode.oversample;\n        }\n        set oversample(value) {\n            this._nativeWaveShaperNode.oversample = value;\n        }\n    };\n};\n//# sourceMappingURL=wave-shaper-node-constructor.js.map","import { isNativeAudioNodeFaker } from '../guards/native-audio-node-faker';\nimport { isOwnedByContext } from '../helpers/is-owned-by-context';\nexport const createWaveShaperNodeRendererFactory = (createNativeWaveShaperNode, getNativeAudioNode, renderInputsOfAudioNode) => {\n    return () => {\n        const renderedNativeWaveShaperNodes = new WeakMap();\n        const createWaveShaperNode = async (proxy, nativeOfflineAudioContext) => {\n            let nativeWaveShaperNode = getNativeAudioNode(proxy);\n            // If the initially used nativeWaveShaperNode was not constructed on the same OfflineAudioContext it needs to be created again.\n            const nativeWaveShaperNodeIsOwnedByContext = isOwnedByContext(nativeWaveShaperNode, nativeOfflineAudioContext);\n            if (!nativeWaveShaperNodeIsOwnedByContext) {\n                const options = {\n                    channelCount: nativeWaveShaperNode.channelCount,\n                    channelCountMode: nativeWaveShaperNode.channelCountMode,\n                    channelInterpretation: nativeWaveShaperNode.channelInterpretation,\n                    curve: nativeWaveShaperNode.curve,\n                    oversample: nativeWaveShaperNode.oversample\n                };\n                nativeWaveShaperNode = createNativeWaveShaperNode(nativeOfflineAudioContext, options);\n            }\n            renderedNativeWaveShaperNodes.set(nativeOfflineAudioContext, nativeWaveShaperNode);\n            if (isNativeAudioNodeFaker(nativeWaveShaperNode)) {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeWaveShaperNode.inputs[0]);\n            }\n            else {\n                await renderInputsOfAudioNode(proxy, nativeOfflineAudioContext, nativeWaveShaperNode);\n            }\n            return nativeWaveShaperNode;\n        };\n        return {\n            render(proxy, nativeOfflineAudioContext) {\n                const renderedNativeWaveShaperNode = renderedNativeWaveShaperNodes.get(nativeOfflineAudioContext);\n                if (renderedNativeWaveShaperNode !== undefined) {\n                    return Promise.resolve(renderedNativeWaveShaperNode);\n                }\n                return createWaveShaperNode(proxy, nativeOfflineAudioContext);\n            }\n        };\n    };\n};\n//# sourceMappingURL=wave-shaper-node-renderer-factory.js.map","export const createWindow = () => (typeof window === 'undefined' ? null : window);\n//# sourceMappingURL=window.js.map","export const createWrapAudioBufferCopyChannelMethods = (convertNumberToUnsignedLong, createIndexSizeError) => {\n    return (audioBuffer) => {\n        audioBuffer.copyFromChannel = (destination, channelNumberAsNumber, bufferOffsetAsNumber = 0) => {\n            const bufferOffset = convertNumberToUnsignedLong(bufferOffsetAsNumber);\n            const channelNumber = convertNumberToUnsignedLong(channelNumberAsNumber);\n            if (channelNumber >= audioBuffer.numberOfChannels) {\n                throw createIndexSizeError();\n            }\n            const audioBufferLength = audioBuffer.length;\n            const channelData = audioBuffer.getChannelData(channelNumber);\n            const destinationLength = destination.length;\n            for (let i = bufferOffset < 0 ? -bufferOffset : 0; i + bufferOffset < audioBufferLength && i < destinationLength; i += 1) {\n                destination[i] = channelData[i + bufferOffset];\n            }\n        };\n        audioBuffer.copyToChannel = (source, channelNumberAsNumber, bufferOffsetAsNumber = 0) => {\n            const bufferOffset = convertNumberToUnsignedLong(bufferOffsetAsNumber);\n            const channelNumber = convertNumberToUnsignedLong(channelNumberAsNumber);\n            if (channelNumber >= audioBuffer.numberOfChannels) {\n                throw createIndexSizeError();\n            }\n            const audioBufferLength = audioBuffer.length;\n            const channelData = audioBuffer.getChannelData(channelNumber);\n            const sourceLength = source.length;\n            for (let i = bufferOffset < 0 ? -bufferOffset : 0; i + bufferOffset < audioBufferLength && i < sourceLength; i += 1) {\n                channelData[i + bufferOffset] = source[i];\n            }\n        };\n    };\n};\n//# sourceMappingURL=wrap-audio-buffer-copy-channel-methods.js.map","export const createWrapAudioBufferCopyChannelMethodsOutOfBounds = (convertNumberToUnsignedLong) => {\n    return (audioBuffer) => {\n        audioBuffer.copyFromChannel = ((copyFromChannel) => {\n            return (destination, channelNumberAsNumber, bufferOffsetAsNumber = 0) => {\n                const bufferOffset = convertNumberToUnsignedLong(bufferOffsetAsNumber);\n                const channelNumber = convertNumberToUnsignedLong(channelNumberAsNumber);\n                if (bufferOffset < audioBuffer.length) {\n                    return copyFromChannel.call(audioBuffer, destination, channelNumber, bufferOffset);\n                }\n            };\n        })(audioBuffer.copyFromChannel);\n        audioBuffer.copyToChannel = ((copyToChannel) => {\n            return (source, channelNumberAsNumber, bufferOffsetAsNumber = 0) => {\n                const bufferOffset = convertNumberToUnsignedLong(bufferOffsetAsNumber);\n                const channelNumber = convertNumberToUnsignedLong(channelNumberAsNumber);\n                if (bufferOffset < audioBuffer.length) {\n                    return copyToChannel.call(audioBuffer, source, channelNumber, bufferOffset);\n                }\n            };\n        })(audioBuffer.copyToChannel);\n    };\n};\n//# sourceMappingURL=wrap-audio-buffer-copy-channel-methods-out-of-bounds.js.map","export const createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer = (overwriteAccessors) => {\n    return (nativeAudioBufferSourceNode, nativeContext) => {\n        const nullifiedBuffer = nativeContext.createBuffer(1, 1, 44100);\n        if (nativeAudioBufferSourceNode.buffer === null) {\n            nativeAudioBufferSourceNode.buffer = nullifiedBuffer;\n        }\n        overwriteAccessors(nativeAudioBufferSourceNode, 'buffer', (get) => () => {\n            const value = get.call(nativeAudioBufferSourceNode);\n            return value === nullifiedBuffer ? null : value;\n        }, (set) => (value) => {\n            return set.call(nativeAudioBufferSourceNode, value === null ? nullifiedBuffer : value);\n        });\n    };\n};\n//# sourceMappingURL=wrap-audio-buffer-source-node-stop-method-nullified-buffer.js.map","export const createWrapChannelMergerNode = (createInvalidStateError, monitorConnections) => {\n    return (nativeContext, channelMergerNode) => {\n        // Bug #15: Safari does not return the default properties.\n        channelMergerNode.channelCount = 1;\n        channelMergerNode.channelCountMode = 'explicit';\n        // Bug #16: Safari does not throw an error when setting a different channelCount or channelCountMode.\n        Object.defineProperty(channelMergerNode, 'channelCount', {\n            get: () => 1,\n            set: () => {\n                throw createInvalidStateError();\n            }\n        });\n        Object.defineProperty(channelMergerNode, 'channelCountMode', {\n            get: () => 'explicit',\n            set: () => {\n                throw createInvalidStateError();\n            }\n        });\n        // Bug #20: Safari requires a connection of any kind to treat the input signal correctly.\n        const audioBufferSourceNode = nativeContext.createBufferSource();\n        const whenConnected = () => {\n            const length = channelMergerNode.numberOfInputs;\n            for (let i = 0; i < length; i += 1) {\n                audioBufferSourceNode.connect(channelMergerNode, 0, i);\n            }\n        };\n        const whenDisconnected = () => audioBufferSourceNode.disconnect(channelMergerNode);\n        monitorConnections(channelMergerNode, whenConnected, whenDisconnected);\n    };\n};\n//# sourceMappingURL=wrap-channel-merger-node.js.map","export const getFirstSample = (audioBuffer, buffer, channelNumber) => {\n    // Bug #5: Safari does not support copyFromChannel() and copyToChannel().\n    if (audioBuffer.copyFromChannel === undefined) {\n        return audioBuffer.getChannelData(channelNumber)[0];\n    }\n    audioBuffer.copyFromChannel(buffer, channelNumber);\n    return buffer[0];\n};\n//# sourceMappingURL=get-first-sample.js.map","export const isDCCurve = (curve) => {\n    if (curve === null) {\n        return false;\n    }\n    const length = curve.length;\n    if (length % 2 !== 0) {\n        return curve[Math.floor(length / 2)] !== 0;\n    }\n    return curve[length / 2 - 1] + curve[length / 2] !== 0;\n};\n//# sourceMappingURL=is-dc-curve.js.map","export const overwriteAccessors = (object, property, createGetter, createSetter) => {\n    let prototype = object;\n    while (!prototype.hasOwnProperty(property)) {\n        prototype = Object.getPrototypeOf(prototype);\n    }\n    const { get, set } = Object.getOwnPropertyDescriptor(prototype, property);\n    Object.defineProperty(object, property, { get: createGetter(get), set: createSetter(set) });\n};\n//# sourceMappingURL=overwrite-accessors.js.map","export const sanitizeAudioWorkletNodeOptions = (options) => {\n    return {\n        ...options,\n        outputChannelCount: options.outputChannelCount !== undefined\n            ? options.outputChannelCount\n            : options.numberOfInputs === 1 && options.numberOfOutputs === 1\n                ? /*\n                   * Bug #61: This should be the computedNumberOfChannels, but unfortunately that is almost impossible to fake. That's why\n                   * the channelCountMode is required to be 'explicit' as long as there is not a native implementation in every browser. That\n                   * makes sure the computedNumberOfChannels is equivilant to the channelCount which makes it much easier to compute.\n                   */\n                    [options.channelCount]\n                : Array.from({ length: options.numberOfOutputs }, () => 1)\n    };\n};\n//# sourceMappingURL=sanitize-audio-worklet-node-options.js.map","export const sanitizeChannelSplitterOptions = (options) => {\n    return { ...options, channelCount: options.numberOfOutputs };\n};\n//# sourceMappingURL=sanitize-channel-splitter-options.js.map","export const sanitizePeriodicWaveOptions = (options) => {\n    const { imag, real } = options;\n    if (imag === undefined) {\n        if (real === undefined) {\n            return { ...options, imag: [0, 0], real: [0, 0] };\n        }\n        return { ...options, imag: Array.from(real, () => 0), real };\n    }\n    if (real === undefined) {\n        return { ...options, imag, real: Array.from(imag, () => 0) };\n    }\n    return { ...options, imag, real };\n};\n//# sourceMappingURL=sanitize-periodic-wave-options.js.map","export const setValueAtTimeUntilPossible = (audioParam, value, startTime) => {\n    try {\n        audioParam.setValueAtTime(value, startTime);\n    }\n    catch (err) {\n        if (err.code !== 9) {\n            throw err;\n        }\n        setValueAtTimeUntilPossible(audioParam, value, startTime + 1e-7);\n    }\n};\n//# sourceMappingURL=set-value-at-time-until-possible.js.map","export const testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport = (nativeContext) => {\n    const nativeAudioBufferSourceNode = nativeContext.createBufferSource();\n    nativeAudioBufferSourceNode.start();\n    try {\n        nativeAudioBufferSourceNode.start();\n    }\n    catch {\n        return true;\n    }\n    return false;\n};\n//# sourceMappingURL=test-audio-buffer-source-node-start-method-consecutive-calls-support.js.map","export const testAudioBufferSourceNodeStartMethodOffsetClampingSupport = (nativeContext) => {\n    const nativeAudioBufferSourceNode = nativeContext.createBufferSource();\n    const nativeAudioBuffer = nativeContext.createBuffer(1, 1, 44100);\n    nativeAudioBufferSourceNode.buffer = nativeAudioBuffer;\n    try {\n        nativeAudioBufferSourceNode.start(0, 1);\n    }\n    catch {\n        return false;\n    }\n    return true;\n};\n//# sourceMappingURL=test-audio-buffer-source-node-start-method-offset-clamping-support.js.map","export const testAudioBufferSourceNodeStopMethodNullifiedBufferSupport = (nativeContext) => {\n    const nativeAudioBufferSourceNode = nativeContext.createBufferSource();\n    nativeAudioBufferSourceNode.start();\n    try {\n        nativeAudioBufferSourceNode.stop();\n    }\n    catch {\n        return false;\n    }\n    return true;\n};\n//# sourceMappingURL=test-audio-buffer-source-node-stop-method-nullified-buffer-support.js.map","export const testAudioScheduledSourceNodeStartMethodNegativeParametersSupport = (nativeContext) => {\n    const nativeAudioBufferSourceNode = nativeContext.createOscillator();\n    try {\n        nativeAudioBufferSourceNode.start(-1);\n    }\n    catch (err) {\n        return err instanceof RangeError;\n    }\n    return false;\n};\n//# sourceMappingURL=test-audio-scheduled-source-node-start-method-negative-parameters-support.js.map","export const testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport = (nativeContext) => {\n    const nativeAudioBuffer = nativeContext.createBuffer(1, 1, 44100);\n    const nativeAudioBufferSourceNode = nativeContext.createBufferSource();\n    nativeAudioBufferSourceNode.buffer = nativeAudioBuffer;\n    nativeAudioBufferSourceNode.start();\n    nativeAudioBufferSourceNode.stop();\n    try {\n        nativeAudioBufferSourceNode.stop();\n        return true;\n    }\n    catch {\n        return false;\n    }\n};\n//# sourceMappingURL=test-audio-scheduled-source-node-stop-method-consecutive-calls-support.js.map","export const testAudioScheduledSourceNodeStopMethodNegativeParametersSupport = (nativeContext) => {\n    const nativeAudioBufferSourceNode = nativeContext.createOscillator();\n    try {\n        nativeAudioBufferSourceNode.stop(-1);\n    }\n    catch (err) {\n        return err instanceof RangeError;\n    }\n    return false;\n};\n//# sourceMappingURL=test-audio-scheduled-source-node-stop-method-negative-parameters-support.js.map","export const testAudioWorkletNodeOptionsClonability = (audioWorkletNodeOptions) => {\n    const { port1, port2 } = new MessageChannel();\n    try {\n        // This will throw an error if the audioWorkletNodeOptions are not clonable.\n        port1.postMessage(audioWorkletNodeOptions);\n    }\n    finally {\n        port1.close();\n        port2.close();\n    }\n};\n//# sourceMappingURL=test-audio-worklet-node-options-clonability.js.map","export const wrapAudioBufferSourceNodeStartMethodOffsetClamping = (nativeAudioBufferSourceNode) => {\n    nativeAudioBufferSourceNode.start = ((start) => {\n        return (when = 0, offset = 0, duration) => {\n            const buffer = nativeAudioBufferSourceNode.buffer;\n            // Bug #154: Safari does not clamp the offset if it is equal to or greater than the duration of the buffer.\n            const clampedOffset = buffer === null ? offset : Math.min(buffer.duration, offset);\n            // Bug #155: Safari does not handle the offset correctly if it would cause the buffer to be not be played at all.\n            if (buffer !== null && clampedOffset > buffer.duration - 0.5 / nativeAudioBufferSourceNode.context.sampleRate) {\n                start.call(nativeAudioBufferSourceNode, when, 0, 0);\n            }\n            else {\n                start.call(nativeAudioBufferSourceNode, when, clampedOffset, duration);\n            }\n        };\n    })(nativeAudioBufferSourceNode.start);\n};\n//# sourceMappingURL=wrap-audio-buffer-source-node-start-method-offset-clamping.js.map","import { interceptConnections } from './intercept-connections';\nexport const wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls = (nativeAudioScheduledSourceNode, nativeContext) => {\n    const nativeGainNode = nativeContext.createGain();\n    nativeAudioScheduledSourceNode.connect(nativeGainNode);\n    const disconnectGainNode = ((disconnect) => {\n        return () => {\n            // @todo TypeScript cannot infer the overloaded signature with 1 argument yet.\n            disconnect.call(nativeAudioScheduledSourceNode, nativeGainNode);\n            nativeAudioScheduledSourceNode.removeEventListener('ended', disconnectGainNode);\n        };\n    })(nativeAudioScheduledSourceNode.disconnect);\n    nativeAudioScheduledSourceNode.addEventListener('ended', disconnectGainNode);\n    interceptConnections(nativeAudioScheduledSourceNode, nativeGainNode);\n    nativeAudioScheduledSourceNode.stop = ((stop) => {\n        let isStopped = false;\n        return (when = 0) => {\n            if (isStopped) {\n                try {\n                    stop.call(nativeAudioScheduledSourceNode, when);\n                }\n                catch {\n                    nativeGainNode.gain.setValueAtTime(0, when);\n                }\n            }\n            else {\n                stop.call(nativeAudioScheduledSourceNode, when);\n                isStopped = true;\n            }\n        };\n    })(nativeAudioScheduledSourceNode.stop);\n};\n//# sourceMappingURL=wrap-audio-scheduled-source-node-stop-method-consecutive-calls.js.map","export const wrapEventListener = (target, eventListener) => {\n    return (event) => {\n        const descriptor = { value: target };\n        Object.defineProperties(event, {\n            currentTarget: descriptor,\n            target: descriptor\n        });\n        if (typeof eventListener === 'function') {\n            return eventListener.call(target, event);\n        }\n        return eventListener.handleEvent.call(target, event);\n    };\n};\n//# sourceMappingURL=wrap-event-listener.js.map","import { createCancelAndHoldAutomationEvent, createCancelScheduledValuesAutomationEvent, createExponentialRampToValueAutomationEvent, createLinearRampToValueAutomationEvent, createSetTargetAutomationEvent, createSetValueAutomationEvent, createSetValueCurveAutomationEvent } from 'automation-events';\nimport { createAbortError } from './factories/abort-error';\nimport { createAddActiveInputConnectionToAudioNode } from './factories/add-active-input-connection-to-audio-node';\nimport { createAddAudioNodeConnections } from './factories/add-audio-node-connections';\nimport { createAddAudioParamConnections } from './factories/add-audio-param-connections';\nimport { createAddAudioWorkletModule } from './factories/add-audio-worklet-module';\nimport { createAddConnectionToAudioNode } from './factories/add-connection-to-audio-node';\nimport { createAddPassiveInputConnectionToAudioNode } from './factories/add-passive-input-connection-to-audio-node';\nimport { createAddSilentConnection } from './factories/add-silent-connection';\nimport { createAddUnrenderedAudioWorkletNode } from './factories/add-unrendered-audio-worklet-node';\nimport { createAnalyserNodeConstructor } from './factories/analyser-node-constructor';\nimport { createAnalyserNodeRendererFactory } from './factories/analyser-node-renderer-factory';\nimport { createAudioBufferConstructor } from './factories/audio-buffer-constructor';\nimport { createAudioBufferSourceNodeConstructor } from './factories/audio-buffer-source-node-constructor';\nimport { createAudioBufferSourceNodeRendererFactory } from './factories/audio-buffer-source-node-renderer-factory';\nimport { createAudioContextConstructor } from './factories/audio-context-constructor';\nimport { createAudioDestinationNodeConstructor } from './factories/audio-destination-node-constructor';\nimport { createAudioDestinationNodeRenderer } from './factories/audio-destination-node-renderer-factory';\nimport { createAudioListenerFactory } from './factories/audio-listener-factory';\nimport { createAudioNodeConstructor } from './factories/audio-node-constructor';\nimport { createAudioParamFactory } from './factories/audio-param-factory';\nimport { createAudioParamRenderer } from './factories/audio-param-renderer';\nimport { createAudioWorkletNodeConstructor } from './factories/audio-worklet-node-constructor';\nimport { createAudioWorkletNodeRendererFactory } from './factories/audio-worklet-node-renderer-factory';\nimport { createBaseAudioContextConstructor } from './factories/base-audio-context-constructor';\nimport { createBiquadFilterNodeConstructor } from './factories/biquad-filter-node-constructor';\nimport { createBiquadFilterNodeRendererFactory } from './factories/biquad-filter-node-renderer-factory';\nimport { createCacheTestResult } from './factories/cache-test-result';\nimport { createChannelMergerNodeConstructor } from './factories/channel-merger-node-constructor';\nimport { createChannelMergerNodeRendererFactory } from './factories/channel-merger-node-renderer-factory';\nimport { createChannelSplitterNodeConstructor } from './factories/channel-splitter-node-constructor';\nimport { createChannelSplitterNodeRendererFactory } from './factories/channel-splitter-node-renderer-factory';\nimport { createConnectAudioParam } from './factories/connect-audio-param';\nimport { createConnectMultipleOutputs } from './factories/connect-multiple-outputs';\nimport { createConnectedNativeAudioBufferSourceNodeFactory } from './factories/connected-native-audio-buffer-source-node-factory';\nimport { createConstantSourceNodeConstructor } from './factories/constant-source-node-constructor';\nimport { createConstantSourceNodeRendererFactory } from './factories/constant-source-node-renderer-factory';\nimport { createConvertNumberToUnsignedLong } from './factories/convert-number-to-unsigned-long';\nimport { createConvolverNodeConstructor } from './factories/convolver-node-constructor';\nimport { createConvolverNodeRendererFactory } from './factories/convolver-node-renderer-factory';\nimport { createCreateNativeOfflineAudioContext } from './factories/create-native-offline-audio-context';\nimport { createDataCloneError } from './factories/data-clone-error';\nimport { createDecodeAudioData } from './factories/decode-audio-data';\nimport { createDecrementCycleCounter } from './factories/decrement-cycle-counter';\nimport { createDelayNodeConstructor } from './factories/delay-node-constructor';\nimport { createDelayNodeRendererFactory } from './factories/delay-node-renderer-factory';\nimport { createDeleteActiveInputConnectionToAudioNode } from './factories/delete-active-input-connection-to-audio-node';\nimport { createDeleteUnrenderedAudioWorkletNode } from './factories/delete-unrendered-audio-worklet-node';\nimport { createDetectCycles } from './factories/detect-cycles';\nimport { createDisconnectMultipleOutputs } from './factories/disconnect-multiple-outputs';\nimport { createDynamicsCompressorNodeConstructor } from './factories/dynamics-compressor-node-constructor';\nimport { createDynamicsCompressorNodeRendererFactory } from './factories/dynamics-compressor-node-renderer-factory';\nimport { createEncodingError } from './factories/encoding-error';\nimport { createEvaluateSource } from './factories/evaluate-source';\nimport { createEventTargetConstructor } from './factories/event-target-constructor';\nimport { createExposeCurrentFrameAndCurrentTime } from './factories/expose-current-frame-and-current-time';\nimport { createFetchSource } from './factories/fetch-source';\nimport { createGainNodeConstructor } from './factories/gain-node-constructor';\nimport { createGainNodeRendererFactory } from './factories/gain-node-renderer-factory';\nimport { createGetActiveAudioWorkletNodeInputs } from './factories/get-active-audio-worklet-node-inputs';\nimport { createGetAudioNodeRenderer } from './factories/get-audio-node-renderer';\nimport { createGetAudioNodeTailTime } from './factories/get-audio-node-tail-time';\nimport { createGetAudioParamRenderer } from './factories/get-audio-param-renderer';\nimport { createGetBackupOfflineAudioContext } from './factories/get-backup-offline-audio-context';\nimport { createGetNativeContext } from './factories/get-native-context';\nimport { createGetOrCreateBackupOfflineAudioContext } from './factories/get-or-create-backup-offline-audio-context';\nimport { createGetUnrenderedAudioWorkletNodes } from './factories/get-unrendered-audio-worklet-nodes';\nimport { createIIRFilterNodeConstructor } from './factories/iir-filter-node-constructor';\nimport { createIIRFilterNodeRendererFactory } from './factories/iir-filter-node-renderer-factory';\nimport { createIncrementCycleCounterFactory } from './factories/increment-cycle-counter-factory';\nimport { createIndexSizeError } from './factories/index-size-error';\nimport { createInvalidAccessError } from './factories/invalid-access-error';\nimport { createInvalidStateError } from './factories/invalid-state-error';\nimport { createIsAnyAudioContext } from './factories/is-any-audio-context';\nimport { createIsAnyAudioNode } from './factories/is-any-audio-node';\nimport { createIsAnyAudioParam } from './factories/is-any-audio-param';\nimport { createIsAnyOfflineAudioContext } from './factories/is-any-offline-audio-context';\nimport { createIsNativeAudioContext } from './factories/is-native-audio-context';\nimport { createIsNativeAudioNode } from './factories/is-native-audio-node';\nimport { createIsNativeAudioParam } from './factories/is-native-audio-param';\nimport { createIsNativeContext } from './factories/is-native-context';\nimport { createIsNativeOfflineAudioContext } from './factories/is-native-offline-audio-context';\nimport { createIsSecureContext } from './factories/is-secure-context';\nimport { createIsSupportedPromise } from './factories/is-supported-promise';\nimport { createMediaElementAudioSourceNodeConstructor } from './factories/media-element-audio-source-node-constructor';\nimport { createMediaStreamAudioDestinationNodeConstructor } from './factories/media-stream-audio-destination-node-constructor';\nimport { createMediaStreamAudioSourceNodeConstructor } from './factories/media-stream-audio-source-node-constructor';\nimport { createMediaStreamTrackAudioSourceNodeConstructor } from './factories/media-stream-track-audio-source-node-constructor';\nimport { createMinimalAudioContextConstructor } from './factories/minimal-audio-context-constructor';\nimport { createMinimalBaseAudioContextConstructor } from './factories/minimal-base-audio-context-constructor';\nimport { createMinimalOfflineAudioContextConstructor } from './factories/minimal-offline-audio-context-constructor';\nimport { createMonitorConnections } from './factories/monitor-connections';\nimport { createNativeAnalyserNodeFactory } from './factories/native-analyser-node-factory';\nimport { createNativeAudioBufferConstructor } from './factories/native-audio-buffer-constructor';\nimport { createNativeAudioBufferSourceNodeFactory } from './factories/native-audio-buffer-source-node-factory';\nimport { createNativeAudioContextConstructor } from './factories/native-audio-context-constructor';\nimport { createNativeAudioDestinationNodeFactory } from './factories/native-audio-destination-node';\nimport { createNativeAudioWorkletNodeConstructor } from './factories/native-audio-worklet-node-constructor';\nimport { createNativeAudioWorkletNodeFactory } from './factories/native-audio-worklet-node-factory';\nimport { createNativeAudioWorkletNodeFakerFactory } from './factories/native-audio-worklet-node-faker-factory';\nimport { createNativeBiquadFilterNode } from './factories/native-biquad-filter-node';\nimport { createNativeChannelMergerNodeFactory } from './factories/native-channel-merger-node-factory';\nimport { createNativeChannelSplitterNode } from './factories/native-channel-splitter-node';\nimport { createNativeConstantSourceNodeFactory } from './factories/native-constant-source-node-factory';\nimport { createNativeConstantSourceNodeFakerFactory } from './factories/native-constant-source-node-faker-factory';\nimport { createNativeConvolverNodeFactory } from './factories/native-convolver-node-factory';\nimport { createNativeDelayNode } from './factories/native-delay-node';\nimport { createNativeDynamicsCompressorNodeFactory } from './factories/native-dynamics-compressor-node-factory';\nimport { createNativeGainNode } from './factories/native-gain-node';\nimport { createNativeIIRFilterNodeFactory } from './factories/native-iir-filter-node-factory';\nimport { createNativeIIRFilterNodeFakerFactory } from './factories/native-iir-filter-node-faker-factory';\nimport { createNativeMediaElementAudioSourceNode } from './factories/native-media-element-audio-source-node';\nimport { createNativeMediaStreamAudioDestinationNode } from './factories/native-media-stream-audio-destination-node';\nimport { createNativeMediaStreamAudioSourceNode } from './factories/native-media-stream-audio-source-node';\nimport { createNativeMediaStreamTrackAudioSourceNodeFactory } from './factories/native-media-stream-track-audio-source-node-factory';\nimport { createNativeOfflineAudioContextConstructor } from './factories/native-offline-audio-context-constructor';\nimport { createNativeOscillatorNodeFactory } from './factories/native-oscillator-node-factory';\nimport { createNativePannerNodeFactory } from './factories/native-panner-node-factory';\nimport { createNativePannerNodeFakerFactory } from './factories/native-panner-node-faker-factory';\nimport { createNativePeriodicWaveFactory } from './factories/native-periodic-wave-factory';\nimport { createNativeScriptProcessorNode } from './factories/native-script-processor-node';\nimport { createNativeStereoPannerNodeFactory } from './factories/native-stereo-panner-node-factory';\nimport { createNativeStereoPannerNodeFakerFactory } from './factories/native-stereo-panner-node-faker-factory';\nimport { createNativeWaveShaperNodeFactory } from './factories/native-wave-shaper-node-factory';\nimport { createNativeWaveShaperNodeFakerFactory } from './factories/native-wave-shaper-node-faker-factory';\nimport { createNotSupportedError } from './factories/not-supported-error';\nimport { createOfflineAudioContextConstructor } from './factories/offline-audio-context-constructor';\nimport { createOscillatorNodeConstructor } from './factories/oscillator-node-constructor';\nimport { createOscillatorNodeRendererFactory } from './factories/oscillator-node-renderer-factory';\nimport { createPannerNodeConstructor } from './factories/panner-node-constructor';\nimport { createPannerNodeRendererFactory } from './factories/panner-node-renderer-factory';\nimport { createPeriodicWaveConstructor } from './factories/periodic-wave-constructor';\nimport { createRenderAutomation } from './factories/render-automation';\nimport { createRenderInputsOfAudioNode } from './factories/render-inputs-of-audio-node';\nimport { createRenderInputsOfAudioParam } from './factories/render-inputs-of-audio-param';\nimport { createRenderNativeOfflineAudioContext } from './factories/render-native-offline-audio-context';\nimport { createSetActiveAudioWorkletNodeInputs } from './factories/set-active-audio-worklet-node-inputs';\nimport { createSetAudioNodeTailTime } from './factories/set-audio-node-tail-time';\nimport { createStartRendering } from './factories/start-rendering';\nimport { createStereoPannerNodeConstructor } from './factories/stereo-panner-node-constructor';\nimport { createStereoPannerNodeRendererFactory } from './factories/stereo-panner-node-renderer-factory';\nimport { createTestAudioBufferConstructorSupport } from './factories/test-audio-buffer-constructor-support';\nimport { createTestAudioBufferCopyChannelMethodsSubarraySupport } from './factories/test-audio-buffer-copy-channel-methods-subarray-support';\nimport { createTestAudioContextCloseMethodSupport } from './factories/test-audio-context-close-method-support';\nimport { createTestAudioContextDecodeAudioDataMethodTypeErrorSupport } from './factories/test-audio-context-decode-audio-data-method-type-error-support';\nimport { createTestAudioContextOptionsSupport } from './factories/test-audio-context-options-support';\nimport { createTestAudioNodeConnectMethodSupport } from './factories/test-audio-node-connect-method-support';\nimport { createTestAudioWorkletProcessorNoOutputsSupport } from './factories/test-audio-worklet-processor-no-outputs-support';\nimport { createTestAudioWorkletProcessorPostMessageSupport } from './factories/test-audio-worklet-processor-post-message-support';\nimport { createTestChannelMergerNodeChannelCountSupport } from './factories/test-channel-merger-node-channel-count-support';\nimport { createTestConstantSourceNodeAccurateSchedulingSupport } from './factories/test-constant-source-node-accurate-scheduling-support';\nimport { createTestConvolverNodeBufferReassignabilitySupport } from './factories/test-convolver-node-buffer-reassignability-support';\nimport { createTestConvolverNodeChannelCountSupport } from './factories/test-convolver-node-channel-count-support';\nimport { createTestIsSecureContextSupport } from './factories/test-is-secure-context-support';\nimport { createTestMediaStreamAudioSourceNodeMediaStreamWithoutAudioTrackSupport } from './factories/test-media-stream-audio-source-node-media-stream-without-audio-track-support';\nimport { createTestOfflineAudioContextCurrentTimeSupport } from './factories/test-offline-audio-context-current-time-support';\nimport { createTestStereoPannerNodeDefaultValueSupport } from './factories/test-stereo-panner-node-default-value-support';\nimport { createUnknownError } from './factories/unknown-error';\nimport { createWaveShaperNodeConstructor } from './factories/wave-shaper-node-constructor';\nimport { createWaveShaperNodeRendererFactory } from './factories/wave-shaper-node-renderer-factory';\nimport { createWindow } from './factories/window';\nimport { createWrapAudioBufferCopyChannelMethods } from './factories/wrap-audio-buffer-copy-channel-methods';\nimport { createWrapAudioBufferCopyChannelMethodsOutOfBounds } from './factories/wrap-audio-buffer-copy-channel-methods-out-of-bounds';\nimport { createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer } from './factories/wrap-audio-buffer-source-node-stop-method-nullified-buffer';\nimport { createWrapChannelMergerNode } from './factories/wrap-channel-merger-node';\nimport { AUDIO_NODE_CONNECTIONS_STORE, AUDIO_NODE_STORE, AUDIO_PARAM_CONNECTIONS_STORE, AUDIO_PARAM_STORE, CONTEXT_STORE, CYCLE_COUNTERS } from './globals';\nimport { connectNativeAudioNodeToNativeAudioNode } from './helpers/connect-native-audio-node-to-native-audio-node';\nimport { disconnectNativeAudioNodeFromNativeAudioNode } from './helpers/disconnect-native-audio-node-from-native-audio-node';\nimport { getAudioNodeConnections } from './helpers/get-audio-node-connections';\nimport { getAudioParamConnections } from './helpers/get-audio-param-connections';\nimport { getEventListenersOfAudioNode } from './helpers/get-event-listeners-of-audio-node';\nimport { getFirstSample } from './helpers/get-first-sample';\nimport { getNativeAudioNode } from './helpers/get-native-audio-node';\nimport { getNativeAudioParam } from './helpers/get-native-audio-param';\nimport { getValueForKey } from './helpers/get-value-for-key';\nimport { insertElementInSet } from './helpers/insert-element-in-set';\nimport { isActiveAudioNode } from './helpers/is-active-audio-node';\nimport { isDCCurve } from './helpers/is-dc-curve';\nimport { isPartOfACycle } from './helpers/is-part-of-a-cycle';\nimport { isPassiveAudioNode } from './helpers/is-passive-audio-node';\nimport { overwriteAccessors } from './helpers/overwrite-accessors';\nimport { pickElementFromSet } from './helpers/pick-element-from-set';\nimport { sanitizeAudioWorkletNodeOptions } from './helpers/sanitize-audio-worklet-node-options';\nimport { sanitizeChannelSplitterOptions } from './helpers/sanitize-channel-splitter-options';\nimport { sanitizePeriodicWaveOptions } from './helpers/sanitize-periodic-wave-options';\nimport { setValueAtTimeUntilPossible } from './helpers/set-value-at-time-until-possible';\nimport { testAudioBufferCopyChannelMethodsOutOfBoundsSupport } from './helpers/test-audio-buffer-copy-channel-methods-out-of-bounds-support';\nimport { testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport } from './helpers/test-audio-buffer-source-node-start-method-consecutive-calls-support';\nimport { testAudioBufferSourceNodeStartMethodOffsetClampingSupport } from './helpers/test-audio-buffer-source-node-start-method-offset-clamping-support';\nimport { testAudioBufferSourceNodeStopMethodNullifiedBufferSupport } from './helpers/test-audio-buffer-source-node-stop-method-nullified-buffer-support';\nimport { testAudioScheduledSourceNodeStartMethodNegativeParametersSupport } from './helpers/test-audio-scheduled-source-node-start-method-negative-parameters-support';\nimport { testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport } from './helpers/test-audio-scheduled-source-node-stop-method-consecutive-calls-support';\nimport { testAudioScheduledSourceNodeStopMethodNegativeParametersSupport } from './helpers/test-audio-scheduled-source-node-stop-method-negative-parameters-support';\nimport { testAudioWorkletNodeOptionsClonability } from './helpers/test-audio-worklet-node-options-clonability';\nimport { testDomExceptionConstructorSupport } from './helpers/test-dom-exception-constructor-support';\nimport { testPromiseSupport } from './helpers/test-promise-support';\nimport { testTransferablesSupport } from './helpers/test-transferables-support';\nimport { wrapAudioBufferSourceNodeStartMethodOffsetClamping } from './helpers/wrap-audio-buffer-source-node-start-method-offset-clamping';\nimport { wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls } from './helpers/wrap-audio-scheduled-source-node-stop-method-consecutive-calls';\nimport { wrapEventListener } from './helpers/wrap-event-listener';\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './interfaces/index';\nexport * from './types/index';\nconst addActiveInputConnectionToAudioNode = createAddActiveInputConnectionToAudioNode(insertElementInSet);\nconst addPassiveInputConnectionToAudioNode = createAddPassiveInputConnectionToAudioNode(insertElementInSet);\nconst deleteActiveInputConnectionToAudioNode = createDeleteActiveInputConnectionToAudioNode(pickElementFromSet);\nconst audioNodeTailTimeStore = new WeakMap();\nconst getAudioNodeTailTime = createGetAudioNodeTailTime(audioNodeTailTimeStore);\nconst cacheTestResult = createCacheTestResult(new Map(), new WeakMap());\nconst window = createWindow();\nconst createNativeAnalyserNode = createNativeAnalyserNodeFactory(cacheTestResult, createIndexSizeError);\nconst getAudioNodeRenderer = createGetAudioNodeRenderer(getAudioNodeConnections);\nconst renderInputsOfAudioNode = createRenderInputsOfAudioNode(getAudioNodeConnections, getAudioNodeRenderer, isPartOfACycle);\nconst createAnalyserNodeRenderer = createAnalyserNodeRendererFactory(createNativeAnalyserNode, getNativeAudioNode, renderInputsOfAudioNode);\nconst getNativeContext = createGetNativeContext(CONTEXT_STORE);\nconst nativeOfflineAudioContextConstructor = createNativeOfflineAudioContextConstructor(window);\nconst isNativeOfflineAudioContext = createIsNativeOfflineAudioContext(nativeOfflineAudioContextConstructor);\nconst audioParamAudioNodeStore = new WeakMap();\nconst eventTargetConstructor = createEventTargetConstructor(wrapEventListener);\nconst nativeAudioContextConstructor = createNativeAudioContextConstructor(window);\nconst isNativeAudioContext = createIsNativeAudioContext(nativeAudioContextConstructor);\nconst isNativeAudioNode = createIsNativeAudioNode(window);\nconst isNativeAudioParam = createIsNativeAudioParam(window);\nconst nativeAudioWorkletNodeConstructor = createNativeAudioWorkletNodeConstructor(window);\nconst audioNodeConstructor = createAudioNodeConstructor(createAddAudioNodeConnections(AUDIO_NODE_CONNECTIONS_STORE), createAddConnectionToAudioNode(addActiveInputConnectionToAudioNode, addPassiveInputConnectionToAudioNode, connectNativeAudioNodeToNativeAudioNode, deleteActiveInputConnectionToAudioNode, disconnectNativeAudioNodeFromNativeAudioNode, getAudioNodeConnections, getAudioNodeTailTime, getEventListenersOfAudioNode, getNativeAudioNode, insertElementInSet, isActiveAudioNode, isPartOfACycle, isPassiveAudioNode), cacheTestResult, createIncrementCycleCounterFactory(CYCLE_COUNTERS, disconnectNativeAudioNodeFromNativeAudioNode, getAudioNodeConnections, getNativeAudioNode, getNativeAudioParam, isActiveAudioNode), createIndexSizeError, createInvalidAccessError, createNotSupportedError, createDecrementCycleCounter(connectNativeAudioNodeToNativeAudioNode, CYCLE_COUNTERS, getAudioNodeConnections, getNativeAudioNode, getNativeAudioParam, getNativeContext, isActiveAudioNode, isNativeOfflineAudioContext), createDetectCycles(audioParamAudioNodeStore, getAudioNodeConnections, getValueForKey), eventTargetConstructor, getNativeContext, isNativeAudioContext, isNativeAudioNode, isNativeAudioParam, isNativeOfflineAudioContext, nativeAudioWorkletNodeConstructor);\nconst analyserNodeConstructor = createAnalyserNodeConstructor(audioNodeConstructor, createAnalyserNodeRenderer, createIndexSizeError, createNativeAnalyserNode, getNativeContext, isNativeOfflineAudioContext);\nexport { analyserNodeConstructor as AnalyserNode };\nconst audioBufferStore = new WeakSet();\nconst nativeAudioBufferConstructor = createNativeAudioBufferConstructor(window);\nconst convertNumberToUnsignedLong = createConvertNumberToUnsignedLong(new Uint32Array(1));\nconst wrapAudioBufferCopyChannelMethods = createWrapAudioBufferCopyChannelMethods(convertNumberToUnsignedLong, createIndexSizeError);\nconst wrapAudioBufferCopyChannelMethodsOutOfBounds = createWrapAudioBufferCopyChannelMethodsOutOfBounds(convertNumberToUnsignedLong);\nconst audioBufferConstructor = createAudioBufferConstructor(audioBufferStore, cacheTestResult, createNotSupportedError, nativeAudioBufferConstructor, nativeOfflineAudioContextConstructor, createTestAudioBufferConstructorSupport(nativeAudioBufferConstructor), wrapAudioBufferCopyChannelMethods, wrapAudioBufferCopyChannelMethodsOutOfBounds);\nexport { audioBufferConstructor as AudioBuffer };\nconst addSilentConnection = createAddSilentConnection(createNativeGainNode);\nconst renderInputsOfAudioParam = createRenderInputsOfAudioParam(getAudioNodeRenderer, getAudioParamConnections, isPartOfACycle);\nconst connectAudioParam = createConnectAudioParam(renderInputsOfAudioParam);\nconst createNativeAudioBufferSourceNode = createNativeAudioBufferSourceNodeFactory(addSilentConnection, cacheTestResult, testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport, testAudioBufferSourceNodeStartMethodOffsetClampingSupport, testAudioBufferSourceNodeStopMethodNullifiedBufferSupport, testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport, testAudioScheduledSourceNodeStopMethodNegativeParametersSupport, wrapAudioBufferSourceNodeStartMethodOffsetClamping, createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer(overwriteAccessors), wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls);\nconst renderAutomation = createRenderAutomation(createGetAudioParamRenderer(getAudioParamConnections), renderInputsOfAudioParam);\nconst createAudioBufferSourceNodeRenderer = createAudioBufferSourceNodeRendererFactory(connectAudioParam, createNativeAudioBufferSourceNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode);\nconst createAudioParam = createAudioParamFactory(createAddAudioParamConnections(AUDIO_PARAM_CONNECTIONS_STORE), audioParamAudioNodeStore, AUDIO_PARAM_STORE, createAudioParamRenderer, createCancelAndHoldAutomationEvent, createCancelScheduledValuesAutomationEvent, createExponentialRampToValueAutomationEvent, createLinearRampToValueAutomationEvent, createSetTargetAutomationEvent, createSetValueAutomationEvent, createSetValueCurveAutomationEvent, nativeAudioContextConstructor, setValueAtTimeUntilPossible);\nconst audioBufferSourceNodeConstructor = createAudioBufferSourceNodeConstructor(audioNodeConstructor, createAudioBufferSourceNodeRenderer, createAudioParam, createInvalidStateError, createNativeAudioBufferSourceNode, getNativeContext, isNativeOfflineAudioContext, wrapEventListener);\nexport { audioBufferSourceNodeConstructor as AudioBufferSourceNode };\nconst audioDestinationNodeConstructor = createAudioDestinationNodeConstructor(audioNodeConstructor, createAudioDestinationNodeRenderer, createIndexSizeError, createInvalidStateError, createNativeAudioDestinationNodeFactory(createNativeGainNode, overwriteAccessors), getNativeContext, isNativeOfflineAudioContext, renderInputsOfAudioNode);\nconst createBiquadFilterNodeRenderer = createBiquadFilterNodeRendererFactory(connectAudioParam, createNativeBiquadFilterNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode);\nconst setAudioNodeTailTime = createSetAudioNodeTailTime(audioNodeTailTimeStore);\nconst biquadFilterNodeConstructor = createBiquadFilterNodeConstructor(audioNodeConstructor, createAudioParam, createBiquadFilterNodeRenderer, createInvalidAccessError, createNativeBiquadFilterNode, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime);\nconst monitorConnections = createMonitorConnections(insertElementInSet, isNativeAudioNode);\nconst wrapChannelMergerNode = createWrapChannelMergerNode(createInvalidStateError, monitorConnections);\nconst createNativeChannelMergerNode = createNativeChannelMergerNodeFactory(nativeAudioContextConstructor, wrapChannelMergerNode);\nconst createChannelMergerNodeRenderer = createChannelMergerNodeRendererFactory(createNativeChannelMergerNode, getNativeAudioNode, renderInputsOfAudioNode);\nconst channelMergerNodeConstructor = createChannelMergerNodeConstructor(audioNodeConstructor, createChannelMergerNodeRenderer, createNativeChannelMergerNode, getNativeContext, isNativeOfflineAudioContext);\nconst createChannelSplitterNodeRenderer = createChannelSplitterNodeRendererFactory(createNativeChannelSplitterNode, getNativeAudioNode, renderInputsOfAudioNode);\nconst channelSplitterNodeConstructor = createChannelSplitterNodeConstructor(audioNodeConstructor, createChannelSplitterNodeRenderer, createNativeChannelSplitterNode, getNativeContext, isNativeOfflineAudioContext, sanitizeChannelSplitterOptions);\nconst createNativeConstantSourceNodeFaker = createNativeConstantSourceNodeFakerFactory(addSilentConnection, createNativeAudioBufferSourceNode, createNativeGainNode, monitorConnections);\nconst createNativeConstantSourceNode = createNativeConstantSourceNodeFactory(addSilentConnection, cacheTestResult, createNativeConstantSourceNodeFaker, testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, testAudioScheduledSourceNodeStopMethodNegativeParametersSupport);\nconst createConstantSourceNodeRenderer = createConstantSourceNodeRendererFactory(connectAudioParam, createNativeConstantSourceNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode);\nconst constantSourceNodeConstructor = createConstantSourceNodeConstructor(audioNodeConstructor, createAudioParam, createConstantSourceNodeRenderer, createNativeConstantSourceNode, getNativeContext, isNativeOfflineAudioContext, wrapEventListener);\nconst createNativeConvolverNode = createNativeConvolverNodeFactory(createNotSupportedError, overwriteAccessors);\nconst createConvolverNodeRenderer = createConvolverNodeRendererFactory(createNativeConvolverNode, getNativeAudioNode, renderInputsOfAudioNode);\nconst convolverNodeConstructor = createConvolverNodeConstructor(audioNodeConstructor, createConvolverNodeRenderer, createNativeConvolverNode, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime);\nconst createDelayNodeRenderer = createDelayNodeRendererFactory(connectAudioParam, createNativeDelayNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode);\nconst delayNodeConstructor = createDelayNodeConstructor(audioNodeConstructor, createAudioParam, createDelayNodeRenderer, createNativeDelayNode, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime);\nconst createNativeDynamicsCompressorNode = createNativeDynamicsCompressorNodeFactory(createNotSupportedError);\nconst createDynamicsCompressorNodeRenderer = createDynamicsCompressorNodeRendererFactory(connectAudioParam, createNativeDynamicsCompressorNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode);\nconst dynamicsCompressorNodeConstructor = createDynamicsCompressorNodeConstructor(audioNodeConstructor, createAudioParam, createDynamicsCompressorNodeRenderer, createNativeDynamicsCompressorNode, createNotSupportedError, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime);\nconst createGainNodeRenderer = createGainNodeRendererFactory(connectAudioParam, createNativeGainNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode);\nconst gainNodeConstructor = createGainNodeConstructor(audioNodeConstructor, createAudioParam, createGainNodeRenderer, createNativeGainNode, getNativeContext, isNativeOfflineAudioContext);\nconst createNativeIIRFilterNodeFaker = createNativeIIRFilterNodeFakerFactory(createInvalidAccessError, createInvalidStateError, createNativeScriptProcessorNode, createNotSupportedError);\nconst renderNativeOfflineAudioContext = createRenderNativeOfflineAudioContext(cacheTestResult, createNativeGainNode, createNativeScriptProcessorNode, createTestOfflineAudioContextCurrentTimeSupport(createNativeGainNode, nativeOfflineAudioContextConstructor));\nconst createIIRFilterNodeRenderer = createIIRFilterNodeRendererFactory(createNativeAudioBufferSourceNode, getNativeAudioNode, nativeOfflineAudioContextConstructor, renderInputsOfAudioNode, renderNativeOfflineAudioContext);\nconst createNativeIIRFilterNode = createNativeIIRFilterNodeFactory(createNativeIIRFilterNodeFaker);\nconst iIRFilterNodeConstructor = createIIRFilterNodeConstructor(audioNodeConstructor, createNativeIIRFilterNode, createIIRFilterNodeRenderer, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime);\nconst createAudioListener = createAudioListenerFactory(createAudioParam, createNativeChannelMergerNode, createNativeConstantSourceNode, createNativeScriptProcessorNode, createNotSupportedError, getFirstSample, isNativeOfflineAudioContext, overwriteAccessors);\nconst unrenderedAudioWorkletNodeStore = new WeakMap();\nconst minimalBaseAudioContextConstructor = createMinimalBaseAudioContextConstructor(audioDestinationNodeConstructor, createAudioListener, eventTargetConstructor, isNativeOfflineAudioContext, unrenderedAudioWorkletNodeStore, wrapEventListener);\nconst createNativeOscillatorNode = createNativeOscillatorNodeFactory(addSilentConnection, cacheTestResult, testAudioScheduledSourceNodeStartMethodNegativeParametersSupport, testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport, testAudioScheduledSourceNodeStopMethodNegativeParametersSupport, wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls);\nconst createOscillatorNodeRenderer = createOscillatorNodeRendererFactory(connectAudioParam, createNativeOscillatorNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode);\nconst oscillatorNodeConstructor = createOscillatorNodeConstructor(audioNodeConstructor, createAudioParam, createNativeOscillatorNode, createOscillatorNodeRenderer, getNativeContext, isNativeOfflineAudioContext, wrapEventListener);\nconst createConnectedNativeAudioBufferSourceNode = createConnectedNativeAudioBufferSourceNodeFactory(createNativeAudioBufferSourceNode);\nconst createNativeWaveShaperNodeFaker = createNativeWaveShaperNodeFakerFactory(createConnectedNativeAudioBufferSourceNode, createInvalidStateError, createNativeGainNode, isDCCurve, monitorConnections);\nconst createNativeWaveShaperNode = createNativeWaveShaperNodeFactory(createConnectedNativeAudioBufferSourceNode, createInvalidStateError, createNativeWaveShaperNodeFaker, isDCCurve, monitorConnections, nativeAudioContextConstructor, overwriteAccessors);\nconst createNativePannerNodeFaker = createNativePannerNodeFakerFactory(connectNativeAudioNodeToNativeAudioNode, createInvalidStateError, createNativeChannelMergerNode, createNativeGainNode, createNativeScriptProcessorNode, createNativeWaveShaperNode, createNotSupportedError, disconnectNativeAudioNodeFromNativeAudioNode, getFirstSample, monitorConnections);\nconst createNativePannerNode = createNativePannerNodeFactory(createNativePannerNodeFaker);\nconst createPannerNodeRenderer = createPannerNodeRendererFactory(connectAudioParam, createNativeChannelMergerNode, createNativeConstantSourceNode, createNativeGainNode, createNativePannerNode, getNativeAudioNode, nativeOfflineAudioContextConstructor, renderAutomation, renderInputsOfAudioNode, renderNativeOfflineAudioContext);\nconst pannerNodeConstructor = createPannerNodeConstructor(audioNodeConstructor, createAudioParam, createNativePannerNode, createPannerNodeRenderer, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime);\nconst createNativePeriodicWave = createNativePeriodicWaveFactory(createIndexSizeError);\nconst periodicWaveConstructor = createPeriodicWaveConstructor(createNativePeriodicWave, getNativeContext, new WeakSet(), sanitizePeriodicWaveOptions);\nconst nativeStereoPannerNodeFakerFactory = createNativeStereoPannerNodeFakerFactory(createNativeChannelMergerNode, createNativeChannelSplitterNode, createNativeGainNode, createNativeWaveShaperNode, createNotSupportedError, monitorConnections);\nconst createNativeStereoPannerNode = createNativeStereoPannerNodeFactory(nativeStereoPannerNodeFakerFactory, createNotSupportedError);\nconst createStereoPannerNodeRenderer = createStereoPannerNodeRendererFactory(connectAudioParam, createNativeStereoPannerNode, getNativeAudioNode, renderAutomation, renderInputsOfAudioNode);\nconst stereoPannerNodeConstructor = createStereoPannerNodeConstructor(audioNodeConstructor, createAudioParam, createNativeStereoPannerNode, createStereoPannerNodeRenderer, getNativeContext, isNativeOfflineAudioContext);\nconst createWaveShaperNodeRenderer = createWaveShaperNodeRendererFactory(createNativeWaveShaperNode, getNativeAudioNode, renderInputsOfAudioNode);\nconst waveShaperNodeConstructor = createWaveShaperNodeConstructor(audioNodeConstructor, createInvalidStateError, createNativeWaveShaperNode, createWaveShaperNodeRenderer, getNativeContext, isNativeOfflineAudioContext, setAudioNodeTailTime);\nconst isSecureContext = createIsSecureContext(window);\nconst exposeCurrentFrameAndCurrentTime = createExposeCurrentFrameAndCurrentTime(window);\nconst backupOfflineAudioContextStore = new WeakMap();\nconst getOrCreateBackupOfflineAudioContext = createGetOrCreateBackupOfflineAudioContext(backupOfflineAudioContextStore, nativeOfflineAudioContextConstructor);\n// The addAudioWorkletModule() function is only available in a SecureContext.\nexport const addAudioWorkletModule = isSecureContext\n    ? createAddAudioWorkletModule(cacheTestResult, createNotSupportedError, createEvaluateSource(window), exposeCurrentFrameAndCurrentTime, createFetchSource(createAbortError), getNativeContext, getOrCreateBackupOfflineAudioContext, isNativeOfflineAudioContext, nativeAudioWorkletNodeConstructor, new WeakMap(), new WeakMap(), createTestAudioWorkletProcessorPostMessageSupport(nativeAudioWorkletNodeConstructor, nativeOfflineAudioContextConstructor), \n    // @todo window is guaranteed to be defined because isSecureContext checks that as well.\n    window)\n    : undefined;\nconst isNativeContext = createIsNativeContext(isNativeAudioContext, isNativeOfflineAudioContext);\nexport const decodeAudioData = createDecodeAudioData(audioBufferStore, cacheTestResult, createDataCloneError, createEncodingError, new WeakSet(), getNativeContext, isNativeContext, testAudioBufferCopyChannelMethodsOutOfBoundsSupport, testPromiseSupport, wrapAudioBufferCopyChannelMethods, wrapAudioBufferCopyChannelMethodsOutOfBounds);\nconst baseAudioContextConstructor = createBaseAudioContextConstructor(addAudioWorkletModule, analyserNodeConstructor, audioBufferConstructor, audioBufferSourceNodeConstructor, biquadFilterNodeConstructor, channelMergerNodeConstructor, channelSplitterNodeConstructor, constantSourceNodeConstructor, convolverNodeConstructor, decodeAudioData, delayNodeConstructor, dynamicsCompressorNodeConstructor, gainNodeConstructor, iIRFilterNodeConstructor, minimalBaseAudioContextConstructor, oscillatorNodeConstructor, pannerNodeConstructor, periodicWaveConstructor, stereoPannerNodeConstructor, waveShaperNodeConstructor);\nconst mediaElementAudioSourceNodeConstructor = createMediaElementAudioSourceNodeConstructor(audioNodeConstructor, createNativeMediaElementAudioSourceNode, getNativeContext, isNativeOfflineAudioContext);\nconst mediaStreamAudioDestinationNodeConstructor = createMediaStreamAudioDestinationNodeConstructor(audioNodeConstructor, createNativeMediaStreamAudioDestinationNode, getNativeContext, isNativeOfflineAudioContext);\nconst mediaStreamAudioSourceNodeConstructor = createMediaStreamAudioSourceNodeConstructor(audioNodeConstructor, createNativeMediaStreamAudioSourceNode, getNativeContext, isNativeOfflineAudioContext);\nconst createNativeMediaStreamTrackAudioSourceNode = createNativeMediaStreamTrackAudioSourceNodeFactory(createInvalidStateError, isNativeOfflineAudioContext);\nconst mediaStreamTrackAudioSourceNodeConstructor = createMediaStreamTrackAudioSourceNodeConstructor(audioNodeConstructor, createNativeMediaStreamTrackAudioSourceNode, getNativeContext);\nconst audioContextConstructor = createAudioContextConstructor(baseAudioContextConstructor, createInvalidStateError, createNotSupportedError, createUnknownError, mediaElementAudioSourceNodeConstructor, mediaStreamAudioDestinationNodeConstructor, mediaStreamAudioSourceNodeConstructor, mediaStreamTrackAudioSourceNodeConstructor, nativeAudioContextConstructor);\nexport { audioContextConstructor as AudioContext };\nconst getUnrenderedAudioWorkletNodes = createGetUnrenderedAudioWorkletNodes(unrenderedAudioWorkletNodeStore);\nconst addUnrenderedAudioWorkletNode = createAddUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes);\nconst connectMultipleOutputs = createConnectMultipleOutputs(createIndexSizeError);\nconst deleteUnrenderedAudioWorkletNode = createDeleteUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes);\nconst disconnectMultipleOutputs = createDisconnectMultipleOutputs(createIndexSizeError);\nconst activeAudioWorkletNodeInputsStore = new WeakMap();\nconst getActiveAudioWorkletNodeInputs = createGetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore, getValueForKey);\nconst createNativeAudioWorkletNodeFaker = createNativeAudioWorkletNodeFakerFactory(connectMultipleOutputs, createIndexSizeError, createInvalidStateError, createNativeChannelMergerNode, createNativeChannelSplitterNode, createNativeConstantSourceNode, createNativeGainNode, createNativeScriptProcessorNode, createNotSupportedError, disconnectMultipleOutputs, exposeCurrentFrameAndCurrentTime, getActiveAudioWorkletNodeInputs, monitorConnections);\nconst createNativeAudioWorkletNode = createNativeAudioWorkletNodeFactory(createInvalidStateError, createNativeAudioWorkletNodeFaker, createNativeGainNode, createNotSupportedError, monitorConnections);\nconst createAudioWorkletNodeRenderer = createAudioWorkletNodeRendererFactory(connectAudioParam, connectMultipleOutputs, createNativeAudioBufferSourceNode, createNativeChannelMergerNode, createNativeChannelSplitterNode, createNativeConstantSourceNode, createNativeGainNode, deleteUnrenderedAudioWorkletNode, disconnectMultipleOutputs, exposeCurrentFrameAndCurrentTime, getNativeAudioNode, nativeAudioWorkletNodeConstructor, nativeOfflineAudioContextConstructor, renderAutomation, renderInputsOfAudioNode, renderNativeOfflineAudioContext);\nconst getBackupOfflineAudioContext = createGetBackupOfflineAudioContext(backupOfflineAudioContextStore);\nconst setActiveAudioWorkletNodeInputs = createSetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore);\n// The AudioWorkletNode constructor is only available in a SecureContext.\nconst audioWorkletNodeConstructor = isSecureContext\n    ? createAudioWorkletNodeConstructor(addUnrenderedAudioWorkletNode, audioNodeConstructor, createAudioParam, createAudioWorkletNodeRenderer, createNativeAudioWorkletNode, getAudioNodeConnections, getBackupOfflineAudioContext, getNativeContext, isNativeOfflineAudioContext, nativeAudioWorkletNodeConstructor, sanitizeAudioWorkletNodeOptions, setActiveAudioWorkletNodeInputs, testAudioWorkletNodeOptionsClonability, wrapEventListener)\n    : undefined;\nexport { audioWorkletNodeConstructor as AudioWorkletNode };\nexport { biquadFilterNodeConstructor as BiquadFilterNode };\nexport { channelMergerNodeConstructor as ChannelMergerNode };\nexport { channelSplitterNodeConstructor as ChannelSplitterNode };\nexport { convolverNodeConstructor as ConvolverNode };\nexport { constantSourceNodeConstructor as ConstantSourceNode };\nexport { delayNodeConstructor as DelayNode };\nexport { dynamicsCompressorNodeConstructor as DynamicsCompressorNode };\nexport { gainNodeConstructor as GainNode };\nexport { iIRFilterNodeConstructor as IIRFilterNode };\nexport { mediaElementAudioSourceNodeConstructor as MediaElementAudioSourceNode };\nexport { mediaStreamAudioDestinationNodeConstructor as MediaStreamAudioDestinationNode };\nexport { mediaStreamAudioSourceNodeConstructor as MediaStreamAudioSourceNode };\nexport { mediaStreamTrackAudioSourceNodeConstructor as MediaStreamTrackAudioSourceNode };\nconst minimalAudioContextConstructor = createMinimalAudioContextConstructor(createInvalidStateError, createNotSupportedError, createUnknownError, minimalBaseAudioContextConstructor, nativeAudioContextConstructor);\nexport { minimalAudioContextConstructor as MinimalAudioContext };\nconst createNativeOfflineAudioContext = createCreateNativeOfflineAudioContext(createNotSupportedError, nativeOfflineAudioContextConstructor);\nconst startRendering = createStartRendering(audioBufferStore, cacheTestResult, getAudioNodeRenderer, getUnrenderedAudioWorkletNodes, renderNativeOfflineAudioContext, testAudioBufferCopyChannelMethodsOutOfBoundsSupport, wrapAudioBufferCopyChannelMethods, wrapAudioBufferCopyChannelMethodsOutOfBounds);\nconst minimalOfflineAudioContextConstructor = createMinimalOfflineAudioContextConstructor(cacheTestResult, createInvalidStateError, createNativeOfflineAudioContext, minimalBaseAudioContextConstructor, startRendering);\nexport { minimalOfflineAudioContextConstructor as MinimalOfflineAudioContext };\nconst offlineAudioContextConstructor = createOfflineAudioContextConstructor(baseAudioContextConstructor, cacheTestResult, createInvalidStateError, createNativeOfflineAudioContext, startRendering);\nexport { offlineAudioContextConstructor as OfflineAudioContext };\nexport { oscillatorNodeConstructor as OscillatorNode };\nexport { pannerNodeConstructor as PannerNode };\nexport { periodicWaveConstructor as PeriodicWave };\nexport { stereoPannerNodeConstructor as StereoPannerNode };\nexport { waveShaperNodeConstructor as WaveShaperNode };\nexport const isAnyAudioContext = createIsAnyAudioContext(CONTEXT_STORE, isNativeAudioContext);\nexport const isAnyAudioNode = createIsAnyAudioNode(AUDIO_NODE_STORE, isNativeAudioNode);\nexport const isAnyAudioParam = createIsAnyAudioParam(AUDIO_PARAM_STORE, isNativeAudioParam);\nexport const isAnyOfflineAudioContext = createIsAnyOfflineAudioContext(CONTEXT_STORE, isNativeOfflineAudioContext);\nexport const isSupported = () => createIsSupportedPromise(cacheTestResult, createTestAudioBufferCopyChannelMethodsSubarraySupport(nativeOfflineAudioContextConstructor), createTestAudioContextCloseMethodSupport(nativeAudioContextConstructor), createTestAudioContextDecodeAudioDataMethodTypeErrorSupport(nativeOfflineAudioContextConstructor), createTestAudioContextOptionsSupport(nativeAudioContextConstructor), createTestAudioNodeConnectMethodSupport(nativeOfflineAudioContextConstructor), createTestAudioWorkletProcessorNoOutputsSupport(nativeAudioWorkletNodeConstructor, nativeOfflineAudioContextConstructor), createTestChannelMergerNodeChannelCountSupport(nativeOfflineAudioContextConstructor), createTestConstantSourceNodeAccurateSchedulingSupport(nativeOfflineAudioContextConstructor), createTestConvolverNodeBufferReassignabilitySupport(nativeOfflineAudioContextConstructor), createTestConvolverNodeChannelCountSupport(nativeOfflineAudioContextConstructor), testDomExceptionConstructorSupport, createTestIsSecureContextSupport(window), createTestMediaStreamAudioSourceNodeMediaStreamWithoutAudioTrackSupport(nativeAudioContextConstructor), createTestStereoPannerNodeDefaultValueSupport(nativeOfflineAudioContextConstructor), testTransferablesSupport);\n//# sourceMappingURL=module.js.map","/**\n * Test if the arg is undefined\n */\nexport function isUndef(arg) {\n    return arg === undefined;\n}\n/**\n * Test if the arg is not undefined\n */\nexport function isDefined(arg) {\n    return arg !== undefined;\n}\n/**\n * Test if the arg is a function\n */\nexport function isFunction(arg) {\n    return typeof arg === \"function\";\n}\n/**\n * Test if the argument is a number.\n */\nexport function isNumber(arg) {\n    return typeof arg === \"number\";\n}\n/**\n * Test if the given argument is an object literal (i.e. `{}`);\n */\nexport function isObject(arg) {\n    return (Object.prototype.toString.call(arg) === \"[object Object]\" &&\n        arg.constructor === Object);\n}\n/**\n * Test if the argument is a boolean.\n */\nexport function isBoolean(arg) {\n    return typeof arg === \"boolean\";\n}\n/**\n * Test if the argument is an Array\n */\nexport function isArray(arg) {\n    return Array.isArray(arg);\n}\n/**\n * Test if the argument is a string.\n */\nexport function isString(arg) {\n    return typeof arg === \"string\";\n}\n/**\n * Test if the argument is in the form of a note in scientific pitch notation.\n * e.g. \"C4\"\n */\nexport function isNote(arg) {\n    return isString(arg) && /^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(arg);\n}\n//# sourceMappingURL=TypeCheck.js.map","import { isUndef } from \"./TypeCheck.js\";\n/**\n * Assert that the statement is true, otherwise invoke the error.\n * @param statement\n * @param error The message which is passed into an Error\n */\nexport function assert(statement, error) {\n    if (!statement) {\n        throw new Error(error);\n    }\n}\n/**\n * Make sure that the given value is within the range\n */\nexport function assertRange(value, gte, lte = Infinity) {\n    if (!(gte <= value && value <= lte)) {\n        throw new RangeError(`Value must be within [${gte}, ${lte}], got: ${value}`);\n    }\n}\n/**\n * Warn if the context is not running.\n */\nexport function assertContextRunning(context) {\n    // add a warning if the context is not started\n    if (!context.isOffline && context.state !== \"running\") {\n        warn('The AudioContext is \"suspended\". Invoke Tone.start() from a user action to start the audio.');\n    }\n}\n/**\n * If it is currently inside a scheduled callback\n */\nlet isInsideScheduledCallback = false;\nlet printedScheduledWarning = false;\n/**\n * Notify that the following block of code is occurring inside a Transport callback.\n */\nexport function enterScheduledCallback(insideCallback) {\n    isInsideScheduledCallback = insideCallback;\n}\n/**\n * Make sure that a time was passed into\n */\nexport function assertUsedScheduleTime(time) {\n    if (isUndef(time) &&\n        isInsideScheduledCallback &&\n        !printedScheduledWarning) {\n        printedScheduledWarning = true;\n        warn(\"Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing\");\n    }\n}\n/**\n * The default logger is the console\n */\nlet defaultLogger = console;\n/**\n * Set the logging interface\n */\nexport function setLogger(logger) {\n    defaultLogger = logger;\n}\n/**\n * Log anything\n */\nexport function log(...args) {\n    defaultLogger.log(...args);\n}\n/**\n * Warn anything\n */\nexport function warn(...args) {\n    defaultLogger.warn(...args);\n}\n//# sourceMappingURL=Debug.js.map","import { AudioContext as stdAudioContext, AudioWorkletNode as stdAudioWorkletNode, OfflineAudioContext as stdOfflineAudioContext, } from \"standardized-audio-context\";\nimport { assert } from \"../util/Debug.js\";\nimport { isDefined } from \"../util/TypeCheck.js\";\n/**\n * Create a new AudioContext\n */\nexport function createAudioContext(options) {\n    return new stdAudioContext(options);\n}\n/**\n * Create a new OfflineAudioContext\n */\nexport function createOfflineAudioContext(channels, length, sampleRate) {\n    return new stdOfflineAudioContext(channels, length, sampleRate);\n}\n/**\n * A reference to the window object\n * @hidden\n */\nexport const theWindow = typeof self === \"object\" ? self : null;\n/**\n * If the browser has a window object which has an AudioContext\n * @hidden\n */\nexport const hasAudioContext = theWindow &&\n    (theWindow.hasOwnProperty(\"AudioContext\") ||\n        theWindow.hasOwnProperty(\"webkitAudioContext\"));\nexport function createAudioWorkletNode(context, name, options) {\n    assert(isDefined(stdAudioWorkletNode), \"AudioWorkletNode only works in a secure context (https or localhost)\");\n    return new (context instanceof (theWindow === null || theWindow === void 0 ? void 0 : theWindow.BaseAudioContext)\n        ? theWindow === null || theWindow === void 0 ? void 0 : theWindow.AudioWorkletNode\n        : stdAudioWorkletNode)(context, name, options);\n}\n/**\n * This promise resolves to a boolean which indicates if the\n * functionality is supported within the currently used browse.\n * Taken from [standardized-audio-context](https://github.com/chrisguttandin/standardized-audio-context#issupported)\n */\nexport { isSupported as supported } from \"standardized-audio-context\";\n//# sourceMappingURL=AudioContext.js.map","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n","/**\n * A class which provides a reliable callback using either\n * a Web Worker, or if that isn't supported, falls back to setTimeout.\n */\nexport class Ticker {\n    constructor(callback, type, updateInterval, contextSampleRate) {\n        this._callback = callback;\n        this._type = type;\n        this._minimumUpdateInterval = Math.max(128 / (contextSampleRate || 44100), 0.001);\n        this.updateInterval = updateInterval;\n        // create the clock source for the first time\n        this._createClock();\n    }\n    /**\n     * Generate a web worker\n     */\n    _createWorker() {\n        const blob = new Blob([\n            /* javascript */ `\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(this._updateInterval * 1000).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`,\n        ], { type: \"text/javascript\" });\n        const blobUrl = URL.createObjectURL(blob);\n        const worker = new Worker(blobUrl);\n        worker.onmessage = this._callback.bind(this);\n        this._worker = worker;\n    }\n    /**\n     * Create a timeout loop\n     */\n    _createTimeout() {\n        this._timeout = setTimeout(() => {\n            this._createTimeout();\n            this._callback();\n        }, this._updateInterval * 1000);\n    }\n    /**\n     * Create the clock source.\n     */\n    _createClock() {\n        if (this._type === \"worker\") {\n            try {\n                this._createWorker();\n            }\n            catch (e) {\n                // workers not supported, fallback to timeout\n                this._type = \"timeout\";\n                this._createClock();\n            }\n        }\n        else if (this._type === \"timeout\") {\n            this._createTimeout();\n        }\n    }\n    /**\n     * Clean up the current clock source\n     */\n    _disposeClock() {\n        if (this._timeout) {\n            clearTimeout(this._timeout);\n        }\n        if (this._worker) {\n            this._worker.terminate();\n            this._worker.onmessage = null;\n        }\n    }\n    /**\n     * The rate in seconds the ticker will update\n     */\n    get updateInterval() {\n        return this._updateInterval;\n    }\n    set updateInterval(interval) {\n        var _a;\n        this._updateInterval = Math.max(interval, this._minimumUpdateInterval);\n        if (this._type === \"worker\") {\n            (_a = this._worker) === null || _a === void 0 ? void 0 : _a.postMessage(this._updateInterval * 1000);\n        }\n    }\n    /**\n     * The type of the ticker, either a worker or a timeout\n     */\n    get type() {\n        return this._type;\n    }\n    set type(type) {\n        this._disposeClock();\n        this._type = type;\n        this._createClock();\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        this._disposeClock();\n    }\n}\n//# sourceMappingURL=Ticker.js.map","import { AudioBuffer, isAnyAudioContext, isAnyAudioNode, isAnyAudioParam, isAnyOfflineAudioContext, } from \"standardized-audio-context\";\n/**\n * Test if the given value is an instanceof AudioParam\n */\nexport function isAudioParam(arg) {\n    return isAnyAudioParam(arg);\n}\n/**\n * Test if the given value is an instanceof AudioNode\n */\nexport function isAudioNode(arg) {\n    return isAnyAudioNode(arg);\n}\n/**\n * Test if the arg is instanceof an OfflineAudioContext\n */\nexport function isOfflineAudioContext(arg) {\n    return isAnyOfflineAudioContext(arg);\n}\n/**\n * Test if the arg is an instanceof AudioContext\n */\nexport function isAudioContext(arg) {\n    return isAnyAudioContext(arg);\n}\n/**\n * Test if the arg is instanceof an AudioBuffer\n */\nexport function isAudioBuffer(arg) {\n    return arg instanceof AudioBuffer;\n}\n//# sourceMappingURL=AdvancedTypeCheck.js.map","import { isAudioBuffer, isAudioNode, isAudioParam, } from \"./AdvancedTypeCheck.js\";\nimport { isDefined, isObject, isUndef } from \"./TypeCheck.js\";\n/**\n * Some objects should not be merged\n */\nfunction noCopy(key, arg) {\n    return (key === \"value\" ||\n        isAudioParam(arg) ||\n        isAudioNode(arg) ||\n        isAudioBuffer(arg));\n}\n/**\n * Recursively merge an object\n * @param target the object to merge into\n * @param sources the source objects to merge\n */\nexport function deepMerge(target, ...sources) {\n    if (!sources.length) {\n        return target;\n    }\n    const source = sources.shift();\n    if (isObject(target) && isObject(source)) {\n        for (const key in source) {\n            if (noCopy(key, source[key])) {\n                target[key] = source[key];\n            }\n            else if (isObject(source[key])) {\n                if (!target[key]) {\n                    Object.assign(target, { [key]: {} });\n                }\n                deepMerge(target[key], source[key]);\n            }\n            else {\n                Object.assign(target, { [key]: source[key] });\n            }\n        }\n    }\n    // @ts-ignore\n    return deepMerge(target, ...sources);\n}\n/**\n * Returns true if the two arrays have the same value for each of the elements\n */\nexport function deepEquals(arrayA, arrayB) {\n    return (arrayA.length === arrayB.length &&\n        arrayA.every((element, index) => arrayB[index] === element));\n}\n/**\n * Convert an args array into an object.\n * @internal\n */\nexport function optionsFromArguments(defaults, argsArray, keys = [], objKey) {\n    const opts = {};\n    const args = Array.from(argsArray);\n    // if the first argument is an object and has an object key\n    if (isObject(args[0]) && objKey && !Reflect.has(args[0], objKey)) {\n        // if it's not part of the defaults\n        const partOfDefaults = Object.keys(args[0]).some((key) => Reflect.has(defaults, key));\n        if (!partOfDefaults) {\n            // merge that key\n            deepMerge(opts, { [objKey]: args[0] });\n            // remove the obj key from the keys\n            keys.splice(keys.indexOf(objKey), 1);\n            // shift the first argument off\n            args.shift();\n        }\n    }\n    if (args.length === 1 && isObject(args[0])) {\n        deepMerge(opts, args[0]);\n    }\n    else {\n        for (let i = 0; i < keys.length; i++) {\n            if (isDefined(args[i])) {\n                opts[keys[i]] = args[i];\n            }\n        }\n    }\n    return deepMerge(defaults, opts);\n}\n/**\n * Return this instances default values by calling Constructor.getDefaults()\n */\nexport function getDefaultsFromInstance(instance) {\n    return instance.constructor.getDefaults();\n}\n/**\n * Returns the fallback if the given object is undefined.\n * Take an array of arguments and return a formatted options object.\n * @internal\n */\nexport function defaultArg(given, fallback) {\n    if (isUndef(given)) {\n        return fallback;\n    }\n    else {\n        return given;\n    }\n}\n/**\n * Remove all of the properties belonging to omit from obj.\n */\nexport function omitFromObject(obj, omit) {\n    omit.forEach((prop) => {\n        if (Reflect.has(obj, prop)) {\n            delete obj[prop];\n        }\n    });\n    return obj;\n}\n//# sourceMappingURL=Defaults.js.map","/**\n * Tone.js\n * @author Yotam Mann\n * @license http://opensource.org/licenses/MIT MIT License\n * @copyright 2014-2024 Yotam Mann\n */\nimport { version } from \"../version.js\";\nimport { theWindow } from \"./context/AudioContext.js\";\nimport { log } from \"./util/Debug.js\";\n/**\n * Tone is the base class of all other classes.\n *\n * @category Core\n * @constructor\n */\nexport class Tone {\n    constructor() {\n        //-------------------------------------\n        // \tDEBUGGING\n        //-------------------------------------\n        /**\n         * Set this debug flag to log all events that happen in this class.\n         */\n        this.debug = false;\n        //-------------------------------------\n        // \tDISPOSING\n        //-------------------------------------\n        /**\n         * Indicates if the instance was disposed\n         */\n        this._wasDisposed = false;\n    }\n    /**\n     * Returns all of the default options belonging to the class.\n     */\n    static getDefaults() {\n        return {};\n    }\n    /**\n     * Prints the outputs to the console log for debugging purposes.\n     * Prints the contents only if either the object has a property\n     * called `debug` set to true, or a variable called TONE_DEBUG_CLASS\n     * is set to the name of the class.\n     * @example\n     * const osc = new Tone.Oscillator();\n     * // prints all logs originating from this oscillator\n     * osc.debug = true;\n     * // calls to start/stop will print in the console\n     * osc.start();\n     */\n    log(...args) {\n        // if the object is either set to debug = true\n        // or if there is a string on the Tone.global.with the class name\n        if (this.debug ||\n            (theWindow && this.toString() === theWindow.TONE_DEBUG_CLASS)) {\n            log(this, ...args);\n        }\n    }\n    /**\n     * disconnect and dispose.\n     */\n    dispose() {\n        this._wasDisposed = true;\n        return this;\n    }\n    /**\n     * Indicates if the instance was disposed. 'Disposing' an\n     * instance means that all of the Web Audio nodes that were\n     * created for the instance are disconnected and freed for garbage collection.\n     */\n    get disposed() {\n        return this._wasDisposed;\n    }\n    /**\n     * Convert the class to a string\n     * @example\n     * const osc = new Tone.Oscillator();\n     * console.log(osc.toString());\n     */\n    toString() {\n        return this.name;\n    }\n}\n/**\n * The version number semver\n */\nTone.version = version;\n//# sourceMappingURL=Tone.js.map","/**\n * The threshold for correctness for operators. Less than one sample even\n * at very high sampling rates (e.g. `1e-6 < 1 / 192000`).\n */\nconst EPSILON = 1e-6;\n/**\n * Test if A is greater than B\n */\nexport function GT(a, b) {\n    return a > b + EPSILON;\n}\n/**\n * Test if A is greater than or equal to B\n */\nexport function GTE(a, b) {\n    return GT(a, b) || EQ(a, b);\n}\n/**\n * Test if A is less than B\n */\nexport function LT(a, b) {\n    return a + EPSILON < b;\n}\n/**\n * Test if A is less than B\n */\nexport function EQ(a, b) {\n    return Math.abs(a - b) < EPSILON;\n}\n/**\n * Clamp the value within the given range\n */\nexport function clamp(value, min, max) {\n    return Math.max(Math.min(value, max), min);\n}\n//# sourceMappingURL=Math.js.map","import { Tone } from \"../Tone.js\";\nimport { optionsFromArguments } from \"./Defaults.js\";\nimport { assert } from \"./Debug.js\";\nimport { EQ, GT, GTE, LT } from \"./Math.js\";\n/**\n * A Timeline class for scheduling and maintaining state\n * along a timeline. All events must have a \"time\" property.\n * Internally, events are stored in time order for fast\n * retrieval.\n * @internal\n */\nexport class Timeline extends Tone {\n    constructor() {\n        super();\n        this.name = \"Timeline\";\n        /**\n         * The array of scheduled timeline events\n         */\n        this._timeline = [];\n        const options = optionsFromArguments(Timeline.getDefaults(), arguments, [\"memory\"]);\n        this.memory = options.memory;\n        this.increasing = options.increasing;\n    }\n    static getDefaults() {\n        return {\n            memory: Infinity,\n            increasing: false,\n        };\n    }\n    /**\n     * The number of items in the timeline.\n     */\n    get length() {\n        return this._timeline.length;\n    }\n    /**\n     * Insert an event object onto the timeline. Events must have a \"time\" attribute.\n     * @param event  The event object to insert into the timeline.\n     */\n    add(event) {\n        // the event needs to have a time attribute\n        assert(Reflect.has(event, \"time\"), \"Timeline: events must have a time attribute\");\n        event.time = event.time.valueOf();\n        if (this.increasing && this.length) {\n            const lastValue = this._timeline[this.length - 1];\n            assert(GTE(event.time, lastValue.time), \"The time must be greater than or equal to the last scheduled time\");\n            this._timeline.push(event);\n        }\n        else {\n            const index = this._search(event.time);\n            this._timeline.splice(index + 1, 0, event);\n        }\n        // if the length is more than the memory, remove the previous ones\n        if (this.length > this.memory) {\n            const diff = this.length - this.memory;\n            this._timeline.splice(0, diff);\n        }\n        return this;\n    }\n    /**\n     * Remove an event from the timeline.\n     * @param  {Object}  event  The event object to remove from the list.\n     * @returns {Timeline} this\n     */\n    remove(event) {\n        const index = this._timeline.indexOf(event);\n        if (index !== -1) {\n            this._timeline.splice(index, 1);\n        }\n        return this;\n    }\n    /**\n     * Get the nearest event whose time is less than or equal to the given time.\n     * @param  time  The time to query.\n     */\n    get(time, param = \"time\") {\n        const index = this._search(time, param);\n        if (index !== -1) {\n            return this._timeline[index];\n        }\n        else {\n            return null;\n        }\n    }\n    /**\n     * Return the first event in the timeline without removing it\n     * @returns {Object} The first event object\n     * @deprecated\n     */\n    peek() {\n        return this._timeline[0];\n    }\n    /**\n     * Return the first event in the timeline and remove it\n     * @deprecated\n     */\n    shift() {\n        return this._timeline.shift();\n    }\n    /**\n     * Get the event which is scheduled after the given time.\n     * @param  time  The time to query.\n     */\n    getAfter(time, param = \"time\") {\n        const index = this._search(time, param);\n        if (index + 1 < this._timeline.length) {\n            return this._timeline[index + 1];\n        }\n        else {\n            return null;\n        }\n    }\n    /**\n     * Get the event before the event at the given time.\n     * @param  time  The time to query.\n     */\n    getBefore(time) {\n        const len = this._timeline.length;\n        // if it's after the last item, return the last item\n        if (len > 0 && this._timeline[len - 1].time < time) {\n            return this._timeline[len - 1];\n        }\n        const index = this._search(time);\n        if (index - 1 >= 0) {\n            return this._timeline[index - 1];\n        }\n        else {\n            return null;\n        }\n    }\n    /**\n     * Cancel events at and after the given time\n     * @param  after  The time to query.\n     */\n    cancel(after) {\n        if (this._timeline.length > 1) {\n            let index = this._search(after);\n            if (index >= 0) {\n                if (EQ(this._timeline[index].time, after)) {\n                    // get the first item with that time\n                    for (let i = index; i >= 0; i--) {\n                        if (EQ(this._timeline[i].time, after)) {\n                            index = i;\n                        }\n                        else {\n                            break;\n                        }\n                    }\n                    this._timeline = this._timeline.slice(0, index);\n                }\n                else {\n                    this._timeline = this._timeline.slice(0, index + 1);\n                }\n            }\n            else {\n                this._timeline = [];\n            }\n        }\n        else if (this._timeline.length === 1) {\n            // the first item's time\n            if (GTE(this._timeline[0].time, after)) {\n                this._timeline = [];\n            }\n        }\n        return this;\n    }\n    /**\n     * Cancel events before or equal to the given time.\n     * @param  time  The time to cancel before.\n     */\n    cancelBefore(time) {\n        const index = this._search(time);\n        if (index >= 0) {\n            this._timeline = this._timeline.slice(index + 1);\n        }\n        return this;\n    }\n    /**\n     * Returns the previous event if there is one. null otherwise\n     * @param  event The event to find the previous one of\n     * @return The event right before the given event\n     */\n    previousEvent(event) {\n        const index = this._timeline.indexOf(event);\n        if (index > 0) {\n            return this._timeline[index - 1];\n        }\n        else {\n            return null;\n        }\n    }\n    /**\n     * Does a binary search on the timeline array and returns the\n     * nearest event index whose time is after or equal to the given time.\n     * If a time is searched before the first index in the timeline, -1 is returned.\n     * If the time is after the end, the index of the last item is returned.\n     */\n    _search(time, param = \"time\") {\n        if (this._timeline.length === 0) {\n            return -1;\n        }\n        let beginning = 0;\n        const len = this._timeline.length;\n        let end = len;\n        if (len > 0 && this._timeline[len - 1][param] <= time) {\n            return len - 1;\n        }\n        while (beginning < end) {\n            // calculate the midpoint for roughly equal partition\n            let midPoint = Math.floor(beginning + (end - beginning) / 2);\n            const event = this._timeline[midPoint];\n            const nextEvent = this._timeline[midPoint + 1];\n            if (EQ(event[param], time)) {\n                // choose the last one that has the same time\n                for (let i = midPoint; i < this._timeline.length; i++) {\n                    const testEvent = this._timeline[i];\n                    if (EQ(testEvent[param], time)) {\n                        midPoint = i;\n                    }\n                    else {\n                        break;\n                    }\n                }\n                return midPoint;\n            }\n            else if (LT(event[param], time) && GT(nextEvent[param], time)) {\n                return midPoint;\n            }\n            else if (GT(event[param], time)) {\n                // search lower\n                end = midPoint;\n            }\n            else {\n                // search upper\n                beginning = midPoint + 1;\n            }\n        }\n        return -1;\n    }\n    /**\n     * Internal iterator. Applies extra safety checks for\n     * removing items from the array.\n     */\n    _iterate(callback, lowerBound = 0, upperBound = this._timeline.length - 1) {\n        this._timeline.slice(lowerBound, upperBound + 1).forEach(callback);\n    }\n    /**\n     * Iterate over everything in the array\n     * @param  callback The callback to invoke with every item\n     */\n    forEach(callback) {\n        this._iterate(callback);\n        return this;\n    }\n    /**\n     * Iterate over everything in the array at or before the given time.\n     * @param  time The time to check if items are before\n     * @param  callback The callback to invoke with every item\n     */\n    forEachBefore(time, callback) {\n        // iterate over the items in reverse so that removing an item doesn't break things\n        const upperBound = this._search(time);\n        if (upperBound !== -1) {\n            this._iterate(callback, 0, upperBound);\n        }\n        return this;\n    }\n    /**\n     * Iterate over everything in the array after the given time.\n     * @param  time The time to check if items are before\n     * @param  callback The callback to invoke with every item\n     */\n    forEachAfter(time, callback) {\n        // iterate over the items in reverse so that removing an item doesn't break things\n        const lowerBound = this._search(time);\n        this._iterate(callback, lowerBound + 1);\n        return this;\n    }\n    /**\n     * Iterate over everything in the array between the startTime and endTime.\n     * The timerange is inclusive of the startTime, but exclusive of the endTime.\n     * range = [startTime, endTime).\n     * @param  startTime The time to check if items are before\n     * @param  endTime The end of the test interval.\n     * @param  callback The callback to invoke with every item\n     */\n    forEachBetween(startTime, endTime, callback) {\n        let lowerBound = this._search(startTime);\n        let upperBound = this._search(endTime);\n        if (lowerBound !== -1 && upperBound !== -1) {\n            if (this._timeline[lowerBound].time !== startTime) {\n                lowerBound += 1;\n            }\n            // exclusive of the end time\n            if (this._timeline[upperBound].time === endTime) {\n                upperBound -= 1;\n            }\n            this._iterate(callback, lowerBound, upperBound);\n        }\n        else if (lowerBound === -1) {\n            this._iterate(callback, 0, upperBound);\n        }\n        return this;\n    }\n    /**\n     * Iterate over everything in the array at or after the given time. Similar to\n     * forEachAfter, but includes the item(s) at the given time.\n     * @param  time The time to check if items are before\n     * @param  callback The callback to invoke with every item\n     */\n    forEachFrom(time, callback) {\n        // iterate over the items in reverse so that removing an item doesn't break things\n        let lowerBound = this._search(time);\n        // work backwards until the event time is less than time\n        while (lowerBound >= 0 && this._timeline[lowerBound].time >= time) {\n            lowerBound--;\n        }\n        this._iterate(callback, lowerBound + 1);\n        return this;\n    }\n    /**\n     * Iterate over everything in the array at the given time\n     * @param  time The time to check if items are before\n     * @param  callback The callback to invoke with every item\n     */\n    forEachAtTime(time, callback) {\n        // iterate over the items in reverse so that removing an item doesn't break things\n        const upperBound = this._search(time);\n        if (upperBound !== -1 && EQ(this._timeline[upperBound].time, time)) {\n            let lowerBound = upperBound;\n            for (let i = upperBound; i >= 0; i--) {\n                if (EQ(this._timeline[i].time, time)) {\n                    lowerBound = i;\n                }\n                else {\n                    break;\n                }\n            }\n            this._iterate((event) => {\n                callback(event);\n            }, lowerBound, upperBound);\n        }\n        return this;\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this._timeline = [];\n        return this;\n    }\n}\n//# sourceMappingURL=Timeline.js.map","/**\n * Array of callbacks to invoke when a new context is created\n */\nconst notifyNewContext = [];\n/**\n * Used internally to setup a new Context\n */\nexport function onContextInit(cb) {\n    notifyNewContext.push(cb);\n}\n/**\n * Invoke any classes which need to also be initialized when a new context is created.\n */\nexport function initializeContext(ctx) {\n    // add any additional modules\n    notifyNewContext.forEach((cb) => cb(ctx));\n}\n/**\n * Array of callbacks to invoke when a new context is closed\n */\nconst notifyCloseContext = [];\n/**\n * Used internally to tear down a Context\n */\nexport function onContextClose(cb) {\n    notifyCloseContext.push(cb);\n}\nexport function closeContext(ctx) {\n    // remove any additional modules\n    notifyCloseContext.forEach((cb) => cb(ctx));\n}\n//# sourceMappingURL=ContextInitialization.js.map","import { Tone } from \"../Tone.js\";\nimport { isUndef } from \"./TypeCheck.js\";\n/**\n * Emitter gives classes which extend it\n * the ability to listen for and emit events.\n * Inspiration and reference from Jerome Etienne's [MicroEvent](https://github.com/jeromeetienne/microevent.js).\n * MIT (c) 2011 Jerome Etienne.\n * @category Core\n */\nexport class Emitter extends Tone {\n    constructor() {\n        super(...arguments);\n        this.name = \"Emitter\";\n    }\n    /**\n     * Bind a callback to a specific event.\n     * @param  event     The name of the event to listen for.\n     * @param  callback  The callback to invoke when the event is emitted\n     */\n    on(event, callback) {\n        // split the event\n        const events = event.split(/\\W+/);\n        events.forEach((eventName) => {\n            if (isUndef(this._events)) {\n                this._events = {};\n            }\n            if (!this._events.hasOwnProperty(eventName)) {\n                this._events[eventName] = [];\n            }\n            this._events[eventName].push(callback);\n        });\n        return this;\n    }\n    /**\n     * Bind a callback which is only invoked once\n     * @param  event     The name of the event to listen for.\n     * @param  callback  The callback to invoke when the event is emitted\n     */\n    once(event, callback) {\n        const boundCallback = (...args) => {\n            // invoke the callback\n            callback(...args);\n            // remove the event\n            this.off(event, boundCallback);\n        };\n        this.on(event, boundCallback);\n        return this;\n    }\n    /**\n     * Remove the event listener.\n     * @param  event     The event to stop listening to.\n     * @param  callback  The callback which was bound to the event with Emitter.on.\n     *                   If no callback is given, all callbacks events are removed.\n     */\n    off(event, callback) {\n        const events = event.split(/\\W+/);\n        events.forEach((eventName) => {\n            if (isUndef(this._events)) {\n                this._events = {};\n            }\n            if (this._events.hasOwnProperty(eventName)) {\n                if (isUndef(callback)) {\n                    this._events[eventName] = [];\n                }\n                else {\n                    const eventList = this._events[eventName];\n                    for (let i = eventList.length - 1; i >= 0; i--) {\n                        if (eventList[i] === callback) {\n                            eventList.splice(i, 1);\n                        }\n                    }\n                }\n            }\n        });\n        return this;\n    }\n    /**\n     * Invoke all of the callbacks bound to the event\n     * with any arguments passed in.\n     * @param  event  The name of the event.\n     * @param args The arguments to pass to the functions listening.\n     */\n    emit(event, ...args) {\n        if (this._events) {\n            if (this._events.hasOwnProperty(event)) {\n                const eventList = this._events[event].slice(0);\n                for (let i = 0, len = eventList.length; i < len; i++) {\n                    eventList[i].apply(this, args);\n                }\n            }\n        }\n        return this;\n    }\n    /**\n     * Add Emitter functions (on/off/emit) to the object\n     */\n    static mixin(constr) {\n        // instance._events = {};\n        [\"on\", \"once\", \"off\", \"emit\"].forEach((name) => {\n            const property = Object.getOwnPropertyDescriptor(Emitter.prototype, name);\n            Object.defineProperty(constr.prototype, name, property);\n        });\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        super.dispose();\n        this._events = undefined;\n        return this;\n    }\n}\n//# sourceMappingURL=Emitter.js.map","import { Emitter } from \"../util/Emitter.js\";\nexport class BaseContext extends Emitter {\n    constructor() {\n        super(...arguments);\n        this.isOffline = false;\n    }\n    /*\n     * This is a placeholder so that JSON.stringify does not throw an error\n     * This matches what JSON.stringify(audioContext) returns on a native\n     * audioContext instance.\n     */\n    toJSON() {\n        return {};\n    }\n}\n//# sourceMappingURL=BaseContext.js.map","import { __awaiter } from \"tslib\";\nimport { Ticker } from \"../clock/Ticker.js\";\nimport { isAudioContext } from \"../util/AdvancedTypeCheck.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { Timeline } from \"../util/Timeline.js\";\nimport { isDefined } from \"../util/TypeCheck.js\";\nimport { createAudioContext, createAudioWorkletNode, } from \"./AudioContext.js\";\nimport { closeContext, initializeContext } from \"./ContextInitialization.js\";\nimport { BaseContext } from \"./BaseContext.js\";\nimport { assert } from \"../util/Debug.js\";\n/**\n * Wrapper around the native AudioContext.\n * @category Core\n */\nexport class Context extends BaseContext {\n    constructor() {\n        var _a, _b;\n        super();\n        this.name = \"Context\";\n        /**\n         * An object containing all of the constants AudioBufferSourceNodes\n         */\n        this._constants = new Map();\n        /**\n         * All of the setTimeout events.\n         */\n        this._timeouts = new Timeline();\n        /**\n         * The timeout id counter\n         */\n        this._timeoutIds = 0;\n        /**\n         * Private indicator if the context has been initialized\n         */\n        this._initialized = false;\n        /**\n         * Private indicator if a close() has been called on the context, since close is async\n         */\n        this._closeStarted = false;\n        /**\n         * Indicates if the context is an OfflineAudioContext or an AudioContext\n         */\n        this.isOffline = false;\n        //--------------------------------------------\n        // AUDIO WORKLET\n        //--------------------------------------------\n        /**\n         * Maps a module name to promise of the addModule method\n         */\n        this._workletPromise = null;\n        const options = optionsFromArguments(Context.getDefaults(), arguments, [\n            \"context\",\n        ]);\n        if (options.context) {\n            this._context = options.context;\n            // custom context provided, latencyHint unknown (unless explicitly provided in options)\n            this._latencyHint = ((_a = arguments[0]) === null || _a === void 0 ? void 0 : _a.latencyHint) || \"\";\n        }\n        else {\n            this._context = createAudioContext({\n                latencyHint: options.latencyHint,\n            });\n            this._latencyHint = options.latencyHint;\n        }\n        this._ticker = new Ticker(this.emit.bind(this, \"tick\"), options.clockSource, options.updateInterval, this._context.sampleRate);\n        this.on(\"tick\", this._timeoutLoop.bind(this));\n        // fwd events from the context\n        this._context.onstatechange = () => {\n            this.emit(\"statechange\", this.state);\n        };\n        // if no custom updateInterval provided, updateInterval will be derived by lookAhead setter\n        this[((_b = arguments[0]) === null || _b === void 0 ? void 0 : _b.hasOwnProperty(\"updateInterval\"))\n            ? \"_lookAhead\"\n            : \"lookAhead\"] = options.lookAhead;\n    }\n    static getDefaults() {\n        return {\n            clockSource: \"worker\",\n            latencyHint: \"interactive\",\n            lookAhead: 0.1,\n            updateInterval: 0.05,\n        };\n    }\n    /**\n     * Finish setting up the context. **You usually do not need to do this manually.**\n     */\n    initialize() {\n        if (!this._initialized) {\n            // add any additional modules\n            initializeContext(this);\n            this._initialized = true;\n        }\n        return this;\n    }\n    //---------------------------\n    // BASE AUDIO CONTEXT METHODS\n    //---------------------------\n    createAnalyser() {\n        return this._context.createAnalyser();\n    }\n    createOscillator() {\n        return this._context.createOscillator();\n    }\n    createBufferSource() {\n        return this._context.createBufferSource();\n    }\n    createBiquadFilter() {\n        return this._context.createBiquadFilter();\n    }\n    createBuffer(numberOfChannels, length, sampleRate) {\n        return this._context.createBuffer(numberOfChannels, length, sampleRate);\n    }\n    createChannelMerger(numberOfInputs) {\n        return this._context.createChannelMerger(numberOfInputs);\n    }\n    createChannelSplitter(numberOfOutputs) {\n        return this._context.createChannelSplitter(numberOfOutputs);\n    }\n    createConstantSource() {\n        return this._context.createConstantSource();\n    }\n    createConvolver() {\n        return this._context.createConvolver();\n    }\n    createDelay(maxDelayTime) {\n        return this._context.createDelay(maxDelayTime);\n    }\n    createDynamicsCompressor() {\n        return this._context.createDynamicsCompressor();\n    }\n    createGain() {\n        return this._context.createGain();\n    }\n    createIIRFilter(feedForward, feedback) {\n        // @ts-ignore\n        return this._context.createIIRFilter(feedForward, feedback);\n    }\n    createPanner() {\n        return this._context.createPanner();\n    }\n    createPeriodicWave(real, imag, constraints) {\n        return this._context.createPeriodicWave(real, imag, constraints);\n    }\n    createStereoPanner() {\n        return this._context.createStereoPanner();\n    }\n    createWaveShaper() {\n        return this._context.createWaveShaper();\n    }\n    createMediaStreamSource(stream) {\n        assert(isAudioContext(this._context), \"Not available if OfflineAudioContext\");\n        const context = this._context;\n        return context.createMediaStreamSource(stream);\n    }\n    createMediaElementSource(element) {\n        assert(isAudioContext(this._context), \"Not available if OfflineAudioContext\");\n        const context = this._context;\n        return context.createMediaElementSource(element);\n    }\n    createMediaStreamDestination() {\n        assert(isAudioContext(this._context), \"Not available if OfflineAudioContext\");\n        const context = this._context;\n        return context.createMediaStreamDestination();\n    }\n    decodeAudioData(audioData) {\n        return this._context.decodeAudioData(audioData);\n    }\n    /**\n     * The current time in seconds of the AudioContext.\n     */\n    get currentTime() {\n        return this._context.currentTime;\n    }\n    /**\n     * The current time in seconds of the AudioContext.\n     */\n    get state() {\n        return this._context.state;\n    }\n    /**\n     * The current time in seconds of the AudioContext.\n     */\n    get sampleRate() {\n        return this._context.sampleRate;\n    }\n    /**\n     * The listener\n     */\n    get listener() {\n        this.initialize();\n        return this._listener;\n    }\n    set listener(l) {\n        assert(!this._initialized, \"The listener cannot be set after initialization.\");\n        this._listener = l;\n    }\n    /**\n     * There is only one Transport per Context. It is created on initialization.\n     */\n    get transport() {\n        this.initialize();\n        return this._transport;\n    }\n    set transport(t) {\n        assert(!this._initialized, \"The transport cannot be set after initialization.\");\n        this._transport = t;\n    }\n    /**\n     * This is the Draw object for the context which is useful for synchronizing the draw frame with the Tone.js clock.\n     */\n    get draw() {\n        this.initialize();\n        return this._draw;\n    }\n    set draw(d) {\n        assert(!this._initialized, \"Draw cannot be set after initialization.\");\n        this._draw = d;\n    }\n    /**\n     * A reference to the Context's destination node.\n     */\n    get destination() {\n        this.initialize();\n        return this._destination;\n    }\n    set destination(d) {\n        assert(!this._initialized, \"The destination cannot be set after initialization.\");\n        this._destination = d;\n    }\n    /**\n     * Create an audio worklet node from a name and options. The module\n     * must first be loaded using {@link addAudioWorkletModule}.\n     */\n    createAudioWorkletNode(name, options) {\n        return createAudioWorkletNode(this.rawContext, name, options);\n    }\n    /**\n     * Add an AudioWorkletProcessor module\n     * @param url The url of the module\n     */\n    addAudioWorkletModule(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            assert(isDefined(this.rawContext.audioWorklet), \"AudioWorkletNode is only available in a secure context (https or localhost)\");\n            if (!this._workletPromise) {\n                this._workletPromise = this.rawContext.audioWorklet.addModule(url);\n            }\n            yield this._workletPromise;\n        });\n    }\n    /**\n     * Returns a promise which resolves when all of the worklets have been loaded on this context\n     */\n    workletsAreReady() {\n        return __awaiter(this, void 0, void 0, function* () {\n            (yield this._workletPromise) ? this._workletPromise : Promise.resolve();\n        });\n    }\n    //---------------------------\n    // TICKER\n    //---------------------------\n    /**\n     * How often the interval callback is invoked.\n     * This number corresponds to how responsive the scheduling\n     * can be. Setting to 0 will result in the lowest practial interval\n     * based on context properties. context.updateInterval + context.lookAhead\n     * gives you the total latency between scheduling an event and hearing it.\n     */\n    get updateInterval() {\n        return this._ticker.updateInterval;\n    }\n    set updateInterval(interval) {\n        this._ticker.updateInterval = interval;\n    }\n    /**\n     * What the source of the clock is, either \"worker\" (default),\n     * \"timeout\", or \"offline\" (none).\n     */\n    get clockSource() {\n        return this._ticker.type;\n    }\n    set clockSource(type) {\n        this._ticker.type = type;\n    }\n    /**\n     * The amount of time into the future events are scheduled. Giving Web Audio\n     * a short amount of time into the future to schedule events can reduce clicks and\n     * improve performance. This value can be set to 0 to get the lowest latency.\n     * Adjusting this value also affects the {@link updateInterval}.\n     */\n    get lookAhead() {\n        return this._lookAhead;\n    }\n    set lookAhead(time) {\n        this._lookAhead = time;\n        // if lookAhead is 0, default to .01 updateInterval\n        this.updateInterval = time ? time / 2 : 0.01;\n    }\n    /**\n     * The type of playback, which affects tradeoffs between audio\n     * output latency and responsiveness.\n     * In addition to setting the value in seconds, the latencyHint also\n     * accepts the strings \"interactive\" (prioritizes low latency),\n     * \"playback\" (prioritizes sustained playback), \"balanced\" (balances\n     * latency and performance).\n     * @example\n     * // prioritize sustained playback\n     * const context = new Tone.Context({ latencyHint: \"playback\" });\n     * // set this context as the global Context\n     * Tone.setContext(context);\n     * // the global context is gettable with Tone.getContext()\n     * console.log(Tone.getContext().latencyHint);\n     */\n    get latencyHint() {\n        return this._latencyHint;\n    }\n    /**\n     * The unwrapped AudioContext or OfflineAudioContext\n     */\n    get rawContext() {\n        return this._context;\n    }\n    /**\n     * The current audio context time plus a short {@link lookAhead}.\n     * @example\n     * setInterval(() => {\n     * \tconsole.log(\"now\", Tone.now());\n     * }, 100);\n     */\n    now() {\n        return this._context.currentTime + this._lookAhead;\n    }\n    /**\n     * The current audio context time without the {@link lookAhead}.\n     * In most cases it is better to use {@link now} instead of {@link immediate} since\n     * with {@link now} the {@link lookAhead} is applied equally to _all_ components including internal components,\n     * to making sure that everything is scheduled in sync. Mixing {@link now} and {@link immediate}\n     * can cause some timing issues. If no lookAhead is desired, you can set the {@link lookAhead} to `0`.\n     */\n    immediate() {\n        return this._context.currentTime;\n    }\n    /**\n     * Starts the audio context from a suspended state. This is required\n     * to initially start the AudioContext.\n     * @see {@link start}\n     */\n    resume() {\n        if (isAudioContext(this._context)) {\n            return this._context.resume();\n        }\n        else {\n            return Promise.resolve();\n        }\n    }\n    /**\n     * Close the context. Once closed, the context can no longer be used and\n     * any AudioNodes created from the context will be silent.\n     */\n    close() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (isAudioContext(this._context) &&\n                this.state !== \"closed\" &&\n                !this._closeStarted) {\n                this._closeStarted = true;\n                yield this._context.close();\n            }\n            if (this._initialized) {\n                closeContext(this);\n            }\n        });\n    }\n    /**\n     * **Internal** Generate a looped buffer at some constant value.\n     */\n    getConstant(val) {\n        if (this._constants.has(val)) {\n            return this._constants.get(val);\n        }\n        else {\n            const buffer = this._context.createBuffer(1, 128, this._context.sampleRate);\n            const arr = buffer.getChannelData(0);\n            for (let i = 0; i < arr.length; i++) {\n                arr[i] = val;\n            }\n            const constant = this._context.createBufferSource();\n            constant.channelCount = 1;\n            constant.channelCountMode = \"explicit\";\n            constant.buffer = buffer;\n            constant.loop = true;\n            constant.start(0);\n            this._constants.set(val, constant);\n            return constant;\n        }\n    }\n    /**\n     * Clean up. Also closes the audio context.\n     */\n    dispose() {\n        super.dispose();\n        this._ticker.dispose();\n        this._timeouts.dispose();\n        Object.keys(this._constants).map((val) => this._constants[val].disconnect());\n        this.close();\n        return this;\n    }\n    //---------------------------\n    // TIMEOUTS\n    //---------------------------\n    /**\n     * The private loop which keeps track of the context scheduled timeouts\n     * Is invoked from the clock source\n     */\n    _timeoutLoop() {\n        const now = this.now();\n        this._timeouts.forEachBefore(now, (event) => {\n            // invoke the callback\n            event.callback();\n            this._timeouts.remove(event);\n        });\n    }\n    /**\n     * A setTimeout which is guaranteed by the clock source.\n     * Also runs in the offline context.\n     * @param  fn       The callback to invoke\n     * @param  timeout  The timeout in seconds\n     * @returns ID to use when invoking Context.clearTimeout\n     */\n    setTimeout(fn, timeout) {\n        this._timeoutIds++;\n        const now = this.now();\n        this._timeouts.add({\n            callback: fn,\n            id: this._timeoutIds,\n            time: now + timeout,\n        });\n        return this._timeoutIds;\n    }\n    /**\n     * Clears a previously scheduled timeout with Tone.context.setTimeout\n     * @param  id  The ID returned from setTimeout\n     */\n    clearTimeout(id) {\n        this._timeouts.forEach((event) => {\n            if (event.id === id) {\n                this._timeouts.remove(event);\n            }\n        });\n        return this;\n    }\n    /**\n     * Clear the function scheduled by {@link setInterval}\n     */\n    clearInterval(id) {\n        return this.clearTimeout(id);\n    }\n    /**\n     * Adds a repeating event to the context's callback clock\n     */\n    setInterval(fn, interval) {\n        const id = ++this._timeoutIds;\n        const intervalFn = () => {\n            const now = this.now();\n            this._timeouts.add({\n                callback: () => {\n                    // invoke the callback\n                    fn();\n                    // invoke the event to repeat it\n                    intervalFn();\n                },\n                id,\n                time: now + interval,\n            });\n        };\n        // kick it off\n        intervalFn();\n        return id;\n    }\n}\n//# sourceMappingURL=Context.js.map","import { __awaiter } from \"tslib\";\nimport { BaseContext } from \"./BaseContext.js\";\nexport class DummyContext extends BaseContext {\n    constructor() {\n        super(...arguments);\n        this.lookAhead = 0;\n        this.latencyHint = 0;\n        this.isOffline = false;\n    }\n    //---------------------------\n    // BASE AUDIO CONTEXT METHODS\n    //---------------------------\n    createAnalyser() {\n        return {};\n    }\n    createOscillator() {\n        return {};\n    }\n    createBufferSource() {\n        return {};\n    }\n    createBiquadFilter() {\n        return {};\n    }\n    createBuffer(_numberOfChannels, _length, _sampleRate) {\n        return {};\n    }\n    createChannelMerger(_numberOfInputs) {\n        return {};\n    }\n    createChannelSplitter(_numberOfOutputs) {\n        return {};\n    }\n    createConstantSource() {\n        return {};\n    }\n    createConvolver() {\n        return {};\n    }\n    createDelay(_maxDelayTime) {\n        return {};\n    }\n    createDynamicsCompressor() {\n        return {};\n    }\n    createGain() {\n        return {};\n    }\n    createIIRFilter(_feedForward, _feedback) {\n        return {};\n    }\n    createPanner() {\n        return {};\n    }\n    createPeriodicWave(_real, _imag, _constraints) {\n        return {};\n    }\n    createStereoPanner() {\n        return {};\n    }\n    createWaveShaper() {\n        return {};\n    }\n    createMediaStreamSource(_stream) {\n        return {};\n    }\n    createMediaElementSource(_element) {\n        return {};\n    }\n    createMediaStreamDestination() {\n        return {};\n    }\n    decodeAudioData(_audioData) {\n        return Promise.resolve({});\n    }\n    //---------------------------\n    // TONE AUDIO CONTEXT METHODS\n    //---------------------------\n    createAudioWorkletNode(_name, _options) {\n        return {};\n    }\n    get rawContext() {\n        return {};\n    }\n    addAudioWorkletModule(_url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return Promise.resolve();\n        });\n    }\n    resume() {\n        return Promise.resolve();\n    }\n    setTimeout(_fn, _timeout) {\n        return 0;\n    }\n    clearTimeout(_id) {\n        return this;\n    }\n    setInterval(_fn, _interval) {\n        return 0;\n    }\n    clearInterval(_id) {\n        return this;\n    }\n    getConstant(_val) {\n        return {};\n    }\n    get currentTime() {\n        return 0;\n    }\n    get state() {\n        return {};\n    }\n    get sampleRate() {\n        return 0;\n    }\n    get listener() {\n        return {};\n    }\n    get transport() {\n        return {};\n    }\n    get draw() {\n        return {};\n    }\n    set draw(_d) { }\n    get destination() {\n        return {};\n    }\n    set destination(_d) { }\n    now() {\n        return 0;\n    }\n    immediate() {\n        return 0;\n    }\n}\n//# sourceMappingURL=DummyContext.js.map","import { isArray } from \"./TypeCheck.js\";\n/**\n * Make the property not writable using `defineProperty`. Internal use only.\n */\nexport function readOnly(target, property) {\n    if (isArray(property)) {\n        property.forEach((str) => readOnly(target, str));\n    }\n    else {\n        Object.defineProperty(target, property, {\n            enumerable: true,\n            writable: false,\n        });\n    }\n}\n/**\n * Make an attribute writeable. Internal use only.\n */\nexport function writable(target, property) {\n    if (isArray(property)) {\n        property.forEach((str) => writable(target, str));\n    }\n    else {\n        Object.defineProperty(target, property, {\n            writable: true,\n        });\n    }\n}\nexport const noOp = () => {\n    // no operation here!\n};\n//# sourceMappingURL=Interface.js.map","import { __awaiter } from \"tslib\";\nimport { getContext } from \"../Global.js\";\nimport { Tone } from \"../Tone.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { noOp } from \"../util/Interface.js\";\nimport { isArray, isNumber, isString } from \"../util/TypeCheck.js\";\nimport { assert } from \"../util/Debug.js\";\n/**\n * AudioBuffer loading and storage. ToneAudioBuffer is used internally by all\n * classes that make requests for audio files such as Tone.Player,\n * Tone.Sampler and Tone.Convolver.\n * @example\n * const buffer = new Tone.ToneAudioBuffer(\"https://tonejs.github.io/audio/casio/A1.mp3\", () => {\n * \tconsole.log(\"loaded\");\n * });\n * @category Core\n */\nexport class ToneAudioBuffer extends Tone {\n    constructor() {\n        super();\n        this.name = \"ToneAudioBuffer\";\n        /**\n         * Callback when the buffer is loaded.\n         */\n        this.onload = noOp;\n        const options = optionsFromArguments(ToneAudioBuffer.getDefaults(), arguments, [\"url\", \"onload\", \"onerror\"]);\n        this.reverse = options.reverse;\n        this.onload = options.onload;\n        if (isString(options.url)) {\n            // initiate the download\n            this.load(options.url).catch(options.onerror);\n        }\n        else if (options.url) {\n            this.set(options.url);\n        }\n    }\n    static getDefaults() {\n        return {\n            onerror: noOp,\n            onload: noOp,\n            reverse: false,\n        };\n    }\n    /**\n     * The sample rate of the AudioBuffer\n     */\n    get sampleRate() {\n        if (this._buffer) {\n            return this._buffer.sampleRate;\n        }\n        else {\n            return getContext().sampleRate;\n        }\n    }\n    /**\n     * Pass in an AudioBuffer or ToneAudioBuffer to set the value of this buffer.\n     */\n    set(buffer) {\n        if (buffer instanceof ToneAudioBuffer) {\n            // if it's loaded, set it\n            if (buffer.loaded) {\n                this._buffer = buffer.get();\n            }\n            else {\n                // otherwise when it's loaded, invoke it's callback\n                buffer.onload = () => {\n                    this.set(buffer);\n                    this.onload(this);\n                };\n            }\n        }\n        else {\n            this._buffer = buffer;\n        }\n        // reverse it initially\n        if (this._reversed) {\n            this._reverse();\n        }\n        return this;\n    }\n    /**\n     * The audio buffer stored in the object.\n     */\n    get() {\n        return this._buffer;\n    }\n    /**\n     * Makes an fetch request for the selected url then decodes the file as an audio buffer.\n     * Invokes the callback once the audio buffer loads.\n     * @param url The url of the buffer to load. filetype support depends on the browser.\n     * @returns A Promise which resolves with this ToneAudioBuffer\n     */\n    load(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const doneLoading = ToneAudioBuffer.load(url).then((audioBuffer) => {\n                this.set(audioBuffer);\n                // invoke the onload method\n                this.onload(this);\n            });\n            ToneAudioBuffer.downloads.push(doneLoading);\n            try {\n                yield doneLoading;\n            }\n            finally {\n                // remove the downloaded file\n                const index = ToneAudioBuffer.downloads.indexOf(doneLoading);\n                ToneAudioBuffer.downloads.splice(index, 1);\n            }\n            return this;\n        });\n    }\n    /**\n     * clean up\n     */\n    dispose() {\n        super.dispose();\n        this._buffer = undefined;\n        return this;\n    }\n    /**\n     * Set the audio buffer from the array.\n     * To create a multichannel AudioBuffer, pass in a multidimensional array.\n     * @param array The array to fill the audio buffer\n     */\n    fromArray(array) {\n        const isMultidimensional = isArray(array) && array[0].length > 0;\n        const channels = isMultidimensional ? array.length : 1;\n        const len = isMultidimensional\n            ? array[0].length\n            : array.length;\n        const context = getContext();\n        const buffer = context.createBuffer(channels, len, context.sampleRate);\n        const multiChannelArray = !isMultidimensional && channels === 1\n            ? [array]\n            : array;\n        for (let c = 0; c < channels; c++) {\n            buffer.copyToChannel(multiChannelArray[c], c);\n        }\n        this._buffer = buffer;\n        return this;\n    }\n    /**\n     * Sums multiple channels into 1 channel\n     * @param chanNum Optionally only copy a single channel from the array.\n     */\n    toMono(chanNum) {\n        if (isNumber(chanNum)) {\n            this.fromArray(this.toArray(chanNum));\n        }\n        else {\n            let outputArray = new Float32Array(this.length);\n            const numChannels = this.numberOfChannels;\n            for (let channel = 0; channel < numChannels; channel++) {\n                const channelArray = this.toArray(channel);\n                for (let i = 0; i < channelArray.length; i++) {\n                    outputArray[i] += channelArray[i];\n                }\n            }\n            // divide by the number of channels\n            outputArray = outputArray.map((sample) => sample / numChannels);\n            this.fromArray(outputArray);\n        }\n        return this;\n    }\n    /**\n     * Get the buffer as an array. Single channel buffers will return a 1-dimensional\n     * Float32Array, and multichannel buffers will return multidimensional arrays.\n     * @param channel Optionally only copy a single channel from the array.\n     */\n    toArray(channel) {\n        if (isNumber(channel)) {\n            return this.getChannelData(channel);\n        }\n        else if (this.numberOfChannels === 1) {\n            return this.toArray(0);\n        }\n        else {\n            const ret = [];\n            for (let c = 0; c < this.numberOfChannels; c++) {\n                ret[c] = this.getChannelData(c);\n            }\n            return ret;\n        }\n    }\n    /**\n     * Returns the Float32Array representing the PCM audio data for the specific channel.\n     * @param  channel  The channel number to return\n     * @return The audio as a TypedArray\n     */\n    getChannelData(channel) {\n        if (this._buffer) {\n            return this._buffer.getChannelData(channel);\n        }\n        else {\n            return new Float32Array(0);\n        }\n    }\n    /**\n     * Cut a subsection of the array and return a buffer of the\n     * subsection. Does not modify the original buffer\n     * @param start The time to start the slice\n     * @param end The end time to slice. If none is given will default to the end of the buffer\n     */\n    slice(start, end = this.duration) {\n        assert(this.loaded, \"Buffer is not loaded\");\n        const startSamples = Math.floor(start * this.sampleRate);\n        const endSamples = Math.floor(end * this.sampleRate);\n        assert(startSamples < endSamples, \"The start time must be less than the end time\");\n        const length = endSamples - startSamples;\n        const retBuffer = getContext().createBuffer(this.numberOfChannels, length, this.sampleRate);\n        for (let channel = 0; channel < this.numberOfChannels; channel++) {\n            retBuffer.copyToChannel(this.getChannelData(channel).subarray(startSamples, endSamples), channel);\n        }\n        return new ToneAudioBuffer(retBuffer);\n    }\n    /**\n     * Reverse the buffer.\n     */\n    _reverse() {\n        if (this.loaded) {\n            for (let i = 0; i < this.numberOfChannels; i++) {\n                this.getChannelData(i).reverse();\n            }\n        }\n        return this;\n    }\n    /**\n     * If the buffer is loaded or not\n     */\n    get loaded() {\n        return this.length > 0;\n    }\n    /**\n     * The duration of the buffer in seconds.\n     */\n    get duration() {\n        if (this._buffer) {\n            return this._buffer.duration;\n        }\n        else {\n            return 0;\n        }\n    }\n    /**\n     * The length of the buffer in samples\n     */\n    get length() {\n        if (this._buffer) {\n            return this._buffer.length;\n        }\n        else {\n            return 0;\n        }\n    }\n    /**\n     * The number of discrete audio channels. Returns 0 if no buffer is loaded.\n     */\n    get numberOfChannels() {\n        if (this._buffer) {\n            return this._buffer.numberOfChannels;\n        }\n        else {\n            return 0;\n        }\n    }\n    /**\n     * Reverse the buffer.\n     */\n    get reverse() {\n        return this._reversed;\n    }\n    set reverse(rev) {\n        if (this._reversed !== rev) {\n            this._reversed = rev;\n            this._reverse();\n        }\n    }\n    /**\n     * Create a ToneAudioBuffer from the array. To create a multichannel AudioBuffer,\n     * pass in a multidimensional array.\n     * @param array The array to fill the audio buffer\n     * @return A ToneAudioBuffer created from the array\n     */\n    static fromArray(array) {\n        return new ToneAudioBuffer().fromArray(array);\n    }\n    /**\n     * Creates a ToneAudioBuffer from a URL, returns a promise which resolves to a ToneAudioBuffer\n     * @param  url The url to load.\n     * @return A promise which resolves to a ToneAudioBuffer\n     */\n    static fromUrl(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const buffer = new ToneAudioBuffer();\n            return yield buffer.load(url);\n        });\n    }\n    /**\n     * Loads a url using fetch and returns the AudioBuffer.\n     */\n    static load(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            // make sure there is a slash between the baseUrl and the url\n            const baseUrl = ToneAudioBuffer.baseUrl === \"\" ||\n                ToneAudioBuffer.baseUrl.endsWith(\"/\")\n                ? ToneAudioBuffer.baseUrl\n                : ToneAudioBuffer.baseUrl + \"/\";\n            const response = yield fetch(baseUrl + url);\n            if (!response.ok) {\n                throw new Error(`could not load url: ${url}`);\n            }\n            const arrayBuffer = yield response.arrayBuffer();\n            const audioBuffer = yield getContext().decodeAudioData(arrayBuffer);\n            return audioBuffer;\n        });\n    }\n    /**\n     * Checks a url's extension to see if the current browser can play that file type.\n     * @param url The url/extension to test\n     * @return If the file extension can be played\n     * @static\n     * @example\n     * Tone.ToneAudioBuffer.supportsType(\"wav\"); // returns true\n     * Tone.ToneAudioBuffer.supportsType(\"path/to/file.wav\"); // returns true\n     */\n    static supportsType(url) {\n        const extensions = url.split(\".\");\n        const extension = extensions[extensions.length - 1];\n        const response = document\n            .createElement(\"audio\")\n            .canPlayType(\"audio/\" + extension);\n        return response !== \"\";\n    }\n    /**\n     * Returns a Promise which resolves when all of the buffers have loaded\n     */\n    static loaded() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // this makes sure that the function is always async\n            yield Promise.resolve();\n            while (ToneAudioBuffer.downloads.length) {\n                yield ToneAudioBuffer.downloads[0];\n            }\n        });\n    }\n}\n//-------------------------------------\n// STATIC METHODS\n//-------------------------------------\n/**\n * A path which is prefixed before every url.\n */\nToneAudioBuffer.baseUrl = \"\";\n/**\n * All of the downloads\n */\nToneAudioBuffer.downloads = [];\n//# sourceMappingURL=ToneAudioBuffer.js.map","import { __awaiter } from \"tslib\";\nimport { createOfflineAudioContext } from \"../context/AudioContext.js\";\nimport { Context } from \"../context/Context.js\";\nimport { isOfflineAudioContext } from \"../util/AdvancedTypeCheck.js\";\nimport { ToneAudioBuffer } from \"./ToneAudioBuffer.js\";\n/**\n * Wrapper around the OfflineAudioContext\n * @category Core\n * @example\n * // generate a single channel, 0.5 second buffer\n * const context = new Tone.OfflineContext(1, 0.5, 44100);\n * const osc = new Tone.Oscillator({ context });\n * context.render().then(buffer => {\n * \tconsole.log(buffer.numberOfChannels, buffer.duration);\n * });\n */\nexport class OfflineContext extends Context {\n    constructor() {\n        super({\n            clockSource: \"offline\",\n            context: isOfflineAudioContext(arguments[0])\n                ? arguments[0]\n                : createOfflineAudioContext(arguments[0], arguments[1] * arguments[2], arguments[2]),\n            lookAhead: 0,\n            updateInterval: isOfflineAudioContext(arguments[0])\n                ? 128 / arguments[0].sampleRate\n                : 128 / arguments[2],\n        });\n        this.name = \"OfflineContext\";\n        /**\n         * An artificial clock source\n         */\n        this._currentTime = 0;\n        this.isOffline = true;\n        this._duration = isOfflineAudioContext(arguments[0])\n            ? arguments[0].length / arguments[0].sampleRate\n            : arguments[1];\n    }\n    /**\n     * Override the now method to point to the internal clock time\n     */\n    now() {\n        return this._currentTime;\n    }\n    /**\n     * Same as this.now()\n     */\n    get currentTime() {\n        return this._currentTime;\n    }\n    /**\n     * Render just the clock portion of the audio context.\n     */\n    _renderClock(asynchronous) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let index = 0;\n            while (this._duration - this._currentTime >= 0) {\n                // invoke all the callbacks on that time\n                this.emit(\"tick\");\n                // increment the clock in block-sized chunks\n                this._currentTime += 128 / this.sampleRate;\n                // yield once a second of audio\n                index++;\n                const yieldEvery = Math.floor(this.sampleRate / 128);\n                if (asynchronous && index % yieldEvery === 0) {\n                    yield new Promise((done) => setTimeout(done, 1));\n                }\n            }\n        });\n    }\n    /**\n     * Render the output of the OfflineContext\n     * @param asynchronous If the clock should be rendered asynchronously, which will not block the main thread, but be slightly slower.\n     */\n    render() {\n        return __awaiter(this, arguments, void 0, function* (asynchronous = true) {\n            yield this.workletsAreReady();\n            yield this._renderClock(asynchronous);\n            const buffer = yield this._context.startRendering();\n            return new ToneAudioBuffer(buffer);\n        });\n    }\n    /**\n     * Close the context\n     */\n    close() {\n        return Promise.resolve();\n    }\n}\n//# sourceMappingURL=OfflineContext.js.map","import { version } from \"../version.js\";\nimport { hasAudioContext, theWindow, } from \"./context/AudioContext.js\";\nimport { Context } from \"./context/Context.js\";\nimport { DummyContext } from \"./context/DummyContext.js\";\nimport { OfflineContext } from \"./context/OfflineContext.js\";\nimport { isAudioContext, isOfflineAudioContext, } from \"./util/AdvancedTypeCheck.js\";\n/**\n * This dummy context is used to avoid throwing immediate errors when importing in Node.js\n */\nconst dummyContext = new DummyContext();\n/**\n * The global audio context which is getable and assignable through\n * getContext and setContext\n */\nlet globalContext = dummyContext;\n/**\n * Returns the default system-wide {@link Context}\n * @category Core\n */\nexport function getContext() {\n    if (globalContext === dummyContext && hasAudioContext) {\n        setContext(new Context());\n    }\n    return globalContext;\n}\n/**\n * Set the default audio context\n * @param context\n * @param disposeOld Pass `true` if you don't need the old context to dispose it.\n * @category Core\n */\nexport function setContext(context, disposeOld = false) {\n    if (disposeOld) {\n        globalContext.dispose();\n    }\n    if (isAudioContext(context)) {\n        globalContext = new Context(context);\n    }\n    else if (isOfflineAudioContext(context)) {\n        globalContext = new OfflineContext(context);\n    }\n    else {\n        globalContext = context;\n    }\n}\n/**\n * Most browsers will not play _any_ audio until a user\n * clicks something (like a play button). Invoke this method\n * on a click or keypress event handler to start the audio context.\n * More about the Autoplay policy\n * [here](https://developers.google.com/web/updates/2017/09/autoplay-policy-changes#webaudio)\n * @example\n * document.querySelector(\"button\").addEventListener(\"click\", async () => {\n * \tawait Tone.start();\n * \tconsole.log(\"context started\");\n * });\n * @category Core\n */\nexport function start() {\n    return globalContext.resume();\n}\n/**\n * Log Tone.js + version in the console.\n */\nif (theWindow && !theWindow.TONE_SILENCE_LOGGING) {\n    let prefix = \"v\";\n    if (version === \"dev\") {\n        prefix = \"\";\n    }\n    const printString = ` * Tone.js ${prefix}${version} * `;\n    // eslint-disable-next-line no-console\n    console.log(`%c${printString}`, \"background: #000; color: #fff\");\n}\n//# sourceMappingURL=Global.js.map","/**\n * Equal power gain scale. Good for cross-fading.\n * @param  percent (0-1)\n */\nexport function equalPowerScale(percent) {\n    const piFactor = 0.5 * Math.PI;\n    return Math.sin(percent * piFactor);\n}\n/**\n * Convert decibels into gain.\n */\nexport function dbToGain(db) {\n    return Math.pow(10, db / 20);\n}\n/**\n * Convert gain to decibels.\n */\nexport function gainToDb(gain) {\n    return 20 * (Math.log(gain) / Math.LN10);\n}\n/**\n * Convert an interval (in semitones) to a frequency ratio.\n * @param interval the number of semitones above the base note\n * @example\n * Tone.intervalToFrequencyRatio(0); // 1\n * Tone.intervalToFrequencyRatio(12); // 2\n * Tone.intervalToFrequencyRatio(-12); // 0.5\n */\nexport function intervalToFrequencyRatio(interval) {\n    return Math.pow(2, interval / 12);\n}\n/**\n * The Global [concert tuning pitch](https://en.wikipedia.org/wiki/Concert_pitch) which is used\n * to generate all the other pitch values from notes. A4's values in Hertz.\n */\nlet A4 = 440;\nexport function getA4() {\n    return A4;\n}\nexport function setA4(freq) {\n    A4 = freq;\n}\n/**\n * Convert a frequency value to a MIDI note.\n * @param frequency The value to frequency value to convert.\n * @example\n * Tone.ftom(440); // returns 69\n */\nexport function ftom(frequency) {\n    return Math.round(ftomf(frequency));\n}\n/**\n * Convert a frequency to a floating point midi value\n */\nexport function ftomf(frequency) {\n    return 69 + 12 * Math.log2(frequency / A4);\n}\n/**\n * Convert a MIDI note to frequency value.\n * @param  midi The midi number to convert.\n * @return The corresponding frequency value\n * @example\n * Tone.mtof(69); // 440\n */\nexport function mtof(midi) {\n    return A4 * Math.pow(2, (midi - 69) / 12);\n}\n//# sourceMappingURL=Conversions.js.map","import { Tone } from \"../Tone.js\";\nimport { isDefined, isObject, isString, isUndef } from \"../util/TypeCheck.js\";\n/**\n * TimeBase is a flexible encoding of time which can be evaluated to and from a string.\n */\nexport class TimeBaseClass extends Tone {\n    /**\n     * @param context The context associated with the time value. Used to compute\n     * Transport and context-relative timing.\n     * @param  value  The time value as a number, string or object\n     * @param  units  Unit values\n     */\n    constructor(context, value, units) {\n        super();\n        /**\n         * The default units\n         */\n        this.defaultUnits = \"s\";\n        this._val = value;\n        this._units = units;\n        this.context = context;\n        this._expressions = this._getExpressions();\n    }\n    /**\n     * All of the time encoding expressions\n     */\n    _getExpressions() {\n        return {\n            hz: {\n                method: (value) => {\n                    return this._frequencyToUnits(parseFloat(value));\n                },\n                regexp: /^(\\d+(?:\\.\\d+)?)hz$/i,\n            },\n            i: {\n                method: (value) => {\n                    return this._ticksToUnits(parseInt(value, 10));\n                },\n                regexp: /^(\\d+)i$/i,\n            },\n            m: {\n                method: (value) => {\n                    return this._beatsToUnits(parseInt(value, 10) * this._getTimeSignature());\n                },\n                regexp: /^(\\d+)m$/i,\n            },\n            n: {\n                method: (value, dot) => {\n                    const numericValue = parseInt(value, 10);\n                    const scalar = dot === \".\" ? 1.5 : 1;\n                    if (numericValue === 1) {\n                        return (this._beatsToUnits(this._getTimeSignature()) *\n                            scalar);\n                    }\n                    else {\n                        return (this._beatsToUnits(4 / numericValue) *\n                            scalar);\n                    }\n                },\n                regexp: /^(\\d+)n(\\.?)$/i,\n            },\n            number: {\n                method: (value) => {\n                    return this._expressions[this.defaultUnits].method.call(this, value);\n                },\n                regexp: /^(\\d+(?:\\.\\d+)?)$/,\n            },\n            s: {\n                method: (value) => {\n                    return this._secondsToUnits(parseFloat(value));\n                },\n                regexp: /^(\\d+(?:\\.\\d+)?)s$/,\n            },\n            samples: {\n                method: (value) => {\n                    return (parseInt(value, 10) /\n                        this.context.sampleRate);\n                },\n                regexp: /^(\\d+)samples$/,\n            },\n            t: {\n                method: (value) => {\n                    const numericValue = parseInt(value, 10);\n                    return this._beatsToUnits(8 / (Math.floor(numericValue) * 3));\n                },\n                regexp: /^(\\d+)t$/i,\n            },\n            tr: {\n                method: (m, q, s) => {\n                    let total = 0;\n                    if (m && m !== \"0\") {\n                        total += this._beatsToUnits(this._getTimeSignature() * parseFloat(m));\n                    }\n                    if (q && q !== \"0\") {\n                        total += this._beatsToUnits(parseFloat(q));\n                    }\n                    if (s && s !== \"0\") {\n                        total += this._beatsToUnits(parseFloat(s) / 4);\n                    }\n                    return total;\n                },\n                regexp: /^(\\d+(?:\\.\\d+)?):(\\d+(?:\\.\\d+)?):?(\\d+(?:\\.\\d+)?)?$/,\n            },\n        };\n    }\n    //-------------------------------------\n    // \tVALUE OF\n    //-------------------------------------\n    /**\n     * Evaluate the time value. Returns the time in seconds.\n     */\n    valueOf() {\n        if (this._val instanceof TimeBaseClass) {\n            this.fromType(this._val);\n        }\n        if (isUndef(this._val)) {\n            return this._noArg();\n        }\n        else if (isString(this._val) && isUndef(this._units)) {\n            for (const units in this._expressions) {\n                if (this._expressions[units].regexp.test(this._val.trim())) {\n                    this._units = units;\n                    break;\n                }\n            }\n        }\n        else if (isObject(this._val)) {\n            let total = 0;\n            for (const typeName in this._val) {\n                if (isDefined(this._val[typeName])) {\n                    const quantity = this._val[typeName];\n                    const time = \n                    // @ts-ignore\n                    new this.constructor(this.context, typeName).valueOf() *\n                        quantity;\n                    total += time;\n                }\n            }\n            return total;\n        }\n        if (isDefined(this._units)) {\n            const expr = this._expressions[this._units];\n            const matching = this._val.toString().trim().match(expr.regexp);\n            if (matching) {\n                return expr.method.apply(this, matching.slice(1));\n            }\n            else {\n                return expr.method.call(this, this._val);\n            }\n        }\n        else if (isString(this._val)) {\n            return parseFloat(this._val);\n        }\n        else {\n            return this._val;\n        }\n    }\n    //-------------------------------------\n    // \tUNIT CONVERSIONS\n    //-------------------------------------\n    /**\n     * Returns the value of a frequency in the current units\n     */\n    _frequencyToUnits(freq) {\n        return (1 / freq);\n    }\n    /**\n     * Return the value of the beats in the current units\n     */\n    _beatsToUnits(beats) {\n        return ((60 / this._getBpm()) * beats);\n    }\n    /**\n     * Returns the value of a second in the current units\n     */\n    _secondsToUnits(seconds) {\n        return seconds;\n    }\n    /**\n     * Returns the value of a tick in the current time units\n     */\n    _ticksToUnits(ticks) {\n        return ((ticks * this._beatsToUnits(1)) / this._getPPQ());\n    }\n    /**\n     * With no arguments, return 'now'\n     */\n    _noArg() {\n        return this._now();\n    }\n    //-------------------------------------\n    // \tTEMPO CONVERSIONS\n    //-------------------------------------\n    /**\n     * Return the bpm\n     */\n    _getBpm() {\n        return this.context.transport.bpm.value;\n    }\n    /**\n     * Return the timeSignature\n     */\n    _getTimeSignature() {\n        return this.context.transport.timeSignature;\n    }\n    /**\n     * Return the PPQ or 192 if Transport is not available\n     */\n    _getPPQ() {\n        return this.context.transport.PPQ;\n    }\n    //-------------------------------------\n    // \tCONVERSION INTERFACE\n    //-------------------------------------\n    /**\n     * Coerce a time type into this units type.\n     * @param type Any time type units\n     */\n    fromType(type) {\n        this._units = undefined;\n        switch (this.defaultUnits) {\n            case \"s\":\n                this._val = type.toSeconds();\n                break;\n            case \"i\":\n                this._val = type.toTicks();\n                break;\n            case \"hz\":\n                this._val = type.toFrequency();\n                break;\n            case \"midi\":\n                this._val = type.toMidi();\n                break;\n        }\n        return this;\n    }\n    /**\n     * Return the value in hertz\n     */\n    toFrequency() {\n        return 1 / this.toSeconds();\n    }\n    /**\n     * Return the time in samples\n     */\n    toSamples() {\n        return this.toSeconds() * this.context.sampleRate;\n    }\n    /**\n     * Return the time in milliseconds.\n     */\n    toMilliseconds() {\n        return this.toSeconds() * 1000;\n    }\n}\n//# sourceMappingURL=TimeBase.js.map","import { getContext } from \"../Global.js\";\nimport { ftom } from \"./Conversions.js\";\nimport { TimeBaseClass, } from \"./TimeBase.js\";\n/**\n * TimeClass is a primitive type for encoding and decoding Time values.\n * TimeClass can be passed into the parameter of any method which takes time as an argument.\n * @param  val    The time value.\n * @param  units  The units of the value.\n * @example\n * const time = Tone.Time(\"4n\"); // a quarter note\n * @category Unit\n */\nexport class TimeClass extends TimeBaseClass {\n    constructor() {\n        super(...arguments);\n        this.name = \"TimeClass\";\n    }\n    _getExpressions() {\n        return Object.assign(super._getExpressions(), {\n            now: {\n                method: (capture) => {\n                    return (this._now() +\n                        new this.constructor(this.context, capture).valueOf());\n                },\n                regexp: /^\\+(.+)/,\n            },\n            quantize: {\n                method: (capture) => {\n                    const quantTo = new TimeClass(this.context, capture).valueOf();\n                    return this._secondsToUnits(this.context.transport.nextSubdivision(quantTo));\n                },\n                regexp: /^@(.+)/,\n            },\n        });\n    }\n    /**\n     * Quantize the time by the given subdivision. Optionally add a\n     * percentage which will move the time value towards the ideal\n     * quantized value by that percentage.\n     * @param  subdiv    The subdivision to quantize to\n     * @param  percent  Move the time value towards the quantized value by a percentage.\n     * @example\n     * Tone.Time(21).quantize(2); // returns 22\n     * Tone.Time(0.6).quantize(\"4n\", 0.5); // returns 0.55\n     */\n    quantize(subdiv, percent = 1) {\n        const subdivision = new this.constructor(this.context, subdiv).valueOf();\n        const value = this.valueOf();\n        const multiple = Math.round(value / subdivision);\n        const ideal = multiple * subdivision;\n        const diff = ideal - value;\n        return (value + diff * percent);\n    }\n    //-------------------------------------\n    // CONVERSIONS\n    //-------------------------------------\n    /**\n     * Convert a Time to Notation. The notation values are will be the\n     * closest representation between 1m to 128th note.\n     * @return {Notation}\n     * @example\n     * // if the Transport is at 120bpm:\n     * Tone.Time(2).toNotation(); // returns \"1m\"\n     */\n    toNotation() {\n        const time = this.toSeconds();\n        const testNotations = [\"1m\"];\n        for (let power = 1; power < 9; power++) {\n            const subdiv = Math.pow(2, power);\n            testNotations.push((subdiv + \"n.\"));\n            testNotations.push((subdiv + \"n\"));\n            testNotations.push((subdiv + \"t\"));\n        }\n        testNotations.push(\"0\");\n        // find the closets notation representation\n        let closest = testNotations[0];\n        let closestSeconds = new TimeClass(this.context, testNotations[0]).toSeconds();\n        testNotations.forEach((notation) => {\n            const notationSeconds = new TimeClass(this.context, notation).toSeconds();\n            if (Math.abs(notationSeconds - time) <\n                Math.abs(closestSeconds - time)) {\n                closest = notation;\n                closestSeconds = notationSeconds;\n            }\n        });\n        return closest;\n    }\n    /**\n     * Return the time encoded as Bars:Beats:Sixteenths.\n     */\n    toBarsBeatsSixteenths() {\n        const quarterTime = this._beatsToUnits(1);\n        let quarters = this.valueOf() / quarterTime;\n        quarters = parseFloat(quarters.toFixed(4));\n        const measures = Math.floor(quarters / this._getTimeSignature());\n        let sixteenths = (quarters % 1) * 4;\n        quarters = Math.floor(quarters) % this._getTimeSignature();\n        const sixteenthString = sixteenths.toString();\n        if (sixteenthString.length > 3) {\n            // the additional parseFloat removes insignificant trailing zeroes\n            sixteenths = parseFloat(parseFloat(sixteenthString).toFixed(3));\n        }\n        const progress = [measures, quarters, sixteenths];\n        return progress.join(\":\");\n    }\n    /**\n     * Return the time in ticks.\n     */\n    toTicks() {\n        const quarterTime = this._beatsToUnits(1);\n        const quarters = this.valueOf() / quarterTime;\n        return quarters * this._getPPQ();\n    }\n    /**\n     * Return the time in seconds.\n     */\n    toSeconds() {\n        return this.valueOf();\n    }\n    /**\n     * Return the value as a midi note.\n     */\n    toMidi() {\n        return ftom(this.toFrequency());\n    }\n    _now() {\n        return this.context.now();\n    }\n}\n/**\n * Create a TimeClass from a time string or number. The time is computed against the\n * global Tone.Context. To use a specific context, use {@link TimeClass}\n * @param value A value which represents time\n * @param units The value's units if they can't be inferred by the value.\n * @category Unit\n * @example\n * const time = Tone.Time(\"4n\").toSeconds();\n * console.log(time);\n * @example\n * const note = Tone.Time(1).toNotation();\n * console.log(note);\n * @example\n * const freq = Tone.Time(0.5).toFrequency();\n * console.log(freq);\n */\nexport function Time(value, units) {\n    return new TimeClass(getContext(), value, units);\n}\n//# sourceMappingURL=Time.js.map","/* eslint-disable key-spacing */\nimport { getContext } from \"../Global.js\";\nimport { intervalToFrequencyRatio, mtof } from \"./Conversions.js\";\nimport { ftom, getA4, setA4 } from \"./Conversions.js\";\nimport { TimeClass } from \"./Time.js\";\n/**\n * Frequency is a primitive type for encoding Frequency values.\n * Eventually all time values are evaluated to hertz using the `valueOf` method.\n * @example\n * Tone.Frequency(\"C3\"); // 261\n * Tone.Frequency(38, \"midi\");\n * Tone.Frequency(\"C3\").transpose(4);\n * @category Unit\n */\nexport class FrequencyClass extends TimeClass {\n    constructor() {\n        super(...arguments);\n        this.name = \"Frequency\";\n        this.defaultUnits = \"hz\";\n    }\n    /**\n     * The [concert tuning pitch](https://en.wikipedia.org/wiki/Concert_pitch) which is used\n     * to generate all the other pitch values from notes. A4's values in Hertz.\n     */\n    static get A4() {\n        return getA4();\n    }\n    static set A4(freq) {\n        setA4(freq);\n    }\n    //-------------------------------------\n    // \tAUGMENT BASE EXPRESSIONS\n    //-------------------------------------\n    _getExpressions() {\n        return Object.assign({}, super._getExpressions(), {\n            midi: {\n                regexp: /^(\\d+(?:\\.\\d+)?midi)/,\n                method(value) {\n                    if (this.defaultUnits === \"midi\") {\n                        return value;\n                    }\n                    else {\n                        return FrequencyClass.mtof(value);\n                    }\n                },\n            },\n            note: {\n                regexp: /^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,\n                method(pitch, octave) {\n                    const index = noteToScaleIndex[pitch.toLowerCase()];\n                    const noteNumber = index + (parseInt(octave, 10) + 1) * 12;\n                    if (this.defaultUnits === \"midi\") {\n                        return noteNumber;\n                    }\n                    else {\n                        return FrequencyClass.mtof(noteNumber);\n                    }\n                },\n            },\n            tr: {\n                regexp: /^(\\d+(?:\\.\\d+)?):(\\d+(?:\\.\\d+)?):?(\\d+(?:\\.\\d+)?)?/,\n                method(m, q, s) {\n                    let total = 1;\n                    if (m && m !== \"0\") {\n                        total *= this._beatsToUnits(this._getTimeSignature() * parseFloat(m));\n                    }\n                    if (q && q !== \"0\") {\n                        total *= this._beatsToUnits(parseFloat(q));\n                    }\n                    if (s && s !== \"0\") {\n                        total *= this._beatsToUnits(parseFloat(s) / 4);\n                    }\n                    return total;\n                },\n            },\n        });\n    }\n    //-------------------------------------\n    // \tEXPRESSIONS\n    //-------------------------------------\n    /**\n     * Transposes the frequency by the given number of semitones.\n     * @return  A new transposed frequency\n     * @example\n     * Tone.Frequency(\"A4\").transpose(3); // \"C5\"\n     */\n    transpose(interval) {\n        return new FrequencyClass(this.context, this.valueOf() * intervalToFrequencyRatio(interval));\n    }\n    /**\n     * Takes an array of semitone intervals and returns\n     * an array of frequencies transposed by those intervals.\n     * @return  Returns an array of Frequencies\n     * @example\n     * Tone.Frequency(\"A4\").harmonize([0, 3, 7]); // [\"A4\", \"C5\", \"E5\"]\n     */\n    harmonize(intervals) {\n        return intervals.map((interval) => {\n            return this.transpose(interval);\n        });\n    }\n    //-------------------------------------\n    // \tUNIT CONVERSIONS\n    //-------------------------------------\n    /**\n     * Return the value of the frequency as a MIDI note\n     * @example\n     * Tone.Frequency(\"C4\").toMidi(); // 60\n     */\n    toMidi() {\n        return ftom(this.valueOf());\n    }\n    /**\n     * Return the value of the frequency in Scientific Pitch Notation\n     * @example\n     * Tone.Frequency(69, \"midi\").toNote(); // \"A4\"\n     */\n    toNote() {\n        const freq = this.toFrequency();\n        const log = Math.log2(freq / FrequencyClass.A4);\n        let noteNumber = Math.round(12 * log) + 57;\n        const octave = Math.floor(noteNumber / 12);\n        if (octave < 0) {\n            noteNumber += -12 * octave;\n        }\n        const noteName = scaleIndexToNote[noteNumber % 12];\n        return (noteName + octave.toString());\n    }\n    /**\n     * Return the duration of one cycle in seconds.\n     */\n    toSeconds() {\n        return 1 / super.toSeconds();\n    }\n    /**\n     * Return the duration of one cycle in ticks\n     */\n    toTicks() {\n        const quarterTime = this._beatsToUnits(1);\n        const quarters = this.valueOf() / quarterTime;\n        return Math.floor(quarters * this._getPPQ());\n    }\n    //-------------------------------------\n    // \tUNIT CONVERSIONS HELPERS\n    //-------------------------------------\n    /**\n     * With no arguments, return 0\n     */\n    _noArg() {\n        return 0;\n    }\n    /**\n     * Returns the value of a frequency in the current units\n     */\n    _frequencyToUnits(freq) {\n        return freq;\n    }\n    /**\n     * Returns the value of a tick in the current time units\n     */\n    _ticksToUnits(ticks) {\n        return (1 / ((ticks * 60) / (this._getBpm() * this._getPPQ())));\n    }\n    /**\n     * Return the value of the beats in the current units\n     */\n    _beatsToUnits(beats) {\n        return (1 / super._beatsToUnits(beats));\n    }\n    /**\n     * Returns the value of a second in the current units\n     */\n    _secondsToUnits(seconds) {\n        return (1 / seconds);\n    }\n    /**\n     * Convert a MIDI note to frequency value.\n     * @param  midi The midi number to convert.\n     * @return The corresponding frequency value\n     */\n    static mtof(midi) {\n        return mtof(midi);\n    }\n    /**\n     * Convert a frequency value to a MIDI note.\n     * @param frequency The value to frequency value to convert.\n     */\n    static ftom(frequency) {\n        return ftom(frequency);\n    }\n}\n//-------------------------------------\n// \tFREQUENCY CONVERSIONS\n//-------------------------------------\n/**\n * Note to scale index.\n * @hidden\n */\nconst noteToScaleIndex = {\n    cbbb: -3,\n    cbb: -2,\n    cb: -1,\n    c: 0,\n    \"c#\": 1,\n    cx: 2,\n    \"c##\": 2,\n    \"c###\": 3,\n    \"cx#\": 3,\n    \"c#x\": 3,\n    dbbb: -1,\n    dbb: 0,\n    db: 1,\n    d: 2,\n    \"d#\": 3,\n    dx: 4,\n    \"d##\": 4,\n    \"d###\": 5,\n    \"dx#\": 5,\n    \"d#x\": 5,\n    ebbb: 1,\n    ebb: 2,\n    eb: 3,\n    e: 4,\n    \"e#\": 5,\n    ex: 6,\n    \"e##\": 6,\n    \"e###\": 7,\n    \"ex#\": 7,\n    \"e#x\": 7,\n    fbbb: 2,\n    fbb: 3,\n    fb: 4,\n    f: 5,\n    \"f#\": 6,\n    fx: 7,\n    \"f##\": 7,\n    \"f###\": 8,\n    \"fx#\": 8,\n    \"f#x\": 8,\n    gbbb: 4,\n    gbb: 5,\n    gb: 6,\n    g: 7,\n    \"g#\": 8,\n    gx: 9,\n    \"g##\": 9,\n    \"g###\": 10,\n    \"gx#\": 10,\n    \"g#x\": 10,\n    abbb: 6,\n    abb: 7,\n    ab: 8,\n    a: 9,\n    \"a#\": 10,\n    ax: 11,\n    \"a##\": 11,\n    \"a###\": 12,\n    \"ax#\": 12,\n    \"a#x\": 12,\n    bbbb: 8,\n    bbb: 9,\n    bb: 10,\n    b: 11,\n    \"b#\": 12,\n    bx: 13,\n    \"b##\": 13,\n    \"b###\": 14,\n    \"bx#\": 14,\n    \"b#x\": 14,\n};\n/**\n * scale index to note (sharps)\n * @hidden\n */\nconst scaleIndexToNote = [\n    \"C\",\n    \"C#\",\n    \"D\",\n    \"D#\",\n    \"E\",\n    \"F\",\n    \"F#\",\n    \"G\",\n    \"G#\",\n    \"A\",\n    \"A#\",\n    \"B\",\n];\n/**\n * Convert a value into a FrequencyClass object.\n * @category Unit\n * @example\n * const midi = Tone.Frequency(\"C3\").toMidi();\n * console.log(midi);\n * @example\n * const hertz = Tone.Frequency(38, \"midi\").toFrequency();\n * console.log(hertz);\n */\nexport function Frequency(value, units) {\n    return new FrequencyClass(getContext(), value, units);\n}\n//# sourceMappingURL=Frequency.js.map","import { getContext } from \"../Global.js\";\nimport { TimeClass } from \"./Time.js\";\n/**\n * TransportTime is a time along the Transport's\n * timeline. It is similar to Tone.Time, but instead of evaluating\n * against the AudioContext's clock, it is evaluated against\n * the Transport's position. See [TransportTime wiki](https://github.com/Tonejs/Tone.js/wiki/TransportTime).\n * @category Unit\n */\nexport class TransportTimeClass extends TimeClass {\n    constructor() {\n        super(...arguments);\n        this.name = \"TransportTime\";\n    }\n    /**\n     * Return the current time in whichever context is relevant\n     */\n    _now() {\n        return this.context.transport.seconds;\n    }\n}\n/**\n * TransportTime is a time along the Transport's\n * timeline. It is similar to Tone.Time, but instead of evaluating\n * against the AudioContext's clock, it is evaluated against\n * the Transport's position. See [TransportTime wiki](https://github.com/Tonejs/Tone.js/wiki/TransportTime).\n * @category Unit\n */\nexport function TransportTime(value, units) {\n    return new TransportTimeClass(getContext(), value, units);\n}\n//# sourceMappingURL=TransportTime.js.map","import { getContext } from \"../Global.js\";\nimport { Tone } from \"../Tone.js\";\nimport { FrequencyClass } from \"../type/Frequency.js\";\nimport { TimeClass } from \"../type/Time.js\";\nimport { TransportTimeClass } from \"../type/TransportTime.js\";\nimport { assertUsedScheduleTime } from \"../util/Debug.js\";\nimport { getDefaultsFromInstance, optionsFromArguments, } from \"../util/Defaults.js\";\nimport { isArray, isBoolean, isDefined, isNumber, isString, isUndef, } from \"../util/TypeCheck.js\";\n/**\n * The Base class for all nodes that have an AudioContext.\n */\nexport class ToneWithContext extends Tone {\n    constructor() {\n        super();\n        const options = optionsFromArguments(ToneWithContext.getDefaults(), arguments, [\"context\"]);\n        if (this.defaultContext) {\n            this.context = this.defaultContext;\n        }\n        else {\n            this.context = options.context;\n        }\n    }\n    static getDefaults() {\n        return {\n            context: getContext(),\n        };\n    }\n    /**\n     * Return the current time of the Context clock plus the lookAhead.\n     * @example\n     * setInterval(() => {\n     * \tconsole.log(Tone.now());\n     * }, 100);\n     */\n    now() {\n        return this.context.currentTime + this.context.lookAhead;\n    }\n    /**\n     * Return the current time of the Context clock without any lookAhead.\n     * @example\n     * setInterval(() => {\n     * \tconsole.log(Tone.immediate());\n     * }, 100);\n     */\n    immediate() {\n        return this.context.currentTime;\n    }\n    /**\n     * The duration in seconds of one sample.\n     */\n    get sampleTime() {\n        return 1 / this.context.sampleRate;\n    }\n    /**\n     * The number of seconds of 1 processing block (128 samples)\n     * @example\n     * console.log(Tone.Destination.blockTime);\n     */\n    get blockTime() {\n        return 128 / this.context.sampleRate;\n    }\n    /**\n     * Convert the incoming time to seconds.\n     * This is calculated against the current {@link TransportClass} bpm\n     * @example\n     * const gain = new Tone.Gain();\n     * setInterval(() => console.log(gain.toSeconds(\"4n\")), 100);\n     * // ramp the tempo to 60 bpm over 30 seconds\n     * Tone.getTransport().bpm.rampTo(60, 30);\n     */\n    toSeconds(time) {\n        assertUsedScheduleTime(time);\n        return new TimeClass(this.context, time).toSeconds();\n    }\n    /**\n     * Convert the input to a frequency number\n     * @example\n     * const gain = new Tone.Gain();\n     * console.log(gain.toFrequency(\"4n\"));\n     */\n    toFrequency(freq) {\n        return new FrequencyClass(this.context, freq).toFrequency();\n    }\n    /**\n     * Convert the input time into ticks\n     * @example\n     * const gain = new Tone.Gain();\n     * console.log(gain.toTicks(\"4n\"));\n     */\n    toTicks(time) {\n        return new TransportTimeClass(this.context, time).toTicks();\n    }\n    //-------------------------------------\n    // \tGET/SET\n    //-------------------------------------\n    /**\n     * Get a subset of the properties which are in the partial props\n     */\n    _getPartialProperties(props) {\n        const options = this.get();\n        // remove attributes from the prop that are not in the partial\n        Object.keys(options).forEach((name) => {\n            if (isUndef(props[name])) {\n                delete options[name];\n            }\n        });\n        return options;\n    }\n    /**\n     * Get the object's attributes.\n     * @example\n     * const osc = new Tone.Oscillator();\n     * console.log(osc.get());\n     */\n    get() {\n        const defaults = getDefaultsFromInstance(this);\n        Object.keys(defaults).forEach((attribute) => {\n            if (Reflect.has(this, attribute)) {\n                const member = this[attribute];\n                if (isDefined(member) &&\n                    isDefined(member.value) &&\n                    isDefined(member.setValueAtTime)) {\n                    defaults[attribute] = member.value;\n                }\n                else if (member instanceof ToneWithContext) {\n                    defaults[attribute] = member._getPartialProperties(defaults[attribute]);\n                    // otherwise make sure it's a serializable type\n                }\n                else if (isArray(member) ||\n                    isNumber(member) ||\n                    isString(member) ||\n                    isBoolean(member)) {\n                    defaults[attribute] = member;\n                }\n                else {\n                    // remove all undefined and unserializable attributes\n                    delete defaults[attribute];\n                }\n            }\n        });\n        return defaults;\n    }\n    /**\n     * Set multiple properties at once with an object.\n     * @example\n     * const filter = new Tone.Filter().toDestination();\n     * // set values using an object\n     * filter.set({\n     * \tfrequency: \"C6\",\n     * \ttype: \"highpass\"\n     * });\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/berklee/Analogsynth_octaves_highmid.mp3\").connect(filter);\n     * player.autostart = true;\n     */\n    set(props) {\n        Object.keys(props).forEach((attribute) => {\n            if (Reflect.has(this, attribute) && isDefined(this[attribute])) {\n                if (this[attribute] &&\n                    isDefined(this[attribute].value) &&\n                    isDefined(this[attribute].setValueAtTime)) {\n                    // small optimization\n                    if (this[attribute].value !== props[attribute]) {\n                        this[attribute].value = props[attribute];\n                    }\n                }\n                else if (this[attribute] instanceof ToneWithContext) {\n                    this[attribute].set(props[attribute]);\n                }\n                else {\n                    this[attribute] = props[attribute];\n                }\n            }\n        });\n        return this;\n    }\n}\n//# sourceMappingURL=ToneWithContext.js.map","import { Timeline } from \"./Timeline.js\";\nimport { assertRange } from \"./Debug.js\";\n/**\n * A Timeline State. Provides the methods: `setStateAtTime(\"state\", time)` and `getValueAtTime(time)`\n * @param initial The initial state of the StateTimeline.  Defaults to `undefined`\n * @internal\n */\nexport class StateTimeline extends Timeline {\n    constructor(initial = \"stopped\") {\n        super();\n        this.name = \"StateTimeline\";\n        this._initial = initial;\n        this.setStateAtTime(this._initial, 0);\n    }\n    /**\n     * Returns the scheduled state scheduled before or at\n     * the given time.\n     * @param  time  The time to query.\n     * @return  The name of the state input in setStateAtTime.\n     */\n    getValueAtTime(time) {\n        const event = this.get(time);\n        if (event !== null) {\n            return event.state;\n        }\n        else {\n            return this._initial;\n        }\n    }\n    /**\n     * Add a state to the timeline.\n     * @param  state The name of the state to set.\n     * @param  time  The time to query.\n     * @param options Any additional options that are needed in the timeline.\n     */\n    setStateAtTime(state, time, options) {\n        assertRange(time, 0);\n        this.add(Object.assign({}, options, {\n            state,\n            time,\n        }));\n        return this;\n    }\n    /**\n     * Return the event before the time with the given state\n     * @param  state The state to look for\n     * @param  time  When to check before\n     * @return  The event with the given state before the time\n     */\n    getLastState(state, time) {\n        // time = this.toSeconds(time);\n        const index = this._search(time);\n        for (let i = index; i >= 0; i--) {\n            const event = this._timeline[i];\n            if (event.state === state) {\n                return event;\n            }\n        }\n    }\n    /**\n     * Return the event after the time with the given state\n     * @param  state The state to look for\n     * @param  time  When to check from\n     * @return  The event with the given state after the time\n     */\n    getNextState(state, time) {\n        // time = this.toSeconds(time);\n        const index = this._search(time);\n        if (index !== -1) {\n            for (let i = index; i < this._timeline.length; i++) {\n                const event = this._timeline[i];\n                if (event.state === state) {\n                    return event;\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=StateTimeline.js.map","import { dbToGain, gainToDb } from \"../type/Conversions.js\";\nimport { isAudioParam } from \"../util/AdvancedTypeCheck.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { Timeline } from \"../util/Timeline.js\";\nimport { isDefined } from \"../util/TypeCheck.js\";\nimport { ToneWithContext } from \"./ToneWithContext.js\";\nimport { EQ } from \"../util/Math.js\";\nimport { assert, assertRange } from \"../util/Debug.js\";\n/**\n * Param wraps the native Web Audio's AudioParam to provide\n * additional unit conversion functionality. It also\n * serves as a base-class for classes which have a single,\n * automatable parameter.\n * @category Core\n */\nexport class Param extends ToneWithContext {\n    constructor() {\n        const options = optionsFromArguments(Param.getDefaults(), arguments, [\n            \"param\",\n            \"units\",\n            \"convert\",\n        ]);\n        super(options);\n        this.name = \"Param\";\n        this.overridden = false;\n        /**\n         * The minimum output value\n         */\n        this._minOutput = 1e-7;\n        assert(isDefined(options.param) &&\n            (isAudioParam(options.param) || options.param instanceof Param), \"param must be an AudioParam\");\n        while (!isAudioParam(options.param)) {\n            options.param = options.param._param;\n        }\n        this._swappable = isDefined(options.swappable)\n            ? options.swappable\n            : false;\n        if (this._swappable) {\n            this.input = this.context.createGain();\n            // initialize\n            this._param = options.param;\n            this.input.connect(this._param);\n        }\n        else {\n            this._param = this.input = options.param;\n        }\n        this._events = new Timeline(1000);\n        this._initialValue = this._param.defaultValue;\n        this.units = options.units;\n        this.convert = options.convert;\n        this._minValue = options.minValue;\n        this._maxValue = options.maxValue;\n        // if the value is defined, set it immediately\n        if (isDefined(options.value) &&\n            options.value !== this._toType(this._initialValue)) {\n            this.setValueAtTime(options.value, 0);\n        }\n    }\n    static getDefaults() {\n        return Object.assign(ToneWithContext.getDefaults(), {\n            convert: true,\n            units: \"number\",\n        });\n    }\n    get value() {\n        const now = this.now();\n        return this.getValueAtTime(now);\n    }\n    set value(value) {\n        this.cancelScheduledValues(this.now());\n        this.setValueAtTime(value, this.now());\n    }\n    get minValue() {\n        // if it's not the default minValue, return it\n        if (isDefined(this._minValue)) {\n            return this._minValue;\n        }\n        else if (this.units === \"time\" ||\n            this.units === \"frequency\" ||\n            this.units === \"normalRange\" ||\n            this.units === \"positive\" ||\n            this.units === \"transportTime\" ||\n            this.units === \"ticks\" ||\n            this.units === \"bpm\" ||\n            this.units === \"hertz\" ||\n            this.units === \"samples\") {\n            return 0;\n        }\n        else if (this.units === \"audioRange\") {\n            return -1;\n        }\n        else if (this.units === \"decibels\") {\n            return -Infinity;\n        }\n        else {\n            return this._param.minValue;\n        }\n    }\n    get maxValue() {\n        if (isDefined(this._maxValue)) {\n            return this._maxValue;\n        }\n        else if (this.units === \"normalRange\" ||\n            this.units === \"audioRange\") {\n            return 1;\n        }\n        else {\n            return this._param.maxValue;\n        }\n    }\n    /**\n     * Type guard based on the unit name\n     */\n    _is(arg, type) {\n        return this.units === type;\n    }\n    /**\n     * Make sure the value is always in the defined range\n     */\n    _assertRange(value) {\n        if (isDefined(this.maxValue) && isDefined(this.minValue)) {\n            assertRange(value, this._fromType(this.minValue), this._fromType(this.maxValue));\n        }\n        return value;\n    }\n    /**\n     * Convert the given value from the type specified by Param.units\n     * into the destination value (such as Gain or Frequency).\n     */\n    _fromType(val) {\n        if (this.convert && !this.overridden) {\n            if (this._is(val, \"time\")) {\n                return this.toSeconds(val);\n            }\n            else if (this._is(val, \"decibels\")) {\n                return dbToGain(val);\n            }\n            else if (this._is(val, \"frequency\")) {\n                return this.toFrequency(val);\n            }\n            else {\n                return val;\n            }\n        }\n        else if (this.overridden) {\n            // if it's overridden, should only schedule 0s\n            return 0;\n        }\n        else {\n            return val;\n        }\n    }\n    /**\n     * Convert the parameters value into the units specified by Param.units.\n     */\n    _toType(val) {\n        if (this.convert && this.units === \"decibels\") {\n            return gainToDb(val);\n        }\n        else {\n            return val;\n        }\n    }\n    //-------------------------------------\n    // ABSTRACT PARAM INTERFACE\n    // all docs are generated from ParamInterface.ts\n    //-------------------------------------\n    setValueAtTime(value, time) {\n        const computedTime = this.toSeconds(time);\n        const numericValue = this._fromType(value);\n        assert(isFinite(numericValue) && isFinite(computedTime), `Invalid argument(s) to setValueAtTime: ${JSON.stringify(value)}, ${JSON.stringify(time)}`);\n        this._assertRange(numericValue);\n        this.log(this.units, \"setValueAtTime\", value, computedTime);\n        this._events.add({\n            time: computedTime,\n            type: \"setValueAtTime\",\n            value: numericValue,\n        });\n        this._param.setValueAtTime(numericValue, computedTime);\n        return this;\n    }\n    getValueAtTime(time) {\n        const computedTime = Math.max(this.toSeconds(time), 0);\n        const after = this._events.getAfter(computedTime);\n        const before = this._events.get(computedTime);\n        let value = this._initialValue;\n        // if it was set by\n        if (before === null) {\n            value = this._initialValue;\n        }\n        else if (before.type === \"setTargetAtTime\" &&\n            (after === null || after.type === \"setValueAtTime\")) {\n            const previous = this._events.getBefore(before.time);\n            let previousVal;\n            if (previous === null) {\n                previousVal = this._initialValue;\n            }\n            else {\n                previousVal = previous.value;\n            }\n            if (before.type === \"setTargetAtTime\") {\n                value = this._exponentialApproach(before.time, previousVal, before.value, before.constant, computedTime);\n            }\n        }\n        else if (after === null) {\n            value = before.value;\n        }\n        else if (after.type === \"linearRampToValueAtTime\" ||\n            after.type === \"exponentialRampToValueAtTime\") {\n            let beforeValue = before.value;\n            if (before.type === \"setTargetAtTime\") {\n                const previous = this._events.getBefore(before.time);\n                if (previous === null) {\n                    beforeValue = this._initialValue;\n                }\n                else {\n                    beforeValue = previous.value;\n                }\n            }\n            if (after.type === \"linearRampToValueAtTime\") {\n                value = this._linearInterpolate(before.time, beforeValue, after.time, after.value, computedTime);\n            }\n            else {\n                value = this._exponentialInterpolate(before.time, beforeValue, after.time, after.value, computedTime);\n            }\n        }\n        else {\n            value = before.value;\n        }\n        return this._toType(value);\n    }\n    setRampPoint(time) {\n        time = this.toSeconds(time);\n        let currentVal = this.getValueAtTime(time);\n        this.cancelAndHoldAtTime(time);\n        if (this._fromType(currentVal) === 0) {\n            currentVal = this._toType(this._minOutput);\n        }\n        this.setValueAtTime(currentVal, time);\n        return this;\n    }\n    linearRampToValueAtTime(value, endTime) {\n        const numericValue = this._fromType(value);\n        const computedTime = this.toSeconds(endTime);\n        assert(isFinite(numericValue) && isFinite(computedTime), `Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(value)}, ${JSON.stringify(endTime)}`);\n        this._assertRange(numericValue);\n        this._events.add({\n            time: computedTime,\n            type: \"linearRampToValueAtTime\",\n            value: numericValue,\n        });\n        this.log(this.units, \"linearRampToValueAtTime\", value, computedTime);\n        this._param.linearRampToValueAtTime(numericValue, computedTime);\n        return this;\n    }\n    exponentialRampToValueAtTime(value, endTime) {\n        let numericValue = this._fromType(value);\n        // the value can't be 0\n        numericValue = EQ(numericValue, 0) ? this._minOutput : numericValue;\n        this._assertRange(numericValue);\n        const computedTime = this.toSeconds(endTime);\n        assert(isFinite(numericValue) && isFinite(computedTime), `Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(value)}, ${JSON.stringify(endTime)}`);\n        // store the event\n        this._events.add({\n            time: computedTime,\n            type: \"exponentialRampToValueAtTime\",\n            value: numericValue,\n        });\n        this.log(this.units, \"exponentialRampToValueAtTime\", value, computedTime);\n        this._param.exponentialRampToValueAtTime(numericValue, computedTime);\n        return this;\n    }\n    exponentialRampTo(value, rampTime, startTime) {\n        startTime = this.toSeconds(startTime);\n        this.setRampPoint(startTime);\n        this.exponentialRampToValueAtTime(value, startTime + this.toSeconds(rampTime));\n        return this;\n    }\n    linearRampTo(value, rampTime, startTime) {\n        startTime = this.toSeconds(startTime);\n        this.setRampPoint(startTime);\n        this.linearRampToValueAtTime(value, startTime + this.toSeconds(rampTime));\n        return this;\n    }\n    targetRampTo(value, rampTime, startTime) {\n        startTime = this.toSeconds(startTime);\n        this.setRampPoint(startTime);\n        this.exponentialApproachValueAtTime(value, startTime, rampTime);\n        return this;\n    }\n    exponentialApproachValueAtTime(value, time, rampTime) {\n        time = this.toSeconds(time);\n        rampTime = this.toSeconds(rampTime);\n        const timeConstant = Math.log(rampTime + 1) / Math.log(200);\n        this.setTargetAtTime(value, time, timeConstant);\n        // at 90% start a linear ramp to the final value\n        this.cancelAndHoldAtTime(time + rampTime * 0.9);\n        this.linearRampToValueAtTime(value, time + rampTime);\n        return this;\n    }\n    setTargetAtTime(value, startTime, timeConstant) {\n        const numericValue = this._fromType(value);\n        // The value will never be able to approach without timeConstant > 0.\n        assert(isFinite(timeConstant) && timeConstant > 0, \"timeConstant must be a number greater than 0\");\n        const computedTime = this.toSeconds(startTime);\n        this._assertRange(numericValue);\n        assert(isFinite(numericValue) && isFinite(computedTime), `Invalid argument(s) to setTargetAtTime: ${JSON.stringify(value)}, ${JSON.stringify(startTime)}`);\n        this._events.add({\n            constant: timeConstant,\n            time: computedTime,\n            type: \"setTargetAtTime\",\n            value: numericValue,\n        });\n        this.log(this.units, \"setTargetAtTime\", value, computedTime, timeConstant);\n        this._param.setTargetAtTime(numericValue, computedTime, timeConstant);\n        return this;\n    }\n    setValueCurveAtTime(values, startTime, duration, scaling = 1) {\n        duration = this.toSeconds(duration);\n        startTime = this.toSeconds(startTime);\n        const startingValue = this._fromType(values[0]) * scaling;\n        this.setValueAtTime(this._toType(startingValue), startTime);\n        const segTime = duration / (values.length - 1);\n        for (let i = 1; i < values.length; i++) {\n            const numericValue = this._fromType(values[i]) * scaling;\n            this.linearRampToValueAtTime(this._toType(numericValue), startTime + i * segTime);\n        }\n        return this;\n    }\n    cancelScheduledValues(time) {\n        const computedTime = this.toSeconds(time);\n        assert(isFinite(computedTime), `Invalid argument to cancelScheduledValues: ${JSON.stringify(time)}`);\n        this._events.cancel(computedTime);\n        this._param.cancelScheduledValues(computedTime);\n        this.log(this.units, \"cancelScheduledValues\", computedTime);\n        return this;\n    }\n    cancelAndHoldAtTime(time) {\n        const computedTime = this.toSeconds(time);\n        const valueAtTime = this._fromType(this.getValueAtTime(computedTime));\n        // remove the schedule events\n        assert(isFinite(computedTime), `Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(time)}`);\n        this.log(this.units, \"cancelAndHoldAtTime\", computedTime, \"value=\" + valueAtTime);\n        // if there is an event at the given computedTime\n        // and that even is not a \"set\"\n        const before = this._events.get(computedTime);\n        const after = this._events.getAfter(computedTime);\n        if (before && EQ(before.time, computedTime)) {\n            // remove everything after\n            if (after) {\n                this._param.cancelScheduledValues(after.time);\n                this._events.cancel(after.time);\n            }\n            else {\n                this._param.cancelAndHoldAtTime(computedTime);\n                this._events.cancel(computedTime + this.sampleTime);\n            }\n        }\n        else if (after) {\n            this._param.cancelScheduledValues(after.time);\n            // cancel the next event(s)\n            this._events.cancel(after.time);\n            if (after.type === \"linearRampToValueAtTime\") {\n                this.linearRampToValueAtTime(this._toType(valueAtTime), computedTime);\n            }\n            else if (after.type === \"exponentialRampToValueAtTime\") {\n                this.exponentialRampToValueAtTime(this._toType(valueAtTime), computedTime);\n            }\n        }\n        // set the value at the given time\n        this._events.add({\n            time: computedTime,\n            type: \"setValueAtTime\",\n            value: valueAtTime,\n        });\n        this._param.setValueAtTime(valueAtTime, computedTime);\n        return this;\n    }\n    rampTo(value, rampTime = 0.1, startTime) {\n        if (this.units === \"frequency\" ||\n            this.units === \"bpm\" ||\n            this.units === \"decibels\") {\n            this.exponentialRampTo(value, rampTime, startTime);\n        }\n        else {\n            this.linearRampTo(value, rampTime, startTime);\n        }\n        return this;\n    }\n    /**\n     * Apply all of the previously scheduled events to the passed in Param or AudioParam.\n     * The applied values will start at the context's current time and schedule\n     * all of the events which are scheduled on this Param onto the passed in param.\n     */\n    apply(param) {\n        const now = this.context.currentTime;\n        // set the param's value at the current time and schedule everything else\n        param.setValueAtTime(this.getValueAtTime(now), now);\n        // if the previous event was a curve, then set the rest of it\n        const previousEvent = this._events.get(now);\n        if (previousEvent && previousEvent.type === \"setTargetAtTime\") {\n            // approx it until the next event with linear ramps\n            const nextEvent = this._events.getAfter(previousEvent.time);\n            // or for 2 seconds if there is no event\n            const endTime = nextEvent ? nextEvent.time : now + 2;\n            const subdivisions = (endTime - now) / 10;\n            for (let i = now; i < endTime; i += subdivisions) {\n                param.linearRampToValueAtTime(this.getValueAtTime(i), i);\n            }\n        }\n        this._events.forEachAfter(this.context.currentTime, (event) => {\n            if (event.type === \"cancelScheduledValues\") {\n                param.cancelScheduledValues(event.time);\n            }\n            else if (event.type === \"setTargetAtTime\") {\n                param.setTargetAtTime(event.value, event.time, event.constant);\n            }\n            else {\n                param[event.type](event.value, event.time);\n            }\n        });\n        return this;\n    }\n    /**\n     * Replace the Param's internal AudioParam. Will apply scheduled curves\n     * onto the parameter and replace the connections.\n     */\n    setParam(param) {\n        assert(this._swappable, \"The Param must be assigned as 'swappable' in the constructor\");\n        const input = this.input;\n        input.disconnect(this._param);\n        this.apply(param);\n        this._param = param;\n        input.connect(this._param);\n        return this;\n    }\n    dispose() {\n        super.dispose();\n        this._events.dispose();\n        return this;\n    }\n    get defaultValue() {\n        return this._toType(this._param.defaultValue);\n    }\n    //-------------------------------------\n    // \tAUTOMATION CURVE CALCULATIONS\n    // \tMIT License, copyright (c) 2014 Jordan Santell\n    //-------------------------------------\n    // Calculates the the value along the curve produced by setTargetAtTime\n    _exponentialApproach(t0, v0, v1, timeConstant, t) {\n        return v1 + (v0 - v1) * Math.exp(-(t - t0) / timeConstant);\n    }\n    // Calculates the the value along the curve produced by linearRampToValueAtTime\n    _linearInterpolate(t0, v0, t1, v1, t) {\n        return v0 + (v1 - v0) * ((t - t0) / (t1 - t0));\n    }\n    // Calculates the the value along the curve produced by exponentialRampToValueAtTime\n    _exponentialInterpolate(t0, v0, t1, v1, t) {\n        return v0 * Math.pow(v1 / v0, (t - t0) / (t1 - t0));\n    }\n}\n//# sourceMappingURL=Param.js.map","import { isAudioNode, isAudioParam } from \"../util/AdvancedTypeCheck.js\";\nimport { isDefined } from \"../util/TypeCheck.js\";\nimport { Param } from \"./Param.js\";\nimport { ToneWithContext } from \"./ToneWithContext.js\";\nimport { assert, warn } from \"../util/Debug.js\";\n/**\n * ToneAudioNode is the base class for classes which process audio.\n * @category Core\n */\nexport class ToneAudioNode extends ToneWithContext {\n    constructor() {\n        super(...arguments);\n        /**\n         * List all of the node that must be set to match the ChannelProperties\n         */\n        this._internalChannels = [];\n    }\n    /**\n     * The number of inputs feeding into the AudioNode.\n     * For source nodes, this will be 0.\n     * @example\n     * const node = new Tone.Gain();\n     * console.log(node.numberOfInputs);\n     */\n    get numberOfInputs() {\n        if (isDefined(this.input)) {\n            if (isAudioParam(this.input) || this.input instanceof Param) {\n                return 1;\n            }\n            else {\n                return this.input.numberOfInputs;\n            }\n        }\n        else {\n            return 0;\n        }\n    }\n    /**\n     * The number of outputs of the AudioNode.\n     * @example\n     * const node = new Tone.Gain();\n     * console.log(node.numberOfOutputs);\n     */\n    get numberOfOutputs() {\n        if (isDefined(this.output)) {\n            return this.output.numberOfOutputs;\n        }\n        else {\n            return 0;\n        }\n    }\n    //-------------------------------------\n    // AUDIO PROPERTIES\n    //-------------------------------------\n    /**\n     * Used to decide which nodes to get/set properties on\n     */\n    _isAudioNode(node) {\n        return (isDefined(node) &&\n            (node instanceof ToneAudioNode || isAudioNode(node)));\n    }\n    /**\n     * Get all of the audio nodes (either internal or input/output) which together\n     * make up how the class node responds to channel input/output\n     */\n    _getInternalNodes() {\n        const nodeList = this._internalChannels.slice(0);\n        if (this._isAudioNode(this.input)) {\n            nodeList.push(this.input);\n        }\n        if (this._isAudioNode(this.output)) {\n            if (this.input !== this.output) {\n                nodeList.push(this.output);\n            }\n        }\n        return nodeList;\n    }\n    /**\n     * Set the audio options for this node such as channelInterpretation\n     * channelCount, etc.\n     * @param options\n     */\n    _setChannelProperties(options) {\n        const nodeList = this._getInternalNodes();\n        nodeList.forEach((node) => {\n            node.channelCount = options.channelCount;\n            node.channelCountMode = options.channelCountMode;\n            node.channelInterpretation = options.channelInterpretation;\n        });\n    }\n    /**\n     * Get the current audio options for this node such as channelInterpretation\n     * channelCount, etc.\n     */\n    _getChannelProperties() {\n        const nodeList = this._getInternalNodes();\n        assert(nodeList.length > 0, \"ToneAudioNode does not have any internal nodes\");\n        // use the first node to get properties\n        // they should all be the same\n        const node = nodeList[0];\n        return {\n            channelCount: node.channelCount,\n            channelCountMode: node.channelCountMode,\n            channelInterpretation: node.channelInterpretation,\n        };\n    }\n    /**\n     * channelCount is the number of channels used when up-mixing and down-mixing\n     * connections to any inputs to the node. The default value is 2 except for\n     * specific nodes where its value is specially determined.\n     */\n    get channelCount() {\n        return this._getChannelProperties().channelCount;\n    }\n    set channelCount(channelCount) {\n        const props = this._getChannelProperties();\n        // merge it with the other properties\n        this._setChannelProperties(Object.assign(props, { channelCount }));\n    }\n    /**\n     * channelCountMode determines how channels will be counted when up-mixing and\n     * down-mixing connections to any inputs to the node.\n     * The default value is \"max\". This attribute has no effect for nodes with no inputs.\n     * * \"max\" - computedNumberOfChannels is the maximum of the number of channels of all connections to an input. In this mode channelCount is ignored.\n     * * \"clamped-max\" - computedNumberOfChannels is determined as for \"max\" and then clamped to a maximum value of the given channelCount.\n     * * \"explicit\" - computedNumberOfChannels is the exact value as specified by the channelCount.\n     */\n    get channelCountMode() {\n        return this._getChannelProperties().channelCountMode;\n    }\n    set channelCountMode(channelCountMode) {\n        const props = this._getChannelProperties();\n        // merge it with the other properties\n        this._setChannelProperties(Object.assign(props, { channelCountMode }));\n    }\n    /**\n     * channelInterpretation determines how individual channels will be treated\n     * when up-mixing and down-mixing connections to any inputs to the node.\n     * The default value is \"speakers\".\n     */\n    get channelInterpretation() {\n        return this._getChannelProperties().channelInterpretation;\n    }\n    set channelInterpretation(channelInterpretation) {\n        const props = this._getChannelProperties();\n        // merge it with the other properties\n        this._setChannelProperties(Object.assign(props, { channelInterpretation }));\n    }\n    //-------------------------------------\n    // CONNECTIONS\n    //-------------------------------------\n    /**\n     * connect the output of a ToneAudioNode to an AudioParam, AudioNode, or ToneAudioNode\n     * @param destination The output to connect to\n     * @param outputNum The output to connect from\n     * @param inputNum The input to connect to\n     */\n    connect(destination, outputNum = 0, inputNum = 0) {\n        connect(this, destination, outputNum, inputNum);\n        return this;\n    }\n    /**\n     * Connect the output to the context's destination node.\n     * @example\n     * const osc = new Tone.Oscillator(\"C2\").start();\n     * osc.toDestination();\n     */\n    toDestination() {\n        this.connect(this.context.destination);\n        return this;\n    }\n    /**\n     * Connect the output to the context's destination node.\n     * @see {@link toDestination}\n     * @deprecated\n     */\n    toMaster() {\n        warn(\"toMaster() has been renamed toDestination()\");\n        return this.toDestination();\n    }\n    /**\n     * disconnect the output\n     */\n    disconnect(destination, outputNum = 0, inputNum = 0) {\n        disconnect(this, destination, outputNum, inputNum);\n        return this;\n    }\n    /**\n     * Connect the output of this node to the rest of the nodes in series.\n     * @example\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/drum-samples/handdrum-loop.mp3\");\n     * player.autostart = true;\n     * const filter = new Tone.AutoFilter(4).start();\n     * const distortion = new Tone.Distortion(0.5);\n     * // connect the player to the filter, distortion and then to the master output\n     * player.chain(filter, distortion, Tone.Destination);\n     */\n    chain(...nodes) {\n        connectSeries(this, ...nodes);\n        return this;\n    }\n    /**\n     * connect the output of this node to the rest of the nodes in parallel.\n     * @example\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/drum-samples/conga-rhythm.mp3\");\n     * player.autostart = true;\n     * const pitchShift = new Tone.PitchShift(4).toDestination();\n     * const filter = new Tone.Filter(\"G5\").toDestination();\n     * // connect a node to the pitch shift and filter in parallel\n     * player.fan(pitchShift, filter);\n     */\n    fan(...nodes) {\n        nodes.forEach((node) => this.connect(node));\n        return this;\n    }\n    /**\n     * Dispose and disconnect\n     */\n    dispose() {\n        super.dispose();\n        if (isDefined(this.input)) {\n            if (this.input instanceof ToneAudioNode) {\n                this.input.dispose();\n            }\n            else if (isAudioNode(this.input)) {\n                this.input.disconnect();\n            }\n        }\n        if (isDefined(this.output)) {\n            if (this.output instanceof ToneAudioNode) {\n                this.output.dispose();\n            }\n            else if (isAudioNode(this.output)) {\n                this.output.disconnect();\n            }\n        }\n        this._internalChannels = [];\n        return this;\n    }\n}\n//-------------------------------------\n// CONNECTIONS\n//-------------------------------------\n/**\n * connect together all of the arguments in series\n * @param nodes\n */\nexport function connectSeries(...nodes) {\n    const first = nodes.shift();\n    nodes.reduce((prev, current) => {\n        if (prev instanceof ToneAudioNode) {\n            prev.connect(current);\n        }\n        else if (isAudioNode(prev)) {\n            connect(prev, current);\n        }\n        return current;\n    }, first);\n}\n/**\n * Connect two nodes together so that signal flows from the\n * first node to the second. Optionally specify the input and output channels.\n * @param srcNode The source node\n * @param dstNode The destination node\n * @param outputNumber The output channel of the srcNode\n * @param inputNumber The input channel of the dstNode\n */\nexport function connect(srcNode, dstNode, outputNumber = 0, inputNumber = 0) {\n    assert(isDefined(srcNode), \"Cannot connect from undefined node\");\n    assert(isDefined(dstNode), \"Cannot connect to undefined node\");\n    if (dstNode instanceof ToneAudioNode || isAudioNode(dstNode)) {\n        assert(dstNode.numberOfInputs > 0, \"Cannot connect to node with no inputs\");\n    }\n    assert(srcNode.numberOfOutputs > 0, \"Cannot connect from node with no outputs\");\n    // resolve the input of the dstNode\n    while (dstNode instanceof ToneAudioNode || dstNode instanceof Param) {\n        if (isDefined(dstNode.input)) {\n            dstNode = dstNode.input;\n        }\n    }\n    while (srcNode instanceof ToneAudioNode) {\n        if (isDefined(srcNode.output)) {\n            srcNode = srcNode.output;\n        }\n    }\n    // make the connection\n    if (isAudioParam(dstNode)) {\n        srcNode.connect(dstNode, outputNumber);\n    }\n    else {\n        srcNode.connect(dstNode, outputNumber, inputNumber);\n    }\n}\n/**\n * Disconnect a node from all nodes or optionally include a destination node and input/output channels.\n * @param srcNode The source node\n * @param dstNode The destination node\n * @param outputNumber The output channel of the srcNode\n * @param inputNumber The input channel of the dstNode\n */\nexport function disconnect(srcNode, dstNode, outputNumber = 0, inputNumber = 0) {\n    // resolve the destination node\n    if (isDefined(dstNode)) {\n        while (dstNode instanceof ToneAudioNode) {\n            dstNode = dstNode.input;\n        }\n    }\n    // resolve the src node\n    while (!isAudioNode(srcNode)) {\n        if (isDefined(srcNode.output)) {\n            srcNode = srcNode.output;\n        }\n    }\n    if (isAudioParam(dstNode)) {\n        srcNode.disconnect(dstNode, outputNumber);\n    }\n    else if (isAudioNode(dstNode)) {\n        srcNode.disconnect(dstNode, outputNumber, inputNumber);\n    }\n    else {\n        srcNode.disconnect();\n    }\n}\n/**\n * Connect the output of one or more source nodes to a single destination node\n * @param nodes One or more source nodes followed by one destination node\n * @example\n * const player = new Tone.Player(\"https://tonejs.github.io/audio/drum-samples/conga-rhythm.mp3\");\n * const player1 = new Tone.Player(\"https://tonejs.github.io/audio/drum-samples/conga-rhythm.mp3\");\n * const filter = new Tone.Filter(\"G5\").toDestination();\n * // connect nodes to a common destination\n * Tone.fanIn(player, player1, filter);\n */\nexport function fanIn(...nodes) {\n    const dstNode = nodes.pop();\n    if (isDefined(dstNode)) {\n        nodes.forEach((node) => connect(node, dstNode));\n    }\n}\n//# sourceMappingURL=ToneAudioNode.js.map","import { Param } from \"../context/Param.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { readOnly } from \"../util/Interface.js\";\nimport { ToneAudioNode } from \"./ToneAudioNode.js\";\n/**\n * A thin wrapper around the Native Web Audio GainNode.\n * The GainNode is a basic building block of the Web Audio\n * API and is useful for routing audio and adjusting gains.\n * @category Core\n * @example\n * return Tone.Offline(() => {\n * \tconst gainNode = new Tone.Gain(0).toDestination();\n * \tconst osc = new Tone.Oscillator(30).connect(gainNode).start();\n * \tgainNode.gain.rampTo(1, 0.1);\n * \tgainNode.gain.rampTo(0, 0.4, 0.2);\n * }, 0.7, 1);\n */\nexport class Gain extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Gain.getDefaults(), arguments, [\n            \"gain\",\n            \"units\",\n        ]);\n        super(options);\n        this.name = \"Gain\";\n        /**\n         * The wrapped GainNode.\n         */\n        this._gainNode = this.context.createGain();\n        // input = output\n        this.input = this._gainNode;\n        this.output = this._gainNode;\n        this.gain = new Param({\n            context: this.context,\n            convert: options.convert,\n            param: this._gainNode.gain,\n            units: options.units,\n            value: options.gain,\n            minValue: options.minValue,\n            maxValue: options.maxValue,\n        });\n        readOnly(this, \"gain\");\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            convert: true,\n            gain: 1,\n            units: \"gain\",\n        });\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this._gainNode.disconnect();\n        this.gain.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=Gain.js.map","import { Gain } from \"../core/context/Gain.js\";\nimport { ToneAudioNode, } from \"../core/context/ToneAudioNode.js\";\nimport { noOp } from \"../core/util/Interface.js\";\nimport { assert } from \"../core/util/Debug.js\";\n/**\n * Base class for fire-and-forget nodes\n */\nexport class OneShotSource extends ToneAudioNode {\n    constructor(options) {\n        super(options);\n        /**\n         * The callback to invoke after the\n         * source is done playing.\n         */\n        this.onended = noOp;\n        /**\n         * The start time\n         */\n        this._startTime = -1;\n        /**\n         * The stop time\n         */\n        this._stopTime = -1;\n        /**\n         * The id of the timeout\n         */\n        this._timeout = -1;\n        /**\n         * The public output node\n         */\n        this.output = new Gain({\n            context: this.context,\n            gain: 0,\n        });\n        /**\n         * The output gain node.\n         */\n        this._gainNode = this.output;\n        /**\n         * Get the playback state at the given time\n         */\n        this.getStateAtTime = function (time) {\n            const computedTime = this.toSeconds(time);\n            if (this._startTime !== -1 &&\n                computedTime >= this._startTime &&\n                (this._stopTime === -1 || computedTime <= this._stopTime)) {\n                return \"started\";\n            }\n            else {\n                return \"stopped\";\n            }\n        };\n        this._fadeIn = options.fadeIn;\n        this._fadeOut = options.fadeOut;\n        this._curve = options.curve;\n        this.onended = options.onended;\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            curve: \"linear\",\n            fadeIn: 0,\n            fadeOut: 0,\n            onended: noOp,\n        });\n    }\n    /**\n     * Start the source at the given time\n     * @param  time When to start the source\n     */\n    _startGain(time, gain = 1) {\n        assert(this._startTime === -1, \"Source cannot be started more than once\");\n        // apply a fade in envelope\n        const fadeInTime = this.toSeconds(this._fadeIn);\n        // record the start time\n        this._startTime = time + fadeInTime;\n        this._startTime = Math.max(this._startTime, this.context.currentTime);\n        // schedule the envelope\n        if (fadeInTime > 0) {\n            this._gainNode.gain.setValueAtTime(0, time);\n            if (this._curve === \"linear\") {\n                this._gainNode.gain.linearRampToValueAtTime(gain, time + fadeInTime);\n            }\n            else {\n                this._gainNode.gain.exponentialApproachValueAtTime(gain, time, fadeInTime);\n            }\n        }\n        else {\n            this._gainNode.gain.setValueAtTime(gain, time);\n        }\n        return this;\n    }\n    /**\n     * Stop the source node at the given time.\n     * @param time When to stop the source\n     */\n    stop(time) {\n        this.log(\"stop\", time);\n        this._stopGain(this.toSeconds(time));\n        return this;\n    }\n    /**\n     * Stop the source at the given time\n     * @param  time When to stop the source\n     */\n    _stopGain(time) {\n        assert(this._startTime !== -1, \"'start' must be called before 'stop'\");\n        // cancel the previous stop\n        this.cancelStop();\n        // the fadeOut time\n        const fadeOutTime = this.toSeconds(this._fadeOut);\n        // schedule the stop callback\n        this._stopTime = this.toSeconds(time) + fadeOutTime;\n        this._stopTime = Math.max(this._stopTime, this.now());\n        if (fadeOutTime > 0) {\n            // start the fade out curve at the given time\n            if (this._curve === \"linear\") {\n                this._gainNode.gain.linearRampTo(0, fadeOutTime, time);\n            }\n            else {\n                this._gainNode.gain.targetRampTo(0, fadeOutTime, time);\n            }\n        }\n        else {\n            // stop any ongoing ramps, and set the value to 0\n            this._gainNode.gain.cancelAndHoldAtTime(time);\n            this._gainNode.gain.setValueAtTime(0, time);\n        }\n        this.context.clearTimeout(this._timeout);\n        this._timeout = this.context.setTimeout(() => {\n            // allow additional time for the exponential curve to fully decay\n            const additionalTail = this._curve === \"exponential\" ? fadeOutTime * 2 : 0;\n            this._stopSource(this.now() + additionalTail);\n            this._onended();\n        }, this._stopTime - this.context.currentTime);\n        return this;\n    }\n    /**\n     * Invoke the onended callback\n     */\n    _onended() {\n        if (this.onended === noOp) {\n            return;\n        }\n        this.onended(this);\n        // overwrite onended to make sure it only is called once\n        this.onended = noOp;\n        // dispose when it's ended to free up for garbage collection only in the online context\n        if (!this.context.isOffline) {\n            const disposeCallback = () => this.dispose();\n            if (typeof requestIdleCallback !== \"undefined\") {\n                requestIdleCallback(disposeCallback);\n            }\n            else {\n                setTimeout(disposeCallback, 10);\n            }\n        }\n    }\n    /**\n     * Get the playback state at the current time\n     */\n    get state() {\n        return this.getStateAtTime(this.now());\n    }\n    /**\n     * Cancel a scheduled stop event\n     */\n    cancelStop() {\n        this.log(\"cancelStop\");\n        assert(this._startTime !== -1, \"Source is not started\");\n        // cancel the stop envelope\n        this._gainNode.gain.cancelScheduledValues(this._startTime + this.sampleTime);\n        this.context.clearTimeout(this._timeout);\n        this._stopTime = -1;\n        return this;\n    }\n    dispose() {\n        super.dispose();\n        this._gainNode.dispose();\n        this.onended = noOp;\n        return this;\n    }\n}\n//# sourceMappingURL=OneShotSource.js.map","import { connect } from \"../core/context/ToneAudioNode.js\";\nimport { Param } from \"../core/context/Param.js\";\nimport { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { OneShotSource, } from \"../source/OneShotSource.js\";\n/**\n * Wrapper around the native fire-and-forget ConstantSource.\n * Adds the ability to reschedule the stop method.\n * @category Signal\n */\nexport class ToneConstantSource extends OneShotSource {\n    constructor() {\n        const options = optionsFromArguments(ToneConstantSource.getDefaults(), arguments, [\"offset\"]);\n        super(options);\n        this.name = \"ToneConstantSource\";\n        /**\n         * The signal generator\n         */\n        this._source = this.context.createConstantSource();\n        connect(this._source, this._gainNode);\n        this.offset = new Param({\n            context: this.context,\n            convert: options.convert,\n            param: this._source.offset,\n            units: options.units,\n            value: options.offset,\n            minValue: options.minValue,\n            maxValue: options.maxValue,\n        });\n    }\n    static getDefaults() {\n        return Object.assign(OneShotSource.getDefaults(), {\n            convert: true,\n            offset: 1,\n            units: \"number\",\n        });\n    }\n    /**\n     * Start the source node at the given time\n     * @param  time When to start the source\n     */\n    start(time) {\n        const computedTime = this.toSeconds(time);\n        this.log(\"start\", computedTime);\n        this._startGain(computedTime);\n        this._source.start(computedTime);\n        return this;\n    }\n    _stopSource(time) {\n        this._source.stop(time);\n    }\n    dispose() {\n        super.dispose();\n        if (this.state === \"started\") {\n            this.stop();\n        }\n        this._source.disconnect();\n        this.offset.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=ToneConstantSource.js.map","import { Param } from \"../core/context/Param.js\";\nimport { ToneAudioNode, } from \"../core/context/ToneAudioNode.js\";\nimport { connect } from \"../core/context/ToneAudioNode.js\";\nimport { isAudioParam } from \"../core/util/AdvancedTypeCheck.js\";\nimport { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { ToneConstantSource } from \"./ToneConstantSource.js\";\n/**\n * A signal is an audio-rate value. Tone.Signal is a core component of the library.\n * Unlike a number, Signals can be scheduled with sample-level accuracy. Tone.Signal\n * has all of the methods available to native Web Audio\n * [AudioParam](http://webaudio.github.io/web-audio-api/#the-audioparam-interface)\n * as well as additional conveniences. Read more about working with signals\n * [here](https://github.com/Tonejs/Tone.js/wiki/Signals).\n *\n * @example\n * const osc = new Tone.Oscillator().toDestination().start();\n * // a scheduleable signal which can be connected to control an AudioParam or another Signal\n * const signal = new Tone.Signal({\n * \tvalue: \"C4\",\n * \tunits: \"frequency\"\n * }).connect(osc.frequency);\n * // the scheduled ramp controls the connected signal\n * signal.rampTo(\"C2\", 4, \"+0.5\");\n * @category Signal\n */\nexport class Signal extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Signal.getDefaults(), arguments, [\n            \"value\",\n            \"units\",\n        ]);\n        super(options);\n        this.name = \"Signal\";\n        /**\n         * Indicates if the value should be overridden on connection.\n         */\n        this.override = true;\n        this.output = this._constantSource = new ToneConstantSource({\n            context: this.context,\n            convert: options.convert,\n            offset: options.value,\n            units: options.units,\n            minValue: options.minValue,\n            maxValue: options.maxValue,\n        });\n        this._constantSource.start(0);\n        this.input = this._param = this._constantSource.offset;\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            convert: true,\n            units: \"number\",\n            value: 0,\n        });\n    }\n    connect(destination, outputNum = 0, inputNum = 0) {\n        // start it only when connected to something\n        connectSignal(this, destination, outputNum, inputNum);\n        return this;\n    }\n    dispose() {\n        super.dispose();\n        this._param.dispose();\n        this._constantSource.dispose();\n        return this;\n    }\n    //-------------------------------------\n    // ABSTRACT PARAM INTERFACE\n    // just a proxy for the ConstantSourceNode's offset AudioParam\n    // all docs are generated from AbstractParam.ts\n    //-------------------------------------\n    setValueAtTime(value, time) {\n        this._param.setValueAtTime(value, time);\n        return this;\n    }\n    getValueAtTime(time) {\n        return this._param.getValueAtTime(time);\n    }\n    setRampPoint(time) {\n        this._param.setRampPoint(time);\n        return this;\n    }\n    linearRampToValueAtTime(value, time) {\n        this._param.linearRampToValueAtTime(value, time);\n        return this;\n    }\n    exponentialRampToValueAtTime(value, time) {\n        this._param.exponentialRampToValueAtTime(value, time);\n        return this;\n    }\n    exponentialRampTo(value, rampTime, startTime) {\n        this._param.exponentialRampTo(value, rampTime, startTime);\n        return this;\n    }\n    linearRampTo(value, rampTime, startTime) {\n        this._param.linearRampTo(value, rampTime, startTime);\n        return this;\n    }\n    targetRampTo(value, rampTime, startTime) {\n        this._param.targetRampTo(value, rampTime, startTime);\n        return this;\n    }\n    exponentialApproachValueAtTime(value, time, rampTime) {\n        this._param.exponentialApproachValueAtTime(value, time, rampTime);\n        return this;\n    }\n    setTargetAtTime(value, startTime, timeConstant) {\n        this._param.setTargetAtTime(value, startTime, timeConstant);\n        return this;\n    }\n    setValueCurveAtTime(values, startTime, duration, scaling) {\n        this._param.setValueCurveAtTime(values, startTime, duration, scaling);\n        return this;\n    }\n    cancelScheduledValues(time) {\n        this._param.cancelScheduledValues(time);\n        return this;\n    }\n    cancelAndHoldAtTime(time) {\n        this._param.cancelAndHoldAtTime(time);\n        return this;\n    }\n    rampTo(value, rampTime, startTime) {\n        this._param.rampTo(value, rampTime, startTime);\n        return this;\n    }\n    get value() {\n        return this._param.value;\n    }\n    set value(value) {\n        this._param.value = value;\n    }\n    get convert() {\n        return this._param.convert;\n    }\n    set convert(convert) {\n        this._param.convert = convert;\n    }\n    get units() {\n        return this._param.units;\n    }\n    get overridden() {\n        return this._param.overridden;\n    }\n    set overridden(overridden) {\n        this._param.overridden = overridden;\n    }\n    get maxValue() {\n        return this._param.maxValue;\n    }\n    get minValue() {\n        return this._param.minValue;\n    }\n    /**\n     * @see {@link Param.apply}.\n     */\n    apply(param) {\n        this._param.apply(param);\n        return this;\n    }\n}\n/**\n * When connecting from a signal, it's necessary to zero out the node destination\n * node if that node is also a signal. If the destination is not 0, then the values\n * will be summed. This method insures that the output of the destination signal will\n * be the same as the source signal, making the destination signal a pass through node.\n * @param signal The output signal to connect from\n * @param destination the destination to connect to\n * @param outputNum the optional output number\n * @param inputNum the input number\n */\nexport function connectSignal(signal, destination, outputNum, inputNum) {\n    if (destination instanceof Param ||\n        isAudioParam(destination) ||\n        (destination instanceof Signal && destination.override)) {\n        // cancel changes\n        destination.cancelScheduledValues(0);\n        // reset the value\n        destination.setValueAtTime(0, 0);\n        // mark the value as overridden\n        if (destination instanceof Signal) {\n            destination.overridden = true;\n        }\n    }\n    connect(signal, destination, outputNum, inputNum);\n}\n//# sourceMappingURL=Signal.js.map","import { Param } from \"../context/Param.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { Timeline } from \"../util/Timeline.js\";\nimport { isUndef } from \"../util/TypeCheck.js\";\n/**\n * A Param class just for computing ticks. Similar to the {@link Param} class,\n * but offers conversion to BPM values as well as ability to compute tick\n * duration and elapsed ticks\n */\nexport class TickParam extends Param {\n    constructor() {\n        const options = optionsFromArguments(TickParam.getDefaults(), arguments, [\"value\"]);\n        super(options);\n        this.name = \"TickParam\";\n        /**\n         * The timeline which tracks all of the automations.\n         */\n        this._events = new Timeline(Infinity);\n        /**\n         * The internal holder for the multiplier value\n         */\n        this._multiplier = 1;\n        // set the multiplier\n        this._multiplier = options.multiplier;\n        // clear the ticks from the beginning\n        this._events.cancel(0);\n        // set an initial event\n        this._events.add({\n            ticks: 0,\n            time: 0,\n            type: \"setValueAtTime\",\n            value: this._fromType(options.value),\n        });\n        this.setValueAtTime(options.value, 0);\n    }\n    static getDefaults() {\n        return Object.assign(Param.getDefaults(), {\n            multiplier: 1,\n            units: \"hertz\",\n            value: 1,\n        });\n    }\n    setTargetAtTime(value, time, constant) {\n        // approximate it with multiple linear ramps\n        time = this.toSeconds(time);\n        this.setRampPoint(time);\n        const computedValue = this._fromType(value);\n        // start from previously scheduled value\n        const prevEvent = this._events.get(time);\n        const segments = Math.round(Math.max(1 / constant, 1));\n        for (let i = 0; i <= segments; i++) {\n            const segTime = constant * i + time;\n            const rampVal = this._exponentialApproach(prevEvent.time, prevEvent.value, computedValue, constant, segTime);\n            this.linearRampToValueAtTime(this._toType(rampVal), segTime);\n        }\n        return this;\n    }\n    setValueAtTime(value, time) {\n        const computedTime = this.toSeconds(time);\n        super.setValueAtTime(value, time);\n        const event = this._events.get(computedTime);\n        const previousEvent = this._events.previousEvent(event);\n        const ticksUntilTime = this._getTicksUntilEvent(previousEvent, computedTime);\n        event.ticks = Math.max(ticksUntilTime, 0);\n        return this;\n    }\n    linearRampToValueAtTime(value, time) {\n        const computedTime = this.toSeconds(time);\n        super.linearRampToValueAtTime(value, time);\n        const event = this._events.get(computedTime);\n        const previousEvent = this._events.previousEvent(event);\n        const ticksUntilTime = this._getTicksUntilEvent(previousEvent, computedTime);\n        event.ticks = Math.max(ticksUntilTime, 0);\n        return this;\n    }\n    exponentialRampToValueAtTime(value, time) {\n        // aproximate it with multiple linear ramps\n        time = this.toSeconds(time);\n        const computedVal = this._fromType(value);\n        // start from previously scheduled value\n        const prevEvent = this._events.get(time);\n        // approx 10 segments per second\n        const segments = Math.round(Math.max((time - prevEvent.time) * 10, 1));\n        const segmentDur = (time - prevEvent.time) / segments;\n        for (let i = 0; i <= segments; i++) {\n            const segTime = segmentDur * i + prevEvent.time;\n            const rampVal = this._exponentialInterpolate(prevEvent.time, prevEvent.value, time, computedVal, segTime);\n            this.linearRampToValueAtTime(this._toType(rampVal), segTime);\n        }\n        return this;\n    }\n    /**\n     * Returns the tick value at the time. Takes into account\n     * any automation curves scheduled on the signal.\n     * @param  event The time to get the tick count at\n     * @return The number of ticks which have elapsed at the time given any automations.\n     */\n    _getTicksUntilEvent(event, time) {\n        if (event === null) {\n            event = {\n                ticks: 0,\n                time: 0,\n                type: \"setValueAtTime\",\n                value: 0,\n            };\n        }\n        else if (isUndef(event.ticks)) {\n            const previousEvent = this._events.previousEvent(event);\n            event.ticks = this._getTicksUntilEvent(previousEvent, event.time);\n        }\n        const val0 = this._fromType(this.getValueAtTime(event.time));\n        let val1 = this._fromType(this.getValueAtTime(time));\n        // if it's right on the line, take the previous value\n        const onTheLineEvent = this._events.get(time);\n        if (onTheLineEvent &&\n            onTheLineEvent.time === time &&\n            onTheLineEvent.type === \"setValueAtTime\") {\n            val1 = this._fromType(this.getValueAtTime(time - this.sampleTime));\n        }\n        return 0.5 * (time - event.time) * (val0 + val1) + event.ticks;\n    }\n    /**\n     * Returns the tick value at the time. Takes into account\n     * any automation curves scheduled on the signal.\n     * @param  time The time to get the tick count at\n     * @return The number of ticks which have elapsed at the time given any automations.\n     */\n    getTicksAtTime(time) {\n        const computedTime = this.toSeconds(time);\n        const event = this._events.get(computedTime);\n        return Math.max(this._getTicksUntilEvent(event, computedTime), 0);\n    }\n    /**\n     * Return the elapsed time of the number of ticks from the given time\n     * @param ticks The number of ticks to calculate\n     * @param  time The time to get the next tick from\n     * @return The duration of the number of ticks from the given time in seconds\n     */\n    getDurationOfTicks(ticks, time) {\n        const computedTime = this.toSeconds(time);\n        const currentTick = this.getTicksAtTime(time);\n        return this.getTimeOfTick(currentTick + ticks) - computedTime;\n    }\n    /**\n     * Given a tick, returns the time that tick occurs at.\n     * @return The time that the tick occurs.\n     */\n    getTimeOfTick(tick) {\n        const before = this._events.get(tick, \"ticks\");\n        const after = this._events.getAfter(tick, \"ticks\");\n        if (before && before.ticks === tick) {\n            return before.time;\n        }\n        else if (before &&\n            after &&\n            after.type === \"linearRampToValueAtTime\" &&\n            before.value !== after.value) {\n            const val0 = this._fromType(this.getValueAtTime(before.time));\n            const val1 = this._fromType(this.getValueAtTime(after.time));\n            const delta = (val1 - val0) / (after.time - before.time);\n            const k = Math.sqrt(Math.pow(val0, 2) - 2 * delta * (before.ticks - tick));\n            const sol1 = (-val0 + k) / delta;\n            const sol2 = (-val0 - k) / delta;\n            return (sol1 > 0 ? sol1 : sol2) + before.time;\n        }\n        else if (before) {\n            if (before.value === 0) {\n                return Infinity;\n            }\n            else {\n                return before.time + (tick - before.ticks) / before.value;\n            }\n        }\n        else {\n            return tick / this._initialValue;\n        }\n    }\n    /**\n     * Convert some number of ticks their the duration in seconds accounting\n     * for any automation curves starting at the given time.\n     * @param  ticks The number of ticks to convert to seconds.\n     * @param  when  When along the automation timeline to convert the ticks.\n     * @return The duration in seconds of the ticks.\n     */\n    ticksToTime(ticks, when) {\n        return this.getDurationOfTicks(ticks, when);\n    }\n    /**\n     * The inverse of {@link ticksToTime}. Convert a duration in\n     * seconds to the corresponding number of ticks accounting for any\n     * automation curves starting at the given time.\n     * @param  duration The time interval to convert to ticks.\n     * @param  when When along the automation timeline to convert the ticks.\n     * @return The duration in ticks.\n     */\n    timeToTicks(duration, when) {\n        const computedTime = this.toSeconds(when);\n        const computedDuration = this.toSeconds(duration);\n        const startTicks = this.getTicksAtTime(computedTime);\n        const endTicks = this.getTicksAtTime(computedTime + computedDuration);\n        return endTicks - startTicks;\n    }\n    /**\n     * Convert from the type when the unit value is BPM\n     */\n    _fromType(val) {\n        if (this.units === \"bpm\" && this.multiplier) {\n            return 1 / (60 / val / this.multiplier);\n        }\n        else {\n            return super._fromType(val);\n        }\n    }\n    /**\n     * Special case of type conversion where the units === \"bpm\"\n     */\n    _toType(val) {\n        if (this.units === \"bpm\" && this.multiplier) {\n            return ((val / this.multiplier) * 60);\n        }\n        else {\n            return super._toType(val);\n        }\n    }\n    /**\n     * A multiplier on the bpm value. Useful for setting a PPQ relative to the base frequency value.\n     */\n    get multiplier() {\n        return this._multiplier;\n    }\n    set multiplier(m) {\n        // get and reset the current value with the new multiplier\n        // might be necessary to clear all the previous values\n        const currentVal = this.value;\n        this._multiplier = m;\n        this.cancelScheduledValues(0);\n        this.setValueAtTime(currentVal, 0);\n    }\n}\n//# sourceMappingURL=TickParam.js.map","import { Signal } from \"../../signal/Signal.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { TickParam } from \"./TickParam.js\";\n/**\n * TickSignal extends Tone.Signal, but adds the capability\n * to calculate the number of elapsed ticks. exponential and target curves\n * are approximated with multiple linear ramps.\n *\n * Thank you Bruno Dias, H. Sofia Pinto, and David M. Matos,\n * for your [WAC paper](https://smartech.gatech.edu/bitstream/handle/1853/54588/WAC2016-49.pdf)\n * describing integrating timing functions for tempo calculations.\n */\nexport class TickSignal extends Signal {\n    constructor() {\n        const options = optionsFromArguments(TickSignal.getDefaults(), arguments, [\"value\"]);\n        super(options);\n        this.name = \"TickSignal\";\n        this.input = this._param = new TickParam({\n            context: this.context,\n            convert: options.convert,\n            multiplier: options.multiplier,\n            param: this._constantSource.offset,\n            units: options.units,\n            value: options.value,\n        });\n    }\n    static getDefaults() {\n        return Object.assign(Signal.getDefaults(), {\n            multiplier: 1,\n            units: \"hertz\",\n            value: 1,\n        });\n    }\n    ticksToTime(ticks, when) {\n        return this._param.ticksToTime(ticks, when);\n    }\n    timeToTicks(duration, when) {\n        return this._param.timeToTicks(duration, when);\n    }\n    getTimeOfTick(tick) {\n        return this._param.getTimeOfTick(tick);\n    }\n    getDurationOfTicks(ticks, time) {\n        return this._param.getDurationOfTicks(ticks, time);\n    }\n    getTicksAtTime(time) {\n        return this._param.getTicksAtTime(time);\n    }\n    /**\n     * A multiplier on the bpm value. Useful for setting a PPQ relative to the base frequency value.\n     */\n    get multiplier() {\n        return this._param.multiplier;\n    }\n    set multiplier(m) {\n        this._param.multiplier = m;\n    }\n    dispose() {\n        super.dispose();\n        this._param.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=TickSignal.js.map","import { ToneWithContext, } from \"../context/ToneWithContext.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { readOnly } from \"../util/Interface.js\";\nimport { StateTimeline, } from \"../util/StateTimeline.js\";\nimport { Timeline } from \"../util/Timeline.js\";\nimport { isDefined } from \"../util/TypeCheck.js\";\nimport { TickSignal } from \"./TickSignal.js\";\nimport { EQ } from \"../util/Math.js\";\n/**\n * Uses [TickSignal](TickSignal) to track elapsed ticks with complex automation curves.\n */\nexport class TickSource extends ToneWithContext {\n    constructor() {\n        const options = optionsFromArguments(TickSource.getDefaults(), arguments, [\"frequency\"]);\n        super(options);\n        this.name = \"TickSource\";\n        /**\n         * The state timeline\n         */\n        this._state = new StateTimeline();\n        /**\n         * The offset values of the ticks\n         */\n        this._tickOffset = new Timeline();\n        /**\n         * Memoized values of getTicksAtTime at events with state other than \"started\"\n         */\n        this._ticksAtTime = new Timeline();\n        /**\n         * Memoized values of getSecondsAtTime at events with state other than \"started\"\n         */\n        this._secondsAtTime = new Timeline();\n        this.frequency = new TickSignal({\n            context: this.context,\n            units: options.units,\n            value: options.frequency,\n        });\n        readOnly(this, \"frequency\");\n        // set the initial state\n        this._state.setStateAtTime(\"stopped\", 0);\n        // add the first event\n        this.setTicksAtTime(0, 0);\n    }\n    static getDefaults() {\n        return Object.assign({\n            frequency: 1,\n            units: \"hertz\",\n        }, ToneWithContext.getDefaults());\n    }\n    /**\n     * Returns the playback state of the source, either \"started\", \"stopped\" or \"paused\".\n     */\n    get state() {\n        return this.getStateAtTime(this.now());\n    }\n    /**\n     * Start the clock at the given time. Optionally pass in an offset\n     * of where to start the tick counter from.\n     * @param  time    The time the clock should start\n     * @param offset The number of ticks to start the source at\n     */\n    start(time, offset) {\n        const computedTime = this.toSeconds(time);\n        if (this._state.getValueAtTime(computedTime) !== \"started\") {\n            this._state.setStateAtTime(\"started\", computedTime);\n            if (isDefined(offset)) {\n                this.setTicksAtTime(offset, computedTime);\n            }\n            this._ticksAtTime.cancel(computedTime);\n            this._secondsAtTime.cancel(computedTime);\n        }\n        return this;\n    }\n    /**\n     * Stop the clock. Stopping the clock resets the tick counter to 0.\n     * @param time The time when the clock should stop.\n     */\n    stop(time) {\n        const computedTime = this.toSeconds(time);\n        // cancel the previous stop\n        if (this._state.getValueAtTime(computedTime) === \"stopped\") {\n            const event = this._state.get(computedTime);\n            if (event && event.time > 0) {\n                this._tickOffset.cancel(event.time);\n                this._state.cancel(event.time);\n            }\n        }\n        this._state.cancel(computedTime);\n        this._state.setStateAtTime(\"stopped\", computedTime);\n        this.setTicksAtTime(0, computedTime);\n        this._ticksAtTime.cancel(computedTime);\n        this._secondsAtTime.cancel(computedTime);\n        return this;\n    }\n    /**\n     * Pause the clock. Pausing does not reset the tick counter.\n     * @param time The time when the clock should stop.\n     */\n    pause(time) {\n        const computedTime = this.toSeconds(time);\n        if (this._state.getValueAtTime(computedTime) === \"started\") {\n            this._state.setStateAtTime(\"paused\", computedTime);\n            this._ticksAtTime.cancel(computedTime);\n            this._secondsAtTime.cancel(computedTime);\n        }\n        return this;\n    }\n    /**\n     * Cancel start/stop/pause and setTickAtTime events scheduled after the given time.\n     * @param time When to clear the events after\n     */\n    cancel(time) {\n        time = this.toSeconds(time);\n        this._state.cancel(time);\n        this._tickOffset.cancel(time);\n        this._ticksAtTime.cancel(time);\n        this._secondsAtTime.cancel(time);\n        return this;\n    }\n    /**\n     * Get the elapsed ticks at the given time\n     * @param  time  When to get the tick value\n     * @return The number of ticks\n     */\n    getTicksAtTime(time) {\n        const computedTime = this.toSeconds(time);\n        const stopEvent = this._state.getLastState(\"stopped\", computedTime);\n        // get previously memoized ticks if available\n        const memoizedEvent = this._ticksAtTime.get(computedTime);\n        // this event allows forEachBetween to iterate until the current time\n        const tmpEvent = {\n            state: \"paused\",\n            time: computedTime,\n        };\n        this._state.add(tmpEvent);\n        // keep track of the previous offset event\n        let lastState = memoizedEvent ? memoizedEvent : stopEvent;\n        let elapsedTicks = memoizedEvent ? memoizedEvent.ticks : 0;\n        let eventToMemoize = null;\n        // iterate through all the events since the last stop\n        this._state.forEachBetween(lastState.time, computedTime + this.sampleTime, (e) => {\n            let periodStartTime = lastState.time;\n            // if there is an offset event in this period use that\n            const offsetEvent = this._tickOffset.get(e.time);\n            if (offsetEvent && offsetEvent.time >= lastState.time) {\n                elapsedTicks = offsetEvent.ticks;\n                periodStartTime = offsetEvent.time;\n            }\n            if (lastState.state === \"started\" && e.state !== \"started\") {\n                elapsedTicks +=\n                    this.frequency.getTicksAtTime(e.time) -\n                        this.frequency.getTicksAtTime(periodStartTime);\n                // do not memoize the temporary event\n                if (e.time !== tmpEvent.time) {\n                    eventToMemoize = {\n                        state: e.state,\n                        time: e.time,\n                        ticks: elapsedTicks,\n                    };\n                }\n            }\n            lastState = e;\n        });\n        // remove the temporary event\n        this._state.remove(tmpEvent);\n        // memoize the ticks at the most recent event with state other than \"started\"\n        if (eventToMemoize) {\n            this._ticksAtTime.add(eventToMemoize);\n        }\n        // return the ticks\n        return elapsedTicks;\n    }\n    /**\n     * The number of times the callback was invoked. Starts counting at 0\n     * and increments after the callback was invoked. Returns -1 when stopped.\n     */\n    get ticks() {\n        return this.getTicksAtTime(this.now());\n    }\n    set ticks(t) {\n        this.setTicksAtTime(t, this.now());\n    }\n    /**\n     * The time since ticks=0 that the TickSource has been running. Accounts\n     * for tempo curves\n     */\n    get seconds() {\n        return this.getSecondsAtTime(this.now());\n    }\n    set seconds(s) {\n        const now = this.now();\n        const ticks = this.frequency.timeToTicks(s, now);\n        this.setTicksAtTime(ticks, now);\n    }\n    /**\n     * Return the elapsed seconds at the given time.\n     * @param  time  When to get the elapsed seconds\n     * @return  The number of elapsed seconds\n     */\n    getSecondsAtTime(time) {\n        time = this.toSeconds(time);\n        const stopEvent = this._state.getLastState(\"stopped\", time);\n        // this event allows forEachBetween to iterate until the current time\n        const tmpEvent = { state: \"paused\", time };\n        this._state.add(tmpEvent);\n        // get previously memoized seconds if available\n        const memoizedEvent = this._secondsAtTime.get(time);\n        // keep track of the previous offset event\n        let lastState = memoizedEvent ? memoizedEvent : stopEvent;\n        let elapsedSeconds = memoizedEvent ? memoizedEvent.seconds : 0;\n        let eventToMemoize = null;\n        // iterate through all the events since the last stop\n        this._state.forEachBetween(lastState.time, time + this.sampleTime, (e) => {\n            let periodStartTime = lastState.time;\n            // if there is an offset event in this period use that\n            const offsetEvent = this._tickOffset.get(e.time);\n            if (offsetEvent && offsetEvent.time >= lastState.time) {\n                elapsedSeconds = offsetEvent.seconds;\n                periodStartTime = offsetEvent.time;\n            }\n            if (lastState.state === \"started\" && e.state !== \"started\") {\n                elapsedSeconds += e.time - periodStartTime;\n                // do not memoize the temporary event\n                if (e.time !== tmpEvent.time) {\n                    eventToMemoize = {\n                        state: e.state,\n                        time: e.time,\n                        seconds: elapsedSeconds,\n                    };\n                }\n            }\n            lastState = e;\n        });\n        // remove the temporary event\n        this._state.remove(tmpEvent);\n        // memoize the seconds at the most recent event with state other than \"started\"\n        if (eventToMemoize) {\n            this._secondsAtTime.add(eventToMemoize);\n        }\n        // return the seconds\n        return elapsedSeconds;\n    }\n    /**\n     * Set the clock's ticks at the given time.\n     * @param  ticks The tick value to set\n     * @param  time  When to set the tick value\n     */\n    setTicksAtTime(ticks, time) {\n        time = this.toSeconds(time);\n        this._tickOffset.cancel(time);\n        this._tickOffset.add({\n            seconds: this.frequency.getDurationOfTicks(ticks, time),\n            ticks,\n            time,\n        });\n        this._ticksAtTime.cancel(time);\n        this._secondsAtTime.cancel(time);\n        return this;\n    }\n    /**\n     * Returns the scheduled state at the given time.\n     * @param  time  The time to query.\n     */\n    getStateAtTime(time) {\n        time = this.toSeconds(time);\n        return this._state.getValueAtTime(time);\n    }\n    /**\n     * Get the time of the given tick. The second argument\n     * is when to test before. Since ticks can be set (with setTicksAtTime)\n     * there may be multiple times for a given tick value.\n     * @param  tick The tick number.\n     * @param  before When to measure the tick value from.\n     * @return The time of the tick\n     */\n    getTimeOfTick(tick, before = this.now()) {\n        const offset = this._tickOffset.get(before);\n        const event = this._state.get(before);\n        const startTime = Math.max(offset.time, event.time);\n        const absoluteTicks = this.frequency.getTicksAtTime(startTime) + tick - offset.ticks;\n        return this.frequency.getTimeOfTick(absoluteTicks);\n    }\n    /**\n     * Invoke the callback event at all scheduled ticks between the\n     * start time and the end time\n     * @param  startTime  The beginning of the search range\n     * @param  endTime    The end of the search range\n     * @param  callback   The callback to invoke with each tick\n     */\n    forEachTickBetween(startTime, endTime, callback) {\n        // only iterate through the sections where it is \"started\"\n        let lastStateEvent = this._state.get(startTime);\n        this._state.forEachBetween(startTime, endTime, (event) => {\n            if (lastStateEvent &&\n                lastStateEvent.state === \"started\" &&\n                event.state !== \"started\") {\n                this.forEachTickBetween(Math.max(lastStateEvent.time, startTime), event.time - this.sampleTime, callback);\n            }\n            lastStateEvent = event;\n        });\n        let error = null;\n        if (lastStateEvent && lastStateEvent.state === \"started\") {\n            const maxStartTime = Math.max(lastStateEvent.time, startTime);\n            // figure out the difference between the frequency ticks and the\n            const startTicks = this.frequency.getTicksAtTime(maxStartTime);\n            const ticksAtStart = this.frequency.getTicksAtTime(lastStateEvent.time);\n            const diff = startTicks - ticksAtStart;\n            let offset = Math.ceil(diff) - diff;\n            // guard against floating point issues\n            offset = EQ(offset, 1) ? 0 : offset;\n            let nextTickTime = this.frequency.getTimeOfTick(startTicks + offset);\n            while (nextTickTime < endTime) {\n                try {\n                    callback(nextTickTime, Math.round(this.getTicksAtTime(nextTickTime)));\n                }\n                catch (e) {\n                    error = e;\n                    break;\n                }\n                nextTickTime += this.frequency.getDurationOfTicks(1, nextTickTime);\n            }\n        }\n        if (error) {\n            throw error;\n        }\n        return this;\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        super.dispose();\n        this._state.dispose();\n        this._tickOffset.dispose();\n        this._ticksAtTime.dispose();\n        this._secondsAtTime.dispose();\n        this.frequency.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=TickSource.js.map","import { ToneWithContext, } from \"../context/ToneWithContext.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { Emitter } from \"../util/Emitter.js\";\nimport { noOp, readOnly } from \"../util/Interface.js\";\nimport { StateTimeline } from \"../util/StateTimeline.js\";\nimport { TickSource } from \"./TickSource.js\";\nimport { assertContextRunning } from \"../util/Debug.js\";\n/**\n * A sample accurate clock which provides a callback at the given rate.\n * While the callback is not sample-accurate (it is still susceptible to\n * loose JS timing), the time passed in as the argument to the callback\n * is precise. For most applications, it is better to use Tone.Transport\n * instead of the Clock by itself since you can synchronize multiple callbacks.\n * @example\n * // the callback will be invoked approximately once a second\n * // and will print the time exactly once a second apart.\n * const clock = new Tone.Clock(time => {\n * \tconsole.log(time);\n * }, 1);\n * clock.start();\n * @category Core\n */\nexport class Clock extends ToneWithContext {\n    constructor() {\n        const options = optionsFromArguments(Clock.getDefaults(), arguments, [\n            \"callback\",\n            \"frequency\",\n        ]);\n        super(options);\n        this.name = \"Clock\";\n        /**\n         * The callback function to invoke at the scheduled tick.\n         */\n        this.callback = noOp;\n        /**\n         * The last time the loop callback was invoked\n         */\n        this._lastUpdate = 0;\n        /**\n         * Keep track of the playback state\n         */\n        this._state = new StateTimeline(\"stopped\");\n        /**\n         * Context bound reference to the _loop method\n         * This is necessary to remove the event in the end.\n         */\n        this._boundLoop = this._loop.bind(this);\n        this.callback = options.callback;\n        this._tickSource = new TickSource({\n            context: this.context,\n            frequency: options.frequency,\n            units: options.units,\n        });\n        this._lastUpdate = 0;\n        this.frequency = this._tickSource.frequency;\n        readOnly(this, \"frequency\");\n        // add an initial state\n        this._state.setStateAtTime(\"stopped\", 0);\n        // bind a callback to the worker thread\n        this.context.on(\"tick\", this._boundLoop);\n    }\n    static getDefaults() {\n        return Object.assign(ToneWithContext.getDefaults(), {\n            callback: noOp,\n            frequency: 1,\n            units: \"hertz\",\n        });\n    }\n    /**\n     * Returns the playback state of the source, either \"started\", \"stopped\" or \"paused\".\n     */\n    get state() {\n        return this._state.getValueAtTime(this.now());\n    }\n    /**\n     * Start the clock at the given time. Optionally pass in an offset\n     * of where to start the tick counter from.\n     * @param  time    The time the clock should start\n     * @param offset  Where the tick counter starts counting from.\n     */\n    start(time, offset) {\n        // make sure the context is running\n        assertContextRunning(this.context);\n        // start the loop\n        const computedTime = this.toSeconds(time);\n        this.log(\"start\", computedTime);\n        if (this._state.getValueAtTime(computedTime) !== \"started\") {\n            this._state.setStateAtTime(\"started\", computedTime);\n            this._tickSource.start(computedTime, offset);\n            if (computedTime < this._lastUpdate) {\n                this.emit(\"start\", computedTime, offset);\n            }\n        }\n        return this;\n    }\n    /**\n     * Stop the clock. Stopping the clock resets the tick counter to 0.\n     * @param time The time when the clock should stop.\n     * @example\n     * const clock = new Tone.Clock(time => {\n     * \tconsole.log(time);\n     * }, 1);\n     * clock.start();\n     * // stop the clock after 10 seconds\n     * clock.stop(\"+10\");\n     */\n    stop(time) {\n        const computedTime = this.toSeconds(time);\n        this.log(\"stop\", computedTime);\n        this._state.cancel(computedTime);\n        this._state.setStateAtTime(\"stopped\", computedTime);\n        this._tickSource.stop(computedTime);\n        if (computedTime < this._lastUpdate) {\n            this.emit(\"stop\", computedTime);\n        }\n        return this;\n    }\n    /**\n     * Pause the clock. Pausing does not reset the tick counter.\n     * @param time The time when the clock should stop.\n     */\n    pause(time) {\n        const computedTime = this.toSeconds(time);\n        if (this._state.getValueAtTime(computedTime) === \"started\") {\n            this._state.setStateAtTime(\"paused\", computedTime);\n            this._tickSource.pause(computedTime);\n            if (computedTime < this._lastUpdate) {\n                this.emit(\"pause\", computedTime);\n            }\n        }\n        return this;\n    }\n    /**\n     * The number of times the callback was invoked. Starts counting at 0\n     * and increments after the callback was invoked.\n     */\n    get ticks() {\n        return Math.ceil(this.getTicksAtTime(this.now()));\n    }\n    set ticks(t) {\n        this._tickSource.ticks = t;\n    }\n    /**\n     * The time since ticks=0 that the Clock has been running. Accounts for tempo curves\n     */\n    get seconds() {\n        return this._tickSource.seconds;\n    }\n    set seconds(s) {\n        this._tickSource.seconds = s;\n    }\n    /**\n     * Return the elapsed seconds at the given time.\n     * @param  time  When to get the elapsed seconds\n     * @return  The number of elapsed seconds\n     */\n    getSecondsAtTime(time) {\n        return this._tickSource.getSecondsAtTime(time);\n    }\n    /**\n     * Set the clock's ticks at the given time.\n     * @param  ticks The tick value to set\n     * @param  time  When to set the tick value\n     */\n    setTicksAtTime(ticks, time) {\n        this._tickSource.setTicksAtTime(ticks, time);\n        return this;\n    }\n    /**\n     * Get the time of the given tick. The second argument\n     * is when to test before. Since ticks can be set (with setTicksAtTime)\n     * there may be multiple times for a given tick value.\n     * @param  tick The tick number.\n     * @param  before When to measure the tick value from.\n     * @return The time of the tick\n     */\n    getTimeOfTick(tick, before = this.now()) {\n        return this._tickSource.getTimeOfTick(tick, before);\n    }\n    /**\n     * Get the clock's ticks at the given time.\n     * @param  time  When to get the tick value\n     * @return The tick value at the given time.\n     */\n    getTicksAtTime(time) {\n        return this._tickSource.getTicksAtTime(time);\n    }\n    /**\n     * Get the time of the next tick\n     * @param  offset The tick number.\n     */\n    nextTickTime(offset, when) {\n        const computedTime = this.toSeconds(when);\n        const currentTick = this.getTicksAtTime(computedTime);\n        return this._tickSource.getTimeOfTick(currentTick + offset, computedTime);\n    }\n    /**\n     * The scheduling loop.\n     */\n    _loop() {\n        const startTime = this._lastUpdate;\n        const endTime = this.now();\n        this._lastUpdate = endTime;\n        this.log(\"loop\", startTime, endTime);\n        if (startTime !== endTime) {\n            // the state change events\n            this._state.forEachBetween(startTime, endTime, (e) => {\n                switch (e.state) {\n                    case \"started\":\n                        const offset = this._tickSource.getTicksAtTime(e.time);\n                        this.emit(\"start\", e.time, offset);\n                        break;\n                    case \"stopped\":\n                        if (e.time !== 0) {\n                            this.emit(\"stop\", e.time);\n                        }\n                        break;\n                    case \"paused\":\n                        this.emit(\"pause\", e.time);\n                        break;\n                }\n            });\n            // the tick callbacks\n            this._tickSource.forEachTickBetween(startTime, endTime, (time, ticks) => {\n                this.callback(time, ticks);\n            });\n        }\n    }\n    /**\n     * Returns the scheduled state at the given time.\n     * @param  time  The time to query.\n     * @return  The name of the state input in setStateAtTime.\n     * @example\n     * const clock = new Tone.Clock();\n     * clock.start(\"+0.1\");\n     * clock.getStateAtTime(\"+0.1\"); // returns \"started\"\n     */\n    getStateAtTime(time) {\n        const computedTime = this.toSeconds(time);\n        return this._state.getValueAtTime(computedTime);\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        super.dispose();\n        this.context.off(\"tick\", this._boundLoop);\n        this._tickSource.dispose();\n        this._state.dispose();\n        return this;\n    }\n}\nEmitter.mixin(Clock);\n//# sourceMappingURL=Clock.js.map","import { Gain } from \"../../core/context/Gain.js\";\nimport { ToneAudioNode, } from \"../../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\n/**\n * Volume is a simple volume node, useful for creating a volume fader.\n *\n * @example\n * const vol = new Tone.Volume(-12).toDestination();\n * const osc = new Tone.Oscillator().connect(vol).start();\n * @category Component\n */\nexport class Volume extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Volume.getDefaults(), arguments, [\n            \"volume\",\n        ]);\n        super(options);\n        this.name = \"Volume\";\n        this.input = this.output = new Gain({\n            context: this.context,\n            gain: options.volume,\n            units: \"decibels\",\n        });\n        this.volume = this.output.gain;\n        readOnly(this, \"volume\");\n        this._unmutedVolume = options.volume;\n        // set the mute initially\n        this.mute = options.mute;\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            mute: false,\n            volume: 0,\n        });\n    }\n    /**\n     * Mute the output.\n     * @example\n     * const vol = new Tone.Volume(-12).toDestination();\n     * const osc = new Tone.Oscillator().connect(vol).start();\n     * // mute the output\n     * vol.mute = true;\n     */\n    get mute() {\n        return this.volume.value === -Infinity;\n    }\n    set mute(mute) {\n        if (!this.mute && mute) {\n            this._unmutedVolume = this.volume.value;\n            // maybe it should ramp here?\n            this.volume.value = -Infinity;\n        }\n        else if (this.mute && !mute) {\n            this.volume.value = this._unmutedVolume;\n        }\n    }\n    /**\n     * clean up\n     */\n    dispose() {\n        super.dispose();\n        this.input.dispose();\n        this.volume.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=Volume.js.map","import { Volume } from \"../../component/channel/Volume.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { onContextClose, onContextInit } from \"./ContextInitialization.js\";\nimport { Gain } from \"./Gain.js\";\nimport { connectSeries, ToneAudioNode, } from \"./ToneAudioNode.js\";\n/**\n * A single master output which is connected to the\n * AudioDestinationNode (aka your speakers).\n * It provides useful conveniences such as the ability\n * to set the volume and mute the entire application.\n * It also gives you the ability to apply master effects to your application.\n *\n * @example\n * const oscillator = new Tone.Oscillator().start();\n * // the audio will go from the oscillator to the speakers\n * oscillator.connect(Tone.getDestination());\n * // a convenience for connecting to the master output is also provided:\n * oscillator.toDestination();\n * @category Core\n */\nexport class DestinationClass extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(DestinationClass.getDefaults(), arguments);\n        super(options);\n        this.name = \"Destination\";\n        this.input = new Volume({ context: this.context });\n        this.output = new Gain({ context: this.context });\n        /**\n         * The volume of the master output in decibels. -Infinity is silent, and 0 is no change.\n         * @example\n         * const osc = new Tone.Oscillator().toDestination();\n         * osc.start();\n         * // ramp the volume down to silent over 10 seconds\n         * Tone.getDestination().volume.rampTo(-Infinity, 10);\n         */\n        this.volume = this.input.volume;\n        connectSeries(this.input, this.output, this.context.rawContext.destination);\n        this.mute = options.mute;\n        this._internalChannels = [\n            this.input,\n            this.context.rawContext.destination,\n            this.output,\n        ];\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            mute: false,\n            volume: 0,\n        });\n    }\n    /**\n     * Mute the output.\n     * @example\n     * const oscillator = new Tone.Oscillator().start().toDestination();\n     * setTimeout(() => {\n     * \t// mute the output\n     * \tTone.Destination.mute = true;\n     * }, 1000);\n     */\n    get mute() {\n        return this.input.mute;\n    }\n    set mute(mute) {\n        this.input.mute = mute;\n    }\n    /**\n     * Add a master effects chain. NOTE: this will disconnect any nodes which were previously\n     * chained in the master effects chain.\n     * @param args All arguments will be connected in a row and the Master will be routed through it.\n     * @example\n     * // route all audio through a filter and compressor\n     * const lowpass = new Tone.Filter(800, \"lowpass\");\n     * const compressor = new Tone.Compressor(-18);\n     * Tone.Destination.chain(lowpass, compressor);\n     */\n    chain(...args) {\n        this.input.disconnect();\n        args.unshift(this.input);\n        args.push(this.output);\n        connectSeries(...args);\n        return this;\n    }\n    /**\n     * The maximum number of channels the system can output\n     * @example\n     * console.log(Tone.Destination.maxChannelCount);\n     */\n    get maxChannelCount() {\n        return this.context.rawContext.destination.maxChannelCount;\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        super.dispose();\n        this.volume.dispose();\n        return this;\n    }\n}\n//-------------------------------------\n// \tINITIALIZATION\n//-------------------------------------\nonContextInit((context) => {\n    context.destination = new DestinationClass({ context });\n});\nonContextClose((context) => {\n    context.destination.dispose();\n});\n//# sourceMappingURL=Destination.js.map","import { ToneAudioNode } from \"./ToneAudioNode.js\";\nimport { Param } from \"./Param.js\";\nimport { onContextClose, onContextInit } from \"./ContextInitialization.js\";\n/**\n * Tone.Listener is a thin wrapper around the AudioListener. Listener combined\n * with {@link Panner3D} makes up the Web Audio API's 3D panning system. Panner3D allows you\n * to place sounds in 3D and Listener allows you to navigate the 3D sound environment from\n * a first-person perspective. There is only one listener per audio context.\n */\nexport class ListenerClass extends ToneAudioNode {\n    constructor() {\n        super(...arguments);\n        this.name = \"Listener\";\n        this.positionX = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.positionX,\n        });\n        this.positionY = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.positionY,\n        });\n        this.positionZ = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.positionZ,\n        });\n        this.forwardX = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.forwardX,\n        });\n        this.forwardY = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.forwardY,\n        });\n        this.forwardZ = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.forwardZ,\n        });\n        this.upX = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.upX,\n        });\n        this.upY = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.upY,\n        });\n        this.upZ = new Param({\n            context: this.context,\n            param: this.context.rawContext.listener.upZ,\n        });\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            positionX: 0,\n            positionY: 0,\n            positionZ: 0,\n            forwardX: 0,\n            forwardY: 0,\n            forwardZ: -1,\n            upX: 0,\n            upY: 1,\n            upZ: 0,\n        });\n    }\n    dispose() {\n        super.dispose();\n        this.positionX.dispose();\n        this.positionY.dispose();\n        this.positionZ.dispose();\n        this.forwardX.dispose();\n        this.forwardY.dispose();\n        this.forwardZ.dispose();\n        this.upX.dispose();\n        this.upY.dispose();\n        this.upZ.dispose();\n        return this;\n    }\n}\n//-------------------------------------\n// \tINITIALIZATION\n//-------------------------------------\nonContextInit((context) => {\n    context.listener = new ListenerClass({ context });\n});\nonContextClose((context) => {\n    context.listener.dispose();\n});\n//# sourceMappingURL=Listener.js.map","import { Tone } from \"../Tone.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { noOp } from \"../util/Interface.js\";\nimport { isString } from \"../util/TypeCheck.js\";\nimport { ToneAudioBuffer } from \"./ToneAudioBuffer.js\";\nimport { assert } from \"../util/Debug.js\";\n/**\n * A data structure for holding multiple buffers in a Map-like datastructure.\n *\n * @example\n * const pianoSamples = new Tone.ToneAudioBuffers({\n * \tA1: \"https://tonejs.github.io/audio/casio/A1.mp3\",\n * \tA2: \"https://tonejs.github.io/audio/casio/A2.mp3\",\n * }, () => {\n * \tconst player = new Tone.Player().toDestination();\n * \t// play one of the samples when they all load\n * \tplayer.buffer = pianoSamples.get(\"A2\");\n * \tplayer.start();\n * });\n * @example\n * // To pass in additional parameters in the second parameter\n * const buffers = new Tone.ToneAudioBuffers({\n * \t urls: {\n * \t\t A1: \"A1.mp3\",\n * \t\t A2: \"A2.mp3\",\n * \t },\n * \t onload: () => console.log(\"loaded\"),\n * \t baseUrl: \"https://tonejs.github.io/audio/casio/\"\n * });\n * @category Core\n */\nexport class ToneAudioBuffers extends Tone {\n    constructor() {\n        super();\n        this.name = \"ToneAudioBuffers\";\n        /**\n         * All of the buffers\n         */\n        this._buffers = new Map();\n        /**\n         * Keep track of the number of loaded buffers\n         */\n        this._loadingCount = 0;\n        const options = optionsFromArguments(ToneAudioBuffers.getDefaults(), arguments, [\"urls\", \"onload\", \"baseUrl\"], \"urls\");\n        this.baseUrl = options.baseUrl;\n        // add each one\n        Object.keys(options.urls).forEach((name) => {\n            this._loadingCount++;\n            const url = options.urls[name];\n            this.add(name, url, this._bufferLoaded.bind(this, options.onload), options.onerror);\n        });\n    }\n    static getDefaults() {\n        return {\n            baseUrl: \"\",\n            onerror: noOp,\n            onload: noOp,\n            urls: {},\n        };\n    }\n    /**\n     * True if the buffers object has a buffer by that name.\n     * @param  name  The key or index of the buffer.\n     */\n    has(name) {\n        return this._buffers.has(name.toString());\n    }\n    /**\n     * Get a buffer by name. If an array was loaded,\n     * then use the array index.\n     * @param  name  The key or index of the buffer.\n     */\n    get(name) {\n        assert(this.has(name), `ToneAudioBuffers has no buffer named: ${name}`);\n        return this._buffers.get(name.toString());\n    }\n    /**\n     * A buffer was loaded. decrement the counter.\n     */\n    _bufferLoaded(callback) {\n        this._loadingCount--;\n        if (this._loadingCount === 0 && callback) {\n            callback();\n        }\n    }\n    /**\n     * If the buffers are loaded or not\n     */\n    get loaded() {\n        return Array.from(this._buffers).every(([_, buffer]) => buffer.loaded);\n    }\n    /**\n     * Add a buffer by name and url to the Buffers\n     * @param  name      A unique name to give the buffer\n     * @param  url  Either the url of the bufer, or a buffer which will be added with the given name.\n     * @param  callback  The callback to invoke when the url is loaded.\n     * @param  onerror  Invoked if the buffer can't be loaded\n     */\n    add(name, url, callback = noOp, onerror = noOp) {\n        if (isString(url)) {\n            // don't include the baseUrl if the url is a base64 encoded sound\n            if (this.baseUrl &&\n                url.trim().substring(0, 11).toLowerCase() === \"data:audio/\") {\n                this.baseUrl = \"\";\n            }\n            this._buffers.set(name.toString(), new ToneAudioBuffer(this.baseUrl + url, callback, onerror));\n        }\n        else {\n            this._buffers.set(name.toString(), new ToneAudioBuffer(url, callback, onerror));\n        }\n        return this;\n    }\n    dispose() {\n        super.dispose();\n        this._buffers.forEach((buffer) => buffer.dispose());\n        this._buffers.clear();\n        return this;\n    }\n}\n//# sourceMappingURL=ToneAudioBuffers.js.map","import { getContext } from \"../Global.js\";\nimport { ftom, mtof } from \"./Conversions.js\";\nimport { FrequencyClass } from \"./Frequency.js\";\n/**\n * Midi is a primitive type for encoding Time values.\n * Midi can be constructed with or without the `new` keyword. Midi can be passed\n * into the parameter of any method which takes time as an argument.\n * @category Unit\n */\nexport class MidiClass extends FrequencyClass {\n    constructor() {\n        super(...arguments);\n        this.name = \"MidiClass\";\n        this.defaultUnits = \"midi\";\n    }\n    /**\n     * Returns the value of a frequency in the current units\n     */\n    _frequencyToUnits(freq) {\n        return ftom(super._frequencyToUnits(freq));\n    }\n    /**\n     * Returns the value of a tick in the current time units\n     */\n    _ticksToUnits(ticks) {\n        return ftom(super._ticksToUnits(ticks));\n    }\n    /**\n     * Return the value of the beats in the current units\n     */\n    _beatsToUnits(beats) {\n        return ftom(super._beatsToUnits(beats));\n    }\n    /**\n     * Returns the value of a second in the current units\n     */\n    _secondsToUnits(seconds) {\n        return ftom(super._secondsToUnits(seconds));\n    }\n    /**\n     * Return the value of the frequency as a MIDI note\n     * @example\n     * Tone.Midi(60).toMidi(); // 60\n     */\n    toMidi() {\n        return this.valueOf();\n    }\n    /**\n     * Return the value of the frequency as a MIDI note\n     * @example\n     * Tone.Midi(60).toFrequency(); // 261.6255653005986\n     */\n    toFrequency() {\n        return mtof(this.toMidi());\n    }\n    /**\n     * Transposes the frequency by the given number of semitones.\n     * @return A new transposed MidiClass\n     * @example\n     * Tone.Midi(\"A4\").transpose(3); // \"C5\"\n     */\n    transpose(interval) {\n        return new MidiClass(this.context, this.toMidi() + interval);\n    }\n}\n/**\n * Convert a value into a FrequencyClass object.\n * @category Unit\n */\nexport function Midi(value, units) {\n    return new MidiClass(getContext(), value, units);\n}\n//# sourceMappingURL=Midi.js.map","import { getContext } from \"../Global.js\";\nimport { TransportTimeClass } from \"./TransportTime.js\";\n/**\n * Ticks is a primitive type for encoding Time values.\n * Ticks can be constructed with or without the `new` keyword. Ticks can be passed\n * into the parameter of any method which takes time as an argument.\n * @example\n * const t = Tone.Ticks(\"4n\"); // a quarter note as ticks\n * @category Unit\n */\nexport class TicksClass extends TransportTimeClass {\n    constructor() {\n        super(...arguments);\n        this.name = \"Ticks\";\n        this.defaultUnits = \"i\";\n    }\n    /**\n     * Get the current time in the given units\n     */\n    _now() {\n        return this.context.transport.ticks;\n    }\n    /**\n     * Return the value of the beats in the current units\n     */\n    _beatsToUnits(beats) {\n        return this._getPPQ() * beats;\n    }\n    /**\n     * Returns the value of a second in the current units\n     */\n    _secondsToUnits(seconds) {\n        return Math.floor((seconds / (60 / this._getBpm())) * this._getPPQ());\n    }\n    /**\n     * Returns the value of a tick in the current time units\n     */\n    _ticksToUnits(ticks) {\n        return ticks;\n    }\n    /**\n     * Return the time in ticks\n     */\n    toTicks() {\n        return this.valueOf();\n    }\n    /**\n     * Return the time in seconds\n     */\n    toSeconds() {\n        return (this.valueOf() / this._getPPQ()) * (60 / this._getBpm());\n    }\n}\n/**\n * Convert a time representation to ticks\n * @category Unit\n */\nexport function Ticks(value, units) {\n    return new TicksClass(getContext(), value, units);\n}\n//# sourceMappingURL=Ticks.js.map","import { ToneWithContext, } from \"../context/ToneWithContext.js\";\nimport { Timeline } from \"./Timeline.js\";\nimport { onContextClose, onContextInit, } from \"../context/ContextInitialization.js\";\n/**\n * Draw is useful for synchronizing visuals and audio events.\n * Callbacks from Tone.Transport or any of the Tone.Event classes\n * always happen _before_ the scheduled time and are not synchronized\n * to the animation frame so they are not good for triggering tightly\n * synchronized visuals and sound. Draw makes it easy to schedule\n * callbacks using the AudioContext time and uses requestAnimationFrame.\n * @example\n * Tone.Transport.schedule((time) => {\n * \t// use the time argument to schedule a callback with Draw\n * \tTone.Draw.schedule(() => {\n * \t\t// do drawing or DOM manipulation here\n * \t\tconsole.log(time);\n * \t}, time);\n * }, \"+0.5\");\n * Tone.Transport.start();\n * @category Core\n */\nexport class DrawClass extends ToneWithContext {\n    constructor() {\n        super(...arguments);\n        this.name = \"Draw\";\n        /**\n         * The duration after which events are not invoked.\n         */\n        this.expiration = 0.25;\n        /**\n         * The amount of time before the scheduled time\n         * that the callback can be invoked. Default is\n         * half the time of an animation frame (0.008 seconds).\n         */\n        this.anticipation = 0.008;\n        /**\n         * All of the events.\n         */\n        this._events = new Timeline();\n        /**\n         * The draw loop\n         */\n        this._boundDrawLoop = this._drawLoop.bind(this);\n        /**\n         * The animation frame id\n         */\n        this._animationFrame = -1;\n    }\n    /**\n     * Schedule a function at the given time to be invoked\n     * on the nearest animation frame.\n     * @param  callback  Callback is invoked at the given time.\n     * @param  time      The time relative to the AudioContext time to invoke the callback.\n     * @example\n     * Tone.Transport.scheduleRepeat(time => {\n     * \tTone.Draw.schedule(() => console.log(time), time);\n     * }, 1);\n     * Tone.Transport.start();\n     */\n    schedule(callback, time) {\n        this._events.add({\n            callback,\n            time: this.toSeconds(time),\n        });\n        // start the draw loop on the first event\n        if (this._events.length === 1) {\n            this._animationFrame = requestAnimationFrame(this._boundDrawLoop);\n        }\n        return this;\n    }\n    /**\n     * Cancel events scheduled after the given time\n     * @param  after  Time after which scheduled events will be removed from the scheduling timeline.\n     */\n    cancel(after) {\n        this._events.cancel(this.toSeconds(after));\n        return this;\n    }\n    /**\n     * The draw loop\n     */\n    _drawLoop() {\n        const now = this.context.currentTime;\n        this._events.forEachBefore(now + this.anticipation, (event) => {\n            if (now - event.time <= this.expiration) {\n                event.callback();\n            }\n            this._events.remove(event);\n        });\n        if (this._events.length > 0) {\n            this._animationFrame = requestAnimationFrame(this._boundDrawLoop);\n        }\n    }\n    dispose() {\n        super.dispose();\n        this._events.dispose();\n        cancelAnimationFrame(this._animationFrame);\n        return this;\n    }\n}\n//-------------------------------------\n// \tINITIALIZATION\n//-------------------------------------\nonContextInit((context) => {\n    context.draw = new DrawClass({ context });\n});\nonContextClose((context) => {\n    context.draw.dispose();\n});\n//# sourceMappingURL=Draw.js.map","import { Tone } from \"../Tone.js\";\nimport { isDefined } from \"./TypeCheck.js\";\nimport { assert } from \"./Debug.js\";\n/**\n * Similar to Tone.Timeline, but all events represent\n * intervals with both \"time\" and \"duration\" times. The\n * events are placed in a tree structure optimized\n * for querying an intersection point with the timeline\n * events. Internally uses an [Interval Tree](https://en.wikipedia.org/wiki/Interval_tree)\n * to represent the data.\n * @internal\n */\nexport class IntervalTimeline extends Tone {\n    constructor() {\n        super(...arguments);\n        this.name = \"IntervalTimeline\";\n        /**\n         * The root node of the inteval tree\n         */\n        this._root = null;\n        /**\n         * Keep track of the length of the timeline.\n         */\n        this._length = 0;\n    }\n    /**\n     * The event to add to the timeline. All events must\n     * have a time and duration value\n     * @param  event  The event to add to the timeline\n     */\n    add(event) {\n        assert(isDefined(event.time), \"Events must have a time property\");\n        assert(isDefined(event.duration), \"Events must have a duration parameter\");\n        event.time = event.time.valueOf();\n        let node = new IntervalNode(event.time, event.time + event.duration, event);\n        if (this._root === null) {\n            this._root = node;\n        }\n        else {\n            this._root.insert(node);\n        }\n        this._length++;\n        // Restructure tree to be balanced\n        while (node !== null) {\n            node.updateHeight();\n            node.updateMax();\n            this._rebalance(node);\n            node = node.parent;\n        }\n        return this;\n    }\n    /**\n     * Remove an event from the timeline.\n     * @param  event  The event to remove from the timeline\n     */\n    remove(event) {\n        if (this._root !== null) {\n            const results = [];\n            this._root.search(event.time, results);\n            for (const node of results) {\n                if (node.event === event) {\n                    this._removeNode(node);\n                    this._length--;\n                    break;\n                }\n            }\n        }\n        return this;\n    }\n    /**\n     * The number of items in the timeline.\n     * @readOnly\n     */\n    get length() {\n        return this._length;\n    }\n    /**\n     * Remove events whose time time is after the given time\n     * @param  after  The time to query.\n     */\n    cancel(after) {\n        this.forEachFrom(after, (event) => this.remove(event));\n        return this;\n    }\n    /**\n     * Set the root node as the given node\n     */\n    _setRoot(node) {\n        this._root = node;\n        if (this._root !== null) {\n            this._root.parent = null;\n        }\n    }\n    /**\n     * Replace the references to the node in the node's parent\n     * with the replacement node.\n     */\n    _replaceNodeInParent(node, replacement) {\n        if (node.parent !== null) {\n            if (node.isLeftChild()) {\n                node.parent.left = replacement;\n            }\n            else {\n                node.parent.right = replacement;\n            }\n            this._rebalance(node.parent);\n        }\n        else {\n            this._setRoot(replacement);\n        }\n    }\n    /**\n     * Remove the node from the tree and replace it with\n     * a successor which follows the schema.\n     */\n    _removeNode(node) {\n        if (node.left === null && node.right === null) {\n            this._replaceNodeInParent(node, null);\n        }\n        else if (node.right === null) {\n            this._replaceNodeInParent(node, node.left);\n        }\n        else if (node.left === null) {\n            this._replaceNodeInParent(node, node.right);\n        }\n        else {\n            const balance = node.getBalance();\n            let replacement;\n            let temp = null;\n            if (balance > 0) {\n                if (node.left.right === null) {\n                    replacement = node.left;\n                    replacement.right = node.right;\n                    temp = replacement;\n                }\n                else {\n                    replacement = node.left.right;\n                    while (replacement.right !== null) {\n                        replacement = replacement.right;\n                    }\n                    if (replacement.parent) {\n                        replacement.parent.right = replacement.left;\n                        temp = replacement.parent;\n                        replacement.left = node.left;\n                        replacement.right = node.right;\n                    }\n                }\n            }\n            else if (node.right.left === null) {\n                replacement = node.right;\n                replacement.left = node.left;\n                temp = replacement;\n            }\n            else {\n                replacement = node.right.left;\n                while (replacement.left !== null) {\n                    replacement = replacement.left;\n                }\n                if (replacement.parent) {\n                    replacement.parent.left = replacement.right;\n                    temp = replacement.parent;\n                    replacement.left = node.left;\n                    replacement.right = node.right;\n                }\n            }\n            if (node.parent !== null) {\n                if (node.isLeftChild()) {\n                    node.parent.left = replacement;\n                }\n                else {\n                    node.parent.right = replacement;\n                }\n            }\n            else {\n                this._setRoot(replacement);\n            }\n            if (temp) {\n                this._rebalance(temp);\n            }\n        }\n        node.dispose();\n    }\n    /**\n     * Rotate the tree to the left\n     */\n    _rotateLeft(node) {\n        const parent = node.parent;\n        const isLeftChild = node.isLeftChild();\n        // Make node.right the new root of this sub tree (instead of node)\n        const pivotNode = node.right;\n        if (pivotNode) {\n            node.right = pivotNode.left;\n            pivotNode.left = node;\n        }\n        if (parent !== null) {\n            if (isLeftChild) {\n                parent.left = pivotNode;\n            }\n            else {\n                parent.right = pivotNode;\n            }\n        }\n        else {\n            this._setRoot(pivotNode);\n        }\n    }\n    /**\n     * Rotate the tree to the right\n     */\n    _rotateRight(node) {\n        const parent = node.parent;\n        const isLeftChild = node.isLeftChild();\n        // Make node.left the new root of this sub tree (instead of node)\n        const pivotNode = node.left;\n        if (pivotNode) {\n            node.left = pivotNode.right;\n            pivotNode.right = node;\n        }\n        if (parent !== null) {\n            if (isLeftChild) {\n                parent.left = pivotNode;\n            }\n            else {\n                parent.right = pivotNode;\n            }\n        }\n        else {\n            this._setRoot(pivotNode);\n        }\n    }\n    /**\n     * Balance the BST\n     */\n    _rebalance(node) {\n        const balance = node.getBalance();\n        if (balance > 1 && node.left) {\n            if (node.left.getBalance() < 0) {\n                this._rotateLeft(node.left);\n            }\n            else {\n                this._rotateRight(node);\n            }\n        }\n        else if (balance < -1 && node.right) {\n            if (node.right.getBalance() > 0) {\n                this._rotateRight(node.right);\n            }\n            else {\n                this._rotateLeft(node);\n            }\n        }\n    }\n    /**\n     * Get an event whose time and duration span the give time. Will\n     * return the match whose \"time\" value is closest to the given time.\n     * @return  The event which spans the desired time\n     */\n    get(time) {\n        if (this._root !== null) {\n            const results = [];\n            this._root.search(time, results);\n            if (results.length > 0) {\n                let max = results[0];\n                for (let i = 1; i < results.length; i++) {\n                    if (results[i].low > max.low) {\n                        max = results[i];\n                    }\n                }\n                return max.event;\n            }\n        }\n        return null;\n    }\n    /**\n     * Iterate over everything in the timeline.\n     * @param  callback The callback to invoke with every item\n     */\n    forEach(callback) {\n        if (this._root !== null) {\n            const allNodes = [];\n            this._root.traverse((node) => allNodes.push(node));\n            allNodes.forEach((node) => {\n                if (node.event) {\n                    callback(node.event);\n                }\n            });\n        }\n        return this;\n    }\n    /**\n     * Iterate over everything in the array in which the given time\n     * overlaps with the time and duration time of the event.\n     * @param  time The time to check if items are overlapping\n     * @param  callback The callback to invoke with every item\n     */\n    forEachAtTime(time, callback) {\n        if (this._root !== null) {\n            const results = [];\n            this._root.search(time, results);\n            results.forEach((node) => {\n                if (node.event) {\n                    callback(node.event);\n                }\n            });\n        }\n        return this;\n    }\n    /**\n     * Iterate over everything in the array in which the time is greater\n     * than or equal to the given time.\n     * @param  time The time to check if items are before\n     * @param  callback The callback to invoke with every item\n     */\n    forEachFrom(time, callback) {\n        if (this._root !== null) {\n            const results = [];\n            this._root.searchAfter(time, results);\n            results.forEach((node) => {\n                if (node.event) {\n                    callback(node.event);\n                }\n            });\n        }\n        return this;\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        super.dispose();\n        if (this._root !== null) {\n            this._root.traverse((node) => node.dispose());\n        }\n        this._root = null;\n        return this;\n    }\n}\n//-------------------------------------\n// \tINTERVAL NODE HELPER\n//-------------------------------------\n/**\n * Represents a node in the binary search tree, with the addition\n * of a \"high\" value which keeps track of the highest value of\n * its children.\n * References:\n * https://brooknovak.wordpress.com/2013/12/07/augmented-interval-tree-in-c/\n * http://www.mif.vu.lt/~valdas/ALGORITMAI/LITERATURA/Cormen/Cormen.pdf\n * @param low\n * @param high\n */\nclass IntervalNode {\n    constructor(low, high, event) {\n        // the nodes to the left\n        this._left = null;\n        // the nodes to the right\n        this._right = null;\n        // the parent node\n        this.parent = null;\n        // the number of child nodes\n        this.height = 0;\n        this.event = event;\n        // the low value\n        this.low = low;\n        // the high value\n        this.high = high;\n        // the high value for this and all child nodes\n        this.max = this.high;\n    }\n    /**\n     * Insert a node into the correct spot in the tree\n     */\n    insert(node) {\n        if (node.low <= this.low) {\n            if (this.left === null) {\n                this.left = node;\n            }\n            else {\n                this.left.insert(node);\n            }\n        }\n        else if (this.right === null) {\n            this.right = node;\n        }\n        else {\n            this.right.insert(node);\n        }\n    }\n    /**\n     * Search the tree for nodes which overlap\n     * with the given point\n     * @param  point  The point to query\n     * @param  results  The array to put the results\n     */\n    search(point, results) {\n        // If p is to the right of the rightmost point of any interval\n        // in this node and all children, there won't be any matches.\n        if (point > this.max) {\n            return;\n        }\n        // Search left children\n        if (this.left !== null) {\n            this.left.search(point, results);\n        }\n        // Check this node\n        if (this.low <= point && this.high > point) {\n            results.push(this);\n        }\n        // If p is to the left of the time of this interval,\n        // then it can't be in any child to the right.\n        if (this.low > point) {\n            return;\n        }\n        // Search right children\n        if (this.right !== null) {\n            this.right.search(point, results);\n        }\n    }\n    /**\n     * Search the tree for nodes which are less\n     * than the given point\n     * @param  point  The point to query\n     * @param  results  The array to put the results\n     */\n    searchAfter(point, results) {\n        // Check this node\n        if (this.low >= point) {\n            results.push(this);\n            if (this.left !== null) {\n                this.left.searchAfter(point, results);\n            }\n        }\n        // search the right side\n        if (this.right !== null) {\n            this.right.searchAfter(point, results);\n        }\n    }\n    /**\n     * Invoke the callback on this element and both it's branches\n     * @param  {Function}  callback\n     */\n    traverse(callback) {\n        callback(this);\n        if (this.left !== null) {\n            this.left.traverse(callback);\n        }\n        if (this.right !== null) {\n            this.right.traverse(callback);\n        }\n    }\n    /**\n     * Update the height of the node\n     */\n    updateHeight() {\n        if (this.left !== null && this.right !== null) {\n            this.height = Math.max(this.left.height, this.right.height) + 1;\n        }\n        else if (this.right !== null) {\n            this.height = this.right.height + 1;\n        }\n        else if (this.left !== null) {\n            this.height = this.left.height + 1;\n        }\n        else {\n            this.height = 0;\n        }\n    }\n    /**\n     * Update the height of the node\n     */\n    updateMax() {\n        this.max = this.high;\n        if (this.left !== null) {\n            this.max = Math.max(this.max, this.left.max);\n        }\n        if (this.right !== null) {\n            this.max = Math.max(this.max, this.right.max);\n        }\n    }\n    /**\n     * The balance is how the leafs are distributed on the node\n     * @return  Negative numbers are balanced to the right\n     */\n    getBalance() {\n        let balance = 0;\n        if (this.left !== null && this.right !== null) {\n            balance = this.left.height - this.right.height;\n        }\n        else if (this.left !== null) {\n            balance = this.left.height + 1;\n        }\n        else if (this.right !== null) {\n            balance = -(this.right.height + 1);\n        }\n        return balance;\n    }\n    /**\n     * @returns true if this node is the left child of its parent\n     */\n    isLeftChild() {\n        return this.parent !== null && this.parent.left === this;\n    }\n    /**\n     * get/set the left node\n     */\n    get left() {\n        return this._left;\n    }\n    set left(node) {\n        this._left = node;\n        if (node !== null) {\n            node.parent = this;\n        }\n        this.updateHeight();\n        this.updateMax();\n    }\n    /**\n     * get/set the right node\n     */\n    get right() {\n        return this._right;\n    }\n    set right(node) {\n        this._right = node;\n        if (node !== null) {\n            node.parent = this;\n        }\n        this.updateHeight();\n        this.updateMax();\n    }\n    /**\n     * null out references.\n     */\n    dispose() {\n        this.parent = null;\n        this._left = null;\n        this._right = null;\n        this.event = null;\n    }\n}\n//# sourceMappingURL=IntervalTimeline.js.map","import { Timeline } from \"./Timeline.js\";\nimport { Tone } from \"../Tone.js\";\n/**\n * Represents a single value which is gettable and settable in a timed way\n */\nexport class TimelineValue extends Tone {\n    /**\n     * @param initialValue The value to return if there is no scheduled values\n     */\n    constructor(initialValue) {\n        super();\n        this.name = \"TimelineValue\";\n        /**\n         * The timeline which stores the values\n         */\n        this._timeline = new Timeline({\n            memory: 10,\n        });\n        this._initialValue = initialValue;\n    }\n    /**\n     * Set the value at the given time\n     */\n    set(value, time) {\n        this._timeline.add({\n            value,\n            time,\n        });\n        return this;\n    }\n    /**\n     * Get the value at the given time\n     */\n    get(time) {\n        const event = this._timeline.get(time);\n        if (event) {\n            return event.value;\n        }\n        else {\n            return this._initialValue;\n        }\n    }\n}\n//# sourceMappingURL=TimelineValue.js.map","import { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { ToneAudioNode, } from \"../core/context/ToneAudioNode.js\";\nimport { connectSignal } from \"./Signal.js\";\n/**\n * A signal operator has an input and output and modifies the signal.\n */\nexport class SignalOperator extends ToneAudioNode {\n    constructor() {\n        super(optionsFromArguments(SignalOperator.getDefaults(), arguments, [\n            \"context\",\n        ]));\n    }\n    connect(destination, outputNum = 0, inputNum = 0) {\n        connectSignal(this, destination, outputNum, inputNum);\n        return this;\n    }\n}\n//# sourceMappingURL=SignalOperator.js.map","import { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { isArray, isFunction } from \"../core/util/TypeCheck.js\";\nimport { assert } from \"../core/util/Debug.js\";\nimport { Signal } from \"./Signal.js\";\nimport { SignalOperator } from \"./SignalOperator.js\";\n/**\n * Wraps the native Web Audio API\n * [WaveShaperNode](http://webaudio.github.io/web-audio-api/#the-waveshapernode-interface).\n *\n * @example\n * const osc = new Tone.Oscillator().toDestination().start();\n * // multiply the output of the signal by 2 using the waveshaper's function\n * const timesTwo = new Tone.WaveShaper((val) => val * 2, 2048).connect(osc.frequency);\n * const signal = new Tone.Signal(440).connect(timesTwo);\n * @category Signal\n */\nexport class WaveShaper extends SignalOperator {\n    constructor() {\n        const options = optionsFromArguments(WaveShaper.getDefaults(), arguments, [\"mapping\", \"length\"]);\n        super(options);\n        this.name = \"WaveShaper\";\n        /**\n         * the waveshaper node\n         */\n        this._shaper = this.context.createWaveShaper();\n        /**\n         * The input to the waveshaper node.\n         */\n        this.input = this._shaper;\n        /**\n         * The output from the waveshaper node\n         */\n        this.output = this._shaper;\n        if (isArray(options.mapping) ||\n            options.mapping instanceof Float32Array) {\n            this.curve = Float32Array.from(options.mapping);\n        }\n        else if (isFunction(options.mapping)) {\n            this.setMap(options.mapping, options.length);\n        }\n    }\n    static getDefaults() {\n        return Object.assign(Signal.getDefaults(), {\n            length: 1024,\n        });\n    }\n    /**\n     * Uses a mapping function to set the value of the curve.\n     * @param mapping The function used to define the values.\n     *                The mapping function take two arguments:\n     *                the first is the value at the current position\n     *                which goes from -1 to 1 over the number of elements\n     *                in the curve array. The second argument is the array position.\n     * @example\n     * const shaper = new Tone.WaveShaper();\n     * // map the input signal from [-1, 1] to [0, 10]\n     * shaper.setMap((val, index) => (val + 1) * 5);\n     */\n    setMap(mapping, length = 1024) {\n        const array = new Float32Array(length);\n        for (let i = 0, len = length; i < len; i++) {\n            const normalized = (i / (len - 1)) * 2 - 1;\n            array[i] = mapping(normalized, i);\n        }\n        this.curve = array;\n        return this;\n    }\n    /**\n     * The array to set as the waveshaper curve. For linear curves\n     * array length does not make much difference, but for complex curves\n     * longer arrays will provide smoother interpolation.\n     */\n    get curve() {\n        return this._shaper.curve;\n    }\n    set curve(mapping) {\n        this._shaper.curve = mapping;\n    }\n    /**\n     * Specifies what type of oversampling (if any) should be used when\n     * applying the shaping curve. Can either be \"none\", \"2x\" or \"4x\".\n     */\n    get oversample() {\n        return this._shaper.oversample;\n    }\n    set oversample(oversampling) {\n        const isOverSampleType = [\"none\", \"2x\", \"4x\"].some((str) => str.includes(oversampling));\n        assert(isOverSampleType, \"oversampling must be either 'none', '2x', or '4x'\");\n        this._shaper.oversample = oversampling;\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this._shaper.disconnect();\n        return this;\n    }\n}\n//# sourceMappingURL=WaveShaper.js.map","import { WaveShaper } from \"./WaveShaper.js\";\nimport { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { SignalOperator } from \"./SignalOperator.js\";\n/**\n * Pow applies an exponent to the incoming signal. The incoming signal must be AudioRange [-1, 1]\n *\n * @example\n * const pow = new Tone.Pow(2);\n * const sig = new Tone.Signal(0.5).connect(pow);\n * // output of pow is 0.25.\n * @category Signal\n */\nexport class Pow extends SignalOperator {\n    constructor() {\n        const options = optionsFromArguments(Pow.getDefaults(), arguments, [\n            \"value\",\n        ]);\n        super(options);\n        this.name = \"Pow\";\n        this._exponentScaler =\n            this.input =\n                this.output =\n                    new WaveShaper({\n                        context: this.context,\n                        mapping: this._expFunc(options.value),\n                        length: 8192,\n                    });\n        this._exponent = options.value;\n    }\n    static getDefaults() {\n        return Object.assign(SignalOperator.getDefaults(), {\n            value: 1,\n        });\n    }\n    /**\n     * the function which maps the waveshaper\n     * @param exponent exponent value\n     */\n    _expFunc(exponent) {\n        return (val) => {\n            return Math.pow(Math.abs(val), exponent);\n        };\n    }\n    /**\n     * The value of the exponent.\n     */\n    get value() {\n        return this._exponent;\n    }\n    set value(exponent) {\n        this._exponent = exponent;\n        this._exponentScaler.setMap(this._expFunc(this._exponent));\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this._exponentScaler.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=Pow.js.map","import { noOp } from \"../util/Interface.js\";\n/**\n * TransportEvent is an internal class used by {@link TransportClass}\n * to schedule events. Do no invoke this class directly, it is\n * handled from within Tone.Transport.\n */\nexport class TransportEvent {\n    /**\n     * @param transport The transport object which the event belongs to\n     */\n    constructor(transport, opts) {\n        /**\n         * The unique id of the event\n         */\n        this.id = TransportEvent._eventId++;\n        /**\n         * The remaining value between the passed in time, and Math.floor(time).\n         * This value is later added back when scheduling to get sub-tick precision.\n         */\n        this._remainderTime = 0;\n        const options = Object.assign(TransportEvent.getDefaults(), opts);\n        this.transport = transport;\n        this.callback = options.callback;\n        this._once = options.once;\n        this.time = Math.floor(options.time);\n        this._remainderTime = options.time - this.time;\n    }\n    static getDefaults() {\n        return {\n            callback: noOp,\n            once: false,\n            time: 0,\n        };\n    }\n    /**\n     * Get the time and remainder time.\n     */\n    get floatTime() {\n        return this.time + this._remainderTime;\n    }\n    /**\n     * Invoke the event callback.\n     * @param  time  The AudioContext time in seconds of the event\n     */\n    invoke(time) {\n        if (this.callback) {\n            const tickDuration = this.transport.bpm.getDurationOfTicks(1, time);\n            this.callback(time + this._remainderTime * tickDuration);\n            if (this._once) {\n                this.transport.clear(this.id);\n            }\n        }\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        this.callback = undefined;\n        return this;\n    }\n}\n/**\n * Current ID counter\n */\nTransportEvent._eventId = 0;\n//# sourceMappingURL=TransportEvent.js.map","import { TicksClass } from \"../type/Ticks.js\";\nimport { TransportEvent } from \"./TransportEvent.js\";\nimport { GT, LT } from \"../util/Math.js\";\n/**\n * TransportRepeatEvent is an internal class used by Tone.Transport\n * to schedule repeat events. This class should not be instantiated directly.\n */\nexport class TransportRepeatEvent extends TransportEvent {\n    /**\n     * @param transport The transport object which the event belongs to\n     */\n    constructor(transport, opts) {\n        super(transport, opts);\n        /**\n         * The ID of the current timeline event\n         */\n        this._currentId = -1;\n        /**\n         * The ID of the next timeline event\n         */\n        this._nextId = -1;\n        /**\n         * The time of the next event\n         */\n        this._nextTick = this.time;\n        /**\n         * a reference to the bound start method\n         */\n        this._boundRestart = this._restart.bind(this);\n        const options = Object.assign(TransportRepeatEvent.getDefaults(), opts);\n        this.duration = options.duration;\n        this._interval = options.interval;\n        this._nextTick = options.time;\n        this.transport.on(\"start\", this._boundRestart);\n        this.transport.on(\"loopStart\", this._boundRestart);\n        this.transport.on(\"ticks\", this._boundRestart);\n        this.context = this.transport.context;\n        this._restart();\n    }\n    static getDefaults() {\n        return Object.assign({}, TransportEvent.getDefaults(), {\n            duration: Infinity,\n            interval: 1,\n            once: false,\n        });\n    }\n    /**\n     * Invoke the callback. Returns the tick time which\n     * the next event should be scheduled at.\n     * @param  time  The AudioContext time in seconds of the event\n     */\n    invoke(time) {\n        // create more events if necessary\n        this._createEvents(time);\n        // call the super class\n        super.invoke(time);\n    }\n    /**\n     * Create an event on the transport on the nextTick\n     */\n    _createEvent() {\n        if (LT(this._nextTick, this.floatTime + this.duration)) {\n            return this.transport.scheduleOnce(this.invoke.bind(this), new TicksClass(this.context, this._nextTick).toSeconds());\n        }\n        return -1;\n    }\n    /**\n     * Push more events onto the timeline to keep up with the position of the timeline\n     */\n    _createEvents(time) {\n        // schedule the next event\n        // const ticks = this.transport.getTicksAtTime(time);\n        // if the next tick is within the bounds set by \"duration\"\n        if (LT(this._nextTick + this._interval, this.floatTime + this.duration)) {\n            this._nextTick += this._interval;\n            this._currentId = this._nextId;\n            this._nextId = this.transport.scheduleOnce(this.invoke.bind(this), new TicksClass(this.context, this._nextTick).toSeconds());\n        }\n    }\n    /**\n     * Re-compute the events when the transport time has changed from a start/ticks/loopStart event\n     */\n    _restart(time) {\n        this.transport.clear(this._currentId);\n        this.transport.clear(this._nextId);\n        // start at the first event\n        this._nextTick = this.floatTime;\n        const ticks = this.transport.getTicksAtTime(time);\n        if (GT(ticks, this.time)) {\n            // the event is not being scheduled from the beginning and should be offset\n            this._nextTick =\n                this.floatTime +\n                    Math.ceil((ticks - this.floatTime) / this._interval) *\n                        this._interval;\n        }\n        this._currentId = this._createEvent();\n        this._nextTick += this._interval;\n        this._nextId = this._createEvent();\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        super.dispose();\n        this.transport.clear(this._currentId);\n        this.transport.clear(this._nextId);\n        this.transport.off(\"start\", this._boundRestart);\n        this.transport.off(\"loopStart\", this._boundRestart);\n        this.transport.off(\"ticks\", this._boundRestart);\n        return this;\n    }\n}\n//# sourceMappingURL=TransportRepeatEvent.js.map","import { TimeClass } from \"../../core/type/Time.js\";\nimport { TimelineValue } from \"../../core/util/TimelineValue.js\";\nimport { Pow } from \"../../signal/Pow.js\";\nimport { onContextClose, onContextInit, } from \"../context/ContextInitialization.js\";\nimport { Gain } from \"../context/Gain.js\";\nimport { ToneWithContext, } from \"../context/ToneWithContext.js\";\nimport { TicksClass } from \"../type/Ticks.js\";\nimport { TransportTimeClass } from \"../type/TransportTime.js\";\nimport { enterScheduledCallback } from \"../util/Debug.js\";\nimport { optionsFromArguments } from \"../util/Defaults.js\";\nimport { Emitter } from \"../util/Emitter.js\";\nimport { readOnly, writable } from \"../util/Interface.js\";\nimport { IntervalTimeline } from \"../util/IntervalTimeline.js\";\nimport { Timeline } from \"../util/Timeline.js\";\nimport { isArray, isDefined } from \"../util/TypeCheck.js\";\nimport { Clock } from \"./Clock.js\";\nimport { TransportEvent } from \"./TransportEvent.js\";\nimport { TransportRepeatEvent } from \"./TransportRepeatEvent.js\";\n/**\n * Transport for timing musical events.\n * Supports tempo curves and time changes. Unlike browser-based timing (setInterval, requestAnimationFrame)\n * Transport timing events pass in the exact time of the scheduled event\n * in the argument of the callback function. Pass that time value to the object\n * you're scheduling. <br><br>\n * A single transport is created for you when the library is initialized.\n * <br><br>\n * The transport emits the events: \"start\", \"stop\", \"pause\", and \"loop\" which are\n * called with the time of that event as the argument.\n *\n * @example\n * const osc = new Tone.Oscillator().toDestination();\n * // repeated event every 8th note\n * Tone.getTransport().scheduleRepeat((time) => {\n * \t// use the callback time to schedule events\n * \tosc.start(time).stop(time + 0.1);\n * }, \"8n\");\n * // transport must be started before it starts invoking events\n * Tone.getTransport().start();\n * @category Core\n */\nexport class TransportClass extends ToneWithContext {\n    constructor() {\n        const options = optionsFromArguments(TransportClass.getDefaults(), arguments);\n        super(options);\n        this.name = \"Transport\";\n        //-------------------------------------\n        // \tLOOPING\n        //-------------------------------------\n        /**\n         * If the transport loops or not.\n         */\n        this._loop = new TimelineValue(false);\n        /**\n         * The loop start position in ticks\n         */\n        this._loopStart = 0;\n        /**\n         * The loop end position in ticks\n         */\n        this._loopEnd = 0;\n        //-------------------------------------\n        // \tTIMELINE EVENTS\n        //-------------------------------------\n        /**\n         * All the events in an object to keep track by ID\n         */\n        this._scheduledEvents = {};\n        /**\n         * The scheduled events.\n         */\n        this._timeline = new Timeline();\n        /**\n         * Repeated events\n         */\n        this._repeatedEvents = new IntervalTimeline();\n        /**\n         * All of the synced Signals\n         */\n        this._syncedSignals = [];\n        /**\n         * The swing amount\n         */\n        this._swingAmount = 0;\n        // CLOCK/TEMPO\n        this._ppq = options.ppq;\n        this._clock = new Clock({\n            callback: this._processTick.bind(this),\n            context: this.context,\n            frequency: 0,\n            units: \"bpm\",\n        });\n        this._bindClockEvents();\n        this.bpm = this._clock.frequency;\n        this._clock.frequency.multiplier = options.ppq;\n        this.bpm.setValueAtTime(options.bpm, 0);\n        readOnly(this, \"bpm\");\n        this._timeSignature = options.timeSignature;\n        // SWING\n        this._swingTicks = options.ppq / 2; // 8n\n    }\n    static getDefaults() {\n        return Object.assign(ToneWithContext.getDefaults(), {\n            bpm: 120,\n            loopEnd: \"4m\",\n            loopStart: 0,\n            ppq: 192,\n            swing: 0,\n            swingSubdivision: \"8n\",\n            timeSignature: 4,\n        });\n    }\n    //-------------------------------------\n    // \tTICKS\n    //-------------------------------------\n    /**\n     * called on every tick\n     * @param  tickTime clock relative tick time\n     */\n    _processTick(tickTime, ticks) {\n        // do the loop test\n        if (this._loop.get(tickTime)) {\n            if (ticks >= this._loopEnd) {\n                this.emit(\"loopEnd\", tickTime);\n                this._clock.setTicksAtTime(this._loopStart, tickTime);\n                ticks = this._loopStart;\n                this.emit(\"loopStart\", tickTime, this._clock.getSecondsAtTime(tickTime));\n                this.emit(\"loop\", tickTime);\n            }\n        }\n        // handle swing\n        if (this._swingAmount > 0 &&\n            ticks % this._ppq !== 0 && // not on a downbeat\n            ticks % (this._swingTicks * 2) !== 0) {\n            // add some swing\n            const progress = (ticks % (this._swingTicks * 2)) / (this._swingTicks * 2);\n            const amount = Math.sin(progress * Math.PI) * this._swingAmount;\n            tickTime +=\n                new TicksClass(this.context, (this._swingTicks * 2) / 3).toSeconds() * amount;\n        }\n        // invoke the timeline events scheduled on this tick\n        enterScheduledCallback(true);\n        this._timeline.forEachAtTime(ticks, (event) => event.invoke(tickTime));\n        enterScheduledCallback(false);\n    }\n    //-------------------------------------\n    // \tSCHEDULABLE EVENTS\n    //-------------------------------------\n    /**\n     * Schedule an event along the timeline.\n     * @param callback The callback to be invoked at the time.\n     * @param time The time to invoke the callback at.\n     * @return The id of the event which can be used for canceling the event.\n     * @example\n     * // schedule an event on the 16th measure\n     * Tone.getTransport().schedule((time) => {\n     * \t// invoked on measure 16\n     * \tconsole.log(\"measure 16!\");\n     * }, \"16:0:0\");\n     */\n    schedule(callback, time) {\n        const event = new TransportEvent(this, {\n            callback,\n            time: new TransportTimeClass(this.context, time).toTicks(),\n        });\n        return this._addEvent(event, this._timeline);\n    }\n    /**\n     * Schedule a repeated event along the timeline. The event will fire\n     * at the `interval` starting at the `startTime` and for the specified\n     * `duration`.\n     * @param  callback   The callback to invoke.\n     * @param  interval   The duration between successive callbacks. Must be a positive number.\n     * @param  startTime  When along the timeline the events should start being invoked.\n     * @param  duration How long the event should repeat.\n     * @return  The ID of the scheduled event. Use this to cancel the event.\n     * @example\n     * const osc = new Tone.Oscillator().toDestination().start();\n     * // a callback invoked every eighth note after the first measure\n     * Tone.getTransport().scheduleRepeat((time) => {\n     * \tosc.start(time).stop(time + 0.1);\n     * }, \"8n\", \"1m\");\n     */\n    scheduleRepeat(callback, interval, startTime, duration = Infinity) {\n        const event = new TransportRepeatEvent(this, {\n            callback,\n            duration: new TimeClass(this.context, duration).toTicks(),\n            interval: new TimeClass(this.context, interval).toTicks(),\n            time: new TransportTimeClass(this.context, startTime).toTicks(),\n        });\n        // kick it off if the Transport is started\n        // @ts-ignore\n        return this._addEvent(event, this._repeatedEvents);\n    }\n    /**\n     * Schedule an event that will be removed after it is invoked.\n     * @param callback The callback to invoke once.\n     * @param time The time the callback should be invoked.\n     * @returns The ID of the scheduled event.\n     */\n    scheduleOnce(callback, time) {\n        const event = new TransportEvent(this, {\n            callback,\n            once: true,\n            time: new TransportTimeClass(this.context, time).toTicks(),\n        });\n        return this._addEvent(event, this._timeline);\n    }\n    /**\n     * Clear the passed in event id from the timeline\n     * @param eventId The id of the event.\n     */\n    clear(eventId) {\n        if (this._scheduledEvents.hasOwnProperty(eventId)) {\n            const item = this._scheduledEvents[eventId.toString()];\n            item.timeline.remove(item.event);\n            item.event.dispose();\n            delete this._scheduledEvents[eventId.toString()];\n        }\n        return this;\n    }\n    /**\n     * Add an event to the correct timeline. Keep track of the\n     * timeline it was added to.\n     * @returns the event id which was just added\n     */\n    _addEvent(event, timeline) {\n        this._scheduledEvents[event.id.toString()] = {\n            event,\n            timeline,\n        };\n        timeline.add(event);\n        return event.id;\n    }\n    /**\n     * Remove scheduled events from the timeline after\n     * the given time. Repeated events will be removed\n     * if their startTime is after the given time\n     * @param after Clear all events after this time.\n     */\n    cancel(after = 0) {\n        const computedAfter = this.toTicks(after);\n        this._timeline.forEachFrom(computedAfter, (event) => this.clear(event.id));\n        this._repeatedEvents.forEachFrom(computedAfter, (event) => this.clear(event.id));\n        return this;\n    }\n    //-------------------------------------\n    // \tSTART/STOP/PAUSE\n    //-------------------------------------\n    /**\n     * Bind start/stop/pause events from the clock and emit them.\n     */\n    _bindClockEvents() {\n        this._clock.on(\"start\", (time, offset) => {\n            offset = new TicksClass(this.context, offset).toSeconds();\n            this.emit(\"start\", time, offset);\n        });\n        this._clock.on(\"stop\", (time) => {\n            this.emit(\"stop\", time);\n        });\n        this._clock.on(\"pause\", (time) => {\n            this.emit(\"pause\", time);\n        });\n    }\n    /**\n     * Returns the playback state of the source, either \"started\", \"stopped\", or \"paused\"\n     */\n    get state() {\n        return this._clock.getStateAtTime(this.now());\n    }\n    /**\n     * Start the transport and all sources synced to the transport.\n     * @param  time The time when the transport should start.\n     * @param  offset The timeline offset to start the transport.\n     * @example\n     * // start the transport in one second starting at beginning of the 5th measure.\n     * Tone.getTransport().start(\"+1\", \"4:0:0\");\n     */\n    start(time, offset) {\n        // start the context\n        this.context.resume();\n        let offsetTicks;\n        if (isDefined(offset)) {\n            offsetTicks = this.toTicks(offset);\n        }\n        // start the clock\n        this._clock.start(time, offsetTicks);\n        return this;\n    }\n    /**\n     * Stop the transport and all sources synced to the transport.\n     * @param time The time when the transport should stop.\n     * @example\n     * Tone.getTransport().stop();\n     */\n    stop(time) {\n        this._clock.stop(time);\n        return this;\n    }\n    /**\n     * Pause the transport and all sources synced to the transport.\n     */\n    pause(time) {\n        this._clock.pause(time);\n        return this;\n    }\n    /**\n     * Toggle the current state of the transport. If it is\n     * started, it will stop it, otherwise it will start the Transport.\n     * @param  time The time of the event\n     */\n    toggle(time) {\n        time = this.toSeconds(time);\n        if (this._clock.getStateAtTime(time) !== \"started\") {\n            this.start(time);\n        }\n        else {\n            this.stop(time);\n        }\n        return this;\n    }\n    //-------------------------------------\n    // \tSETTERS/GETTERS\n    //-------------------------------------\n    /**\n     * The time signature as just the numerator over 4.\n     * For example 4/4 would be just 4 and 6/8 would be 3.\n     * @example\n     * // common time\n     * Tone.getTransport().timeSignature = 4;\n     * // 7/8\n     * Tone.getTransport().timeSignature = [7, 8];\n     * // this will be reduced to a single number\n     * Tone.getTransport().timeSignature; // returns 3.5\n     */\n    get timeSignature() {\n        return this._timeSignature;\n    }\n    set timeSignature(timeSig) {\n        if (isArray(timeSig)) {\n            timeSig = (timeSig[0] / timeSig[1]) * 4;\n        }\n        this._timeSignature = timeSig;\n    }\n    /**\n     * When the Transport.loop = true, this is the starting position of the loop.\n     */\n    get loopStart() {\n        return new TimeClass(this.context, this._loopStart, \"i\").toSeconds();\n    }\n    set loopStart(startPosition) {\n        this._loopStart = this.toTicks(startPosition);\n    }\n    /**\n     * When the Transport.loop = true, this is the ending position of the loop.\n     */\n    get loopEnd() {\n        return new TimeClass(this.context, this._loopEnd, \"i\").toSeconds();\n    }\n    set loopEnd(endPosition) {\n        this._loopEnd = this.toTicks(endPosition);\n    }\n    /**\n     * If the transport loops or not.\n     */\n    get loop() {\n        return this._loop.get(this.now());\n    }\n    set loop(loop) {\n        this._loop.set(loop, this.now());\n    }\n    /**\n     * Set the loop start and stop at the same time.\n     * @example\n     * // loop over the first measure\n     * Tone.getTransport().setLoopPoints(0, \"1m\");\n     * Tone.getTransport().loop = true;\n     */\n    setLoopPoints(startPosition, endPosition) {\n        this.loopStart = startPosition;\n        this.loopEnd = endPosition;\n        return this;\n    }\n    /**\n     * The swing value. Between 0-1 where 1 equal to the note + half the subdivision.\n     */\n    get swing() {\n        return this._swingAmount;\n    }\n    set swing(amount) {\n        // scale the values to a normal range\n        this._swingAmount = amount;\n    }\n    /**\n     * Set the subdivision which the swing will be applied to.\n     * The default value is an 8th note. Value must be less\n     * than a quarter note.\n     */\n    get swingSubdivision() {\n        return new TicksClass(this.context, this._swingTicks).toNotation();\n    }\n    set swingSubdivision(subdivision) {\n        this._swingTicks = this.toTicks(subdivision);\n    }\n    /**\n     * The Transport's position in Bars:Beats:Sixteenths.\n     * Setting the value will jump to that position right away.\n     */\n    get position() {\n        const now = this.now();\n        const ticks = this._clock.getTicksAtTime(now);\n        return new TicksClass(this.context, ticks).toBarsBeatsSixteenths();\n    }\n    set position(progress) {\n        const ticks = this.toTicks(progress);\n        this.ticks = ticks;\n    }\n    /**\n     * The Transport's position in seconds.\n     * Setting the value will jump to that position right away.\n     */\n    get seconds() {\n        return this._clock.seconds;\n    }\n    set seconds(s) {\n        const now = this.now();\n        const ticks = this._clock.frequency.timeToTicks(s, now);\n        this.ticks = ticks;\n    }\n    /**\n     * The Transport's loop position as a normalized value. Always\n     * returns 0 if the Transport.loop = false.\n     */\n    get progress() {\n        if (this.loop) {\n            const now = this.now();\n            const ticks = this._clock.getTicksAtTime(now);\n            return ((ticks - this._loopStart) / (this._loopEnd - this._loopStart));\n        }\n        else {\n            return 0;\n        }\n    }\n    /**\n     * The Transport's current tick position.\n     */\n    get ticks() {\n        return this._clock.ticks;\n    }\n    set ticks(t) {\n        if (this._clock.ticks !== t) {\n            const now = this.now();\n            // stop everything synced to the transport\n            if (this.state === \"started\") {\n                const ticks = this._clock.getTicksAtTime(now);\n                // schedule to start on the next tick, #573\n                const remainingTick = this._clock.frequency.getDurationOfTicks(Math.ceil(ticks) - ticks, now);\n                const time = now + remainingTick;\n                this.emit(\"stop\", time);\n                this._clock.setTicksAtTime(t, time);\n                // restart it with the new time\n                this.emit(\"start\", time, this._clock.getSecondsAtTime(time));\n            }\n            else {\n                this.emit(\"ticks\", now);\n                this._clock.setTicksAtTime(t, now);\n            }\n        }\n    }\n    /**\n     * Get the clock's ticks at the given time.\n     * @param  time  When to get the tick value\n     * @return The tick value at the given time.\n     */\n    getTicksAtTime(time) {\n        return this._clock.getTicksAtTime(time);\n    }\n    /**\n     * Return the elapsed seconds at the given time.\n     * @param  time  When to get the elapsed seconds\n     * @return  The number of elapsed seconds\n     */\n    getSecondsAtTime(time) {\n        return this._clock.getSecondsAtTime(time);\n    }\n    /**\n     * Pulses Per Quarter note. This is the smallest resolution\n     * the Transport timing supports. This should be set once\n     * on initialization and not set again. Changing this value\n     * after other objects have been created can cause problems.\n     */\n    get PPQ() {\n        return this._clock.frequency.multiplier;\n    }\n    set PPQ(ppq) {\n        this._clock.frequency.multiplier = ppq;\n    }\n    //-------------------------------------\n    // \tSYNCING\n    //-------------------------------------\n    /**\n     * Returns the time aligned to the next subdivision\n     * of the Transport. If the Transport is not started,\n     * it will return 0.\n     * Note: this will not work precisely during tempo ramps.\n     * @param  subdivision  The subdivision to quantize to\n     * @return  The context time of the next subdivision.\n     * @example\n     * // the transport must be started, otherwise returns 0\n     * Tone.getTransport().start();\n     * Tone.getTransport().nextSubdivision(\"4n\");\n     */\n    nextSubdivision(subdivision) {\n        subdivision = this.toTicks(subdivision);\n        if (this.state !== \"started\") {\n            // if the transport's not started, return 0\n            return 0;\n        }\n        else {\n            const now = this.now();\n            // the remainder of the current ticks and the subdivision\n            const transportPos = this.getTicksAtTime(now);\n            const remainingTicks = subdivision - (transportPos % subdivision);\n            return this._clock.nextTickTime(remainingTicks, now);\n        }\n    }\n    /**\n     * Attaches the signal to the tempo control signal so that\n     * any changes in the tempo will change the signal in the same\n     * ratio.\n     *\n     * @param signal\n     * @param ratio Optionally pass in the ratio between the two signals.\n     * \t\t\tOtherwise it will be computed based on their current values.\n     */\n    syncSignal(signal, ratio) {\n        const now = this.now();\n        let source = this.bpm;\n        let sourceValue = 1 / (60 / source.getValueAtTime(now) / this.PPQ);\n        let nodes = [];\n        // If the signal is in the time domain, sync it to the reciprocal of\n        // the tempo instead of the tempo.\n        if (signal.units === \"time\") {\n            // The input to Pow should be in the range [1 / 4096, 1], where\n            // where 4096 is half of the buffer size of Pow's waveshaper.\n            // Pick a scaling factor based on the initial tempo that ensures\n            // that the initial input is in this range, while leaving room for\n            // tempo changes.\n            const scaleFactor = 1 / 64 / sourceValue;\n            const scaleBefore = new Gain(scaleFactor);\n            const reciprocal = new Pow(-1);\n            const scaleAfter = new Gain(scaleFactor);\n            // @ts-ignore\n            source.chain(scaleBefore, reciprocal, scaleAfter);\n            source = scaleAfter;\n            sourceValue = 1 / sourceValue;\n            nodes = [scaleBefore, reciprocal, scaleAfter];\n        }\n        if (!ratio) {\n            // get the sync ratio\n            if (signal.getValueAtTime(now) !== 0) {\n                ratio = signal.getValueAtTime(now) / sourceValue;\n            }\n            else {\n                ratio = 0;\n            }\n        }\n        const ratioSignal = new Gain(ratio);\n        // @ts-ignore\n        source.connect(ratioSignal);\n        // @ts-ignore\n        ratioSignal.connect(signal._param);\n        nodes.push(ratioSignal);\n        this._syncedSignals.push({\n            initial: signal.value,\n            nodes: nodes,\n            signal,\n        });\n        signal.value = 0;\n        return this;\n    }\n    /**\n     * Unsyncs a previously synced signal from the transport's control.\n     * @see {@link syncSignal}.\n     */\n    unsyncSignal(signal) {\n        for (let i = this._syncedSignals.length - 1; i >= 0; i--) {\n            const syncedSignal = this._syncedSignals[i];\n            if (syncedSignal.signal === signal) {\n                syncedSignal.nodes.forEach((node) => node.dispose());\n                syncedSignal.signal.value = syncedSignal.initial;\n                this._syncedSignals.splice(i, 1);\n            }\n        }\n        return this;\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this._clock.dispose();\n        writable(this, \"bpm\");\n        this._timeline.dispose();\n        this._repeatedEvents.dispose();\n        return this;\n    }\n}\nEmitter.mixin(TransportClass);\n//-------------------------------------\n// \tINITIALIZATION\n//-------------------------------------\nonContextInit((context) => {\n    context.transport = new TransportClass({ context });\n});\nonContextClose((context) => {\n    context.transport.dispose();\n});\n//# sourceMappingURL=Transport.js.map","import { Volume } from \"../component/channel/Volume.js\";\nimport \"../core/context/Destination.js\";\nimport \"../core/clock/Transport.js\";\nimport { ToneAudioNode, } from \"../core/context/ToneAudioNode.js\";\nimport { defaultArg } from \"../core/util/Defaults.js\";\nimport { noOp, readOnly } from \"../core/util/Interface.js\";\nimport { StateTimeline, } from \"../core/util/StateTimeline.js\";\nimport { isDefined, isUndef } from \"../core/util/TypeCheck.js\";\nimport { assert, assertContextRunning } from \"../core/util/Debug.js\";\nimport { GT } from \"../core/util/Math.js\";\n/**\n * Base class for sources.\n * start/stop of this.context.transport.\n *\n * ```\n * // Multiple state change events can be chained together,\n * // but must be set in the correct order and with ascending times\n * // OK\n * state.start().stop(\"+0.2\");\n * // OK\n * state.start().stop(\"+0.2\").start(\"+0.4\").stop(\"+0.7\")\n * // BAD\n * state.stop(\"+0.2\").start();\n * // BAD\n * state.start(\"+0.3\").stop(\"+0.2\");\n * ```\n */\nexport class Source extends ToneAudioNode {\n    constructor(options) {\n        super(options);\n        /**\n         * Sources have no inputs\n         */\n        this.input = undefined;\n        /**\n         * Keep track of the scheduled state.\n         */\n        this._state = new StateTimeline(\"stopped\");\n        /**\n         * The synced `start` callback function from the transport\n         */\n        this._synced = false;\n        /**\n         * Keep track of all of the scheduled event ids\n         */\n        this._scheduled = [];\n        /**\n         * Placeholder functions for syncing/unsyncing to transport\n         */\n        this._syncedStart = noOp;\n        this._syncedStop = noOp;\n        this._state.memory = 100;\n        this._state.increasing = true;\n        this._volume = this.output = new Volume({\n            context: this.context,\n            mute: options.mute,\n            volume: options.volume,\n        });\n        this.volume = this._volume.volume;\n        readOnly(this, \"volume\");\n        this.onstop = options.onstop;\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            mute: false,\n            onstop: noOp,\n            volume: 0,\n        });\n    }\n    /**\n     * Returns the playback state of the source, either \"started\" or \"stopped\".\n     * @example\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/berklee/ahntone_c3.mp3\", () => {\n     * \tplayer.start();\n     * \tconsole.log(player.state);\n     * }).toDestination();\n     */\n    get state() {\n        if (this._synced) {\n            if (this.context.transport.state === \"started\") {\n                return this._state.getValueAtTime(this.context.transport.seconds);\n            }\n            else {\n                return \"stopped\";\n            }\n        }\n        else {\n            return this._state.getValueAtTime(this.now());\n        }\n    }\n    /**\n     * Mute the output.\n     * @example\n     * const osc = new Tone.Oscillator().toDestination().start();\n     * // mute the output\n     * osc.mute = true;\n     */\n    get mute() {\n        return this._volume.mute;\n    }\n    set mute(mute) {\n        this._volume.mute = mute;\n    }\n    /**\n     * Ensure that the scheduled time is not before the current time.\n     * Should only be used when scheduled unsynced.\n     */\n    _clampToCurrentTime(time) {\n        if (this._synced) {\n            return time;\n        }\n        else {\n            return Math.max(time, this.context.currentTime);\n        }\n    }\n    /**\n     * Start the source at the specified time. If no time is given,\n     * start the source now.\n     * @param  time When the source should be started.\n     * @example\n     * const source = new Tone.Oscillator().toDestination();\n     * source.start(\"+0.5\"); // starts the source 0.5 seconds from now\n     */\n    start(time, offset, duration) {\n        let computedTime = isUndef(time) && this._synced\n            ? this.context.transport.seconds\n            : this.toSeconds(time);\n        computedTime = this._clampToCurrentTime(computedTime);\n        // if it's started, stop it and restart it\n        if (!this._synced &&\n            this._state.getValueAtTime(computedTime) === \"started\") {\n            // time should be strictly greater than the previous start time\n            assert(GT(computedTime, this._state.get(computedTime).time), \"Start time must be strictly greater than previous start time\");\n            this._state.cancel(computedTime);\n            this._state.setStateAtTime(\"started\", computedTime);\n            this.log(\"restart\", computedTime);\n            this.restart(computedTime, offset, duration);\n        }\n        else {\n            this.log(\"start\", computedTime);\n            this._state.setStateAtTime(\"started\", computedTime);\n            if (this._synced) {\n                // add the offset time to the event\n                const event = this._state.get(computedTime);\n                if (event) {\n                    event.offset = this.toSeconds(defaultArg(offset, 0));\n                    event.duration = duration\n                        ? this.toSeconds(duration)\n                        : undefined;\n                }\n                const sched = this.context.transport.schedule((t) => {\n                    this._start(t, offset, duration);\n                }, computedTime);\n                this._scheduled.push(sched);\n                // if the transport is already started\n                // and the time is greater than where the transport is\n                if (this.context.transport.state === \"started\" &&\n                    this.context.transport.getSecondsAtTime(this.immediate()) >\n                        computedTime) {\n                    this._syncedStart(this.now(), this.context.transport.seconds);\n                }\n            }\n            else {\n                assertContextRunning(this.context);\n                this._start(computedTime, offset, duration);\n            }\n        }\n        return this;\n    }\n    /**\n     * Stop the source at the specified time. If no time is given,\n     * stop the source now.\n     * @param  time When the source should be stopped.\n     * @example\n     * const source = new Tone.Oscillator().toDestination();\n     * source.start();\n     * source.stop(\"+0.5\"); // stops the source 0.5 seconds from now\n     */\n    stop(time) {\n        let computedTime = isUndef(time) && this._synced\n            ? this.context.transport.seconds\n            : this.toSeconds(time);\n        computedTime = this._clampToCurrentTime(computedTime);\n        if (this._state.getValueAtTime(computedTime) === \"started\" ||\n            isDefined(this._state.getNextState(\"started\", computedTime))) {\n            this.log(\"stop\", computedTime);\n            if (!this._synced) {\n                this._stop(computedTime);\n            }\n            else {\n                const sched = this.context.transport.schedule(this._stop.bind(this), computedTime);\n                this._scheduled.push(sched);\n            }\n            this._state.cancel(computedTime);\n            this._state.setStateAtTime(\"stopped\", computedTime);\n        }\n        return this;\n    }\n    /**\n     * Restart the source.\n     */\n    restart(time, offset, duration) {\n        time = this.toSeconds(time);\n        if (this._state.getValueAtTime(time) === \"started\") {\n            this._state.cancel(time);\n            this._restart(time, offset, duration);\n        }\n        return this;\n    }\n    /**\n     * Sync the source to the Transport so that all subsequent\n     * calls to `start` and `stop` are synced to the TransportTime\n     * instead of the AudioContext time.\n     *\n     * @example\n     * const osc = new Tone.Oscillator().toDestination();\n     * // sync the source so that it plays between 0 and 0.3 on the Transport's timeline\n     * osc.sync().start(0).stop(0.3);\n     * // start the transport.\n     * Tone.Transport.start();\n     * // set it to loop once a second\n     * Tone.Transport.loop = true;\n     * Tone.Transport.loopEnd = 1;\n     */\n    sync() {\n        if (!this._synced) {\n            this._synced = true;\n            this._syncedStart = (time, offset) => {\n                if (GT(offset, 0)) {\n                    // get the playback state at that time\n                    const stateEvent = this._state.get(offset);\n                    // listen for start events which may occur in the middle of the sync'ed time\n                    if (stateEvent &&\n                        stateEvent.state === \"started\" &&\n                        stateEvent.time !== offset) {\n                        // get the offset\n                        const startOffset = offset - this.toSeconds(stateEvent.time);\n                        let duration;\n                        if (stateEvent.duration) {\n                            duration =\n                                this.toSeconds(stateEvent.duration) -\n                                    startOffset;\n                        }\n                        this._start(time, this.toSeconds(stateEvent.offset) + startOffset, duration);\n                    }\n                }\n            };\n            this._syncedStop = (time) => {\n                const seconds = this.context.transport.getSecondsAtTime(Math.max(time - this.sampleTime, 0));\n                if (this._state.getValueAtTime(seconds) === \"started\") {\n                    this._stop(time);\n                }\n            };\n            this.context.transport.on(\"start\", this._syncedStart);\n            this.context.transport.on(\"loopStart\", this._syncedStart);\n            this.context.transport.on(\"stop\", this._syncedStop);\n            this.context.transport.on(\"pause\", this._syncedStop);\n            this.context.transport.on(\"loopEnd\", this._syncedStop);\n        }\n        return this;\n    }\n    /**\n     * Unsync the source to the Transport.\n     * @see {@link sync}\n     */\n    unsync() {\n        if (this._synced) {\n            this.context.transport.off(\"stop\", this._syncedStop);\n            this.context.transport.off(\"pause\", this._syncedStop);\n            this.context.transport.off(\"loopEnd\", this._syncedStop);\n            this.context.transport.off(\"start\", this._syncedStart);\n            this.context.transport.off(\"loopStart\", this._syncedStart);\n        }\n        this._synced = false;\n        // clear all of the scheduled ids\n        this._scheduled.forEach((id) => this.context.transport.clear(id));\n        this._scheduled = [];\n        this._state.cancel(0);\n        // stop it also\n        this._stop(0);\n        return this;\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this.onstop = noOp;\n        this.unsync();\n        this._volume.dispose();\n        this._state.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=Source.js.map","import { connect } from \"../../core/context/ToneAudioNode.js\";\nimport { Param } from \"../../core/context/Param.js\";\nimport { ToneAudioBuffer } from \"../../core/context/ToneAudioBuffer.js\";\nimport { defaultArg, optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { noOp } from \"../../core/util/Interface.js\";\nimport { isDefined } from \"../../core/util/TypeCheck.js\";\nimport { assert } from \"../../core/util/Debug.js\";\nimport { OneShotSource, } from \"../OneShotSource.js\";\nimport { EQ, GTE, LT } from \"../../core/util/Math.js\";\n/**\n * Wrapper around the native BufferSourceNode.\n * @category Source\n */\nexport class ToneBufferSource extends OneShotSource {\n    constructor() {\n        const options = optionsFromArguments(ToneBufferSource.getDefaults(), arguments, [\"url\", \"onload\"]);\n        super(options);\n        this.name = \"ToneBufferSource\";\n        /**\n         * The oscillator\n         */\n        this._source = this.context.createBufferSource();\n        this._internalChannels = [this._source];\n        /**\n         * indicators if the source has started/stopped\n         */\n        this._sourceStarted = false;\n        this._sourceStopped = false;\n        connect(this._source, this._gainNode);\n        this._source.onended = () => this._stopSource();\n        /**\n         * The playbackRate of the buffer\n         */\n        this.playbackRate = new Param({\n            context: this.context,\n            param: this._source.playbackRate,\n            units: \"positive\",\n            value: options.playbackRate,\n        });\n        // set some values initially\n        this.loop = options.loop;\n        this.loopStart = options.loopStart;\n        this.loopEnd = options.loopEnd;\n        this._buffer = new ToneAudioBuffer(options.url, options.onload, options.onerror);\n        this._internalChannels.push(this._source);\n    }\n    static getDefaults() {\n        return Object.assign(OneShotSource.getDefaults(), {\n            url: new ToneAudioBuffer(),\n            loop: false,\n            loopEnd: 0,\n            loopStart: 0,\n            onload: noOp,\n            onerror: noOp,\n            playbackRate: 1,\n        });\n    }\n    /**\n     * The fadeIn time of the amplitude envelope.\n     */\n    get fadeIn() {\n        return this._fadeIn;\n    }\n    set fadeIn(t) {\n        this._fadeIn = t;\n    }\n    /**\n     * The fadeOut time of the amplitude envelope.\n     */\n    get fadeOut() {\n        return this._fadeOut;\n    }\n    set fadeOut(t) {\n        this._fadeOut = t;\n    }\n    /**\n     * The curve applied to the fades, either \"linear\" or \"exponential\"\n     */\n    get curve() {\n        return this._curve;\n    }\n    set curve(t) {\n        this._curve = t;\n    }\n    /**\n     * Start the buffer\n     * @param  time When the player should start.\n     * @param  offset The offset from the beginning of the sample to start at.\n     * @param  duration How long the sample should play. If no duration is given, it will default to the full length of the sample (minus any offset)\n     * @param  gain  The gain to play the buffer back at.\n     */\n    start(time, offset, duration, gain = 1) {\n        assert(this.buffer.loaded, \"buffer is either not set or not loaded\");\n        const computedTime = this.toSeconds(time);\n        // apply the gain envelope\n        this._startGain(computedTime, gain);\n        // if it's a loop the default offset is the loopstart point\n        if (this.loop) {\n            offset = defaultArg(offset, this.loopStart);\n        }\n        else {\n            // otherwise the default offset is 0\n            offset = defaultArg(offset, 0);\n        }\n        // make sure the offset is not less than 0\n        let computedOffset = Math.max(this.toSeconds(offset), 0);\n        // start the buffer source\n        if (this.loop) {\n            // modify the offset if it's greater than the loop time\n            const loopEnd = this.toSeconds(this.loopEnd) || this.buffer.duration;\n            const loopStart = this.toSeconds(this.loopStart);\n            const loopDuration = loopEnd - loopStart;\n            // move the offset back\n            if (GTE(computedOffset, loopEnd)) {\n                computedOffset =\n                    ((computedOffset - loopStart) % loopDuration) + loopStart;\n            }\n            // when the offset is very close to the duration, set it to 0\n            if (EQ(computedOffset, this.buffer.duration)) {\n                computedOffset = 0;\n            }\n        }\n        // this.buffer.loaded would have return false if the AudioBuffer was undefined\n        this._source.buffer = this.buffer.get();\n        this._source.loopEnd =\n            this.toSeconds(this.loopEnd) || this.buffer.duration;\n        if (LT(computedOffset, this.buffer.duration)) {\n            this._sourceStarted = true;\n            this._source.start(computedTime, computedOffset);\n        }\n        // if a duration is given, schedule a stop\n        if (isDefined(duration)) {\n            let computedDur = this.toSeconds(duration);\n            // make sure it's never negative\n            computedDur = Math.max(computedDur, 0);\n            this.stop(computedTime + computedDur);\n        }\n        return this;\n    }\n    _stopSource(time) {\n        if (!this._sourceStopped && this._sourceStarted) {\n            this._sourceStopped = true;\n            this._source.stop(this.toSeconds(time));\n            this._onended();\n        }\n    }\n    /**\n     * If loop is true, the loop will start at this position.\n     */\n    get loopStart() {\n        return this._source.loopStart;\n    }\n    set loopStart(loopStart) {\n        this._source.loopStart = this.toSeconds(loopStart);\n    }\n    /**\n     * If loop is true, the loop will end at this position.\n     */\n    get loopEnd() {\n        return this._source.loopEnd;\n    }\n    set loopEnd(loopEnd) {\n        this._source.loopEnd = this.toSeconds(loopEnd);\n    }\n    /**\n     * The audio buffer belonging to the player.\n     */\n    get buffer() {\n        return this._buffer;\n    }\n    set buffer(buffer) {\n        this._buffer.set(buffer);\n    }\n    /**\n     * If the buffer should loop once it's over.\n     */\n    get loop() {\n        return this._source.loop;\n    }\n    set loop(loop) {\n        this._source.loop = loop;\n        if (this._sourceStarted) {\n            this.cancelStop();\n        }\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this._source.onended = null;\n        this._source.disconnect();\n        this._buffer.dispose();\n        this.playbackRate.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=ToneBufferSource.js.map","import { __awaiter } from \"tslib\";\nimport { connect, ToneAudioNode, } from \"../core/context/ToneAudioNode.js\";\nimport { Volume } from \"../component/channel/Volume.js\";\nimport { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { assert } from \"../core/util/Debug.js\";\nimport { readOnly } from \"../core/util/Interface.js\";\nimport { isDefined, isNumber } from \"../core/util/TypeCheck.js\";\n/**\n * UserMedia uses MediaDevices.getUserMedia to open up and external microphone or audio input.\n * Check [MediaDevices API Support](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)\n * to see which browsers are supported. Access to an external input\n * is limited to secure (HTTPS) connections.\n * @example\n * const meter = new Tone.Meter();\n * const mic = new Tone.UserMedia().connect(meter);\n * mic.open().then(() => {\n * \t// promise resolves when input is available\n * \tconsole.log(\"mic open\");\n * \t// print the incoming mic levels in decibels\n * \tsetInterval(() => console.log(meter.getValue()), 100);\n * }).catch(e => {\n * \t// promise is rejected when the user doesn't have or allow mic access\n * \tconsole.log(\"mic not open\");\n * });\n * @category Source\n */\nexport class UserMedia extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(UserMedia.getDefaults(), arguments, [\"volume\"]);\n        super(options);\n        this.name = \"UserMedia\";\n        this._volume = this.output = new Volume({\n            context: this.context,\n            volume: options.volume,\n        });\n        this.volume = this._volume.volume;\n        readOnly(this, \"volume\");\n        this.mute = options.mute;\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            mute: false,\n            volume: 0,\n        });\n    }\n    /**\n     * Open the media stream. If a string is passed in, it is assumed\n     * to be the label or id of the stream, if a number is passed in,\n     * it is the input number of the stream.\n     * @param  labelOrId The label or id of the audio input media device.\n     *                   With no argument, the default stream is opened.\n     * @return The promise is resolved when the stream is open.\n     */\n    open(labelOrId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            assert(UserMedia.supported, \"UserMedia is not supported\");\n            // close the previous stream\n            if (this.state === \"started\") {\n                this.close();\n            }\n            const devices = yield UserMedia.enumerateDevices();\n            if (isNumber(labelOrId)) {\n                this._device = devices[labelOrId];\n            }\n            else {\n                this._device = devices.find((device) => {\n                    return (device.label === labelOrId || device.deviceId === labelOrId);\n                });\n                // didn't find a matching device\n                if (!this._device && devices.length > 0) {\n                    this._device = devices[0];\n                }\n                assert(isDefined(this._device), `No matching device ${labelOrId}`);\n            }\n            // do getUserMedia\n            const constraints = {\n                audio: {\n                    echoCancellation: false,\n                    sampleRate: this.context.sampleRate,\n                    noiseSuppression: false,\n                    mozNoiseSuppression: false,\n                },\n            };\n            if (this._device) {\n                // @ts-ignore\n                constraints.audio.deviceId = this._device.deviceId;\n            }\n            const stream = yield navigator.mediaDevices.getUserMedia(constraints);\n            // start a new source only if the previous one is closed\n            if (!this._stream) {\n                this._stream = stream;\n                // Wrap a MediaStreamSourceNode around the live input stream.\n                const mediaStreamNode = this.context.createMediaStreamSource(stream);\n                // Connect the MediaStreamSourceNode to a gate gain node\n                connect(mediaStreamNode, this.output);\n                this._mediaStream = mediaStreamNode;\n            }\n            return this;\n        });\n    }\n    /**\n     * Close the media stream\n     */\n    close() {\n        if (this._stream && this._mediaStream) {\n            this._stream.getAudioTracks().forEach((track) => {\n                track.stop();\n            });\n            this._stream = undefined;\n            // remove the old media stream\n            this._mediaStream.disconnect();\n            this._mediaStream = undefined;\n        }\n        this._device = undefined;\n        return this;\n    }\n    /**\n     * Returns a promise which resolves with the list of audio input devices available.\n     * @return The promise that is resolved with the devices\n     * @example\n     * Tone.UserMedia.enumerateDevices().then((devices) => {\n     * \t// print the device labels\n     * \tconsole.log(devices.map(device => device.label));\n     * });\n     */\n    static enumerateDevices() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const allDevices = yield navigator.mediaDevices.enumerateDevices();\n            return allDevices.filter((device) => {\n                return device.kind === \"audioinput\";\n            });\n        });\n    }\n    /**\n     * Returns the playback state of the source, \"started\" when the microphone is open\n     * and \"stopped\" when the mic is closed.\n     */\n    get state() {\n        return this._stream && this._stream.active ? \"started\" : \"stopped\";\n    }\n    /**\n     * Returns an identifier for the represented device that is\n     * persisted across sessions. It is un-guessable by other applications and\n     * unique to the origin of the calling application. It is reset when the\n     * user clears cookies (for Private Browsing, a different identifier is\n     * used that is not persisted across sessions). Returns undefined when the\n     * device is not open.\n     */\n    get deviceId() {\n        if (this._device) {\n            return this._device.deviceId;\n        }\n        else {\n            return undefined;\n        }\n    }\n    /**\n     * Returns a group identifier. Two devices have the\n     * same group identifier if they belong to the same physical device.\n     * Returns null  when the device is not open.\n     */\n    get groupId() {\n        if (this._device) {\n            return this._device.groupId;\n        }\n        else {\n            return undefined;\n        }\n    }\n    /**\n     * Returns a label describing this device (for example \"Built-in Microphone\").\n     * Returns undefined when the device is not open or label is not available\n     * because of permissions.\n     */\n    get label() {\n        if (this._device) {\n            return this._device.label;\n        }\n        else {\n            return undefined;\n        }\n    }\n    /**\n     * Mute the output.\n     * @example\n     * const mic = new Tone.UserMedia();\n     * mic.open().then(() => {\n     * \t// promise resolves when input is available\n     * });\n     * // mute the output\n     * mic.mute = true;\n     */\n    get mute() {\n        return this._volume.mute;\n    }\n    set mute(mute) {\n        this._volume.mute = mute;\n    }\n    dispose() {\n        super.dispose();\n        this.close();\n        this._volume.dispose();\n        this.volume.dispose();\n        return this;\n    }\n    /**\n     * If getUserMedia is supported by the browser.\n     */\n    static get supported() {\n        return (isDefined(navigator.mediaDevices) &&\n            isDefined(navigator.mediaDevices.getUserMedia));\n    }\n}\n//# sourceMappingURL=UserMedia.js.map","import { __awaiter } from \"tslib\";\nimport { OfflineContext } from \"../../core/context/OfflineContext.js\";\n/**\n * Render a segment of the oscillator to an offline context and return the results as an array\n */\nexport function generateWaveform(instance, length) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const duration = length / instance.context.sampleRate;\n        const context = new OfflineContext(1, duration, instance.context.sampleRate);\n        const clone = new instance.constructor(Object.assign(instance.get(), {\n            // should do 2 iterations\n            frequency: 2 / duration,\n            // zero out the detune\n            detune: 0,\n            context,\n        })).toDestination();\n        clone.start(0);\n        const buffer = yield context.render();\n        return buffer.getChannelData(0);\n    });\n}\n//# sourceMappingURL=OscillatorInterface.js.map","import { connect } from \"../../core/context/ToneAudioNode.js\";\nimport { Param } from \"../../core/context/Param.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { OneShotSource } from \"../OneShotSource.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\n/**\n * Wrapper around the native fire-and-forget OscillatorNode.\n * Adds the ability to reschedule the stop method.\n * ***{@link Oscillator} is better for most use-cases***\n * @category Source\n */\nexport class ToneOscillatorNode extends OneShotSource {\n    constructor() {\n        const options = optionsFromArguments(ToneOscillatorNode.getDefaults(), arguments, [\"frequency\", \"type\"]);\n        super(options);\n        this.name = \"ToneOscillatorNode\";\n        /**\n         * The oscillator\n         */\n        this._oscillator = this.context.createOscillator();\n        this._internalChannels = [this._oscillator];\n        connect(this._oscillator, this._gainNode);\n        this.type = options.type;\n        this.frequency = new Param({\n            context: this.context,\n            param: this._oscillator.frequency,\n            units: \"frequency\",\n            value: options.frequency,\n        });\n        this.detune = new Param({\n            context: this.context,\n            param: this._oscillator.detune,\n            units: \"cents\",\n            value: options.detune,\n        });\n        readOnly(this, [\"frequency\", \"detune\"]);\n    }\n    static getDefaults() {\n        return Object.assign(OneShotSource.getDefaults(), {\n            detune: 0,\n            frequency: 440,\n            type: \"sine\",\n        });\n    }\n    /**\n     * Start the oscillator node at the given time\n     * @param  time When to start the oscillator\n     */\n    start(time) {\n        const computedTime = this.toSeconds(time);\n        this.log(\"start\", computedTime);\n        this._startGain(computedTime);\n        this._oscillator.start(computedTime);\n        return this;\n    }\n    _stopSource(time) {\n        this._oscillator.stop(time);\n    }\n    /**\n     * Sets an arbitrary custom periodic waveform given a PeriodicWave.\n     * @param  periodicWave PeriodicWave should be created with context.createPeriodicWave\n     */\n    setPeriodicWave(periodicWave) {\n        this._oscillator.setPeriodicWave(periodicWave);\n        return this;\n    }\n    /**\n     * The oscillator type. Either 'sine', 'sawtooth', 'square', or 'triangle'\n     */\n    get type() {\n        return this._oscillator.type;\n    }\n    set type(type) {\n        this._oscillator.type = type;\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        if (this.state === \"started\") {\n            this.stop();\n        }\n        this._oscillator.disconnect();\n        this.frequency.dispose();\n        this.detune.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=ToneOscillatorNode.js.map","import { __awaiter } from \"tslib\";\nimport { deepEquals, optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\nimport { isDefined } from \"../../core/util/TypeCheck.js\";\nimport { Signal } from \"../../signal/Signal.js\";\nimport { Source } from \"../Source.js\";\nimport { generateWaveform, } from \"./OscillatorInterface.js\";\nimport { ToneOscillatorNode } from \"./ToneOscillatorNode.js\";\nimport { assertRange } from \"../../core/util/Debug.js\";\nimport { clamp } from \"../../core/util/Math.js\";\n/**\n * Oscillator supports a number of features including\n * phase rotation, multiple oscillator types (see Oscillator.type),\n * and Transport syncing (see Oscillator.syncFrequency).\n *\n * @example\n * // make and start a 440hz sine tone\n * const osc = new Tone.Oscillator(440, \"sine\").toDestination().start();\n * @category Source\n */\nexport class Oscillator extends Source {\n    constructor() {\n        const options = optionsFromArguments(Oscillator.getDefaults(), arguments, [\"frequency\", \"type\"]);\n        super(options);\n        this.name = \"Oscillator\";\n        /**\n         * the main oscillator\n         */\n        this._oscillator = null;\n        this.frequency = new Signal({\n            context: this.context,\n            units: \"frequency\",\n            value: options.frequency,\n        });\n        readOnly(this, \"frequency\");\n        this.detune = new Signal({\n            context: this.context,\n            units: \"cents\",\n            value: options.detune,\n        });\n        readOnly(this, \"detune\");\n        this._partials = options.partials;\n        this._partialCount = options.partialCount;\n        this._type = options.type;\n        if (options.partialCount && options.type !== \"custom\") {\n            this._type = (this.baseType +\n                options.partialCount.toString());\n        }\n        this.phase = options.phase;\n    }\n    static getDefaults() {\n        return Object.assign(Source.getDefaults(), {\n            detune: 0,\n            frequency: 440,\n            partialCount: 0,\n            partials: [],\n            phase: 0,\n            type: \"sine\",\n        });\n    }\n    /**\n     * start the oscillator\n     */\n    _start(time) {\n        const computedTime = this.toSeconds(time);\n        // new oscillator with previous values\n        const oscillator = new ToneOscillatorNode({\n            context: this.context,\n            onended: () => this.onstop(this),\n        });\n        this._oscillator = oscillator;\n        if (this._wave) {\n            this._oscillator.setPeriodicWave(this._wave);\n        }\n        else {\n            this._oscillator.type = this._type;\n        }\n        // connect the control signal to the oscillator frequency & detune\n        this._oscillator.connect(this.output);\n        this.frequency.connect(this._oscillator.frequency);\n        this.detune.connect(this._oscillator.detune);\n        // start the oscillator\n        this._oscillator.start(computedTime);\n    }\n    /**\n     * stop the oscillator\n     */\n    _stop(time) {\n        const computedTime = this.toSeconds(time);\n        if (this._oscillator) {\n            this._oscillator.stop(computedTime);\n        }\n    }\n    /**\n     * Restart the oscillator. Does not stop the oscillator, but instead\n     * just cancels any scheduled 'stop' from being invoked.\n     */\n    _restart(time) {\n        const computedTime = this.toSeconds(time);\n        this.log(\"restart\", computedTime);\n        if (this._oscillator) {\n            this._oscillator.cancelStop();\n        }\n        this._state.cancel(computedTime);\n        return this;\n    }\n    /**\n     * Sync the signal to the Transport's bpm. Any changes to the transports bpm,\n     * will also affect the oscillators frequency.\n     * @example\n     * const osc = new Tone.Oscillator().toDestination().start();\n     * osc.frequency.value = 440;\n     * // the ratio between the bpm and the frequency will be maintained\n     * osc.syncFrequency();\n     * // double the tempo\n     * Tone.Transport.bpm.value *= 2;\n     * // the frequency of the oscillator is doubled to 880\n     */\n    syncFrequency() {\n        this.context.transport.syncSignal(this.frequency);\n        return this;\n    }\n    /**\n     * Unsync the oscillator's frequency from the Transport.\n     * @see {@link syncFrequency}\n     */\n    unsyncFrequency() {\n        this.context.transport.unsyncSignal(this.frequency);\n        return this;\n    }\n    /**\n     * Get a cached periodic wave. Avoids having to recompute\n     * the oscillator values when they have already been computed\n     * with the same values.\n     */\n    _getCachedPeriodicWave() {\n        if (this._type === \"custom\") {\n            const oscProps = Oscillator._periodicWaveCache.find((description) => {\n                return (description.phase === this._phase &&\n                    deepEquals(description.partials, this._partials));\n            });\n            return oscProps;\n        }\n        else {\n            const oscProps = Oscillator._periodicWaveCache.find((description) => {\n                return (description.type === this._type &&\n                    description.phase === this._phase);\n            });\n            this._partialCount = oscProps\n                ? oscProps.partialCount\n                : this._partialCount;\n            return oscProps;\n        }\n    }\n    get type() {\n        return this._type;\n    }\n    set type(type) {\n        this._type = type;\n        const isBasicType = [\"sine\", \"square\", \"sawtooth\", \"triangle\"].indexOf(type) !== -1;\n        if (this._phase === 0 && isBasicType) {\n            this._wave = undefined;\n            this._partialCount = 0;\n            // just go with the basic approach\n            if (this._oscillator !== null) {\n                // already tested that it's a basic type\n                this._oscillator.type = type;\n            }\n        }\n        else {\n            // first check if the value is cached\n            const cache = this._getCachedPeriodicWave();\n            if (isDefined(cache)) {\n                const { partials, wave } = cache;\n                this._wave = wave;\n                this._partials = partials;\n                if (this._oscillator !== null) {\n                    this._oscillator.setPeriodicWave(this._wave);\n                }\n            }\n            else {\n                const [real, imag] = this._getRealImaginary(type, this._phase);\n                const periodicWave = this.context.createPeriodicWave(real, imag);\n                this._wave = periodicWave;\n                if (this._oscillator !== null) {\n                    this._oscillator.setPeriodicWave(this._wave);\n                }\n                // set the cache\n                Oscillator._periodicWaveCache.push({\n                    imag,\n                    partialCount: this._partialCount,\n                    partials: this._partials,\n                    phase: this._phase,\n                    real,\n                    type: this._type,\n                    wave: this._wave,\n                });\n                if (Oscillator._periodicWaveCache.length > 100) {\n                    Oscillator._periodicWaveCache.shift();\n                }\n            }\n        }\n    }\n    get baseType() {\n        return this._type.replace(this.partialCount.toString(), \"\");\n    }\n    set baseType(baseType) {\n        if (this.partialCount &&\n            this._type !== \"custom\" &&\n            baseType !== \"custom\") {\n            this.type = (baseType + this.partialCount);\n        }\n        else {\n            this.type = baseType;\n        }\n    }\n    get partialCount() {\n        return this._partialCount;\n    }\n    set partialCount(p) {\n        assertRange(p, 0);\n        let type = this._type;\n        const partial = /^(sine|triangle|square|sawtooth)(\\d+)$/.exec(this._type);\n        if (partial) {\n            type = partial[1];\n        }\n        if (this._type !== \"custom\") {\n            if (p === 0) {\n                this.type = type;\n            }\n            else {\n                this.type = (type + p.toString());\n            }\n        }\n        else {\n            // extend or shorten the partials array\n            const fullPartials = new Float32Array(p);\n            // copy over the partials array\n            this._partials.forEach((v, i) => (fullPartials[i] = v));\n            this._partials = Array.from(fullPartials);\n            this.type = this._type;\n        }\n    }\n    /**\n     * Returns the real and imaginary components based\n     * on the oscillator type.\n     * @returns [real: Float32Array, imaginary: Float32Array]\n     */\n    _getRealImaginary(type, phase) {\n        const fftSize = 4096;\n        let periodicWaveSize = fftSize / 2;\n        const real = new Float32Array(periodicWaveSize);\n        const imag = new Float32Array(periodicWaveSize);\n        let partialCount = 1;\n        if (type === \"custom\") {\n            partialCount = this._partials.length + 1;\n            this._partialCount = this._partials.length;\n            periodicWaveSize = partialCount;\n            // if the partial count is 0, don't bother doing any computation\n            if (this._partials.length === 0) {\n                return [real, imag];\n            }\n        }\n        else {\n            const partial = /^(sine|triangle|square|sawtooth)(\\d+)$/.exec(type);\n            if (partial) {\n                partialCount = parseInt(partial[2], 10) + 1;\n                this._partialCount = parseInt(partial[2], 10);\n                type = partial[1];\n                partialCount = Math.max(partialCount, 2);\n                periodicWaveSize = partialCount;\n            }\n            else {\n                this._partialCount = 0;\n            }\n            this._partials = [];\n        }\n        for (let n = 1; n < periodicWaveSize; ++n) {\n            const piFactor = 2 / (n * Math.PI);\n            let b;\n            switch (type) {\n                case \"sine\":\n                    b = n <= partialCount ? 1 : 0;\n                    this._partials[n - 1] = b;\n                    break;\n                case \"square\":\n                    b = n & 1 ? 2 * piFactor : 0;\n                    this._partials[n - 1] = b;\n                    break;\n                case \"sawtooth\":\n                    b = piFactor * (n & 1 ? 1 : -1);\n                    this._partials[n - 1] = b;\n                    break;\n                case \"triangle\":\n                    if (n & 1) {\n                        b =\n                            2 *\n                                (piFactor * piFactor) *\n                                (((n - 1) >> 1) & 1 ? -1 : 1);\n                    }\n                    else {\n                        b = 0;\n                    }\n                    this._partials[n - 1] = b;\n                    break;\n                case \"custom\":\n                    b = this._partials[n - 1];\n                    break;\n                default:\n                    throw new TypeError(\"Oscillator: invalid type: \" + type);\n            }\n            if (b !== 0) {\n                real[n] = -b * Math.sin(phase * n);\n                imag[n] = b * Math.cos(phase * n);\n            }\n            else {\n                real[n] = 0;\n                imag[n] = 0;\n            }\n        }\n        return [real, imag];\n    }\n    /**\n     * Compute the inverse FFT for a given phase.\n     */\n    _inverseFFT(real, imag, phase) {\n        let sum = 0;\n        const len = real.length;\n        for (let i = 0; i < len; i++) {\n            sum +=\n                real[i] * Math.cos(i * phase) + imag[i] * Math.sin(i * phase);\n        }\n        return sum;\n    }\n    /**\n     * Returns the initial value of the oscillator when stopped.\n     * E.g. a \"sine\" oscillator with phase = 90 would return an initial value of -1.\n     */\n    getInitialValue() {\n        const [real, imag] = this._getRealImaginary(this._type, 0);\n        let maxValue = 0;\n        const twoPi = Math.PI * 2;\n        const testPositions = 32;\n        // check for peaks in 16 places\n        for (let i = 0; i < testPositions; i++) {\n            maxValue = Math.max(this._inverseFFT(real, imag, (i / testPositions) * twoPi), maxValue);\n        }\n        return clamp(-this._inverseFFT(real, imag, this._phase) / maxValue, -1, 1);\n    }\n    get partials() {\n        return this._partials.slice(0, this.partialCount);\n    }\n    set partials(partials) {\n        this._partials = partials;\n        this._partialCount = this._partials.length;\n        if (partials.length) {\n            this.type = \"custom\";\n        }\n    }\n    get phase() {\n        return this._phase * (180 / Math.PI);\n    }\n    set phase(phase) {\n        this._phase = (phase * Math.PI) / 180;\n        // reset the type\n        this.type = this._type;\n    }\n    asArray() {\n        return __awaiter(this, arguments, void 0, function* (length = 1024) {\n            return generateWaveform(this, length);\n        });\n    }\n    dispose() {\n        super.dispose();\n        if (this._oscillator !== null) {\n            this._oscillator.dispose();\n        }\n        this._wave = undefined;\n        this.frequency.dispose();\n        this.detune.dispose();\n        return this;\n    }\n}\n/**\n * Cache the periodic waves to avoid having to redo computations\n */\nOscillator._periodicWaveCache = [];\n//# sourceMappingURL=Oscillator.js.map","import { SignalOperator } from \"./SignalOperator.js\";\nimport { WaveShaper } from \"./WaveShaper.js\";\n/**\n * AudioToGain converts an input in AudioRange [-1,1] to NormalRange [0,1].\n * @see {@link GainToAudio}.\n * @category Signal\n */\nexport class AudioToGain extends SignalOperator {\n    constructor() {\n        super(...arguments);\n        this.name = \"AudioToGain\";\n        /**\n         * The node which converts the audio ranges\n         */\n        this._norm = new WaveShaper({\n            context: this.context,\n            mapping: (x) => (x + 1) / 2,\n        });\n        /**\n         * The AudioRange input [-1, 1]\n         */\n        this.input = this._norm;\n        /**\n         * The GainRange output [0, 1]\n         */\n        this.output = this._norm;\n    }\n    /**\n     * clean up\n     */\n    dispose() {\n        super.dispose();\n        this._norm.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=AudioToGain.js.map","import { Gain } from \"../core/context/Gain.js\";\nimport { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { Signal } from \"./Signal.js\";\n/**\n * Multiply two incoming signals. Or, if a number is given in the constructor,\n * multiplies the incoming signal by that value.\n *\n * @example\n * // multiply two signals\n * const mult = new Tone.Multiply();\n * const sigA = new Tone.Signal(3);\n * const sigB = new Tone.Signal(4);\n * sigA.connect(mult);\n * sigB.connect(mult.factor);\n * // output of mult is 12.\n * @example\n * // multiply a signal and a number\n * const mult = new Tone.Multiply(10);\n * const sig = new Tone.Signal(2).connect(mult);\n * // the output of mult is 20.\n * @category Signal\n */\nexport class Multiply extends Signal {\n    constructor() {\n        const options = optionsFromArguments(Multiply.getDefaults(), arguments, [\"value\"]);\n        super(options);\n        this.name = \"Multiply\";\n        /**\n         * Indicates if the value should be overridden on connection\n         */\n        this.override = false;\n        this._mult =\n            this.input =\n                this.output =\n                    new Gain({\n                        context: this.context,\n                        minValue: options.minValue,\n                        maxValue: options.maxValue,\n                    });\n        this.factor = this._param = this._mult\n            .gain;\n        this.factor.setValueAtTime(options.value, 0);\n    }\n    static getDefaults() {\n        return Object.assign(Signal.getDefaults(), {\n            value: 0,\n        });\n    }\n    dispose() {\n        super.dispose();\n        this._mult.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=Multiply.js.map","import { __awaiter } from \"tslib\";\nimport { Gain } from \"../../core/context/Gain.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\nimport { AudioToGain } from \"../../signal/AudioToGain.js\";\nimport { Multiply } from \"../../signal/Multiply.js\";\nimport { Source } from \"../Source.js\";\nimport { Oscillator } from \"./Oscillator.js\";\nimport { generateWaveform, } from \"./OscillatorInterface.js\";\n/**\n * An amplitude modulated oscillator node. It is implemented with\n * two oscillators, one which modulators the other's amplitude\n * through a gain node.\n * ```\n *    +-------------+       +----------+\n *    | Carrier Osc +>------> GainNode |\n *    +-------------+       |          +--->Output\n *                      +---> gain     |\n * +---------------+    |   +----------+\n * | Modulator Osc +>---+\n * +---------------+\n * ```\n * @example\n * return Tone.Offline(() => {\n * \tconst amOsc = new Tone.AMOscillator(30, \"sine\", \"square\").toDestination().start();\n * }, 0.2, 1);\n * @category Source\n */\nexport class AMOscillator extends Source {\n    constructor() {\n        const options = optionsFromArguments(AMOscillator.getDefaults(), arguments, [\"frequency\", \"type\", \"modulationType\"]);\n        super(options);\n        this.name = \"AMOscillator\";\n        /**\n         * convert the -1,1 output to 0,1\n         */\n        this._modulationScale = new AudioToGain({ context: this.context });\n        /**\n         * the node where the modulation happens\n         */\n        this._modulationNode = new Gain({\n            context: this.context,\n        });\n        this._carrier = new Oscillator({\n            context: this.context,\n            detune: options.detune,\n            frequency: options.frequency,\n            onstop: () => this.onstop(this),\n            phase: options.phase,\n            type: options.type,\n        });\n        (this.frequency = this._carrier.frequency),\n            (this.detune = this._carrier.detune);\n        this._modulator = new Oscillator({\n            context: this.context,\n            phase: options.phase,\n            type: options.modulationType,\n        });\n        this.harmonicity = new Multiply({\n            context: this.context,\n            units: \"positive\",\n            value: options.harmonicity,\n        });\n        // connections\n        this.frequency.chain(this.harmonicity, this._modulator.frequency);\n        this._modulator.chain(this._modulationScale, this._modulationNode.gain);\n        this._carrier.chain(this._modulationNode, this.output);\n        readOnly(this, [\"frequency\", \"detune\", \"harmonicity\"]);\n    }\n    static getDefaults() {\n        return Object.assign(Oscillator.getDefaults(), {\n            harmonicity: 1,\n            modulationType: \"square\",\n        });\n    }\n    /**\n     * start the oscillator\n     */\n    _start(time) {\n        this._modulator.start(time);\n        this._carrier.start(time);\n    }\n    /**\n     * stop the oscillator\n     */\n    _stop(time) {\n        this._modulator.stop(time);\n        this._carrier.stop(time);\n    }\n    _restart(time) {\n        this._modulator.restart(time);\n        this._carrier.restart(time);\n    }\n    /**\n     * The type of the carrier oscillator\n     */\n    get type() {\n        return this._carrier.type;\n    }\n    set type(type) {\n        this._carrier.type = type;\n    }\n    get baseType() {\n        return this._carrier.baseType;\n    }\n    set baseType(baseType) {\n        this._carrier.baseType = baseType;\n    }\n    get partialCount() {\n        return this._carrier.partialCount;\n    }\n    set partialCount(partialCount) {\n        this._carrier.partialCount = partialCount;\n    }\n    /**\n     * The type of the modulator oscillator\n     */\n    get modulationType() {\n        return this._modulator.type;\n    }\n    set modulationType(type) {\n        this._modulator.type = type;\n    }\n    get phase() {\n        return this._carrier.phase;\n    }\n    set phase(phase) {\n        this._carrier.phase = phase;\n        this._modulator.phase = phase;\n    }\n    get partials() {\n        return this._carrier.partials;\n    }\n    set partials(partials) {\n        this._carrier.partials = partials;\n    }\n    asArray() {\n        return __awaiter(this, arguments, void 0, function* (length = 1024) {\n            return generateWaveform(this, length);\n        });\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this.frequency.dispose();\n        this.detune.dispose();\n        this.harmonicity.dispose();\n        this._carrier.dispose();\n        this._modulator.dispose();\n        this._modulationNode.dispose();\n        this._modulationScale.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=AMOscillator.js.map","import { __awaiter } from \"tslib\";\nimport { Gain } from \"../../core/context/Gain.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\nimport { Multiply } from \"../../signal/Multiply.js\";\nimport { Signal } from \"../../signal/Signal.js\";\nimport { Source } from \"../Source.js\";\nimport { Oscillator } from \"./Oscillator.js\";\nimport { generateWaveform, } from \"./OscillatorInterface.js\";\n/**\n * FMOscillator implements a frequency modulation synthesis\n * ```\n *                                              +-------------+\n * +---------------+        +-------------+     | Carrier Osc |\n * | Modulator Osc +>-------> GainNode    |     |             +--->Output\n * +---------------+        |             +>----> frequency   |\n *                       +--> gain        |     +-------------+\n *                       |  +-------------+\n * +-----------------+   |\n * | modulationIndex +>--+\n * +-----------------+\n * ```\n *\n * @example\n * return Tone.Offline(() => {\n * \tconst fmOsc = new Tone.FMOscillator({\n * \t\tfrequency: 200,\n * \t\ttype: \"square\",\n * \t\tmodulationType: \"triangle\",\n * \t\tharmonicity: 0.2,\n * \t\tmodulationIndex: 3\n * \t}).toDestination().start();\n * }, 0.1, 1);\n * @category Source\n */\nexport class FMOscillator extends Source {\n    constructor() {\n        const options = optionsFromArguments(FMOscillator.getDefaults(), arguments, [\"frequency\", \"type\", \"modulationType\"]);\n        super(options);\n        this.name = \"FMOscillator\";\n        /**\n         * the node where the modulation happens\n         */\n        this._modulationNode = new Gain({\n            context: this.context,\n            gain: 0,\n        });\n        this._carrier = new Oscillator({\n            context: this.context,\n            detune: options.detune,\n            frequency: 0,\n            onstop: () => this.onstop(this),\n            phase: options.phase,\n            type: options.type,\n        });\n        this.detune = this._carrier.detune;\n        this.frequency = new Signal({\n            context: this.context,\n            units: \"frequency\",\n            value: options.frequency,\n        });\n        this._modulator = new Oscillator({\n            context: this.context,\n            phase: options.phase,\n            type: options.modulationType,\n        });\n        this.harmonicity = new Multiply({\n            context: this.context,\n            units: \"positive\",\n            value: options.harmonicity,\n        });\n        this.modulationIndex = new Multiply({\n            context: this.context,\n            units: \"positive\",\n            value: options.modulationIndex,\n        });\n        // connections\n        this.frequency.connect(this._carrier.frequency);\n        this.frequency.chain(this.harmonicity, this._modulator.frequency);\n        this.frequency.chain(this.modulationIndex, this._modulationNode);\n        this._modulator.connect(this._modulationNode.gain);\n        this._modulationNode.connect(this._carrier.frequency);\n        this._carrier.connect(this.output);\n        this.detune.connect(this._modulator.detune);\n        readOnly(this, [\n            \"modulationIndex\",\n            \"frequency\",\n            \"detune\",\n            \"harmonicity\",\n        ]);\n    }\n    static getDefaults() {\n        return Object.assign(Oscillator.getDefaults(), {\n            harmonicity: 1,\n            modulationIndex: 2,\n            modulationType: \"square\",\n        });\n    }\n    /**\n     * start the oscillator\n     */\n    _start(time) {\n        this._modulator.start(time);\n        this._carrier.start(time);\n    }\n    /**\n     * stop the oscillator\n     */\n    _stop(time) {\n        this._modulator.stop(time);\n        this._carrier.stop(time);\n    }\n    _restart(time) {\n        this._modulator.restart(time);\n        this._carrier.restart(time);\n        return this;\n    }\n    get type() {\n        return this._carrier.type;\n    }\n    set type(type) {\n        this._carrier.type = type;\n    }\n    get baseType() {\n        return this._carrier.baseType;\n    }\n    set baseType(baseType) {\n        this._carrier.baseType = baseType;\n    }\n    get partialCount() {\n        return this._carrier.partialCount;\n    }\n    set partialCount(partialCount) {\n        this._carrier.partialCount = partialCount;\n    }\n    /**\n     * The type of the modulator oscillator\n     */\n    get modulationType() {\n        return this._modulator.type;\n    }\n    set modulationType(type) {\n        this._modulator.type = type;\n    }\n    get phase() {\n        return this._carrier.phase;\n    }\n    set phase(phase) {\n        this._carrier.phase = phase;\n        this._modulator.phase = phase;\n    }\n    get partials() {\n        return this._carrier.partials;\n    }\n    set partials(partials) {\n        this._carrier.partials = partials;\n    }\n    asArray() {\n        return __awaiter(this, arguments, void 0, function* (length = 1024) {\n            return generateWaveform(this, length);\n        });\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this.frequency.dispose();\n        this.harmonicity.dispose();\n        this._carrier.dispose();\n        this._modulator.dispose();\n        this._modulationNode.dispose();\n        this.modulationIndex.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=FMOscillator.js.map","import { __awaiter } from \"tslib\";\nimport { Gain } from \"../../core/context/Gain.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\nimport { Signal } from \"../../signal/Signal.js\";\nimport { WaveShaper } from \"../../signal/WaveShaper.js\";\nimport { Source } from \"../Source.js\";\nimport { Oscillator } from \"./Oscillator.js\";\nimport { generateWaveform, } from \"./OscillatorInterface.js\";\n/**\n * PulseOscillator is an oscillator with control over pulse width,\n * also known as the duty cycle. At 50% duty cycle (width = 0) the wave is\n * a square wave.\n * [Read more](https://wigglewave.wordpress.com/2014/08/16/pulse-waveforms-and-harmonics/).\n * ```\n *    width = -0.25        width = 0.0          width = 0.25\n *\n *   +-----+            +-------+       +    +-------+     +-+\n *   |     |            |       |       |            |     |\n *   |     |            |       |       |            |     |\n * +-+     +-------+    +       +-------+            +-----+\n *\n *\n *    width = -0.5                              width = 0.5\n *\n *     +---+                                 +-------+   +---+\n *     |   |                                         |   |\n *     |   |                                         |   |\n * +---+   +-------+                                 +---+\n *\n *\n *    width = -0.75                             width = 0.75\n *\n *       +-+                                 +-------+ +-----+\n *       | |                                         | |\n *       | |                                         | |\n * +-----+ +-------+                                 +-+\n * ```\n * @example\n * return Tone.Offline(() => {\n * \tconst pulse = new Tone.PulseOscillator(50, 0.4).toDestination().start();\n * }, 0.1, 1);\n * @category Source\n */\nexport class PulseOscillator extends Source {\n    constructor() {\n        const options = optionsFromArguments(PulseOscillator.getDefaults(), arguments, [\"frequency\", \"width\"]);\n        super(options);\n        this.name = \"PulseOscillator\";\n        /**\n         * gate the width amount\n         */\n        this._widthGate = new Gain({\n            context: this.context,\n            gain: 0,\n        });\n        /**\n         * Threshold the signal to turn it into a square\n         */\n        this._thresh = new WaveShaper({\n            context: this.context,\n            mapping: (val) => (val <= 0 ? -1 : 1),\n        });\n        this.width = new Signal({\n            context: this.context,\n            units: \"audioRange\",\n            value: options.width,\n        });\n        this._triangle = new Oscillator({\n            context: this.context,\n            detune: options.detune,\n            frequency: options.frequency,\n            onstop: () => this.onstop(this),\n            phase: options.phase,\n            type: \"triangle\",\n        });\n        this.frequency = this._triangle.frequency;\n        this.detune = this._triangle.detune;\n        // connections\n        this._triangle.chain(this._thresh, this.output);\n        this.width.chain(this._widthGate, this._thresh);\n        readOnly(this, [\"width\", \"frequency\", \"detune\"]);\n    }\n    static getDefaults() {\n        return Object.assign(Source.getDefaults(), {\n            detune: 0,\n            frequency: 440,\n            phase: 0,\n            type: \"pulse\",\n            width: 0.2,\n        });\n    }\n    /**\n     * start the oscillator\n     */\n    _start(time) {\n        time = this.toSeconds(time);\n        this._triangle.start(time);\n        this._widthGate.gain.setValueAtTime(1, time);\n    }\n    /**\n     * stop the oscillator\n     */\n    _stop(time) {\n        time = this.toSeconds(time);\n        this._triangle.stop(time);\n        // the width is still connected to the output.\n        // that needs to be stopped also\n        this._widthGate.gain.cancelScheduledValues(time);\n        this._widthGate.gain.setValueAtTime(0, time);\n    }\n    _restart(time) {\n        this._triangle.restart(time);\n        this._widthGate.gain.cancelScheduledValues(time);\n        this._widthGate.gain.setValueAtTime(1, time);\n    }\n    /**\n     * The phase of the oscillator in degrees.\n     */\n    get phase() {\n        return this._triangle.phase;\n    }\n    set phase(phase) {\n        this._triangle.phase = phase;\n    }\n    /**\n     * The type of the oscillator. Always returns \"pulse\".\n     */\n    get type() {\n        return \"pulse\";\n    }\n    /**\n     * The baseType of the oscillator. Always returns \"pulse\".\n     */\n    get baseType() {\n        return \"pulse\";\n    }\n    /**\n     * The partials of the waveform. Cannot set partials for this waveform type\n     */\n    get partials() {\n        return [];\n    }\n    /**\n     * No partials for this waveform type.\n     */\n    get partialCount() {\n        return 0;\n    }\n    /**\n     * *Internal use* The carrier oscillator type is fed through the\n     * waveshaper node to create the pulse. Using different carrier oscillators\n     * changes oscillator's behavior.\n     */\n    set carrierType(type) {\n        this._triangle.type = type;\n    }\n    asArray() {\n        return __awaiter(this, arguments, void 0, function* (length = 1024) {\n            return generateWaveform(this, length);\n        });\n    }\n    /**\n     * Clean up method.\n     */\n    dispose() {\n        super.dispose();\n        this._triangle.dispose();\n        this.width.dispose();\n        this._widthGate.dispose();\n        this._thresh.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=PulseOscillator.js.map","import { __awaiter } from \"tslib\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { noOp, readOnly } from \"../../core/util/Interface.js\";\nimport { Signal } from \"../../signal/Signal.js\";\nimport { Source } from \"../Source.js\";\nimport { Oscillator } from \"./Oscillator.js\";\nimport { generateWaveform, } from \"./OscillatorInterface.js\";\nimport { assertRange } from \"../../core/util/Debug.js\";\n/**\n * FatOscillator is an array of oscillators with detune spread between the oscillators\n * @example\n * const fatOsc = new Tone.FatOscillator(\"Ab3\", \"sawtooth\", 40).toDestination().start();\n * @category Source\n */\nexport class FatOscillator extends Source {\n    constructor() {\n        const options = optionsFromArguments(FatOscillator.getDefaults(), arguments, [\"frequency\", \"type\", \"spread\"]);\n        super(options);\n        this.name = \"FatOscillator\";\n        /**\n         * The array of oscillators\n         */\n        this._oscillators = [];\n        this.frequency = new Signal({\n            context: this.context,\n            units: \"frequency\",\n            value: options.frequency,\n        });\n        this.detune = new Signal({\n            context: this.context,\n            units: \"cents\",\n            value: options.detune,\n        });\n        this._spread = options.spread;\n        this._type = options.type;\n        this._phase = options.phase;\n        this._partials = options.partials;\n        this._partialCount = options.partialCount;\n        // set the count initially\n        this.count = options.count;\n        readOnly(this, [\"frequency\", \"detune\"]);\n    }\n    static getDefaults() {\n        return Object.assign(Oscillator.getDefaults(), {\n            count: 3,\n            spread: 20,\n            type: \"sawtooth\",\n        });\n    }\n    /**\n     * start the oscillator\n     */\n    _start(time) {\n        time = this.toSeconds(time);\n        this._forEach((osc) => osc.start(time));\n    }\n    /**\n     * stop the oscillator\n     */\n    _stop(time) {\n        time = this.toSeconds(time);\n        this._forEach((osc) => osc.stop(time));\n    }\n    _restart(time) {\n        this._forEach((osc) => osc.restart(time));\n    }\n    /**\n     * Iterate over all of the oscillators\n     */\n    _forEach(iterator) {\n        for (let i = 0; i < this._oscillators.length; i++) {\n            iterator(this._oscillators[i], i);\n        }\n    }\n    /**\n     * The type of the oscillator\n     */\n    get type() {\n        return this._type;\n    }\n    set type(type) {\n        this._type = type;\n        this._forEach((osc) => (osc.type = type));\n    }\n    /**\n     * The detune spread between the oscillators. If \"count\" is\n     * set to 3 oscillators and the \"spread\" is set to 40,\n     * the three oscillators would be detuned like this: [-20, 0, 20]\n     * for a total detune spread of 40 cents.\n     * @example\n     * const fatOsc = new Tone.FatOscillator().toDestination().start();\n     * fatOsc.spread = 70;\n     */\n    get spread() {\n        return this._spread;\n    }\n    set spread(spread) {\n        this._spread = spread;\n        if (this._oscillators.length > 1) {\n            const start = -spread / 2;\n            const step = spread / (this._oscillators.length - 1);\n            this._forEach((osc, i) => (osc.detune.value = start + step * i));\n        }\n    }\n    /**\n     * The number of detuned oscillators. Must be an integer greater than 1.\n     * @example\n     * const fatOsc = new Tone.FatOscillator(\"C#3\", \"sawtooth\").toDestination().start();\n     * // use 4 sawtooth oscillators\n     * fatOsc.count = 4;\n     */\n    get count() {\n        return this._oscillators.length;\n    }\n    set count(count) {\n        assertRange(count, 1);\n        if (this._oscillators.length !== count) {\n            // dispose the previous oscillators\n            this._forEach((osc) => osc.dispose());\n            this._oscillators = [];\n            for (let i = 0; i < count; i++) {\n                const osc = new Oscillator({\n                    context: this.context,\n                    volume: -6 - count * 1.1,\n                    type: this._type,\n                    phase: this._phase + (i / count) * 360,\n                    partialCount: this._partialCount,\n                    onstop: i === 0 ? () => this.onstop(this) : noOp,\n                });\n                if (this.type === \"custom\") {\n                    osc.partials = this._partials;\n                }\n                this.frequency.connect(osc.frequency);\n                this.detune.connect(osc.detune);\n                osc.detune.overridden = false;\n                osc.connect(this.output);\n                this._oscillators[i] = osc;\n            }\n            // set the spread\n            this.spread = this._spread;\n            if (this.state === \"started\") {\n                this._forEach((osc) => osc.start());\n            }\n        }\n    }\n    get phase() {\n        return this._phase;\n    }\n    set phase(phase) {\n        this._phase = phase;\n        this._forEach((osc, i) => (osc.phase = this._phase + (i / this.count) * 360));\n    }\n    get baseType() {\n        return this._oscillators[0].baseType;\n    }\n    set baseType(baseType) {\n        this._forEach((osc) => (osc.baseType = baseType));\n        this._type = this._oscillators[0].type;\n    }\n    get partials() {\n        return this._oscillators[0].partials;\n    }\n    set partials(partials) {\n        this._partials = partials;\n        this._partialCount = this._partials.length;\n        if (partials.length) {\n            this._type = \"custom\";\n            this._forEach((osc) => (osc.partials = partials));\n        }\n    }\n    get partialCount() {\n        return this._oscillators[0].partialCount;\n    }\n    set partialCount(partialCount) {\n        this._partialCount = partialCount;\n        this._forEach((osc) => (osc.partialCount = partialCount));\n        this._type = this._oscillators[0].type;\n    }\n    asArray() {\n        return __awaiter(this, arguments, void 0, function* (length = 1024) {\n            return generateWaveform(this, length);\n        });\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this.frequency.dispose();\n        this.detune.dispose();\n        this._forEach((osc) => osc.dispose());\n        return this;\n    }\n}\n//# sourceMappingURL=FatOscillator.js.map","import { __awaiter } from \"tslib\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\nimport { Multiply } from \"../../signal/Multiply.js\";\nimport { Source } from \"../Source.js\";\nimport { Oscillator } from \"./Oscillator.js\";\nimport { generateWaveform, } from \"./OscillatorInterface.js\";\nimport { PulseOscillator } from \"./PulseOscillator.js\";\n/**\n * PWMOscillator modulates the width of a Tone.PulseOscillator\n * at the modulationFrequency. This has the effect of continuously\n * changing the timbre of the oscillator by altering the harmonics\n * generated.\n * @example\n * return Tone.Offline(() => {\n * \tconst pwm = new Tone.PWMOscillator(60, 0.3).toDestination().start();\n * }, 0.1, 1);\n * @category Source\n */\nexport class PWMOscillator extends Source {\n    constructor() {\n        const options = optionsFromArguments(PWMOscillator.getDefaults(), arguments, [\"frequency\", \"modulationFrequency\"]);\n        super(options);\n        this.name = \"PWMOscillator\";\n        this.sourceType = \"pwm\";\n        /**\n         * Scale the oscillator so it doesn't go silent\n         * at the extreme values.\n         */\n        this._scale = new Multiply({\n            context: this.context,\n            value: 2,\n        });\n        this._pulse = new PulseOscillator({\n            context: this.context,\n            frequency: options.modulationFrequency,\n        });\n        // change the pulse oscillator type\n        this._pulse.carrierType = \"sine\";\n        this.modulationFrequency = this._pulse.frequency;\n        this._modulator = new Oscillator({\n            context: this.context,\n            detune: options.detune,\n            frequency: options.frequency,\n            onstop: () => this.onstop(this),\n            phase: options.phase,\n        });\n        this.frequency = this._modulator.frequency;\n        this.detune = this._modulator.detune;\n        // connections\n        this._modulator.chain(this._scale, this._pulse.width);\n        this._pulse.connect(this.output);\n        readOnly(this, [\"modulationFrequency\", \"frequency\", \"detune\"]);\n    }\n    static getDefaults() {\n        return Object.assign(Source.getDefaults(), {\n            detune: 0,\n            frequency: 440,\n            modulationFrequency: 0.4,\n            phase: 0,\n            type: \"pwm\",\n        });\n    }\n    /**\n     * start the oscillator\n     */\n    _start(time) {\n        time = this.toSeconds(time);\n        this._modulator.start(time);\n        this._pulse.start(time);\n    }\n    /**\n     * stop the oscillator\n     */\n    _stop(time) {\n        time = this.toSeconds(time);\n        this._modulator.stop(time);\n        this._pulse.stop(time);\n    }\n    /**\n     * restart the oscillator\n     */\n    _restart(time) {\n        this._modulator.restart(time);\n        this._pulse.restart(time);\n    }\n    /**\n     * The type of the oscillator. Always returns \"pwm\".\n     */\n    get type() {\n        return \"pwm\";\n    }\n    /**\n     * The baseType of the oscillator. Always returns \"pwm\".\n     */\n    get baseType() {\n        return \"pwm\";\n    }\n    /**\n     * The partials of the waveform. Cannot set partials for this waveform type\n     */\n    get partials() {\n        return [];\n    }\n    /**\n     * No partials for this waveform type.\n     */\n    get partialCount() {\n        return 0;\n    }\n    /**\n     * The phase of the oscillator in degrees.\n     */\n    get phase() {\n        return this._modulator.phase;\n    }\n    set phase(phase) {\n        this._modulator.phase = phase;\n    }\n    asArray() {\n        return __awaiter(this, arguments, void 0, function* (length = 1024) {\n            return generateWaveform(this, length);\n        });\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this._pulse.dispose();\n        this._scale.dispose();\n        this._modulator.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=PWMOscillator.js.map","import { __awaiter } from \"tslib\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\nimport { isNumber, isString } from \"../../core/util/TypeCheck.js\";\nimport { Signal } from \"../../signal/Signal.js\";\nimport { Source } from \"../Source.js\";\nimport { AMOscillator } from \"./AMOscillator.js\";\nimport { FatOscillator } from \"./FatOscillator.js\";\nimport { FMOscillator } from \"./FMOscillator.js\";\nimport { Oscillator } from \"./Oscillator.js\";\nimport { generateWaveform, } from \"./OscillatorInterface.js\";\nimport { PulseOscillator } from \"./PulseOscillator.js\";\nimport { PWMOscillator } from \"./PWMOscillator.js\";\nconst OmniOscillatorSourceMap = {\n    am: AMOscillator,\n    fat: FatOscillator,\n    fm: FMOscillator,\n    oscillator: Oscillator,\n    pulse: PulseOscillator,\n    pwm: PWMOscillator,\n};\n/**\n * OmniOscillator aggregates all of the oscillator types into one.\n * @example\n * return Tone.Offline(() => {\n * \tconst omniOsc = new Tone.OmniOscillator(\"C#4\", \"pwm\").toDestination().start();\n * }, 0.1, 1);\n * @category Source\n */\nexport class OmniOscillator extends Source {\n    constructor() {\n        const options = optionsFromArguments(OmniOscillator.getDefaults(), arguments, [\"frequency\", \"type\"]);\n        super(options);\n        this.name = \"OmniOscillator\";\n        this.frequency = new Signal({\n            context: this.context,\n            units: \"frequency\",\n            value: options.frequency,\n        });\n        this.detune = new Signal({\n            context: this.context,\n            units: \"cents\",\n            value: options.detune,\n        });\n        readOnly(this, [\"frequency\", \"detune\"]);\n        // set the options\n        this.set(options);\n    }\n    static getDefaults() {\n        return Object.assign(Oscillator.getDefaults(), FMOscillator.getDefaults(), AMOscillator.getDefaults(), FatOscillator.getDefaults(), PulseOscillator.getDefaults(), PWMOscillator.getDefaults());\n    }\n    /**\n     * start the oscillator\n     */\n    _start(time) {\n        this._oscillator.start(time);\n    }\n    /**\n     * start the oscillator\n     */\n    _stop(time) {\n        this._oscillator.stop(time);\n    }\n    _restart(time) {\n        this._oscillator.restart(time);\n        return this;\n    }\n    /**\n     * The type of the oscillator. Can be any of the basic types: sine, square, triangle, sawtooth. Or\n     * prefix the basic types with \"fm\", \"am\", or \"fat\" to use the FMOscillator, AMOscillator or FatOscillator\n     * types. The oscillator could also be set to \"pwm\" or \"pulse\". All of the parameters of the\n     * oscillator's class are accessible when the oscillator is set to that type, but throws an error\n     * when it's not.\n     * @example\n     * const omniOsc = new Tone.OmniOscillator().toDestination().start();\n     * omniOsc.type = \"pwm\";\n     * // modulationFrequency is parameter which is available\n     * // only when the type is \"pwm\".\n     * omniOsc.modulationFrequency.value = 0.5;\n     */\n    get type() {\n        let prefix = \"\";\n        if ([\"am\", \"fm\", \"fat\"].some((p) => this._sourceType === p)) {\n            prefix = this._sourceType;\n        }\n        return (prefix + this._oscillator.type);\n    }\n    set type(type) {\n        if (type.substr(0, 2) === \"fm\") {\n            this._createNewOscillator(\"fm\");\n            this._oscillator = this._oscillator;\n            this._oscillator.type = type.substr(2);\n        }\n        else if (type.substr(0, 2) === \"am\") {\n            this._createNewOscillator(\"am\");\n            this._oscillator = this._oscillator;\n            this._oscillator.type = type.substr(2);\n        }\n        else if (type.substr(0, 3) === \"fat\") {\n            this._createNewOscillator(\"fat\");\n            this._oscillator = this._oscillator;\n            this._oscillator.type = type.substr(3);\n        }\n        else if (type === \"pwm\") {\n            this._createNewOscillator(\"pwm\");\n            this._oscillator = this._oscillator;\n        }\n        else if (type === \"pulse\") {\n            this._createNewOscillator(\"pulse\");\n        }\n        else {\n            this._createNewOscillator(\"oscillator\");\n            this._oscillator = this._oscillator;\n            this._oscillator.type = type;\n        }\n    }\n    /**\n     * The value is an empty array when the type is not \"custom\".\n     * This is not available on \"pwm\" and \"pulse\" oscillator types.\n     * @see {@link Oscillator.partials}\n     */\n    get partials() {\n        return this._oscillator.partials;\n    }\n    set partials(partials) {\n        if (!this._getOscType(this._oscillator, \"pulse\") &&\n            !this._getOscType(this._oscillator, \"pwm\")) {\n            this._oscillator.partials = partials;\n        }\n    }\n    get partialCount() {\n        return this._oscillator.partialCount;\n    }\n    set partialCount(partialCount) {\n        if (!this._getOscType(this._oscillator, \"pulse\") &&\n            !this._getOscType(this._oscillator, \"pwm\")) {\n            this._oscillator.partialCount = partialCount;\n        }\n    }\n    set(props) {\n        // make sure the type is set first\n        if (Reflect.has(props, \"type\") && props.type) {\n            this.type = props.type;\n        }\n        // then set the rest\n        super.set(props);\n        return this;\n    }\n    /**\n     * connect the oscillator to the frequency and detune signals\n     */\n    _createNewOscillator(oscType) {\n        if (oscType !== this._sourceType) {\n            this._sourceType = oscType;\n            const OscConstructor = OmniOscillatorSourceMap[oscType];\n            // short delay to avoid clicks on the change\n            const now = this.now();\n            if (this._oscillator) {\n                const oldOsc = this._oscillator;\n                oldOsc.stop(now);\n                // dispose the old one\n                this.context.setTimeout(() => oldOsc.dispose(), this.blockTime);\n            }\n            this._oscillator = new OscConstructor({\n                context: this.context,\n            });\n            this.frequency.connect(this._oscillator.frequency);\n            this.detune.connect(this._oscillator.detune);\n            this._oscillator.connect(this.output);\n            this._oscillator.onstop = () => this.onstop(this);\n            if (this.state === \"started\") {\n                this._oscillator.start(now);\n            }\n        }\n    }\n    get phase() {\n        return this._oscillator.phase;\n    }\n    set phase(phase) {\n        this._oscillator.phase = phase;\n    }\n    /**\n     * The source type of the oscillator.\n     * @example\n     * const omniOsc = new Tone.OmniOscillator(440, \"fmsquare\");\n     * console.log(omniOsc.sourceType); // 'fm'\n     */\n    get sourceType() {\n        return this._sourceType;\n    }\n    set sourceType(sType) {\n        // the basetype defaults to sine\n        let baseType = \"sine\";\n        if (this._oscillator.type !== \"pwm\" &&\n            this._oscillator.type !== \"pulse\") {\n            baseType = this._oscillator.type;\n        }\n        // set the type\n        if (sType === \"fm\") {\n            this.type = (\"fm\" + baseType);\n        }\n        else if (sType === \"am\") {\n            this.type = (\"am\" + baseType);\n        }\n        else if (sType === \"fat\") {\n            this.type = (\"fat\" + baseType);\n        }\n        else if (sType === \"oscillator\") {\n            this.type = baseType;\n        }\n        else if (sType === \"pulse\") {\n            this.type = \"pulse\";\n        }\n        else if (sType === \"pwm\") {\n            this.type = \"pwm\";\n        }\n    }\n    _getOscType(osc, sourceType) {\n        return osc instanceof OmniOscillatorSourceMap[sourceType];\n    }\n    /**\n     * The base type of the oscillator.\n     * @see {@link Oscillator.baseType}\n     * @example\n     * const omniOsc = new Tone.OmniOscillator(440, \"fmsquare4\");\n     * console.log(omniOsc.sourceType, omniOsc.baseType, omniOsc.partialCount);\n     */\n    get baseType() {\n        return this._oscillator.baseType;\n    }\n    set baseType(baseType) {\n        if (!this._getOscType(this._oscillator, \"pulse\") &&\n            !this._getOscType(this._oscillator, \"pwm\") &&\n            baseType !== \"pulse\" &&\n            baseType !== \"pwm\") {\n            this._oscillator.baseType = baseType;\n        }\n    }\n    /**\n     * The width of the oscillator when sourceType === \"pulse\".\n     * @see {@link PWMOscillator}\n     */\n    get width() {\n        if (this._getOscType(this._oscillator, \"pulse\")) {\n            return this._oscillator.width;\n        }\n        else {\n            return undefined;\n        }\n    }\n    /**\n     * The number of detuned oscillators when sourceType === \"fat\".\n     * @see {@link FatOscillator.count}\n     */\n    get count() {\n        if (this._getOscType(this._oscillator, \"fat\")) {\n            return this._oscillator.count;\n        }\n        else {\n            return undefined;\n        }\n    }\n    set count(count) {\n        if (this._getOscType(this._oscillator, \"fat\") && isNumber(count)) {\n            this._oscillator.count = count;\n        }\n    }\n    /**\n     * The detune spread between the oscillators when sourceType === \"fat\".\n     * @see {@link FatOscillator.count}\n     */\n    get spread() {\n        if (this._getOscType(this._oscillator, \"fat\")) {\n            return this._oscillator.spread;\n        }\n        else {\n            return undefined;\n        }\n    }\n    set spread(spread) {\n        if (this._getOscType(this._oscillator, \"fat\") && isNumber(spread)) {\n            this._oscillator.spread = spread;\n        }\n    }\n    /**\n     * The type of the modulator oscillator. Only if the oscillator is set to \"am\" or \"fm\" types.\n     * @see {@link AMOscillator} or {@link FMOscillator}\n     */\n    get modulationType() {\n        if (this._getOscType(this._oscillator, \"fm\") ||\n            this._getOscType(this._oscillator, \"am\")) {\n            return this._oscillator.modulationType;\n        }\n        else {\n            return undefined;\n        }\n    }\n    set modulationType(mType) {\n        if ((this._getOscType(this._oscillator, \"fm\") ||\n            this._getOscType(this._oscillator, \"am\")) &&\n            isString(mType)) {\n            this._oscillator.modulationType = mType;\n        }\n    }\n    /**\n     * The modulation index when the sourceType === \"fm\"\n     * @see {@link FMOscillator}.\n     */\n    get modulationIndex() {\n        if (this._getOscType(this._oscillator, \"fm\")) {\n            return this._oscillator.modulationIndex;\n        }\n        else {\n            return undefined;\n        }\n    }\n    /**\n     * Harmonicity is the frequency ratio between the carrier and the modulator oscillators.\n     * @see {@link AMOscillator} or {@link FMOscillator}\n     */\n    get harmonicity() {\n        if (this._getOscType(this._oscillator, \"fm\") ||\n            this._getOscType(this._oscillator, \"am\")) {\n            return this._oscillator.harmonicity;\n        }\n        else {\n            return undefined;\n        }\n    }\n    /**\n     * The modulationFrequency Signal of the oscillator when sourceType === \"pwm\"\n     * see {@link PWMOscillator}\n     * @min 0.1\n     * @max 5\n     */\n    get modulationFrequency() {\n        if (this._getOscType(this._oscillator, \"pwm\")) {\n            return this._oscillator.modulationFrequency;\n        }\n        else {\n            return undefined;\n        }\n    }\n    asArray() {\n        return __awaiter(this, arguments, void 0, function* (length = 1024) {\n            return generateWaveform(this, length);\n        });\n    }\n    dispose() {\n        super.dispose();\n        this.detune.dispose();\n        this.frequency.dispose();\n        this._oscillator.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=OmniOscillator.js.map","import { assertRange } from \"./Debug.js\";\n/**\n * Assert that the number is in the given range.\n */\nexport function range(min, max = Infinity) {\n    const valueMap = new WeakMap();\n    return function (target, propertyKey) {\n        Reflect.defineProperty(target, propertyKey, {\n            configurable: true,\n            enumerable: true,\n            get: function () {\n                return valueMap.get(this);\n            },\n            set: function (newValue) {\n                assertRange(newValue, min, max);\n                valueMap.set(this, newValue);\n            },\n        });\n    };\n}\n/**\n * Convert the time to seconds and assert that the time is in between the two\n * values when being set.\n */\nexport function timeRange(min, max = Infinity) {\n    const valueMap = new WeakMap();\n    return function (target, propertyKey) {\n        Reflect.defineProperty(target, propertyKey, {\n            configurable: true,\n            enumerable: true,\n            get: function () {\n                return valueMap.get(this);\n            },\n            set: function (newValue) {\n                assertRange(this.toSeconds(newValue), min, max);\n                valueMap.set(this, newValue);\n            },\n        });\n    };\n}\n//# sourceMappingURL=Decorator.js.map","import { __awaiter, __decorate } from \"tslib\";\nimport { ToneAudioBuffer } from \"../../core/context/ToneAudioBuffer.js\";\nimport { defaultArg, optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { noOp } from \"../../core/util/Interface.js\";\nimport { isUndef } from \"../../core/util/TypeCheck.js\";\nimport { Source } from \"../Source.js\";\nimport { ToneBufferSource } from \"./ToneBufferSource.js\";\nimport { assertRange } from \"../../core/util/Debug.js\";\nimport { timeRange } from \"../../core/util/Decorator.js\";\n/**\n * Player is an audio file player with start, loop, and stop functions.\n * @example\n * const player = new Tone.Player(\"https://tonejs.github.io/audio/berklee/gong_1.mp3\").toDestination();\n * // play as soon as the buffer is loaded\n * player.autostart = true;\n * @category Source\n */\nexport class Player extends Source {\n    constructor() {\n        const options = optionsFromArguments(Player.getDefaults(), arguments, [\n            \"url\",\n            \"onload\",\n        ]);\n        super(options);\n        this.name = \"Player\";\n        /**\n         * All of the active buffer source nodes\n         */\n        this._activeSources = new Set();\n        this._buffer = new ToneAudioBuffer({\n            onload: this._onload.bind(this, options.onload),\n            onerror: options.onerror,\n            reverse: options.reverse,\n            url: options.url,\n        });\n        this.autostart = options.autostart;\n        this._loop = options.loop;\n        this._loopStart = options.loopStart;\n        this._loopEnd = options.loopEnd;\n        this._playbackRate = options.playbackRate;\n        this.fadeIn = options.fadeIn;\n        this.fadeOut = options.fadeOut;\n    }\n    static getDefaults() {\n        return Object.assign(Source.getDefaults(), {\n            autostart: false,\n            fadeIn: 0,\n            fadeOut: 0,\n            loop: false,\n            loopEnd: 0,\n            loopStart: 0,\n            onload: noOp,\n            onerror: noOp,\n            playbackRate: 1,\n            reverse: false,\n        });\n    }\n    /**\n     * Load the audio file as an audio buffer.\n     * Decodes the audio asynchronously and invokes\n     * the callback once the audio buffer loads.\n     * Note: this does not need to be called if a url\n     * was passed in to the constructor. Only use this\n     * if you want to manually load a new url.\n     * @param url The url of the buffer to load. Filetype support depends on the browser.\n     */\n    load(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this._buffer.load(url);\n            this._onload();\n            return this;\n        });\n    }\n    /**\n     * Internal callback when the buffer is loaded.\n     */\n    _onload(callback = noOp) {\n        callback();\n        if (this.autostart) {\n            this.start();\n        }\n    }\n    /**\n     * Internal callback when the buffer is done playing.\n     */\n    _onSourceEnd(source) {\n        // invoke the onstop function\n        this.onstop(this);\n        // delete the source from the active sources\n        this._activeSources.delete(source);\n        if (this._activeSources.size === 0 &&\n            !this._synced &&\n            this._state.getValueAtTime(this.now()) === \"started\") {\n            // remove the 'implicitEnd' event and replace with an explicit end\n            this._state.cancel(this.now());\n            this._state.setStateAtTime(\"stopped\", this.now());\n        }\n    }\n    /**\n     * Play the buffer at the given startTime. Optionally add an offset\n     * and/or duration which will play the buffer from a position\n     * within the buffer for the given duration.\n     *\n     * @param  time When the player should start.\n     * @param  offset The offset from the beginning of the sample to start at.\n     * @param  duration How long the sample should play. If no duration is given, it will default to the full length of the sample (minus any offset)\n     */\n    start(time, offset, duration) {\n        super.start(time, offset, duration);\n        return this;\n    }\n    /**\n     * Internal start method\n     */\n    _start(startTime, offset, duration) {\n        // if it's a loop the default offset is the loopStart point\n        if (this._loop) {\n            offset = defaultArg(offset, this._loopStart);\n        }\n        else {\n            // otherwise the default offset is 0\n            offset = defaultArg(offset, 0);\n        }\n        // compute the values in seconds\n        const computedOffset = this.toSeconds(offset);\n        // compute the duration which is either the passed in duration of the buffer.duration - offset\n        const origDuration = duration;\n        duration = defaultArg(duration, Math.max(this._buffer.duration - computedOffset, 0));\n        let computedDuration = this.toSeconds(duration);\n        // scale it by the playback rate\n        computedDuration = computedDuration / this._playbackRate;\n        // get the start time\n        startTime = this.toSeconds(startTime);\n        // make the source\n        const source = new ToneBufferSource({\n            url: this._buffer,\n            context: this.context,\n            fadeIn: this.fadeIn,\n            fadeOut: this.fadeOut,\n            loop: this._loop,\n            loopEnd: this._loopEnd,\n            loopStart: this._loopStart,\n            onended: this._onSourceEnd.bind(this),\n            playbackRate: this._playbackRate,\n        }).connect(this.output);\n        // set the looping properties\n        if (!this._loop && !this._synced) {\n            // cancel the previous stop\n            this._state.cancel(startTime + computedDuration);\n            // if it's not looping, set the state change at the end of the sample\n            this._state.setStateAtTime(\"stopped\", startTime + computedDuration, {\n                implicitEnd: true,\n            });\n        }\n        // add it to the array of active sources\n        this._activeSources.add(source);\n        // start it\n        if (this._loop && isUndef(origDuration)) {\n            source.start(startTime, computedOffset);\n        }\n        else {\n            // subtract the fade out time\n            source.start(startTime, computedOffset, computedDuration - this.toSeconds(this.fadeOut));\n        }\n    }\n    /**\n     * Stop playback.\n     */\n    _stop(time) {\n        const computedTime = this.toSeconds(time);\n        this._activeSources.forEach((source) => source.stop(computedTime));\n    }\n    /**\n     * Stop and then restart the player from the beginning (or offset)\n     * @param  time When the player should start.\n     * @param  offset The offset from the beginning of the sample to start at.\n     * @param  duration How long the sample should play. If no duration is given,\n     * \t\t\t\t\tit will default to the full length of the sample (minus any offset)\n     */\n    restart(time, offset, duration) {\n        super.restart(time, offset, duration);\n        return this;\n    }\n    _restart(time, offset, duration) {\n        var _a;\n        (_a = [...this._activeSources].pop()) === null || _a === void 0 ? void 0 : _a.stop(time); // explicitly stop only the most recently created source, to avoid edge case when > 1 source exists and _stop() erroneously sets all stop times past original end offset\n        this._start(time, offset, duration);\n    }\n    /**\n     * Seek to a specific time in the player's buffer. If the\n     * source is no longer playing at that time, it will stop.\n     * @param offset The time to seek to.\n     * @param when The time for the seek event to occur.\n     * @example\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/berklee/gurgling_theremin_1.mp3\", () => {\n     * \tplayer.start();\n     * \t// seek to the offset in 1 second from now\n     * \tplayer.seek(0.4, \"+1\");\n     * }).toDestination();\n     */\n    seek(offset, when) {\n        const computedTime = this.toSeconds(when);\n        if (this._state.getValueAtTime(computedTime) === \"started\") {\n            const computedOffset = this.toSeconds(offset);\n            // if it's currently playing, stop it\n            this._stop(computedTime);\n            // restart it at the given time\n            this._start(computedTime, computedOffset);\n        }\n        return this;\n    }\n    /**\n     * Set the loop start and end. Will only loop if loop is set to true.\n     * @param loopStart The loop start time\n     * @param loopEnd The loop end time\n     * @example\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/berklee/malevoices_aa2_F3.mp3\").toDestination();\n     * // loop between the given points\n     * player.setLoopPoints(0.2, 0.3);\n     * player.loop = true;\n     * player.autostart = true;\n     */\n    setLoopPoints(loopStart, loopEnd) {\n        this.loopStart = loopStart;\n        this.loopEnd = loopEnd;\n        return this;\n    }\n    /**\n     * If loop is true, the loop will start at this position.\n     */\n    get loopStart() {\n        return this._loopStart;\n    }\n    set loopStart(loopStart) {\n        this._loopStart = loopStart;\n        if (this.buffer.loaded) {\n            assertRange(this.toSeconds(loopStart), 0, this.buffer.duration);\n        }\n        // get the current source\n        this._activeSources.forEach((source) => {\n            source.loopStart = loopStart;\n        });\n    }\n    /**\n     * If loop is true, the loop will end at this position.\n     */\n    get loopEnd() {\n        return this._loopEnd;\n    }\n    set loopEnd(loopEnd) {\n        this._loopEnd = loopEnd;\n        if (this.buffer.loaded) {\n            assertRange(this.toSeconds(loopEnd), 0, this.buffer.duration);\n        }\n        // get the current source\n        this._activeSources.forEach((source) => {\n            source.loopEnd = loopEnd;\n        });\n    }\n    /**\n     * The audio buffer belonging to the player.\n     */\n    get buffer() {\n        return this._buffer;\n    }\n    set buffer(buffer) {\n        this._buffer.set(buffer);\n    }\n    /**\n     * If the buffer should loop once it's over.\n     * @example\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/drum-samples/breakbeat.mp3\").toDestination();\n     * player.loop = true;\n     * player.autostart = true;\n     */\n    get loop() {\n        return this._loop;\n    }\n    set loop(loop) {\n        // if no change, do nothing\n        if (this._loop === loop) {\n            return;\n        }\n        this._loop = loop;\n        // set the loop of all of the sources\n        this._activeSources.forEach((source) => {\n            source.loop = loop;\n        });\n        if (loop) {\n            // remove the next stopEvent\n            const stopEvent = this._state.getNextState(\"stopped\", this.now());\n            if (stopEvent) {\n                this._state.cancel(stopEvent.time);\n            }\n        }\n    }\n    /**\n     * Normal speed is 1. The pitch will change with the playback rate.\n     * @example\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/berklee/femalevoices_aa2_A5.mp3\").toDestination();\n     * // play at 1/4 speed\n     * player.playbackRate = 0.25;\n     * // play as soon as the buffer is loaded\n     * player.autostart = true;\n     */\n    get playbackRate() {\n        return this._playbackRate;\n    }\n    set playbackRate(rate) {\n        this._playbackRate = rate;\n        const now = this.now();\n        // cancel the stop event since it's at a different time now\n        const stopEvent = this._state.getNextState(\"stopped\", now);\n        if (stopEvent && stopEvent.implicitEnd) {\n            this._state.cancel(stopEvent.time);\n            this._activeSources.forEach((source) => source.cancelStop());\n        }\n        // set all the sources\n        this._activeSources.forEach((source) => {\n            source.playbackRate.setValueAtTime(rate, now);\n        });\n    }\n    /**\n     * If the buffer should be reversed. Note that this sets the underlying {@link ToneAudioBuffer.reverse}, so\n     * if multiple players are pointing at the same ToneAudioBuffer, they will all be reversed.\n     * @example\n     * const player = new Tone.Player(\"https://tonejs.github.io/audio/berklee/chime_1.mp3\").toDestination();\n     * player.autostart = true;\n     * player.reverse = true;\n     */\n    get reverse() {\n        return this._buffer.reverse;\n    }\n    set reverse(rev) {\n        this._buffer.reverse = rev;\n    }\n    /**\n     * If the buffer is loaded\n     */\n    get loaded() {\n        return this._buffer.loaded;\n    }\n    dispose() {\n        super.dispose();\n        // disconnect all of the players\n        this._activeSources.forEach((source) => source.dispose());\n        this._activeSources.clear();\n        this._buffer.dispose();\n        return this;\n    }\n}\n__decorate([\n    timeRange(0)\n], Player.prototype, \"fadeIn\", void 0);\n__decorate([\n    timeRange(0)\n], Player.prototype, \"fadeOut\", void 0);\n//# sourceMappingURL=Player.js.map","import { __awaiter, __decorate } from \"tslib\";\nimport { ToneAudioNode, } from \"../../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { isArray, isObject, isString } from \"../../core/util/TypeCheck.js\";\nimport { connectSignal, Signal } from \"../../signal/Signal.js\";\nimport { OfflineContext } from \"../../core/context/OfflineContext.js\";\nimport { assert } from \"../../core/util/Debug.js\";\nimport { range, timeRange } from \"../../core/util/Decorator.js\";\n/**\n * Envelope is an [ADSR](https://en.wikipedia.org/wiki/Synthesizer#ADSR_envelope)\n * envelope generator. Envelope outputs a signal which\n * can be connected to an AudioParam or Tone.Signal.\n * ```\n *           /\\\n *          /  \\\n *         /    \\\n *        /      \\\n *       /        \\___________\n *      /                     \\\n *     /                       \\\n *    /                         \\\n *   /                           \\\n * ```\n * @example\n * return Tone.Offline(() => {\n * \tconst env = new Tone.Envelope({\n * \t\tattack: 0.1,\n * \t\tdecay: 0.2,\n * \t\tsustain: 0.5,\n * \t\trelease: 0.8,\n * \t}).toDestination();\n * \tenv.triggerAttackRelease(0.5);\n * }, 1.5, 1);\n * @category Component\n */\nexport class Envelope extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Envelope.getDefaults(), arguments, [\"attack\", \"decay\", \"sustain\", \"release\"]);\n        super(options);\n        this.name = \"Envelope\";\n        /**\n         * the signal which is output.\n         */\n        this._sig = new Signal({\n            context: this.context,\n            value: 0,\n        });\n        /**\n         * The output signal of the envelope\n         */\n        this.output = this._sig;\n        /**\n         * Envelope has no input\n         */\n        this.input = undefined;\n        this.attack = options.attack;\n        this.decay = options.decay;\n        this.sustain = options.sustain;\n        this.release = options.release;\n        this.attackCurve = options.attackCurve;\n        this.releaseCurve = options.releaseCurve;\n        this.decayCurve = options.decayCurve;\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            attack: 0.01,\n            attackCurve: \"linear\",\n            decay: 0.1,\n            decayCurve: \"exponential\",\n            release: 1,\n            releaseCurve: \"exponential\",\n            sustain: 0.5,\n        });\n    }\n    /**\n     * Read the current value of the envelope. Useful for\n     * synchronizing visual output to the envelope.\n     */\n    get value() {\n        return this.getValueAtTime(this.now());\n    }\n    /**\n     * Get the curve\n     * @param  curve\n     * @param  direction  In/Out\n     * @return The curve name\n     */\n    _getCurve(curve, direction) {\n        if (isString(curve)) {\n            return curve;\n        }\n        else {\n            // look up the name in the curves array\n            let curveName;\n            for (curveName in EnvelopeCurves) {\n                if (EnvelopeCurves[curveName][direction] === curve) {\n                    return curveName;\n                }\n            }\n            // return the custom curve\n            return curve;\n        }\n    }\n    /**\n     * Assign a the curve to the given name using the direction\n     * @param  name\n     * @param  direction In/Out\n     * @param  curve\n     */\n    _setCurve(name, direction, curve) {\n        // check if it's a valid type\n        if (isString(curve) && Reflect.has(EnvelopeCurves, curve)) {\n            const curveDef = EnvelopeCurves[curve];\n            if (isObject(curveDef)) {\n                if (name !== \"_decayCurve\") {\n                    this[name] = curveDef[direction];\n                }\n            }\n            else {\n                this[name] = curveDef;\n            }\n        }\n        else if (isArray(curve) && name !== \"_decayCurve\") {\n            this[name] = curve;\n        }\n        else {\n            throw new Error(\"Envelope: invalid curve: \" + curve);\n        }\n    }\n    /**\n     * The shape of the attack.\n     * Can be any of these strings:\n     * * \"linear\"\n     * * \"exponential\"\n     * * \"sine\"\n     * * \"cosine\"\n     * * \"bounce\"\n     * * \"ripple\"\n     * * \"step\"\n     *\n     * Can also be an array which describes the curve. Values\n     * in the array are evenly subdivided and linearly\n     * interpolated over the duration of the attack.\n     * @example\n     * return Tone.Offline(() => {\n     * \tconst env = new Tone.Envelope(0.4).toDestination();\n     * \tenv.attackCurve = \"linear\";\n     * \tenv.triggerAttack();\n     * }, 1, 1);\n     */\n    get attackCurve() {\n        return this._getCurve(this._attackCurve, \"In\");\n    }\n    set attackCurve(curve) {\n        this._setCurve(\"_attackCurve\", \"In\", curve);\n    }\n    /**\n     * The shape of the release. See the attack curve types.\n     * @example\n     * return Tone.Offline(() => {\n     * \tconst env = new Tone.Envelope({\n     * \t\trelease: 0.8\n     * \t}).toDestination();\n     * \tenv.triggerAttack();\n     * \t// release curve could also be defined by an array\n     * \tenv.releaseCurve = [1, 0.3, 0.4, 0.2, 0.7, 0];\n     * \tenv.triggerRelease(0.2);\n     * }, 1, 1);\n     */\n    get releaseCurve() {\n        return this._getCurve(this._releaseCurve, \"Out\");\n    }\n    set releaseCurve(curve) {\n        this._setCurve(\"_releaseCurve\", \"Out\", curve);\n    }\n    /**\n     * The shape of the decay either \"linear\" or \"exponential\"\n     * @example\n     * return Tone.Offline(() => {\n     * \tconst env = new Tone.Envelope({\n     * \t\tsustain: 0.1,\n     * \t\tdecay: 0.5\n     * \t}).toDestination();\n     * \tenv.decayCurve = \"linear\";\n     * \tenv.triggerAttack();\n     * }, 1, 1);\n     */\n    get decayCurve() {\n        return this._getCurve(this._decayCurve, \"Out\");\n    }\n    set decayCurve(curve) {\n        this._setCurve(\"_decayCurve\", \"Out\", curve);\n    }\n    /**\n     * Trigger the attack/decay portion of the ADSR envelope.\n     * @param  time When the attack should start.\n     * @param velocity The velocity of the envelope scales the vales.\n     *                             number between 0-1\n     * @example\n     * const env = new Tone.AmplitudeEnvelope().toDestination();\n     * const osc = new Tone.Oscillator().connect(env).start();\n     * // trigger the attack 0.5 seconds from now with a velocity of 0.2\n     * env.triggerAttack(\"+0.5\", 0.2);\n     */\n    triggerAttack(time, velocity = 1) {\n        this.log(\"triggerAttack\", time, velocity);\n        time = this.toSeconds(time);\n        const originalAttack = this.toSeconds(this.attack);\n        let attack = originalAttack;\n        const decay = this.toSeconds(this.decay);\n        // check if it's not a complete attack\n        const currentValue = this.getValueAtTime(time);\n        if (currentValue > 0) {\n            // subtract the current value from the attack time\n            const attackRate = 1 / attack;\n            const remainingDistance = 1 - currentValue;\n            // the attack is now the remaining time\n            attack = remainingDistance / attackRate;\n        }\n        // attack\n        if (attack < this.sampleTime) {\n            this._sig.cancelScheduledValues(time);\n            // case where the attack time is 0 should set instantly\n            this._sig.setValueAtTime(velocity, time);\n        }\n        else if (this._attackCurve === \"linear\") {\n            this._sig.linearRampTo(velocity, attack, time);\n        }\n        else if (this._attackCurve === \"exponential\") {\n            this._sig.targetRampTo(velocity, attack, time);\n        }\n        else {\n            this._sig.cancelAndHoldAtTime(time);\n            let curve = this._attackCurve;\n            // find the starting position in the curve\n            for (let i = 1; i < curve.length; i++) {\n                // the starting index is between the two values\n                if (curve[i - 1] <= currentValue && currentValue <= curve[i]) {\n                    curve = this._attackCurve.slice(i);\n                    // the first index is the current value\n                    curve[0] = currentValue;\n                    break;\n                }\n            }\n            this._sig.setValueCurveAtTime(curve, time, attack, velocity);\n        }\n        // decay\n        if (decay && this.sustain < 1) {\n            const decayValue = velocity * this.sustain;\n            const decayStart = time + attack;\n            this.log(\"decay\", decayStart);\n            if (this._decayCurve === \"linear\") {\n                this._sig.linearRampToValueAtTime(decayValue, decay + decayStart);\n            }\n            else {\n                this._sig.exponentialApproachValueAtTime(decayValue, decayStart, decay);\n            }\n        }\n        return this;\n    }\n    /**\n     * Triggers the release of the envelope.\n     * @param  time When the release portion of the envelope should start.\n     * @example\n     * const env = new Tone.AmplitudeEnvelope().toDestination();\n     * const osc = new Tone.Oscillator({\n     * \ttype: \"sawtooth\"\n     * }).connect(env).start();\n     * env.triggerAttack();\n     * // trigger the release half a second after the attack\n     * env.triggerRelease(\"+0.5\");\n     */\n    triggerRelease(time) {\n        this.log(\"triggerRelease\", time);\n        time = this.toSeconds(time);\n        const currentValue = this.getValueAtTime(time);\n        if (currentValue > 0) {\n            const release = this.toSeconds(this.release);\n            if (release < this.sampleTime) {\n                this._sig.setValueAtTime(0, time);\n            }\n            else if (this._releaseCurve === \"linear\") {\n                this._sig.linearRampTo(0, release, time);\n            }\n            else if (this._releaseCurve === \"exponential\") {\n                this._sig.targetRampTo(0, release, time);\n            }\n            else {\n                assert(isArray(this._releaseCurve), \"releaseCurve must be either 'linear', 'exponential' or an array\");\n                this._sig.cancelAndHoldAtTime(time);\n                this._sig.setValueCurveAtTime(this._releaseCurve, time, release, currentValue);\n            }\n        }\n        return this;\n    }\n    /**\n     * Get the scheduled value at the given time. This will\n     * return the unconverted (raw) value.\n     * @example\n     * const env = new Tone.Envelope(0.5, 1, 0.4, 2);\n     * env.triggerAttackRelease(2);\n     * setInterval(() => console.log(env.getValueAtTime(Tone.now())), 100);\n     */\n    getValueAtTime(time) {\n        return this._sig.getValueAtTime(time);\n    }\n    /**\n     * triggerAttackRelease is shorthand for triggerAttack, then waiting\n     * some duration, then triggerRelease.\n     * @param duration The duration of the sustain.\n     * @param time When the attack should be triggered.\n     * @param velocity The velocity of the envelope.\n     * @example\n     * const env = new Tone.AmplitudeEnvelope().toDestination();\n     * const osc = new Tone.Oscillator().connect(env).start();\n     * // trigger the release 0.5 seconds after the attack\n     * env.triggerAttackRelease(0.5);\n     */\n    triggerAttackRelease(duration, time, velocity = 1) {\n        time = this.toSeconds(time);\n        this.triggerAttack(time, velocity);\n        this.triggerRelease(time + this.toSeconds(duration));\n        return this;\n    }\n    /**\n     * Cancels all scheduled envelope changes after the given time.\n     */\n    cancel(after) {\n        this._sig.cancelScheduledValues(this.toSeconds(after));\n        return this;\n    }\n    /**\n     * Connect the envelope to a destination node.\n     */\n    connect(destination, outputNumber = 0, inputNumber = 0) {\n        connectSignal(this, destination, outputNumber, inputNumber);\n        return this;\n    }\n    /**\n     * Render the envelope curve to an array of the given length.\n     * Good for visualizing the envelope curve. Rescales the duration of the\n     * envelope to fit the length.\n     */\n    asArray() {\n        return __awaiter(this, arguments, void 0, function* (length = 1024) {\n            const duration = length / this.context.sampleRate;\n            const context = new OfflineContext(1, duration, this.context.sampleRate);\n            // normalize the ADSR for the given duration with 20% sustain time\n            const attackPortion = this.toSeconds(this.attack) + this.toSeconds(this.decay);\n            const envelopeDuration = attackPortion + this.toSeconds(this.release);\n            const sustainTime = envelopeDuration * 0.1;\n            const totalDuration = envelopeDuration + sustainTime;\n            // @ts-ignore\n            const clone = new this.constructor(Object.assign(this.get(), {\n                attack: (duration * this.toSeconds(this.attack)) / totalDuration,\n                decay: (duration * this.toSeconds(this.decay)) / totalDuration,\n                release: (duration * this.toSeconds(this.release)) / totalDuration,\n                context,\n            }));\n            clone._sig.toDestination();\n            clone.triggerAttackRelease((duration * (attackPortion + sustainTime)) / totalDuration, 0);\n            const buffer = yield context.render();\n            return buffer.getChannelData(0);\n        });\n    }\n    dispose() {\n        super.dispose();\n        this._sig.dispose();\n        return this;\n    }\n}\n__decorate([\n    timeRange(0)\n], Envelope.prototype, \"attack\", void 0);\n__decorate([\n    timeRange(0)\n], Envelope.prototype, \"decay\", void 0);\n__decorate([\n    range(0, 1)\n], Envelope.prototype, \"sustain\", void 0);\n__decorate([\n    timeRange(0)\n], Envelope.prototype, \"release\", void 0);\n/**\n * Generate some complex envelope curves.\n */\nconst EnvelopeCurves = (() => {\n    const curveLen = 128;\n    let i;\n    let k;\n    // cosine curve\n    const cosineCurve = [];\n    for (i = 0; i < curveLen; i++) {\n        cosineCurve[i] = Math.sin((i / (curveLen - 1)) * (Math.PI / 2));\n    }\n    // ripple curve\n    const rippleCurve = [];\n    const rippleCurveFreq = 6.4;\n    for (i = 0; i < curveLen - 1; i++) {\n        k = i / (curveLen - 1);\n        const sineWave = Math.sin(k * (Math.PI * 2) * rippleCurveFreq - Math.PI / 2) + 1;\n        rippleCurve[i] = sineWave / 10 + k * 0.83;\n    }\n    rippleCurve[curveLen - 1] = 1;\n    // stairs curve\n    const stairsCurve = [];\n    const steps = 5;\n    for (i = 0; i < curveLen; i++) {\n        stairsCurve[i] = Math.ceil((i / (curveLen - 1)) * steps) / steps;\n    }\n    // in-out easing curve\n    const sineCurve = [];\n    for (i = 0; i < curveLen; i++) {\n        k = i / (curveLen - 1);\n        sineCurve[i] = 0.5 * (1 - Math.cos(Math.PI * k));\n    }\n    // a bounce curve\n    const bounceCurve = [];\n    for (i = 0; i < curveLen; i++) {\n        k = i / (curveLen - 1);\n        const freq = Math.pow(k, 3) * 4 + 0.2;\n        const val = Math.cos(freq * Math.PI * 2 * k);\n        bounceCurve[i] = Math.abs(val * (1 - k));\n    }\n    /**\n     * Invert a value curve to make it work for the release\n     */\n    function invertCurve(curve) {\n        const out = new Array(curve.length);\n        for (let j = 0; j < curve.length; j++) {\n            out[j] = 1 - curve[j];\n        }\n        return out;\n    }\n    /**\n     * reverse the curve\n     */\n    function reverseCurve(curve) {\n        return curve.slice(0).reverse();\n    }\n    /**\n     * attack and release curve arrays\n     */\n    return {\n        bounce: {\n            In: invertCurve(bounceCurve),\n            Out: bounceCurve,\n        },\n        cosine: {\n            In: cosineCurve,\n            Out: reverseCurve(cosineCurve),\n        },\n        exponential: \"exponential\",\n        linear: \"linear\",\n        ripple: {\n            In: rippleCurve,\n            Out: invertCurve(rippleCurve),\n        },\n        sine: {\n            In: sineCurve,\n            Out: invertCurve(sineCurve),\n        },\n        step: {\n            In: stairsCurve,\n            Out: invertCurve(stairsCurve),\n        },\n    };\n})();\n//# sourceMappingURL=Envelope.js.map","import { Volume } from \"../component/channel/Volume.js\";\nimport { ToneAudioNode, } from \"../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { readOnly } from \"../core/util/Interface.js\";\n/**\n * Base-class for all instruments\n */\nexport class Instrument extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Instrument.getDefaults(), arguments);\n        super(options);\n        /**\n         * Keep track of all events scheduled to the transport\n         * when the instrument is 'synced'\n         */\n        this._scheduledEvents = [];\n        /**\n         * If the instrument is currently synced\n         */\n        this._synced = false;\n        this._original_triggerAttack = this.triggerAttack;\n        this._original_triggerRelease = this.triggerRelease;\n        /**\n         * The release which is scheduled to the timeline.\n         */\n        this._syncedRelease = (time) => this._original_triggerRelease(time);\n        this._volume = this.output = new Volume({\n            context: this.context,\n            volume: options.volume,\n        });\n        this.volume = this._volume.volume;\n        readOnly(this, \"volume\");\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            volume: 0,\n        });\n    }\n    /**\n     * Sync the instrument to the Transport. All subsequent calls of\n     * {@link triggerAttack} and {@link triggerRelease} will be scheduled along the transport.\n     * @example\n     * const fmSynth = new Tone.FMSynth().toDestination();\n     * fmSynth.volume.value = -6;\n     * fmSynth.sync();\n     * // schedule 3 notes when the transport first starts\n     * fmSynth.triggerAttackRelease(\"C4\", \"8n\", 0);\n     * fmSynth.triggerAttackRelease(\"E4\", \"8n\", \"8n\");\n     * fmSynth.triggerAttackRelease(\"G4\", \"8n\", \"4n\");\n     * // start the transport to hear the notes\n     * Tone.Transport.start();\n     */\n    sync() {\n        if (this._syncState()) {\n            this._syncMethod(\"triggerAttack\", 1);\n            this._syncMethod(\"triggerRelease\", 0);\n            this.context.transport.on(\"stop\", this._syncedRelease);\n            this.context.transport.on(\"pause\", this._syncedRelease);\n            this.context.transport.on(\"loopEnd\", this._syncedRelease);\n        }\n        return this;\n    }\n    /**\n     * set _sync\n     */\n    _syncState() {\n        let changed = false;\n        if (!this._synced) {\n            this._synced = true;\n            changed = true;\n        }\n        return changed;\n    }\n    /**\n     * Wrap the given method so that it can be synchronized\n     * @param method Which method to wrap and sync\n     * @param  timePosition What position the time argument appears in\n     */\n    _syncMethod(method, timePosition) {\n        const originalMethod = (this[\"_original_\" + method] = this[method]);\n        this[method] = (...args) => {\n            const time = args[timePosition];\n            const id = this.context.transport.schedule((t) => {\n                args[timePosition] = t;\n                originalMethod.apply(this, args);\n            }, time);\n            this._scheduledEvents.push(id);\n        };\n    }\n    /**\n     * Unsync the instrument from the Transport\n     */\n    unsync() {\n        this._scheduledEvents.forEach((id) => this.context.transport.clear(id));\n        this._scheduledEvents = [];\n        if (this._synced) {\n            this._synced = false;\n            this.triggerAttack = this._original_triggerAttack;\n            this.triggerRelease = this._original_triggerRelease;\n            this.context.transport.off(\"stop\", this._syncedRelease);\n            this.context.transport.off(\"pause\", this._syncedRelease);\n            this.context.transport.off(\"loopEnd\", this._syncedRelease);\n        }\n        return this;\n    }\n    /**\n     * Trigger the attack and then the release after the duration.\n     * @param  note     The note to trigger.\n     * @param  duration How long the note should be held for before\n     *                         triggering the release. This value must be greater than 0.\n     * @param time  When the note should be triggered.\n     * @param  velocity The velocity the note should be triggered at.\n     * @example\n     * const synth = new Tone.Synth().toDestination();\n     * // trigger \"C4\" for the duration of an 8th note\n     * synth.triggerAttackRelease(\"C4\", \"8n\");\n     */\n    triggerAttackRelease(note, duration, time, velocity) {\n        const computedTime = this.toSeconds(time);\n        const computedDuration = this.toSeconds(duration);\n        this.triggerAttack(note, computedTime, velocity);\n        this.triggerRelease(computedTime + computedDuration);\n        return this;\n    }\n    /**\n     * clean up\n     * @returns {Instrument} this\n     */\n    dispose() {\n        super.dispose();\n        this._volume.dispose();\n        this.unsync();\n        this._scheduledEvents = [];\n        return this;\n    }\n}\n//# sourceMappingURL=Instrument.js.map","import { __decorate } from \"tslib\";\nimport { FrequencyClass } from \"../core/type/Frequency.js\";\nimport { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { noOp } from \"../core/util/Interface.js\";\nimport { Instrument } from \"../instrument/Instrument.js\";\nimport { timeRange } from \"../core/util/Decorator.js\";\n/**\n * Abstract base class for other monophonic instruments to extend.\n */\nexport class Monophonic extends Instrument {\n    constructor() {\n        const options = optionsFromArguments(Monophonic.getDefaults(), arguments);\n        super(options);\n        this.portamento = options.portamento;\n        this.onsilence = options.onsilence;\n    }\n    static getDefaults() {\n        return Object.assign(Instrument.getDefaults(), {\n            detune: 0,\n            onsilence: noOp,\n            portamento: 0,\n        });\n    }\n    /**\n     * Trigger the attack of the note optionally with a given velocity.\n     * @param  note The note to trigger.\n     * @param  time When the note should start.\n     * @param  velocity The velocity determines how \"loud\" the note will be.\n     * @example\n     * const synth = new Tone.Synth().toDestination();\n     * // trigger the note a half second from now at half velocity\n     * synth.triggerAttack(\"C4\", \"+0.5\", 0.5);\n     */\n    triggerAttack(note, time, velocity = 1) {\n        this.log(\"triggerAttack\", note, time, velocity);\n        const seconds = this.toSeconds(time);\n        this._triggerEnvelopeAttack(seconds, velocity);\n        this.setNote(note, seconds);\n        return this;\n    }\n    /**\n     * Trigger the release portion of the envelope.\n     * @param  time If no time is given, the release happens immediately.\n     * @example\n     * const synth = new Tone.Synth().toDestination();\n     * synth.triggerAttack(\"C4\");\n     * // trigger the release a second from now\n     * synth.triggerRelease(\"+1\");\n     */\n    triggerRelease(time) {\n        this.log(\"triggerRelease\", time);\n        const seconds = this.toSeconds(time);\n        this._triggerEnvelopeRelease(seconds);\n        return this;\n    }\n    /**\n     * Set the note at the given time. If no time is given, the note\n     * will set immediately.\n     * @param note The note to change to.\n     * @param  time The time when the note should be set.\n     * @example\n     * const synth = new Tone.Synth().toDestination();\n     * synth.triggerAttack(\"C4\");\n     * // change to F#6 in one quarter note from now.\n     * synth.setNote(\"F#6\", \"+4n\");\n     */\n    setNote(note, time) {\n        const computedTime = this.toSeconds(time);\n        const computedFrequency = note instanceof FrequencyClass ? note.toFrequency() : note;\n        if (this.portamento > 0 && this.getLevelAtTime(computedTime) > 0.05) {\n            const portTime = this.toSeconds(this.portamento);\n            this.frequency.exponentialRampTo(computedFrequency, portTime, computedTime);\n        }\n        else {\n            this.frequency.setValueAtTime(computedFrequency, computedTime);\n        }\n        return this;\n    }\n}\n__decorate([\n    timeRange(0)\n], Monophonic.prototype, \"portamento\", void 0);\n//# sourceMappingURL=Monophonic.js.map","import { Gain } from \"../../core/context/Gain.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { Envelope } from \"./Envelope.js\";\n/**\n * AmplitudeEnvelope is a Tone.Envelope connected to a gain node.\n * Unlike Tone.Envelope, which outputs the envelope's value, AmplitudeEnvelope accepts\n * an audio signal as the input and will apply the envelope to the amplitude\n * of the signal.\n * Read more about ADSR Envelopes on [Wikipedia](https://en.wikipedia.org/wiki/Synthesizer#ADSR_envelope).\n *\n * @example\n * return Tone.Offline(() => {\n * \tconst ampEnv = new Tone.AmplitudeEnvelope({\n * \t\tattack: 0.1,\n * \t\tdecay: 0.2,\n * \t\tsustain: 1.0,\n * \t\trelease: 0.8\n * \t}).toDestination();\n * \t// create an oscillator and connect it\n * \tconst osc = new Tone.Oscillator().connect(ampEnv).start();\n * \t// trigger the envelopes attack and release \"8t\" apart\n * \tampEnv.triggerAttackRelease(\"8t\");\n * }, 1.5, 1);\n * @category Component\n */\nexport class AmplitudeEnvelope extends Envelope {\n    constructor() {\n        super(optionsFromArguments(AmplitudeEnvelope.getDefaults(), arguments, [\n            \"attack\",\n            \"decay\",\n            \"sustain\",\n            \"release\",\n        ]));\n        this.name = \"AmplitudeEnvelope\";\n        this._gainNode = new Gain({\n            context: this.context,\n            gain: 0,\n        });\n        this.output = this._gainNode;\n        this.input = this._gainNode;\n        this._sig.connect(this._gainNode.gain);\n        this.output = this._gainNode;\n        this.input = this._gainNode;\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        super.dispose();\n        this._gainNode.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=AmplitudeEnvelope.js.map","import { AmplitudeEnvelope } from \"../component/envelope/AmplitudeEnvelope.js\";\nimport { Envelope } from \"../component/envelope/Envelope.js\";\nimport { ToneAudioNode, } from \"../core/context/ToneAudioNode.js\";\nimport { omitFromObject, optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { readOnly } from \"../core/util/Interface.js\";\nimport { OmniOscillator } from \"../source/oscillator/OmniOscillator.js\";\nimport { Source } from \"../source/Source.js\";\nimport { Monophonic } from \"./Monophonic.js\";\n/**\n * Synth is composed simply of a {@link OmniOscillator} routed through an {@link AmplitudeEnvelope}.\n * ```\n * +----------------+   +-------------------+\n * | OmniOscillator +>--> AmplitudeEnvelope +>--> Output\n * +----------------+   +-------------------+\n * ```\n * @example\n * const synth = new Tone.Synth().toDestination();\n * synth.triggerAttackRelease(\"C4\", \"8n\");\n * @category Instrument\n */\nexport class Synth extends Monophonic {\n    constructor() {\n        const options = optionsFromArguments(Synth.getDefaults(), arguments);\n        super(options);\n        this.name = \"Synth\";\n        this.oscillator = new OmniOscillator(Object.assign({\n            context: this.context,\n            detune: options.detune,\n            onstop: () => this.onsilence(this),\n        }, options.oscillator));\n        this.frequency = this.oscillator.frequency;\n        this.detune = this.oscillator.detune;\n        this.envelope = new AmplitudeEnvelope(Object.assign({\n            context: this.context,\n        }, options.envelope));\n        // connect the oscillators to the output\n        this.oscillator.chain(this.envelope, this.output);\n        readOnly(this, [\"oscillator\", \"frequency\", \"detune\", \"envelope\"]);\n    }\n    static getDefaults() {\n        return Object.assign(Monophonic.getDefaults(), {\n            envelope: Object.assign(omitFromObject(Envelope.getDefaults(), Object.keys(ToneAudioNode.getDefaults())), {\n                attack: 0.005,\n                decay: 0.1,\n                release: 1,\n                sustain: 0.3,\n            }),\n            oscillator: Object.assign(omitFromObject(OmniOscillator.getDefaults(), [\n                ...Object.keys(Source.getDefaults()),\n                \"frequency\",\n                \"detune\",\n            ]), {\n                type: \"triangle\",\n            }),\n        });\n    }\n    /**\n     * start the attack portion of the envelope\n     * @param time the time the attack should start\n     * @param velocity the velocity of the note (0-1)\n     */\n    _triggerEnvelopeAttack(time, velocity) {\n        // the envelopes\n        this.envelope.triggerAttack(time, velocity);\n        this.oscillator.start(time);\n        // if there is no release portion, stop the oscillator\n        if (this.envelope.sustain === 0) {\n            const computedAttack = this.toSeconds(this.envelope.attack);\n            const computedDecay = this.toSeconds(this.envelope.decay);\n            this.oscillator.stop(time + computedAttack + computedDecay);\n        }\n    }\n    /**\n     * start the release portion of the envelope\n     * @param time the time the release should start\n     */\n    _triggerEnvelopeRelease(time) {\n        this.envelope.triggerRelease(time);\n        this.oscillator.stop(time + this.toSeconds(this.envelope.release));\n    }\n    getLevelAtTime(time) {\n        time = this.toSeconds(time);\n        return this.envelope.getValueAtTime(time);\n    }\n    /**\n     * clean up\n     */\n    dispose() {\n        super.dispose();\n        this.oscillator.dispose();\n        this.envelope.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=Synth.js.map","import { __decorate } from \"tslib\";\nimport { FrequencyClass } from \"../core/type/Frequency.js\";\nimport { deepMerge, optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { readOnly } from \"../core/util/Interface.js\";\nimport { Monophonic } from \"./Monophonic.js\";\nimport { Synth } from \"./Synth.js\";\nimport { range, timeRange } from \"../core/util/Decorator.js\";\n/**\n * MembraneSynth makes kick and tom sounds using a single oscillator\n * with an amplitude envelope and frequency ramp. A Tone.OmniOscillator\n * is routed through a Tone.AmplitudeEnvelope to the output. The drum\n * quality of the sound comes from the frequency envelope applied\n * during MembraneSynth.triggerAttack(note). The frequency envelope\n * starts at <code>note * .octaves</code> and ramps to <code>note</code>\n * over the duration of <code>.pitchDecay</code>.\n * @example\n * const synth = new Tone.MembraneSynth().toDestination();\n * synth.triggerAttackRelease(\"C2\", \"8n\");\n * @category Instrument\n */\nexport class MembraneSynth extends Synth {\n    constructor() {\n        const options = optionsFromArguments(MembraneSynth.getDefaults(), arguments);\n        super(options);\n        this.name = \"MembraneSynth\";\n        /**\n         * Portamento is ignored in this synth. use pitch decay instead.\n         */\n        this.portamento = 0;\n        this.pitchDecay = options.pitchDecay;\n        this.octaves = options.octaves;\n        readOnly(this, [\"oscillator\", \"envelope\"]);\n    }\n    static getDefaults() {\n        return deepMerge(Monophonic.getDefaults(), Synth.getDefaults(), {\n            envelope: {\n                attack: 0.001,\n                attackCurve: \"exponential\",\n                decay: 0.4,\n                release: 1.4,\n                sustain: 0.01,\n            },\n            octaves: 10,\n            oscillator: {\n                type: \"sine\",\n            },\n            pitchDecay: 0.05,\n        });\n    }\n    setNote(note, time) {\n        const seconds = this.toSeconds(time);\n        const hertz = this.toFrequency(note instanceof FrequencyClass ? note.toFrequency() : note);\n        const maxNote = hertz * this.octaves;\n        this.oscillator.frequency.setValueAtTime(maxNote, seconds);\n        this.oscillator.frequency.exponentialRampToValueAtTime(hertz, seconds + this.toSeconds(this.pitchDecay));\n        return this;\n    }\n    dispose() {\n        super.dispose();\n        return this;\n    }\n}\n__decorate([\n    range(0)\n], MembraneSynth.prototype, \"octaves\", void 0);\n__decorate([\n    timeRange(0)\n], MembraneSynth.prototype, \"pitchDecay\", void 0);\n//# sourceMappingURL=MembraneSynth.js.map","/**\n * All of the classes or functions which are loaded into the AudioWorkletGlobalScope\n */\nconst workletContext = new Set();\n/**\n * Add a class to the AudioWorkletGlobalScope\n */\nexport function addToWorklet(classOrFunction) {\n    workletContext.add(classOrFunction);\n}\n/**\n * Register a processor in the AudioWorkletGlobalScope with the given name\n */\nexport function registerProcessor(name, classDesc) {\n    const processor = /* javascript */ `registerProcessor(\"${name}\", ${classDesc})`;\n    workletContext.add(processor);\n}\n/**\n * Get all of the modules which have been registered to the AudioWorkletGlobalScope\n */\nexport function getWorkletGlobalScope() {\n    return Array.from(workletContext).join(\"\\n\");\n}\n//# sourceMappingURL=WorkletGlobalScope.js.map","import { addToWorklet } from \"./WorkletGlobalScope.js\";\nconst toneAudioWorkletProcessor = /* javascript */ `\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it's disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === \"dispose\") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n`;\naddToWorklet(toneAudioWorkletProcessor);\n//# sourceMappingURL=ToneAudioWorkletProcessor.worklet.js.map","import \"./ToneAudioWorkletProcessor.worklet.js\";\nimport { addToWorklet } from \"./WorkletGlobalScope.js\";\nexport const singleIOProcess = /* javascript */ `\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n`;\naddToWorklet(singleIOProcess);\n//# sourceMappingURL=SingleIOProcessor.worklet.js.map","import { addToWorklet } from \"./WorkletGlobalScope.js\";\nconst delayLine = /* javascript */ `\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n`;\naddToWorklet(delayLine);\n//# sourceMappingURL=DelayLine.worklet.js.map","import \"../../core/worklet/SingleIOProcessor.worklet.js\";\nimport \"../../core/worklet/DelayLine.worklet.js\";\nimport { registerProcessor } from \"../../core/worklet/WorkletGlobalScope.js\";\nexport const workletName = \"feedback-comb-filter\";\nconst feedbackCombFilter = /* javascript */ `\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"delayTime\",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: \"k-rate\"\n\t\t\t}, {\n\t\t\t\tname: \"feedback\",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: \"k-rate\"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n`;\nregisterProcessor(workletName, feedbackCombFilter);\n//# sourceMappingURL=FeedbackCombFilter.worklet.js.map","import { MidiClass } from \"../core/type/Midi.js\";\nimport { deepMerge, omitFromObject, optionsFromArguments, } from \"../core/util/Defaults.js\";\nimport { isArray, isNumber } from \"../core/util/TypeCheck.js\";\nimport { Instrument } from \"./Instrument.js\";\nimport { Monophonic } from \"./Monophonic.js\";\nimport { Synth } from \"./Synth.js\";\nimport { assert, warn } from \"../core/util/Debug.js\";\n/**\n * PolySynth handles voice creation and allocation for any\n * instruments passed in as the second parameter. PolySynth is\n * not a synthesizer by itself, it merely manages voices of\n * one of the other types of synths, allowing any of the\n * monophonic synthesizers to be polyphonic.\n *\n * @example\n * const synth = new Tone.PolySynth().toDestination();\n * // set the attributes across all the voices using 'set'\n * synth.set({ detune: -1200 });\n * // play a chord\n * synth.triggerAttackRelease([\"C4\", \"E4\", \"A4\"], 1);\n * @category Instrument\n */\nexport class PolySynth extends Instrument {\n    constructor() {\n        const options = optionsFromArguments(PolySynth.getDefaults(), arguments, [\"voice\", \"options\"]);\n        super(options);\n        this.name = \"PolySynth\";\n        /**\n         * The voices which are not currently in use\n         */\n        this._availableVoices = [];\n        /**\n         * The currently active voices\n         */\n        this._activeVoices = [];\n        /**\n         * All of the allocated voices for this synth.\n         */\n        this._voices = [];\n        /**\n         * The GC timeout. Held so that it could be cancelled when the node is disposed.\n         */\n        this._gcTimeout = -1;\n        /**\n         * A moving average of the number of active voices\n         */\n        this._averageActiveVoices = 0;\n        /**\n         * The release which is scheduled to the timeline.\n         */\n        this._syncedRelease = (time) => this.releaseAll(time);\n        // check against the old API (pre 14.3.0)\n        assert(!isNumber(options.voice), \"DEPRECATED: The polyphony count is no longer the first argument.\");\n        const defaults = options.voice.getDefaults();\n        this.options = Object.assign(defaults, options.options);\n        this.voice = options.voice;\n        this.maxPolyphony = options.maxPolyphony;\n        // create the first voice\n        this._dummyVoice = this._getNextAvailableVoice();\n        // remove it from the voices list\n        const index = this._voices.indexOf(this._dummyVoice);\n        this._voices.splice(index, 1);\n        // kick off the GC interval\n        this._gcTimeout = this.context.setInterval(this._collectGarbage.bind(this), 1);\n    }\n    static getDefaults() {\n        return Object.assign(Instrument.getDefaults(), {\n            maxPolyphony: 32,\n            options: {},\n            voice: Synth,\n        });\n    }\n    /**\n     * The number of active voices.\n     */\n    get activeVoices() {\n        return this._activeVoices.length;\n    }\n    /**\n     * Invoked when the source is done making sound, so that it can be\n     * readded to the pool of available voices\n     */\n    _makeVoiceAvailable(voice) {\n        this._availableVoices.push(voice);\n        // remove the midi note from 'active voices'\n        const activeVoiceIndex = this._activeVoices.findIndex((e) => e.voice === voice);\n        this._activeVoices.splice(activeVoiceIndex, 1);\n    }\n    /**\n     * Get an available voice from the pool of available voices.\n     * If one is not available and the maxPolyphony limit is reached,\n     * steal a voice, otherwise return null.\n     */\n    _getNextAvailableVoice() {\n        // if there are available voices, return the first one\n        if (this._availableVoices.length) {\n            return this._availableVoices.shift();\n        }\n        else if (this._voices.length < this.maxPolyphony) {\n            // otherwise if there is still more maxPolyphony, make a new voice\n            const voice = new this.voice(Object.assign(this.options, {\n                context: this.context,\n                onsilence: this._makeVoiceAvailable.bind(this),\n            }));\n            assert(voice instanceof Monophonic, \"Voice must extend Monophonic class\");\n            voice.connect(this.output);\n            this._voices.push(voice);\n            return voice;\n        }\n        else {\n            warn(\"Max polyphony exceeded. Note dropped.\");\n        }\n    }\n    /**\n     * Occasionally check if there are any allocated voices which can be cleaned up.\n     */\n    _collectGarbage() {\n        this._averageActiveVoices = Math.max(this._averageActiveVoices * 0.95, this.activeVoices);\n        if (this._availableVoices.length &&\n            this._voices.length > Math.ceil(this._averageActiveVoices + 1)) {\n            // take off an available note\n            const firstAvail = this._availableVoices.shift();\n            const index = this._voices.indexOf(firstAvail);\n            this._voices.splice(index, 1);\n            if (!this.context.isOffline) {\n                firstAvail.dispose();\n            }\n        }\n    }\n    /**\n     * Internal method which triggers the attack\n     */\n    _triggerAttack(notes, time, velocity) {\n        notes.forEach((note) => {\n            const midiNote = new MidiClass(this.context, note).toMidi();\n            const voice = this._getNextAvailableVoice();\n            if (voice) {\n                voice.triggerAttack(note, time, velocity);\n                this._activeVoices.push({\n                    midi: midiNote,\n                    voice,\n                    released: false,\n                });\n                this.log(\"triggerAttack\", note, time);\n            }\n        });\n    }\n    /**\n     * Internal method which triggers the release\n     */\n    _triggerRelease(notes, time) {\n        notes.forEach((note) => {\n            const midiNote = new MidiClass(this.context, note).toMidi();\n            const event = this._activeVoices.find(({ midi, released }) => midi === midiNote && !released);\n            if (event) {\n                // trigger release on that note\n                event.voice.triggerRelease(time);\n                // mark it as released\n                event.released = true;\n                this.log(\"triggerRelease\", note, time);\n            }\n        });\n    }\n    /**\n     * Schedule the attack/release events. If the time is in the future, then it should set a timeout\n     * to wait for just-in-time scheduling\n     */\n    _scheduleEvent(type, notes, time, velocity) {\n        assert(!this.disposed, \"Synth was already disposed\");\n        // if the notes are greater than this amount of time in the future, they should be scheduled with setTimeout\n        if (time <= this.now()) {\n            // do it immediately\n            if (type === \"attack\") {\n                this._triggerAttack(notes, time, velocity);\n            }\n            else {\n                this._triggerRelease(notes, time);\n            }\n        }\n        else {\n            // schedule it to start in the future\n            this.context.setTimeout(() => {\n                if (!this.disposed) {\n                    this._scheduleEvent(type, notes, time, velocity);\n                }\n            }, time - this.now());\n        }\n    }\n    /**\n     * Trigger the attack portion of the note\n     * @param  notes The notes to play. Accepts a single Frequency or an array of frequencies.\n     * @param  time  The start time of the note.\n     * @param velocity The velocity of the note.\n     * @example\n     * const synth = new Tone.PolySynth(Tone.FMSynth).toDestination();\n     * // trigger a chord immediately with a velocity of 0.2\n     * synth.triggerAttack([\"Ab3\", \"C4\", \"F5\"], Tone.now(), 0.2);\n     */\n    triggerAttack(notes, time, velocity) {\n        if (!Array.isArray(notes)) {\n            notes = [notes];\n        }\n        const computedTime = this.toSeconds(time);\n        this._scheduleEvent(\"attack\", notes, computedTime, velocity);\n        return this;\n    }\n    /**\n     * Trigger the release of the note. Unlike monophonic instruments,\n     * a note (or array of notes) needs to be passed in as the first argument.\n     * @param  notes The notes to play. Accepts a single Frequency or an array of frequencies.\n     * @param  time  When the release will be triggered.\n     * @example\n     * const poly = new Tone.PolySynth(Tone.AMSynth).toDestination();\n     * poly.triggerAttack([\"Ab3\", \"C4\", \"F5\"]);\n     * // trigger the release of the given notes.\n     * poly.triggerRelease([\"Ab3\", \"C4\"], \"+1\");\n     * poly.triggerRelease(\"F5\", \"+3\");\n     */\n    triggerRelease(notes, time) {\n        if (!Array.isArray(notes)) {\n            notes = [notes];\n        }\n        const computedTime = this.toSeconds(time);\n        this._scheduleEvent(\"release\", notes, computedTime);\n        return this;\n    }\n    /**\n     * Trigger the attack and release after the specified duration\n     * @param  notes The notes to play. Accepts a single  Frequency or an array of frequencies.\n     * @param  duration the duration of the note\n     * @param  time  if no time is given, defaults to now\n     * @param  velocity the velocity of the attack (0-1)\n     * @example\n     * const poly = new Tone.PolySynth(Tone.AMSynth).toDestination();\n     * // can pass in an array of durations as well\n     * poly.triggerAttackRelease([\"Eb3\", \"G4\", \"Bb4\", \"D5\"], [4, 3, 2, 1]);\n     */\n    triggerAttackRelease(notes, duration, time, velocity) {\n        const computedTime = this.toSeconds(time);\n        this.triggerAttack(notes, computedTime, velocity);\n        if (isArray(duration)) {\n            assert(isArray(notes), \"If the duration is an array, the notes must also be an array\");\n            notes = notes;\n            for (let i = 0; i < notes.length; i++) {\n                const d = duration[Math.min(i, duration.length - 1)];\n                const durationSeconds = this.toSeconds(d);\n                assert(durationSeconds > 0, \"The duration must be greater than 0\");\n                this.triggerRelease(notes[i], computedTime + durationSeconds);\n            }\n        }\n        else {\n            const durationSeconds = this.toSeconds(duration);\n            assert(durationSeconds > 0, \"The duration must be greater than 0\");\n            this.triggerRelease(notes, computedTime + durationSeconds);\n        }\n        return this;\n    }\n    sync() {\n        if (this._syncState()) {\n            this._syncMethod(\"triggerAttack\", 1);\n            this._syncMethod(\"triggerRelease\", 1);\n            // make sure that the sound doesn't play after its been stopped\n            this.context.transport.on(\"stop\", this._syncedRelease);\n            this.context.transport.on(\"pause\", this._syncedRelease);\n            this.context.transport.on(\"loopEnd\", this._syncedRelease);\n        }\n        return this;\n    }\n    /**\n     * Set a member/attribute of the voices\n     * @example\n     * const poly = new Tone.PolySynth().toDestination();\n     * // set all of the voices using an options object for the synth type\n     * poly.set({\n     * \tenvelope: {\n     * \t\tattack: 0.25\n     * \t}\n     * });\n     * poly.triggerAttackRelease(\"Bb3\", 0.2);\n     */\n    set(options) {\n        // remove options which are controlled by the PolySynth\n        const sanitizedOptions = omitFromObject(options, [\n            \"onsilence\",\n            \"context\",\n        ]);\n        // store all of the options\n        this.options = deepMerge(this.options, sanitizedOptions);\n        this._voices.forEach((voice) => voice.set(sanitizedOptions));\n        this._dummyVoice.set(sanitizedOptions);\n        return this;\n    }\n    get() {\n        return this._dummyVoice.get();\n    }\n    /**\n     * Trigger the release portion of all the currently active voices immediately.\n     * Useful for silencing the synth.\n     */\n    releaseAll(time) {\n        const computedTime = this.toSeconds(time);\n        this._activeVoices.forEach(({ voice }) => {\n            voice.triggerRelease(computedTime);\n        });\n        return this;\n    }\n    dispose() {\n        super.dispose();\n        this._dummyVoice.dispose();\n        this._voices.forEach((v) => v.dispose());\n        this._activeVoices = [];\n        this._availableVoices = [];\n        this.context.clearInterval(this._gcTimeout);\n        return this;\n    }\n}\n//# sourceMappingURL=PolySynth.js.map","import { __decorate } from \"tslib\";\nimport { ToneAudioBuffers } from \"../core/context/ToneAudioBuffers.js\";\nimport { ftomf, intervalToFrequencyRatio } from \"../core/type/Conversions.js\";\nimport { FrequencyClass } from \"../core/type/Frequency.js\";\nimport { optionsFromArguments } from \"../core/util/Defaults.js\";\nimport { noOp } from \"../core/util/Interface.js\";\nimport { isArray, isNote, isNumber } from \"../core/util/TypeCheck.js\";\nimport { Instrument } from \"../instrument/Instrument.js\";\nimport { ToneBufferSource, } from \"../source/buffer/ToneBufferSource.js\";\nimport { timeRange } from \"../core/util/Decorator.js\";\nimport { assert } from \"../core/util/Debug.js\";\n/**\n * Pass in an object which maps the note's pitch or midi value to the url,\n * then you can trigger the attack and release of that note like other instruments.\n * By automatically repitching the samples, it is possible to play pitches which\n * were not explicitly included which can save loading time.\n *\n * For sample or buffer playback where repitching is not necessary,\n * use {@link Player}.\n * @example\n * const sampler = new Tone.Sampler({\n * \turls: {\n * \t\tA1: \"A1.mp3\",\n * \t\tA2: \"A2.mp3\",\n * \t},\n * \tbaseUrl: \"https://tonejs.github.io/audio/casio/\",\n * \tonload: () => {\n * \t\tsampler.triggerAttackRelease([\"C1\", \"E1\", \"G1\", \"B1\"], 0.5);\n * \t}\n * }).toDestination();\n * @category Instrument\n */\nexport class Sampler extends Instrument {\n    constructor() {\n        const options = optionsFromArguments(Sampler.getDefaults(), arguments, [\"urls\", \"onload\", \"baseUrl\"], \"urls\");\n        super(options);\n        this.name = \"Sampler\";\n        /**\n         * The object of all currently playing BufferSources\n         */\n        this._activeSources = new Map();\n        const urlMap = {};\n        Object.keys(options.urls).forEach((note) => {\n            const noteNumber = parseInt(note, 10);\n            assert(isNote(note) || (isNumber(noteNumber) && isFinite(noteNumber)), `url key is neither a note or midi pitch: ${note}`);\n            if (isNote(note)) {\n                // convert the note name to MIDI\n                const mid = new FrequencyClass(this.context, note).toMidi();\n                urlMap[mid] = options.urls[note];\n            }\n            else if (isNumber(noteNumber) && isFinite(noteNumber)) {\n                // otherwise if it's numbers assume it's midi\n                urlMap[noteNumber] = options.urls[noteNumber];\n            }\n        });\n        this._buffers = new ToneAudioBuffers({\n            urls: urlMap,\n            onload: options.onload,\n            baseUrl: options.baseUrl,\n            onerror: options.onerror,\n        });\n        this.attack = options.attack;\n        this.release = options.release;\n        this.curve = options.curve;\n        // invoke the callback if it's already loaded\n        if (this._buffers.loaded) {\n            // invoke onload deferred\n            Promise.resolve().then(options.onload);\n        }\n    }\n    static getDefaults() {\n        return Object.assign(Instrument.getDefaults(), {\n            attack: 0,\n            baseUrl: \"\",\n            curve: \"exponential\",\n            onload: noOp,\n            onerror: noOp,\n            release: 0.1,\n            urls: {},\n        });\n    }\n    /**\n     * Returns the difference in steps between the given midi note at the closets sample.\n     */\n    _findClosest(midi) {\n        // searches within 8 octaves of the given midi note\n        const MAX_INTERVAL = 96;\n        let interval = 0;\n        while (interval < MAX_INTERVAL) {\n            // check above and below\n            if (this._buffers.has(midi + interval)) {\n                return -interval;\n            }\n            else if (this._buffers.has(midi - interval)) {\n                return interval;\n            }\n            interval++;\n        }\n        throw new Error(`No available buffers for note: ${midi}`);\n    }\n    /**\n     * @param  notes\tThe note to play, or an array of notes.\n     * @param  time     When to play the note\n     * @param  velocity The velocity to play the sample back.\n     */\n    triggerAttack(notes, time, velocity = 1) {\n        this.log(\"triggerAttack\", notes, time, velocity);\n        if (!Array.isArray(notes)) {\n            notes = [notes];\n        }\n        notes.forEach((note) => {\n            const midiFloat = ftomf(new FrequencyClass(this.context, note).toFrequency());\n            const midi = Math.round(midiFloat);\n            const remainder = midiFloat - midi;\n            // find the closest note pitch\n            const difference = this._findClosest(midi);\n            const closestNote = midi - difference;\n            const buffer = this._buffers.get(closestNote);\n            const playbackRate = intervalToFrequencyRatio(difference + remainder);\n            // play that note\n            const source = new ToneBufferSource({\n                url: buffer,\n                context: this.context,\n                curve: this.curve,\n                fadeIn: this.attack,\n                fadeOut: this.release,\n                playbackRate,\n            }).connect(this.output);\n            source.start(time, 0, buffer.duration / playbackRate, velocity);\n            // add it to the active sources\n            if (!isArray(this._activeSources.get(midi))) {\n                this._activeSources.set(midi, []);\n            }\n            this._activeSources.get(midi).push(source);\n            // remove it when it's done\n            source.onended = () => {\n                if (this._activeSources && this._activeSources.has(midi)) {\n                    const sources = this._activeSources.get(midi);\n                    const index = sources.indexOf(source);\n                    if (index !== -1) {\n                        sources.splice(index, 1);\n                    }\n                }\n            };\n        });\n        return this;\n    }\n    /**\n     * @param  notes\tThe note to release, or an array of notes.\n     * @param  time     \tWhen to release the note.\n     */\n    triggerRelease(notes, time) {\n        this.log(\"triggerRelease\", notes, time);\n        if (!Array.isArray(notes)) {\n            notes = [notes];\n        }\n        notes.forEach((note) => {\n            const midi = new FrequencyClass(this.context, note).toMidi();\n            // find the note\n            if (this._activeSources.has(midi) &&\n                this._activeSources.get(midi).length) {\n                const sources = this._activeSources.get(midi);\n                time = this.toSeconds(time);\n                sources.forEach((source) => {\n                    source.stop(time);\n                });\n                this._activeSources.set(midi, []);\n            }\n        });\n        return this;\n    }\n    /**\n     * Release all currently active notes.\n     * @param  time     \tWhen to release the notes.\n     */\n    releaseAll(time) {\n        const computedTime = this.toSeconds(time);\n        this._activeSources.forEach((sources) => {\n            while (sources.length) {\n                const source = sources.shift();\n                source.stop(computedTime);\n            }\n        });\n        return this;\n    }\n    sync() {\n        if (this._syncState()) {\n            this._syncMethod(\"triggerAttack\", 1);\n            this._syncMethod(\"triggerRelease\", 1);\n        }\n        return this;\n    }\n    /**\n     * Invoke the attack phase, then after the duration, invoke the release.\n     * @param  notes\tThe note to play and release, or an array of notes.\n     * @param  duration The time the note should be held\n     * @param  time     When to start the attack\n     * @param  velocity The velocity of the attack\n     */\n    triggerAttackRelease(notes, duration, time, velocity = 1) {\n        const computedTime = this.toSeconds(time);\n        this.triggerAttack(notes, computedTime, velocity);\n        if (isArray(duration)) {\n            assert(isArray(notes), \"notes must be an array when duration is array\");\n            notes.forEach((note, index) => {\n                const d = duration[Math.min(index, duration.length - 1)];\n                this.triggerRelease(note, computedTime + this.toSeconds(d));\n            });\n        }\n        else {\n            this.triggerRelease(notes, computedTime + this.toSeconds(duration));\n        }\n        return this;\n    }\n    /**\n     * Add a note to the sampler.\n     * @param  note      The buffer's pitch.\n     * @param  url  Either the url of the buffer, or a buffer which will be added with the given name.\n     * @param  callback  The callback to invoke when the url is loaded.\n     */\n    add(note, url, callback) {\n        assert(isNote(note) || isFinite(note), `note must be a pitch or midi: ${note}`);\n        if (isNote(note)) {\n            // convert the note name to MIDI\n            const mid = new FrequencyClass(this.context, note).toMidi();\n            this._buffers.add(mid, url, callback);\n        }\n        else {\n            // otherwise if it's numbers assume it's midi\n            this._buffers.add(note, url, callback);\n        }\n        return this;\n    }\n    /**\n     * If the buffers are loaded or not\n     */\n    get loaded() {\n        return this._buffers.loaded;\n    }\n    /**\n     * Clean up\n     */\n    dispose() {\n        super.dispose();\n        this._buffers.dispose();\n        this._activeSources.forEach((sources) => {\n            sources.forEach((source) => source.dispose());\n        });\n        this._activeSources.clear();\n        return this;\n    }\n}\n__decorate([\n    timeRange(0)\n], Sampler.prototype, \"attack\", void 0);\n__decorate([\n    timeRange(0)\n], Sampler.prototype, \"release\", void 0);\n//# sourceMappingURL=Sampler.js.map","import { Param } from \"../../core/context/Param.js\";\nimport { ToneAudioNode, } from \"../../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\n/**\n * Panner is an equal power Left/Right Panner. It is a wrapper around the StereoPannerNode.\n * @example\n * return Tone.Offline(() => {\n * // move the input signal from right to left\n * \tconst panner = new Tone.Panner(1).toDestination();\n * \tpanner.pan.rampTo(-1, 0.5);\n * \tconst osc = new Tone.Oscillator(100).connect(panner).start();\n * }, 0.5, 2);\n * @category Component\n */\nexport class Panner extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Panner.getDefaults(), arguments, [\n            \"pan\",\n        ]);\n        super(options);\n        this.name = \"Panner\";\n        /**\n         * the panner node\n         */\n        this._panner = this.context.createStereoPanner();\n        this.input = this._panner;\n        this.output = this._panner;\n        this.pan = new Param({\n            context: this.context,\n            param: this._panner.pan,\n            value: options.pan,\n            minValue: -1,\n            maxValue: 1,\n        });\n        // this is necessary for standardized-audio-context\n        // doesn't make any difference for the native AudioContext\n        // https://github.com/chrisguttandin/standardized-audio-context/issues/647\n        this._panner.channelCount = options.channelCount;\n        this._panner.channelCountMode = \"explicit\";\n        // initial value\n        readOnly(this, \"pan\");\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            pan: 0,\n            channelCount: 1,\n        });\n    }\n    dispose() {\n        super.dispose();\n        this._panner.disconnect();\n        this.pan.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=Panner.js.map","import \"../core/worklet/SingleIOProcessor.worklet.js\";\nimport { registerProcessor } from \"../core/worklet/WorkletGlobalScope.js\";\nexport const workletName = \"bit-crusher\";\nexport const bitCrusherWorklet = /* javascript */ `\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n`;\nregisterProcessor(workletName, bitCrusherWorklet);\n//# sourceMappingURL=BitCrusher.worklet.js.map","import { ToneAudioNode, } from \"../../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\n/**\n * Split splits an incoming signal into the number of given channels.\n *\n * @example\n * const split = new Tone.Split();\n * // stereoSignal.connect(split);\n * @category Component\n */\nexport class Split extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Split.getDefaults(), arguments, [\n            \"channels\",\n        ]);\n        super(options);\n        this.name = \"Split\";\n        this._splitter =\n            this.input =\n                this.output =\n                    this.context.createChannelSplitter(options.channels);\n        this._internalChannels = [this._splitter];\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            channels: 2,\n        });\n    }\n    dispose() {\n        super.dispose();\n        this._splitter.disconnect();\n        return this;\n    }\n}\n//# sourceMappingURL=Split.js.map","import { ToneAudioNode, } from \"../../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { Split } from \"../channel/Split.js\";\nimport { Gain } from \"../../core/context/Gain.js\";\nimport { assert, assertRange } from \"../../core/util/Debug.js\";\n/**\n * Wrapper around the native Web Audio's [AnalyserNode](http://webaudio.github.io/web-audio-api/#idl-def-AnalyserNode).\n * Extracts FFT or Waveform data from the incoming signal.\n * @category Component\n */\nexport class Analyser extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Analyser.getDefaults(), arguments, [\"type\", \"size\"]);\n        super(options);\n        this.name = \"Analyser\";\n        /**\n         * The analyser node.\n         */\n        this._analysers = [];\n        /**\n         * The buffer that the FFT data is written to\n         */\n        this._buffers = [];\n        this.input =\n            this.output =\n                this._gain =\n                    new Gain({ context: this.context });\n        this._split = new Split({\n            context: this.context,\n            channels: options.channels,\n        });\n        this.input.connect(this._split);\n        assertRange(options.channels, 1);\n        // create the analysers\n        for (let channel = 0; channel < options.channels; channel++) {\n            this._analysers[channel] = this.context.createAnalyser();\n            this._split.connect(this._analysers[channel], channel, 0);\n        }\n        // set the values initially\n        this.size = options.size;\n        this.type = options.type;\n        this.smoothing = options.smoothing;\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            size: 1024,\n            smoothing: 0.8,\n            type: \"fft\",\n            channels: 1,\n        });\n    }\n    /**\n     * Run the analysis given the current settings. If {@link channels} = 1,\n     * it will return a Float32Array. If {@link channels} > 1, it will\n     * return an array of Float32Arrays where each index in the array\n     * represents the analysis done on a channel.\n     */\n    getValue() {\n        this._analysers.forEach((analyser, index) => {\n            const buffer = this._buffers[index];\n            if (this._type === \"fft\") {\n                analyser.getFloatFrequencyData(buffer);\n            }\n            else if (this._type === \"waveform\") {\n                analyser.getFloatTimeDomainData(buffer);\n            }\n        });\n        if (this.channels === 1) {\n            return this._buffers[0];\n        }\n        else {\n            return this._buffers;\n        }\n    }\n    /**\n     * The size of analysis. This must be a power of two in the range 16 to 16384.\n     */\n    get size() {\n        return this._analysers[0].frequencyBinCount;\n    }\n    set size(size) {\n        this._analysers.forEach((analyser, index) => {\n            analyser.fftSize = size * 2;\n            this._buffers[index] = new Float32Array(size);\n        });\n    }\n    /**\n     * The number of channels the analyser does the analysis on. Channel\n     * separation is done using {@link Split}\n     */\n    get channels() {\n        return this._analysers.length;\n    }\n    /**\n     * The analysis function returned by analyser.getValue(), either \"fft\" or \"waveform\".\n     */\n    get type() {\n        return this._type;\n    }\n    set type(type) {\n        assert(type === \"waveform\" || type === \"fft\", `Analyser: invalid type: ${type}`);\n        this._type = type;\n    }\n    /**\n     * 0 represents no time averaging with the last analysis frame.\n     */\n    get smoothing() {\n        return this._analysers[0].smoothingTimeConstant;\n    }\n    set smoothing(val) {\n        this._analysers.forEach((a) => (a.smoothingTimeConstant = val));\n    }\n    /**\n     * Clean up.\n     */\n    dispose() {\n        super.dispose();\n        this._analysers.forEach((a) => a.disconnect());\n        this._split.dispose();\n        this._gain.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=Analyser.js.map","import { Gain } from \"../../core/context/Gain.js\";\nimport { ToneAudioNode, } from \"../../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\n/**\n * Solo lets you isolate a specific audio stream. When an instance is set to `solo=true`,\n * it will mute all other instances of Solo.\n * @example\n * const soloA = new Tone.Solo().toDestination();\n * const oscA = new Tone.Oscillator(\"C4\", \"sawtooth\").connect(soloA);\n * const soloB = new Tone.Solo().toDestination();\n * const oscB = new Tone.Oscillator(\"E4\", \"square\").connect(soloB);\n * soloA.solo = true;\n * // no audio will pass through soloB\n * @category Component\n */\nexport class Solo extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Solo.getDefaults(), arguments, [\n            \"solo\",\n        ]);\n        super(options);\n        this.name = \"Solo\";\n        this.input = this.output = new Gain({\n            context: this.context,\n        });\n        if (!Solo._allSolos.has(this.context)) {\n            Solo._allSolos.set(this.context, new Set());\n        }\n        Solo._allSolos.get(this.context).add(this);\n        // set initially\n        this.solo = options.solo;\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            solo: false,\n        });\n    }\n    /**\n     * Isolates this instance and mutes all other instances of Solo.\n     * Only one instance can be soloed at a time. A soloed\n     * instance will report `solo=false` when another instance is soloed.\n     */\n    get solo() {\n        return this._isSoloed();\n    }\n    set solo(solo) {\n        if (solo) {\n            this._addSolo();\n        }\n        else {\n            this._removeSolo();\n        }\n        Solo._allSolos.get(this.context).forEach((instance) => instance._updateSolo());\n    }\n    /**\n     * If the current instance is muted, i.e. another instance is soloed\n     */\n    get muted() {\n        return this.input.gain.value === 0;\n    }\n    /**\n     * Add this to the soloed array\n     */\n    _addSolo() {\n        if (!Solo._soloed.has(this.context)) {\n            Solo._soloed.set(this.context, new Set());\n        }\n        Solo._soloed.get(this.context).add(this);\n    }\n    /**\n     * Remove this from the soloed array\n     */\n    _removeSolo() {\n        if (Solo._soloed.has(this.context)) {\n            Solo._soloed.get(this.context).delete(this);\n        }\n    }\n    /**\n     * Is this on the soloed array\n     */\n    _isSoloed() {\n        return (Solo._soloed.has(this.context) &&\n            Solo._soloed.get(this.context).has(this));\n    }\n    /**\n     * Returns true if no one is soloed\n     */\n    _noSolos() {\n        // either does not have any soloed added\n        return (!Solo._soloed.has(this.context) ||\n            // or has a solo set but doesn't include any items\n            (Solo._soloed.has(this.context) &&\n                Solo._soloed.get(this.context).size === 0));\n    }\n    /**\n     * Solo the current instance and unsolo all other instances.\n     */\n    _updateSolo() {\n        if (this._isSoloed()) {\n            this.input.gain.value = 1;\n        }\n        else if (this._noSolos()) {\n            // no one is soloed\n            this.input.gain.value = 1;\n        }\n        else {\n            this.input.gain.value = 0;\n        }\n    }\n    dispose() {\n        super.dispose();\n        Solo._allSolos.get(this.context).delete(this);\n        this._removeSolo();\n        return this;\n    }\n}\n/**\n * Hold all of the solo'ed tracks belonging to a specific context\n */\nSolo._allSolos = new Map();\n/**\n * Hold the currently solo'ed instance(s)\n */\nSolo._soloed = new Map();\n//# sourceMappingURL=Solo.js.map","import { readOnly } from \"../../core/util/Interface.js\";\nimport { ToneAudioNode, } from \"../../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { Panner } from \"./Panner.js\";\nimport { Volume } from \"./Volume.js\";\n/**\n * PanVol is a Tone.Panner and Tone.Volume in one.\n * @example\n * // pan the incoming signal left and drop the volume\n * const panVol = new Tone.PanVol(-0.25, -12).toDestination();\n * const osc = new Tone.Oscillator().connect(panVol).start();\n * @category Component\n */\nexport class PanVol extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(PanVol.getDefaults(), arguments, [\n            \"pan\",\n            \"volume\",\n        ]);\n        super(options);\n        this.name = \"PanVol\";\n        this._panner = this.input = new Panner({\n            context: this.context,\n            pan: options.pan,\n            channelCount: options.channelCount,\n        });\n        this.pan = this._panner.pan;\n        this._volume = this.output = new Volume({\n            context: this.context,\n            volume: options.volume,\n        });\n        this.volume = this._volume.volume;\n        // connections\n        this._panner.connect(this._volume);\n        this.mute = options.mute;\n        readOnly(this, [\"pan\", \"volume\"]);\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            mute: false,\n            pan: 0,\n            volume: 0,\n            channelCount: 1,\n        });\n    }\n    /**\n     * Mute/unmute the volume\n     */\n    get mute() {\n        return this._volume.mute;\n    }\n    set mute(mute) {\n        this._volume.mute = mute;\n    }\n    dispose() {\n        super.dispose();\n        this._panner.dispose();\n        this.pan.dispose();\n        this._volume.dispose();\n        this.volume.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=PanVol.js.map","import { ToneAudioNode, } from \"../../core/context/ToneAudioNode.js\";\nimport { optionsFromArguments } from \"../../core/util/Defaults.js\";\nimport { Solo } from \"./Solo.js\";\nimport { PanVol } from \"./PanVol.js\";\nimport { readOnly } from \"../../core/util/Interface.js\";\nimport { Gain } from \"../../core/context/Gain.js\";\n/**\n * Channel provides a channel strip interface with volume, pan, solo and mute controls.\n * @see {@link PanVol} and {@link Solo}\n * @example\n * // pan the incoming signal left and drop the volume 12db\n * const channel = new Tone.Channel(-0.25, -12);\n * @category Component\n */\nexport class Channel extends ToneAudioNode {\n    constructor() {\n        const options = optionsFromArguments(Channel.getDefaults(), arguments, [\n            \"volume\",\n            \"pan\",\n        ]);\n        super(options);\n        this.name = \"Channel\";\n        this._solo = this.input = new Solo({\n            solo: options.solo,\n            context: this.context,\n        });\n        this._panVol = this.output = new PanVol({\n            context: this.context,\n            pan: options.pan,\n            volume: options.volume,\n            mute: options.mute,\n            channelCount: options.channelCount,\n        });\n        this.pan = this._panVol.pan;\n        this.volume = this._panVol.volume;\n        this._solo.connect(this._panVol);\n        readOnly(this, [\"pan\", \"volume\"]);\n    }\n    static getDefaults() {\n        return Object.assign(ToneAudioNode.getDefaults(), {\n            pan: 0,\n            volume: 0,\n            mute: false,\n            solo: false,\n            channelCount: 1,\n        });\n    }\n    /**\n     * Solo/unsolo the channel. Soloing is only relative to other {@link Channel}s and {@link Solo} instances\n     */\n    get solo() {\n        return this._solo.solo;\n    }\n    set solo(solo) {\n        this._solo.solo = solo;\n    }\n    /**\n     * If the current instance is muted, i.e. another instance is soloed,\n     * or the channel is muted\n     */\n    get muted() {\n        return this._solo.muted || this.mute;\n    }\n    /**\n     * Mute/unmute the volume\n     */\n    get mute() {\n        return this._panVol.mute;\n    }\n    set mute(mute) {\n        this._panVol.mute = mute;\n    }\n    /**\n     * Get the gain node belonging to the bus name. Create it if\n     * it doesn't exist\n     * @param name The bus name\n     */\n    _getBus(name) {\n        if (!Channel.buses.has(name)) {\n            Channel.buses.set(name, new Gain({ context: this.context }));\n        }\n        return Channel.buses.get(name);\n    }\n    /**\n     * Send audio to another channel using a string. `send` is a lot like\n     * {@link connect}, except it uses a string instead of an object. This can\n     * be useful in large applications to decouple sections since {@link send}\n     * and {@link receive} can be invoked separately in order to connect an object\n     * @param name The channel name to send the audio\n     * @param volume The amount of the signal to send.\n     * \tDefaults to 0db, i.e. send the entire signal\n     * @returns Returns the gain node of this connection.\n     */\n    send(name, volume = 0) {\n        const bus = this._getBus(name);\n        const sendKnob = new Gain({\n            context: this.context,\n            units: \"decibels\",\n            gain: volume,\n        });\n        this.connect(sendKnob);\n        sendKnob.connect(bus);\n        return sendKnob;\n    }\n    /**\n     * Receive audio from a channel which was connected with {@link send}.\n     * @param name The channel name to receive audio from.\n     */\n    receive(name) {\n        const bus = this._getBus(name);\n        bus.connect(this);\n        return this;\n    }\n    dispose() {\n        super.dispose();\n        this._panVol.dispose();\n        this.pan.dispose();\n        this.volume.dispose();\n        this._solo.dispose();\n        return this;\n    }\n}\n/**\n * Store the send/receive channels by name.\n */\nChannel.buses = new Map();\n//# sourceMappingURL=Channel.js.map","export { getContext, setContext } from \"./core/Global.js\";\nexport * from \"./classes.js\";\nexport * from \"./version.js\";\nimport { getContext } from \"./core/Global.js\";\nimport { ToneAudioBuffer } from \"./core/context/ToneAudioBuffer.js\";\nexport { start } from \"./core/Global.js\";\nexport { supported } from \"./core/context/AudioContext.js\";\n/**\n * The current audio context time of the global {@link BaseContext}.\n * @see {@link Context.now}\n * @category Core\n */\nexport function now() {\n    return getContext().now();\n}\n/**\n * The current audio context time of the global {@link Context} without the {@link Context.lookAhead}\n * @see {@link Context.immediate}\n * @category Core\n */\nexport function immediate() {\n    return getContext().immediate();\n}\n/**\n * The Transport object belonging to the global Tone.js Context.\n * @see {@link TransportClass}\n * @category Core\n * @deprecated Use {@link getTransport} instead\n */\nexport const Transport = getContext().transport;\n/**\n * The Transport object belonging to the global Tone.js Context.\n * @see {@link TransportClass}\n * @category Core\n */\nexport function getTransport() {\n    return getContext().transport;\n}\n/**\n * The Destination (output) belonging to the global Tone.js Context.\n * @see {@link DestinationClass}\n * @category Core\n * @deprecated Use {@link getDestination} instead\n */\nexport const Destination = getContext().destination;\n/**\n * @deprecated Use {@link getDestination} instead\n */\nexport const Master = getContext().destination;\n/**\n * The Destination (output) belonging to the global Tone.js Context.\n * @see {@link DestinationClass}\n * @category Core\n */\nexport function getDestination() {\n    return getContext().destination;\n}\n/**\n * The {@link ListenerClass} belonging to the global Tone.js Context.\n * @category Core\n * @deprecated Use {@link getListener} instead\n */\nexport const Listener = getContext().listener;\n/**\n * The {@link ListenerClass} belonging to the global Tone.js Context.\n * @category Core\n */\nexport function getListener() {\n    return getContext().listener;\n}\n/**\n * Draw is used to synchronize the draw frame with the Transport's callbacks.\n * @see {@link DrawClass}\n * @category Core\n * @deprecated Use {@link getDraw} instead\n */\nexport const Draw = getContext().draw;\n/**\n * Get the singleton attached to the global context.\n * Draw is used to synchronize the draw frame with the Transport's callbacks.\n * @see {@link DrawClass}\n * @category Core\n */\nexport function getDraw() {\n    return getContext().draw;\n}\n/**\n * A reference to the global context\n * @see {@link Context}\n * @deprecated Use {@link getContext} instead\n */\nexport const context = getContext();\n/**\n * Promise which resolves when all of the loading promises are resolved.\n * Alias for static {@link ToneAudioBuffer.loaded} method.\n * @category Core\n */\nexport function loaded() {\n    return ToneAudioBuffer.loaded();\n}\n// this fills in name changes from 13.x to 14.x\nimport { ToneAudioBuffers } from \"./core/context/ToneAudioBuffers.js\";\nimport { ToneBufferSource } from \"./source/buffer/ToneBufferSource.js\";\n/** @deprecated Use {@link ToneAudioBuffer} */\nexport const Buffer = ToneAudioBuffer;\n/** @deprecated Use {@link ToneAudioBuffers} */\nexport const Buffers = ToneAudioBuffers;\n/** @deprecated Use {@link ToneBufferSource} */\nexport const BufferSource = ToneBufferSource;\n//# sourceMappingURL=index.js.map","/**\r\n * Feedback Collector\r\n *\r\n * Collects and analyzes user performance data for Note Highway playback.\r\n * Tracks pitch input samples and calculates accuracy metrics.\r\n */\r\n\r\nimport type {\r\n  FeedbackCollectorConfig,\r\n  FeedbackCollectorInstance,\r\n  HighwayTargetNote,\r\n  NotePerformance,\r\n  PitchSample,\r\n} from './types.js';\r\n\r\n// ============================================================================\r\n// Default Configuration\r\n// ============================================================================\r\n\r\nconst DEFAULT_CONFIG: FeedbackCollectorConfig = {\r\n  onsetToleranceMs: 100,\r\n  releaseToleranceMs: 150,\r\n  pitchToleranceCents: 50,\r\n  hitThreshold: 70, // 70% of note duration with correct pitch\r\n  accuracyTiers: {\r\n    perfect: { onsetMs: 30, pitchCents: 10, coverage: 95 },\r\n    good: { onsetMs: 75, pitchCents: 25, coverage: 85 },\r\n    okay: { onsetMs: 150, pitchCents: 50, coverage: 70 },\r\n  },\r\n};\r\n\r\n// ============================================================================\r\n// Active Note Tracking\r\n// ============================================================================\r\n\r\ninterface ActiveNoteData {\r\n  note: HighwayTargetNote;\r\n  samples: PitchSample[];\r\n  onsetSample: PitchSample | null;\r\n  releaseSample: PitchSample | null;\r\n  startedAt: number;\r\n}\r\n\r\n// ============================================================================\r\n// Factory Function\r\n// ============================================================================\r\n\r\n/**\r\n * Create a feedback collector instance.\r\n */\r\nexport function createFeedbackCollector(\r\n  config: Partial<FeedbackCollectorConfig> = {}\r\n): FeedbackCollectorInstance {\r\n  const finalConfig: FeedbackCollectorConfig = {\r\n    ...DEFAULT_CONFIG,\r\n    ...config,\r\n    accuracyTiers: config.accuracyTiers\r\n      ? {\r\n          ...DEFAULT_CONFIG.accuracyTiers,\r\n          ...config.accuracyTiers,\r\n        }\r\n      : DEFAULT_CONFIG.accuracyTiers,\r\n  };\r\n\r\n  // Active notes being tracked\r\n  const activeNotes = new Map<string, ActiveNoteData>();\r\n\r\n  // Completed performances\r\n  const performances = new Map<string, NotePerformance>();\r\n\r\n  // ============================================================================\r\n  // Helper Functions\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Calculate pitch deviation in cents between two MIDI values.\r\n   */\r\n  function calculateCentDeviation(actualMidi: number, targetMidi: number): number {\r\n    return (actualMidi - targetMidi) * 100;\r\n  }\r\n\r\n  /**\r\n   * Check if a pitch sample matches the target note within tolerance.\r\n   */\r\n  function isPitchCorrect(sample: PitchSample, targetMidi: number): boolean {\r\n    const deviation = Math.abs(calculateCentDeviation(sample.midi, targetMidi));\r\n    return deviation <= finalConfig.pitchToleranceCents;\r\n  }\r\n\r\n  /**\r\n   * Calculate average pitch deviation from all samples.\r\n   */\r\n  function calculateAveragePitchDeviation(\r\n    samples: PitchSample[],\r\n    targetMidi: number\r\n  ): number {\r\n    if (samples.length === 0) return 0;\r\n\r\n    const totalDeviation = samples.reduce((sum, sample) => {\r\n      return sum + Math.abs(calculateCentDeviation(sample.midi, targetMidi));\r\n    }, 0);\r\n\r\n    return totalDeviation / samples.length;\r\n  }\r\n\r\n  /**\r\n   * Calculate percentage of note duration with correct pitch.\r\n   */\r\n  function calculatePitchCoverage(\r\n    samples: PitchSample[],\r\n    targetMidi: number,\r\n    noteStartMs: number,\r\n    noteDurationMs: number\r\n  ): number {\r\n    if (samples.length === 0) return 0;\r\n\r\n    const correctSamples = samples.filter(s => isPitchCorrect(s, targetMidi));\r\n    if (correctSamples.length === 0) return 0;\r\n\r\n    // Calculate time coverage based on sample timestamps\n    let coveredMs = 0;\n    for (let i = 0; i < correctSamples.length; i++) {\n      const sample = correctSamples[i];\n      if (!sample) {\n        continue;\n      }\n      const nextSample = correctSamples[i + 1];\n\r\n      if (nextSample) {\r\n        coveredMs += nextSample.timeMs - sample.timeMs;\r\n      } else {\r\n        // Assume last sample covers until note end or next sample time\r\n        const endTime = noteStartMs + noteDurationMs;\r\n        const sampleDuration = Math.min(50, endTime - sample.timeMs); // Max 50ms per sample\r\n        coveredMs += sampleDuration;\r\n      }\r\n    }\r\n\r\n    return (coveredMs / noteDurationMs) * 100;\r\n  }\r\n\r\n  /**\r\n   * Determine accuracy tier based on performance metrics.\r\n   */\r\n  function determineAccuracyTier(\r\n    onsetAccuracyMs: number,\r\n    pitchAccuracyCents: number,\r\n    pitchCoverage: number\r\n  ): string {\r\n    const tiers = finalConfig.accuracyTiers;\r\n    if (!tiers) return 'okay';\r\n\r\n    const absOnset = Math.abs(onsetAccuracyMs);\r\n\r\n    if (\r\n      absOnset <= tiers.perfect.onsetMs &&\r\n      pitchAccuracyCents <= tiers.perfect.pitchCents &&\r\n      pitchCoverage >= tiers.perfect.coverage\r\n    ) {\r\n      return 'perfect';\r\n    }\r\n\r\n    if (\r\n      absOnset <= tiers.good.onsetMs &&\r\n      pitchAccuracyCents <= tiers.good.pitchCents &&\r\n      pitchCoverage >= tiers.good.coverage\r\n    ) {\r\n      return 'good';\r\n    }\r\n\r\n    if (\r\n      absOnset <= tiers.okay.onsetMs &&\r\n      pitchAccuracyCents <= tiers.okay.pitchCents &&\r\n      pitchCoverage >= tiers.okay.coverage\r\n    ) {\r\n      return 'okay';\r\n    }\r\n\r\n    return 'miss';\r\n  }\r\n\r\n  /**\r\n   * Analyze performance for a completed note.\r\n   */\r\n  function analyzePerformance(noteData: ActiveNoteData): NotePerformance {\r\n    const { note, samples, onsetSample, releaseSample } = noteData;\r\n\r\n    // Calculate onset accuracy\r\n    let onsetAccuracyMs = 0;\r\n    if (onsetSample) {\r\n      onsetAccuracyMs = onsetSample.timeMs - note.startTimeMs;\r\n    } else {\r\n      // No onset detected - use tolerance as penalty\r\n      onsetAccuracyMs = finalConfig.onsetToleranceMs * 2;\r\n    }\r\n\r\n    // Calculate release accuracy\r\n    let releaseAccuracyMs = 0;\r\n    const noteEndMs = note.startTimeMs + note.durationMs;\r\n    if (releaseSample) {\r\n      releaseAccuracyMs = releaseSample.timeMs - noteEndMs;\r\n    } else {\r\n      // No release detected\r\n      releaseAccuracyMs = finalConfig.releaseToleranceMs * 2;\r\n    }\r\n\r\n    // Calculate pitch accuracy\r\n    const pitchAccuracyCents = calculateAveragePitchDeviation(samples, note.midi);\r\n\r\n    // Calculate pitch coverage\r\n    const pitchCoverage = calculatePitchCoverage(\r\n      samples,\r\n      note.midi,\r\n      note.startTimeMs,\r\n      note.durationMs\r\n    );\r\n\r\n    // Determine hit status\r\n    const onsetOk = Math.abs(onsetAccuracyMs) <= finalConfig.onsetToleranceMs;\r\n    const releaseOk = Math.abs(releaseAccuracyMs) <= finalConfig.releaseToleranceMs;\r\n    const pitchOk = pitchCoverage >= finalConfig.hitThreshold;\r\n    const hitStatus = onsetOk && releaseOk && pitchOk ? 'hit' : 'miss';\r\n\r\n    // Determine accuracy tier\r\n    const accuracyTier = determineAccuracyTier(\r\n      onsetAccuracyMs,\r\n      pitchAccuracyCents,\r\n      pitchCoverage\r\n    );\r\n\r\n    return {\r\n      hitStatus,\r\n      onsetAccuracyMs,\r\n      releaseAccuracyMs,\r\n      pitchAccuracyCents,\r\n      pitchCoverage,\r\n      pitchSamples: [...samples],\r\n      accuracyTier,\r\n    };\r\n  }\r\n\r\n  // ============================================================================\r\n  // Public API\r\n  // ============================================================================\r\n\r\n  const instance: FeedbackCollectorInstance = {\r\n    startNote(noteId: string, note: HighwayTargetNote): void {\r\n      activeNotes.set(noteId, {\r\n        note,\r\n        samples: [],\r\n        onsetSample: null,\r\n        releaseSample: null,\r\n        startedAt: performance.now(),\r\n      });\r\n    },\r\n\r\n    recordPitchSample(sample: PitchSample): void {\r\n      // Add sample to all active notes that it might belong to\r\n      for (const [noteId, noteData] of activeNotes) {\r\n        const { note } = noteData;\r\n        const noteEndMs = note.startTimeMs + note.durationMs;\r\n        const onsetWindow = finalConfig.onsetToleranceMs;\r\n        const releaseWindow = finalConfig.releaseToleranceMs;\r\n\r\n        // Check if sample is within note window (with tolerance)\r\n        if (\r\n          sample.timeMs >= note.startTimeMs - onsetWindow &&\r\n          sample.timeMs <= noteEndMs + releaseWindow\r\n        ) {\r\n          noteData.samples.push(sample);\r\n\r\n          // Track onset sample (first correct pitch near note start)\r\n          if (\r\n            !noteData.onsetSample &&\r\n            sample.timeMs >= note.startTimeMs - onsetWindow &&\r\n            sample.timeMs <= note.startTimeMs + onsetWindow &&\r\n            isPitchCorrect(sample, note.midi)\r\n          ) {\r\n            noteData.onsetSample = sample;\r\n          }\r\n\r\n          // Track release sample (last sample near note end)\r\n          if (\r\n            sample.timeMs >= noteEndMs - releaseWindow &&\r\n            sample.timeMs <= noteEndMs + releaseWindow\r\n          ) {\r\n            noteData.releaseSample = sample;\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    endNote(noteId: string): NotePerformance | null {\r\n      const noteData = activeNotes.get(noteId);\r\n      if (!noteData) return null;\r\n\r\n      const performance = analyzePerformance(noteData);\r\n      performances.set(noteId, performance);\r\n      activeNotes.delete(noteId);\r\n\r\n      return performance;\r\n    },\r\n\r\n    getCurrentPerformance(noteId: string): Partial<NotePerformance> | null {\r\n      const noteData = activeNotes.get(noteId);\r\n      if (!noteData) return null;\r\n\r\n      // Provide partial performance data before note ends\r\n      const { note, samples, onsetSample } = noteData;\r\n\r\n      let onsetAccuracyMs = 0;\r\n      if (onsetSample) {\r\n        onsetAccuracyMs = onsetSample.timeMs - note.startTimeMs;\r\n      }\r\n\r\n      const pitchAccuracyCents = calculateAveragePitchDeviation(samples, note.midi);\r\n      const pitchCoverage = calculatePitchCoverage(\r\n        samples,\r\n        note.midi,\r\n        note.startTimeMs,\r\n        note.durationMs\r\n      );\r\n\r\n      return {\r\n        onsetAccuracyMs,\r\n        pitchAccuracyCents,\r\n        pitchCoverage,\r\n        pitchSamples: [...samples],\r\n      };\r\n    },\r\n\r\n    getAllPerformances(): Map<string, NotePerformance> {\r\n      return new Map(performances);\r\n    },\r\n\r\n    reset(): void {\r\n      activeNotes.clear();\r\n      performances.clear();\r\n    },\r\n\r\n    dispose(): void {\r\n      activeNotes.clear();\r\n      performances.clear();\r\n    },\r\n  };\r\n\r\n  return instance;\r\n}\r\n","/**\r\n * Note Highway Service\r\n *\r\n * Framework-agnostic service for Note Highway playback mode where grids scroll\r\n * westward (right-to-left) while a static judgment line remains fixed.\r\n */\r\n\r\nimport { createFeedbackCollector } from './feedbackCollector.js';\r\nimport type {\r\n  NoteHighwayConfig,\r\n  NoteHighwayServiceInstance,\r\n  NoteHighwayState,\r\n  HighwayTargetNote,\r\n  InputSource,\r\n  PitchSample,\r\n  NotePerformance,\r\n  FeedbackCollectorInstance,\r\n} from './types.js';\r\n\r\n// ============================================================================\r\n// Default Configuration\r\n// ============================================================================\r\n\r\nconst DEFAULT_CONFIG: Partial<NoteHighwayConfig> = {\r\n  judgmentLinePosition: 0.12,\r\n  pixelsPerSecond: 200,\r\n  lookAheadMs: 3000,\r\n  scrollMode: 'constant-speed',\r\n  leadInBeats: 4,\r\n  playMetronomeDuringOnramp: true,\r\n  playTargetNotes: true,\r\n  playMetronome: false,\r\n  inputSources: ['microphone'],\r\n  feedbackConfig: {\r\n    onsetToleranceMs: 100,\r\n    releaseToleranceMs: 150,\r\n    pitchToleranceCents: 50,\r\n    hitThreshold: 70,\r\n  },\r\n};\r\n\r\n// ============================================================================\r\n// Factory Function\r\n// ============================================================================\r\n\r\n/**\r\n * Create a Note Highway service instance.\r\n */\r\nexport function createNoteHighwayService(\r\n  config: NoteHighwayConfig\r\n): NoteHighwayServiceInstance {\r\n  const finalConfig: NoteHighwayConfig = {\r\n    ...DEFAULT_CONFIG,\r\n    ...config,\r\n    feedbackConfig: {\r\n      ...DEFAULT_CONFIG.feedbackConfig!,\r\n      ...config.feedbackConfig,\r\n    },\r\n  };\r\n\r\n  const { stateCallbacks, eventCallbacks, visualCallbacks, logger } = finalConfig;\r\n\r\n  // Internal state\r\n  const state: NoteHighwayState = {\r\n    isPlaying: false,\r\n    isPaused: false,\r\n    currentTimeMs: 0,\r\n    scrollOffset: 0,\r\n    onrampComplete: false,\r\n    targetNotes: [],\r\n    activeNotes: new Set(),\r\n    startTime: null,\r\n  };\r\n\r\n  // Feedback collector\r\n  const feedbackCollector = createFeedbackCollector(finalConfig.feedbackConfig);\r\n\r\n  // Animation frame ID\r\n  let animationFrameId: number | null = null;\r\n\r\n  // Track which notes have entered/exited judgment window\r\n  const notesInWindow = new Set<string>();\r\n\r\n  // ============================================================================\r\n  // Helper Functions\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Calculate the onramp duration in milliseconds.\r\n   */\r\n  function getOnrampDurationMs(): number {\r\n    const tempo = stateCallbacks.getTempo();\r\n    const beatDurationMs = (60 / tempo) * 1000;\r\n    return finalConfig.leadInBeats * beatDurationMs;\r\n  }\r\n\r\n  /**\r\n   * Calculate judgment line X position in pixels.\r\n   */\r\n  function getJudgmentLineX(): number {\r\n    const viewportWidth = stateCallbacks.getViewportWidth();\r\n    return viewportWidth * finalConfig.judgmentLinePosition;\r\n  }\r\n\r\n  /**\r\n   * Calculate scroll offset from current time.\r\n   */\r\n  function calculateScrollOffset(timeMs: number): number {\r\n    const pixelsPerMs = finalConfig.pixelsPerSecond / 1000;\r\n    const judgmentLineX = getJudgmentLineX();\r\n\r\n    // In constant-speed mode, scroll offset moves linearly with time\r\n    // Offset starts negative during onramp\r\n    const onrampDurationMs = getOnrampDurationMs();\r\n    const adjustedTimeMs = timeMs + onrampDurationMs;\r\n\r\n    return (adjustedTimeMs * pixelsPerMs) - judgmentLineX;\r\n  }\r\n\r\n  /**\r\n   * Check if a note is within the judgment window.\r\n   */\r\n  function isNoteInJudgmentWindow(note: HighwayTargetNote): boolean {\r\n    const judgmentLineX = getJudgmentLineX();\r\n    const cellWidth = stateCallbacks.getCellWidth();\r\n\r\n    // Calculate note X positions\r\n    const noteStartX = (note.startColumn * cellWidth) - state.scrollOffset;\r\n    const noteEndX = (note.endColumn * cellWidth) - state.scrollOffset;\r\n\r\n    // Judgment window: within tolerance of judgment line\r\n    const windowToleranceMs = finalConfig.feedbackConfig.onsetToleranceMs;\r\n    const windowTolerancePx = (windowToleranceMs / 1000) * finalConfig.pixelsPerSecond;\r\n\r\n    return (\r\n      noteStartX <= judgmentLineX + windowTolerancePx &&\r\n      noteEndX >= judgmentLineX - windowTolerancePx\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Update active notes based on current time.\r\n   */\r\n  function updateActiveNotes(): void {\r\n    const currentActiveNotes = new Set<string>();\r\n\r\n    for (const note of state.targetNotes) {\r\n      const noteEndMs = note.startTimeMs + note.durationMs;\r\n\r\n      // Note is active if current time is within its duration (with tolerance)\r\n      const tolerance = finalConfig.feedbackConfig.onsetToleranceMs;\r\n      if (\r\n        state.currentTimeMs >= note.startTimeMs - tolerance &&\r\n        state.currentTimeMs <= noteEndMs + tolerance\r\n      ) {\r\n        currentActiveNotes.add(note.id);\r\n\r\n        // Start tracking if just became active\r\n        if (!state.activeNotes.has(note.id)) {\r\n          feedbackCollector.startNote(note.id, note);\r\n          logger?.debug('NoteHighway', `Note ${note.id} became active`, { note });\r\n        }\r\n      } else if (state.activeNotes.has(note.id)) {\r\n        // Note just became inactive - end tracking\r\n        const performance = feedbackCollector.endNote(note.id);\r\n        if (performance) {\r\n          // Update note with performance data\r\n          note.performance = performance;\r\n\r\n          // Emit event\r\n          const eventData = { noteId: note.id, note, performance };\r\n          if (performance.hitStatus === 'hit') {\r\n            eventCallbacks.emit('noteHit', eventData);\r\n            visualCallbacks?.onNoteHit?.(note.id, performance.accuracyTier || 'okay');\r\n            logger?.info('NoteHighway', `Note hit: ${note.id}`, performance);\r\n          } else {\r\n            eventCallbacks.emit('noteMissed', eventData);\r\n            visualCallbacks?.onNoteMiss?.(note.id);\r\n            logger?.info('NoteHighway', `Note missed: ${note.id}`, performance);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    state.activeNotes = currentActiveNotes;\r\n  }\r\n\r\n  /**\r\n   * Update notes in judgment window for visual feedback.\r\n   */\r\n  function updateJudgmentWindow(): void {\r\n    for (const note of state.targetNotes) {\r\n      const inWindow = isNoteInJudgmentWindow(note);\r\n      const wasInWindow = notesInWindow.has(note.id);\r\n\r\n      if (inWindow && !wasInWindow) {\r\n        notesInWindow.add(note.id);\r\n        eventCallbacks.emit('noteEntered', { noteId: note.id, note });\r\n      } else if (!inWindow && wasInWindow) {\r\n        notesInWindow.delete(note.id);\r\n        eventCallbacks.emit('noteExited', { noteId: note.id, note });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update onramp state and countdown.\r\n   */\r\n  function updateOnramp(): void {\r\n    if (state.onrampComplete) return;\r\n\r\n    if (state.currentTimeMs >= 0) {\r\n      state.onrampComplete = true;\r\n      eventCallbacks.emit('onrampComplete');\r\n      visualCallbacks?.clearOnrampCountdown?.();\r\n      logger?.info('NoteHighway', 'Onramp complete', null);\r\n    } else {\r\n      // Calculate beats remaining in onramp\r\n      const tempo = stateCallbacks.getTempo();\r\n      const beatDurationMs = (60 / tempo) * 1000;\r\n      const msRemaining = Math.abs(state.currentTimeMs);\r\n      const beatsRemaining = Math.ceil(msRemaining / beatDurationMs);\r\n\r\n      visualCallbacks?.updateOnrampCountdown?.(beatsRemaining);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Animation loop for updating state.\r\n   */\r\n  function animate(): void {\r\n    if (!state.isPlaying || state.isPaused || !state.startTime) {\r\n      animationFrameId = null;\r\n      return;\r\n    }\r\n\r\n    const now = performance.now();\r\n    const onrampDurationMs = getOnrampDurationMs();\r\n\r\n    // Calculate current time (can be negative during onramp)\r\n    state.currentTimeMs = (now - state.startTime) - onrampDurationMs;\r\n\r\n    // Update scroll offset\r\n    state.scrollOffset = calculateScrollOffset(state.currentTimeMs);\r\n\r\n    // Update onramp\r\n    updateOnramp();\r\n\r\n    // Update active notes\r\n    updateActiveNotes();\r\n\r\n    // Update judgment window\r\n    updateJudgmentWindow();\r\n\r\n    // Continue animation\r\n    animationFrameId = requestAnimationFrame(animate);\r\n  }\r\n\r\n  /**\r\n   * Start the animation loop.\r\n   */\r\n  function startAnimation(): void {\r\n    if (animationFrameId) return;\r\n    animationFrameId = requestAnimationFrame(animate);\r\n  }\r\n\r\n  /**\r\n   * Stop the animation loop.\r\n   */\r\n  function stopAnimation(): void {\r\n    if (animationFrameId) {\r\n      cancelAnimationFrame(animationFrameId);\r\n      animationFrameId = null;\r\n    }\r\n  }\r\n\r\n  // ============================================================================\r\n  // Public API\r\n  // ============================================================================\r\n\r\n  const instance: NoteHighwayServiceInstance = {\r\n    init(notes: HighwayTargetNote[]): void {\r\n      state.targetNotes = notes;\r\n      logger?.info('NoteHighway', `Initialized with ${notes.length} notes`, null);\r\n    },\r\n\r\n    start(): void {\r\n      if (state.isPlaying) return;\r\n\r\n      state.isPlaying = true;\r\n      state.isPaused = false;\r\n      state.currentTimeMs = -getOnrampDurationMs(); // Start in onramp\r\n      state.scrollOffset = calculateScrollOffset(state.currentTimeMs);\r\n      state.onrampComplete = false;\r\n      state.activeNotes.clear();\r\n      state.startTime = performance.now();\r\n\r\n      notesInWindow.clear();\r\n      feedbackCollector.reset();\r\n\r\n      startAnimation();\r\n      eventCallbacks.emit('playbackStarted');\r\n      logger?.info('NoteHighway', 'Playback started', { onrampDurationMs: getOnrampDurationMs() });\r\n    },\r\n\r\n    pause(): void {\r\n      if (!state.isPlaying || state.isPaused) return;\r\n\r\n      state.isPaused = true;\r\n      stopAnimation();\r\n      eventCallbacks.emit('playbackPaused');\r\n      logger?.info('NoteHighway', 'Playback paused', { currentTimeMs: state.currentTimeMs });\r\n    },\r\n\r\n    resume(): void {\r\n      if (!state.isPlaying || !state.isPaused || !state.startTime) return;\r\n\r\n      // Adjust start time to account for paused duration\r\n      const pausedDuration = performance.now() - (state.startTime + state.currentTimeMs + getOnrampDurationMs());\r\n      state.startTime += pausedDuration;\r\n\r\n      state.isPaused = false;\r\n      startAnimation();\r\n      eventCallbacks.emit('playbackResumed');\r\n      logger?.info('NoteHighway', 'Playback resumed', null);\r\n    },\r\n\r\n    stop(): void {\r\n      if (!state.isPlaying) return;\r\n\r\n      state.isPlaying = false;\r\n      state.isPaused = false;\r\n      state.currentTimeMs = 0;\r\n      state.scrollOffset = 0;\r\n      state.onrampComplete = false;\r\n      state.activeNotes.clear();\r\n      state.startTime = null;\r\n\r\n      notesInWindow.clear();\r\n      stopAnimation();\r\n      visualCallbacks?.clearCanvas?.();\r\n      visualCallbacks?.clearOnrampCountdown?.();\r\n      eventCallbacks.emit('playbackStopped');\r\n\r\n      // Check if all notes have been evaluated\r\n      const allEvaluated = state.targetNotes.every(n => n.performance !== undefined);\r\n      if (allEvaluated) {\r\n        eventCallbacks.emit('performanceComplete');\r\n      }\r\n\r\n      logger?.info('NoteHighway', 'Playback stopped', null);\r\n    },\r\n\r\n    setScrollOffset(timeMs: number): void {\r\n      state.currentTimeMs = timeMs;\r\n      state.scrollOffset = calculateScrollOffset(timeMs);\r\n\r\n      if (state.isPlaying) {\r\n        // Adjust start time to sync with new position\r\n        const onrampDurationMs = getOnrampDurationMs();\r\n        state.startTime = performance.now() - (timeMs + onrampDurationMs);\r\n      }\r\n\r\n      logger?.debug('NoteHighway', 'Scroll offset set', { timeMs, scrollOffset: state.scrollOffset });\r\n    },\r\n\r\n    recordPitchInput(midi: number, clarity: number, source: InputSource): void {\r\n      if (!state.isPlaying || state.isPaused) return;\r\n      if (!finalConfig.inputSources.includes(source)) return;\r\n\r\n      const sample: PitchSample = {\r\n        timeMs: state.currentTimeMs,\r\n        midi,\r\n        clarity,\r\n        source,\r\n      };\r\n\r\n      feedbackCollector.recordPitchSample(sample);\r\n    },\r\n\r\n    getState(): Readonly<NoteHighwayState> {\r\n      return state;\r\n    },\r\n\r\n    getVisibleNotes(): HighwayTargetNote[] {\r\n      const judgmentLineX = getJudgmentLineX();\r\n      const viewportWidth = stateCallbacks.getViewportWidth();\r\n      const cellWidth = stateCallbacks.getCellWidth();\r\n\r\n      return state.targetNotes.filter(note => {\r\n        const noteStartX = (note.startColumn * cellWidth) - state.scrollOffset;\r\n        const noteEndX = (note.endColumn * cellWidth) - state.scrollOffset;\r\n\r\n        // Note is visible if any part is on screen\r\n        return noteEndX >= 0 && noteStartX <= viewportWidth;\r\n      });\r\n    },\r\n\r\n    getPerformanceResults(): Map<string, NotePerformance> {\r\n      return feedbackCollector.getAllPerformances();\r\n    },\r\n\r\n    getFeedbackCollector(): FeedbackCollectorInstance {\r\n      return feedbackCollector;\r\n    },\r\n\r\n    dispose(): void {\r\n      stopAnimation();\r\n      feedbackCollector.dispose();\r\n      state.targetNotes = [];\r\n      state.activeNotes.clear();\r\n      notesInWindow.clear();\r\n      logger?.info('NoteHighway', 'Service disposed', null);\r\n    },\r\n  };\r\n\r\n  return instance;\r\n}\r\n","/**\n * Highway State Store - Svelte 5 Runes\n *\n * State for the \"Guitar Hero\" note highway visualization mode.\n * Now uses the @mlt/student-notation-engine highway service.\n */\n\nimport {\n  createNoteHighwayService,\n  type NoteHighwayServiceInstance,\n  type HighwayTargetNote,\n  type NotePerformance,\n} from '@mlt/student-notation-engine';\n\nexport interface TargetNote {\n  midi: number;\n  startTimeMs: number;\n  durationMs: number;\n  hit?: boolean;\n  lyric?: string; // For emoji/text display on notes\n}\n\nexport interface HighwayState {\n  isPlaying: boolean;\n  startTime: number | null;\n  currentTimeMs: number;\n  targetNotes: TargetNote[];\n  nowLineX: number;\n  pixelsPerSecond: number;\n  timeWindowMs: number;\n}\n\nconst DEFAULT_STATE: HighwayState = {\n  isPlaying: false,\n  startTime: null,\n  currentTimeMs: 0,\n  targetNotes: [],\n  nowLineX: 100, // Position of the \"now\" line from left edge\n  pixelsPerSecond: 200,\n  timeWindowMs: 4000,\n};\n\nfunction createHighwayState() {\n  let state = $state<HighwayState>({ ...DEFAULT_STATE });\n  let engineService: NoteHighwayServiceInstance | null = null;\n  let animationFrameId: number | null = null;\n  let performanceCompleteCallback: ((results: Map<string, NotePerformance>) => void) | null = null;\n\n  // Convert local TargetNote to engine HighwayTargetNote\n  function convertToEngineFormat(notes: TargetNote[]): HighwayTargetNote[] {\n    return notes.map((note, index) => ({\n      id: `target-${index}`,\n      midi: note.midi,\n      startTimeMs: note.startTimeMs,\n      durationMs: note.durationMs,\n      startColumn: 0, // Not used in target notes mode\n      endColumn: 0,   // Not used in target notes mode\n      color: '#3b82f6',\n      shape: 'oval' as const,\n      globalRow: 0,\n    }));\n  }\n\n  // Sync engine state to local state\n  function syncEngineState() {\n    if (!engineService) return;\n\n    const engineState = engineService.getState();\n    state.isPlaying = engineState.isPlaying && !engineState.isPaused;\n    state.currentTimeMs = engineState.currentTimeMs;\n\n    // Update hit status from engine performance\n    const performances = engineService.getPerformanceResults();\n    state.targetNotes = state.targetNotes.map((note, index) => {\n      const noteId = `target-${index}`;\n      const perf = performances.get(noteId);\n      return {\n        ...note,\n        hit: perf?.hitStatus === 'hit',\n      };\n    });\n  }\n\n  // Animation loop to sync state\n  function animate() {\n    if (state.isPlaying && engineService) {\n      syncEngineState();\n      animationFrameId = requestAnimationFrame(animate);\n    } else {\n      animationFrameId = null;\n    }\n  }\n\n  function initializeEngine() {\n    if (engineService) {\n      engineService.dispose();\n    }\n\n    // Create engine service with minimal config\n    engineService = createNoteHighwayService({\n      judgmentLinePosition: state.nowLineX / 800, // Assume 800px viewport\n      pixelsPerSecond: state.pixelsPerSecond,\n      lookAheadMs: state.timeWindowMs,\n      scrollMode: 'constant-speed',\n      leadInBeats: 0, // No onramp for singing trainer\n      playMetronomeDuringOnramp: false,\n      playTargetNotes: false,\n      playMetronome: false,\n      inputSources: ['microphone'],\n      feedbackConfig: {\n        onsetToleranceMs: 100,\n        releaseToleranceMs: 150,\n        pitchToleranceCents: 50,\n        hitThreshold: 70,\n      },\n      stateCallbacks: {\n        getTempo: () => 120,\n        getCellWidth: () => 20,\n        getViewportWidth: () => 800,\n      },\n      eventCallbacks: {\n        emit: (event, data) => {\n          // Log highway events for debugging\n          console.debug('[Highway]', event, data);\n\n          // Handle specific events with visual feedback (placeholder for Phase 6)\n          if (event === 'noteHit') {\n            const hitData = data as { noteId: string; note: any; performance: any };\n            console.log(\n              `[Highway] Note HIT: ${hitData.noteId}, accuracy: ${hitData.performance.accuracyTier || 'unknown'}`\n            );\n            // TODO Phase 6: Trigger visual effects (glow, particles, emboldening)\n          } else if (event === 'noteMissed') {\n            const missData = data as { noteId: string; note: any; performance: any };\n            console.log(`[Highway] Note MISSED: ${missData.noteId}`);\n            // TODO Phase 6: Trigger visual effects (fade, shake, miss indicator)\n          } else if (event === 'onrampComplete') {\n            console.log('[Highway] Onramp complete, playback starting!');\n          } else if (event === 'performanceComplete') {\n            console.log('[Highway] Performance complete!');\n            // Trigger callback with results\n            if (performanceCompleteCallback && engineService) {\n              performanceCompleteCallback(engineService.getPerformanceResults());\n            }\n          }\n        },\n      },\n    });\n\n    // Initialize with target notes\n    const engineNotes = convertToEngineFormat(state.targetNotes);\n    engineService.init(engineNotes);\n  }\n\n  return {\n    get state() {\n      return state;\n    },\n\n    get engineService() {\n      return engineService;\n    },\n\n    start() {\n      if (!engineService && state.targetNotes.length > 0) {\n        initializeEngine();\n      }\n\n      if (engineService) {\n        engineService.start();\n        state.isPlaying = true;\n        state.startTime = performance.now();\n        state.currentTimeMs = 0;\n        animate();\n      }\n    },\n\n    stop() {\n      if (engineService) {\n        engineService.stop();\n      }\n      state.isPlaying = false;\n      if (animationFrameId !== null) {\n        cancelAnimationFrame(animationFrameId);\n        animationFrameId = null;\n      }\n    },\n\n    pause() {\n      if (engineService) {\n        engineService.pause();\n      }\n      state.isPlaying = false;\n      if (animationFrameId !== null) {\n        cancelAnimationFrame(animationFrameId);\n        animationFrameId = null;\n      }\n    },\n\n    resume() {\n      if (engineService) {\n        engineService.resume();\n        state.isPlaying = true;\n        animate();\n      }\n    },\n\n    setTargetNotes(notes: TargetNote[]) {\n      state.targetNotes = notes;\n\n      // Reinitialize engine if it exists\n      if (engineService) {\n        const engineNotes = convertToEngineFormat(notes);\n        engineService.init(engineNotes);\n      }\n    },\n\n    markNoteHit(noteIndex: number) {\n      if (noteIndex >= 0 && noteIndex < state.targetNotes.length) {\n        state.targetNotes = state.targetNotes.map((note, i) =>\n          i === noteIndex ? { ...note, hit: true } : note\n        );\n      }\n    },\n\n    setNowLineX(x: number) {\n      state.nowLineX = x;\n    },\n\n    setPixelsPerSecond(pps: number) {\n      state.pixelsPerSecond = pps;\n    },\n\n    setTimeWindowMs(ms: number) {\n      state.timeWindowMs = ms;\n    },\n\n    recordPitchInput(midi: number, clarity: number) {\n      if (engineService && state.isPlaying) {\n        engineService.recordPitchInput(midi, clarity, 'microphone');\n      }\n    },\n\n    getPerformanceResults(): Map<string, NotePerformance> {\n      return engineService?.getPerformanceResults() ?? new Map();\n    },\n\n    /**\n     * Set current time externally (for YouTube sync)\n     */\n    setCurrentTime(timeMs: number) {\n      state.currentTimeMs = timeMs;\n      if (engineService) {\n        engineService.setScrollOffset(timeMs);\n      }\n    },\n\n    /**\n     * Register callback for performance complete event\n     */\n    onPerformanceComplete(callback: (results: Map<string, NotePerformance>) => void): () => void {\n      performanceCompleteCallback = callback;\n      return () => {\n        performanceCompleteCallback = null;\n      };\n    },\n\n    reset() {\n      if (animationFrameId !== null) {\n        cancelAnimationFrame(animationFrameId);\n        animationFrameId = null;\n      }\n      if (engineService) {\n        engineService.dispose();\n        engineService = null;\n      }\n      state = { ...DEFAULT_STATE };\n    },\n  };\n}\n\nexport const highwayState = createHighwayState();\n","/**\r\n * Demo Exercise State Store - Svelte 5 Runes\r\n *\r\n * Manages the pitch-matching demo exercise with reference tones and graded user input.\r\n */\r\n\r\nimport type { NotePerformance } from '@mlt/student-notation-engine';\r\nimport type { TargetNote } from './highwayState.svelte.js';\r\n\r\nexport interface ExerciseConfig {\r\n  numLoops: number;\r\n  minMidi: number;\r\n  maxMidi: number;\r\n  tempo: number;\r\n  referenceVolume: number; // dB, -60 to 0\r\n}\r\n\r\nexport type ExercisePhase = 'reference' | 'rest1' | 'input' | 'rest2';\r\n\r\nexport interface ExerciseState {\r\n  isActive: boolean;\r\n  isPlaying: boolean;\r\n  config: ExerciseConfig;\r\n  currentLoop: number;\r\n  currentPhase: ExercisePhase;\r\n  currentPitch: number | null;\r\n  generatedNotes: TargetNote[];\r\n  results: ExerciseResult[];\r\n}\r\n\r\nexport interface ExerciseResult {\r\n  loopIndex: number;\r\n  targetPitch: number;\r\n  performance: NotePerformance | null;\r\n  accuracy: number; // 0-100%\r\n}\r\n\r\nconst DEFAULT_CONFIG: ExerciseConfig = {\r\n  numLoops: 5,\r\n  minMidi: 48, // Will be overridden with Y-axis range\r\n  maxMidi: 72,\r\n  tempo: 108,\r\n  referenceVolume: -12, // -12 dB default\r\n};\r\n\r\nconst DEFAULT_STATE: ExerciseState = {\r\n  isActive: false,\r\n  isPlaying: false,\r\n  config: { ...DEFAULT_CONFIG },\r\n  currentLoop: 0,\r\n  currentPhase: 'reference',\r\n  currentPitch: null,\r\n  generatedNotes: [],\r\n  results: [],\r\n};\r\n\r\n/**\r\n * Generate a random MIDI pitch within range\r\n */\r\nfunction randomPitch(minMidi: number, maxMidi: number): number {\r\n  return Math.floor(Math.random() * (maxMidi - minMidi + 1)) + minMidi;\r\n}\r\n\r\n/**\r\n * Calculate microbeat duration in milliseconds\r\n */\r\nfunction getMicrobeatDurationMs(tempo: number): number {\r\n  // Microbeat = eighth note = (60 / tempo) / 2 seconds\r\n  return (60 / tempo) * 1000 / 2;\r\n}\r\n\r\nfunction createDemoExerciseState() {\r\n  let state = $state<ExerciseState>({ ...DEFAULT_STATE });\r\n\r\n  /**\r\n   * Generate exercise notes with emojis\r\n   */\r\n  function generateExerciseNotes(config: ExerciseConfig): TargetNote[] {\r\n    const notes: TargetNote[] = [];\r\n    const microbeatDurationMs = getMicrobeatDurationMs(config.tempo);\r\n\r\n    // Add 2-second lead-in so notes don't start immediately\r\n    const leadInMs = 2000;\r\n\r\n    for (let loop = 0; loop < config.numLoops; loop++) {\r\n      const pitch = randomPitch(config.minMidi, config.maxMidi);\r\n      const loopStartTime = leadInMs + (loop * 32 * microbeatDurationMs);\r\n\r\n      // Reference note (0-8 microbeats) with  emoji\r\n      notes.push({\r\n        midi: pitch,\r\n        startTimeMs: loopStartTime,\r\n        durationMs: 8 * microbeatDurationMs,\r\n        lyric: '',\r\n      });\r\n\r\n      // Rest 1 (8-16 microbeats) - no note\r\n\r\n      // User input note (16-24 microbeats) with  emoji\r\n      notes.push({\r\n        midi: pitch,\r\n        startTimeMs: loopStartTime + (16 * microbeatDurationMs),\r\n        durationMs: 8 * microbeatDurationMs,\r\n        lyric: '',\r\n      });\r\n\r\n      // Rest 2 (24-32 microbeats) - no note\r\n    }\r\n\r\n    return notes;\r\n  }\r\n\r\n  /**\r\n   * Determine which phase we're in based on current time\r\n   */\r\n  function getPhaseFromTime(currentTimeMs: number, tempo: number): { loop: number; phase: ExercisePhase } {\r\n    const microbeatDurationMs = getMicrobeatDurationMs(tempo);\r\n    const loopDurationMs = 32 * microbeatDurationMs;\r\n    const leadInMs = 2000;\r\n\r\n    // Subtract lead-in time\r\n    const adjustedTimeMs = currentTimeMs - leadInMs;\r\n\r\n    // During lead-in, show as rest\r\n    if (adjustedTimeMs < 0) {\r\n      return { loop: 0, phase: 'rest2' };\r\n    }\r\n\r\n    const currentLoop = Math.floor(adjustedTimeMs / loopDurationMs);\r\n    const timeInLoop = adjustedTimeMs % loopDurationMs;\r\n    const microbeatInLoop = Math.floor(timeInLoop / microbeatDurationMs);\r\n\r\n    let phase: ExercisePhase;\r\n    if (microbeatInLoop < 8) {\r\n      phase = 'reference';\r\n    } else if (microbeatInLoop < 16) {\r\n      phase = 'rest1';\r\n    } else if (microbeatInLoop < 24) {\r\n      phase = 'input';\r\n    } else {\r\n      phase = 'rest2';\r\n    }\r\n\r\n    return { loop: currentLoop, phase };\r\n  }\r\n\r\n  return {\r\n    get state() {\r\n      return state;\r\n    },\r\n\r\n    /**\r\n     * Update exercise configuration\r\n     */\r\n    configure(newConfig: Partial<ExerciseConfig>) {\r\n      state.config = { ...state.config, ...newConfig };\r\n    },\r\n\r\n    /**\r\n     * Set pitch range from current Y-axis range\r\n     */\r\n    setPitchRange(minMidi: number, maxMidi: number) {\r\n      state.config.minMidi = minMidi;\r\n      state.config.maxMidi = maxMidi;\r\n    },\r\n\r\n    /**\r\n     * Start the demo exercise\r\n     */\r\n    start() {\r\n      // Generate notes\r\n      const notes = generateExerciseNotes(state.config);\r\n\r\n      state.generatedNotes = notes;\r\n      state.isActive = true;\r\n      state.isPlaying = false; // Will be set to true when playback starts\r\n      state.currentLoop = 0;\r\n      state.currentPhase = 'reference';\r\n      state.currentPitch = notes.length > 0 ? notes[0].midi : null;\r\n      state.results = [];\r\n    },\r\n\r\n    /**\r\n     * Stop the exercise\r\n     */\r\n    stop() {\r\n      state.isActive = false;\r\n      state.isPlaying = false;\r\n      state.currentLoop = 0;\r\n      state.currentPhase = 'reference';\r\n      state.currentPitch = null;\r\n    },\r\n\r\n    /**\r\n     * Mark exercise as playing (called when highway starts)\r\n     */\r\n    setPlaying(playing: boolean) {\r\n      state.isPlaying = playing;\r\n    },\r\n\r\n    /**\r\n     * Update current phase based on time\r\n     */\r\n    updatePhase(currentTimeMs: number) {\r\n      const { loop, phase } = getPhaseFromTime(currentTimeMs, state.config.tempo);\r\n      state.currentLoop = loop;\r\n      state.currentPhase = phase;\r\n\r\n      // Update current pitch\r\n      const noteIndex = loop * 2; // 2 notes per loop (reference + input)\r\n      if (noteIndex < state.generatedNotes.length) {\r\n        state.currentPitch = state.generatedNotes[noteIndex].midi;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Add a performance result for a completed loop\r\n     */\r\n    addResult(result: ExerciseResult) {\r\n      state.results.push(result);\r\n    },\r\n\r\n    /**\r\n     * Check if we already have a result for a specific loop\r\n     */\r\n    hasResultForLoop(loopIndex: number): boolean {\r\n      return state.results.some(r => r.loopIndex === loopIndex);\r\n    },\r\n\r\n    /**\r\n     * Get all results\r\n     */\r\n    getResults(): ExerciseResult[] {\r\n      return state.results;\r\n    },\r\n\r\n    /**\r\n     * Get current progress\r\n     */\r\n    getCurrentProgress(): { current: number; total: number } {\r\n      return {\r\n        current: state.currentLoop + 1,\r\n        total: state.config.numLoops,\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Get generated notes for highway\r\n     */\r\n    getGeneratedNotes(): TargetNote[] {\r\n      return state.generatedNotes;\r\n    },\r\n\r\n    /**\r\n     * Calculate average accuracy from results\r\n     */\r\n    getAverageAccuracy(): number {\r\n      if (state.results.length === 0) return 0;\r\n      const total = state.results.reduce((sum, r) => sum + r.accuracy, 0);\r\n      return total / state.results.length;\r\n    },\r\n\r\n    /**\r\n     * Count hits\r\n     */\r\n    getHitCount(): number {\r\n      return state.results.filter(r => r.performance?.hitStatus === 'hit').length;\r\n    },\r\n\r\n    /**\r\n     * Reset to default state\r\n     */\r\n    reset() {\r\n      state = { ...DEFAULT_STATE, config: { ...state.config } };\r\n    },\r\n  };\r\n}\r\n\r\nexport const demoExerciseState = createDemoExerciseState();\r\n","<script lang=\"ts\">\n  /**\n   * SingingCanvas Component\n   *\n   * Wraps the shared PitchGrid component for singing/highway visualization modes.\n   */\n\n  import { onDestroy } from 'svelte';\n  import {\n    PitchGrid,\n    calculateViewportWindow,\n    createTimeCoordinates,\n    drawUserPitchTrace,\n  } from '@mlt/ui-components/canvas';\n  import type {\n    LegendHighlightConfig,\n    PitchGridMode,\n    PitchGridViewport,\n    SingingModeConfig,\n    HighwayModeConfig,\n    TargetNote as SharedTargetNote,\n    PitchTrailConfig,\n    UserPitchRenderConfig,\n    ViewportWindow,\n  } from '@mlt/ui-components/canvas';\n  import { generateRowDataForMidiRange, getTonicPitchClass, type PitchRowData } from '@mlt/pitch-data';\n  import { appState } from '../stores/appState.svelte.js';\n  import { pitchState } from '../stores/pitchState.svelte.js';\n  import { highwayState } from '../stores/highwayState.svelte.js';\n  import { demoExerciseState } from '../stores/demoExerciseState.svelte.js';\n\n  // Container element for measuring size\n  let container: HTMLDivElement | undefined = $state(undefined);\n  let containerWidth = $state(800);\n  let containerHeight = $state(400);\n\n  // Trail canvas overlay\n  let trailCanvas: HTMLCanvasElement | undefined = $state(undefined);\n  let trailCtx: CanvasRenderingContext2D | null = $state(null);\n  let trailAnimationId: number | null = $state(null);\n\n  let lastTrailLogAt = 0;\n  let trailFrameSamples = 0;\n  let trailFrameTimeTotal = 0;\n\n  const cellWidth = 20;\n  const showOctaveLabels = true;\n  const showFrequencyLabels = false;\n  const showRightLegend = $derived(containerWidth >= 720);\n\n  // Keep legend sizing in sync with PitchGrid\n  const LEGEND_COLUMN_WIDTH_UNITS = 3;\n  const legendColumnWidth = $derived(cellWidth * LEGEND_COLUMN_WIDTH_UNITS);\n  const legendCanvasWidth = $derived(legendColumnWidth * 2);\n  const showLegends = $derived(showOctaveLabels || showFrequencyLabels);\n  const legendTotalWidth = $derived(showLegends ? legendCanvasWidth * (showRightLegend ? 2 : 1) : 0);\n  const gridWidth = $derived(Math.max(0, containerWidth - legendTotalWidth));\n  const gridOffsetX = $derived(showLegends ? legendCanvasWidth : 0);\n  const getDebugTrailFlag = (): boolean => {\n    try {\n      const win = globalThis as typeof globalThis & { __ST_DEBUG_TRAIL?: boolean };\n      return Boolean(win.__ST_DEBUG_TRAIL);\n    } catch {\n      return false;\n    }\n  };\n\n  // Generate row data for the pitch grid based on y-axis range\n  // Uses the shared pitch data package which includes proper colors, frequencies, and enharmonic spellings\n  const fullRowData = $derived<PitchRowData[]>(\n    generateRowDataForMidiRange(appState.state.yAxisRange.minMidi, appState.state.yAxisRange.maxMidi)\n  );\n\n  // Calculate optimal viewport window that fills container height\n  const viewportWindow = $derived<ViewportWindow>(\n    calculateViewportWindow({\n      containerHeight,\n      fullRowData,\n      preferredCellHeight: 40,\n      minCellHeight: 20,\n    })\n  );\n\n  // Derive the PitchGrid mode from app state\n  const mode = $derived<PitchGridMode>(\n    appState.state.visualizationMode === 'highway' ? 'highway' : 'singing'\n  );\n\n  // Calculate beat interval based on exercise tempo\n  // 1 beat = 2 microbeats, beatIntervalMs = 60000 / tempo\n  const beatIntervalMs = $derived<number>(\n    (60 / demoExerciseState.state.config.tempo) * 1000 // ms per beat (quarter note)\n  );\n\n  // Lead-in time offset for beat line alignment (matches demoExerciseState)\n  const beatTimeOffsetMs = 2000;\n\n  const legendHighlight = $derived<LegendHighlightConfig | undefined>((() => {\n    if (!appState.state.pitchHighlightEnabled) {\n      return undefined;\n    }\n\n    const stable = pitchState.state.stablePitch;\n    if (stable.pitchClass === null || stable.opacity <= 0.01) {\n      return undefined;\n    }\n\n    return {\n      pitchClass: stable.pitchClass,\n      midi: stable.midi,\n      opacity: stable.opacity,\n      color: '#ffff00',\n    };\n  })());\n\n  // Convert local target notes to shared format\n  function convertTargetNotes(): SharedTargetNote[] {\n    return highwayState.state.targetNotes.map((n, i) => ({\n      id: `target-${i}`,\n      midi: n.midi,\n      startTimeMs: n.startTimeMs,\n      durationMs: n.durationMs,\n      label: n.lyric, // Pass emoji as label\n    }));\n  }\n\n  // Get pitch trail configuration with tonic-relative colors\n  const trailConfig = $derived<PitchTrailConfig>({\n    timeWindowMs: 4000,\n    pixelsPerSecond: 200,\n    circleRadius: 9.5,\n    proximityThreshold: 35,\n    maxConnections: 3,\n    connectorLineWidth: 2.5,\n    connectorColor: 'rgba(0,0,0,0.4)',\n    useTonicRelativeColors: true,\n    tonicPitchClass: getTonicPitchClass(appState.state.tonic),\n    clarityThreshold: 0.5,\n    maxOpacity: 0.9,\n  });\n\n  // Build singing mode config\n  const singingConfig = $derived<SingingModeConfig | undefined>(\n    mode === 'singing'\n      ? {\n          userPitch: pitchState.state.currentPitch\n            ? {\n                frequency: pitchState.state.currentPitch.frequency,\n                midi: pitchState.state.currentPitch.midi,\n                clarity: pitchState.state.currentPitch.clarity,\n                pitchClass: pitchState.state.currentPitch.pitchClass,\n              }\n            : null,\n          pitchHistory: [],\n          targetNotes: [],\n          pixelsPerSecond: 200,\n          timeWindowMs: 4000,\n          trailConfig,\n        }\n      : undefined\n  );\n\n  // Build highway mode config\n  const highwayConfig = $derived<HighwayModeConfig | undefined>(\n    mode === 'highway'\n      ? {\n          userPitch: pitchState.state.currentPitch\n            ? {\n                frequency: pitchState.state.currentPitch.frequency,\n                midi: pitchState.state.currentPitch.midi,\n                clarity: pitchState.state.currentPitch.clarity,\n                pitchClass: pitchState.state.currentPitch.pitchClass,\n              }\n            : null,\n          pitchHistory: [],\n          targetNotes: convertTargetNotes(),\n          nowLineX: highwayState.state.nowLineX,\n          pixelsPerSecond: highwayState.state.pixelsPerSecond,\n          currentTimeMs: highwayState.state.currentTimeMs,\n          timeWindowMs: highwayState.state.timeWindowMs,\n          trailConfig,\n        }\n      : undefined\n  );\n\n  // Viewport configuration using calculated window\n  const viewport = $derived<PitchGridViewport>({\n    startRow: viewportWindow.startRow,\n    endRow: viewportWindow.endRow,\n    zoomLevel: 1.0,\n    containerWidth,\n    containerHeight,\n  });\n\n  function setupTrailCanvas(): void {\n    if (!trailCanvas) return;\n\n    const dpr = window.devicePixelRatio || 1;\n    trailCanvas.width = gridWidth * dpr;\n    trailCanvas.height = containerHeight * dpr;\n    trailCanvas.style.width = `${gridWidth}px`;\n    trailCanvas.style.height = `${containerHeight}px`;\n    trailCanvas.style.left = `${gridOffsetX}px`;\n\n    const ctx = trailCanvas.getContext('2d');\n    if (!ctx) {\n      trailCtx = null;\n      return;\n    }\n\n    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\n    trailCtx = ctx;\n  }\n\n  function renderTrail(): void {\n    if (!trailCtx || gridWidth <= 0) return;\n\n    trailCtx.clearRect(0, 0, gridWidth, containerHeight);\n\n    const trailHistory = pitchState.state.history;\n    if (trailHistory.length === 0) return;\n\n    // Support both stationary and highway modes\n    const activeConfig = mode === 'singing' ? singingConfig : highwayConfig;\n    if (!activeConfig) return;\n\n    const debugTrail = getDebugTrailFlag();\n    const frameStart = debugTrail ? performance.now() : 0;\n\n    // Use appropriate nowLineX based on mode\n    const nowLineX = mode === 'highway' && highwayConfig\n      ? highwayConfig.nowLineX\n      : 100;\n\n    const coords = createTimeCoordinates({\n      cellWidth,\n      cellHeight: viewportWindow.cellHeight,\n      viewport,\n      pixelsPerSecond: activeConfig.pixelsPerSecond ?? 200,\n      nowLineX,\n      currentTimeMs: mode === 'highway' && highwayConfig ? highwayConfig.currentTimeMs : 0,\n    });\n\n    const userPitchConfig: UserPitchRenderConfig = {\n      cellHeight: viewportWindow.cellHeight,\n      viewportWidth: gridWidth,\n      nowLineX,\n      pixelsPerSecond: activeConfig.pixelsPerSecond ?? 200,\n      timeWindowMs: activeConfig.timeWindowMs ?? 4000,\n      colorMode: 'color',\n      trailConfig,\n    };\n\n    const currentTime = performance.now();\n\n    drawUserPitchTrace(\n      trailCtx,\n      coords,\n      trailHistory,\n      currentTime,\n      userPitchConfig,\n      fullRowData\n    );\n\n    if (debugTrail) {\n      const now = performance.now();\n      trailFrameSamples += 1;\n      trailFrameTimeTotal += (now - frameStart);\n      if (now - lastTrailLogAt >= 1000) {\n        const avgMs = trailFrameSamples > 0 ? (trailFrameTimeTotal / trailFrameSamples) : 0;\n        console.log(\n          `[SingingTrail] points=${trailHistory.length} avgMs=${avgMs.toFixed(2)} gridWidth=${gridWidth}`\n        );\n        lastTrailLogAt = now;\n        trailFrameSamples = 0;\n        trailFrameTimeTotal = 0;\n      }\n    }\n  }\n\n  function startTrailLoop(): void {\n    if (trailAnimationId) return;\n\n    const loop = () => {\n      renderTrail();\n      trailAnimationId = requestAnimationFrame(loop);\n    };\n\n    trailAnimationId = requestAnimationFrame(loop);\n  }\n\n  function stopTrailLoop(): void {\n    if (trailAnimationId) {\n      cancelAnimationFrame(trailAnimationId);\n      trailAnimationId = null;\n    }\n    if (trailCtx && gridWidth > 0) {\n      trailCtx.clearRect(0, 0, gridWidth, containerHeight);\n    }\n  }\n\n  // Handle container resize\n  $effect(() => {\n    if (!container) return;\n\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        containerWidth = entry.contentRect.width;\n        containerHeight = entry.contentRect.height;\n      }\n    });\n\n    resizeObserver.observe(container);\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  });\n\n  $effect(() => {\n    void gridWidth;\n    void containerHeight;\n    void gridOffsetX;\n    void trailCanvas;\n    setupTrailCanvas();\n  });\n\n  $effect(() => {\n    void mode;\n    void trailCtx;\n    // Run trail loop for both stationary and highway modes\n    if (mode === 'singing' || mode === 'highway') {\n      startTrailLoop();\n    } else {\n      stopTrailLoop();\n    }\n  });\n\n  onDestroy(() => {\n    stopTrailLoop();\n  });\n</script>\n\n<div class=\"singing-canvas-container\" bind:this={container}>\n  <PitchGrid\n    {mode}\n    {fullRowData}\n    {viewport}\n    cellWidth={cellWidth}\n    cellHeight={viewportWindow.cellHeight}\n    colorMode=\"color\"\n    {showOctaveLabels}\n    {showFrequencyLabels}\n    {showRightLegend}\n    {singingConfig}\n    {highwayConfig}\n    legendHighlight={legendHighlight}\n    {beatIntervalMs}\n    {beatTimeOffsetMs}\n  />\n  <canvas\n    bind:this={trailCanvas}\n    class=\"pitch-trail-canvas\"\n  ></canvas>\n</div>\n\n<style>\n  .singing-canvas-container {\n    flex: 1;\n    width: 100%;\n    min-height: 300px;\n    position: relative;\n    background-color: var(--color-bg-light);\n    /* Subtle white overlay to make grid bounds more visible */\n    background-image: linear-gradient(rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.02));\n    border-radius: var(--radius-md);\n    overflow: hidden;\n  }\n\n  .pitch-trail-canvas {\n    position: absolute;\n    top: 0;\n    pointer-events: none;\n    z-index: 2;\n  }\n</style>\n","'use strict';\n\nfunction FFT(size) {\n  this.size = size | 0;\n  if (this.size <= 1 || (this.size & (this.size - 1)) !== 0)\n    throw new Error('FFT size must be a power of two and bigger than 1');\n\n  this._csize = size << 1;\n\n  // NOTE: Use of `var` is intentional for old V8 versions\n  var table = new Array(this.size * 2);\n  for (var i = 0; i < table.length; i += 2) {\n    const angle = Math.PI * i / this.size;\n    table[i] = Math.cos(angle);\n    table[i + 1] = -Math.sin(angle);\n  }\n  this.table = table;\n\n  // Find size's power of two\n  var power = 0;\n  for (var t = 1; this.size > t; t <<= 1)\n    power++;\n\n  // Calculate initial step's width:\n  //   * If we are full radix-4 - it is 2x smaller to give inital len=8\n  //   * Otherwise it is the same as `power` to give len=4\n  this._width = power % 2 === 0 ? power - 1 : power;\n\n  // Pre-compute bit-reversal patterns\n  this._bitrev = new Array(1 << this._width);\n  for (var j = 0; j < this._bitrev.length; j++) {\n    this._bitrev[j] = 0;\n    for (var shift = 0; shift < this._width; shift += 2) {\n      var revShift = this._width - shift - 2;\n      this._bitrev[j] |= ((j >>> shift) & 3) << revShift;\n    }\n  }\n\n  this._out = null;\n  this._data = null;\n  this._inv = 0;\n}\nmodule.exports = FFT;\n\nFFT.prototype.fromComplexArray = function fromComplexArray(complex, storage) {\n  var res = storage || new Array(complex.length >>> 1);\n  for (var i = 0; i < complex.length; i += 2)\n    res[i >>> 1] = complex[i];\n  return res;\n};\n\nFFT.prototype.createComplexArray = function createComplexArray() {\n  const res = new Array(this._csize);\n  for (var i = 0; i < res.length; i++)\n    res[i] = 0;\n  return res;\n};\n\nFFT.prototype.toComplexArray = function toComplexArray(input, storage) {\n  var res = storage || this.createComplexArray();\n  for (var i = 0; i < res.length; i += 2) {\n    res[i] = input[i >>> 1];\n    res[i + 1] = 0;\n  }\n  return res;\n};\n\nFFT.prototype.completeSpectrum = function completeSpectrum(spectrum) {\n  var size = this._csize;\n  var half = size >>> 1;\n  for (var i = 2; i < half; i += 2) {\n    spectrum[size - i] = spectrum[i];\n    spectrum[size - i + 1] = -spectrum[i + 1];\n  }\n};\n\nFFT.prototype.transform = function transform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 0;\n  this._transform4();\n  this._out = null;\n  this._data = null;\n};\n\nFFT.prototype.realTransform = function realTransform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 0;\n  this._realTransform4();\n  this._out = null;\n  this._data = null;\n};\n\nFFT.prototype.inverseTransform = function inverseTransform(out, data) {\n  if (out === data)\n    throw new Error('Input and output buffers must be different');\n\n  this._out = out;\n  this._data = data;\n  this._inv = 1;\n  this._transform4();\n  for (var i = 0; i < out.length; i++)\n    out[i] /= this.size;\n  this._out = null;\n  this._data = null;\n};\n\n// radix-4 implementation\n//\n// NOTE: Uses of `var` are intentional for older V8 version that do not\n// support both `let compound assignments` and `const phi`\nFFT.prototype._transform4 = function _transform4() {\n  var out = this._out;\n  var size = this._csize;\n\n  // Initial step (permute and transform)\n  var width = this._width;\n  var step = 1 << width;\n  var len = (size / step) << 1;\n\n  var outOff;\n  var t;\n  var bitrev = this._bitrev;\n  if (len === 4) {\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleTransform2(outOff, off, step);\n    }\n  } else {\n    // len === 8\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleTransform4(outOff, off, step);\n    }\n  }\n\n  // Loop through steps in decreasing order\n  var inv = this._inv ? -1 : 1;\n  var table = this.table;\n  for (step >>= 2; step >= 2; step >>= 2) {\n    len = (size / step) << 1;\n    var quarterLen = len >>> 2;\n\n    // Loop through offsets in the data\n    for (outOff = 0; outOff < size; outOff += len) {\n      // Full case\n      var limit = outOff + quarterLen;\n      for (var i = outOff, k = 0; i < limit; i += 2, k += step) {\n        const A = i;\n        const B = A + quarterLen;\n        const C = B + quarterLen;\n        const D = C + quarterLen;\n\n        // Original values\n        const Ar = out[A];\n        const Ai = out[A + 1];\n        const Br = out[B];\n        const Bi = out[B + 1];\n        const Cr = out[C];\n        const Ci = out[C + 1];\n        const Dr = out[D];\n        const Di = out[D + 1];\n\n        // Middle values\n        const MAr = Ar;\n        const MAi = Ai;\n\n        const tableBr = table[k];\n        const tableBi = inv * table[k + 1];\n        const MBr = Br * tableBr - Bi * tableBi;\n        const MBi = Br * tableBi + Bi * tableBr;\n\n        const tableCr = table[2 * k];\n        const tableCi = inv * table[2 * k + 1];\n        const MCr = Cr * tableCr - Ci * tableCi;\n        const MCi = Cr * tableCi + Ci * tableCr;\n\n        const tableDr = table[3 * k];\n        const tableDi = inv * table[3 * k + 1];\n        const MDr = Dr * tableDr - Di * tableDi;\n        const MDi = Dr * tableDi + Di * tableDr;\n\n        // Pre-Final values\n        const T0r = MAr + MCr;\n        const T0i = MAi + MCi;\n        const T1r = MAr - MCr;\n        const T1i = MAi - MCi;\n        const T2r = MBr + MDr;\n        const T2i = MBi + MDi;\n        const T3r = inv * (MBr - MDr);\n        const T3i = inv * (MBi - MDi);\n\n        // Final values\n        const FAr = T0r + T2r;\n        const FAi = T0i + T2i;\n\n        const FCr = T0r - T2r;\n        const FCi = T0i - T2i;\n\n        const FBr = T1r + T3i;\n        const FBi = T1i - T3r;\n\n        const FDr = T1r - T3i;\n        const FDi = T1i + T3r;\n\n        out[A] = FAr;\n        out[A + 1] = FAi;\n        out[B] = FBr;\n        out[B + 1] = FBi;\n        out[C] = FCr;\n        out[C + 1] = FCi;\n        out[D] = FDr;\n        out[D + 1] = FDi;\n      }\n    }\n  }\n};\n\n// radix-2 implementation\n//\n// NOTE: Only called for len=4\nFFT.prototype._singleTransform2 = function _singleTransform2(outOff, off,\n                                                             step) {\n  const out = this._out;\n  const data = this._data;\n\n  const evenR = data[off];\n  const evenI = data[off + 1];\n  const oddR = data[off + step];\n  const oddI = data[off + step + 1];\n\n  const leftR = evenR + oddR;\n  const leftI = evenI + oddI;\n  const rightR = evenR - oddR;\n  const rightI = evenI - oddI;\n\n  out[outOff] = leftR;\n  out[outOff + 1] = leftI;\n  out[outOff + 2] = rightR;\n  out[outOff + 3] = rightI;\n};\n\n// radix-4\n//\n// NOTE: Only called for len=8\nFFT.prototype._singleTransform4 = function _singleTransform4(outOff, off,\n                                                             step) {\n  const out = this._out;\n  const data = this._data;\n  const inv = this._inv ? -1 : 1;\n  const step2 = step * 2;\n  const step3 = step * 3;\n\n  // Original values\n  const Ar = data[off];\n  const Ai = data[off + 1];\n  const Br = data[off + step];\n  const Bi = data[off + step + 1];\n  const Cr = data[off + step2];\n  const Ci = data[off + step2 + 1];\n  const Dr = data[off + step3];\n  const Di = data[off + step3 + 1];\n\n  // Pre-Final values\n  const T0r = Ar + Cr;\n  const T0i = Ai + Ci;\n  const T1r = Ar - Cr;\n  const T1i = Ai - Ci;\n  const T2r = Br + Dr;\n  const T2i = Bi + Di;\n  const T3r = inv * (Br - Dr);\n  const T3i = inv * (Bi - Di);\n\n  // Final values\n  const FAr = T0r + T2r;\n  const FAi = T0i + T2i;\n\n  const FBr = T1r + T3i;\n  const FBi = T1i - T3r;\n\n  const FCr = T0r - T2r;\n  const FCi = T0i - T2i;\n\n  const FDr = T1r - T3i;\n  const FDi = T1i + T3r;\n\n  out[outOff] = FAr;\n  out[outOff + 1] = FAi;\n  out[outOff + 2] = FBr;\n  out[outOff + 3] = FBi;\n  out[outOff + 4] = FCr;\n  out[outOff + 5] = FCi;\n  out[outOff + 6] = FDr;\n  out[outOff + 7] = FDi;\n};\n\n// Real input radix-4 implementation\nFFT.prototype._realTransform4 = function _realTransform4() {\n  var out = this._out;\n  var size = this._csize;\n\n  // Initial step (permute and transform)\n  var width = this._width;\n  var step = 1 << width;\n  var len = (size / step) << 1;\n\n  var outOff;\n  var t;\n  var bitrev = this._bitrev;\n  if (len === 4) {\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleRealTransform2(outOff, off >>> 1, step >>> 1);\n    }\n  } else {\n    // len === 8\n    for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n      const off = bitrev[t];\n      this._singleRealTransform4(outOff, off >>> 1, step >>> 1);\n    }\n  }\n\n  // Loop through steps in decreasing order\n  var inv = this._inv ? -1 : 1;\n  var table = this.table;\n  for (step >>= 2; step >= 2; step >>= 2) {\n    len = (size / step) << 1;\n    var halfLen = len >>> 1;\n    var quarterLen = halfLen >>> 1;\n    var hquarterLen = quarterLen >>> 1;\n\n    // Loop through offsets in the data\n    for (outOff = 0; outOff < size; outOff += len) {\n      for (var i = 0, k = 0; i <= hquarterLen; i += 2, k += step) {\n        var A = outOff + i;\n        var B = A + quarterLen;\n        var C = B + quarterLen;\n        var D = C + quarterLen;\n\n        // Original values\n        var Ar = out[A];\n        var Ai = out[A + 1];\n        var Br = out[B];\n        var Bi = out[B + 1];\n        var Cr = out[C];\n        var Ci = out[C + 1];\n        var Dr = out[D];\n        var Di = out[D + 1];\n\n        // Middle values\n        var MAr = Ar;\n        var MAi = Ai;\n\n        var tableBr = table[k];\n        var tableBi = inv * table[k + 1];\n        var MBr = Br * tableBr - Bi * tableBi;\n        var MBi = Br * tableBi + Bi * tableBr;\n\n        var tableCr = table[2 * k];\n        var tableCi = inv * table[2 * k + 1];\n        var MCr = Cr * tableCr - Ci * tableCi;\n        var MCi = Cr * tableCi + Ci * tableCr;\n\n        var tableDr = table[3 * k];\n        var tableDi = inv * table[3 * k + 1];\n        var MDr = Dr * tableDr - Di * tableDi;\n        var MDi = Dr * tableDi + Di * tableDr;\n\n        // Pre-Final values\n        var T0r = MAr + MCr;\n        var T0i = MAi + MCi;\n        var T1r = MAr - MCr;\n        var T1i = MAi - MCi;\n        var T2r = MBr + MDr;\n        var T2i = MBi + MDi;\n        var T3r = inv * (MBr - MDr);\n        var T3i = inv * (MBi - MDi);\n\n        // Final values\n        var FAr = T0r + T2r;\n        var FAi = T0i + T2i;\n\n        var FBr = T1r + T3i;\n        var FBi = T1i - T3r;\n\n        out[A] = FAr;\n        out[A + 1] = FAi;\n        out[B] = FBr;\n        out[B + 1] = FBi;\n\n        // Output final middle point\n        if (i === 0) {\n          var FCr = T0r - T2r;\n          var FCi = T0i - T2i;\n          out[C] = FCr;\n          out[C + 1] = FCi;\n          continue;\n        }\n\n        // Do not overwrite ourselves\n        if (i === hquarterLen)\n          continue;\n\n        // In the flipped case:\n        // MAi = -MAi\n        // MBr=-MBi, MBi=-MBr\n        // MCr=-MCr\n        // MDr=MDi, MDi=MDr\n        var ST0r = T1r;\n        var ST0i = -T1i;\n        var ST1r = T0r;\n        var ST1i = -T0i;\n        var ST2r = -inv * T3i;\n        var ST2i = -inv * T3r;\n        var ST3r = -inv * T2i;\n        var ST3i = -inv * T2r;\n\n        var SFAr = ST0r + ST2r;\n        var SFAi = ST0i + ST2i;\n\n        var SFBr = ST1r + ST3i;\n        var SFBi = ST1i - ST3r;\n\n        var SA = outOff + quarterLen - i;\n        var SB = outOff + halfLen - i;\n\n        out[SA] = SFAr;\n        out[SA + 1] = SFAi;\n        out[SB] = SFBr;\n        out[SB + 1] = SFBi;\n      }\n    }\n  }\n};\n\n// radix-2 implementation\n//\n// NOTE: Only called for len=4\nFFT.prototype._singleRealTransform2 = function _singleRealTransform2(outOff,\n                                                                     off,\n                                                                     step) {\n  const out = this._out;\n  const data = this._data;\n\n  const evenR = data[off];\n  const oddR = data[off + step];\n\n  const leftR = evenR + oddR;\n  const rightR = evenR - oddR;\n\n  out[outOff] = leftR;\n  out[outOff + 1] = 0;\n  out[outOff + 2] = rightR;\n  out[outOff + 3] = 0;\n};\n\n// radix-4\n//\n// NOTE: Only called for len=8\nFFT.prototype._singleRealTransform4 = function _singleRealTransform4(outOff,\n                                                                     off,\n                                                                     step) {\n  const out = this._out;\n  const data = this._data;\n  const inv = this._inv ? -1 : 1;\n  const step2 = step * 2;\n  const step3 = step * 3;\n\n  // Original values\n  const Ar = data[off];\n  const Br = data[off + step];\n  const Cr = data[off + step2];\n  const Dr = data[off + step3];\n\n  // Pre-Final values\n  const T0r = Ar + Cr;\n  const T1r = Ar - Cr;\n  const T2r = Br + Dr;\n  const T3r = inv * (Br - Dr);\n\n  // Final values\n  const FAr = T0r + T2r;\n\n  const FBr = T1r;\n  const FBi = -T3r;\n\n  const FCr = T0r - T2r;\n\n  const FDr = T1r;\n  const FDi = T3r;\n\n  out[outOff] = FAr;\n  out[outOff + 1] = 0;\n  out[outOff + 2] = FBr;\n  out[outOff + 3] = FBi;\n  out[outOff + 4] = FCr;\n  out[outOff + 5] = 0;\n  out[outOff + 6] = FDr;\n  out[outOff + 7] = FDi;\n};\n","import FFT from \"fft.js\";\n\n/**\n * @typedef {Float32Array | Float64Array | number[]} Buffer One of the supported\n * buffer types. Other numeric array types may not work correctly.\n */\n\n/**\n * A class that can perform autocorrelation on input arrays of a given size.\n *\n * The class holds internal buffers so that no additional allocations are\n * necessary while performing the operation.\n *\n * @template {Buffer} T the buffer type to use. While inputs to the\n * autocorrelation process can be any array-like type, the output buffer\n * (whether provided explicitly or using a fresh buffer) is always of this type.\n */\nexport class Autocorrelator {\n  /** @private @readonly @type {number} */\n  _inputLength;\n  /** @private @type {FFT} */\n  _fft;\n  /** @private @type {(size: number) => T} */\n  _bufferSupplier;\n  /** @private @type {T} */\n  _paddedInputBuffer;\n  /** @private @type {T} */\n  _transformBuffer;\n  /** @private @type {T} */\n  _inverseBuffer;\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using\n   * {@link Float32Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<Float32Array>}\n   */\n  static forFloat32Array(inputLength) {\n    return new Autocorrelator(\n      inputLength,\n      (length) => new Float32Array(length),\n    );\n  }\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using\n   * {@link Float64Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<Float64Array>}\n   */\n  static forFloat64Array(inputLength) {\n    return new Autocorrelator(\n      inputLength,\n      (length) => new Float64Array(length),\n    );\n  }\n\n  /**\n   * A helper method to create an {@link Autocorrelator} using `number[]`\n   * buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {Autocorrelator<number[]>}\n   */\n  static forNumberArray(inputLength) {\n    return new Autocorrelator(inputLength, (length) => Array(length));\n  }\n\n  /**\n   * Constructs a new {@link Autocorrelator} able to handle input arrays of the\n   * given length.\n   *\n   * @param inputLength {number} the input array length to support. This\n   * `Autocorrelator` will only support operation on arrays of this length.\n   * @param bufferSupplier {(length: number) => T} the function to use for\n   * creating buffers, accepting the length of the buffer to create and\n   * returning a new buffer of that length. The values of the returned buffer\n   * need not be initialized in any particular way.\n   */\n  constructor(inputLength, bufferSupplier) {\n    if (inputLength < 1) {\n      throw new Error(`Input length must be at least one`);\n    }\n    this._inputLength = inputLength;\n    // We need to double the input length to get correct results, and the FFT\n    // algorithm we use requires a length that's a power of 2\n    this._fft = new FFT(ceilPow2(2 * inputLength));\n    this._bufferSupplier = bufferSupplier;\n    this._paddedInputBuffer = this._bufferSupplier(this._fft.size);\n    this._transformBuffer = this._bufferSupplier(2 * this._fft.size);\n    this._inverseBuffer = this._bufferSupplier(2 * this._fft.size);\n  }\n\n  /**\n   * Returns the supported input length.\n   *\n   * @returns {number} the supported input length\n   */\n  get inputLength() {\n    return this._inputLength;\n  }\n\n  /**\n   * Autocorrelates the given input data.\n   *\n   * @param input {ArrayLike<number>} the input data to autocorrelate\n   * @param output {T} the output buffer into which to write the autocorrelated\n   * data. If not provided, a new buffer will be created.\n   * @returns {T} `output`\n   */\n  autocorrelate(input, output = this._bufferSupplier(input.length)) {\n    if (input.length !== this._inputLength) {\n      throw new Error(\n        `Input must have length ${this._inputLength} but had length ${input.length}`,\n      );\n    }\n    // Step 0: pad the input array with zeros\n    for (let i = 0; i < input.length; i++) {\n      this._paddedInputBuffer[i] = input[i];\n    }\n    for (let i = input.length; i < this._paddedInputBuffer.length; i++) {\n      this._paddedInputBuffer[i] = 0;\n    }\n\n    // Step 1: get the DFT of the input array\n    this._fft.realTransform(this._transformBuffer, this._paddedInputBuffer);\n    // We need to fill in the right half of the array too\n    this._fft.completeSpectrum(this._transformBuffer);\n    // Step 2: multiply each entry by its conjugate\n    const tb = this._transformBuffer;\n    for (let i = 0; i < tb.length; i += 2) {\n      tb[i] = tb[i] * tb[i] + tb[i + 1] * tb[i + 1];\n      tb[i + 1] = 0;\n    }\n    // Step 3: perform the inverse transform\n    this._fft.inverseTransform(this._inverseBuffer, this._transformBuffer);\n\n    // This last result (the inverse transform) contains the autocorrelation\n    // data, which is completely real\n    for (let i = 0; i < input.length; i++) {\n      output[i] = this._inverseBuffer[2 * i];\n    }\n    return output;\n  }\n}\n\n/**\n * Returns an array of all the key maximum positions in the given input array.\n *\n * In McLeod's paper, a key maximum is the highest maximum between a positively\n * sloped zero crossing and a negatively sloped one.\n *\n * TODO: it may be more efficient not to construct a new output array each time,\n * but that would also make the code more complicated (more so than the changes\n * that were needed to remove the other allocations).\n *\n * @param input {ArrayLike<number>}\n * @returns {number[]}\n */\nfunction getKeyMaximumIndices(input) {\n  // The indices of the key maxima\n  /** @type {number[]} */ const keyIndices = [];\n  // Whether the last zero crossing found was positively sloped; equivalently,\n  // whether we're looking for a key maximum\n  let lookingForMaximum = false;\n  // The largest local maximum found so far\n  let max = -Infinity;\n  // The index of the largest local maximum so far\n  let maxIndex = -1;\n\n  for (let i = 1; i < input.length - 1; i++) {\n    if (input[i - 1] <= 0 && input[i] > 0) {\n      // Positively sloped zero crossing\n      lookingForMaximum = true;\n      maxIndex = i;\n      max = input[i];\n    } else if (input[i - 1] > 0 && input[i] <= 0) {\n      // Negatively sloped zero crossing\n      lookingForMaximum = false;\n      if (maxIndex !== -1) {\n        keyIndices.push(maxIndex);\n      }\n    } else if (lookingForMaximum && input[i] > max) {\n      max = input[i];\n      maxIndex = i;\n    }\n  }\n\n  return keyIndices;\n}\n\n/**\n * Refines the chosen key maximum index chosen from the given data by\n * interpolating a parabola using the key maximum index and its two neighbors\n * and finding the position of that parabola's maximum value.\n *\n * This is described in section 5 of the MPM paper as a way to refine the\n * position of the maximum.\n *\n * @param index {number} the chosen key maximum index. This must be between `1`\n * and `data.length - 2`, inclusive, since it and its two neighbors need to be\n * valid indexes of `data`.\n * @param data {ArrayLike<number>} the input array from which `index` was chosen\n * @returns {[number, number]} a pair consisting of the refined key maximum index and the\n * interpolated value of `data` at that index (the latter of which is used as a\n * measure of clarity)\n */\nfunction refineResultIndex(index, data) {\n  const [x0, x1, x2] = [index - 1, index, index + 1];\n  const [y0, y1, y2] = [data[x0], data[x1], data[x2]];\n\n  // The parabola going through the three data points can be written as\n  // y = y0(x - x1)(x - x2)/(x0 - x1)(x0 - x2)\n  //   + y1(x - x0)(x - x2)/(x1 - x0)(x1 - x2)\n  //   + y2(x - x0)(x - x1)/(x2 - x0)(x2 - x1)\n  // Given the definitions of x0, x1, and x2, we can simplify the denominators:\n  // y = y0(x - x1)(x - x2)/2\n  //   - y1(x - x0)(x - x2)\n  //   + y2(x - x0)(x - x1)/2\n  // We can expand this out and get the coefficients in standard form:\n  // a = y0/2 - y1 + y2/2\n  // b = -(y0/2)(x1 + x2) + y1(x0 + x2) - (y2/2)(x0 + x1)\n  // c = y0x1x2/2 - y1x0x2 + y2x0x1/2\n  // The index of the maximum is -b / 2a (by solving for x where the derivative\n  // is 0).\n\n  const a = y0 / 2 - y1 + y2 / 2;\n  const b = -(y0 / 2) * (x1 + x2) + y1 * (x0 + x2) - (y2 / 2) * (x0 + x1);\n  const c = (y0 * x1 * x2) / 2 - y1 * x0 * x2 + (y2 * x0 * x1) / 2;\n\n  const xMax = -b / (2 * a);\n  const yMax = a * xMax * xMax + b * xMax + c;\n  return [xMax, yMax];\n}\n\n/**\n * A class that can detect the pitch of a note from a time-domain input array.\n *\n * This class uses the McLeod pitch method (MPM) to detect pitches. MPM is\n * described in the paper 'A Smarter Way to Find Pitch' by Philip McLeod and\n * Geoff Wyvill\n * (http://miracle.otago.ac.nz/tartini/papers/A_Smarter_Way_to_Find_Pitch.pdf).\n *\n * The class holds internal buffers so that a minimal number of additional\n * allocations are necessary while performing the operation.\n *\n * @template {Buffer} T the buffer type to use internally. Inputs to the\n * pitch-detection process can be any numeric array type.\n */\nexport class PitchDetector {\n  /** @private @type {Autocorrelator<T>} */\n  _autocorrelator;\n  /** @private @type {T} */\n  _nsdfBuffer;\n  /** @private @type {number} */\n  _clarityThreshold = 0.9;\n  /** @private @type {number} */\n  _minVolumeAbsolute = 0.0;\n  /** @private @type {number} */\n  _maxInputAmplitude = 1.0;\n\n  /**\n   * A helper method to create an {@link PitchDetector} using {@link Float32Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<Float32Array>}\n   */\n  static forFloat32Array(inputLength) {\n    return new PitchDetector(inputLength, (length) => new Float32Array(length));\n  }\n\n  /**\n   * A helper method to create an {@link PitchDetector} using {@link Float64Array} buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<Float64Array>}\n   */\n  static forFloat64Array(inputLength) {\n    return new PitchDetector(inputLength, (length) => new Float64Array(length));\n  }\n\n  /**\n   * A helper method to create an {@link PitchDetector} using `number[]` buffers.\n   *\n   * @param inputLength {number} the input array length to support\n   * @returns {PitchDetector<number[]>}\n   */\n  static forNumberArray(inputLength) {\n    return new PitchDetector(inputLength, (length) => Array(length));\n  }\n\n  /**\n   * Constructs a new {@link PitchDetector} able to handle input arrays of the\n   * given length.\n   *\n   * @param inputLength {number} the input array length to support. This\n   * `PitchDetector` will only support operation on arrays of this length.\n   * @param bufferSupplier {(inputLength: number) => T} the function to use for\n   * creating buffers, accepting the length of the buffer to create and\n   * returning a new buffer of that length. The values of the returned buffer\n   * need not be initialized in any particular way.\n   */\n  constructor(inputLength, bufferSupplier) {\n    this._autocorrelator = new Autocorrelator(inputLength, bufferSupplier);\n    this._nsdfBuffer = bufferSupplier(inputLength);\n  }\n\n  /**\n   * Returns the supported input length.\n   *\n   * @returns {number} the supported input length\n   */\n  get inputLength() {\n    return this._autocorrelator.inputLength;\n  }\n\n  /**\n   * Sets the clarity threshold used when identifying the correct pitch (the constant\n   * `k` from the MPM paper). The value must be between 0 (exclusive) and 1\n   * (inclusive), with the most suitable range being between 0.8 and 1.\n   *\n   * @param threshold {number} the clarity threshold\n   */\n  set clarityThreshold(threshold) {\n    if (!Number.isFinite(threshold) || threshold <= 0 || threshold > 1) {\n      throw new Error(\"clarityThreshold must be a number in the range (0, 1]\");\n    }\n    this._clarityThreshold = threshold;\n  }\n\n  /**\n   * Sets the minimum detectable volume, as an absolute number between 0 and\n   * `maxInputAmplitude`, inclusive, to consider in a sample when detecting the\n   * pitch. If a sample fails to meet this minimum volume, `findPitch` will\n   * return a clarity of 0.\n   *\n   * Volume is calculated as the RMS (root mean square) of the input samples.\n   *\n   * @param volume {number} the minimum volume as an absolute amplitude value\n   */\n  set minVolumeAbsolute(volume) {\n    if (\n      !Number.isFinite(volume) ||\n      volume < 0 ||\n      volume > this._maxInputAmplitude\n    ) {\n      throw new Error(\n        `minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`,\n      );\n    }\n    this._minVolumeAbsolute = volume;\n  }\n\n  /**\n   * Sets the minimum volume using a decibel measurement. Must be less than or\n   * equal to 0: 0 indicates the loudest possible sound (see\n   * `maxInputAmplitude`), -10 is a sound with a tenth of the volume of the\n   * loudest possible sound, etc.\n   *\n   * Volume is calculated as the RMS (root mean square) of the input samples.\n   *\n   * @param db {number} the minimum volume in decibels, with 0 being the loudest\n   * sound\n   */\n  set minVolumeDecibels(db) {\n    if (!Number.isFinite(db) || db > 0) {\n      throw new Error(\"minVolumeDecibels must be a number <= 0\");\n    }\n    this._minVolumeAbsolute = this._maxInputAmplitude * 10 ** (db / 10);\n  }\n\n  /**\n   * Sets the maximum amplitude of an input reading. Must be greater than 0.\n   *\n   * @param amplitude {number} the maximum amplitude (absolute value) of an input reading\n   */\n  set maxInputAmplitude(amplitude) {\n    if (!Number.isFinite(amplitude) || amplitude <= 0) {\n      throw new Error(\"maxInputAmplitude must be a number > 0\");\n    }\n    this._maxInputAmplitude = amplitude;\n  }\n\n  /**\n   * Returns the pitch detected using McLeod Pitch Method (MPM) along with a\n   * measure of its clarity.\n   *\n   * The clarity is a value between 0 and 1 (potentially inclusive) that\n   * represents how \"clear\" the pitch was. A clarity value of 1 indicates that\n   * the pitch was very distinct, while lower clarity values indicate less\n   * definite pitches.\n   *\n   * @param input {ArrayLike<number>} the time-domain input data\n   * @param sampleRate {number} the sample rate at which the input data was\n   * collected\n   * @returns {[number, number]} the detected pitch, in Hz, followed by the\n   * clarity. If a pitch cannot be determined from the input, such as if the\n   * volume is too low (see `minVolumeAbsolute` and `minVolumeDecibels`), this\n   * will be `[0, 0]`.\n   */\n  findPitch(input, sampleRate) {\n    // If the highest key maximum is less than the minimum volume, we don't need\n    // to bother detecting the pitch, as the sample is too quiet.\n    if (this._belowMinimumVolume(input)) return [0, 0];\n    this._nsdf(input);\n    const keyMaximumIndices = getKeyMaximumIndices(this._nsdfBuffer);\n    if (keyMaximumIndices.length === 0) {\n      // No key maxima means that we either don't have enough data to analyze or\n      // that the data was flawed (such as an input array of zeroes)\n      return [0, 0];\n    }\n    // The highest key maximum\n    const nMax = Math.max(...keyMaximumIndices.map((i) => this._nsdfBuffer[i]));\n    // Following the paper, we return the pitch corresponding to the first key\n    // maximum higher than K * nMax. This is guaranteed not to be undefined, since\n    // we know of at least one key maximum satisfying this condition (whichever\n    // key maximum gave us nMax).\n    const resultIndex = keyMaximumIndices.find(\n      (i) => this._nsdfBuffer[i] >= this._clarityThreshold * nMax,\n    );\n    const [refinedResultIndex, clarity] = refineResultIndex(\n      // @ts-expect-error resultIndex is guaranteed to be defined\n      resultIndex,\n      this._nsdfBuffer,\n    );\n\n    // Due to floating point errors, the clarity may occasionally come out to be\n    // slightly over 1.0. We can avoid incorrect results by clamping the value.\n    return [sampleRate / refinedResultIndex, Math.min(clarity, 1.0)];\n  }\n\n  /**\n   * Returns whether the input audio data is below the minimum volume allowed by\n   * the pitch detector.\n   *\n   * @private\n   * @param input {ArrayLike<number>}\n   * @returns {boolean}\n   */\n  _belowMinimumVolume(input) {\n    if (this._minVolumeAbsolute === 0) return false;\n    let squareSum = 0;\n    for (let i = 0; i < input.length; i++) {\n      squareSum += input[i] ** 2;\n    }\n    return Math.sqrt(squareSum / input.length) < this._minVolumeAbsolute;\n  }\n\n  /**\n   * Computes the NSDF of the input and stores it in the internal buffer. This\n   * is equation (9) in the McLeod pitch method paper.\n   *\n   * @private\n   * @param input {ArrayLike<number>}\n   */\n  _nsdf(input) {\n    // The function r'(tau) is the autocorrelation\n    this._autocorrelator.autocorrelate(input, this._nsdfBuffer);\n    // The function m'(tau) (defined in equation (6)) can be computed starting\n    // with m'(0), which is equal to 2r'(0), and then iteratively modified to\n    // get m'(1), m'(2), etc. For example, to get m'(1), we take m'(0) and\n    // subtract x_0^2 and x_{W-1}^2. Then, to get m'(2), we take m'(1) and\n    // subtract x_1^2 and x_{W-2}^2, and further values are similar (see the\n    // note at the end of section 6 in the MPM paper).\n    //\n    // The resulting array values are 2 * r'(tau) / m'(tau). We use m below as\n    // the incremental value of m'.\n    let m = 2 * this._nsdfBuffer[0];\n    /** @type {number} */ let i;\n    // As pointed out by issuefiler on GitHub, we can take advantage of the fact\n    // that m will never increase to avoid division by zero by ending this loop\n    // once m === 0. The rest of the array values after m becomes 0 will just be\n    // set to 0 themselves. We actually check for m > 0 rather than m === 0\n    // because there may be small floating-point errors that cause m to become\n    // negative rather than exactly 0.\n    for (i = 0; i < this._nsdfBuffer.length && m > 0; i++) {\n      this._nsdfBuffer[i] = (2 * this._nsdfBuffer[i]) / m;\n      m -= input[i] ** 2 + input[input.length - i - 1] ** 2;\n    }\n    // If there are any array values remaining, it means m === 0 for those\n    // values of tau, so we can just set them to 0\n    for (; i < this._nsdfBuffer.length; i++) {\n      this._nsdfBuffer[i] = 0;\n    }\n  }\n}\n\n/**\n * Rounds up the input to the next power of 2.\n *\n * @param {number} v\n * @returns {number} the next power of 2 at least as large as `v`\n */\nfunction ceilPow2(v) {\n  // https://graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2\n  v--;\n  v |= v >> 1;\n  v |= v >> 2;\n  v |= v >> 4;\n  v |= v >> 8;\n  v |= v >> 16;\n  v++;\n  return v;\n}\n","/**\n * @mlt/pitch-utils\n *\n * Shared pitch mapping utilities for Music Learning Tools.\n * Provides conversion between:\n * - Frequency (Hz)  MIDI  Cents\n * - Continuous pitch (from microphone)  Grid Y position\n * - Pitch boundaries and threshold logic\n *\n * Reference: A4 = 440 Hz = MIDI 69\n *\n * PITCH GRID GEOMETRY (per Student Notation spec):\n * - The center of a row is the exact pitch\n * - Moving upward within the row represents positive cents deviation\n * - The top of the row is +100 cents (the adjacent semitone above)\n * - Moving downward within the row represents negative cents deviation\n * - The bottom of the row is -100 cents (but this overlaps with the row below)\n *\n * In Student Notation, rows use \"dual overlapping\" behavior:\n * - 50 cents above center = one-quarter of row height above center\n * - Each row represents 50 cents around its center pitch\n */\n// ============================================================================\n// Constants\n// ============================================================================\n/** Reference frequency for A4 in Hz */\nexport const A4_FREQUENCY = 440;\n/** MIDI number for A4 */\nexport const A4_MIDI = 69;\n/** Number of cents in a semitone */\nexport const CENTS_PER_SEMITONE = 100;\n/** Number of semitones in an octave */\nexport const SEMITONES_PER_OCTAVE = 12;\n/** Minimum valid MIDI note (A0 on piano) */\nexport const MIDI_MIN = 21;\n/** Maximum valid MIDI note (C8 on piano) */\nexport const MIDI_MAX = 108;\n// ============================================================================\n// Basic Conversions\n// ============================================================================\n/**\n * Convert frequency (Hz) to MIDI note number (continuous, can be fractional).\n *\n * @param frequency Frequency in Hz\n * @returns MIDI note number (can be fractional for microtones)\n *\n * @example\n * frequencyToMidi(440) // 69 (A4)\n * frequencyToMidi(466.16) // ~70 (Bb4)\n * frequencyToMidi(453.08) // ~69.5 (between A4 and Bb4)\n */\nexport function frequencyToMidi(frequency) {\n    if (frequency <= 0) {\n        return NaN;\n    }\n    return A4_MIDI + SEMITONES_PER_OCTAVE * Math.log2(frequency / A4_FREQUENCY);\n}\n/**\n * Convert MIDI note number to frequency (Hz).\n *\n * @param midi MIDI note number (can be fractional)\n * @returns Frequency in Hz\n *\n * @example\n * midiToFrequency(69) // 440 (A4)\n * midiToFrequency(60) // ~261.63 (C4)\n * midiToFrequency(69.5) // ~452.89 (between A4 and Bb4)\n */\nexport function midiToFrequency(midi) {\n    return A4_FREQUENCY * Math.pow(2, (midi - A4_MIDI) / SEMITONES_PER_OCTAVE);\n}\n/**\n * Convert frequency to cents offset from a reference frequency.\n *\n * @param frequency The frequency to measure\n * @param reference The reference frequency\n * @returns Cents offset (positive = sharp, negative = flat)\n *\n * @example\n * frequencyToCents(440, 440) // 0\n * frequencyToCents(466.16, 440) // ~100 (one semitone up)\n * frequencyToCents(453.08, 440) // ~50 (50 cents sharp)\n */\nexport function frequencyToCents(frequency, reference) {\n    if (frequency <= 0 || reference <= 0) {\n        return NaN;\n    }\n    return 1200 * Math.log2(frequency / reference);\n}\n/**\n * Convert cents offset to frequency ratio.\n *\n * @param cents Cents offset\n * @returns Frequency ratio (multiply reference frequency by this)\n *\n * @example\n * centsToRatio(100) // ~1.0595 (one semitone up)\n * centsToRatio(-100) // ~0.9439 (one semitone down)\n */\nexport function centsToRatio(cents) {\n    return Math.pow(2, cents / 1200);\n}\n/**\n * Get cents offset from the nearest semitone.\n *\n * @param midi Continuous MIDI number\n * @returns Cents offset from nearest integer MIDI (-50 to +50)\n *\n * @example\n * getCentsOffset(69.0) // 0\n * getCentsOffset(69.25) // 25\n * getCentsOffset(69.75) // -25 (closer to 70)\n */\nexport function getCentsOffset(midi) {\n    const nearestMidi = Math.round(midi);\n    const cents = (midi - nearestMidi) * CENTS_PER_SEMITONE;\n    return cents;\n}\n/**\n * Get the nearest integer MIDI note.\n *\n * @param midi Continuous MIDI number\n * @returns Nearest integer MIDI note\n */\nexport function getNearestMidi(midi) {\n    return Math.round(midi);\n}\n/**\n * Calculate the Y position in a pitch grid for a continuous MIDI value.\n *\n * The grid is laid out with higher pitches at the top (lower Y values).\n * Each semitone row has a height of: gridHeight / (topMidi - bottomMidi + 1)\n *\n * Within a row:\n * - Row center = exact pitch (0 cents offset)\n * - Top of row = +50 cents (halfway to next semitone)\n * - Bottom of row = -50 cents (halfway to previous semitone)\n *\n * @param midi Continuous MIDI value\n * @param config Grid configuration\n * @returns Y position in pixels (0 = top)\n */\nexport function midiToGridY(midi, config) {\n    const { topMidi, bottomMidi, gridHeight } = config;\n    const totalSemitones = topMidi - bottomMidi + 1;\n    const rowHeight = gridHeight / totalSemitones;\n    // Position relative to top (inverted because Y increases downward)\n    // topMidi is at Y=0, bottomMidi is at Y=gridHeight\n    const semitonesFromTop = topMidi - midi;\n    // Y position: each semitone from top adds rowHeight\n    // The row center is at (rowIndex + 0.5) * rowHeight\n    // For continuous MIDI, we use the fractional part to position within row\n    return semitonesFromTop * rowHeight;\n}\n/**\n * Calculate the continuous MIDI value from a Y position in the grid.\n *\n * @param y Y position in pixels\n * @param config Grid configuration\n * @returns Continuous MIDI value\n */\nexport function gridYToMidi(y, config) {\n    const { topMidi, bottomMidi, gridHeight } = config;\n    const totalSemitones = topMidi - bottomMidi + 1;\n    const rowHeight = gridHeight / totalSemitones;\n    const semitonesFromTop = y / rowHeight;\n    return topMidi - semitonesFromTop;\n}\n/**\n * Get the Y position of a row center for a given MIDI note.\n *\n * @param midi Integer MIDI note\n * @param config Grid configuration\n * @returns Y position of row center in pixels\n */\nexport function getMidiRowCenterY(midi, config) {\n    const { topMidi, bottomMidi, gridHeight } = config;\n    const totalSemitones = topMidi - bottomMidi + 1;\n    const rowHeight = gridHeight / totalSemitones;\n    const rowIndex = topMidi - midi;\n    return (rowIndex + 0.5) * rowHeight;\n}\n/**\n * Get the row height for the grid configuration.\n *\n * @param config Grid configuration\n * @returns Row height in pixels\n */\nexport function getRowHeight(config) {\n    const { topMidi, bottomMidi, gridHeight } = config;\n    return gridHeight / (topMidi - bottomMidi + 1);\n}\n// ============================================================================\n// Pitch Accuracy and Thresholds\n// ============================================================================\n/**\n * Check if a sung pitch is within threshold of a target pitch.\n *\n * @param sungMidi The sung MIDI value (continuous)\n * @param targetMidi The target MIDI value (integer)\n * @param thresholdCents Acceptable deviation in cents\n * @returns True if within threshold\n *\n * @example\n * isPitchAccurate(69.1, 69, 25) // true (10 cents off, within 25)\n * isPitchAccurate(69.4, 69, 25) // false (40 cents off, outside 25)\n */\nexport function isPitchAccurate(sungMidi, targetMidi, thresholdCents) {\n    const centsOff = Math.abs(sungMidi - targetMidi) * CENTS_PER_SEMITONE;\n    return centsOff <= thresholdCents;\n}\n/**\n * Get a normalized accuracy score (0 to 1) for how close a sung pitch is to target.\n *\n * @param sungMidi The sung MIDI value\n * @param targetMidi The target MIDI value\n * @param maxDeviationCents Maximum deviation for score=0 (default: 100 = one semitone)\n * @returns Accuracy score (1 = perfect, 0 = at or beyond max deviation)\n */\nexport function getPitchAccuracyScore(sungMidi, targetMidi, maxDeviationCents = CENTS_PER_SEMITONE) {\n    const centsOff = Math.abs(sungMidi - targetMidi) * CENTS_PER_SEMITONE;\n    return Math.max(0, 1 - centsOff / maxDeviationCents);\n}\n/**\n * Get the signed cents deviation from a target pitch.\n *\n * @param sungMidi The sung MIDI value\n * @param targetMidi The target MIDI value\n * @returns Cents deviation (positive = sharp, negative = flat)\n */\nexport function getCentsDeviation(sungMidi, targetMidi) {\n    return (sungMidi - targetMidi) * CENTS_PER_SEMITONE;\n}\n// ============================================================================\n// Pitch Names\n// ============================================================================\nconst NOTE_NAMES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\nconst NOTE_NAMES_FLAT = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n/**\n * Get the note name from a MIDI number.\n *\n * @param midi MIDI note number\n * @param preferFlats Use flat names instead of sharp names\n * @returns Note name with octave (e.g., \"C4\", \"Bb3\")\n */\nexport function midiToNoteName(midi, preferFlats = false) {\n    const intMidi = Math.round(midi);\n    const noteIndex = ((intMidi % SEMITONES_PER_OCTAVE) + SEMITONES_PER_OCTAVE) % SEMITONES_PER_OCTAVE;\n    const octave = Math.floor(intMidi / SEMITONES_PER_OCTAVE) - 1;\n    const names = preferFlats ? NOTE_NAMES_FLAT : NOTE_NAMES;\n    return `${names[noteIndex]}${octave}`;\n}\n/**\n * Get the pitch class (0-11, C=0) from a MIDI number.\n *\n * @param midi MIDI note number\n * @returns Pitch class (0-11)\n */\nexport function midiToPitchClass(midi) {\n    return ((Math.round(midi) % SEMITONES_PER_OCTAVE) + SEMITONES_PER_OCTAVE) % SEMITONES_PER_OCTAVE;\n}\n/**\n * Get the octave number from a MIDI number.\n *\n * @param midi MIDI note number\n * @returns Octave number\n */\nexport function midiToOctave(midi) {\n    return Math.floor(Math.round(midi) / SEMITONES_PER_OCTAVE) - 1;\n}\n// ============================================================================\n// Frequency from Microphone Helpers\n// ============================================================================\n/**\n * Process a raw frequency from microphone input.\n * Clamps to reasonable singing range and handles edge cases.\n *\n * @param frequency Raw frequency in Hz\n * @param minHz Minimum valid frequency (default: 60 Hz, ~B1)\n * @param maxHz Maximum valid frequency (default: 1600 Hz, ~G6)\n * @returns Processed frequency or null if invalid/out of range\n */\nexport function processRawFrequency(frequency, minHz = 60, maxHz = 1600) {\n    if (!Number.isFinite(frequency) || frequency <= 0) {\n        return null;\n    }\n    if (frequency < minHz || frequency > maxHz) {\n        return null;\n    }\n    return frequency;\n}\n/**\n * Convert a frequency to full pitch information.\n *\n * @param frequency Frequency in Hz\n * @returns Pitch information object\n */\nexport function frequencyToPitchInfo(frequency) {\n    const midi = frequencyToMidi(frequency);\n    const nearestMidi = getNearestMidi(midi);\n    const centsOffset = getCentsOffset(midi);\n    return {\n        frequency,\n        midi,\n        nearestMidi,\n        centsOffset,\n        noteName: midiToNoteName(nearestMidi),\n        pitchClass: midiToPitchClass(nearestMidi),\n        octave: midiToOctave(nearestMidi),\n    };\n}\n","/**\r\n * Reference Audio Service\r\n *\r\n * Plays sine wave reference tones for the demo exercise.\r\n */\r\n\r\nimport * as Tone from 'tone';\r\n\r\nclass ReferenceAudioService {\r\n  private synth: Tone.Synth | null = null;\r\n  private scheduledTimeouts: number[] = []; // Store timeout IDs for cleanup\r\n  private volume: Tone.Volume | null = null;\r\n  private startTime: number = 0; // Performance.now() when playback started\r\n  private _isPlaying: boolean = false; // Track if a reference tone is currently playing\r\n\r\n  /**\r\n   * Check if a reference tone is currently playing\r\n   */\r\n  get isPlaying(): boolean {\r\n    return this._isPlaying;\r\n  }\r\n\r\n  /**\r\n   * Initialize the audio service\r\n   */\r\n  async init(): Promise<void> {\r\n    await Tone.start();\r\n\r\n    // Create volume node\r\n    this.volume = new Tone.Volume(-12).toDestination();\r\n\r\n    // Create synth with triangle wave (less likely to be picked up by mic as same frequency)\r\n    this.synth = new Tone.Synth({\r\n      oscillator: { type: 'triangle' },\r\n      envelope: {\r\n        attack: 0.05,\r\n        decay: 0.1,\r\n        sustain: 0.9,\r\n        release: 0.1,\r\n      },\r\n    }).connect(this.volume);\r\n  }\r\n\r\n  /**\r\n   * Set reference tone volume\r\n   */\r\n  setVolume(dB: number): void {\r\n    if (this.volume) {\r\n      this.volume.volume.value = dB;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Schedule all reference tones for the exercise\r\n   * Uses setTimeout for precise timing aligned with the highway animation\r\n   */\r\n  scheduleReferenceTones(\r\n    notes: Array<{ midi: number; startTimeMs: number; durationMs: number }>\r\n  ): void {\r\n    if (!this.synth) {\r\n      console.warn('[ReferenceAudio] Synth not initialized');\r\n      return;\r\n    }\r\n\r\n    // Clear any existing scheduled notes\r\n    this.clearScheduled();\r\n\r\n    // Record start time for synchronization\r\n    this.startTime = performance.now();\r\n\r\n    notes.forEach((note) => {\r\n      const duration = note.durationMs / 1000;\r\n      const frequency = Tone.Frequency(note.midi, 'midi').toFrequency();\r\n\r\n      // Schedule the note start\r\n      const startTimeoutId = window.setTimeout(() => {\r\n        if (this.synth) {\r\n          console.log(`[ReferenceAudio] Playing ${note.midi} at ${performance.now() - this.startTime}ms`);\r\n          this._isPlaying = true;\r\n          this.synth.triggerAttackRelease(frequency, duration);\r\n        }\r\n      }, note.startTimeMs);\r\n\r\n      // Schedule the note end (to clear isPlaying flag)\r\n      const endTimeoutId = window.setTimeout(() => {\r\n        this._isPlaying = false;\r\n      }, note.startTimeMs + note.durationMs);\r\n\r\n      this.scheduledTimeouts.push(startTimeoutId, endTimeoutId);\r\n    });\r\n\r\n    console.log(`[ReferenceAudio] Scheduled ${notes.length} reference tones`);\r\n  }\r\n\r\n  /**\r\n   * Play a single reference tone immediately\r\n   */\r\n  playTone(midi: number, durationMs: number): void {\r\n    if (!this.synth) {\r\n      console.warn('[ReferenceAudio] Synth not initialized');\r\n      return;\r\n    }\r\n\r\n    const frequency = Tone.Frequency(midi, 'midi').toFrequency();\r\n    const duration = durationMs / 1000;\r\n    this.synth.triggerAttackRelease(frequency, duration);\r\n  }\r\n\r\n  /**\r\n   * Clear all scheduled notes\r\n   */\r\n  clearScheduled(): void {\r\n    this.scheduledTimeouts.forEach((timeoutId) => {\r\n      window.clearTimeout(timeoutId);\r\n    });\r\n    this.scheduledTimeouts = [];\r\n  }\r\n\r\n  /**\r\n   * Stop all audio\r\n   */\r\n  stop(): void {\r\n    this.clearScheduled();\r\n    if (this.synth) {\r\n      this.synth.triggerRelease();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose of audio resources\r\n   */\r\n  dispose(): void {\r\n    this.stop();\r\n    if (this.synth) {\r\n      this.synth.dispose();\r\n      this.synth = null;\r\n    }\r\n    if (this.volume) {\r\n      this.volume.dispose();\r\n      this.volume = null;\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const referenceAudio = new ReferenceAudioService();\r\n","/**\n * Pitch Detection Service\n *\n * Uses Pitchy.js for real-time pitch detection from microphone input.\n * Ported from the original JavaScript implementation.\n */\n\nimport * as Tone from 'tone';\nimport { PitchDetector } from 'pitchy';\nimport { getCentsOffset, getNearestMidi, midiToPitchClass } from '@mlt/pitch-utils';\nimport { pitchState, type DetectedPitch } from '../stores/pitchState.svelte.js';\nimport { highwayState } from '../stores/highwayState.svelte.js';\nimport { referenceAudio } from './referenceAudio.js';\n\n// Configuration\nconst CONFIG = {\n  FFT_SIZE: 2048,\n  CLARITY_THRESHOLD: 0.8,\n  MIN_PITCH_HZ: 60,\n  MAX_PITCH_HZ: 1600,\n  HIGHLIGHT_CENTS_RANGE: 50,\n  MIN_VOLUME_DB: -60,\n} as const;\n\n// Module state\nlet mic: Tone.UserMedia | null = null;\nlet analyser: Tone.Analyser | null = null;\nlet detector: ReturnType<typeof PitchDetector.forFloat32Array> | null = null;\nlet animationFrameId: number | null = null;\nlet isRunning = false;\n\nconst HIGHLIGHT_DEFAULT_SIZE = 1.0;\n\n/**\n * Convert frequency in Hz to MIDI note number\n */\nfunction frequencyToMidi(frequency: number): number {\n  return 12 * Math.log2(frequency / 440) + 69;\n}\n\n/**\n * The main detection and animation loop\n */\nfunction animationLoop(): void {\n  if (!isRunning || !analyser || !detector) {\n    animationFrameId = null;\n    return;\n  }\n\n  // Skip pitch detection while reference tone is playing (avoid mic picking up speakers)\n  if (referenceAudio.isPlaying) {\n    // Still add a silent history point to keep the trail continuous\n    pitchState.addHistoryPoint({\n      frequency: 0,\n      midi: 0,\n      time: performance.now(),\n      clarity: 0,\n    });\n    animationFrameId = requestAnimationFrame(animationLoop);\n    return;\n  }\n\n  // Get pitch from audio\n  const waveform = analyser.getValue() as Float32Array;\n  const [pitch, clarity] = detector.findPitch(waveform, Tone.getContext().sampleRate);\n\n  const isValidPitch =\n    pitch !== null &&\n    clarity > CONFIG.CLARITY_THRESHOLD &&\n    pitch > CONFIG.MIN_PITCH_HZ &&\n    pitch < CONFIG.MAX_PITCH_HZ;\n\n  // Update pitch state\n  if (isValidPitch) {\n    const midi = frequencyToMidi(pitch);\n    const detectedPitch: DetectedPitch = {\n      frequency: pitch,\n      midi,\n      clarity,\n      pitchClass: Math.round(midi) % 12,\n    };\n    pitchState.setCurrentPitch(detectedPitch);\n    pitchState.addHistoryPoint({\n      frequency: pitch,\n      midi,\n      time: performance.now(),\n      clarity,\n    });\n\n    // Record pitch input for highway performance tracking\n    highwayState.recordPitchInput(midi, clarity);\n  } else {\n    pitchState.addHistoryPoint({\n      frequency: 0,\n      midi: 0,\n      time: performance.now(),\n      clarity: 0,\n    });\n  }\n\n  // Highlight opacity based on cents deviation from nearest pitch\n  if (isValidPitch && pitchState.state.currentPitch) {\n    const midi = pitchState.state.currentPitch.midi;\n    const nearestMidi = getNearestMidi(midi);\n    const centsOffset = getCentsOffset(midi);\n    const centsDistance = Math.min(Math.abs(centsOffset), CONFIG.HIGHLIGHT_CENTS_RANGE);\n    const opacity = Math.max(0, 1 - (centsDistance / CONFIG.HIGHLIGHT_CENTS_RANGE));\n\n    pitchState.setStablePitch({\n      pitchClass: midiToPitchClass(nearestMidi),\n      midi: nearestMidi,\n      opacity,\n      size: HIGHLIGHT_DEFAULT_SIZE,\n    });\n  } else {\n    pitchState.setStablePitch({ pitchClass: null, midi: null, opacity: 0, size: HIGHLIGHT_DEFAULT_SIZE });\n  }\n\n  // Request next frame\n  animationFrameId = requestAnimationFrame(animationLoop);\n}\n\n/**\n * Start pitch detection from microphone\n */\nexport async function startDetection(): Promise<void> {\n  if (isRunning) return;\n\n  // Cancel any existing animation frame\n  if (animationFrameId !== null) {\n    cancelAnimationFrame(animationFrameId);\n  }\n\n  // Create audio nodes\n  mic = new Tone.UserMedia();\n  analyser = new Tone.Analyser('waveform', CONFIG.FFT_SIZE);\n  detector = PitchDetector.forFloat32Array(analyser.size);\n\n  try {\n    await Tone.start(); // Initialize audio context\n    await mic.open();\n    mic.connect(analyser);\n    isRunning = true;\n    animationLoop();\n  } catch (err) {\n    console.error('Microphone access denied or failed:', err);\n    cleanup();\n    throw err;\n  }\n}\n\n/**\n * Stop pitch detection\n */\nexport function stopDetection(): void {\n  isRunning = false;\n  cleanup();\n}\n\n/**\n * Clean up audio resources\n */\nfunction cleanup(): void {\n  if (animationFrameId !== null) {\n    cancelAnimationFrame(animationFrameId);\n    animationFrameId = null;\n  }\n\n  if (mic) {\n    mic.close();\n    mic = null;\n  }\n\n  analyser = null;\n  detector = null;\n\n  pitchState.setStablePitch({ pitchClass: null, midi: null, opacity: 0, size: HIGHLIGHT_DEFAULT_SIZE });\n  pitchState.setCurrentPitch(null);\n}\n\n/**\n * Check if detection is currently running\n */\nexport function isDetecting(): boolean {\n  return isRunning;\n}\n","/**\n * Drone Audio Service\n *\n * Provides a sustained drone tone using Tone.js for pitch reference.\n */\n\nimport * as Tone from 'tone';\nimport { appState } from '../stores/appState.svelte.js';\n\n// Module state\nlet synth: Tone.PolySynth | null = null;\nlet isPlaying = false;\nlet currentNote: string | null = null;\n\n// Note name mapping\nconst NOTE_NAMES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n\n/**\n * Initialize the drone synth\n */\nfunction ensureSynth(): Tone.PolySynth {\n  if (!synth) {\n    synth = new Tone.PolySynth(Tone.Synth, {\n      oscillator: { type: 'sawtooth' },\n      envelope: {\n        attack: 0.3,\n        decay: 0.1,\n        sustain: 0.8,\n        release: 0.5,\n      },\n    }).toDestination();\n    const oscillatorType = synth.get().oscillator?.type ?? 'unknown';\n    console.log('[DroneAudio] Initialized drone synth', { oscillatorType });\n  }\n  return synth;\n}\n\n/**\n * Get the note name with octave from tonic and octave\n */\nfunction getNoteName(tonic: string, octave: number): string {\n  // Normalize tonic (handle flats)\n  const normalizedTonic = tonic.replace('b', '#').replace('Db', 'C#').replace('Eb', 'D#')\n    .replace('Gb', 'F#').replace('Ab', 'G#').replace('Bb', 'A#');\n  return `${normalizedTonic}${octave}`;\n}\n\n/**\n * Start playing the drone\n */\nexport async function startDrone(): Promise<void> {\n  // Ensure audio context is started (required for browsers)\n  await Tone.start();\n\n  const s = ensureSynth();\n  const note = getNoteName(appState.state.tonic, appState.state.drone.octave);\n\n  // Set volume (convert from dB scale used in app to Tone.js scale)\n  s.volume.value = appState.state.drone.volume;\n  console.log('[DroneAudio] Starting drone', {\n    note,\n    volume: s.volume.value,\n  });\n\n  // Release any current note before starting new one\n  if (currentNote) {\n    s.releaseAll();\n  }\n\n  currentNote = note;\n  s.triggerAttack(note);\n  isPlaying = true;\n}\n\n/**\n * Stop the drone\n */\nexport function stopDrone(): void {\n  if (synth && isPlaying) {\n    synth.releaseAll();\n    currentNote = null;\n    isPlaying = false;\n  }\n}\n\n/**\n * Update drone parameters (tonic, octave, volume)\n */\nexport function updateDrone(): void {\n  if (!isPlaying || !synth) return;\n\n  const newNote = getNoteName(appState.state.tonic, appState.state.drone.octave);\n  synth.volume.value = appState.state.drone.volume;\n  console.log('[DroneAudio] Updating drone', {\n    note: newNote,\n    volume: synth.volume.value,\n  });\n\n  if (newNote !== currentNote) {\n    synth.releaseAll();\n    synth.triggerAttack(newNote);\n    currentNote = newNote;\n  }\n}\n\n/**\n * Toggle drone on/off\n */\nexport async function toggleDrone(): Promise<void> {\n  if (isPlaying) {\n    stopDrone();\n  } else {\n    await startDrone();\n  }\n}\n\n/**\n * Check if drone is playing\n */\nexport function isDronePlaying(): boolean {\n  return isPlaying;\n}\n\n/**\n * Clean up resources\n */\nexport function dispose(): void {\n  stopDrone();\n  if (synth) {\n    synth.dispose();\n    synth = null;\n  }\n}\n","<script lang=\"ts\">\n  /**\n   * TonicSelector Component\n   *\n   * Dropdown for selecting the tonic/key center.\n   */\n\n  import { appState, type TonicNote } from '../../stores/appState.svelte.js';\n  import { updateDrone } from '../../services/droneAudio.js';\n\n  const TONIC_OPTIONS: TonicNote[] = [\n    'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'\n  ];\n\n  function handleChange(event: Event) {\n    const target = event.target as HTMLSelectElement;\n    appState.setTonic(target.value as TonicNote);\n    updateDrone();\n  }\n</script>\n\n<div class=\"tonic-selector\">\n  <label for=\"tonic-select\">Key:</label>\n  <select\n    id=\"tonic-select\"\n    value={appState.state.tonic}\n    onchange={handleChange}\n  >\n    {#each TONIC_OPTIONS as tonic}\n      <option value={tonic}>{tonic}</option>\n    {/each}\n  </select>\n</div>\n\n<style>\n  .tonic-selector {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-sm);\n  }\n\n  label {\n    font-weight: 500;\n    color: var(--color-text-muted);\n  }\n\n  select {\n    padding: var(--spacing-sm) var(--spacing-md);\n    font-size: var(--font-size-base);\n    color: var(--color-text);\n    background-color: var(--color-surface);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: var(--radius-sm);\n    cursor: pointer;\n    min-width: 70px;\n  }\n\n  select:hover {\n    border-color: var(--color-secondary);\n  }\n\n  select:focus {\n    outline: none;\n    border-color: var(--color-secondary);\n    box-shadow: 0 0 0 2px rgba(0, 217, 255, 0.2);\n  }\n</style>\n","<script lang=\"ts\">\n  /**\n   * DroneControls Component\n   *\n   * Controls for the drone reference tone.\n   */\n\n  import { appState } from '../../stores/appState.svelte.js';\n  import { toggleDrone, updateDrone } from '../../services/droneAudio.js';\n\n  const OCTAVE_OPTIONS = [2, 3, 4, 5];\n\n  async function handleToggle() {\n    await toggleDrone();\n    appState.toggleDrone();\n  }\n\n  function handleOctaveChange(event: Event) {\n    const target = event.target as HTMLSelectElement;\n    appState.setDroneOctave(parseInt(target.value, 10));\n    updateDrone();\n  }\n\n  function handleVolumeChange(event: Event) {\n    const target = event.target as HTMLInputElement;\n    appState.setDroneVolume(parseInt(target.value, 10));\n    updateDrone();\n  }\n</script>\n\n<div class=\"drone-controls\">\n  <button\n    class=\"drone-toggle\"\n    class:active={appState.state.drone.isPlaying}\n    onclick={handleToggle}\n  >\n    {appState.state.drone.isPlaying ? 'Drone On' : 'Drone Off'}\n  </button>\n\n  <div class=\"drone-settings\">\n    <label>\n      Oct:\n      <select value={appState.state.drone.octave} onchange={handleOctaveChange}>\n        {#each OCTAVE_OPTIONS as oct}\n          <option value={oct}>{oct}</option>\n        {/each}\n      </select>\n    </label>\n\n    <label>\n      Vol:\n      <input\n        type=\"range\"\n        min=\"-40\"\n        max=\"0\"\n        value={appState.state.drone.volume}\n        oninput={handleVolumeChange}\n      />\n    </label>\n  </div>\n</div>\n\n<style>\n  .drone-controls {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n  }\n\n  .drone-toggle {\n    padding: var(--spacing-sm) var(--spacing-md);\n    font-size: var(--font-size-sm);\n    font-weight: 500;\n    color: var(--color-text);\n    background-color: var(--color-surface);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: var(--radius-sm);\n    transition: all 0.2s ease;\n  }\n\n  .drone-toggle:hover {\n    border-color: var(--color-secondary);\n  }\n\n  .drone-toggle.active {\n    background-color: var(--color-secondary);\n    color: var(--color-bg);\n    border-color: var(--color-secondary);\n  }\n\n  .drone-settings {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n  }\n\n  label {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-xs);\n    font-size: var(--font-size-sm);\n    color: var(--color-text-muted);\n  }\n\n  select {\n    padding: var(--spacing-xs) var(--spacing-sm);\n    font-size: var(--font-size-sm);\n    color: var(--color-text);\n    background-color: var(--color-surface);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: var(--radius-sm);\n    cursor: pointer;\n  }\n\n  input[type='range'] {\n    width: 80px;\n    height: 4px;\n    cursor: pointer;\n  }\n</style>\n","<script lang=\"ts\">\n\t/**\n\t * PitchWheel Component\n\t *\n\t * A scrollable wheel picker for selecting pitches.\n\t * Supports mouse drag, wheel scrolling, and keyboard navigation.\n\t */\n\timport type { WheelOption } from './types.js';\n\n\tinterface Props {\n\t\toptions: WheelOption[];\n\t\tselectedIndex: number;\n\t\tonchange?: (index: number, option: WheelOption) => void;\n\t\tonbeforechange?: (requestedIndex: number) => number;\n\t\twheelHeight?: number;\n\t\tariaLabel?: string;\n\t}\n\n\tlet {\n\t\toptions,\n\t\tselectedIndex = $bindable(),\n\t\tonchange,\n\t\tonbeforechange,\n\t\twheelHeight,\n\t\tariaLabel = 'Pitch selector'\n\t}: Props = $props();\n\n\tconst OPTION_HEIGHT = 40;\n\tconst SCROLL_STEP = OPTION_HEIGHT;\n\n\t// Component state\n\tlet wheelElement: HTMLDivElement | undefined = $state();\n\tlet viewportElement: HTMLDivElement | undefined = $state();\n\tlet optionsElement: HTMLDivElement | undefined = $state();\n\tlet pointerActive = $state(false);\n\tlet pointerId: number | null = $state(null);\n\tlet lastPointerY = $state(0);\n\tlet deltaBuffer = $state(0);\n\tlet measuredOptionHeight = $state(OPTION_HEIGHT);\n\n\t// Derived values\n\tconst optionDistances = $derived(\n\t\toptions.map((_, index) => Math.min(Math.abs(index - selectedIndex), 3))\n\t);\n\n\tconst viewportHeight = $derived(viewportElement?.clientHeight ?? 0);\n\tconst padding = $derived(Math.max(0, (viewportHeight - measuredOptionHeight) / 2));\n\t// centerOffset must include padding since it's applied to the options container\n\tconst centerOffset = $derived(padding + selectedIndex * measuredOptionHeight + measuredOptionHeight / 2);\n\t// Only apply translateY when we have valid viewport dimensions to avoid incorrect positioning\n\tconst translateY = $derived(viewportHeight > 0 ? viewportHeight / 2 - centerOffset : 0);\n\n\t// Set index with optional constraint callback\n\tfunction setIndex(index: number) {\n\t\tif (!options || options.length === 0) return;\n\n\t\t// Allow parent to pre-validate/constrain the requested index\n\t\tlet targetIndex = index;\n\t\tif (typeof onbeforechange === 'function') {\n\t\t\ttargetIndex = onbeforechange(index);\n\t\t}\n\n\t\tconst clampedIndex = Math.max(0, Math.min(options.length - 1, targetIndex));\n\t\tif (clampedIndex === selectedIndex) return;\n\n\t\tselectedIndex = clampedIndex;\n\n\t\tif (typeof onchange === 'function') {\n\t\t\tconst option = options[clampedIndex];\n\t\t\tif (option) {\n\t\t\t\tonchange(clampedIndex, option);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction increment(step: number) {\n\t\tif (step === 0) return;\n\t\tsetIndex(selectedIndex + step);\n\t}\n\n\t// Event handlers\n\tfunction handleWheel(event: WheelEvent) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tconst delta = Math.sign(event.deltaY);\n\t\tif (delta !== 0) {\n\t\t\tincrement(delta);\n\t\t}\n\t}\n\n\tfunction handleKeydown(event: KeyboardEvent) {\n\t\tif (event.key === 'ArrowUp') {\n\t\t\tevent.preventDefault();\n\t\t\tincrement(-1);\n\t\t} else if (event.key === 'ArrowDown') {\n\t\t\tevent.preventDefault();\n\t\t\tincrement(1);\n\t\t} else if (event.key === 'Home') {\n\t\t\tevent.preventDefault();\n\t\t\tsetIndex(0);\n\t\t} else if (event.key === 'End') {\n\t\t\tevent.preventDefault();\n\t\t\tsetIndex(options.length - 1);\n\t\t}\n\t}\n\n\tfunction handlePointerDown(event: PointerEvent) {\n\t\tevent.preventDefault();\n\t\tpointerActive = true;\n\t\tpointerId = event.pointerId;\n\t\tlastPointerY = event.clientY;\n\t\tdeltaBuffer = 0;\n\t\tif (wheelElement && typeof wheelElement.setPointerCapture === 'function') {\n\t\t\ttry {\n\t\t\t\twheelElement.setPointerCapture(event.pointerId);\n\t\t\t} catch {\n\t\t\t\t// ignore\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handlePointerMove(event: PointerEvent) {\n\t\tif (!pointerActive || event.pointerId !== pointerId) return;\n\n\t\tconst deltaY = event.clientY - lastPointerY;\n\t\tlastPointerY = event.clientY;\n\t\tif (deltaY === 0) return;\n\n\t\tdeltaBuffer += deltaY;\n\t\tconst step = measuredOptionHeight || SCROLL_STEP;\n\t\twhile (Math.abs(deltaBuffer) >= step) {\n\t\t\tconst direction = -Math.sign(deltaBuffer); // drag down = scroll up\n\t\t\tincrement(direction);\n\t\t\tdeltaBuffer -= Math.sign(deltaBuffer) * step;\n\t\t}\n\t}\n\n\tfunction handlePointerEnd(event: PointerEvent) {\n\t\tif (pointerActive && event.pointerId === pointerId) {\n\t\t\tpointerActive = false;\n\t\t\tpointerId = null;\n\t\t\tdeltaBuffer = 0;\n\t\t\tif (wheelElement?.hasPointerCapture?.(event.pointerId)) {\n\t\t\t\twheelElement.releasePointerCapture(event.pointerId);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Measure option height effect\n\t$effect(() => {\n\t\tif (!optionsElement || !viewportElement) return;\n\n\t\tconst measureHeight = () => {\n\t\t\tconst firstOption = optionsElement?.querySelector('.pitch-wheel-option') as HTMLElement;\n\t\t\tif (firstOption) {\n\t\t\t\tmeasuredOptionHeight = firstOption.offsetHeight || OPTION_HEIGHT;\n\t\t\t}\n\t\t};\n\n\t\t// Initial measurement\n\t\tmeasureHeight();\n\n\t\t// Observe size changes\n\t\tconst resizeObserver = new ResizeObserver(() => {\n\t\t\tmeasureHeight();\n\t\t});\n\n\t\tresizeObserver.observe(viewportElement);\n\n\t\treturn () => {\n\t\t\tresizeObserver.disconnect();\n\t\t};\n\t});\n</script>\n\n<div\n\tbind:this={wheelElement}\n\tclass=\"pitch-wheel\"\n\trole=\"slider\"\n\ttabindex=\"0\"\n\taria-label={ariaLabel}\n\taria-valuemin=\"0\"\n\taria-valuemax={options.length - 1}\n\taria-valuenow={selectedIndex}\n\taria-valuetext={options[selectedIndex]?.label ?? ''}\n\tstyle:height={wheelHeight ? `${wheelHeight}px` : '100%'}\n\tonwheel={handleWheel}\n\tonkeydown={handleKeydown}\n\tonpointerdown={handlePointerDown}\n\tonpointermove={handlePointerMove}\n\tonpointerup={handlePointerEnd}\n\tonpointercancel={handlePointerEnd}\n\tonpointerleave={handlePointerEnd}\n>\n\t<div bind:this={viewportElement} class=\"pitch-wheel-viewport\">\n\t\t<div\n\t\t\tbind:this={optionsElement}\n\t\t\tclass=\"pitch-wheel-options\"\n\t\t\tstyle:padding-top=\"{padding}px\"\n\t\t\tstyle:padding-bottom=\"{padding}px\"\n\t\t\tstyle:transform=\"translateY({translateY}px)\"\n\t\t>\n\t\t\t{#each options as option, index (option.index)}\n\t\t\t\t<div class=\"pitch-wheel-option\" data-distance={optionDistances[index]}>\n\t\t\t\t\t{option.label}\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\t</div>\n\t<div class=\"pitch-wheel-overlay\"></div>\n</div>\n\n<style>\n\t.pitch-wheel {\n\t\tposition: relative;\n\t\tborder-radius: 18px;\n\t\tbackground: linear-gradient(180deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 249, 250, 0.85) 100%);\n\t\tborder: 1px solid rgba(0, 0, 0, 0.05);\n\t\tbox-shadow: 0 10px 30px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.5);\n\t\tmin-height: 0;\n\t\twidth: clamp(70px, 8dvw, 90px);\n\t\tmin-width: 0;\n\t\toutline: none;\n\t\tcursor: grab;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\ttransition: box-shadow 0.2s ease, border-color 0.2s ease;\n\t\ttouch-action: none;\n\t}\n\n\t.pitch-wheel:focus-visible {\n\t\tborder-color: #ffc107;\n\t\tbox-shadow: 0 0 0 3px rgba(255, 193, 7, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.6);\n\t}\n\n\t.pitch-wheel:active {\n\t\tcursor: grabbing;\n\t}\n\n\t.pitch-wheel-viewport {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\toverflow: hidden;\n\t\tdisplay: flex;\n\t\talign-items: stretch;\n\t\tjustify-content: center;\n\t\ttouch-action: none;\n\t}\n\n\t.pitch-wheel-options {\n\t\tposition: relative;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\twidth: 100%;\n\t\ttransform: translateY(0);\n\t\ttransition: transform 0.18s ease-out;\n\t\twill-change: transform;\n\t}\n\n\t.pitch-wheel-option {\n\t\twidth: 100%;\n\t\ttext-align: center;\n\t\theight: 40px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 0.8rem;\n\t\tfont-weight: 500;\n\t\tcolor: #212529;\n\t\tuser-select: none;\n\t\tpointer-events: none;\n\t\ttransform-origin: center;\n\t\ttransition:\n\t\t\tcolor 0.18s ease-out,\n\t\t\ttransform 0.18s ease-out,\n\t\t\topacity 0.18s ease-out;\n\t\topacity: 0.4;\n\t}\n\n\t.pitch-wheel-option[data-distance='0'] {\n\t\tfont-size: 0.95rem;\n\t\tfont-weight: 700;\n\t\tcolor: #000000;\n\t\topacity: 1;\n\t}\n\n\t.pitch-wheel-option[data-distance='1'] {\n\t\topacity: 0.6;\n\t\ttransform: scale(0.95);\n\t}\n\n\t.pitch-wheel-option[data-distance='2'] {\n\t\topacity: 0.5;\n\t\ttransform: scale(0.9);\n\t}\n\n\t.pitch-wheel-overlay {\n\t\tposition: absolute;\n\t\tinset: 0;\n\t\tpointer-events: none;\n\t\tbackground: linear-gradient(\n\t\t\t180deg,\n\t\t\trgba(248, 249, 250, 0.92) 0%,\n\t\t\trgba(255, 255, 255, 0) 20%,\n\t\t\trgba(255, 255, 255, 0) 80%,\n\t\t\trgba(248, 249, 250, 0.92) 100%\n\t\t);\n\t\tborder-radius: 18px;\n\t}\n\n\t.pitch-wheel-overlay::before {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tleft: 0%;\n\t\tright: 0%;\n\t\ttop: 50%;\n\t\theight: 30px;\n\t\tborder-radius: 16px;\n\t\tborder: 1px solid rgba(255, 193, 7, 0.35);\n\t\tbackground: rgba(255, 193, 7, 0.12);\n\t\ttransform: translateY(-50%);\n\t\tbox-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.4);\n\t}\n</style>\n","<script lang=\"ts\">\r\n\t/**\r\n\t * PresetButtons Component\r\n\t *\r\n\t * Renders a set of preset buttons for quick range selection.\r\n\t * Highlights the active preset when the current range matches.\r\n\t */\r\n\timport type { PitchRangePreset } from './types.js';\r\n\r\n\tinterface Props {\r\n\t\tpresets: PitchRangePreset[];\r\n\t\tactivePreset?: string;\r\n\t\tonPresetClick: (preset: PitchRangePreset) => void;\r\n\t}\r\n\r\n\tlet { presets, activePreset, onPresetClick }: Props = $props();\r\n\r\n\tfunction handleClick(preset: PitchRangePreset) {\r\n\t\tonPresetClick(preset);\r\n\t}\r\n</script>\r\n\r\n<div class=\"preset-buttons\">\r\n\t{#each presets as preset}\r\n\t\t<button\r\n\t\t\tclass=\"preset-button\"\r\n\t\t\tclass:active={activePreset === preset.label}\r\n\t\t\tonclick={() => handleClick(preset)}\r\n\t\t\ttype=\"button\"\r\n\t\t>\r\n\t\t\t{preset.label}\r\n\t\t</button>\r\n\t{/each}\r\n</div>\r\n\r\n<style>\r\n\t.preset-buttons {\r\n\t\tdisplay: flex;\r\n\t\tgap: 6px;\r\n\t\tflex-wrap: wrap;\r\n\t\tjustify-content: center;\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.preset-button {\r\n\t\tpadding: 6px 12px;\r\n\t\tfont-size: 0.7rem;\r\n\t\tfont-weight: 600;\r\n\t\tcolor: rgba(33, 37, 41, 0.8);\r\n\t\tbackground: rgba(255, 255, 255, 0.6);\r\n\t\tborder: 1px solid rgba(0, 0, 0, 0.1);\r\n\t\tborder-radius: 8px;\r\n\t\tcursor: pointer;\r\n\t\ttransition:\r\n\t\t\tall 0.15s ease-out;\r\n\t\tbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\r\n\t\tuser-select: none;\r\n\t\tletter-spacing: 0.3px;\r\n\t}\r\n\r\n\t.preset-button:hover {\r\n\t\tbackground: rgba(255, 255, 255, 0.85);\r\n\t\tborder-color: rgba(255, 193, 7, 0.3);\r\n\t\ttransform: translateY(-1px);\r\n\t\tbox-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.preset-button:active {\r\n\t\ttransform: translateY(0);\r\n\t\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\r\n\t}\r\n\r\n\t.preset-button.active {\r\n\t\tbackground: rgba(255, 193, 7, 0.25);\r\n\t\tborder-color: rgba(255, 193, 7, 0.5);\r\n\t\tcolor: #000;\r\n\t\tfont-weight: 700;\r\n\t\tbox-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);\r\n\t}\r\n\r\n\t.preset-button.active:hover {\r\n\t\tbackground: rgba(255, 193, 7, 0.35);\r\n\t}\r\n</style>\r\n","import type { PitchRowData } from '@mlt/types';\nimport type { WheelOption, PitchRangePreset } from './types.js';\n\nconst DEFAULT_MIN_SPAN = 7; // Default minimum span\n\nfunction clampInt(value: number, min: number, max: number): number {\n\tif (!Number.isFinite(value)) {\n\t\treturn min;\n\t}\n\treturn Math.max(min, Math.min(max, Math.round(value)));\n}\n\n/**\n * Computes the constrained top index for a wheel picker.\n * Ensures the top index doesn't get too close to the bottom index (maintains minimum span).\n *\n * @param currentBottomIndex - Current bottom wheel index\n * @param requestedTop - Requested top index\n * @param totalOptions - Total number of options\n * @param minSpan - Minimum span between top and bottom (default 7)\n * @returns Constrained top index\n */\nexport function computeConstrainedTopIndex(\n\tcurrentBottomIndex: number,\n\trequestedTop: number,\n\ttotalOptions: number,\n\tminSpan = DEFAULT_MIN_SPAN\n): number {\n\tconst maxIndex = Math.max(0, totalOptions - 1);\n\tconst bottomIndex = clampInt(currentBottomIndex, 0, maxIndex);\n\tconst normalizedMinSpan = Math.max(1, Math.round(minSpan));\n\tconst maxTop = Math.max(0, bottomIndex - (normalizedMinSpan - 1));\n\treturn clampInt(requestedTop, 0, maxTop);\n}\n\n/**\n * Computes the constrained bottom index for a wheel picker.\n * Ensures the bottom index doesn't get too close to the top index (maintains minimum span).\n *\n * @param currentTopIndex - Current top wheel index\n * @param requestedBottom - Requested bottom index\n * @param totalOptions - Total number of options\n * @param minSpan - Minimum span between top and bottom (default 7)\n * @returns Constrained bottom index\n */\nexport function computeConstrainedBottomIndex(\n\tcurrentTopIndex: number,\n\trequestedBottom: number,\n\ttotalOptions: number,\n\tminSpan = DEFAULT_MIN_SPAN\n): number {\n\tconst maxIndex = Math.max(0, totalOptions - 1);\n\tconst topIndex = clampInt(currentTopIndex, 0, maxIndex);\n\tconst normalizedMinSpan = Math.max(1, Math.round(minSpan));\n\tconst minBottom = Math.min(maxIndex, topIndex + (normalizedMinSpan - 1));\n\treturn clampInt(requestedBottom, minBottom, maxIndex);\n}\n\n/**\n * Converts PitchRowData array to WheelOption array for use in wheel pickers.\n *\n * @param pitchRowData - Array of pitch row data\n * @returns Array of wheel options\n */\nexport function createWheelOptions(pitchRowData: PitchRowData[]): WheelOption[] {\n\treturn pitchRowData.map((row, index) => ({\n\t\tindex,\n\t\tlabel: row.pitch,\n\t\tmidi: row.midi,\n\t\ttoneNote: row.toneNote,\n\t\tfrequency: row.frequency\n\t}));\n}\n\n/**\n * Finds the index of a pitch by MIDI number in the pitch data array.\n *\n * @param pitchData - Array of pitch row data\n * @param midiNumber - MIDI note number to find\n * @returns Index of the pitch, or 0 if not found\n */\nfunction findMidiIndex(pitchData: readonly PitchRowData[], midiNumber: number): number {\n\tconst index = pitchData.findIndex((p) => p.midi === midiNumber);\n\treturn index >= 0 ? index : 0;\n}\n\n/**\n * Creates voice range presets for singing applications.\n * Voice I: A3 to A5 (MIDI 57-81)\n * Voice II: C3 to C5 (MIDI 48-72)\n * Voice III: E2 to E4 (MIDI 40-64)\n *\n * @param pitchData - Array of pitch row data (should be 88-key piano range)\n * @returns Array of voice preset configurations\n */\nexport function createVoicePresets(pitchData: readonly PitchRowData[]): PitchRangePreset[] {\n\treturn [\n\t\t{\n\t\t\tlabel: 'Voice I',\n\t\t\ttopIndex: findMidiIndex(pitchData, 81), // A5\n\t\t\tbottomIndex: findMidiIndex(pitchData, 57) // A3\n\t\t},\n\t\t{\n\t\t\tlabel: 'Voice II',\n\t\t\ttopIndex: findMidiIndex(pitchData, 72), // C5\n\t\t\tbottomIndex: findMidiIndex(pitchData, 48) // C3\n\t\t},\n\t\t{\n\t\t\tlabel: 'Voice III',\n\t\t\ttopIndex: findMidiIndex(pitchData, 64), // E4\n\t\t\tbottomIndex: findMidiIndex(pitchData, 40) // E2\n\t\t}\n\t];\n}\n\n/**\n * Creates standard clef range presets for notation applications.\n * Full Range: A0 to C8\n * Treble: C4 to G5 (MIDI 60-79)\n * Alto: D3 to A4 (MIDI 62-69)\n * Bass: E2 to C4 (MIDI 40-60)\n *\n * @param pitchData - Array of pitch row data (should be 88-key piano range)\n * @returns Array of clef preset configurations\n */\nexport function createRangePresets(pitchData: readonly PitchRowData[]): PitchRangePreset[] {\n\treturn [\n\t\t{\n\t\t\tlabel: 'Full Range',\n\t\t\ttopIndex: 0,\n\t\t\tbottomIndex: Math.max(0, pitchData.length - 1)\n\t\t},\n\t\t{\n\t\t\tlabel: 'Treble',\n\t\t\ttopIndex: findMidiIndex(pitchData, 79), // G5\n\t\t\tbottomIndex: findMidiIndex(pitchData, 60) // C4\n\t\t},\n\t\t{\n\t\t\tlabel: 'Alto',\n\t\t\ttopIndex: findMidiIndex(pitchData, 69), // A4\n\t\t\tbottomIndex: findMidiIndex(pitchData, 62) // D3\n\t\t},\n\t\t{\n\t\t\tlabel: 'Bass',\n\t\t\ttopIndex: findMidiIndex(pitchData, 60), // C4\n\t\t\tbottomIndex: findMidiIndex(pitchData, 40) // E2\n\t\t}\n\t];\n}\n","<script lang=\"ts\">\n\t/**\n\t * DualPitchWheel Component\n\t *\n\t * Orchestrates two pitch wheels (top and bottom) with constraint coordination.\n\t * Displays range summary showing selected pitch range.\n\t */\n\timport PitchWheel from './PitchWheel.svelte';\n\timport PresetButtons from './PresetButtons.svelte';\n\timport type { PitchRowData } from '@mlt/types';\n\timport type { WheelOption, PitchWheelRange, PitchRangePreset } from './types.js';\n\timport {\n\t\tcreateWheelOptions,\n\t\tcomputeConstrainedTopIndex,\n\t\tcomputeConstrainedBottomIndex\n\t} from './pitchWheelUtils.js';\n\n\tinterface Props {\n\t\tfullRowData: PitchRowData[];\n\t\ttopIndex: number;\n\t\tbottomIndex: number;\n\t\tminSpan?: number;\n\t\tonrangechange?: (range: PitchWheelRange) => void;\n\t\tshowSummary?: boolean;\n\t\twheelHeight?: number;\n\t\tpresets?: PitchRangePreset[];\n\t\tshowPresets?: boolean;\n\t}\n\n\tlet {\n\t\tfullRowData,\n\t\ttopIndex = $bindable(),\n\t\tbottomIndex = $bindable(),\n\t\tminSpan = 7,\n\t\tonrangechange,\n\t\tshowSummary = true,\n\t\twheelHeight,\n\t\tpresets,\n\t\tshowPresets = false\n\t}: Props = $props();\n\n\t// Convert pitch data to wheel options\n\tconst options = $derived(createWheelOptions(fullRowData));\n\n\t// Derived range data\n\tconst currentRange = $derived<PitchWheelRange>({\n\t\ttopIndex,\n\t\tbottomIndex,\n\t\ttopPitch: fullRowData[topIndex],\n\t\tbottomPitch: fullRowData[bottomIndex],\n\t\tspan: bottomIndex - topIndex + 1\n\t});\n\n\tconst rangeLabel = $derived(\n\t\tcurrentRange.topPitch && currentRange.bottomPitch\n\t\t\t? `${currentRange.topPitch.pitch}  ${currentRange.bottomPitch.pitch}`\n\t\t\t: ''\n\t);\n\n\tconst rangeCount = $derived(\n\t\t`${currentRange.span} ${currentRange.span === 1 ? 'pitch' : 'pitches'}`\n\t);\n\n\t// Determine which preset is currently active based on current range\n\tconst activePreset = $derived.by(() => {\n\t\tif (!presets || presets.length === 0) return undefined;\n\t\tconst matchingPreset = presets.find(\n\t\t\t(p) => p.topIndex === topIndex && p.bottomIndex === bottomIndex\n\t\t);\n\t\treturn matchingPreset?.label;\n\t});\n\n\t// Constraint functions for each wheel\n\tfunction constrainTopIndex(requestedTopIndex: number): number {\n\t\treturn computeConstrainedTopIndex(bottomIndex, requestedTopIndex, options.length, minSpan);\n\t}\n\n\tfunction constrainBottomIndex(requestedBottomIndex: number): number {\n\t\treturn computeConstrainedBottomIndex(topIndex, requestedBottomIndex, options.length, minSpan);\n\t}\n\n\t// Handle top wheel change\n\tfunction handleTopChange(newTopIndex: number, _option: WheelOption) {\n\t\ttopIndex = newTopIndex;\n\t\tif (typeof onrangechange === 'function') {\n\t\t\tonrangechange(currentRange);\n\t\t}\n\t}\n\n\t// Handle bottom wheel change\n\tfunction handleBottomChange(newBottomIndex: number, _option: WheelOption) {\n\t\tbottomIndex = newBottomIndex;\n\t\tif (typeof onrangechange === 'function') {\n\t\t\tonrangechange(currentRange);\n\t\t}\n\t}\n\n\t// Handle preset button click\n\tfunction handlePresetClick(preset: PitchRangePreset) {\n\t\ttopIndex = preset.topIndex;\n\t\tbottomIndex = preset.bottomIndex;\n\t\tif (typeof onrangechange === 'function') {\n\t\t\tonrangechange(currentRange);\n\t\t}\n\t}\n</script>\n\n<div class=\"dual-pitch-wheel\">\n\t<div class=\"wheels-container\">\n\t\t<div class=\"wheel-column\">\n\t\t\t<div class=\"wheel-label\">High</div>\n\t\t\t<PitchWheel\n\t\t\t\t{options}\n\t\t\t\tselectedIndex={topIndex}\n\t\t\t\tonchange={handleTopChange}\n\t\t\t\tonbeforechange={constrainTopIndex}\n\t\t\t\t{wheelHeight}\n\t\t\t\tariaLabel=\"High pitch selector\"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div class=\"wheel-column\">\n\t\t\t<div class=\"wheel-label\">Low</div>\n\t\t\t<PitchWheel\n\t\t\t\t{options}\n\t\t\t\tselectedIndex={bottomIndex}\n\t\t\t\tonchange={handleBottomChange}\n\t\t\t\tonbeforechange={constrainBottomIndex}\n\t\t\t\t{wheelHeight}\n\t\t\t\tariaLabel=\"Low pitch selector\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n\n\t{#if showSummary}\n\t\t<div class=\"summary-card\">\n\t\t\t<div class=\"summary-label\">{rangeLabel}</div>\n\t\t\t<div class=\"summary-metadata\">{rangeCount}</div>\n\t\t</div>\n\t{/if}\n\n\t{#if showPresets && presets && presets.length > 0}\n\t\t<PresetButtons {presets} activePreset={activePreset} onPresetClick={handlePresetClick} />\n\t{/if}\n</div>\n\n<style>\n\t.dual-pitch-wheel {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\talign-items: center;\n\t}\n\n\t.wheels-container {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: 12px;\n\t\talign-items: stretch;\n\t}\n\n\t.wheel-column {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 8px;\n\t\talign-items: center;\n\t}\n\n\t.wheel-label {\n\t\tfont-size: 0.7rem;\n\t\tfont-weight: 600;\n\t\tcolor: rgba(33, 37, 41, 0.6);\n\t\ttext-transform: uppercase;\n\t\tletter-spacing: 0.5px;\n\t}\n\n\t.summary-card {\n\t\tbackground: rgba(255, 255, 255, 0.6);\n\t\tborder-radius: 12px;\n\t\tpadding: 10px 16px;\n\t\tborder: 1px solid rgba(0, 0, 0, 0.08);\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 4px;\n\t\talign-items: center;\n\t\tmin-width: 120px;\n\t}\n\n\t.summary-label {\n\t\tfont-size: 0.85rem;\n\t\tfont-weight: 600;\n\t\tcolor: #212529;\n\t\tline-height: 1.2;\n\t}\n\n\t.summary-metadata {\n\t\tfont-size: 0.7rem;\n\t\tcolor: #6c757d;\n\t}\n</style>\n","<script lang=\"ts\">\n\t/**\n\t * RangeControl Component\n\t *\n\t * Wrapper for DualPitchWheel that integrates with singing-trainer app state.\n\t * Converts between MIDI values (used in app state) and indices (used by wheels).\n\t */\n\timport { DualPitchWheel, createVoicePresets } from '@mlt/ui-components/pitch-wheels';\n\timport type { PitchWheelRange, PitchRangePreset } from '@mlt/ui-components/pitch-wheels';\n\timport { fullRowData } from '@mlt/pitch-data';\n\timport { appState } from '../../stores/appState.svelte';\n\n\t// Convert MIDI to index in fullRowData\n\tfunction midiToIndex(midi: number): number {\n\t\tconst index = fullRowData.findIndex((p) => p.midi === midi);\n\t\treturn index >= 0 ? index : 0;\n\t}\n\n\t// Current indices derived from app state\n\tconst topIndex = $derived(midiToIndex(appState.state.yAxisRange.maxMidi));\n\tconst bottomIndex = $derived(midiToIndex(appState.state.yAxisRange.minMidi));\n\n\t// Create voice presets\n\tconst voicePresets: PitchRangePreset[] = createVoicePresets(fullRowData);\n\n\t// Handle range change from wheels\n\tfunction handleRangeChange(range: PitchWheelRange) {\n\t\tconst minMidi = range.bottomPitch.midi ?? 21;\n\t\tconst maxMidi = range.topPitch.midi ?? 108;\n\t\tappState.setYAxisRange({ minMidi, maxMidi });\n\t}\n</script>\n\n<div class=\"range-control\">\n\t<h3 class=\"control-title\">Pitch Range</h3>\n\t<DualPitchWheel\n\t\t{fullRowData}\n\t\t{topIndex}\n\t\t{bottomIndex}\n\t\tminSpan={7}\n\t\tonrangechange={handleRangeChange}\n\t\tshowSummary={true}\n\t\twheelHeight={200}\n\t\tpresets={voicePresets}\n\t\tshowPresets={true}\n\t/>\n</div>\n\n<style>\n\t.range-control {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12px;\n\t\tpadding: 16px;\n\t\tbackground: rgba(255, 255, 255, 0.05);\n\t\tborder-radius: 12px;\n\t}\n\n\t.control-title {\n\t\tmargin: 0;\n\t\tfont-size: 0.85rem;\n\t\tfont-weight: 600;\n\t\tcolor: rgba(255, 255, 255, 0.9);\n\t\ttext-align: center;\n\t\tletter-spacing: 0.5px;\n\t}\n</style>\n","<script lang=\"ts\">\n  /**\n   * PitchHighlightToggle Component\n   *\n   * Toggles the yellow pitch highlight overlay.\n   */\n\n  import { appState } from '../../stores/appState.svelte.js';\n\n  function handleToggle() {\n    appState.togglePitchHighlight();\n  }\n</script>\n\n<div class=\"pitch-highlight-toggle\">\n  <span class=\"toggle-label\">Pitch Highlight</span>\n  <button\n    class=\"toggle-button\"\n    class:active={appState.state.pitchHighlightEnabled}\n    onclick={handleToggle}\n  >\n    {appState.state.pitchHighlightEnabled ? 'On' : 'Off'}\n  </button>\n</div>\n\n<style>\n  .pitch-highlight-toggle {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: var(--spacing-sm);\n  }\n\n  .toggle-label {\n    font-size: var(--font-size-sm);\n    color: var(--color-text-muted);\n  }\n\n  .toggle-button {\n    padding: var(--spacing-xs) var(--spacing-md);\n    font-size: var(--font-size-sm);\n    font-weight: 500;\n    color: var(--color-text);\n    background-color: var(--color-surface);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: var(--radius-sm);\n    transition: all 0.2s ease;\n    min-width: 64px;\n  }\n\n  .toggle-button:hover {\n    border-color: var(--color-secondary);\n  }\n\n  .toggle-button.active {\n    background-color: var(--color-secondary);\n    color: var(--color-bg);\n    border-color: var(--color-secondary);\n  }\n</style>\n","<script lang=\"ts\">\r\n  /**\r\n   * Demo Exercise Controls Component\r\n   *\r\n   * UI for starting/stopping the pitch-matching demo exercise.\r\n   */\r\n\r\n  import { demoExerciseState } from '../../stores/demoExerciseState.svelte.js';\r\n  import { highwayState } from '../../stores/highwayState.svelte.js';\r\n  import { appState } from '../../stores/appState.svelte.js';\r\n  import { referenceAudio } from '../../services/referenceAudio.js';\r\n  import { getPitchByMidi } from '@mlt/pitch-data';\r\n  import { onDestroy } from 'svelte';\r\n\r\n  // Local state for settings panel\r\n  let showSettings = $state(false);\r\n  let numLoops = $state(5);\r\n  let tempo = $state(108);\r\n  let referenceVolume = $state(-12);\r\n\r\n  // Reactive state from stores\r\n  const isActive = $derived(demoExerciseState.state.isActive);\r\n  const isPlaying = $derived(demoExerciseState.state.isPlaying);\r\n  const currentPhase = $derived(demoExerciseState.state.currentPhase);\r\n  const progress = $derived(demoExerciseState.getCurrentProgress());\r\n  const results = $derived(demoExerciseState.getResults());\r\n  const hasResults = $derived(results.length > 0);\r\n\r\n  // Calculate stats from results\r\n  const averageAccuracy = $derived(demoExerciseState.getAverageAccuracy());\r\n  const hitCount = $derived(demoExerciseState.getHitCount());\r\n  const totalCount = $derived(results.length);\r\n\r\n  /**\r\n   * Track phase based on highway currentTimeMs\r\n   */\r\n  $effect(() => {\r\n    if (!isActive || !isPlaying) return;\r\n\r\n    const currentTimeMs = highwayState.state.currentTimeMs;\r\n    demoExerciseState.updatePhase(currentTimeMs);\r\n  });\r\n\r\n  /**\r\n   * Collect results from highway performance data\r\n   */\r\n  $effect(() => {\r\n    if (!isActive) return;\r\n\r\n    const performances = highwayState.getPerformanceResults();\r\n    const notes = demoExerciseState.getGeneratedNotes();\r\n\r\n    // Check each input note for completion\r\n    notes.forEach((note, index) => {\r\n      if (note.lyric !== '') return; // Only process input notes\r\n\r\n      const noteId = `target-${index}`;\r\n      const perf = performances.get(noteId);\r\n\r\n      if (perf && !demoExerciseState.hasResultForLoop(Math.floor(index / 2))) {\r\n        // Calculate accuracy percentage from performance data\r\n        const accuracy = calculateAccuracy(perf);\r\n\r\n        demoExerciseState.addResult({\r\n          loopIndex: Math.floor(index / 2),\r\n          targetPitch: note.midi,\r\n          accuracy,\r\n          performance: perf,\r\n        });\r\n      }\r\n    });\r\n  });\r\n\r\n  /**\r\n   * Calculate accuracy percentage from performance data\r\n   */\r\n  function calculateAccuracy(perf: any): number {\r\n    // Simple accuracy: 100% if hit, based on pitch accuracy if available\r\n    if (perf.hitStatus === 'hit') {\r\n      // If we have pitch accuracy data, use it\r\n      if (perf.pitchAccuracyCents !== undefined) {\r\n        const maxCents = 50; // Tolerance from config\r\n        const accuracy = Math.max(0, 100 - (Math.abs(perf.pitchAccuracyCents) / maxCents) * 100);\r\n        return accuracy;\r\n      }\r\n      return 100;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Cleanup on component destroy\r\n   */\r\n  onDestroy(() => {\r\n    if (isActive) {\r\n      handleStop();\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Use current Y-axis range for pitch range\r\n   */\r\n  function useCurrentRange() {\r\n    const range = appState.state.yAxisRange;\r\n    demoExerciseState.setPitchRange(range.minMidi, range.maxMidi);\r\n  }\r\n\r\n  /**\r\n   * Use full piano range\r\n   */\r\n  function useFullRange() {\r\n    demoExerciseState.setPitchRange(21, 108); // A0 to C8\r\n  }\r\n\r\n  /**\r\n   * Start the demo exercise\r\n   */\r\n  async function handleStart() {\r\n    // Auto-switch to highway mode\r\n    appState.setVisualizationMode('highway');\r\n\r\n    // Update configuration\r\n    demoExerciseState.configure({\r\n      numLoops,\r\n      tempo,\r\n      referenceVolume,\r\n    });\r\n\r\n    // Set pitch range to current Y-axis range\r\n    useCurrentRange();\r\n\r\n    // Initialize reference audio\r\n    await referenceAudio.init();\r\n    referenceAudio.setVolume(referenceVolume);\r\n\r\n    // Start exercise (generates notes)\r\n    demoExerciseState.start();\r\n\r\n    const notes = demoExerciseState.getGeneratedNotes();\r\n\r\n    // Set highway state with generated notes\r\n    highwayState.setTargetNotes(notes);\r\n\r\n    // Start highway playback\r\n    highwayState.start();\r\n    demoExerciseState.setPlaying(true);\r\n\r\n    // Schedule reference tones (only the reference notes, not input notes)\r\n    const referenceTones = notes.filter(n => n.lyric === '');\r\n    referenceAudio.scheduleReferenceTones(referenceTones);\r\n  }\r\n\r\n  /**\r\n   * Stop the demo exercise\r\n   */\r\n  function handleStop() {\r\n    // Stop audio\r\n    referenceAudio.stop();\r\n\r\n    // Stop highway\r\n    highwayState.stop();\r\n\r\n    // Mark exercise as stopped\r\n    demoExerciseState.stop();\r\n  }\r\n\r\n  /**\r\n   * Get phase label for display\r\n   */\r\n  function getPhaseLabel(phase: string): string {\r\n    switch (phase) {\r\n      case 'reference':\r\n        return ' Listen';\r\n      case 'input':\r\n        return ' Sing';\r\n      default:\r\n        return 'Rest';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get pitch name from MIDI number\r\n   */\r\n  function getPitchName(midi: number): string {\r\n    const pitch = getPitchByMidi(midi);\r\n    return pitch?.pitch || `MIDI ${midi}`;\r\n  }\r\n</script>\r\n\r\n<div class=\"demo-exercise-panel\">\r\n  <h3 class=\"panel-title\">Demo Exercise</h3>\r\n\r\n  <!-- Settings (collapsed by default) -->\r\n  <details class=\"settings-details\" bind:open={showSettings}>\r\n    <summary class=\"settings-summary\">Settings</summary>\r\n    <div class=\"exercise-settings\">\r\n      <label class=\"setting-label\">\r\n        <span class=\"label-text\">Number of loops:</span>\r\n        <input\r\n          class=\"setting-input\"\r\n          type=\"number\"\r\n          min=\"1\"\r\n          max=\"20\"\r\n          bind:value={numLoops}\r\n          disabled={isActive}\r\n        />\r\n      </label>\r\n\r\n      <label class=\"setting-label\">\r\n        <span class=\"label-text\">Tempo (BPM):</span>\r\n        <input\r\n          class=\"setting-input\"\r\n          type=\"number\"\r\n          min=\"60\"\r\n          max=\"180\"\r\n          bind:value={tempo}\r\n          disabled={isActive}\r\n        />\r\n      </label>\r\n\r\n      <label class=\"setting-label\">\r\n        <span class=\"label-text\">Reference Volume:</span>\r\n        <input\r\n          class=\"setting-slider\"\r\n          type=\"range\"\r\n          min=\"-40\"\r\n          max=\"0\"\r\n          bind:value={referenceVolume}\r\n          disabled={isActive}\r\n        />\r\n        <span class=\"volume-value\">{referenceVolume} dB</span>\r\n      </label>\r\n\r\n      <div class=\"pitch-range-buttons\">\r\n        <button class=\"range-btn\" onclick={useCurrentRange} disabled={isActive}>\r\n          Use Current Range\r\n        </button>\r\n        <button class=\"range-btn\" onclick={useFullRange} disabled={isActive}>\r\n          Use Full Range\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </details>\r\n\r\n  <!-- Main Controls -->\r\n  <div class=\"exercise-controls\">\r\n    {#if !isActive}\r\n      <button class=\"start-exercise-btn\" onclick={handleStart}>\r\n        Start Demo Exercise\r\n      </button>\r\n    {:else}\r\n      <button class=\"stop-exercise-btn\" onclick={handleStop}>\r\n        Stop Exercise\r\n      </button>\r\n\r\n      <div class=\"progress-indicator\">\r\n        Loop {progress.current} / {progress.total}\r\n      </div>\r\n\r\n      <div class=\"phase-indicator\">\r\n        {getPhaseLabel(currentPhase)}\r\n      </div>\r\n    {/if}\r\n  </div>\r\n\r\n  <!-- Results Display (after completion) -->\r\n  {#if hasResults && !isActive}\r\n    <div class=\"exercise-results\">\r\n      <h4 class=\"results-title\">Results</h4>\r\n      <div class=\"results-summary\">\r\n        <div class=\"stat\">\r\n          <span class=\"stat-label\">Average Accuracy:</span>\r\n          <span class=\"stat-value\">{averageAccuracy.toFixed(1)}%</span>\r\n        </div>\r\n        <div class=\"stat\">\r\n          <span class=\"stat-label\">Hits:</span>\r\n          <span class=\"stat-value\">{hitCount}/{totalCount}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <details class=\"results-details\">\r\n        <summary class=\"results-summary-label\">Detailed Results</summary>\r\n        <div class=\"results-list\">\r\n          {#each results as result, i}\r\n            <div class=\"result-item\" class:hit={result.performance?.hitStatus === 'hit'}>\r\n              <span class=\"result-loop\">Loop {i + 1}:</span>\r\n              <span class=\"result-pitch\">{getPitchName(result.targetPitch)}</span>\r\n              <span class=\"result-accuracy\">{result.accuracy.toFixed(0)}%</span>\r\n              <span class=\"result-status\">\r\n                {result.performance?.hitStatus === 'hit' ? '' : ''}\r\n              </span>\r\n            </div>\r\n          {/each}\r\n        </div>\r\n      </details>\r\n    </div>\r\n  {/if}\r\n</div>\r\n\r\n<style>\r\n  .demo-exercise-panel {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--spacing-md);\r\n  }\r\n\r\n  .panel-title {\r\n    font-size: var(--font-size-sm);\r\n    font-weight: 600;\r\n    color: var(--color-text-muted);\r\n    text-transform: uppercase;\r\n    letter-spacing: 0.05em;\r\n    margin: 0;\r\n  }\r\n\r\n  /* Settings */\r\n  .settings-details {\r\n    background-color: var(--color-surface);\r\n    border-radius: var(--radius-sm);\r\n    padding: var(--spacing-xs);\r\n  }\r\n\r\n  .settings-summary {\r\n    cursor: pointer;\r\n    font-size: var(--font-size-sm);\r\n    font-weight: 500;\r\n    padding: var(--spacing-xs);\r\n    user-select: none;\r\n  }\r\n\r\n  .settings-summary:hover {\r\n    color: var(--color-primary);\r\n  }\r\n\r\n  .exercise-settings {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--spacing-sm);\r\n    padding: var(--spacing-sm);\r\n    padding-top: 0;\r\n  }\r\n\r\n  .setting-label {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--spacing-xs);\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  .label-text {\r\n    color: var(--color-text-muted);\r\n    font-weight: 500;\r\n  }\r\n\r\n  .setting-input {\r\n    padding: var(--spacing-xs) var(--spacing-sm);\r\n    border: 1px solid rgba(255, 255, 255, 0.1);\r\n    border-radius: var(--radius-sm);\r\n    background-color: var(--color-bg);\r\n    color: var(--color-text);\r\n    font-size: var(--font-size-sm);\r\n    width: 100%;\r\n  }\r\n\r\n  .setting-input:disabled {\r\n    opacity: 0.5;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .setting-slider {\r\n    width: 100%;\r\n    accent-color: var(--color-primary);\r\n  }\r\n\r\n  .volume-value {\r\n    font-size: var(--font-size-xs);\r\n    color: var(--color-text-muted);\r\n  }\r\n\r\n  .pitch-range-buttons {\r\n    display: flex;\r\n    gap: var(--spacing-xs);\r\n  }\r\n\r\n  .range-btn {\r\n    flex: 1;\r\n    padding: var(--spacing-xs) var(--spacing-sm);\r\n    font-size: var(--font-size-xs);\r\n    font-weight: 500;\r\n    background-color: var(--color-bg);\r\n    color: var(--color-text);\r\n    border: 1px solid rgba(255, 255, 255, 0.1);\r\n    border-radius: var(--radius-sm);\r\n    cursor: pointer;\r\n    transition: all 0.2s ease;\r\n  }\r\n\r\n  .range-btn:hover:not(:disabled) {\r\n    background-color: var(--color-primary);\r\n    color: white;\r\n  }\r\n\r\n  .range-btn:disabled {\r\n    opacity: 0.5;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  /* Main Controls */\r\n  .exercise-controls {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--spacing-sm);\r\n  }\r\n\r\n  .start-exercise-btn {\r\n    padding: var(--spacing-md);\r\n    font-size: var(--font-size-md);\r\n    font-weight: 600;\r\n    background-color: var(--color-primary);\r\n    color: white;\r\n    border: none;\r\n    border-radius: var(--radius-md);\r\n    cursor: pointer;\r\n    transition: background-color 0.2s ease;\r\n  }\r\n\r\n  .start-exercise-btn:hover {\r\n    background-color: var(--color-primary-dark, #4a7bc8);\r\n  }\r\n\r\n  .stop-exercise-btn {\r\n    padding: var(--spacing-md);\r\n    font-size: var(--font-size-md);\r\n    font-weight: 600;\r\n    background-color: var(--color-error, #dc3545);\r\n    color: white;\r\n    border: none;\r\n    border-radius: var(--radius-md);\r\n    cursor: pointer;\r\n    transition: background-color 0.2s ease;\r\n  }\r\n\r\n  .stop-exercise-btn:hover {\r\n    background-color: #c82333;\r\n  }\r\n\r\n  .progress-indicator {\r\n    text-align: center;\r\n    font-size: var(--font-size-md);\r\n    font-weight: 600;\r\n    color: var(--color-text);\r\n  }\r\n\r\n  .phase-indicator {\r\n    text-align: center;\r\n    font-size: var(--font-size-lg);\r\n    font-weight: 500;\r\n    padding: var(--spacing-sm);\r\n    background-color: var(--color-surface);\r\n    border-radius: var(--radius-sm);\r\n    color: var(--color-text);\r\n  }\r\n\r\n  /* Results */\r\n  .exercise-results {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--spacing-sm);\r\n    background-color: var(--color-surface);\r\n    border-radius: var(--radius-sm);\r\n    padding: var(--spacing-md);\r\n  }\r\n\r\n  .results-title {\r\n    font-size: var(--font-size-sm);\r\n    font-weight: 600;\r\n    margin: 0;\r\n    color: var(--color-text);\r\n  }\r\n\r\n  .results-summary {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--spacing-xs);\r\n  }\r\n\r\n  .stat {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  .stat-label {\r\n    color: var(--color-text-muted);\r\n  }\r\n\r\n  .stat-value {\r\n    color: var(--color-text);\r\n    font-weight: 600;\r\n  }\r\n\r\n  .results-details {\r\n    margin-top: var(--spacing-xs);\r\n  }\r\n\r\n  .results-summary-label {\r\n    cursor: pointer;\r\n    font-size: var(--font-size-sm);\r\n    font-weight: 500;\r\n    padding: var(--spacing-xs);\r\n    user-select: none;\r\n  }\r\n\r\n  .results-summary-label:hover {\r\n    color: var(--color-primary);\r\n  }\r\n\r\n  .results-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: var(--spacing-xs);\r\n    padding-top: var(--spacing-sm);\r\n  }\r\n\r\n  .result-item {\r\n    display: grid;\r\n    grid-template-columns: auto 1fr auto auto;\r\n    gap: var(--spacing-xs);\r\n    align-items: center;\r\n    padding: var(--spacing-xs);\r\n    background-color: var(--color-bg);\r\n    border-radius: var(--radius-sm);\r\n    font-size: var(--font-size-sm);\r\n  }\r\n\r\n  .result-item.hit {\r\n    border-left: 3px solid var(--color-success, #28a745);\r\n  }\r\n\r\n  .result-item:not(.hit) {\r\n    border-left: 3px solid var(--color-error, #dc3545);\r\n  }\r\n\r\n  .result-loop {\r\n    color: var(--color-text-muted);\r\n    font-weight: 500;\r\n  }\r\n\r\n  .result-pitch {\r\n    color: var(--color-text);\r\n    font-weight: 600;\r\n  }\r\n\r\n  .result-accuracy {\r\n    color: var(--color-text);\r\n  }\r\n\r\n  .result-status {\r\n    font-size: var(--font-size-md);\r\n    font-weight: bold;\r\n  }\r\n\r\n  .result-item.hit .result-status {\r\n    color: var(--color-success, #28a745);\r\n  }\r\n\r\n  .result-item:not(.hit) .result-status {\r\n    color: var(--color-error, #dc3545);\r\n  }\r\n</style>\r\n","/**\n * Ultrastar File Format Types\n *\n * Type definitions for parsing and working with UltraStar karaoke .txt files.\n * Supports YouTube video embedding and sync with the note highway.\n */\n\n/** Ultrastar metadata parsed from header lines (#KEY:VALUE) */\nexport interface UltrastarMetadata {\n  title: string;\n  artist: string;\n  video?: string; // YouTube URL or video ID\n  videoGap?: number; // Offset in seconds for video sync\n  gap?: number; // Offset in milliseconds for note timing\n  bpm: number; // Beats per minute (Ultrastar uses quarter-beat resolution)\n  mp3?: string; // Audio filename (not used for YouTube mode)\n  language?: string;\n  genre?: string;\n  year?: number;\n  creator?: string;\n  cover?: string;\n  background?: string;\n  previewStart?: number; // Preview start time in seconds\n}\n\n/** Note types from Ultrastar format */\nexport type UltrastarNoteType =\n  | ':' // Regular note\n  | '*' // Golden/bonus note (worth double points)\n  | 'F' // Freestyle note (no pitch judgment)\n  | 'R' // Rap note (rhythm only, no pitch)\n  | '-'; // Line/phrase break\n\n/** Parsed note from Ultrastar file */\nexport interface UltrastarNote {\n  type: UltrastarNoteType;\n  startBeat: number; // Beat number from song start\n  duration: number; // Duration in beats\n  pitch: number; // Relative pitch (0 = C4 in standard Ultrastar)\n  lyric: string; // Syllable text\n}\n\n/** Complete parsed Ultrastar song */\nexport interface UltrastarSong {\n  metadata: UltrastarMetadata;\n  notes: UltrastarNote[];\n  lineBreaks: number[]; // Beat positions of phrase breaks\n  totalBeats: number; // Total length in beats\n}\n\n/** YouTube player state */\nexport interface YouTubePlayerState {\n  isApiLoaded: boolean;\n  isReady: boolean;\n  isPlaying: boolean;\n  currentTime: number; // seconds\n  duration: number; // seconds\n  error?: string;\n}\n\n/** Sync configuration for YouTube-highway alignment */\nexport interface YouTubeSyncConfig {\n  gapMs: number; // GAP from Ultrastar (ms)\n  videoGapSec: number; // VIDEOGAP from Ultrastar (sec)\n  manualOffsetSec: number; // User-adjustable offset\n}\n\n/** Parser result with success/error info */\nexport type ParseResult =\n  | { success: true; song: UltrastarSong }\n  | { success: false; error: string };\n\n/** YouTube ID extraction patterns */\nexport const YOUTUBE_URL_PATTERNS = [\n  /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/embed\\/)([a-zA-Z0-9_-]{11})/,\n  /^([a-zA-Z0-9_-]{11})$/, // Direct video ID\n] as const;\n\n/** Default sync configuration */\nexport const DEFAULT_SYNC_CONFIG: YouTubeSyncConfig = {\n  gapMs: 0,\n  videoGapSec: 0,\n  manualOffsetSec: 0,\n};\n\n/** Standard Ultrastar base MIDI (0 = C4 = MIDI 60) */\nexport const ULTRASTAR_BASE_MIDI = 60;\n","/**\n * Ultrastar Parser Service\n *\n * Parses UltraStar karaoke .txt files into structured data for the singing trainer.\n * Handles metadata extraction, note parsing, and conversion to highway target notes.\n */\n\nimport type {\n  UltrastarMetadata,\n  UltrastarNote,\n  UltrastarNoteType,\n  UltrastarSong,\n  ParseResult,\n  YouTubeSyncConfig,\n} from '../types/ultrastar.js';\nimport { YOUTUBE_URL_PATTERNS, ULTRASTAR_BASE_MIDI } from '../types/ultrastar.js';\nimport type { TargetNote } from '../stores/highwayState.svelte.js';\n\n/**\n * Parse an Ultrastar .txt file content into structured song data\n */\nexport function parseUltrastarFile(content: string): ParseResult {\n  try {\n    const lines = content.split(/\\r?\\n/).map((line) => line.trim());\n\n    // Extract metadata from header lines\n    const metadata = extractMetadata(lines);\n\n    if (!metadata.bpm) {\n      return { success: false, error: 'Missing required #BPM tag' };\n    }\n\n    // Parse note lines\n    const { notes, lineBreaks, totalBeats } = parseNoteLines(lines);\n\n    if (notes.length === 0) {\n      return { success: false, error: 'No valid notes found in file' };\n    }\n\n    return {\n      success: true,\n      song: {\n        metadata,\n        notes,\n        lineBreaks,\n        totalBeats,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown parsing error',\n    };\n  }\n}\n\n/**\n * Extract metadata from header lines (#KEY:VALUE format)\n */\nexport function extractMetadata(lines: string[]): UltrastarMetadata {\n  const metadata: Partial<UltrastarMetadata> = {};\n\n  for (const line of lines) {\n    if (!line.startsWith('#')) continue;\n\n    const colonIndex = line.indexOf(':');\n    if (colonIndex === -1) continue;\n\n    const key = line.slice(1, colonIndex).toUpperCase().trim();\n    const value = line.slice(colonIndex + 1).trim();\n\n    switch (key) {\n      case 'TITLE':\n        metadata.title = value;\n        break;\n      case 'ARTIST':\n        metadata.artist = value;\n        break;\n      case 'VIDEO':\n        metadata.video = value;\n        break;\n      case 'VIDEOGAP':\n        // VIDEOGAP is in seconds (can be negative)\n        metadata.videoGap = parseFloat(value.replace(',', '.')) || 0;\n        break;\n      case 'GAP':\n        // GAP is in milliseconds (can use comma as decimal separator)\n        metadata.gap = parseFloat(value.replace(',', '.')) || 0;\n        break;\n      case 'BPM':\n        // BPM uses comma as decimal separator in some files\n        metadata.bpm = parseFloat(value.replace(',', '.')) || 0;\n        break;\n      case 'MP3':\n      case 'AUDIO':\n        metadata.mp3 = value;\n        break;\n      case 'LANGUAGE':\n        metadata.language = value;\n        break;\n      case 'GENRE':\n        metadata.genre = value;\n        break;\n      case 'YEAR':\n        metadata.year = parseInt(value) || undefined;\n        break;\n      case 'CREATOR':\n        metadata.creator = value;\n        break;\n      case 'COVER':\n        metadata.cover = value;\n        break;\n      case 'BACKGROUND':\n        metadata.background = value;\n        break;\n      case 'PREVIEWSTART':\n        metadata.previewStart = parseFloat(value.replace(',', '.')) || 0;\n        break;\n    }\n  }\n\n  return {\n    title: metadata.title || 'Unknown Title',\n    artist: metadata.artist || 'Unknown Artist',\n    bpm: metadata.bpm || 0,\n    ...metadata,\n  };\n}\n\n/**\n * Parse note lines from Ultrastar format\n */\nexport function parseNoteLines(lines: string[]): {\n  notes: UltrastarNote[];\n  lineBreaks: number[];\n  totalBeats: number;\n} {\n  const notes: UltrastarNote[] = [];\n  const lineBreaks: number[] = [];\n  let totalBeats = 0;\n\n  for (const line of lines) {\n    if (line.length === 0 || line.startsWith('#')) continue;\n\n    const firstChar = line[0];\n\n    // End of song marker\n    if (firstChar === 'E') break;\n\n    // Line break marker\n    if (firstChar === '-') {\n      const parts = line.slice(1).trim().split(/\\s+/);\n      const beat = parseInt(parts[0]) || 0;\n      lineBreaks.push(beat);\n      continue;\n    }\n\n    // Note types: :, *, F, R\n    if ([':','*', 'F', 'R'].includes(firstChar)) {\n      const note = parseNoteLine(line);\n      if (note) {\n        notes.push(note);\n        const noteEnd = note.startBeat + note.duration;\n        if (noteEnd > totalBeats) {\n          totalBeats = noteEnd;\n        }\n      }\n    }\n  }\n\n  return { notes, lineBreaks, totalBeats };\n}\n\n/**\n * Parse a single note line\n * Format: TYPE STARTBEAT DURATION PITCH LYRIC\n * Example: : 0 5 60 Hel\n */\nfunction parseNoteLine(line: string): UltrastarNote | null {\n  const type = line[0] as UltrastarNoteType;\n  const rest = line.slice(1).trim();\n\n  // Split by whitespace, but keep lyric text together\n  const parts = rest.split(/\\s+/);\n  if (parts.length < 3) return null;\n\n  const startBeat = parseInt(parts[0]);\n  const duration = parseInt(parts[1]);\n  const pitch = parseInt(parts[2]);\n  const lyric = parts.slice(3).join(' ') || '';\n\n  if (isNaN(startBeat) || isNaN(duration) || isNaN(pitch)) {\n    return null;\n  }\n\n  return {\n    type,\n    startBeat,\n    duration,\n    pitch,\n    lyric,\n  };\n}\n\n/**\n * Extract YouTube video ID from URL or direct ID\n */\nexport function extractYouTubeId(urlOrId: string): string | null {\n  if (!urlOrId) return null;\n\n  const trimmed = urlOrId.trim();\n\n  for (const pattern of YOUTUBE_URL_PATTERNS) {\n    const match = trimmed.match(pattern);\n    if (match && match[1]) {\n      return match[1];\n    }\n  }\n\n  return null;\n}\n\n/**\n * Convert Ultrastar song to highway target notes\n *\n * Note: GAP is NOT added to note timing here. GAP represents the offset\n * from audio start to first note, and is handled separately via YouTube sync.\n * Note timing is relative to transport time 0 = first beat of song.\n */\nexport function convertToTargetNotes(\n  song: UltrastarSong,\n  baseMidi: number = ULTRASTAR_BASE_MIDI\n): TargetNote[] {\n  const { metadata, notes, lineBreaks } = song;\n  const { bpm } = metadata;\n\n  // Calculate milliseconds per beat\n  // Ultrastar BPM is actually quarter-beat resolution (beats are 1/4 notes)\n  // So we multiply by 4 to get real ms per beat unit\n  const msPerBeat = (60 / bpm) * 1000 * 4;\n\n  // Group notes by phrase (between line breaks)\n  let phraseIndex = 0;\n  const sortedBreaks = [...lineBreaks].sort((a, b) => a - b);\n\n  // Find the first note's beat to use as reference (transport 0 = first note)\n  const firstNoteBeat = notes.length > 0 ? Math.min(...notes.map(n => n.startBeat)) : 0;\n\n  return notes\n    .filter((note) => note.type !== 'F') // Skip freestyle notes (no pitch judgment)\n    .map((note) => {\n      // Calculate timing relative to first note (so first note starts at ~0)\n      const startTimeMs = (note.startBeat - firstNoteBeat) * msPerBeat;\n      const durationMs = note.duration * msPerBeat;\n\n      // Convert relative pitch to MIDI\n      const midi = baseMidi + note.pitch;\n\n      // Determine phrase index\n      while (\n        phraseIndex < sortedBreaks.length &&\n        note.startBeat >= sortedBreaks[phraseIndex]\n      ) {\n        phraseIndex++;\n      }\n\n      // Build target note\n      const targetNote: TargetNote & {\n        phraseIndex?: number;\n        isGolden?: boolean;\n      } = {\n        midi,\n        startTimeMs,\n        durationMs,\n        lyric: note.lyric.trim() || undefined,\n      };\n\n      // Add optional metadata\n      if (note.type === '*') {\n        targetNote.isGolden = true;\n      }\n\n      return targetNote;\n    });\n}\n\n/**\n * Get sync configuration from Ultrastar metadata\n */\nexport function getSyncConfig(metadata: UltrastarMetadata): YouTubeSyncConfig {\n  return {\n    gapMs: metadata.gap || 0,\n    videoGapSec: metadata.videoGap || 0,\n    manualOffsetSec: 0,\n  };\n}\n\n/**\n * Calculate total duration of song in milliseconds\n * Duration is relative to transport time 0 = first note\n */\nexport function calculateSongDuration(song: UltrastarSong): number {\n  const { metadata, notes, totalBeats } = song;\n  const { bpm } = metadata;\n\n  // Ultrastar BPM is quarter-beat resolution\n  const msPerBeat = (60 / bpm) * 1000 * 4;\n\n  // Find first note beat to calculate relative duration\n  const firstNoteBeat = notes.length > 0 ? Math.min(...notes.map(n => n.startBeat)) : 0;\n  const relativeTotalBeats = totalBeats - firstNoteBeat;\n\n  // Add some buffer after the last note\n  return relativeTotalBeats * msPerBeat + 2000;\n}\n\n/**\n * Detect pitch range of song (for auto-adjusting viewport)\n */\nexport function detectPitchRange(\n  song: UltrastarSong,\n  baseMidi: number = ULTRASTAR_BASE_MIDI\n): { minMidi: number; maxMidi: number } {\n  const midiNotes = song.notes\n    .filter((note) => note.type !== 'F' && note.type !== '-')\n    .map((note) => baseMidi + note.pitch);\n\n  if (midiNotes.length === 0) {\n    return { minMidi: 48, maxMidi: 72 };\n  }\n\n  const minMidi = Math.min(...midiNotes);\n  const maxMidi = Math.max(...midiNotes);\n\n  // Add some padding\n  return {\n    minMidi: Math.max(24, minMidi - 3),\n    maxMidi: Math.min(108, maxMidi + 3),\n  };\n}\n\n/**\n * Group notes by phrase for results breakdown\n */\nexport function groupNotesByPhrase(\n  notes: UltrastarNote[],\n  lineBreaks: number[]\n): UltrastarNote[][] {\n  const phrases: UltrastarNote[][] = [];\n  const sortedBreaks = [0, ...lineBreaks].sort((a, b) => a - b);\n\n  for (let i = 0; i < sortedBreaks.length; i++) {\n    const start = sortedBreaks[i];\n    const end = sortedBreaks[i + 1] ?? Infinity;\n\n    const phraseNotes = notes.filter(\n      (note) => note.startBeat >= start && note.startBeat < end\n    );\n\n    if (phraseNotes.length > 0) {\n      phrases.push(phraseNotes);\n    }\n  }\n\n  return phrases;\n}\n\n/**\n * Get lyric preview for a phrase (first few syllables)\n */\nexport function getPhraseLyricPreview(notes: UltrastarNote[], maxLength = 30): string {\n  const lyrics = notes\n    .map((n) => n.lyric)\n    .join('')\n    .trim();\n\n  if (lyrics.length <= maxLength) {\n    return lyrics;\n  }\n\n  return lyrics.slice(0, maxLength - 3) + '...';\n}\n","/**\n * Ultrastar State Store - Svelte 5 Runes\n *\n * Manages the state for loaded Ultrastar karaoke files,\n * including parsed song data, sync configuration, and playback state.\n */\n\nimport type {\n  UltrastarSong,\n  YouTubeSyncConfig,\n} from '../types/ultrastar.js';\nimport { DEFAULT_SYNC_CONFIG, ULTRASTAR_BASE_MIDI } from '../types/ultrastar.js';\nimport {\n  parseUltrastarFile,\n  extractYouTubeId,\n  convertToTargetNotes,\n  getSyncConfig,\n  calculateSongDuration,\n  detectPitchRange,\n} from '../services/ultrastarParser.js';\nimport type { TargetNote } from './highwayState.svelte.js';\n\nexport interface UltrastarState {\n  isActive: boolean;\n  isLoading: boolean;\n  isPlaying: boolean;\n  song: UltrastarSong | null;\n  targetNotes: TargetNote[];\n  youtubeId: string | null;\n  syncConfig: YouTubeSyncConfig;\n  baseMidi: number;\n  totalDurationMs: number;\n  detectedRange: { minMidi: number; maxMidi: number };\n  error: string | null;\n}\n\nconst DEFAULT_STATE: UltrastarState = {\n  isActive: false,\n  isLoading: false,\n  isPlaying: false,\n  song: null,\n  targetNotes: [],\n  youtubeId: null,\n  syncConfig: { ...DEFAULT_SYNC_CONFIG },\n  baseMidi: ULTRASTAR_BASE_MIDI,\n  totalDurationMs: 0,\n  detectedRange: { minMidi: 48, maxMidi: 72 },\n  error: null,\n};\n\nfunction createUltrastarState() {\n  let state = $state<UltrastarState>({ ...DEFAULT_STATE });\n\n  // Completion callback\n  let onCompleteCallback: (() => void) | null = null;\n\n  return {\n    get state() {\n      return state;\n    },\n\n    /** Load and parse an Ultrastar .txt file */\n    async loadFile(file: File): Promise<boolean> {\n      state.isLoading = true;\n      state.error = null;\n\n      try {\n        const content = await file.text();\n        const result = parseUltrastarFile(content);\n\n        if (!result.success) {\n          state.error = result.error;\n          state.isLoading = false;\n          return false;\n        }\n\n        const song = result.song;\n\n        // Extract YouTube ID if video is specified\n        const youtubeId = song.metadata.video\n          ? extractYouTubeId(song.metadata.video)\n          : null;\n\n        // Get sync configuration from metadata\n        const syncConfig = getSyncConfig(song.metadata);\n\n        // Convert notes to target format\n        const targetNotes = convertToTargetNotes(song, state.baseMidi);\n\n        // Calculate duration and detect pitch range\n        const totalDurationMs = calculateSongDuration(song);\n        const detectedRange = detectPitchRange(song, state.baseMidi);\n\n        // Update state\n        state.song = song;\n        state.youtubeId = youtubeId;\n        state.syncConfig = syncConfig;\n        state.targetNotes = targetNotes;\n        state.totalDurationMs = totalDurationMs;\n        state.detectedRange = detectedRange;\n        state.isActive = true;\n        state.isLoading = false;\n\n        return true;\n      } catch (error) {\n        state.error = error instanceof Error ? error.message : 'Failed to load file';\n        state.isLoading = false;\n        return false;\n      }\n    },\n\n    /** Get the computed YouTube offset in seconds */\n    get youtubeOffset(): number {\n      const { gapMs, videoGapSec, manualOffsetSec } = state.syncConfig;\n      return gapMs / 1000 + videoGapSec + manualOffsetSec;\n    },\n\n    /** Adjust the manual sync offset */\n    adjustOffset(deltaSec: number) {\n      state.syncConfig = {\n        ...state.syncConfig,\n        manualOffsetSec: state.syncConfig.manualOffsetSec + deltaSec,\n      };\n    },\n\n    /** Set the manual sync offset directly */\n    setManualOffset(offsetSec: number) {\n      state.syncConfig = {\n        ...state.syncConfig,\n        manualOffsetSec: offsetSec,\n      };\n    },\n\n    /** Reset manual offset to zero */\n    resetOffset() {\n      state.syncConfig = {\n        ...state.syncConfig,\n        manualOffsetSec: 0,\n      };\n    },\n\n    /** Set the base MIDI note for pitch conversion */\n    setBaseMidi(midi: number) {\n      state.baseMidi = midi;\n\n      // Reconvert notes if song is loaded\n      if (state.song) {\n        state.targetNotes = convertToTargetNotes(state.song, midi);\n        state.detectedRange = detectPitchRange(state.song, midi);\n      }\n    },\n\n    /** Set playing state */\n    setPlaying(playing: boolean) {\n      state.isPlaying = playing;\n    },\n\n    /** Register completion callback */\n    onComplete(callback: () => void) {\n      onCompleteCallback = callback;\n    },\n\n    /** Trigger completion (called when song ends) */\n    triggerComplete() {\n      state.isPlaying = false;\n      if (onCompleteCallback) {\n        onCompleteCallback();\n      }\n    },\n\n    /** Check if current time has exceeded song duration */\n    checkCompletion(currentTimeMs: number): boolean {\n      if (!state.isPlaying || !state.isActive) return false;\n\n      // Add a small buffer before triggering completion\n      if (currentTimeMs >= state.totalDurationMs - 500) {\n        this.triggerComplete();\n        return true;\n      }\n\n      return false;\n    },\n\n    /** Get song title */\n    get title(): string {\n      return state.song?.metadata.title || '';\n    },\n\n    /** Get song artist */\n    get artist(): string {\n      return state.song?.metadata.artist || '';\n    },\n\n    /** Check if YouTube video is available */\n    get hasVideo(): boolean {\n      return state.youtubeId !== null;\n    },\n\n    /** Reset state and clear loaded song */\n    reset() {\n      state = { ...DEFAULT_STATE };\n      onCompleteCallback = null;\n    },\n\n    /** Unload song but preserve settings */\n    unload() {\n      state.isActive = false;\n      state.isPlaying = false;\n      state.song = null;\n      state.targetNotes = [];\n      state.youtubeId = null;\n      state.totalDurationMs = 0;\n      state.error = null;\n    },\n  };\n}\n\nexport const ultrastarState = createUltrastarState();\n","/**\n * YouTube Player Service\n *\n * Manages the YouTube IFrame Player API for embedding and controlling\n * YouTube videos synchronized with the note highway.\n */\n\n// YouTube IFrame API types\ndeclare global {\n  interface Window {\n    YT: typeof YT;\n    onYouTubeIframeAPIReady: () => void;\n  }\n\n  namespace YT {\n    interface Player {\n      playVideo(): void;\n      pauseVideo(): void;\n      stopVideo(): void;\n      seekTo(seconds: number, allowSeekAhead?: boolean): void;\n      getCurrentTime(): number;\n      getDuration(): number;\n      getPlayerState(): PlayerState;\n      getVideoUrl(): string;\n      destroy(): void;\n      setVolume(volume: number): void;\n      getVolume(): number;\n      mute(): void;\n      unMute(): void;\n      isMuted(): boolean;\n    }\n\n    interface PlayerOptions {\n      height?: string | number;\n      width?: string | number;\n      videoId?: string;\n      playerVars?: PlayerVars;\n      events?: PlayerEvents;\n    }\n\n    interface PlayerVars {\n      autoplay?: 0 | 1;\n      controls?: 0 | 1;\n      disablekb?: 0 | 1;\n      enablejsapi?: 0 | 1;\n      fs?: 0 | 1;\n      modestbranding?: 0 | 1;\n      origin?: string;\n      playsinline?: 0 | 1;\n      rel?: 0 | 1;\n      start?: number;\n    }\n\n    interface PlayerEvents {\n      onReady?: (event: PlayerEvent) => void;\n      onStateChange?: (event: OnStateChangeEvent) => void;\n      onError?: (event: OnErrorEvent) => void;\n    }\n\n    interface PlayerEvent {\n      target: Player;\n    }\n\n    interface OnStateChangeEvent {\n      target: Player;\n      data: PlayerState;\n    }\n\n    interface OnErrorEvent {\n      target: Player;\n      data: PlayerError;\n    }\n\n    enum PlayerState {\n      UNSTARTED = -1,\n      ENDED = 0,\n      PLAYING = 1,\n      PAUSED = 2,\n      BUFFERING = 3,\n      CUED = 5,\n    }\n\n    enum PlayerError {\n      InvalidParam = 2,\n      Html5Error = 5,\n      VideoNotFound = 100,\n      NotAllowedEmbedded = 101,\n      NotAllowedEmbedded2 = 150,\n    }\n\n    const Player: {\n      new (elementId: string | HTMLElement, options: PlayerOptions): Player;\n    };\n  }\n}\n\nlet apiLoadPromise: Promise<void> | null = null;\nlet isApiLoaded = false;\n\n/**\n * Load the YouTube IFrame Player API script\n */\nexport function loadYouTubeAPI(): Promise<void> {\n  // Return existing promise if already loading\n  if (apiLoadPromise) return apiLoadPromise;\n\n  // Already loaded\n  if (isApiLoaded && window.YT && window.YT.Player) {\n    return Promise.resolve();\n  }\n\n  apiLoadPromise = new Promise((resolve, reject) => {\n    // Check if already loaded\n    if (window.YT && window.YT.Player) {\n      isApiLoaded = true;\n      resolve();\n      return;\n    }\n\n    // Set up callback for when API is ready\n    window.onYouTubeIframeAPIReady = () => {\n      isApiLoaded = true;\n      resolve();\n    };\n\n    // Create and inject the script\n    const script = document.createElement('script');\n    script.src = 'https://www.youtube.com/iframe_api';\n    script.async = true;\n    script.onerror = () => {\n      reject(new Error('Failed to load YouTube IFrame API'));\n    };\n\n    document.head.appendChild(script);\n\n    // Timeout after 10 seconds\n    setTimeout(() => {\n      if (!isApiLoaded) {\n        reject(new Error('YouTube IFrame API load timeout'));\n      }\n    }, 10000);\n  });\n\n  return apiLoadPromise;\n}\n\n/**\n * Check if YouTube API is loaded\n */\nexport function isYouTubeAPILoaded(): boolean {\n  return isApiLoaded && !!window.YT?.Player;\n}\n\n/**\n * Create a YouTube player instance\n */\nexport function createYouTubePlayer(\n  elementId: string,\n  videoId: string,\n  options: {\n    width?: number;\n    height?: number;\n    onReady?: (player: YT.Player) => void;\n    onStateChange?: (state: YT.PlayerState) => void;\n    onError?: (error: YT.PlayerError) => void;\n  } = {}\n): YT.Player {\n  if (!isApiLoaded || !window.YT?.Player) {\n    throw new Error('YouTube API not loaded. Call loadYouTubeAPI() first.');\n  }\n\n  const { width = 320, height = 180, onReady, onStateChange, onError } = options;\n\n  return new window.YT.Player(elementId, {\n    width,\n    height,\n    videoId,\n    playerVars: {\n      autoplay: 0,\n      controls: 1,\n      disablekb: 1, // Disable keyboard controls (we handle our own)\n      enablejsapi: 1,\n      fs: 0, // Disable fullscreen button\n      modestbranding: 1,\n      origin: window.location.origin,\n      playsinline: 1,\n      rel: 0, // Don't show related videos\n    },\n    events: {\n      onReady: (event) => {\n        onReady?.(event.target);\n      },\n      onStateChange: (event) => {\n        onStateChange?.(event.data);\n      },\n      onError: (event) => {\n        onError?.(event.data);\n      },\n    },\n  });\n}\n\n/**\n * Get human-readable error message for YouTube player errors\n */\nexport function getYouTubeErrorMessage(error: YT.PlayerError): string {\n  switch (error) {\n    case YT.PlayerError.InvalidParam:\n      return 'Invalid video ID';\n    case YT.PlayerError.Html5Error:\n      return 'HTML5 player error';\n    case YT.PlayerError.VideoNotFound:\n      return 'Video not found';\n    case YT.PlayerError.NotAllowedEmbedded:\n    case YT.PlayerError.NotAllowedEmbedded2:\n      return 'Video cannot be embedded';\n    default:\n      return 'Unknown player error';\n  }\n}\n\n/**\n * Get player state name for debugging\n */\nexport function getPlayerStateName(state: YT.PlayerState): string {\n  switch (state) {\n    case YT.PlayerState.UNSTARTED:\n      return 'unstarted';\n    case YT.PlayerState.ENDED:\n      return 'ended';\n    case YT.PlayerState.PLAYING:\n      return 'playing';\n    case YT.PlayerState.PAUSED:\n      return 'paused';\n    case YT.PlayerState.BUFFERING:\n      return 'buffering';\n    case YT.PlayerState.CUED:\n      return 'cued';\n    default:\n      return 'unknown';\n  }\n}\n","/**\n * YouTube State Store - Svelte 5 Runes\n *\n * Manages the YouTube player instance and playback state,\n * including sync with the note highway transport.\n */\n\nimport {\n  loadYouTubeAPI,\n  createYouTubePlayer,\n  isYouTubeAPILoaded,\n  getYouTubeErrorMessage,\n} from '../services/youtubePlayer.js';\n\nexport interface YouTubeState {\n  isApiLoaded: boolean;\n  isApiLoading: boolean;\n  isPlayerReady: boolean;\n  isPlaying: boolean;\n  currentTime: number; // seconds\n  duration: number; // seconds\n  videoId: string | null;\n  error: string | null;\n  isEmbeddable: boolean;\n  volume: number; // 0-100\n  isMuted: boolean;\n}\n\nconst DEFAULT_STATE: YouTubeState = {\n  isApiLoaded: false,\n  isApiLoading: false,\n  isPlayerReady: false,\n  isPlaying: false,\n  currentTime: 0,\n  duration: 0,\n  videoId: null,\n  error: null,\n  isEmbeddable: true,\n  volume: 100,\n  isMuted: false,\n};\n\nfunction createYouTubeState() {\n  let state = $state<YouTubeState>({ ...DEFAULT_STATE });\n  let player: YT.Player | null = null;\n  let syncIntervalId: number | null = null;\n  let timeUpdateCallback: ((time: number) => void) | null = null;\n\n  return {\n    get state() {\n      return state;\n    },\n\n    /** Initialize the YouTube IFrame API */\n    async initAPI(): Promise<boolean> {\n      if (state.isApiLoaded) return true;\n      if (state.isApiLoading) return false;\n\n      state.isApiLoading = true;\n      state.error = null;\n\n      try {\n        await loadYouTubeAPI();\n        state.isApiLoaded = true;\n        state.isApiLoading = false;\n        return true;\n      } catch (error) {\n        state.error = error instanceof Error ? error.message : 'Failed to load YouTube API';\n        state.isApiLoading = false;\n        return false;\n      }\n    },\n\n    /** Load a video into the player */\n    async loadVideo(videoId: string, containerId: string): Promise<boolean> {\n      // Ensure API is loaded\n      if (!state.isApiLoaded) {\n        const loaded = await this.initAPI();\n        if (!loaded) return false;\n      }\n\n      // Dispose existing player\n      if (player) {\n        try {\n          player.destroy();\n        } catch {\n          // Player may already be destroyed\n        }\n        player = null;\n      }\n\n      state.isPlayerReady = false;\n      state.error = null;\n      state.isEmbeddable = true;\n      state.videoId = videoId;\n\n      return new Promise((resolve) => {\n        try {\n          player = createYouTubePlayer(containerId, videoId, {\n            onReady: (p) => {\n              state.isPlayerReady = true;\n              state.duration = p.getDuration();\n              state.volume = p.getVolume();\n              state.isMuted = p.isMuted();\n              resolve(true);\n            },\n            onStateChange: (playerState) => {\n              // Update playing state\n              state.isPlaying = playerState === YT.PlayerState.PLAYING;\n\n              // Check for video ended\n              if (playerState === YT.PlayerState.ENDED) {\n                state.isPlaying = false;\n                this.stopSyncLoop();\n              }\n            },\n            onError: (error) => {\n              state.error = getYouTubeErrorMessage(error);\n              state.isEmbeddable =\n                error !== YT.PlayerError.NotAllowedEmbedded &&\n                error !== YT.PlayerError.NotAllowedEmbedded2;\n              state.isPlayerReady = false;\n              resolve(false);\n            },\n          });\n        } catch (error) {\n          state.error = error instanceof Error ? error.message : 'Failed to create player';\n          resolve(false);\n        }\n      });\n    },\n\n    /** Play the video */\n    play() {\n      if (player && state.isPlayerReady) {\n        player.playVideo();\n      }\n    },\n\n    /** Pause the video */\n    pause() {\n      if (player && state.isPlayerReady) {\n        player.pauseVideo();\n      }\n    },\n\n    /** Stop the video */\n    stop() {\n      if (player && state.isPlayerReady) {\n        player.stopVideo();\n        state.isPlaying = false;\n      }\n      this.stopSyncLoop();\n    },\n\n    /** Seek to a specific time in seconds */\n    seekTo(timeSeconds: number) {\n      if (player && state.isPlayerReady) {\n        player.seekTo(Math.max(0, timeSeconds), true);\n        state.currentTime = Math.max(0, timeSeconds);\n      }\n    },\n\n    /** Get current playback time */\n    getCurrentTime(): number {\n      if (player && state.isPlayerReady) {\n        return player.getCurrentTime();\n      }\n      return state.currentTime;\n    },\n\n    /** Set volume (0-100) */\n    setVolume(volume: number) {\n      const v = Math.max(0, Math.min(100, volume));\n      if (player && state.isPlayerReady) {\n        player.setVolume(v);\n      }\n      state.volume = v;\n    },\n\n    /** Mute the video */\n    mute() {\n      if (player && state.isPlayerReady) {\n        player.mute();\n      }\n      state.isMuted = true;\n    },\n\n    /** Unmute the video */\n    unmute() {\n      if (player && state.isPlayerReady) {\n        player.unMute();\n      }\n      state.isMuted = false;\n    },\n\n    /** Toggle mute state */\n    toggleMute() {\n      if (state.isMuted) {\n        this.unmute();\n      } else {\n        this.mute();\n      }\n    },\n\n    /** Start the sync loop for drift correction */\n    startSyncLoop(onTimeUpdate: (time: number) => void, intervalMs = 250) {\n      timeUpdateCallback = onTimeUpdate;\n\n      if (syncIntervalId !== null) {\n        clearInterval(syncIntervalId);\n      }\n\n      syncIntervalId = window.setInterval(() => {\n        if (player && state.isPlayerReady && state.isPlaying) {\n          const currentTime = player.getCurrentTime();\n          state.currentTime = currentTime;\n          timeUpdateCallback?.(currentTime);\n        }\n      }, intervalMs);\n    },\n\n    /** Stop the sync loop */\n    stopSyncLoop() {\n      if (syncIntervalId !== null) {\n        clearInterval(syncIntervalId);\n        syncIntervalId = null;\n      }\n      timeUpdateCallback = null;\n    },\n\n    /** Check and correct drift if needed */\n    correctDrift(expectedTimeSec: number, maxDriftMs = 150): boolean {\n      if (!player || !state.isPlayerReady || !state.isPlaying) return false;\n\n      const actualTime = player.getCurrentTime();\n      const driftMs = Math.abs(actualTime - expectedTimeSec) * 1000;\n\n      if (driftMs > maxDriftMs) {\n        player.seekTo(expectedTimeSec, true);\n        return true;\n      }\n\n      return false;\n    },\n\n    /** Get the YouTube video URL for fallback */\n    getVideoUrl(): string | null {\n      if (!state.videoId) return null;\n      return `https://www.youtube.com/watch?v=${state.videoId}`;\n    },\n\n    /** Dispose of the player and clean up */\n    dispose() {\n      this.stopSyncLoop();\n\n      if (player) {\n        try {\n          player.destroy();\n        } catch {\n          // Player may already be destroyed\n        }\n        player = null;\n      }\n\n      state = { ...DEFAULT_STATE, isApiLoaded: state.isApiLoaded };\n    },\n\n    /** Reset to initial state */\n    reset() {\n      this.dispose();\n      state = { ...DEFAULT_STATE };\n    },\n  };\n}\n\nexport const youtubeState = createYouTubeState();\n","/**\n * Transport Sync Service\n *\n * Coordinates time synchronization between the note highway transport\n * and YouTube player. Handles offset calculations and drift correction.\n */\n\nimport type { YouTubeSyncConfig } from '../types/ultrastar.js';\n\nexport interface TransportSyncOptions {\n  /** Sync configuration from Ultrastar metadata */\n  syncConfig: YouTubeSyncConfig;\n  /** Interval for checking drift (ms) */\n  driftCheckIntervalMs?: number;\n  /** Maximum allowed drift before correction (ms) */\n  maxDriftMs?: number;\n}\n\nexport interface DriftCheckResult {\n  /** Drift amount in milliseconds */\n  driftMs: number;\n  /** Whether drift exceeds threshold and needs correction */\n  needsCorrection: boolean;\n  /** Suggested corrected transport time (ms) */\n  correctedTransportTimeMs?: number;\n}\n\n/**\n * Create a transport sync coordinator\n */\nexport function createTransportSync(options: TransportSyncOptions) {\n  let config = { ...options.syncConfig };\n  const driftCheckIntervalMs = options.driftCheckIntervalMs ?? 250;\n  const maxDriftMs = options.maxDriftMs ?? 150;\n\n  /**\n   * Calculate the total YouTube offset in seconds\n   * youtubeOffset = (GAP_ms/1000) + VIDEOGAP_sec + manualOffset\n   */\n  function getYouTubeOffset(): number {\n    return config.gapMs / 1000 + config.videoGapSec + config.manualOffsetSec;\n  }\n\n  /**\n   * Convert transport time (ms) to YouTube time (seconds)\n   * When transport is at 0, YouTube should be at youtubeOffset\n   */\n  function transportToYouTube(transportTimeMs: number): number {\n    return transportTimeMs / 1000 + getYouTubeOffset();\n  }\n\n  /**\n   * Convert YouTube time (seconds) to transport time (ms)\n   */\n  function youTubeToTransport(youtubeTimeSec: number): number {\n    return (youtubeTimeSec - getYouTubeOffset()) * 1000;\n  }\n\n  /**\n   * Check drift between expected and actual YouTube time\n   */\n  function checkDrift(\n    transportTimeMs: number,\n    youtubeTimeSec: number\n  ): DriftCheckResult {\n    const expectedYouTubeTime = transportToYouTube(transportTimeMs);\n    const driftSec = youtubeTimeSec - expectedYouTubeTime;\n    const driftMs = Math.abs(driftSec * 1000);\n\n    if (driftMs > maxDriftMs) {\n      // Calculate corrected transport time based on actual YouTube position\n      const correctedTransportTimeMs = youTubeToTransport(youtubeTimeSec);\n      return {\n        driftMs,\n        needsCorrection: true,\n        correctedTransportTimeMs,\n      };\n    }\n\n    return {\n      driftMs,\n      needsCorrection: false,\n    };\n  }\n\n  /**\n   * Update sync configuration\n   */\n  function updateConfig(partial: Partial<YouTubeSyncConfig>) {\n    config = { ...config, ...partial };\n  }\n\n  /**\n   * Adjust manual offset by a delta\n   */\n  function adjustManualOffset(deltaSec: number) {\n    config.manualOffsetSec += deltaSec;\n  }\n\n  /**\n   * Reset manual offset to zero\n   */\n  function resetManualOffset() {\n    config.manualOffsetSec = 0;\n  }\n\n  /**\n   * Get the current manual offset\n   */\n  function getManualOffset(): number {\n    return config.manualOffsetSec;\n  }\n\n  /**\n   * Get total offset in seconds\n   */\n  function getTotalOffset(): number {\n    return getYouTubeOffset();\n  }\n\n  /**\n   * Format offset for display (e.g., \"+0.15s\" or \"-0.30s\")\n   */\n  function formatOffset(): string {\n    const offset = config.manualOffsetSec;\n    const sign = offset >= 0 ? '+' : '';\n    return `${sign}${offset.toFixed(2)}s`;\n  }\n\n  /**\n   * Get configuration for creating sync loop\n   */\n  function getSyncLoopConfig() {\n    return {\n      intervalMs: driftCheckIntervalMs,\n      maxDriftMs,\n    };\n  }\n\n  return {\n    // Getters\n    getYouTubeOffset,\n    getTotalOffset,\n    getManualOffset,\n    getSyncLoopConfig,\n\n    // Conversion\n    transportToYouTube,\n    youTubeToTransport,\n\n    // Drift handling\n    checkDrift,\n\n    // Configuration\n    updateConfig,\n    adjustManualOffset,\n    resetManualOffset,\n\n    // Formatting\n    formatOffset,\n\n    // Get current config (for persistence)\n    getConfig: () => ({ ...config }),\n  };\n}\n\n/** Type for the transport sync instance */\nexport type TransportSyncInstance = ReturnType<typeof createTransportSync>;\n","<script lang=\"ts\">\n  /**\n   * YouTube Player Component\n   *\n   * Embeds a YouTube video player synchronized with the note highway.\n   * Shows loading state, error handling, and fallback for non-embeddable videos.\n   */\n\n  import { onMount, onDestroy } from 'svelte';\n  import { youtubeState } from '../../stores/youtubeState.svelte.js';\n  import { ultrastarState } from '../../stores/ultrastarState.svelte.js';\n\n  // Unique ID for the player container\n  const playerId = `youtube-player-${Math.random().toString(36).slice(2, 9)}`;\n\n  // Reactive state\n  const isLoading = $derived(\n    youtubeState.state.isApiLoading ||\n    (youtubeState.state.videoId && !youtubeState.state.isPlayerReady)\n  );\n  const hasError = $derived(!!youtubeState.state.error);\n  const isEmbeddable = $derived(youtubeState.state.isEmbeddable);\n  const videoId = $derived(ultrastarState.state.youtubeId);\n\n  // Load video when videoId changes\n  $effect(() => {\n    if (videoId) {\n      youtubeState.loadVideo(videoId, playerId);\n    }\n  });\n\n  onDestroy(() => {\n    youtubeState.dispose();\n  });\n\n  /**\n   * Open video in new tab (fallback for non-embeddable)\n   */\n  function openOnYouTube() {\n    const url = youtubeState.getVideoUrl();\n    if (url) {\n      window.open(url, '_blank', 'noopener,noreferrer');\n    }\n  }\n</script>\n\n<div class=\"youtube-container\">\n  <!-- Player container - NEVER hide this div, YouTube API needs it visible -->\n  <div\n    id={playerId}\n    class=\"youtube-player\"\n  ></div>\n\n  <!-- Loading overlay (shown on top of player while loading) -->\n  {#if isLoading && videoId}\n    <div class=\"youtube-loading\">\n      <div class=\"spinner\"></div>\n      <span>Loading video...</span>\n    </div>\n  {/if}\n\n  <!-- Error state -->\n  {#if hasError}\n    <div class=\"youtube-error\">\n      <span class=\"error-icon\"></span>\n      <span class=\"error-message\">{youtubeState.state.error}</span>\n\n      {#if !isEmbeddable}\n        <button class=\"fallback-btn\" onclick={openOnYouTube}>\n          Open on YouTube \n        </button>\n      {/if}\n    </div>\n  {/if}\n\n  <!-- No video placeholder -->\n  {#if !videoId && !isLoading && !hasError}\n    <div class=\"youtube-placeholder\">\n      <span class=\"placeholder-icon\"></span>\n      <span class=\"placeholder-text\">No video loaded</span>\n    </div>\n  {/if}\n</div>\n\n<style>\n  .youtube-container {\n    position: relative;\n    width: 100%;\n    aspect-ratio: 16 / 9;\n    background-color: var(--color-bg);\n    border-radius: var(--radius-sm);\n    overflow: hidden;\n  }\n\n  .youtube-player {\n    width: 100%;\n    height: 100%;\n  }\n\n  .youtube-player :global(iframe) {\n    width: 100%;\n    height: 100%;\n    border: none;\n  }\n\n  .youtube-loading,\n  .youtube-error,\n  .youtube-placeholder {\n    position: absolute;\n    inset: 0;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: var(--spacing-sm);\n    color: var(--color-text-muted);\n    font-size: var(--font-size-sm);\n  }\n\n  .spinner {\n    width: 24px;\n    height: 24px;\n    border: 2px solid rgba(255, 255, 255, 0.1);\n    border-top-color: var(--color-primary);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n  }\n\n  @keyframes spin {\n    to {\n      transform: rotate(360deg);\n    }\n  }\n\n  .youtube-error {\n    background-color: rgba(220, 53, 69, 0.1);\n  }\n\n  .error-icon {\n    font-size: var(--font-size-xl);\n  }\n\n  .error-message {\n    color: var(--color-error, #dc3545);\n    text-align: center;\n  }\n\n  .fallback-btn {\n    margin-top: var(--spacing-sm);\n    padding: var(--spacing-sm) var(--spacing-md);\n    font-size: var(--font-size-sm);\n    font-weight: 500;\n    background-color: var(--color-primary);\n    color: white;\n    border: none;\n    border-radius: var(--radius-sm);\n    cursor: pointer;\n    transition: background-color 0.2s ease;\n  }\n\n  .fallback-btn:hover {\n    background-color: var(--color-primary-dark, #4a7bc8);\n  }\n\n  .placeholder-icon {\n    font-size: var(--font-size-xl);\n    opacity: 0.5;\n  }\n\n  .placeholder-text {\n    opacity: 0.7;\n  }\n</style>\n","<script lang=\"ts\">\n  /**\n   * Sync Controls Component\n   *\n   * Provides manual offset adjustment for YouTube-highway synchronization.\n   * Allows fine-tuning with +/- 0.01s and coarse with +/- 0.1s buttons.\n   */\n\n  import { ultrastarState } from '../../stores/ultrastarState.svelte.js';\n\n  // Reactive state\n  const manualOffset = $derived(ultrastarState.state.syncConfig.manualOffsetSec);\n  const isActive = $derived(ultrastarState.state.isActive);\n\n  /**\n   * Format offset for display\n   */\n  function formatOffset(offset: number): string {\n    const sign = offset >= 0 ? '+' : '';\n    return `${sign}${offset.toFixed(2)}s`;\n  }\n\n  /**\n   * Adjust offset by delta\n   */\n  function adjust(delta: number) {\n    ultrastarState.adjustOffset(delta);\n  }\n\n  /**\n   * Reset offset to zero\n   */\n  function reset() {\n    ultrastarState.resetOffset();\n  }\n\n  /**\n   * Handle keyboard shortcuts\n   */\n  function handleKeydown(event: KeyboardEvent) {\n    if (!isActive) return;\n\n    // Only handle if not focused on an input\n    if (event.target instanceof HTMLInputElement) return;\n\n    switch (event.key) {\n      case 'ArrowLeft':\n        event.preventDefault();\n        adjust(event.shiftKey ? -0.1 : -0.01);\n        break;\n      case 'ArrowRight':\n        event.preventDefault();\n        adjust(event.shiftKey ? 0.1 : 0.01);\n        break;\n    }\n  }\n</script>\n\n<svelte:window onkeydown={handleKeydown} />\n\n<div class=\"sync-controls\">\n  <div class=\"sync-header\">\n    <span class=\"sync-label\">Sync Offset</span>\n    <span class=\"sync-value\">{formatOffset(manualOffset)}</span>\n  </div>\n\n  <div class=\"sync-buttons\">\n    <button\n      class=\"sync-btn coarse\"\n      onclick={() => adjust(-0.1)}\n      disabled={!isActive}\n      title=\"Earlier by 0.1s\"\n    >\n      -0.1s\n    </button>\n    <button\n      class=\"sync-btn fine\"\n      onclick={() => adjust(-0.01)}\n      disabled={!isActive}\n      title=\"Earlier by 0.01s\"\n    >\n      -0.01s\n    </button>\n    <button\n      class=\"sync-btn reset\"\n      onclick={reset}\n      disabled={!isActive || manualOffset === 0}\n      title=\"Reset offset\"\n    >\n      0\n    </button>\n    <button\n      class=\"sync-btn fine\"\n      onclick={() => adjust(0.01)}\n      disabled={!isActive}\n      title=\"Later by 0.01s\"\n    >\n      +0.01s\n    </button>\n    <button\n      class=\"sync-btn coarse\"\n      onclick={() => adjust(0.1)}\n      disabled={!isActive}\n      title=\"Later by 0.1s\"\n    >\n      +0.1s\n    </button>\n  </div>\n\n  <div class=\"sync-hint\">\n    Use arrow keys to adjust (Shift for coarse)\n  </div>\n</div>\n\n<style>\n  .sync-controls {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-xs);\n    padding: var(--spacing-sm);\n    background-color: var(--color-surface);\n    border-radius: var(--radius-sm);\n  }\n\n  .sync-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  .sync-label {\n    font-size: var(--font-size-sm);\n    font-weight: 500;\n    color: var(--color-text-muted);\n  }\n\n  .sync-value {\n    font-size: var(--font-size-md);\n    font-weight: 600;\n    font-family: monospace;\n    color: var(--color-text);\n  }\n\n  .sync-buttons {\n    display: flex;\n    gap: 2px;\n    justify-content: center;\n  }\n\n  .sync-btn {\n    flex: 1;\n    padding: var(--spacing-xs);\n    font-size: var(--font-size-xs);\n    font-weight: 500;\n    background-color: var(--color-bg);\n    color: var(--color-text);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: var(--radius-sm);\n    cursor: pointer;\n    transition: all 0.15s ease;\n  }\n\n  .sync-btn:hover:not(:disabled) {\n    background-color: var(--color-primary);\n    color: white;\n    border-color: var(--color-primary);\n  }\n\n  .sync-btn:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n  }\n\n  .sync-btn.reset {\n    flex: 0.5;\n    font-weight: 600;\n  }\n\n  .sync-btn.reset:hover:not(:disabled) {\n    background-color: var(--color-secondary, #00d9ff);\n  }\n\n  .sync-hint {\n    font-size: var(--font-size-xs);\n    color: var(--color-text-muted);\n    text-align: center;\n    opacity: 0.7;\n  }\n</style>\n","<script lang=\"ts\">\n  /**\n   * Ultrastar Controls Component\n   *\n   * UI for uploading Ultrastar .txt files, displaying song info,\n   * and controlling playback with YouTube video sync.\n   */\n\n  import { ultrastarState } from '../../stores/ultrastarState.svelte.js';\n  import { youtubeState } from '../../stores/youtubeState.svelte.js';\n  import { highwayState } from '../../stores/highwayState.svelte.js';\n  import { appState } from '../../stores/appState.svelte.js';\n  import { createTransportSync, type TransportSyncInstance } from '../../services/transportSync.js';\n  import { onDestroy } from 'svelte';\n  import YouTubePlayer from '../youtube/YouTubePlayer.svelte';\n  import SyncControls from './SyncControls.svelte';\n\n  // Transport sync instance\n  let transportSync: TransportSyncInstance | null = null;\n  let syncLoopId: number | null = null;\n\n  // File input ref\n  let fileInput: HTMLInputElement;\n\n  // Reactive state\n  const isActive = $derived(ultrastarState.state.isActive);\n  const isLoading = $derived(ultrastarState.state.isLoading);\n  const isPlaying = $derived(ultrastarState.state.isPlaying);\n  const hasVideo = $derived(ultrastarState.hasVideo);\n  const songTitle = $derived(ultrastarState.title);\n  const songArtist = $derived(ultrastarState.artist);\n  const error = $derived(ultrastarState.state.error);\n\n  /**\n   * Handle file upload\n   */\n  async function handleFileSelect(event: Event) {\n    const input = event.target as HTMLInputElement;\n    const file = input.files?.[0];\n\n    if (!file) return;\n\n    const success = await ultrastarState.loadFile(file);\n\n    if (success) {\n      // Initialize transport sync with song's sync config\n      transportSync = createTransportSync({\n        syncConfig: ultrastarState.state.syncConfig,\n      });\n\n      // Apply detected pitch range to app\n      const range = ultrastarState.state.detectedRange;\n      appState.setYAxisRange({ minMidi: range.minMidi, maxMidi: range.maxMidi });\n\n      // Set target notes on highway\n      highwayState.setTargetNotes(ultrastarState.state.targetNotes);\n\n      // Debug logging\n      console.log('[Ultrastar] File loaded:', {\n        title: ultrastarState.title,\n        artist: ultrastarState.artist,\n        youtubeId: ultrastarState.state.youtubeId,\n        bpm: ultrastarState.state.song?.metadata.bpm,\n        gap: ultrastarState.state.song?.metadata.gap,\n        videoGap: ultrastarState.state.song?.metadata.videoGap,\n        noteCount: ultrastarState.state.targetNotes.length,\n        firstNotes: ultrastarState.state.targetNotes.slice(0, 3),\n        lastNotes: ultrastarState.state.targetNotes.slice(-3),\n        totalDurationMs: ultrastarState.state.totalDurationMs,\n        pitchRange: range,\n        syncConfig: ultrastarState.state.syncConfig,\n      });\n    }\n\n    // Reset input so same file can be selected again\n    input.value = '';\n  }\n\n  /**\n   * Start playback\n   */\n  async function handleStart() {\n    if (!isActive) return;\n\n    // Switch to highway mode\n    appState.setVisualizationMode('highway');\n\n    // Update transport sync config if offset changed\n    if (transportSync) {\n      transportSync.updateConfig(ultrastarState.state.syncConfig);\n    }\n\n    // Set target notes (in case they changed)\n    highwayState.setTargetNotes(ultrastarState.state.targetNotes);\n    ultrastarState.setPlaying(true);\n\n    // If we have video, YouTube is the master clock\n    if (hasVideo && youtubeState.state.isPlayerReady) {\n      const startOffset = transportSync?.getYouTubeOffset() ?? 0;\n\n      // Log for debugging\n      console.log('[Ultrastar] Starting playback:', {\n        youtubeOffset: startOffset,\n        noteCount: ultrastarState.state.targetNotes.length,\n        firstNote: ultrastarState.state.targetNotes[0],\n        syncConfig: ultrastarState.state.syncConfig,\n      });\n\n      // Reset highway time to 0\n      highwayState.setCurrentTime(0);\n\n      // Seek YouTube to the offset where first note plays\n      youtubeState.seekTo(startOffset);\n      youtubeState.play();\n\n      // Start sync loop - YouTube drives highway time\n      startSyncLoop();\n    } else {\n      // No video - use highway's internal clock\n      highwayState.start();\n    }\n  }\n\n  /**\n   * Stop playback\n   */\n  function handleStop() {\n    // Stop highway\n    highwayState.stop();\n    ultrastarState.setPlaying(false);\n\n    // Stop YouTube\n    youtubeState.pause();\n\n    // Stop sync loop\n    stopSyncLoop();\n  }\n\n  /**\n   * Unload current song\n   */\n  function handleUnload() {\n    handleStop();\n    ultrastarState.unload();\n    youtubeState.dispose();\n    highwayState.reset();\n    transportSync = null;\n  }\n\n  /**\n   * Start the sync loop - YouTube is the master clock for Ultrastar songs\n   * We sync the highway to YouTube, not the other way around\n   */\n  function startSyncLoop() {\n    if (syncLoopId !== null) {\n      clearInterval(syncLoopId);\n    }\n\n    // Use YouTube as the master clock - update highway time from YouTube position\n    youtubeState.startSyncLoop((ytTime) => {\n      if (!transportSync) return;\n\n      // Convert YouTube time to transport time and update highway\n      const transportTimeMs = transportSync.youTubeToTransport(ytTime);\n\n      // Only update if significantly different to avoid jitter\n      const currentTransport = highwayState.state.currentTimeMs;\n      const diffMs = Math.abs(transportTimeMs - currentTransport);\n\n      // Update highway time to match YouTube (with small threshold to reduce jitter)\n      if (diffMs > 50) {\n        highwayState.setCurrentTime(Math.max(0, transportTimeMs));\n      }\n    }, 100); // Check every 100ms for smoother sync\n  }\n\n  /**\n   * Stop the sync loop\n   */\n  function stopSyncLoop() {\n    youtubeState.stopSyncLoop();\n    if (syncLoopId !== null) {\n      clearInterval(syncLoopId);\n      syncLoopId = null;\n    }\n  }\n\n  /**\n   * Trigger file input click\n   */\n  function openFilePicker() {\n    fileInput?.click();\n  }\n\n  onDestroy(() => {\n    stopSyncLoop();\n    youtubeState.dispose();\n  });\n</script>\n\n<div class=\"ultrastar-panel\">\n  <h3 class=\"panel-title\">Ultrastar Song</h3>\n\n  <!-- Hidden file input -->\n  <input\n    type=\"file\"\n    accept=\".txt\"\n    bind:this={fileInput}\n    onchange={handleFileSelect}\n    style=\"display: none;\"\n  />\n\n  {#if !isActive}\n    <!-- Upload button -->\n    <button class=\"upload-btn\" onclick={openFilePicker} disabled={isLoading}>\n      {#if isLoading}\n        <span class=\"spinner\"></span>\n        Loading...\n      {:else}\n        Upload Ultrastar .txt\n      {/if}\n    </button>\n\n    {#if error}\n      <div class=\"error-message\">{error}</div>\n    {/if}\n  {:else}\n    <!-- Song Info -->\n    <div class=\"song-info\">\n      <div class=\"song-title\">{songTitle}</div>\n      <div class=\"song-artist\">{songArtist}</div>\n    </div>\n\n    <!-- YouTube Player (if video available) -->\n    {#if hasVideo}\n      <div class=\"video-section\">\n        <YouTubePlayer />\n        <SyncControls />\n      </div>\n    {/if}\n\n    <!-- Playback Controls -->\n    <div class=\"playback-controls\">\n      {#if !isPlaying}\n        <button class=\"play-btn\" onclick={handleStart}>\n           Play\n        </button>\n      {:else}\n        <button class=\"stop-btn\" onclick={handleStop}>\n           Stop\n        </button>\n      {/if}\n\n      <button class=\"unload-btn\" onclick={handleUnload} disabled={isPlaying}>\n        Unload\n      </button>\n    </div>\n\n    <!-- Progress info -->\n    {#if isPlaying}\n      <div class=\"progress-info\">\n        <span class=\"time-display\">\n          {Math.floor(highwayState.state.currentTimeMs / 1000)}s\n          / {Math.floor(ultrastarState.state.totalDurationMs / 1000)}s\n        </span>\n      </div>\n    {/if}\n  {/if}\n</div>\n\n<style>\n  .ultrastar-panel {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .panel-title {\n    font-size: var(--font-size-sm);\n    font-weight: 600;\n    color: var(--color-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n    margin: 0;\n  }\n\n  .upload-btn {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: var(--spacing-sm);\n    padding: var(--spacing-md);\n    font-size: var(--font-size-md);\n    font-weight: 600;\n    background-color: var(--color-primary);\n    color: white;\n    border: none;\n    border-radius: var(--radius-md);\n    cursor: pointer;\n    transition: background-color 0.2s ease;\n  }\n\n  .upload-btn:hover:not(:disabled) {\n    background-color: var(--color-primary-dark, #4a7bc8);\n  }\n\n  .upload-btn:disabled {\n    opacity: 0.7;\n    cursor: wait;\n  }\n\n  .spinner {\n    width: 16px;\n    height: 16px;\n    border: 2px solid rgba(255, 255, 255, 0.3);\n    border-top-color: white;\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n  }\n\n  @keyframes spin {\n    to {\n      transform: rotate(360deg);\n    }\n  }\n\n  .error-message {\n    padding: var(--spacing-sm);\n    font-size: var(--font-size-sm);\n    color: var(--color-error, #dc3545);\n    background-color: rgba(220, 53, 69, 0.1);\n    border-radius: var(--radius-sm);\n  }\n\n  .song-info {\n    padding: var(--spacing-sm);\n    background-color: var(--color-surface);\n    border-radius: var(--radius-sm);\n  }\n\n  .song-title {\n    font-size: var(--font-size-md);\n    font-weight: 600;\n    color: var(--color-text);\n  }\n\n  .song-artist {\n    font-size: var(--font-size-sm);\n    color: var(--color-text-muted);\n  }\n\n  .video-section {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-sm);\n  }\n\n  .playback-controls {\n    display: flex;\n    gap: var(--spacing-sm);\n  }\n\n  .play-btn {\n    flex: 1;\n    padding: var(--spacing-md);\n    font-size: var(--font-size-md);\n    font-weight: 600;\n    background-color: var(--color-success, #28a745);\n    color: white;\n    border: none;\n    border-radius: var(--radius-md);\n    cursor: pointer;\n    transition: background-color 0.2s ease;\n  }\n\n  .play-btn:hover {\n    background-color: #218838;\n  }\n\n  .stop-btn {\n    flex: 1;\n    padding: var(--spacing-md);\n    font-size: var(--font-size-md);\n    font-weight: 600;\n    background-color: var(--color-error, #dc3545);\n    color: white;\n    border: none;\n    border-radius: var(--radius-md);\n    cursor: pointer;\n    transition: background-color 0.2s ease;\n  }\n\n  .stop-btn:hover {\n    background-color: #c82333;\n  }\n\n  .unload-btn {\n    padding: var(--spacing-md);\n    font-size: var(--font-size-sm);\n    font-weight: 500;\n    background-color: var(--color-bg);\n    color: var(--color-text-muted);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: var(--radius-md);\n    cursor: pointer;\n    transition: all 0.2s ease;\n  }\n\n  .unload-btn:hover:not(:disabled) {\n    background-color: var(--color-surface);\n    color: var(--color-text);\n  }\n\n  .unload-btn:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n  }\n\n  .progress-info {\n    text-align: center;\n    padding: var(--spacing-sm);\n    background-color: var(--color-surface);\n    border-radius: var(--radius-sm);\n  }\n\n  .time-display {\n    font-size: var(--font-size-md);\n    font-weight: 500;\n    font-family: monospace;\n    color: var(--color-text);\n  }\n</style>\n","<script lang=\"ts\">\n  /**\n   * PitchReadout Component\n   *\n   * Displays the current detected pitch information.\n   */\n\n  import { pitchState } from '../../stores/pitchState.svelte.js';\n\n  const NOTE_NAMES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n\n  const currentNote = $derived(() => {\n    const pitch = pitchState.state.currentPitch;\n    if (!pitch) return null;\n\n    const noteName = NOTE_NAMES[pitch.pitchClass];\n    const octave = Math.floor(pitch.midi / 12) - 1;\n    const cents = Math.round((pitch.midi - Math.round(pitch.midi)) * 100);\n\n    return {\n      name: noteName,\n      octave,\n      frequency: pitch.frequency.toFixed(1),\n      cents,\n      clarity: Math.round(pitch.clarity * 100),\n    };\n  });\n</script>\n\n<div class=\"pitch-readout\">\n  {#if currentNote()}\n    {@const note = currentNote()!}\n    <div class=\"note-display\">\n      <span class=\"note-name\">{note.name}</span>\n      <span class=\"octave\">{note.octave}</span>\n    </div>\n    <div class=\"details\">\n      <span class=\"frequency\">{note.frequency} Hz</span>\n      <span class=\"cents\" class:sharp={note.cents > 0} class:flat={note.cents < 0}>\n        {note.cents > 0 ? '+' : ''}{note.cents}\n      </span>\n      <span class=\"clarity\">{note.clarity}%</span>\n    </div>\n  {:else}\n    <div class=\"no-pitch\">\n      <span class=\"placeholder\">---</span>\n      <span class=\"hint\">Sing or hum into the microphone</span>\n    </div>\n  {/if}\n</div>\n\n<style>\n  .pitch-readout {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: var(--spacing-lg);\n    background-color: var(--color-surface);\n    border-radius: var(--radius-md);\n    min-width: 200px;\n    min-height: 100px;\n  }\n\n  .note-display {\n    display: flex;\n    align-items: baseline;\n    gap: var(--spacing-xs);\n  }\n\n  .note-name {\n    font-size: var(--font-size-2xl);\n    font-weight: 700;\n    color: var(--color-secondary);\n  }\n\n  .octave {\n    font-size: var(--font-size-lg);\n    color: var(--color-text-muted);\n  }\n\n  .details {\n    display: flex;\n    gap: var(--spacing-md);\n    margin-top: var(--spacing-sm);\n    font-size: var(--font-size-sm);\n    color: var(--color-text-muted);\n  }\n\n  .cents {\n    font-weight: 500;\n  }\n\n  .cents.sharp {\n    color: var(--color-warning);\n  }\n\n  .cents.flat {\n    color: var(--color-primary);\n  }\n\n  .no-pitch {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--spacing-sm);\n  }\n\n  .placeholder {\n    font-size: var(--font-size-2xl);\n    color: var(--color-text-muted);\n  }\n\n  .hint {\n    font-size: var(--font-size-sm);\n    color: var(--color-text-muted);\n    opacity: 0.7;\n  }\n</style>\n","/**\n * Results State Store - Svelte 5 Runes\n *\n * Manages the display of performance results after song/exercise completion.\n * Calculates statistics and controls the results modal visibility.\n */\n\nimport type { NotePerformance } from '@mlt/student-notation-engine';\nimport type { TargetNote } from './highwayState.svelte.js';\n\n/** Result for a single phrase/section */\nexport interface PhraseResult {\n  phraseIndex: number;\n  notesHit: number;\n  totalNotes: number;\n  accuracyPercent: number;\n  lyricPreview: string;\n}\n\n/** Summary of overall performance */\nexport interface ResultsSummary {\n  totalNotes: number;\n  notesHit: number;\n  notesMissed: number;\n  accuracyPercent: number;\n  goldenNotesHit: number;\n  goldenNotesTotal: number;\n  phraseResults: PhraseResult[];\n  averagePitchDeviationCents: number;\n}\n\n/** State for the results modal */\nexport interface ResultsState {\n  isVisible: boolean;\n  summary: ResultsSummary | null;\n  songTitle: string;\n  artistName: string;\n  source: 'demo' | 'ultrastar' | null;\n}\n\nconst DEFAULT_STATE: ResultsState = {\n  isVisible: false,\n  summary: null,\n  songTitle: '',\n  artistName: '',\n  source: null,\n};\n\nconst EMPTY_SUMMARY: ResultsSummary = {\n  totalNotes: 0,\n  notesHit: 0,\n  notesMissed: 0,\n  accuracyPercent: 0,\n  goldenNotesHit: 0,\n  goldenNotesTotal: 0,\n  phraseResults: [],\n  averagePitchDeviationCents: 0,\n};\n\nfunction createResultsState() {\n  let state = $state<ResultsState>({ ...DEFAULT_STATE });\n\n  return {\n    get state() {\n      return state;\n    },\n\n    /**\n     * Show results modal with calculated summary\n     */\n    show(\n      summary: ResultsSummary,\n      options: {\n        title?: string;\n        artist?: string;\n        source?: 'demo' | 'ultrastar';\n      } = {}\n    ) {\n      state.summary = summary;\n      state.songTitle = options.title || '';\n      state.artistName = options.artist || '';\n      state.source = options.source || null;\n      state.isVisible = true;\n    },\n\n    /**\n     * Hide results modal\n     */\n    hide() {\n      state.isVisible = false;\n    },\n\n    /**\n     * Clear results and hide modal\n     */\n    clear() {\n      state = { ...DEFAULT_STATE };\n    },\n\n    /**\n     * Calculate summary from performance data and target notes\n     */\n    calculateSummary(\n      performances: Map<string, NotePerformance>,\n      targetNotes: TargetNote[]\n    ): ResultsSummary {\n      if (targetNotes.length === 0) {\n        return { ...EMPTY_SUMMARY };\n      }\n\n      let notesHit = 0;\n      let goldenNotesHit = 0;\n      let goldenNotesTotal = 0;\n      let totalPitchDeviation = 0;\n      let pitchDeviationCount = 0;\n\n      // Group notes by phrase for phrase-level results\n      const phraseMap = new Map<number, { hit: number; total: number; lyrics: string[] }>();\n\n      targetNotes.forEach((note, index) => {\n        const noteId = `target-${index}`;\n        const perf = performances.get(noteId);\n        const isGolden = (note as any).isGolden === true;\n        const phraseIndex = (note as any).phraseIndex ?? 0;\n\n        // Track golden notes\n        if (isGolden) {\n          goldenNotesTotal++;\n        }\n\n        // Initialize phrase tracking\n        if (!phraseMap.has(phraseIndex)) {\n          phraseMap.set(phraseIndex, { hit: 0, total: 0, lyrics: [] });\n        }\n        const phrase = phraseMap.get(phraseIndex)!;\n        phrase.total++;\n\n        // Track lyrics for preview\n        if (note.lyric) {\n          phrase.lyrics.push(note.lyric);\n        }\n\n        // Check if hit\n        if (perf?.hitStatus === 'hit') {\n          notesHit++;\n          phrase.hit++;\n\n          if (isGolden) {\n            goldenNotesHit++;\n          }\n\n          // Track pitch deviation if available\n          if (typeof perf.pitchAccuracyCents === 'number') {\n            totalPitchDeviation += Math.abs(perf.pitchAccuracyCents);\n            pitchDeviationCount++;\n          }\n        }\n      });\n\n      const totalNotes = targetNotes.length;\n      const notesMissed = totalNotes - notesHit;\n      const accuracyPercent = totalNotes > 0 ? (notesHit / totalNotes) * 100 : 0;\n      const averagePitchDeviationCents =\n        pitchDeviationCount > 0 ? totalPitchDeviation / pitchDeviationCount : 0;\n\n      // Build phrase results\n      const phraseResults: PhraseResult[] = [];\n      phraseMap.forEach((data, phraseIndex) => {\n        phraseResults.push({\n          phraseIndex,\n          notesHit: data.hit,\n          totalNotes: data.total,\n          accuracyPercent: data.total > 0 ? (data.hit / data.total) * 100 : 0,\n          lyricPreview: data.lyrics.join('').trim().slice(0, 30) || `Phrase ${phraseIndex + 1}`,\n        });\n      });\n\n      // Sort by phrase index\n      phraseResults.sort((a, b) => a.phraseIndex - b.phraseIndex);\n\n      return {\n        totalNotes,\n        notesHit,\n        notesMissed,\n        accuracyPercent,\n        goldenNotesHit,\n        goldenNotesTotal,\n        phraseResults,\n        averagePitchDeviationCents,\n      };\n    },\n\n    /**\n     * Get letter grade based on accuracy\n     */\n    getLetterGrade(accuracy: number): string {\n      if (accuracy >= 95) return 'S';\n      if (accuracy >= 90) return 'A';\n      if (accuracy >= 80) return 'B';\n      if (accuracy >= 70) return 'C';\n      if (accuracy >= 60) return 'D';\n      return 'F';\n    },\n\n    /**\n     * Get color for accuracy display\n     */\n    getAccuracyColor(accuracy: number): string {\n      if (accuracy >= 90) return 'var(--color-success, #28a745)';\n      if (accuracy >= 70) return 'var(--color-warning, #ffc107)';\n      return 'var(--color-error, #dc3545)';\n    },\n  };\n}\n\nexport const resultsState = createResultsState();\n","<script lang=\"ts\">\n  /**\n   * Results Modal Component\n   *\n   * Displays performance results after song/exercise completion.\n   * Shows accuracy, notes hit, letter grade, and optional phrase breakdown.\n   */\n\n  import { resultsState, type ResultsSummary } from '../../stores/resultsState.svelte.js';\n\n  interface Props {\n    onRetry?: () => void;\n    onClose?: () => void;\n  }\n\n  let { onRetry, onClose }: Props = $props();\n\n  // Reactive state\n  const isVisible = $derived(resultsState.state.isVisible);\n  const summary = $derived(resultsState.state.summary);\n  const songTitle = $derived(resultsState.state.songTitle);\n  const artistName = $derived(resultsState.state.artistName);\n\n  // Derived values\n  const letterGrade = $derived(\n    summary ? resultsState.getLetterGrade(summary.accuracyPercent) : 'F'\n  );\n  const accuracyColor = $derived(\n    summary ? resultsState.getAccuracyColor(summary.accuracyPercent) : ''\n  );\n\n  /**\n   * Handle close button\n   */\n  function handleClose() {\n    resultsState.hide();\n    onClose?.();\n  }\n\n  /**\n   * Handle retry button\n   */\n  function handleRetry() {\n    resultsState.hide();\n    onRetry?.();\n  }\n\n  /**\n   * Handle backdrop click\n   */\n  function handleBackdropClick(event: MouseEvent) {\n    if (event.target === event.currentTarget) {\n      handleClose();\n    }\n  }\n\n  /**\n   * Handle escape key\n   */\n  function handleKeydown(event: KeyboardEvent) {\n    if (event.key === 'Escape' && isVisible) {\n      handleClose();\n    }\n  }\n</script>\n\n<svelte:window onkeydown={handleKeydown} />\n\n{#if isVisible && summary}\n  <!-- svelte-ignore a11y_no_noninteractive_element_interactions -->\n  <!-- svelte-ignore a11y_click_events_have_key_events -->\n  <div\n    class=\"modal-backdrop\"\n    onclick={handleBackdropClick}\n    onkeydown={handleKeydown}\n    role=\"dialog\"\n    aria-modal=\"true\"\n    aria-labelledby=\"results-title\"\n    tabindex=\"-1\"\n  >\n    <div class=\"modal-content\">\n      <!-- Header -->\n      <div class=\"modal-header\">\n        <h2 id=\"results-title\" class=\"modal-title\">Results</h2>\n        {#if songTitle}\n          <div class=\"song-info\">\n            <span class=\"song-title\">{songTitle}</span>\n            {#if artistName}\n              <span class=\"song-artist\">by {artistName}</span>\n            {/if}\n          </div>\n        {/if}\n      </div>\n\n      <!-- Main Stats -->\n      <div class=\"stats-section\">\n        <!-- Letter Grade -->\n        <div class=\"grade-display\" style:--grade-color={accuracyColor}>\n          <span class=\"grade-letter\">{letterGrade}</span>\n        </div>\n\n        <!-- Accuracy -->\n        <div class=\"accuracy-display\" style:color={accuracyColor}>\n          <span class=\"accuracy-value\">{summary.accuracyPercent.toFixed(1)}%</span>\n          <span class=\"accuracy-label\">Accuracy</span>\n        </div>\n\n        <!-- Notes Hit -->\n        <div class=\"stats-row\">\n          <div class=\"stat-item\">\n            <span class=\"stat-value hit\">{summary.notesHit}</span>\n            <span class=\"stat-label\">Hit</span>\n          </div>\n          <div class=\"stat-divider\">/</div>\n          <div class=\"stat-item\">\n            <span class=\"stat-value total\">{summary.totalNotes}</span>\n            <span class=\"stat-label\">Total</span>\n          </div>\n          {#if summary.notesMissed > 0}\n            <div class=\"stat-item missed\">\n              <span class=\"stat-value\">{summary.notesMissed}</span>\n              <span class=\"stat-label\">Missed</span>\n            </div>\n          {/if}\n        </div>\n\n        <!-- Golden Notes (if any) -->\n        {#if summary.goldenNotesTotal > 0}\n          <div class=\"golden-stats\">\n            <span class=\"golden-icon\"></span>\n            <span class=\"golden-text\">\n              Golden Notes: {summary.goldenNotesHit}/{summary.goldenNotesTotal}\n            </span>\n          </div>\n        {/if}\n\n        <!-- Average Pitch Deviation -->\n        {#if summary.averagePitchDeviationCents > 0}\n          <div class=\"pitch-stats\">\n            <span class=\"pitch-label\">Avg. Pitch Deviation:</span>\n            <span class=\"pitch-value\">\n              {summary.averagePitchDeviationCents.toFixed(1)} cents\n            </span>\n          </div>\n        {/if}\n      </div>\n\n      <!-- Phrase Breakdown (collapsible) -->\n      {#if summary.phraseResults.length > 1}\n        <details class=\"phrase-details\">\n          <summary class=\"phrase-summary\">Phrase Breakdown</summary>\n          <div class=\"phrase-list\">\n            {#each summary.phraseResults as phrase}\n              <div\n                class=\"phrase-item\"\n                class:perfect={phrase.accuracyPercent === 100}\n                class:good={phrase.accuracyPercent >= 70 && phrase.accuracyPercent < 100}\n                class:poor={phrase.accuracyPercent < 70}\n              >\n                <span class=\"phrase-lyric\">{phrase.lyricPreview}</span>\n                <span class=\"phrase-accuracy\">\n                  {phrase.notesHit}/{phrase.totalNotes}\n                  ({phrase.accuracyPercent.toFixed(0)}%)\n                </span>\n              </div>\n            {/each}\n          </div>\n        </details>\n      {/if}\n\n      <!-- Actions -->\n      <div class=\"modal-actions\">\n        {#if onRetry}\n          <button class=\"action-btn retry-btn\" onclick={handleRetry}>\n            Try Again\n          </button>\n        {/if}\n        <button class=\"action-btn close-btn\" onclick={handleClose}>\n          Close\n        </button>\n      </div>\n    </div>\n  </div>\n{/if}\n\n<style>\n  .modal-backdrop {\n    position: fixed;\n    inset: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: rgba(0, 0, 0, 0.75);\n    z-index: 1000;\n    animation: fadeIn 0.2s ease;\n  }\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n\n  .modal-content {\n    width: 90%;\n    max-width: 400px;\n    max-height: 80vh;\n    overflow-y: auto;\n    background-color: var(--color-surface);\n    border-radius: var(--radius-lg, 12px);\n    padding: var(--spacing-lg);\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n    animation: slideUp 0.3s ease;\n  }\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n\n  .modal-header {\n    text-align: center;\n    margin-bottom: var(--spacing-lg);\n  }\n\n  .modal-title {\n    font-size: var(--font-size-xl);\n    font-weight: 700;\n    color: var(--color-text);\n    margin: 0 0 var(--spacing-sm);\n  }\n\n  .song-info {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n  }\n\n  .song-title {\n    font-size: var(--font-size-md);\n    font-weight: 600;\n    color: var(--color-text);\n  }\n\n  .song-artist {\n    font-size: var(--font-size-sm);\n    color: var(--color-text-muted);\n  }\n\n  .stats-section {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--spacing-md);\n  }\n\n  .grade-display {\n    width: 80px;\n    height: 80px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border: 4px solid var(--grade-color);\n    border-radius: 50%;\n  }\n\n  .grade-letter {\n    font-size: 48px;\n    font-weight: 800;\n    color: var(--grade-color);\n  }\n\n  .accuracy-display {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 2px;\n  }\n\n  .accuracy-value {\n    font-size: var(--font-size-2xl, 32px);\n    font-weight: 700;\n  }\n\n  .accuracy-label {\n    font-size: var(--font-size-sm);\n    text-transform: uppercase;\n    letter-spacing: 0.1em;\n    opacity: 0.7;\n  }\n\n  .stats-row {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n  }\n\n  .stat-item {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .stat-value {\n    font-size: var(--font-size-lg);\n    font-weight: 600;\n  }\n\n  .stat-value.hit {\n    color: var(--color-success, #28a745);\n  }\n\n  .stat-value.total {\n    color: var(--color-text);\n  }\n\n  .stat-item.missed .stat-value {\n    color: var(--color-error, #dc3545);\n  }\n\n  .stat-label {\n    font-size: var(--font-size-xs);\n    color: var(--color-text-muted);\n    text-transform: uppercase;\n  }\n\n  .stat-divider {\n    font-size: var(--font-size-lg);\n    color: var(--color-text-muted);\n  }\n\n  .golden-stats {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-xs);\n    padding: var(--spacing-xs) var(--spacing-sm);\n    background-color: rgba(255, 193, 7, 0.1);\n    border-radius: var(--radius-sm);\n  }\n\n  .golden-icon {\n    font-size: var(--font-size-md);\n  }\n\n  .golden-text {\n    font-size: var(--font-size-sm);\n    color: #ffc107;\n    font-weight: 500;\n  }\n\n  .pitch-stats {\n    display: flex;\n    gap: var(--spacing-xs);\n    font-size: var(--font-size-sm);\n    color: var(--color-text-muted);\n  }\n\n  .pitch-value {\n    font-weight: 500;\n    color: var(--color-text);\n  }\n\n  .phrase-details {\n    width: 100%;\n    margin-top: var(--spacing-md);\n    background-color: var(--color-bg);\n    border-radius: var(--radius-sm);\n  }\n\n  .phrase-summary {\n    padding: var(--spacing-sm);\n    font-size: var(--font-size-sm);\n    font-weight: 500;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .phrase-summary:hover {\n    color: var(--color-primary);\n  }\n\n  .phrase-list {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    padding: 0 var(--spacing-sm) var(--spacing-sm);\n  }\n\n  .phrase-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: var(--spacing-xs) var(--spacing-sm);\n    background-color: var(--color-surface);\n    border-radius: var(--radius-sm);\n    font-size: var(--font-size-sm);\n    border-left: 3px solid transparent;\n  }\n\n  .phrase-item.perfect {\n    border-left-color: var(--color-success, #28a745);\n  }\n\n  .phrase-item.good {\n    border-left-color: var(--color-warning, #ffc107);\n  }\n\n  .phrase-item.poor {\n    border-left-color: var(--color-error, #dc3545);\n  }\n\n  .phrase-lyric {\n    color: var(--color-text);\n    flex: 1;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  .phrase-accuracy {\n    color: var(--color-text-muted);\n    flex-shrink: 0;\n    margin-left: var(--spacing-sm);\n  }\n\n  .modal-actions {\n    display: flex;\n    gap: var(--spacing-sm);\n    margin-top: var(--spacing-lg);\n  }\n\n  .action-btn {\n    flex: 1;\n    padding: var(--spacing-md);\n    font-size: var(--font-size-md);\n    font-weight: 600;\n    border: none;\n    border-radius: var(--radius-md);\n    cursor: pointer;\n    transition: all 0.2s ease;\n  }\n\n  .retry-btn {\n    background-color: var(--color-primary);\n    color: white;\n  }\n\n  .retry-btn:hover {\n    background-color: var(--color-primary-dark, #4a7bc8);\n  }\n\n  .close-btn {\n    background-color: var(--color-bg);\n    color: var(--color-text);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n  }\n\n  .close-btn:hover {\n    background-color: var(--color-surface);\n  }\n</style>\n","/**\n * @mlt/handoff - Snapshot Types\n *\n * Defines the data structures for cross-app handoff between Student Notation\n * and Singing Trainer. This is a COPY SNAPSHOT approach - not live sync.\n *\n * SCHEMA VERSION: 1\n * - Initial implementation with core note data and grid structure\n */\n\n// ============================================================================\n// Schema Version\n// ============================================================================\n\nexport const SNAPSHOT_SCHEMA_VERSION = 1;\n\n// ============================================================================\n// Core Types\n// ============================================================================\n\n/**\n * A note event within a single voice/color.\n * Represents a monophonic note in the time grid.\n */\nexport interface SnapshotNote {\n  /** Start position in microbeat columns (0-indexed, inclusive) */\n  startMicrobeatCol: number;\n  /** End position in microbeat columns (inclusive - occupies start through end) */\n  endMicrobeatCol: number;\n  /** MIDI pitch number (e.g., 60 = C4) */\n  midiPitch: number;\n  /** Original pitch name for display (e.g., \"C4\", \"Bb3\") */\n  pitchName: string;\n  /** Shape of the note for rendering */\n  shape: 'circle' | 'oval' | 'diamond';\n}\n\n/**\n * A voice containing monophonic note events.\n * Multiple voices can overlap with each other (polyphony across voices).\n */\nexport interface SnapshotVoice {\n  /** Unique identifier for the voice (typically the color) */\n  voiceId: string;\n  /** Display color for the voice (hex code) */\n  color: string;\n  /** Array of notes in this voice (must be monophonic - no overlaps within voice) */\n  notes: SnapshotNote[];\n}\n\n/**\n * Describes the time grid structure.\n * Includes macrobeat groupings for visual rendering.\n */\nexport interface TimeGridStructure {\n  /** Total number of microbeat columns */\n  microbeatCount: number;\n  /** Number of microbeats per macrobeat (explicit for redundancy) */\n  microbeatsPerMacrobeat: number;\n  /**\n   * Array of macrobeat groupings (2 or 3 microbeats per macrobeat).\n   * Each entry corresponds to one macrobeat.\n   * Used to render grid lines:\n   * - thin/no lines between microbeats\n   * - solid lines between macrobeats\n   * - thicker solid lines between measures\n   */\n  macrobeatGroupings: (2 | 3)[];\n  /**\n   * Boundary styles for each macrobeat.\n   * 'dashed' = dashed line (e.g., between macrobeats within measure)\n   * 'solid' = solid line (e.g., measure boundary)\n   * 'anacrusis' = pickup measure boundary\n   */\n  macrobeatBoundaryStyles: ('dashed' | 'solid' | 'anacrusis')[];\n}\n\n/**\n * Optional visual overlay/annotation from Student Notation.\n * These are purely visual and do not affect app logic.\n *\n * WARNING: If stored in pixel coordinates, these may not survive zoom/scale changes.\n * Grid-relative coordinates are preferred.\n */\nexport interface VisualOverlay {\n  /** Type of overlay */\n  type: 'freehand' | 'text' | 'arrow';\n  /** Unique identifier */\n  id: string;\n  /** Raw annotation data (varies by type) */\n  data: unknown;\n  /**\n   * Coordinate system used.\n   * 'pixel' = pixel coordinates (fragile under zoom)\n   * 'grid' = grid-relative coordinates (preferred)\n   */\n  coordinateSystem: 'pixel' | 'grid';\n}\n\n/**\n * Optional pitch range hint for initializing a viewport.\n */\nexport interface SnapshotPitchRange {\n  /** Lowest MIDI pitch in the range */\n  minMidi: number;\n  /** Highest MIDI pitch in the range */\n  maxMidi: number;\n}\n\n/**\n * Preferred source for pitch range initialization.\n */\nexport type PitchRangeSource = 'notes' | 'clef';\n\n/**\n * Tonal center information for drone and degree-based display.\n * Used to share key/tonic between Student Notation and Singing Trainer.\n */\nexport interface TonalCenter {\n  /** Pitch class (e.g., \"C\", \"C#\", \"Db\", \"F#\") */\n  pitchClass: string;\n  /** Optional octave for drone purposes (e.g., 3, 4) */\n  octave?: number;\n  /** Optional mode (e.g., \"major\", \"minor\", \"dorian\") */\n  mode?: string;\n}\n\n// ============================================================================\n// Main Snapshot Type\n// ============================================================================\n\n/**\n * Complete snapshot for handoff between Student Notation and Singing Trainer.\n *\n * This contains all data needed to reconstruct the pitch grid and target notes\n * in the Singing Trainer.\n */\nexport interface SingingTrainerSnapshot {\n  /** Schema version for forward compatibility */\n  schemaVersion: typeof SNAPSHOT_SCHEMA_VERSION;\n\n  /** Timestamp when snapshot was created */\n  createdAt: number;\n\n  /** Optional identifier for the source file */\n  sourceFileId?: string;\n\n  /** Source app that created the snapshot */\n  sourceApp: 'student-notation' | 'singing-trainer';\n\n  // --- Time Grid Structure ---\n  timeGrid: TimeGridStructure;\n\n  // --- Voice Data ---\n  /** Array of voices, each containing monophonic notes */\n  voices: SnapshotVoice[];\n\n  // --- Optional Tempo ---\n  /** Tempo in BPM (can be manipulated locally after import) */\n  tempo?: number;\n\n  // --- Pitch Range Hints ---\n  /** Lowest MIDI pitch in the dataset (for viewport initialization) */\n  minMidiPitch?: number;\n  /** Highest MIDI pitch in the dataset (for viewport initialization) */\n  maxMidiPitch?: number;\n  /** Pitch range based on the clef wheel selection (optional) */\n  clefPitchRange?: SnapshotPitchRange;\n  /** Preferred source for pitch range initialization (optional) */\n  preferredPitchRangeSource?: PitchRangeSource;\n\n  // --- Visual Overlays (optional) ---\n  /** Visual annotations that don't affect logic */\n  visualOverlays?: VisualOverlay[];\n\n  // --- Tonal Center (optional) ---\n  /**\n   * Tonal center for drone and degree-based display.\n   * If provided, Singing Trainer can use this to initialize the drone pitch.\n   */\n  tonalCenter?: TonalCenter;\n}\n\n// ============================================================================\n// Validation Types\n// ============================================================================\n\n/**\n * Represents an overlap conflict within a single voice.\n */\nexport interface OverlapConflict {\n  /** The voice ID where the conflict occurs */\n  voiceId: string;\n  /** Display color of the voice */\n  color: string;\n  /** Microbeat columns where the conflict occurs */\n  conflictColumns: number[];\n  /** First conflicting note */\n  note1: { startMicrobeatCol: number; endMicrobeatCol: number; midiPitch: number };\n  /** Second conflicting note */\n  note2: { startMicrobeatCol: number; endMicrobeatCol: number; midiPitch: number };\n}\n\n/**\n * Result of validating a snapshot for Singing Trainer import.\n */\nexport interface ValidationResult {\n  /** Whether the snapshot is valid for import */\n  isValid: boolean;\n  /** Array of overlap conflicts (empty if valid) */\n  conflicts: OverlapConflict[];\n  /** Human-readable error messages */\n  errorMessages: string[];\n}\n\n// ============================================================================\n// Handoff Slot Types\n// ============================================================================\n\n/**\n * Wrapper for the handoff slot data with metadata.\n */\nexport interface HandoffSlotData {\n  /** The snapshot data */\n  snapshot: SingingTrainerSnapshot;\n  /** When the slot was written */\n  writtenAt: number;\n  /** Unique ID for this handoff */\n  handoffId: string;\n}\n\n/**\n * Direction of the handoff.\n */\nexport type HandoffDirection =\n  | 'student-notation-to-singing-trainer'\n  | 'singing-trainer-to-student-notation';\n","/**\n * @mlt/handoff - Storage\n *\n * Implements the \"handoff slot\" mechanism using IndexedDB with localStorage fallback.\n * The slot is a one-time transfer: write once, read once, then clear.\n *\n * DESIGN NOTES:\n * - IndexedDB is preferred for larger payloads and better structured data.\n * - localStorage fallback for browsers with IndexedDB issues.\n * - Handoff slot is keyed by a unique handoff ID.\n * - Slot auto-expires after 5 minutes to prevent stale data.\n */\n\nimport type { SingingTrainerSnapshot, HandoffSlotData } from './types.js';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst DB_NAME = 'mlt-handoff';\nconst DB_VERSION = 1;\nconst STORE_NAME = 'handoff-slots';\nconst STORAGE_KEY = 'mlt-handoff-slot';\nconst SLOT_EXPIRY_MS = 5 * 60 * 1000; // 5 minutes\n\n// ============================================================================\n// IndexedDB Utilities\n// ============================================================================\n\n/**\n * Open the IndexedDB database.\n */\nfunction openDatabase(): Promise<IDBDatabase> {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n    request.onerror = () => {\n      reject(new Error('Failed to open IndexedDB'));\n    };\n\n    request.onsuccess = () => {\n      resolve(request.result);\n    };\n\n    request.onupgradeneeded = (event) => {\n      const db = (event.target as IDBOpenDBRequest).result;\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\n        db.createObjectStore(STORE_NAME, { keyPath: 'handoffId' });\n      }\n    };\n  });\n}\n\n/**\n * Check if IndexedDB is available and working.\n */\nasync function isIndexedDBAvailable(): Promise<boolean> {\n  if (typeof indexedDB === 'undefined') {\n    return false;\n  }\n\n  try {\n    const db = await openDatabase();\n    db.close();\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================================================\n// Generate Unique ID\n// ============================================================================\n\n/**\n * Generate a unique handoff ID.\n */\nexport function generateHandoffId(): string {\n  const timestamp = Date.now().toString(36);\n  const random = Math.random().toString(36).substring(2, 10);\n  return `handoff-${timestamp}-${random}`;\n}\n\n// ============================================================================\n// Write to Handoff Slot\n// ============================================================================\n\n/**\n * Write a snapshot to the handoff slot using IndexedDB.\n */\nasync function writeToIndexedDB(data: HandoffSlotData): Promise<void> {\n  const db = await openDatabase();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(STORE_NAME, 'readwrite');\n    const store = transaction.objectStore(STORE_NAME);\n\n    // Clear any existing slots first\n    const clearRequest = store.clear();\n\n    clearRequest.onsuccess = () => {\n      const addRequest = store.add(data);\n\n      addRequest.onsuccess = () => {\n        resolve();\n      };\n\n      addRequest.onerror = () => {\n        reject(new Error('Failed to write to IndexedDB'));\n      };\n    };\n\n    clearRequest.onerror = () => {\n      reject(new Error('Failed to clear IndexedDB'));\n    };\n\n    transaction.oncomplete = () => {\n      db.close();\n    };\n  });\n}\n\n/**\n * Write a snapshot to the handoff slot using localStorage fallback.\n */\nfunction writeToLocalStorage(data: HandoffSlotData): void {\n  try {\n    const serialized = JSON.stringify(data);\n    localStorage.setItem(STORAGE_KEY, serialized);\n  } catch (error) {\n    throw new Error(`Failed to write to localStorage: ${error}`);\n  }\n}\n\n/**\n * Write a snapshot to the handoff slot.\n * Uses IndexedDB with localStorage fallback.\n *\n * @param snapshot The snapshot to store\n * @returns The handoff ID for reference\n */\nexport async function writeHandoffSlot(snapshot: SingingTrainerSnapshot): Promise<string> {\n  const handoffId = generateHandoffId();\n  const data: HandoffSlotData = {\n    snapshot,\n    writtenAt: Date.now(),\n    handoffId,\n  };\n\n  const useIndexedDB = await isIndexedDBAvailable();\n\n  if (useIndexedDB) {\n    try {\n      await writeToIndexedDB(data);\n      return handoffId;\n    } catch {\n      // Fall back to localStorage\n      writeToLocalStorage(data);\n      return handoffId;\n    }\n  } else {\n    writeToLocalStorage(data);\n    return handoffId;\n  }\n}\n\n// ============================================================================\n// Read from Handoff Slot\n// ============================================================================\n\n/**\n * Read from IndexedDB handoff slot.\n */\nasync function readFromIndexedDB(): Promise<HandoffSlotData | null> {\n  const db = await openDatabase();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(STORE_NAME, 'readonly');\n    const store = transaction.objectStore(STORE_NAME);\n    const request = store.getAll();\n\n    request.onsuccess = () => {\n      const results = request.result as HandoffSlotData[];\n      if (results.length > 0) {\n        // Return the most recent one\n        resolve(results[results.length - 1]);\n      } else {\n        resolve(null);\n      }\n    };\n\n    request.onerror = () => {\n      reject(new Error('Failed to read from IndexedDB'));\n    };\n\n    transaction.oncomplete = () => {\n      db.close();\n    };\n  });\n}\n\n/**\n * Read from localStorage handoff slot.\n */\nfunction readFromLocalStorage(): HandoffSlotData | null {\n  try {\n    const serialized = localStorage.getItem(STORAGE_KEY);\n    if (!serialized) {\n      return null;\n    }\n    return JSON.parse(serialized) as HandoffSlotData;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Read the snapshot from the handoff slot.\n * Does NOT clear the slot (use clearHandoffSlot separately).\n *\n * @returns The snapshot or null if no slot exists or expired\n */\nexport async function readHandoffSlot(): Promise<SingingTrainerSnapshot | null> {\n  const useIndexedDB = await isIndexedDBAvailable();\n\n  let data: HandoffSlotData | null = null;\n\n  if (useIndexedDB) {\n    try {\n      data = await readFromIndexedDB();\n    } catch {\n      // Fall back to localStorage\n      data = readFromLocalStorage();\n    }\n  } else {\n    data = readFromLocalStorage();\n  }\n\n  if (!data) {\n    return null;\n  }\n\n  // Check expiry\n  const age = Date.now() - data.writtenAt;\n  if (age > SLOT_EXPIRY_MS) {\n    // Slot expired, clear it\n    await clearHandoffSlot();\n    return null;\n  }\n\n  return data.snapshot;\n}\n\n/**\n * Read the full handoff slot data including metadata.\n *\n * @returns The full slot data or null\n */\nexport async function readHandoffSlotData(): Promise<HandoffSlotData | null> {\n  const useIndexedDB = await isIndexedDBAvailable();\n\n  let data: HandoffSlotData | null = null;\n\n  if (useIndexedDB) {\n    try {\n      data = await readFromIndexedDB();\n    } catch {\n      data = readFromLocalStorage();\n    }\n  } else {\n    data = readFromLocalStorage();\n  }\n\n  if (!data) {\n    return null;\n  }\n\n  // Check expiry\n  const age = Date.now() - data.writtenAt;\n  if (age > SLOT_EXPIRY_MS) {\n    await clearHandoffSlot();\n    return null;\n  }\n\n  return data;\n}\n\n// ============================================================================\n// Clear Handoff Slot\n// ============================================================================\n\n/**\n * Clear IndexedDB handoff slot.\n */\nasync function clearIndexedDB(): Promise<void> {\n  const db = await openDatabase();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(STORE_NAME, 'readwrite');\n    const store = transaction.objectStore(STORE_NAME);\n    const request = store.clear();\n\n    request.onsuccess = () => {\n      resolve();\n    };\n\n    request.onerror = () => {\n      reject(new Error('Failed to clear IndexedDB'));\n    };\n\n    transaction.oncomplete = () => {\n      db.close();\n    };\n  });\n}\n\n/**\n * Clear localStorage handoff slot.\n */\nfunction clearLocalStorage(): void {\n  try {\n    localStorage.removeItem(STORAGE_KEY);\n  } catch {\n    // Ignore errors\n  }\n}\n\n/**\n * Clear the handoff slot.\n * Should be called after successfully reading and importing the snapshot.\n */\nexport async function clearHandoffSlot(): Promise<void> {\n  const useIndexedDB = await isIndexedDBAvailable();\n\n  // Clear both to be safe\n  clearLocalStorage();\n\n  if (useIndexedDB) {\n    try {\n      await clearIndexedDB();\n    } catch {\n      // Already cleared localStorage, ignore IndexedDB errors\n    }\n  }\n}\n\n// ============================================================================\n// Convenience: Read and Clear\n// ============================================================================\n\n/**\n * Read the snapshot from the handoff slot and immediately clear it.\n * This is the typical pattern for the receiving app.\n *\n * @returns The snapshot or null if no slot exists\n */\nexport async function consumeHandoffSlot(): Promise<SingingTrainerSnapshot | null> {\n  const snapshot = await readHandoffSlot();\n\n  if (snapshot) {\n    await clearHandoffSlot();\n  }\n\n  return snapshot;\n}\n","/**\n * @mlt/handoff - Navigation\n *\n * Utilities for navigating between apps in the same tab.\n */\n\nimport type { HandoffDirection } from './types.js';\n\n// ============================================================================\n// App Routes\n// ============================================================================\n\n/**\n * Get the relative URL for an app within the hub.\n */\nexport function getAppRoute(app: 'student-notation' | 'singing-trainer'): string {\n  switch (app) {\n    case 'student-notation':\n      return '/student-notation/';\n    case 'singing-trainer':\n      return '/singing-trainer/';\n    default:\n      throw new Error(`Unknown app: ${app}`);\n  }\n}\n\n/**\n * Navigate to an app in the same tab.\n *\n * @param app Target app\n * @param params Optional query parameters\n */\nexport function navigateToApp(\n  app: 'student-notation' | 'singing-trainer',\n  params?: Record<string, string>\n): void {\n  let url = getAppRoute(app);\n\n  // Add query params if provided\n  if (params && Object.keys(params).length > 0) {\n    const searchParams = new URLSearchParams(params);\n    url += `?${searchParams.toString()}`;\n  }\n\n  // Navigate in same tab\n  window.location.href = url;\n}\n\n/**\n * Navigate to Singing Trainer with handoff indicator.\n *\n * @param handoffId The handoff ID for reference\n */\nexport function navigateToSingingTrainer(handoffId?: string): void {\n  const params: Record<string, string> = {};\n\n  if (handoffId) {\n    params.handoff = handoffId;\n  }\n\n  // Add source indicator\n  params.from = 'student-notation';\n\n  navigateToApp('singing-trainer', params);\n}\n\n/**\n * Navigate to Student Notation with handoff indicator.\n *\n * @param handoffId The handoff ID for reference\n */\nexport function navigateToStudentNotation(handoffId?: string): void {\n  const params: Record<string, string> = {};\n\n  if (handoffId) {\n    params.handoff = handoffId;\n  }\n\n  // Add source indicator\n  params.from = 'singing-trainer';\n\n  navigateToApp('student-notation', params);\n}\n\n/**\n * Check if the current page was loaded via handoff.\n *\n * @returns Handoff info or null\n */\nexport function checkForHandoff(): {\n  direction: HandoffDirection;\n  handoffId?: string;\n} | null {\n  const params = new URLSearchParams(window.location.search);\n  const from = params.get('from');\n  const handoffId = params.get('handoff') ?? undefined;\n\n  if (from === 'student-notation') {\n    return {\n      direction: 'student-notation-to-singing-trainer',\n      handoffId,\n    };\n  }\n\n  if (from === 'singing-trainer') {\n    return {\n      direction: 'singing-trainer-to-student-notation',\n      handoffId,\n    };\n  }\n\n  return null;\n}\n\n/**\n * Clear handoff query parameters from the URL without reloading.\n * Keeps the URL clean after processing the handoff.\n */\nexport function clearHandoffParams(): void {\n  const url = new URL(window.location.href);\n  url.searchParams.delete('handoff');\n  url.searchParams.delete('from');\n\n  // Update URL without reload\n  window.history.replaceState({}, '', url.toString());\n}\n","/**\n * Handoff State Store - Svelte 5 Runes\n *\n * Manages imported snapshot data from Student Notation.\n * This store handles the handoff lifecycle:\n * 1. Check for handoff on app load\n * 2. Import snapshot data\n * 3. Provide access to imported voices and grid structure\n * 4. Support \"Bring Back to Student Notation\" flow\n */\n\nimport {\n  consumeHandoffSlot,\n  checkForHandoff,\n  clearHandoffParams,\n  writeHandoffSlot,\n  navigateToStudentNotation,\n  type SingingTrainerSnapshot,\n  type SnapshotVoice,\n  type TimeGridStructure,\n  SNAPSHOT_SCHEMA_VERSION,\n} from '@mlt/handoff';\n\nexport interface HandoffState {\n  /** Whether a snapshot has been imported */\n  hasImportedSnapshot: boolean;\n  /** The imported snapshot (if any) */\n  snapshot: SingingTrainerSnapshot | null;\n  /** Loading state during handoff processing */\n  isLoading: boolean;\n  /** Error message if handoff failed */\n  error: string | null;\n  /** Transposition offset in semitones (positive = up) */\n  transpositionSemitones: number;\n}\n\nconst DEFAULT_STATE: HandoffState = {\n  hasImportedSnapshot: false,\n  snapshot: null,\n  isLoading: false,\n  error: null,\n  transpositionSemitones: 0,\n};\n\nfunction createHandoffState() {\n  let state = $state<HandoffState>({ ...DEFAULT_STATE });\n\n  return {\n    get state() {\n      return state;\n    },\n\n    /**\n     * Check for and consume any pending handoff on app initialization.\n     * Should be called once when the app loads.\n     */\n    async checkAndConsumeHandoff(): Promise<boolean> {\n      // First check URL params to see if we came from a handoff\n      const handoffInfo = checkForHandoff();\n\n      if (!handoffInfo) {\n        return false;\n      }\n\n      state.isLoading = true;\n      state.error = null;\n\n      try {\n        // Try to read and consume the snapshot from the handoff slot\n        const snapshot = await consumeHandoffSlot();\n\n        if (!snapshot) {\n          state.error = 'Handoff data expired or not found. Please try exporting again.';\n          state.isLoading = false;\n          clearHandoffParams();\n          return false;\n        }\n\n        // Validate schema version\n        if (snapshot.schemaVersion !== SNAPSHOT_SCHEMA_VERSION) {\n          state.error = `Incompatible snapshot version: ${snapshot.schemaVersion}. Expected: ${SNAPSHOT_SCHEMA_VERSION}`;\n          state.isLoading = false;\n          clearHandoffParams();\n          return false;\n        }\n\n        // Successfully imported\n        state.snapshot = snapshot;\n        state.hasImportedSnapshot = true;\n        state.isLoading = false;\n\n        // Clear URL params to keep the URL clean\n        clearHandoffParams();\n\n        console.log('[HandoffState] Successfully imported snapshot', {\n          voices: snapshot.voices.length,\n          microbeatCount: snapshot.timeGrid.microbeatCount,\n          tempo: snapshot.tempo,\n        });\n\n        return true;\n      } catch (error) {\n        console.error('[HandoffState] Failed to process handoff', error);\n        state.error = 'Failed to import data from Student Notation.';\n        state.isLoading = false;\n        clearHandoffParams();\n        return false;\n      }\n    },\n\n    /**\n     * Get the imported voices.\n     */\n    get voices(): SnapshotVoice[] {\n      return state.snapshot?.voices ?? [];\n    },\n\n    /**\n     * Get the time grid structure.\n     */\n    get timeGrid(): TimeGridStructure | null {\n      return state.snapshot?.timeGrid ?? null;\n    },\n\n    /**\n     * Get the tempo (with transposition applied to accompaniment).\n     */\n    get tempo(): number {\n      return state.snapshot?.tempo ?? 90;\n    },\n\n    /**\n     * Get the suggested pitch range based on imported notes.\n     */\n    get suggestedPitchRange(): { minMidi: number; maxMidi: number } | null {\n      if (!state.snapshot) {\n        return null;\n      }\n\n      const margin = 3; // Add a few semitones margin\n      const minMidi = state.snapshot.minMidiPitch;\n      const maxMidi = state.snapshot.maxMidiPitch;\n\n      if (minMidi === undefined || maxMidi === undefined) {\n        return null;\n      }\n\n      return {\n        minMidi: Math.max(21, minMidi - margin + state.transpositionSemitones),\n        maxMidi: Math.min(108, maxMidi + margin + state.transpositionSemitones),\n      };\n    },\n\n    /**\n     * Set transposition in semitones.\n     */\n    setTransposition(semitones: number) {\n      state.transpositionSemitones = semitones;\n    },\n\n    /**\n     * Transpose up by one semitone.\n     */\n    transposeUp() {\n      state.transpositionSemitones += 1;\n    },\n\n    /**\n     * Transpose down by one semitone.\n     */\n    transposeDown() {\n      state.transpositionSemitones -= 1;\n    },\n\n    /**\n     * Get a transposed MIDI pitch.\n     */\n    getTransposedMidi(originalMidi: number): number {\n      return originalMidi + state.transpositionSemitones;\n    },\n\n    /**\n     * Export current state back to Student Notation.\n     * Creates a new snapshot and navigates back.\n     */\n    async bringBackToStudentNotation(): Promise<void> {\n      if (!state.snapshot) {\n        console.warn('[HandoffState] No snapshot to bring back');\n        return;\n      }\n\n      // Create a modified snapshot for return\n      const returnSnapshot: SingingTrainerSnapshot = {\n        ...state.snapshot,\n        sourceApp: 'singing-trainer',\n        createdAt: Date.now(),\n        // Apply transposition to all voices\n        voices: state.snapshot.voices.map(voice => ({\n          ...voice,\n          notes: voice.notes.map(note => ({\n            ...note,\n            midiPitch: note.midiPitch + state.transpositionSemitones,\n          })),\n        })),\n      };\n\n      try {\n        const handoffId = await writeHandoffSlot(returnSnapshot);\n        console.log('[HandoffState] Handoff slot written for return', handoffId);\n        navigateToStudentNotation(handoffId);\n      } catch (error) {\n        console.error('[HandoffState] Failed to write return handoff', error);\n      }\n    },\n\n    /**\n     * Clear the imported snapshot.\n     */\n    clearSnapshot() {\n      state = { ...DEFAULT_STATE };\n    },\n\n    /**\n     * Reset the handoff state.\n     */\n    reset() {\n      state = { ...DEFAULT_STATE };\n    },\n  };\n}\n\nexport const handoffState = createHandoffState();\n","<script lang=\"ts\">\n  /**\n   * App Component\n   *\n   * Main application layout for the Singing Trainer.\n   */\n  import { onMount, onDestroy } from 'svelte';\n  import {\n    SingingCanvas,\n    TonicSelector,\n    DroneControls,\n    PitchHighlightToggle,\n    PitchReadout,\n    RangeControl,\n    DemoExerciseControls,\n    UltrastarControls,\n  } from './lib/components/index.js';\n  import { ResultsModal } from './lib/components/feedback/index.js';\n  import { handoffState } from './lib/stores/handoffState.svelte.js';\n  import { appState } from './lib/stores/appState.svelte.js';\n  import { highwayState } from './lib/stores/highwayState.svelte.js';\n  import { ultrastarState } from './lib/stores/ultrastarState.svelte.js';\n  import { resultsState } from './lib/stores/resultsState.svelte.js';\n  import { demoExerciseState } from './lib/stores/demoExerciseState.svelte.js';\n  import { startDetection, stopDetection } from './lib/services/pitchDetection.js';\n\n  // Settings panel state\n  let showSettings = $state(false);\n\n  // Reactive state for Ultrastar\n  const isUltrastarActive = $derived(ultrastarState.state.isActive);\n\n  // Register performance complete callbacks\n  $effect(() => {\n    // Register highway completion callback\n    const unsubscribe = highwayState.onPerformanceComplete((results) => {\n      // Check if this is an Ultrastar song\n      if (ultrastarState.state.isActive && ultrastarState.state.isPlaying) {\n        const summary = resultsState.calculateSummary(\n          results,\n          ultrastarState.state.targetNotes\n        );\n        resultsState.show(summary, {\n          title: ultrastarState.title,\n          artist: ultrastarState.artist,\n          source: 'ultrastar',\n        });\n        ultrastarState.setPlaying(false);\n      }\n      // Demo exercise handles its own results display\n    });\n\n    return unsubscribe;\n  });\n\n  // Handle results modal retry\n  function handleResultsRetry() {\n    if (resultsState.state.source === 'ultrastar') {\n      // Restart Ultrastar song\n      highwayState.reset();\n      highwayState.setTargetNotes(ultrastarState.state.targetNotes);\n      appState.setVisualizationMode('highway');\n    } else if (resultsState.state.source === 'demo') {\n      // Restart demo exercise - handled by DemoExerciseControls\n    }\n  }\n\n  // Check for handoff and auto-start pitch detection on mount\n  onMount(async () => {\n    const wasHandoff = await handoffState.checkAndConsumeHandoff();\n\n    if (wasHandoff) {\n      console.log('[App] Handoff detected and processed');\n\n      // Update the pitch range based on imported data\n      const suggestedRange = handoffState.suggestedPitchRange;\n      if (suggestedRange) {\n        appState.setYAxisRange(suggestedRange);\n      }\n    }\n\n    // Auto-start pitch detection\n    try {\n      await startDetection();\n      appState.setDetecting(true);\n      console.log('[App] Pitch detection auto-started');\n    } catch (err) {\n      console.error('[App] Failed to auto-start pitch detection:', err);\n    }\n  });\n\n  // Clean up on unmount\n  onDestroy(() => {\n    stopDetection();\n  });\n\n  // Reactive state\n  const hasImportedSnapshot = $derived(handoffState.state.hasImportedSnapshot);\n  const transposition = $derived(handoffState.state.transpositionSemitones);\n  const handoffError = $derived(handoffState.state.error);\n\n  function handleBringBack() {\n    handoffState.bringBackToStudentNotation();\n  }\n\n  function handleTransposeUp() {\n    handoffState.transposeUp();\n  }\n\n  function handleTransposeDown() {\n    handoffState.transposeDown();\n  }\n</script>\n\n<div class=\"app\">\n  <header class=\"header\">\n    <h1 class=\"title\">Singing Trainer</h1>\n    <div class=\"header-controls\">\n      {#if hasImportedSnapshot}\n        <div class=\"handoff-controls\">\n          <div class=\"transposition-control\">\n            <button class=\"transpose-btn\" onclick={handleTransposeDown} title=\"Transpose down\">-</button>\n            <span class=\"transposition-label\">\n              {transposition >= 0 ? '+' : ''}{transposition}\n            </span>\n            <button class=\"transpose-btn\" onclick={handleTransposeUp} title=\"Transpose up\">+</button>\n          </div>\n          <button class=\"bring-back-btn\" onclick={handleBringBack}>\n            Bring Back to Student Notation\n          </button>\n        </div>\n      {/if}\n    </div>\n  </header>\n\n  {#if handoffError}\n    <div class=\"error-banner\">\n      {handoffError}\n    </div>\n  {/if}\n\n  <main class=\"main\">\n    <aside class=\"sidebar sidebar--left\">\n      <div class=\"control-group\">\n        <PitchReadout />\n      </div>\n\n      <div class=\"control-group\">\n        <DemoExerciseControls />\n      </div>\n\n      <div class=\"control-group\">\n        <UltrastarControls />\n      </div>\n\n      <div class=\"control-group\">\n        <details class=\"settings-details\" bind:open={showSettings}>\n          <summary class=\"settings-summary\">Settings</summary>\n          <div class=\"settings-content\">\n            <TonicSelector />\n            <DroneControls />\n            <PitchHighlightToggle />\n          </div>\n        </details>\n      </div>\n\n      <div class=\"control-group\">\n        <RangeControl />\n      </div>\n\n      {#if hasImportedSnapshot}\n        <div class=\"control-group\">\n          <h3 class=\"control-group-title\">Imported Material</h3>\n          <div class=\"import-info\">\n            <span class=\"import-label\">Voices:</span>\n            <span class=\"import-value\">{handoffState.voices.length}</span>\n          </div>\n          <div class=\"import-info\">\n            <span class=\"import-label\">Tempo:</span>\n            <span class=\"import-value\">{handoffState.tempo} BPM</span>\n          </div>\n          {#if handoffState.timeGrid}\n            <div class=\"import-info\">\n              <span class=\"import-label\">Microbeats:</span>\n              <span class=\"import-value\">{handoffState.timeGrid.microbeatCount}</span>\n            </div>\n          {/if}\n        </div>\n      {/if}\n    </aside>\n\n    <section class=\"canvas-area\">\n      <SingingCanvas />\n    </section>\n  </main>\n\n  <!-- Results Modal -->\n  <ResultsModal onRetry={handleResultsRetry} />\n</div>\n\n<style>\n  .app {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n  }\n\n  .header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: var(--spacing-md) var(--spacing-lg);\n    background-color: var(--color-bg-light);\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n  }\n\n  .title {\n    font-size: var(--font-size-xl);\n    font-weight: 700;\n    color: var(--color-text);\n    margin: 0;\n  }\n\n  .header-controls {\n    display: flex;\n    gap: var(--spacing-md);\n  }\n\n  .main {\n    display: flex;\n    flex: 1;\n    overflow: hidden;\n  }\n\n  .sidebar {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-lg);\n    padding: var(--spacing-lg);\n    background-color: var(--color-bg-light);\n    border-right: 1px solid rgba(255, 255, 255, 0.1);\n    min-width: 260px;\n    max-width: 300px;\n    overflow-y: auto; /* Allow vertical scrolling */\n  }\n\n  .control-group {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .control-group-title {\n    font-size: var(--font-size-sm);\n    font-weight: 600;\n    color: var(--color-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n    margin: 0;\n  }\n\n  .canvas-area {\n    flex: 1;\n    display: flex;\n    padding: var(--spacing-lg);\n    overflow: hidden;\n  }\n\n  /* Handoff controls */\n  .handoff-controls {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n  }\n\n  .transposition-control {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-xs);\n    background-color: var(--color-bg);\n    border-radius: var(--radius-md);\n    padding: var(--spacing-xs) var(--spacing-sm);\n  }\n\n  .transpose-btn {\n    width: 28px;\n    height: 28px;\n    border: none;\n    border-radius: var(--radius-sm);\n    background-color: var(--color-bg-light);\n    color: var(--color-text);\n    font-size: var(--font-size-lg);\n    font-weight: 600;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: background-color 0.15s ease;\n  }\n\n  .transpose-btn:hover {\n    background-color: var(--color-primary);\n    color: white;\n  }\n\n  .transposition-label {\n    font-size: var(--font-size-sm);\n    font-weight: 600;\n    color: var(--color-text);\n    min-width: 32px;\n    text-align: center;\n  }\n\n  .bring-back-btn {\n    padding: var(--spacing-sm) var(--spacing-md);\n    border: none;\n    border-radius: var(--radius-md);\n    background-color: var(--color-primary);\n    color: white;\n    font-size: var(--font-size-sm);\n    font-weight: 600;\n    cursor: pointer;\n    transition: background-color 0.15s ease;\n  }\n\n  .bring-back-btn:hover {\n    background-color: var(--color-primary-dark, #4a7bc8);\n  }\n\n  /* Error banner */\n  .error-banner {\n    background-color: var(--color-error, #dc3545);\n    color: white;\n    padding: var(--spacing-sm) var(--spacing-lg);\n    text-align: center;\n    font-size: var(--font-size-sm);\n  }\n\n  /* Import info */\n  .import-info {\n    display: flex;\n    justify-content: space-between;\n    font-size: var(--font-size-sm);\n    padding: var(--spacing-xs) 0;\n  }\n\n  .import-label {\n    color: var(--color-text-muted);\n  }\n\n  .import-value {\n    color: var(--color-text);\n    font-weight: 600;\n  }\n\n  /* Settings dropdown */\n  .settings-details {\n    background-color: var(--color-surface, rgba(255, 255, 255, 0.05));\n    border-radius: var(--radius-sm);\n    padding: var(--spacing-xs);\n  }\n\n  .settings-summary {\n    cursor: pointer;\n    font-size: var(--font-size-sm);\n    font-weight: 600;\n    color: var(--color-text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n    padding: var(--spacing-xs);\n    user-select: none;\n    list-style: none;\n  }\n\n  .settings-summary::-webkit-details-marker {\n    display: none;\n  }\n\n  .settings-summary::before {\n    content: '';\n    display: inline-block;\n    margin-right: var(--spacing-xs);\n    font-size: 0.7em;\n    transition: transform 0.2s ease;\n  }\n\n  .settings-details[open] .settings-summary::before {\n    transform: rotate(90deg);\n  }\n\n  .settings-summary:hover {\n    color: var(--color-primary);\n  }\n\n  .settings-content {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n    padding: var(--spacing-sm);\n    padding-top: var(--spacing-md);\n  }\n\n  @media (max-width: 900px) {\n    .header {\n      flex-wrap: wrap;\n      gap: var(--spacing-sm);\n      padding: var(--spacing-sm) var(--spacing-md);\n    }\n\n    .title {\n      font-size: var(--font-size-lg);\n    }\n\n    .header-controls {\n      width: 100%;\n      flex-wrap: wrap;\n      justify-content: flex-start;\n    }\n\n    .handoff-controls {\n      flex-wrap: wrap;\n    }\n\n    .main {\n      flex-direction: column;\n    }\n\n    .canvas-area {\n      order: 1;\n      padding: var(--spacing-md);\n      min-height: 300px;\n    }\n\n    .sidebar {\n      order: 2;\n      width: 100%;\n      max-width: none;\n      min-width: 0;\n      border-right: none;\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n      padding: var(--spacing-md);\n      max-height: 40vh;\n    }\n  }\n\n  @media (max-width: 600px) {\n    .canvas-area {\n      padding: var(--spacing-sm);\n    }\n\n    .sidebar {\n      max-height: 50vh;\n    }\n  }\n</style>\n","import { mount, unmount } from 'svelte';\nimport App from './App.svelte';\n\nexport type SingingTrainerInstance = {\n  destroy: () => void;\n};\n\nexport function mountSingingTrainer(container: HTMLElement): SingingTrainerInstance {\n  const instance = mount(App, { target: container });\n\n  return {\n    destroy: () => {\n      unmount(instance);\n    },\n  };\n}\n\n// Re-export for convenience\nexport { default as App } from './App.svelte';\n\n// Export types\nexport type * from './lib/types/ultrastar';\nexport type { AppState, VisualizationMode, TonicNote } from './lib/stores/appState.svelte';\nexport type { PitchState, DetectedPitch, PitchHistoryPoint, StablePitch } from './lib/stores/pitchState.svelte';\nexport type { HighwayState, TargetNote } from './lib/stores/highwayState.svelte';\nexport type { UltrastarState } from './lib/stores/ultrastarState.svelte';\nexport type { YouTubeState } from './lib/stores/youtubeState.svelte';\nexport type { ResultsState, ResultsSummary, PhraseResult } from './lib/stores/resultsState.svelte';\n","import '@mlt/singing-trainer-ui/styles.css';\nimport { mountSingingTrainer } from '@mlt/singing-trainer-ui';\n\nconst app = mountSingingTrainer(document.getElementById('app')!);\n\nexport default app;\n"],"names":["DEV","is_array","index_of","array_from","define_property","get_descriptor","get_descriptors","object_prototype","array_prototype","get_prototype_of","is_extensible","run_all","arr","i","deferred","resolve","reject","promise","res","rej","DERIVED","EFFECT","RENDER_EFFECT","MANAGED_EFFECT","BLOCK_EFFECT","BRANCH_EFFECT","ROOT_EFFECT","BOUNDARY_EFFECT","CONNECTED","CLEAN","DIRTY","MAYBE_DIRTY","INERT","DESTROYED","EFFECT_RAN","EFFECT_TRANSPARENT","EAGER_EFFECT","HEAD_EFFECT","EFFECT_PRESERVED","USER_EFFECT","EFFECT_OFFSCREEN","WAS_MARKED","REACTION_IS_UPDATING","ASYNC","ERROR_VALUE","STATE_SYMBOL","LEGACY_PROPS","LOADING_ATTR_SYMBOL","STALE_REACTION","__publicField","lifecycle_outside_component","name","async_derived_orphan","effect_in_teardown","rune","effect_in_unowned_derived","effect_orphan","effect_update_depth_exceeded","props_invalid_value","key","state_descriptors_fixed","state_prototype_fixed","state_unsafe_mutation","svelte_boundary_reset_onerror","EACH_ITEM_REACTIVE","EACH_INDEX_REACTIVE","EACH_IS_CONTROLLED","EACH_IS_ANIMATED","EACH_ITEM_IMMUTABLE","PROPS_IS_IMMUTABLE","PROPS_IS_UPDATED","PROPS_IS_BINDABLE","PROPS_IS_LAZY_INITIAL","TEMPLATE_FRAGMENT","TEMPLATE_USE_IMPORT_NODE","UNINITIALIZED","NAMESPACE_HTML","select_multiple_invalid_value","svelte_boundary_reset_noop","equals","value","safe_not_equal","a","b","safe_equals","tracing_mode_flag","component_context","set_component_context","context","push","props","runes","fn","pop","component","effects","create_user_effect","is_runes","micro_tasks","run_micro_tasks","tasks","queue_micro_task","is_flushing_sync","flush_tasks","handle_error","error","effect","active_effect","active_reaction","invoke_error_boundary","e","batches","current_batch","previous_batch","batch_values","queued_root_effects","last_scheduled_effect","is_flushing","_Batch","__privateAdd","_Batch_instances","_commit_callbacks","_discard_callbacks","_pending","_blocking_pending","_deferred","_dirty_effects","_maybe_dirty_effects","__privateGet","root_effects","target","root","__privateMethod","traverse_effect_tree_fn","resolve_fn","defer_effects_fn","flush_queued_effects","_a","source","flush_effects","blocking","__privateSet","set_signal_status","schedule_effect","batch","task","flags","is_branch","is_skippable_branch","skip","is_dirty","update_effect","child","parent","clear_marked_fn","deps","dep","commit_fn","previous_batch_values","is_earlier","dummy_target","sources","others","s","prev_queued_root_effects","marked","checked","mark_effects","Batch","flushSync","was_flushing_sync","result","was_updating_effect","is_updating_effect","source_stacks","flush_count","set_is_updating_effect","updates","entry","infinite_loop_guard","old_values","e.effect_update_depth_exceeded","eager_block_effects","length","unlink_effect","ordered_effects","ancestor","j","reaction","depends_on","depends","signal","createSubscriber","start","subscribers","version","stop","effect_tracking","get","render_effect","untrack","increment","boundary","node","children","Boundary","_Boundary_instances","_anchor","_hydrate_open","_props","_children","_effect","_main_effect","_pending_effect","_failed_effect","_offscreen_fragment","_pending_anchor","_local_pending_count","_pending_count","_is_creating_fallback","_effect_pending","_effect_pending_subscriber","block","anchor","get_anchor_fn","branch","show_pending_snippet_fn","d","update_pending_count_fn","internal_set","onerror","failed","destroy_effect","did_reset","calling_on_error","reset","w.svelte_boundary_reset_noop","e.svelte_boundary_reset_onerror","pause_effect","run_fn","previous_reaction","set_active_reaction","hydrate_resolved_content_fn","hydrate_pending_content_fn","pending","create_text","previous_effect","previous_ctx","set_active_effect","move_effect","flatten","blockers","sync","async","derived","restore","capture","run","expression","async_derived","unset_context","previous_component_context","activate_batch","parent_derived","location","e.async_derived_orphan","should_suspend","deferreds","async_effect","handler","teardown","fulfil","next","p","go","user_derived","push_reaction_value","derived_safe_equal","destroy_derived_effects","get_derived_parent_effect","execute_derived","prev_active_effect","update_reaction","update_derived","increment_write_version","is_destroying_effect","status","eager_effects","eager_effects_deferred","v","stack","state","mutable_source","initial_value","immutable","trackable","set","should_proxy","untracking","current_sources","e.state_unsafe_mutation","new_value","proxy","old_value","mark_reactions","untracked_writes","set_untracked_writes","flush_eager_effects","prev_is_updating_effect","inspects","reactions","not_dirty","prototype","is_proxied_array","parent_version","update_version","with_parent","set_update_version","_","prop","descriptor","e.state_descriptors_fixed","receiver","exists","has","other_s","ls","n","own_keys","e.state_prototype_fixed","get_proxied_value","is","$window","is_firefox","first_child_getter","next_sibling_getter","init_operations","element_prototype","node_prototype","text_prototype","get_first_child","get_next_sibling","is_text","first_child","first","sibling","count","next_sibling","clear_text_content","should_defer_append","listening_to_form_reset","add_form_reset_listener","evt","without_reactive_context","listen_to_event_and_reset_event","element","event","on_reset","prev","validate_effect","e.effect_orphan","e.effect_in_unowned_derived","e.effect_in_teardown","push_effect","parent_effect","parent_last","create_effect","type","user_effect","defer","component_root","options","template_effect","values","execute_effect_teardown","previously_destroying_effect","set_is_destroying_effect","destroy_effect_children","remove_dom","controller","destroy_block_effect_children","removed","remove_effect_dom","remove_reactions","transitions","transition","end","callback","destroy","pause_children","remaining","check","local","t","transparent","resume_effect","resume_children","fragment","new_deps","skipped_deps","write_version","read_version","dependencies","dependency","schedule_possible_effect_self_invalidation","previous_deps","previous_skipped_deps","previous_untracked_writes","previous_sources","previous_untracking","previous_update_version","remove_reaction","index","new_length","start_index","tick","is_derived","destroyed","depends_on_old_values","reconnect","STATUS_MASK","PASSIVE_EVENTS","is_passive_event","all_registered_events","root_event_handles","create_event","event_name","dom","target_handler","handle_event_propagation","passive","delegate","events","last_propagated_event","handler_element","owner_document","path","current_target","path_idx","handled_at","at_idx","handler_idx","throw_error","other_errors","parent_element","delegated","create_fragment_from_html","html","elem","assign_nodes","from_html","content","is_fragment","use_import_node","has_start","clone","text","comment","frag","append","set_text","str","mount","_mount","document_listeners","Component","intro","registered_events","event_handle","unmount","anchor_node","ctx","mounted_components","BranchManager","_batches","_onscreen","_offscreen","_outroing","_transition","_commit","onscreen","offscreen","k","on_destroy","_discard","keys","if_block","elseif","branches","update_branch","condition","has_branch","flag","pause_effects","to_destroy","controlled_anchor","group","groups","destroy_effects","fast_path","parent_node","offscreen_anchor","each","get_collection","get_key","render_fn","fallback_fn","items","is_controlled","fallback","each_array","collection","array","first_run","commit","reconcile","move","item","create_item","is_animated","current","seen","to_animate","matched","stashed","_b","link","_d","_c","_e","destroy_length","_g","_f","_i","_h","dest","next_node","whitespace","to_class","hash","directives","classname","len","append_styles","styles","important","separator","css","to_style","new_style","normal_styles","important_styles","set_class","is_html","prev_classes","next_classes","next_class_name","is_present","update_styles","priority","set_style","prev_styles","next_styles","next_style_attr","select_option","select","mounting","w.select_multiple_invalid_value","option","get_option_value","option_value","init_select","observer","IS_CUSTOM_ELEMENT","IS_HTML","set_value","attributes","get_attributes","set_attribute","attribute","skip_warning","get_setters","setters_cache","cache_key","setters","descriptors","proto","element_proto","bind_value","input","is_reset","is_numberlike_input","to_number","is_bound_this","bound_value","element_or_component","bind_this","update","get_value","get_parts","old_parts","parts","bind_property","property","is_store_binding","capture_store_binding","previous_is_store_binding","bindable","lazy","fallback_value","fallback_dirty","get_fallback","setter","is_entry_props","is_store_sub","e.props_invalid_value","getter","legacy_parent","mutation","overridden","onMount","e.lifecycle_outside_component","cleanup","onDestroy","PUBLIC_VERSION","createColumnCoordinates","config","cellHeight","columnWidths","viewport","halfUnit","columnPositions","buildColumnPositions","rowIndex","canvasY","relativeRowIndex","columnIndex","canvasX","left","right","mid","createTimeCoordinates","pixelsPerSecond","nowLineX","currentTimeMs","_columnIndex","_canvasX","timeMs","timeDelta","cellWidth","positions","x","width","getVisibleRowRangeWithPadding","fullRowData","startRow","endRow","maxRowIndex","isRowVisible","globalRow","coords","y","padding","getPitchClass","pitchWithOctave","pc","getLineStyleFromPitchClass","pitchClass","DEFAULT_ANACRUSIS_COLORS","cachedAnacrusisColors","getAnacrusisColors","drawHorizontalLines","startX","endX","viewportHeight","viewportWidth","finalEndX","pitchClassesToSkip","row","style","drawVerticalLines","macrobeatBoundaries","macrobeatBoundaryStyles","placedTonicSigns","totalColumns","canvasCol","isGridStartOrEnd","isTonicColumnStart","isTonicColumn","isTonicColumnEnd","ts","isMacrobeatEnd","shouldDrawVerticalLineAtColumn","mbIndex","boundaryStyle","stroke","drawTimeBasedVerticalLines","beatIntervalMs","measureIntervalMs","visibleTimeRange","beatTimeOffsetMs","adjustedStart","adjustedEnd","firstBeatIndex","lastBeatIndex","beatIndex","isMeasure","toneNoteToIndex","midiToIndex","getPitchByMidi","midi","generateRowDataForMidiRange","minMidi","maxMidi","rows","pitch","PITCH_CLASS_COLORS","FALLBACK_COLOR","hexToRgb","hex","bigint","interpolateRgb","c1","c2","factor","clampedFactor","c2Value","getInterpolatedPitchColor","midiValue","tonicPitchClass","midiFloor","fraction","nextPitchClass","baseColor","nextColor","NOTE_TO_PITCH_CLASS","getTonicPitchClass","noteName","cleanName","OVAL_NOTE_FONT_RATIO","FILLED_NOTE_FONT_RATIO","MIN_FONT_SIZE","MIN_STROKE_WIDTH_THICK","STROKE_WIDTH_RATIO","TAIL_LINE_WIDTH_RATIO","MIN_TAIL_LINE_WIDTH","SHADOW_BLUR_RADIUS","hasRenderableDimensions","height","hasVisibleTail","note","baselineEnd","getUuidTimestamp","timestampSegment","calculateColorOffset","allNotes","offsetAmount","noteUuid","notesAtSamePosition","otherNote","allNotesAtPosition","calculateTailYOffset","tailOffsetAmount","notesWithTailsAtSamePosition","allNotesWithTailsAtPosition","getDegreeFontMultiplier","label","hasFlat","hasSharp","hasBothAccidentals","drawScaleDegreeText","noteLabel","shape","centerX","centerY","noteWidth","contentMultiplier","category","baseFontSize","circleBaseSize","ovalBaseSize","lineHeight","totalHeight","startY","part","opticalOffset","drawStadiumShape","leftCenterX","rightCenterX","ry","strokeWidth","drawSingleColumnOvalNote","getScaleDegreeLabel","degreeDisplayMode","currentCellWidth","xOffset","dynamicStrokeWidth","cx","rx","drawTwoColumnOvalNote","longNoteStyle","xStart","actualCellWidth","hasTail","stadiumCenterX","originalEndX","tailYOffset","tailY","drawTonicShape","tonicSign","radius","numberText","fontSize","DEFAULT_TRAIL_CONFIG","getTrailConfig","drawUserPitchIndicator","clarity","trail","colorMode","getMidiY","color","baseY","rowStep","drawUserPitchTrace","history","currentTime","timeWindowMs","trailOriginX","notePoints","point","age","connections","dx","dy","pt","opacity","drawTargetNotes","targetNotes","userMidi","userClarity","pitchToleranceSemitones","isAtJudgmentLine","pitchMatches","isBeingHit","drawHitParticles","labelX","burstRadius","angle","px","py","stripOctaveSuffix","withoutOctave","snapToDevicePixel","pixelRatio","getLegendFontSize","labelLength","sizeMultiplier","resolutionBoost","getCanvasPixelRatio","canvas","getPitchClassFromRow","noteMap","baseNote","processLabel","showFrequencyLabels","showOctaveLabels","accidentalMode","finalizeLabel","flatName","sharpName","isAccidental","sharp","flat","drawLegend","columnsOrder","legendColumnWidth","snap","colWidth","cumulativeX","colLabel","isAccidentalHidden","shouldHideAccidental","bgColor","textAlpha","highlight","shouldHighlight","textX","textY","drawLegendsToSeparateCanvases","leftCtx","rightCtx","DEFAULT_PREFERRED_CELL_HEIGHT","DEFAULT_MIN_CELL_HEIGHT","calculateViewportWindow","containerHeight","preferredCellHeight","minCellHeight","centerOnMidi","totalRows","normalizedMinCellHeight","normalizedPreferredCellHeight","maxVisibleRowsForCellHeight","maxVisibleRowsAtPreferred","maxVisibleRowsAtMinimum","visibleRows","centerRowIndex","halfVisible","showRightLegend","placedNotes","$.prop","$$props","macrobeatGroupings","mainCanvas","$.state","legendLeftCanvas","legendRightCanvas","animationFrameId","LEGEND_COLUMN_WIDTH_UNITS","legendCanvasWidth","$.derived","$.get","showLegends","legendTotalWidth","gridWidth","isNotationMode","isSingingMode","isHighwayMode","getCoordinates","render","paddedStartRow","paddedEndRow","horizontalConfig","renderNotationMode","renderSingingMode","renderHighwayMode","renderLegends","renderCtx","calculateMacrobeatBoundaries","verticalConfig","visibleNotes","visibleTonicSigns","sign","noteContext","userPitchConfig","renderScrollingGrid","drawJudgmentLine","drawOnrampCountdown","gridData","scrollOffset","lineWidth","dash","noteConfig","noteStartX","scrolledCoords","colIndex","beatsRemaining","legendConfig","legendOptions","groupings","boundaries","column","grouping","startAnimationLoop","loop","stopAnimationLoop","$.set","setupCanvas","dpr","$.user_effect","div","root_1","$$value","$$render","consequent","canvas_1","$.sibling","canvas_2","root_2","consequent_1","DEFAULT_STATE","createAppState","$.proxy","isDetecting","mode","tonic","useDegrees","show","enabled","range","octave","volume","appState","MAX_HISTORY_LENGTH","createPitchState","stable","pitchState","createExtendedExponentialRampToValueAutomationEvent","endTime","insertTime","createExtendedLinearRampToValueAutomationEvent","createSetValueAutomationEvent","startTime","createSetValueCurveAutomationEvent","duration","getTargetValueAtTime","time","valueAtStartTime","timeConstant","isExponentialRampToValueAutomationEvent","automationEvent","isLinearRampToValueAutomationEvent","isAnyRampToValueAutomationEvent","isSetValueAutomationEvent","isSetValueCurveAutomationEvent","getValueOfAutomationEventAtIndexAtTime","automationEvents","defaultValue","getEndTimeAndValueOfPreviousAutomationEvent","currentAutomationEvent","nextAutomationEvent","isCancelAndHoldAutomationEvent","isCancelScheduledValuesAutomationEvent","getEventTime","getExponentialRampValueAtTime","getLinearRampValueAtTime","interpolateValue","theoreticIndex","lowerIndex","upperIndex","getValueCurveValueAtTime","isSetTargetAutomationEvent","AutomationEventList","eventTime","removedAutomationEvent","lastAutomationEvent","startValue","truncatedAutomationEvent","ratio","previousAutomationEvent","persistentAutomationEvent","remainingAutomationEvents","firstRemainingAutomationEvent","indexOfNextEvent","indexOfCurrentEvent","createCancelAndHoldAutomationEvent","cancelTime","createCancelScheduledValuesAutomationEvent","createExponentialRampToValueAutomationEvent","createLinearRampToValueAutomationEvent","createSetTargetAutomationEvent","createAbortError","createAddActiveInputConnectionToAudioNode","insertElementInSet","activeInputs","output","eventListener","ignoreDuplicates","activeInputConnection","createAddAudioNodeConnections","audioNodeConnectionsStore","audioNode","audioNodeRenderer","nativeAudioNode","createAddAudioParamConnections","audioParamConnectionsStore","audioParam","audioParamRenderer","ACTIVE_AUDIO_NODE_STORE","AUDIO_NODE_CONNECTIONS_STORE","AUDIO_NODE_STORE","AUDIO_PARAM_CONNECTIONS_STORE","AUDIO_PARAM_STORE","CONTEXT_STORE","EVENT_LISTENERS","CYCLE_COUNTERS","NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS","NODE_TO_PROCESSOR_MAPS","isConstructible","constructible","IMPORT_STATEMENT_REGEX","splitImportStatements","url","importStatements","sourceWithoutImportStatements","unresolvedUrl","importStatementWithResolvedUrl","verifyParameterDescriptors","parameterDescriptors","verifyProcessorCtor","processorCtor","createAddAudioWorkletModule","cacheTestResult","createNotSupportedError","evaluateSource","exposeCurrentFrameAndCurrentTime","fetchSource","getNativeContext","getOrCreateBackupOfflineAudioContext","isNativeOfflineAudioContext","nativeAudioWorkletNodeConstructor","ongoingRequests","resolvedRequests","testAudioWorkletProcessorPostMessageSupport","window","moduleURL","resolvedRequestsOfContext","ongoingRequestsOfContext","promiseOfOngoingRequest","nativeContext","absoluteUrl","wrappedSource","evaluateAudioWorkletGlobalScope","nodeNameToProcessorConstructorMap","isSupportingPostMessage","currentIndex","blob","backupOfflineAudioContext","nativeContextOrBackupOfflineAudioContext","updatedResolvedRequestsOfContext","updatedOngoingRequestsOfContext","getValueForKey","map","pickElementFromSet","predicate","matchingElements","matchingElement","deletePassiveInputConnectionToAudioNode","passiveInputs","passiveInputConnections","matchingConnection","passiveInputConnection","getEventListenersOfAudioNode","setInternalStateToActive","isAudioWorkletNode","setInternalStateToPassive","setInternalStateToPassiveWhenNecessary","createAddConnectionToAudioNode","addActiveInputConnectionToAudioNode","addPassiveInputConnectionToAudioNode","connectNativeAudioNodeToNativeAudioNode","deleteActiveInputConnectionToAudioNode","disconnectNativeAudioNodeFromNativeAudioNode","getAudioNodeConnections","getAudioNodeTailTime","getNativeAudioNode","isActiveAudioNode","isPartOfACycle","isPassiveAudioNode","tailTimeTimeoutIds","destination","isOffline","outputs","eventListeners","isActive","nativeDestinationAudioNode","nativeSourceAudioNode","partialConnection","tailTime","tailTimeTimeoutId","outputConnection","createAddPassiveInputConnectionToAudioNode","createAddSilentConnection","createNativeGainNode","nativeAudioScheduledSourceNode","nativeGainNode","disconnect","createAddUnrenderedAudioWorkletNode","getUnrenderedAudioWorkletNodes","audioWorkletNode","DEFAULT_OPTIONS","createAnalyserNodeConstructor","audionNodeConstructor","createAnalyserNodeRenderer","createIndexSizeError","createNativeAnalyserNode","mergedOptions","nativeAnalyserNode","analyserNodeRenderer","maxDecibels","minDecibels","isOwnedByContext","createAnalyserNodeRendererFactory","renderInputsOfAudioNode","renderedNativeAnalyserNodes","createAnalyserNode","nativeOfflineAudioContext","renderedNativeAnalyserNode","testAudioBufferCopyChannelMethodsOutOfBoundsSupport","nativeAudioBuffer","wrapAudioBufferGetChannelDataMethod","audioBuffer","getChannelData","channel","err","createAudioBufferConstructor","audioBufferStore","nativeAudioBufferConstructor","nativeOfflineAudioContextConstructor","testNativeAudioBufferConstructorSupport","wrapAudioBufferCopyChannelMethods","wrapAudioBufferCopyChannelMethodsOutOfBounds","AudioBuffer","numberOfChannels","sampleRate","instance","MOST_NEGATIVE_SINGLE_FLOAT","MOST_POSITIVE_SINGLE_FLOAT","createAudioBufferSourceNodeConstructor","audioNodeConstructor","createAudioBufferSourceNodeRenderer","createAudioParam","createInvalidStateError","createNativeAudioBufferSourceNode","wrapEventListener","nativeAudioBufferSourceNode","audioBufferSourceNodeRenderer","wrappedListener","nativeOnEnded","when","offset","resetInternalStateToPassive","createAudioBufferSourceNodeRendererFactory","connectAudioParam","renderAutomation","renderedNativeAudioBufferSourceNodes","createAudioBufferSourceNode","nativeAudioBufferSourceNodeIsOwnedByContext","renderedNativeAudioBufferSourceNode","isAudioBufferSourceNode","isBiquadFilterNode","isConstantSourceNode","isGainNode","isOscillatorNode","isStereoPannerNode","getAudioParamConnections","deactivateActiveAudioNodeInputConnections","trace","audioParams","audioParamConnections","deactivateAudioGraph","isValidLatencyHint","latencyHint","createAudioContextConstructor","baseAudioContextConstructor","createUnknownError","mediaElementAudioSourceNodeConstructor","mediaStreamAudioDestinationNodeConstructor","mediaStreamAudioSourceNodeConstructor","mediaStreamTrackAudioSourceNodeConstructor","nativeAudioContextConstructor","nativeAudioContext","revokeState","mediaElement","mediaStream","mediaStreamTrack","resolvePromise","createAudioDestinationNodeConstructor","createAudioDestinationNodeRenderer","createNativeAudioDestinationNode","channelCount","nativeAudioDestinationNode","audioDestinationNodeRenderer","renderedNativeAudioDestinationNodes","createAudioDestinationNode","renderedNativeAudioDestinationNode","createAudioListenerFactory","createNativeChannelMergerNode","createNativeConstantSourceNode","createNativeScriptProcessorNode","getFirstSample","overwriteAccessors","nativeListener","createFakeAudioParams","buffer","channelMergerNode","isScriptProcessorNodeCreated","lastOrientation","lastPosition","createScriptProcessorNode","scriptProcessorNode","inputBuffer","orientation","positon","createSetOrientation","createSetPosition","createFakeAudioParam","initialValue","setValue","constantSourceNode","cancelAndHoldAtTime","args","cancelScheduledValues","exponentialRampToValueAtTime","linearRampToValueAtTime","setTargetAtTime","setValueAtTime","setValueCurveAtTime","forwardX","forwardY","forwardZ","positionX","positionY","positionZ","upX","upY","upZ","isAudioNode","audioNodeOrAudioParam","isAudioNodeOutputConnection","lmnt","addActiveInputConnectionToAudioParam","addPassiveInputConnectionToAudioParam","isNativeAudioNodeFaker","nativeAudioNodeOrNativeAudioNodeFaker","fakeNativeDestinationAudioNode","deleteActiveInputConnection","activeInputConnections","deleteActiveInputConnectionToAudioParam","deleteEventListenerOfAudioNode","deletePassiveInputConnectionToAudioParam","getNativeAudioParam","testAudioNodeDisconnectMethodSupport","analyzer","dummy","ones","channelData","chnnlDt","sample","visitEachAudioNodeOnce","cycles","visitor","counts","cycle","isNativeAudioNode","nativeAudioNodeOrAudioParam","wrapAudioNodeDisconnectMethod","connect","returnValue","connectionsToDestination","connection","destinationOrOutput","filteredConnections","addConnectionToAudioParamOfAudioContext","nativeAudioParam","deleteInputConnectionOfAudioNode","deleteInputConnectionOfAudioParam","deleteInputsOfAudioNode","listener","deleteInputsOfAudioParam","deleteAnyConnection","audioNodeConnectionsOfSource","destinations","deleteConnectionAtOutput","deleteConnectionToDestination","createAudioNodeConstructor","addAudioNodeConnections","addConnectionToAudioNode","createIncrementCycleCounter","createInvalidAccessError","decrementCycleCounter","detectCycles","eventTargetConstructor","isNativeAudioContext","isNativeAudioParam","isPassive","createAudioParamFactory","addAudioParamConnections","audioParamAudioNodeStore","audioParamStore","createAudioParamRenderer","setValueAtTimeUntilPossible","isAudioParamOfOfflineAudioContext","maxValue","minValue","automationEventList","previousLastEvent","currentLastEvent","convertedValues","firstSample","lastSample","numberOfInterpolatedValues","interpolatedValues","timeOfLastSample","ReadOnlyMap","parameters","thisArg","createAudioWorkletNodeConstructor","addUnrenderedAudioWorkletNode","createAudioWorkletNodeRenderer","createNativeAudioWorkletNode","getBackupOfflineAudioContext","sanitizeAudioWorkletNodeOptions","setActiveAudioWorkletNodeInputs","testAudioWorkletNodeOptionsClonability","processorConstructor","nativeAudioWorkletNode","audioWorkletNodeRenderer","nm","nativeOnProcessorError","copyFromChannel","channelNumber","bufferOffset","slicedInput","copyToChannel","createNestedArrays","arrays","getAudioWorkletProcessor","nodeToProcessorMap","processBuffer","renderedBuffer","outputChannelCount","numberOfInputChannels","numberOfOutputChannels","sum","processedBuffer","audioNodeConnections","audioWorkletProcessor","inputs","prmtrs","potentiallyEmptyInputs","activeSourceFlag","outputChannelSplitterNodeOutput","createAudioWorkletNodeRendererFactory","connectMultipleOutputs","createNativeChannelSplitterNode","deleteUnrenderedAudioWorkletNode","disconnectMultipleOutputs","renderNativeOfflineAudioContext","renderedNativeAudioNodes","processedBufferPromise","createAudioNode","nativeOutputNodes","nativeAudioWorkletNodeIsOwnedByContext","outputChannelSplitterNode","outputChannelMergerNodes","outputGainNode","numberOfParameters","partialOfflineAudioContext","gainNodes","inputChannelSplitterNodes","constantSourceNodes","inputChannelMergerNode","gainNode","audioBufferSourceNode","outputChannelMergerNode","renderedNativeAudioWorkletNodeOrGainNode","createBaseAudioContextConstructor","addAudioWorkletModule","analyserNodeConstructor","audioBufferConstructor","audioBufferSourceNodeConstructor","biquadFilterNodeConstructor","channelMergerNodeConstructor","channelSplitterNodeConstructor","constantSourceNodeConstructor","convolverNodeConstructor","decodeAudioData","delayNodeConstructor","dynamicsCompressorNodeConstructor","gainNodeConstructor","iIRFilterNodeConstructor","minimalBaseAudioContextConstructor","oscillatorNodeConstructor","pannerNodeConstructor","periodicWaveConstructor","stereoPannerNodeConstructor","waveShaperNodeConstructor","_nativeContext","numberOfInputs","numberOfOutputs","maxDelayTime","feedforward","feedback","real","imag","constraints","audioData","successCallback","errorCallback","createBiquadFilterNodeConstructor","createBiquadFilterNodeRenderer","createNativeBiquadFilterNode","setAudioNodeTailTime","nativeBiquadFilterNode","biquadFilterNodeRenderer","frequencyHz","magResponse","phaseResponse","createBiquadFilterNodeRendererFactory","renderedNativeBiquadFilterNodes","createBiquadFilterNode","nativeBiquadFilterNodeIsOwnedByContext","renderedNativeBiquadFilterNode","createCacheTestResult","ongoingTests","testResults","tester","test","cachedTestResult","ongoingTest","synchronousTestResult","finalTestResult","createChannelMergerNodeConstructor","createChannelMergerNodeRenderer","nativeChannelMergerNode","channelMergerNodeRenderer","createChannelMergerNodeRendererFactory","renderedNativeAudioNode","createChannelSplitterNodeConstructor","createChannelSplitterNodeRenderer","sanitizeChannelSplitterOptions","nativeChannelSplitterNode","channelSplitterNodeRenderer","createChannelSplitterNodeRendererFactory","createConnectAudioParam","renderInputsOfAudioParam","createConnectMultipleOutputs","outputAudioNodes","outputAudioNode","createConnectedNativeAudioBufferSourceNodeFactory","createConstantSourceNodeConstructor","createConstantSourceNodeRendererFactory","nativeConstantSourceNode","constantSourceNodeRenderer","renderedNativeConstantSourceNodes","createConstantSourceNode","nativeConstantSourceNodeIsOwnedByContext","renderedNativeConstantSourceNode","createConvertNumberToUnsignedLong","unit32Array","createConvolverNodeConstructor","createConvolverNodeRenderer","createNativeConvolverNode","nativeConvolverNode","convolverNodeRenderer","createConvolverNodeRendererFactory","renderedNativeConvolverNodes","createConvolverNode","renderedNativeConvolverNode","createCreateNativeOfflineAudioContext","createDataCloneError","detachArrayBuffer","arrayBuffer","port1","port2","closeAndResolve","createDecodeAudioData","createEncodingError","detachedArrayBuffers","isNativeContext","testPromiseSupport","anyContext","complete","fail","createDecrementCycleCounter","cycleCounters","cycleCounter","nativeDestinationAudioParam","createDelayNodeConstructor","createDelayNodeRenderer","createNativeDelayNode","nativeDelayNode","delayNodeRenderer","createDelayNodeRendererFactory","renderedNativeDelayNodes","createDelayNode","nativeDelayNodeIsOwnedByContext","renderedNativeDelayNode","createDeleteActiveInputConnectionToAudioNode","createDeleteUnrenderedAudioWorkletNode","isDelayNode","createDetectCycles","chain","nextLink","mergedCycles","nestedCycles","getOutputAudioNodeAtIndex","createDisconnectMultipleOutputs","createDynamicsCompressorNodeConstructor","createDynamicsCompressorNodeRenderer","createNativeDynamicsCompressorNode","nativeDynamicsCompressorNode","dynamicsCompressorNodeRenderer","previousChannelCount","createDynamicsCompressorNodeRendererFactory","renderedNativeDynamicsCompressorNodes","createDynamicsCompressorNode","nativeDynamicsCompressorNodeIsOwnedByContext","renderedNativeDynamicsCompressorNode","createEvaluateSource","head","script","originalOnErrorHandler","removeErrorEventListenerAndRevokeUrl","message","src","lineno","colno","createEventTargetConstructor","_nativeEventTarget","wrappedEventListener","createExposeCurrentFrameAndCurrentTime","createFetchSource","response","createGainNodeConstructor","createGainNodeRenderer","gainNodeRenderer","createGainNodeRendererFactory","renderedNativeGainNodes","createGainNode","nativeGainNodeIsOwnedByContext","renderedNativeGainNode","createGetActiveAudioWorkletNodeInputs","activeAudioWorkletNodeInputsStore","createGetAudioNodeRenderer","createGetAudioNodeTailTime","audioNodeTailTimeStore","createGetAudioParamRenderer","createGetBackupOfflineAudioContext","backupOfflineAudioContextStore","createGetNativeContext","contextStore","createGetOrCreateBackupOfflineAudioContext","createGetUnrenderedAudioWorkletNodes","unrenderedAudioWorkletNodeStore","unrenderedAudioWorkletNodes","wrapIIRFilterNodeGetFrequencyResponseMethod","nativeIIRFilterNode","getFrequencyResponse","createIIRFilterNodeConstructor","createNativeIIRFilterNode","createIIRFilterNodeRenderer","iirFilterNodeRenderer","filterBuffer","feedbackLength","feedforwardLength","minLength","xBuffer","yBuffer","bufferIndex","bufferLength","inputLength","filterFullBuffer","convertedFeedback","convertedFeedforward","filteredBuffer","createIIRFilterNodeRendererFactory","filteredBufferPromise","nativeIIRFilterNodeIsOwnedByContext","createIncrementCycleCounterFactory","createIsAnyAudioContext","anything","createIsAnyAudioNode","audioNodeStore","createIsAnyAudioParam","createIsAnyOfflineAudioContext","createIsNativeAudioContext","createIsNativeAudioNode","createIsNativeAudioParam","createIsNativeContext","createIsNativeOfflineAudioContext","createIsSecureContext","createMediaElementAudioSourceNodeConstructor","createNativeMediaElementAudioSourceNode","nativeMediaElementAudioSourceNode","createMediaStreamAudioDestinationNodeConstructor","createNativeMediaStreamAudioDestinationNode","nativeMediaStreamAudioDestinationNode","createMediaStreamAudioSourceNodeConstructor","createNativeMediaStreamAudioSourceNode","nativeMediaStreamAudioSourceNode","createMediaStreamTrackAudioSourceNodeConstructor","createNativeMediaStreamTrackAudioSourceNode","nativeMediaStreamTrackAudioSourceNode","createMinimalBaseAudioContextConstructor","audioDestinationNodeConstructor","createAudioListener","nativeOnStateChange","uint32Array","createMonitorConnections","whenConnected","whenDisconnected","wasDisconnected","wasConnected","isDisconnected","assignNativeAudioNodeOption","assignNativeAudioNodeOptions","testAnalyserNodeGetFloatTimeDomainDataMethodSupport","wrapAnalyserNodeGetFloatTimeDomainDataMethod","byteTimeDomainData","createNativeAnalyserNodeFactory","createNativeAudioBufferConstructor","assignNativeAudioNodeAudioParamValue","wrapAudioBufferSourceNodeStartMethodConsecutiveCalls","isScheduled","wrapAudioScheduledSourceNodeStartMethodNegativeParameters","wrapAudioScheduledSourceNodeStopMethodNegativeParameters","createNativeAudioBufferSourceNodeFactory","addSilentConnection","testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport","testAudioBufferSourceNodeStartMethodOffsetClampingSupport","testAudioBufferSourceNodeStopMethodNullifiedBufferSupport","testAudioScheduledSourceNodeStartMethodNegativeParametersSupport","testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport","testAudioScheduledSourceNodeStopMethodNegativeParametersSupport","wrapAudioBufferSourceNodeStartMethodOffsetClampling","wrapAudioBufferSourceNodeStopMethodNullifiedBuffer","wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls","createNativeAudioContextConstructor","createNativeAudioDestinationNodeFactory","isNodeOfNativeOfflineAudioContext","createNativeAudioWorkletNodeConstructor","testClonabilityOfAudioWorkletNodeOptions","audioWorkletNodeOptions","createNativeAudioWorkletNodeFactory","createNativeAudioWorkletNodeFaker","monitorConnections","baseLatency","patchedEventListeners","onprocessorerror","addEventListener","unpatchedEventListener","patchedEventListener","removeEventListener","computeBufferSize","cloneAudioWorkletNodeOptions","data","createAudioWorkletProcessorPromise","clonedAudioWorkletNodeOptions","createAudioWorkletProcessor","audioWorkletProcessorPromise","createNativeAudioWorkletNodeFakerFactory","getActiveAudioWorkletNodeInputs","messageChannel","bufferSize","parameterMap","channelInterpretation","nativeAudioWorkletNodeFaker","onmessage","dWrkltPrcssr","disconnectOutputsGraph","activeInputIndexes","outputBuffer","isConnected","disconnectFakeGraph","connectFakeGraph","createNativeChannelMergerNodeFactory","wrapChannelMergerNode","wrapChannelSplitterNode","channelSplitterNode","createNativeConstantSourceNodeFactory","createNativeConstantSourceNodeFaker","interceptConnections","original","interceptor","createNativeConstantSourceNodeFakerFactory","audioNodeOptions","nativeConstantSourceNodeFaker","createNativeConvolverNodeFactory","createNativeDynamicsCompressorNodeFactory","createNativeIIRFilterNodeFactory","createNativeIIRFilterNodeFaker","divide","denominator","multiply","evaluatePolynomial","coefficient","z","createNativeIIRFilterNodeFakerFactory","channelCountMode","bufferIndexes","xBuffers","yBuffers","nyquist","omega","numerator","audioStreamTracks","filteredAudioStreamTracks","createNativeMediaStreamTrackAudioSourceNodeFactory","createNativeOfflineAudioContextConstructor","createNativeOscillatorNodeFactory","nativeOscillatorNode","createNativePannerNodeFactory","createNativePannerNodeFaker","nativePannerNode","createNativePannerNodeFakerFactory","createNativeWaveShaperNode","coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","refDistance","rolloffFactor","pannerNode","SINGLE_CHANNEL_OPTIONS","inputGainNode","orientationXGainNode","orientationYGainNode","orientationZGainNode","positionXGainNode","positionYGainNode","positionZGainNode","waveShaperNode","nativePannerNodeFaker","createNativePeriodicWaveFactory","disableNormalization","convertedImag","convertedReal","nativePeriodicWave","createNativeStereoPannerNodeFactory","createNativeStereoPannerNodeFaker","nativeStereoPannerNode","createNativeStereoPannerNodeFakerFactory","DC_CURVE","HALF_PI","SINGLE_CHANNEL_WAVE_SHAPER_OPTIONS","buildInternalGraphForMono","panGainNode","leftWaveShaperCurve","rightWaveShaperCurve","leftGainNode","leftWaveShaperNode","panWaveShaperNode","rightGainNode","rightWaveShaperNode","buildInternalGraphForStereo","leftInputForLeftOutputWaveShaperCurve","leftInputForRightOutputWaveShaperCurve","rightInputForLeftOutputWaveShaperCurve","rightInputForRightOutputWaveShaperCurve","centerIndex","leftInputForLeftOutputGainNode","leftInputForLeftOutputWaveShaperNode","leftInputForRightOutputGainNode","leftInputForRightOutputWaveShaperNode","rightInputForLeftOutputGainNode","rightInputForLeftOutputWaveShaperNode","rightInputForRightOutputGainNode","rightInputForRightOutputWaveShaperNode","buildInternalGraph","pan","connectGraph","disconnectGraph","nativeStereoPannerNodeFakerFactory","createNativeWaveShaperNodeFactory","createConnectedNativeAudioBufferSourceNode","createNativeWaveShaperNodeFaker","isDCCurve","nativeWaveShaperNode","curve","disconnectNativeAudioBufferSourceNode","createNativeWaveShaperNodeFakerFactory","oversample","negativeWaveShaperNode","positiveWaveShaperNode","invertGainNode","revertGainNode","unmodifiedCurve","nativeWaveShaperNodeFaker","curveLength","negativeCurve","positiveCurve","createOfflineAudioContextConstructor","createNativeOfflineAudioContext","startRendering","delayStateChangeEvent","createOscillatorNodeConstructor","createNativeOscillatorNode","createOscillatorNodeRenderer","oscillatorNodeRenderer","periodicWave","createOscillatorNodeRendererFactory","renderedNativeOscillatorNodes","createOscillatorNode","nativeOscillatorNodeIsOwnedByContext","renderedNativeOscillatorNode","createPannerNodeConstructor","createNativePannerNode","createPannerNodeRenderer","pannerNodeRenderer","createPannerNodeRendererFactory","renderedBufferPromise","commonAudioNodeOptions","commonNativePannerNodeOptions","nativePannerNodeIsOwnedByContext","nativeConstantSourceNodes","channelDatas","gateGainNode","partialPannerNode","renderedNativeGainNodeOrNativePannerNode","createPeriodicWaveConstructor","createNativePeriodicWave","periodicWaveStore","sanitizePeriodicWaveOptions","PeriodicWave","createRenderAutomation","getAudioParamRenderer","createRenderInputsOfAudioNode","getAudioNodeRenderer","allRenderingPromises","renderingPromises","createRenderInputsOfAudioParam","createRenderNativeOfflineAudioContext","testOfflineAudioContextCurrentTimeSupport","isOfflineAudioContextCurrentTimeSupported","createSetActiveAudioWorkletNodeInputs","createSetAudioNodeTailTime","createStartRendering","createStereoPannerNodeConstructor","createNativeStereoPannerNode","createStereoPannerNodeRenderer","stereoPannerNodeRenderer","createStereoPannerNodeRendererFactory","renderedNativeStereoPannerNodes","createStereoPannerNode","nativeStereoPannerNodeIsOwnedByContext","renderedNativeStereoPannerNode","createTestAudioBufferConstructorSupport","createTestAudioWorkletProcessorPostMessageSupport","offlineAudioContext","isEmittingMessageEvents","isEmittingProcessorErrorEvents","oscillator","createTestOfflineAudioContextCurrentTimeSupport","createWaveShaperNodeConstructor","createWaveShaperNodeRenderer","waveShaperNodeRenderer","createWaveShaperNodeRendererFactory","renderedNativeWaveShaperNodes","createWaveShaperNode","renderedNativeWaveShaperNode","createWindow","createWrapAudioBufferCopyChannelMethods","convertNumberToUnsignedLong","channelNumberAsNumber","bufferOffsetAsNumber","audioBufferLength","destinationLength","sourceLength","createWrapAudioBufferCopyChannelMethodsOutOfBounds","createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer","nullifiedBuffer","createWrapChannelMergerNode","object","createGetter","createSetter","wrapAudioBufferSourceNodeStartMethodOffsetClamping","clampedOffset","disconnectGainNode","isStopped","createConstantSourceNodeRenderer","isSecureContext","audioContextConstructor","audioWorkletNodeConstructor","offlineAudioContextConstructor","isAnyAudioContext","isAnyAudioNode","isAnyAudioParam","isAnyOfflineAudioContext","isUndef","arg","isDefined","isFunction","isNumber","isObject","isBoolean","isArray","isString","isNote","assert","statement","assertRange","gte","lte","assertContextRunning","warn","isInsideScheduledCallback","printedScheduledWarning","enterScheduledCallback","insideCallback","assertUsedScheduleTime","defaultLogger","log","createAudioContext","stdAudioContext","createOfflineAudioContext","channels","stdOfflineAudioContext","theWindow","hasAudioContext","createAudioWorkletNode","stdAudioWorkletNode","__decorate","decorators","desc","c","__awaiter","_arguments","P","generator","adopt","fulfilled","step","rejected","Ticker","updateInterval","contextSampleRate","blobUrl","worker","interval","isAudioParam","isOfflineAudioContext","isAudioContext","isAudioBuffer","noCopy","deepMerge","deepEquals","arrayA","arrayB","optionsFromArguments","defaults","argsArray","objKey","opts","getDefaultsFromInstance","defaultArg","given","omitFromObject","obj","omit","Tone","EPSILON","GT","GTE","EQ","LT","clamp","min","max","Timeline","lastValue","diff","param","after","beginning","midPoint","nextEvent","testEvent","lowerBound","upperBound","notifyNewContext","onContextInit","cb","initializeContext","notifyCloseContext","onContextClose","closeContext","Emitter","eventName","boundCallback","eventList","constr","BaseContext","Context","feedForward","stream","l","val","constant","now","timeout","id","intervalFn","DummyContext","_numberOfChannels","_length","_sampleRate","_numberOfInputs","_numberOfOutputs","_maxDelayTime","_feedForward","_feedback","_real","_imag","_constraints","_stream","_element","_audioData","_name","_options","_url","_fn","_timeout","_id","_interval","_val","readOnly","writable","noOp","ToneAudioBuffer","getContext","doneLoading","isMultidimensional","multiChannelArray","chanNum","outputArray","numChannels","channelArray","ret","startSamples","endSamples","retBuffer","rev","baseUrl","extensions","extension","OfflineContext","asynchronous","yieldEvery","done","dummyContext","globalContext","setContext","disposeOld","printString","dbToGain","db","gainToDb","gain","intervalToFrequencyRatio","A4","getA4","setA4","freq","ftom","frequency","ftomf","mtof","TimeBaseClass","units","dot","numericValue","scalar","m","q","total","typeName","quantity","expr","matching","beats","seconds","ticks","TimeClass","quantTo","subdiv","percent","subdivision","testNotations","power","closest","closestSeconds","notation","notationSeconds","quarterTime","quarters","measures","sixteenths","sixteenthString","FrequencyClass","noteNumber","noteToScaleIndex","intervals","scaleIndexToNote","Frequency","TransportTimeClass","ToneWithContext","member","StateTimeline","initial","Param","computedTime","before","previous","previousVal","beforeValue","currentVal","rampTime","scaling","startingValue","segTime","valueAtTime","previousEvent","subdivisions","t0","v0","v1","t1","ToneAudioNode","nodeList","outputNum","inputNum","nodes","connectSeries","srcNode","dstNode","outputNumber","inputNumber","Gain","OneShotSource","fadeInTime","fadeOutTime","additionalTail","disposeCallback","ToneConstantSource","Signal","connectSignal","convert","TickParam","computedValue","prevEvent","segments","rampVal","ticksUntilTime","computedVal","segmentDur","val0","val1","onTheLineEvent","currentTick","delta","sol1","sol2","computedDuration","startTicks","TickSignal","TickSource","stopEvent","memoizedEvent","tmpEvent","lastState","elapsedTicks","eventToMemoize","periodStartTime","offsetEvent","elapsedSeconds","absoluteTicks","lastStateEvent","maxStartTime","ticksAtStart","nextTickTime","Clock","Volume","mute","DestinationClass","ListenerClass","ToneAudioBuffers","MidiClass","TicksClass","DrawClass","IntervalTimeline","IntervalNode","results","replacement","balance","temp","isLeftChild","pivotNode","allNodes","low","high","TimelineValue","SignalOperator","WaveShaper","mapping","normalized","oversampling","isOverSampleType","Pow","exponent","TransportEvent","transport","tickDuration","TransportRepeatEvent","TransportClass","tickTime","progress","amount","eventId","timeline","computedAfter","offsetTicks","timeSig","startPosition","endPosition","remainingTick","ppq","transportPos","remainingTicks","sourceValue","scaleFactor","scaleBefore","reciprocal","scaleAfter","ratioSignal","syncedSignal","Source","sched","stateEvent","startOffset","ToneBufferSource","computedOffset","loopEnd","loopStart","loopDuration","computedDur","UserMedia","labelOrId","devices","device","mediaStreamNode","track","generateWaveform","ToneOscillatorNode","Oscillator","description","oscProps","isBasicType","cache","partials","wave","baseType","partial","fullPartials","phase","periodicWaveSize","partialCount","piFactor","twoPi","testPositions","AudioToGain","Multiply","AMOscillator","FMOscillator","PulseOscillator","FatOscillator","osc","iterator","spread","PWMOscillator","OmniOscillatorSourceMap","OmniOscillator","prefix","oscType","OscConstructor","oldOsc","sType","sourceType","mType","valueMap","propertyKey","newValue","timeRange","Player","origDuration","rate","Envelope","direction","curveName","EnvelopeCurves","curveDef","velocity","attack","decay","currentValue","attackRate","decayValue","decayStart","release","attackPortion","envelopeDuration","sustainTime","totalDuration","cosineCurve","rippleCurve","rippleCurveFreq","sineWave","stairsCurve","steps","sineCurve","bounceCurve","invertCurve","out","reverseCurve","Instrument","changed","method","timePosition","originalMethod","Monophonic","computedFrequency","portTime","AmplitudeEnvelope","Synth","computedAttack","computedDecay","MembraneSynth","hertz","maxNote","workletContext","addToWorklet","classOrFunction","registerProcessor","classDesc","processor","toneAudioWorkletProcessor","singleIOProcess","delayLine","workletName","feedbackCombFilter","PolySynth","voice","activeVoiceIndex","firstAvail","notes","midiNote","released","durationSeconds","sanitizedOptions","Sampler","urlMap","midiFloat","remainder","difference","closestNote","playbackRate","Panner","bitCrusherWorklet","Split","Analyser","analyser","size","Solo","solo","PanVol","Channel","bus","sendKnob","DEFAULT_CONFIG","createFeedbackCollector","finalConfig","activeNotes","performances","calculateCentDeviation","actualMidi","targetMidi","isPitchCorrect","calculateAveragePitchDeviation","samples","calculatePitchCoverage","noteStartMs","noteDurationMs","correctSamples","coveredMs","nextSample","sampleDuration","determineAccuracyTier","onsetAccuracyMs","pitchAccuracyCents","pitchCoverage","tiers","absOnset","analyzePerformance","noteData","onsetSample","releaseSample","releaseAccuracyMs","noteEndMs","onsetOk","releaseOk","pitchOk","hitStatus","accuracyTier","noteId","onsetWindow","releaseWindow","performance","createNoteHighwayService","stateCallbacks","eventCallbacks","visualCallbacks","logger","feedbackCollector","notesInWindow","getOnrampDurationMs","beatDurationMs","getJudgmentLineX","calculateScrollOffset","pixelsPerMs","judgmentLineX","onrampDurationMs","isNoteInJudgmentWindow","noteEndX","windowTolerancePx","updateActiveNotes","currentActiveNotes","tolerance","eventData","updateJudgmentWindow","inWindow","wasInWindow","updateOnramp","msRemaining","animate","startAnimation","stopAnimation","pausedDuration","createHighwayState","engineService","performanceCompleteCallback","convertToEngineFormat","syncEngineState","engineState","perf","initializeEngine","hitData","engineNotes","noteIndex","pps","ms","highwayState","randomPitch","getMicrobeatDurationMs","tempo","createDemoExerciseState","generateExerciseNotes","microbeatDurationMs","leadInMs","loopStartTime","getPhaseFromTime","loopDurationMs","adjustedTimeMs","currentLoop","timeInLoop","microbeatInLoop","newConfig","playing","loopIndex","r","demoExerciseState","container","containerWidth","trailCanvas","trailCtx","trailAnimationId","lastTrailLogAt","trailFrameSamples","trailFrameTimeTotal","gridOffsetX","getDebugTrailFlag","viewportWindow","legendHighlight","convertTargetNotes","trailConfig","singingConfig","highwayConfig","setupTrailCanvas","renderTrail","trailHistory","activeConfig","debugTrail","frameStart","avgMs","startTrailLoop","stopTrailLoop","resizeObserver","entries","PitchGrid","FFT","table","shift","revShift","fft","complex","storage","spectrum","half","outOff","bitrev","off","inv","quarterLen","limit","A","B","C","D","Ar","Ai","Br","Bi","Cr","Ci","Dr","Di","MAr","MAi","tableBr","tableBi","MBr","MBi","tableCr","tableCi","MCr","MCi","tableDr","tableDi","MDr","MDi","T0r","T0i","T1r","T1i","T2r","T2i","T3r","T3i","FAr","FAi","FCr","FCi","FBr","FBi","FDr","FDi","evenR","evenI","oddR","oddI","leftR","leftI","rightR","rightI","step2","step3","halfLen","hquarterLen","ST0r","ST0i","ST1r","ST1i","ST2r","ST2i","ST3r","ST3i","SFAr","SFAi","SFBr","SFBi","SA","SB","Autocorrelator","bufferSupplier","ceilPow2","tb","getKeyMaximumIndices","keyIndices","lookingForMaximum","maxIndex","refineResultIndex","x0","x1","x2","y0","y1","y2","xMax","yMax","PitchDetector","threshold","amplitude","keyMaximumIndices","nMax","resultIndex","refinedResultIndex","squareSum","CENTS_PER_SEMITONE","SEMITONES_PER_OCTAVE","getCentsOffset","nearestMidi","getNearestMidi","midiToPitchClass","ReferenceAudioService","Tone.start","Tone.Volume","Tone.Synth","dB","Tone.Frequency","startTimeoutId","endTimeoutId","durationMs","timeoutId","referenceAudio","CONFIG","mic","detector","isRunning","HIGHLIGHT_DEFAULT_SIZE","frequencyToMidi","animationLoop","waveform","Tone.getContext","isValidPitch","detectedPitch","centsOffset","centsDistance","startDetection","Tone.UserMedia","Tone.Analyser","stopDetection","synth","isPlaying","currentNote","ensureSynth","Tone.PolySynth","oscillatorType","getNoteName","startDrone","stopDrone","updateDrone","newNote","toggleDrone","TONIC_OPTIONS","handleChange","$.child","$.init_select","$.select_option","OCTAVE_OPTIONS","handleToggle","handleOctaveChange","handleVolumeChange","button","div_1","$.index","$$anchor","oct","label_1","classes","$.set_class","select_value","$.set_value","selectedIndex","ariaLabel","OPTION_HEIGHT","SCROLL_STEP","wheelElement","viewportElement","optionsElement","pointerActive","pointerId","lastPointerY","deltaBuffer","measuredOptionHeight","optionDistances","centerOffset","translateY","setIndex","targetIndex","clampedIndex","handleWheel","handleKeydown","handlePointerDown","handlePointerMove","deltaY","handlePointerEnd","measureHeight","firstOption","div_2","$.each","div_3","$.set_text","$.set_attribute","$.set_style","styles_1","$.event","$.append","handleClick","preset","DEFAULT_MIN_SPAN","clampInt","computeConstrainedTopIndex","currentBottomIndex","requestedTop","totalOptions","minSpan","bottomIndex","normalizedMinSpan","maxTop","computeConstrainedBottomIndex","currentTopIndex","requestedBottom","topIndex","minBottom","createWheelOptions","pitchRowData","findMidiIndex","pitchData","midiNumber","createVoicePresets","showSummary","showPresets","currentRange","rangeLabel","rangeCount","activePreset","matchingPreset","constrainTopIndex","requestedTopIndex","constrainBottomIndex","requestedBottomIndex","handleTopChange","newTopIndex","_option","handleBottomChange","newBottomIndex","handlePresetClick","PitchWheel","node_1","div_4","div_5","div_6","PresetButtons","voicePresets","handleRangeChange","DualPitchWheel","showSettings","numLoops","referenceVolume","currentPhase","hasResults","averageAccuracy","hitCount","totalCount","accuracy","calculateAccuracy","handleStop","useCurrentRange","useFullRange","handleStart","referenceTones","getPhaseLabel","getPitchName","details","input_1","label_2","input_2","span","button_1","button_2","button_3","$.first_child","text_1","alternate","root_3","div_7","div_8","span_1","div_9","span_2","details_1","div_10","div_11","root_4","span_3","span_4","span_5","span_6","text_4","YOUTUBE_URL_PATTERNS","DEFAULT_SYNC_CONFIG","ULTRASTAR_BASE_MIDI","parseUltrastarFile","lines","line","metadata","extractMetadata","lineBreaks","totalBeats","parseNoteLines","colonIndex","firstChar","beat","parseNoteLine","noteEnd","startBeat","lyric","extractYouTubeId","urlOrId","trimmed","pattern","match","convertToTargetNotes","song","baseMidi","bpm","msPerBeat","phraseIndex","sortedBreaks","firstNoteBeat","startTimeMs","targetNote","getSyncConfig","calculateSongDuration","detectPitchRange","midiNotes","createUltrastarState","onCompleteCallback","file","youtubeId","syncConfig","totalDurationMs","detectedRange","gapMs","videoGapSec","manualOffsetSec","deltaSec","offsetSec","ultrastarState","apiLoadPromise","isApiLoaded","loadYouTubeAPI","createYouTubePlayer","elementId","videoId","onReady","onStateChange","onError","getYouTubeErrorMessage","createYouTubeState","player","syncIntervalId","timeUpdateCallback","containerId","playerState","timeSeconds","onTimeUpdate","intervalMs","expectedTimeSec","maxDriftMs","actualTime","youtubeState","createTransportSync","driftCheckIntervalMs","getYouTubeOffset","transportToYouTube","transportTimeMs","youTubeToTransport","youtubeTimeSec","checkDrift","expectedYouTubeTime","driftSec","driftMs","correctedTransportTimeMs","updateConfig","adjustManualOffset","resetManualOffset","getManualOffset","getTotalOffset","formatOffset","getSyncLoopConfig","playerId","isLoading","hasError","isEmbeddable","openOnYouTube","consequent_2","consequent_3","$.template_effect","manualOffset","adjust","button_4","transportSync","fileInput","hasVideo","songTitle","songArtist","handleFileSelect","startSyncLoop","stopSyncLoop","handleUnload","ytTime","currentTransport","openFilePicker","fragment_2","root_6","YouTubePlayer","node_4","SyncControls","node_5","node_3","root_7","root_8","alternate_1","consequent_4","node_6","root_9","consequent_5","alternate_2","NOTE_NAMES","cents","text_2","EMPTY_SUMMARY","createResultsState","summary","notesHit","goldenNotesHit","goldenNotesTotal","totalPitchDeviation","pitchDeviationCount","phraseMap","isGolden","phrase","totalNotes","notesMissed","accuracyPercent","averagePitchDeviationCents","phraseResults","resultsState","isVisible","artistName","letterGrade","accuracyColor","handleClose","handleRetry","handleBackdropClick","text_6","root_5","span_7","text_7","div_12","span_8","$0","text_8","div_13","div_14","span_9","span_10","text_9","text_10","div_15","node_7","text_5","consequent_7","SNAPSHOT_SCHEMA_VERSION","DB_NAME","DB_VERSION","STORE_NAME","STORAGE_KEY","SLOT_EXPIRY_MS","openDatabase","request","isIndexedDBAvailable","generateHandoffId","timestamp","random","writeToIndexedDB","transaction","store","clearRequest","addRequest","writeToLocalStorage","serialized","writeHandoffSlot","snapshot","handoffId","readFromIndexedDB","readFromLocalStorage","readHandoffSlot","useIndexedDB","clearHandoffSlot","clearIndexedDB","clearLocalStorage","consumeHandoffSlot","getAppRoute","app","navigateToApp","params","searchParams","navigateToStudentNotation","checkForHandoff","from","clearHandoffParams","createHandoffState","margin","semitones","originalMidi","returnSnapshot","handoffState","handleResultsRetry","suggestedRange","hasImportedSnapshot","transposition","handoffError","handleBringBack","handleTransposeUp","handleTransposeDown","header","main","aside","PitchReadout","node_2","DemoExerciseControls","UltrastarControls","TonicSelector","DroneControls","PitchHighlightToggle","RangeControl","node_8","text_3","section","SingingCanvas","node_11","ResultsModal","mountSingingTrainer","App"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,415,416]}