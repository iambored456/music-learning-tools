import"./modulepreload-polyfill-B5Qt9EMX.js";import{b as z,P as pe,S as fe,n as Ae,U as ve,A as Ne,m as re,c as xe}from"./index-Daas8fXP.js";import{P as Ce}from"./index-DoA2xU7W.js";var ye=Object.defineProperty,Be=(e,t,c)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[t]=c,ge=(e,t,c)=>Be(e,t+"",c);const be=`<div id="app-container">\r
    <!-- LEFT PANEL: All controls will live here -->\r
    <div id="left-panel">\r
      <button id="startBtn" class="startBtn" aria-label="Start Pitch Detection">Start</button>\r
      \r
      <div id="detector" class="vague">\r
        <div><span id="pitch">--</span> Hz</div>\r
        <div>\r
          <span id="note">--</span><span id="octave">-</span>\r
        </div>\r
        <canvas id="output" width="100" height="42"></canvas>\r
        <div id="detune">\r
          <span id="detune_amt">--</span>\r
          <span id="flat">cents ♭</span>\r
          <span id="sharp">cents ♯</span>\r
        </div>\r
      </div>\r
\r
      <div id="tonicBox">\r
        <label for="tonicSelect">Tonic:</label>\r
        <select id="tonicSelect" aria-label="Select Tonic">\r
            <option value="C">C</option>\r
            <option value="C♯">C♯</option>\r
            <option value="D♭">D♭</option>\r
            <option value="D">D</option>\r
            <option value="E♭">E♭</option>\r
            <option value="E">E</option>\r
            <option value="F">F</option>\r
            <option value="F♯">F♯</option>\r
            <option value="G♭">G♭</option>\r
            <option value="G">G</option>\r
            <option value="A♭">A♭</option>\r
            <option value="A">A</option>\r
            <option value="B♭">B♭</option>\r
            <option value="B">B</option>\r
        </select>\r
        <label>\r
          <input type="checkbox" id="labelToggle" />\r
          degrees\r
        </label>\r
        <label>\r
          <input type="checkbox" id="accidentalsToggle" checked />\r
          Show Accidentals\r
        </label>\r
      </div>\r
\r
      <div id="droneBox">\r
        <button class="droneBtn" id="droneBtn">Drone</button>\r
        <div id="octaveToggles">\r
          <button class="octaveBtn" data-octave="2">Oct 2</button>\r
          <button class="octaveBtn active" data-octave="3">Oct 3</button>\r
          <button class="octaveBtn" data-octave="4">Oct 4</button>\r
        </div>\r
        <div id="volumeContainer">\r
          <label for="volumeSlider">Volume</label>\r
          <div id="volumeSliderWrapper">\r
            <input type="range" id="volumeSlider" min="-40" max="0" value="-12" step="1" />\r
            <div class="volumeLabels">\r
              <span>Min</span>\r
              <span>Max</span>\r
            </div>\r
          </div>\r
        </div>\r
      </div>\r
    </div>\r
\r
    <!-- RIGHT PANEL: The plot and its controls will live here -->\r
    <div id="right-panel">\r
      <div id="yAxisControlsTop" class="yAxisControls">\r
        <button id="yAxisUpperExpandBtn" aria-label="Expand Upper Y-Axis">↑</button>\r
        <button id="yAxisUpperContractBtn" aria-label="Contract Upper Y-Axis">↓</button>\r
      </div>\r
\r
      <div id="plotContainer">\r
        <canvas id="plotCanvas"></canvas>\r
        <canvas id="noteCanvas"></canvas>\r
      </div>\r
\r
      <div id="yAxisControlsBottom" class="yAxisControls">\r
        <button id="yAxisLowerContractBtn" aria-label="Contract Lower Y-Axis">↑</button>\r
        <button id="yAxisLowerExpandBtn" aria-label="Expand Lower Y-Axis">↓</button>\r
      </div>\r
    </div>\r
  </div>\r
\r
  <!-- Main application script -->
`,Ee=[{pitch:"C8",column:"A",hex:"#fef1f5",value:48},{pitch:"B7",column:"B",hex:"#fbf2fa",value:47},{pitch:"B♭/A♯7",column:"A",hex:"#f6f3fd",value:46},{pitch:"A7",column:"B",hex:"#f1f5ff",value:45},{pitch:"A♭/G♯7",column:"A",hex:"#edf7fe",value:44},{pitch:"G7",column:"B",hex:"#ebf8fa",value:43},{pitch:"G♭/F♯7",column:"A",hex:"#ecf8f5",value:42},{pitch:"F7",column:"B",hex:"#eff8f0",value:41},{pitch:"E7",column:"A",hex:"#f4f7ec",value:40},{pitch:"E♭/D♯7",column:"B",hex:"#f9f5eb",value:39},{pitch:"D7",column:"A",hex:"#fdf3ec",value:38},{pitch:"D♭/C♯7",column:"B",hex:"#fef2f0",value:37},{pitch:"C7",column:"A",hex:"#fef1f5",value:36},{pitch:"B6",column:"B",hex:"#f0d1ec",value:35},{pitch:"B♭/A♯6",column:"A",hex:"#e1d6f9",value:34},{pitch:"A6",column:"B",hex:"#cfdcff",value:33},{pitch:"A♭/G♯6",column:"A",hex:"#bfe2fb",value:32},{pitch:"G6",column:"B",hex:"#b7e6ef",value:31},{pitch:"G♭/F♯6",column:"A",hex:"#b9e8dd",value:30},{pitch:"F6",column:"B",hex:"#c6e6cb",value:29},{pitch:"E6",column:"A",hex:"#d8e2bd",value:28},{pitch:"E♭/D♯6",column:"B",hex:"#e9dcb7",value:27},{pitch:"D6",column:"A",hex:"#f6d5bc",value:26},{pitch:"D♭/C♯6",column:"B",hex:"#fcd1c9",value:25},{pitch:"C6",column:"A",hex:"#facfdb",value:24},{pitch:"B5",column:"B",hex:"#e6b2e1",value:23},{pitch:"B♭/A♯5",column:"A",hex:"#cebaf6",value:22},{pitch:"A5",column:"B",hex:"#b0c4fe",value:21},{pitch:"A♭/G♯5",column:"A",hex:"#92cef8",value:20},{pitch:"G5",column:"B",hex:"#7fd5e5",value:19},{pitch:"G♭/F♯5",column:"A",hex:"#84d8c8",value:18},{pitch:"F5",column:"B",hex:"#9ed6a8",value:17},{pitch:"E5",column:"A",hex:"#bece8f",value:16},{pitch:"E♭/D♯5",column:"B",hex:"#dbc484",value:15},{pitch:"D5",column:"A",hex:"#f0b98d",value:14},{pitch:"D♭/C♯5",column:"B",hex:"#f9b1a5",value:13},{pitch:"C5",column:"A",hex:"#f5afc3",value:12},{pitch:"B4",column:"B",hex:"#db8fd4",value:11},{pitch:"B♭/A♯4",column:"A",hex:"#ba9bf2",value:10},{pitch:"A4",column:"B",hex:"#8fa9ff",value:9},{pitch:"A♭/G♯4",column:"A",hex:"#58b8f6",value:8},{pitch:"G4",column:"B",hex:"#16c3da",value:7},{pitch:"G♭/F♯4",column:"A",hex:"#2dc8b1",value:6},{pitch:"F4",column:"B",hex:"#6ec482",value:5},{pitch:"E4",column:"A",hex:"#a4ba57",value:4},{pitch:"E♭/D♯4",column:"B",hex:"#cdaa42",value:3},{pitch:"D4",column:"A",hex:"#e89955",value:2},{pitch:"D♭/C♯4",column:"B",hex:"#f48e7d",value:1},{pitch:"C4",column:"A",hex:"#ef8aab",value:0},{pitch:"B3",column:"B",hex:"#be7cb8",value:-1},{pitch:"B♭/A♯3",column:"A",hex:"#a286d2",value:-2},{pitch:"A3",column:"B",hex:"#7b93dd",value:-3},{pitch:"A♭/G♯3",column:"A",hex:"#4c9fd6",value:-4},{pitch:"G3",column:"B",hex:"#13a9bd",value:-5},{pitch:"G♭/F♯3",column:"A",hex:"#27ad99",value:-6},{pitch:"F3",column:"B",hex:"#5faa71",value:-7},{pitch:"E3",column:"A",hex:"#8ea14b",value:-8},{pitch:"E♭/D♯3",column:"B",hex:"#b29338",value:-9},{pitch:"D3",column:"A",hex:"#ca8549",value:-10},{pitch:"D♭/C♯3",column:"B",hex:"#d47a6c",value:-11},{pitch:"C3",column:"A",hex:"#cf7894",value:-12},{pitch:"B2",column:"B",hex:"#a46b9f",value:-13},{pitch:"B♭/A♯2",column:"A",hex:"#8b73b6",value:-14},{pitch:"A2",column:"B",hex:"#6a7ebf",value:-15},{pitch:"A♭/G♯2",column:"A",hex:"#4189b8",value:-16},{pitch:"G2",column:"B",hex:"#1092a3",value:-17},{pitch:"G♭/F♯2",column:"A",hex:"#219584",value:-18},{pitch:"F2",column:"B",hex:"#519360",value:-19},{pitch:"E2",column:"A",hex:"#7a8b40",value:-20},{pitch:"E♭/D♯2",column:"B",hex:"#997f30",value:-21},{pitch:"D2",column:"A",hex:"#ae723e",value:-22},{pitch:"D♭/C♯2",column:"B",hex:"#b7695d",value:-23},{pitch:"C2",column:"A",hex:"#b3677f",value:-24},{pitch:"B1",column:"B",hex:"#6f466b",value:-25},{pitch:"B♭/A♯1",column:"A",hex:"#5d4c7b",value:-26},{pitch:"A1",column:"B",hex:"#465482",value:-27},{pitch:"A♭/G♯1",column:"A",hex:"#295c7d",value:-28},{pitch:"G1",column:"B",hex:"#06626e",value:-29},{pitch:"G♭/F♯1",column:"A",hex:"#126458",value:-30},{pitch:"F1",column:"B",hex:"#34633f",value:-31},{pitch:"E1",column:"A",hex:"#515d28",value:-32},{pitch:"E♭/D♯1",column:"B",hex:"#67541d",value:-33},{pitch:"D1",column:"A",hex:"#764c27",value:-34},{pitch:"D♭/C♯1",column:"B",hex:"#7c453d",value:-35},{pitch:"C1",column:"A",hex:"#794455",value:-36}],p={_subscribers:{},on(e,t){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e].push(t),()=>this.off(e,t)},off(e,t){const c=this._subscribers[e];c&&(this._subscribers[e]=c.filter(i=>i!==t))},emit(e,t){this._subscribers[e]&&this._subscribers[e].forEach(c=>c(t))}},De={pitchData:Ee,noteStrings:["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],tonicToSemisFromC:{C:0,"C♯":1,"D♭":1,D:2,"D♯":3,"E♭":3,E:4,"F♭":4,F:5,"E♯":5,"F♯":6,"G♭":6,G:7,"G♯":8,"A♭":8,A:9,"A♯":10,"B♭":10,B:11},majorScales:{C:[0,2,4,5,7,9,11],"C♯":[1,3,5,6,8,10,0],"D♭":[1,3,5,6,8,10,0],D:[2,4,6,7,9,11,1],"E♭":[3,5,7,8,10,0,2],E:[4,6,8,9,11,1,3],F:[5,7,9,10,0,2,4],"F♯":[6,8,10,11,1,3,5],"G♭":[6,8,10,11,1,3,5],G:[7,9,11,0,2,4,6],"A♭":[8,10,0,1,3,5,7],A:[9,11,1,2,4,6,8],"B♭":[10,0,2,3,5,7,9],B:[11,1,3,4,6,8,10]}},o={isDetecting:!1,detectedPitch:{frequency:0,clarity:0,midi:0,pitchClass:0},tonic:"C",useDegrees:!1,showAccidentals:!0,yAxisRange:{minMidi:33,maxMidi:81},drone:{isPlaying:!1,octave:3,volume:-12},stablePitch:{pitchClass:null,opacity:0,size:1},pitchHistory:[]},Ge={toggleIsDetecting(){o.isDetecting=!o.isDetecting,o.isDetecting||(o.pitchHistory=[],o.detectedPitch={frequency:0,clarity:0,midi:0,pitchClass:0},p.emit("pitchChanged",o.detectedPitch),p.emit("pitchHistoryChanged",o.pitchHistory)),p.emit("isDetectingChanged",o.isDetecting)},setDetectedPitch(e){o.detectedPitch=e,p.emit("pitchChanged",o.detectedPitch)},addPitchHistoryPoint(e){o.pitchHistory.push(e),o.pitchHistory.length>500&&o.pitchHistory.shift(),p.emit("pitchHistoryChanged",o.pitchHistory)},setTonic(e){o.tonic=e,p.emit("settingsChanged"),p.emit("droneShouldUpdate")},setUseDegrees(e){o.useDegrees=e,p.emit("settingsChanged")},setShowAccidentals(e){o.showAccidentals=e,p.emit("settingsChanged")},setYAxisRange(e,t){const{minMidi:c,maxMidi:i}=o.yAxisRange;t==="upper"&&(e==="expand"&&i<81&&o.yAxisRange.maxMidi++,e==="contract"&&i>c+12&&o.yAxisRange.maxMidi--),t==="lower"&&(e==="expand"&&c>33&&o.yAxisRange.minMidi--,e==="contract"&&c<i-12&&o.yAxisRange.minMidi++),p.emit("settingsChanged")},toggleDrone(){o.drone.isPlaying=!o.drone.isPlaying,p.emit("droneShouldUpdate")},setDroneOctave(e){o.drone.octave=e,p.emit("droneOctaveChanged",e),p.emit("droneShouldUpdate")},setDroneVolume(e){o.drone.volume=e,p.emit("droneShouldUpdate")},setStablePitch(e,t,c){o.stablePitch={pitchClass:e,opacity:t,size:c},p.emit("stablePitchChanged")}},n={state:o,data:De,...Ge,...p};let g,O=!1,Y=[];function qe(){return new pe(fe,{oscillator:{type:"sine"},envelope:{attack:.02,release:1},volume:-24}).toDestination()}function Fe(e,t){const c=e.replace("♯","#").replace("♭","b");return re(c+t).toMidi()}function we(e,t){const c=Fe(e,t);return isNaN(c)?(console.error(`Could not parse tonic: ${e}${t}`),[]):[re(c,"midi").toNote()]}async function Le(){if(!O||!g)return;await z();const{isPlaying:e,octave:t,volume:c}=n.state.drone,{tonic:i}=n.state;if(g.volume.value=c,g.releaseAll(),e){const a=we(i,t);if(a.length===0){console.error("Aborting drone: Invalid notes calculated.");return}g.triggerAttack(a,Ae())}}function Se(){O||(g=qe(),Y.push(n.on("droneShouldUpdate",Le)),O=!0,console.log("AudioService Initialized."))}function Te(){Y.forEach(e=>e()),Y=[],g&&(g.releaseAll(),g.dispose(),g=void 0),O=!1}const y={FFT_SIZE:2048,CLARITY_THRESHOLD:.8,MIN_PITCH_HZ:60,MAX_PITCH_HZ:1600,STABILITY_THRESHOLD:15,HIGHLIGHT_FADE_SPEED:.2,MIN_VOLUME_DB:-60};let S,T,W,E=null,$=[],k=-1,w=0,ce=0,ie=1;function He(e){return 12*Math.log2(e/440)+69}function de(){if(!n.state.isDetecting||!T||!W){E=null;return}const e=T.getValue(),[t,c]=W.findPitch(e,xe.sampleRate);let i=t&&c>y.CLARITY_THRESHOLD&&t>y.MIN_PITCH_HZ&&t<y.MAX_PITCH_HZ;if(i){const d=He(t);n.setDetectedPitch({frequency:t,clarity:c,midi:d,pitchClass:Math.round(d)%12}),n.addPitchHistoryPoint({frequency:t,midi:d,time:performance.now(),clarity:c})}else n.addPitchHistoryPoint({frequency:0,midi:0,time:performance.now(),clarity:0});const a=i?Math.round(n.state.detectedPitch.midi)%12:-1;a===k&&a!==-1?w++:(w=0,k=a),ce=w>=y.STABILITY_THRESHOLD?1:0,ie=w>=y.STABILITY_THRESHOLD?1.05:1;const l=n.state.stablePitch,s=l.opacity+(ce-l.opacity)*y.HIGHLIGHT_FADE_SPEED,A=l.size+(ie-l.size)*y.HIGHLIGHT_FADE_SPEED;n.setStablePitch(k,s,A),E=requestAnimationFrame(de)}async function Ie(){E&&cancelAnimationFrame(E),S=new ve(y.MIN_VOLUME_DB),T=new Ne("waveform",y.FFT_SIZE),W=Ce.forFloat32Array(T.size);try{await S.open(),S.connect(T),de()}catch(e){console.error("Microphone access denied or failed.",e),n.toggleIsDetecting()}}function ue(){S&&S.close(),E&&(cancelAnimationFrame(E),E=null),w=0,k=-1,n.setStablePitch(-1,0,1)}function Me(){$.push(n.on("isDetectingChanged",e=>{e?Ie():ue()}))}function Pe(){$.forEach(e=>e()),$=[],ue()}let N,r,q,H=[];const C=200;function me(e){const t=e-60;return n.data.pitchData.find(c=>c.value===t)}function Re(e,t){var c;const i=me(e);if(!i)return"";const a=e%12,l=n.data.tonicToSemisFromC[t.tonic]||0,s=(c=n.data.majorScales[t.tonic])==null?void 0:c.includes(a);if(!s&&!t.showAccidentals)return"";if(t.useDegrees){const A=(a-l+12)%12;return s?{0:"1",1:"♭2",2:"2",3:"♭3",4:"3",5:"4",6:"♭5",7:"5",8:"♭6",9:"6",10:"♭7",11:"7"}[A]:{1:"#1/♭2",3:"#2/♭3",6:"#4/♭5",8:"#5/♭6",10:"#6/♭7"}[A]||""}else return i.pitch}function _e(e){switch(e){case 0:return{color:"#000000",width:2,dash:[]};case 2:case 6:case 8:case 10:return{color:"#A0A0A0",width:1,dash:[]};case 4:return{color:"#A0A0A0",width:1,dash:[5,5]};case 7:return"greyRect";default:return null}}function ke(e,t){if(t.maxMidi===t.minMidi)return N.height/2;const c=(e-t.minMidi)/(t.maxMidi-t.minMidi);return N.height-c*N.height}function _(){r.clearRect(0,0,N.width,N.height);const{yAxisRange:e,tonic:t,stablePitch:c}=n.state,{minMidi:i,maxMidi:a}=e,l=n.data.tonicToSemisFromC[t]||0,s=C*.75,A=C*.25,d={};for(let h=Math.floor(i)-1;h<=Math.ceil(a)+1;h++)d[h]={y:ke(h,e)};for(let h=Math.floor(i);h<=Math.ceil(a);h++){const v=(d[h-1].y-d[h+1].y)/2;d[h].cellTop=d[h].y-v,d[h].cellHeight=2*v}for(let h=Math.floor(i);h<=Math.ceil(a);h++){const v=d[h],m=(h%12-l+12)%12,x=_e(m);x==="greyRect"?(r.fillStyle="#E8E8E8",r.fillRect(0,v.cellTop,N.width,v.cellHeight)):x&&(r.strokeStyle=x.color,r.lineWidth=x.width,r.setLineDash(x.dash),r.beginPath(),r.moveTo(0,v.y),r.lineTo(N.width,v.y),r.stroke())}for(let h=Math.floor(i);h<=Math.ceil(a);h++){const v=me(h);if(!v)continue;const m=d[h],x=v.column==="A",D=Re(h,n.state),P=c.pitchClass===h%12;if(D){const b=x?s:A,G=N.width-b;r.fillStyle=v.hex,r.fillRect(b-C/4,m.cellTop,C/2,m.cellHeight),r.fillRect(G-C/4,m.cellTop,C/2,m.cellHeight),P&&c.opacity>.01&&(r.fillStyle=`rgba(255, 255, 0, ${c.opacity})`,r.fillRect(b-C/4,m.cellTop,C/2,m.cellHeight),r.fillRect(G-C/4,m.cellTop,C/2,m.cellHeight));const R=Math.max(8,Math.floor(m.cellHeight*.7));r.font=`${R}px "Atkinson Hyperlegible", sans-serif`,r.textAlign="center",r.textBaseline="middle",r.fillStyle="#000",r.fillText(D,b,m.y),r.fillText(D,G,m.y)}}}function Oe(){q=document.getElementById("plotContainer"),N=document.getElementById("plotCanvas"),r=N.getContext("2d"),H.push(n.on("settingsChanged",_)),H.push(n.on("stablePitchChanged",_));const e=()=>{N.width=q.clientWidth,N.height=q.clientHeight,_()};window.addEventListener("resize",e),H.push(()=>window.removeEventListener("resize",e)),N.width=q.clientWidth,N.height=q.clientHeight,_(),console.log("Staff Component Initialized.")}function Ue(){H.forEach(e=>e()),H=[]}const ze={timeWindow:4e3,proximityThreshold:35,maxConnections:3,pointRadius:9.5,lineWidth:2.5,lineColor:"rgba(0,0,0,0.4)",maxOpacity:.9,tonicPitchClass:0},Ye=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fcfcfc",isAccidental:!1,midi:108,pitchClass:0,octave:8},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fcf7fc",isAccidental:!1,midi:107,pitchClass:11,octave:7},{pitch:"B♭/A♯7",flatName:"B♭7",sharpName:"A♯7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f7f5fd",isAccidental:!0,midi:106,pitchClass:10,octave:7},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f0f4ff",isAccidental:!1,midi:105,pitchClass:9,octave:7},{pitch:"A♭/G♯7",flatName:"A♭7",sharpName:"G♯7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#e6f3fd",isAccidental:!0,midi:104,pitchClass:8,octave:7},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#def3f7",isAccidental:!1,midi:103,pitchClass:7,octave:7},{pitch:"G♭/F♯7",flatName:"G♭7",sharpName:"F♯7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#daf2ec",isAccidental:!0,midi:102,pitchClass:6,octave:7},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#dcefdf",isAccidental:!1,midi:101,pitchClass:5,octave:7},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#e3ebd1",isAccidental:!1,midi:100,pitchClass:4,octave:7},{pitch:"E♭/D♯7",flatName:"E♭7",sharpName:"D♯7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#eee4c8",isAccidental:!0,midi:99,pitchClass:3,octave:7},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#f8dcc6",isAccidental:!1,midi:98,pitchClass:2,octave:7},{pitch:"D♭/C♯7",flatName:"D♭7",sharpName:"C♯7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fcd4cd",isAccidental:!0,midi:97,pitchClass:1,octave:7},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#facfdb",isAccidental:!1,midi:96,pitchClass:0,octave:7},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#efcdeb",isAccidental:!1,midi:95,pitchClass:11,octave:6},{pitch:"B♭/A♯6",flatName:"B♭6",sharpName:"A♯6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#ddcff9",isAccidental:!0,midi:94,pitchClass:10,octave:6},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#c4d3ff",isAccidental:!1,midi:93,pitchClass:9,octave:6},{pitch:"A♭/G♯6",flatName:"A♭6",sharpName:"G♯6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#abd9fa",isAccidental:!0,midi:92,pitchClass:8,octave:6},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#98dde9",isAccidental:!1,midi:91,pitchClass:7,octave:6},{pitch:"G♭/F♯6",flatName:"G♭6",sharpName:"F♯6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#96ddcf",isAccidental:!0,midi:90,pitchClass:6,octave:6},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#a6d9b0",isAccidental:!1,midi:89,pitchClass:5,octave:6},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#c0d093",isAccidental:!1,midi:88,pitchClass:4,octave:6},{pitch:"E♭/D♯6",flatName:"E♭6",sharpName:"D♯6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#dbc383",isAccidental:!0,midi:87,pitchClass:3,octave:6},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#efb586",isAccidental:!1,midi:86,pitchClass:2,octave:6},{pitch:"D♭/C♯6",flatName:"D♭6",sharpName:"C♯6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#f8a99c",isAccidental:!0,midi:85,pitchClass:1,octave:6},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#f3a2bb",isAccidental:!1,midi:84,pitchClass:0,octave:6},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e1a3db",isAccidental:!1,midi:83,pitchClass:11,octave:5},{pitch:"B♭/A♯5",flatName:"B♭5",sharpName:"A♯5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#c3a9f4",isAccidental:!0,midi:82,pitchClass:10,octave:5},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#9ab2ff",isAccidental:!1,midi:81,pitchClass:9,octave:5},{pitch:"A♭/G♯5",flatName:"A♭5",sharpName:"G♯5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#67bdf7",isAccidental:!0,midi:80,pitchClass:8,octave:5},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#30c6dc",isAccidental:!1,midi:79,pitchClass:7,octave:5},{pitch:"G♭/F♯5",flatName:"G♭5",sharpName:"F♯5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#32c8b2",isAccidental:!0,midi:78,pitchClass:6,octave:5},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#6dc281",isAccidental:!1,midi:77,pitchClass:5,octave:5},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#a0b556",isAccidental:!1,midi:76,pitchClass:4,octave:5},{pitch:"E♭/D♯5",flatName:"E♭5",sharpName:"D♯5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#c5a33f",isAccidental:!0,midi:75,pitchClass:3,octave:5},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#dc9150",isAccidental:!1,midi:74,pitchClass:2,octave:5},{pitch:"D♭/C♯5",flatName:"D♭5",sharpName:"C♯5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#e38475",isAccidental:!0,midi:73,pitchClass:1,octave:5},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#dc7f9d",isAccidental:!1,midi:72,pitchClass:0,octave:5},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#c781c0",isAccidental:!1,midi:71,pitchClass:11,octave:4},{pitch:"B♭/A♯4",flatName:"B♭4",sharpName:"A♯4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#a68ad8",isAccidental:!0,midi:70,pitchClass:10,octave:4},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#7d94e0",isAccidental:!1,midi:69,pitchClass:9,octave:4},{pitch:"A♭/G♯4",flatName:"A♭4",sharpName:"G♯4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#4c9fd5",isAccidental:!0,midi:68,pitchClass:8,octave:4},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#0fa6ba",isAccidental:!1,midi:67,pitchClass:7,octave:4},{pitch:"G♭/F♯4",flatName:"G♭4",sharpName:"F♯4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#24a794",isAccidental:!0,midi:66,pitchClass:6,octave:4},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#5aa26a",isAccidental:!1,midi:65,pitchClass:5,octave:4},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#849646",isAccidental:!1,midi:64,pitchClass:4,octave:4},{pitch:"E♭/D♯4",flatName:"E♭4",sharpName:"D♯4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#a38733",isAccidental:!0,midi:63,pitchClass:3,octave:4},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#b67740",isAccidental:!1,midi:62,pitchClass:2,octave:4},{pitch:"D♭/C♯4",flatName:"D♭4",sharpName:"C♯4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#bc6c5f",isAccidental:!0,midi:61,pitchClass:1,octave:4},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#b56880",isAccidental:!1,midi:60,pitchClass:0,octave:4},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#a3699e",isAccidental:!1,midi:59,pitchClass:11,octave:3},{pitch:"B♭/A♯3",flatName:"B♭3",sharpName:"A♯3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#8870b1",isAccidental:!0,midi:58,pitchClass:10,octave:3},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#6578b7",isAccidental:!1,midi:57,pitchClass:9,octave:3},{pitch:"A♭/G♯3",flatName:"A♭3",sharpName:"G♯3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#3c81ad",isAccidental:!0,midi:56,pitchClass:8,octave:3},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#0e8696",isAccidental:!1,midi:55,pitchClass:7,octave:3},{pitch:"G♭/F♯3",flatName:"G♭3",sharpName:"F♯3",toneNote:"Gb3",frequency:185,column:"A",hex:"#1b8777",isAccidental:!0,midi:54,pitchClass:6,octave:3},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#478255",isAccidental:!1,midi:53,pitchClass:5,octave:3},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#697836",isAccidental:!1,midi:52,pitchClass:4,octave:3},{pitch:"E♭/D♯3",flatName:"E♭3",sharpName:"D♯3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#836b27",isAccidental:!0,midi:51,pitchClass:3,octave:3},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#925e32",isAccidental:!1,midi:50,pitchClass:2,octave:3},{pitch:"D♭/C♯3",flatName:"D♭3",sharpName:"C♯3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#96554b",isAccidental:!0,midi:49,pitchClass:1,octave:3},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#905165",isAccidental:!1,midi:48,pitchClass:0,octave:3},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#80527c",isAccidental:!1,midi:47,pitchClass:11,octave:2},{pitch:"B♭/A♯2",flatName:"B♭2",sharpName:"A♯2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#6a578c",isAccidental:!0,midi:46,pitchClass:10,octave:2},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#4e5e90",isAccidental:!1,midi:45,pitchClass:9,octave:2},{pitch:"A♭/G♯2",flatName:"A♭2",sharpName:"G♯2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#2d6488",isAccidental:!0,midi:44,pitchClass:8,octave:2},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#096875",isAccidental:!1,midi:43,pitchClass:7,octave:2},{pitch:"G♭/F♯2",flatName:"G♭2",sharpName:"F♯2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#13685b",isAccidental:!0,midi:42,pitchClass:6,octave:2},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#356440",isAccidental:!1,midi:41,pitchClass:5,octave:2},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#505c28",isAccidental:!1,midi:40,pitchClass:4,octave:2},{pitch:"E♭/D♯2",flatName:"E♭2",sharpName:"D♯2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#63511c",isAccidental:!0,midi:39,pitchClass:3,octave:2},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#6e4724",isAccidental:!1,midi:38,pitchClass:2,octave:2},{pitch:"D♭/C♯2",flatName:"D♭2",sharpName:"C♯2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#713f37",isAccidental:!0,midi:37,pitchClass:1,octave:2},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#6c3c4b",isAccidental:!1,midi:36,pitchClass:0,octave:2},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#603c5d",isAccidental:!1,midi:35,pitchClass:11,octave:1},{pitch:"B♭/A♯1",flatName:"B♭1",sharpName:"A♯1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#4e4068",isAccidental:!0,midi:34,pitchClass:10,octave:1},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#38446b",isAccidental:!1,midi:33,pitchClass:9,octave:1},{pitch:"A♭/G♯1",flatName:"A♭1",sharpName:"G♯1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#1f4964",isAccidental:!0,midi:32,pitchClass:8,octave:1},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#044b55",isAccidental:!1,midi:31,pitchClass:7,octave:1},{pitch:"G♭/F♯1",flatName:"G♭1",sharpName:"F♯1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#0c4b41",isAccidental:!0,midi:30,pitchClass:6,octave:1},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#24472c",isAccidental:!1,midi:29,pitchClass:5,octave:1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#38401a",isAccidental:!1,midi:28,pitchClass:4,octave:1},{pitch:"E♭/D♯1",flatName:"E♭1",sharpName:"D♯1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#463811",isAccidental:!0,midi:27,pitchClass:3,octave:1},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#4d3017",isAccidental:!1,midi:26,pitchClass:2,octave:1},{pitch:"D♭/C♯1",flatName:"D♭1",sharpName:"C♯1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#4f2a24",isAccidental:!0,midi:25,pitchClass:1,octave:1},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#4a2733",isAccidental:!1,midi:24,pitchClass:0,octave:1},{pitch:"B0",flatName:"B0",sharpName:"B0",toneNote:"B0",frequency:30.87,column:"B",hex:"#41273f",isAccidental:!1,midi:23,pitchClass:11,octave:0},{pitch:"B♭/A♯0",flatName:"B♭0",sharpName:"A♯0",toneNote:"Bb0",frequency:29.14,column:"A",hex:"#342a46",isAccidental:!0,midi:22,pitchClass:10,octave:0},{pitch:"A0",flatName:"A0",sharpName:"A0",toneNote:"A0",frequency:27.5,column:"B",hex:"#242c48",isAccidental:!1,midi:21,pitchClass:9,octave:0}],We=new Map,$e=new Map;Ye.forEach((e,t)=>{We.set(e.toneNote,t),e.midi!==void 0&&$e.set(e.midi,t)});const ae=["#ef8aab","#f48e7d","#e89955","#cdaa42","#a4ba57","#6ec482","#2dc8b1","#16c3da","#58b8f6","#8fa9ff","#ba9bf2","#db8fd4"];function ne(e){const t=parseInt(e.slice(1),16);return[t>>16&255,t>>8&255,t&255]}function Ve(e,t,c){const i=Math.max(0,Math.min(1,c));return e.map((a,l)=>Math.round(a+i*(t[l]-a)))}function Ze(e,t=0){const c=Math.floor(e),i=e-c,a=(c%12-t+12)%12,l=(a+1)%12,s=ne(ae[a]),A=ne(ae[l]);return Ve(s,A,i)}function je(e,t,c,i,a){const l=1-(t-e)/c;return i+l*a}function Xe(e,t,c,i){if(c===t)return i/2;const a=(e-t)/(c-t);return i-a*i}function oe(e,t,c){const i=t.plotAreaLeft??0,a=t.plotAreaRight??t.width,l=a-i;return e.filter(s=>s.midi>0).map(s=>({x:je(s.time,t.currentTime,c.timeWindow,i,l),y:Xe(s.midi,t.midiRange.minMidi,t.midiRange.maxMidi,t.height),clarity:s.clarity,color:Ze(s.midi,c.tonicPitchClass)})).filter(s=>s.x>=i&&s.x<=a)}function Je(e,t,c){const i=[];for(let a=0;a<e.length;a++){let l=0;for(let s=a+1;s<e.length&&l<c;s++){const A=e[a].x-e[s].x,d=e[a].y-e[s].y;Math.sqrt(A*A+d*d)<=t&&(i.push([a,s]),l++)}}return i}class Ke{constructor(t={}){ge(this,"config"),this.config={...ze,...t}}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t}}render(t,c,i){if(t.clearRect(0,0,i.width,i.height),c.length<1)return;const a=oe(c,i,this.config);a.length<1||(this.drawConnections(t,a),this.drawPoints(t,a))}transformPoints(t,c){return oe(t,c,this.config)}drawConnections(t,c){const i=Je(c,this.config.proximityThreshold,this.config.maxConnections);t.strokeStyle=this.config.lineColor,t.lineWidth=this.config.lineWidth,t.beginPath();for(const[a,l]of i)t.moveTo(c[a].x,c[a].y),t.lineTo(c[l].x,c[l].y);t.stroke()}drawPoints(t,c){for(const i of c){const a=Math.min(i.clarity*this.config.maxOpacity,1);t.fillStyle=`rgba(${i.color[0]}, ${i.color[1]}, ${i.color[2]}, ${a})`,t.beginPath(),t.arc(i.x,i.y,this.config.pointRadius,0,2*Math.PI),t.fill()}}}let B,V,F,I=[],M;const le=200,se=5;function U(){if(!V||!M)return;const e=n.state.pitchHistory,t=n.state.yAxisRange,c=n.data.tonicToSemisFromC[n.state.tonic]||0;M.updateConfig({tonicPitchClass:c});const i={width:B.width,height:B.height,plotAreaLeft:le+se,plotAreaRight:B.width-(le+se),midiRange:t,currentTime:performance.now()};M.render(V,e,i)}function Qe(){F=document.getElementById("plotContainer"),B=document.getElementById("noteCanvas"),V=B.getContext("2d"),M=new Ke,I.push(n.on("pitchHistoryChanged",U)),I.push(n.on("settingsChanged",U));const e=()=>{B.width=F.clientWidth,B.height=F.clientHeight,U()};window.addEventListener("resize",e),I.push(()=>window.removeEventListener("resize",e)),B.width=F.clientWidth,B.height=F.clientHeight}function et(){I.forEach(e=>e()),I=[],M=null}let f=[];function tt(e,t){e.querySelectorAll("button").forEach(c=>{const i=c.dataset.octave;i&&c.classList.toggle("active",i===t.toString())})}function ct(){const e=document.getElementById("startBtn"),t=document.getElementById("tonicSelect"),c=document.getElementById("labelToggle"),i=document.getElementById("accidentalsToggle"),a=document.getElementById("droneBtn"),l=document.getElementById("octaveToggles"),s=document.getElementById("volumeSlider"),A=document.getElementById("yAxisUpperExpandBtn"),d=document.getElementById("yAxisUpperContractBtn"),h=document.getElementById("yAxisLowerExpandBtn"),v=document.getElementById("yAxisLowerContractBtn"),m=async()=>{await z(),n.toggleIsDetecting()};e.addEventListener("click",m),f.push(()=>e.removeEventListener("click",m));const x=u=>{n.setTonic(u.target.value)};t.addEventListener("change",x),f.push(()=>t.removeEventListener("change",x));const D=u=>n.setUseDegrees(u.target.checked),P=u=>n.setShowAccidentals(u.target.checked);c.addEventListener("change",D),i.addEventListener("change",P),f.push(()=>c.removeEventListener("change",D)),f.push(()=>i.removeEventListener("change",P));const b=async()=>{await z(),n.toggleDrone()};a.addEventListener("click",b),f.push(()=>a.removeEventListener("click",b));const G=u=>{u.target.matches(".octaveBtn")&&n.setDroneOctave(parseInt(u.target.dataset.octave,10))};l.addEventListener("click",G),f.push(()=>l.removeEventListener("click",G));const R=u=>{n.setDroneVolume(parseInt(u.target.value,10))};s.addEventListener("input",R),f.push(()=>s.removeEventListener("input",R));const K=()=>n.setYAxisRange("expand","upper"),Q=()=>n.setYAxisRange("contract","upper"),ee=()=>n.setYAxisRange("expand","lower"),te=()=>n.setYAxisRange("contract","lower");A.addEventListener("click",K),d.addEventListener("click",Q),h.addEventListener("click",ee),v.addEventListener("click",te),f.push(()=>A.removeEventListener("click",K)),f.push(()=>d.removeEventListener("click",Q)),f.push(()=>h.removeEventListener("click",ee)),f.push(()=>v.removeEventListener("click",te)),f.push(n.on("isDetectingChanged",u=>{e.textContent=u?"Stop":"Start",e.classList.toggle("active",u)})),f.push(n.on("droneStateChanged",u=>{a.classList.toggle("active",u.isPlaying)})),f.push(n.on("droneOctaveChanged",u=>{tt(l,u)})),console.log("ControlPanel Initialized.")}function it(){f.forEach(e=>e()),f=[]}let L,Z,j,X,J=[];function at(e){if(e.clarity>.95){L.classList.add("confident"),L.classList.remove("vague"),Z.textContent=Math.round(e.frequency);const t=n.data.noteStrings[e.pitchClass],c=Math.floor(e.midi/12)-1;j.textContent=t,X.textContent=c}else L.classList.add("vague"),L.classList.remove("confident"),Z.textContent="--",j.textContent="--",X.textContent="-"}function nt(){L=document.getElementById("detector"),Z=document.getElementById("pitch"),j=document.getElementById("note"),X=document.getElementById("octave"),J.push(n.on("pitchChanged",at)),console.log("PitchReadout Initialized.")}function ot(){J.forEach(e=>e()),J=[]}function lt(e){return e.innerHTML=be,Oe(),Qe(),ct(),nt(),Se(),Me(),{destroy:()=>{Pe(),Te(),ot(),it(),et(),Ue(),e.innerHTML=""}}}const st=lt,he=document.getElementById("app");he&&st(he);
