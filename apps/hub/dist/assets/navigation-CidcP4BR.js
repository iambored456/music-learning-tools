import{I as U,P as ut,Q as q,R as mt,S as H,T as z,U as ft,V as pt,j as Nt,E as At,W as xt,X as yt,L as Ct,K as T,Y as gt,Z as et,_ as w,a0 as bt,u as F,a1 as V,a2 as vt,g as _,a3 as St,a4 as at,a5 as Mt,a6 as Bt,a7 as Et,a8 as It,q as wt,k as _t,a9 as Tt,aa as Dt,ab as Gt,ac as qt,ad as nt,ae as Rt,af as Ft,ag as Pt,ah as Ot,ai as st}from"./legacy-CpVVXpx-.js";class kt{anchor;#e=new Map;#a=new Map;#t=new Map;#n=new Set;#s=!0;constructor(e,n=!0){this.anchor=e,this.#s=n}#i=()=>{var e=U;if(this.#e.has(e)){var n=this.#e.get(e),o=this.#a.get(n);if(o)ut(o),this.#n.delete(n);else{var c=this.#t.get(n);c&&(this.#a.set(n,c.effect),this.#t.delete(n),c.fragment.lastChild.remove(),this.anchor.before(c.fragment),o=c.effect)}for(const[i,a]of this.#e){if(this.#e.delete(i),i===e)break;const s=this.#t.get(a);s&&(q(s.effect),this.#t.delete(a))}for(const[i,a]of this.#a){if(i===n||this.#n.has(i))continue;const s=()=>{if(Array.from(this.#e.values()).includes(i)){var d=document.createDocumentFragment();ft(a,d),d.append(H()),this.#t.set(i,{effect:a,fragment:d})}else q(a);this.#n.delete(i),this.#a.delete(i)};this.#s||!o?(this.#n.add(i),mt(a,s,!1)):s()}}};#o=e=>{this.#e.delete(e);const n=Array.from(this.#e.values());for(const[o,c]of this.#t)n.includes(o)||(q(c.effect),this.#t.delete(o))};ensure(e,n){var o=U,c=pt();if(n&&!this.#a.has(e)&&!this.#t.has(e))if(c){var i=document.createDocumentFragment(),a=H();i.append(a),this.#t.set(e,{effect:z(()=>n(a)),fragment:i})}else this.#a.set(e,z(()=>n(this.anchor)));if(this.#e.set(o,e),c){for(const[s,l]of this.#a)s===e?o.skipped_effects.delete(l):o.skipped_effects.add(l);for(const[s,l]of this.#t)s===e?o.skipped_effects.delete(l.effect):o.skipped_effects.add(l.effect);o.oncommit(this.#i),o.ondiscard(this.#o)}else this.#i()}}function he(t,e,n=!1){var o=new kt(t),c=n?At:0;function i(a,s){o.ensure(a,s)}Nt(()=>{var a=!1;e((s,l=!0)=>{a=!0,i(l,s)}),a||i(!1,null)},c)}function de(t,e,n,o,c,i){var a=t.__className;if(a!==n||a===void 0){var s=xt(n,o,i);s==null?t.removeAttribute("class"):t.className=s,t.__className=n}else if(i&&c!==i)for(var l in i){var d=!!i[l];(c==null||d!==!!c[l])&&t.classList.toggle(l,d)}return i}function j(t,e){return t===e||t?.[et]===e}function ue(t={},e,n,o){return yt(()=>{var c,i;return Ct(()=>{c=i,i=[],T(()=>{t!==n(...i)&&(e(t,...i),c&&j(n(...c),t)&&e(null,...c))})}),()=>{gt(()=>{i&&j(n(...i),t)&&e(null,...i)})}}),t}function me(t=!1){const e=w,n=e.l.u;if(!n)return;let o=()=>St(e.s);if(t){let c=0,i={};const a=at(()=>{let s=!1;const l=e.s;for(const d in l)l[d]!==i[d]&&(i[d]=l[d],s=!0);return s&&c++,c});o=()=>_(a)}n.b.length&&bt(()=>{Y(e,o),V(n.b)}),F(()=>{const c=T(()=>n.m.map(vt));return()=>{for(const i of c)typeof i=="function"&&i()}}),n.a.length&&F(()=>{Y(e,o),V(n.a)})}function Y(t,e){if(t.l.s)for(const n of t.l.s)_(n);e()}let D=!1;function Lt(t){var e=D;try{return D=!1,[t(),D]}finally{D=e}}function fe(t,e,n,o){var c=!nt||(n&Rt)!==0,i=(n&qt)!==0,a=(n&Pt)!==0,s=o,l=!0,d=()=>(l&&(l=!1,s=a?T(o):o),s),u;if(i){var m=et in t||Ot in t;u=Mt(t,e)?.set??(m&&e in t?r=>t[e]=r:void 0)}var p,A=!1;i?[p,A]=Lt(()=>t[e]):p=t[e],p===void 0&&o!==void 0&&(p=d(),u&&(c&&Bt(),u(p)));var f;if(c?f=()=>{var r=t[e];return r===void 0?d():(l=!0,r)}:f=()=>{var r=t[e];return r!==void 0&&(s=void 0),r===void 0?s:r},c&&(n&Et)===0)return f;if(u){var N=t.$$legacy;return(function(r,h){return arguments.length>0?((!c||!h||N||A)&&u(h?f():r),r):f()})}var x=!1,g=((n&Ft)!==0?at:It)(()=>(x=!1,f()));i&&_(g);var C=Dt;return(function(r,h){if(arguments.length>0){const y=h?_(g):c&&i?wt(r):r;return _t(g,y),x=!0,s!==void 0&&(s=y),r}return Tt&&x||(C.f&Gt)!==0?g.v:_(g)})}function $t(t){w===null&&st(),nt&&w.l!==null?Ut(w).m.push(t):F(()=>{const e=T(t);if(typeof e=="function")return e})}function pe(t){w===null&&st(),$t(()=>()=>T(t))}function Ut(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}const it=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fcfcfc",isAccidental:!1,midi:108,pitchClass:0,octave:8},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fcf7fc",isAccidental:!1,midi:107,pitchClass:11,octave:7},{pitch:"B♭/A♯7",flatName:"B♭7",sharpName:"A♯7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f7f5fd",isAccidental:!0,midi:106,pitchClass:10,octave:7},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f0f4ff",isAccidental:!1,midi:105,pitchClass:9,octave:7},{pitch:"A♭/G♯7",flatName:"A♭7",sharpName:"G♯7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#e6f3fd",isAccidental:!0,midi:104,pitchClass:8,octave:7},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#def3f7",isAccidental:!1,midi:103,pitchClass:7,octave:7},{pitch:"G♭/F♯7",flatName:"G♭7",sharpName:"F♯7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#daf2ec",isAccidental:!0,midi:102,pitchClass:6,octave:7},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#dcefdf",isAccidental:!1,midi:101,pitchClass:5,octave:7},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#e3ebd1",isAccidental:!1,midi:100,pitchClass:4,octave:7},{pitch:"E♭/D♯7",flatName:"E♭7",sharpName:"D♯7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#eee4c8",isAccidental:!0,midi:99,pitchClass:3,octave:7},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#f8dcc6",isAccidental:!1,midi:98,pitchClass:2,octave:7},{pitch:"D♭/C♯7",flatName:"D♭7",sharpName:"C♯7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fcd4cd",isAccidental:!0,midi:97,pitchClass:1,octave:7},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#facfdb",isAccidental:!1,midi:96,pitchClass:0,octave:7},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#efcdeb",isAccidental:!1,midi:95,pitchClass:11,octave:6},{pitch:"B♭/A♯6",flatName:"B♭6",sharpName:"A♯6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#ddcff9",isAccidental:!0,midi:94,pitchClass:10,octave:6},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#c4d3ff",isAccidental:!1,midi:93,pitchClass:9,octave:6},{pitch:"A♭/G♯6",flatName:"A♭6",sharpName:"G♯6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#abd9fa",isAccidental:!0,midi:92,pitchClass:8,octave:6},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#98dde9",isAccidental:!1,midi:91,pitchClass:7,octave:6},{pitch:"G♭/F♯6",flatName:"G♭6",sharpName:"F♯6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#96ddcf",isAccidental:!0,midi:90,pitchClass:6,octave:6},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#a6d9b0",isAccidental:!1,midi:89,pitchClass:5,octave:6},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#c0d093",isAccidental:!1,midi:88,pitchClass:4,octave:6},{pitch:"E♭/D♯6",flatName:"E♭6",sharpName:"D♯6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#dbc383",isAccidental:!0,midi:87,pitchClass:3,octave:6},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#efb586",isAccidental:!1,midi:86,pitchClass:2,octave:6},{pitch:"D♭/C♯6",flatName:"D♭6",sharpName:"C♯6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#f8a99c",isAccidental:!0,midi:85,pitchClass:1,octave:6},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#f3a2bb",isAccidental:!1,midi:84,pitchClass:0,octave:6},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e1a3db",isAccidental:!1,midi:83,pitchClass:11,octave:5},{pitch:"B♭/A♯5",flatName:"B♭5",sharpName:"A♯5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#c3a9f4",isAccidental:!0,midi:82,pitchClass:10,octave:5},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#9ab2ff",isAccidental:!1,midi:81,pitchClass:9,octave:5},{pitch:"A♭/G♯5",flatName:"A♭5",sharpName:"G♯5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#67bdf7",isAccidental:!0,midi:80,pitchClass:8,octave:5},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#30c6dc",isAccidental:!1,midi:79,pitchClass:7,octave:5},{pitch:"G♭/F♯5",flatName:"G♭5",sharpName:"F♯5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#32c8b2",isAccidental:!0,midi:78,pitchClass:6,octave:5},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#6dc281",isAccidental:!1,midi:77,pitchClass:5,octave:5},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#a0b556",isAccidental:!1,midi:76,pitchClass:4,octave:5},{pitch:"E♭/D♯5",flatName:"E♭5",sharpName:"D♯5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#c5a33f",isAccidental:!0,midi:75,pitchClass:3,octave:5},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#dc9150",isAccidental:!1,midi:74,pitchClass:2,octave:5},{pitch:"D♭/C♯5",flatName:"D♭5",sharpName:"C♯5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#e38475",isAccidental:!0,midi:73,pitchClass:1,octave:5},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#dc7f9d",isAccidental:!1,midi:72,pitchClass:0,octave:5},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#c781c0",isAccidental:!1,midi:71,pitchClass:11,octave:4},{pitch:"B♭/A♯4",flatName:"B♭4",sharpName:"A♯4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#a68ad8",isAccidental:!0,midi:70,pitchClass:10,octave:4},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#7d94e0",isAccidental:!1,midi:69,pitchClass:9,octave:4},{pitch:"A♭/G♯4",flatName:"A♭4",sharpName:"G♯4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#4c9fd5",isAccidental:!0,midi:68,pitchClass:8,octave:4},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#0fa6ba",isAccidental:!1,midi:67,pitchClass:7,octave:4},{pitch:"G♭/F♯4",flatName:"G♭4",sharpName:"F♯4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#24a794",isAccidental:!0,midi:66,pitchClass:6,octave:4},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#5aa26a",isAccidental:!1,midi:65,pitchClass:5,octave:4},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#849646",isAccidental:!1,midi:64,pitchClass:4,octave:4},{pitch:"E♭/D♯4",flatName:"E♭4",sharpName:"D♯4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#a38733",isAccidental:!0,midi:63,pitchClass:3,octave:4},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#b67740",isAccidental:!1,midi:62,pitchClass:2,octave:4},{pitch:"D♭/C♯4",flatName:"D♭4",sharpName:"C♯4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#bc6c5f",isAccidental:!0,midi:61,pitchClass:1,octave:4},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#b56880",isAccidental:!1,midi:60,pitchClass:0,octave:4},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#a3699e",isAccidental:!1,midi:59,pitchClass:11,octave:3},{pitch:"B♭/A♯3",flatName:"B♭3",sharpName:"A♯3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#8870b1",isAccidental:!0,midi:58,pitchClass:10,octave:3},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#6578b7",isAccidental:!1,midi:57,pitchClass:9,octave:3},{pitch:"A♭/G♯3",flatName:"A♭3",sharpName:"G♯3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#3c81ad",isAccidental:!0,midi:56,pitchClass:8,octave:3},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#0e8696",isAccidental:!1,midi:55,pitchClass:7,octave:3},{pitch:"G♭/F♯3",flatName:"G♭3",sharpName:"F♯3",toneNote:"Gb3",frequency:185,column:"A",hex:"#1b8777",isAccidental:!0,midi:54,pitchClass:6,octave:3},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#478255",isAccidental:!1,midi:53,pitchClass:5,octave:3},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#697836",isAccidental:!1,midi:52,pitchClass:4,octave:3},{pitch:"E♭/D♯3",flatName:"E♭3",sharpName:"D♯3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#836b27",isAccidental:!0,midi:51,pitchClass:3,octave:3},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#925e32",isAccidental:!1,midi:50,pitchClass:2,octave:3},{pitch:"D♭/C♯3",flatName:"D♭3",sharpName:"C♯3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#96554b",isAccidental:!0,midi:49,pitchClass:1,octave:3},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#905165",isAccidental:!1,midi:48,pitchClass:0,octave:3},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#80527c",isAccidental:!1,midi:47,pitchClass:11,octave:2},{pitch:"B♭/A♯2",flatName:"B♭2",sharpName:"A♯2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#6a578c",isAccidental:!0,midi:46,pitchClass:10,octave:2},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#4e5e90",isAccidental:!1,midi:45,pitchClass:9,octave:2},{pitch:"A♭/G♯2",flatName:"A♭2",sharpName:"G♯2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#2d6488",isAccidental:!0,midi:44,pitchClass:8,octave:2},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#096875",isAccidental:!1,midi:43,pitchClass:7,octave:2},{pitch:"G♭/F♯2",flatName:"G♭2",sharpName:"F♯2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#13685b",isAccidental:!0,midi:42,pitchClass:6,octave:2},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#356440",isAccidental:!1,midi:41,pitchClass:5,octave:2},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#505c28",isAccidental:!1,midi:40,pitchClass:4,octave:2},{pitch:"E♭/D♯2",flatName:"E♭2",sharpName:"D♯2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#63511c",isAccidental:!0,midi:39,pitchClass:3,octave:2},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#6e4724",isAccidental:!1,midi:38,pitchClass:2,octave:2},{pitch:"D♭/C♯2",flatName:"D♭2",sharpName:"C♯2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#713f37",isAccidental:!0,midi:37,pitchClass:1,octave:2},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#6c3c4b",isAccidental:!1,midi:36,pitchClass:0,octave:2},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#603c5d",isAccidental:!1,midi:35,pitchClass:11,octave:1},{pitch:"B♭/A♯1",flatName:"B♭1",sharpName:"A♯1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#4e4068",isAccidental:!0,midi:34,pitchClass:10,octave:1},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#38446b",isAccidental:!1,midi:33,pitchClass:9,octave:1},{pitch:"A♭/G♯1",flatName:"A♭1",sharpName:"G♯1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#1f4964",isAccidental:!0,midi:32,pitchClass:8,octave:1},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#044b55",isAccidental:!1,midi:31,pitchClass:7,octave:1},{pitch:"G♭/F♯1",flatName:"G♭1",sharpName:"F♯1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#0c4b41",isAccidental:!0,midi:30,pitchClass:6,octave:1},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#24472c",isAccidental:!1,midi:29,pitchClass:5,octave:1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#38401a",isAccidental:!1,midi:28,pitchClass:4,octave:1},{pitch:"E♭/D♯1",flatName:"E♭1",sharpName:"D♯1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#463811",isAccidental:!0,midi:27,pitchClass:3,octave:1},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#4d3017",isAccidental:!1,midi:26,pitchClass:2,octave:1},{pitch:"D♭/C♯1",flatName:"D♭1",sharpName:"C♯1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#4f2a24",isAccidental:!0,midi:25,pitchClass:1,octave:1},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#4a2733",isAccidental:!1,midi:24,pitchClass:0,octave:1},{pitch:"B0",flatName:"B0",sharpName:"B0",toneNote:"B0",frequency:30.87,column:"B",hex:"#41273f",isAccidental:!1,midi:23,pitchClass:11,octave:0},{pitch:"B♭/A♯0",flatName:"B♭0",sharpName:"A♯0",toneNote:"Bb0",frequency:29.14,column:"A",hex:"#342a46",isAccidental:!0,midi:22,pitchClass:10,octave:0},{pitch:"A0",flatName:"A0",sharpName:"A0",toneNote:"A0",frequency:27.5,column:"B",hex:"#242c48",isAccidental:!1,midi:21,pitchClass:9,octave:0}],ot=new Map,ct=new Map;it.forEach((t,e)=>{ot.set(t.toneNote,e),t.midi!==void 0&&ct.set(t.midi,e)});function W(t){return ot.get(t)??-1}function Ht(t){const e=ct.get(t);return e!==void 0?it[e]:void 0}function Ne(t,e){const n=W(t),o=W(e);return n===-1||o===-1?null:{topIndex:Math.min(n,o),bottomIndex:Math.max(n,o)}}function Ae(t,e){const n=[];for(let o=e;o>=t;o--){const c=Ht(o);c&&n.push(c)}return n}const Z={COMPRESSION_2_3:2/3,EXPANSION_3_2:3/2};function zt(t,e,n=null,o=null,c=null){return{id:`mod_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,measureIndex:t,ratio:e,active:!0,xPosition:n,columnIndex:o,macrobeatIndex:c}}const X=new Array(19).fill(2),Vt=["anacrusis","anacrusis","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid"],J=new Array(16).fill(2),jt=["dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed"];function K(t,e){const n=e(t),o=new Map;n.entries.forEach(c=>{c.type==="tonic"&&c.tonicSignUuid&&typeof c.canvasIndex=="number"&&o.set(c.tonicSignUuid,c.canvasIndex)}),Object.entries(t.tonicSignGroups||{}).forEach(([c,i])=>{const a=o.get(c);a!==void 0&&i.forEach(s=>{s.columnIndex=a})})}const Yt={entries:[],visualToCanvas:new Map,visualToTime:new Map,canvasToVisual:new Map,canvasToTime:new Map,timeToCanvas:new Map,timeToVisual:new Map,macrobeatBoundaries:[],totalVisualColumns:0,totalCanvasColumns:0,totalTimeColumns:0,totalWidthUnmodulated:0};function xe(t={}){const{getColumnMap:e=()=>Yt,visualToTimeIndex:n=()=>null,timeIndexToVisualColumn:o=()=>null,getTimeBoundaryAfterMacrobeat:c=()=>0,log:i=()=>{}}=t;return{setAnacrusis(a){if(this.state.hasAnacrusis===a)return;const s=[...this.state.macrobeatGroupings],l=[...this.state.macrobeatBoundaryStyles],d=s.reduce((f,N)=>f+N,0);let u,m;if(a){const f=this._anacrusisCache,N=X.length-J.length,x=X.slice(0,N),g=Vt.slice(0,N),C=f?.groupings?.length?[...f.groupings]:[...x],r=f?.boundaryStyles?.length?[...f.boundaryStyles]:[...g];if(u=[...C,...s],m=[...r,...l],!f?.boundaryStyles?.length)for(let h=0;h<r.length;h++)m[h]=h<r.length-1?"anacrusis":"solid";this._anacrusisCache=null,i("debug","rhythmActions","Enabled anacrusis",{insertedCount:C.length,insertedColumns:C.reduce((h,y)=>h+y,0)},"state")}else{const f=l.findIndex(C=>C==="solid");let N=0;if(f!==-1)N=f+1;else for(;N<l.length&&l[N]==="anacrusis";)N++;N=Math.min(N,s.length);const x=s.slice(0,N),g=l.slice(0,N);N>0?this._anacrusisCache={groupings:x,boundaryStyles:g}:this._anacrusisCache=null,u=s.slice(N),m=l.slice(N).map(C=>C==="anacrusis"?"dashed":C),u.length===0&&(u=[...J],m=[...jt]),i("debug","rhythmActions","Disabled anacrusis",{removalCount:N,removedColumns:x.reduce((C,r)=>C+r,0)},"state")}const A=u.reduce((f,N)=>f+N,0)-d;if(this.state.hasAnacrusis=a,this.state.macrobeatGroupings=[...u],this.state.macrobeatBoundaryStyles=[...m],K(this.state,e),A!==0){const f=[];this.state.placedNotes.forEach(r=>{const h=n(this.state,r.startColumnIndex,s),y=n(this.state,r.endColumnIndex,s);if(h===null||y===null)return;const b=h+A,E=y+A;if(b<0){f.push(r);return}const M=o(this.state,b,u),B=o(this.state,E,u);if(M===null||B===null){f.push(r);return}r.startColumnIndex=M,r.endColumnIndex=B}),f.forEach(r=>{const h=this.state.placedNotes.indexOf(r);h>-1&&this.state.placedNotes.splice(h,1)});const N=[];this.state.sixteenthStampPlacements.forEach(r=>{const h=n(this.state,r.startColumn,s),y=n(this.state,r.endColumn,s);if(h===null||y===null)return;const b=h+A,E=y+A;if(b<0){N.push(r);return}const M=o(this.state,b,u),B=o(this.state,E,u);if(M===null||B===null){N.push(r);return}r.startColumn=M,r.endColumn=B}),N.forEach(r=>{const h=this.state.sixteenthStampPlacements.indexOf(r);h>-1&&this.state.sixteenthStampPlacements.splice(h,1)});const x=[];this.state.tripletStampPlacements&&(this.state.tripletStampPlacements.forEach(r=>{const h=r.startTimeIndex+A;h<0?x.push(r):r.startTimeIndex=h}),x.forEach(r=>{const h=this.state.tripletStampPlacements.indexOf(r);h>-1&&this.state.tripletStampPlacements.splice(h,1)}));const g=[],C=a?u.length-s.length:-(s.length-u.length);this.state.tempoModulationMarkers.forEach(r=>{const h=r.measureIndex+C;if(h<0){g.push(r);return}r.measureIndex=h,r.columnIndex=null,r.xPosition=null,r.macrobeatIndex=null}),g.forEach(r=>{const h=this.state.tempoModulationMarkers.indexOf(r);h>-1&&this.state.tempoModulationMarkers.splice(h,1)})}this.emit("anacrusisChanged",a),this.emit("notesChanged"),this.emit("sixteenthStampPlacementsChanged"),this.emit("tripletStampPlacementsChanged"),this.emit("tempoModulationMarkersChanged"),this.emit("rhythmStructureChanged"),this.recordState()},toggleMacrobeatGrouping(a){if(a===void 0||a<0||a>=this.state.macrobeatGroupings.length){i("error","rhythmActions",`Invalid index for toggleMacrobeatGrouping: ${a}`,null,"state");return}const s=[...this.state.macrobeatGroupings],l=s[a],d=l===2?3:2,u=d-l,m=[...s];m[a]=d;const p=c(this.state,a,s),A=[];this.state.placedNotes.forEach(f=>{const N=n(this.state,f.startColumnIndex,s),x=n(this.state,f.endColumnIndex,s);if(!(N===null||x===null)&&N>=p){const g=N+u,C=x+u,r=o(this.state,g,m),h=o(this.state,C,m);r!==null&&h!==null?(f.startColumnIndex=r,f.endColumnIndex=h):A.push(f)}}),A.length&&A.forEach(f=>{const N=this.state.placedNotes.indexOf(f);N>-1&&this.state.placedNotes.splice(N,1)}),this.state.macrobeatGroupings=m,K(this.state,e),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},cycleMacrobeatBoundaryStyle(a){if(a===void 0||a<0||a>=this.state.macrobeatBoundaryStyles.length){i("error","rhythmActions",`Invalid index for cycleMacrobeatBoundaryStyle: ${a}`,null,"state");return}const s=this._isBoundaryInAnacrusis(a);let l;s?l=["dashed","solid","anacrusis"]:l=["dashed","solid"];const d=this.state.macrobeatBoundaryStyles[a]??"dashed",u=l.indexOf(d),m=u===-1?0:(u+1)%l.length,p=l[m]??"dashed";this.state.macrobeatBoundaryStyles[a]=p,this.emit("rhythmStructureChanged"),this.recordState()},_isBoundaryInAnacrusis(a){if(!this.state.hasAnacrusis)return!1;for(let s=0;s<=a;s++)if(this.state.macrobeatBoundaryStyles[s]==="solid")return s===a;return!0},increaseMacrobeatCount(){this.state.macrobeatGroupings.push(2),this.state.macrobeatBoundaryStyles.push("dashed"),this.emit("rhythmStructureChanged"),this.recordState()},decreaseMacrobeatCount(){if(this.state.macrobeatGroupings.length>1){const a=this.state.macrobeatGroupings.length-1,s=c(this.state,a-1,this.state.macrobeatGroupings),l=[];this.state.placedNotes.forEach(m=>{const p=n(this.state,m.startColumnIndex,this.state.macrobeatGroupings);p!==null&&p>=s&&l.push(m)}),l.forEach(m=>{const p=this.state.placedNotes.indexOf(m);p>-1&&this.state.placedNotes.splice(p,1)});const d=[];this.state.sixteenthStampPlacements.forEach(m=>{const p=n(this.state,m.startColumn,this.state.macrobeatGroupings);p!==null&&p>=s&&d.push(m)}),d.forEach(m=>{const p=this.state.sixteenthStampPlacements.indexOf(m);p>-1&&this.state.sixteenthStampPlacements.splice(p,1)});const u=[];this.state.tripletStampPlacements&&(this.state.tripletStampPlacements.forEach(m=>{m.startTimeIndex>=s&&u.push(m)}),u.forEach(m=>{const p=this.state.tripletStampPlacements.indexOf(m);p>-1&&this.state.tripletStampPlacements.splice(p,1)})),this.state.macrobeatGroupings.pop(),this.state.macrobeatBoundaryStyles.pop(),l.length>0&&this.emit("notesChanged"),d.length>0&&this.emit("sixteenthStampPlacementsChanged"),u.length>0&&this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),this.recordState()}},updateTimeSignature(a,s){if(!Array.isArray(s)||s.length===0){i("error","rhythmActions","Invalid groupings provided to updateTimeSignature",null,"state");return}let l=0,d=0,u=0;for(let r=0;r<this.state.macrobeatGroupings.length;r++){if(u===a){l=r;break}const h=r===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[r]==="solid"||h)&&u++}u=0;for(let r=0;r<this.state.macrobeatGroupings.length;r++)if(u===a){const h=r===this.state.macrobeatGroupings.length-1;if(this.state.macrobeatBoundaryStyles[r]==="solid"||h){d=r;break}}else if(u<a){const h=r===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[r]==="solid"||h)&&u++}const m=d-l+1,p=s.length,A=this.state.macrobeatGroupings.slice(l,d+1).reduce((r,h)=>r+h,0),N=s.reduce((r,h)=>r+h,0)-A,x=c(this.state,d,this.state.macrobeatGroupings);if(N!==0){const r=(()=>{const y=[...this.state.macrobeatGroupings];return y.splice(l,m,...s),y})(),h=[];this.state.placedNotes.forEach(y=>{const b=n(this.state,y.startColumnIndex,this.state.macrobeatGroupings),E=n(this.state,y.endColumnIndex,this.state.macrobeatGroupings);if(!(b===null||E===null)&&b>=x){const M=b+N,B=E+N,L=o(this.state,M,r),$=o(this.state,B,r);L!==null&&$!==null?(y.startColumnIndex=L,y.endColumnIndex=$):h.push(y)}}),h.length&&h.forEach(y=>{const b=this.state.placedNotes.indexOf(y);b>-1&&this.state.placedNotes.splice(b,1)})}const g=[...s],C=new Array(Math.max(p-1,0)).fill("dashed");if(d<this.state.macrobeatBoundaryStyles.length){const r=this.state.macrobeatBoundaryStyles[d]??"dashed";C.push(r)}this.state.macrobeatGroupings.splice(l,m,...g),this.state.macrobeatBoundaryStyles.splice(l,m-1,...C),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},addModulationMarker(a,s,l=null,d=null,u=null){if(!Object.values(Z).includes(s))return i("error","rhythmActions",`Invalid modulation ratio: ${s}`,null,"state"),null;const m=this.state.tempoModulationMarkers.findIndex(A=>A.measureIndex===a||u!==null&&A.macrobeatIndex===u||d!==null&&A.columnIndex===d);if(m!==-1){const A=this.state.tempoModulationMarkers[m];return i("info","rhythmActions",`Replacing existing modulation marker ${A.id} at measure ${a} (old ratio: ${A.ratio}, new ratio: ${s})`,null,"state"),A.ratio=s,A.xPosition=l,d!==null&&(A.columnIndex=d),u!==null&&(A.macrobeatIndex=u),this.emit("tempoModulationMarkersChanged"),this.recordState(),A.id}const p=zt(a,s,l,d,u);return this.state.tempoModulationMarkers.push(p),this.state.tempoModulationMarkers.sort((A,f)=>A.measureIndex-f.measureIndex),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Added modulation marker ${p.id} at measure ${a} with ratio=${s}, columnIndex=${d}`,null,"state"),p.id},removeModulationMarker(a){const s=this.state.tempoModulationMarkers.findIndex(l=>l.id===a);if(s===-1){i("warn","rhythmActions",`Modulation marker not found: ${a}`,null,"state");return}this.state.tempoModulationMarkers.splice(s,1),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Removed modulation marker ${a}`,null,"state")},setModulationRatio(a,s){if(!Object.values(Z).includes(s)){i("error","rhythmActions",`Invalid modulation ratio: ${s}`,null,"state");return}const l=this.state.tempoModulationMarkers.find(d=>d.id===a);if(!l){i("warn","rhythmActions",`Modulation marker not found: ${a}`,null,"state");return}l.ratio=s,this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Updated modulation marker ${a} ratio to ${s}`,null,"state")},moveModulationMarker(a,s){const l=this.state.tempoModulationMarkers.find(d=>d.id===a);if(!l){i("warn","rhythmActions",`Modulation marker not found: ${a}`,null,"state");return}l.measureIndex=s,this.state.tempoModulationMarkers.sort((d,u)=>d.measureIndex-u.measureIndex),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Moved modulation marker ${a} to measure ${s}`,null,"state")},toggleModulationMarker(a){const s=this.state.tempoModulationMarkers.find(l=>l.id===a);if(!s){i("warn","rhythmActions",`Modulation marker not found: ${a}`,null,"state");return}s.active=!s.active,this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Toggled modulation marker ${a} active state to ${s.active}`,null,"state")},clearModulationMarkers(){const a=this.state.tempoModulationMarkers.length;this.state.tempoModulationMarkers=[],this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Cleared ${a} modulation markers`,null,"state")}}}const I=9,Wt=2,Zt=5;function v(t,e,n){return Number.isFinite(t)?Math.max(e,Math.min(n,Math.round(t))):e}function Xt(t){return Number.isFinite(t)?Math.max(1,t):1}function ye(t,e,{maxStep:n=Zt}={}){const o=Math.max(1,Math.round(e)),i=Math.max(1,Math.round(t))/o;let a=1;i>=.85?a=5:i>=.65?a=4:i>=.45?a=3:i>=.25?a=2:a=1;const s=Math.max(1,Math.round(n));return Math.max(1,Math.min(s,a))}function rt(t,e,n){const o=Math.max(0,n-1),c=Math.max(1,Math.round(e)),i=(c-1)/2;let a=Math.round(t-i),s=a+c-1;if(a<0&&(s+=-a,a=0),s>o){const l=s-o;a-=l,s=o}return a=v(a,0,o),s=v(s,a,o),{topIndex:a,bottomIndex:s}}function P(t){return t.bottomIndex-t.topIndex+1}function lt(t,e){const n=Math.max(0,e-1),o=v(t.topIndex??0,0,n),c=v(t.bottomIndex??n,0,n);return c<o?{topIndex:c,bottomIndex:o}:{topIndex:o,bottomIndex:c}}function R(t,e,n=I){const o=lt(t,e),c=Math.max(1,Math.round(n));if(P(o)>=c)return o;const a=(o.topIndex+o.bottomIndex)/2;return rt(a,c,e)}function Ce(t,e,n,o=I){const c=Math.max(0,n-1),i=v(t.bottomIndex,0,c),a=Math.max(1,Math.round(o)),s=Math.max(0,i-(a-1));return{topIndex:v(e,0,s),bottomIndex:i}}function ge(t,e,n,o=I){const c=Math.max(0,n-1),i=v(t.topIndex,0,c),a=Math.max(1,Math.round(o)),s=Math.min(c,i+(a-1)),l=v(e,s,c);return{topIndex:i,bottomIndex:l}}function be(t,e,n,o=I){const c=Math.max(0,n-1),i=v(t,0,c),a=Math.max(1,Math.round(o)),s=Math.max(0,i-(a-1));return v(e,0,s)}function ve(t,e,n,o=I){const c=Math.max(0,n-1),i=v(t,0,c),a=Math.max(1,Math.round(o)),s=Math.min(c,i+(a-1));return v(e,s,c)}function Se(t,e,n){const o=Math.max(0,n-1),c=Math.max(1,P(t)),i=Math.max(0,o+1-c),a=v(t.topIndex+e,0,i),s=Math.min(o,a+c-1);return{topIndex:a,bottomIndex:s}}function Me(t,e,{totalRanks:n,minSpan:o=I,zoomStep:c=Wt}){const i=Math.max(0,n-1),a=Math.max(1,Math.round(o)),s=Math.max(0,Math.round(c)),l=lt(t,n);if(s===0)return R(l,n,a);const d=P(l);if(e==="in"){if(d<=a)return R(l,n,a);const f=Math.max(a,d-2*s),N=(l.topIndex+l.bottomIndex)/2;return rt(N,f,n)}const u=l.topIndex-s,m=l.bottomIndex+s,p=v(u,0,i),A=v(m,0,i);return R({topIndex:p,bottomIndex:A},n,a)}function Be(t,e,{baseUnit:n,paddingRows:o=1}){if(!t||t<=0||!e||e<=0)return 1;const c=Math.max(1,Math.round(e)+Math.max(0,Math.round(o))),i=Xt(n);return 2*t/(c*i)}const Jt=40,Kt=20;function Ee(t){const{containerHeight:e,fullRowData:n,preferredCellHeight:o=Jt,minCellHeight:c=Kt,centerOnMidi:i}=t,a=n.length;if(a===0)return{startRow:0,endRow:0,cellHeight:o,visibleRows:0};const s=Math.max(1,c),l=Math.max(s,o),d=x=>{if(e<=0||x<=0)return 0;const g=x/2;return Math.max(0,Math.floor(e/g)-1)},u=d(l),m=d(s);if(a<=u&&u>0){const x=2*e/(a+1);return{startRow:0,endRow:a-1,cellHeight:x,visibleRows:a}}if(a<=m&&m>0){const x=2*e/(a+1);return{startRow:0,endRow:a-1,cellHeight:x,visibleRows:a}}const p=Math.max(1,m);let A=0,f=p-1;if(i!==void 0&&n[0]){const C=(n[0].midi??108)-Math.round(i);if(C>=0&&C<a){const r=Math.floor(p/2);A=Math.max(0,C-r),f=Math.min(a-1,A+p-1),f===a-1&&(A=Math.max(0,f-p+1))}}const N=2*e/(p+1);return{startRow:A,endRow:f,cellHeight:N,visibleRows:p}}const Ie=1,Qt="mlt-handoff",te=1,S="handoff-slots",O="mlt-handoff-slot",ee=300*1e3;function G(){return new Promise((t,e)=>{const n=indexedDB.open(Qt,te);n.onerror=()=>{e(new Error("Failed to open IndexedDB"))},n.onsuccess=()=>{t(n.result)},n.onupgradeneeded=o=>{const c=o.target.result;c.objectStoreNames.contains(S)||c.createObjectStore(S,{keyPath:"handoffId"})}})}async function k(){if(typeof indexedDB>"u")return!1;try{return(await G()).close(),!0}catch{return!1}}function ae(){const t=Date.now().toString(36),e=Math.random().toString(36).substring(2,10);return`handoff-${t}-${e}`}async function ne(t){const e=await G();return new Promise((n,o)=>{const c=e.transaction(S,"readwrite"),i=c.objectStore(S),a=i.clear();a.onsuccess=()=>{const s=i.add(t);s.onsuccess=()=>{n()},s.onerror=()=>{o(new Error("Failed to write to IndexedDB"))}},a.onerror=()=>{o(new Error("Failed to clear IndexedDB"))},c.oncomplete=()=>{e.close()}})}function Q(t){try{const e=JSON.stringify(t);localStorage.setItem(O,e)}catch(e){throw new Error(`Failed to write to localStorage: ${e}`)}}async function we(t){const e=ae(),n={snapshot:t,writtenAt:Date.now(),handoffId:e};if(await k())try{return await ne(n),e}catch{return Q(n),e}else return Q(n),e}async function se(){const t=await G();return new Promise((e,n)=>{const o=t.transaction(S,"readonly"),i=o.objectStore(S).getAll();i.onsuccess=()=>{const a=i.result;a.length>0?e(a[a.length-1]):e(null)},i.onerror=()=>{n(new Error("Failed to read from IndexedDB"))},o.oncomplete=()=>{t.close()}})}function tt(){try{const t=localStorage.getItem(O);return t?JSON.parse(t):null}catch{return null}}async function ie(){const t=await k();let e=null;if(t)try{e=await se()}catch{e=tt()}else e=tt();return e?Date.now()-e.writtenAt>ee?(await ht(),null):e.snapshot:null}async function oe(){const t=await G();return new Promise((e,n)=>{const o=t.transaction(S,"readwrite"),i=o.objectStore(S).clear();i.onsuccess=()=>{e()},i.onerror=()=>{n(new Error("Failed to clear IndexedDB"))},o.oncomplete=()=>{t.close()}})}function ce(){try{localStorage.removeItem(O)}catch{}}async function ht(){const t=await k();if(ce(),t)try{await oe()}catch{}}async function _e(){const t=await ie();return t&&await ht(),t}function re(t){switch(t){case"student-notation":return"/student-notation/";case"singing-trainer":return"/singing-trainer/";default:throw new Error(`Unknown app: ${t}`)}}function dt(t,e){let n=re(t);if(e&&Object.keys(e).length>0){const o=new URLSearchParams(e);n+=`?${o.toString()}`}window.location.href=n}function Te(t){const e={};t&&(e.handoff=t),e.from="student-notation",dt("singing-trainer",e)}function De(t){const e={};t&&(e.handoff=t),e.from="singing-trainer",dt("student-notation",e)}function Ge(){const t=new URLSearchParams(window.location.search),e=t.get("from"),n=t.get("handoff")??void 0;return e==="student-notation"?{direction:"student-notation-to-singing-trainer",handoffId:n}:e==="singing-trainer"?{direction:"singing-trainer-to-student-notation",handoffId:n}:null}function qe(){const t=new URL(window.location.href);t.searchParams.delete("handoff"),t.searchParams.delete("from"),window.history.replaceState({},"",t.toString())}export{Ge as A,kt as B,_e as C,I as D,qe as E,Ie as S,Ce as a,Se as b,xe as c,ye as d,Be as e,it as f,P as g,de as h,he as i,pe as j,me as k,Te as l,be as m,R as n,$t as o,ve as p,ue as q,Ne as r,ge as s,fe as t,Ae as u,Ee as v,we as w,Ht as x,De as y,Me as z};
