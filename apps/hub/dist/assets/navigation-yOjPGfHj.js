import{X as g,a5 as V,aa as y,a6 as k,U as I,Z as G,ae as j,_ as W,V as Z,af as $,ag as J,ah as C,J as X,l as Y,z as _}from"./disclose-version-CQsWsxfw.js";function R(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}class K{anchor;#t=new Map;#a=new Map;#e=new Map;#c=new Set;#n=!0;constructor(e,a=!0){this.anchor=e,this.#n=a}#i=()=>{var e=g;if(this.#t.has(e)){var a=this.#t.get(e),n=this.#a.get(a);if(n)V(n),this.#c.delete(a);else{var o=this.#e.get(a);o&&(this.#a.set(a,o.effect),this.#e.delete(a),o.fragment.lastChild.remove(),this.anchor.before(o.fragment),n=o.effect)}for(const[i,c]of this.#t){if(this.#t.delete(i),i===e)break;const s=this.#e.get(c);s&&(y(s.effect),this.#e.delete(c))}for(const[i,c]of this.#a){if(i===a||this.#c.has(i))continue;const s=()=>{if(Array.from(this.#t.values()).includes(i)){var h=document.createDocumentFragment();j(c,h),h.append(I()),this.#e.set(i,{effect:c,fragment:h})}else y(c);this.#c.delete(i),this.#a.delete(i)};this.#n||!n?(this.#c.add(i),k(c,s,!1)):s()}}};#o=e=>{this.#t.delete(e);const a=Array.from(this.#t.values());for(const[n,o]of this.#e)a.includes(n)||(y(o.effect),this.#e.delete(n))};ensure(e,a){var n=g,o=W();if(a&&!this.#a.has(e)&&!this.#e.has(e))if(o){var i=document.createDocumentFragment(),c=I();i.append(c),this.#e.set(e,{effect:G(()=>a(c)),fragment:i})}else this.#a.set(e,G(()=>a(this.anchor)));if(this.#t.set(n,e),o){for(const[s,r]of this.#a)s===e?n.skipped_effects.delete(r):n.skipped_effects.add(r);for(const[s,r]of this.#e)s===e?n.skipped_effects.delete(r.effect):n.skipped_effects.add(r.effect);n.oncommit(this.#i),n.ondiscard(this.#o)}else this.#i()}}function Ce(t,e,a=!1){var n=new K(t),o=a?$:0;function i(c,s){n.ensure(c,s)}Z(()=>{var c=!1;e((s,r=!0)=>{c=!0,i(r,s)}),c||i(!1,null)},o)}function Be(t,e,a,n,o,i){var c=t.__className;if(c!==a||c===void 0){var s=J(a,n,i);s==null?t.removeAttribute("class"):t.className=s,t.__className=a}else if(i&&o!==i)for(var r in i){var h=!!i[r];(o==null||h!==!!o[r])&&t.classList.toggle(r,h)}return i}function Q(t){C===null&&R(),X&&C.l!==null?ee(C).m.push(t):Y(()=>{const e=_(t);if(typeof e=="function")return e})}function ve(t){C===null&&R(),Q(()=>()=>_(t))}function ee(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}const T=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fcfcfc",isAccidental:!1,midi:108,pitchClass:0,octave:8},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fcf7fc",isAccidental:!1,midi:107,pitchClass:11,octave:7},{pitch:"B♭/A♯7",flatName:"B♭7",sharpName:"A♯7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f7f5fd",isAccidental:!0,midi:106,pitchClass:10,octave:7},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f0f4ff",isAccidental:!1,midi:105,pitchClass:9,octave:7},{pitch:"A♭/G♯7",flatName:"A♭7",sharpName:"G♯7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#e6f3fd",isAccidental:!0,midi:104,pitchClass:8,octave:7},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#def3f7",isAccidental:!1,midi:103,pitchClass:7,octave:7},{pitch:"G♭/F♯7",flatName:"G♭7",sharpName:"F♯7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#daf2ec",isAccidental:!0,midi:102,pitchClass:6,octave:7},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#dcefdf",isAccidental:!1,midi:101,pitchClass:5,octave:7},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#e3ebd1",isAccidental:!1,midi:100,pitchClass:4,octave:7},{pitch:"E♭/D♯7",flatName:"E♭7",sharpName:"D♯7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#eee4c8",isAccidental:!0,midi:99,pitchClass:3,octave:7},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#f8dcc6",isAccidental:!1,midi:98,pitchClass:2,octave:7},{pitch:"D♭/C♯7",flatName:"D♭7",sharpName:"C♯7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fcd4cd",isAccidental:!0,midi:97,pitchClass:1,octave:7},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#facfdb",isAccidental:!1,midi:96,pitchClass:0,octave:7},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#efcdeb",isAccidental:!1,midi:95,pitchClass:11,octave:6},{pitch:"B♭/A♯6",flatName:"B♭6",sharpName:"A♯6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#ddcff9",isAccidental:!0,midi:94,pitchClass:10,octave:6},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#c4d3ff",isAccidental:!1,midi:93,pitchClass:9,octave:6},{pitch:"A♭/G♯6",flatName:"A♭6",sharpName:"G♯6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#abd9fa",isAccidental:!0,midi:92,pitchClass:8,octave:6},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#98dde9",isAccidental:!1,midi:91,pitchClass:7,octave:6},{pitch:"G♭/F♯6",flatName:"G♭6",sharpName:"F♯6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#96ddcf",isAccidental:!0,midi:90,pitchClass:6,octave:6},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#a6d9b0",isAccidental:!1,midi:89,pitchClass:5,octave:6},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#c0d093",isAccidental:!1,midi:88,pitchClass:4,octave:6},{pitch:"E♭/D♯6",flatName:"E♭6",sharpName:"D♯6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#dbc383",isAccidental:!0,midi:87,pitchClass:3,octave:6},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#efb586",isAccidental:!1,midi:86,pitchClass:2,octave:6},{pitch:"D♭/C♯6",flatName:"D♭6",sharpName:"C♯6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#f8a99c",isAccidental:!0,midi:85,pitchClass:1,octave:6},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#f3a2bb",isAccidental:!1,midi:84,pitchClass:0,octave:6},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e1a3db",isAccidental:!1,midi:83,pitchClass:11,octave:5},{pitch:"B♭/A♯5",flatName:"B♭5",sharpName:"A♯5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#c3a9f4",isAccidental:!0,midi:82,pitchClass:10,octave:5},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#9ab2ff",isAccidental:!1,midi:81,pitchClass:9,octave:5},{pitch:"A♭/G♯5",flatName:"A♭5",sharpName:"G♯5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#67bdf7",isAccidental:!0,midi:80,pitchClass:8,octave:5},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#30c6dc",isAccidental:!1,midi:79,pitchClass:7,octave:5},{pitch:"G♭/F♯5",flatName:"G♭5",sharpName:"F♯5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#32c8b2",isAccidental:!0,midi:78,pitchClass:6,octave:5},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#6dc281",isAccidental:!1,midi:77,pitchClass:5,octave:5},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#a0b556",isAccidental:!1,midi:76,pitchClass:4,octave:5},{pitch:"E♭/D♯5",flatName:"E♭5",sharpName:"D♯5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#c5a33f",isAccidental:!0,midi:75,pitchClass:3,octave:5},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#dc9150",isAccidental:!1,midi:74,pitchClass:2,octave:5},{pitch:"D♭/C♯5",flatName:"D♭5",sharpName:"C♯5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#e38475",isAccidental:!0,midi:73,pitchClass:1,octave:5},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#dc7f9d",isAccidental:!1,midi:72,pitchClass:0,octave:5},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#c781c0",isAccidental:!1,midi:71,pitchClass:11,octave:4},{pitch:"B♭/A♯4",flatName:"B♭4",sharpName:"A♯4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#a68ad8",isAccidental:!0,midi:70,pitchClass:10,octave:4},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#7d94e0",isAccidental:!1,midi:69,pitchClass:9,octave:4},{pitch:"A♭/G♯4",flatName:"A♭4",sharpName:"G♯4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#4c9fd5",isAccidental:!0,midi:68,pitchClass:8,octave:4},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#0fa6ba",isAccidental:!1,midi:67,pitchClass:7,octave:4},{pitch:"G♭/F♯4",flatName:"G♭4",sharpName:"F♯4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#24a794",isAccidental:!0,midi:66,pitchClass:6,octave:4},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#5aa26a",isAccidental:!1,midi:65,pitchClass:5,octave:4},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#849646",isAccidental:!1,midi:64,pitchClass:4,octave:4},{pitch:"E♭/D♯4",flatName:"E♭4",sharpName:"D♯4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#a38733",isAccidental:!0,midi:63,pitchClass:3,octave:4},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#b67740",isAccidental:!1,midi:62,pitchClass:2,octave:4},{pitch:"D♭/C♯4",flatName:"D♭4",sharpName:"C♯4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#bc6c5f",isAccidental:!0,midi:61,pitchClass:1,octave:4},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#b56880",isAccidental:!1,midi:60,pitchClass:0,octave:4},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#a3699e",isAccidental:!1,midi:59,pitchClass:11,octave:3},{pitch:"B♭/A♯3",flatName:"B♭3",sharpName:"A♯3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#8870b1",isAccidental:!0,midi:58,pitchClass:10,octave:3},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#6578b7",isAccidental:!1,midi:57,pitchClass:9,octave:3},{pitch:"A♭/G♯3",flatName:"A♭3",sharpName:"G♯3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#3c81ad",isAccidental:!0,midi:56,pitchClass:8,octave:3},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#0e8696",isAccidental:!1,midi:55,pitchClass:7,octave:3},{pitch:"G♭/F♯3",flatName:"G♭3",sharpName:"F♯3",toneNote:"Gb3",frequency:185,column:"A",hex:"#1b8777",isAccidental:!0,midi:54,pitchClass:6,octave:3},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#478255",isAccidental:!1,midi:53,pitchClass:5,octave:3},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#697836",isAccidental:!1,midi:52,pitchClass:4,octave:3},{pitch:"E♭/D♯3",flatName:"E♭3",sharpName:"D♯3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#836b27",isAccidental:!0,midi:51,pitchClass:3,octave:3},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#925e32",isAccidental:!1,midi:50,pitchClass:2,octave:3},{pitch:"D♭/C♯3",flatName:"D♭3",sharpName:"C♯3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#96554b",isAccidental:!0,midi:49,pitchClass:1,octave:3},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#905165",isAccidental:!1,midi:48,pitchClass:0,octave:3},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#80527c",isAccidental:!1,midi:47,pitchClass:11,octave:2},{pitch:"B♭/A♯2",flatName:"B♭2",sharpName:"A♯2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#6a578c",isAccidental:!0,midi:46,pitchClass:10,octave:2},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#4e5e90",isAccidental:!1,midi:45,pitchClass:9,octave:2},{pitch:"A♭/G♯2",flatName:"A♭2",sharpName:"G♯2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#2d6488",isAccidental:!0,midi:44,pitchClass:8,octave:2},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#096875",isAccidental:!1,midi:43,pitchClass:7,octave:2},{pitch:"G♭/F♯2",flatName:"G♭2",sharpName:"F♯2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#13685b",isAccidental:!0,midi:42,pitchClass:6,octave:2},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#356440",isAccidental:!1,midi:41,pitchClass:5,octave:2},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#505c28",isAccidental:!1,midi:40,pitchClass:4,octave:2},{pitch:"E♭/D♯2",flatName:"E♭2",sharpName:"D♯2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#63511c",isAccidental:!0,midi:39,pitchClass:3,octave:2},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#6e4724",isAccidental:!1,midi:38,pitchClass:2,octave:2},{pitch:"D♭/C♯2",flatName:"D♭2",sharpName:"C♯2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#713f37",isAccidental:!0,midi:37,pitchClass:1,octave:2},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#6c3c4b",isAccidental:!1,midi:36,pitchClass:0,octave:2},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#603c5d",isAccidental:!1,midi:35,pitchClass:11,octave:1},{pitch:"B♭/A♯1",flatName:"B♭1",sharpName:"A♯1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#4e4068",isAccidental:!0,midi:34,pitchClass:10,octave:1},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#38446b",isAccidental:!1,midi:33,pitchClass:9,octave:1},{pitch:"A♭/G♯1",flatName:"A♭1",sharpName:"G♯1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#1f4964",isAccidental:!0,midi:32,pitchClass:8,octave:1},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#044b55",isAccidental:!1,midi:31,pitchClass:7,octave:1},{pitch:"G♭/F♯1",flatName:"G♭1",sharpName:"F♯1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#0c4b41",isAccidental:!0,midi:30,pitchClass:6,octave:1},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#24472c",isAccidental:!1,midi:29,pitchClass:5,octave:1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#38401a",isAccidental:!1,midi:28,pitchClass:4,octave:1},{pitch:"E♭/D♯1",flatName:"E♭1",sharpName:"D♯1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#463811",isAccidental:!0,midi:27,pitchClass:3,octave:1},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#4d3017",isAccidental:!1,midi:26,pitchClass:2,octave:1},{pitch:"D♭/C♯1",flatName:"D♭1",sharpName:"C♯1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#4f2a24",isAccidental:!0,midi:25,pitchClass:1,octave:1},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#4a2733",isAccidental:!1,midi:24,pitchClass:0,octave:1},{pitch:"B0",flatName:"B0",sharpName:"B0",toneNote:"B0",frequency:30.87,column:"B",hex:"#41273f",isAccidental:!1,midi:23,pitchClass:11,octave:0},{pitch:"B♭/A♯0",flatName:"B♭0",sharpName:"A♯0",toneNote:"Bb0",frequency:29.14,column:"A",hex:"#342a46",isAccidental:!0,midi:22,pitchClass:10,octave:0},{pitch:"A0",flatName:"A0",sharpName:"A0",toneNote:"A0",frequency:27.5,column:"B",hex:"#242c48",isAccidental:!1,midi:21,pitchClass:9,octave:0}],te=new Map,H=new Map;T.forEach((t,e)=>{te.set(t.toneNote,e),t.midi!==void 0&&H.set(t.midi,e)});function ae(t){const e=H.get(t);return e!==void 0?T[e]:void 0}function be(t,e){const a=[];for(let n=e;n>=t;n--){const o=ae(n);o&&a.push(o)}return a}const N=9,ce=2,ne=5;function l(t,e,a){return Number.isFinite(t)?Math.max(e,Math.min(a,Math.round(t))):e}function ie(t){return Number.isFinite(t)?Math.max(1,t):1}function ye(t,e,{maxStep:a=ne}={}){const n=Math.max(1,Math.round(e)),i=Math.max(1,Math.round(t))/n;let c=1;i>=.85?c=5:i>=.65?c=4:i>=.45?c=3:i>=.25?c=2:c=1;const s=Math.max(1,Math.round(a));return Math.max(1,Math.min(s,c))}function P(t,e,a){const n=Math.max(0,a-1),o=Math.max(1,Math.round(e)),i=(o-1)/2;let c=Math.round(t-i),s=c+o-1;if(c<0&&(s+=-c,c=0),s>n){const r=s-n;c-=r,s=n}return c=l(c,0,n),s=l(s,c,n),{topIndex:c,bottomIndex:s}}function q(t){return t.bottomIndex-t.topIndex+1}function z(t,e){const a=Math.max(0,e-1),n=l(t.topIndex??0,0,a),o=l(t.bottomIndex??a,0,a);return o<n?{topIndex:o,bottomIndex:n}:{topIndex:n,bottomIndex:o}}function D(t,e,a=N){const n=z(t,e),o=Math.max(1,Math.round(a));if(q(n)>=o)return n;const c=(n.topIndex+n.bottomIndex)/2;return P(c,o,e)}function De(t,e,a,n=N){const o=Math.max(0,a-1),i=l(t.bottomIndex,0,o),c=Math.max(1,Math.round(n)),s=Math.max(0,i-(c-1));return{topIndex:l(e,0,s),bottomIndex:i}}function qe(t,e,a,n=N){const o=Math.max(0,a-1),i=l(t.topIndex,0,o),c=Math.max(1,Math.round(n)),s=Math.min(o,i+(c-1)),r=l(e,s,o);return{topIndex:i,bottomIndex:r}}function Me(t,e,a,n=N){const o=Math.max(0,a-1),i=l(t,0,o),c=Math.max(1,Math.round(n)),s=Math.max(0,i-(c-1));return l(e,0,s)}function Ee(t,e,a,n=N){const o=Math.max(0,a-1),i=l(t,0,o),c=Math.max(1,Math.round(n)),s=Math.min(o,i+(c-1));return l(e,s,o)}function we(t,e,a){const n=Math.max(0,a-1),o=Math.max(1,q(t)),i=Math.max(0,n+1-o),c=l(t.topIndex+e,0,i),s=Math.min(n,c+o-1);return{topIndex:c,bottomIndex:s}}function ge(t,e,{totalRanks:a,minSpan:n=N,zoomStep:o=ce}){const i=Math.max(0,a-1),c=Math.max(1,Math.round(n)),s=Math.max(0,Math.round(o)),r=z(t,a);if(s===0)return D(r,a,c);const h=q(r);if(e==="in"){if(h<=c)return D(r,a,c);const p=Math.max(c,h-2*s),v=(r.topIndex+r.bottomIndex)/2;return P(v,p,a)}const x=r.topIndex-s,A=r.bottomIndex+s,m=l(x,0,i),u=l(A,0,i);return D({topIndex:m,bottomIndex:u},a,c)}function Ie(t,e,{baseUnit:a,paddingRows:n=1}){if(!t||t<=0||!e||e<=0)return 1;const o=Math.max(1,Math.round(e)+Math.max(0,Math.round(n))),i=ie(a);return 2*t/(o*i)}const oe=40,se=20;function Ge(t){const{containerHeight:e,fullRowData:a,preferredCellHeight:n=oe,minCellHeight:o=se,centerOnMidi:i}=t,c=a.length;if(c===0)return{startRow:0,endRow:0,cellHeight:n,visibleRows:0};const s=Math.max(1,o),r=Math.max(s,n),h=d=>{if(e<=0||d<=0)return 0;const w=d/2;return Math.max(0,Math.floor(e/w)-1)},x=h(r),A=h(s);if(c<=x&&x>0){const d=2*e/(c+1);return{startRow:0,endRow:c-1,cellHeight:d,visibleRows:c}}if(c<=A&&A>0){const d=2*e/(c+1);return{startRow:0,endRow:c-1,cellHeight:d,visibleRows:c}}const m=Math.max(1,A);let u=0,p=m-1;if(i!==void 0&&a[0]){const b=(a[0].midi??108)-Math.round(i);if(b>=0&&b<c){const U=Math.floor(m/2);u=Math.max(0,b-U),p=Math.min(c-1,u+m-1),p===c-1&&(u=Math.max(0,p-m+1))}}const v=2*e/(m+1);return{startRow:u,endRow:p,cellHeight:v,visibleRows:m}}const Fe=1,re="mlt-handoff",le=1,f="handoff-slots",M="mlt-handoff-slot",he=300*1e3;function B(){return new Promise((t,e)=>{const a=indexedDB.open(re,le);a.onerror=()=>{e(new Error("Failed to open IndexedDB"))},a.onsuccess=()=>{t(a.result)},a.onupgradeneeded=n=>{const o=n.target.result;o.objectStoreNames.contains(f)||o.createObjectStore(f,{keyPath:"handoffId"})}})}async function E(){if(typeof indexedDB>"u")return!1;try{return(await B()).close(),!0}catch{return!1}}function me(){const t=Date.now().toString(36),e=Math.random().toString(36).substring(2,10);return`handoff-${t}-${e}`}async function fe(t){const e=await B();return new Promise((a,n)=>{const o=e.transaction(f,"readwrite"),i=o.objectStore(f),c=i.clear();c.onsuccess=()=>{const s=i.add(t);s.onsuccess=()=>{a()},s.onerror=()=>{n(new Error("Failed to write to IndexedDB"))}},c.onerror=()=>{n(new Error("Failed to clear IndexedDB"))},o.oncomplete=()=>{e.close()}})}function F(t){try{const e=JSON.stringify(t);localStorage.setItem(M,e)}catch(e){throw new Error(`Failed to write to localStorage: ${e}`)}}async function Se(t){const e=me(),a={snapshot:t,writtenAt:Date.now(),handoffId:e};if(await E())try{return await fe(a),e}catch{return F(a),e}else return F(a),e}async function de(){const t=await B();return new Promise((e,a)=>{const n=t.transaction(f,"readonly"),i=n.objectStore(f).getAll();i.onsuccess=()=>{const c=i.result;c.length>0?e(c[c.length-1]):e(null)},i.onerror=()=>{a(new Error("Failed to read from IndexedDB"))},n.oncomplete=()=>{t.close()}})}function S(){try{const t=localStorage.getItem(M);return t?JSON.parse(t):null}catch{return null}}async function ue(){const t=await E();let e=null;if(t)try{e=await de()}catch{e=S()}else e=S();return e?Date.now()-e.writtenAt>he?(await O(),null):e.snapshot:null}async function pe(){const t=await B();return new Promise((e,a)=>{const n=t.transaction(f,"readwrite"),i=n.objectStore(f).clear();i.onsuccess=()=>{e()},i.onerror=()=>{a(new Error("Failed to clear IndexedDB"))},n.oncomplete=()=>{t.close()}})}function Ne(){try{localStorage.removeItem(M)}catch{}}async function O(){const t=await E();if(Ne(),t)try{await pe()}catch{}}async function _e(){const t=await ue();return t&&await O(),t}function Ae(t){switch(t){case"student-notation":return"/student-notation/";case"singing-trainer":return"/singing-trainer/";default:throw new Error(`Unknown app: ${t}`)}}function L(t,e){let a=Ae(t);if(e&&Object.keys(e).length>0){const n=new URLSearchParams(e);a+=`?${n.toString()}`}window.location.href=a}function Re(t){const e={};t&&(e.handoff=t),e.from="student-notation",L("singing-trainer",e)}function Te(t){const e={};t&&(e.handoff=t),e.from="singing-trainer",L("student-notation",e)}function He(){const t=new URLSearchParams(window.location.search),e=t.get("from"),a=t.get("handoff")??void 0;return e==="student-notation"?{direction:"student-notation-to-singing-trainer",handoffId:a}:e==="singing-trainer"?{direction:"singing-trainer-to-student-notation",handoffId:a}:null}function Pe(){const t=new URL(window.location.href);t.searchParams.delete("handoff"),t.searchParams.delete("from"),window.history.replaceState({},"",t.toString())}export{N as D,Fe as S,De as a,we as b,ye as c,Me as d,Ee as e,Ie as f,q as g,ve as h,Ce as i,Be as j,Re as k,Te as l,He as m,D as n,Q as o,_e as p,Pe as q,T as r,qe as s,Ge as t,be as u,Se as w,ge as z};
