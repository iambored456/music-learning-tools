import{g as c,p as l,a as i,O as p,B as g}from"./diatonic-compass-CUph0nUv.js";import"./modulepreload-polyfill-B5Qt9EMX.js";var y=Object.defineProperty,b=(o,e,t)=>e in o?y(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,u=(o,e,t)=>b(o,typeof e!="symbol"?e+"":e,t);const m={general:"Use arrow keys to rotate rings, space to play scale, S for settings, H for keyboard shortcuts help.",navigation:"Arrow keys rotate rings. Shift plus arrows for chromatic ring. Control plus arrows for large steps.",playback:"Press space or enter to play the current scale. Escape to stop playback.",settings:"Press S to open settings. Use tab to navigate options. Escape to close.",keyboard:"Press H to see all keyboard shortcuts. Use tab to navigate between interface elements."};class d{static init(){try{this.setupLiveRegions(),this.enhanceExistingElements(),this.setupStateMonitoring(),console.log("Screen reader support initialized")}catch(e){c.handle(e,l.ERROR_HANDLING.CONTEXTS.UI)}}static setupLiveRegions(){const e=document.createElement("div");e.id="sr-main-announcements",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","false"),e.className="sr-only",this.applySROnlyStyles(e),document.body.appendChild(e);const t=document.createElement("div");t.id="sr-urgent-announcements",t.setAttribute("aria-live","assertive"),t.setAttribute("aria-atomic","true"),t.className="sr-only",this.applySROnlyStyles(t),document.body.appendChild(t);const n=document.createElement("div");n.id="sr-musical-status",n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true"),n.className="sr-only",this.applySROnlyStyles(n),document.body.appendChild(n)}static applySROnlyStyles(e){e.style.position="absolute",e.style.left="-10000px",e.style.width="1px",e.style.height="1px",e.style.overflow="hidden",e.style.clip="rect(1px, 1px, 1px, 1px)",e.style.whiteSpace="nowrap"}static enhanceExistingElements(){const e=document.querySelector("#chromaWheel");if(e){e.setAttribute("role","application"),e.setAttribute("aria-label","Interactive Diatonic Compass"),e.setAttribute("aria-describedby","sr-canvas-description");const n=document.createElement("div");n.id="sr-canvas-description",n.className="sr-only",n.textContent="A circular interface with three concentric rings representing pitch classes, scale degrees, and chromatic positions. Use arrow keys to rotate rings and explore different musical keys and modes.",this.applySROnlyStyles(n),document.body.appendChild(n)}const t=document.querySelector("#result-container");if(t){t.setAttribute("role","status"),t.setAttribute("aria-label","Current musical key and mode"),t.setAttribute("aria-describedby","sr-result-description");const n=document.createElement("div");n.id="sr-result-description",n.className="sr-only",n.textContent="Shows the current musical key and mode. Click to play the scale.",this.applySROnlyStyles(n),document.body.appendChild(n)}this.enhanceBelts(),this.enhanceControls()}static enhanceBelts(){[{selector:"#pitchBelt",name:"Pitch Class Belt",description:"Shows note names (C, D, E, etc.)"},{selector:"#degreeBelt",name:"Scale Degree Belt",description:"Shows scale degrees (1, 2, 3, etc.)"},{selector:"#chromaticBelt",name:"Chromatic Belt",description:"Shows chromatic positions (0-11)"}].forEach(e=>{const t=document.querySelector(e.selector);t&&(t.setAttribute("role","listbox"),t.setAttribute("aria-label",e.name),t.setAttribute("aria-description",e.description),t.setAttribute("tabindex","0"))})}static enhanceControls(){var e,t,n;const a=document.querySelector("#flat-btn"),r=document.querySelector("#sharp-btn");if(a){a.setAttribute("aria-describedby","sr-flat-description");const s=document.createElement("span");s.id="sr-flat-description",s.className="sr-only",s.textContent="Toggle display of flat note names like D-flat, E-flat",this.applySROnlyStyles(s),(e=a.parentNode)==null||e.appendChild(s)}if(r){r.setAttribute("aria-describedby","sr-sharp-description");const s=document.createElement("span");s.id="sr-sharp-description",s.className="sr-only",s.textContent="Toggle display of sharp note names like C-sharp, F-sharp",this.applySROnlyStyles(s),(t=r.parentNode)==null||t.appendChild(s)}const h=document.querySelector("#settings-btn");if(h){h.setAttribute("aria-describedby","sr-settings-description");const s=document.createElement("span");s.id="sr-settings-description",s.className="sr-only",s.textContent="Open settings panel to change display options, theme, and layout",this.applySROnlyStyles(s),(n=h.parentNode)==null||n.appendChild(s)}}static setupStateMonitoring(){setInterval(()=>{this.shouldAnnounceStateChange()&&this.announceCurrentState()},1e3)}static shouldAnnounceStateChange(){if(!this.isEnabled)return!1;const e=this.getCurrentMusicalState();return JSON.stringify(e)!==JSON.stringify(this.lastAnnouncedState)&&!i.drag.active&&!i.animation}static getCurrentMusicalState(){try{const e=p(i);return{pitch:e?.pitch,mode:e?.modeName,isPlaying:i.playback.isPlaying}}catch{return{pitch:"Unknown",mode:"Unknown",isPlaying:!1}}}static announceCurrentState(){try{const e=p(i);if(!e)return;const t=`${e.pitch} ${e.modeName}`;this.announceToRegion(t,"sr-musical-status"),this.lastAnnouncedState=this.getCurrentMusicalState()}catch(e){c.handle(e,l.ERROR_HANDLING.CONTEXTS.UI)}}static announceMusicalChange(e,t={}){try{let n="";switch(e){case"key-change":n=`Key changed to ${t.key} ${t.mode}`;break;case"mode-change":n=`Mode changed to ${t.mode}`;break;case"note-change":n=`Root note changed to ${t.note}`;break;case"playback-start":n=`Playing ${t.key} ${t.mode} scale`;break;case"playback-stop":n="Playback stopped";break;case"playback-note":n=`Playing ${t.note}`;break;default:n=t.message||"Musical state changed"}this.queueAnnouncement(n)}catch(n){c.handle(n,l.ERROR_HANDLING.CONTEXTS.UI)}}static announceInteractionStart(e){const t={"wheel-drag":"Dragging wheel ring. Move to change musical key.","belt-drag":"Dragging belt. Move to change scale degrees.","chromatic-drag":"Dragging chromatic ring. Move to change perspective.","playback-start":"Scale playback started.","settings-open":"Settings panel opened.","tutorial-start":"Tutorial started. Follow the instructions to learn the interface."}[e];t&&this.queueAnnouncement(t,"polite")}static announceMusicalContext(e=!1){try{const t=p(i);if(!t)return;let n=`Current key: ${t.pitch} ${t.modeName}`;if(e){const a=this.getScaleNotes(t);a.length>0&&(n+=`. Scale notes: ${a.join(", ")}`);const r=this.getModeDescription(t.modeName);r&&(n+=`. ${r}`)}this.queueAnnouncement(n,"polite")}catch(t){c.handle(t,l.ERROR_HANDLING.CONTEXTS.UI)}}static getScaleNotes(e){try{const t=g(i);return[]}catch{return[]}}static getModeDescription(e){return{Major:"A bright, happy sounding mode",Minor:"A darker, more melancholic mode",Dorian:"A minor mode with a raised 6th degree",Phrygian:"A minor mode with a lowered 2nd degree",Lydian:"A major mode with a raised 4th degree",Mixolydian:"A major mode with a lowered 7th degree",Locrian:"A diminished mode, rarely used in practice"}[e]||""}static announceUIChange(e,t={}){const n={"orientation-change":`Layout changed to ${t.orientation}`,"theme-change":`Theme changed to ${t.theme} mode`,"accidental-change":`${t.accidentalType} names ${t.enabled?"enabled":"disabled"}`,"sidebar-toggle":`Settings ${t.open?"opened":"closed"}`,"focus-change":`Focus moved to ${t.element}`}[e]||t.message;n&&this.queueAnnouncement(n)}static queueAnnouncement(e,t="polite"){this.announcementQueue.push({message:e,priority:t,timestamp:Date.now()}),this.isProcessingQueue||this.processAnnouncementQueue()}static async processAnnouncementQueue(){for(this.isProcessingQueue=!0;this.announcementQueue.length>0;){const e=this.announcementQueue.shift();e&&(Date.now()-e.timestamp>5e3||(this.announceToRegion(e.message,e.priority==="assertive"?"sr-urgent-announcements":"sr-main-announcements"),await new Promise(t=>setTimeout(t,500))))}this.isProcessingQueue=!1}static announceToRegion(e,t){try{const n=document.getElementById(t);if(!n||!e)return;n.textContent="",requestAnimationFrame(()=>{n.textContent=e}),setTimeout(()=>{n.textContent===e&&(n.textContent="")},2e3)}catch(n){c.handle(n,l.ERROR_HANDLING.CONTEXTS.UI)}}static announceTutorialStep(e,t,n=""){const a=`Tutorial step ${e}. ${t}${n?". Hint: "+n:""}`;this.queueAnnouncement(a,"assertive")}static announceValidation(e,t){const n=e==="error"?"assertive":"polite";this.queueAnnouncement(t,n)}static announceHelp(e="general"){const t=m[e]||m.general;this.queueAnnouncement(t,"polite")}static enable(){this.isEnabled=!0,this.queueAnnouncement("Screen reader support enabled")}static disable(){this.isEnabled=!1,this.queueAnnouncement("Screen reader support disabled")}static emergencyAnnounce(e){const t=document.getElementById("sr-urgent-announcements");t&&(t.textContent=e)}static cleanup(){["sr-main-announcements","sr-urgent-announcements","sr-musical-status"].forEach(e=>{const t=document.getElementById(e);t&&t.remove()}),this.announcementQueue=[],this.isProcessingQueue=!1}static getStatus(){return{isEnabled:this.isEnabled,queueLength:this.announcementQueue.length,isProcessingQueue:this.isProcessingQueue,lastAnnouncedState:this.lastAnnouncedState}}}u(d,"isEnabled",!0),u(d,"lastAnnouncedState",null),u(d,"announcementQueue",[]),u(d,"isProcessingQueue",!1);export{d as ScreenReaderManager};
