var t2=Object.defineProperty;var em=n=>{throw TypeError(n)};var e2=(n,t,e)=>t in n?t2(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var M=(n,t,e)=>e2(n,typeof t!="symbol"?t+"":t,e),qu=(n,t,e)=>t.has(n)||em("Cannot "+e);var j=(n,t,e)=>(qu(n,t,"read from private field"),e?e.call(n):t.get(n)),Pt=(n,t,e)=>t.has(n)?em("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),It=(n,t,e,s)=>(qu(n,t,"write to private field"),s?s.call(n,e):t.set(n,e),e),le=(n,t,e)=>(qu(n,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const n2="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAAAXNSR0IArs4c6QAACC9JREFUeF7tnU9rXFUcQH93Jgm0iVXQrQtFIaAJdSvu9QNY/PMt/Br6BRR1objShXRjSlxLK1QRBXEnqYKplNTWRsR05sqb9KWvw5vJmzb32HFONk0mM+/enHc4eZle7kvb79/M4UdRAsNI8eyfP8cw9YqO48EjkkKX10ChyzOuR1BogLVCA5DvDKHQAGuFBiArNAdZoTnWFhpgrdAAZAvNQVZojrWFBlgrNADZQnOQFZpjbaEB1goNQLbQHGSF5lhbaIC1QgOQLTQHWaE51hYaYK3QAGQLzUEeRIqnb+242g5AbqEByL2c46e1U9EfjZUiolqxW/3b9tH83vjzpr2ueaxpr5tl7Hq+1b+zvK75s7FzVmhI6O8ePXNHaGDABR5CoYGTXxVaoQHQ1e89F/iXB63Q5RnXIyg0wFqhAci+y8FBVmiOtYUGWCs0ANlCc5AVmmNtoQHWCg1AttAcZIXmWFtogLVCA5AtNAdZoTnWFhpgrdAAZAvNQVZojnX64oObuV4bNR/rqQ7hzNOcK6F/OOPiJELr9Nb5/dHuoylHHJndGHn88ebX9eeTntPl8Unjjv/wbWPNy5yHOcdTf6+28iVO8iKNkV6/8Jfb6RY+44PI8dIfp2M4aQl04fEX6fAKDZxthQYg138UWujysBW6PON6BAsNsFZoALKF5iArNMfaQgOsFRqAbKE5yArNsbbQAGuFBiBbaA6yQnOsLTTAWqEByBaag6zQHGsLDbBWaACyheYgKzTH2kIDrCuhX7xxKgaNxUnTVhlW32v7aFsNOWn6sx6jy6rHeZizQgNCL+UUF9auxHK+e/P649aet01rlsV6k5ZQdtnzdBKSeZizQgNC93OKrbWdWIq7QgPDLuQQCg2cdoUGIPtHIQdZoTnWFhpgrdAAZAvNQVZojrWFBlgrNADZQnOQFZpjbaEB1goNQLbQHGSF5lhbaIC1QgOQLTQHWaE51hYaYK3QAGQLzUFWaI51enX7+mhh1v3ckbl+zaQ7S3d5vOvdrNvGmpc5V0J/eXrXxUmA1+mFi1tu1lgc9CB+PViPlIbFR1r0AdLGpfMKXdiCFIP47Z9NhS7MuTq8QhOQFRqgfDiEQgOoLTQAuX6Xw0uO8rAVujzjegQLDbBWaACyhQYhew2NwbbQAGoLDUC20CBkC43BttAAagsNQLbQIGQLjcG20ABqCw1AttAgZAuNwbbQAGoLDUC20CDkUaE3oudqu+LQLXRxxBGDSLF+cC1ySpGj3v+zuchx2mNtE6xf29xLtO2x8dceN2b1/OqYzZXm458f/SfznU/ajvnfzVmhAaFvRy9eObgcg9QHRlvsIRQaOP8KDUD2GpqDrNAcawsNsFZoALKF5iArNMfaQgOsFRqAbKE5yArNsbbQAGuFBiBbaA6yQnOsLTTAWqEByBaag6zQHGsLDbBWaACyheYgKzTHOp299Pk9e9vNw/2cx/E87HM+iF68fPBt3HZxUnGz00fbb9wjdL14sG3kaTc+7zrTWY8xbT71mA/7nPt5EBdXN6Mf7j7a1ZP7fV76ZPs1dx+9X3odX9fLg/hq9axCd+T1IE9T6Aeh1/G1Ct0R1Ak8TaFPAOJxh1Do4wid3PcV+uRYTjySQgOQ67ftvIYuD1uhyzM+eoNAocvDVujyjBWaYxwKzcH2GhpgrdAAZK+hOcgKzbG20ABrhQYgW2gOskJzrC00wFqhAcgWmoOs0BxrCw2wrlbbfX16w8VJAGuFBiAPUopnblyPYaoXzx634LW5k+j47p5dFkeOH7/59SxjV3AmzaUJbtrxuywAro51MnNWaEjozb3dGKYeMNpiD6HQwPmvCq3QAOiq867lKA9aocszdi0HxzgUmoNtoQHWCg1A9n1oDrJCc6wtNMBaoQHIFpqDrNAcawsNsFZoALKF5iArNMfaQgOsFRqAbKE5yArNsbbQAGuFBiDXhf50y73tSuMepIj1G1ddnFQadLWWY+fDc/noXuXjKxOPu8/6+Fais9xTfdI90asfum3F4aR7qs/BnFNOcfWx36OXXW1X2um0+965LgtsS8/jf338NExx5QmFJk6yQgOUFRqAXF9DW+jysBW6PON6BAsNsFZoALKFBiF7DY3BttAAagsNQLbQIGQLjcG20ABqCw1AttAgZAuNwbbQAGoLDUC20CBkC43BttAAagsNQLbQIGQLjcG20ADqqtC/PH4tennSnc6BSSzIEAoNnOgcw1jbfy4iefP60rgVujTh0Ya0w3jk1vMKDbBWaACyQgOQ/aOQg6zQHGsLDbBWaACyheYgKzTH2kIDrBUagGyhOcgKzbG20ABrhQYgW2gOskJzrC00wFqhAcgWmoOs0BxrCw2wVmgAsoXmICs0xzrtvvtmPryf87QdEpsTau7gWGK3xrYdIqvxZ9mtcdoOjvycR0Lvr7s4CfA67b3zsZs1Fgfdi5X+jxHRLz7Sog+Qrr/9mUIXtiDnXqwsf6PQhTmPfo8rdHnKCl2ecT2CQgOsFRqAXL/LYaHLw1bo8owtNMc4FJqD7SUHwFqhAchecnCQFZpjbaEB1goNQLbQHGSF5lhbaIC1QgOQLTQHWaE51hYaYK3QAGQLzUFWaI61hQZYV0IvLX/v4iSAtUITkPMw9laejBTuPloat0KXJlwtacyDuLqyGT2FLk5boYsjVmgA8dEQCg3QttAAZN/lACF7yYHBttAAagsNQLbQIGQLjcG20ABqCw1AttAgZAuNwbbQAGoLDUC20CBkC43BttAAagsNQLbQIGQLjcG20ABqCw1AttAgZAuNwf4X8h6Lm5rywjsAAAAASUVORK5CYII=",s2="/music-learning-tools/student-notation/assets/clear-BoKs1BI5.svg",r2="data:image/svg+xml,%3csvg%20class='diamond-icon'%20viewBox='0%200%20120%20120'%20aria-hidden='true'%20focusable='false'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M60%205%20L35%2048.3%20L35%2071.7%20L60%20115%20L85%2071.7%20L85%2048.3%20Z'%20/%3e%3c/svg%3e",i2="/music-learning-tools/student-notation/assets/eraser-vjnwKGf-.svg",o2="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-dasharray='3%202'%20xmlns='http://www.w3.org/2000/svg'%3e%3cellipse%20cx='12'%20cy='12'%20rx='8'%20ry='6'%20transform='rotate(-15%2012%2012)'/%3e%3c/svg%3e",A2="/music-learning-tools/student-notation/assets/loop-DCKCNdJ9.svg",a2="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M18%202L6%2014l-2%206%206-2L22%206l-4-4z'/%3e%3cline%20x1='14'%20y1='6'%20x2='18'%20y2='10'/%3e%3c/svg%3e",l2="/music-learning-tools/student-notation/assets/pause-BvM7-xog.svg",c2="/music-learning-tools/student-notation/assets/play-z9TE0FgS.svg",u2="/music-learning-tools/student-notation/assets/redo-C3TqBHBd.svg",d2="/music-learning-tools/student-notation/assets/settings-TJsqx0gz.svg",h2="/music-learning-tools/student-notation/assets/stop-BU_KSLYe.svg",f2="/music-learning-tools/student-notation/assets/undo-D1s0pqx2.svg",p2="/music-learning-tools/student-notation/assets/volume-BF7HNWqG.svg",m2="/music-learning-tools/student-notation/assets/zoomIn-CqIKlW7B.svg",g2="/music-learning-tools/student-notation/assets/zoomOut-Cm9mM1qf.svg",v2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3c!--%20Grid%20pattern%20--%3e%3cline%20x1='3'%20y1='3'%20x2='3'%20y2='21'%20/%3e%3cline%20x1='9'%20y1='3'%20x2='9'%20y2='21'%20/%3e%3cline%20x1='15'%20y1='3'%20x2='15'%20y2='21'%20/%3e%3cline%20x1='21'%20y1='3'%20x2='21'%20y2='21'%20/%3e%3cline%20x1='3'%20y1='6'%20x2='21'%20y2='6'%20/%3e%3cline%20x1='3'%20y1='12'%20x2='21'%20y2='12'%20/%3e%3cline%20x1='3'%20y1='18'%20x2='21'%20y2='18'%20/%3e%3c!--%20Eye%20with%20slash%20(hide)%20--%3e%3cpath%20d='M1%201%20L23%2023'%20stroke-width='2.5'/%3e%3c/svg%3e",w2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3c!--%20Drum%20pattern%20--%3e%3cellipse%20cx='12'%20cy='7'%20rx='7'%20ry='3'/%3e%3cpath%20d='M%205%207%20L%205%2017%20Q%205%2020%2012%2020%20Q%2019%2020%2019%2017%20L%2019%207'/%3e%3cline%20x1='8'%20y1='10'%20x2='8'%20y2='16'/%3e%3cline%20x1='16'%20y1='10'%20x2='16'%20y2='16'/%3e%3c!--%20Slash%20(hide)%20--%3e%3cpath%20d='M2%202%20L22%2022'%20stroke-width='2.5'/%3e%3c/svg%3e",B2="/music-learning-tools/student-notation/assets/newPage-C3DkqRnq.svg",C2="/music-learning-tools/student-notation/assets/open-yWU2irvQ.svg",b2="/music-learning-tools/student-notation/assets/print-y0OmDKSR.svg",y2="/music-learning-tools/student-notation/assets/saveAs-DyEXJ3e_.svg",S2="/music-learning-tools/student-notation/assets/dottedQuarterNote-Cf79kpGq.svg",E2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='168'%20zoomAndPan='magnify'%20viewBox='0%200%20126%20231.75'%20height='309'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='f11b48ab54'%3e%3cpath%20d='M%200.0664062%200%20L%20125%200%20L%20125%20230.75%20L%200.0664062%20230.75%20Z%20M%200.0664062%200%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='9738701237'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23f11b48ab54)'%3e%3cpath%20style='%20stroke:none;fill-rule:nonzero;fill:%23000000;fill-opacity:1;'%20d='M%208.109375%20225.367188%20C%20-6.25%20212.289062%201.699219%20191.523438%2025.289062%20179.214844%20C%2033.234375%20175.371094%2039.132812%20173.574219%2049.386719%20173.832031%20C%2055.796875%20174.089844%2062.976562%20177.679688%2062.976562%20177.679688%20C%2062.976562%20131.273438%2062.71875%2043.585938%2062.71875%200.511719%20C%2065.285156%200.511719%2067.078125%200.257812%2070.667969%200.257812%20C%2070.667969%202.820312%2070.667969%204.871094%2070.667969%206.921875%20C%2070.667969%209.230469%2070.667969%2010.511719%2070.925781%2012.050781%20C%2073.488281%2028.203125%2077.078125%2034.613281%2095.023438%2054.355469%20C%20117.84375%2079.738281%20124.511719%2094.863281%20124.511719%20115.121094%20C%20124.253906%20134.09375%20107.589844%20174.601562%20104%20173.0625%20C%20109.125%20158.707031%20116.304688%20143.320312%20118.101562%20130.503906%20C%20120.40625%20114.863281%20114%2092.8125%20103.742188%2081.277344%20C%2095.539062%2071.53125%2076.050781%2063.070312%2070.667969%2063.070312%20C%2070.667969%2063.070312%2070.410156%20156.398438%2070.410156%20191.78125%20C%2070.410156%20197.675781%2065.027344%20208.1875%2061.949219%20211.777344%20C%2047.847656%20228.699219%2020.414062%20236.390625%208.109375%20225.367188%20Z%20M%208.109375%20225.367188%20'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",x2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20stroke='currentColor'%20stroke-width='1.5'%20fill='none'/%3e%3cpath%20d='M%2012%2012%20L%2022%2012%20A%2010%2010%200%200%200%2012%202%20Z'%20fill='currentColor'/%3e%3c/svg%3e",I2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20stroke='currentColor'%20stroke-width='1.5'%20fill='none'/%3e%3cpath%20d='M%2012%2012%20L%2022%2012%20A%2010%2010%200%200%200%2012%202%20Z'%20fill='currentColor'%20transform='rotate(180,%2012,%2012)'/%3e%3c/svg%3e",F2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20stroke='currentColor'%20stroke-width='1.5'%20fill='none'/%3e%3cpath%20d='M%2012%2012%20L%2022%2012%20A%2010%2010%200%200%200%2012%202%20Z'%20fill='currentColor'%20transform='rotate(270,%2012,%2012)'/%3e%3c/svg%3e",T2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20stroke='currentColor'%20stroke-width='1.5'%20fill='none'/%3e%3cpath%20d='M%2012%2012%20L%2022%2012%20A%2010%2010%200%200%200%2012%202%20Z'%20fill='currentColor'%20transform='rotate(90,%2012,%2012)'/%3e%3c/svg%3e",_2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='111'%20zoomAndPan='magnify'%20viewBox='0%200%2083.25%20230.999992'%20height='308'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='084e4edff4'%3e%3cpath%20d='M%201%20165%20L%2081.761719%20165%20L%2081.761719%20229.226562%20L%201%20229.226562%20Z%20M%201%20165%20'/%3e%3c/clipPath%3e%3cclipPath%20id='fdeab4882e'%3e%3cpath%20d='M%2073%201.03125%20L%2081.761719%201.03125%20L%2081.761719%20192%20L%2073%20192%20Z%20M%2073%201.03125%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='45713f1632'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23084e4edff4)'%3e%3cpath%20style='%20stroke:none;fill-rule:evenodd;fill:%23000000;fill-opacity:0.9;'%20d='M%2057.546875%20222.390625%20C%2076.429688%20212.289062%2086.492188%20194.003906%2080.304688%20180.25%20C%2073.699219%20165.578125%2051.011719%20161.4375%2029.660156%20171.003906%20C%208.308594%20180.574219%20-3.664062%20200.25%202.9375%20214.921875%20C%209.542969%20229.59375%2032.230469%20233.734375%2053.582031%20224.164062%20C%2054.917969%20223.566406%2056.285156%20223.0625%2057.546875%20222.390625%20Z%20M%2057.546875%20222.390625%20'/%3e%3c/g%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23fdeab4882e)'%3e%3cpath%20style='fill:none;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%20299.504676%20305.984569%20L%20299.504676%20339.572267%20'%20transform='matrix(-5.561147,0,0,-5.549953,1743.335656,1885.43835)'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",M2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='456e80bb30'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='87c9148330'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='d7032f28cc'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23456e80bb30)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%2387c9148330)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(44.895794,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2017.8125%200%20L%2017.8125%20-40.09375%20L%204.203125%20-40.09375%20L%204.203125%20-51.09375%20C%207.367188%20-51.09375%209.992188%20-51.253906%2012.078125%20-51.578125%20C%2014.171875%20-51.910156%2015.914062%20-52.6875%2017.3125%20-53.90625%20C%2018.71875%20-55.132812%2019.957031%20-57.09375%2021.03125%20-59.78125%20L%2031.3125%20-59.78125%20L%2031.3125%200%20Z%20M%2017.8125%200%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Q2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='af2f53afe5'%3e%3cpath%20d='M%2017.898438%2024.566406%20L%20111.859375%2024.566406%20L%20111.859375%20118.527344%20L%2017.898438%20118.527344%20Z%20M%2017.898438%2024.566406%20'/%3e%3c/clipPath%3e%3cclipPath%20id='c8dd529e93'%3e%3cpath%20d='M%2064.878906%2024.566406%20C%2038.933594%2024.566406%2017.898438%2045.601562%2017.898438%2071.546875%20C%2017.898438%2097.496094%2038.933594%20118.527344%2064.878906%20118.527344%20C%2090.828125%20118.527344%20111.859375%2097.496094%20111.859375%2071.546875%20C%20111.859375%2045.601562%2090.828125%2024.566406%2064.878906%2024.566406%20Z%20M%2064.878906%2024.566406%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='4829c2bf70'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23af2f53afe5)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23c8dd529e93)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%200.00130943%20C%2028.250074%200.00130943%200.0009548%2028.250428%200.0009548%2063.093632%20C%200.0009548%2097.942081%2028.250074%20126.185954%2063.093277%20126.185954%20C%2097.941726%20126.185954%20126.185599%2097.942081%20126.185599%2063.093632%20C%20126.185599%2028.250428%2097.941726%200.00130943%2063.093277%200.00130943%20Z%20M%2063.093277%200.00130943%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.565431)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(38.720147,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%203.046875%200%20L%203.046875%20-11.1875%20C%2010.921875%20-16.726562%2017.179688%20-21.421875%2021.828125%20-25.265625%20C%2026.484375%20-29.117188%2029.835938%20-32.507812%2031.890625%20-35.4375%20C%2033.953125%20-38.363281%2034.984375%20-41.109375%2034.984375%20-43.671875%20C%2034.984375%20-45.992188%2034.160156%20-47.75%2032.515625%20-48.9375%20C%2030.878906%20-50.132812%2028.957031%20-50.734375%2026.75%20-50.734375%20C%2024.90625%20-50.734375%2023.085938%20-50.210938%2021.296875%20-49.171875%20C%2019.503906%20-48.128906%2018.28125%20-46.207031%2017.625%20-43.40625%20L%205.28125%20-47.875%20C%206.894531%20-52.050781%209.664062%20-55.253906%2013.59375%20-57.484375%20C%2017.53125%20-59.722656%2022.125%20-60.84375%2027.375%20-60.84375%20C%2031.4375%20-60.84375%2035.078125%20-60.171875%2038.296875%20-58.828125%20C%2041.515625%20-57.492188%2044.046875%20-55.523438%2045.890625%20-52.921875%20C%2047.742188%20-50.328125%2048.671875%20-47.15625%2048.671875%20-43.40625%20C%2048.671875%20-37.375%2046.148438%20-31.773438%2041.109375%20-26.609375%20C%2036.078125%20-21.453125%2029.175781%20-16.3125%2020.40625%20-11.1875%20L%2048.953125%20-11.1875%20L%2048.953125%200%20Z%20M%203.046875%200%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",U2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='0551ece328'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='073daee785'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='04a7d7f831'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%230551ece328)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23073daee785)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(37.869539,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2026.046875%201.078125%20C%2022.703125%201.078125%2019.492188%200.597656%2016.421875%20-0.359375%20C%2013.347656%20-1.316406%2010.644531%20-2.789062%208.3125%20-4.78125%20C%205.988281%20-6.78125%204.203125%20-9.363281%202.953125%20-12.53125%20L%2015.296875%20-17%20C%2016.078125%20-14.082031%2017.507812%20-12.023438%2019.59375%20-10.828125%20C%2021.6875%20-9.628906%2023.953125%20-9.03125%2026.390625%20-9.03125%20C%2029.203125%20-9.03125%2031.441406%20-9.71875%2033.109375%20-11.09375%20C%2034.773438%20-12.46875%2035.609375%20-14.378906%2035.609375%20-16.828125%20C%2035.609375%20-19.265625%2034.832031%20-21.15625%2033.28125%20-22.5%20C%2031.738281%20-23.84375%2029.695312%20-24.769531%2027.15625%20-25.28125%20C%2024.625%20-25.789062%2021.863281%20-26.046875%2018.875%20-26.046875%20L%2018.875%20-35.53125%20C%2024.007812%20-35.53125%2027.960938%20-36.242188%2030.734375%20-37.671875%20C%2033.515625%20-39.109375%2034.90625%20-41.140625%2034.90625%20-43.765625%20C%2034.90625%20-46.085938%2033.960938%20-47.828125%2032.078125%20-48.984375%20C%2030.203125%20-50.148438%2028.039062%20-50.734375%2025.59375%20-50.734375%20C%2023.382812%20-50.734375%2021.351562%20-50.195312%2019.5%20-49.125%20C%2017.65625%20-48.050781%2016.4375%20-46.144531%2015.84375%20-43.40625%20L%203.578125%20-47.875%20C%204.773438%20-50.914062%206.535156%20-53.390625%208.859375%20-55.296875%20C%2011.179688%20-57.210938%2013.863281%20-58.613281%2016.90625%20-59.5%20C%2019.945312%20-60.394531%2023.109375%20-60.84375%2026.390625%20-60.84375%20C%2029.140625%20-60.84375%2031.828125%20-60.546875%2034.453125%20-59.953125%20C%2037.078125%20-59.359375%2039.445312%20-58.421875%2041.5625%20-57.140625%20C%2043.6875%20-55.859375%2045.390625%20-54.242188%2046.671875%20-52.296875%20C%2047.953125%20-50.359375%2048.59375%20-48.050781%2048.59375%20-45.375%20C%2048.59375%20-42.144531%2047.726562%20-39.320312%2046%20-36.90625%20C%2044.269531%20-34.488281%2042.359375%20-32.6875%2040.265625%20-31.5%20C%2042.234375%20-30.78125%2043.914062%20-29.644531%2045.3125%20-28.09375%20C%2046.71875%20-26.539062%2047.78125%20-24.835938%2048.5%20-22.984375%20C%2049.21875%20-21.140625%2049.578125%20-19.296875%2049.578125%20-17.453125%20C%2049.578125%20-13.273438%2048.472656%20-9.828125%2046.265625%20-7.109375%20C%2044.054688%20-4.398438%2041.160156%20-2.359375%2037.578125%20-0.984375%20C%2034.003906%200.390625%2030.160156%201.078125%2026.046875%201.078125%20Z%20M%2026.046875%201.078125%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",P2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='0f524ef70a'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='786a2dceed'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='1bb9b822db'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%230f524ef70a)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23786a2dceed)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(36.937365,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2031.140625%200%20L%2031.140625%20-12.625%20L%202.0625%20-12.625%20L%202.0625%20-22.546875%20L%2031.140625%20-59.78125%20L%2044.75%20-59.78125%20L%2044.75%20-24.609375%20L%2052.96875%20-24.609375%20L%2052.96875%20-12.625%20L%2044.75%20-12.625%20L%2044.75%200%20Z%20M%2016.828125%20-24.609375%20L%2031.140625%20-24.609375%20L%2031.140625%20-41.96875%20Z%20M%2016.828125%20-24.609375%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",N2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='0d82974cc8'%3e%3cpath%20d='M%2017.898438%2024.789062%20L%20111.859375%2024.789062%20L%20111.859375%20118.753906%20L%2017.898438%20118.753906%20Z%20M%2017.898438%2024.789062%20'/%3e%3c/clipPath%3e%3cclipPath%20id='37694f020a'%3e%3cpath%20d='M%2064.878906%2024.789062%20C%2038.933594%2024.789062%2017.898438%2045.824219%2017.898438%2071.769531%20C%2017.898438%2097.71875%2038.933594%20118.753906%2064.878906%20118.753906%20C%2090.828125%20118.753906%20111.859375%2097.71875%20111.859375%2071.769531%20C%20111.859375%2045.824219%2090.828125%2024.789062%2064.878906%2024.789062%20Z%20M%2064.878906%2024.789062%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='22003a5ccc'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%230d82974cc8)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%2337694f020a)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.000119013%20C%2028.250074%20-0.000119013%200.0009548%2028.249%200.0009548%2063.092203%20C%200.0009548%2097.940652%2028.250074%20126.189771%2063.093277%20126.189771%20C%2097.941726%20126.189771%20126.185599%2097.940652%20126.185599%2063.092203%20C%20126.185599%2028.249%2097.941726%20-0.000119013%2063.093277%20-0.000119013%20Z%20M%2063.093277%20-0.000119013%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.789151)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(37.55493,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2026.390625%201.078125%20C%2021.203125%201.078125%2016.59375%20-0.0664062%2012.5625%20-2.359375%20C%208.539062%20-4.660156%205.578125%20-8.019531%203.671875%20-12.4375%20L%2015.484375%20-16.734375%20C%2016.316406%20-13.804688%2017.671875%20-11.789062%2019.546875%20-10.6875%20C%2021.429688%20-9.582031%2023.476562%20-9.03125%2025.6875%20-9.03125%20C%2028.84375%20-9.03125%2031.4375%20-9.957031%2033.46875%20-11.8125%20C%2035.5%20-13.664062%2036.515625%20-16.320312%2036.515625%20-19.78125%20C%2036.515625%20-23.476562%2035.453125%20-26.191406%2033.328125%20-27.921875%20C%2031.210938%20-29.648438%2028.753906%20-30.515625%2025.953125%20-30.515625%20C%2021.535156%20-30.515625%2018.253906%20-28.578125%2016.109375%20-24.703125%20L%204.03125%20-29.171875%20L%207.78125%20-59.78125%20L%2047.78125%20-59.78125%20L%2047.78125%20-48.671875%20L%2019.0625%20-48.671875%20L%2017.71875%20-37.5%20C%2019.09375%20-38.507812%2020.894531%20-39.28125%2023.125%20-39.8125%20C%2025.363281%20-40.351562%2027.53125%20-40.625%2029.625%20-40.625%20C%2033.195312%20-40.625%2036.578125%20-39.847656%2039.765625%20-38.296875%20C%2042.960938%20-36.742188%2045.5625%20-34.429688%2047.5625%20-31.359375%20C%2049.5625%20-28.285156%2050.5625%20-24.425781%2050.5625%20-19.78125%20C%2050.5625%20-15.238281%2049.441406%20-11.414062%2047.203125%20-8.3125%20C%2044.960938%20-5.21875%2042.007812%20-2.878906%2038.34375%20-1.296875%20C%2034.675781%200.285156%2030.691406%201.078125%2026.390625%201.078125%20Z%20M%2026.390625%201.078125%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",D2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='2a134d5da5'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='1436cb12ac'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='0d388df51e'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%232a134d5da5)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%231436cb12ac)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(36.669365,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2028.71875%201.078125%20C%2023%201.078125%2018.363281%20-0.113281%2014.8125%20-2.5%20C%2011.257812%20-4.882812%208.660156%20-8.222656%207.015625%20-12.515625%20C%205.378906%20-16.816406%204.5625%20-21.769531%204.5625%20-27.375%20C%204.5625%20-31.675781%205.035156%20-35.820312%205.984375%20-39.8125%20C%206.941406%20-43.8125%208.453125%20-47.390625%2010.515625%20-50.546875%20C%2012.578125%20-53.710938%2015.242188%20-56.21875%2018.515625%20-58.0625%20C%2021.796875%20-59.914062%2025.765625%20-60.84375%2030.421875%20-60.84375%20C%2034.953125%20-60.84375%2038.738281%20-60.050781%2041.78125%20-58.46875%20C%2044.832031%20-56.894531%2047.128906%20-54.796875%2048.671875%20-52.171875%20L%2036.515625%20-47.78125%20C%2035.910156%20-48.800781%2034.984375%20-49.59375%2033.734375%20-50.15625%20C%2032.484375%20-50.71875%2031.082031%20-51%2029.53125%20-51%20C%2026.363281%20-51%2023.78125%20-49.789062%2021.78125%20-47.375%20C%2019.789062%20-44.96875%2018.796875%20-41.195312%2018.796875%20-36.0625%20C%2020.285156%20-37.4375%2022.054688%20-38.507812%2024.109375%20-39.28125%20C%2026.171875%20-40.0625%2028.664062%20-40.453125%2031.59375%20-40.453125%20C%2035.113281%20-40.453125%2038.40625%20-39.628906%2041.46875%20-37.984375%20C%2044.539062%20-36.347656%2047.015625%20-34.019531%2048.890625%20-31%20C%2050.773438%20-27.988281%2051.71875%20-24.425781%2051.71875%20-20.3125%20C%2051.71875%20-16.195312%2050.734375%20-12.523438%2048.765625%20-9.296875%20C%2046.796875%20-6.078125%2044.082031%20-3.539062%2040.625%20-1.6875%20C%2037.164062%200.15625%2033.195312%201.078125%2028.71875%201.078125%20Z%20M%2028.640625%20-9.03125%20C%2031.554688%20-9.03125%2033.847656%20-10%2035.515625%20-11.9375%20C%2037.191406%20-13.882812%2038.03125%20-16.4375%2038.03125%20-19.59375%20C%2038.03125%20-22.757812%2037.191406%20-25.328125%2035.515625%20-27.296875%20C%2033.847656%20-29.265625%2031.523438%20-30.25%2028.546875%20-30.25%20C%2025.679688%20-30.25%2023.367188%20-29.289062%2021.609375%20-27.375%20C%2019.847656%20-25.46875%2018.96875%20-22.90625%2018.96875%20-19.6875%20C%2018.96875%20-16.46875%2019.847656%20-13.882812%2021.609375%20-11.9375%20C%2023.367188%20-10%2025.710938%20-9.03125%2028.640625%20-9.03125%20Z%20M%2028.640625%20-9.03125%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",L2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='d5d49c9923'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='0ef729529e'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='926e811c6f'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23d5d49c9923)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%230ef729529e)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(40.642754,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%207.421875%200%20L%2031.671875%20-48.59375%20L%201.34375%20-48.59375%20L%201.34375%20-59.78125%20L%2046.078125%20-59.78125%20L%2046.078125%20-48.59375%20L%2023.09375%200%20Z%20M%207.421875%200%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",k2="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAAXNSR0IArs4c6QAABFNJREFUeF7tnU1rFEEQhqvBrOQbveshCupiUG/iSfwNfgRP/h7Be0RBEG8q6EExAQ+5SMRLFBWPEjeiyWqCaxQSoaXdDNszzi61U907U8u7t52pqp59n+nu6o+ZNYu3flhS+rFkaab1icgo/QFEZACgXHgAUK7+qAEl6w8AACBQAJ2wQLwQrgAQQkVBDJc/H9puEBlGHmotz05wPUVcVWdBRJZWR2tFfndlfHQDsJbeTU9VRswiF6IewNvpKc0DYd1pKFlLAFCk3oXyAYBQShaMAwAFhQvlNgwAHt5JT0e7jDo7P513LE/DxK5XjH5j+eVkfY0l+jg+qbsTvvbkV0fvPAX9Y74azit7zj/GJSSI70bCp1tjutcD5p55AEI1DQOK4wCc3QKAAcn9fzEAUJr07YIBAADEChj0AWINRQEAQCSf3Fk9gNmWNx3NWBbY6zzCp65JCs5h4tmqBuAGYkvja2QUD8VUA3BD9ucTDcXyEwEAp8mIaAMAEcXlhAYAjkoRbQAgoric0ADAUSmijbm4sKV2e7qbDVoaW9edhp55sZABkHz1RzV5SzTt6bD2p9sSjH/r9FrmScrqVk62rM73xp8Z1r6siDexKLSZXX6sugZ83amHH9WKJO3PGQD60yu4NQAEl7S/gADQn17BrQEguKT9BQSA/vQKbq0ewMbOcWRBwW8LZkCXP5/b/VDBBy/4qzOqa4D7mRd2VyoIgHkHuSGs5oEYAPBBR7EEgCiy8oMCAF+rKJYAEEVWftChAHBq+ZE3G9otfeo1TdxNsFg+nWt0e0PP777RnQXdXZzzlOr2+ER2xxNnBjuWT/oaX43VdW9Lubd4haMmv10YpKW19HL8JAAMUvNUWQBQmvTtggEAAKQKGPQBUgll/gAg00/srR7AyugxVhZk/+0eql7CpxqAk/NwqyW+C8sMoB5AfWujTP3EZesHsLmhe0lScxbkmqA6AIhrYeEAAFBYujCOABBGx8JRhgLAg6eXU8mxy5fdtvP05vT0FHB2M3nnbOfdM9mcO4mbbGX3I+ZvTk/n7e2L7BxLLnqm1dTdCa/evlS90Qm3Tlii9emm7gc0vtzUDWDtYHPvAREutWrZGQAoFwgAlKs/AQAACBSwROgDBPqJXQFALKEsgCX6fGCTtR4gKyiet+o+wG3MGv19lMi9OCj1EtNezy+3B3T5zzhnX5zqDxF7vVQ1G9MHlleWN2DVnIY6AJM/T+geCQNAvOaFE1l9E4QawMEcyQZNUCRhuWEBgKtUJLvhADB/Ve90NFma2HZpaCTCAwhrvt2YVwyAaL9p6J6O3rx+Xy0A9+d4tZHXADCAmppbBACUpfxeuQAAAGIFDPoAsYaiAAAgkk/urB7AvpH3yILk90HBCNbS99qRnLn9bnPwfjnZNQR3zj+Wd03h/2hNdQ1wT0k2a/WC9KrhBgAlcwAAABAogCZIIF4IVwAIoaIgBgAIxAvhOgQA/gLvdplS6vruLgAAAABJRU5ErkJggg==",R2="/music-learning-tools/student-notation/assets/favicon-Bc4v39Jn.ico",H2="/music-learning-tools/student-notation/assets/favicon-BsWgUeI5.svg",O2="/music-learning-tools/student-notation/assets/atkinsonHyperlegibleNextBold-CRDaWt1k.otf",V2="/music-learning-tools/student-notation/assets/atkinsonHyperlegibleNextRegular-DOJsAlq1.otf",W2="/music-learning-tools/student-notation/assets/atkinsonHyperlegibleNextRegularItalic-DruWc0Qu.otf",G2="data:application/manifest+json;base64,ew0KICAibmFtZSI6ICJTdHVkZW50Tm90YXRpb24iLA0KICAic2hvcnRfbmFtZSI6ICJTTiIsDQogICJpY29ucyI6IFsNCiAgICB7DQogICAgICAic3JjIjogIi93ZWItYXBwLW1hbmlmZXN0LTE5MngxOTIucG5nIiwNCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwNCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIsDQogICAgICAicHVycG9zZSI6ICJtYXNrYWJsZSINCiAgICB9LA0KICAgIHsNCiAgICAgICJzcmMiOiAiL3dlYi1hcHAtbWFuaWZlc3QtNTEyeDUxMi5wbmciLA0KICAgICAgInNpemVzIjogIjUxMng1MTIiLA0KICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIiwNCiAgICAgICJwdXJwb3NlIjogIm1hc2thYmxlIg0KICAgIH0NCiAgXSwNCiAgInRoZW1lX2NvbG9yIjogIiNmZmZmZmYiLA0KICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwNCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSINCn0=",K2="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAAAXNSR0IArs4c6QAACJhJREFUeF7tncFuG1UYRv9rO0ElaRFSt0gsCgKhNu0esUasQeQ9eAvEA4DoBsQKNmUBgWwRVSWKEEKCZUkXNICUJhAQajIedF1PNRnZjok6OmN8solke+Zen29OPju6vk7b7/9Rhj8IgSJSPP/nnRimHjK+g0YkBeAuAwXg2FcjKwCYgQKA8MdDKwCYgQKA8BWAh68AfAY2AJiBAoDwbQAevgLwGdgAYAYKAMK3AXj4CsBnYAOAGSgACN8G4OErAJ+BDQBmoAAgfBuAh68AfAY2AJiBAoDwbQAevgLwGdgAYAZF9OLS4Z0oXA6NpaAAGPqIflnGT+vnYjCeQ/5gRoqI6ne+uX5bfar1x1Uf6Gge23xqnv8k28xHAWABvnvqQvTBOSz70AoAXgG5ARQADMAGYOErAMvfl0AwfwWAA7AB2AAUgOVvA8D8FQAOwAZgA1AAlr8NAPNXADgAG4ANQAFY/jYAzF8B4ABsADYABWD52wAwfwWAA7AB2AAUgOVvA8D8FQAOIDfA59fdHp2KIQvwwwVXg1L8Rw3w1o2//H4AKIFhDOPZf9ZjmBfy+4MQSJtf/K0ACPqI4yjjlf0no1AAKIEIBcDQKwCI/tHQCgCmYAOA8MdDKwCYgQKA8BWAh68AfAY2AJiBAoDwbQAevgLwGdgAYAYKAMK3AXj4CsBnYAOAGSgACN8G4OErAJ+BDQBmoAAgfBuAh68AfAY2AJiBAoDwbQAefhbg5f1zrgYFo7ABQPiDMsXW+k6sRO/hNwPUvxigPq/mgvV5lk+3dcy0Oeb5LuD8FQAVoBefrf88FgCcyBIPrQBg+INSAUD8o6EVAExAAUD4vgnm4SsAn4ENAGagACB8G4CHrwB8BjYAmIECgPBtAB6+AvAZ2ABgBgoAwrcBePgKwGdgA4AZKAAI3wbg4SsAn4ENAGagACB8G4CHrwB8Bun17fvuDg3lMBj24su1e64GhfjnYdO1m1sKAAWQooi7xy9GLxXQDBw2Xb71qQJA10EW4JcHGwoA8R81gAJw9BWAY1+NrABgBgoAwq/+C2QDcCEoAMfeBuDZhwLwIfgSCMxAAUD4vgTqAHz/C4SHYAOAEdgAIHwboAPwbQA8BBsAjMAGAOHbAB2AbwPgIdgAYAQ2AAjfBugAfBsAD8EGACOwAUD4NkAH4EcR9x5ccTUoGIUNAMLPnwJ47ugghqm+4f+kTfZnbcpffwLV42ad47+ea9L5Z0FbrPkrACjAUfTjtaNv4jj1wVks99AKAOavACB83wPw8BWAz8AGADNQABC+DcDDVwA+AxsAzEABQPg2AA9fAfgMbAAwAwUA4dsAPHwF4DOwAcAMFACEbwPw8BWAz8AGADNQABC+DcDDVwA+AxsAzEABQPhVA2zculHbHXraUtnmBtL15bvTnkRbx8xazrtY8z+KXrx69K2rQUEP0ofbm7UrNV/Yk3ZLb17w8+yo3tYx0+aYKS7W/PtlEV+vXY1B+P0AlAPpo+0357maqfn9r8fNAny1dk0BwJQVAISvACD86j2ADcCFoAAc+2pkGwDMQAFA+DYAD18B+AxsADADBQDh2wA8fAXgM7ABwAwUAIRvA/DwFYDPwAYAM1AAEL4NwMNXAD4DGwDMQAFA+DYAD18B+AxsADADBQDh2wA8/H55HDfzcujS5dBUGjYART4iipTi0sH+6Hf+mfVJh/o0q8fVf+f7698OMOlpNY+rj1kf+yyfuFjU+SsAKMBxSnF1bzeK1ANnsdxDKwCYvwKA8H0PwMNXAD4DGwDMQAFA+DYAD18B+AxsADADBQDh2wA8fAXgM7ABwAwUAIRvA/DwFYDPwAYAM1AAEL4NwMNXAD4DGwDMQAFA+DYAD18B+AxsADADBQDhVw3w8Za7Q1Mx5GXQLxzsxtDVoFQEkXauv3Fie/RqV//6jdN2+q8/9rRvA5h0f3OsWeeYNK9J1BZp/r1hit2nf4te6XJoyoC0+95JAaiJLOO4WYCdiwpAZq8AIH0FAOFX7wFsAC4EBeDYVyPbAGAGCgDCtwF4+ArAZ2ADgBkoAAjfBuDhKwCfgQ0AZqAAIHwbgIevAHwGNgCYgQKA8G0AHr4C8BnYAGAGCgDCtwF4+ArAZ2ADgBkoAAjfBugA/GGKuxd/j361HLra37w5tRML1sf7qJ82/baOmTbHPJ8FnL8NcNqF1OL9ZRRx/vBylGn8BRnTNuY/7cMWk+bY1jFn+fKAtubSfN7zjNOYvwK0eIGfduqHAlyJqAQ47QDvf+wEFOCxI53/hAowP6u2HqkAbZGd47wKMAeklh+iAC0DnnV6BQDh+18gHr4C8BnYAGAGCgDCtwF4+ArAZ2ADgBkoAAjfBuDhKwCfgQ0AZqAAIHwbgIevAHwGNgCYgQKA8G0AHr4C8BnYAGAGCgDCf9QA7242V47zs1qSGeRl0OcPX3I1KJh32nvng5oAsxZ712dZPa7+O99ffSJimlPN4/Ixs26bROYsC9Kb5+nG/MuyH0/0f4yIPngJLPfQ6f7bn9gA0DWQBVhdua0AEP/Rn18F4OgrAMe+GlkBwAwUAIRfvQm2AbgQFIBjbwPw7EMB+BB8CQRmoAAgfF8C8fAVgM/ABgAzUAAQvg3Aw1cAPgMbAMxAAUD4NgAPXwH4DGwAMAMFAOHbADx8BeAzsAHADBQAhG8D8PCzAIOV7yNiMJ7MvJvv15edV3uCT7qt+Ryby9WnLQufxWbeOU4bO9/enfnbAKAHqSxib/WZSKMLwh+CgAIQ1Kv6LYv4dXUjejH+ggxwLss6tAKAyecGUAAwAD8QA8NXADYABWD52wAs/zy6L4HADBQAhO+/QTsA35dAeAg2ABiBDQDCtwE6AN8GwEOwAcAIbAAQvg3QAfg2AB6CDQBGYAOA8G2ADsC3AfAQbAAwAhsAhG8DdAC+DYCHYAOAEdgAIPzx0P8CpKm0wymYN9kAAAAASUVORK5CYII=",q2="/music-learning-tools/student-notation/assets/web-app-manifest-512x512-Dz8l3SBy.png",zu=`<div id="app-loading-screen">\r
  <div class="loading-container">\r
    <div class="loading-logo">\r
      <svg viewBox="0 0 100 100" class="logo-svg">\r
        <circle cx="50" cy="50" r="45" class="logo-circle" />\r
        <path d="M 30 50 Q 50 30, 70 50 T 70 70" class="logo-path" />\r
      </svg>\r
    </div>\r
    <h1 class="loading-title">Student Notation</h1>\r
    <div class="loading-progress-container">\r
      <div class="loading-progress-bar">\r
        <div class="loading-progress-fill" id="loading-progress-fill"></div>\r
      </div>\r
      <div class="loading-progress-text" id="loading-progress-text">0%</div>\r
    </div>\r
    <div class="loading-status" id="loading-status">Initializing...</div>\r
  </div>\r
</div>\r
<!-- Sidebar for File/App Actions -->\r
<div id="sidebar-overlay"></div>\r
<aside id="sidebar" role="complementary" aria-label="Application settings and controls">\r
<div class="sidebar-container">\r
<div class="app-title">Student Notation</div>\r
</div>\r
<div class="sidebar-container">\r
<button class="sidebar-button" id="save-as-button" title="Save As"><img src="assets/sidebar/saveAs.svg" alt="Save As"><span class="sidebar-button-text">Save As</span></button>\r
<button class="sidebar-button" id="import-button" title="Open"><img src="assets/sidebar/open.svg" alt="Open"><span class="sidebar-button-text">Open</span></button>\r
<button class="sidebar-button" id="print-button" title="Print"><img src="assets/sidebar/print.svg" alt="Print"><span class="sidebar-button-text">Print</span></button>\r
<button class="sidebar-button" id="reset-canvas-button" title="New File"><img src="assets/sidebar/newPage.svg" alt="New Page"><span class="sidebar-button-text">New Page</span></button>\r
</div>\r
<div class="sidebar-container">\r
<h4 class="sidebar-section-header">Handoff</h4>\r
<button class="sidebar-button" id="take-to-singing-trainer-button" title="Take to Singing Trainer">\r
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\r
<path d="M7 17L17 7"/><path d="M7 7h10v10"/>\r
</svg>\r
<span class="sidebar-button-text">Take to Singing Trainer</span></button>\r
</div>\r
<div class="sidebar-container">\r
<button class="sidebar-button" id="hide-drumgrid-toggle" title="Toggle Drum Grid"><img src="assets/sidebar/hideDrums.svg" alt="Toggle Drum Grid"><span class="sidebar-button-text">Hide Drum Grid</span></button>\r
<button class="sidebar-button" id="hide-buttongrid-toggle" title="Toggle Button Grid"><img src="assets/sidebar/hideAnalysis.svg" alt="Toggle Button Grid"><span class="sidebar-button-text">Hide Button Grid</span></button>\r
<div class="sidebar-legend-toggle-row" role="group" aria-label="Legend visibility">\r
  <button class="sidebar-toggle-button" id="hide-leftlegend-toggle" type="button">Hide Left Legend</button>\r
  <button class="sidebar-toggle-button" id="hide-rightlegend-toggle" type="button">Hide Right Legend</button>\r
</div>\r
</div>\r
<div class="sidebar-container">\r
<h4 class="sidebar-section-header">Long Notes Style</h4>\r
<div class="toggle-button-group"><button class="sidebar-toggle-button active" id="long-note-style1-btn">Circle & Tails</button><button class="sidebar-toggle-button" id="long-note-style2-btn">Stadium</button></div>\r
</div>\r
<div class="sidebar-container">\r
<h4 class="sidebar-section-header">Playhead</h4>\r
<div class="toggle-button-group"><button class="sidebar-toggle-button active" id="playhead-mode-cursor-btn">Cursor Playhead</button><button class="sidebar-toggle-button" id="playhead-mode-microbeat-btn">Pulsing Microbeat</button><button class="sidebar-toggle-button" id="playhead-mode-macrobeat-btn">Pulsing Macrobeat</button></div>\r
</div>\r
</aside>\r
<main id="app-container" role="main">\r
  <!-- Toolbar Container -->\r
  <nav id="toolbar" role="navigation" aria-label="Music notation tools">\r
    <!-- Primary Toolbar -->\r
    <div id="toolbar-primary" class="toolbar-primary">\r
        <div class="primary-toolbar-grid-5x5">\r
            <!-- Row 1: settings, volume, blue notes -->\r
            <button class="toolkit-icon-button" id="settings-button" title="Settings"><img src="assets/icons/settings.svg" alt="Settings"></button>\r
            <div id="volume-control-wrapper">\r
                <button class="toolkit-icon-button" id="volume-icon-button" aria-label="Volume" title="Volume"><img src="assets/icons/volume.svg" alt="Volume"></button>\r
                <div id="volume-popup">\r
                    <input type="range" id="vertical-volume-slider" orient="vertical" min="0" max="100" value="70" step="1" />\r
                </div>\r
            </div>\r
            <div class="note circle-note" data-type="circle" data-color="#4a90e2"></div>\r
            <div class="note oval-note" data-type="oval" data-color="#4a90e2"></div>\r
            <div class="note diamond-note" data-type="diamond" data-color="#4a90e2" aria-label="Sixteenth note jewel">\r
                <svg class="diamond-icon" viewBox="0 0 120 120" aria-hidden="true" focusable="false">\r
                    <path d="M60 5 L35 48.3 L35 71.7 L60 115 L85 71.7 L85 48.3 Z" />\r
                </svg>\r
            </div>\r
            <!-- Row 2: zoom in/out, black notes -->\r
            <button class="toolkit-icon-button" id="grid-zoom-in" title="Zoom In"><img src="assets/icons/zoomIn.svg" alt="Zoom In"></button>\r
            <button class="toolkit-icon-button" id="grid-zoom-out" title="Zoom Out"><img src="assets/icons/zoomOut.svg" alt="Zoom Out"></button>\r
            <div class="note circle-note" data-type="circle" data-color="#2d2d2d"></div>\r
            <div class="note oval-note" data-type="oval" data-color="#2d2d2d"></div>\r
            <div class="note diamond-note" data-type="diamond" data-color="#2d2d2d" aria-label="Sixteenth note jewel">\r
                <svg class="diamond-icon" viewBox="0 0 120 120" aria-hidden="true" focusable="false">\r
                    <path d="M60 5 L35 48.3 L35 71.7 L60 115 L85 71.7 L85 48.3 Z" />\r
                </svg>\r
            </div>\r
            <!-- Row 3: redo/undo, red notes -->\r
            <button class="toolkit-icon-button" id="redo-button" title="Redo"><img src="assets/icons/redo.svg" alt="Redo"></button>\r
            <button class="toolkit-icon-button" id="undo-button" title="Undo"><img src="assets/icons/undo.svg" alt="Undo"></button>\r
            <div class="note circle-note" data-type="circle" data-color="#d66573"></div>\r
            <div class="note oval-note" data-type="oval" data-color="#d66573"></div>\r
            <div class="note diamond-note" data-type="diamond" data-color="#d66573" aria-label="Sixteenth note jewel">\r
                <svg class="diamond-icon" viewBox="0 0 120 120" aria-hidden="true" focusable="false">\r
                    <path d="M60 5 L35 48.3 L35 71.7 L60 115 L85 71.7 L85 48.3 Z" />\r
                </svg>\r
            </div>\r
            <!-- Row 4: clear/eraser, green notes -->\r
            <button class="toolkit-icon-button" id="clear-button" title="Clear"><img src="assets/icons/clear.svg" alt="Clear"></button>\r
            <button class="toolkit-icon-button eraser-button" id="eraser-tool-button" title="Eraser">\r
                <img src="assets/icons/eraser.svg" alt="Eraser" class="eraser-icon">\r
            </button>\r
            <div class="note circle-note" data-type="circle" data-color="#68a03f"></div>\r
            <div class="note oval-note" data-type="oval" data-color="#68a03f"></div>\r
            <div class="note diamond-note" data-type="diamond" data-color="#68a03f" aria-label="Sixteenth note jewel">\r
                <svg class="diamond-icon" viewBox="0 0 120 120" aria-hidden="true" focusable="false">\r
                    <path d="M60 5 L35 48.3 L35 71.7 L60 115 L85 71.7 L85 48.3 Z" />\r
                </svg>\r
            </div>\r
            <!-- Row 5: lasso/marker shortcuts, playback controls -->\r
            <button class="toolkit-icon-button" id="lasso-shortcut-button" title="Lasso Tool">\r
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="3 2">\r
                    <ellipse cx="12" cy="12" rx="8" ry="6" transform="rotate(-15 12 12)"/>\r
                </svg>\r
            </button>\r
            <button class="toolkit-icon-button" id="marker-shortcut-button" title="Marker Tool">\r
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                    <path d="M18 2L6 14l-2 6 6-2L22 6l-4-4z"/>\r
                    <line x1="14" y1="6" x2="18" y2="10"/>\r
                </svg>\r
            </button>\r
            <button class="toolkit-icon-button" id="play-button" title="Play"><img src="assets/icons/play.svg" alt="Play"></button>\r
            <button class="toolkit-icon-button" id="stop-button" title="Stop"><img src="assets/icons/stop.svg" alt="Stop"></button>\r
            <button class="toolkit-icon-button" id="loop-button" title="Loop"><img src="assets/icons/loop.svg" alt="Loop"></button>\r
        </div>\r
    </div>\r
    <!-- Secondary Toolbar -->\r
    <div id="toolbar-secondary" class="toolbar-secondary">\r
        <div class="tab-sidebar">\r
            <button class="tab-button" data-tab="timbre">Timbre</button>\r
            <button class="tab-button" data-tab="pitch">Pitch</button>\r
            <button class="tab-button" data-tab="rhythm">Rhythm</button>\r
        </div>\r
        <div class="tab-content">\r
            <!-- Timbre Tab -->\r
            <div class="tab-panel" id="timbre-panel">\r
                <!-- Presets/Effects Section (Separate) -->\r
                <div class="control-section preset-effects-container">\r
                    <div class="preset-effects-controls">\r
                            <div class="preset-effects-tabs">\r
                                <button class="preset-tab-button active" data-preset-tab="presets">Presets</button>\r
                                <button class="preset-tab-button" data-preset-tab="effects">Effects</button>\r
                            </div>\r
                            <div class="preset-effects-content">\r
                                <!-- Presets Tab -->\r
                                <div class="preset-tab-panel active" id="presets-panel">\r
                            <div class="preset-content-box">\r
                                <div class="preset-grid" id="preset-buttons">\r
                                    <div class="preset-column">\r
                                        <button class="preset-button" id="preset-sine">Sine</button>\r
                                        <button class="preset-button" id="preset-triangle">Triangle</button>\r
                                        <button class="preset-button" id="preset-square">Square</button>\r
                                        <button class="preset-button" id="preset-sawtooth">Sawtooth</button>\r
                                    </div>\r
                                    <div class="preset-column">\r
                                        <button class="preset-button" id="preset-piano">Piano</button>\r
                                        <button class="preset-button" id="preset-marimba">Marimba</button>\r
                                        <button class="preset-button" id="preset-woodwind">Woodwind</button>\r
                                        <button class="preset-button" id="preset-strings">Strings</button>\r
                                    </div>\r
                                </div>\r
                            </div>\r
                        </div>\r
                        <!-- Effects Tab -->\r
                        <div class="preset-tab-panel" id="effects-panel">\r
                            <div class="effects-content-box">\r
                                <div class="position-controls-container">\r
                                    <div class="position-control-group">\r
                                        <h5 class="position-label">Delay</h5>\r
                                        <div class="position-component-wrapper">
                                            <div class="position-component" id="delay-position" data-svelte-component="effects-cartesian-slider" data-effect="delay"></div>
                                            <div id="delay-mix-wrapper"></div>
                                        </div>
                                        <div class="position-axis-labels" data-axis-x="Time" data-axis-y="Echoes"></div>\r
                                    </div>\r
                                    <div class="position-control-group">\r
                                        <h5 class="position-label">Vibrato</h5>\r
                                        <div class="position-component-wrapper">
                                            <div class="position-component" id="vibrato-position" data-svelte-component="effects-cartesian-slider" data-effect="vibrato"></div>
                                            <div id="vibrato-mix-wrapper"></div>
                                        </div>
                                        <div class="position-axis-labels" data-axis-x="Speed" data-axis-y="Span"></div>\r
                                    </div>\r
                                    <div class="position-control-group">\r
                                        <h5 class="position-label">Tremolo</h5>\r
                                        <div class="position-component-wrapper">
                                            <div class="position-component" id="tremolo-position" data-svelte-component="effects-cartesian-slider" data-effect="tremolo"></div>
                                            <div id="tremolo-mix-wrapper"></div>
                                        </div>
                                        <div class="position-axis-labels" data-axis-x="Speed" data-axis-y="Span"></div>\r
                                    </div>\r
                                </div>\r
                            </div>\r
                        </div>                        \r
                        <div class="effect-controls-container" id="effect-controls" style="display: none;">\r
                            <!-- Effect controls will be dynamically inserted here for data synchronization -->\r
                        </div>\r
                            </div>\r
                    </div>\r
                </div>\r
                <div class="control-section filter-container">\r
                    <!-- Row 1, Col 1: Blend slider -->\r
                    <div class="blend-slider-container"><div id="blend-slider-container"><div class="filter-blend-thumb" id="thumb-b" tabindex="0">B</div></div></div>\r
                    <!-- Row 2, Col 1: Bins grid (appended via JS) -->\r
                    <div class="filter-bins-wrapper"></div>\r
                    <!-- Row 3, Col 1: Cutoff slider -->\r
                    <div id="cutoff-slider-container"><div class="filter-cutoff-thumb" id="thumb-c" tabindex="0">C</div></div>\r
                    <!-- Row 2, Col 2: Vertical M slider (appended via JS) -->\r
                    <div class="filter-vertical-blend-wrapper"></div>\r
                </div>\r
                <div class="control-section adsr-container">\r
                    <!-- Row 1, Col 1: ADSR graph -->\r
                    <div class="adsr-graph-wrapper"><div id="adsr-envelope"></div></div>\r
                    <!-- Row 1, Col 2: Sustain slider -->\r
                    <div class="sustain-slider-wrapper"><div id="sustain-slider-track"><div id="sustain-slider-thumb" tabindex="0">S</div></div></div>\r
                    <!-- Row 2, Col 1: ADR slider -->\r
                    <div id="multi-thumb-slider-container"><div class="time-slider-thumb" id="thumb-a" tabindex="0">A</div><div class="time-slider-thumb" id="thumb-d" tabindex="0">D</div><div class="time-slider-thumb" id="thumb-r" tabindex="0">R</div></div>\r
                </div>\r
                  <!-- Waveform Section (Separate) -->\r
                  <div class="control-section">\r
                      <div class="waveform-section">\r
                          <div class="waveform-content-box">\r
                              <div class="waveform-display-wrapper">\r
                                  <canvas id="static-waveform-canvas"></canvas>\r
                                  <div class="waveform-speed-controls">\r
                                      <button class="waveform-speed-btn" data-speed="50">50%</button>\r
                                      <button class="waveform-speed-btn" data-speed="10">10%</button>\r
                                  </div>\r
                              </div>\r
                          </div>\r
                      </div>\r
                  </div>\r
              </div>\r
              <!-- Pitch Tab -->\r
            <div class="tab-panel" id="pitch-panel">\r
                <div class="control-section pitch-tabs-container">\r
                    <div class="pitch-tabs">\r
                        <button class="pitch-tab-button active" data-pitch-tab="range">Range</button>\r
                        <button class="pitch-tab-button" data-pitch-tab="chords">Chords</button>\r
                        <button class="pitch-tab-button" data-pitch-tab="draw">Draw</button>\r
                    </div>\r
                    <div class="pitch-tab-content">\r
                        <div class="pitch-tab-panel active" id="range-panel">\r
                            <div class="range-content-box">\r
                                <div class="range-layout">\r
                                   <div class="range-panel-section modes-section">\r
                                       <!-- <h4 class="panel-section-title">Modes</h4> -->\r
                                       <div class="tonic-modes-container">\r
                                           <div class="tonic-modes-grid">\r
                                               <button class="tonic-mode-button" data-tonic="1">\r
                                                   <img src="assets/tabicons/tonicShape_1.svg" alt="Major" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Major</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="2">\r
                                                   <img src="assets/tabicons/tonicShape_2.svg" alt="Dorian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Dorian</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="3">\r
                                                   <img src="assets/tabicons/tonicShape_3.svg" alt="Phrygian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Phrygian</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="4">\r
                                                   <img src="assets/tabicons/tonicShape_4.svg" alt="Lydian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Lydian</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="5">\r
                                                   <img src="assets/tabicons/tonicShape_5.svg" alt="Mixolydian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Mixolydian</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="6">\r
                                                   <img src="assets/tabicons/tonicShape_6.svg" alt="Minor" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Minor</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="7">\r
                                                   <img src="assets/tabicons/tonicShape_7.svg" alt="Locrian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Locrian</span>\r
                                               </button>\r
                                           </div>\r
                                       </div>\r
                                   </div>\r
                                   <div class="range-panel-section degrees-section">\r
                                       <!-- <h4 class="panel-section-title">Degrees</h4> -->\r
                                       <div class="degree-visibility-toggle-container">\r
                                           <button class="degree-visibility-button" id="degree-visibility-toggle" type="button">\r
                                               Show Degrees\r
                                           </button>\r
                                       </div>\r
                                       <div class="degree-mode-toggle-container" id="degree-mode-toggle">\r
                                           <button class="degree-mode-button" data-mode="diatonic" type="button">Scale</button>\r
                                           <button class="degree-mode-button" data-mode="modal" type="button">Mode</button>\r
                                       </div>\r
                                       <label class="checkbox-label">\r
                                            <input type="checkbox" id="focus-colours-toggle">\r
                                            <span class="checkbox-text">Focus Colours</span>\r
                                        </label>\r
                                   </div>\r
                                   <div class="range-panel-section wheels-section">\r
                                       <!-- <h4 class="panel-section-title">Select Range</h4> -->\r
                                       <div class="clef-wheels-wrapper">\r
                                           <div class="clef-picker-column">\r
                                               <div class="clef-wheel" id="clef-top-wheel" tabindex="0" aria-label="Select top note">\r
                                                   <div class="clef-wheel-viewport">\r
                                                       <div class="clef-wheel-options"></div>\r
                                                   </div>\r
                                                   <div class="clef-wheel-overlay"></div>\r
                                               </div>\r
                                           </div>\r
                                           <div class="clef-picker-column">\r
                                               <div class="clef-wheel" id="clef-bottom-wheel" tabindex="0" aria-label="Select bottom note">\r
                                                   <div class="clef-wheel-viewport">\r
                                                       <div class="clef-wheel-options"></div>\r
                                                   </div>\r
                                                   <div class="clef-wheel-overlay"></div>\r
                                               </div>\r
                                           </div>\r
                                       </div>\r
                                   </div>\r
                                   <div class="range-panel-section presets-section">\r
                                       <!-- <h4 class="panel-section-title">Presets</h4> -->\r
                                       <div class="clef-presets-column">\r
                                           <div class="clef-preset-buttons">\r
                                               <button class="toolkit-button clef-preset-button" id="clef-full-range-button" type="button">\r
                                                   Full Range\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-treble-button" type="button">\r
                                                   Treble\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-alto-button" type="button">\r
                                                   Alto\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-bass-button" type="button">\r
                                                   Bass\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-voice1-button" type="button">\r
                                                   Voice I\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-voice2-button" type="button">\r
                                                   Voice II\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-voice3-button" type="button">\r
                                                   Voice III\r
                                               </button>\r
                                           </div>\r
                                       </div>\r
                                   </div>\r
                                </div>\r
                        </div>\r
                    </div>\r
                        <div class="pitch-tab-panel" id="chords-panel">\r
            <div class="chords-content-box">\r
                <div class="chords-layout">\r
                    <div class="chords-panel-section intervals-grid-section">\r
                        <h4 class="panel-section-title">Intervals</h4>\r
                        <div class="intervals-grid-column">\r
                            <div class="harmony-preset-grid intervals-4x4-grid">\r
                                <button class="harmony-preset-button">M6</button>\r
                                <button class="harmony-preset-button">A6</button>\r
                                <button class="harmony-preset-button">m7</button>\r
                                <button class="harmony-preset-button">M7</button>\r
                                <button class="harmony-preset-button">d5</button>\r
                                <button class="harmony-preset-button">P5</button>\r
                                <button class="harmony-preset-button">A5</button>\r
                                <button class="harmony-preset-button">m6</button>\r
                                <button class="harmony-preset-button">m3</button>\r
                                <button class="harmony-preset-button">M3</button>\r
                                <button class="harmony-preset-button">P4</button>\r
                                <button class="harmony-preset-button">A4</button>\r
                                <button class="harmony-preset-button">U</button>\r
                                <button class="harmony-preset-button">m2</button>\r
                                <button class="harmony-preset-button">M2</button>\r
                                <button class="harmony-preset-button">A2</button>\r
                            </div>\r
                        </div>\r
                    </div>\r
                    <div class="chords-panel-section unified-position-section">\r
                        <h4 class="panel-section-title">Position</h4>\r
                        <div class="unified-position-column">\r
                            <div class="unified-position-toggle" id="unified-position-toggle">\r
                                <div class="left-labels">\r
                                    <span class="state-label" data-step="0">Asc.</span>\r
                                    <span class="state-label" data-step="1">Desc.</span>\r
                                </div>\r
                                <div class="toggle-track">\r
                                    <div class="unified-slider"></div>\r
                                </div>\r
                                <div class="right-labels">\r
                                    <span class="state-label" data-step="0">Root</span>\r
                                    <span class="state-label" data-step="1">1st</span>\r
                                    <span class="state-label" data-step="2">2nd</span>\r
                                    <span class="state-label" data-step="3">3rd</span>\r
                                    <span class="state-label" data-step="4">4th</span>\r
                                    <span class="state-label" data-step="5">5th</span>\r
                                </div>\r
                            </div>\r
                        </div>\r
                    </div>\r
                    <div class="chords-panel-section chords-grid-section">\r
                        <h4 class="panel-section-title">Chords</h4>\r
                        <div class="chords-grid-column">\r
                            <div class="harmony-preset-grid chords-grid chords-grid-6col" id="chords-preset-grid">\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;]" title="Major triad">X</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;]" title="Minor triad">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5d&quot;]" title="Diminished triad">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;6m&quot;]" title="Augmented triad">X+</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7m&quot;]" title="Dominant 7">X</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;7m&quot;]" title="Minor 7">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7M&quot;]" title="Major 7">Xmaj</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5d&quot;, &quot;7m&quot;]" title="Half-diminished 7"></button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5d&quot;, &quot;6M&quot;]" title="Fully diminished 7">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;6M&quot;]" title="Major 6">X</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;2M&quot;, &quot;5P&quot;]" title="Suspended 2">Xsus2</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;4P&quot;, &quot;5P&quot;]" title="Suspended 4">Xsus4</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;7M&quot;]" title="Minor-major 7">xmaj</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;9M&quot;]" title="Major add 9">Xadd9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;9M&quot;]" title="Minor add 9">xadd9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;6M&quot;, &quot;9M&quot;]" title="Major 6/9">X6/9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;]" title="Dominant 9">X9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;, &quot;11P&quot;]" title="Dominant 11">X11</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;, &quot;13M&quot;]" title="Dominant 13">X13</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7M&quot;, &quot;9M&quot;]" title="Major 9">Xmaj9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;]" title="Minor 9">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;6M&quot;]" title="Minor 6">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;, &quot;11P&quot;]" title="Minor 11">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7M&quot;, &quot;11A&quot;]" title="Major 7 sharp 11 (Lydian)">Xmaj711</button>\r
                            </div>\r
                        </div>\r
                    </div>\r
                </div>\r
            </div>\r
        </div>\r
                        <div class="pitch-tab-panel" id="draw-panel">\r
                            <div class="draw-content-box">\r
                                <div class="draw-layout-grid">\r
                                    <!-- Arrow Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-arrow-controls" data-draw-tool="arrow">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="arrow" title="Arrow Tool">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                    <line x1="4" y1="20" x2="20" y2="4"/>\r
                                                    <polyline points="14,4 20,4 20,10"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="arrow-tool-options">\r
                                            <div class="draw-option-group">\r
                                                <div class="draw-toolbar-row">\r
                                                    <!-- Stroke weight popup -->\r
                                                    <div class="draw-popup-trigger">\r
                                                        <button class="draw-toolbar-button" title="Stroke width">\r
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                                <line x1="4" y1="12" x2="20" y2="12"/>\r
                                                            </svg>\r
                                                        </button>\r
                                                        <div class="draw-popup-menu">\r
                                                            <div class="draw-option-label">Stroke</div>\r
                                                            <input type="range" id="arrow-stroke-weight" min="1" max="20" value="4" aria-label="Arrow stroke weight">\r
                                                        </div>\r
                                                    </div>\r
\r
                                                    <!-- Line style popup -->\r
                                                    <div class="draw-popup-trigger">\r
                                                        <button class="draw-toolbar-button" title="Line style">\r
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                                <line x1="4" y1="8" x2="20" y2="8" stroke-dasharray="4 3"/>\r
                                                                <line x1="4" y1="16" x2="20" y2="16"/>\r
                                                            </svg>\r
                                                        </button>\r
                                                        <div class="draw-popup-menu">\r
                                                            <div class="draw-option-label">Line Style</div>\r
                                                            <div class="draw-button-group">\r
                                                                <button class="draw-option-button active" data-line-style="solid">Solid</button>\r
                                                                <button class="draw-option-button" data-line-style="dashed">Dashed</button>\r
                                                            </div>\r
                                                        </div>\r
                                                    </div>\r
                                                </div>\r
                                                <div class="draw-toolbar-row">\r
                                                    <!-- Left arrowhead popup -->\r
                                                    <div class="draw-popup-trigger">\r
                                                        <button class="draw-toolbar-button" id="arrow-start-head-trigger" title="Start head">\r
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                                <polyline points="9,5 3,12 9,19"/>\r
                                                                <line x1="3" y1="12" x2="21" y2="12"/>\r
                                                            </svg>\r
                                                        </button>\r
                                                                <div class="draw-popup-menu">\r
                                                                    <div class="draw-option-label">Start</div>\r
                                                                    <div class="draw-button-group">\r
                                                                    <button class="draw-option-button active" data-arrow-start="none">No head</button>\r
                                                                    <button class="draw-option-button" data-arrow-start="filled-arrow">Arrow</button>\r
                                                                    </div>\r
                                                                </div>\r
                                                            </div>\r
                                                    <!-- Swap heads -->\r
                                                    <button class="draw-toolbar-button" id="arrow-swap-heads" title="Swap heads">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <polyline points="9 5 15 5 15 11"/>\r
                                                            <polyline points="15 19 9 19 9 13"/>\r
                                                            <line x1="9" y1="5" x2="5" y2="9"/>\r
                                                            <line x1="15" y1="19" x2="19" y2="15"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <!-- Right arrowhead popup -->\r
                                                    <div class="draw-popup-trigger">\r
                                                        <button class="draw-toolbar-button" id="arrow-end-head-trigger" title="End head">\r
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                                <polyline points="15,5 21,12 15,19"/>\r
                                                                <line x1="3" y1="12" x2="21" y2="12"/>\r
                                                            </svg>\r
                                                        </button>\r
                                                                <div class="draw-popup-menu">\r
                                                                    <div class="draw-option-label">End</div>\r
                                                                    <div class="draw-button-group">\r
                                                                    <button class="draw-option-button active" data-arrow-end="filled-arrow">Arrow</button>\r
                                                                    <button class="draw-option-button" data-arrow-end="none">No head</button>\r
                                                                    </div>\r
                                                                    <div class="draw-option-label">Head Size</div>\r
                                                                    <input type="range" id="arrow-head-size" min="8" max="32" value="12" aria-label="Arrowhead size">\r
                                                                </div>\r
                                                            </div>\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                    <!-- Text Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-text-controls" data-draw-tool="text">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="text" title="Text Tool">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                    <polyline points="4,7 4,4 20,4 20,7"/>\r
                                                    <line x1="12" y1="4" x2="12" y2="20"/>\r
                                                    <line x1="9" y1="20" x2="15" y2="20"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="text-tool-options">\r
                                            <div class="draw-option-group draw-toolbar-row">\r
                                                <!-- Size popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Text size">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <path d="M4 18h16"/>\r
                                                            <path d="M8 18l4-12 4 12"/>\r
                                                            <path d="M10 12h4"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Size (px)</div>\r
                                                        <input type="number" id="text-size-input" min="8" max="72" value="16" aria-label="Text size (px)">\r
                                                    </div>\r
                                                </div>\r
                                                <!-- Colour popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Text colour">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <path d="M12 3l6 16"/>\r
                                                            <path d="M6 19l6-16"/>\r
                                                            <path d="M10 12h4"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Colour</div>\r
                                                        <div class="draw-color-picker">\r
                                                            <button class="draw-color-button active" data-color="#000000" style="background-color: #000000;" aria-label="Black text"></button>\r
                                                            <button class="draw-color-button" data-color="#4a90e2" style="background-color: #4a90e2;" aria-label="Blue text"></button>\r
                                                            <button class="draw-color-button" data-color="#d66573" style="background-color: #d66573;" aria-label="Red text"></button>\r
                                                            <button class="draw-color-button" data-color="#68a03f" style="background-color: #68a03f;" aria-label="Green text"></button>\r
                                                        </div>\r
                                                    </div>\r
                                                </div>\r
                                                <!-- Style buttons -->\r
                                                <div class="text-style-rows">\r
                                                    <div class="draw-button-group">\r
                                                        <button class="draw-option-button" data-text-style="bold">B</button>\r
                                                        <button class="draw-option-button" data-text-style="italic">I</button>\r
                                                        <button class="draw-option-button" data-text-style="underline">U</button>\r
                                                    </div>\r
                                                    <div class="draw-button-group">\r
                                                        <button class="draw-option-button" data-text-style="background">Bg</button>\r
                                                        <button class="draw-option-button" data-text-style="superscript">x<sup>2</sup></button>\r
                                                        <button class="draw-option-button" data-text-style="subscript">x<sub>2</sub></button>\r
                                                    </div>\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                    <!-- Marker Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-marker-controls" data-draw-tool="marker">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="marker" title="Marker Tool">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                    <!-- Pointed marker tip -->\r
                                                    <path d="M18 2L6 14l-2 6 6-2L22 6l-4-4z"/>\r
                                                    <line x1="10" y1="18" x2="6" y2="14"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="marker-tool-options">\r
                                            <div class="draw-option-group draw-toolbar-row">\r
                                                <!-- Size popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Marker size">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <path d="M6 19l12-14"/>\r
                                                            <path d="M6 19l-2 4 4-2"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Size</div>\r
                                                        <input type="range" id="marker-size-input" min="2" max="20" value="6" aria-label="Marker size">\r
                                                    </div>\r
                                                </div>\r
                                                <!-- Colours popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Marker colour">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <path d="M19 4l-7 7"/>\r
                                                            <path d="M5 20l3.5-1.5"/>\r
                                                            <path d="M16 7l1.5 1.5"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Colours</div>\r
                                                        <div class="draw-color-picker">\r
                                                            <button class="draw-color-button" data-color="#4a90e2" style="background-color: #4a90e2;" aria-label="Blue marker"></button>\r
                                                            <button class="draw-color-button" data-color="#2d2d2d" style="background-color: #2d2d2d;" aria-label="Black marker"></button>\r
                                                            <button class="draw-color-button" data-color="#d66573" style="background-color: #d66573;" aria-label="Red marker"></button>\r
                                                            <button class="draw-color-button" data-color="#68a03f" style="background-color: #68a03f;" aria-label="Green marker"></button>\r
                                                        </div>\r
                                                    </div>\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                    <!-- Highlighter Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-highlighter-controls" data-draw-tool="highlighter">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="highlighter" title="Highlighter Tool">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" opacity="0.5">\r
                                                    <!-- Flat highlighter head -->\r
                                                    <rect x="3" y="3" width="4" height="18" rx="1"/>\r
                                                    <path d="M7 5h12l-2 14H7z"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="highlighter-tool-options">\r
                                            <div class="draw-option-group draw-toolbar-row">\r
                                                <!-- Size popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Highlighter size">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <rect x="5" y="5" width="10" height="10" rx="2"/>\r
                                                            <path d="M9 15l-2 4"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Size</div>\r
                                                        <input type="range" id="highlighter-size-input" min="4" max="30" value="10" aria-label="Highlighter size">\r
                                                    </div>\r
                                                </div>\r
                                                <!-- Colours popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Highlighter colour">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <rect x="7" y="7" width="10" height="10" rx="2"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Colours</div>\r
                                                        <div class="draw-color-picker">\r
                                                            <button class="draw-color-button" data-color="#9fc5ff" style="background-color: #9fc5ff;" aria-label="Light blue highlighter"></button>\r
                                                            <button class="draw-color-button" data-color="#c2c2c2" style="background-color: #c2c2c2;" aria-label="Gray highlighter"></button>\r
                                                            <button class="draw-color-button" data-color="#ffd166" style="background-color: #ffd166;" aria-label="Yellow highlighter"></button>\r
                                                        </div>\r
                                                    </div>\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                    <!-- Lasso Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-lasso-controls" data-draw-tool="lasso">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="lasso" title="Lasso Select">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="3 2">\r
                                                    <ellipse cx="12" cy="12" rx="8" ry="6" transform="rotate(-15 12 12)"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="lasso-tool-options">\r
                                            <div class="draw-option-group draw-toolbar-row">\r
                                                <div class="draw-option-help">\r
                                                    Draw around notes to select and drag them as a group.\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                </div>\r
                            </div>\r
                        </div>\r
                    </div>\r
                </div>\r
            </div>\r
            <!-- Rhythm Tab -->\r
            <div class="tab-panel" id="rhythm-panel">\r
\r
                <!-- Stamps/Triplets Section (Separate) -->\r
                <div class="control-section rhythm-stamp-tabs-container">\r
                    <div class="rhythm-stamp-tabs-controls">\r
                        <div class="rhythm-tab-stamps">\r
                            <button class="rhythm-tab-button rhythm-stamp-tab-button active" data-rhythm-stamp-tab="sixteenth">Sixteenths</button>\r
                            <button class="rhythm-tab-button rhythm-stamp-tab-button" data-rhythm-stamp-tab="triplet">Triplets</button>\r
                        </div>\r
                        <div class="rhythm-stamp-tab-content">\r
                            <div class="rhythm-stamp-tab-panel active" id="sixteenth-stamps-panel">\r
                                <div id="sixteenth-stamps-toolbar-container" class="sixteenth-stamps-toolbar-container">\r
                                    <!-- Stamps toolbar will be rendered here by JavaScript -->\r
                                </div>\r
                            </div>\r
                            <div class="rhythm-stamp-tab-panel" id="triplet-stamps-panel">\r
                                <div id="triplet-stamps-toolbar-container" class="triplet-stamps-toolbar-container">\r
                                    <!-- Triplets toolbar will be rendered here by JavaScript -->\r
                                </div>\r
                            </div>\r
                        </div>\r
                    </div>\r
                </div>\r
                                <!-- Controls Section (Separate) -->\r
                <div class="control-section rhythm-controls-container">\r
                    <div class="rhythm-controls-section">\r
                        <button class="rhythm-tab-button rhythm-controls-tab-button active" disabled>Controls</button>\r
                        <div class="rhythm-controls-content-box">\r
                            <div class="tempo-content-box">\r
                                <div class="tempo-container">\r
                                    <div class="tempo-boxes-container">\r
                                        <div class="tempo-input-group tempo-row">\r
                                            <img src="assets/tabicons/eigthNote.svg" alt="Eighth Note Tempo" class="tempo-label-icon">\r
                                            <div id="eighth-note-tempo"></div>\r
                                        </div>\r
                                        <div class="tempo-input-group tempo-row">\r
                                            <img src="assets/tabicons/quarterNote.svg" alt="Quarter Note Tempo" class="tempo-label-icon">\r
                                            <div id="quarter-note-tempo"></div>\r
                                        </div>\r
                                        <div class="tempo-input-group tempo-row">\r
                                            <img src="assets/tabicons/dottedQuarterNote.svg" alt="Dotted Quarter Note Tempo" class="tempo-label-icon">\r
                                            <div id="dotted-quarter-tempo"></div>\r
                                        </div>\r
                                    </div>\r
                                    <div class="tempo-slider-container tempo-column-2">\r
                                        <input type="range" id="tempo-slider" min="30" max="240" value="90">\r
                                    </div>\r
                                </div>\r
                            </div>\r
                            <div class="rhythm-structure-container">\r
                                <div class="control-subsection">\r
                                    <h4>Add/Del Beat</h4>\r
                                    <div class="macrobeat-adjust-group">\r
                                        <button class="toolkit-button" id="macrobeat-decrease"></button>\r
                                        <button class="toolkit-button" id="macrobeat-increase">+</button>\r
                                    </div>\r
                                </div>\r
                                <div class="control-subsection">\r
                                    <h4>Pickup</h4>\r
                                    <div class="toggle-button-group"><button class="sidebar-toggle-button" id="anacrusis-on-btn">On</button><button class="sidebar-toggle-button" id="anacrusis-off-btn">Off</button></div>\r
                                </div>\r
                            </div>\r
                            <div class="modulation-container">\r
                                <div class="control-subsection">\r
                                    <h4>Modulation</h4>\r
                                    <div class="modulation-controls">\r
                                        <button class="toolkit-button modulation-ratio-btn" id="modulation-2-3-btn" data-ratio="2:3" title="Place 2:3 modulation marker (33% faster)">2:3 - 33% faster</button>\r
                                        <button class="toolkit-button modulation-ratio-btn" id="modulation-3-2-btn" data-ratio="3:2" title="Place 3:2 modulation marker (33% slower)">3:2 - 33% slower</button>\r
                                        <button class="toolkit-button" id="modulation-clear-btn" title="Clear all modulation markers">Clear</button>\r
                                    </div>\r
                                </div>\r
                            </div>\r
                        </div>\r
                    </div>\r
                </div>\r
            </div>\r
        </div>\r
    </div>\r
  </nav>\r
  <div id="canvas-container" role="region" aria-label="Musical notation canvas">\r
    <div id="canvas-content">\r
        <div id="grids-wrapper">\r
            <div id="button-grid">\r
                <div class="button-grid-left-cell">\r
                    <div class="left-cell-grid">\r
                        <div id="flat-toggle-btn" class="accidental-btn active" role="button" tabindex="0" aria-pressed="true"></div>\r
                        <div id="sharp-toggle-btn" class="accidental-btn active" role="button" tabindex="0" aria-pressed="true"></div>\r
                        <div id="hz-toggle-btn" class="accidental-btn" role="button" tabindex="0" aria-pressed="false">Hz</div>\r
                        <div id="spn-octave-toggle-btn" class="accidental-btn octave-toggle-btn active" role="button" tabindex="0" aria-pressed="true" title="Show SPN octave digits" aria-label="Toggle SPN octave digits">\r
                            <span class="octave-label">\r
                                A<span class="octave-digit">1</span>\r
                            </span>\r
                        </div>\r
                    </div>\r
                </div>\r
                <div class="button-grid-middle-cell">\r
                    <div id="beat-line-button-layer">\r
                        <div id="time-signature-row" class="beat-line-row"></div>\r
                        <div id="grouping-buttons-row" class="beat-line-row"></div>\r
                        <div id="boundary-buttons-row" class="beat-line-row"></div>\r
                    </div>\r
                </div>\r
                <div class="button-grid-right-cell">\r
                    <!-- Null/empty cell for alignment with pitch grid right legend -->\r
                </div>\r
            </div>\r
            <div id="pitch-grid-wrapper">\r
                <div id="pitch-grid-container">\r
                    <div id="grid-container">\r
                        <div id="pitch-canvas-wrapper">\r
                            <canvas id="legend-left-canvas"></canvas>\r
                            <canvas id="notation-grid"></canvas>\r
                            <canvas id="note-animation-canvas"></canvas>\r
                            <canvas id="legend-right-canvas"></canvas>\r
                            <canvas id="playhead-canvas"></canvas>\r
                            <canvas id="hover-canvas"></canvas>\r
                        </div>\r
                    </div>\r
                </div>\r
            </div>\r
            <div id="grid-scrollbar-proxy" role="scrollbar" aria-label="Horizontal scroll for notation grids" tabindex="0">\r
                <div class="grid-scrollbar-inner"></div>\r
            </div>\r
            <div id="drum-grid-wrapper">\r
                <div class="drum-grid-left-cell">\r
                    <!-- Reserved for future drum legends/controls -->\r
                </div>\r
                <div class="drum-grid-middle-cell">\r
                    <div id="drum-canvas-wrapper">\r
                        <canvas id="drum-grid"></canvas>\r
                        <canvas id="drum-playhead-canvas"></canvas>\r
                        <canvas id="drum-hover-canvas"></canvas>\r
                    </div>\r
                </div>\r
                <div class="drum-grid-right-cell">\r
                    <!-- Placeholder for alignment with right legend spacing -->\r
                </div>\r
            </div>\r
        </div>\r
    </div>\r
</div>\r
</main>\r
<!-- Notification Overlay -->\r
<div id="notification-overlay">\r
    <div class="notification-modal">\r
        <div class="notification-header">\r
            <h3 class="notification-title">Notice</h3>\r
            <button class="notification-close"></button>\r
        </div>\r
        <div class="notification-message"></div>\r
        <div class="notification-actions">\r
            <button class="notification-button">OK</button>\r
        </div>\r
    </div>\r
</div>\r
<!-- ... (Print Preview Modal remains the same) ... -->\r
<div id="print-preview-overlay" class="hidden">\r
    <div id="print-preview-modal">\r
        <div class="print-preview-header">\r
            <h2>Print Preview</h2>\r
            <button id="print-close-button" class="close-button"></button>\r
        </div>\r
        <div class="print-preview-content">\r
            <div class="print-preview-canvas-wrapper">\r
                <canvas id="print-preview-canvas"></canvas>\r
                <canvas id="print-crop-overlay"></canvas>\r
            </div>\r
                <div class="print-preview-options">\r
                <div class="print-info-box">\r
                    <p>Use the crop handles on the preview to trim what gets sent to the printer.</p>\r
                </div>\r
                <h3>Layout</h3>\r
                <div class="print-option-row">\r
                    <label>Paper</label>\r
                    <select id="print-page-size" class="print-select">\r
                        <option value="letter">Letter (8.511)</option>\r
                        <option value="11x14">1114</option>\r
                        <option value="11x17">1117</option>\r
                    </select>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Orientation</label>\r
                    <button id="print-orientation-toggle" class="toggle-button">Landscape</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Buttons</label>\r
                    <button id="print-button-grid-toggle" class="toggle-button active">Include</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Drums</label>\r
                    <button id="print-drum-grid-toggle" class="toggle-button active">Include</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Left Legend</label>\r
                    <button id="print-left-legend-toggle" class="toggle-button active">Include</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Right Legend</label>\r
                    <button id="print-right-legend-toggle" class="toggle-button active">Include</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Color</label>\r
                    <button id="print-color-mode-toggle" class="toggle-button active">Color</button>\r
                </div>\r
            </div>\r
        </div>\r
        <div class="print-preview-footer">\r
            <button id="print-confirm-button" class="confirm-button">Print</button>\r
        </div>\r
    </div>\r
</div>\r
<div id="print-staging-area"></div>\r
\r
<!-- Svelte component mount points (headless components) -->\r
<!-- Toolbar bridges -->\r
<div data-svelte-component="playback-controls-bridge" style="display: none;"></div>\r
<div data-svelte-component="file-actions-bridge" style="display: none;"></div>\r
<div data-svelte-component="grid-controls-bridge" style="display: none;"></div>\r
<div data-svelte-component="modulation-bridge" style="display: none;"></div>\r
<div data-svelte-component="sidebar-bridge" style="display: none;"></div>\r
<div data-svelte-component="tool-selector-bridge" style="display: none;"></div>\r
<div data-svelte-component="audio-controls-bridge" style="display: none;"></div>\r
<!-- Tab management bridge -->\r
<div data-svelte-component="tab-management-bridge" style="display: none;"></div>\r
<!-- Modal bridges -->\r
<div data-svelte-component="print-preview-bridge" style="display: none;"></div>\r
<!-- Phase 3: Modernized Svelte 5 components -->\r
<div data-svelte-component="store-context" style="display: none;"></div>
<div data-svelte-component="notification-modal"></div>
<div data-svelte-component="zoom-indicator"></div>
`,uv="15.1.22",nm=(n,t,e)=>({endTime:t,insertTime:e,type:"exponentialRampToValue",value:n}),sm=(n,t,e)=>({endTime:t,insertTime:e,type:"linearRampToValue",value:n}),qd=(n,t)=>({startTime:t,type:"setValue",value:n}),dv=(n,t,e)=>({duration:e,startTime:t,type:"setValueCurve",values:n}),hv=(n,t,{startTime:e,target:s,timeConstant:r})=>s+(t-s)*Math.exp((e-n)/r),ao=n=>n.type==="exponentialRampToValue",Ac=n=>n.type==="linearRampToValue",Sr=n=>ao(n)||Ac(n),vf=n=>n.type==="setValue",zs=n=>n.type==="setValueCurve",ac=(n,t,e,s)=>{const r=n[t];return r===void 0?s:Sr(r)||vf(r)?r.value:zs(r)?r.values[r.values.length-1]:hv(e,ac(n,t-1,r.startTime,s),r)},rm=(n,t,e,s,r)=>e===void 0?[s.insertTime,r]:Sr(e)?[e.endTime,e.value]:vf(e)?[e.startTime,e.value]:zs(e)?[e.startTime+e.duration,e.values[e.values.length-1]]:[e.startTime,ac(n,t-1,e.startTime,r)],zd=n=>n.type==="cancelAndHold",$d=n=>n.type==="cancelScheduledValues",Br=n=>zd(n)||$d(n)?n.cancelTime:ao(n)||Ac(n)?n.endTime:n.startTime,im=(n,t,e,{endTime:s,value:r})=>e===r?r:0<e&&0<r||e<0&&r<0?e*(r/e)**((n-t)/(s-t)):0,om=(n,t,e,{endTime:s,value:r})=>e+(n-t)/(s-t)*(r-e),z2=(n,t)=>{const e=Math.floor(t),s=Math.ceil(t);return e===s?n[e]:(1-(t-e))*n[e]+(1-(s-t))*n[s]},$2=(n,{duration:t,startTime:e,values:s})=>{const r=(n-e)/t*(s.length-1);return z2(s,r)},Ka=n=>n.type==="setTarget";class X2{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(t){const e=Br(t);if(zd(t)||$d(t)){const s=this._automationEvents.findIndex(i=>$d(t)&&zs(i)?i.startTime+i.duration>=e:Br(i)>=e),r=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),zd(t)){const i=this._automationEvents[this._automationEvents.length-1];if(r!==void 0&&Sr(r)){if(i!==void 0&&Ka(i))throw new Error("The internal list is malformed.");const o=i===void 0?r.insertTime:zs(i)?i.startTime+i.duration:Br(i),A=i===void 0?this._defaultValue:zs(i)?i.values[i.values.length-1]:i.value,a=ao(r)?im(e,o,A,r):om(e,o,A,r),l=ao(r)?nm(a,e,this._currenTime):sm(a,e,this._currenTime);this._automationEvents.push(l)}if(i!==void 0&&Ka(i)&&this._automationEvents.push(qd(this.getValue(e),e)),i!==void 0&&zs(i)&&i.startTime+i.duration>e){const o=e-i.startTime,A=(i.values.length-1)/i.duration,a=Math.max(2,1+Math.ceil(o*A)),l=o/(a-1)*A,c=i.values.slice(0,a);if(l<1)for(let u=1;u<a;u+=1){const d=l*u%1;c[u]=i.values[u-1]*(1-d)+i.values[u]*d}this._automationEvents[this._automationEvents.length-1]=dv(c,i.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>Br(o)>e),r=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(r!==void 0&&zs(r)&&Br(r)+r.duration>e)return!1;const i=ao(t)?nm(t.value,t.endTime,this._currenTime):Ac(t)?sm(t.value,e,this._currenTime):t;if(s===-1)this._automationEvents.push(i);else{if(zs(t)&&e+t.duration>Br(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,i)}}return!0}flush(t){const e=this._automationEvents.findIndex(s=>Br(s)>t);if(e>1){const s=this._automationEvents.slice(e-1),r=s[0];Ka(r)&&s.unshift(qd(ac(this._automationEvents,e-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=s}}getValue(t){if(this._automationEvents.length===0)return this._defaultValue;const e=this._automationEvents.findIndex(o=>Br(o)>t),s=this._automationEvents[e],r=(e===-1?this._automationEvents.length:e)-1,i=this._automationEvents[r];if(i!==void 0&&Ka(i)&&(s===void 0||!Sr(s)||s.insertTime>t))return hv(t,ac(this._automationEvents,r-1,i.startTime,this._defaultValue),i);if(i!==void 0&&vf(i)&&(s===void 0||!Sr(s)))return i.value;if(i!==void 0&&zs(i)&&(s===void 0||!Sr(s)||i.startTime+i.duration>t))return t<i.startTime+i.duration?$2(t,i):i.values[i.values.length-1];if(i!==void 0&&Sr(i)&&(s===void 0||!Sr(s)))return i.value;if(s!==void 0&&ao(s)){const[o,A]=rm(this._automationEvents,r,i,s,this._defaultValue);return im(t,o,A,s)}if(s!==void 0&&Ac(s)){const[o,A]=rm(this._automationEvents,r,i,s,this._defaultValue);return om(t,o,A,s)}return this._defaultValue}}const Y2=n=>({cancelTime:n,type:"cancelAndHold"}),j2=n=>({cancelTime:n,type:"cancelScheduledValues"}),J2=(n,t)=>({endTime:t,type:"exponentialRampToValue",value:n}),Z2=(n,t)=>({endTime:t,type:"linearRampToValue",value:n}),ty=(n,t,e)=>({startTime:t,target:n,timeConstant:e,type:"setTarget"}),ey=()=>new DOMException("","AbortError"),ny=n=>(t,e,[s,r,i],o)=>{n(t[r],[e,s,i],A=>A[0]===e&&A[1]===s,o)},sy=n=>(t,e,s)=>{const r=[];for(let i=0;i<s.numberOfInputs;i+=1)r.push(new Set);n.set(t,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:e})},ry=n=>(t,e)=>{n.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})},Lo=new WeakSet,fv=new WeakMap,wf=new WeakMap,pv=new WeakMap,Bf=new WeakMap,Zc=new WeakMap,mv=new WeakMap,Xd=new WeakMap,Yd=new WeakMap,jd=new WeakMap,gv={construct(){return gv}},iy=n=>{try{const t=new Proxy(n,gv);new t}catch{return!1}return!0},Am=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,am=(n,t)=>{const e=[];let s=n.replace(/^[\s]+/,""),r=s.match(Am);for(;r!==null;){const i=r[1].slice(1,-1),o=r[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,t).toString());e.push(o),s=s.slice(r[0].length).replace(/^[\s]+/,""),r=s.match(Am)}return[e.join(";"),s]},lm=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},cm=n=>{if(!iy(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},oy=(n,t,e,s,r,i,o,A,a,l,c,u,d)=>{let p=0;return(h,m,g={credentials:"omit"})=>{const v=c.get(h);if(v!==void 0&&v.has(m))return Promise.resolve();const w=l.get(h);if(w!==void 0){const B=w.get(m);if(B!==void 0)return B}const y=i(h),I=y.audioWorklet===void 0?r(m).then(([B,C])=>{const[b,S]=am(B,C),T=`${b};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${S}
})})(window,'_AWGS')`;return e(T)}).then(()=>{const B=d._AWGS.pop();if(B===void 0)throw new SyntaxError;s(y.currentTime,y.sampleRate,()=>B(class{},void 0,(C,b)=>{if(C.trim()==="")throw t();const S=Yd.get(y);if(S!==void 0){if(S.has(C))throw t();cm(b),lm(b.parameterDescriptors),S.set(C,b)}else cm(b),lm(b.parameterDescriptors),Yd.set(y,new Map([[C,b]]))},y.sampleRate,void 0,void 0))}):Promise.all([r(m),Promise.resolve(n(u,u))]).then(([[B,C],b])=>{const S=p+1;p=S;const[T,x]=am(B,C),U=`${T};((AudioWorkletProcessor,registerProcessor)=>{${x}
})(${b?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${b?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${b?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${S}',class extends AudioWorkletProcessor{process(){return !1}})`,W=new Blob([U],{type:"application/javascript; charset=utf-8"}),D=URL.createObjectURL(W);return y.audioWorklet.addModule(D,g).then(()=>{if(A(y))return y;const R=o(y);return R.audioWorklet.addModule(D,g).then(()=>R)}).then(R=>{if(a===null)throw new SyntaxError;try{new a(R,`__sac${S}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(D))});return w===void 0?l.set(h,new Map([[m,I]])):w.set(m,I),I.then(()=>{const B=c.get(h);B===void 0?c.set(h,new Set([m])):B.add(m)}).finally(()=>{const B=l.get(h);B!==void 0&&B.delete(m)}),I}},as=(n,t)=>{const e=n.get(t);if(e===void 0)throw new Error("A value with the given key could not be found.");return e},tu=(n,t)=>{const e=Array.from(n).filter(t);if(e.length>1)throw Error("More than one element was found.");if(e.length===0)throw Error("No element was found.");const[s]=e;return n.delete(s),s},vv=(n,t,e,s)=>{const r=as(n,t),i=tu(r,o=>o[0]===e&&o[1]===s);return r.size===0&&n.delete(t),i},Sa=n=>as(mv,n),ko=n=>{if(Lo.has(n))throw new Error("The AudioNode is already stored.");Lo.add(n),Sa(n).forEach(t=>t(!0))},wv=n=>"port"in n,Ea=n=>{if(!Lo.has(n))throw new Error("The AudioNode is not stored.");Lo.delete(n),Sa(n).forEach(t=>t(!1))},Jd=(n,t)=>{!wv(n)&&t.every(e=>e.size===0)&&Ea(n)},Ay=(n,t,e,s,r,i,o,A,a,l,c,u,d)=>{const p=new WeakMap;return(h,m,g,v,w)=>{const{activeInputs:y,passiveInputs:I}=i(m),{outputs:B}=i(h),C=A(h),b=S=>{const T=a(m),x=a(h);if(S){const _=vv(I,h,g,v);n(y,h,_,!1),!w&&!u(h)&&e(x,T,g,v),d(m)&&ko(m)}else{const _=s(y,h,g,v);t(I,v,_,!1),!w&&!u(h)&&r(x,T,g,v);const F=o(m);if(F===0)c(m)&&Jd(m,y);else{const Q=p.get(m);Q!==void 0&&clearTimeout(Q),p.set(m,setTimeout(()=>{c(m)&&Jd(m,y)},F*1e3))}}};return l(B,[m,g,v],S=>S[0]===m&&S[1]===g&&S[2]===v,!0)?(C.add(b),c(h)?n(y,h,[g,v,b],!0):t(I,v,[h,g,b],!0),!0):!1}},ay=n=>(t,e,[s,r,i],o)=>{const A=t.get(s);A===void 0?t.set(s,new Set([[r,e,i]])):n(A,[r,e,i],a=>a[0]===r&&a[1]===e,o)},ly=n=>(t,e)=>{const s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(s).connect(t.destination);const r=()=>{e.removeEventListener("ended",r),e.disconnect(s),s.disconnect()};e.addEventListener("ended",r)},cy=n=>(t,e)=>{n(t).add(e)},uy={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},dy=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=r(A),c={...uy,...a},u=s(l,c),d=i(l)?t():null;super(A,!1,u,d),this._nativeAnalyserNode=u}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(A){this._nativeAnalyserNode.fftSize=A}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(A){const a=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=A,!(A>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=a,e()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(A){const a=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=A,!(this._nativeAnalyserNode.maxDecibels>A))throw this._nativeAnalyserNode.minDecibels=a,e()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(A){this._nativeAnalyserNode.smoothingTimeConstant=A}getByteFrequencyData(A){this._nativeAnalyserNode.getByteFrequencyData(A)}getByteTimeDomainData(A){this._nativeAnalyserNode.getByteTimeDomainData(A)}getFloatFrequencyData(A){this._nativeAnalyserNode.getFloatFrequencyData(A)}getFloatTimeDomainData(A){this._nativeAnalyserNode.getFloatTimeDomainData(A)}},je=(n,t)=>n.context===t,hy=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,fftSize:A.fftSize,maxDecibels:A.maxDecibels,minDecibels:A.minDecibels,smoothingTimeConstant:A.smoothingTimeConstant};A=n(o,l)}return s.set(o,A),await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},lc=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Ns=()=>new DOMException("","IndexSizeError"),Cf=n=>{n.getChannelData=(t=>e=>{try{return t.call(n,e)}catch(s){throw s.code===12?Ns():s}})(n.getChannelData)},fy={numberOfChannels:1},py=(n,t,e,s,r,i,o,A)=>{let a=null;return class Bv{constructor(c){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:d,sampleRate:p}={...fy,...c};a===null&&(a=new r(1,1,44100));const h=s!==null&&t(i,i)?new s({length:u,numberOfChannels:d,sampleRate:p}):a.createBuffer(d,u,p);if(h.numberOfChannels===0)throw e();return typeof h.copyFromChannel!="function"?(o(h),Cf(h)):t(lc,()=>lc(h))||A(h),n.add(h),h}static[Symbol.hasInstance](c){return c!==null&&typeof c=="object"&&Object.getPrototypeOf(c)===Bv.prototype||n.has(c)}}},cn=-34028234663852886e22,nn=-cn,nr=n=>Lo.has(n),my={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},gy=(n,t,e,s,r,i,o,A)=>class extends n{constructor(l,c){const u=i(l),d={...my,...c},p=r(u,d),h=o(u),m=h?t():null;super(l,!1,p,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=p,this._onended=null,this._playbackRate=e(this,h,p.playbackRate,nn,cn)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const c=typeof l=="function"?A(this,l):null;this._nativeAudioBufferSourceNode.onended=c;const u=this._nativeAudioBufferSourceNode.onended;this._onended=u!==null&&u===c?l:u}get playbackRate(){return this._playbackRate}start(l=0,c=0,u){if(this._nativeAudioBufferSourceNode.start(l,c,u),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=u===void 0?[l,c]:[l,c,u]),this.context.state!=="closed"){ko(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),nr(this)&&Ea(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},vy=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,A=null;const a=async(l,c)=>{let u=e(l);const d=je(u,c);if(!d){const p={buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,loop:u.loop,loopEnd:u.loopEnd,loopStart:u.loopStart,playbackRate:u.playbackRate.value};u=t(c,p),o!==null&&u.start(...o),A!==null&&u.stop(A)}return i.set(c,u),d?await n(c,l.playbackRate,u.playbackRate):await s(c,l.playbackRate,u.playbackRate),await r(l,c,u),u};return{set start(l){o=l},set stop(l){A=l},render(l,c){const u=i.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},wy=n=>"playbackRate"in n,By=n=>"frequency"in n&&"gain"in n,Cy=n=>"offset"in n,by=n=>!("frequency"in n)&&"gain"in n,yy=n=>"detune"in n&&"frequency"in n&&!("gain"in n),Sy=n=>"pan"in n,sn=n=>as(fv,n),xa=n=>as(pv,n),Zd=(n,t)=>{const{activeInputs:e}=sn(n);e.forEach(r=>r.forEach(([i])=>{t.includes(n)||Zd(i,[...t,n])}));const s=wy(n)?[n.playbackRate]:wv(n)?Array.from(n.parameters.values()):By(n)?[n.Q,n.detune,n.frequency,n.gain]:Cy(n)?[n.offset]:by(n)?[n.gain]:yy(n)?[n.detune,n.frequency]:Sy(n)?[n.pan]:[];for(const r of s){const i=xa(r);i!==void 0&&i.activeInputs.forEach(([o])=>Zd(o,t))}nr(n)&&Ea(n)},Cv=n=>{Zd(n.destination,[])},Ey=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),xy=(n,t,e,s,r,i,o,A,a)=>class extends n{constructor(c={}){if(a===null)throw new Error("Missing the native AudioContext constructor.");let u;try{u=new a(c)}catch(h){throw h.code===12&&h.message==="sampleRate is not in range"?e():h}if(u===null)throw s();if(!Ey(c.latencyHint))throw new TypeError(`The provided value '${c.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(c.sampleRate!==void 0&&u.sampleRate!==c.sampleRate)throw e();super(u,2);const{latencyHint:d}=c,{sampleRate:p}=u;if(this._baseLatency=typeof u.baseLatency=="number"?u.baseLatency:d==="balanced"?512/p:d==="interactive"||d===void 0?256/p:d==="playback"?1024/p:Math.max(2,Math.min(128,Math.round(d*p/128)))*128/p,this._nativeAudioContext=u,a.name==="webkitAudioContext"?(this._nativeGainNode=u.createGain(),this._nativeOscillatorNode=u.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(u.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,u.state==="running"){this._state="suspended";const h=()=>{this._state==="suspended"&&(this._state=null),u.removeEventListener("statechange",h)};u.addEventListener("statechange",h)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Cv(this)}))}createMediaElementSource(c){return new r(this,{mediaElement:c})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(c){return new o(this,{mediaStream:c})}createMediaStreamTrackSource(c){return new A(this,{mediaStreamTrack:c})}resume(){return this._state==="suspended"?new Promise((c,u)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?c():this.resume().then(c,u)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(c=>{throw c===void 0||c.code===15?t():c})}suspend(){return this._nativeAudioContext.suspend().catch(c=>{throw c===void 0?t():c})}},Iy=(n,t,e,s,r,i,o,A)=>class extends n{constructor(l,c){const u=i(l),d=o(u),p=r(u,c,d),h=d?t(A):null;super(l,!1,p,h),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=p}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw e();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},Fy=n=>{const t=new WeakMap,e=async(s,r)=>{const i=r.destination;return t.set(r,i),await n(s,r,i),i};return{render(s,r){const i=t.get(r);return i!==void 0?Promise.resolve(i):e(s,r)}}},Ty=(n,t,e,s,r,i,o,A)=>(a,l)=>{const c=l.listener,u=()=>{const B=new Float32Array(1),C=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),b=o(l);let S=!1,T=[0,0,-1,0,1,0],x=[0,0,0];const _=()=>{if(S)return;S=!0;const W=s(l,256,9,0);W.onaudioprocess=({inputBuffer:D})=>{const R=[i(D,B,0),i(D,B,1),i(D,B,2),i(D,B,3),i(D,B,4),i(D,B,5)];R.some((q,J)=>q!==T[J])&&(c.setOrientation(...R),T=R);const N=[i(D,B,6),i(D,B,7),i(D,B,8)];N.some((q,J)=>q!==x[J])&&(c.setPosition(...N),x=N)},C.connect(W)},F=W=>D=>{D!==T[W]&&(T[W]=D,c.setOrientation(...T))},Q=W=>D=>{D!==x[W]&&(x[W]=D,c.setPosition(...x))},U=(W,D,R)=>{const N=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:D});N.connect(C,0,W),N.start(),Object.defineProperty(N.offset,"defaultValue",{get(){return D}});const q=n({context:a},b,N.offset,nn,cn);return A(q,"value",J=>()=>J.call(q),J=>nt=>{try{J.call(q,nt)}catch(At){if(At.code!==9)throw At}_(),b&&R(nt)}),q.cancelAndHoldAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.cancelAndHoldAtTime),q.cancelScheduledValues=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.cancelScheduledValues),q.exponentialRampToValueAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.exponentialRampToValueAtTime),q.linearRampToValueAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.linearRampToValueAtTime),q.setTargetAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.setTargetAtTime),q.setValueAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.setValueAtTime),q.setValueCurveAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.setValueCurveAtTime),q};return{forwardX:U(0,0,F(0)),forwardY:U(1,0,F(1)),forwardZ:U(2,-1,F(2)),positionX:U(6,0,Q(0)),positionY:U(7,0,Q(1)),positionZ:U(8,0,Q(2)),upX:U(3,0,F(3)),upY:U(4,1,F(4)),upZ:U(5,0,F(5))}},{forwardX:d,forwardY:p,forwardZ:h,positionX:m,positionY:g,positionZ:v,upX:w,upY:y,upZ:I}=c.forwardX===void 0?u():c;return{get forwardX(){return d},get forwardY(){return p},get forwardZ(){return h},get positionX(){return m},get positionY(){return g},get positionZ(){return v},get upX(){return w},get upY(){return y},get upZ(){return I}}},cc=n=>"context"in n,Ia=n=>cc(n[0]),Oi=(n,t,e,s)=>{for(const r of n)if(e(r)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(t),!0},um=(n,t,[e,s],r)=>{Oi(n,[t,e,s],i=>i[0]===t&&i[1]===e,r)},dm=(n,[t,e,s],r)=>{const i=n.get(t);i===void 0?n.set(t,new Set([[e,s]])):Oi(i,[e,s],o=>o[0]===e,r)},jo=n=>"inputs"in n,uc=(n,t,e,s)=>{if(jo(t)){const r=t.inputs[s];return n.connect(r,e,0),[r,e,0]}return n.connect(t,e,s),[t,e,s]},bv=(n,t,e)=>{for(const s of n)if(s[0]===t&&s[1]===e)return n.delete(s),s;return null},_y=(n,t,e)=>tu(n,s=>s[0]===t&&s[1]===e),yv=(n,t)=>{if(!Sa(n).delete(t))throw new Error("Missing the expected event listener.")},Sv=(n,t,e)=>{const s=as(n,t),r=tu(s,i=>i[0]===e);return s.size===0&&n.delete(t),r},dc=(n,t,e,s)=>{jo(t)?n.disconnect(t.inputs[s],e,0):n.disconnect(t,e,s)},Zt=n=>as(wf,n),$A=n=>as(Bf,n),Mi=n=>Xd.has(n),Rl=n=>!Lo.has(n),hm=(n,t)=>new Promise(e=>{if(t!==null)e(!0);else{const s=n.createScriptProcessor(256,1,1),r=n.createGain(),i=n.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const A=n.createBufferSource();A.buffer=i,A.loop=!0,A.connect(s).connect(n.destination),A.connect(r),A.disconnect(r),s.onaudioprocess=a=>{const l=a.inputBuffer.getChannelData(0);Array.prototype.some.call(l,c=>c===1)?e(!0):e(!1),A.stop(),s.onaudioprocess=null,A.disconnect(s),s.disconnect(n.destination)},A.start()}}),$u=(n,t)=>{const e=new Map;for(const s of n)for(const r of s){const i=e.get(r);e.set(r,i===void 0?1:i+1)}e.forEach((s,r)=>t(r,s))},hc=n=>"context"in n,My=n=>{const t=new Map;n.connect=(e=>(s,r=0,i=0)=>{const o=hc(s)?e(s,r,i):e(s,r),A=t.get(s);return A===void 0?t.set(s,[{input:i,output:r}]):A.every(a=>a.input!==i||a.output!==r)&&A.push({input:i,output:r}),o})(n.connect.bind(n)),n.disconnect=(e=>(s,r,i)=>{if(e.apply(n),s===void 0)t.clear();else if(typeof s=="number")for(const[o,A]of t){const a=A.filter(l=>l.output!==s);a.length===0?t.delete(o):t.set(o,a)}else if(t.has(s))if(r===void 0)t.delete(s);else{const o=t.get(s);if(o!==void 0){const A=o.filter(a=>a.output!==r&&(a.input!==i||i===void 0));A.length===0?t.delete(s):t.set(s,A)}}for(const[o,A]of t)A.forEach(a=>{hc(o)?n.connect(o,a.output,a.input):n.connect(o,a.output)})})(n.disconnect)},Qy=(n,t,e,s)=>{const{activeInputs:r,passiveInputs:i}=xa(t),{outputs:o}=sn(n),A=Sa(n),a=l=>{const c=Zt(n),u=$A(t);if(l){const d=Sv(i,n,e);um(r,n,d,!1),!s&&!Mi(n)&&c.connect(u,e)}else{const d=_y(r,n,e);dm(i,d,!1),!s&&!Mi(n)&&c.disconnect(u,e)}};return Oi(o,[t,e],l=>l[0]===t&&l[1]===e,!0)?(A.add(a),nr(n)?um(r,n,[e,a],!0):dm(i,[n,e,a],!0),!0):!1},Uy=(n,t,e,s)=>{const{activeInputs:r,passiveInputs:i}=sn(t),o=bv(r[s],n,e);return o===null?[vv(i,n,e,s)[2],!1]:[o[2],!0]},Py=(n,t,e)=>{const{activeInputs:s,passiveInputs:r}=xa(t),i=bv(s,n,e);return i===null?[Sv(r,n,e)[1],!1]:[i[2],!0]},bf=(n,t,e,s,r)=>{const[i,o]=Uy(n,e,s,r);if(i!==null&&(yv(n,i),o&&!t&&!Mi(n)&&dc(Zt(n),Zt(e),s,r)),nr(e)){const{activeInputs:A}=sn(e);Jd(e,A)}},yf=(n,t,e,s)=>{const[r,i]=Py(n,e,s);r!==null&&(yv(n,r),i&&!t&&!Mi(n)&&Zt(n).disconnect($A(e),s))},Ny=(n,t)=>{const e=sn(n),s=[];for(const r of e.outputs)Ia(r)?bf(n,t,...r):yf(n,t,...r),s.push(r[0]);return e.outputs.clear(),s},Dy=(n,t,e)=>{const s=sn(n),r=[];for(const i of s.outputs)i[1]===e&&(Ia(i)?bf(n,t,...i):yf(n,t,...i),r.push(i[0]),s.outputs.delete(i));return r},Ly=(n,t,e,s,r)=>{const i=sn(n);return Array.from(i.outputs).filter(o=>o[0]===e&&(s===void 0||o[1]===s)&&(r===void 0||o[2]===r)).map(o=>(Ia(o)?bf(n,t,...o):yf(n,t,...o),i.outputs.delete(o),o[0]))},ky=(n,t,e,s,r,i,o,A,a,l,c,u,d,p,h,m)=>class extends l{constructor(v,w,y,I){super(y),this._context=v,this._nativeAudioNode=y;const B=c(v);u(B)&&e(hm,()=>hm(B,m))!==!0&&My(y),wf.set(this,y),mv.set(this,new Set),v.state!=="closed"&&w&&ko(this),n(this,I,y)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,w=0,y=0){if(w<0||w>=this._nativeAudioNode.numberOfOutputs)throw r();const I=c(this._context),B=h(I);if(d(v)||p(v))throw i();if(cc(v)){const S=Zt(v);try{const x=uc(this._nativeAudioNode,S,w,y),_=Rl(this);(B||_)&&this._nativeAudioNode.disconnect(...x),this.context.state!=="closed"&&!_&&Rl(v)&&ko(v)}catch(x){throw x.code===12?i():x}if(t(this,v,w,y,B)){const x=a([this],v);$u(x,s(B))}return v}const C=$A(v);if(C.name==="playbackRate"&&C.maxValue===1024)throw o();try{this._nativeAudioNode.connect(C,w),(B||Rl(this))&&this._nativeAudioNode.disconnect(C,w)}catch(S){throw S.code===12?i():S}if(Qy(this,v,w,B)){const S=a([this],v);$u(S,s(B))}}disconnect(v,w,y){let I;const B=c(this._context),C=h(B);if(v===void 0)I=Ny(this,C);else if(typeof v=="number"){if(v<0||v>=this.numberOfOutputs)throw r();I=Dy(this,C,v)}else{if(w!==void 0&&(w<0||w>=this.numberOfOutputs)||cc(v)&&y!==void 0&&(y<0||y>=v.numberOfInputs))throw r();if(I=Ly(this,C,v,w,y),I.length===0)throw i()}for(const b of I){const S=a([this],b);$u(S,A)}}},Ry=(n,t,e,s,r,i,o,A,a,l,c,u,d)=>(p,h,m,g=null,v=null)=>{const w=m.value,y=new X2(w),I=h?s(y):null,B={get defaultValue(){return w},get maxValue(){return g===null?m.maxValue:g},get minValue(){return v===null?m.minValue:v},get value(){return m.value},set value(C){m.value=C,B.setValueAtTime(C,p.context.currentTime)},cancelAndHoldAtTime(C){if(typeof m.cancelAndHoldAtTime=="function")I===null&&y.flush(p.context.currentTime),y.add(r(C)),m.cancelAndHoldAtTime(C);else{const b=Array.from(y).pop();I===null&&y.flush(p.context.currentTime),y.add(r(C));const S=Array.from(y).pop();m.cancelScheduledValues(C),b!==S&&S!==void 0&&(S.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(S.value,S.endTime):S.type==="linearRampToValue"?m.linearRampToValueAtTime(S.value,S.endTime):S.type==="setValue"?m.setValueAtTime(S.value,S.startTime):S.type==="setValueCurve"&&m.setValueCurveAtTime(S.values,S.startTime,S.duration))}return B},cancelScheduledValues(C){return I===null&&y.flush(p.context.currentTime),y.add(i(C)),m.cancelScheduledValues(C),B},exponentialRampToValueAtTime(C,b){if(C===0)throw new RangeError;if(!Number.isFinite(b)||b<0)throw new RangeError;const S=p.context.currentTime;return I===null&&y.flush(S),Array.from(y).length===0&&(y.add(l(w,S)),m.setValueAtTime(w,S)),y.add(o(C,b)),m.exponentialRampToValueAtTime(C,b),B},linearRampToValueAtTime(C,b){const S=p.context.currentTime;return I===null&&y.flush(S),Array.from(y).length===0&&(y.add(l(w,S)),m.setValueAtTime(w,S)),y.add(A(C,b)),m.linearRampToValueAtTime(C,b),B},setTargetAtTime(C,b,S){return I===null&&y.flush(p.context.currentTime),y.add(a(C,b,S)),m.setTargetAtTime(C,b,S),B},setValueAtTime(C,b){return I===null&&y.flush(p.context.currentTime),y.add(l(C,b)),m.setValueAtTime(C,b),B},setValueCurveAtTime(C,b,S){const T=C instanceof Float32Array?C:new Float32Array(C);if(u!==null&&u.name==="webkitAudioContext"){const x=b+S,_=p.context.sampleRate,F=Math.ceil(b*_),Q=Math.floor(x*_),U=Q-F,W=new Float32Array(U);for(let R=0;R<U;R+=1){const N=(T.length-1)/S*((F+R)/_-b),q=Math.floor(N),J=Math.ceil(N);W[R]=q===J?T[q]:(1-(N-q))*T[q]+(1-(J-N))*T[J]}I===null&&y.flush(p.context.currentTime),y.add(c(W,b,S)),m.setValueCurveAtTime(W,b,S);const D=Q/_;D<x&&d(B,W[W.length-1],D),d(B,T[T.length-1],x)}else I===null&&y.flush(p.context.currentTime),y.add(c(T,b,S)),m.setValueCurveAtTime(T,b,S);return B}};return e.set(B,m),t.set(B,p),n(B,I),B},Hy=n=>({replay(t){for(const e of n)if(e.type==="exponentialRampToValue"){const{endTime:s,value:r}=e;t.exponentialRampToValueAtTime(r,s)}else if(e.type==="linearRampToValue"){const{endTime:s,value:r}=e;t.linearRampToValueAtTime(r,s)}else if(e.type==="setTarget"){const{startTime:s,target:r,timeConstant:i}=e;t.setTargetAtTime(r,s,i)}else if(e.type==="setValue"){const{startTime:s,value:r}=e;t.setValueAtTime(r,s)}else if(e.type==="setValueCurve"){const{duration:s,startTime:r,values:i}=e;t.setValueCurveAtTime(i,r,s)}else throw new Error("Can't apply an unknown automation.")}});class Ev{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach((s,r)=>t.call(e,s,r,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const Oy={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},Vy=(n,t,e,s,r,i,o,A,a,l,c,u,d,p)=>class extends t{constructor(m,g,v){var w;const y=A(m),I=a(y),B=c({...Oy,...v});d(B);const C=Yd.get(y),b=C==null?void 0:C.get(g),S=I||y.state!=="closed"?y:(w=o(y))!==null&&w!==void 0?w:y,T=r(S,I?null:m.baseLatency,l,g,b,B),x=I?s(g,B,b):null;super(m,!0,T,x);const _=[];T.parameters.forEach((Q,U)=>{const W=e(this,I,Q);_.push([U,W])}),this._nativeAudioWorkletNode=T,this._onprocessorerror=null,this._parameters=new Ev(_),I&&n(y,this);const{activeInputs:F}=i(this);u(T,F)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const g=typeof m=="function"?p(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=g;const v=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=v!==null&&v===g?m:v}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function fc(n,t,e,s,r){if(typeof n.copyFromChannel=="function")t[e].byteLength===0&&(t[e]=new Float32Array(128)),n.copyFromChannel(t[e],s,r);else{const i=n.getChannelData(s);if(t[e].byteLength===0)t[e]=i.slice(r,r+128);else{const o=new Float32Array(i.buffer,r*Float32Array.BYTES_PER_ELEMENT,128);t[e].set(o)}}}const xv=(n,t,e,s,r)=>{typeof n.copyToChannel=="function"?t[e].byteLength!==0&&n.copyToChannel(t[e],s,r):t[e].byteLength!==0&&n.getChannelData(s).set(t[e],r)},pc=(n,t)=>{const e=[];for(let s=0;s<n;s+=1){const r=[],i=typeof t=="number"?t:t[s];for(let o=0;o<i;o+=1)r.push(new Float32Array(128));e.push(r)}return e},Wy=(n,t)=>{const e=as(jd,n),s=Zt(t);return as(e,s)},Gy=async(n,t,e,s,r,i,o)=>{const A=t===null?Math.ceil(n.context.length/128)*128:t.length,a=s.channelCount*s.numberOfInputs,l=r.reduce((g,v)=>g+v,0),c=l===0?null:e.createBuffer(l,A,e.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const u=sn(n),d=await Wy(e,n),p=pc(s.numberOfInputs,s.channelCount),h=pc(s.numberOfOutputs,r),m=Array.from(n.parameters.keys()).reduce((g,v)=>({...g,[v]:new Float32Array(128)}),{});for(let g=0;g<A;g+=128){if(s.numberOfInputs>0&&t!==null)for(let v=0;v<s.numberOfInputs;v+=1)for(let w=0;w<s.channelCount;w+=1)fc(t,p[v],w,w,g);i.parameterDescriptors!==void 0&&t!==null&&i.parameterDescriptors.forEach(({name:v},w)=>{fc(t,m,v,a+w,g)});for(let v=0;v<s.numberOfInputs;v+=1)for(let w=0;w<r[v];w+=1)h[v][w].byteLength===0&&(h[v][w]=new Float32Array(128));try{const v=p.map((y,I)=>u.activeInputs[I].size===0?[]:y),w=o(g/e.sampleRate,e.sampleRate,()=>d.process(v,h,m));if(c!==null)for(let y=0,I=0;y<s.numberOfOutputs;y+=1){for(let B=0;B<r[y];B+=1)xv(c,h[y],B,I+B,g);I+=r[y]}if(!w)break}catch(v){n.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return c},Ky=(n,t,e,s,r,i,o,A,a,l,c,u,d,p,h,m)=>(g,v,w)=>{const y=new WeakMap;let I=null;const B=async(C,b)=>{let S=c(C),T=null;const x=je(S,b),_=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(u===null){const F=_.reduce((D,R)=>D+R,0),Q=r(b,{channelCount:Math.max(1,F),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,F)}),U=[];for(let D=0;D<C.numberOfOutputs;D+=1)U.push(s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[D]}));const W=o(b,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});W.connect=t.bind(null,U),W.disconnect=a.bind(null,U),T=[Q,U,W]}else x||(S=new u(b,g));if(y.set(b,T===null?S:T[2]),T!==null){if(I===null){if(w===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const R=C.channelCount*C.numberOfInputs,N=w.parameterDescriptors===void 0?0:w.parameterDescriptors.length,q=R+N;I=Gy(C,q===0?null:await(async()=>{const nt=new d(q,Math.ceil(C.context.length/128)*128,b.sampleRate),At=[],ot=[];for(let G=0;G<v.numberOfInputs;G+=1)At.push(o(nt,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),ot.push(r(nt,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const V=await Promise.all(Array.from(C.parameters.values()).map(async G=>{const Y=i(nt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:G.value});return await p(nt,G,Y.offset),Y})),H=s(nt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,R+N)});for(let G=0;G<v.numberOfInputs;G+=1){At[G].connect(ot[G]);for(let Y=0;Y<v.channelCount;Y+=1)ot[G].connect(H,Y,G*v.channelCount+Y)}for(const[G,Y]of V.entries())Y.connect(H,0,R+G),Y.start(0);return H.connect(nt.destination),await Promise.all(At.map(G=>h(C,nt,G))),m(nt)})(),b,v,_,w,l)}const F=await I,Q=e(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[U,W,D]=T;F!==null&&(Q.buffer=F,Q.start(0)),Q.connect(U);for(let R=0,N=0;R<C.numberOfOutputs;R+=1){const q=W[R];for(let J=0;J<_[R];J+=1)U.connect(q,N+J,J);N+=_[R]}return D}if(x)for(const[F,Q]of C.parameters.entries())await n(b,Q,S.parameters.get(F));else for(const[F,Q]of C.parameters.entries())await p(b,Q,S.parameters.get(F));return await h(C,b,S),S};return{render(C,b){A(b,C);const S=y.get(b);return S!==void 0?Promise.resolve(S):B(C,b)}}},qy=(n,t,e,s,r,i,o,A,a,l,c,u,d,p,h,m,g,v,w,y)=>class extends h{constructor(B,C){super(B,C),this._nativeContext=B,this._audioWorklet=n===void 0?void 0:{addModule:(b,S)=>n(this,b,S)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new r(this)}createBuffer(B,C,b){return new e({length:C,numberOfChannels:B,sampleRate:b})}createBufferSource(){return new s(this)}createChannelMerger(B=6){return new i(this,{numberOfInputs:B})}createChannelSplitter(B=6){return new o(this,{numberOfOutputs:B})}createConstantSource(){return new A(this)}createConvolver(){return new a(this)}createDelay(B=1){return new c(this,{maxDelayTime:B})}createDynamicsCompressor(){return new u(this)}createGain(){return new d(this)}createIIRFilter(B,C){return new p(this,{feedback:C,feedforward:B})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(B,C,b={disableNormalization:!1}){return new v(this,{...b,imag:C,real:B})}createStereoPanner(){return new w(this)}createWaveShaper(){return new y(this)}decodeAudioData(B,C,b){return l(this._nativeContext,B).then(S=>(typeof C=="function"&&C(S),S),S=>{throw typeof b=="function"&&b(S),S})}},zy={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},$y=(n,t,e,s,r,i,o,A)=>class extends n{constructor(l,c){const u=i(l),d={...zy,...c},p=r(u,d),h=o(u),m=h?e():null;super(l,!1,p,m),this._Q=t(this,h,p.Q,nn,cn),this._detune=t(this,h,p.detune,1200*Math.log2(nn),-1200*Math.log2(nn)),this._frequency=t(this,h,p.frequency,l.sampleRate/2,0),this._gain=t(this,h,p.gain,40*Math.log10(nn),cn),this._nativeBiquadFilterNode=p,A(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,c,u){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,c,u)}catch(d){throw d.code===11?s():d}if(l.length!==c.length||c.length!==u.length)throw s()}},Xy=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(A,a)=>{let l=e(A);const c=je(l,a);if(!c){const u={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=t(a,u)}return i.set(a,l),c?(await n(a,A.Q,l.Q),await n(a,A.detune,l.detune),await n(a,A.frequency,l.frequency),await n(a,A.gain,l.gain)):(await s(a,A.Q,l.Q),await s(a,A.detune,l.detune),await s(a,A.frequency,l.frequency),await s(a,A.gain,l.gain)),await r(A,a,l),l};return{render(A,a){const l=i.get(a);return l!==void 0?Promise.resolve(l):o(A,a)}}},Yy=(n,t)=>(e,s)=>{const r=t.get(e);if(r!==void 0)return r;const i=n.get(e);if(i!==void 0)return i;try{const o=s();return o instanceof Promise?(n.set(e,o),o.catch(()=>!1).then(A=>(n.delete(e),t.set(e,A),A))):(t.set(e,o),o)}catch{return t.set(e,!1),!1}},jy={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Jy=(n,t,e,s,r)=>class extends n{constructor(o,A){const a=s(o),l={...jy,...A},c=e(a,l),u=r(a)?t():null;super(o,!1,c,u)}},Zy=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,numberOfInputs:A.numberOfInputs};A=n(o,l)}return s.set(o,A),await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},t1={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},e1=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=s(A),c=i({...t1,...a}),u=e(l,c),d=r(l)?t():null;super(A,!1,u,d)}},n1=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,numberOfOutputs:A.numberOfOutputs};A=n(o,l)}return s.set(o,A),await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},s1=n=>(t,e,s)=>n(e,t,s),r1=n=>(t,e,s=0,r=0)=>{const i=t[s];if(i===void 0)throw n();return hc(e)?i.connect(e,0,r):i.connect(e,0)},i1=n=>(t,e)=>{const s=n(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=t.createBuffer(1,2,44100);return s.buffer=r,s.loop=!0,s.connect(e),s.start(),()=>{s.stop(),s.disconnect(e)}},o1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},A1=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...o1,...l},d=s(c,u),p=i(c),h=p?e():null;super(a,!1,d,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=d,this._offset=t(this,p,d.offset,nn,cn),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(a){const l=typeof a=="function"?o(this,a):null;this._nativeConstantSourceNode.onended=l;const c=this._nativeConstantSourceNode.onended;this._onended=c!==null&&c===l?a:c}start(a=0){if(this._nativeConstantSourceNode.start(a),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=a),this.context.state!=="closed"){ko(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),nr(this)&&Ea(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(a=0){this._nativeConstantSourceNode.stop(a),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=a)}},a1=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,A=null;const a=async(l,c)=>{let u=e(l);const d=je(u,c);if(!d){const p={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,offset:u.offset.value};u=t(c,p),o!==null&&u.start(o),A!==null&&u.stop(A)}return i.set(c,u),d?await n(c,l.offset,u.offset):await s(c,l.offset,u.offset),await r(l,c,u),u};return{set start(l){o=l},set stop(l){A=l},render(l,c){const u=i.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},l1=n=>t=>(n[0]=t,n[0]),c1={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},u1=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=s(A),c={...c1,...a},u=e(l,c),p=r(l)?t():null;super(A,!1,u,p),this._isBufferNullified=!1,this._nativeConvolverNode=u,c.buffer!==null&&i(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(A){if(this._nativeConvolverNode.buffer=A,A===null&&this._nativeConvolverNode.buffer!==null){const a=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=a.createBuffer(1,1,a.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(A){this._nativeConvolverNode.normalize=A}},d1=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={buffer:A.buffer,channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,disableNormalization:!A.normalize};A=n(o,l)}return s.set(o,A),jo(A)?await e(i,o,A.inputs[0]):await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},h1=(n,t)=>(e,s,r)=>{if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(e,s,r)}catch(i){throw i.name==="SyntaxError"?n():i}},f1=()=>new DOMException("","DataCloneError"),fm=n=>{const{port1:t,port2:e}=new MessageChannel;return new Promise(s=>{const r=()=>{e.onmessage=null,t.close(),e.close(),s()};e.onmessage=()=>r();try{t.postMessage(n,[n])}catch{}finally{r()}})},p1=(n,t,e,s,r,i,o,A,a,l,c)=>(u,d)=>{const p=o(u)?u:i(u);if(r.has(d)){const h=e();return Promise.reject(h)}try{r.add(d)}catch{}return t(a,()=>a(p))?p.decodeAudioData(d).then(h=>(fm(d).catch(()=>{}),t(A,()=>A(h))||c(h),n.add(h),h)):new Promise((h,m)=>{const g=async()=>{try{await fm(d)}catch{}},v=w=>{m(w),g()};try{p.decodeAudioData(d,w=>{typeof w.copyFromChannel!="function"&&(l(w),Cf(w)),n.add(w),g().then(()=>h(w))},w=>{v(w===null?s():w)})}catch(w){v(w)}})},m1=(n,t,e,s,r,i,o,A)=>(a,l)=>{const c=t.get(a);if(c===void 0)throw new Error("Missing the expected cycle count.");const u=i(a.context),d=A(u);if(c===l){if(t.delete(a),!d&&o(a)){const p=s(a),{outputs:h}=e(a);for(const m of h)if(Ia(m)){const g=s(m[0]);n(p,g,m[1],m[2])}else{const g=r(m[0]);p.connect(g,m[1])}}}else t.set(a,c-l)},g1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},v1=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...g1,...l},d=s(c,u),p=i(c),h=p?e(u.maxDelayTime):null;super(a,!1,d,h),this._delayTime=t(this,p,d.delayTime),o(this,u.maxDelayTime)}get delayTime(){return this._delayTime}},w1=(n,t,e,s,r)=>i=>{const o=new WeakMap,A=async(a,l)=>{let c=e(a);const u=je(c,l);if(!u){const d={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,delayTime:c.delayTime.value,maxDelayTime:i};c=t(l,d)}return o.set(l,c),u?await n(l,a.delayTime,c.delayTime):await s(l,a.delayTime,c.delayTime),await r(a,l,c),c};return{render(a,l){const c=o.get(l);return c!==void 0?Promise.resolve(c):A(a,l)}}},B1=n=>(t,e,s,r)=>n(t[r],i=>i[0]===e&&i[1]===s),C1=n=>(t,e)=>{n(t).delete(e)},b1=n=>"delayTime"in n,y1=(n,t,e)=>function s(r,i){const o=cc(i)?i:e(n,i);if(b1(o))return[];if(r[0]===o)return[r];if(r.includes(o))return[];const{outputs:A}=t(o);return Array.from(A).map(a=>s([...r,o],a[0])).reduce((a,l)=>a.concat(l),[])},qa=(n,t,e)=>{const s=t[e];if(s===void 0)throw n();return s},S1=n=>(t,e=void 0,s=void 0,r=0)=>e===void 0?t.forEach(i=>i.disconnect()):typeof e=="number"?qa(n,t,e).disconnect():hc(e)?s===void 0?t.forEach(i=>i.disconnect(e)):r===void 0?qa(n,t,s).disconnect(e,0):qa(n,t,s).disconnect(e,0,r):s===void 0?t.forEach(i=>i.disconnect(e)):qa(n,t,s).disconnect(e,0),E1={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},x1=(n,t,e,s,r,i,o,A)=>class extends n{constructor(l,c){const u=i(l),d={...E1,...c},p=s(u,d),h=o(u),m=h?e():null;super(l,!1,p,m),this._attack=t(this,h,p.attack),this._knee=t(this,h,p.knee),this._nativeDynamicsCompressorNode=p,this._ratio=t(this,h,p.ratio),this._release=t(this,h,p.release),this._threshold=t(this,h,p.threshold),A(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const c=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=c,r()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const c=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=c,r()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},I1=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(A,a)=>{let l=e(A);const c=je(l,a);if(!c){const u={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=t(a,u)}return i.set(a,l),c?(await n(a,A.attack,l.attack),await n(a,A.knee,l.knee),await n(a,A.ratio,l.ratio),await n(a,A.release,l.release),await n(a,A.threshold,l.threshold)):(await s(a,A.attack,l.attack),await s(a,A.knee,l.knee),await s(a,A.ratio,l.ratio),await s(a,A.release,l.release),await s(a,A.threshold,l.threshold)),await r(A,a,l),l};return{render(A,a){const l=i.get(a);return l!==void 0?Promise.resolve(l):o(A,a)}}},F1=()=>new DOMException("","EncodingError"),T1=n=>t=>new Promise((e,s)=>{if(n===null){s(new SyntaxError);return}const r=n.document.head;if(r===null)s(new SyntaxError);else{const i=n.document.createElement("script"),o=new Blob([t],{type:"application/javascript"}),A=URL.createObjectURL(o),a=n.onerror,l=()=>{n.onerror=a,URL.revokeObjectURL(A)};n.onerror=(c,u,d,p,h)=>{if(u===A||u===n.location.href&&d===1&&p===1)return l(),s(h),!1;if(a!==null)return a(c,u,d,p,h)},i.onerror=()=>{l(),s(new SyntaxError)},i.onload=()=>{l(),e()},i.src=A,i.type="module",r.appendChild(i)}}),_1=n=>class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(e,s,r){if(s!==null){let i=this._listeners.get(s);i===void 0&&(i=n(this,s),typeof s=="function"&&this._listeners.set(s,i)),this._nativeEventTarget.addEventListener(e,i,r)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,s,r){const i=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(e,i===void 0?null:i,r)}},M1=n=>(t,e,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(t*e)}},currentTime:{configurable:!0,get(){return t}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},Q1=n=>async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw n()},U1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},P1=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=r(A),c={...U1,...a},u=s(l,c),d=i(l),p=d?e():null;super(A,!1,u,p),this._gain=t(this,d,u.gain,nn,cn)}get gain(){return this._gain}},N1=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(A,a)=>{let l=e(A);const c=je(l,a);if(!c){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=t(a,u)}return i.set(a,l),c?await n(a,A.gain,l.gain):await s(a,A.gain,l.gain),await r(A,a,l),l};return{render(A,a){const l=i.get(a);return l!==void 0?Promise.resolve(l):o(A,a)}}},D1=(n,t)=>e=>t(n,e),L1=n=>t=>{const e=n(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer},k1=n=>t=>{var e;return(e=n.get(t))!==null&&e!==void 0?e:0},R1=n=>t=>{const e=n(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return e.renderer},H1=n=>t=>n.get(t),Te=()=>new DOMException("","InvalidStateError"),O1=n=>t=>{const e=n.get(t);if(e===void 0)throw Te();return e},V1=(n,t)=>e=>{let s=n.get(e);if(s!==void 0)return s;if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new t(1,1,44100),n.set(e,s),s},W1=n=>t=>{const e=n.get(t);if(e===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return e},eu=()=>new DOMException("","InvalidAccessError"),G1=n=>{n.getFrequencyResponse=(t=>(e,s,r)=>{if(e.length!==s.length||s.length!==r.length)throw eu();return t.call(n,e,s,r)})(n.getFrequencyResponse)},K1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},q1=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=s(A),c=r(l),u={...K1,...a},d=t(l,c?null:A.baseLatency,u),p=c?e(u.feedback,u.feedforward):null;super(A,!1,d,p),G1(d),this._nativeIIRFilterNode=d,i(this,1)}getFrequencyResponse(A,a,l){return this._nativeIIRFilterNode.getFrequencyResponse(A,a,l)}},Iv=(n,t,e,s,r,i,o,A,a,l,c)=>{const u=l.length;let d=A;for(let p=0;p<u;p+=1){let h=e[0]*l[p];for(let m=1;m<r;m+=1){const g=d-m&a-1;h+=e[m]*i[g],h-=n[m]*o[g]}for(let m=r;m<s;m+=1)h+=e[m]*i[d-m&a-1];for(let m=r;m<t;m+=1)h-=n[m]*o[d-m&a-1];i[d]=l[p],o[d]=h,d=d+1&a-1,c[p]=h}return d},z1=(n,t,e,s)=>{const r=e instanceof Float64Array?e:new Float64Array(e),i=s instanceof Float64Array?s:new Float64Array(s),o=r.length,A=i.length,a=Math.min(o,A);if(r[0]!==1){for(let h=0;h<o;h+=1)i[h]/=r[0];for(let h=1;h<A;h+=1)r[h]/=r[0]}const l=32,c=new Float32Array(l),u=new Float32Array(l),d=t.createBuffer(n.numberOfChannels,n.length,n.sampleRate),p=n.numberOfChannels;for(let h=0;h<p;h+=1){const m=n.getChannelData(h),g=d.getChannelData(h);c.fill(0),u.fill(0),Iv(r,o,i,A,a,c,u,0,l,m,g)}return d},$1=(n,t,e,s,r)=>(i,o)=>{const A=new WeakMap;let a=null;const l=async(c,u)=>{let d=null,p=t(c);const h=je(p,u);if(u.createIIRFilter===void 0?d=n(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):h||(p=u.createIIRFilter(o,i)),A.set(u,d===null?p:d),d!==null){if(a===null){if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new e(c.context.destination.channelCount,c.context.length,u.sampleRate);a=(async()=>{await s(c,g,g.destination);const v=await r(g);return z1(v,u,i,o)})()}const m=await a;return d.buffer=m,d.start(0),d}return await s(c,u,p),p};return{render(c,u){const d=A.get(u);return d!==void 0?Promise.resolve(d):l(c,u)}}},X1=(n,t,e,s,r,i)=>o=>(A,a)=>{const l=n.get(A);if(l===void 0){if(!o&&i(A)){const c=s(A),{outputs:u}=e(A);for(const d of u)if(Ia(d)){const p=s(d[0]);t(c,p,d[1],d[2])}else{const p=r(d[0]);c.disconnect(p,d[1])}}n.set(A,a)}else n.set(A,l+a)},Y1=(n,t)=>e=>{const s=n.get(e);return t(s)||t(e)},j1=(n,t)=>e=>n.has(e)||t(e),J1=(n,t)=>e=>n.has(e)||t(e),Z1=(n,t)=>e=>{const s=n.get(e);return t(s)||t(e)},tS=n=>t=>n!==null&&t instanceof n,eS=n=>t=>n!==null&&typeof n.AudioNode=="function"&&t instanceof n.AudioNode,nS=n=>t=>n!==null&&typeof n.AudioParam=="function"&&t instanceof n.AudioParam,sS=(n,t)=>e=>n(e)||t(e),rS=n=>t=>n!==null&&t instanceof n,iS=n=>n!==null&&n.isSecureContext,oS=(n,t,e,s)=>class extends n{constructor(i,o){const A=e(i),a=t(A,o);if(s(A))throw TypeError();super(i,!0,a,null),this._nativeMediaElementAudioSourceNode=a}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},AS={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},aS=(n,t,e,s)=>class extends n{constructor(i,o){const A=e(i);if(s(A))throw new TypeError;const a={...AS,...o},l=t(A,a);super(i,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},lS=(n,t,e,s)=>class extends n{constructor(i,o){const A=e(i),a=t(A,o);if(s(A))throw new TypeError;super(i,!0,a,null),this._nativeMediaStreamAudioSourceNode=a}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},cS=(n,t,e)=>class extends n{constructor(r,i){const o=e(r),A=t(o,i);super(r,!0,A,null)}},uS=(n,t,e,s,r,i)=>class extends e{constructor(A,a){super(A),this._nativeContext=A,Zc.set(this,A),s(A)&&r.set(A,new Set),this._destination=new n(this,a),this._listener=t(this,A),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(A){const a=typeof A=="function"?i(this,A):null;this._nativeContext.onstatechange=a;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===a?A:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},XA=n=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const e=n.decodeAudioData(t.buffer,()=>{});return e===void 0?!1:(e.catch(()=>{}),!0)}catch{}return!1},dS=(n,t)=>(e,s,r)=>{const i=new Set;return e.connect=(o=>(A,a=0,l=0)=>{const c=i.size===0;if(t(A))return o.call(e,A,a,l),n(i,[A,a,l],u=>u[0]===A&&u[1]===a&&u[2]===l,!0),c&&s(),A;o.call(e,A,a),n(i,[A,a],u=>u[0]===A&&u[1]===a,!0),c&&s()})(e.connect),e.disconnect=(o=>(A,a,l)=>{const c=i.size>0;if(A===void 0)o.apply(e),i.clear();else if(typeof A=="number"){o.call(e,A);for(const d of i)d[1]===A&&i.delete(d)}else{t(A)?o.call(e,A,a,l):o.call(e,A,a);for(const d of i)d[0]===A&&(a===void 0||d[1]===a)&&(l===void 0||d[2]===l)&&i.delete(d)}const u=i.size===0;c&&u&&r()})(e.disconnect),e},se=(n,t,e)=>{const s=t[e];s!==void 0&&s!==n[e]&&(n[e]=s)},Ee=(n,t)=>{se(n,t,"channelCount"),se(n,t,"channelCountMode"),se(n,t,"channelInterpretation")},pm=n=>typeof n.getFloatTimeDomainData=="function",hS=n=>{n.getFloatTimeDomainData=t=>{const e=new Uint8Array(t.length);n.getByteTimeDomainData(e);const s=Math.max(e.length,n.fftSize);for(let r=0;r<s;r+=1)t[r]=(e[r]-128)*.0078125;return t}},fS=(n,t)=>(e,s)=>{const r=e.createAnalyser();if(Ee(r,s),!(s.maxDecibels>s.minDecibels))throw t();return se(r,s,"fftSize"),se(r,s,"maxDecibels"),se(r,s,"minDecibels"),se(r,s,"smoothingTimeConstant"),n(pm,()=>pm(r))||hS(r),r},pS=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,Ae=(n,t,e)=>{const s=t[e];s!==void 0&&s!==n[e].value&&(n[e].value=s)},mS=n=>{n.start=(t=>{let e=!1;return(s=0,r=0,i)=>{if(e)throw Te();t.call(n,s,r,i),e=!0}})(n.start)},Sf=n=>{n.start=(t=>(e=0,s=0,r)=>{if(typeof r=="number"&&r<0||s<0||e<0)throw new RangeError("The parameters can't be negative.");t.call(n,e,s,r)})(n.start)},Ef=n=>{n.stop=(t=>(e=0)=>{if(e<0)throw new RangeError("The parameter can't be negative.");t.call(n,e)})(n.stop)},gS=(n,t,e,s,r,i,o,A,a,l,c)=>(u,d)=>{const p=u.createBufferSource();return Ee(p,d),Ae(p,d,"playbackRate"),se(p,d,"buffer"),se(p,d,"loop"),se(p,d,"loopEnd"),se(p,d,"loopStart"),t(e,()=>e(u))||mS(p),t(s,()=>s(u))||a(p),t(r,()=>r(u))||l(p,u),t(i,()=>i(u))||Sf(p),t(o,()=>o(u))||c(p,u),t(A,()=>A(u))||Ef(p),n(u,p),p},vS=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,wS=(n,t)=>(e,s,r)=>{const i=e.destination;if(i.channelCount!==s)try{i.channelCount=s}catch{}r&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:s});const o=n(e,{channelCount:s,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return t(o,"channelCount",A=>()=>A.call(o),A=>a=>{A.call(o,a);try{i.channelCount=a}catch(l){if(a>i.maxChannelCount)throw l}}),t(o,"channelCountMode",A=>()=>A.call(o),A=>a=>{A.call(o,a),i.channelCountMode=a}),t(o,"channelInterpretation",A=>()=>A.call(o),A=>a=>{A.call(o,a),i.channelInterpretation=a}),Object.defineProperty(o,"maxChannelCount",{get:()=>i.maxChannelCount}),o.connect(i),o},BS=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,CS=n=>{const{port1:t}=new MessageChannel;try{t.postMessage(n)}finally{t.close()}},bS=(n,t,e,s,r)=>(i,o,A,a,l,c)=>{if(A!==null)try{const u=new A(i,a,c),d=new Map;let p=null;if(Object.defineProperties(u,{channelCount:{get:()=>c.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>p,set:h=>{typeof p=="function"&&u.removeEventListener("processorerror",p),p=typeof h=="function"?h:null,typeof p=="function"&&u.addEventListener("processorerror",p)}}}),u.addEventListener=(h=>(...m)=>{if(m[0]==="processorerror"){const g=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(g!==null){const v=d.get(m[1]);v!==void 0?m[1]=v:(m[1]=w=>{w.type==="error"?(Object.defineProperties(w,{type:{value:"processorerror"}}),g(w)):g(new ErrorEvent(m[0],{...w}))},d.set(g,m[1]))}}return h.call(u,"error",m[1],m[2]),h.call(u,...m)})(u.addEventListener),u.removeEventListener=(h=>(...m)=>{if(m[0]==="processorerror"){const g=d.get(m[1]);g!==void 0&&(d.delete(m[1]),m[1]=g)}return h.call(u,"error",m[1],m[2]),h.call(u,m[0],m[1],m[2])})(u.removeEventListener),c.numberOfOutputs!==0){const h=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return u.connect(h).connect(i.destination),r(u,()=>h.disconnect(),()=>h.connect(i.destination))}return u}catch(u){throw u.code===11?s():u}if(l===void 0)throw s();return CS(c),t(i,o,l,c)},Fv=(n,t)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*t))))),yS=n=>new Promise((t,e)=>{const{port1:s,port2:r}=new MessageChannel;s.onmessage=({data:i})=>{s.close(),r.close(),t(i)},s.onmessageerror=({data:i})=>{s.close(),r.close(),e(i)},r.postMessage(n)}),SS=async(n,t)=>{const e=await yS(t);return new n(e)},ES=(n,t,e,s)=>{let r=jd.get(n);r===void 0&&(r=new WeakMap,jd.set(n,r));const i=SS(e,s);return r.set(t,i),i},xS=(n,t,e,s,r,i,o,A,a,l,c,u,d)=>(p,h,m,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw a();const v=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(v.some(k=>k<1))throw a();if(v.length!==g.numberOfOutputs)throw t();if(g.channelCountMode!=="explicit")throw a();const w=g.channelCount*g.numberOfInputs,y=v.reduce((k,z)=>k+z,0),I=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(w+I>6||y>6)throw a();const B=new MessageChannel,C=[],b=[];for(let k=0;k<g.numberOfInputs;k+=1)C.push(o(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),b.push(r(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const S=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:k,maxValue:z,minValue:$,name:rt}of m.parameterDescriptors){const et=i(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[rt]!==void 0?g.parameterData[rt]:k===void 0?0:k});Object.defineProperties(et.offset,{defaultValue:{get:()=>k===void 0?0:k},maxValue:{get:()=>z===void 0?nn:z},minValue:{get:()=>$===void 0?cn:$}}),S.push(et)}const T=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,w+I)}),x=Fv(h,p.sampleRate),_=A(p,x,w+I,Math.max(1,y)),F=r(p,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),Q=[];for(let k=0;k<g.numberOfOutputs;k+=1)Q.push(s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[k]}));for(let k=0;k<g.numberOfInputs;k+=1){C[k].connect(b[k]);for(let z=0;z<g.channelCount;z+=1)b[k].connect(T,z,k*g.channelCount+z)}const U=new Ev(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:k},z)=>{const $=S[z];return $.connect(T,0,w+z),$.start(0),[k,$.offset]}));T.connect(_);let W=g.channelInterpretation,D=null;const R=g.numberOfOutputs===0?[_]:Q,N={get bufferSize(){return x},get channelCount(){return g.channelCount},set channelCount(k){throw e()},get channelCountMode(){return g.channelCountMode},set channelCountMode(k){throw e()},get channelInterpretation(){return W},set channelInterpretation(k){for(const z of C)z.channelInterpretation=k;W=k},get context(){return _.context},get inputs(){return C},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return D},set onprocessorerror(k){typeof D=="function"&&N.removeEventListener("processorerror",D),D=typeof k=="function"?k:null,typeof D=="function"&&N.addEventListener("processorerror",D)},get parameters(){return U},get port(){return B.port2},addEventListener(...k){return _.addEventListener(k[0],k[1],k[2])},connect:n.bind(null,R),disconnect:l.bind(null,R),dispatchEvent(...k){return _.dispatchEvent(k[0])},removeEventListener(...k){return _.removeEventListener(k[0],k[1],k[2])}},q=new Map;B.port1.addEventListener=(k=>(...z)=>{if(z[0]==="message"){const $=typeof z[1]=="function"?z[1]:typeof z[1]=="object"&&z[1]!==null&&typeof z[1].handleEvent=="function"?z[1].handleEvent:null;if($!==null){const rt=q.get(z[1]);rt!==void 0?z[1]=rt:(z[1]=et=>{c(p.currentTime,p.sampleRate,()=>$(et))},q.set($,z[1]))}}return k.call(B.port1,z[0],z[1],z[2])})(B.port1.addEventListener),B.port1.removeEventListener=(k=>(...z)=>{if(z[0]==="message"){const $=q.get(z[1]);$!==void 0&&(q.delete(z[1]),z[1]=$)}return k.call(B.port1,z[0],z[1],z[2])})(B.port1.removeEventListener);let J=null;Object.defineProperty(B.port1,"onmessage",{get:()=>J,set:k=>{typeof J=="function"&&B.port1.removeEventListener("message",J),J=typeof k=="function"?k:null,typeof J=="function"&&(B.port1.addEventListener("message",J),B.port1.start())}}),m.prototype.port=B.port1;let nt=null;ES(p,N,m,g).then(k=>nt=k);const ot=pc(g.numberOfInputs,g.channelCount),V=pc(g.numberOfOutputs,v),H=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((k,{name:z})=>({...k,[z]:new Float32Array(128)}),{});let G=!0;const Y=()=>{g.numberOfOutputs>0&&_.disconnect(F);for(let k=0,z=0;k<g.numberOfOutputs;k+=1){const $=Q[k];for(let rt=0;rt<v[k];rt+=1)F.disconnect($,z+rt,rt);z+=v[k]}},P=new Map;_.onaudioprocess=({inputBuffer:k,outputBuffer:z})=>{if(nt!==null){const $=u(N);for(let rt=0;rt<x;rt+=128){for(let et=0;et<g.numberOfInputs;et+=1)for(let it=0;it<g.channelCount;it+=1)fc(k,ot[et],it,it,rt);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:et},it)=>{fc(k,H,et,w+it,rt)});for(let et=0;et<g.numberOfInputs;et+=1)for(let it=0;it<v[et];it+=1)V[et][it].byteLength===0&&(V[et][it]=new Float32Array(128));try{const et=ot.map((at,Ct)=>{if($[Ct].size>0)return P.set(Ct,x/128),at;const Bt=P.get(Ct);return Bt===void 0?[]:(at.every(Et=>Et.every(Qt=>Qt===0))&&(Bt===1?P.delete(Ct):P.set(Ct,Bt-1)),at)});G=c(p.currentTime+rt/p.sampleRate,p.sampleRate,()=>nt.process(et,V,H));for(let at=0,Ct=0;at<g.numberOfOutputs;at+=1){for(let yt=0;yt<v[at];yt+=1)xv(z,V[at],yt,Ct+yt,rt);Ct+=v[at]}}catch(et){G=!1,N.dispatchEvent(new ErrorEvent("processorerror",{colno:et.colno,filename:et.filename,lineno:et.lineno,message:et.message}))}if(!G){for(let et=0;et<g.numberOfInputs;et+=1){C[et].disconnect(b[et]);for(let it=0;it<g.channelCount;it+=1)b[rt].disconnect(T,it,et*g.channelCount+it)}if(m.parameterDescriptors!==void 0){const et=m.parameterDescriptors.length;for(let it=0;it<et;it+=1){const at=S[it];at.disconnect(T,0,w+it),at.stop()}}T.disconnect(_),_.onaudioprocess=null,st?Y():O();break}}}};let st=!1;const L=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),K=()=>_.connect(L).connect(p.destination),O=()=>{_.disconnect(L),L.disconnect()},X=()=>{if(G){O(),g.numberOfOutputs>0&&_.connect(F);for(let k=0,z=0;k<g.numberOfOutputs;k+=1){const $=Q[k];for(let rt=0;rt<v[k];rt+=1)F.connect($,z+rt,rt);z+=v[k]}}st=!0},tt=()=>{G&&(K(),Y()),st=!1};return K(),d(N,X,tt)},Tv=(n,t)=>{const e=n.createBiquadFilter();return Ee(e,t),Ae(e,t,"Q"),Ae(e,t,"detune"),Ae(e,t,"frequency"),Ae(e,t,"gain"),se(e,t,"type"),e},IS=(n,t)=>(e,s)=>{const r=e.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&t(e,r),Ee(r,s),r},FS=n=>{const t=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw Te()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:e=>{if(e!=="explicit")throw Te()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:e=>{if(e!=="discrete")throw Te()}})},Fa=(n,t)=>{const e=n.createChannelSplitter(t.numberOfOutputs);return Ee(e,t),FS(e),e},TS=(n,t,e,s,r)=>(i,o)=>{if(i.createConstantSource===void 0)return e(i,o);const A=i.createConstantSource();return Ee(A,o),Ae(A,o,"offset"),t(s,()=>s(i))||Sf(A),t(r,()=>r(i))||Ef(A),n(i,A),A},Jo=(n,t)=>(n.connect=t.connect.bind(t),n.disconnect=t.disconnect.bind(t),n),_S=(n,t,e,s)=>(r,{offset:i,...o})=>{const A=r.createBuffer(1,2,44100),a=t(r,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=e(r,{...o,gain:i}),c=A.getChannelData(0);c[0]=1,c[1]=1,a.buffer=A,a.loop=!0;const u={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(h){l.channelCount=h},get channelCountMode(){return l.channelCountMode},set channelCountMode(h){l.channelCountMode=h},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(h){l.channelInterpretation=h},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return a.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return a.onended},set onended(h){a.onended=h},addEventListener(...h){return a.addEventListener(h[0],h[1],h[2])},dispatchEvent(...h){return a.dispatchEvent(h[0])},removeEventListener(...h){return a.removeEventListener(h[0],h[1],h[2])},start(h=0){a.start.call(a,h)},stop(h=0){a.stop.call(a,h)}},d=()=>a.connect(l),p=()=>a.disconnect(l);return n(r,a),s(Jo(u,l),d,p)},MS=(n,t)=>(e,s)=>{const r=e.createConvolver();if(Ee(r,s),s.disableNormalization===r.normalize&&(r.normalize=!s.disableNormalization),se(r,s,"buffer"),s.channelCount>2||(t(r,"channelCount",i=>()=>i.call(r),i=>o=>{if(o>2)throw n();return i.call(r,o)}),s.channelCountMode==="max"))throw n();return t(r,"channelCountMode",i=>()=>i.call(r),i=>o=>{if(o==="max")throw n();return i.call(r,o)}),r},_v=(n,t)=>{const e=n.createDelay(t.maxDelayTime);return Ee(e,t),Ae(e,t,"delayTime"),e},QS=n=>(t,e)=>{const s=t.createDynamicsCompressor();if(Ee(s,e),e.channelCount>2||e.channelCountMode==="max")throw n();return Ae(s,e,"attack"),Ae(s,e,"knee"),Ae(s,e,"ratio"),Ae(s,e,"release"),Ae(s,e,"threshold"),s},vn=(n,t)=>{const e=n.createGain();return Ee(e,t),Ae(e,t,"gain"),e},US=n=>(t,e,s)=>{if(t.createIIRFilter===void 0)return n(t,e,s);const r=t.createIIRFilter(s.feedforward,s.feedback);return Ee(r,s),r};function PS(n,t){const e=t[0]*t[0]+t[1]*t[1];return[(n[0]*t[0]+n[1]*t[1])/e,(n[1]*t[0]-n[0]*t[1])/e]}function NS(n,t){return[n[0]*t[0]-n[1]*t[1],n[0]*t[1]+n[1]*t[0]]}function mm(n,t){let e=[0,0];for(let s=n.length-1;s>=0;s-=1)e=NS(e,t),e[0]+=n[s];return e}const DS=(n,t,e,s)=>(r,i,{channelCount:o,channelCountMode:A,channelInterpretation:a,feedback:l,feedforward:c})=>{const u=Fv(i,r.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),p=c instanceof Float64Array?c:new Float64Array(c),h=d.length,m=p.length,g=Math.min(h,m);if(h===0||h>20)throw s();if(d[0]===0)throw t();if(m===0||m>20)throw s();if(p[0]===0)throw t();if(d[0]!==1){for(let S=0;S<m;S+=1)p[S]/=d[0];for(let S=1;S<h;S+=1)d[S]/=d[0]}const v=e(r,u,o,o);v.channelCount=o,v.channelCountMode=A,v.channelInterpretation=a;const w=32,y=[],I=[],B=[];for(let S=0;S<o;S+=1){y.push(0);const T=new Float32Array(w),x=new Float32Array(w);T.fill(0),x.fill(0),I.push(T),B.push(x)}v.onaudioprocess=S=>{const T=S.inputBuffer,x=S.outputBuffer,_=T.numberOfChannels;for(let F=0;F<_;F+=1){const Q=T.getChannelData(F),U=x.getChannelData(F);y[F]=Iv(d,h,p,m,g,I[F],B[F],y[F],w,Q,U)}};const C=r.sampleRate/2;return Jo({get bufferSize(){return u},get channelCount(){return v.channelCount},set channelCount(S){v.channelCount=S},get channelCountMode(){return v.channelCountMode},set channelCountMode(S){v.channelCountMode=S},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(S){v.channelInterpretation=S},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener(...S){return v.addEventListener(S[0],S[1],S[2])},dispatchEvent(...S){return v.dispatchEvent(S[0])},getFrequencyResponse(S,T,x){if(S.length!==T.length||T.length!==x.length)throw n();const _=S.length;for(let F=0;F<_;F+=1){const Q=-Math.PI*(S[F]/C),U=[Math.cos(Q),Math.sin(Q)],W=mm(p,U),D=mm(d,U),R=PS(W,D);T[F]=Math.sqrt(R[0]*R[0]+R[1]*R[1]),x[F]=Math.atan2(R[1],R[0])}},removeEventListener(...S){return v.removeEventListener(S[0],S[1],S[2])}},v)},LS=(n,t)=>n.createMediaElementSource(t.mediaElement),kS=(n,t)=>{const e=n.createMediaStreamDestination();return Ee(e,t),e.numberOfOutputs===1&&Object.defineProperty(e,"numberOfOutputs",{get:()=>0}),e},RS=(n,{mediaStream:t})=>{const e=t.getAudioTracks();e.sort((i,o)=>i.id<o.id?-1:i.id>o.id?1:0);const s=e.slice(0,1),r=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(r,"mediaStream",{value:t}),r},HS=(n,t)=>(e,{mediaStreamTrack:s})=>{if(typeof e.createMediaStreamTrackSource=="function")return e.createMediaStreamTrackSource(s);const r=new MediaStream([s]),i=e.createMediaStreamSource(r);if(s.kind!=="audio")throw n();if(t(e))throw new TypeError;return i},OS=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,VS=(n,t,e,s,r,i)=>(o,A)=>{const a=o.createOscillator();return Ee(a,A),Ae(a,A,"detune"),Ae(a,A,"frequency"),A.periodicWave!==void 0?a.setPeriodicWave(A.periodicWave):se(a,A,"type"),t(e,()=>e(o))||Sf(a),t(s,()=>s(o))||i(a,o),t(r,()=>r(o))||Ef(a),n(o,a),a},WS=n=>(t,e)=>{const s=t.createPanner();return s.orientationX===void 0?n(t,e):(Ee(s,e),Ae(s,e,"orientationX"),Ae(s,e,"orientationY"),Ae(s,e,"orientationZ"),Ae(s,e,"positionX"),Ae(s,e,"positionY"),Ae(s,e,"positionZ"),se(s,e,"coneInnerAngle"),se(s,e,"coneOuterAngle"),se(s,e,"coneOuterGain"),se(s,e,"distanceModel"),se(s,e,"maxDistance"),se(s,e,"panningModel"),se(s,e,"refDistance"),se(s,e,"rolloffFactor"),s)},GS=(n,t,e,s,r,i,o,A,a,l)=>(c,{coneInnerAngle:u,coneOuterAngle:d,coneOuterGain:p,distanceModel:h,maxDistance:m,orientationX:g,orientationY:v,orientationZ:w,panningModel:y,positionX:I,positionY:B,positionZ:C,refDistance:b,rolloffFactor:S,...T})=>{const x=c.createPanner();if(T.channelCount>2||T.channelCountMode==="max")throw o();Ee(x,T);const _={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},F=e(c,{..._,channelInterpretation:"speakers",numberOfInputs:6}),Q=s(c,{...T,gain:1}),U=s(c,{..._,gain:1}),W=s(c,{..._,gain:0}),D=s(c,{..._,gain:0}),R=s(c,{..._,gain:0}),N=s(c,{..._,gain:0}),q=s(c,{..._,gain:0}),J=r(c,256,6,1),nt=i(c,{..._,curve:new Float32Array([1,1]),oversample:"none"});let At=[g,v,w],ot=[I,B,C];const V=new Float32Array(1);J.onaudioprocess=({inputBuffer:P})=>{const st=[a(P,V,0),a(P,V,1),a(P,V,2)];st.some((K,O)=>K!==At[O])&&(x.setOrientation(...st),At=st);const L=[a(P,V,3),a(P,V,4),a(P,V,5)];L.some((K,O)=>K!==ot[O])&&(x.setPosition(...L),ot=L)},Object.defineProperty(W.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(q.gain,"defaultValue",{get:()=>0});const H={get bufferSize(){},get channelCount(){return x.channelCount},set channelCount(P){if(P>2)throw o();Q.channelCount=P,x.channelCount=P},get channelCountMode(){return x.channelCountMode},set channelCountMode(P){if(P==="max")throw o();Q.channelCountMode=P,x.channelCountMode=P},get channelInterpretation(){return x.channelInterpretation},set channelInterpretation(P){Q.channelInterpretation=P,x.channelInterpretation=P},get coneInnerAngle(){return x.coneInnerAngle},set coneInnerAngle(P){x.coneInnerAngle=P},get coneOuterAngle(){return x.coneOuterAngle},set coneOuterAngle(P){x.coneOuterAngle=P},get coneOuterGain(){return x.coneOuterGain},set coneOuterGain(P){if(P<0||P>1)throw t();x.coneOuterGain=P},get context(){return x.context},get distanceModel(){return x.distanceModel},set distanceModel(P){x.distanceModel=P},get inputs(){return[Q]},get maxDistance(){return x.maxDistance},set maxDistance(P){if(P<0)throw new RangeError;x.maxDistance=P},get numberOfInputs(){return x.numberOfInputs},get numberOfOutputs(){return x.numberOfOutputs},get orientationX(){return U.gain},get orientationY(){return W.gain},get orientationZ(){return D.gain},get panningModel(){return x.panningModel},set panningModel(P){x.panningModel=P},get positionX(){return R.gain},get positionY(){return N.gain},get positionZ(){return q.gain},get refDistance(){return x.refDistance},set refDistance(P){if(P<0)throw new RangeError;x.refDistance=P},get rolloffFactor(){return x.rolloffFactor},set rolloffFactor(P){if(P<0)throw new RangeError;x.rolloffFactor=P},addEventListener(...P){return Q.addEventListener(P[0],P[1],P[2])},dispatchEvent(...P){return Q.dispatchEvent(P[0])},removeEventListener(...P){return Q.removeEventListener(P[0],P[1],P[2])}};u!==H.coneInnerAngle&&(H.coneInnerAngle=u),d!==H.coneOuterAngle&&(H.coneOuterAngle=d),p!==H.coneOuterGain&&(H.coneOuterGain=p),h!==H.distanceModel&&(H.distanceModel=h),m!==H.maxDistance&&(H.maxDistance=m),g!==H.orientationX.value&&(H.orientationX.value=g),v!==H.orientationY.value&&(H.orientationY.value=v),w!==H.orientationZ.value&&(H.orientationZ.value=w),y!==H.panningModel&&(H.panningModel=y),I!==H.positionX.value&&(H.positionX.value=I),B!==H.positionY.value&&(H.positionY.value=B),C!==H.positionZ.value&&(H.positionZ.value=C),b!==H.refDistance&&(H.refDistance=b),S!==H.rolloffFactor&&(H.rolloffFactor=S),(At[0]!==1||At[1]!==0||At[2]!==0)&&x.setOrientation(...At),(ot[0]!==0||ot[1]!==0||ot[2]!==0)&&x.setPosition(...ot);const G=()=>{Q.connect(x),n(Q,nt,0,0),nt.connect(U).connect(F,0,0),nt.connect(W).connect(F,0,1),nt.connect(D).connect(F,0,2),nt.connect(R).connect(F,0,3),nt.connect(N).connect(F,0,4),nt.connect(q).connect(F,0,5),F.connect(J).connect(c.destination)},Y=()=>{Q.disconnect(x),A(Q,nt,0,0),nt.disconnect(U),U.disconnect(F),nt.disconnect(W),W.disconnect(F),nt.disconnect(D),D.disconnect(F),nt.disconnect(R),R.disconnect(F),nt.disconnect(N),N.disconnect(F),nt.disconnect(q),q.disconnect(F),F.disconnect(J),J.disconnect(c.destination)};return l(Jo(H,x),G,Y)},KS=n=>(t,{disableNormalization:e,imag:s,real:r})=>{const i=s instanceof Float32Array?s:new Float32Array(s),o=r instanceof Float32Array?r:new Float32Array(r),A=t.createPeriodicWave(o,i,{disableNormalization:e});if(Array.from(s).length<2)throw n();return A},Ta=(n,t,e,s)=>n.createScriptProcessor(t,e,s),qS=(n,t)=>(e,s)=>{const r=s.channelCountMode;if(r==="clamped-max")throw t();if(e.createStereoPanner===void 0)return n(e,s);const i=e.createStereoPanner();return Ee(i,s),Ae(i,s,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>r,set:o=>{if(o!==r)throw t()}}),i},zS=(n,t,e,s,r,i)=>{const A=new Float32Array([1,1]),a=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},c={...l,oversample:"none"},u=(h,m,g,v)=>{const w=new Float32Array(16385),y=new Float32Array(16385);for(let T=0;T<16385;T+=1){const x=T/16384*a;w[T]=Math.cos(x),y[T]=Math.sin(x)}const I=e(h,{...l,gain:0}),B=s(h,{...c,curve:w}),C=s(h,{...c,curve:A}),b=e(h,{...l,gain:0}),S=s(h,{...c,curve:y});return{connectGraph(){m.connect(I),m.connect(C.inputs===void 0?C:C.inputs[0]),m.connect(b),C.connect(g),g.connect(B.inputs===void 0?B:B.inputs[0]),g.connect(S.inputs===void 0?S:S.inputs[0]),B.connect(I.gain),S.connect(b.gain),I.connect(v,0,0),b.connect(v,0,1)},disconnectGraph(){m.disconnect(I),m.disconnect(C.inputs===void 0?C:C.inputs[0]),m.disconnect(b),C.disconnect(g),g.disconnect(B.inputs===void 0?B:B.inputs[0]),g.disconnect(S.inputs===void 0?S:S.inputs[0]),B.disconnect(I.gain),S.disconnect(b.gain),I.disconnect(v,0,0),b.disconnect(v,0,1)}}},d=(h,m,g,v)=>{const w=new Float32Array(16385),y=new Float32Array(16385),I=new Float32Array(16385),B=new Float32Array(16385),C=Math.floor(16385/2);for(let R=0;R<16385;R+=1)if(R>C){const N=(R-C)/(16384-C)*a;w[R]=Math.cos(N),y[R]=Math.sin(N),I[R]=0,B[R]=1}else{const N=R/(16384-C)*a;w[R]=1,y[R]=0,I[R]=Math.cos(N),B[R]=Math.sin(N)}const b=t(h,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),S=e(h,{...l,gain:0}),T=s(h,{...c,curve:w}),x=e(h,{...l,gain:0}),_=s(h,{...c,curve:y}),F=s(h,{...c,curve:A}),Q=e(h,{...l,gain:0}),U=s(h,{...c,curve:I}),W=e(h,{...l,gain:0}),D=s(h,{...c,curve:B});return{connectGraph(){m.connect(b),m.connect(F.inputs===void 0?F:F.inputs[0]),b.connect(S,0),b.connect(x,0),b.connect(Q,1),b.connect(W,1),F.connect(g),g.connect(T.inputs===void 0?T:T.inputs[0]),g.connect(_.inputs===void 0?_:_.inputs[0]),g.connect(U.inputs===void 0?U:U.inputs[0]),g.connect(D.inputs===void 0?D:D.inputs[0]),T.connect(S.gain),_.connect(x.gain),U.connect(Q.gain),D.connect(W.gain),S.connect(v,0,0),Q.connect(v,0,0),x.connect(v,0,1),W.connect(v,0,1)},disconnectGraph(){m.disconnect(b),m.disconnect(F.inputs===void 0?F:F.inputs[0]),b.disconnect(S,0),b.disconnect(x,0),b.disconnect(Q,1),b.disconnect(W,1),F.disconnect(g),g.disconnect(T.inputs===void 0?T:T.inputs[0]),g.disconnect(_.inputs===void 0?_:_.inputs[0]),g.disconnect(U.inputs===void 0?U:U.inputs[0]),g.disconnect(D.inputs===void 0?D:D.inputs[0]),T.disconnect(S.gain),_.disconnect(x.gain),U.disconnect(Q.gain),D.disconnect(W.gain),S.disconnect(v,0,0),Q.disconnect(v,0,0),x.disconnect(v,0,1),W.disconnect(v,0,1)}}},p=(h,m,g,v,w)=>{if(m===1)return u(h,g,v,w);if(m===2)return d(h,g,v,w);throw r()};return(h,{channelCount:m,channelCountMode:g,pan:v,...w})=>{if(g==="max")throw r();const y=n(h,{...w,channelCount:1,channelCountMode:g,numberOfInputs:2}),I=e(h,{...w,channelCount:m,channelCountMode:g,gain:1}),B=e(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:v});let{connectGraph:C,disconnectGraph:b}=p(h,m,I,B,y);Object.defineProperty(B.gain,"defaultValue",{get:()=>0}),Object.defineProperty(B.gain,"maxValue",{get:()=>1}),Object.defineProperty(B.gain,"minValue",{get:()=>-1});const S={get bufferSize(){},get channelCount(){return I.channelCount},set channelCount(F){I.channelCount!==F&&(T&&b(),{connectGraph:C,disconnectGraph:b}=p(h,F,I,B,y),T&&C()),I.channelCount=F},get channelCountMode(){return I.channelCountMode},set channelCountMode(F){if(F==="clamped-max"||F==="max")throw r();I.channelCountMode=F},get channelInterpretation(){return I.channelInterpretation},set channelInterpretation(F){I.channelInterpretation=F},get context(){return I.context},get inputs(){return[I]},get numberOfInputs(){return I.numberOfInputs},get numberOfOutputs(){return I.numberOfOutputs},get pan(){return B.gain},addEventListener(...F){return I.addEventListener(F[0],F[1],F[2])},dispatchEvent(...F){return I.dispatchEvent(F[0])},removeEventListener(...F){return I.removeEventListener(F[0],F[1],F[2])}};let T=!1;const x=()=>{C(),T=!0},_=()=>{b(),T=!1};return i(Jo(S,y),x,_)}},$S=(n,t,e,s,r,i,o)=>(A,a)=>{const l=A.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&A.createGain().gain.automationRate===void 0)return e(A,a);Ee(l,a);const c=a.curve===null||a.curve instanceof Float32Array?a.curve:new Float32Array(a.curve);if(c!==null&&c.length<2)throw t();se(l,{curve:c},"curve"),se(l,a,"oversample");let u=null,d=!1;return o(l,"curve",m=>()=>m.call(l),m=>g=>(m.call(l,g),d&&(s(g)&&u===null?u=n(A,l):!s(g)&&u!==null&&(u(),u=null)),g)),r(l,()=>{d=!0,s(l.curve)&&(u=n(A,l))},()=>{d=!1,u!==null&&(u(),u=null)})},XS=(n,t,e,s,r)=>(i,{curve:o,oversample:A,...a})=>{const l=i.createWaveShaper(),c=i.createWaveShaper();Ee(l,a),Ee(c,a);const u=e(i,{...a,gain:1}),d=e(i,{...a,gain:-1}),p=e(i,{...a,gain:1}),h=e(i,{...a,gain:-1});let m=null,g=!1,v=null;const w={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(B){u.channelCount=B,d.channelCount=B,l.channelCount=B,p.channelCount=B,c.channelCount=B,h.channelCount=B},get channelCountMode(){return l.channelCountMode},set channelCountMode(B){u.channelCountMode=B,d.channelCountMode=B,l.channelCountMode=B,p.channelCountMode=B,c.channelCountMode=B,h.channelCountMode=B},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(B){u.channelInterpretation=B,d.channelInterpretation=B,l.channelInterpretation=B,p.channelInterpretation=B,c.channelInterpretation=B,h.channelInterpretation=B},get context(){return l.context},get curve(){return v},set curve(B){if(B!==null&&B.length<2)throw t();if(B===null)l.curve=B,c.curve=B;else{const C=B.length,b=new Float32Array(C+2-C%2),S=new Float32Array(C+2-C%2);b[0]=B[0],S[0]=-B[C-1];const T=Math.ceil((C+1)/2),x=(C+1)/2-1;for(let _=1;_<T;_+=1){const F=_/T*x,Q=Math.floor(F),U=Math.ceil(F);b[_]=Q===U?B[Q]:(1-(F-Q))*B[Q]+(1-(U-F))*B[U],S[_]=Q===U?-B[C-1-Q]:-((1-(F-Q))*B[C-1-Q])-(1-(U-F))*B[C-1-U]}b[T]=C%2===1?B[T-1]:(B[T-2]+B[T-1])/2,l.curve=b,c.curve=S}v=B,g&&(s(v)&&m===null?m=n(i,u):m!==null&&(m(),m=null))},get inputs(){return[u]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(B){l.oversample=B,c.oversample=B},addEventListener(...B){return u.addEventListener(B[0],B[1],B[2])},dispatchEvent(...B){return u.dispatchEvent(B[0])},removeEventListener(...B){return u.removeEventListener(B[0],B[1],B[2])}};o!==null&&(w.curve=o instanceof Float32Array?o:new Float32Array(o)),A!==w.oversample&&(w.oversample=A);const y=()=>{u.connect(l).connect(p),u.connect(d).connect(c).connect(h).connect(p),g=!0,s(v)&&(m=n(i,u))},I=()=>{u.disconnect(l),l.disconnect(p),u.disconnect(d),d.disconnect(c),c.disconnect(h),h.disconnect(p),g=!1,m!==null&&(m(),m=null)};return r(Jo(w,p),y,I)},An=()=>new DOMException("","NotSupportedError"),YS={numberOfChannels:1},jS=(n,t,e,s,r)=>class extends n{constructor(o,A,a){let l;if(typeof o=="number"&&A!==void 0&&a!==void 0)l={length:A,numberOfChannels:o,sampleRate:a};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:c,numberOfChannels:u,sampleRate:d}={...YS,...l},p=s(u,c,d);t(XA,()=>XA(p))||p.addEventListener("statechange",(()=>{let h=0;const m=g=>{this._state==="running"&&(h>0?(p.removeEventListener("statechange",m),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):h+=1)};return m})()),super(p,u),this._length=c,this._nativeOfflineAudioContext=p,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(e()):(this._state="running",r(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Cv(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},JS={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},ZS=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...JS,...l},d=e(c,u),p=i(c),h=p?s():null,m=a.sampleRate/2;super(a,!1,d,h),this._detune=t(this,p,d.detune,153600,-153600),this._frequency=t(this,p,d.frequency,m,-m),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=h,this._oscillatorNodeRenderer!==null&&u.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=u.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(a){const l=typeof a=="function"?o(this,a):null;this._nativeOscillatorNode.onended=l;const c=this._nativeOscillatorNode.onended;this._onended=c!==null&&c===l?a:c}get type(){return this._nativeOscillatorNode.type}set type(a){this._nativeOscillatorNode.type=a,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(a){this._nativeOscillatorNode.setPeriodicWave(a),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=a)}start(a=0){if(this._nativeOscillatorNode.start(a),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=a),this.context.state!=="closed"){ko(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),nr(this)&&Ea(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(a=0){this._nativeOscillatorNode.stop(a),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=a)}},tE=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,A=null,a=null;const l=async(c,u)=>{let d=e(c);const p=je(d,u);if(!p){const h={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=t(u,h),A!==null&&d.start(A),a!==null&&d.stop(a)}return i.set(u,d),p?(await n(u,c.detune,d.detune),await n(u,c.frequency,d.frequency)):(await s(u,c.detune,d.detune),await s(u,c.frequency,d.frequency)),await r(c,u,d),d};return{set periodicWave(c){o=c},set start(c){A=c},set stop(c){a=c},render(c,u){const d=i.get(u);return d!==void 0?Promise.resolve(d):l(c,u)}}},eE={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},nE=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...eE,...l},d=e(c,u),p=i(c),h=p?s():null;super(a,!1,d,h),this._nativePannerNode=d,this._orientationX=t(this,p,d.orientationX,nn,cn),this._orientationY=t(this,p,d.orientationY,nn,cn),this._orientationZ=t(this,p,d.orientationZ,nn,cn),this._positionX=t(this,p,d.positionX,nn,cn),this._positionY=t(this,p,d.positionY,nn,cn),this._positionZ=t(this,p,d.positionZ,nn,cn),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(a){this._nativePannerNode.coneInnerAngle=a}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(a){this._nativePannerNode.coneOuterAngle=a}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(a){this._nativePannerNode.coneOuterGain=a}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(a){this._nativePannerNode.distanceModel=a}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(a){this._nativePannerNode.maxDistance=a}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(a){this._nativePannerNode.panningModel=a}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(a){this._nativePannerNode.refDistance=a}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(a){this._nativePannerNode.rolloffFactor=a}},sE=(n,t,e,s,r,i,o,A,a,l)=>()=>{const c=new WeakMap;let u=null;const d=async(p,h)=>{let m=null,g=i(p);const v={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},w={...v,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},y=je(g,h);if("bufferSize"in g)m=s(h,{...v,gain:1});else if(!y){const I={...w,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=r(h,I)}if(c.set(h,m===null?g:m),m!==null){if(u===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _=new o(6,p.context.length,h.sampleRate),F=t(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});F.connect(_.destination),u=(async()=>{const Q=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map(async(U,W)=>{const D=e(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:W===0?1:0});return await A(_,U,D.offset),D}));for(let U=0;U<6;U+=1)Q[U].connect(F,0,U),Q[U].start(0);return l(_)})()}const I=await u,B=s(h,{...v,gain:1});await a(p,h,B);const C=[];for(let _=0;_<I.numberOfChannels;_+=1)C.push(I.getChannelData(_));let b=[C[0][0],C[1][0],C[2][0]],S=[C[3][0],C[4][0],C[5][0]],T=s(h,{...v,gain:1}),x=r(h,{...w,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:S[0],positionY:S[1],positionZ:S[2]});B.connect(T).connect(x.inputs[0]),x.connect(m);for(let _=128;_<I.length;_+=128){const F=[C[0][_],C[1][_],C[2][_]],Q=[C[3][_],C[4][_],C[5][_]];if(F.some((U,W)=>U!==b[W])||Q.some((U,W)=>U!==S[W])){b=F,S=Q;const U=_/h.sampleRate;T.gain.setValueAtTime(0,U),T=s(h,{...v,gain:0}),x=r(h,{...w,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:S[0],positionY:S[1],positionZ:S[2]}),T.gain.setValueAtTime(1,U),B.connect(T).connect(x.inputs[0]),x.connect(m)}}return m}return y?(await n(h,p.orientationX,g.orientationX),await n(h,p.orientationY,g.orientationY),await n(h,p.orientationZ,g.orientationZ),await n(h,p.positionX,g.positionX),await n(h,p.positionY,g.positionY),await n(h,p.positionZ,g.positionZ)):(await A(h,p.orientationX,g.orientationX),await A(h,p.orientationY,g.orientationY),await A(h,p.orientationZ,g.orientationZ),await A(h,p.positionX,g.positionX),await A(h,p.positionY,g.positionY),await A(h,p.positionZ,g.positionZ)),jo(g)?await a(p,h,g.inputs[0]):await a(p,h,g),g};return{render(p,h){const m=c.get(h);return m!==void 0?Promise.resolve(m):d(p,h)}}},rE={disableNormalization:!1},iE=(n,t,e,s)=>class Mv{constructor(i,o){const A=t(i),a=s({...rE,...o}),l=n(A,a);return e.add(l),l}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===Mv.prototype||e.has(i)}},oE=(n,t)=>(e,s,r)=>(n(s).replay(r),t(s,e,r)),AE=(n,t,e)=>async(s,r,i)=>{const o=n(s);await Promise.all(o.activeInputs.map((A,a)=>Array.from(A).map(async([l,c])=>{const d=await t(l).render(l,r),p=s.context.destination;!e(l)&&(s!==p||!e(s))&&d.connect(i,c,a)})).reduce((A,a)=>[...A,...a],[]))},aE=(n,t,e)=>async(s,r,i)=>{const o=t(s);await Promise.all(Array.from(o.activeInputs).map(async([A,a])=>{const c=await n(A).render(A,r);e(A)||c.connect(i,a)}))},lE=(n,t,e,s)=>r=>n(XA,()=>XA(r))?Promise.resolve(n(s,s)).then(i=>{if(!i){const o=e(r,512,0,1);r.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>r.currentTime,o.connect(r.destination)}return r.startRendering()}):new Promise(i=>{const o=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.oncomplete=A=>{o.disconnect(),i(A.renderedBuffer)},o.connect(r.destination),r.startRendering()}),cE=n=>(t,e)=>{n.set(t,e)},uE=n=>(t,e)=>n.set(t,e),dE=(n,t,e,s,r,i,o,A)=>(a,l)=>e(a).render(a,l).then(()=>Promise.all(Array.from(s(l)).map(c=>e(c).render(c,l)))).then(()=>r(l)).then(c=>(typeof c.copyFromChannel!="function"?(o(c),Cf(c)):t(i,()=>i(c))||A(c),n.add(c),c)),hE={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},fE=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=r(A),c={...hE,...a},u=e(l,c),d=i(l),p=d?s():null;super(A,!1,u,p),this._pan=t(this,d,u.pan)}get pan(){return this._pan}},pE=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(A,a)=>{let l=e(A);const c=je(l,a);if(!c){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=t(a,u)}return i.set(a,l),c?await n(a,A.pan,l.pan):await s(a,A.pan,l.pan),jo(l)?await r(A,a,l.inputs[0]):await r(A,a,l),l};return{render(A,a){const l=i.get(a);return l!==void 0?Promise.resolve(l):o(A,a)}}},mE=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},gE=(n,t)=>async()=>{if(n===null)return!0;if(t===null)return!1;const e=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,44100),r=URL.createObjectURL(e);let i=!1,o=!1;try{await s.audioWorklet.addModule(r);const A=new n(s,"a",{numberOfOutputs:0}),a=s.createOscillator();A.port.onmessage=()=>i=!0,A.onprocessorerror=()=>o=!0,a.connect(A),a.start(0),await s.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(r)}return i&&!o},vE=(n,t)=>()=>{if(t===null)return Promise.resolve(!1);const e=new t(1,1,44100),s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(r=>{e.oncomplete=()=>{s.disconnect(),r(e.currentTime!==0)},e.startRendering()})},wE=()=>new DOMException("","UnknownError"),BE={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},CE=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...BE,...l},d=e(c,u),h=i(c)?s():null;super(a,!0,d,h),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(a){if(a===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(a.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=a}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(a){this._nativeWaveShaperNode.oversample=a}},bE=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,curve:A.curve,oversample:A.oversample};A=n(o,l)}return s.set(o,A),jo(A)?await e(i,o,A.inputs[0]):await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},yE=()=>typeof window>"u"?null:window,SE=(n,t)=>e=>{e.copyFromChannel=(s,r,i=0)=>{const o=n(i),A=n(r);if(A>=e.numberOfChannels)throw t();const a=e.length,l=e.getChannelData(A),c=s.length;for(let u=o<0?-o:0;u+o<a&&u<c;u+=1)s[u]=l[u+o]},e.copyToChannel=(s,r,i=0)=>{const o=n(i),A=n(r);if(A>=e.numberOfChannels)throw t();const a=e.length,l=e.getChannelData(A),c=s.length;for(let u=o<0?-o:0;u+o<a&&u<c;u+=1)l[u+o]=s[u]}},EE=n=>t=>{t.copyFromChannel=(e=>(s,r,i=0)=>{const o=n(i),A=n(r);if(o<t.length)return e.call(t,s,A,o)})(t.copyFromChannel),t.copyToChannel=(e=>(s,r,i=0)=>{const o=n(i),A=n(r);if(o<t.length)return e.call(t,s,A,o)})(t.copyToChannel)},xE=n=>(t,e)=>{const s=e.createBuffer(1,1,44100);t.buffer===null&&(t.buffer=s),n(t,"buffer",r=>()=>{const i=r.call(t);return i===s?null:i},r=>i=>r.call(t,i===null?s:i))},IE=(n,t)=>(e,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const r=e.createBufferSource();t(s,()=>{const A=s.numberOfInputs;for(let a=0;a<A;a+=1)r.connect(s,0,a)},()=>r.disconnect(s))},Qv=(n,t,e)=>n.copyFromChannel===void 0?n.getChannelData(e)[0]:(n.copyFromChannel(t,e),t[0]),Uv=n=>{if(n===null)return!1;const t=n.length;return t%2!==0?n[Math.floor(t/2)]!==0:n[t/2-1]+n[t/2]!==0},_a=(n,t,e,s)=>{let r=n;for(;!r.hasOwnProperty(t);)r=Object.getPrototypeOf(r);const{get:i,set:o}=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(n,t,{get:e(i),set:s(o)})},FE=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),TE=n=>({...n,channelCount:n.numberOfOutputs}),_E=n=>{const{imag:t,real:e}=n;return t===void 0?e===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(e,()=>0),real:e}:e===void 0?{...n,imag:t,real:Array.from(t,()=>0)}:{...n,imag:t,real:e}},Pv=(n,t,e)=>{try{n.setValueAtTime(t,e)}catch(s){if(s.code!==9)throw s;Pv(n,t,e+1e-7)}},ME=n=>{const t=n.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},QE=n=>{const t=n.createBufferSource(),e=n.createBuffer(1,1,44100);t.buffer=e;try{t.start(0,1)}catch{return!1}return!0},UE=n=>{const t=n.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},xf=n=>{const t=n.createOscillator();try{t.start(-1)}catch(e){return e instanceof RangeError}return!1},Nv=n=>{const t=n.createBuffer(1,1,44100),e=n.createBufferSource();e.buffer=t,e.start(),e.stop();try{return e.stop(),!0}catch{return!1}},If=n=>{const t=n.createOscillator();try{t.stop(-1)}catch(e){return e instanceof RangeError}return!1},PE=n=>{const{port1:t,port2:e}=new MessageChannel;try{t.postMessage(n)}finally{t.close(),e.close()}},NE=n=>{n.start=(t=>(e=0,s=0,r)=>{const i=n.buffer,o=i===null?s:Math.min(i.duration,s);i!==null&&o>i.duration-.5/n.context.sampleRate?t.call(n,e,0,0):t.call(n,e,o,r)})(n.start)},Dv=(n,t)=>{const e=t.createGain();n.connect(e);const s=(r=>()=>{r.call(n,e),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),Jo(n,e),n.stop=(r=>{let i=!1;return(o=0)=>{if(i)try{r.call(n,o)}catch{e.gain.setValueAtTime(0,o)}else r.call(n,o),i=!0}})(n.stop)},Zo=(n,t)=>e=>{const s={value:n};return Object.defineProperties(e,{currentTarget:s,target:s}),typeof t=="function"?t.call(n,e):t.handleEvent.call(n,e)},DE=ny(Oi),LE=ay(Oi),kE=B1(tu),Lv=new WeakMap,RE=k1(Lv),cs=Yy(new Map,new WeakMap),Ts=yE(),kv=fS(cs,Ns),Ff=L1(sn),Re=AE(sn,Ff,Mi),HE=hy(kv,Zt,Re),Yt=O1(Zc),dr=OS(Ts),zt=rS(dr),Rv=new WeakMap,Hv=_1(Zo),Ma=vS(Ts),Tf=tS(Ma),_f=eS(Ts),Ov=nS(Ts),YA=BS(Ts),de=ky(sy(fv),Ay(DE,LE,uc,kE,dc,sn,RE,Sa,Zt,Oi,nr,Mi,Rl),cs,X1(Xd,dc,sn,Zt,$A,nr),Ns,eu,An,m1(uc,Xd,sn,Zt,$A,Yt,nr,zt),y1(Rv,sn,as),Hv,Yt,Tf,_f,Ov,zt,YA),OE=dy(de,HE,Ns,kv,Yt,zt),Mf=new WeakSet,gm=pS(Ts),Vv=l1(new Uint32Array(1)),Qf=SE(Vv,Ns),Uf=EE(Vv),Wv=py(Mf,cs,An,gm,dr,mE(gm),Qf,Uf),nu=ly(vn),Gv=aE(Ff,xa,Mi),Ds=s1(Gv),tA=gS(nu,cs,ME,QE,UE,xf,Nv,If,NE,xE(_a),Dv),Ls=oE(R1(xa),Gv),VE=vy(Ds,tA,Zt,Ls,Re),us=Ry(ry(pv),Rv,Bf,Hy,Y2,j2,J2,Z2,ty,qd,dv,Ma,Pv),WE=gy(de,VE,us,Te,tA,Yt,zt,Zo),GE=Iy(de,Fy,Ns,Te,wS(vn,_a),Yt,zt,Re),KE=Xy(Ds,Tv,Zt,Ls,Re),Vi=uE(Lv),qE=$y(de,us,KE,eu,Tv,Yt,zt,Vi),Yr=dS(Oi,_f),zE=IE(Te,Yr),jr=IS(Ma,zE),$E=Zy(jr,Zt,Re),XE=Jy(de,$E,jr,Yt,zt),YE=n1(Fa,Zt,Re),jE=e1(de,YE,Fa,Yt,zt,TE),JE=_S(nu,tA,vn,Yr),eA=TS(nu,cs,JE,xf,If),ZE=a1(Ds,eA,Zt,Ls,Re),tx=A1(de,us,ZE,eA,Yt,zt,Zo),Kv=MS(An,_a),ex=d1(Kv,Zt,Re),nx=u1(de,ex,Kv,Yt,zt,Vi),sx=w1(Ds,_v,Zt,Ls,Re),rx=v1(de,us,sx,_v,Yt,zt,Vi),qv=QS(An),ix=I1(Ds,qv,Zt,Ls,Re),ox=x1(de,us,ix,qv,An,Yt,zt,Vi),Ax=N1(Ds,vn,Zt,Ls,Re),ax=P1(de,us,Ax,vn,Yt,zt),lx=DS(eu,Te,Ta,An),su=lE(cs,vn,Ta,vE(vn,dr)),cx=$1(tA,Zt,dr,Re,su),ux=US(lx),dx=q1(de,ux,cx,Yt,zt,Vi),hx=Ty(us,jr,eA,Ta,An,Qv,zt,_a),zv=new WeakMap,fx=uS(GE,hx,Hv,zt,zv,Zo),$v=VS(nu,cs,xf,Nv,If,Dv),px=tE(Ds,$v,Zt,Ls,Re),mx=ZS(de,us,$v,px,Yt,zt,Zo),Xv=i1(tA),gx=XS(Xv,Te,vn,Uv,Yr),ru=$S(Xv,Te,gx,Uv,Yr,Ma,_a),vx=GS(uc,Te,jr,vn,Ta,ru,An,dc,Qv,Yr),Yv=WS(vx),wx=sE(Ds,jr,eA,vn,Yv,Zt,dr,Ls,Re,su),Bx=nE(de,us,Yv,wx,Yt,zt,Vi),Cx=KS(Ns),bx=iE(Cx,Yt,new WeakSet,_E),yx=zS(jr,Fa,vn,ru,An,Yr),jv=qS(yx,An),Sx=pE(Ds,jv,Zt,Ls,Re),Ex=fE(de,us,jv,Sx,Yt,zt),xx=bE(ru,Zt,Re),Ix=CE(de,Te,ru,xx,Yt,zt,Vi),Jv=iS(Ts),Pf=M1(Ts),Zv=new WeakMap,Fx=V1(Zv,dr),Tx=Jv?oy(cs,An,T1(Ts),Pf,Q1(ey),Yt,Fx,zt,YA,new WeakMap,new WeakMap,gE(YA,dr),Ts):void 0,_x=sS(Tf,zt),Mx=p1(Mf,cs,f1,F1,new WeakSet,Yt,_x,lc,XA,Qf,Uf),tw=qy(Tx,OE,Wv,WE,qE,XE,jE,tx,nx,Mx,rx,ox,ax,dx,fx,mx,Bx,bx,Ex,Ix),Qx=oS(de,LS,Yt,zt),Ux=aS(de,kS,Yt,zt),Px=lS(de,RS,Yt,zt),Nx=HS(Te,zt),Dx=cS(de,Nx,Yt),Lx=xy(tw,Te,An,wE,Qx,Ux,Px,Dx,Ma),Nf=W1(zv),kx=cy(Nf),ew=r1(Ns),Rx=C1(Nf),nw=S1(Ns),sw=new WeakMap,Hx=D1(sw,as),Ox=xS(ew,Ns,Te,jr,Fa,eA,vn,Ta,An,nw,Pf,Hx,Yr),Vx=bS(Te,Ox,vn,An,Yr),Wx=Ky(Ds,ew,tA,jr,Fa,eA,vn,Rx,nw,Pf,Zt,YA,dr,Ls,Re,su),Gx=H1(Zv),Kx=cE(sw),vm=Jv?Vy(kx,de,us,Wx,Vx,sn,Gx,Yt,zt,YA,FE,Kx,PE,Zo):void 0,qx=h1(An,dr),zx=dE(Mf,cs,Ff,Nf,su,lc,Qf,Uf),$x=jS(tw,cs,Te,qx,zx),Xx=Y1(Zc,Tf),Yx=j1(wf,_f),jx=J1(Bf,Ov),Jx=Z1(Zc,zt);function $n(n){return n===void 0}function _t(n){return n!==void 0}function Zx(n){return typeof n=="function"}function or(n){return typeof n=="number"}function yi(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function tI(n){return typeof n=="boolean"}function _n(n){return Array.isArray(n)}function Ar(n){return typeof n=="string"}function za(n){return Ar(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function vt(n,t){if(!n)throw new Error(t)}function ar(n,t,e=1/0){if(!(t<=n&&n<=e))throw new RangeError(`Value must be within [${t}, ${e}], got: ${n}`)}function rw(n){!n.isOffline&&n.state!=="running"&&Qa('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let iw=!1,wm=!1;function Bm(n){iw=n}function eI(n){$n(n)&&iw&&!wm&&(wm=!0,Qa("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let ow=console;function nI(...n){ow.log(...n)}function Qa(...n){ow.warn(...n)}function sI(n){return new Lx(n)}function rI(n,t,e){return new $x(n,t,e)}const xn=typeof self=="object"?self:null,iI=xn&&(xn.hasOwnProperty("AudioContext")||xn.hasOwnProperty("webkitAudioContext"));function oI(n,t,e){return vt(_t(vm),"AudioWorkletNode only works in a secure context (https or localhost)"),new(n instanceof(xn==null?void 0:xn.BaseAudioContext)?xn==null?void 0:xn.AudioWorkletNode:vm)(n,t,e)}function ds(n,t,e,s){var r=arguments.length,i=r<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,t,e,s);else for(var A=n.length-1;A>=0;A--)(o=n[A])&&(i=(r<3?o(i):r>3?o(t,e,i):o(t,e))||i);return r>3&&i&&Object.defineProperty(t,e,i),i}function ge(n,t,e,s){function r(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function A(c){try{l(s.next(c))}catch(u){o(u)}}function a(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?i(c.value):r(c.value).then(A,a)}l((s=s.apply(n,t||[])).next())})}class AI{constructor(t,e,s,r){this._callback=t,this._type=e,this._minimumUpdateInterval=Math.max(128/(r||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new Worker(e);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){var e;this._updateInterval=Math.max(t,this._minimumUpdateInterval),this._type==="worker"&&((e=this._worker)===null||e===void 0||e.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Qi(n){return jx(n)}function Rr(n){return Yx(n)}function Hl(n){return Jx(n)}function so(n){return Xx(n)}function aI(n){return n instanceof Wv}function lI(n,t){return n==="value"||Qi(t)||Rr(t)||aI(t)}function Si(n,...t){if(!t.length)return n;const e=t.shift();if(yi(n)&&yi(e))for(const s in e)lI(s,e[s])?n[s]=e[s]:yi(e[s])?(n[s]||Object.assign(n,{[s]:{}}),Si(n[s],e[s])):Object.assign(n,{[s]:e[s]});return Si(n,...t)}function cI(n,t){return n.length===t.length&&n.every((e,s)=>t[s]===e)}function pt(n,t,e=[],s){const r={},i=Array.from(t);if(yi(i[0])&&s&&!Reflect.has(i[0],s)&&(Object.keys(i[0]).some(A=>Reflect.has(n,A))||(Si(r,{[s]:i[0]}),e.splice(e.indexOf(s),1),i.shift())),i.length===1&&yi(i[0]))Si(r,i[0]);else for(let o=0;o<e.length;o++)_t(i[o])&&(r[e[o]]=i[o]);return Si(n,r)}function uI(n){return n.constructor.getDefaults()}function bo(n,t){return $n(n)?t:n}function th(n,t){return t.forEach(e=>{Reflect.has(n,e)&&delete n[e]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class hr{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||xn&&this.toString()===xn.TONE_DEBUG_CLASS)&&nI(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}hr.version=uv;const Df=1e-6;function Ro(n,t){return n>t+Df}function eh(n,t){return Ro(n,t)||ss(n,t)}function mc(n,t){return n+Df<t}function ss(n,t){return Math.abs(n-t)<Df}function dI(n,t,e){return Math.max(Math.min(n,e),t)}class Xn extends hr{constructor(){super(),this.name="Timeline",this._timeline=[];const t=pt(Xn.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(vt(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];vt(eh(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(t){const e=this._timeline.indexOf(t);return e!==-1&&this._timeline.splice(e,1),this}get(t,e="time"){const s=this._search(t,e);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const s=this._search(t,e);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const s=this._search(t);return s-1>=0?this._timeline[s-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(ss(this._timeline[e].time,t)){for(let s=e;s>=0&&ss(this._timeline[s].time,t);s--)e=s;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else this._timeline.length===1&&eh(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(this._timeline.length===0)return-1;let s=0;const r=this._timeline.length;let i=r;if(r>0&&this._timeline[r-1][e]<=t)return r-1;for(;s<i;){let o=Math.floor(s+(i-s)/2);const A=this._timeline[o],a=this._timeline[o+1];if(ss(A[e],t)){for(let l=o;l<this._timeline.length;l++){const c=this._timeline[l];if(ss(c[e],t))o=l;else break}return o}else{if(mc(A[e],t)&&Ro(a[e],t))return o;Ro(A[e],t)?i=o:s=o+1}}return-1}_iterate(t,e=0,s=this._timeline.length-1){this._timeline.slice(e,s+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const s=this._search(t);return s!==-1&&this._iterate(e,0,s),this}forEachAfter(t,e){const s=this._search(t);return this._iterate(e,s+1),this}forEachBetween(t,e,s){let r=this._search(t),i=this._search(e);return r!==-1&&i!==-1?(this._timeline[r].time!==t&&(r+=1),this._timeline[i].time===e&&(i-=1),this._iterate(s,r,i)):r===-1&&this._iterate(s,0,i),this}forEachFrom(t,e){let s=this._search(t);for(;s>=0&&this._timeline[s].time>=t;)s--;return this._iterate(e,s+1),this}forEachAtTime(t,e){const s=this._search(t);if(s!==-1&&ss(this._timeline[s].time,t)){let r=s;for(let i=s;i>=0&&ss(this._timeline[i].time,t);i--)r=i;this._iterate(i=>{e(i)},r,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Aw=[];function iu(n){Aw.push(n)}function hI(n){Aw.forEach(t=>t(n))}const aw=[];function ou(n){aw.push(n)}function fI(n){aw.forEach(t=>t(n))}let Lf=class lw extends hr{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(r=>{$n(this._events)&&(this._events={}),this._events.hasOwnProperty(r)||(this._events[r]=[]),this._events[r].push(e)}),this}once(t,e){const s=(...r)=>{e(...r),this.off(t,s)};return this.on(t,s),this}off(t,e){return t.split(/\W+/).forEach(r=>{if($n(this._events)&&(this._events={}),this._events.hasOwnProperty(r))if($n(e))this._events[r]=[];else{const i=this._events[r];for(let o=i.length-1;o>=0;o--)i[o]===e&&i.splice(o,1)}}),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const s=this._events[t].slice(0);for(let r=0,i=s.length;r<i;r++)s[r].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach(e=>{const s=Object.getOwnPropertyDescriptor(lw.prototype,e);Object.defineProperty(t.prototype,e,s)})}dispose(){return super.dispose(),this._events=void 0,this}};class cw extends Lf{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}let Au=class uw extends cw{constructor(){var t,e;super(),this.name="Context",this._constants=new Map,this._timeouts=new Xn,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=pt(uw.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((t=arguments[0])===null||t===void 0?void 0:t.latencyHint)||""):(this._context=sI({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new AI(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((e=arguments[0])===null||e===void 0)&&e.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(hI(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,s){return this._context.createBuffer(t,e,s)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,s){return this._context.createPeriodicWave(t,e,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return vt(so(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return vt(so(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return vt(so(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){vt(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){vt(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){vt(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){vt(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return oI(this.rawContext,t,e)}addAudioWorkletModule(t){return ge(this,void 0,void 0,function*(){vt(_t(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(t)),yield this._workletPromise})}workletsAreReady(){return ge(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get lookAhead(){return this._lookAhead}set lookAhead(t){this._lookAhead=t,this.updateInterval=t?t/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return so(this._context)?this._context.resume():Promise.resolve()}close(){return ge(this,void 0,void 0,function*(){so(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&fI(this)})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),s=e.getChannelData(0);for(let i=0;i<s.length;i++)s[i]=t;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=e,r.loop=!0,r.start(0),this._constants.set(t,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this.close(),this}_timeoutLoop(){const t=this.now();this._timeouts.forEachBefore(t,e=>{e.callback(),this._timeouts.remove(e)})}setTimeout(t,e){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:s+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const s=++this._timeoutIds,r=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),r()},id:s,time:i+e})};return r(),s}};class pI extends cw{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,s){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t){return ge(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}}function Dt(n,t){_n(t)?t.forEach(e=>Dt(n,e)):Object.defineProperty(n,t,{enumerable:!0,writable:!1})}function kf(n,t){_n(t)?t.forEach(e=>kf(n,e)):Object.defineProperty(n,t,{writable:!0})}const Ht=()=>{};class ne extends hr{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ht;const t=pt(ne.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,Ar(t.url)?this.load(t.url).catch(t.onerror):t.url&&this.set(t.url)}static getDefaults(){return{onerror:Ht,onload:Ht,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ke().sampleRate}set(t){return t instanceof ne?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return ge(this,void 0,void 0,function*(){const e=ne.load(t).then(s=>{this.set(s),this.onload(this)});ne.downloads.push(e);try{yield e}finally{const s=ne.downloads.indexOf(e);ne.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=_n(t)&&t[0].length>0,s=e?t.length:1,r=e?t[0].length:t.length,i=Ke(),o=i.createBuffer(s,r,i.sampleRate),A=!e&&s===1?[t]:t;for(let a=0;a<s;a++)o.copyToChannel(A[a],a);return this._buffer=o,this}toMono(t){if(or(t))this.fromArray(this.toArray(t));else{let e=new Float32Array(this.length);const s=this.numberOfChannels;for(let r=0;r<s;r++){const i=this.toArray(r);for(let o=0;o<i.length;o++)e[o]+=i[o]}e=e.map(r=>r/s),this.fromArray(e)}return this}toArray(t){if(or(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{const e=[];for(let s=0;s<this.numberOfChannels;s++)e[s]=this.getChannelData(s);return e}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){vt(this.loaded,"Buffer is not loaded");const s=Math.floor(t*this.sampleRate),r=Math.floor(e*this.sampleRate);vt(s<r,"The start time must be less than the end time");const i=r-s,o=Ke().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let A=0;A<this.numberOfChannels;A++)o.copyToChannel(this.getChannelData(A).subarray(s,r),A);return new ne(o)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new ne().fromArray(t)}static fromUrl(t){return ge(this,void 0,void 0,function*(){return yield new ne().load(t)})}static load(t){return ge(this,void 0,void 0,function*(){const e=ne.baseUrl===""||ne.baseUrl.endsWith("/")?ne.baseUrl:ne.baseUrl+"/",s=yield fetch(e+t);if(!s.ok)throw new Error(`could not load url: ${t}`);const r=yield s.arrayBuffer();return yield Ke().decodeAudioData(r)})}static supportsType(t){const e=t.split("."),s=e[e.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return ge(this,void 0,void 0,function*(){for(yield Promise.resolve();ne.downloads.length;)yield ne.downloads[0]})}}ne.baseUrl="";ne.downloads=[];class Rf extends Au{constructor(){super({clockSource:"offline",context:Hl(arguments[0])?arguments[0]:rI(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Hl(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Hl(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return ge(this,void 0,void 0,function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const s=Math.floor(this.sampleRate/128);t&&e%s===0&&(yield new Promise(r=>setTimeout(r,1)))}})}render(){return ge(this,arguments,void 0,function*(t=!0){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new ne(e)})}close(){return Promise.resolve()}}const dw=new pI;let ci=dw;function Ke(){return ci===dw&&iI&&hw(new Au),ci}function hw(n,t=!1){t&&ci.dispose(),so(n)?ci=new Au(n):Hl(n)?ci=new Rf(n):ci=n}function gc(){return ci.resume()}if(xn&&!xn.TONE_SILENCE_LOGGING){const t=` * Tone.js v${uv} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function mI(n){return Math.pow(10,n/20)}function fw(n){return 20*(Math.log(n)/Math.LN10)}function pw(n){return Math.pow(2,n/12)}let au=440;function gI(){return au}function vI(n){au=n}function ui(n){return Math.round(mw(n))}function mw(n){return 69+12*Math.log2(n/au)}function gw(n){return au*Math.pow(2,(n-69)/12)}class Hf extends hr{constructor(t,e,s){super(),this.defaultUnits="s",this._val=e,this._units=s,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const s=parseInt(t,10),r=e==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/s)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(Math.floor(e)*3))},regexp:/^(\d+)t$/i},tr:{method:(t,e,s)=>{let r=0;return t&&t!=="0"&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(r+=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(r+=this._beatsToUnits(parseFloat(s)/4)),r},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Hf&&this.fromType(this._val),$n(this._val))return this._noArg();if(Ar(this._val)&&$n(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(yi(this._val)){let t=0;for(const e in this._val)if(_t(this._val[e])){const s=this._val[e],r=new this.constructor(this.context,e).valueOf()*s;t+=r}return t}if(_t(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}else return Ar(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Gn extends Hf{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Gn(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const s=new this.constructor(this.context,t).valueOf(),r=this.valueOf(),A=Math.round(r/s)*s-r;return r+A*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let i=1;i<9;i++){const o=Math.pow(2,i);e.push(o+"n."),e.push(o+"n"),e.push(o+"t")}e.push("0");let s=e[0],r=new Gn(this.context,e[0]).toSeconds();return e.forEach(i=>{const o=new Gn(this.context,i).toSeconds();Math.abs(o-t)<Math.abs(r-t)&&(s=i,r=o)}),s}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const s=Math.floor(e/this._getTimeSignature());let r=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=r.toString();return i.length>3&&(r=parseFloat(parseFloat(i).toFixed(3))),[s,e,r].join(":")}toTicks(){const t=this._beatsToUnits(1);return this.valueOf()/t*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return ui(this.toFrequency())}_now(){return this.context.now()}}function Ce(n,t){return new Gn(Ke(),n,t)}class In extends Gn{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return gI()}static set A4(t){vI(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return this.defaultUnits==="midi"?t:In.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(t,e){const r=wI[t.toLowerCase()]+(parseInt(e,10)+1)*12;return this.defaultUnits==="midi"?r:In.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,s){let r=1;return t&&t!=="0"&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(r*=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(r*=this._beatsToUnits(parseFloat(s)/4)),r}}})}transpose(t){return new In(this.context,this.valueOf()*pw(t))}harmonize(t){return t.map(e=>this.transpose(e))}toMidi(){return ui(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/In.A4);let s=Math.round(12*e)+57;const r=Math.floor(s/12);return r<0&&(s+=-12*r),BI[s%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(t*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return gw(t)}static ftom(t){return ui(t)}}const wI={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},BI=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class FA extends Gn{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class pn extends hr{constructor(){super();const t=pt(pn.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Ke()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return eI(t),new Gn(this.context,t).toSeconds()}toFrequency(t){return new In(this.context,t).toFrequency()}toTicks(t){return new FA(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach(s=>{$n(t[s])&&delete e[s]}),e}get(){const t=uI(this);return Object.keys(t).forEach(e=>{if(Reflect.has(this,e)){const s=this[e];_t(s)&&_t(s.value)&&_t(s.setValueAtTime)?t[e]=s.value:s instanceof pn?t[e]=s._getPartialProperties(t[e]):_n(s)||or(s)||Ar(s)||tI(s)?t[e]=s:delete t[e]}}),t}set(t){return Object.keys(t).forEach(e=>{Reflect.has(this,e)&&_t(this[e])&&(this[e]&&_t(this[e].value)&&_t(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof pn?this[e].set(t[e]):this[e]=t[e])}),this}}class Of extends Xn{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return e!==null?e.state:this._initial}setStateAtTime(t,e,s){return ar(e,0),this.add(Object.assign({},s,{state:t,time:e})),this}getLastState(t,e){const s=this._search(e);for(let r=s;r>=0;r--){const i=this._timeline[r];if(i.state===t)return i}}getNextState(t,e){const s=this._search(e);if(s!==-1)for(let r=s;r<this._timeline.length;r++){const i=this._timeline[r];if(i.state===t)return i}}}class Ft extends pn{constructor(){const t=pt(Ft.getDefaults(),arguments,["param","units","convert"]);for(super(t),this.name="Param",this.overridden=!1,this._minOutput=1e-7,vt(_t(t.param)&&(Qi(t.param)||t.param instanceof Ft),"param must be an AudioParam");!Qi(t.param);)t.param=t.param._param;this._swappable=_t(t.swappable)?t.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Xn(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,_t(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(pn.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return _t(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return _t(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return _t(this.maxValue)&&_t(this.minValue)&&ar(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?mI(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&this.units==="decibels"?fw(t):t}setValueAtTime(t,e){const s=this.toSeconds(e),r=this._fromType(t);return vt(isFinite(r)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(r),this.log(this.units,"setValueAtTime",t,s),this._events.add({time:s,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,s),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),s=this._events.getAfter(e),r=this._events.get(e);let i=this._initialValue;if(r===null)i=this._initialValue;else if(r.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(r.time);let A;o===null?A=this._initialValue:A=o.value,r.type==="setTargetAtTime"&&(i=this._exponentialApproach(r.time,A,r.value,r.constant,e))}else if(s===null)i=r.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=r.value;if(r.type==="setTargetAtTime"){const A=this._events.getBefore(r.time);A===null?o=this._initialValue:o=A.value}s.type==="linearRampToValueAtTime"?i=this._linearInterpolate(r.time,o,s.time,s.value,e):i=this._exponentialInterpolate(r.time,o,s.time,s.value,e)}else i=r.value;return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),this._fromType(e)===0&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const s=this._fromType(t),r=this.toSeconds(e);return vt(isFinite(s)&&isFinite(r),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this._events.add({time:r,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",t,r),this._param.linearRampToValueAtTime(s,r),this}exponentialRampToValueAtTime(t,e){let s=this._fromType(t);s=ss(s,0)?this._minOutput:s,this._assertRange(s);const r=this.toSeconds(e);return vt(isFinite(s)&&isFinite(r),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",t,r),this._param.exponentialRampToValueAtTime(s,r),this}exponentialRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(t,s+this.toSeconds(e)),this}linearRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(t,s+this.toSeconds(e)),this}targetRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(t,s,e),this}exponentialApproachValueAtTime(t,e,s){e=this.toSeconds(e),s=this.toSeconds(s);const r=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(t,e,r),this.cancelAndHoldAtTime(e+s*.9),this.linearRampToValueAtTime(t,e+s),this}setTargetAtTime(t,e,s){const r=this._fromType(t);vt(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(r),vt(isFinite(r)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:s,time:i,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",t,i,s),this._param.setTargetAtTime(r,i,s),this}setValueCurveAtTime(t,e,s,r=1){s=this.toSeconds(s),e=this.toSeconds(e);const i=this._fromType(t[0])*r;this.setValueAtTime(this._toType(i),e);const o=s/(t.length-1);for(let A=1;A<t.length;A++){const a=this._fromType(t[A])*r;this.linearRampToValueAtTime(this._toType(a),e+A*o)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return vt(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),s=this._fromType(this.getValueAtTime(e));vt(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+s);const r=this._events.get(e),i=this._events.getAfter(e);return r&&ss(r.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),e):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),e)),this._events.add({time:e,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,e),this}rampTo(t,e=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(t,e,s):this.linearRampTo(t,e,s),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const s=this._events.get(e);if(s&&s.type==="setTargetAtTime"){const r=this._events.getAfter(s.time),i=r?r.time:e+2,o=(i-e)/10;for(let A=e;A<i;A+=o)t.linearRampToValueAtTime(this.getValueAtTime(A),A)}return this._events.forEachAfter(this.context.currentTime,r=>{r.type==="cancelScheduledValues"?t.cancelScheduledValues(r.time):r.type==="setTargetAtTime"?t.setTargetAtTime(r.value,r.time,r.constant):t[r.type](r.value,r.time)}),this}setParam(t){vt(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,s,r,i){return s+(e-s)*Math.exp(-(i-t)/r)}_linearInterpolate(t,e,s,r,i){return e+(r-e)*((i-t)/(s-t))}_exponentialInterpolate(t,e,s,r,i){return e*Math.pow(r/e,(i-t)/(s-t))}}class ft extends pn{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return _t(this.input)?Qi(this.input)||this.input instanceof Ft?1:this.input.numberOfInputs:0}get numberOfOutputs(){return _t(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return _t(t)&&(t instanceof ft||Rr(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(s=>{s.channelCount=t.channelCount,s.channelCountMode=t.channelCountMode,s.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();vt(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,s=0){return lr(this,t,e,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Qa("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,s=0){return vw(this,t,e,s),this}chain(...t){return jA(this,...t),this}fan(...t){return t.forEach(e=>this.connect(e)),this}dispose(){return super.dispose(),_t(this.input)&&(this.input instanceof ft?this.input.dispose():Rr(this.input)&&this.input.disconnect()),_t(this.output)&&(this.output instanceof ft?this.output.dispose():Rr(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function jA(...n){const t=n.shift();n.reduce((e,s)=>(e instanceof ft?e.connect(s):Rr(e)&&lr(e,s),s),t)}function lr(n,t,e=0,s=0){for(vt(_t(n),"Cannot connect from undefined node"),vt(_t(t),"Cannot connect to undefined node"),(t instanceof ft||Rr(t))&&vt(t.numberOfInputs>0,"Cannot connect to node with no inputs"),vt(n.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof ft||t instanceof Ft;)_t(t.input)&&(t=t.input);for(;n instanceof ft;)_t(n.output)&&(n=n.output);Qi(t)?n.connect(t,e):n.connect(t,e,s)}function vw(n,t,e=0,s=0){if(_t(t))for(;t instanceof ft;)t=t.input;for(;!Rr(n);)_t(n.output)&&(n=n.output);Qi(t)?n.disconnect(t,e):Rr(t)?n.disconnect(t,e,s):n.disconnect()}class Mt extends ft{constructor(){const t=pt(Mt.getDefaults(),arguments,["gain","units"]);super(t),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Ft({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),Dt(this,"gain")}static getDefaults(){return Object.assign(ft.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Ho extends ft{constructor(t){super(t),this.onended=Ht,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Mt({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const s=this.toSeconds(e);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(ft.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ht})}_startGain(t,e=1){vt(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(e,t+s):this._gainNode.gain.exponentialApproachValueAtTime(e,t,s)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){vt(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.now()),e>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?e*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ht&&(this.onended(this),this.onended=Ht,!this.context.isOffline)){const t=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(t):setTimeout(t,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),vt(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Ht,this}}class Vf extends Ho{constructor(){const t=pt(Vf.getDefaults(),arguments,["offset"]);super(t),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),lr(this._source,this._gainNode),this.offset=new Ft({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Ho.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class $t extends ft{constructor(){const t=pt($t.getDefaults(),arguments,["value","units"]);super(t),this.name="Signal",this.override=!0,this.output=this._constantSource=new Vf({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ft.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,s=0){return lu(this,t,e,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,s){return this._param.exponentialRampTo(t,e,s),this}linearRampTo(t,e,s){return this._param.linearRampTo(t,e,s),this}targetRampTo(t,e,s){return this._param.targetRampTo(t,e,s),this}exponentialApproachValueAtTime(t,e,s){return this._param.exponentialApproachValueAtTime(t,e,s),this}setTargetAtTime(t,e,s){return this._param.setTargetAtTime(t,e,s),this}setValueCurveAtTime(t,e,s,r){return this._param.setValueCurveAtTime(t,e,s,r),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,s){return this._param.rampTo(t,e,s),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function lu(n,t,e,s){(t instanceof Ft||Qi(t)||t instanceof $t&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof $t&&(t.overridden=!0)),lr(n,t,e,s)}class Wf extends Ft{constructor(){const t=pt(Wf.getDefaults(),arguments,["value"]);super(t),this.name="TickParam",this._events=new Xn(1/0),this._multiplier=1,this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ft.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,s){e=this.toSeconds(e),this.setRampPoint(e);const r=this._fromType(t),i=this._events.get(e),o=Math.round(Math.max(1/s,1));for(let A=0;A<=o;A++){const a=s*A+e,l=this._exponentialApproach(i.time,i.value,r,s,a);this.linearRampToValueAtTime(this._toType(l),a)}return this}setValueAtTime(t,e){const s=this.toSeconds(e);super.setValueAtTime(t,e);const r=this._events.get(s),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,s);return r.ticks=Math.max(o,0),this}linearRampToValueAtTime(t,e){const s=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const r=this._events.get(s),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,s);return r.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const s=this._fromType(t),r=this._events.get(e),i=Math.round(Math.max((e-r.time)*10,1)),o=(e-r.time)/i;for(let A=0;A<=i;A++){const a=o*A+r.time,l=this._exponentialInterpolate(r.time,r.value,e,s,a);this.linearRampToValueAtTime(this._toType(l),a)}return this}_getTicksUntilEvent(t,e){if(t===null)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if($n(t.ticks)){const o=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(o,t.time)}const s=this._fromType(this.getValueAtTime(t.time));let r=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&i.type==="setValueAtTime"&&(r=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(s+r)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),s=this._events.get(e);return Math.max(this._getTicksUntilEvent(s,e),0)}getDurationOfTicks(t,e){const s=this.toSeconds(e),r=this.getTicksAtTime(e);return this.getTimeOfTick(r+t)-s}getTimeOfTick(t){const e=this._events.get(t,"ticks"),s=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&s&&s.type==="linearRampToValueAtTime"&&e.value!==s.value){const r=this._fromType(this.getValueAtTime(e.time)),o=(this._fromType(this.getValueAtTime(s.time))-r)/(s.time-e.time),A=Math.sqrt(Math.pow(r,2)-2*o*(e.ticks-t)),a=(-r+A)/o,l=(-r-A)/o;return(a>0?a:l)+e.time}else return e?e.value===0?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const s=this.toSeconds(e),r=this.toSeconds(t),i=this.getTicksAtTime(s);return this.getTicksAtTime(s+r)-i}_fromType(t){return this.units==="bpm"&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return this.units==="bpm"&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Gf extends $t{constructor(){const t=pt(Gf.getDefaults(),arguments,["value"]);super(t),this.name="TickSignal",this.input=this._param=new Wf({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign($t.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Kf extends pn{constructor(){const t=pt(Kf.getDefaults(),arguments,["frequency"]);super(t),this.name="TickSource",this._state=new Of,this._tickOffset=new Xn,this._ticksAtTime=new Xn,this._secondsAtTime=new Xn,this.frequency=new Gf({context:this.context,units:t.units,value:t.frequency}),Dt(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},pn.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const s=this.toSeconds(t);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),_t(e)&&this.setTicksAtTime(e,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(t){const e=this.toSeconds(t);if(this._state.getValueAtTime(e)==="stopped"){const s=this._state.get(e);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e)),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),s=this._state.getLastState("stopped",e),r=this._ticksAtTime.get(e),i={state:"paused",time:e};this._state.add(i);let o=r||s,A=r?r.ticks:0,a=null;return this._state.forEachBetween(o.time,e+this.sampleTime,l=>{let c=o.time;const u=this._tickOffset.get(l.time);u&&u.time>=o.time&&(A=u.ticks,c=u.time),o.state==="started"&&l.state!=="started"&&(A+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(c),l.time!==i.time&&(a={state:l.state,time:l.time,ticks:A})),o=l}),this._state.remove(i),a&&this._ticksAtTime.add(a),A}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),s=this.frequency.timeToTicks(t,e);this.setTicksAtTime(s,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);const r=this._secondsAtTime.get(t);let i=r||e,o=r?r.seconds:0,A=null;return this._state.forEachBetween(i.time,t+this.sampleTime,a=>{let l=i.time;const c=this._tickOffset.get(a.time);c&&c.time>=i.time&&(o=c.seconds,l=c.time),i.state==="started"&&a.state!=="started"&&(o+=a.time-l,a.time!==s.time&&(A={state:a.state,time:a.time,seconds:o})),i=a}),this._state.remove(s),A&&this._secondsAtTime.add(A),o}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const s=this._tickOffset.get(e),r=this._state.get(e),i=Math.max(s.time,r.time),o=this.frequency.getTicksAtTime(i)+t-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(t,e,s){let r=this._state.get(t);this._state.forEachBetween(t,e,o=>{r&&r.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(r.time,t),o.time-this.sampleTime,s),r=o});let i=null;if(r&&r.state==="started"){const o=Math.max(r.time,t),A=this.frequency.getTicksAtTime(o),a=this.frequency.getTicksAtTime(r.time),l=A-a;let c=Math.ceil(l)-l;c=ss(c,1)?0:c;let u=this.frequency.getTimeOfTick(A+c);for(;u<e;){try{s(u,Math.round(this.getTicksAtTime(u)))}catch(d){i=d;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class cu extends pn{constructor(){const t=pt(cu.getDefaults(),arguments,["callback","frequency"]);super(t),this.name="Clock",this.callback=Ht,this._lastUpdate=0,this._state=new Of("stopped"),this._boundLoop=this._loop.bind(this),this.callback=t.callback,this._tickSource=new Kf({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Dt(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(pn.getDefaults(),{callback:Ht,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){rw(this.context);const s=this.toSeconds(t);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,e),s<this._lastUpdate&&this.emit("start",s,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const s=this.toSeconds(e),r=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(r+t,s)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,s=>{switch(s.state){case"started":const r=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,r);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(t,e,(s,r)=>{this.callback(s,r)}))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Lf.mixin(cu);class qf extends ft{constructor(){const t=pt(qf.getDefaults(),arguments,["delayTime","maxDelay"]);super(t),this.name="Delay";const e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new Ft({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),Dt(this,"delayTime")}static getDefaults(){return Object.assign(ft.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class fr extends ft{constructor(){const t=pt(fr.getDefaults(),arguments,["volume"]);super(t),this.name="Volume",this.input=this.output=new Mt({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,Dt(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class zf extends ft{constructor(){const t=pt(zf.getDefaults(),arguments);super(t),this.name="Destination",this.input=new fr({context:this.context}),this.output=new Mt({context:this.context}),this.volume=this.input.volume,jA(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),jA(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}iu(n=>{n.destination=new zf({context:n})});ou(n=>{n.destination.dispose()});class CI extends ft{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ft({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ft({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ft({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ft({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ft({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ft({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ft({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ft({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ft({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ft.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}iu(n=>{n.listener=new CI({context:n})});ou(n=>{n.listener.dispose()});class uu extends hr{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=pt(uu.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(e=>{this._loadingCount++;const s=t.urls[e];this.add(e,s,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Ht,onload:Ht,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return vt(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,this._loadingCount===0&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,e])=>e.loaded)}add(t,e,s=Ht,r=Ht){return Ar(e)?(this.baseUrl&&e.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(t.toString(),new ne(this.baseUrl+e,s,r))):this._buffers.set(t.toString(),new ne(e,s,r)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class JA extends In{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return ui(super._frequencyToUnits(t))}_ticksToUnits(t){return ui(super._ticksToUnits(t))}_beatsToUnits(t){return ui(super._beatsToUnits(t))}_secondsToUnits(t){return ui(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return gw(this.toMidi())}transpose(t){return new JA(this.context,this.toMidi()+t)}}function bI(n,t){return new JA(Ke(),n,t)}class lo extends FA{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class yI extends pn{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Xn,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;this._events.forEachBefore(t+this.anticipation,e=>{t-e.time<=this.expiration&&e.callback(),this._events.remove(e)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}iu(n=>{n.draw=new yI({context:n})});ou(n=>{n.draw.dispose()});class SI extends hr{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){vt(_t(t.time),"Events must have a time property"),vt(_t(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new EI(t.time,t.time+t.duration,t);for(this._root===null?this._root=e:this._root.insert(e),this._length++;e!==null;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(this._root!==null){const e=[];this._root.search(t.time,e);for(const s of e)if(s.event===t){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,e=>this.remove(e)),this}_setRoot(t){this._root=t,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(t,e){t.parent!==null?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(t.left===null&&t.right===null)this._replaceNodeInParent(t,null);else if(t.right===null)this._replaceNodeInParent(t,t.left);else if(t.left===null)this._replaceNodeInParent(t,t.right);else{const e=t.getBalance();let s,r=null;if(e>0)if(t.left.right===null)s=t.left,s.right=t.right,r=s;else{for(s=t.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,r=s.parent,s.left=t.left,s.right=t.right)}else if(t.right.left===null)s=t.right,s.left=t.left,r=s;else{for(s=t.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,r=s.parent,s.left=t.left,s.right=t.right)}t.parent!==null?t.isLeftChild()?t.parent.left=s:t.parent.right=s:this._setRoot(s),r&&this._rebalance(r)}t.dispose()}_rotateLeft(t){const e=t.parent,s=t.isLeftChild(),r=t.right;r&&(t.right=r.left,r.left=t),e!==null?s?e.left=r:e.right=r:this._setRoot(r)}_rotateRight(t){const e=t.parent,s=t.isLeftChild(),r=t.left;r&&(t.left=r.right,r.right=t),e!==null?s?e.left=r:e.right=r:this._setRoot(r)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(this._root!==null){const e=[];if(this._root.search(t,e),e.length>0){let s=e[0];for(let r=1;r<e.length;r++)e[r].low>s.low&&(s=e[r]);return s.event}}return null}forEach(t){if(this._root!==null){const e=[];this._root.traverse(s=>e.push(s)),e.forEach(s=>{s.event&&t(s.event)})}return this}forEachAtTime(t,e){if(this._root!==null){const s=[];this._root.search(t,s),s.forEach(r=>{r.event&&e(r.event)})}return this}forEachFrom(t,e){if(this._root!==null){const s=[];this._root.searchAfter(t,s),s.forEach(r=>{r.event&&e(r.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class EI{constructor(t,e,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?this.left===null?this.left=t:this.left.insert(t):this.right===null?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(this.left!==null&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),!(this.low>t)&&this.right!==null&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),this.left!==null&&this.left.searchAfter(t,e)),this.right!==null&&this.right.searchAfter(t,e)}traverse(t){t(this),this.left!==null&&this.left.traverse(t),this.right!==null&&this.right.traverse(t)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return this.left!==null&&this.right!==null?t=this.left.height-this.right.height:this.left!==null?t=this.left.height+1:this.right!==null&&(t=-(this.right.height+1)),t}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class xI extends hr{constructor(t){super(),this.name="TimelineValue",this._timeline=new Xn({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class _s extends ft{constructor(){super(pt(_s.getDefaults(),arguments,["context"]))}connect(t,e=0,s=0){return lu(this,t,e,s),this}}class nA extends _s{constructor(){const t=pt(nA.getDefaults(),arguments,["mapping","length"]);super(t),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,_n(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):Zx(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign($t.getDefaults(),{length:1024})}setMap(t,e=1024){const s=new Float32Array(e);for(let r=0,i=e;r<i;r++){const o=r/(i-1)*2-1;s[r]=t(o,r)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){const e=["none","2x","4x"].some(s=>s.includes(t));vt(e,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class $f extends _s{constructor(){const t=pt($f.getDefaults(),arguments,["value"]);super(t),this.name="Pow",this._exponentScaler=this.input=this.output=new nA({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(_s.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class qr{constructor(t,e){this.id=qr._eventId++,this._remainderTime=0;const s=Object.assign(qr.getDefaults(),e);this.transport=t,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:Ht,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){const e=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*e),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}qr._eventId=0;class Xf extends qr{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(Xf.getDefaults(),e);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},qr.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvent(){return mc(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new lo(this.context,this._nextTick).toSeconds()):-1}_createEvents(t){mc(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new lo(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const e=this.transport.getTicksAtTime(t);Ro(e,this.time)&&(this._nextTick=this.floatTime+Math.ceil((e-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class du extends pn{constructor(){const t=pt(du.getDefaults(),arguments);super(t),this.name="Transport",this._loop=new xI(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Xn,this._repeatedEvents=new SI,this._syncedSignals=[],this._swingAmount=0,this._ppq=t.ppq,this._clock=new cu({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),Dt(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(pn.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!==0&&e%(this._swingTicks*2)!==0){const s=e%(this._swingTicks*2)/(this._swingTicks*2),r=Math.sin(s*Math.PI)*this._swingAmount;t+=new lo(this.context,this._swingTicks*2/3).toSeconds()*r}Bm(!0),this._timeline.forEachAtTime(e,s=>s.invoke(t)),Bm(!1)}schedule(t,e){const s=new qr(this,{callback:t,time:new FA(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(t,e,s,r=1/0){const i=new Xf(this,{callback:t,duration:new Gn(this.context,r).toTicks(),interval:new Gn(this.context,e).toTicks(),time:new FA(this.context,s).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const s=new qr(this,{callback:t,once:!0,time:new FA(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(e,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new lo(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){this.context.resume();let s;return _t(e)&&(s=this.toTicks(e)),this._clock.start(t,s),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!=="started"?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){_n(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Gn(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Gn(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new lo(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new lo(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),s=this._clock.frequency.timeToTicks(t,e);this.ticks=s}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(e),r=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,e),i=e+r;this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this.emit("ticks",e),this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return this._clock.getTicksAtTime(t)}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),this.state!=="started")return 0;{const e=this.now(),s=this.getTicksAtTime(e),r=t-s%t;return this._clock.nextTickTime(r,e)}}syncSignal(t,e){const s=this.now();let r=this.bpm,i=1/(60/r.getValueAtTime(s)/this.PPQ),o=[];if(t.units==="time"){const a=.015625/i,l=new Mt(a),c=new $f(-1),u=new Mt(a);r.chain(l,c,u),r=u,i=1/i,o=[l,c,u]}e||(t.getValueAtTime(s)!==0?e=t.getValueAtTime(s)/i:e=0);const A=new Mt(e);return r.connect(A),A.connect(t._param),o.push(A),this._syncedSignals.push({initial:t.value,nodes:o,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const s=this._syncedSignals[e];s.signal===t&&(s.nodes.forEach(r=>r.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),kf(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Lf.mixin(du);iu(n=>{n.transport=new du({context:n})});ou(n=>{n.transport.dispose()});class wn extends ft{constructor(t){super(t),this.input=void 0,this._state=new Of("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ht,this._syncedStop=Ht,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new fr({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,Dt(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,onstop:Ht,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,s){let r=$n(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(r=this._clampToCurrentTime(r),!this._synced&&this._state.getValueAtTime(r)==="started")vt(Ro(r,this._state.get(r).time),"Start time must be strictly greater than previous start time"),this._state.cancel(r),this._state.setStateAtTime("started",r),this.log("restart",r),this.restart(r,e,s);else if(this.log("start",r),this._state.setStateAtTime("started",r),this._synced){const i=this._state.get(r);i&&(i.offset=this.toSeconds(bo(e,0)),i.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(A=>{this._start(A,e,s)},r);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>r&&this._syncedStart(this.now(),this.context.transport.seconds)}else rw(this.context),this._start(r,e,s);return this}stop(t){let e=$n(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),this._state.getValueAtTime(e)==="started"||_t(this._state.getNextState("started",e))){if(this.log("stop",e),!this._synced)this._stop(e);else{const s=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(s)}this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,s){return t=this.toSeconds(t),this._state.getValueAtTime(t)==="started"&&(this._state.cancel(t),this._restart(t,e,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(Ro(e,0)){const s=this._state.get(e);if(s&&s.state==="started"&&s.time!==e){const r=e-this.toSeconds(s.time);let i;s.duration&&(i=this.toSeconds(s.duration)-r),this._start(t,this.toSeconds(s.offset)+r,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(e)==="started"&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ht,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class hu extends Ho{constructor(){const t=pt(hu.getDefaults(),arguments,["url","onload"]);super(t),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,lr(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ft({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new ne(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Ho.getDefaults(),{url:new ne,loop:!1,loopEnd:0,loopStart:0,onload:Ht,onerror:Ht,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,s,r=1){vt(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,r),this.loop?e=bo(e,this.loopStart):e=bo(e,0);let o=Math.max(this.toSeconds(e),0);if(this.loop){const A=this.toSeconds(this.loopEnd)||this.buffer.duration,a=this.toSeconds(this.loopStart),l=A-a;eh(o,A)&&(o=(o-a)%l+a),ss(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,mc(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),_t(s)){let A=this.toSeconds(s);A=Math.max(A,0),this.stop(i+A)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function Wi(n,t){return ge(this,void 0,void 0,function*(){const e=t/n.context.sampleRate,s=new Rf(1,e,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/e,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class Yf extends Ho{constructor(){const t=pt(Yf.getDefaults(),arguments,["frequency","type"]);super(t),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],lr(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Ft({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Ft({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),Dt(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ho.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ae extends wn{constructor(){const t=pt(ae.getDefaults(),arguments,["frequency","type"]);super(t),this.name="Oscillator",this._oscillator=null,this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),Dt(this,"frequency"),this.detune=new $t({context:this.context,units:"cents",value:t.detune}),Dt(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(wn.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),s=new Yf({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return ae._periodicWaveCache.find(e=>e.phase===this._phase&&cI(e.partials,this._partials));{const t=ae._periodicWaveCache.find(e=>e.type===this._type&&e.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&e)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{const s=this._getCachedPeriodicWave();if(_t(s)){const{partials:r,wave:i}=s;this._wave=i,this._partials=r,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[r,i]=this._getRealImaginary(t,this._phase),o=this.context.createPeriodicWave(r,i);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),ae._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:r,type:this._type,wave:this._wave}),ae._periodicWaveCache.length>100&&ae._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){ar(t,0);let e=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(e=s[1]),this._type!=="custom")t===0?this.type=e:this.type=e+t.toString();else{const r=new Float32Array(t);this._partials.forEach((i,o)=>r[o]=i),this._partials=Array.from(r),this.type=this._type}}_getRealImaginary(t,e){let r=2048;const i=new Float32Array(r),o=new Float32Array(r);let A=1;if(t==="custom"){if(A=this._partials.length+1,this._partialCount=this._partials.length,r=A,this._partials.length===0)return[i,o]}else{const a=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);a?(A=parseInt(a[2],10)+1,this._partialCount=parseInt(a[2],10),t=a[1],A=Math.max(A,2),r=A):this._partialCount=0,this._partials=[]}for(let a=1;a<r;++a){const l=2/(a*Math.PI);let c;switch(t){case"sine":c=a<=A?1:0,this._partials[a-1]=c;break;case"square":c=a&1?2*l:0,this._partials[a-1]=c;break;case"sawtooth":c=l*(a&1?1:-1),this._partials[a-1]=c;break;case"triangle":a&1?c=2*(l*l)*(a-1>>1&1?-1:1):c=0,this._partials[a-1]=c;break;case"custom":c=this._partials[a-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}c!==0?(i[a]=-c*Math.sin(e*a),o[a]=c*Math.cos(e*a)):(i[a]=0,o[a]=0)}return[i,o]}_inverseFFT(t,e,s){let r=0;const i=t.length;for(let o=0;o<i;o++)r+=t[o]*Math.cos(o*s)+e[o]*Math.sin(o*s);return r}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let s=0;const r=Math.PI*2,i=32;for(let o=0;o<i;o++)s=Math.max(this._inverseFFT(t,e,o/i*r),s);return dI(-this._inverseFFT(t,e,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){return ge(this,arguments,void 0,function*(t=1024){return Wi(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ae._periodicWaveCache=[];class ww extends _s{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new nA({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ui extends $t{constructor(){const t=pt(Ui.getDefaults(),arguments,["value"]);super(t),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Mt({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign($t.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class fu extends wn{constructor(){const t=pt(fu.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="AMOscillator",this._modulationScale=new ww({context:this.context}),this._modulationNode=new Mt({context:this.context}),this._carrier=new ae({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ae({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Ui({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Dt(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ae.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return ge(this,arguments,void 0,function*(t=1024){return Wi(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class pu extends wn{constructor(){const t=pt(pu.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="FMOscillator",this._modulationNode=new Mt({context:this.context,gain:0}),this._carrier=new ae({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new ae({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Ui({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Ui({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Dt(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ae.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return ge(this,arguments,void 0,function*(t=1024){return Wi(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Ua extends wn{constructor(){const t=pt(Ua.getDefaults(),arguments,["frequency","width"]);super(t),this.name="PulseOscillator",this._widthGate=new Mt({context:this.context,gain:0}),this._thresh=new nA({context:this.context,mapping:e=>e<=0?-1:1}),this.width=new $t({context:this.context,units:"audioRange",value:t.width}),this._triangle=new ae({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Dt(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(wn.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(){return ge(this,arguments,void 0,function*(t=1024){return Wi(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class mu extends wn{constructor(){const t=pt(mu.getDefaults(),arguments,["frequency","type","spread"]);super(t),this.name="FatOscillator",this._oscillators=[],this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $t({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,Dt(this,["frequency","detune"])}static getDefaults(){return Object.assign(ae.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(e=>e.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(e=>e.stop(t))}_restart(t){this._forEach(e=>e.restart(t))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,s=t/(this._oscillators.length-1);this._forEach((r,i)=>r.detune.value=e+s*i)}}get count(){return this._oscillators.length}set count(t){if(ar(t,1),this._oscillators.length!==t){this._forEach(e=>e.dispose()),this._oscillators=[];for(let e=0;e<t;e++){const s=new ae({context:this.context,volume:-6-t*1.1,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:e===0?()=>this.onstop(this):Ht});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[e]=s}this.spread=this._spread,this.state==="started"&&this._forEach(e=>e.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((e,s)=>e.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(){return ge(this,arguments,void 0,function*(t=1024){return Wi(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class gu extends wn{constructor(){const t=pt(gu.getDefaults(),arguments,["frequency","modulationFrequency"]);super(t),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Ui({context:this.context,value:2}),this._pulse=new Ua({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ae({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Dt(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(wn.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(){return ge(this,arguments,void 0,function*(t=1024){return Wi(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Cm={am:fu,fat:mu,fm:pu,oscillator:ae,pulse:Ua,pwm:gu};class vc extends wn{constructor(){const t=pt(vc.getDefaults(),arguments,["frequency","type"]);super(t),this.name="OmniOscillator",this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $t({context:this.context,units:"cents",value:t.detune}),Dt(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(ae.getDefaults(),pu.getDefaults(),fu.getDefaults(),mu.getDefaults(),Ua.getDefaults(),gu.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(e=>this._sourceType===e)&&(t=this._sourceType),t+this._oscillator.type}set type(t){t.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):t==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):t==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Cm[t],s=this.now();if(this._oscillator){const r=this._oscillator;r.stop(s),this.context.setTimeout(()=>r.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(e=this._oscillator.type),t==="fm"?this.type="fm"+e:t==="am"?this.type="am"+e:t==="fat"?this.type="fat"+e:t==="oscillator"?this.type=e:t==="pulse"?this.type="pulse":t==="pwm"&&(this.type="pwm")}_getOscType(t,e){return t instanceof Cm[e]}get baseType(){return this._oscillator.baseType}set baseType(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&t!=="pulse"&&t!=="pwm"&&(this._oscillator.baseType=t)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(t){this._getOscType(this._oscillator,"fat")&&or(t)&&(this._oscillator.count=t)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(t){this._getOscType(this._oscillator,"fat")&&or(t)&&(this._oscillator.spread=t)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Ar(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return ge(this,arguments,void 0,function*(t=1024){return Wi(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class jf extends $t{constructor(){super(pt(jf.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new Mt({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,jA(this._constantSource,this._sum)}static getDefaults(){return Object.assign($t.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class ZA extends _s{constructor(){const t=pt(ZA.getDefaults(),arguments,["min","max"]);super(t),this.name="Scale",this._mult=this.input=new Ui({context:this.context,value:t.max-t.min}),this._add=this.output=new jf({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(_s.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class Jf extends _s{constructor(){super(pt(Jf.getDefaults(),arguments)),this.name="Zero",this._gain=new Mt({context:this.context}),this.output=this._gain,this.input=void 0,lr(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),vw(this.context.getConstant(0),this._gain),this}}class wc extends ft{constructor(){const t=pt(wc.getDefaults(),arguments,["frequency","min","max"]);super(t),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Ft.prototype._fromType,this._toType=Ft.prototype._toType,this._is=Ft.prototype._is,this._clampValue=Ft.prototype._clampValue,this._oscillator=new ae(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Mt({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new $t({context:this.context,units:"audioRange",value:0}),this._zeros=new Jf({context:this.context}),this._a2g=new ww({context:this.context}),this._scaler=this.output=new ZA({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Dt(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(ae.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,s=this.max;this._units=t,this.min=e,this.max=s}get state(){return this._oscillator.state}connect(t,e,s){return(t instanceof Ft||t instanceof $t)&&(this.convert=t.convert,this.units=t.units),lu(this,t,e,s),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Bw(n,t=1/0){const e=new WeakMap;return function(s,r){Reflect.defineProperty(s,r,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(i){ar(i,n,t),e.set(this,i)}})}}function pr(n,t=1/0){const e=new WeakMap;return function(s,r){Reflect.defineProperty(s,r,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(i){ar(this.toSeconds(i),n,t),e.set(this,i)}})}}class Pa extends wn{constructor(){const t=pt(Pa.getDefaults(),arguments,["url","onload"]);super(t),this.name="Player",this._activeSources=new Set,this._buffer=new ne({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(wn.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ht,onerror:Ht,playbackRate:1,reverse:!1})}load(t){return ge(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=Ht){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,s){return super.start(t,e,s),this}_start(t,e,s){this._loop?e=bo(e,this._loopStart):e=bo(e,0);const r=this.toSeconds(e),i=s;s=bo(s,Math.max(this._buffer.duration-r,0));let o=this.toSeconds(s);o=o/this._playbackRate,t=this.toSeconds(t);const A=new hu({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(t+o),this._state.setStateAtTime("stopped",t+o,{implicitEnd:!0})),this._activeSources.add(A),this._loop&&$n(i)?A.start(t,r):A.start(t,r,o-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach(s=>s.stop(e))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){var r;(r=[...this._activeSources].pop())===null||r===void 0||r.stop(t),this._start(t,e,s)}seek(t,e){const s=this.toSeconds(e);if(this._state.getValueAtTime(s)==="started"){const r=this.toSeconds(t);this._stop(s),this._start(s,r)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&ar(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&ar(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(e=>{e.loop=t}),t)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),s=this._state.getNextState("stopped",e);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(r=>r.cancelStop())),this._activeSources.forEach(r=>{r.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}ds([pr(0)],Pa.prototype,"fadeIn",void 0);ds([pr(0)],Pa.prototype,"fadeOut",void 0);class vu extends ft{constructor(){const t=pt(vu.getDefaults(),arguments,["urls","onload"],"urls");super(t),this.name="Players",this.input=void 0,this._players=new Map,this._volume=this.output=new fr({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Dt(this,"volume"),this._buffers=new uu({urls:t.urls,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.mute=t.mute,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(wn.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Ht,onerror:Ht,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._players.forEach(e=>{e.fadeIn=t})}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._players.forEach(e=>{e.fadeOut=t})}get state(){return Array.from(this._players).some(([e,s])=>s.state==="started")?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){if(vt(this.has(t),`No Player with the name ${t} exists on this object`),!this._players.has(t)){const e=new Pa({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output);this._players.set(t,e)}return this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,e,s){return vt(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,e,s),this}stopAll(t){return this._players.forEach(e=>e.stop(t)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(t=>t.dispose()),this._buffers.dispose(),this}}class II extends _s{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new nA({context:this.context,mapping:t=>Math.abs(t)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Jr extends ft{constructor(){const t=pt(Jr.getDefaults(),arguments,["attack","decay","sustain","release"]);super(t),this.name="Envelope",this._sig=new $t({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(ft.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Ar(t))return t;{let s;for(s in $a)if($a[s][e]===t)return s;return t}}_setCurve(t,e,s){if(Ar(s)&&Reflect.has($a,s)){const r=$a[s];yi(r)?t!=="_decayCurve"&&(this[t]=r[e]):this[t]=r}else if(_n(s)&&t!=="_decayCurve")this[t]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(t){this._setCurve("_decayCurve","Out",t)}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let r=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(t);if(o>0){const A=1/r;r=(1-o)/A}if(r<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if(this._attackCurve==="linear")this._sig.linearRampTo(e,r,t);else if(this._attackCurve==="exponential")this._sig.targetRampTo(e,r,t);else{this._sig.cancelAndHoldAtTime(t);let A=this._attackCurve;for(let a=1;a<A.length;a++)if(A[a-1]<=o&&o<=A[a]){A=this._attackCurve.slice(a),A[0]=o;break}this._sig.setValueCurveAtTime(A,t,r,e)}if(i&&this.sustain<1){const A=e*this.sustain,a=t+r;this.log("decay",a),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(A,i+a):this._sig.exponentialApproachValueAtTime(A,a,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,t):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,t):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,t):(vt(_n(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,s,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),this.triggerAttack(e,s),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,s=0){return lu(this,t,e,s),this}asArray(){return ge(this,arguments,void 0,function*(t=1024){const e=t/this.context.sampleRate,s=new Rf(1,e,this.context.sampleRate),r=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=r+this.toSeconds(this.release),o=i*.1,A=i+o,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/A,decay:e*this.toSeconds(this.decay)/A,release:e*this.toSeconds(this.release)/A,context:s}));return a._sig.toDestination(),a.triggerAttackRelease(e*(r+o)/A,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}ds([pr(0)],Jr.prototype,"attack",void 0);ds([pr(0)],Jr.prototype,"decay",void 0);ds([Bw(0,1)],Jr.prototype,"sustain",void 0);ds([pr(0)],Jr.prototype,"release",void 0);const $a=(()=>{let t,e;const s=[];for(t=0;t<128;t++)s[t]=Math.sin(t/127*(Math.PI/2));const r=[],i=6.4;for(t=0;t<127;t++){e=t/127;const d=Math.sin(e*(Math.PI*2)*i-Math.PI/2)+1;r[t]=d/10+e*.83}r[127]=1;const o=[],A=5;for(t=0;t<128;t++)o[t]=Math.ceil(t/127*A)/A;const a=[];for(t=0;t<128;t++)e=t/127,a[t]=.5*(1-Math.cos(Math.PI*e));const l=[];for(t=0;t<128;t++){e=t/127;const d=Math.pow(e,3)*4+.2,p=Math.cos(d*Math.PI*2*e);l[t]=Math.abs(p*(1-e))}function c(d){const p=new Array(d.length);for(let h=0;h<d.length;h++)p[h]=1-d[h];return p}function u(d){return d.slice(0).reverse()}return{bounce:{In:c(l),Out:l},cosine:{In:s,Out:u(s)},exponential:"exponential",linear:"linear",ripple:{In:r,Out:c(r)},sine:{In:a,Out:c(a)},step:{In:o,Out:c(o)}}})();class zr extends ft{constructor(){const t=pt(zr.getDefaults(),arguments);super(t),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=e=>this._original_triggerRelease(e),this._volume=this.output=new fr({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Dt(this,"volume")}static getDefaults(){return Object.assign(ft.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const s=this["_original_"+t]=this[t];this[t]=(...r)=>{const i=r[e],o=this.context.transport.schedule(A=>{r[e]=A,s.apply(this,r)},i);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(t,e,s,r){const i=this.toSeconds(s),o=this.toSeconds(e);return this.triggerAttack(t,i,r),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Pi extends zr{constructor(){const t=pt(Pi.getDefaults(),arguments);super(t),this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(zr.getDefaults(),{detune:0,onsilence:Ht,portamento:0})}triggerAttack(t,e,s=1){this.log("triggerAttack",t,e,s);const r=this.toSeconds(e);return this._triggerEnvelopeAttack(r,s),this.setNote(t,r),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const s=this.toSeconds(e),r=t instanceof In?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,i,s)}else this.frequency.setValueAtTime(r,s);return this}}ds([pr(0)],Pi.prototype,"portamento",void 0);class Zf extends Jr{constructor(){super(pt(Zf.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Mt({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Oo extends Pi{constructor(){const t=pt(Oo.getDefaults(),arguments);super(t),this.name="Synth",this.oscillator=new vc(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Zf(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),Dt(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Pi.getDefaults(),{envelope:Object.assign(th(Jr.getDefaults(),Object.keys(ft.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(th(vc.getDefaults(),[...Object.keys(wn.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+s+r)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Bc extends ft{constructor(){const t=pt(Bc.getDefaults(),arguments,["frequency","type"]);super(t),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Ft({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new Ft({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new Ft({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new Ft({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(ft.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){vt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let o=0;o<t;o++){const a=Math.pow(o/t,2)*19980+20;e[o]=a}const s=new Float32Array(t),r=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,s,r),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class TA extends ft{constructor(){const t=pt(TA.getDefaults(),arguments,["frequency","type","rolloff"]);super(t),this.name="Filter",this.input=new Mt({context:this.context}),this.output=new Mt({context:this.context}),this._filters=[],this._filters=[],this.Q=new $t({context:this.context,units:"positive",value:t.Q}),this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $t({context:this.context,units:"cents",value:t.detune}),this.gain=new $t({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,Dt(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(ft.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){vt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,`Invalid filter type: ${t}`),this._type=t,this._filters.forEach(s=>s.type=t)}get rolloff(){return this._rolloff}set rolloff(t){const e=or(t)?t:parseInt(t,10),s=[-12,-24,-48,-96];let r=s.indexOf(e);vt(r!==-1,`rolloff can only be ${s.join(", ")}`),r+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach(i=>i.disconnect()),this._filters=new Array(r);for(let i=0;i<r;i++){const o=new Bc({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[i]=o}this._internalChannels=this._filters,jA(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new Bc({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(t).map(()=>1);return this._filters.forEach(()=>{e.getFrequencyResponse(t).forEach((i,o)=>s[o]*=i)}),e.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(t=>{t.dispose()}),kf(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class wu extends Oo{constructor(){const t=pt(wu.getDefaults(),arguments);super(t),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,Dt(this,["oscillator","envelope"])}static getDefaults(){return Si(Pi.getDefaults(),Oo.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const s=this.toSeconds(e),r=this.toFrequency(t instanceof In?t.toFrequency():t),i=r*this.octaves;return this.oscillator.frequency.setValueAtTime(i,s),this.oscillator.frequency.exponentialRampToValueAtTime(r,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}ds([Bw(0)],wu.prototype,"octaves",void 0);ds([pr(0)],wu.prototype,"pitchDecay",void 0);const Cw=new Set;function tp(n){Cw.add(n)}function bw(n,t){const e=`registerProcessor("${n}", ${t})`;Cw.add(e)}const FI=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;tp(FI);const TI=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;tp(TI);const _I=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;tp(_I);const MI="feedback-comb-filter",QI=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;bw(MI,QI);class ep extends zr{constructor(){const t=pt(ep.getDefaults(),arguments,["voice","options"]);super(t),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=r=>this.releaseAll(r),vt(!or(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const s=this._voices.indexOf(this._dummyVoice);this._voices.splice(s,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(zr.getDefaults(),{maxPolyphony:32,options:{},voice:Oo})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex(s=>s.voice===t);this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return vt(t instanceof Pi,"Voice must extend Monophonic class"),t.connect(this.output),this._voices.push(t),t}else Qa("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,s){t.forEach(r=>{const i=new JA(this.context,r).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(r,e,s),this._activeVoices.push({midi:i,voice:o,released:!1}),this.log("triggerAttack",r,e))})}_triggerRelease(t,e){t.forEach(s=>{const r=new JA(this.context,s).toMidi(),i=this._activeVoices.find(({midi:o,released:A})=>o===r&&!A);i&&(i.voice.triggerRelease(e),i.released=!0,this.log("triggerRelease",s,e))})}_scheduleEvent(t,e,s,r){vt(!this.disposed,"Synth was already disposed"),s<=this.now()?t==="attack"?this._triggerAttack(e,s,r):this._triggerRelease(e,s):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(t,e,s,r)},s-this.now())}triggerAttack(t,e,s){Array.isArray(t)||(t=[t]);const r=this.toSeconds(e);return this._scheduleEvent("attack",t,r,s),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("release",t,s),this}triggerAttackRelease(t,e,s,r){const i=this.toSeconds(s);if(this.triggerAttack(t,i,r),_n(e)){vt(_n(t),"If the duration is an array, the notes must also be an array"),t=t;for(let o=0;o<t.length;o++){const A=e[Math.min(o,e.length-1)],a=this.toSeconds(A);vt(a>0,"The duration must be greater than 0"),this.triggerRelease(t[o],i+a)}}else{const o=this.toSeconds(e);vt(o>0,"The duration must be greater than 0"),this.triggerRelease(t,i+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(t){const e=th(t,["onsilence","context"]);return this.options=Si(this.options,e),this._voices.forEach(s=>s.set(e)),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach(({voice:s})=>{s.triggerRelease(e)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(t=>t.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Bu extends zr{constructor(){const t=pt(Bu.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(t),this.name="Sampler",this._activeSources=new Map;const e={};Object.keys(t.urls).forEach(s=>{const r=parseInt(s,10);if(vt(za(s)||or(r)&&isFinite(r),`url key is neither a note or midi pitch: ${s}`),za(s)){const i=new In(this.context,s).toMidi();e[i]=t.urls[s]}else or(r)&&isFinite(r)&&(e[r]=t.urls[r])}),this._buffers=new uu({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(zr.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ht,onerror:Ht,release:.1,urls:{}})}_findClosest(t){let s=0;for(;s<96;){if(this._buffers.has(t+s))return-s;if(this._buffers.has(t-s))return s;s++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,s=1){return this.log("triggerAttack",t,e,s),Array.isArray(t)||(t=[t]),t.forEach(r=>{const i=mw(new In(this.context,r).toFrequency()),o=Math.round(i),A=i-o,a=this._findClosest(o),l=o-a,c=this._buffers.get(l),u=pw(a+A),d=new hu({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:u}).connect(this.output);d.start(e,0,c.duration/u,s),_n(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const p=this._activeSources.get(o),h=p.indexOf(d);h!==-1&&p.splice(h,1)}}}),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach(s=>{const r=new In(this.context,s).toMidi();if(this._activeSources.has(r)&&this._activeSources.get(r).length){const i=this._activeSources.get(r);e=this.toSeconds(e),i.forEach(o=>{o.stop(e)}),this._activeSources.set(r,[])}}),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(e)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,s,r=1){const i=this.toSeconds(s);return this.triggerAttack(t,i,r),_n(e)?(vt(_n(t),"notes must be an array when duration is array"),t.forEach((o,A)=>{const a=e[Math.min(A,e.length-1)];this.triggerRelease(o,i+this.toSeconds(a))})):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,s){if(vt(za(t)||isFinite(t),`note must be a pitch or midi: ${t}`),za(t)){const r=new In(this.context,t).toMidi();this._buffers.add(r,e,s)}else this._buffers.add(t,e,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(e=>e.dispose())}),this._activeSources.clear(),this}}ds([pr(0)],Bu.prototype,"attack",void 0);ds([pr(0)],Bu.prototype,"release",void 0);class yo extends ft{constructor(){const t=pt(yo.getDefaults(),arguments,["fade"]);super(t),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new II({context:this.context}),this.a=new Mt({context:this.context,gain:0}),this.b=new Mt({context:this.context,gain:0}),this.output=new Mt({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new $t({context:this.context,units:"normalRange",value:t.fade}),Dt(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",lr(this._split,this.a.gain,0),lr(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(ft.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class bm extends ft{constructor(t){super(t),this.name="Effect",this._dryWet=new yo({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Mt({context:this.context}),this.effectReturn=new Mt({context:this.context}),this.input=new Mt({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Dt(this,"wet")}static getDefaults(){return Object.assign(ft.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class np extends ft{constructor(){const t=pt(np.getDefaults(),arguments,["pan"]);super(t),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Ft({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",Dt(this,"pan")}static getDefaults(){return Object.assign(ft.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const UI="bit-crusher",PI=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;bw(UI,PI);class sp extends ft{constructor(){const t=pt(sp.getDefaults(),arguments,["channels"]);super(t),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(ft.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class ym extends bm{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new Mt({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Dt(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(bm.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class rp extends ym{constructor(){const t=pt(rp.getDefaults(),arguments,["delayTime","feedback"]);super(t),this.name="FeedbackDelay",this._delayNode=new qf({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Dt(this,"delayTime")}static getDefaults(){return Object.assign(ym.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class Na extends ft{constructor(){const t=pt(Na.getDefaults(),arguments,["type","size"]);super(t),this.name="Analyser",this._analysers=[],this._buffers=[],this.input=this.output=this._gain=new Mt({context:this.context}),this._split=new sp({context:this.context,channels:t.channels}),this.input.connect(this._split),ar(t.channels,1);for(let e=0;e<t.channels;e++)this._analysers[e]=this.context.createAnalyser(),this._split.connect(this._analysers[e],e,0);this.size=t.size,this.type=t.type,this.smoothing=t.smoothing}static getDefaults(){return Object.assign(ft.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,e)=>{const s=this._buffers[e];this._type==="fft"?t.getFloatFrequencyData(s):this._type==="waveform"&&t.getFloatTimeDomainData(s)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach((e,s)=>{e.fftSize=t*2,this._buffers[s]=new Float32Array(t)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){vt(t==="waveform"||t==="fft",`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach(e=>e.smoothingTimeConstant=t)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class Cc extends ft{constructor(){super(pt(Cc.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Na({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class ip extends Cc{constructor(){const t=pt(ip.getDefaults(),arguments,["smoothing"]);super(t),this.name="Meter",this.input=this.output=this._analyser=new Na({context:this.context,size:256,type:"waveform",channels:t.channelCount}),this.smoothing=t.smoothing,this.normalRange=t.normalRange,this._rms=new Array(t.channelCount),this._rms.fill(0)}static getDefaults(){return Object.assign(Cc.getDefaults(),{smoothing:.8,normalRange:!1,channelCount:1})}getLevel(){return Qa("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),s=(this.channels===1?[t]:t).map((r,i)=>{const o=r.reduce((a,l)=>a+l*l,0),A=Math.sqrt(o/r.length);return this._rms[i]=Math.max(A,this._rms[i]*this.smoothing),this.normalRange?this._rms[i]:fw(this._rms[i])});return this.channels===1?s[0]:s}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class he extends ft{constructor(){const t=pt(he.getDefaults(),arguments,["solo"]);super(t),this.name="Solo",this.input=this.output=new Mt({context:this.context}),he._allSolos.has(this.context)||he._allSolos.set(this.context,new Set),he._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(ft.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),he._allSolos.get(this.context).forEach(e=>e._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){he._soloed.has(this.context)||he._soloed.set(this.context,new Set),he._soloed.get(this.context).add(this)}_removeSolo(){he._soloed.has(this.context)&&he._soloed.get(this.context).delete(this)}_isSoloed(){return he._soloed.has(this.context)&&he._soloed.get(this.context).has(this)}_noSolos(){return!he._soloed.has(this.context)||he._soloed.has(this.context)&&he._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),he._allSolos.get(this.context).delete(this),this._removeSolo(),this}}he._allSolos=new Map;he._soloed=new Map;class op extends ft{constructor(){const t=pt(op.getDefaults(),arguments,["pan","volume"]);super(t),this.name="PanVol",this._panner=this.input=new np({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new fr({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,Dt(this,["pan","volume"])}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class co extends ft{constructor(){const t=pt(co.getDefaults(),arguments,["volume","pan"]);super(t),this.name="Channel",this._solo=this.input=new he({solo:t.solo,context:this.context}),this._panVol=this.output=new op({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Dt(this,["pan","volume"])}static getDefaults(){return Object.assign(ft.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return co.buses.has(t)||co.buses.set(t,new Mt({context:this.context})),co.buses.get(t)}send(t,e=0){const s=this._getBus(t),r=new Mt({context:this.context,units:"decibels",gain:e});return this.connect(r),r.connect(s),r}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}co.buses=new Map;class Cu extends ft{constructor(){const t=pt(Cu.getDefaults(),arguments,["threshold","ratio"]);super(t),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new Ft({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new Ft({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new Ft({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new Ft({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new Ft({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),Dt(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(ft.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class Ap extends ft{constructor(){const t=pt(Ap.getDefaults(),arguments,["threshold"]);super(t),this.name="Limiter",this._compressor=this.input=this.output=new Cu({context:this.context,ratio:20,attack:.003,release:.01,threshold:t.threshold}),this.threshold=this._compressor.threshold,Dt(this,"threshold")}static getDefaults(){return Object.assign(ft.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}function Pe(){return Ke().now()}const ht=Ke().transport;Ke().destination;Ke().destination;Ke().listener;const _A=Ke().draw,ta=Ke(),Wn=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fcfcfc",isAccidental:!1,midi:108,pitchClass:0,octave:8},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fcf7fc",isAccidental:!1,midi:107,pitchClass:11,octave:7},{pitch:"B/A7",flatName:"B7",sharpName:"A7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f7f5fd",isAccidental:!0,midi:106,pitchClass:10,octave:7},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f0f4ff",isAccidental:!1,midi:105,pitchClass:9,octave:7},{pitch:"A/G7",flatName:"A7",sharpName:"G7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#e6f3fd",isAccidental:!0,midi:104,pitchClass:8,octave:7},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#def3f7",isAccidental:!1,midi:103,pitchClass:7,octave:7},{pitch:"G/F7",flatName:"G7",sharpName:"F7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#daf2ec",isAccidental:!0,midi:102,pitchClass:6,octave:7},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#dcefdf",isAccidental:!1,midi:101,pitchClass:5,octave:7},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#e3ebd1",isAccidental:!1,midi:100,pitchClass:4,octave:7},{pitch:"E/D7",flatName:"E7",sharpName:"D7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#eee4c8",isAccidental:!0,midi:99,pitchClass:3,octave:7},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#f8dcc6",isAccidental:!1,midi:98,pitchClass:2,octave:7},{pitch:"D/C7",flatName:"D7",sharpName:"C7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fcd4cd",isAccidental:!0,midi:97,pitchClass:1,octave:7},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#facfdb",isAccidental:!1,midi:96,pitchClass:0,octave:7},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#efcdeb",isAccidental:!1,midi:95,pitchClass:11,octave:6},{pitch:"B/A6",flatName:"B6",sharpName:"A6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#ddcff9",isAccidental:!0,midi:94,pitchClass:10,octave:6},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#c4d3ff",isAccidental:!1,midi:93,pitchClass:9,octave:6},{pitch:"A/G6",flatName:"A6",sharpName:"G6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#abd9fa",isAccidental:!0,midi:92,pitchClass:8,octave:6},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#98dde9",isAccidental:!1,midi:91,pitchClass:7,octave:6},{pitch:"G/F6",flatName:"G6",sharpName:"F6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#96ddcf",isAccidental:!0,midi:90,pitchClass:6,octave:6},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#a6d9b0",isAccidental:!1,midi:89,pitchClass:5,octave:6},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#c0d093",isAccidental:!1,midi:88,pitchClass:4,octave:6},{pitch:"E/D6",flatName:"E6",sharpName:"D6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#dbc383",isAccidental:!0,midi:87,pitchClass:3,octave:6},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#efb586",isAccidental:!1,midi:86,pitchClass:2,octave:6},{pitch:"D/C6",flatName:"D6",sharpName:"C6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#f8a99c",isAccidental:!0,midi:85,pitchClass:1,octave:6},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#f3a2bb",isAccidental:!1,midi:84,pitchClass:0,octave:6},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e1a3db",isAccidental:!1,midi:83,pitchClass:11,octave:5},{pitch:"B/A5",flatName:"B5",sharpName:"A5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#c3a9f4",isAccidental:!0,midi:82,pitchClass:10,octave:5},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#9ab2ff",isAccidental:!1,midi:81,pitchClass:9,octave:5},{pitch:"A/G5",flatName:"A5",sharpName:"G5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#67bdf7",isAccidental:!0,midi:80,pitchClass:8,octave:5},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#30c6dc",isAccidental:!1,midi:79,pitchClass:7,octave:5},{pitch:"G/F5",flatName:"G5",sharpName:"F5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#32c8b2",isAccidental:!0,midi:78,pitchClass:6,octave:5},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#6dc281",isAccidental:!1,midi:77,pitchClass:5,octave:5},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#a0b556",isAccidental:!1,midi:76,pitchClass:4,octave:5},{pitch:"E/D5",flatName:"E5",sharpName:"D5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#c5a33f",isAccidental:!0,midi:75,pitchClass:3,octave:5},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#dc9150",isAccidental:!1,midi:74,pitchClass:2,octave:5},{pitch:"D/C5",flatName:"D5",sharpName:"C5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#e38475",isAccidental:!0,midi:73,pitchClass:1,octave:5},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#dc7f9d",isAccidental:!1,midi:72,pitchClass:0,octave:5},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#c781c0",isAccidental:!1,midi:71,pitchClass:11,octave:4},{pitch:"B/A4",flatName:"B4",sharpName:"A4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#a68ad8",isAccidental:!0,midi:70,pitchClass:10,octave:4},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#7d94e0",isAccidental:!1,midi:69,pitchClass:9,octave:4},{pitch:"A/G4",flatName:"A4",sharpName:"G4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#4c9fd5",isAccidental:!0,midi:68,pitchClass:8,octave:4},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#0fa6ba",isAccidental:!1,midi:67,pitchClass:7,octave:4},{pitch:"G/F4",flatName:"G4",sharpName:"F4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#24a794",isAccidental:!0,midi:66,pitchClass:6,octave:4},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#5aa26a",isAccidental:!1,midi:65,pitchClass:5,octave:4},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#849646",isAccidental:!1,midi:64,pitchClass:4,octave:4},{pitch:"E/D4",flatName:"E4",sharpName:"D4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#a38733",isAccidental:!0,midi:63,pitchClass:3,octave:4},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#b67740",isAccidental:!1,midi:62,pitchClass:2,octave:4},{pitch:"D/C4",flatName:"D4",sharpName:"C4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#bc6c5f",isAccidental:!0,midi:61,pitchClass:1,octave:4},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#b56880",isAccidental:!1,midi:60,pitchClass:0,octave:4},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#a3699e",isAccidental:!1,midi:59,pitchClass:11,octave:3},{pitch:"B/A3",flatName:"B3",sharpName:"A3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#8870b1",isAccidental:!0,midi:58,pitchClass:10,octave:3},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#6578b7",isAccidental:!1,midi:57,pitchClass:9,octave:3},{pitch:"A/G3",flatName:"A3",sharpName:"G3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#3c81ad",isAccidental:!0,midi:56,pitchClass:8,octave:3},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#0e8696",isAccidental:!1,midi:55,pitchClass:7,octave:3},{pitch:"G/F3",flatName:"G3",sharpName:"F3",toneNote:"Gb3",frequency:185,column:"A",hex:"#1b8777",isAccidental:!0,midi:54,pitchClass:6,octave:3},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#478255",isAccidental:!1,midi:53,pitchClass:5,octave:3},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#697836",isAccidental:!1,midi:52,pitchClass:4,octave:3},{pitch:"E/D3",flatName:"E3",sharpName:"D3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#836b27",isAccidental:!0,midi:51,pitchClass:3,octave:3},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#925e32",isAccidental:!1,midi:50,pitchClass:2,octave:3},{pitch:"D/C3",flatName:"D3",sharpName:"C3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#96554b",isAccidental:!0,midi:49,pitchClass:1,octave:3},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#905165",isAccidental:!1,midi:48,pitchClass:0,octave:3},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#80527c",isAccidental:!1,midi:47,pitchClass:11,octave:2},{pitch:"B/A2",flatName:"B2",sharpName:"A2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#6a578c",isAccidental:!0,midi:46,pitchClass:10,octave:2},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#4e5e90",isAccidental:!1,midi:45,pitchClass:9,octave:2},{pitch:"A/G2",flatName:"A2",sharpName:"G2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#2d6488",isAccidental:!0,midi:44,pitchClass:8,octave:2},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#096875",isAccidental:!1,midi:43,pitchClass:7,octave:2},{pitch:"G/F2",flatName:"G2",sharpName:"F2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#13685b",isAccidental:!0,midi:42,pitchClass:6,octave:2},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#356440",isAccidental:!1,midi:41,pitchClass:5,octave:2},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#505c28",isAccidental:!1,midi:40,pitchClass:4,octave:2},{pitch:"E/D2",flatName:"E2",sharpName:"D2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#63511c",isAccidental:!0,midi:39,pitchClass:3,octave:2},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#6e4724",isAccidental:!1,midi:38,pitchClass:2,octave:2},{pitch:"D/C2",flatName:"D2",sharpName:"C2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#713f37",isAccidental:!0,midi:37,pitchClass:1,octave:2},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#6c3c4b",isAccidental:!1,midi:36,pitchClass:0,octave:2},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#603c5d",isAccidental:!1,midi:35,pitchClass:11,octave:1},{pitch:"B/A1",flatName:"B1",sharpName:"A1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#4e4068",isAccidental:!0,midi:34,pitchClass:10,octave:1},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#38446b",isAccidental:!1,midi:33,pitchClass:9,octave:1},{pitch:"A/G1",flatName:"A1",sharpName:"G1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#1f4964",isAccidental:!0,midi:32,pitchClass:8,octave:1},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#044b55",isAccidental:!1,midi:31,pitchClass:7,octave:1},{pitch:"G/F1",flatName:"G1",sharpName:"F1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#0c4b41",isAccidental:!0,midi:30,pitchClass:6,octave:1},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#24472c",isAccidental:!1,midi:29,pitchClass:5,octave:1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#38401a",isAccidental:!1,midi:28,pitchClass:4,octave:1},{pitch:"E/D1",flatName:"E1",sharpName:"D1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#463811",isAccidental:!0,midi:27,pitchClass:3,octave:1},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#4d3017",isAccidental:!1,midi:26,pitchClass:2,octave:1},{pitch:"D/C1",flatName:"D1",sharpName:"C1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#4f2a24",isAccidental:!0,midi:25,pitchClass:1,octave:1},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#4a2733",isAccidental:!1,midi:24,pitchClass:0,octave:1},{pitch:"B0",flatName:"B0",sharpName:"B0",toneNote:"B0",frequency:30.87,column:"B",hex:"#41273f",isAccidental:!1,midi:23,pitchClass:11,octave:0},{pitch:"B/A0",flatName:"B0",sharpName:"A0",toneNote:"Bb0",frequency:29.14,column:"A",hex:"#342a46",isAccidental:!0,midi:22,pitchClass:10,octave:0},{pitch:"A0",flatName:"A0",sharpName:"A0",toneNote:"A0",frequency:27.5,column:"B",hex:"#242c48",isAccidental:!1,midi:21,pitchClass:9,octave:0}],yw=new Map,NI=new Map;Wn.forEach((n,t)=>{yw.set(n.toneNote,t),n.midi!==void 0&&NI.set(n.midi,t)});function Sm(n){return yw.get(n)??-1}function DI(n,t){const e=Sm(n),s=Sm(t);return e===-1||s===-1?null:{topIndex:Math.min(e,s),bottomIndex:Math.max(e,s)}}const LI={attack:.1,decay:.2,sustain:.8,release:.3},kI={enabled:!1,blend:.5,cutoff:.5,resonance:0,type:"lowpass",mix:1},RI={speed:5,span:0},HI={speed:5,span:0};function OI(){const n=["#4a90e2","#e24a4a","#4ae24a","#e2e24a","#e24ae2","#4ae2e2","#e2a04a","#a04ae2"],t={};return n.forEach(e=>{const s=new Float32Array(32);s[0]=1;const r=new Float32Array(32);t[e]={name:"Sine",adsr:{...LI},coeffs:s,phases:r,filter:{...kI},activePresetName:"sine",gain:1,vibrato:{...RI},tremelo:{...HI}}}),t}function VI(){const n=new Array(16).fill(2),t=n.slice(0,-1).map((e,s)=>(s+1)%4===0?"solid":"dashed");return{macrobeatGroupings:n,macrobeatBoundaryStyles:t,hasAnacrusis:!1,baseMicrobeatPx:40,tempoModulationMarkers:[]}}function WI(){const n=DI("G5","C4");return n||{topIndex:0,bottomIndex:Math.max(0,Wn.length-1)}}function GI(){const n=OI();return{placedNotes:[],placedChords:[],tonicSignGroups:{},sixteenthStampPlacements:[],tripletStampPlacements:[],annotations:[],lassoSelection:{selectedItems:[],convexHull:null,isActive:!1},history:[{notes:[],tonicSignGroups:{},timbres:JSON.parse(JSON.stringify(n)),placedChords:[],sixteenthStampPlacements:[],tripletStampPlacements:[],annotations:[],lassoSelection:{selectedItems:[],convexHull:null,isActive:!1}}],historyIndex:0,fullRowData:[...Wn],pitchRange:WI(),...VI(),selectedModulationRatio:null,timbres:n,colorPalette:{"#4a90e2":{primary:"#4a90e2",light:"#a8c8f0"},"#e24a4a":{primary:"#e24a4a",light:"#f0a8a8"},"#4ae24a":{primary:"#4ae24a",light:"#a8f0a8"},"#e2e24a":{primary:"#e2e24a",light:"#f0f0a8"},"#e24ae2":{primary:"#e24ae2",light:"#f0a8f0"},"#4ae2e2":{primary:"#4ae2e2",light:"#a8f0f0"},"#e2a04a":{primary:"#e2a04a",light:"#f0d0a8"},"#a04ae2":{primary:"#a04ae2",light:"#d0a8f0"}},selectedTool:"note",previousTool:"note",selectedToolTonicNumber:1,selectedNote:{shape:"circle",color:"#4a90e2"},deviceProfile:{isMobile:!1,isTouch:!1,isCoarsePointer:!1,orientation:"landscape",width:0,height:0},activeChordId:null,activeChordIntervals:["1P"],isIntervalsInverted:!1,chordPositionState:0,gridPosition:0,viewportRows:0,logicRows:0,cellWidth:0,cellHeight:0,columnWidths:[],musicalColumnWidths:[],degreeDisplayMode:"off",accidentalMode:{sharp:!0,flat:!0},showFrequencyLabels:!1,showOctaveLabels:!0,focusColours:!1,isPlaying:!1,isPaused:!1,isLooping:!1,tempo:90,playheadMode:"cursor",waveformExtendedView:!1,adsrTimeAxisScale:1,isPrintPreviewActive:!1,printOptions:{pageSize:"letter",includeButtonGrid:!0,includeDrums:!0,includeLeftLegend:!0,includeRightLegend:!0,orientation:"landscape",colorMode:"color",cropTop:0,cropBottom:1,cropLeft:0,cropRight:1},longNoteStyle:"style1"}}function Em(n){if(!(!n||n.isDrum)&&n.shape==="circle"&&typeof n.startColumnIndex=="number"){const t=n.startColumnIndex+1;(typeof n.endColumnIndex!="number"||n.endColumnIndex<t)&&(n.endColumnIndex=t)}}function Xu(n,t){if(typeof n.row!="number")return;const e=t.length>0?t.length-1:-1;if(e<0)return;const s=typeof n.globalRow=="number"?n.globalRow:n.row,r=Math.max(0,Math.min(e,Math.round(s)));n.globalRow=r,n.row=r}function Yu(){return`uuid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function KI(n={}){const{getMacrobeatInfo:t,getDegreeForNote:e,hasAccidental:s,log:r=()=>{}}=n;return{addNote(i){const o=this.state.placedNotes.find(a=>!a.isDrum&&a.row===i.row&&a.startColumnIndex===i.startColumnIndex&&a.color===i.color);if(o){if(this.state.degreeDisplayMode!=="off"&&e&&s){const a=e(o,this.state);if(a&&s(a))return o.enharmonicPreference=!o.enharmonicPreference,r("debug","[ENHARMONIC] Toggled enharmonic preference for note",{noteUuid:o.uuid,currentDegree:a,enharmonicPreference:o.enharmonicPreference}),this.emit("notesChanged"),o}return null}const A={...i,uuid:Yu()};return Em(A),Xu(A,this.state.fullRowData),this.state.placedNotes.push(A),this.emit("notesChanged"),A},updateNoteTail(i,o){let A=o;i.shape==="circle"&&(A=Math.max(i.startColumnIndex+1,o)),i.endColumnIndex=A,this.emit("notesChanged")},updateMultipleNoteTails(i,o){i.forEach(A=>{let a=o;A.shape==="circle"&&(a=Math.max(A.startColumnIndex+1,o)),A.endColumnIndex=a}),this.emit("notesChanged")},updateNoteRow(i,o){i.row=o,i.globalRow=o,this.emit("notesChanged")},updateMultipleNoteRows(i,o){i.forEach((A,a)=>{const l=o[a];l!==void 0&&(A.row=l,Xu(A,this.state.fullRowData))}),this.emit("notesChanged")},updateNotePosition(i,o){i.startColumnIndex=o,i.endColumnIndex=i.shape==="circle"?o+1:o,this.emit("notesChanged")},updateMultipleNotePositions(i,o){i.forEach(A=>{A.startColumnIndex=o,A.endColumnIndex=A.shape==="circle"?o+1:o}),this.emit("notesChanged")},removeNote(i){const o=this.state.placedNotes.indexOf(i);o>-1&&(this.state.placedNotes.splice(o,1),this.emit("notesChanged"))},removeMultipleNotes(i){const o=new Set(i);this.state.placedNotes=this.state.placedNotes.filter(A=>!o.has(A)),this.emit("notesChanged")},eraseInPitchArea(i,o,A=1,a=!0){const l=i+A-1,c=o-1,u=o+1;let d=!1;const p=this.state.placedNotes.length;return this.state.placedNotes=this.state.placedNotes.filter(h=>{if(h.isDrum)return!0;if(h.shape==="circle"){const m=h.startColumnIndex+1,g=typeof h.endColumnIndex=="number"?Math.max(m,h.endColumnIndex):m,v=h.startColumnIndex<=l&&g>=i,w=h.row>=c&&h.row<=u;if(v&&w)return!1}else if(h.row>=c&&h.row<=u&&h.startColumnIndex<=l&&h.endColumnIndex>=i)return!1;return!0}),this.state.placedNotes.length<p&&(d=!0),d&&(this.emit("notesChanged"),a&&this.recordState()),d},addTonicSignGroup(i){r("debug","Starting addTonicSignGroup",{tonicSignGroup:i});const o=i[0];if(!o)return;const{preMacrobeatIndex:A}=o;if(r("debug","preMacrobeatIndex",{preMacrobeatIndex:A}),Object.entries(this.state.tonicSignGroups).find(([,p])=>p.some(h=>h.preMacrobeatIndex===A))){r("debug","Existing tonic already present for measure, skipping",{preMacrobeatIndex:A});return}if(!t){r("error","getMacrobeatInfo callback not provided");return}const l=t(this.state,A+1).startColumn;r("debug","Boundary column (canvas-space) for shifting notes",{boundaryColumn:l});const c=this.state.placedNotes.filter(p=>p.startColumnIndex>=l);r("debug","Notes that will be shifted",{noteRanges:c.map(p=>`${p.startColumnIndex}-${p.endColumnIndex}`)}),this.state.placedNotes.forEach(p=>{if(p.startColumnIndex>=l){const h=p.startColumnIndex,m=p.endColumnIndex;p.startColumnIndex=p.startColumnIndex+2,p.endColumnIndex=p.endColumnIndex+2,r("debug",`Shifted note from ${h}-${m} to ${p.startColumnIndex}-${p.endColumnIndex}`)}});const u=Yu(),d=i.map(p=>({...p,uuid:u,globalRow:typeof p.globalRow=="number"?p.globalRow:p.row}));this.state.tonicSignGroups[u]=d,r("debug","Added tonic group",{uuid:u,columns:d.map(p=>p.columnIndex)}),r("debug","Emitting events: notesChanged, rhythmStructureChanged"),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},eraseTonicSignAt(i,o=!0){const A=Object.entries(this.state.tonicSignGroups).find(([,p])=>p.some(h=>h.columnIndex===i));if(!A)return!1;if(!t)return r("error","getMacrobeatInfo callback not provided"),!1;const[a,l]=A,c=l[0];if(!c)return!1;const u=c.preMacrobeatIndex,d=t(this.state,u+1).startColumn;return delete this.state.tonicSignGroups[a],this.state.placedNotes.forEach(p=>{p.startColumnIndex>=d&&(p.startColumnIndex=p.startColumnIndex-2,p.endColumnIndex=p.endColumnIndex-2)}),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),o&&this.recordState(),!0},clearAllNotes(){this.state.placedNotes=[],this.state.tonicSignGroups={},this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},loadNotes(i){const o=(i||[]).map(A=>{const a={...A,uuid:(A==null?void 0:A.uuid)??Yu()};return Em(a),Xu(a,this.state.fullRowData),a});this.state.placedNotes=o,this.emit("notesChanged"),this.recordState()}}}function qI(){return`sixteenth-stamp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function zI(n={}){const{getPlacedTonicSigns:t,isWithinTonicSpan:e,log:s=()=>{}}=n;return{addSixteenthStampPlacement(r,i,o,A="#4a90e2"){const a=i+2;if(t&&e){const d=t(this.state);(e(i,d)||e(i+1,d))&&s("debug","Cannot place sixteenth stamp - overlaps tonic column",{sixteenthStampId:r,startColumn:i,row:o})}const l=this.state.sixteenthStampPlacements.find(d=>d.row===o&&d.startColumn<a&&d.endColumn>i);l&&this.removeSixteenthStampPlacement(l.id);const c=o,u={id:qI(),sixteenthStampId:r,startColumn:i,endColumn:a,row:o,globalRow:c,color:A,timestamp:Date.now(),shapeOffsets:{}};return this.state.sixteenthStampPlacements.push(u),this.emit("sixteenthStampPlacementsChanged"),s("debug",`Added sixteenth stamp ${r} at canvas-space ${i}-${a},${o}`,{sixteenthStampId:r,startColumn:i,endColumn:a,row:o,placementId:u.id}),u},removeSixteenthStampPlacement(r){const i=this.state.sixteenthStampPlacements.findIndex(A=>A.id===r);if(i===-1)return!1;const o=this.state.sixteenthStampPlacements.splice(i,1)[0];return o?(this.emit("sixteenthStampPlacementsChanged"),s("debug",`Removed sixteenth stamp ${o.sixteenthStampId} at ${o.startColumn}-${o.endColumn},${o.row}`,{placementId:r,sixteenthStampId:o.sixteenthStampId,startColumn:o.startColumn,endColumn:o.endColumn,row:o.row}),!0):!1},eraseSixteenthStampsInArea(r,i,o,A){const a=[];for(const c of this.state.sixteenthStampPlacements){const u=c.startColumn<=i&&c.endColumn>=r,d=c.row>=o&&c.row<=A;u&&d&&a.push(c.id)}let l=!1;return a.forEach(c=>{this.removeSixteenthStampPlacement(c)&&(l=!0)}),l},getAllSixteenthStampPlacements(){return[...this.state.sixteenthStampPlacements]},getSixteenthStampAt(r,i){return this.state.sixteenthStampPlacements.find(o=>o.row===i&&r>=o.startColumn&&r<o.endColumn)||null},clearAllSixteenthStamps(){const r=this.state.sixteenthStampPlacements.length>0;this.state.sixteenthStampPlacements=[],r&&(this.emit("sixteenthStampPlacementsChanged"),s("info","Cleared all sixteenth stamp placements"))},getSixteenthStampPlaybackData(){return this.state.sixteenthStampPlacements.map(r=>{const i=this.state.fullRowData[r.row];return{sixteenthStampId:r.sixteenthStampId,column:r.startColumn,startColumn:r.startColumn,endColumn:r.endColumn,row:r.row,pitch:(i==null?void 0:i.toneNote)||"",color:r.color,placement:r}}).filter(r=>r.pitch)},updateSixteenthStampShapeOffset(r,i,o){const A=this.state.sixteenthStampPlacements.find(a=>a.id===r);if(!A){s("warn","[SIXTEENTH STAMP SHAPE OFFSET] Placement not found",{placementId:r});return}A.shapeOffsets||(A.shapeOffsets={}),s("debug","[SIXTEENTH STAMP SHAPE OFFSET] Updating shape offset",{placementId:r,shapeKey:i,oldOffset:A.shapeOffsets[i]||0,newOffset:o,baseRow:A.row,targetRow:A.row+o}),A.shapeOffsets[i]=o,this.emit("sixteenthStampPlacementsChanged")},getSixteenthStampShapeRow(r,i){var A;const o=((A=r.shapeOffsets)==null?void 0:A[i])||0;return r.row+o}}}function $I(){return`triplet-stamp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function XI(n={}){const{canvasToTime:t,timeToCanvas:e,getColumnMap:s,log:r=()=>{}}=n;return{addTripletStampPlacement(i){this.state.tripletStampPlacements||(this.state.tripletStampPlacements=[]);const o=i.startTimeIndex+i.span*2,A=this.state.tripletStampPlacements.find(l=>l.row!==i.row?!1:!(l.startTimeIndex+l.span*2<=i.startTimeIndex||o<=l.startTimeIndex));if(A&&this.removeTripletStampPlacement(A.id),this.state.sixteenthStampPlacements&&t&&s){const l=s(this.state);this.state.sixteenthStampPlacements.filter(u=>{if(u.row!==i.row)return!1;const d=t(u.startColumn,l);return d===null?!0:!(d+2<=i.startTimeIndex||d>=o)}).forEach(u=>{this.removeSixteenthStampPlacement&&this.removeSixteenthStampPlacement(u.id)})}const a={id:$I(),...i,shapeOffsets:i.shapeOffsets||{}};return this.state.tripletStampPlacements.push(a),this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),r("debug",`Added triplet stamp ${i.tripletStampId} at time ${i.startTimeIndex}, row ${i.row}`,{tripletStampId:i.tripletStampId,startTimeIndex:i.startTimeIndex,span:i.span,row:i.row,placementId:a.id}),a},removeTripletStampPlacement(i){if(!this.state.tripletStampPlacements)return!1;const o=this.state.tripletStampPlacements.findIndex(a=>a.id===i);if(o===-1)return!1;const A=this.state.tripletStampPlacements.splice(o,1)[0];return A?(this.emit("tripletStampPlacementsChanged"),r("debug",`Removed triplet stamp ${A.tripletStampId} at time ${A.startTimeIndex}, row ${A.row}`,{placementId:i,tripletStampId:A.tripletStampId,startTimeIndex:A.startTimeIndex,span:A.span,row:A.row}),!0):!1},eraseTripletStampsInArea(i,o,A,a){if(!this.state.tripletStampPlacements||!e||!s)return!1;const l=s(this.state),c=[];for(const d of this.state.tripletStampPlacements)if(d.row>=A&&d.row<=a){const p=d.span*2,h=e(d.startTimeIndex,l);h+p-1<i||h>o||c.push(d.id)}let u=!1;return c.forEach(d=>{this.removeTripletStampPlacement(d)&&(u=!0)}),u},getAllTripletStampPlacements(){return[...this.state.tripletStampPlacements||[]]},getTripletStampAt(i,o){return this.state.tripletStampPlacements&&this.state.tripletStampPlacements.find(A=>A.row===o&&i>=A.startTimeIndex&&i<A.startTimeIndex+A.span*2)||null},clearAllTripletStamps(){if(!this.state.tripletStampPlacements)return;const i=this.state.tripletStampPlacements.length>0;this.state.tripletStampPlacements=[],i&&(this.emit("tripletStampPlacementsChanged"),r("info","Cleared all triplet stamp placements"))},getTripletStampPlaybackData(){return this.state.tripletStampPlacements?this.state.tripletStampPlacements.map(i=>{const o=this.state.fullRowData[i.row];return{startTimeIndex:i.startTimeIndex,tripletStampId:i.tripletStampId,row:i.row,pitch:(o==null?void 0:o.toneNote)??"",color:i.color,span:i.span,placement:i}}).filter(i=>i.pitch):[]},updateTripletStampShapeOffset(i,o,A){var l;const a=(l=this.state.tripletStampPlacements)==null?void 0:l.find(c=>c.id===i);if(!a){r("warn","[TRIPLET STAMP SHAPE OFFSET] Placement not found",{placementId:i});return}a.shapeOffsets||(a.shapeOffsets={}),r("debug","[TRIPLET STAMP SHAPE OFFSET] Updating shape offset",{placementId:i,shapeKey:o,oldOffset:a.shapeOffsets[o]||0,newOffset:A,baseRow:a.row,targetRow:a.row+A}),a.shapeOffsets[o]=A,this.emit("tripletStampPlacementsChanged")},getTripletStampShapeRow(i,o){var a;const A=((a=i.shapeOffsets)==null?void 0:a[o])||0;return i.row+A}}}const xm={COMPRESSION_2_3:2/3,EXPANSION_3_2:3/2};function YI(n,t,e=null,s=null,r=null){return{id:`mod_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,measureIndex:n,ratio:t,active:!0,xPosition:e,columnIndex:s,macrobeatIndex:r}}const Im=new Array(19).fill(2),jI=["anacrusis","anacrusis","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid"],Fm=new Array(16).fill(2),JI=["dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed"];function Tm(n,t){const e=t(n),s=new Map;e.entries.forEach(r=>{r.type==="tonic"&&r.tonicSignUuid&&typeof r.canvasIndex=="number"&&s.set(r.tonicSignUuid,r.canvasIndex)}),Object.entries(n.tonicSignGroups||{}).forEach(([r,i])=>{const o=s.get(r);o!==void 0&&i.forEach(A=>{A.columnIndex=o})})}const ZI={entries:[],visualToCanvas:new Map,visualToTime:new Map,canvasToVisual:new Map,canvasToTime:new Map,timeToCanvas:new Map,timeToVisual:new Map,macrobeatBoundaries:[],totalVisualColumns:0,totalCanvasColumns:0,totalTimeColumns:0,totalWidthUnmodulated:0};function tF(n={}){const{getColumnMap:t=()=>ZI,visualToTimeIndex:e=()=>null,timeIndexToVisualColumn:s=()=>null,getTimeBoundaryAfterMacrobeat:r=()=>0,log:i=()=>{}}=n;return{setAnacrusis(o){var h,m,g;if(this.state.hasAnacrusis===o)return;const A=[...this.state.macrobeatGroupings],a=[...this.state.macrobeatBoundaryStyles],l=A.reduce((v,w)=>v+w,0);let c,u;if(o){const v=this._anacrusisCache,w=Im.length-Fm.length,y=Im.slice(0,w),I=jI.slice(0,w),B=(h=v==null?void 0:v.groupings)!=null&&h.length?[...v.groupings]:[...y],C=(m=v==null?void 0:v.boundaryStyles)!=null&&m.length?[...v.boundaryStyles]:[...I];if(c=[...B,...A],u=[...C,...a],!((g=v==null?void 0:v.boundaryStyles)!=null&&g.length))for(let b=0;b<C.length;b++)u[b]=b<C.length-1?"anacrusis":"solid";this._anacrusisCache=null,i("debug","rhythmActions","Enabled anacrusis",{insertedCount:B.length,insertedColumns:B.reduce((b,S)=>b+S,0)},"state")}else{const v=a.findIndex(B=>B==="solid");let w=0;if(v!==-1)w=v+1;else for(;w<a.length&&a[w]==="anacrusis";)w++;w=Math.min(w,A.length);const y=A.slice(0,w),I=a.slice(0,w);w>0?this._anacrusisCache={groupings:y,boundaryStyles:I}:this._anacrusisCache=null,c=A.slice(w),u=a.slice(w).map(B=>B==="anacrusis"?"dashed":B),c.length===0&&(c=[...Fm],u=[...JI]),i("debug","rhythmActions","Disabled anacrusis",{removalCount:w,removedColumns:y.reduce((B,C)=>B+C,0)},"state")}const p=c.reduce((v,w)=>v+w,0)-l;if(this.state.hasAnacrusis=o,this.state.macrobeatGroupings=[...c],this.state.macrobeatBoundaryStyles=[...u],Tm(this.state,t),p!==0){const v=[];this.state.placedNotes.forEach(C=>{const b=e(this.state,C.startColumnIndex,A),S=e(this.state,C.endColumnIndex,A);if(b===null||S===null)return;const T=b+p,x=S+p;if(T<0){v.push(C);return}const _=s(this.state,T,c),F=s(this.state,x,c);if(_===null||F===null){v.push(C);return}C.startColumnIndex=_,C.endColumnIndex=F}),v.forEach(C=>{const b=this.state.placedNotes.indexOf(C);b>-1&&this.state.placedNotes.splice(b,1)});const w=[];this.state.sixteenthStampPlacements.forEach(C=>{const b=e(this.state,C.startColumn,A),S=e(this.state,C.endColumn,A);if(b===null||S===null)return;const T=b+p,x=S+p;if(T<0){w.push(C);return}const _=s(this.state,T,c),F=s(this.state,x,c);if(_===null||F===null){w.push(C);return}C.startColumn=_,C.endColumn=F}),w.forEach(C=>{const b=this.state.sixteenthStampPlacements.indexOf(C);b>-1&&this.state.sixteenthStampPlacements.splice(b,1)});const y=[];this.state.tripletStampPlacements&&(this.state.tripletStampPlacements.forEach(C=>{const b=C.startTimeIndex+p;b<0?y.push(C):C.startTimeIndex=b}),y.forEach(C=>{const b=this.state.tripletStampPlacements.indexOf(C);b>-1&&this.state.tripletStampPlacements.splice(b,1)}));const I=[],B=o?c.length-A.length:-(A.length-c.length);this.state.tempoModulationMarkers.forEach(C=>{const b=C.measureIndex+B;if(b<0){I.push(C);return}C.measureIndex=b,C.columnIndex=null,C.xPosition=null,C.macrobeatIndex=null}),I.forEach(C=>{const b=this.state.tempoModulationMarkers.indexOf(C);b>-1&&this.state.tempoModulationMarkers.splice(b,1)})}this.emit("anacrusisChanged",o),this.emit("notesChanged"),this.emit("sixteenthStampPlacementsChanged"),this.emit("tripletStampPlacementsChanged"),this.emit("tempoModulationMarkersChanged"),this.emit("rhythmStructureChanged"),this.recordState()},toggleMacrobeatGrouping(o){if(o===void 0||o<0||o>=this.state.macrobeatGroupings.length){i("error","rhythmActions",`Invalid index for toggleMacrobeatGrouping: ${o}`,null,"state");return}const A=[...this.state.macrobeatGroupings],a=A[o],l=a===2?3:2,c=l-a,u=[...A];u[o]=l;const d=r(this.state,o,A),p=[];this.state.placedNotes.forEach(h=>{const m=e(this.state,h.startColumnIndex,A),g=e(this.state,h.endColumnIndex,A);if(!(m===null||g===null)&&m>=d){const v=m+c,w=g+c,y=s(this.state,v,u),I=s(this.state,w,u);y!==null&&I!==null?(h.startColumnIndex=y,h.endColumnIndex=I):p.push(h)}}),p.length&&p.forEach(h=>{const m=this.state.placedNotes.indexOf(h);m>-1&&this.state.placedNotes.splice(m,1)}),this.state.macrobeatGroupings=u,Tm(this.state,t),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},cycleMacrobeatBoundaryStyle(o){if(o===void 0||o<0||o>=this.state.macrobeatBoundaryStyles.length){i("error","rhythmActions",`Invalid index for cycleMacrobeatBoundaryStyle: ${o}`,null,"state");return}const A=this._isBoundaryInAnacrusis(o);let a;A?a=["dashed","solid","anacrusis"]:a=["dashed","solid"];const l=this.state.macrobeatBoundaryStyles[o]??"dashed",c=a.indexOf(l),u=c===-1?0:(c+1)%a.length,d=a[u]??"dashed";this.state.macrobeatBoundaryStyles[o]=d,this.emit("rhythmStructureChanged"),this.recordState()},_isBoundaryInAnacrusis(o){if(!this.state.hasAnacrusis)return!1;for(let A=0;A<=o;A++)if(this.state.macrobeatBoundaryStyles[A]==="solid")return A===o;return!0},increaseMacrobeatCount(){this.state.macrobeatGroupings.push(2),this.state.macrobeatBoundaryStyles.push("dashed"),this.emit("rhythmStructureChanged"),this.recordState()},decreaseMacrobeatCount(){if(this.state.macrobeatGroupings.length>1){const o=this.state.macrobeatGroupings.length-1,A=r(this.state,o-1,this.state.macrobeatGroupings),a=[];this.state.placedNotes.forEach(u=>{const d=e(this.state,u.startColumnIndex,this.state.macrobeatGroupings);d!==null&&d>=A&&a.push(u)}),a.forEach(u=>{const d=this.state.placedNotes.indexOf(u);d>-1&&this.state.placedNotes.splice(d,1)});const l=[];this.state.sixteenthStampPlacements.forEach(u=>{const d=e(this.state,u.startColumn,this.state.macrobeatGroupings);d!==null&&d>=A&&l.push(u)}),l.forEach(u=>{const d=this.state.sixteenthStampPlacements.indexOf(u);d>-1&&this.state.sixteenthStampPlacements.splice(d,1)});const c=[];this.state.tripletStampPlacements&&(this.state.tripletStampPlacements.forEach(u=>{u.startTimeIndex>=A&&c.push(u)}),c.forEach(u=>{const d=this.state.tripletStampPlacements.indexOf(u);d>-1&&this.state.tripletStampPlacements.splice(d,1)})),this.state.macrobeatGroupings.pop(),this.state.macrobeatBoundaryStyles.pop(),a.length>0&&this.emit("notesChanged"),l.length>0&&this.emit("sixteenthStampPlacementsChanged"),c.length>0&&this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),this.recordState()}},updateTimeSignature(o,A){if(!Array.isArray(A)||A.length===0){i("error","rhythmActions","Invalid groupings provided to updateTimeSignature",null,"state");return}let a=0,l=0,c=0;for(let y=0;y<this.state.macrobeatGroupings.length;y++){if(c===o){a=y;break}const I=y===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[y]==="solid"||I)&&c++}c=0;for(let y=0;y<this.state.macrobeatGroupings.length;y++)if(c===o){const I=y===this.state.macrobeatGroupings.length-1;if(this.state.macrobeatBoundaryStyles[y]==="solid"||I){l=y;break}}else if(c<o){const I=y===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[y]==="solid"||I)&&c++}const u=l-a+1,d=A.length,p=this.state.macrobeatGroupings.slice(a,l+1).reduce((y,I)=>y+I,0),m=A.reduce((y,I)=>y+I,0)-p,g=r(this.state,l,this.state.macrobeatGroupings);if(m!==0){const y=(()=>{const B=[...this.state.macrobeatGroupings];return B.splice(a,u,...A),B})(),I=[];this.state.placedNotes.forEach(B=>{const C=e(this.state,B.startColumnIndex,this.state.macrobeatGroupings),b=e(this.state,B.endColumnIndex,this.state.macrobeatGroupings);if(!(C===null||b===null)&&C>=g){const S=C+m,T=b+m,x=s(this.state,S,y),_=s(this.state,T,y);x!==null&&_!==null?(B.startColumnIndex=x,B.endColumnIndex=_):I.push(B)}}),I.length&&I.forEach(B=>{const C=this.state.placedNotes.indexOf(B);C>-1&&this.state.placedNotes.splice(C,1)})}const v=[...A],w=new Array(Math.max(d-1,0)).fill("dashed");if(l<this.state.macrobeatBoundaryStyles.length){const y=this.state.macrobeatBoundaryStyles[l]??"dashed";w.push(y)}this.state.macrobeatGroupings.splice(a,u,...v),this.state.macrobeatBoundaryStyles.splice(a,u-1,...w),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},addModulationMarker(o,A,a=null,l=null,c=null){if(!Object.values(xm).includes(A))return i("error","rhythmActions",`Invalid modulation ratio: ${A}`,null,"state"),null;const u=this.state.tempoModulationMarkers.findIndex(p=>p.measureIndex===o||c!==null&&p.macrobeatIndex===c||l!==null&&p.columnIndex===l);if(u!==-1){const p=this.state.tempoModulationMarkers[u];return i("info","rhythmActions",`Replacing existing modulation marker ${p.id} at measure ${o} (old ratio: ${p.ratio}, new ratio: ${A})`,null,"state"),p.ratio=A,p.xPosition=a,l!==null&&(p.columnIndex=l),c!==null&&(p.macrobeatIndex=c),this.emit("tempoModulationMarkersChanged"),this.recordState(),p.id}const d=YI(o,A,a,l,c);return this.state.tempoModulationMarkers.push(d),this.state.tempoModulationMarkers.sort((p,h)=>p.measureIndex-h.measureIndex),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Added modulation marker ${d.id} at measure ${o} with ratio=${A}, columnIndex=${l}`,null,"state"),d.id},removeModulationMarker(o){const A=this.state.tempoModulationMarkers.findIndex(a=>a.id===o);if(A===-1){i("warn","rhythmActions",`Modulation marker not found: ${o}`,null,"state");return}this.state.tempoModulationMarkers.splice(A,1),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Removed modulation marker ${o}`,null,"state")},setModulationRatio(o,A){if(!Object.values(xm).includes(A)){i("error","rhythmActions",`Invalid modulation ratio: ${A}`,null,"state");return}const a=this.state.tempoModulationMarkers.find(l=>l.id===o);if(!a){i("warn","rhythmActions",`Modulation marker not found: ${o}`,null,"state");return}a.ratio=A,this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Updated modulation marker ${o} ratio to ${A}`,null,"state")},moveModulationMarker(o,A){const a=this.state.tempoModulationMarkers.find(l=>l.id===o);if(!a){i("warn","rhythmActions",`Modulation marker not found: ${o}`,null,"state");return}a.measureIndex=A,this.state.tempoModulationMarkers.sort((l,c)=>l.measureIndex-c.measureIndex),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Moved modulation marker ${o} to measure ${A}`,null,"state")},toggleModulationMarker(o){const A=this.state.tempoModulationMarkers.find(a=>a.id===o);if(!A){i("warn","rhythmActions",`Modulation marker not found: ${o}`,null,"state");return}A.active=!A.active,this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Toggled modulation marker ${o} active state to ${A.active}`,null,"state")},clearModulationMarkers(){const o=this.state.tempoModulationMarkers.length;this.state.tempoModulationMarkers=[],this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Cleared ${o} modulation markers`,null,"state")}}}function _m(n){const t=JSON.parse(JSON.stringify(n));for(const e in t){const s=t[e];s.coeffs&&typeof s.coeffs=="object"&&!Array.isArray(s.coeffs)?s.coeffs=new Float32Array(Object.values(s.coeffs)):Array.isArray(s.coeffs)&&(s.coeffs=new Float32Array(s.coeffs)),s.phases&&typeof s.phases=="object"&&!Array.isArray(s.phases)?s.phases=new Float32Array(Object.values(s.phases)):Array.isArray(s.phases)&&(s.phases=new Float32Array(s.phases))}return t}const eF=new Set(["dashed","solid","anacrusis"]);function nF(n){return Array.isArray(n)&&n.length>0&&n.every(t=>t===2||t===3)}function sF(n,t){return Array.isArray(n)&&n.length===Math.max(t-1,0)&&n.every(e=>eF.has(e))}function rF(n,t){if(n)try{const e=n.getItem(t);if(e===null)return;const s=JSON.parse(e),r=s.macrobeatGroupings;if(!nF(r)){n.removeItem(t);return}if(!sF(s.macrobeatBoundaryStyles,r.length)){n.removeItem(t);return}if(delete s.timbres,s.pitchRange){const i=Wn.length,o=Math.max(0,i-1),A=Math.max(0,Math.min(o,s.pitchRange.topIndex??0)),a=Math.max(A,Math.min(o,s.pitchRange.bottomIndex??o));s.pitchRange={topIndex:A,bottomIndex:a}}if("playheadMode"in s){const i=s.playheadMode;i!=="cursor"&&i!=="microbeat"&&i!=="macrobeat"&&delete s.playheadMode}return s.fullRowData=[...Wn],s}catch{return}}function iF(n,t,e){if(t)try{const s=JSON.parse(JSON.stringify({placedNotes:n.placedNotes,placedChords:n.placedChords,tonicSignGroups:n.tonicSignGroups,sixteenthStampPlacements:n.sixteenthStampPlacements,tripletStampPlacements:n.tripletStampPlacements,macrobeatGroupings:n.macrobeatGroupings,macrobeatBoundaryStyles:n.macrobeatBoundaryStyles,hasAnacrusis:n.hasAnacrusis,baseMicrobeatPx:n.baseMicrobeatPx,tempoModulationMarkers:n.tempoModulationMarkers,tempo:n.tempo,activeChordIntervals:n.activeChordIntervals,selectedNote:n.selectedNote,annotations:n.annotations,pitchRange:n.pitchRange,degreeDisplayMode:n.degreeDisplayMode,showOctaveLabels:n.showOctaveLabels,longNoteStyle:n.longNoteStyle,playheadMode:n.playheadMode})),r=JSON.stringify(s);t.setItem(e,r)}catch{}}function oF(n={}){const{storageKey:t="studentNotationState",storage:e,initialState:s,onClearState:r,noteActionCallbacks:i={},sixteenthStampActionCallbacks:o={},tripletStampActionCallbacks:A={},rhythmActionCallbacks:a={}}=n,l={},c=rF(e,t),u=!c,h={state:{...GI(),...c,...s},isColdStart:u,on(m,g){l[m]||(l[m]=[]),l[m].push(g)},off(m,g){if(l[m]){const v=l[m].indexOf(g);v>-1&&l[m].splice(v,1)}},emit(m,g){l[m]&&l[m].forEach(v=>{try{v(g)}catch(w){console.error(`Error in listener for event "${m}"`,w)}})},dispose(){for(const m in l)delete l[m]},saveState(){iF(h.state,e,t)},recordState(){h.state.history=h.state.history.slice(0,h.state.historyIndex+1);const m=JSON.parse(JSON.stringify(h.state.timbres)),g={notes:JSON.parse(JSON.stringify(h.state.placedNotes)),tonicSignGroups:JSON.parse(JSON.stringify(h.state.tonicSignGroups)),placedChords:JSON.parse(JSON.stringify(h.state.placedChords)),sixteenthStampPlacements:JSON.parse(JSON.stringify(h.state.sixteenthStampPlacements)),tripletStampPlacements:JSON.parse(JSON.stringify(h.state.tripletStampPlacements||[])),timbres:m,annotations:h.state.annotations?JSON.parse(JSON.stringify(h.state.annotations)):[],lassoSelection:JSON.parse(JSON.stringify(h.state.lassoSelection))};h.state.history.push(g),h.state.historyIndex++,h.emit("historyChanged"),h.saveState()},undo(){var m;if(h.state.historyIndex>0){h.state.historyIndex--;const g=h.state.history[h.state.historyIndex];if(!g)return;h.state.placedNotes=JSON.parse(JSON.stringify(g.notes)),h.state.tonicSignGroups=JSON.parse(JSON.stringify(g.tonicSignGroups)),h.state.sixteenthStampPlacements=JSON.parse(JSON.stringify(g.sixteenthStampPlacements||[])),h.state.tripletStampPlacements=JSON.parse(JSON.stringify(g.tripletStampPlacements||[])),h.state.timbres=_m(g.timbres),h.state.annotations=g.annotations?JSON.parse(JSON.stringify(g.annotations)):[],h.emit("notesChanged"),h.emit("sixteenthStampPlacementsChanged"),h.emit("tripletStampPlacementsChanged"),h.emit("rhythmStructureChanged"),(m=h.state.selectedNote)!=null&&m.color&&h.emit("timbreChanged",h.state.selectedNote.color),h.emit("annotationsChanged"),h.emit("historyChanged")}},redo(){var m;if(h.state.historyIndex<h.state.history.length-1){h.state.historyIndex++;const g=h.state.history[h.state.historyIndex];if(!g)return;h.state.placedNotes=JSON.parse(JSON.stringify(g.notes)),h.state.tonicSignGroups=JSON.parse(JSON.stringify(g.tonicSignGroups)),h.state.sixteenthStampPlacements=JSON.parse(JSON.stringify(g.sixteenthStampPlacements||[])),h.state.tripletStampPlacements=JSON.parse(JSON.stringify(g.tripletStampPlacements||[])),h.state.timbres=_m(g.timbres),h.state.annotations=g.annotations?JSON.parse(JSON.stringify(g.annotations)):[],h.emit("notesChanged"),h.emit("sixteenthStampPlacementsChanged"),h.emit("tripletStampPlacementsChanged"),h.emit("rhythmStructureChanged"),(m=h.state.selectedNote)!=null&&m.color&&h.emit("timbreChanged",h.state.selectedNote.color),h.emit("annotationsChanged"),h.emit("historyChanged")}},clearSavedState(){e&&(e.removeItem(t),e.removeItem("effectDialValues")),r&&r()},setPlaybackState(m,g){h.state.isPlaying=m,h.state.isPaused=g,h.emit("playbackStateChanged",{isPlaying:m,isPaused:g})},setLooping(m){h.state.isLooping=m,h.emit("loopingChanged",m)},setTempo(m){h.state.tempo=m,h.emit("tempoChanged",m)},setPlayheadMode(m){h.state.playheadMode=m,h.emit("playheadModeChanged",m)},setSelectedTool(m,g){const v=h.state.selectedTool;if(h.state.previousTool=v,h.state.selectedTool=m,g!==void 0){const w=typeof g=="string"?parseInt(g,10):g;isNaN(w)||(h.state.selectedToolTonicNumber=w)}h.emit("toolChanged",{newTool:m,oldTool:v})},setSelectedNote(m,g){const v={...h.state.selectedNote};h.state.selectedNote={shape:m,color:g},h.emit("noteChanged",{newNote:h.state.selectedNote,oldNote:v})},setPitchRange(m){h.state.pitchRange={...h.state.pitchRange,...m},h.emit("pitchRangeChanged",h.state.pitchRange)},setDegreeDisplayMode(m){h.state.degreeDisplayMode=m,h.emit("degreeDisplayModeChanged",m)},setLongNoteStyle(m){h.state.longNoteStyle=m,h.emit("longNoteStyleChanged",m)},toggleAccidentalMode(m){h.state.accidentalMode[m]=!h.state.accidentalMode[m],h.emit("accidentalModeChanged",h.state.accidentalMode)},toggleFrequencyLabels(){h.state.showFrequencyLabels=!h.state.showFrequencyLabels,h.emit("frequencyLabelsChanged",h.state.showFrequencyLabels)},toggleOctaveLabels(){h.state.showOctaveLabels=!h.state.showOctaveLabels,h.emit("octaveLabelsChanged",h.state.showOctaveLabels)},toggleFocusColours(){h.state.focusColours=!h.state.focusColours,h.emit("focusColoursChanged",h.state.focusColours)},toggleWaveformExtendedView(){h.state.waveformExtendedView=!h.state.waveformExtendedView,h.emit("waveformExtendedViewChanged",h.state.waveformExtendedView)},setLayoutConfig(m){m.cellWidth!==void 0&&(h.state.cellWidth=m.cellWidth),m.cellHeight!==void 0&&(h.state.cellHeight=m.cellHeight),m.columnWidths!==void 0&&(h.state.columnWidths=m.columnWidths),h.emit("layoutConfigChanged",m)},setDeviceProfile(m){h.state.deviceProfile={...h.state.deviceProfile,...m},h.emit("deviceProfileChanged",h.state.deviceProfile)},setPrintPreviewActive(m){h.state.isPrintPreviewActive=m,h.emit("printPreviewStateChanged",m)},setPrintOptions(m){h.state.printOptions={...h.state.printOptions,...m},h.emit("printOptionsChanged",h.state.printOptions)},setAdsrTimeAxisScale(m){h.state.adsrTimeAxisScale=m,h.emit("adsrTimeAxisScaleChanged",m)},setAdsrComponentWidth(){},shiftGridUp(){},shiftGridDown(){},setGridPosition(){},setKeySignature(m){h.state.keySignature=m,h.emit("keySignatureChanged",m)},setActiveChordIntervals(m){h.state.activeChordIntervals=m,h.emit("activeChordIntervalsChanged",m)},setIntervalsInversion(m){h.state.isIntervalsInverted=m,h.emit("intervalsInversionChanged",m)},setChordPosition(m){h.state.chordPositionState=m,h.emit("chordPositionChanged",m)},setADSR(m,g){h.state.timbres[m]&&(h.state.timbres[m].adsr={...h.state.timbres[m].adsr,...g},h.emit("timbreChanged",m))},setHarmonicCoefficients(m,g){h.state.timbres[m]&&(h.state.timbres[m].coeffs=g,h.emit("timbreChanged",m))},setHarmonicPhases(m,g){h.state.timbres[m]&&(h.state.timbres[m].phases=g,h.emit("timbreChanged",m))},setFilterSettings(m,g){h.state.timbres[m]&&(h.state.timbres[m].filter={...h.state.timbres[m].filter,...g},h.emit("timbreChanged",m))},applyPreset(m,g){h.state.timbres[m]&&(Object.assign(h.state.timbres[m],g),h.emit("timbreChanged",m))},...KI(i),...zI(o),...XI(A),...tF(a)};return e&&(h.on("tempoChanged",()=>h.saveState()),h.on("degreeDisplayModeChanged",()=>h.saveState()),h.on("longNoteStyleChanged",()=>h.saveState()),h.on("playheadModeChanged",()=>h.saveState())),u&&e&&h.saveState(),h}class AF extends Oo{constructor(e){super(e);M(this,"presetGain");M(this,"vibratoLFO");M(this,"vibratoDepth");M(this,"vibratoGain");M(this,"tremoloLFO");M(this,"tremoloDepth");M(this,"tremoloGain");M(this,"hpFilter");M(this,"lpFilterForBP");M(this,"lpFilterSolo");M(this,"hpOutput");M(this,"bpOutput");M(this,"lpOutput");M(this,"hp_bp_fade");M(this,"main_fade");M(this,"wetDryFade");this.presetGain=new Mt(e.gain||1),this.vibratoLFO=new wc(0,0),this.vibratoDepth=new ZA(-1,1),this.vibratoGain=new Mt(0),this.vibratoLFO.connect(this.vibratoDepth),this.vibratoDepth.connect(this.vibratoGain),this.vibratoGain.connect(this.oscillator.frequency),this.tremoloLFO=new wc(0,0),this.tremoloDepth=new ZA(0,1),this.tremoloGain=new Mt(1),this.tremoloLFO.connect(this.tremoloDepth),this.tremoloDepth.connect(this.tremoloGain.gain),this.hpFilter=new TA({type:"highpass"}),this.lpFilterForBP=new TA({type:"lowpass"}),this.lpFilterSolo=new TA({type:"lowpass"}),this.hpOutput=new Mt,this.bpOutput=new Mt,this.lpOutput=new Mt,this.hp_bp_fade=new yo(0),this.main_fade=new yo(0),this.wetDryFade=new yo(0),this.oscillator.connect(this.presetGain),this.presetGain.connect(this.wetDryFade.a),this.presetGain.connect(this.hpFilter),this.hpFilter.connect(this.hpOutput),this.hpFilter.connect(this.lpFilterForBP),this.lpFilterForBP.connect(this.bpOutput),this.presetGain.connect(this.lpFilterSolo),this.lpFilterSolo.connect(this.lpOutput),this.hpOutput.connect(this.hp_bp_fade.a),this.bpOutput.connect(this.hp_bp_fade.b),this.lpOutput.connect(this.main_fade.b),this.hp_bp_fade.connect(this.main_fade.a),this.main_fade.connect(this.wetDryFade.b),this.wetDryFade.connect(this.tremoloGain),this.tremoloGain.connect(this.envelope),e.filter&&this._setFilter(e.filter),e.vibrato?this._setVibrato(e.vibrato):this._setVibrato({speed:0,span:0}),e.tremelo?this._setTremolo(e.tremelo):this._setTremolo({speed:0,span:0})}_setPresetGain(e){this.presetGain&&(this.presetGain.gain.value=e)}_setVibrato(e,s=Pe()){var p,h;if(!this.vibratoLFO||!this.vibratoGain)return;const r=e.speed/100*16,o=(((h=(p=Ke())==null?void 0:p.rawContext)==null?void 0:h.state)??ta.state)==="running";if(e.speed===0||e.span===0){o&&this.vibratoLFO.state==="started"&&this.vibratoLFO.stop(s),this.vibratoLFO.frequency.value=0,this.vibratoGain.gain.value=0;return}o&&this.vibratoLFO.state!=="started"&&this.vibratoLFO.start(s),this.vibratoLFO.frequency.value=r;const l=e.span/100*50/1200,d=440*(Math.pow(2,l)-1);this.vibratoGain.gain.value=d}_setTremolo(e,s=Pe()){var c,u;if(!this.tremoloLFO||!this.tremoloGain)return;const r=e.speed/100*16,o=(((u=(c=Ke())==null?void 0:c.rawContext)==null?void 0:u.state)??ta.state)==="running";if(e.speed===0||e.span===0){o&&this.tremoloLFO.state==="started"&&this.tremoloLFO.stop(s),this.tremoloLFO.frequency.value=0,this.tremoloGain.gain.cancelScheduledValues(s),this.tremoloGain.gain.value=1;return}o&&this.tremoloLFO.state!=="started"&&this.tremoloLFO.start(s),this.tremoloLFO.frequency.value=r;const A=e.span/100,a=Math.max(0,1-A),l=1;this.tremoloDepth.min=a,this.tremoloDepth.max=l}_setFilter(e){this.wetDryFade.fade.value=e.enabled?1:0;const s=bI(e.cutoff+35).toFrequency(),r=e.resonance/100*12+.1;this.hpFilter.set({frequency:s,Q:r}),this.lpFilterForBP.set({frequency:s,Q:r}),this.lpFilterSolo.set({frequency:s,Q:r});const i=e.blend;i<=1?(this.main_fade.fade.value=0,this.hp_bp_fade.fade.value=i):(this.main_fade.fade.value=i-1,this.hp_bp_fade.fade.value=1)}}const Sw={polyphonyReference:32,smoothingTauMs:200,masterGainRampMs:50,gainUpdateIntervalMs:16};function Ew(n=Sw.polyphonyReference){return 1/Math.sqrt(n)}class aF{constructor(t,e={}){M(this,"masterGain");M(this,"options");M(this,"perVoiceBaselineGain");M(this,"activeVoiceCount",0);M(this,"smoothedVoiceCount");M(this,"gainUpdateLoopId",null);this.masterGain=t,this.options={...Sw,...e},this.perVoiceBaselineGain=Ew(this.options.polyphonyReference),this.smoothedVoiceCount=this.options.polyphonyReference}start(){this.stop(),this.gainUpdateLoopId=setInterval(()=>this.updateMasterGain(),this.options.gainUpdateIntervalMs)}stop(){this.gainUpdateLoopId!==null&&(clearInterval(this.gainUpdateLoopId),this.gainUpdateLoopId=null)}noteOn(t=1){t<=0||(this.activeVoiceCount+=t)}noteOff(t=1){t<=0||(this.activeVoiceCount=Math.max(0,this.activeVoiceCount-t))}clampActiveVoiceCountToAtMost(t){Number.isFinite(t)&&(this.activeVoiceCount=Math.max(0,Math.min(this.activeVoiceCount,Math.floor(t))))}resetActiveVoiceCount(){this.activeVoiceCount=0}getActiveVoiceCount(){return this.activeVoiceCount}updateMasterGain(){const{polyphonyReference:t,smoothingTauMs:e,masterGainRampMs:s,gainUpdateIntervalMs:r}=this.options,i=Pe();if(this.activeVoiceCount===0){this.smoothedVoiceCount=.01*t+(1-.01)*this.smoothedVoiceCount;return}const o=r/1e3,A=1-Math.exp(-o/(e/1e3)),a=Math.max(1,this.activeVoiceCount);this.smoothedVoiceCount=A*a+(1-A)*this.smoothedVoiceCount;const l=Math.sqrt(t/this.smoothedVoiceCount),c=this.perVoiceBaselineGain*l;this.masterGain.gain.rampTo(c,s/1e3,i)}}const lF={clippingWarningThresholdDb:-3,clippingMonitorIntervalMs:500,clippingWarningCooldownMs:2e3};class cF{constructor(t,e={}){M(this,"meter");M(this,"options");M(this,"clippingMonitorId",null);M(this,"lastClippingWarningAt",0);this.meter=t,this.options={...lF,...e}}start(){this.stop(),this.lastClippingWarningAt=0,this.clippingMonitorId=setInterval(()=>{var r,i;const t=this.meter.getValue(),e=Array.isArray(t)?t[0]:t;if(e===void 0||e<=this.options.clippingWarningThresholdDb)return;const s=Date.now();s-this.lastClippingWarningAt<this.options.clippingWarningCooldownMs||(this.lastClippingWarningAt=s,(i=(r=this.options).onWarning)==null||i.call(r,e))},this.options.clippingMonitorIntervalMs)}stop(){this.clippingMonitorId!==null&&(clearInterval(this.clippingMonitorId),this.clippingMonitorId=null)}}function uF(n){const{timbres:t,masterVolume:e=0,effectsManager:s,harmonicFilter:r,logger:i,audioInit:o,getDrumVolume:A}=n,a={};let l=null,c=null,u=null,d=null,p=null,h={},m=null,g=null;const v={...t},w=i??{debug:()=>{},info:()=>{},warn:()=>{}};function y(C){if(r)return r.getFilteredCoefficients(C);const b=v[C];return b!=null&&b.coeffs?b.coeffs:new Float32Array([0,1])}function I(C){const b=C.reduce((S,T)=>S+Math.abs(T),0);return b>1?Array.from(C).map(S=>S/b):Array.from(C)}const B={init(){this.stopBackgroundMonitors(),l=new Mt(Ew()),m=new aF(l),m.start(),c=new fr(e),u=new Cu({threshold:-12,ratio:3,attack:.01,release:.1,knee:6}),d=new Ap(-3),p=new ip,l.connect(c),c.connect(u),u.connect(d),d.toDestination(),d.connect(p),p&&(g=new cF(p,{onWarning:C=>{w.warn("SynthEngine","Limiter input approaching clipping threshold",{level:C},"audio")}}),g.start());for(const C in v){const b=v[C];if(!b)continue;b.vibrato||(b.vibrato={speed:0,span:0}),b.tremelo||(b.tremelo={speed:0,span:0});const S=y(C),T=I(S),x=b.gain||1,_=new ep({voice:AF,options:{oscillator:{type:"custom",partials:T},envelope:b.adsr,filter:b.filter,vibrato:b.vibrato,tremelo:b.tremelo,gain:x}}).connect(l);s&&l&&s.applySynthEffects(_,C,l);const F=_.triggerAttack.bind(_);_.triggerAttack=function(...Q){const U=F(...Q),D=(Q[1]??Pe())+.005;return _A.schedule(()=>{const R=this._activeVoices;s?R&&R.size>0?R.forEach(N=>{N.effectsApplied||(s.applyEffectsToVoice(N,C),N.effectsApplied=!0)}):this._voices&&Array.isArray(this._voices)&&this._voices.forEach(N=>{N&&!N.effectsApplied&&(s.applyEffectsToVoice(N,C),N.effectsApplied=!0)}):R&&R.size>0?R.forEach(N=>{N._setVibrato&&N.vibratoApplied!==!0&&(N._setVibrato(this._currentVibrato),N.vibratoApplied=!0),N._setTremolo&&N.tremoloApplied!==!0&&(N._setTremolo(this._currentTremolo),N.tremoloApplied=!0)}):this._voices&&Array.isArray(this._voices)&&this._voices.forEach(N=>{N!=null&&N._setVibrato&&N.vibratoApplied!==!0&&(N._setVibrato(this._currentVibrato),N.vibratoApplied=!0),N!=null&&N._setTremolo&&N.tremoloApplied!==!0&&(N._setTremolo(this._currentTremolo),N.tremoloApplied=!0)})},D),U},_._currentVibrato=b.vibrato,_._currentTremolo=b.tremelo,_._currentFilter=b.filter,a[C]=_,w.debug("SynthEngine",`Created filtered synth for color: ${C}`,null,"audio")}w.info("SynthEngine","Initialized with multi-timbral support",null,"audio")},updateSynthForColor(C){const b=v[C],S=a[C];if(!S||!b)return;b.vibrato||(b.vibrato={speed:0,span:0}),b.tremelo||(b.tremelo={speed:0,span:0}),w.debug("SynthEngine",`Updating timbre for color ${C}`,null,"audio");const T=y(C),x=I(T);S.set({oscillator:{partials:x},envelope:b.adsr}),s&&l&&s.applySynthEffects(S,C,l),S._currentVibrato=b.vibrato,S._currentTremolo=b.tremelo,S._currentFilter=b.filter;const _=S._activeVoices;_&&_.size>0?_.forEach(F=>{if(F._setFilter&&F._setFilter(b.filter),F._setVibrato&&(F._setVibrato(b.vibrato),F.vibratoApplied=!0),F._setTremolo&&(F._setTremolo(b.tremelo),F.tremoloApplied=!0),F._setPresetGain){const Q=b.gain||1;F._setPresetGain(Q)}}):S._voices&&Array.isArray(S._voices)&&S._voices.forEach(F=>{if(F!=null&&F._setVibrato&&(F._setVibrato(b.vibrato),F.vibratoApplied=!0),F!=null&&F._setTremolo&&(F._setTremolo(b.tremelo),F.tremoloApplied=!0),F!=null&&F._setFilter&&F._setFilter(b.filter),F!=null&&F._setPresetGain){const Q=b.gain||1;F._setPresetGain(Q)}})},setBpm(C){try{ht!=null&&ht.bpm&&(ht.bpm.value=C,w.debug("SynthEngine",`Tone.Transport BPM updated to ${C}`,null,"audio"))}catch(b){w.warn("SynthEngine","Unable to update BPM on Tone.Transport",{tempo:C,error:b},"audio")}},setVolume(C){c&&(c.volume.value=C)},async playNote(C,b,S=Pe()){await(o||(()=>gc()))();const x=Object.keys(a);if(x.length===0)return;const[_]=x;if(!_)return;const F=a[_];F&&F.triggerAttackRelease(C,b,S)},triggerAttack(C,b,S=Pe(),T=!1){const x=a[b];if(x)if(m==null||m.noteOn(1),T&&A){const _=A(),F=x.volume.value,Q=F+20*Math.log10(_);x.volume.value=Q,x.triggerAttack(C,S),_A.schedule(()=>{x!=null&&x.volume&&(x.volume.value=F)},S+.1)}else x.triggerAttack(C,S)},triggerAttackInteractive(C,b){B.triggerAttack(C,b,Pe()+.02)},quickReleasePitches(C,b){var x,_,F;const S=a[b];if(!S||!C||C.length===0)return;let T;try{const Q=typeof S.get=="function"?S.get():null,U=(x=Q==null?void 0:Q.envelope)==null?void 0:x.release;T=typeof U=="number"?U:void 0,S.set({envelope:{release:.01}}),C.forEach(D=>{S.triggerRelease(D,Pe())});const W=((_=S._activeVoices)==null?void 0:_.size)??((F=S._voices)==null?void 0:F.length)??(m==null?void 0:m.getActiveVoiceCount())??0;m==null||m.clampActiveVoiceCountToAtMost(W)}catch(Q){w.warn("SynthEngine","quickReleasePitches failed",{err:Q,color:b,pitches:C},"audio")}finally{if(T!==void 0)try{S.set({envelope:{release:T}})}catch{}}},triggerRelease(C,b,S=Pe()){var _,F;const T=a[b];if(!T)return;T.triggerRelease(C,S),m==null||m.noteOff(1);const x=((_=T._activeVoices)==null?void 0:_.size)??((F=T._voices)==null?void 0:F.length)??(m==null?void 0:m.getActiveVoiceCount())??0;m==null||m.clampActiveVoiceCountToAtMost(x)},releaseAll(){var C;for(const b in a)(C=a[b])==null||C.releaseAll();m==null||m.resetActiveVoiceCount()},createWaveformAnalyzer(C){const b=a[C];return b?(h[C]||(h[C]=new Na("waveform",1024),b.connect(h[C]),w.debug("SynthEngine",`Created waveform analyzer for color: ${C}`,null,"waveform")),h[C]):(w.warn("SynthEngine",`No synth found for color: ${C}`,null,"audio"),null)},getWaveformAnalyzer(C){return h[C]||null},getAllWaveformAnalyzers(){const C=new Map;for(const b in h)h[b]&&C.set(b,h[b]);return C},removeWaveformAnalyzer(C){h[C]&&(h[C].dispose(),delete h[C],w.debug("SynthEngine",`Removed waveform analyzer for color: ${C}`,null,"waveform"))},disposeAllWaveformAnalyzers(){for(const C in h)h[C]&&h[C].dispose();h={},w.debug("SynthEngine","Disposed all waveform analyzers",null,"waveform")},getSynth(C){return a[C]||null},getAllSynths(){return{...a}},getMainVolumeNode(){return c||null},getMasterGainNode(){return l||null},stopBackgroundMonitors(){g==null||g.stop(),m==null||m.stop()},dispose(){var C;this.stopBackgroundMonitors(),this.disposeAllWaveformAnalyzers();for(const b in a)(C=a[b])==null||C.dispose();l==null||l.dispose(),c==null||c.dispose(),u==null||u.dispose(),d==null||d.dispose(),p==null||p.dispose(),w.debug("SynthEngine","Disposed SynthEngine",null,"audio")}};return B}const Mm=1e-4;function dF(n){const{getMacrobeatInfo:t,getPlacedTonicSigns:e,getTonicSpanColumnIndices:s,updatePlayheadModel:r,logger:i}=n;let o=[],A=0,a=0,l=0;const c=i??{debug:()=>{}};function u(h){return 60/(h*2)}function d(h,m,g){let v=0;c.debug("TimeMapCalculator","[TIMEMAP] Building timeMap",{columnCount:m.length,tonicSignCount:g.length,microbeatDuration:h});const w=m.length,y=s(g);for(let I=0;I<w;I++){o[I]=v;const B=y.has(I);if(B?c.debug("TimeMapCalculator",`[TIMEMAP] Column ${I} is tonic, not advancing time`):v+=(m[I]||0)*h,I<5){const C=o[I];C!==void 0&&c.debug("TimeMapCalculator",`[TIMEMAP] timeMap[${I}] = ${C.toFixed(3)}s (isTonic: ${B})`)}}w>0&&(o[w]=v),c.debug("TimeMapCalculator",`[TIMEMAP] Complete. Total columns: ${w}, Final time: ${v.toFixed(3)}s`)}function p(h){var y;const m=o.length>0?o[o.length-1]??0:0;if(!Number.isFinite(m)||m===0){A=0;return}const g=((y=h.tempoModulationMarkers)==null?void 0:y.filter(I=>I.active))||[];if(g.length===0){A=m;return}const v=[...g].sort((I,B)=>I.measureIndex-B.measureIndex);let w=m;for(const I of v){const B=t(I.measureIndex);if(B){const C=B.endColumn-1,b=o[C]??m,S=m-b,T=S*I.ratio;w=w-S+T}}A=w}return{getMicrobeatDuration:u,calculate(h){var y,I;c.debug("TimeMapCalculator","calculate",{tempo:`${h.tempo} BPM`}),o=[];const m=u(h.tempo),{columnWidths:g}=h,v=e();d(m,g,v),(I=c.timing)==null||I.call(c,"TimeMapCalculator","calculate",{totalDuration:`${(y=o[o.length-1])==null?void 0:y.toFixed(2)}s`}),p(h);const w=A;r==null||r({timeMap:o,musicalEndTime:w,columnWidths:h.columnWidths,cellWidth:h.cellWidth})},getTimeMap(){return o},getMusicalEndTime(){return A},findNonAnacrusisStart(h){if(!h.hasAnacrusis)return c.debug("TimeMapCalculator","[ANACRUSIS] No anacrusis, starting from time 0"),0;for(let m=0;m<h.macrobeatBoundaryStyles.length;m++)if(h.macrobeatBoundaryStyles[m]==="solid"){const g=t(m+1);if(g){const v=o[g.startColumn]||0;return c.debug("TimeMapCalculator",`[ANACRUSIS] Found solid boundary at macrobeat ${m}, non-anacrusis starts at column ${g.startColumn}, time ${v.toFixed(3)}s`),v}}return c.debug("TimeMapCalculator","[ANACRUSIS] No solid boundary found, starting from time 0"),0},applyModulationToTime(h,m,g){var I;const v=((I=g.tempoModulationMarkers)==null?void 0:I.filter(B=>B.active))||[];if(v.length===0)return h;const w=[...v].sort((B,C)=>B.measureIndex-C.measureIndex);let y=h;m<5&&c.debug("TimeMapCalculator",`[MODULATION] Column ${m}: baseTime ${h.toFixed(3)}s, ${w.length} active markers`);for(const B of w){const C=t(B.measureIndex);if(C){const b=C.endColumn;if(m>b){const S=o[b]!==void 0?o[b]:0,T=h-S,x=T*B.ratio;y=y-T+x,m<5&&c.debug("TimeMapCalculator",`[MODULATION] Column ${m}: Applied marker at measure ${B.measureIndex} (col ${b}), ratio ${B.ratio}, adjustedTime ${y.toFixed(3)}s`)}}}return y},setLoopBounds(h,m,g){const v=u(g),w=Math.max(v,.001),y=Number.isFinite(h)?h:0;let I=Number.isFinite(m)?m:y+w;I<=y&&(I=y+w),a=y,l=I,ht&&(ht.loopStart=y,ht.loopEnd=I)},getConfiguredLoopBounds(){return{loopStart:a,loopEnd:l}},setConfiguredLoopBounds(h,m){a=h,l=m},clearConfiguredLoopBounds(){a=0,l=0},reapplyConfiguredLoopBounds(h){if(l>a){const m=Ce(ht.loopStart).toSeconds(),g=Ce(ht.loopEnd).toSeconds(),v=Math.abs(m-a),w=Math.abs(g-l);(v>Mm||w>Mm)&&(ht.loopStart=a,ht.loopEnd=l),ht.loop!==h&&(ht.loop=h)}},updateLoopBoundsFromTimeline(h){const m=this.findNonAnacrusisStart(h),g=A;this.setLoopBounds(m,g,h.tempo)}}}const hF={H:"https://tonejs.github.io/audio/drum-samples/CR78/hihat.mp3",M:"https://tonejs.github.io/audio/drum-samples/CR78/snare.mp3",L:"https://tonejs.github.io/audio/drum-samples/CR78/kick.mp3"},fF=1e-4;function pF(n={}){var a;const{samples:t=hF,synthEngine:e,initialVolume:s=0}=n;let r=null,i=null;const o=new Map;function A(l,c){let u=Number.isFinite(c)?c:Pe();const d=o.get(l)??-1/0;return u>d||(u=d+fF),o.set(l,u),u}if(i=new fr(s),r=new vu(t).connect(i),e){const l=(a=e.getMainVolumeNode)==null?void 0:a.call(e);l?i.connect(l):i.toDestination()}else i.toDestination();return{getPlayers(){return r},getVolumeNode(){return i},trigger(l,c){var d;if(!r)return;const u=A(l,c);(d=r.player(l))==null||d.start(u)},reset(){o.clear()},dispose(){r==null||r.dispose(),i==null||i.dispose(),r=null,i=null,o.clear()}}}const Qm="",Um="";function mF(n,t){if(n.length<2||t<n[0]||t>=n[n.length-1])return-1;let e=0,s=n.length-2;for(;e<=s;){const r=e+s>>>1,i=n[r],o=n[r+1];if(t>=i&&t<o)return r;t<i?s=r-1:e=r+1}return-1}function gF(n){const{synthEngine:t,stateCallbacks:e,eventCallbacks:s,visualCallbacks:r,logger:i,audioInit:o,playbackMode:A="standard"}=n,a=i??{debug:()=>{},info:()=>{},warn:()=>{}};let l=null,c=!1,u=null,d=null,p=1;const h=[];function m(x,_){const F=_.fullRowData[x];return F?F.toneNote.replace(Qm,"b").replace(Um,"#"):"C4"}function g(x,_){const F=x.globalRow??x.row,Q=_.fullRowData[F];return Q?Q.toneNote.replace(Qm,"b").replace(Um,"#"):"C4"}function v(){var D,R,N;if(!u)return;const x=e.getState();a.debug("TransportService","scheduleNotes","Clearing previous transport events and rescheduling all notes"),ht.cancel(),d==null||d.reset(),u.calculate(x),(D=r==null?void 0:r.clearAdsrVisuals)==null||D.call(r);const _=u.getTimeMap(),{loopEnd:F}=u.getConfiguredLoopBounds(),Q=u.findNonAnacrusisStart(x);a.debug("TransportService",`[ANACRUSIS] hasAnacrusis: ${x.hasAnacrusis}, anacrusisOffset: ${Q.toFixed(3)}s`),x.placedNotes.forEach((q,J)=>{const nt=q.startColumnIndex,At=q.endColumnIndex,ot=_[nt];if(ot===void 0){a.warn("TransportService",`[NOTE SCHEDULE] Note ${J}: timeMap[${nt}] undefined, skipping`);return}const V=u.applyModulationToTime(ot,nt,x),H=_[At+1];if(H===void 0){a.warn("TransportService",`Skipping note with invalid endColumnIndex: ${q.endColumnIndex+1}`);return}const Y=u.applyModulationToTime(H,At+1,x)-V;q.isDrum?w(q,V):y(q,V,Y,F,x)});const U=((R=e.getStampPlaybackData)==null?void 0:R.call(e))??[];U.forEach(q=>{I(q,_,x)});const W=((N=e.getTripletPlaybackData)==null?void 0:N.call(e))??[];W.forEach(q=>{B(q,_,x)}),a.debug("TransportService","scheduleNotes",`Finished scheduling ${x.placedNotes.length} notes, ${U.length} stamps, and ${W.length} triplets`)}function w(x,_){const F=e.getState();ht.schedule(Q=>{if(F.isPaused)return;const U=x.drumTrack;if(U==null)return;const W=String(U);d==null||d.trigger(W,Q),_A.schedule(()=>{var D;(D=r==null?void 0:r.triggerDrumNotePop)==null||D.call(r,x.startColumnIndex,U)},Q)},_)}function y(x,_,F,Q,U){var V;const W=g(x,U),D=x.color,R=x.globalRow??x.row,N=((V=U.fullRowData[R])==null?void 0:V.hex)||"#888888",q=x.uuid,J=U.timbres[D];if(!J){a.warn("TransportService",`Timbre not found for color ${D}. Skipping note ${q}`);return}let nt=_+F;const ot=Q-.001;nt>=Q&&(nt=Math.max(_+.001,ot)),ht.schedule(H=>{e.getState().isPaused||(t.triggerAttack(W,D,H),_A.schedule(()=>{var G;(G=r==null?void 0:r.triggerAdsrVisual)==null||G.call(r,q,"attack",N,J.adsr),s.emit("noteAttack",{noteId:q,color:D})},H))},_),ht.schedule(H=>{t.triggerRelease(W,D,H),_A.schedule(()=>{var G;(G=r==null?void 0:r.triggerAdsrVisual)==null||G.call(r,q,"release",N,J.adsr),s.emit("noteRelease",{noteId:q,color:D})},H)},nt)}function I(x,_,F){var D;const Q=x.column,U=_[Q];if(U===void 0)return;(((D=e.getStampScheduleEvents)==null?void 0:D.call(e,x.sixteenthStampId,x.placement))??[]).forEach(R=>{C(R,U,x.row,x.color,F)})}function B(x,_,F){var D,R;const Q=((D=e.timeToCanvas)==null?void 0:D.call(e,x.startTimeIndex,F))??x.startTimeIndex,U=_[Q];if(U===void 0)return;(((R=e.getTripletScheduleEvents)==null?void 0:R.call(e,x.tripletStampId,x.placement))??[]).forEach(N=>{C(N,U,x.row,x.color,F)})}function C(x,_,F,Q,U){const W=Ce(x.offset).toSeconds(),D=Ce(x.duration).toSeconds(),R=_+W,N=R+D,q=F+x.rowOffset,J=m(q,U);ht.schedule(nt=>{e.getState().isPaused||t.triggerAttack(J,Q,nt)},R),ht.schedule(nt=>{e.getState().isPaused||t.triggerRelease(J,Q,nt)},N)}function b(){var R;const _=e.getState().tempo,F=1e-4,Q=.5,U=N=>(N==null?void 0:N.xPosition)??477.5,W=typeof((R=ht==null?void 0:ht.bpm)==null?void 0:R.value)=="number"?ht.bpm.value:_;p=_!==0?W/_:1,c=!0;function D(){var yt,Bt,Et,Qt,ct,gt,mt,Ot,ve,we,wr,jn,ni,si,jp;if(!c||!u)return;if(ht.state==="stopped"){l=requestAnimationFrame(D);return}const N=e.getState(),q=Ce(ht.loopEnd).toSeconds(),J=N.isLooping,nt=u.getMusicalEndTime(),At=J&&q>0?q:nt,ot=ht.seconds,V=ot*1e3,H=ot>=At-.001;if(!J&&H){a.info("TransportService","Playback reached end. Stopping playhead."),T.stop();return}if(N.isPaused){l=requestAnimationFrame(D);return}const G=u.getTimeMap();(yt=r==null?void 0:r.clearPlayheadCanvas)==null||yt.call(r),(Bt=r==null?void 0:r.clearDrumPlayheadCanvas)==null||Bt.call(r);let Y=ot;if(J){const qi=Ce(ht.loopStart).toSeconds(),Os=Ce(ht.loopEnd).toSeconds()-qi;Os>0&&(Y=(ot-qi)%Os+qi)}const P=((Et=e.getCanvasWidth)==null?void 0:Et.call(e))??1e3,st=((Qt=e.getPlacedTonicSigns)==null?void 0:Qt.call(e))??[],L=((ct=e.getTonicSpanColumnIndices)==null?void 0:ct.call(e,st))??new Set;let K=0,O=0,X=0,tt=-1;const k=mF(G,Y);if(k>=0){const qi=G[k],Jp=G[k+1];let Os=k;for(;L.has(Os)&&Os<G.length-1;)Os++;const Ku=((gt=e.getColumnStartX)==null?void 0:gt.call(e,Os))??0,Zp=((mt=e.getColumnWidth)==null?void 0:mt.call(e,Os))??10;if(O=Ku,X=Zp,tt=Os,L.has(k))K=Ku;else{const tm=Jp-qi,Jb=Y-qi,Zb=tm>0?Jb/tm:0;K=Ku+Zb*Zp}}const z=Math.min(K,P);S(N,z,_,U,F,Q);const $=((Ot=r==null?void 0:r.getPlayheadCanvasHeight)==null?void 0:Ot.call(r))??500,rt=((ve=r==null?void 0:r.getDrumCanvasHeight)==null?void 0:ve.call(r))??100,et=N.playheadMode==="macrobeat"&&tt>=0?(we=e.getMacrobeatHighlightRect)==null?void 0:we.call(e,tt):null,it=(et==null?void 0:et.x)??O,at=(et==null?void 0:et.width)??X;z>=0&&(N.playheadMode==="macrobeat"||N.playheadMode==="microbeat"?((wr=r==null?void 0:r.drawPlayheadHighlight)==null||wr.call(r,it,at,$,V),(jn=r==null?void 0:r.drawDrumPlayheadHighlight)==null||jn.call(r,it,at,rt,V)):((ni=r==null?void 0:r.drawPlayheadLine)==null||ni.call(r,z,$),(si=r==null?void 0:r.drawDrumPlayheadLine)==null||si.call(r,z,rt)));const Ct=N.playheadMode==="macrobeat"||N.playheadMode==="microbeat";(jp=r==null?void 0:r.updateBeatLineHighlight)==null||jp.call(r,it,at,Ct),l=requestAnimationFrame(D)}D()}function S(x,_,F,Q,U,W){if(!u)return;const R=(Array.isArray(x.tempoModulationMarkers)?x.tempoModulationMarkers:[]).filter(N=>(N==null?void 0:N.active)&&typeof N.ratio=="number"&&N.ratio!==0).sort((N,q)=>Q(N)-Q(q));if(R.length>0){let N=1;for(const q of R){const J=Q(q);if(_+W>=J)N*=1/q.ratio;else break}if((!Number.isFinite(N)||N<=0)&&(N=1),Math.abs(N-p)>U){const q=F*N;ht.bpm.value=q,u.reapplyConfiguredLoopBounds(x.isLooping),p=N,a.debug("TransportService",`Tempo multiplier updated to ${N.toFixed(3)} (${q.toFixed(2)} BPM)`)}}else Math.abs(p-1)>U&&(ht.bpm.value=F,u.reapplyConfiguredLoopBounds(x.isLooping),p=1,a.debug("TransportService",`Tempo reset to base ${F} BPM`))}const T={init(){const x=e.getState();u=dF({getMacrobeatInfo:e.getMacrobeatInfo??(()=>null),getPlacedTonicSigns:e.getPlacedTonicSigns??(()=>[]),getTonicSpanColumnIndices:e.getTonicSpanColumnIndices??(()=>new Set),logger:a}),d=pF({samples:{H:"/audio/drums/hi.mp3",M:"/audio/drums/mid.mp3",L:"/audio/drums/lo.mp3"},synthEngine:{getMainVolumeNode:()=>t.getMainVolumeNode()}}),ht.bpm.value=x.tempo;const _=()=>this.handleStateChange(),F=()=>this.handleStateChange(),Q=()=>this.handleStateChange(),U=()=>{if(u&&u.getTimeMap().length>0){const N=e.getState();u.calculate(N)}this.handleStateChange()},W=N=>{var nt,At;const q=((nt=N==null?void 0:N.oldConfig)==null?void 0:nt.columnWidths)||[],J=((At=N==null?void 0:N.newConfig)==null?void 0:At.columnWidths)||[];q.length!==J.length&&u&&u.calculate(e.getState())},D=N=>{if(a.info("TransportService",`tempoChanged triggered with new value: ${N} BPM`),ht.state==="started"){const q=ht.position;ht.pause(),l&&(cancelAnimationFrame(l),l=null),ht.bpm.value=N,u==null||u.reapplyConfiguredLoopBounds(e.getState().isLooping),v(),ht.start(void 0,q),A==="standard"&&b()}else ht.bpm.value=N,u==null||u.reapplyConfiguredLoopBounds(e.getState().isLooping),u==null||u.calculate(e.getState())},R=N=>{ht.loop=N;const q=Ce(ht.loopStart).toSeconds(),J=Ce(ht.loopEnd).toSeconds();N&&J<=q&&u&&(ht.loopEnd=q+Math.max(u.getMicrobeatDuration(e.getState().tempo),.001)),N&&u?u.setConfiguredLoopBounds(Ce(ht.loopStart).toSeconds(),Ce(ht.loopEnd).toSeconds()):u==null||u.clearConfiguredLoopBounds()};s.on("rhythmStructureChanged",_),s.on("notesChanged",F),s.on("sixteenthStampPlacementsChanged",Q),s.on("tempoModulationMarkersChanged",U),s.on("layoutConfigChanged",W),s.on("tempoChanged",D),s.on("loopingChanged",R),h.push(()=>{}),ht.on("stop",()=>{var N,q;a.info("TransportService","Tone.Transport 'stop' fired. Resetting playback state"),(N=s.setPlaybackState)==null||N.call(s,!1,!1),(q=r==null?void 0:r.clearAdsrVisuals)==null||q.call(r),l&&(cancelAnimationFrame(l),l=null)}),a.info("TransportService","Initialized")},handleStateChange(){if(ht.state==="started"){a.debug("TransportService","handleStateChange: Notes or rhythm changed during playback. Rescheduling");const _=ht.position;ht.pause(),v(),ht.start(void 0,_)}else u==null||u.calculate(e.getState())},start(){a.info("TransportService","Starting playback"),(o||(()=>gc()))().then(()=>{v();const _=e.getState();u==null||u.getTimeMap();const F=(u==null?void 0:u.getMusicalEndTime())??0,Q=(u==null?void 0:u.findNonAnacrusisStart(_))??0;u==null||u.setLoopBounds(Q,F,_.tempo),ht.bpm.value=_.tempo;const U=Pe()+.1;ht.start(U,0),A==="standard"&&b(),s.emit("playbackStarted")})},resume(){a.info("TransportService","Resuming playback"),(o||(()=>gc()))().then(()=>{ht.start(),A==="standard"&&b(),s.emit("playbackResumed")})},pause(){a.info("TransportService","Pausing playback"),ht.pause(),l&&(cancelAnimationFrame(l),l=null),s.emit("playbackPaused")},stop(){var _,F,Q;a.info("TransportService","Stopping playback and clearing visuals"),c=!1,l&&(cancelAnimationFrame(l),l=null),ht.stop(),ht.cancel(),d==null||d.reset();const x=e.getState();ht.bpm.value=x.tempo,u==null||u.reapplyConfiguredLoopBounds(x.isLooping),t.releaseAll(),(_=r==null?void 0:r.clearPlayheadCanvas)==null||_.call(r),(F=r==null?void 0:r.clearDrumPlayheadCanvas)==null||F.call(r),(Q=r==null?void 0:r.updateBeatLineHighlight)==null||Q.call(r,0,0,!1),s.emit("playbackStopped")},dispose(){this.stop(),d==null||d.dispose(),h.forEach(x=>x()),a.debug("TransportService","Disposed")}};return T}const vF={latencyHint:"playback",lookAhead:.1};function wF(n={}){const{latencyHint:t,lookAhead:e}={...vF,...n};let s=!1;if(ta.state==="suspended")try{hw(new Au({latencyHint:t})),s=!0}catch(r){console.warn("Failed to create new AudioContext, using default:",r)}return e!==void 0&&(ta.lookAhead=e),s}let BF=class{constructor(){M(this,"logLevel");M(this,"enabledLevels");M(this,"categories");this.logLevel="ERROR",this.enabledLevels={DEBUG:!1,INFO:!1,WARN:!1,ERROR:!0},this.categories={general:!1,state:!1,canvas:!1,audio:!1,ui:!1,layout:!1,harmony:!1,performance:!1,initialization:!1,transport:!1,grid:!1,toolbar:!1,zoom:!1,scroll:!1,keyboard:!1,mouse:!1,adsr:!1,filter:!1,waveform:!1,debug:!1}}enable(...t){t.forEach(e=>{Object.prototype.hasOwnProperty.call(this.categories,e)&&(this.categories[e]=!0)})}disable(...t){t.forEach(e=>{Object.prototype.hasOwnProperty.call(this.categories,e)&&(this.categories[e]=!1)})}enableAll(){Object.keys(this.categories).forEach(t=>{this.categories[t]=!0}),this.setLevel("DEBUG")}disableAll(){Object.keys(this.categories).forEach(t=>{this.categories[t]=!1}),this.setLevel("ERROR")}isCategoryEnabled(t){return this.categories[t]===!0}setLevel(t){const s=["DEBUG","INFO","WARN","ERROR"].indexOf(t);s!==-1&&(this.logLevel=t,this.enabledLevels={DEBUG:s<=0,INFO:s<=1,WARN:s<=2,ERROR:s<=3})}logWithConsole(t,e,s,r=null){if(typeof console<"u"&&console[t]){const i=r!==null?[e,s,r]:[e,s];console[t](...i)}}event(t,e,s="",r="ui"){!this.enabledLevels.INFO||this.isCategoryEnabled(r)}state(t,e,s=null,r="state"){!this.enabledLevels.INFO||this.isCategoryEnabled(r)}debug(t,e,s=null,r="debug"){!this.enabledLevels.DEBUG||!this.isCategoryEnabled(r)||this.logWithConsole("debug",t,e,s)}timing(t,e,s,r="performance"){!this.enabledLevels.DEBUG||!this.isCategoryEnabled(r)||this.logWithConsole("debug",t,e,s)}warn(t,e,s=null,r="general"){!this.enabledLevels.WARN||!this.isCategoryEnabled(r)||this.logWithConsole("warn",t,e,s)}error(t,e,s=null,r="general"){this.enabledLevels.ERROR&&this.logWithConsole("error",t,e,s)}info(t,e,s=null,r="general"){!this.enabledLevels.INFO||!this.isCategoryEnabled(r)||this.logWithConsole("info",t,e,s)}getConfig(){return{logLevel:this.logLevel,enabledLevels:{...this.enabledLevels},enabledCategories:Object.entries(this.categories).filter(([,t])=>t).map(([t])=>t)}}getAvailableCategories(){return Object.keys(this.categories)}section(t){this.enabledLevels.INFO&&this.info("Logger",`===== ${t} =====`,null,"general")}initStart(t){this.enabledLevels.INFO&&this.info(t,"init start",null,"initialization")}initSuccess(t){this.enabledLevels.INFO&&this.info(t,"init success",null,"initialization")}initFailed(t,e){if(this.enabledLevels.ERROR){const s=e?`init failed: ${e}`:"init failed";this.error(t,s,null,"initialization")}}moduleLoaded(t,e="initialization"){this.isCategoryEnabled(e)&&this.enabledLevels.INFO&&this.info(t,"loaded",null,e)}log(t,e,s=null){this.info(t,e,s,"general")}};const E=new BF;typeof window<"u"&&(window.logger=E);E.moduleLoaded("EngineStore","general");function Pm(){return{entries:[],visualToCanvas:new Map,visualToTime:new Map,canvasToVisual:new Map,canvasToTime:new Map,timeToCanvas:new Map,timeToVisual:new Map,macrobeatBoundaries:[],totalVisualColumns:0,totalCanvasColumns:0,totalTimeColumns:0,totalWidthUnmodulated:0}}const CF="studentNotationState",bF={getItem:n=>localStorage.getItem(n),setItem:(n,t)=>localStorage.setItem(n,t),removeItem:n=>localStorage.removeItem(n)},Xa=(n,t,e,s,r)=>{const i=r||"general";switch(n){case"debug":E.debug(t,e,s,i);break;case"info":E.info(t,e,s,i);break;case"warn":E.warn(t,e,s,i);break;case"error":E.error(t,e,s,i);break}};let Jn={};function yF(n){Jn=n,E.info("EngineStore","Column map callbacks registered")}const f=oF({storageKey:CF,storage:bF,onClearState:()=>{localStorage.removeItem("effectDialValues"),window.location.reload()},noteActionCallbacks:{getMacrobeatInfo:(n,t)=>{const e=n.macrobeatGroupings||[];let s=0;for(let i=0;i<t&&i<e.length;i++)s+=e[i]||2;const r=s+(e[t]||2)-1;return{startColumn:s,endColumn:r}},log:(n,t,e)=>Xa(n,"noteActions",t,e)},rhythmActionCallbacks:{getColumnMap:n=>Jn.getColumnMap?Jn.getColumnMap(n):Pm(),visualToTimeIndex:(n,t,e)=>Jn.visualToTimeIndex?Jn.visualToTimeIndex(n,t,e):t,timeIndexToVisualColumn:(n,t,e)=>Jn.timeIndexToVisualColumn?Jn.timeIndexToVisualColumn(n,t,e):t,getTimeBoundaryAfterMacrobeat:(n,t,e)=>{if(Jn.getTimeBoundaryAfterMacrobeat)return Jn.getTimeBoundaryAfterMacrobeat(n,t,e);let s=0;for(let r=0;r<=t&&r<e.length;r++)s+=e[r]||2;return s},log:Xa},sixteenthStampActionCallbacks:{log:(n,t,e)=>Xa(n,"sixteenthStampActions",t,e)},tripletStampActionCallbacks:{canvasToTime:(n,t)=>t.canvasToTime.get(n)??null,timeToCanvas:(n,t)=>t.timeToCanvas.get(n)??n,getColumnMap:n=>Jn.getColumnMap?Jn.getColumnMap(n):Pm(),log:(n,t,e)=>Xa(n,"tripletStampActions",t,e)}});function ap(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function lp(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var xw=[0,2,4,-1,1,3,5],Iw=xw.map(n=>Math.floor(n*7/12));function Fw(n){const{step:t,alt:e,oct:s,dir:r=1}=n,i=xw[t]+7*e;if(s===void 0)return[r*i];const o=s-Iw[t]-4*e;return[r*i,r*o]}var SF=[3,0,4,1,5,2,6];function Tw(n){const[t,e,s]=n,r=SF[EF(t)],i=Math.floor((t+1)/7);if(e===void 0)return{step:r,alt:i,dir:s};const o=e+4*i+Iw[r];return{step:r,alt:i,oct:o,dir:s}}function EF(n){const t=(n+1)%7;return t<0?7+t:t}var Nm=(n,t)=>Array(Math.abs(t)+1).join(n),nh=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),xF="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",IF="(AA|A|P|M|m|d|dd)([-+]?\\d+)",FF=new RegExp("^"+xF+"|"+IF+"$");function TF(n){const t=FF.exec(`${n}`);return t===null?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}var Dm={};function Yn(n){return typeof n=="string"?Dm[n]||(Dm[n]=_F(n)):lp(n)?Yn(QF(n)):ap(n)?Yn(n.name):nh}var Lm=[0,2,4,5,7,9,11],_w="PMMPPMM";function _F(n){const t=TF(n);if(t[0]==="")return nh;const e=+t[0],s=t[1],r=(Math.abs(e)-1)%7,i=_w[r];if(i==="M"&&s==="P")return nh;const o=i==="M"?"majorable":"perfectable",A=""+e+s,a=e<0?-1:1,l=e===8||e===-8?e:a*(r+1),c=MF(o,s),u=Math.floor((Math.abs(e)-1)/7),d=a*(Lm[r]+c+12*u),p=(a*(Lm[r]+c)%12+12)%12,h=Fw({step:r,alt:c,oct:u,dir:a});return{empty:!1,name:A,num:e,q:s,step:r,alt:c,dir:a,type:o,simple:l,semitones:d,chroma:p,coord:h,oct:u}}function Mw(n,t){const[e,s=0]=n,r=e*7+s*12<0,i=t||r?[-e,-s,-1]:[e,s,1];return Yn(Tw(i))}function MF(n,t){return t==="M"&&n==="majorable"||t==="P"&&n==="perfectable"?0:t==="m"&&n==="majorable"?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*(n==="perfectable"?t.length:t.length+1):0}function QF(n){const{step:t,alt:e,oct:s=0,dir:r}=n;if(!r)return"";const i=t+1+7*s,o=i===0?t+1:i,A=r<0?"-":"",a=_w[t]==="M"?"majorable":"perfectable";return A+o+UF(a,e)}function UF(n,t){return t===0?n==="majorable"?"M":"P":t===-1&&n==="majorable"?"m":t>0?Nm("A",t):Nm("d",n==="perfectable"?t:t+1)}var km=(n,t)=>Array(Math.abs(t)+1).join(n),Qw=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),Rm=new Map,PF=n=>"CDEFGAB".charAt(n),Uw=n=>n<0?km("b",-n):km("#",n),Pw=n=>n[0]==="b"?-n.length:n.length;function Se(n){const t=JSON.stringify(n),e=Rm.get(t);if(e)return e;const s=typeof n=="string"?kF(n):lp(n)?Se(RF(n)):ap(n)?Se(n.name):Qw;return Rm.set(t,s),s}var NF=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function cp(n){const t=NF.exec(n);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:["","","",""]}function DF(n){return Se(Tw(n))}var LF=(n,t)=>(n%t+t)%t,ju=[0,2,4,5,7,9,11];function kF(n){const t=cp(n);if(t[0]===""||t[3]!=="")return Qw;const e=t[0],s=t[1],r=t[2],i=(e.charCodeAt(0)+3)%7,o=Pw(s),A=r.length?+r:void 0,a=Fw({step:i,alt:o,oct:A}),l=e+s+r,c=e+s,u=(ju[i]+o+120)%12,d=A===void 0?LF(ju[i]+o,12)-1188:ju[i]+o+12*(A+1),p=d>=0&&d<=127?d:null,h=A===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:s,alt:o,chroma:u,coord:a,freq:h,height:d,letter:e,midi:p,name:l,oct:A,pc:c,step:i}}function RF(n){const{step:t,alt:e,oct:s}=n,r=PF(t);if(!r)return"";const i=r+Uw(e);return s||s===0?i+s:i}function bu(n,t){const e=Se(n),s=Array.isArray(t)?t:Yn(t).coord;if(e.empty||!s||s.length<2)return"";const r=e.coord,i=r.length===1?[r[0]+s[0]]:[r[0]+s[0],r[1]+s[1]];return DF(i).name}function bc(n,t){const e=Se(n),s=Se(t);if(e.empty||s.empty)return"";const r=e.coord,i=s.coord,o=i[0]-r[0],A=r.length===2&&i.length===2?i[1]-r[1]:-Math.floor(o*7/12),a=s.height===e.height&&s.midi!==null&&e.oct===s.oct&&e.step>s.step;return Mw([o,A],a).name}function up(n,t){const e=t.length,s=(n%e+e)%e;return t.slice(s,e).concat(t.slice(0,s))}function HF(n){return n.filter(t=>t===0||t)}var Ni={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Nw=n=>Number(n).toString(2).padStart(12,"0"),Hm=n=>parseInt(n,2),OF=/^[01]{12}$/;function Dw(n){return OF.test(n)}var VF=n=>typeof n=="number"&&n>=0&&n<=4095,WF=n=>n&&Dw(n.chroma),Om={[Ni.chroma]:Ni};function dp(n){const t=Dw(n)?n:VF(n)?Nw(n):Array.isArray(n)?XF(n):WF(n)?n.chroma:Ni.chroma;return Om[t]=Om[t]||$F(t)}var GF=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function KF(n){const t=[];for(let e=0;e<12;e++)n.charAt(e)==="1"&&t.push(GF[e]);return t}function qF(n,t=!0){const s=dp(n).chroma.split("");return HF(s.map((r,i)=>{const o=up(i,s);return t&&o[0]==="0"?null:o.join("")}))}function zF(n){const t=n.split("");return t.map((e,s)=>up(s,t).join(""))}function $F(n){const t=Hm(n),e=zF(n).map(Hm).filter(i=>i>=2048).sort()[0],s=Nw(e),r=KF(n);return{empty:!1,name:"",setNum:t,chroma:n,normalized:s,intervals:r}}function XF(n){if(n.length===0)return Ni.chroma;let t;const e=[0,0,0,0,0,0,0,0,0,0,0,0];for(let s=0;s<n.length;s++)t=Se(n[s]),t.empty&&(t=Yn(n[s])),t.empty||(e[t.chroma]=1);return e.join("")}var YF=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],jF=YF,JF={...Ni,name:"",quality:"Unknown",intervals:[],aliases:[]},hp=[],MA={};function ZF(n){return MA[n]||JF}function tT(){return hp.slice()}function eT(n,t,e){const s=sT(n),r={...dp(n),name:e||"",quality:s,intervals:n,aliases:t};hp.push(r),r.name&&(MA[r.name]=r),MA[r.setNum]=r,MA[r.chroma]=r,r.aliases.forEach(i=>nT(r,i))}function nT(n,t){MA[t]=n}function sT(n){const t=e=>n.indexOf(e)!==-1;return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}jF.forEach(([n,t,e])=>eT(n.split(" "),e.split(" "),t));hp.sort((n,t)=>n.setNum-t.setNum);var rT=n=>{const t=n.reduce((e,s)=>{const r=Se(s).chroma;return r!==void 0&&(e[r]=e[r]||Se(s).name),e},{});return e=>t[e]};function iT(n,t={}){const e=n.map(r=>Se(r).pc).filter(r=>r);return Se.length===0?[]:dT(e,1,t).filter(r=>r.weight).sort((r,i)=>i.weight-r.weight).map(r=>r.name)}var yu={anyThirds:384,perfectFifth:16,nonPerfectFifths:40,anySeventh:3},Su=n=>t=>!!(t&n),oT=Su(yu.anyThirds),AT=Su(yu.perfectFifth),aT=Su(yu.anySeventh),lT=Su(yu.nonPerfectFifths);function cT(n){const t=parseInt(n.chroma,2);return oT(t)&&AT(t)&&aT(t)}function uT(n){const t=parseInt(n,2);return lT(t)?n:(t|16).toString(2)}function dT(n,t,e){const s=n[0],r=Se(s).chroma,i=rT(n),o=qF(n,!1),A=[];return o.forEach((a,l)=>{const c=e.assumePerfectFifth&&uT(a);tT().filter(d=>e.assumePerfectFifth&&cT(d)?d.chroma===c:d.chroma===a).forEach(d=>{const p=d.aliases[0],h=i(l);l!==r?A.push({weight:.5*t,name:`${h}${p}/${s}`}):A.push({weight:1*t,name:`${h}${p}`})})}),A}var hT=Yn;function fT(n){const t=Yn(n);if(t.empty)return"";const e=(7-t.step)%7,s=t.type==="perfectable"?-t.alt:-(t.alt+1);return Yn({step:e,alt:s,oct:t.oct,dir:t.dir}).name}var Vm=bc,pT=mT((n,t)=>[n[0]-t[0],n[1]-t[1]]);function mT(n){return(t,e)=>{const s=Yn(t).coord,r=Yn(e).coord;if(s&&r){const i=n(s,r);return Mw(i).name}}}var gT=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],vT=gT,wT={...Ni,intervals:[],aliases:[]},QA={};function Lw(n){return QA[n]||wT}function BT(n,t,e=[]){const s={...dp(n),name:t,intervals:n,aliases:e};return QA[s.name]=s,QA[s.setNum]=s,QA[s.chroma]=s,s.aliases.forEach(r=>CT(s,r)),s}function CT(n,t){QA[t]=n}vT.forEach(([n,t,...e])=>BT(n.split(" "),t,e));var kw={empty:!0,name:"",symbol:"",root:"",bass:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Rw(n){const[t,e,s,r]=cp(n);return t===""?Ju("",n):t==="A"&&r==="ug"?Ju("","aug"):Ju(t+e,s+r)}function Ju(n,t){const e=t.split("/");if(e.length===1)return[n,e[0],""];const[s,r,i,o]=cp(e[1]);return s!==""&&i===""&&o===""?[n,e[0],s+r]:[n,t,""]}function bT(n){if(Array.isArray(n))return Zu(n[1]||"",n[0],n[2]);if(n==="")return kw;{const[t,e,s]=Rw(n),r=Zu(e,t,s);return r.empty?Zu(n):r}}function Zu(n,t,e){const s=ZF(n),r=Se(t||""),i=Se(e||"");if(s.empty||t&&r.empty||e&&i.empty)return kw;const o=bc(r.pc,i.pc),A=s.intervals.indexOf(o),a=A>=0,l=a?i:Se(""),c=A===-1?NaN:A+1,u=i.pc&&i.pc!==r.pc,d=Array.from(s.intervals);if(a)for(let g=1;g<c;g++){const v=d[0][0],w=d[0][1],y=parseInt(v,10)+7;d.push(`${y}${w}`),d.shift()}else if(u){const g=pT(bc(r.pc,i.pc),"8P");g&&d.unshift(g)}const p=r.empty?[]:d.map(g=>bu(r.pc,g));n=s.aliases.indexOf(n)!==-1?n:s.aliases[0];const h=`${r.empty?"":r.pc}${n}${a&&c>1?"/"+l.pc:u?"/"+i.pc:""}`,m=`${t?r.pc+" ":""}${s.name}${a&&c>1?" over "+l.pc:u?" over "+i.pc:""}`;return{...s,name:m,symbol:h,tonic:r.pc,type:s.name,root:l.pc,bass:u?i.pc:"",intervals:d,rootDegree:c,notes:p}}var yT=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],ST=yT;ST.forEach(([n,t,e])=>void 0);var ET="C C# D D# E F F# G G# A A# B".split(" "),xT="C Db D Eb E F Gb G Ab A Bb B".split(" ");function fp(n,t={}){if(isNaN(n)||n===-1/0||n===1/0)return"";n=Math.round(n);const s=(t.sharps===!0?ET:xT)[n%12];if(t.pitchClass)return s;const r=Math.floor(n/12)-1;return s+r}var ea=Se,sh=n=>ea(n).pc,td=n=>ea(n).midi;function IT(n){return fp(n)}var So=bu,UA=n=>{const t=ea(n);return t.empty?"":fp(t.midi||t.chroma,{sharps:t.alt>0,pitchClass:t.midi===null})};function PA(n,t){const e=ea(n);if(e.empty)return"";const s=ea(t||fp(e.midi||e.chroma,{sharps:e.alt<0,pitchClass:!0}));if(s.empty||s.chroma!==e.chroma)return"";if(e.oct===void 0)return s.pc;const r=e.chroma-e.alt,i=s.chroma-s.alt,o=r>11||i<0?-1:r<0||i>11?1:0,A=e.oct+o;return s.pc+A}var Hw={empty:!0,name:"",chordType:""},Wm={};function na(n){return typeof n=="string"?Wm[n]||(Wm[n]=QT(n)):typeof n=="number"?na(pp[n]||""):lp(n)?FT(n):ap(n)?na(n.name):Hw}function FT(n){return na(Uw(n.alt)+pp[n.step])}var TT=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function _T(n){return TT.exec(n)||["","","",""]}var MT="I II III IV V VI VII",pp=MT.split(" ");function QT(n){const[t,e,s,r]=_T(n);if(!s)return Hw;const i=s.toUpperCase(),o=pp.indexOf(i),A=Pw(e),a=1;return{empty:!1,name:t,roman:s,interval:Yn({step:o,alt:A,dir:a}).name,acc:e,chordType:r,alt:A,step:o,major:s===i,oct:0,dir:a}}var mp=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],Gm={...Ni,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},UT=mp.map(PT),rh={};UT.forEach(n=>{rh[n.name]=n,n.aliases.forEach(t=>{rh[t]=n})});function Ow(n){return typeof n=="string"?rh[n.toLowerCase()]||Gm:n&&n.name?Ow(n.name):Gm}function PT(n){const[t,e,s,r,i,o,A]=n,a=A?[A]:[],l=Number(e).toString(2);return{empty:!1,intervals:Lw(r).intervals,modeNum:t,chroma:l,normalized:l,name:r,setNum:e,alt:s,triad:i,seventh:o,aliases:a}}function Vw(n){return(t,e)=>{const s=Ow(t);if(s.empty)return[];const r=up(s.modeNum,n),i=s.intervals.map(o=>bu(e,o));return r.map((o,A)=>i[A]+o)}}Vw(mp.map(n=>n[4]));Vw(mp.map(n=>n[5]));function NT(n,t){return t.map(e=>{const[s,r]=Rw(e),i=bc(n,s);return na(Yn(i)).name+r})}var DT={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function LT(n){if(typeof n!="string")return["",""];const t=n.indexOf(" "),e=Se(n.substring(0,t));if(e.empty){const r=Se(n);return r.empty?["",n.toLowerCase()]:[r.name,""]}const s=n.substring(e.name.length+1).toLowerCase();return[e.name,s.length?s:""]}function kT(n){const t=Array.isArray(n)?n:LT(n),e=Se(t[0]).name,s=Lw(t[1]);if(s.empty)return DT;const r=s.name,i=e?s.intervals.map(A=>bu(e,A)):[],o=e?e+" "+r:r;return{...s,name:o,type:r,tonic:e,notes:i}}const $s=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fcfcfc",isAccidental:!1},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fcf7fc",isAccidental:!1},{pitch:"B/A7",flatName:"B7",sharpName:"A7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f7f5fd",isAccidental:!0},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f0f4ff",isAccidental:!1},{pitch:"A/G7",flatName:"A7",sharpName:"G7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#e6f3fd",isAccidental:!0},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#def3f7",isAccidental:!1},{pitch:"G/F7",flatName:"G7",sharpName:"F7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#daf2ec",isAccidental:!0},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#dcefdf",isAccidental:!1},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#e3ebd1",isAccidental:!1},{pitch:"E/D7",flatName:"E7",sharpName:"D7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#eee4c8",isAccidental:!0},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#f8dcc6",isAccidental:!1},{pitch:"D/C7",flatName:"D7",sharpName:"C7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fcd4cd",isAccidental:!0},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#facfdb",isAccidental:!1},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#efcdeb",isAccidental:!1},{pitch:"B/A6",flatName:"B6",sharpName:"A6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#ddcff9",isAccidental:!0},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#c4d3ff",isAccidental:!1},{pitch:"A/G6",flatName:"A6",sharpName:"G6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#abd9fa",isAccidental:!0},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#98dde9",isAccidental:!1},{pitch:"G/F6",flatName:"G6",sharpName:"F6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#96ddcf",isAccidental:!0},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#a6d9b0",isAccidental:!1},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#c0d093",isAccidental:!1},{pitch:"E/D6",flatName:"E6",sharpName:"D6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#dbc383",isAccidental:!0},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#efb586",isAccidental:!1},{pitch:"D/C6",flatName:"D6",sharpName:"C6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#f8a99c",isAccidental:!0},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#f3a2bb",isAccidental:!1},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e1a3db",isAccidental:!1},{pitch:"B/A5",flatName:"B5",sharpName:"A5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#c3a9f4",isAccidental:!0},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#9ab2ff",isAccidental:!1},{pitch:"A/G5",flatName:"A5",sharpName:"G5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#67bdf7",isAccidental:!0},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#30c6dc",isAccidental:!1},{pitch:"G/F5",flatName:"G5",sharpName:"F5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#32c8b2",isAccidental:!0},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#6dc281",isAccidental:!1},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#a0b556",isAccidental:!1},{pitch:"E/D5",flatName:"E5",sharpName:"D5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#c5a33f",isAccidental:!0},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#dc9150",isAccidental:!1},{pitch:"D/C5",flatName:"D5",sharpName:"C5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#e38475",isAccidental:!0},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#dc7f9d",isAccidental:!1},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#c781c0",isAccidental:!1},{pitch:"B/A4",flatName:"B4",sharpName:"A4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#a68ad8",isAccidental:!0},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#7d94e0",isAccidental:!1},{pitch:"A/G4",flatName:"A4",sharpName:"G4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#4c9fd5",isAccidental:!0},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#0fa6ba",isAccidental:!1},{pitch:"G/F4",flatName:"G4",sharpName:"F4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#24a794",isAccidental:!0},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#5aa26a",isAccidental:!1},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#849646",isAccidental:!1},{pitch:"E/D4",flatName:"E4",sharpName:"D4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#a38733",isAccidental:!0},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#b67740",isAccidental:!1},{pitch:"D/C4",flatName:"D4",sharpName:"C4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#bc6c5f",isAccidental:!0},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#b56880",isAccidental:!1},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#a3699e",isAccidental:!1},{pitch:"B/A3",flatName:"B3",sharpName:"A3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#8870b1",isAccidental:!0},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#6578b7",isAccidental:!1},{pitch:"A/G3",flatName:"A3",sharpName:"G3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#3c81ad",isAccidental:!0},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#0e8696",isAccidental:!1},{pitch:"G/F3",flatName:"G3",sharpName:"F3",toneNote:"Gb3",frequency:185,column:"A",hex:"#1b8777",isAccidental:!0},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#478255",isAccidental:!1},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#697836",isAccidental:!1},{pitch:"E/D3",flatName:"E3",sharpName:"D3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#836b27",isAccidental:!0},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#925e32",isAccidental:!1},{pitch:"D/C3",flatName:"D3",sharpName:"C3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#96554b",isAccidental:!0},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#905165",isAccidental:!1},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#80527c",isAccidental:!1},{pitch:"B/A2",flatName:"B2",sharpName:"A2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#6a578c",isAccidental:!0},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#4e5e90",isAccidental:!1},{pitch:"A/G2",flatName:"A2",sharpName:"G2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#2d6488",isAccidental:!0},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#096875",isAccidental:!1},{pitch:"G/F2",flatName:"G2",sharpName:"F2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#13685b",isAccidental:!0},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#356440",isAccidental:!1},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#505c28",isAccidental:!1},{pitch:"E/D2",flatName:"E2",sharpName:"D2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#63511c",isAccidental:!0},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#6e4724",isAccidental:!1},{pitch:"D/C2",flatName:"D2",sharpName:"C2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#713f37",isAccidental:!0},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#6c3c4b",isAccidental:!1},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#603c5d",isAccidental:!1},{pitch:"B/A1",flatName:"B1",sharpName:"A1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#4e4068",isAccidental:!0},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#38446b",isAccidental:!1},{pitch:"A/G1",flatName:"A1",sharpName:"G1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#1f4964",isAccidental:!0},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#044b55",isAccidental:!1},{pitch:"G/F1",flatName:"G1",sharpName:"F1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#0c4b41",isAccidental:!0},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#24472c",isAccidental:!1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#38401a",isAccidental:!1},{pitch:"E/D1",flatName:"E1",sharpName:"D1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#463811",isAccidental:!0},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#4d3017",isAccidental:!1},{pitch:"D/C1",flatName:"D1",sharpName:"C1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#4f2a24",isAccidental:!0},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#4a2733",isAccidental:!1},{pitch:"B0",flatName:"B0",sharpName:"B0",toneNote:"B0",frequency:30.87,column:"B",hex:"#41273f",isAccidental:!1},{pitch:"B/A0",flatName:"B0",sharpName:"A0",toneNote:"Bb0",frequency:29.14,column:"A",hex:"#342a46",isAccidental:!0},{pitch:"A0",flatName:"A0",sharpName:"A0",toneNote:"A0",frequency:27.5,column:"B",hex:"#242c48",isAccidental:!1}],RT=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"],Ye=n=>n.tonicSignGroups?Object.values(n.tonicSignGroups).flat():[],mn=(n,t)=>{const e=Ne.getColumnMap(n),{macrobeatGroupings:s}=n,r=s[t]??0;let i=null,o=null;for(const A of e.entries)A.macrobeatIndex===t&&A.type==="beat"&&((i===null||A.canvasIndex!==null&&A.canvasIndex<i)&&(i=A.canvasIndex),(o===null||A.canvasIndex!==null&&A.canvasIndex>o)&&(o=A.canvasIndex));if(i===null||o===null){let A=0;const a=Ye(n);a.some(l=>l.preMacrobeatIndex===-1)&&(A+=2);for(let l=0;l<t;l++)A+=s[l]??0,a.some(c=>c.preMacrobeatIndex===l)&&(A+=2);i=A,o=i+r-1}return{startColumn:i,endColumn:o,grouping:r}},HT=n=>n.placedNotes.filter(t=>!t.isDrum),OT=n=>n.placedNotes.filter(t=>t.isDrum),VT=(n,t)=>{const s=Ye(n).filter(l=>l.columnIndex<=t);if(s.length===0)return{keyTonic:"C",keyMode:"major"};const r=s.reduce((l,c)=>c.columnIndex>l.columnIndex?c:l),i=typeof r.globalRow=="number"?r.globalRow:r.row,o=$s[i]??n.fullRowData[r.row];if(!o)return{keyTonic:"C",keyMode:"major"};const A=sh(o.toneNote),a=RT[r.tonicNumber-1]||"major";return{keyTonic:A,keyMode:a}},Eo=12,WT=50,GT=.5,rs=3,Ya=1,NA=30,sa=30,ra=.5,Km=3,KT=.7,qT=.9,zT=4,$T=1.5,XT=.15,YT=.2,jT=1,ia=1.5,JT="#CCCCCC",Ww=1,qm=3,zm=5,ZT=7,Ol=16,t_=0,e_=255;class n_{constructor(){M(this,"cachedMap",null);M(this,"cacheKey",null)}getColumnMap(t){const e=this.buildCacheKey(t);return this.cachedMap&&this.isCacheValid(e)?this.cachedMap:(this.cachedMap=this.buildColumnMap(t),this.cacheKey=e,this.cachedMap)}invalidate(){this.cachedMap=null,this.cacheKey=null}buildCacheKey(t){const s=Ye(t).map(r=>`${r.columnIndex}:${r.preMacrobeatIndex}:${r.uuid||""}`).sort().join("|");return{macrobeatGroupings:[...t.macrobeatGroupings],tonicSignsHash:s,macrobeatBoundaryStyles:[...t.macrobeatBoundaryStyles]}}isCacheValid(t){return this.cacheKey?this.cacheKey.tonicSignsHash===t.tonicSignsHash&&JSON.stringify(this.cacheKey.macrobeatGroupings)===JSON.stringify(t.macrobeatGroupings)&&JSON.stringify(this.cacheKey.macrobeatBoundaryStyles)===JSON.stringify(t.macrobeatBoundaryStyles):!1}buildColumnMap(t){const{macrobeatGroupings:e,macrobeatBoundaryStyles:s}=t,i=[...Ye(t)].sort((B,C)=>B.preMacrobeatIndex-C.preMacrobeatIndex),o=[],A=[];let a=0,l=0,c=0,u=0,d=0;const p=B=>{var C;for(;d<i.length;){const b=i[d];if(!b||b.preMacrobeatIndex!==B)break;const S=b.uuid||"";for(let x=0;x<2;x++)o.push({visualIndex:a,canvasIndex:l,timeIndex:null,type:"tonic",widthMultiplier:Ya,xOffsetUnmodulated:u,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:x===0?S:null}),a++,l++,u+=Ya;const T=S;do d++;while(d<i.length&&(((C=i[d])==null?void 0:C.uuid)||"")===T)}};for(let B=0;B<2;B++)o.push({visualIndex:a,canvasIndex:null,timeIndex:null,type:"legend-left",widthMultiplier:rs,xOffsetUnmodulated:u,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:null}),a++,u+=rs;p(-1),e.forEach((B,C)=>{for(let S=0;S<B;S++)o.push({visualIndex:a,canvasIndex:l,timeIndex:c,type:"beat",widthMultiplier:Ya,xOffsetUnmodulated:u,macrobeatIndex:C,beatInMacrobeat:S,isMacrobeatStart:S===0,isMacrobeatEnd:S===B-1,isPlayable:!0,tonicSignUuid:null}),a++,l++,c++,u+=Ya;const b=s[C]||"dashed";A.push({macrobeatIndex:C,visualColumn:a-1,canvasColumn:l-1,timeColumn:c-1,boundaryType:b,isMeasureStart:b==="solid"}),p(C)});for(let B=0;B<2;B++)o.push({visualIndex:a,canvasIndex:null,timeIndex:null,type:"legend-right",widthMultiplier:rs,xOffsetUnmodulated:u,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:null}),a++,u+=rs;const h=new Map,m=new Map,g=new Map,v=new Map,w=new Map,y=new Map;return o.forEach(B=>{h.set(B.visualIndex,B.canvasIndex),m.set(B.visualIndex,B.timeIndex),B.canvasIndex!==null&&(g.set(B.canvasIndex,B.visualIndex),v.set(B.canvasIndex,B.timeIndex)),B.timeIndex!==null&&(B.canvasIndex!==null&&w.set(B.timeIndex,B.canvasIndex),y.set(B.timeIndex,B.visualIndex))}),{entries:o,visualToCanvas:h,visualToTime:m,canvasToVisual:g,canvasToTime:v,timeToCanvas:w,timeToVisual:y,macrobeatBoundaries:A,totalVisualColumns:a,totalCanvasColumns:l,totalTimeColumns:c,totalWidthUnmodulated:u}}}const Ne=new n_;function s_(n){n.on("rhythmStructureChanged",()=>{Ne.invalidate()})}function r_(n,t){return Ne.getColumnMap(t).visualToTime.get(n)??null}function $r(n,t){return Ne.getColumnMap(t).canvasToTime.get(n)??null}function Cn(n,t){const s=Ne.getColumnMap(t).timeToCanvas.get(n);return s!==void 0?s:n}function i_(n,t){const s=Ne.getColumnMap(t).timeToVisual.get(n);return s!==void 0?s:n+2}function o_(n,t){const e=Ne.getColumnMap(t),s=e.canvasToVisual.get(n);return s!==void 0&&e.entries[s]||null}function A_(n,t){const e=o_(n,t);return(e==null?void 0:e.isPlayable)??!1}function a_(n){const t=Ne.getColumnMap(n),e=[];for(const s of t.entries)s.canvasIndex!==null&&(e[s.canvasIndex]=s.widthMultiplier);return e}function ih(n,...t){}const Fn={COMPRESSION_2_3:2/3,EXPANSION_3_2:3/2};function l_(n,t){if(!t||!t.macrobeatGroupings)return n*4;if(n===0)return 0;const e=n-1,s=mn(t,e);if(s){const i=s.endColumn+1;return ih("log","[MODULATION] Found measure info, canvas-space endColumn:",s.endColumn,"first column after:",i),i}return n*4}function Gw(n){return Math.abs(n-Fn.COMPRESSION_2_3)<.001?"2:3":Math.abs(n-Fn.EXPANSION_3_2)<.001?"3:2":`${n}`}function Kw(n){const t="#ffc107";return Math.abs(n-Fn.COMPRESSION_2_3)<.001||Math.abs(n-Fn.EXPANSION_3_2)<.001,t}function $m(){const n=[{startColumn:0,endColumn:1/0,scale:1}];return{segments:n,getScaleForColumn(t){return 1},microbeatToCanvasX(){return 0},canvasXToMicrobeat(){return 0},getSegmentAtX(){return n[0]||null},getGhostGridPositions(){return[]}}}function c_(n,t,e=null){if(!n||n.length===0)return $m();const s=[...n.filter(l=>l.active)].sort((l,c)=>l.measureIndex-c.measureIndex);if(s.length===0)return $m();const r=s.map(l=>{const c=l_(l.measureIndex,e);return ih("log",`[MODULATION] Marker at measure ${l.measureIndex} calculated column=${c}`),ih("log","[MODULATION] Final marker position:",{id:l.id,measureIndex:l.measureIndex,columnIndex:c}),{...l,columnIndex:c}}),i=[];let o=1;const A=r[0];if(r.length===0||A&&A.columnIndex>0){const l=A?A.columnIndex:1/0;i.push({startColumn:0,endColumn:l,scale:1})}for(let l=0;l<r.length;l++){const c=r[l],u=r[l+1],d=u?u.columnIndex:1/0;o*=c.ratio,i.push({startColumn:c.columnIndex,endColumn:d,scale:o,marker:c})}return{segments:i,getScaleForColumn(l){for(const c of i)if(l>=c.startColumn&&l<c.endColumn)return c.scale;return 1},microbeatToCanvasX(l){return 0},canvasXToMicrobeat(l){return 0},getSegmentAtX(l){return i[0]||null},getGhostGridPositions(l,c){return[]}}}class u_{constructor(){M(this,"cachedPixelMap",null);M(this,"lastPixelMapHash",null)}getColumnPixelPosition(t,e,s){const r=this.getOrBuildPixelMap(e,s),i=r.columnPositions.get(Math.floor(t));if(i)return i;const o=r.columnPositions.size;return t===o&&r.columnPositions.get(o-1)?{canvasIndex:t,xStart:r.totalPixelWidth,xEnd:r.totalPixelWidth,width:0,modulationScale:1}:this.calculateFallbackPosition(t,e)}columnToPixelX(t,e,s){const r=Math.floor(t),i=t-r,o=this.getColumnPixelPosition(r,e,s);return o.xStart+i*o.width}pixelXToColumn(t,e,s){const r=this.getOrBuildPixelMap(e,s),i=Array.from(r.columnPositions.values()).sort((a,l)=>a.canvasIndex-l.canvasIndex);for(const a of i)if(t>=a.xStart&&t<a.xEnd){const l=(t-a.xStart)/a.width;return a.canvasIndex+l}if(i.length===0)return 0;const o=i[0];if(!o||t<o.xStart)return 0;const A=i[i.length-1];return(A==null?void 0:A.canvasIndex)??0}invalidate(){this.cachedPixelMap=null,this.lastPixelMapHash=null}getOrBuildPixelMap(t,e){const s=this.buildPixelMapHash(t,e);return this.cachedPixelMap&&this.lastPixelMapHash===s?this.cachedPixelMap:(this.cachedPixelMap=this.buildPixelMap(t,e),this.lastPixelMapHash=s,this.cachedPixelMap)}buildPixelMapHash(t,e){const s=t.tempoModulationMarkers?JSON.stringify(t.tempoModulationMarkers.map(r=>({id:r.id,col:r.columnIndex,ratio:r.ratio}))):"none";return JSON.stringify({cellWidth:t.cellWidth,modulation:s,columnCount:e?Ne.getColumnMap(e).totalCanvasColumns:0})}buildPixelMap(t,e){const{cellWidth:s,tempoModulationMarkers:r}=t,i=Ne.getColumnMap(e),o=new Map,A=t.baseMicrobeatPx??s,a=r&&r.length>0?c_(r,A,e):null;let l=0;for(const c of i.entries){if(c.canvasIndex===null)continue;const u=c.widthMultiplier*s,d=a?a.getScaleForColumn(c.canvasIndex):1,p=u*d;o.set(c.canvasIndex,{canvasIndex:c.canvasIndex,xStart:l,xEnd:l+p,width:p,modulationScale:d}),l+=p}return{columnPositions:o,totalPixelWidth:l}}calculateFallbackPosition(t,e){const{cellWidth:s}=e,r=s;return{canvasIndex:t,xStart:t*r,xEnd:(t+1)*r,width:r,modulationScale:1}}}const Zr=new u_;function d_(n){n.on("rhythmStructureChanged",()=>{Zr.invalidate()})}function h_(n,t){const e=t.state||t;return Zr.columnToPixelX(n,t,e)}function qw(n){const t=n.state||n;return Zr.getOrBuildPixelMap(n,t).totalPixelWidth}function f_(n){return a_(n)}function p_(n,t){return n.reduce((e,s)=>e+s,0)*t}const oe=9,m_=2,g_=5;function on(n,t,e){return Number.isFinite(n)?Math.max(t,Math.min(e,Math.round(n))):t}function v_(n){return Number.isFinite(n)?Math.max(1,n):1}function Xm(n,t,{maxStep:e=g_}={}){const s=Math.max(1,Math.round(t)),i=Math.max(1,Math.round(n))/s;let o=1;i>=.85?o=5:i>=.65?o=4:i>=.45?o=3:i>=.25?o=2:o=1;const A=Math.max(1,Math.round(e));return Math.max(1,Math.min(A,o))}function zw(n,t,e){const s=Math.max(0,e-1),r=Math.max(1,Math.round(t)),i=(r-1)/2;let o=Math.round(n-i),A=o+r-1;if(o<0&&(A+=-o,o=0),A>s){const a=A-s;o-=a,A=s}return o=on(o,0,s),A=on(A,o,s),{topIndex:o,bottomIndex:A}}function is(n){return n.bottomIndex-n.topIndex+1}function $w(n,t){const e=Math.max(0,t-1),s=on(n.topIndex??0,0,e),r=on(n.bottomIndex??e,0,e);return r<s?{topIndex:r,bottomIndex:s}:{topIndex:s,bottomIndex:r}}function Kn(n,t,e=oe){const s=$w(n,t),r=Math.max(1,Math.round(e));if(is(s)>=r)return s;const o=(s.topIndex+s.bottomIndex)/2;return zw(o,r,t)}function w_(n,t,e,s=oe){const r=Math.max(0,e-1),i=on(n.bottomIndex,0,r),o=Math.max(1,Math.round(s)),A=Math.max(0,i-(o-1));return{topIndex:on(t,0,A),bottomIndex:i}}function B_(n,t,e,s=oe){const r=Math.max(0,e-1),i=on(n.topIndex,0,r),o=Math.max(1,Math.round(s)),A=Math.min(r,i+(o-1)),a=on(t,A,r);return{topIndex:i,bottomIndex:a}}function C_(n,t,e,s=oe){const r=Math.max(0,e-1),i=on(n,0,r),o=Math.max(1,Math.round(s)),A=Math.max(0,i-(o-1));return on(t,0,A)}function b_(n,t,e,s=oe){const r=Math.max(0,e-1),i=on(n,0,r),o=Math.max(1,Math.round(s)),A=Math.min(r,i+(o-1));return on(t,A,r)}function y_(n,t,e){const s=Math.max(0,e-1),r=Math.max(1,is(n)),i=Math.max(0,s+1-r),o=on(n.topIndex+t,0,i),A=Math.min(s,o+r-1);return{topIndex:o,bottomIndex:A}}function Ym(n,t,{totalRanks:e,minSpan:s=oe,zoomStep:r=m_}){const i=Math.max(0,e-1),o=Math.max(1,Math.round(s)),A=Math.max(0,Math.round(r)),a=$w(n,e);if(A===0)return Kn(a,e,o);const l=is(a);if(t==="in"){if(l<=o)return Kn(a,e,o);const h=Math.max(o,l-2*A),m=(a.topIndex+a.bottomIndex)/2;return zw(m,h,e)}const c=a.topIndex-A,u=a.bottomIndex+A,d=on(c,0,i),p=on(u,0,i);return Kn({topIndex:d,bottomIndex:p},e,o)}function S_(n,t,{baseUnit:e,paddingRows:s=1}){if(!n||n<=0||!t||t<=0)return 1;const r=Math.max(1,Math.round(t)+Math.max(0,Math.round(s))),i=v_(e);return 2*n/(r*i)}let uo=1,xo=0,Ai,Es,oh,js,Js,qs,fA,Ah,Xw,Yw,jw,Jw,Zn,di,ah,ed=null,Vl=!1,DA=!1,nd=!1,sd=!1,lh=!1,jm=0,ja=null,Io=null,ch=0,Wl=null,rd=!1,Ja=0;const E_=new Promise(n=>{Wl=()=>n()});let id=0,od=0;function Zw(){const n=document.getElementById("pitch-grid-container"),t=xo||window.innerHeight||0;return(n==null?void 0:n.clientHeight)||(t?t*.7:0)}function Jm(n,t){return S_(n,t,{baseUnit:NA,paddingRows:1})}function Fo(){const n=f.state.fullRowData.length,t=Math.max(0,n-1),e=f.state.pitchRange||{topIndex:0,bottomIndex:t};return Kn(e,n,oe)}function Gl(){Io!==null&&(cancelAnimationFrame(Io),Io=null),ch+=1,DA=!1}function Za(n,t){const e=f.state.fullRowData.length,s=Fo(),r=Kn(n,e,oe);if(r.topIndex===s.topIndex&&r.bottomIndex===s.bottomIndex)return;const i=s.topIndex,o=is(s);f.setPitchRange(r),f.emit("scrollChanged");const A=r.topIndex-i;if(A!==0&&f.emit("scrollByUnits",A),is(r)!==o){Ss(),f.emit("zoomChanged");return}document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:t}}))}function tl(n,t,e){Gl(),DA=!0;const s=f.state.fullRowData.length,r=Fo(),i=Kn(n,s,oe);if(i.topIndex===r.topIndex&&i.bottomIndex===r.bottomIndex){DA=!1;return}const o=ch,A=performance.now(),a=Math.max(0,Math.round(t));let l=r.topIndex;const c=d=>d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,u=()=>{if(o!==ch)return;const d=performance.now(),p=a>0?(d-A)/a:1,h=Math.max(0,Math.min(1,p)),m=c(h),g=Math.round(r.topIndex+(i.topIndex-r.topIndex)*m),v=Math.round(r.bottomIndex+(i.bottomIndex-r.bottomIndex)*m),w=Kn({topIndex:g,bottomIndex:v},s,oe);f.setPitchRange(w),f.emit("scrollChanged");const y=w.topIndex-l;if(y!==0&&(f.emit("scrollByUnits",y),l=w.topIndex),Ss(),f.emit("zoomChanged"),h<1){Io=requestAnimationFrame(u);return}Io=null,DA=!1};Io=requestAnimationFrame(u)}function x_(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let I_=!1;function tB(n,t){var e;if(x_())try{const s=((e=performance==null?void 0:performance.now)==null?void 0:e.call(performance))??Date.now();if(s-jm<500)return;jm=s,I_=!0}catch{}}function F_(){const n=(window==null?void 0:window.devicePixelRatio)??1;return!Number.isFinite(n)||n<=0?1:n}function ri(n,t,e,s,r){if(!n)return!1;const i=Number.isFinite(s)&&s>0?s:1;n.dataset.pixelRatio=`${i}`;let o=!1;if(typeof t=="number"){const A=Math.max(1,Math.round(t*i));Math.abs(n.width-A)>.5&&(n.width=A,o=!0),n.style.width=`${t}px`,n.dataset.logicalWidth=`${t}`}if(typeof e=="number"){const A=Math.max(1,Math.round(e*i));Math.abs(n.height-A)>.5&&(n.height=A,o=!0),n.style.height=`${e}px`,n.dataset.logicalHeight=`${e}`}if(o){const A=r||n.getContext("2d");A&&A.setTransform(i,0,0,i,0,0)}return o}function T_(){Ai=document.getElementById("pitch-grid-wrapper"),Es=document.getElementById("notation-grid"),js=document.getElementById("legend-left-canvas"),Js=document.getElementById("legend-right-canvas"),qs=document.getElementById("drum-grid-wrapper"),fA=document.getElementById("drum-grid"),Xw=document.getElementById("drum-playhead-canvas"),Yw=document.getElementById("playhead-canvas"),jw=document.getElementById("hover-canvas"),Jw=document.getElementById("drum-hover-canvas"),Zn=document.getElementById("button-grid"),di=document.getElementById("grid-scrollbar-proxy"),ah=(di==null?void 0:di.querySelector(".grid-scrollbar-inner"))||null;const n=document.getElementById("canvas-container");if(!Ai||!Es||!n)return{};oh=Es.getContext("2d"),Ah=(fA==null?void 0:fA.getContext("2d"))||null;const t=(js==null?void 0:js.getContext("2d"))||null,e=(Js==null?void 0:Js.getContext("2d"))||null;return{ctx:oh,drumCtx:Ah,legendLeftCtx:t,legendRightCtx:e,canvasContainer:n}}function __(){var e;if(lh)return;const n=(((e=f.state.columnWidths)==null?void 0:e.length)||0)>0,t=!!(f.state.cellWidth&&f.state.cellWidth>0);!n||!t||(lh=!0,Wl==null||Wl())}function Ss(){var V,H;if(!Ai||Ai.clientHeight===0){nd||(E.warn("LayoutService","Pitch grid wrapper not ready for layout (height=0). Retrying on next frame.",null,"layout"),nd=!0),requestAnimationFrame(Ss);return}if(nd=!1,Vl)return;Vl=!0;const n=document.getElementById("pitch-grid-container");Ai.clientWidth;const t=window.innerHeight;(Math.abs(t-xo)>3||xo===0)&&(xo=t);const s=NA,r=s*GT,i=Fo(),o=Zw(),A=Math.max(1,is(i));uo=Jm(o,A);const a=Math.round(s*uo),l=Math.round(r*uo);f.setLayoutConfig({cellHeight:a,cellWidth:l});const c=f_(f.state);f.setLayoutConfig({columnWidths:c}),__(),(!f.state.cellWidth||!c.length)&&E.warn("LayoutService","Unexpected layout configuration",{cellWidth:f.state.cellWidth,columnCount:c.length},"layout");const d=c.reduce((G,Y)=>G+Y,0)*f.state.cellWidth,p=fe.getModulatedCanvasWidth(),h=f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0,m=h?p:d,g=rs*2*f.state.cellWidth,v=rs*2*f.state.cellWidth,w=Math.round(m+g+v),y=F_();document.getElementById("drum-grid-wrapper");const I=document.getElementById("grids-wrapper"),B=w+"px";if(n&&(n.style.width=B),Ai&&(Ai.style.width=B),qs&&(qs.style.width=B),ah&&di){ah.style.width=B;const G=(I==null?void 0:I.getBoundingClientRect().width)||0;w>G?di.style.display="":di.style.display="none"}const C=Math.max(sa,ra*f.state.cellHeight),b=Km*C,S=`${b}px`,T=((V=f.state.columnWidths)==null?void 0:V.length)??0;let x=0;if(h){const G={cellWidth:f.state.cellWidth,columnWidths:f.state.columnWidths,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth,cellHeight:f.state.cellHeight,state:f.state};x=qw(G)}else for(let G=0;G<T;G++)x+=(f.state.columnWidths[G]||0)*f.state.cellWidth;if(T===0&&E.warn("LayoutService","Column widths array is empty.",{columnWidthsCount:T,columnWidths:f.state.columnWidths},"layout"),x<50&&T>0&&E.warn("LayoutService","Computed button-grid middle cell width is unexpectedly small.",{middleCellWidth:x,columnWidthsSample:(H=f.state.columnWidths)==null?void 0:H.slice(0,10),cellWidth:f.state.cellWidth,macrobeatGroupings:f.state.macrobeatGroupings},"layout"),Zn){const G=Zn.querySelector(".button-grid-left-cell"),Y=Zn.querySelector(".button-grid-middle-cell"),P=Zn.querySelector(".button-grid-right-cell"),st=rs*2*f.state.cellWidth,L=rs*2*f.state.cellWidth;(Math.abs(od-b)>5||od===0)&&(Zn.style.height=S,od=b);const X=(z,$)=>{if(!z)return;const rt=`${Math.max(0,$)}px`;z.style.width=rt,z.style.flex=`0 0 ${rt}`,z.style.maxWidth=rt,z.style.minWidth=rt,z.style.height=S};if(G){X(G,st);const z=G.getBoundingClientRect();st>0&&z.width===0&&E.warn("LayoutService","Left button-grid cell measured width is 0 after assignment.",{assignedWidth:st,measuredWidth:z.width,computedDisplay:window.getComputedStyle(G).display},"layout")}if(Y){x===0&&E.warn("LayoutService","Calculated middle button-grid width is 0. Check column width data.",{columnWidths:f.state.columnWidths,cellWidth:f.state.cellWidth},"layout"),X(Y,x);const z=Y.getBoundingClientRect();if(x>0&&z.width===0&&E.warn("LayoutService","Middle button-grid cell assigned width but still measures 0.",{assignedWidth:x,measuredWidth:z.width,computedStyles:window.getComputedStyle(Y)},"layout"),Math.abs(z.width-x)>5&&(E.warn("LayoutService","Middle cell measured width does not match assigned width.",{assignedWidth:x,measuredWidth:z.width,styleWidth:Y.style.width,cellWidth:f.state.cellWidth},"layout"),requestAnimationFrame(()=>{const $=Y.getBoundingClientRect();Math.abs($.width-x)>5&&E.warn("LayoutService","Middle cell still mismatched after RAF.",{assignedWidth:x,measuredWidth:$.width,delta:$.width-x,computedStyles:window.getComputedStyle(Y)},"layout")})),!sd){const $=Y.querySelector("#beat-line-button-layer");if($){const rt=$.getBoundingClientRect();if(rt.width===0){const et=window.getComputedStyle($);E.warn("LayoutService","#beat-line-button-layer width is 0 despite middle cell sizing.",{beatLineRect:rt,beatLineStyles:{display:et.display,position:et.position,flex:{direction:et.flexDirection,grow:et.flexGrow,shrink:et.flexShrink,basis:et.flexBasis},width:et.width,minWidth:et.minWidth,maxWidth:et.maxWidth},middleRect:z,middleCellComputedWidth:et.width},"layout"),sd=!0}}else E.warn("LayoutService","Could not find #beat-line-button-layer inside middle cell to measure.",null,"layout"),sd=!0}}if(P){X(P,L);const z=P.getBoundingClientRect();L>0&&z.width===0&&E.warn("LayoutService","Right button-grid cell measured width is 0 after assignment.",{assignedWidth:L,measuredWidth:z.width,computedDisplay:window.getComputedStyle(P).display},"layout")}const tt=st+x+L;Number.isFinite(tt)&&tt>0&&(Zn.style.width=B,Zn.style.maxWidth=B,Zn.style.minWidth=B),Zn.getBoundingClientRect().width===0&&E.warn("LayoutService","Entire button grid wrapper width is 0 after layout pass.",{leftCellWidth:st,middleCellWidth:x,rightCellWidth:L,wrapperStyles:window.getComputedStyle(Zn)},"layout")}const _=Math.max(sa,ra*f.state.cellHeight),F=Km*_,Q=`${F}px`,U=(n==null?void 0:n.clientHeight)||0;if(U>0){const G=f.state.cellHeight,Y=f.state.cellWidth,P=Math.max(1,is(i)),st=Jm(U,P),L=Math.round(s*st),K=Math.round(r*st);f.setLayoutConfig({cellHeight:L,cellWidth:K}),uo=st,(L!==G||K!==Y)&&(rd=!0)}const W=Math.round(rs*2*f.state.cellWidth),D=Math.round(rs*2*f.state.cellWidth),R=Math.round(m),N=[{element:Es,context:oh},{element:Yw},{element:jw}];if(N.forEach(({element:G,context:Y})=>{ri(G,R,U,y,Y),G&&(G.style.left=`${W}px`)}),ri(js,W,U,y,null),ri(Js,D,U,y,null),[{element:fA,context:Ah},{element:Xw},{element:Jw}].forEach(({element:G,context:Y})=>{ri(G,R,F,y,Y)}),qs){const G=qs.querySelector(".drum-grid-left-cell"),Y=qs.querySelector(".drum-grid-middle-cell"),P=qs.querySelector(".drum-grid-right-cell"),st=(K,O)=>{if(!K)return;const X=`${Math.max(0,Math.round(O))}px`;K.style.width=X,K.style.flex=`0 0 ${X}`,K.style.maxWidth=X,K.style.minWidth=X,K.style.height=Q};st(G,W),st(Y,R),st(P,D);const L=Y==null?void 0:Y.querySelector("#drum-canvas-wrapper");L&&(L.style.width="100%",L.style.height=Q)}const nt=Math.abs(id-F)>5||id===0;qs&&nt&&(qs.style.height=Q,id=F);const At=y,ot=R;ja&&clearTimeout(ja),ja=setTimeout(()=>{var P,st,L;ja=null;const G=document.getElementById("pitch-grid-container"),Y=(G==null?void 0:G.clientHeight)||0;N.forEach(({element:K,context:O})=>{ri(K,ot,Y,At,O),K&&(K.style.left=`${W}px`)}),ri(js,W,Y,At,null),ri(Js,D,Y,At,null),tB("deferredResize",{finalContainerHeight:Y,pitchCanvasLogicalHeight:(P=Es==null?void 0:Es.dataset)==null?void 0:P.logicalHeight,legendLeftLogicalHeight:(st=js==null?void 0:js.dataset)==null?void 0:st.logicalHeight,legendRightLogicalHeight:(L=Js==null?void 0:Js.dataset)==null?void 0:L.logicalHeight}),document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:"layoutService-deferred"}}))});try{const G=f.state.fullRowData.length,Y=Math.max(0,G-1),P=f.state.pitchRange||{topIndex:0,bottomIndex:Y},st=Kn(P,G,oe);(P.topIndex!==st.topIndex||P.bottomIndex!==st.bottomIndex)&&f.setPitchRange(st)}catch{}f.emit("layoutConfigChanged"),Vl=!1,rd?(rd=!1,Ja<1?(Ja+=1,requestAnimationFrame(Ss)):E.warn("LayoutService","Skipped additional layout pass after repeated final zoom adjustments.",{finalRecalcAttempts:Ja},"layout")):Ja=0}const fe={init(){const{ctx:n,drumCtx:t,legendLeftCtx:e,legendRightCtx:s}=T_();requestAnimationFrame(Ss),this.initScrollHandler();const r=()=>{Vl||(ed!==null&&clearTimeout(ed),ed=setTimeout(()=>{Ss()},WT))};return window.addEventListener("resize",r),f.on("zoomIn",i=>{this.zoomIn(i)}),f.on("zoomOut",i=>{this.zoomOut(i)}),{ctx:n,drumCtx:t,legendLeftCtx:e,legendRightCtx:s}},waitForInitialLayout(){return lh?Promise.resolve():E_},getCurrentZoomLevel(){return uo},setZoomLevel(n){const t=Number.isFinite(n)&&n>0?n:1,e=Zw(),s=f.state.fullRowData.length,r=Math.max(0,s-1);if(!s||s<=0)return;const i=2*e/(t*NA),o=Math.max(oe,Math.min(s,Math.round(i)-1)),A=Fo(),a=(A.topIndex+A.bottomIndex)/2,l=(o-1)/2;let c=Math.round(a-l),u=c+o-1;if(c<0&&(u+=-c,c=0),u>r){const d=u-r;c-=d,u=r}Za({topIndex:c,bottomIndex:u},"setZoomLevel")},setPitchViewportRange(n,t={}){const e=t.source??"setPitchViewportRange",s=Math.max(0,Math.round(t.animateMs??0));if(s>0){tl(n,s);return}Za(n,e)},_canScrollRange(n){const t=f.state.pitchRange;if(!t||!$s||$s.length===0)return!1;const e=$s.length-1,s=typeof n=="string"?n==="up"?-1:1:n,r=s<0&&t.topIndex>0,i=s>0&&t.bottomIndex<e;return r||i},initScrollHandler(){const n=document.getElementById("pitch-grid-wrapper");n&&n.addEventListener("wheel",t=>{if(t.preventDefault(),t.ctrlKey||t.metaKey)t.deltaY<0?this.zoomIn({source:"wheel"}):this.zoomOut({source:"wheel"});else{const e=t.deltaY>0?1:-1;this._canScrollRange(e)&&this.scrollByUnits(e)}},{passive:!1})},zoomIn(n){const t=f.state.fullRowData.length;if(!t)return;const e=Fo(),s=is(e),r=Xm(s,t),i=Ym(e,"in",{totalRanks:t,minSpan:oe,zoomStep:r}),o=is(i),A=(n==null?void 0:n.source)??"unknown",a=A==="wheel"?0:280;E.debug("LayoutService",`[Zoom] Range zoom in (span ${s} -> ${o})`,{source:A},"layout"),a>0?tl(i,a):(Za(i,`zoomIn:${A}`),f.emit("zoomChanged"))},zoomOut(n){const t=f.state.fullRowData.length;if(!t)return;const e=Fo(),s=is(e),r=Xm(s,t),i=Ym(e,"out",{totalRanks:t,minSpan:oe,zoomStep:r}),o=is(i),A=(n==null?void 0:n.source)??"unknown",a=A==="wheel"?0:280;E.debug("LayoutService",`[Zoom] Range zoom out (span ${s} -> ${o})`,{source:A},"layout"),a>0?tl(i,a):(Za(i,`zoomOut:${A}`),f.emit("zoomChanged"))},resetZoom(n){const t=f.state.fullRowData.length;if(!t)return;const e=Math.max(0,t-1);n==null||n.source,tl({topIndex:0,bottomIndex:e},320)},scroll(n){const e=this.getViewportInfo().startRank;f.emit("scrollChanged");const i=this.getViewportInfo().startRank-e;i!==0&&f.emit("scrollByUnits",i),f.emit("layoutConfigChanged")},scrollByUnits(n){Gl();const t=f.state.pitchRange;if(!t||!$s||$s.length===0)return;const e=Math.sign(n||0);if(e===0)return;const s=$s.length,r=Kn(t,s,oe),i=y_(r,e,s);i.topIndex===r.topIndex&&i.bottomIndex===r.bottomIndex||(f.setPitchRange(i),f.emit("scrollChanged"),f.emit("scrollByUnits",e),document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:"viewportScroll"}})))},setViewportTopIndex(n){Gl();const t=f.state.pitchRange||{topIndex:0,bottomIndex:Math.max(0,f.state.fullRowData.length-1)},e=f.state.fullRowData.length,s=Kn(t,e,oe),r=w_(s,n,e,oe),i=r.topIndex-(s.topIndex??0);r.topIndex===s.topIndex&&r.bottomIndex===s.bottomIndex||(f.setPitchRange(r),f.emit("scrollChanged"),i!==0&&f.emit("scrollByUnits",i),Ss(),f.emit("zoomChanged"))},setViewportBottomIndex(n){Gl();const t=f.state.pitchRange||{topIndex:0,bottomIndex:Math.max(0,f.state.fullRowData.length-1)},e=f.state.fullRowData.length,s=Kn(t,e,oe),r=B_(s,n,e,oe),i=r.topIndex-(s.topIndex??0);E.debug("LayoutService","setViewportBottomIndex",{requestedBottom:n,currentRange:t,normalized:s,nextRange:r,willUpdate:!(r.topIndex===s.topIndex&&r.bottomIndex===s.bottomIndex)},"layout"),!(r.topIndex===s.topIndex&&r.bottomIndex===s.bottomIndex)&&(f.setPitchRange(r),f.emit("scrollChanged"),i!==0&&f.emit("scrollByUnits",i),Ss(),f.emit("zoomChanged"))},scrollByPixels(n,t=0){const s=this.getViewportInfo().startRank;f.state.fullRowData.length,f.state.cellHeight,f.emit("scrollChanged");const o=this.getViewportInfo().startRank-s;o!==0&&f.emit("scrollByUnits",o),f.emit("layoutConfigChanged")},getViewportInfo(){var I,B,C,b,S,T;const n=f.state.fullRowData.length,t=Math.max(0,n-1),e=document.getElementById("pitch-grid-container"),s=(e==null?void 0:e.clientHeight)||xo*.7,r=f.state.cellHeight||NA,i=r/2,o=Kn(f.state.pitchRange||{topIndex:0,bottomIndex:t},n,oe),A=Math.max(0,Math.min(t,o.topIndex??0)),a=Math.max(A,Math.min(t,o.bottomIndex??t)),l=Math.min(n,a+1),c=A*i,u=document.getElementById("legend-left-canvas"),d=document.getElementById("legend-right-canvas"),p=i?s/i:0,h=Math.max(1,a-A+1),m=h*i,g=f.state.fullRowData[A],v=f.state.fullRowData[a],w=A<=0,y=a>=t;return tB("getViewportInfo",{containerHeight:s,containerRectHeight:(I=e==null?void 0:e.getBoundingClientRect)==null?void 0:I.call(e).height,cellHeight:r,halfUnit:i,ratio:p,rowCount:h,coveragePx:m,coverageGapPx:s-m,totalRanks:n,pitchRange:o,startRank:A,endRank:l,atTopGamutEdge:w,atBottomGamutEdge:y,scrollOffset:c,startRowSummary:g?{pitch:g.pitch,column:g.column,isBoundary:!!g.isBoundary}:null,endRowSummary:v?{pitch:v.pitch,column:v.column,isBoundary:!!v.isBoundary}:null,pitchCanvasLogicalHeight:(B=Es==null?void 0:Es.dataset)==null?void 0:B.logicalHeight,legendLeftLogicalHeight:(C=u==null?void 0:u.dataset)==null?void 0:C.logicalHeight,legendRightLogicalHeight:(b=d==null?void 0:d.dataset)==null?void 0:b.logicalHeight,legendLeftCssHeight:(S=u==null?void 0:u.getBoundingClientRect)==null?void 0:S.call(u).height,legendRightCssHeight:(T=d==null?void 0:d.getBoundingClientRect)==null?void 0:T.call(d).height}),{zoomLevel:uo,viewportHeight:xo,containerHeight:s,cellHeight:r,halfUnit:i,startRank:A,endRank:l,scrollOffset:c}},getMacrobeatWidthPx(n,t){return t*n.cellWidth},getColumnX(n){const t=f.state.cellWidth||40,e=f.state.columnWidths||[];return h_(n,{cellWidth:t,columnWidths:e,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:t,state:f.state})},getCanvasWidth(){return p_(f.state.columnWidths,f.state.cellWidth)},getModulatedCanvasWidth(){const n=this.getCanvasWidth();if(!f.state.tempoModulationMarkers||f.state.tempoModulationMarkers.length===0)return n;try{const t=f.state.cellWidth||40,e=f.state.columnWidths||[],s={cellWidth:t,columnWidths:e,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:t,cellHeight:f.state.cellHeight||40,state:f.state};return qw(s)}catch{return n}},recalculateLayout(){Ss()},reflow(){Ss()},get isZooming(){return DA}};let Ad=null,ad=null,ld=null,cd=null;const oa={setContexts({ctx:n,drumCtx:t,legendLeftCtx:e,legendRightCtx:s}){Ad=n??null,ad=t??null,ld=e??null,cd=s??null},getPitchContext(){return Ad||E.error("CanvasContextService","Pitch context requested before it was set.",null,"canvas"),Ad},getDrumContext(){return ad||E.error("CanvasContextService","Drum context requested before it was set.",null,"canvas"),ad},getLegendLeftContext(){return ld||E.error("CanvasContextService","Legend left context requested before it was set.",null,"canvas"),ld},getLegendRightContext(){return cd||E.error("CanvasContextService","Legend right context requested before it was set.",null,"canvas"),cd}},qe={getViewportInfo:()=>fe.getViewportInfo(),setViewportTopIndex(n){var t;(t=fe.setViewportTopIndex)==null||t.call(fe,n)},setViewportBottomIndex(n){var t;(t=fe.setViewportBottomIndex)==null||t.call(fe,n)},setPitchViewportRange(n,t={}){var e;(e=fe.setPitchViewportRange)==null||e.call(fe,n,t)}};let To=null,_o=null;f.on("tempoModulationMarkersChanged",()=>{});f.on("scrollChanged",()=>{To=null,_o=null});f.on("zoomChanged",()=>{To=null,_o=null});f.on("pitchRangeChanged",()=>{To=null,_o=null});function gp(){const n=performance.now();return(!To||!_o||n-_o>1)&&(To=qe.getViewportInfo(),_o=n),To}function lt(n,t){const e=f.state,s={cellWidth:t.cellWidth,tempoModulationMarkers:t.tempoModulationMarkers,baseMicrobeatPx:t.baseMicrobeatPx,columnWidths:t.columnWidths,state:e};return Zr.columnToPixelX(n,s,e)}function xt(n,t){const e=gp(),s=n-e.startRank,r=t.cellHeight/2;return(s+1)*r}function M_(n){let t=(n||"").replace(/\d/g,"").trim();return t=t.replace(/b/g,"b-").replace(/#/g,"b_"),t}function Q_(n){switch(n){case"C":return{lineWidth:3.33,dash:[],color:"#adb5bd"};case"E":return{lineWidth:1,dash:[5,5],color:"#adb5bd"};case"G":return{lineWidth:1,dash:[],color:"#dee2e6"};case"B":case"A":case"F":case"Eb/Db":case"Db/C#":return{lineWidth:1,dash:[],color:"#ced4da"};default:return{lineWidth:1,dash:[],color:"#ced4da"}}}function U_(){const n=gp(),{startRank:t,endRank:e}=n,s=Math.max(t,e-1);return{startRow:t,endRow:s}}function uh(n,t){const e=f.state,s={cellWidth:t.cellWidth,tempoModulationMarkers:t.tempoModulationMarkers,baseMicrobeatPx:t.baseMicrobeatPx,columnWidths:t.columnWidths,state:e};return Zr.pixelXToColumn(n,s,e)}function P_(n,t){const e=gp(),s=t.cellHeight/2;return n/s-1+e.startRank}function eB(n,t){return t.some(e=>e.columnIndex===n)}function dh(n,t){return t.some(e=>n===e.columnIndex||n===e.columnIndex+1)}function Aa(n,t){const e=Ye(t);return!dh(n,e)}function nB(n,t){for(const e of t)if(n===e.columnIndex+1)return!1;return t.some(e=>n===e.columnIndex+2),!0}function N_(n){const t=new Set;return n.forEach(e=>{t.add(e.columnIndex),t.add(e.columnIndex+1)}),t}function $e(n){var s;if(!n)return 0;const t=(s=n.dataset)==null?void 0:s.logicalWidth,e=t!==void 0?Number(t):NaN;return Number.isFinite(e)?e:n.width||0}function ie(n){var s;if(!n)return 0;const t=(s=n.dataset)==null?void 0:s.logicalHeight,e=t!==void 0?Number(t):NaN;return Number.isFinite(e)?e:n.height||0}function D_(n){var s;if(!n)return 1;const t=(s=n.dataset)==null?void 0:s.pixelRatio,e=t!==void 0?Number(t):NaN;return Number.isFinite(e)&&e>0?e:1}const ud={stroke:"#c7cfd8",background:"rgba(207, 214, 222, 0.32)"};let el=null;function sB(){if(el)return el;if(typeof window>"u")return ud;const n=window.getComputedStyle(document.documentElement);return el={stroke:n.getPropertyValue("--c-anacrusis-border").trim()||ud.stroke,background:n.getPropertyValue("--c-anacrusis-bg").trim()||ud.background},el}function L_(n){if(n.length===0)return[];const t=[...n].sort((s,r)=>s.start-r.start),e=[];for(const s of t){if(e.length===0){e.push({...s});continue}const r=e[e.length-1];s.start<=r.end?r.end=Math.max(r.end,s.end):e.push({...s})}return e}function k_(n){const t=[],e=H_();return e!==null&&e>0&&t.push({start:lt(0,n),end:lt(e,n)}),Ye(f.state).forEach(r=>{const i=lt(r.columnIndex,n),o=lt(r.columnIndex+2,n);t.push({start:i,end:o})}),L_(t)}function R_(n,t,e){const s=new Set([n,t]);e.forEach(o=>{const A=Math.max(n,Math.min(t,o.start)),a=Math.max(n,Math.min(t,o.end));a>A&&(s.add(A),s.add(a))});const r=Array.from(s).sort((o,A)=>o-A),i=[];for(let o=0;o<r.length-1;o++){const A=r[o],a=r[o+1],l=(A+a)/2,c=e.some(u=>l>=u.start&&l<u.end);a>A&&i.push({from:A,to:a,light:c})}return i}function H_(){const n=f.state;if(!(n!=null&&n.hasAnacrusis)||!Array.isArray(n.macrobeatBoundaryStyles))return null;const t=n.macrobeatBoundaryStyles.findIndex(s=>s==="solid");if(t<0)return null;const e=mn(n,t);return e?e.endColumn+1:null}function O_(n,t,e,s){const r=k_(t),{stroke:i}=sB();for(let o=e;o<=s;o++){const A=t.fullRowData[o];if(!A||A.isBoundary)continue;const a=xt(o,t);if(a<-10||a>t.viewportHeight+10)continue;const l=M_(A.pitch);if(["B","A","F","E/D","D/C"].includes(l))continue;const u=Q_(l),d=t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:t.columnWidths||[],p=lt(0,t),h=lt(d.length,t),m=R_(p,h,r);l==="G"?m.forEach(g=>{const v=g.to-g.from;v<=0||(n.save(),n.fillStyle=g.light?i:u.color,n.globalAlpha=g.light?.5:1,n.fillRect(g.from,a-t.cellHeight/2,v,t.cellHeight),n.restore())}):m.forEach(g=>{g.to-g.from<=0||(n.beginPath(),n.moveTo(g.from,a),n.lineTo(g.to,a),n.lineWidth=u.lineWidth,n.strokeStyle=g.light?i:u.color,n.setLineDash(u.dash),n.globalAlpha=g.light?.6:1,n.stroke(),n.setLineDash([]),n.globalAlpha=1)})}}function V_(n,t,e,s){O_(n,t,e,s)}function W_(n,t){G_(n,t)}function G_(n,t){const{columnWidths:e,macrobeatGroupings:s,macrobeatBoundaryStyles:r,placedTonicSigns:i}=t,A=(t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:e).length,a=s.map((l,c)=>{const{endColumn:u}=mn(f.state,c);return u+1});for(let l=0;l<=A;l++){const c=l===0||l===A,u=eB(l,i),d=i.some(v=>l===v.columnIndex+2),p=a.includes(l);if(!nB(l,i))continue;let m=null;if(c||u||d)m={lineWidth:2,strokeStyle:"#adb5bd",dash:[]};else if(p){const v=a.indexOf(l),w=r[v]??"dashed";if(w==="anacrusis"){const{stroke:y}=sB();m={lineWidth:1,strokeStyle:y,dash:[4,4]}}else m={lineWidth:1,strokeStyle:"#adb5bd",dash:w==="solid"?[]:[5,5]}}if(!m)continue;const g=lt(l,t);n.beginPath(),n.moveTo(g,0),n.lineTo(g,ie(n.canvas)),n.lineWidth=m.lineWidth,n.strokeStyle=m.strokeStyle,n.setLineDash(m.dash),n.stroke()}n.setLineDash([])}let Zm=0;function rB(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let K_=!1;function q_(n,t){var e;if(rB())try{const s=((e=performance==null?void 0:performance.now)==null?void 0:e.call(performance))??Date.now();if(s-Zm<500)return;Zm=s,K_=!0}catch{}}const tg=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"];function z_(n){const t=n.replace(/\d+$/,"");return t.length>0?t:n}function iB(n,t){return!Number.isFinite(t)||t<=0?n:Math.round(n*t)/t}function $_(n,t,e,s){const r=Math.max(10,Math.min(n*1.2,t*1.2)),i=e<=3?1:.7,o=s<=1?1.08:1;return iB(r*i*o,s)}function X_(n,t){const e=t[n];if(!e)return null;const r=e.pitch.replace(/\d+$/,"");return(r.includes("/")?r.split("/")[0]??r:r).replace(//g,"b").replace(//g,"#")}function Y_(n,t){if(!n||!t)return[];const e=t-1;if(e<0||e>=tg.length)return E.warn("LegendRenderer",`Invalid tonic number: ${t}`,null,"grid"),[];const s=tg[e];try{const r=`${n} ${s}`;return kT(r).notes||[]}catch(r){return E.warn("LegendRenderer",`Could not generate ${s} scale`,{tonic:n,error:r},"grid"),[]}}function yc(n){return n?n.replace(/\d+$/,"").replace(/T-/g,"b").replace(/T_/g,"#").replace(/-/g,"b").replace(/_/g,"#").replace(//g,"b").replace(//g,"#"):""}function j_(n){const t=new Set;return n.forEach(e=>{const s=yc(e);if(s){t.add(s);try{const r=yc(PA(s));r&&t.add(r)}catch{}}}),t}function eg(n,t){if(!t.size)return!0;const e=yc(n.toneNote||n.pitch);if(!e)return!1;if(t.has(e))return!0;try{const s=yc(PA(e));if(s&&t.has(s))return!0}catch{}return e.includes("/")?e.split("/").some(s=>t.has(s)):!1}function J_(n,t,e,s,r){const{fullRowData:i,columnWidths:o,cellWidth:A,cellHeight:a,colorMode:l}=e,c=l??"color",{sharp:u,flat:d}=f.state.accidentalMode,{focusColours:p,showFrequencyLabels:h}=f.state,m=e.showOctaveLabels??!0,g=S=>m?S:z_(S),v=(S,T)=>{var ot;if(!rB())return;const x=a/2,_=ie(S.canvas),F=xt(r,e),Q=F+x,U=((ot=document.getElementById("pitch-grid-container"))==null?void 0:ot.clientHeight)??null,W=i.length,D=s<=0,R=r>=W-1,N=V=>{if(V===null)return null;const H=i[V];return H?{rowIndex:V,pitch:H.pitch,column:H.column,isBoundary:!!H.isBoundary}:{rowIndex:V,exists:!1}},q=V=>{let H=null,G=null;for(let Y=s;Y<=r;Y++){const P=i[Y];!P||P.isDummy||P.column===V&&(H===null&&(H=Y),G=Y)}return{first:H,last:G}},J=q("A"),nt=q("B"),At=V=>{if(V===null)return null;const H=xt(V,e);return{rowIndex:V,y:H,topEdge:H-x,bottomEdge:H+x,gapCanvasMinusBottomEdge:_-(H+x)}};q_("legendCoverage",{side:T,startRow:s,endRow:r,atTopGamutEdge:D,atBottomGamutEdge:R,cellHeight:a,halfUnit:x,yEnd:F,bottomEdge:Q,canvasHeight:_,gapCanvasMinusBottomEdge:_-Q,containerHeight:U,gapCanvasMinusContainer:typeof U=="number"?_-U:null,startRowSummary:N(s),endRowSummary:N(r),firstLastA:{...J,firstSummary:N(J.first),lastSummary:N(J.last)},firstLastB:{...nt,firstSummary:N(nt.first),lastSummary:N(nt.last)},aLastCoverage:At(J.last),bLastCoverage:At(nt.last)})};let w=[],y=new Set;if(p){const S=Ye(f.state),T=new Set;S.length||E.info("LegendRenderer","Focus Colours ON but no tonic placements found",null,"grid"),S.forEach(x=>{const _=X_(x.row,i),F=Y_(_,x.tonicNumber);E.debug("LegendRenderer","Focus Colours tonic scale",{tonicNote:_,tonicNumber:x.tonicNumber,scaleNotes:F},"grid"),F.forEach(Q=>T.add(Q))}),w=Array.from(T),E.debug("LegendRenderer","Focus Colours combined scale",{focusScale:w},"grid"),y=j_(w)}const I=(S,T=[],x=null)=>{if(h){const W=p&&y.size>0,D=x?eg(x,y):!1;return W&&x&&!D?null:x&&x.frequency?String(x.frequency):S}if(!x){if(!S.includes("/"))return g(S);const W=S.slice(-1),D=S.substring(0,S.length-1),[R,N]=D.split("/");return g(u&&d?`${R}/${N}${W}`:u?`${N}${W}`:d?`${R}${W}`:`${N}${W}`)}const{flatName:_,sharpName:F,isAccidental:Q}=x;if(!Q)return g(_);let U;return u&&d?U=x.pitch:u&&!d?U=F:d&&!u?U=_:U=F,g(U)},B=()=>!u&&!d,C=S=>{S.clearRect(0,0,$e(S.canvas),ie(S.canvas))};function b(S,T,x,_){const F=rs*2*A,Q=[F/2,F/2],U=D_(S.canvas),W=q=>iB(q,U);let D=0,R=0,N=0;x.forEach((q,J)=>{const nt=Q[J]??0;for(let At=s;At<=r;At++){const ot=i[At];if(!(!ot||ot.isDummy)&&ot.column===q){const V=xt(At,e),H=ot.isAccidental??ot.pitch.includes("/"),G=!h&&H&&B(),Y=eg(ot,y),P=I(ot.pitch,_,ot);if(P===null)continue;const st=!!ot.isBoundary;let L=c==="bw"?"#ffffff":ot.hex||"#ffffff";p&&!Y&&!h&&(L="#ffffff");const K=G||st?"00":p&&!Y?"55":"FF";p&&y.size>0&&(N+=1,Y||(R+=1)),S.fillStyle=G?"rgba(255,255,255,0)":L,S.fillRect(D,V-a/2,nt,a);const O=$_(A,a,P.length,U);S.font=`bold ${O}px 'Atkinson Hyperlegible', sans-serif`,S.textAlign="center",S.textBaseline="middle";const X=W(D+nt/2),tt=W(V);S.strokeStyle=`#212529${K}`,S.lineWidth=Math.max(1.2,2.5/U),S.lineJoin="round",S.strokeText(P,X,tt),S.fillStyle=`#ffffff${K}`,S.fillText(P,X,tt)}}D+=nt}),p&&y.size>0&&E.debug("LegendRenderer","Focus filter summary (separate)",{side:T===0?"left":"right",startCol:T,relevantScale:_,totalLabels:N,filteredLabels:R},"grid")}n&&(C(n),v(n,"left"),b(n,0,["B","A"],w)),t&&(C(t),v(t,"right"),b(t,o.length,["A","B"],w))}const oB={0:{degree:1,alt:0},1:{degree:2,alt:-1},2:{degree:2,alt:0},3:{degree:3,alt:-1},4:{degree:3,alt:0},5:{degree:4,alt:0},6:{degree:5,alt:-1},7:{degree:5,alt:0},8:{degree:6,alt:-1},9:{degree:6,alt:0},10:{degree:7,alt:-1},11:{degree:7,alt:0}};function Z_(n){if(Math.abs(n.num)!==8||n.alt>=0)return null;const e=(n.semitones%12+12)%12;return oB[e]||null}function ng(n){if(!n)return null;const t=hT(n);if((t==null?void 0:t.num)===void 0)return null;const e=Z_(t);if(e){const a=e.degree,l=e.alt;let c="";return l<0?c="".repeat(Math.abs(l)):l>0&&(c="".repeat(l)),`${c}${a}`}const s=(t.semitones%12+12)%12,r=oB[s];if(!r){const a=Math.abs(t.num),l=t.alt;let c="";return l<0?c="".repeat(Math.abs(l)):l>0&&(c="".repeat(l)),`${c}${a}`}const i=r.degree,o=r.alt;let A="";return o<0?A="".repeat(Math.abs(o)):o>0&&(A="".repeat(o)),`${A}${i}`}function sg(n){return n&&{"1":"2","2":"1","2":"3","3":"2","4":"5","5":"4","5":"6","6":"5","6":"7","7":"6"}[n]||null}function rg(n){return!!(n&&(n.includes("")||n.includes("")))}const dd={getEnharmonicDegree:sg,hasAccidental:rg,getDegreeForNote(n,t){var u;if(!n||!t)return null;const{keyTonic:e,keyMode:s}=VT(t,n.startColumnIndex);if(!e)return null;const r=n.globalRow??n.row,i=(u=t.fullRowData[r])==null?void 0:u.toneNote;if(!i)return null;const o=sh(i)||i;let A=e;if(t.degreeDisplayMode!=="modal"&&s!=="major"){const p=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"].indexOf(s);if(p>0){const m=["1P","2M","3M","4P","5P","6M","7M"][p];if(m){const g=fT(m);A=So(e,g)||A}}}const l=Vm(A,o),c=ng(l);if(n.enharmonicPreference&&c&&rg(c)){const d=sg(c);if(d)return d}return c},getDegreesForNotes(n,t){return!n||n.length===0?[]:n.map(e=>{const s=sh(e)||e,r=Vm(t,s);return ng(r)}).filter(e=>e!==null)},getRomanNumeralForNotes(n,t){if(!n||n.length<2)return null;const[e]=iT(n);if(!e)return null;const s=bT(e),r=s==null?void 0:s.symbol;if(!r)return null;const[i]=NT(t,[r]);if(!i)return null;const o=na(i),A=o==null?void 0:o.roman;if(!A)return null;let a=o.name.replace(A,"");const l=(s==null?void 0:s.tonic)||t;return a==="6"&&(a="add6"),{roman:A,ext:a,root:l}}},hh="",fh="",Sc="/",Da=()=>window.animationEffectsManager,ph=()=>f.state.placedNotes,Ec=n=>{const t=n==null?void 0:n.split("-")[1];return Number.parseInt(t??"0",10)};function AB(n){if(!n||typeof n.startColumnIndex!="number"||typeof n.endColumnIndex!="number")return!1;const t=n.shape==="circle"?n.startColumnIndex+1:n.startColumnIndex;return n.endColumnIndex>t}function aB(n,t,e){const{cellWidth:s}=e,r=s*.25,i=n.uuid;if(!i)return 0;const o=t.filter(l=>!l.isDrum&&l.row===n.row&&l.startColumnIndex===n.startColumnIndex&&l.uuid&&l.uuid!==i);if(o.length===0)return 0;const A=[n,...o];return A.sort((l,c)=>Ec(l.uuid)-Ec(c.uuid)),A.findIndex(l=>l.uuid===i)*r}function lB(n,t){var i,o;const{cellHeight:e}=t,s=Da();return(i=s==null?void 0:s.shouldAnimateNote)!=null&&i.call(s,n)?(((o=s.getVibratoYOffset)==null?void 0:o.call(s,n.color))??0)*e:0}function cB(n,t,e){const s=Da(),r=s==null?void 0:s.hasReverbEffect;if(!(typeof r=="function"?r(t.color):!!r))return{shouldApply:!1,blur:0,spread:0};const{cellWidth:o}=e,A=s==null?void 0:s.getReverbEffect,a=typeof A=="function"?A(t.color):void 0;if(!a)return{shouldApply:!1,blur:0,spread:0};const l=a.blur*(o/2),c=a.spread*(o/3);return{shouldApply:l>0||c>0,blur:l,spread:c}}function uB(n,t,e,s,r,i,o){var c,u;const A=Da();if(!((c=A==null?void 0:A.hasDelayEffect)!=null&&c.call(A,t.color)))return;const{cellWidth:a}=e,l=(u=A.getDelayEffects)==null?void 0:u.call(A,t.color);!l||l.length===0||l.forEach((d,p)=>{const h=d.delay/500*a*2,m=s+h,g=i*d.scale,v=o*d.scale;n.save(),n.globalAlpha=d.opacity*.6,n.beginPath(),n.ellipse(m,r,g,v,0,0,2*Math.PI),n.strokeStyle=t.color,n.lineWidth=Math.max(.5,g*.1),n.setLineDash([2,2]),n.stroke(),n.restore()})}function dB(n,t,e,s,r,i){var c,u;const o=Da();if(!((c=o==null?void 0:o.shouldFillNote)!=null&&c.call(o,t)))return;const A=((u=o.getFillLevel)==null?void 0:u.call(o,t))??0;if(A<=0)return;n.save();const a=1-A,l=n.createRadialGradient(e,s,0,e,s,Math.max(r,i));l.addColorStop(0,"transparent"),l.addColorStop(Math.max(0,a-.05),"transparent"),l.addColorStop(a,`${t.color}1F`),l.addColorStop(1,`${t.color}BF`),n.beginPath(),n.ellipse(e,s,r,i,0,0,2*Math.PI),n.clip(),n.fillStyle=l,n.fillRect(e-r-10,s-i-10,(r+10)*2,(i+10)*2),n.restore()}function tM(n,t,e,s,r,i){var p,h;const o=Da();if(!((p=o==null?void 0:o.shouldFillNote)!=null&&p.call(o,t)))return;const A=((h=o.getFillLevel)==null?void 0:h.call(o,t))??0;if(A<=0)return;n.save(),n.beginPath(),n.arc(e,r,i,Math.PI/2,-Math.PI/2,!1),n.lineTo(s,r-i),n.arc(s,r,i,-Math.PI/2,Math.PI/2,!1),n.lineTo(e,r+i),n.closePath(),n.clip();const a=(e+s)/2,l=s-e,c=Math.max(l/2+i,i),u=1-A,d=n.createRadialGradient(a,r,0,a,r,c);d.addColorStop(0,"transparent"),d.addColorStop(Math.max(0,u-.05),"transparent"),d.addColorStop(u,`${t.color}1F`),d.addColorStop(1,`${t.color}BF`),n.fillStyle=d,n.fillRect(e-i-10,r-i-10,l+(i+10)*2,(i+10)*2),n.restore()}function eM(n,t,e,s,r,i,o,A){if(tM(n,t,s,r,i,o),n.save(),n.beginPath(),n.arc(s,i,o,Math.PI/2,-Math.PI/2,!1),n.lineTo(r,i-o),n.arc(r,i,o,-Math.PI/2,Math.PI/2,!1),n.lineTo(s,i+o),n.closePath(),n.strokeStyle=t.color,n.lineWidth=A,n.shadowColor=t.color,n.shadowBlur=ia,n.stroke(),n.shadowBlur=0,n.shadowColor="transparent",n.restore(),e.degreeDisplayMode!=="off"){const a=(s+r)/2;vp(n,t,e,a,i,o)}}function nM(n,t,e){const{cellHeight:s}=e,r=s/2*.12,i=n.uuid;if(!i)return 0;const o=t.filter(l=>!l.isDrum&&l.row===n.row&&l.startColumnIndex===n.startColumnIndex&&l.uuid&&l.uuid!==i&&AB(l));if(o.length===0)return 0;const A=[n,...o];return A.sort((l,c)=>Ec(l.uuid)-Ec(c.uuid)),A.findIndex(l=>l.uuid===i)*r}function sM(n,t){const e=dd.getDegreeForNote(n,t);if(!e)return{label:null,isAccidental:!1};if(!dd.hasAccidental(e))return{label:e,isAccidental:!1};const r=f.state.accidentalMode||{},i=r.sharp??!0,o=r.flat??!0;if(!i&&!o)return{label:null,isAccidental:!0};let A=e.includes(hh)?e:null,a=e.includes(fh)?e:null;const l=dd.getEnharmonicDegree(e);l&&(l.includes(hh)&&!A&&(A=l),l.includes(fh)&&!a&&(a=l));let c=null;if(i&&o){const u=[];A&&u.push(A),a&&(!A||a!==A)&&u.push(a),c=u.join(Sc),c||(c=e)}else i?c=A||e:o&&(c=a||e);return{label:c,isAccidental:!0}}function rM(n){if(!n)return{multiplier:1,category:"natural"};const t=n.includes(fh),e=n.includes(hh),s=n.includes(Sc);return!t&&!e?{multiplier:1,category:"natural"}:s?{multiplier:.75,category:"both-accidentals"}:{multiplier:.88,category:"single-accidental"}}function vp(n,t,e,s,r,i,o){const{label:A}=sM(t,e);if(!A)return;const{multiplier:a,category:l}=rM(A);let c;if(t.shape==="circle"){const d=i*2*qT;switch(l){case"natural":c=d;break;case"single-accidental":c=d*.8;break;case"both-accidentals":c=d*.4;break;default:c=d*a}}else{const d=i*2*KT;switch(l){case"natural":c=d*1.5;break;case"single-accidental":c=d*1.2;break;case"both-accidentals":c=d;break;default:c=d*a}}const u=c;if(!(u<zT))if(n.fillStyle="#212529",n.font=`bold ${u}px 'Atkinson Hyperlegible', sans-serif`,n.textAlign="center",n.textBaseline="middle",t.shape==="oval"&&l==="both-accidentals"&&A.includes(Sc)){const d=A.split(Sc),p=u*1.1,h=p*(d.length-1),m=r-h/2;d.forEach((g,v)=>{const w=m+v*p,y=u*.08;n.fillText(g.trim(),s,w+y)})}else{const d=u*.08;n.fillText(A,s,r+d)}}function LA(n,t){return Number.isFinite(n)&&n>0&&Number.isFinite(t)&&t>0}function wp(n,t,e,s){const{cellWidth:r,cellHeight:i,tempoModulationMarkers:o}=t,A=xt(s,t),a=lB(e,t),l=A+a,c=lt(e.startColumnIndex,t);let u;if(o&&o.length>0?u=lt(e.startColumnIndex+1,t)-c:u=r,!LA(u,i))return;const d=aB(e,ph(),t),p=c+u+d,h=Math.max($T,u*XT),m=i/2-h/2,g=AB(e),v=f.state.longNoteStyle||"style1";if(g&&v==="style2"){const I=p,B=lt(e.endColumnIndex,t);if(!LA(B-I,m))return;eM(n,e,t,I,B,l,m,h);return}if(g){const I=lt(e.endColumnIndex+1,t),B=nM(e,ph(),t),C=l+B;n.beginPath(),n.moveTo(p,C),n.lineTo(I,C),n.strokeStyle=e.color,n.lineWidth=Math.max(jT,u*YT),n.stroke()}const w=u-h/2;if(!LA(w,m))return;uB(n,e,t,p,l,w,m),n.save(),dB(n,e,p,l,w,m);const y=cB(n,e,t);y.shouldApply&&(n.shadowColor=e.color,n.shadowBlur=ia+y.blur,n.shadowOffsetX=y.spread),n.beginPath(),n.ellipse(p,l,w,m,0,0,2*Math.PI),n.strokeStyle=e.color,n.lineWidth=h,y.shouldApply||(n.shadowColor=e.color,n.shadowBlur=ia),n.stroke(),n.shadowBlur=0,n.shadowColor="transparent",n.shadowOffsetX=0,n.restore(),t.degreeDisplayMode!=="off"&&vp(n,e,t,p,l,w)}function Bp(n,t,e,s){const{columnWidths:r,cellWidth:i,cellHeight:o,tempoModulationMarkers:A}=t,a=xt(s,t),l=lB(e,t),c=a+l,u=lt(e.startColumnIndex,t);let d;if(A&&A.length>0?d=lt(e.startColumnIndex+1,t)-u:d=((t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:r)[e.startColumnIndex]??0)*i,!LA(d,o))return;const p=aB(e,ph(),t),h=Math.max(.5,d*.15),m=u+d/2+p,g=d/2-h/2,v=o/2-h/2;if(!LA(g,v))return;uB(n,e,t,m,c,g,v),n.save(),dB(n,e,m,c,g,v);const w=cB(n,e,t);w.shouldApply&&(n.shadowColor=e.color,n.shadowBlur=ia+w.blur,n.shadowOffsetX=w.spread),n.beginPath(),n.ellipse(m,c,g,v,0,0,2*Math.PI),n.strokeStyle=e.color,n.lineWidth=h,w.shouldApply||(n.shadowColor=e.color,n.shadowBlur=ia),n.stroke(),n.shadowBlur=0,n.shadowColor="transparent",n.shadowOffsetX=0,n.restore(),t.degreeDisplayMode!=="off"&&vp(n,e,t,m,c,g)}function hB(n,t,e){const{cellWidth:s,cellHeight:r,tempoModulationMarkers:i}=t,o=xt(e.globalRow??e.row,t);let A=e.columnIndex;if(e.uuid){const g=Ne.getColumnMap(f.state).entries.find(v=>v.type==="tonic"&&v.tonicSignUuid===e.uuid&&typeof v.canvasIndex=="number");g&&typeof g.canvasIndex=="number"&&(A=g.canvasIndex)}const a=lt(A,t);let l;i&&i.length>0?l=lt(A+1,t)-a:l=s;const c=l*2,u=a+c/2,d=Math.min(c,r)/2*.9;if(d<2||(n.beginPath(),n.arc(u,o,d,0,2*Math.PI),n.strokeStyle="#212529",n.lineWidth=Math.max(.5,l*.05),n.stroke(),e.tonicNumber==null))return;const p=e.tonicNumber.toString(),h=d*1.5;h<6||(n.fillStyle="#212529",n.font=`bold ${h}px 'Atkinson Hyperlegible', sans-serif`,n.textAlign="center",n.textBaseline="middle",n.fillText(p,u,o))}const mh=[{id:1,diamonds:[0],ovals:[],label:"left 8th"},{id:2,diamonds:[1],ovals:[],label:"e"},{id:3,diamonds:[2],ovals:[],label:"right 8th"},{id:4,diamonds:[3],ovals:[],label:"a"},{id:5,diamonds:[0,1],ovals:[],label:"1 e"},{id:6,diamonds:[1,2],ovals:[],label:"e &"},{id:7,diamonds:[2,3],ovals:[],label:"& a"},{id:8,diamonds:[0,2],ovals:[],label:"two 8ths"},{id:9,diamonds:[1,3],ovals:[],label:"e a"},{id:10,diamonds:[0,1,2],ovals:[],label:"1 e + right 8th"},{id:11,diamonds:[1,2,3],ovals:[],label:"e & a"},{id:12,diamonds:[0,1,3],ovals:[],label:"1 e a"},{id:13,diamonds:[0,2,3],ovals:[],label:"left 8th + & a"},{id:14,diamonds:[0,3],ovals:[],label:"left 8th + a"},{id:15,diamonds:[0,1,2,3],ovals:[],label:"1 e & a"}];function Eu(n){return mh.find(t=>t.id===n)}function ig(n,t,e,s){const r=Math.sqrt(3)/2*e,i=Math.max(1,s-2*r),o=t-(i/2+r),A=o+r,a=A+i,l=a+r,c=n-e/2,u=n+e/2;return`M ${[`${n},${o}`,`${c},${A}`,`${c},${a}`,`${n},${l}`,`${u},${a}`,`${u},${A}`].join(" ")} Z`.replace(/,/g," ")}class iM{constructor(t={}){M(this,"options");this.options={diamondW:30,diamondH:120,ovalRx:30,ovalRy:60,strokeWidth:2,...t}}renderToCanvas(t,e,s,r,i,o,A="#000",a=null,l=null){const c=i/100*.8,u=o/100*.8,d=this.options.diamondW*c,p=this.options.diamondH*u,h=this.options.ovalRx*c,m=this.options.ovalRy*u,g=[.125,.375,.625,.875].map(w=>s+w*i),v=r+o/2;t.save(),t.strokeStyle=A,t.fillStyle=A,t.lineWidth=this.options.strokeWidth,t.lineCap="round",t.lineJoin="round",e.ovals.forEach(w=>{var B;const y=w===0?s+.25*i:s+.75*i;let I=v;if(a&&l){const C=`oval_${w}`,b=((B=a.shapeOffsets)==null?void 0:B[C])||0,S=a.row+b;I=l(S)}t.beginPath(),t.ellipse(y,I,h,m,0,0,Math.PI*2),t.stroke()}),e.diamonds.forEach(w=>{var b;const y=g[w];if(y===void 0)return;let I=v;if(a&&l){const S=`diamond_${w}`,T=((b=a.shapeOffsets)==null?void 0:b[S])||0,x=a.row+T;I=l(x)}const B=ig(y,I,d,p),C=new Path2D(B);t.stroke(C)}),t.restore()}renderToSVG(t,e=100,s=100){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox",`0 0 ${e} ${s}`),r.style.color="#000000";const i=Math.min(e/100,s/100)*.8,o=this.options.diamondW*i,A=this.options.diamondH*i,a=this.options.ovalRx*i,l=this.options.ovalRy*i,c=[12.5,37.5,62.5,87.5],u=s/2;return t.ovals.forEach(d=>{const p=d===0?25:75,h=document.createElementNS("http://www.w3.org/2000/svg","ellipse");h.setAttribute("cx",String(p)),h.setAttribute("cy",String(u)),h.setAttribute("rx",String(a)),h.setAttribute("ry",String(l)),h.setAttribute("fill","none"),h.setAttribute("stroke","currentColor"),h.setAttribute("stroke-width",String(this.options.strokeWidth*2)),h.setAttribute("stroke-linecap","round"),r.appendChild(h)}),t.diamonds.forEach(d=>{const p=c[d];if(p===void 0)return;const h=ig(p,u,o,A),m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",h),m.setAttribute("fill","none"),m.setAttribute("stroke","currentColor"),m.setAttribute("stroke-width",String(this.options.strokeWidth*2)),m.setAttribute("stroke-linejoin","round"),m.setAttribute("stroke-linecap","round"),r.appendChild(m)}),r}}const Cp=new iM;E.moduleLoaded("SixteenthStampRenderer","stamps");function oM(n,t){var s,r;const e=((s=f.getAllSixteenthStampPlacements)==null?void 0:s.call(f))??((r=f.state)==null?void 0:r.sixteenthStampPlacements)??[];e.length!==0&&(E.debug("SixteenthStampRenderer",`Rendering ${e.length} stamps`,{count:e.length},"stamps"),e.forEach(i=>{AM(n,i,t)}))}function AM(n,t,e){const s=Eu(t.sixteenthStampId);if(!s)return;const{startColumn:r,row:i,color:o}=t,A=f.state,a=lt(r,e),c=xt(i,e)-e.cellHeight/2,u=$r(r,A);let d;if(u!==null){const w=u+2;d=Cn(w,A)}else d=r+2;const h=lt(d,e)-a,m=e.cellHeight,g=$e(n.canvas);if(a+h<0||a>g)return;const v=w=>xt(w,e);Cp.renderToCanvas(n,s,a,c,h,m,o,t,v),n.save(),n.globalAlpha=.1,n.fillStyle=o,n.fillRect(a+1,c+1,h-2,m-2),n.restore(),E.debug("SixteenthStampRenderer",`Rendered stamp ${t.sixteenthStampId} at ${r}-${d},${i}`,{sixteenthStampId:t.sixteenthStampId,startColumn:r,effectiveEndColumn:d,row:i,stampX:a,stampY:c,hasOffsets:!!t.shapeOffsets},"stamps")}function aM(n,t,e,s,r){if(!s)return;const i=f.state,o=lt(t,r),a=xt(e,r)-r.cellHeight/2,l=$r(t,i);let c;if(l!==null){const h=l+2;c=Cn(h,i)}else c=t+2;const d=lt(c,r)-o,p=r.cellHeight;n.save(),n.globalAlpha=.6,Cp.renderToCanvas(n,s,o,a,d,p,r.previewColor||"#4a90e2"),n.restore()}function og(n,t,e){return[{id:t+0,span:n,hits:[0],label:`${e} [1]`},{id:t+1,span:n,hits:[1],label:`${e} [2]`},{id:t+2,span:n,hits:[2],label:`${e} [3]`},{id:t+3,span:n,hits:[0,1],label:`${e} [1 2]`},{id:t+4,span:n,hits:[1,2],label:`${e} [2 3]`},{id:t+5,span:n,hits:[0,2],label:`${e} [1 3]`},{id:t+6,span:n,hits:[0,1,2],label:`${e} [1 2 3]`}]}const Kl=[...og("eighth",1,"8th triplet"),...og("quarter",8,"Quarter triplet")],fB={eighth:1,quarter:2},pB=[16.6667,50,83.3333];function xu(n){return Kl.find(t=>t.id===n)}E.moduleLoaded("TripletStampRenderer","triplets");function lM(n,t){var s,r;const e=((s=f.getAllTripletStampPlacements)==null?void 0:s.call(f))??((r=f.state)==null?void 0:r.tripletStampPlacements)??[];e.length!==0&&(E.debug("TripletStampRenderer",`Rendering ${e.length} triplet groups`,{count:e.length},"triplets"),e.forEach(i=>{cM(n,i,t)}))}function cM(n,t,e){const s=xu(t.tripletStampId);if(!s)return;const{startTimeIndex:r,span:i,row:o,color:A}=t,a=i*2,l=Cn(r,f.state),c=l+a,u=lt(l,e),d=xt(o,e),p=d-e.cellHeight/2,m=lt(c,e)-u,g=e.cellHeight,v=$e(n.canvas);if(u+m<0||u>v)return;mB(n,s,u,d,m,g,A,t,y=>xt(y,e)),n.save(),n.globalAlpha=.1,n.fillStyle=A,n.fillRect(u+1,p+1,m-2,g-2),n.restore()}function mB(n,t,e,s,r,i,o,A=null,a=null){const l=r/100*.8,c=i/100*.8,u=Math.max(1,3*c);t.hits.forEach(d=>{var g;const p=pB[d]??50,h=e+r*p/100;let m=s;if(A&&a){const v=`triplet_${d}`,w=((g=A.shapeOffsets)==null?void 0:g[v])||0,y=A.row+w;m=a(y),w!==0&&E.debug("TripletStampRenderer","Drawing notehead with offset",{slot:d,shapeKey:v,rowOffset:w,baseRow:A.row,shapeRow:y,y:m},"triplets")}uM(n,h,m,o,u,l,c)})}function uM(n,t,e,s="currentColor",r=4,i=1,o=1){const A=20*i,a=60*o;n.strokeStyle=s,n.lineWidth=r,n.fillStyle="none",n.beginPath(),n.ellipse(t,e,A,a,0,0,2*Math.PI),n.stroke()}function dM(n,t,e,s,r){if(!s)return;const o=(s.span==="eighth"?1:2)*2,A=Cn(t,f.state),a=lt(A,r),l=xt(e,r),c=A+o,d=lt(c,r)-a,p=r.cellHeight;n.save(),n.globalAlpha=.6;const h=r.previewColor||"#4a90e2";mB(n,s,a,l,d,p,h),n.restore()}function hM(n,t){if(n===0)return lt(0,t);const e=n-1,s=mn(f.state,e);return s?lt(s.endColumn+1,t):(E.warn("ModulationRenderer","Could not find measure info for index",{measureIndex:n},"grid"),n*200)}function gB(n,t){const{tempoModulationMarkers:e}=t;if(!e||e.length===0)return;const s=e.filter(i=>i.active).map(i=>{let o;if(i.columnIndex!==null&&i.columnIndex!==void 0)o=lt(i.columnIndex+1,t);else if(i.macrobeatIndex!==null&&i.macrobeatIndex!==void 0&&i.macrobeatIndex>=0){const A=mn(f.state,i.macrobeatIndex);A?o=lt(A.endColumn+1,t):(E.warn("ModulationRenderer","Could not find macrobeat info for index",{macrobeatIndex:i.macrobeatIndex},"grid"),o=i.xPosition??0)}else i.measureIndex!==null&&i.measureIndex!==void 0?o=hM(i.measureIndex,t):o=i.xPosition??0;return{...i,xCanvas:o}});n.save();const r=t.showModulationLabel!==!1;s.forEach(i=>{fM(n,i,r)}),n.restore()}function fM(n,t,e){const s=t.xCanvas,r=t.ratio,i=Kw(r),o=Gw(r);pM(n,s,i),e&&mM(n,s,o,i)}function pM(n,t,e){const r=ie(n.canvas);n.beginPath(),n.moveTo(t,0),n.lineTo(t,r),n.lineWidth=3,n.strokeStyle=e,n.setLineDash([]),n.stroke()}function mM(n,t,e,s){const i="Arial, sans-serif";n.font=`14px ${i}`,n.textAlign="center",n.textBaseline="middle";const c=n.measureText(e).width,u=14,d=c+12,p=u+12,h=t-d/2,m=20;gM(n,h,m,d,p,8,s),n.fillStyle="#212529",n.fillText(e,t,m+p/2)}function gM(n,t,e,s,r,i,o){n.beginPath(),n.moveTo(t+i,e),n.lineTo(t+s-i,e),n.quadraticCurveTo(t+s,e,t+s,e+i),n.lineTo(t+s,e+r-i),n.quadraticCurveTo(t+s,e+r,t+s-i,e+r),n.lineTo(t+i,e+r),n.quadraticCurveTo(t,e+r,t,e+r-i),n.lineTo(t,e+i),n.quadraticCurveTo(t,e,t+i,e),n.closePath(),n.fillStyle=o,n.fill(),n.strokeStyle="rgba(0, 0, 0, 0.2)",n.lineWidth=1,n.stroke()}function Ag(n,t,e){const{xCanvas:s}=e,r=6,i=40;return Math.abs(n-s)<=r/2?t<=i?{marker:e,type:"label",canDrag:!1}:{marker:e,type:"barline",canDrag:!0}:null}function ag(n){if(!n)return"default";switch(n.type){case"label":return"pointer";case"barline":return n.canDrag?"ew-resize":"pointer";default:return"default"}}function os(n){return n.x??n.col??0}function As(n){return n.y??n.row??0}function aa(n,t){if(!t||t.length<3)return!1;const e=os(n),s=As(n);let r=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const A=os(t[i]),a=As(t[i]),l=os(t[o]),c=As(t[o]);a>s!=c>s&&e<(l-A)*(s-a)/(c-a)+A&&(r=!r)}return r}function vM(n){if(!n||n.length<3)return n;const t=n.map(i=>({x:os(i),y:As(i)}));if(t.length===0)return[];let e=t[0];for(let i=1;i<t.length;i++){const o=t[i];(o.y<e.y||o.y===e.y&&o.x<e.x)&&(e=o)}const s=t.filter(i=>i!==e);if(s.sort((i,o)=>{const A=Math.atan2(i.y-e.y,i.x-e.x),a=Math.atan2(o.y-e.y,o.x-e.x);if(A!==a)return A-a;const l=Math.hypot(i.x-e.x,i.y-e.y),c=Math.hypot(o.x-e.x,o.y-e.y);return l-c}),s.length===0)return[e];const r=[e,s[0]];for(let i=1;i<s.length;i++){const o=s[i];for(;r.length>1&&!wM(r[r.length-2],r[r.length-1],o);)r.pop();r.push(o)}return r}function wM(n,t,e){const s=os(n),r=As(n),i=os(t),o=As(t),A=os(e),a=As(e);return(i-s)*(a-r)-(o-r)*(A-s)>0}function BM(n,t,e,s=10){const r=os(n),i=As(n),o=os(t),A=As(t),a=os(e),l=As(e),c=a-o,u=l-A,d=c*c+u*u;if(d===0)return Math.hypot(r-o,i-A)<=s;let p=((r-o)*c+(i-A)*u)/d;p=Math.max(0,Math.min(1,p));const h=o+p*c,m=A+p*u;return Math.hypot(r-h,i-m)<=s}function lg(n,t,e=10){if(!t||t.length<2)return!1;for(let s=0;s<t.length;s++){const r=t[s],i=t[(s+1)%t.length];if(BM(n,r,i,e))return!0}return!1}function CM(n,t){const{centerX:e,centerY:s,rx:r,ry:i}=t,o=16;for(let A=0;A<o;A++){const a=A/o*2*Math.PI,l=e+r*Math.cos(a),c=s+i*Math.sin(a);if(aa({x:l,y:c},n))return!0}return!!aa({x:e,y:s},n)}function cg(n,t){const{x:e,y:s,width:r,height:i}=t,o=[{x:e,y:s},{x:e+r,y:s},{x:e+r,y:s+i},{x:e,y:s+i}];for(const A of o)if(aa(A,n))return!0;for(const A of n){const a=os(A),l=As(A);if(a>=e&&a<=e+r&&l>=s&&l<=s+i)return!0}return!1}function vB(n,t,e,s,r,i){const o=r-e,A=i-s,a=o*o+A*A;if(a===0){const h=n-e,m=t-s;return Math.sqrt(h*h+m*m)}let l=((n-e)*o+(t-s)*A)/a;l=Math.max(0,Math.min(1,l));const c=e+l*o,u=s+l*A,d=n-c,p=t-u;return Math.sqrt(d*d+p*p)}function bM(n){const{x:t,y:e,annotations:s,getRenderOptions:r}=n,i=10;let o=!1;const A=r();return{nextAnnotations:s.filter(l=>{let c=!0;if(l.type==="arrow"){const u=lt(l.startCol,A),d=xt(l.startRow,A),p=lt(l.endCol,A),h=xt(l.endRow,A);vB(t,e,u,d,p,h)<i&&(c=!1,o=!0)}else if(l.type==="text"){const u=lt(l.col,A),d=xt(l.row,A),p=lt(l.col+l.widthCols,A),h=xt(l.row+l.heightRows,A);t>=u&&t<=p&&e>=d&&e<=h&&(c=!1,o=!0)}else if(l.type==="marker"||l.type==="highlighter")for(let u=0;u<l.path.length;u++){const d=lt(l.path[u].col,A),p=xt(l.path[u].row,A),h=t-d,m=e-p;if(Math.sqrt(h*h+m*m)<i){c=!1,o=!0;break}}return c}),changed:o}}function yM(n){const{lassoPath:t,state:e,renderOptions:s,isAdditive:r,existingSelectedItems:i}=n,o=[];r&&Array.isArray(i)&&o.push(...i),e.placedNotes.forEach((a,l)=>{if(a.isDrum)return;const c=a.startColumnIndex,u=lt(c,s),d=xt(a.row,s),{cellWidth:p,cellHeight:h}=s;let m=p;s.tempoModulationMarkers&&s.tempoModulationMarkers.length>0&&(m=lt(c+1,s)-u);const g=a.shape==="oval"?u+m:u+m/2,v=d,w=a.shape==="oval"?m:m/2,y=h/2;if(CM(t,{centerX:g,centerY:v,rx:w,ry:y})){const I=`note-${a.row}-${c}-${a.color}-${a.shape}`;o.find(B=>B.id===I)||o.push({type:"note",id:I,data:a,index:l})}}),e.sixteenthStampPlacements.forEach((a,l)=>{const{cellWidth:c,cellHeight:u}=s,d=lt(a.startColumn,s),p=xt(a.row,s)-u/2,h=c*2;if(cg(t,{x:d,y:p,width:h,height:u})){const g=`sixteenth-stamp-${a.row}-${a.startColumn}-${a.sixteenthStampId}`;o.find(v=>v.id===g)||o.push({type:"sixteenthStamp",id:g,data:a,index:l})}}),e.tripletStampPlacements.forEach((a,l)=>{const{cellHeight:c}=s,u=Cn(a.startTimeIndex,e),d=u+a.span*2,p=lt(u,s),h=lt(d,s)-p,m=xt(a.row,s)-c/2;if(cg(t,{x:p,y:m,width:h,height:c})){const v=`triplet-stamp-${a.row}-${u}-${a.tripletStampId}`;o.find(w=>w.id===v)||o.push({type:"tripletStamp",id:v,data:a,index:l})}});const A=la({selectedItems:o,renderOptions:s,state:e});return{selectedItems:o,convexHull:A,isActive:o.length>0}}function la(n){const{selectedItems:t,renderOptions:e,state:s}=n;if(!t.length)return null;const r=s??f.state,i=t.map(o=>{const A=o.type==="note"?o.data.startColumnIndex:o.type==="sixteenthStamp"?o.data.startColumn:Cn(o.data.startTimeIndex,r),a=lt(A,e),l=xt(o.data.row,e);return{x:a,y:l}});return vM(i)}function SM(n){const{canvasX:t,canvasY:e,state:s,renderOptions:r,selection:i}=n;if(!(i!=null&&i.isActive))return null;const o=n.thresholdPx??15;let A=null;if(s.placedNotes.forEach(c=>{const u=c.startColumnIndex,d=lt(u,r),p=xt(c.row,r);Math.hypot(t-d,e-p)<=o&&(A=`note-${c.row}-${u}-${c.color}-${c.shape}`)}),A||s.sixteenthStampPlacements.forEach(c=>{const u=c.startColumn+1,d=lt(u,r),p=xt(c.row,r);Math.hypot(t-d,e-p)<=o&&(A=`sixteenth-stamp-${c.row}-${c.startColumn}-${c.sixteenthStampId}`)}),A||s.tripletStampPlacements.forEach(c=>{const u=Cn(c.startTimeIndex,s),d=u+c.span,p=lt(d,r),h=xt(c.row,r);Math.hypot(t-p,e-h)<=o&&(A=`triplet-stamp-${c.row}-${u}-${c.tripletStampId}`)}),!A)return null;const a=i.selectedItems.filter(c=>c.id!==A),l=la({selectedItems:a,renderOptions:r});return{nextSelection:{selectedItems:a,convexHull:l,isActive:a.length>0},changed:!0}}function EM(n){const{selection:t,selectionDragStart:e,selectionDragTotal:s,currentPointerGrid:r,initialDragStartRank:i,currentStartRank:o,renderOptions:A}=n,a=i!==null?o-i:0,l=r.row-a,c=Math.round(r.col-e.col),u=Math.round(l-e.row),d={col:c-s.col,row:u-s.row};if(d.col===0&&d.row===0)return{moved:!1,nextSelectionDragTotal:s,nextConvexHull:t.convexHull};const p=(v,w)=>typeof w=="number"?w:v,h=(v,w)=>{var B;const y=((B=f.state.columnWidths)==null?void 0:B.length)??0;let I=v;for(;I>=0&&I<y;){const C=$r(I,f.state);if(C!==null)return C;I+=w}return null};t.selectedItems.forEach(v=>{if(v.type==="note"){const y=p(v.data.row,v.data.globalRow)+d.row;v.data.globalRow=y,v.data.row=y,v.data.startColumnIndex=v.data.startColumnIndex+d.col,v.data.endColumnIndex=v.data.endColumnIndex+d.col}else if(v.type==="sixteenthStamp"){const y=p(v.data.row,v.data.globalRow)+d.row;v.data.globalRow=y,v.data.row=y,v.data.startColumn=v.data.startColumn+d.col,v.data.endColumn=v.data.endColumn+d.col}else if(v.type==="tripletStamp"){const y=p(v.data.row,v.data.globalRow)+d.row;if(v.data.globalRow=y,v.data.row=y,d.col!==0){const B=Cn(v.data.startTimeIndex,f.state)+d.col,C=Math.sign(d.col)||1,b=h(B,C);b!==null&&(v.data.startTimeIndex=b)}}});const m={col:c,row:u},g=la({selectedItems:t.selectedItems,renderOptions:A,state:f.state});return t.convexHull=g,{moved:!0,nextSelectionDragTotal:m,nextConvexHull:g}}function xM(n){const{ctx:t,annotation:e,isTemp:s=!1,isSelected:r=!1,isHovered:i=!1,getStrokeWidth:o,getLineDash:A}=n,{startX:a,startY:l,endX:c,endY:u,settings:d}=e;t.save(),r&&(t.strokeStyle="#4a90e2",t.lineWidth=o(d.strokeWeight)+4,t.globalAlpha=.3,t.setLineDash([]),t.beginPath(),t.moveTo(a,l),t.lineTo(c,u),t.stroke(),t.globalAlpha=1),i&&!r&&(t.strokeStyle="#4a90e2",t.lineWidth=o(d.strokeWeight)+4,t.globalAlpha=.15,t.setLineDash([]),t.beginPath(),t.moveTo(a,l),t.lineTo(c,u),t.stroke(),t.globalAlpha=1),t.strokeStyle=s?"rgba(0, 0, 0, 0.5)":"#000000",t.lineWidth=o(d.strokeWeight),t.setLineDash(A(d.lineStyle));const p=Math.atan2(u-l,c-a),h=d.arrowheadSize||12;let m=a,g=l,v=c,w=u;d.startArrowhead!=="none"&&(m=a+Math.cos(p)*h,g=l+Math.sin(p)*h),d.endArrowhead!=="none"&&(v=c-Math.cos(p)*h,w=u-Math.sin(p)*h),t.beginPath(),t.moveTo(m,g),t.lineTo(v,w),t.stroke(),d.startArrowhead!=="none"&&ug({ctx:t,x:a,y:l,angle:p+Math.PI,type:d.startArrowhead,size:h}),d.endArrowhead!=="none"&&ug({ctx:t,x:c,y:u,angle:p,type:d.endArrowhead,size:h}),t.restore()}function ug(n){const{ctx:t,x:e,y:s,angle:r,type:i,size:o}=n;switch(t.save(),t.translate(e,s),t.rotate(r),t.setLineDash([]),i){case"filled":case"filled-arrow":t.beginPath(),t.moveTo(0,0),t.lineTo(-o,-o/2),t.lineTo(-o,o/2),t.closePath(),t.fillStyle=t.strokeStyle,t.fill();break;case"unfilled":case"unfilled-arrow":t.beginPath(),t.moveTo(0,0),t.lineTo(-o,-o/2),t.lineTo(-o,o/2),t.closePath(),t.stroke();break;case"circle":t.beginPath(),t.arc(0,0,o/3,0,Math.PI*2),t.fillStyle=t.strokeStyle,t.fill();break}t.restore()}E.moduleLoaded("AnnotationService","annotation");class IM{constructor(){M(this,"canvas");M(this,"ctx");M(this,"currentTool");M(this,"toolSettings");M(this,"tempEraserMode");M(this,"isDrawing");M(this,"currentPath");M(this,"startPoint");M(this,"tempAnnotation");M(this,"selectedAnnotation");M(this,"hoverAnnotation");M(this,"eraserCursor");M(this,"isDragging");M(this,"dragOffset");M(this,"isResizing");M(this,"resizeHandle");M(this,"resizeStartBounds");M(this,"isDraggingSelection");M(this,"selectionDragStart");M(this,"selectionDragTotal");M(this,"lastPointerPosition");M(this,"initialDragStartRank");this.toolSettings=null,this.tempEraserMode=!1,this.currentTool=null,this.isDrawing=!1,this.currentPath=[],this.startPoint=null,this.tempAnnotation=null,this.selectedAnnotation=null,this.hoverAnnotation=null,this.eraserCursor=null,this.isDragging=!1,this.dragOffset=null,this.isResizing=!1,this.resizeHandle=null,this.resizeStartBounds=null,this.isDraggingSelection=!1,this.selectionDragStart=null,this.selectionDragTotal=null,this.lastPointerPosition=null,this.initialDragStartRank=null}initialize(){const t=document.getElementById("notation-grid");if(!(t instanceof HTMLCanvasElement)){E.error("AnnotationService","Pitch grid canvas not found",null,"annotation");return}const e=t.getContext("2d");if(!e){E.error("AnnotationService","Pitch grid context not available",null,"annotation");return}this.canvas=t,this.ctx=e,this.setupEventListeners(),f.on("annotationsChanged",()=>{this.selectedAnnotation=null,this.render()}),f.on("scrollByUnits",s=>{typeof s=="number"&&this.handleSelectionScroll(s)}),E.initSuccess("AnnotationService")}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("dblclick",this.handleDoubleClick.bind(this)),this.canvas.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),this.canvas.addEventListener("contextmenu",t=>t.preventDefault()),this.registerScrollSyncTarget(document.getElementById("pitch-grid-wrapper")),this.registerScrollSyncTarget(document.getElementById("canvas-container")),window.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}),window.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),document.addEventListener("keydown",this.handleKeyDown.bind(this))}handleKeyDown(t){if(!this.selectedAnnotation)return;const e=document.activeElement;if(e instanceof HTMLElement){const s=e.isContentEditable,r=e.tagName.toLowerCase();if(["input","textarea"].includes(r)||s)return}(t.key==="Delete"||t.key==="Backspace")&&(t.preventDefault(),this.deleteSelectedAnnotation())}deleteSelectedAnnotation(){if(!this.selectedAnnotation)return;const t=f.state.annotations.indexOf(this.selectedAnnotation);t>-1&&(f.state.annotations.splice(t,1),this.selectedAnnotation=null,f.recordState(),this.render(),E.log("AnnotationService","Deleted annotation","annotation"))}resize(){const t=document.getElementById("notation-grid");t instanceof HTMLCanvasElement&&(this.canvas.width=t.width,this.canvas.height=t.height,this.render())}getRenderOptions(){return{columnWidths:f.state.columnWidths,cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth}}canvasToGrid(t,e){const s=this.getRenderOptions();return{col:uh(t,s),row:P_(e,s)}}canvasToGridFresh(t,e){const s=this.getRenderOptions(),r=qe.getViewportInfo(),i=s.cellHeight/2;return{col:uh(t,s),row:e/i+r.startRank-1}}gridToCanvas(t,e){const s=this.getRenderOptions();return{x:lt(t,s),y:xt(e,s)}}setTool(t,e){if(this.currentTool=t,this.toolSettings=e,this.canvas)switch(t){case"arrow":case"text":this.canvas.style.cursor="crosshair";break;case"marker":case"highlighter":this.canvas.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><circle cx='8' cy='8' r='4' fill='rgba(0,0,0,0.5)'/></svg>") 8 8, crosshair`;break;case"lasso":this.canvas.style.cursor="crosshair";break;default:this.canvas.style.cursor="default"}}handleMouseDown(t){var A,a,l;if(!this.currentTool||!this.toolSettings)return;const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top;this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY};const i=this.canvasToGridFresh(s,r);if(t.button===2){if(this.currentTool==="lasso"&&((A=f.state.lassoSelection)!=null&&A.isActive)){this.removeFromLassoSelection(s,r);return}this.tempEraserMode=!0,this.isDrawing=!0,this.eraseAtPoint(s,r),this.showEraserCursor(s,r);return}if(((a=this.selectedAnnotation)==null?void 0:a.type)==="text"){const c=this.getResizeHandleAt(s,r,this.selectedAnnotation);if(c){this.isResizing=!0,this.resizeHandle=c,this.resizeStartBounds={col:this.selectedAnnotation.col,row:this.selectedAnnotation.row,widthCols:this.selectedAnnotation.widthCols,heightRows:this.selectedAnnotation.heightRows,mouseCol:i.col,mouseRow:i.row};return}}if((l=f.state.lassoSelection)!=null&&l.isActive&&f.state.lassoSelection.convexHull){const c=lg({x:s,y:r},f.state.lassoSelection.convexHull,10),u=aa({x:s,y:r},f.state.lassoSelection.convexHull);if(c||u){this.isDraggingSelection=!0,this.selectionDragStart={col:i.col,row:i.row},this.selectionDragTotal={col:0,row:0},this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY},this.initialDragStartRank=qe.getViewportInfo().startRank;return}}const o=this.getAnnotationAt(s,r);if(o&&(o.type==="arrow"||o.type==="text")){if(this.selectedAnnotation===o){this.isDragging=!0,o.type==="arrow"?this.dragOffset={startCol:i.col-o.startCol,startRow:i.row-o.startRow,endCol:i.col-o.endCol,endRow:i.row-o.endRow}:o.type==="text"&&(this.dragOffset={col:i.col-o.col,row:i.row-o.row});return}if(this.currentTool==="text"&&o.type==="text"){this.editTextAnnotation(o);return}this.selectedAnnotation=o,this.loadAnnotationSettings(o),this.render();return}else this.selectedAnnotation=null;switch(this.isDrawing=!0,this.startPoint=i,this.currentPath=[i],this.currentTool){case"arrow":this.tempAnnotation={type:"arrow",startCol:i.col,startRow:i.row,endCol:i.col,endRow:i.row,settings:{...this.toolSettings.arrow}};break;case"text":this.tempAnnotation={type:"text",startCol:i.col,startRow:i.row,endCol:i.col,endRow:i.row};break;case"marker":case"highlighter":this.tempAnnotation={type:this.currentTool,path:[i],settings:{...this.toolSettings[this.currentTool]}};break;case"lasso":this.tempAnnotation={type:"lasso",path:[{x:s,y:r}]};break}}handleMouseMove(t){var o;const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top;this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY};const i=this.canvasToGridFresh(s,r);if(this.tempEraserMode){this.eraseAtPoint(s,r),this.showEraserCursor(s,r);return}if(this.isResizing&&((o=this.selectedAnnotation)==null?void 0:o.type)==="text"){if(!this.resizeHandle||!this.resizeStartBounds)return;const A=i.col-this.resizeStartBounds.mouseCol,a=i.row-this.resizeStartBounds.mouseRow;let l=this.resizeStartBounds.col,c=this.resizeStartBounds.row,u=this.resizeStartBounds.widthCols,d=this.resizeStartBounds.heightRows;this.resizeHandle.includes("n")&&(c=this.resizeStartBounds.row+a,d=this.resizeStartBounds.heightRows-a),this.resizeHandle.includes("s")&&(d=this.resizeStartBounds.heightRows+a),this.resizeHandle.includes("w")&&(l=this.resizeStartBounds.col+A,u=this.resizeStartBounds.widthCols-A),this.resizeHandle.includes("e")&&(u=this.resizeStartBounds.widthCols+A);const p=2,h=1;u<p&&(this.resizeHandle.includes("w")&&(l=this.resizeStartBounds.col+this.resizeStartBounds.widthCols-p),u=p),d<h&&(this.resizeHandle.includes("n")&&(c=this.resizeStartBounds.row+this.resizeStartBounds.heightRows-h),d=h),this.selectedAnnotation.col=l,this.selectedAnnotation.row=c,this.selectedAnnotation.widthCols=u,this.selectedAnnotation.heightRows=d,this.render();return}if(this.isDraggingSelection&&this.selectionDragStart&&this.selectionDragTotal){this.applySelectionDrag(s,r);return}if(this.isDragging&&this.selectedAnnotation){this.selectedAnnotation.type==="arrow"?(this.selectedAnnotation.startCol=i.col-this.dragOffset.startCol,this.selectedAnnotation.startRow=i.row-this.dragOffset.startRow,this.selectedAnnotation.endCol=i.col-this.dragOffset.endCol,this.selectedAnnotation.endRow=i.row-this.dragOffset.endRow):this.selectedAnnotation.type==="text"&&(this.selectedAnnotation.col=i.col-this.dragOffset.col,this.selectedAnnotation.row=i.row-this.dragOffset.row),this.render();return}if(!this.isDrawing){this.updateHover(s,r);return}if(this.tempAnnotation)switch(this.currentTool){case"arrow":this.tempAnnotation.endCol=i.col,this.tempAnnotation.endRow=i.row,this.render();break;case"text":this.tempAnnotation.endCol=i.col,this.tempAnnotation.endRow=i.row,this.render();break;case"marker":case"highlighter":if(this.tempAnnotation.path.length>0){const A=this.tempAnnotation.path[this.tempAnnotation.path.length-1],a=this.interpolatePoints(A,i);this.tempAnnotation.path.push(...a)}else this.tempAnnotation.path.push(i);this.render();break;case"lasso":this.tempAnnotation.path.push({x:s,y:r}),this.render();break}}handleMouseUp(t){if(this.isResizing){this.isResizing=!1,this.resizeHandle=null,this.resizeStartBounds=null,f.recordState();return}if(this.isDraggingSelection){this.isDraggingSelection=!1,this.selectionDragStart=null,this.selectionDragTotal=null,this.lastPointerPosition=null,this.initialDragStartRank=null,f.recordState();return}if(this.isDragging){this.isDragging=!1,this.dragOffset=null,f.recordState();return}if(this.isDrawing){if(this.isDrawing=!1,this.tempEraserMode){this.tempEraserMode=!1,this.render();return}if(this.tempAnnotation){if(this.currentTool==="text"){const{startCol:e,startRow:s,endCol:r,endRow:i}=this.tempAnnotation,o=Math.abs(r-e),A=Math.abs(i-s),a=Math.min(e,r),l=Math.min(s,i);o>.5&&A>.2?this.createTextAnnotation(a,l,o,A):this.createTextAnnotation(e,s,8,2),this.tempAnnotation=null,this.render();return}this.currentTool==="lasso"?this.handleLassoSelection(t.shiftKey):(f.state.annotations.push(this.tempAnnotation),this.currentTool==="arrow"&&(this.selectedAnnotation=this.tempAnnotation),f.recordState()),this.tempAnnotation=null,this.render()}}}handleWheel(t){!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal||((t.clientX!==0||t.clientY!==0)&&(this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY}),requestAnimationFrame(()=>this.applySelectionDragFromLastPointer()))}handleScroll(){!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal||requestAnimationFrame(()=>this.applySelectionDragFromLastPointer())}applySelectionDragFromLastPointer(){if(!this.canvas||!this.lastPointerPosition)return;const t=this.canvas.getBoundingClientRect(),e=this.lastPointerPosition.clientX-t.left,s=this.lastPointerPosition.clientY-t.top;this.applySelectionDrag(e,s)}registerScrollSyncTarget(t){t&&(t.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),t.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}))}applySelectionDrag(t,e){if(!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal)return;const s=this.getRenderOptions(),i=qe.getViewportInfo().startRank,o=this.canvasToGridFresh(t,e),{moved:A,nextSelectionDragTotal:a}=EM({selection:f.state.lassoSelection,selectionDragStart:this.selectionDragStart,selectionDragTotal:this.selectionDragTotal,currentPointerGrid:o,initialDragStartRank:this.initialDragStartRank,currentStartRank:i,renderOptions:s});A&&(this.selectionDragTotal.col=a.col,this.selectionDragTotal.row=a.row,this.render())}handleSelectionScroll(t){var s;if(!((s=f.state.lassoSelection)!=null&&s.isActive)||this.isDraggingSelection)return;const e=this.getRenderOptions();f.state.lassoSelection.convexHull=la({selectedItems:f.state.lassoSelection.selectedItems,renderOptions:e}),this.render()}handleMouseLeave(t){this.isDrawing&&this.handleMouseUp(t)}handleDoubleClick(t){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top,i=this.getAnnotationAt(s,r);(i==null?void 0:i.type)==="text"&&this.editTextAnnotation(i)}editTextAnnotation(t){const{col:e,row:s,widthCols:r,heightRows:i,text:o,settings:A}=t,a=f.state.annotations.indexOf(t);a>-1&&(f.state.annotations.splice(a,1),this.selectedAnnotation=null,this.render()),this.createTextAnnotation(e,s,r,i,o,A)}createTextAnnotation(t,e,s,r,i=null,o=null){this.isDrawing=!1;const A=this.gridToCanvas(t,e),a=this.gridToCanvas(t+s,e+r),l=A.x,c=A.y,u=a.x-l,d=a.y-c,h=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',m=o||this.toolSettings.text,g=document.createElement("div");g.contentEditable="true",g.className="annotation-text-input",g.textContent=i||"Type here...";const v=m.size,w=v*1.2;g.style.width=`${u}px`,g.style.height=`${d}px`,g.style.padding=m.background?"4px 8px":"4px",g.style.border="2px dashed rgba(74, 144, 226, 0.5)",g.style.backgroundColor=m.background?"#ffffff":"transparent",g.style.color=m.color,g.style.fontSize=`${v}px`,g.style.lineHeight=`${w}px`,g.style.fontWeight=m.bold?"bold":"normal",g.style.fontStyle=m.italic?"italic":"normal",g.style.textDecoration=m.underline?"underline":"none",m.superscript?(g.style.fontSize=`${v*.6}px`,g.style.verticalAlign="super"):m.subscript&&(g.style.fontSize=`${v*.6}px`,g.style.verticalAlign="sub"),g.style.outline="none",g.style.zIndex="10000",g.style.position="fixed",g.style.cursor="text",g.style.pointerEvents="auto",g.style.fontFamily=h,g.style.whiteSpace="pre-wrap",g.style.wordWrap="break-word",g.style.overflow="hidden",g.style.boxSizing="border-box";const y=this.canvas.getBoundingClientRect();g.style.left=`${y.left+l}px`,g.style.top=`${y.top+c}px`,document.body.appendChild(g),g.focus();const I=document.createRange();I.selectNodeContents(g);const B=window.getSelection();B&&(B.removeAllRanges(),B.addRange(I));let C=!1;const b=()=>{if(C)return;C=!0;const T=g.textContent.trim();if(T&&T!=="Type here..."){const x={type:"text",col:t,row:e,widthCols:s,heightRows:r,text:T,settings:{...m}};f.state.annotations.push(x),this.selectedAnnotation=f.state.annotations[f.state.annotations.length-1],f.recordState(),this.render()}document.body.contains(g)&&document.body.removeChild(g)};let S=!1;g.addEventListener("input",()=>{!S&&g.textContent==="Type here..."&&(g.textContent="",S=!0)}),setTimeout(()=>{g.addEventListener("blur",b)},100),g.addEventListener("keydown",T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),b()),T.key==="Escape"&&(C=!0,document.body.contains(g)&&document.body.removeChild(g))})}handleLassoSelection(t=!1){var s,r;if(!((s=this.tempAnnotation)!=null&&s.path))return;const e=this.getRenderOptions();f.state.lassoSelection=yM({lassoPath:this.tempAnnotation.path,state:f.state,renderOptions:e,isAdditive:t,existingSelectedItems:(r=f.state.lassoSelection)==null?void 0:r.selectedItems}),f.recordState(),E.log("AnnotationService",`Lasso selection completed: ${f.state.lassoSelection.selectedItems.length} items selected`,"annotation"),this.render()}updateLassoConvexHull(){var e,s;if(!((e=f.state.lassoSelection)!=null&&e.isActive)||!((s=f.state.lassoSelection.selectedItems)!=null&&s.length))return;const t=this.getRenderOptions();f.state.lassoSelection.convexHull=la({selectedItems:f.state.lassoSelection.selectedItems,renderOptions:t})}removeFromLassoSelection(t,e){var i;if(!((i=f.state.lassoSelection)!=null&&i.isActive))return;const s=this.getRenderOptions(),r=SM({canvasX:t,canvasY:e,state:f.state,renderOptions:s,selection:f.state.lassoSelection});r!=null&&r.changed&&(f.state.lassoSelection=r.nextSelection,f.recordState(),this.render(),E.log("AnnotationService",`Removed item from lasso selection. ${r.nextSelection.selectedItems.length} items remain.`,"annotation"))}drawTempAnnotation(){if(this.tempAnnotation)switch(this.tempAnnotation.type){case"arrow":this.drawArrow(this.tempAnnotation,!0);break;case"text":this.drawTextBoxPreview(this.tempAnnotation);break;case"marker":this.drawPath(this.tempAnnotation,!1);break;case"highlighter":this.drawPath(this.tempAnnotation,!0);break;case"lasso":this.drawLassoPath(this.tempAnnotation);break}}drawTextBoxPreview(t){const{startX:e,startY:s,endX:r,endY:i}=t,o=this.ctx,A=Math.min(e,r),a=Math.min(s,i),l=Math.abs(r-e),c=Math.abs(i-s);o.save(),o.strokeStyle="rgba(74, 144, 226, 0.6)",o.lineWidth=2,o.setLineDash([5,5]),o.strokeRect(A,a,l,c),this.toolSettings.text.background&&(o.fillStyle="rgba(255, 255, 255, 0.8)",o.fillRect(A,a,l,c)),o.restore()}render(){Vo.render()}drawArrow(t,e=!1,s=!1,r=!1){xM({ctx:this.ctx,annotation:t,isTemp:e,isSelected:s,isHovered:r,getStrokeWidth:this.getStrokeWidth.bind(this),getLineDash:this.getLineDash.bind(this)})}wrapText(t,e,s){const r=e.split(`
`),i=[];return r.forEach(o=>{if(!o.trim()){i.push("");return}const A=o.split(" ");let a="";A.forEach((l,c)=>{const u=a?a+" "+l:l;t.measureText(u).width>s&&a?(i.push(a),a=l):a=u}),a&&i.push(a)}),i}drawText(t,e=!1,s=!1){const{x:r,y:i,text:o,settings:A}=t,a=this.ctx;a.save();const c=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',u=this.getSizeValue(A.size);a.font=`${A.italic?"italic ":""}${A.bold?"bold ":""}${u} ${c}`,a.textBaseline="top";const d=parseInt(u)*1.2,p=t.width||0,h=t.height||0,m=A.background?16:8,g=p-m,v=this.wrapText(a,o,g);if(A.background){a.fillStyle="#ffffff";const y=8;a.fillRect(r-y/2,i-y/2,p+y,h+y/2)}if(s&&!e){a.fillStyle="rgba(74, 144, 226, 0.1)";const y=A.background?8:2;a.fillRect(r-y/2,i-y/2,p+y,h+y/2)}if(e){a.fillStyle="rgba(74, 144, 226, 0.2)";const y=A.background?8:2;a.fillRect(r-y/2,i-y/2,p+y,h+y/2)}a.fillStyle=A.color;const w=parseInt(u);v.forEach((y,I)=>{const B=i+I*d;this.drawTextWithSuperscripts(a,y,r,B,w,A,c)}),e&&this.drawResizeHandles(r,i,p,h),a.restore()}drawTextWithSuperscripts(t,e,s,r,i,o,A){if(o.superscript||o.subscript){t.save();const u=i*.6,d=o.superscript?-i*.4:i*.3;if(t.font=`${o.italic?"italic ":""}${o.bold?"bold ":""}${u}px ${A}`,t.fillText(e,s,r+d),o.underline){const p=t.measureText(e);t.beginPath(),t.strokeStyle=o.color,t.lineWidth=1,t.moveTo(s,r+d+u*1.2-2),t.lineTo(s+p.width,r+d+u*1.2-2),t.stroke()}t.restore();return}let a=s;const l=this.parseFormattedText(e),c=(u,d)=>{const p=u;if(p){if(t.save(),d==="superscript"){const h=i*.6,m=-i*.4;t.font=`${o.italic?"italic ":""}${o.bold?"bold ":""}${h}px ${A}`,t.fillText(p,a,r+m),a+=t.measureText(p).width}else if(d==="subscript"){const h=i*.6,m=i*.3;t.font=`${o.italic?"italic ":""}${o.bold?"bold ":""}${h}px ${A}`,t.fillText(p,a,r+m),a+=t.measureText(p).width}else{if(t.font=`${o.italic?"italic ":""}${o.bold?"bold ":""}${i}px ${A}`,t.fillText(p,a,r),o.underline){const h=t.measureText(p);t.beginPath(),t.strokeStyle=o.color,t.lineWidth=1,t.moveTo(a,r+i*1.2-2),t.lineTo(a+h.width,r+i*1.2-2),t.stroke()}a+=t.measureText(p).width}t.restore()}};l.forEach(u=>{c(u.text,u.format)})}parseFormattedText(t){const e=[];let s=0,r="",i=!1;for(;s<t.length;){if(t.substr(s,5)==="<sup>"){r&&(e.push({text:r,format:"normal"}),r="");const o=t.indexOf("</sup>",s);if(o!==-1){const A=t.substring(s+5,o);e.push({text:A,format:"superscript"}),s=o+6;continue}}if(t.substr(s,5)==="<sub>"){r&&(e.push({text:r,format:"normal"}),r="");const o=t.indexOf("</sub>",s);if(o!==-1){const A=t.substring(s+5,o);e.push({text:A,format:"subscript"}),s=o+6;continue}}if(t[s]==="^"&&!i){r&&(e.push({text:r,format:"normal"}),r=""),i=!0,s++;continue}if(i&&t[s]===" "){r&&(e.push({text:r,format:"superscript"}),r=""),i=!1,e.push({text:" ",format:"normal"}),s++;continue}r+=t[s],s++}return r&&e.push({text:r,format:i?"superscript":"normal"}),e}drawResizeHandles(t,e,s,r){const i=this.ctx,o=8,A=[{pos:"nw",x:t,y:e},{pos:"n",x:t+s/2,y:e},{pos:"ne",x:t+s,y:e},{pos:"e",x:t+s,y:e+r/2},{pos:"se",x:t+s,y:e+r},{pos:"s",x:t+s/2,y:e+r},{pos:"sw",x:t,y:e+r},{pos:"w",x:t,y:e+r/2}];i.save(),A.forEach(a=>{i.fillStyle="#4a90e2",i.strokeStyle="#ffffff",i.lineWidth=2,i.fillRect(a.x-o/2,a.y-o/2,o,o),i.strokeRect(a.x-o/2,a.y-o/2,o,o)}),i.restore()}drawPath(t,e){const{path:s,settings:r}=t,i=this.ctx;if(!(s.length<2)){i.save(),e&&(i.globalAlpha=.3),i.strokeStyle=r.color,i.lineWidth=this.getStrokeWidth(r.size),i.lineCap="round",i.lineJoin="round",i.beginPath(),i.moveTo(s[0].x,s[0].y);for(let o=1;o<s.length;o++)i.lineTo(s[o].x,s[o].y);i.stroke(),i.restore()}}drawLassoPath(t){const{path:e}=t,s=this.ctx;if(!(e.length<2)){s.save(),s.strokeStyle="rgba(0, 100, 255, 0.8)",s.lineWidth=2,s.setLineDash([5,5]),s.beginPath(),s.moveTo(e[0].x,e[0].y);for(let r=1;r<e.length;r++)s.lineTo(e[r].x,e[r].y);s.lineTo(e[0].x,e[0].y),s.stroke(),s.restore()}}getStrokeWidth(t){if(typeof t=="number")return t;switch(t){case"small":return 2;case"medium":return 4;case"large":return 6;default:return 2}}getLineDash(t){switch(t){case"solid":return[];case"dashed-big":return[10,5];case"dashed-small":return[5,3];case"dotted":return[2,3];default:return[]}}getSizeValue(t){if(typeof t=="number")return`${t}px`;switch(t){case"small":return"14px";case"medium":return"18px";case"large":return"24px";default:return"16px"}}updateHover(t,e){var o,A,a,l;const s=this.hoverAnnotation,r=typeof document<"u"&&((A=(o=document.body)==null?void 0:o.dataset)==null?void 0:A.cursorOverride)==="stamp";if(((a=this.selectedAnnotation)==null?void 0:a.type)==="text"){const c=this.getResizeHandleAt(t,e,this.selectedAnnotation);if(c){const u={nw:"nwse-resize",n:"ns-resize",ne:"nesw-resize",e:"ew-resize",se:"nwse-resize",s:"ns-resize",sw:"nesw-resize",w:"ew-resize"};this.canvas.style.cursor=u[c]??"default";return}}if((l=f.state.lassoSelection)!=null&&l.isActive&&f.state.lassoSelection.convexHull){const c=lg({x:t,y:e},f.state.lassoSelection.convexHull,10),u=aa({x:t,y:e},f.state.lassoSelection.convexHull);if(c||u){this.canvas.style.cursor="move";return}}const i=this.getAnnotationAt(t,e);i&&(i.type==="arrow"||i.type==="text")?(r||(this.currentTool==="text"&&i.type==="text"?this.selectedAnnotation===i?this.canvas.style.cursor="move":this.canvas.style.cursor="pointer":this.canvas.style.cursor="move"),this.hoverAnnotation=i):(r||(this.currentTool?this.setTool(this.currentTool,this.toolSettings):s&&(this.canvas.style.cursor="default")),this.hoverAnnotation=null),s!==this.hoverAnnotation&&this.render()}getResizeHandleAt(t,e,s){if((s==null?void 0:s.type)!=="text")return null;const i=8/2+2,o=this.getRenderOptions(),A=lt(s.col,o),a=xt(s.row,o),l=lt(s.col+s.widthCols,o),c=xt(s.row+s.heightRows,o),u=l-A,d=c-a,p=[{pos:"nw",x:A,y:a},{pos:"n",x:A+u/2,y:a},{pos:"ne",x:A+u,y:a},{pos:"e",x:A+u,y:a+d/2},{pos:"se",x:A+u,y:a+d},{pos:"s",x:A+u/2,y:a+d},{pos:"sw",x:A,y:a+d},{pos:"w",x:A,y:a+d/2}];for(const h of p)if(Math.sqrt(Math.pow(t-h.x,2)+Math.pow(e-h.y,2))<=i)return h.pos;return null}getAnnotationAt(t,e){for(let r=f.state.annotations.length-1;r>=0;r--){const i=f.state.annotations[r];if(i.type==="arrow"){if(vB(t,e,i.startX,i.startY,i.endX,i.endY)<10)return i}else if(i.type==="text"){const o=this.getRenderOptions(),A=lt(i.col,o),a=xt(i.row,o),l=lt(i.col+i.widthCols,o),c=xt(i.row+i.heightRows,o),u=l-A,d=c-a;if(t>=A&&t<=A+u&&e>=a&&e<=a+d)return i}}return null}showEraserCursor(t,e){this.render();const r=(f.state.cellWidth||40)*2;this.ctx.save(),this.ctx.fillStyle="rgba(220, 53, 69, 0.3)",this.ctx.fillRect(t-r/2,e-r/2,r,r),this.ctx.restore()}loadAnnotationSettings(t){if(t.type==="arrow"&&window.drawToolsController){const e=t.settings;window.drawToolsController.settings.arrow={...e},window.drawToolsController.renderArrowOptions()}else if(t.type==="text"&&window.drawToolsController){const e=t.settings;window.drawToolsController.settings.text={...e},window.drawToolsController.renderTextOptions()}}applyCurrentSettingsToSelected(){this.selectedAnnotation&&(this.selectedAnnotation.type==="arrow"&&this.toolSettings.arrow?(this.selectedAnnotation.settings={...this.toolSettings.arrow},this.render()):this.selectedAnnotation.type==="text"&&this.toolSettings.text&&(this.selectedAnnotation.settings={...this.toolSettings.text},this.render()))}clearAnnotations(){f.state.annotations=[],this.render()}eraseAtPoint(t,e){const{nextAnnotations:s,changed:r}=bM({x:t,y:e,annotations:f.state.annotations,getRenderOptions:()=>this.getRenderOptions()});return f.state.annotations=s,r&&this.render(),r}interpolatePoints(t,e){const s=[],r=e.col-t.col,i=e.row-t.row,o=Math.sqrt(r*r+i*i),A=Math.max(1,Math.floor(o/.1));for(let a=1;a<=A;a++){const l=a/A;s.push({col:t.col+l*r,row:t.row+l*i})}return s}deleteAnnotationAt(t,e){this.eraseAtPoint(t,e)}getAnnotations(){return f.state.annotations}loadAnnotations(t){f.state.annotations=t||[],this.render()}applyInlineFormatting(t){const e=document.querySelector(".annotation-text-input");if(!e)return;const s=window.getSelection();if(!s||!s.rangeCount)return;const r=s.getRangeAt(0),i=r.toString();if(!i)return;let o;if(t==="superscript")o=`<sup>${i}</sup>`;else if(t==="subscript")o=`<sub>${i}</sub>`;else return;r.deleteContents();const A=document.createTextNode(o);r.insertNode(A),r.setStartAfter(A),r.setEndAfter(A),s.removeAllRanges(),s.addRange(r),e instanceof HTMLElement&&e.focus()}}const Jt=new IM;function dg(n){if((n==null?void 0:n.type)!=="arrow")return!1;const t=n,e=t.settings;return typeof t.startCol=="number"&&typeof t.startRow=="number"&&typeof t.endCol=="number"&&typeof t.endRow=="number"&&!!e&&typeof e.strokeWeight=="number"&&typeof e.lineStyle=="string"}function hg(n){if((n==null?void 0:n.type)!=="text")return!1;const t=n,e=t.settings;return typeof t.col=="number"&&typeof t.row=="number"&&typeof t.widthCols=="number"&&typeof t.heightRows=="number"&&typeof t.text=="string"&&!!e&&typeof e.size=="number"&&typeof e.color=="string"}function FM(n){if((n==null?void 0:n.type)!=="text")return!1;const t=n,e=typeof n.col=="number";return typeof t.startCol=="number"&&typeof t.startRow=="number"&&typeof t.endCol=="number"&&typeof t.endRow=="number"&&!e}function fg(n){if(!n||n.type!=="marker"&&n.type!=="highlighter")return!1;const t=n,e=t.settings;return Array.isArray(t.path)&&!!e&&typeof e.color=="string"&&(typeof e.size=="number"||e.size==="small"||e.size==="medium"||e.size==="large")}function TM(n){return(n==null?void 0:n.type)==="lasso"&&Array.isArray(n.path)}function _M(n,t){const e=f.state.annotations,s=Jt.tempAnnotation,r=Jt.selectedAnnotation,i=Jt.hoverAnnotation;if(e&&e.length>0&&e.forEach(A=>{const a=A===r,l=A===i;switch(A.type){case"arrow":dg(A)&&pg(n,A,a,l,t);break;case"text":hg(A)&&gg(n,A,a,l,t);break;case"marker":case"highlighter":fg(A)&&vg(n,A,t);break}}),s)switch(s.type){case"arrow":dg(s)&&pg(n,s,!1,!1,t);break;case"text":FM(s)?NM(n,s,t):hg(s)&&gg(n,s,!1,!1,t);break;case"marker":case"highlighter":fg(s)&&vg(n,s,t);break;case"lasso":TM(s)&&LM(n,s);break}const o=f.state.lassoSelection;o!=null&&o.isActive&&Array.isArray(o.convexHull)&&(Jt.updateLassoConvexHull(),kM(n,o.convexHull))}function pg(n,t,e=!1,s=!1,r){const{startCol:i,startRow:o,endCol:A,endRow:a,settings:l}=t,c=lt(i,r),u=xt(o,r),d=lt(A,r),p=xt(a,r);n.save(),n.strokeStyle=t.color||"#000000",n.lineWidth=gh(l.strokeWeight),n.setLineDash(DM(l.lineStyle));const h=Math.atan2(p-u,d-c),m=l.arrowheadSize||12;let g=c,v=u,w=d,y=p;l.startArrowhead&&l.startArrowhead!=="none"&&(g=c+Math.cos(h)*m,v=u+Math.sin(h)*m),l.endArrowhead&&l.endArrowhead!=="none"&&(w=d-Math.cos(h)*m,y=p-Math.sin(h)*m),n.beginPath(),n.moveTo(g,v),n.lineTo(w,y),n.stroke(),n.setLineDash([]),l.startArrowhead&&l.startArrowhead!=="none"&&mg(n,c,u,h+Math.PI,l.startArrowhead,m),l.endArrowhead&&l.endArrowhead!=="none"&&mg(n,d,p,h,l.endArrowhead,m),(e||s)&&(n.strokeStyle=e?"rgba(74, 144, 226, 0.6)":"rgba(74, 144, 226, 0.3)",n.lineWidth=gh(l.strokeWeight)+4,n.setLineDash([]),n.beginPath(),n.moveTo(c,u),n.lineTo(d,p),n.stroke()),n.restore()}function mg(n,t,e,s,r,i){switch(n.save(),n.translate(t,e),n.rotate(s),r){case"filled":case"filled-arrow":n.beginPath(),n.moveTo(0,0),n.lineTo(-i,-i/2),n.lineTo(-i,i/2),n.closePath(),n.fillStyle=n.strokeStyle,n.fill();break;case"unfilled":case"unfilled-arrow":n.beginPath(),n.moveTo(0,0),n.lineTo(-i,-i/2),n.lineTo(-i,i/2),n.closePath(),n.stroke();break;case"circle":n.beginPath(),n.arc(0,0,i/3,0,Math.PI*2),n.fillStyle=n.strokeStyle,n.fill();break}n.restore()}function gg(n,t,e=!1,s=!1,r){const{col:i,row:o,text:A,widthCols:a,heightRows:l,settings:c}=t,u=lt(i,r),d=xt(o,r),p=lt(i+(typeof a=="number"?a:2),r)-u,h=xt(o+(typeof l=="number"?l:1),r)-d;n.save(),n.textBaseline="top";const g=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',v=c.size,w=v*1.2,y=c.background?8:4,I=4,B=p-y*2,C=MM(n,A,B,v,c,g);c.background&&(n.fillStyle="#ffffff",n.fillRect(u,d,p,h)),s&&!e&&(n.fillStyle="rgba(74, 144, 226, 0.1)",n.fillRect(u,d,p,h)),e&&(n.fillStyle="rgba(74, 144, 226, 0.2)",n.fillRect(u,d,p,h)),n.fillStyle=c.color,C.forEach((b,S)=>{const T=d+I+S*w;QM(n,b,u+y,T,v,c,g)}),e&&PM(n,u,d,p,h),n.restore()}function MM(n,t,e,s,r,i){n.font=`${r.italic?"italic ":""}${r.bold?"bold ":""}${s}px ${i}`;const o=t.split(`
`),A=[];return o.forEach(a=>{if(!a.trim()){A.push("");return}const l=a.split(" ");let c="";l.forEach(u=>{const d=c?c+" "+u:u;n.measureText(d).width>e&&c?(A.push(c),c=u):c=d}),c&&A.push(c)}),A}function QM(n,t,e,s,r,i,o){if(i.superscript||i.subscript){n.save();const l=r*.6,c=i.superscript?-r*.4:r*.3;if(n.font=`${i.italic?"italic ":""}${i.bold?"bold ":""}${l}px ${o}`,n.fillText(t,e,s+c),i.underline){const u=n.measureText(t);n.beginPath(),n.strokeStyle=i.color,n.lineWidth=1,n.moveTo(e,s+c+l*1.2-2),n.lineTo(e+u.width,s+c+l*1.2-2),n.stroke()}n.restore();return}const A=UM(t);let a=e;A.forEach(l=>{if(n.save(),l.format==="superscript"){const c=r*.6,u=-r*.4;n.font=`${i.italic?"italic ":""}${i.bold?"bold ":""}${c}px ${o}`,n.fillText(l.text,a,s+u),a+=n.measureText(l.text).width}else if(l.format==="subscript"){const c=r*.6,u=r*.3;n.font=`${i.italic?"italic ":""}${i.bold?"bold ":""}${c}px ${o}`,n.fillText(l.text,a,s+u),a+=n.measureText(l.text).width}else{if(n.font=`${i.italic?"italic ":""}${i.bold?"bold ":""}${r}px ${o}`,n.fillText(l.text,a,s),i.underline){const c=n.measureText(l.text);n.beginPath(),n.strokeStyle=i.color,n.lineWidth=1,n.moveTo(a,s+r*1.2-2),n.lineTo(a+c.width,s+r*1.2-2),n.stroke()}a+=n.measureText(l.text).width}n.restore()})}function UM(n){const t=[];let e=0,s="",r=!1;for(;e<n.length;){if(n.substr(e,5)==="<sup>"){s&&(t.push({text:s,format:"normal"}),s="");const i=n.indexOf("</sup>",e);if(i!==-1){const o=n.substring(e+5,i);t.push({text:o,format:"superscript"}),e=i+6;continue}}if(n.substr(e,5)==="<sub>"){s&&(t.push({text:s,format:"normal"}),s="");const i=n.indexOf("</sub>",e);if(i!==-1){const o=n.substring(e+5,i);t.push({text:o,format:"subscript"}),e=i+6;continue}}if(n[e]==="^"&&!r){s&&(t.push({text:s,format:"normal"}),s=""),r=!0,e++;continue}if(r&&n[e]===" "){s&&(t.push({text:s,format:"superscript"}),s=""),r=!1,t.push({text:" ",format:"normal"}),e++;continue}s+=n[e],e++}return s&&t.push({text:s,format:r?"superscript":"normal"}),t}function PM(n,t,e,s,r){const o=[{x:t,y:e},{x:t+s/2,y:e},{x:t+s,y:e},{x:t+s,y:e+r/2},{x:t+s,y:e+r},{x:t+s/2,y:e+r},{x:t,y:e+r},{x:t,y:e+r/2}];n.save(),o.forEach(A=>{n.fillStyle="#4a90e2",n.strokeStyle="#ffffff",n.lineWidth=2,n.fillRect(A.x-8/2,A.y-8/2,8,8),n.strokeRect(A.x-8/2,A.y-8/2,8,8)}),n.restore()}function NM(n,t,e){const{startCol:s,startRow:r,endCol:i,endRow:o}=t,A=lt(s,e),a=xt(r,e),l=lt(i,e),c=xt(o,e),u=Math.min(A,l),d=Math.min(a,c),p=Math.abs(l-A),h=Math.abs(c-a);n.save(),n.strokeStyle="rgba(74, 144, 226, 0.6)",n.lineWidth=2,n.setLineDash([5,5]),n.strokeRect(u,d,p,h),n.restore()}function vg(n,t,e){const{path:s,settings:r,type:i}=t;if(!s||s.length<2)return;const o=s.map(a=>({x:lt(a.col,e),y:xt(a.row,e)}));n.save(),i==="highlighter"&&(n.globalAlpha=.3),n.strokeStyle=r.color,n.lineWidth=typeof r.size=="number"?r.size:gh(r.size),n.lineCap="round",n.lineJoin="round",n.beginPath();const A=o[0];if(!A){n.restore();return}n.moveTo(A.x,A.y);for(let a=1;a<o.length;a++){const l=o[a];l&&n.lineTo(l.x,l.y)}n.stroke(),n.restore()}function gh(n){if(typeof n=="number")return n;switch(n){case"small":return 2;case"medium":return 4;case"large":return 6;default:return 4}}function DM(n){switch(n){case"solid":return[];case"dashed-big":return[10,5];case"dashed-small":return[5,3];case"dotted":return[2,3];default:return[]}}function LM(n,t){const e=t.path;if(!e||e.length<2)return;const s=e[0];if(s){n.save(),n.strokeStyle="#4a90e2",n.lineWidth=2,n.setLineDash([5,5]),n.globalAlpha=.7,n.beginPath(),n.moveTo(s.x,s.y);for(let r=1;r<e.length;r++){const i=e[r];i&&n.lineTo(i.x,i.y)}e.length>2&&n.lineTo(s.x,s.y),n.stroke(),n.restore()}}function kM(n,t){if(!t||t.length<3)return;const e=t[0];if(e){n.save(),n.strokeStyle="#4a90e2",n.lineWidth=2,n.setLineDash([8,4]),n.globalAlpha=.8,n.beginPath(),n.moveTo(e.x,e.y);for(let s=1;s<t.length;s++){const r=t[s];r&&n.lineTo(r.x,r.y)}n.closePath(),n.stroke(),n.fillStyle="rgba(74, 144, 226, 0.1)",n.fill(),n.restore()}}let wg=0;function wB(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let RM=!1;function HM(n,t){var e;if(wB())try{const s=((e=performance==null?void 0:performance.now)==null?void 0:e.call(performance))??Date.now();if(s-wg<500)return;wg=s,RM=!0}catch{}}function OM(n,t){var m,g,v,w,y,I;const e={...f.state,...t};if(!((m=e.columnWidths)!=null&&m.length)||!((g=e.fullRowData)!=null&&g.length))return;n.clearRect(0,0,$e(n.canvas),ie(n.canvas));const{startRow:s,endRow:r}=U_(),i=Math.max(0,s-1),o=Math.max(0,(((v=e.fullRowData)==null?void 0:v.length)??1)-1),A=Math.min(o,r+1);if(wB()){const B=ie(n.canvas),C=e.cellHeight/2,b=xt(r,e),S=b+C,T=((w=e.fullRowData)==null?void 0:w.length)??0,x=s<=0,_=T>0?r>=T-1:!1,F=(y=e.fullRowData)==null?void 0:y[s],Q=(I=e.fullRowData)==null?void 0:I[r];HM("pitchCanvasCoverage",{startRow:s,endRow:r,paddedStartRow:i,paddedEndRow:A,atTopGamutEdge:x,atBottomGamutEdge:_,canvasHeight:B,containerHeight:e.viewportHeight,halfUnit:C,yEnd:b,bottomEdge:S,gapCanvasMinusBottomEdge:B-S,gapCanvasMinusContainer:B-e.viewportHeight,startRowSummary:F?{pitch:F.pitch,column:F.column,isBoundary:!!F.isBoundary}:null,endRowSummary:Q?{pitch:Q.pitch,column:Q.column,isBoundary:!!Q.isBoundary}:null})}const a=e.cellHeight,l=B=>{const C=xt(B,e);return C>=-a&&C<=e.viewportHeight+a},c=e.placedTonicSigns.filter(B=>B.globalRow===void 0?!1:l(B.globalRow)),u=oa.getLegendLeftContext(),d=oa.getLegendRightContext();J_(u,d,e,i,A),V_(n,e,i,A),W_(n,e);const p=t.placedNotes.filter(B=>B.isDrum||B.globalRow===void 0?!1:l(B.globalRow)),h=c;p.forEach(B=>{B.shape==="oval"?Bp(n,e,B,B.globalRow):B.shape==="circle"&&wp(n,e,B,B.globalRow)}),h.forEach(B=>{hB(n,e,B)}),oM(n,e),lM(n,e),gB(n,e),_M(n,e)}const BB={getTimeSignatureSegments(){const n=f.state,t=n.macrobeatGroupings??[],e=n.macrobeatBoundaryStyles??[],s=[];let r=!!n.hasAnacrusis,i=mn(n,0).startColumn,o=0,A=!1;return t.forEach((a,l)=>{o+=a,a===3&&(A=!0);const c=l===t.length-1,d=e[l]==="solid";if(d||c){const h=mn(n,l).endColumn+1,m=Array.isArray(n.tempoModulationMarkers)&&n.tempoModulationMarkers.length>0,g={...n,tempoModulationMarkers:m?n.tempoModulationMarkers:[],cellWidth:n.cellWidth,columnWidths:n.columnWidths,musicalColumnWidths:n.musicalColumnWidths,baseMicrobeatPx:n.cellWidth},v=lt(i,g),w=lt(h,g),y=A?`${o}/8`:`${o/2}/4`;s.push({label:y,centerX:(v+w)/2,startX:v,endX:w,isAnacrusis:r}),c||(i=h,o=0,A=!1,d&&(r=!1))}}),s},getRhythmUIButtons(){const n=f.state,t=n.macrobeatGroupings??[],e=n.macrobeatBoundaryStyles??[],s=[],r=Ye(n),i=new Set(r.map(o=>o.columnIndex+2));return t.forEach((o,A)=>{const a=mn(n,A),{startColumn:l,endColumn:c}=a,u={...n,tempoModulationMarkers:n.tempoModulationMarkers||[],cellWidth:n.cellWidth,columnWidths:n.columnWidths,musicalColumnWidths:n.columnWidths,baseMicrobeatPx:n.cellWidth},d=lt(l,u),p=lt(c+1,u),h=(d+p)/2,m=e[A]??null,g=A>0?e[A-1]??null:null,v=g!==null&&i.has(l);s.push({type:"grouping",content:o,x:h,startX:d,endX:p,index:A,nextBoundaryStyle:m,prevBoundaryStyle:g,hasLeftDivider:v}),A<t.length-1&&s.push({type:"boundary",boundaryStyle:m,x:p,index:A})}),s}},VM="data-rhythm-ui-element",vh=n=>`${Math.round(n*100)/100}px`,WM=n=>{n.querySelectorAll(`[${VM}]`).forEach(t=>t.remove())},GM=n=>{const t=document.getElementById("notation-grid");if(!t)return null;const e=t.getBoundingClientRect(),s=n.getBoundingClientRect();return e.width===0?null:e.left-s.left},KM=(n,t)=>{const e=document.createElement("button");return e.type="button",e.className="grouping-segment",e.dataset.rhythmUiElement="grouping",e.dataset.index=`${n.index}`,e.textContent=`${n.content}`,e.style.left=vh(t+n.startX),e.style.width=vh(Math.max(0,n.endX-n.startX)),e.dataset.nextBoundaryStyle=`${n.nextBoundaryStyle??""}`,e.dataset.prevBoundaryStyle=`${n.prevBoundaryStyle??""}`,e.dataset.hasLeftDivider=n.hasLeftDivider?"true":"false",e.setAttribute("aria-label",`Toggle macrobeat grouping (${n.content}) at position ${n.index+1}`),e.addEventListener("click",s=>{s.stopPropagation(),f.toggleMacrobeatGrouping(n.index)}),e},qM=(n,t)=>{const e=document.createElement("button");e.type="button",e.className="buttonGrid-ui-button buttonGrid-ui-button--boundary",e.dataset.rhythmUiElement="boundary",e.dataset.index=`${n.index}`,e.style.left=vh(t+n.x),e.setAttribute("aria-label","Cycle boundary style");const s=document.createElement("span");return s.className="boundary-diamond",s.dataset.style=n.boundaryStyle||"dashed",e.appendChild(s),e.addEventListener("click",r=>{r.stopPropagation(),f.cycleMacrobeatBoundaryStyle(n.index)}),e};function CB(){const n=document.getElementById("beat-line-button-layer");if(!n){E.warn("rhythmUI","Cannot render rhythm UI without beat-line container",null,"ui");return}const t=GM(n);if(t===null)return;const e=n.querySelector("#grouping-buttons-row"),s=n.querySelector("#boundary-buttons-row");WM(n);const r=BB.getRhythmUIButtons();if(!Array.isArray(r)||r.length===0)return;const i=document.createDocumentFragment(),o=document.createDocumentFragment();r.forEach(A=>{A.type==="grouping"?i.appendChild(KM(A,t)):A.type==="boundary"&&o.appendChild(qM(A,t))}),e?e.appendChild(i):n.appendChild(i),s?s.appendChild(o):n.appendChild(o)}const zM={init:$M};function $M(){CB()}const XM={getTimeSignatureOptions(){return{"Single Macrobeat":[{label:"1/4",groupings:[2],description:"one 2-beat"},{label:"2/8",groupings:[2],description:"one 2-beat"},{label:"3/8",groupings:[3],description:"one 3-beat"}],"Two Macrobeats":[{label:"2/4",groupings:[2,2],description:"two 2-beats"},{label:"4/8",groupings:[2,2],description:"two 2-beats"},{label:"5/8",groupings:[2,3],description:"2+3"},{label:"5/8",groupings:[3,2],description:"3+2"},{label:"6/8",groupings:[3,3],description:"two 3-beats"}],"Three Macrobeats":[{label:"3/4",groupings:[2,2,2],description:"three 2-beats"},{label:"7/8",groupings:[2,2,3],description:"2+2+3"},{label:"7/8",groupings:[3,2,2],description:"3+2+2"},{label:"7/8",groupings:[2,3,2],description:"2+3+2"},{label:"8/8",groupings:[3,3,2],description:"3+3+2"},{label:"8/8",groupings:[3,2,3],description:"3+2+3"},{label:"8/8",groupings:[2,3,3],description:"2+3+3"},{label:"9/8",groupings:[3,3,3],description:"three 3-beats"}],"Four Macrobeats":[{label:"4/4",groupings:[2,2,2,2],description:"four 2-beats"},{label:"10/8",groupings:[2,2,3,3],description:"2+2+3+3"},{label:"10/8",groupings:[2,3,2,3],description:"2+3+2+3"},{label:"10/8",groupings:[2,3,3,2],description:"2+3+3+2"},{label:"10/8",groupings:[3,2,3,2],description:"3+2+3+2"},{label:"10/8",groupings:[3,3,2,2],description:"3+3+2+2"},{label:"10/8",groupings:[3,2,2,3],description:"3+2+2+3"},{label:"11/8",groupings:[3,3,3,2],description:"3+3+3+2"},{label:"11/8",groupings:[3,3,2,3],description:"3+3+2+3"},{label:"11/8",groupings:[3,2,3,3],description:"3+2+3+3"},{label:"11/8",groupings:[2,3,3,3],description:"2+3+3+3"},{label:"12/8",groupings:[3,3,3,3],description:"four 3-beats"}],"Five Macrobeats":[{label:"5/4",groupings:[2,2,2,2,2],description:"five 2-beats"},{label:"11/8",groupings:[2,2,2,2,3],description:"2+2+2+2+3"},{label:"11/8",groupings:[2,2,2,3,2],description:"2+2+2+3+2"},{label:"11/8",groupings:[2,2,3,2,2],description:"2+2+3+2+2"},{label:"11/8",groupings:[2,3,2,2,2],description:"2+3+2+2+2"},{label:"11/8",groupings:[3,2,2,2,2],description:"3+2+2+2+2"},{label:"12/8",groupings:[2,2,2,3,3],description:"2+2+2+3+3"},{label:"12/8",groupings:[2,2,3,2,3],description:"2+2+3+2+3"},{label:"12/8",groupings:[2,2,3,3,2],description:"2+2+3+3+2"},{label:"12/8",groupings:[2,3,2,2,3],description:"2+3+2+2+3"},{label:"12/8",groupings:[2,3,2,3,2],description:"2+3+2+3+2"},{label:"12/8",groupings:[2,3,3,2,2],description:"2+3+3+2+2"},{label:"12/8",groupings:[3,2,2,2,3],description:"3+2+2+2+3"},{label:"12/8",groupings:[3,2,2,3,2],description:"3+2+2+3+2"},{label:"12/8",groupings:[3,2,3,2,2],description:"3+2+3+2+2"},{label:"12/8",groupings:[3,3,2,2,2],description:"3+3+2+2+2"},{label:"13/8",groupings:[3,2,2,3,3],description:"3+2+2+3+3"},{label:"13/8",groupings:[3,3,2,3,2],description:"3+3+2+3+2"},{label:"13/8",groupings:[3,3,3,2,2],description:"3+3+3+2+2"},{label:"15/8",groupings:[3,3,3,3,3],description:"five 3-beats"}]}},generateDropdownHTML(){const n=this.getTimeSignatureOptions();let t='<div id="time-signature-dropdown" class="time-signature-dropdown hidden">';return Object.entries(n).forEach(([e,s])=>{t+='<div class="dropdown-category">',t+=`<div class="dropdown-category-header">${e}</div>`,s.forEach((r,i)=>{const o=`${e}-${i}`;t+=`<div class="dropdown-option" data-groupings="${JSON.stringify(r.groupings)}" data-key="${o}">`,t+=`<span class="dropdown-label">${r.label}</span>`,t+=`<span class="dropdown-description">${r.description}</span>`,t+="</div>"}),t+="</div>"}),t+="</div>",t},getTimeSignatureLabel(n){const t=n.reduce((s,r)=>s+r,0);return n.includes(3)?`${t}/8`:`${t/2}/4`}};let ho=null;function YM(){const n=document.getElementById("beat-line-button-layer");if(!n)return;const t=n.querySelector("#time-signature-row")||n;n.querySelectorAll(".time-signature-label").forEach(a=>a.remove());const s=document.getElementById("notation-grid");if(!s)return;const r=s.getBoundingClientRect(),i=n.getBoundingClientRect(),o=r.left-i.left;BB.getTimeSignatureSegments().forEach((a,l)=>{const c=document.createElement("div");c.className="time-signature-label",a.isAnacrusis&&c.classList.add("anacrusis-label"),c.textContent=a.label,c.style.position="absolute",c.style.left=`${o+a.startX}px`,c.style.width=`${Math.max(0,a.endX-a.startX)}px`,c.style.transform="none",c.style.pointerEvents="auto",c.addEventListener("click",u=>{u.stopPropagation(),JM(c,l)}),t.appendChild(c)}),jM()}function jM(){if(!document.getElementById("time-signature-dropdown")){const n=XM.generateDropdownHTML();document.body.insertAdjacentHTML("beforeend",n);const t=document.getElementById("time-signature-dropdown");t==null||t.addEventListener("click",tQ)}}function JM(n,t){const e=document.getElementById("time-signature-dropdown");if(!e)return;e.dataset.measureIndex=String(t);const s=n.getBoundingClientRect();e.style.left=`${s.left}px`,e.style.top=`${s.bottom+5}px`;const r=e.getBoundingClientRect(),i=window.innerWidth,o=window.innerHeight;s.left+r.width>i&&(e.style.left=`${i-r.width-10}px`),s.bottom+r.height>o&&(e.style.top=`${s.top-r.height-5}px`),e.classList.remove("hidden"),ho={dropdown:e,measureIndex:t},setTimeout(()=>{document.addEventListener("click",ZM,{once:!0})},0)}function ZM(n){const t=document.getElementById("time-signature-dropdown"),e=n.target;t&&e&&!t.contains(e)&&(t.classList.add("hidden"),ho=null)}function tQ(n){const t=n.target,e=t==null?void 0:t.closest(".dropdown-option");if(!e)return;const s=e.dataset.groupings,r=(ho==null?void 0:ho.measureIndex)??NaN;if(!(!s||Number.isNaN(r)))try{const i=JSON.parse(s);f.updateTimeSignature(r,i);const o=document.getElementById("time-signature-dropdown");o==null||o.classList.add("hidden"),ho=null}catch{}}E.moduleLoaded("PitchGridController","grid");function eQ(){var s,r;const n=oa.getPitchContext();if(!(n!=null&&n.canvas)){E.error("PitchGridController","Pitch grid context not available for rendering",null,"grid");return}const t=qe.getViewportInfo(),e={placedNotes:HT(f.state),placedTonicSigns:Ye(f.state),fullRowData:f.state.fullRowData,columnWidths:f.state.columnWidths,cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,rowHeight:f.state.cellHeight*.5,macrobeatGroupings:f.state.macrobeatGroupings,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles,accidentalMode:f.state.accidentalMode,showFrequencyLabels:f.state.showFrequencyLabels,showOctaveLabels:f.state.showOctaveLabels,colorMode:"color",degreeDisplayMode:f.state.degreeDisplayMode,zoomLevel:t.zoomLevel,viewportHeight:t.containerHeight,tempoModulationMarkers:f.state.tempoModulationMarkers,showModulationLabel:!1};E.debug("PitchGridController","renderPitchGrid options",{columns:(s=e.columnWidths)==null?void 0:s.length,rows:(r=e.fullRowData)==null?void 0:r.length,placedNotes:e.placedNotes.length,tonicSigns:e.placedTonicSigns.length,zoomLevel:e.zoomLevel,viewportHeight:e.viewportHeight},"grid"),OM(n,e)}const Vo={render(){eQ()},renderMacrobeatTools(){CB(),YM()}};/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wh=function(n,t){return wh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])},wh(n,t)};function hs(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");wh(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Bh=function(){return Bh=Object.assign||function(t){for(var e,s=1,r=arguments.length;s<r;s++){e=arguments[s];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Bh.apply(this,arguments)};function Ze(n,t,e,s){function r(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function A(c){try{l(s.next(c))}catch(u){o(u)}}function a(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?i(c.value):r(c.value).then(A,a)}l((s=s.apply(n,[])).next())})}function Oe(n,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,r,i,o;return o={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function A(l){return function(c){return a([l,c])}}function a(l){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,r&&(i=l[0]&2?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,r=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){e.label=l[1];break}if(l[0]===6&&e.label<i[1]){e.label=i[1],i=l;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(l);break}i[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(n,e)}catch(c){l=[6,c],r=0}finally{s=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function nl(n,t,e){if(arguments.length===2)for(var s=0,r=t.length,i;s<r;s++)(i||!(s in t))&&(i||(i=Array.prototype.slice.call(t,0,s)),i[s]=t[s]);return n.concat(i||t)}var cr=(function(){function n(t,e,s,r){this.left=t,this.top=e,this.width=s,this.height=r}return n.prototype.add=function(t,e,s,r){return new n(this.left+t,this.top+e,this.width+s,this.height+r)},n.fromClientRect=function(t,e){return new n(e.left+t.windowBounds.left,e.top+t.windowBounds.top,e.width,e.height)},n.fromDOMRectList=function(t,e){var s=Array.from(e).find(function(r){return r.width!==0});return s?new n(s.left+t.windowBounds.left,s.top+t.windowBounds.top,s.width,s.height):n.EMPTY},n.EMPTY=new n(0,0,0,0),n})(),Iu=function(n,t){return cr.fromClientRect(n,t.getBoundingClientRect())},nQ=function(n){var t=n.body,e=n.documentElement;if(!t||!e)throw new Error("Unable to get document size");var s=Math.max(Math.max(t.scrollWidth,e.scrollWidth),Math.max(t.offsetWidth,e.offsetWidth),Math.max(t.clientWidth,e.clientWidth)),r=Math.max(Math.max(t.scrollHeight,e.scrollHeight),Math.max(t.offsetHeight,e.offsetHeight),Math.max(t.clientHeight,e.clientHeight));return new cr(0,0,s,r)},Fu=function(n){for(var t=[],e=0,s=n.length;e<s;){var r=n.charCodeAt(e++);if(r>=55296&&r<=56319&&e<s){var i=n.charCodeAt(e++);(i&64512)===56320?t.push(((r&1023)<<10)+(i&1023)+65536):(t.push(r),e--)}else t.push(r)}return t},ue=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,n);var e=n.length;if(!e)return"";for(var s=[],r=-1,i="";++r<e;){var o=n[r];o<=65535?s.push(o):(o-=65536,s.push((o>>10)+55296,o%1024+56320)),(r+1===e||s.length>16384)&&(i+=String.fromCharCode.apply(String,s),s.length=0)}return i},Bg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",sQ=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var sl=0;sl<Bg.length;sl++)sQ[Bg.charCodeAt(sl)]=sl;var Cg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pA=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var rl=0;rl<Cg.length;rl++)pA[Cg.charCodeAt(rl)]=rl;var rQ=function(n){var t=n.length*.75,e=n.length,s,r=0,i,o,A,a;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);var l=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),c=Array.isArray(l)?l:new Uint8Array(l);for(s=0;s<e;s+=4)i=pA[n.charCodeAt(s)],o=pA[n.charCodeAt(s+1)],A=pA[n.charCodeAt(s+2)],a=pA[n.charCodeAt(s+3)],c[r++]=i<<2|o>>4,c[r++]=(o&15)<<4|A>>2,c[r++]=(A&3)<<6|a&63;return l},iQ=function(n){for(var t=n.length,e=[],s=0;s<t;s+=2)e.push(n[s+1]<<8|n[s]);return e},oQ=function(n){for(var t=n.length,e=[],s=0;s<t;s+=4)e.push(n[s+3]<<24|n[s+2]<<16|n[s+1]<<8|n[s]);return e},Ei=5,bp=11,hd=2,AQ=bp-Ei,bB=65536>>Ei,aQ=1<<Ei,fd=aQ-1,lQ=1024>>Ei,cQ=bB+lQ,uQ=cQ,dQ=32,hQ=uQ+dQ,fQ=65536>>bp,pQ=1<<AQ,mQ=pQ-1,bg=function(n,t,e){return n.slice?n.slice(t,e):new Uint16Array(Array.prototype.slice.call(n,t,e))},gQ=function(n,t,e){return n.slice?n.slice(t,e):new Uint32Array(Array.prototype.slice.call(n,t,e))},vQ=function(n,t){var e=rQ(n),s=Array.isArray(e)?oQ(e):new Uint32Array(e),r=Array.isArray(e)?iQ(e):new Uint16Array(e),i=24,o=bg(r,i/2,s[4]/2),A=s[5]===2?bg(r,(i+s[4])/2):gQ(s,Math.ceil((i+s[4])/4));return new wQ(s[0],s[1],s[2],s[3],o,A)},wQ=(function(){function n(t,e,s,r,i,o){this.initialValue=t,this.errorValue=e,this.highStart=s,this.highValueIndex=r,this.index=i,this.data=o}return n.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>Ei],e=(e<<hd)+(t&fd),this.data[e];if(t<=65535)return e=this.index[bB+(t-55296>>Ei)],e=(e<<hd)+(t&fd),this.data[e];if(t<this.highStart)return e=hQ-fQ+(t>>bp),e=this.index[e],e+=t>>Ei&mQ,e=this.index[e],e=(e<<hd)+(t&fd),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},n})(),yg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BQ=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var il=0;il<yg.length;il++)BQ[yg.charCodeAt(il)]=il;var CQ="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Sg=50,bQ=1,yB=2,SB=3,yQ=4,SQ=5,Eg=7,EB=8,xg=9,Ur=10,Ch=11,Ig=12,bh=13,EQ=14,mA=15,yh=16,ol=17,iA=18,xQ=19,Fg=20,Sh=21,oA=22,pd=23,zi=24,bn=25,gA=26,vA=27,$i=28,IQ=29,ai=30,FQ=31,Al=32,al=33,Eh=34,xh=35,Ih=36,ca=37,Fh=38,ql=39,zl=40,md=41,xB=42,TQ=43,_Q=[9001,65288],IB="!",Tt="",ll="",Th=vQ(CQ),Vs=[ai,Ih],_h=[bQ,yB,SB,SQ],FB=[Ur,EB],Tg=[vA,gA],MQ=_h.concat(FB),_g=[Fh,ql,zl,Eh,xh],QQ=[mA,bh],UQ=function(n,t){t===void 0&&(t="strict");var e=[],s=[],r=[];return n.forEach(function(i,o){var A=Th.get(i);if(A>Sg?(r.push(!0),A-=Sg):r.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(i)!==-1)return s.push(o),e.push(yh);if(A===yQ||A===Ch){if(o===0)return s.push(o),e.push(ai);var a=e[o-1];return MQ.indexOf(a)===-1?(s.push(s[o-1]),e.push(a)):(s.push(o),e.push(ai))}if(s.push(o),A===FQ)return e.push(t==="strict"?Sh:ca);if(A===xB||A===IQ)return e.push(ai);if(A===TQ)return i>=131072&&i<=196605||i>=196608&&i<=262141?e.push(ca):e.push(ai);e.push(A)}),[s,e,r]},gd=function(n,t,e,s){var r=s[e];if(Array.isArray(n)?n.indexOf(r)!==-1:n===r)for(var i=e;i<=s.length;){i++;var o=s[i];if(o===t)return!0;if(o!==Ur)break}if(r===Ur)for(var i=e;i>0;){i--;var A=s[i];if(Array.isArray(n)?n.indexOf(A)!==-1:n===A)for(var a=e;a<=s.length;){a++;var o=s[a];if(o===t)return!0;if(o!==Ur)break}if(A!==Ur)break}return!1},Mg=function(n,t){for(var e=n;e>=0;){var s=t[e];if(s===Ur)e--;else return s}return 0},PQ=function(n,t,e,s,r){if(e[s]===0)return Tt;var i=s-1;if(Array.isArray(r)&&r[i]===!0)return Tt;var o=i-1,A=i+1,a=t[i],l=o>=0?t[o]:0,c=t[A];if(a===yB&&c===SB)return Tt;if(_h.indexOf(a)!==-1)return IB;if(_h.indexOf(c)!==-1||FB.indexOf(c)!==-1)return Tt;if(Mg(i,t)===EB)return ll;if(Th.get(n[i])===Ch||(a===Al||a===al)&&Th.get(n[A])===Ch||a===Eg||c===Eg||a===xg||[Ur,bh,mA].indexOf(a)===-1&&c===xg||[ol,iA,xQ,zi,$i].indexOf(c)!==-1||Mg(i,t)===oA||gd(pd,oA,i,t)||gd([ol,iA],Sh,i,t)||gd(Ig,Ig,i,t))return Tt;if(a===Ur)return ll;if(a===pd||c===pd)return Tt;if(c===yh||a===yh)return ll;if([bh,mA,Sh].indexOf(c)!==-1||a===EQ||l===Ih&&QQ.indexOf(a)!==-1||a===$i&&c===Ih||c===Fg||Vs.indexOf(c)!==-1&&a===bn||Vs.indexOf(a)!==-1&&c===bn||a===vA&&[ca,Al,al].indexOf(c)!==-1||[ca,Al,al].indexOf(a)!==-1&&c===gA||Vs.indexOf(a)!==-1&&Tg.indexOf(c)!==-1||Tg.indexOf(a)!==-1&&Vs.indexOf(c)!==-1||[vA,gA].indexOf(a)!==-1&&(c===bn||[oA,mA].indexOf(c)!==-1&&t[A+1]===bn)||[oA,mA].indexOf(a)!==-1&&c===bn||a===bn&&[bn,$i,zi].indexOf(c)!==-1)return Tt;if([bn,$i,zi,ol,iA].indexOf(c)!==-1)for(var u=i;u>=0;){var d=t[u];if(d===bn)return Tt;if([$i,zi].indexOf(d)!==-1)u--;else break}if([vA,gA].indexOf(c)!==-1)for(var u=[ol,iA].indexOf(a)!==-1?o:i;u>=0;){var d=t[u];if(d===bn)return Tt;if([$i,zi].indexOf(d)!==-1)u--;else break}if(Fh===a&&[Fh,ql,Eh,xh].indexOf(c)!==-1||[ql,Eh].indexOf(a)!==-1&&[ql,zl].indexOf(c)!==-1||[zl,xh].indexOf(a)!==-1&&c===zl||_g.indexOf(a)!==-1&&[Fg,gA].indexOf(c)!==-1||_g.indexOf(c)!==-1&&a===vA||Vs.indexOf(a)!==-1&&Vs.indexOf(c)!==-1||a===zi&&Vs.indexOf(c)!==-1||Vs.concat(bn).indexOf(a)!==-1&&c===oA&&_Q.indexOf(n[A])===-1||Vs.concat(bn).indexOf(c)!==-1&&a===iA)return Tt;if(a===md&&c===md){for(var p=e[i],h=1;p>0&&(p--,t[p]===md);)h++;if(h%2!==0)return Tt}return a===Al&&c===al?Tt:ll},NQ=function(n,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var e=UQ(n,t.lineBreak),s=e[0],r=e[1],i=e[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(r=r.map(function(A){return[bn,ai,xB].indexOf(A)!==-1?ca:A}));var o=t.wordBreak==="keep-all"?i.map(function(A,a){return A&&n[a]>=19968&&n[a]<=40959}):void 0;return[s,r,o]},DQ=(function(){function n(t,e,s,r){this.codePoints=t,this.required=e===IB,this.start=s,this.end=r}return n.prototype.slice=function(){return ue.apply(void 0,this.codePoints.slice(this.start,this.end))},n})(),LQ=function(n,t){var e=Fu(n),s=NQ(e,t),r=s[0],i=s[1],o=s[2],A=e.length,a=0,l=0;return{next:function(){if(l>=A)return{done:!0,value:null};for(var c=Tt;l<A&&(c=PQ(e,i,r,++l,o))===Tt;);if(c!==Tt||l===A){var u=new DQ(e,c,a,l);return a=l,{value:u,done:!1}}return{done:!0,value:null}}}},kQ=1,RQ=2,La=4,Qg=8,xc=10,Ug=47,kA=92,HQ=9,OQ=32,cl=34,AA=61,VQ=35,WQ=36,GQ=37,ul=39,dl=40,aA=41,KQ=95,ln=45,qQ=33,zQ=60,$Q=62,XQ=64,YQ=91,jQ=93,JQ=61,ZQ=123,hl=63,tU=125,Pg=124,eU=126,nU=128,Ng=65533,vd=42,hi=43,sU=44,rU=58,iU=59,ua=46,oU=0,AU=8,aU=11,lU=14,cU=31,uU=127,fs=-1,TB=48,_B=97,MB=101,dU=102,hU=117,fU=122,QB=65,UB=69,PB=70,pU=85,mU=90,We=function(n){return n>=TB&&n<=57},gU=function(n){return n>=55296&&n<=57343},Xi=function(n){return We(n)||n>=QB&&n<=PB||n>=_B&&n<=dU},vU=function(n){return n>=_B&&n<=fU},wU=function(n){return n>=QB&&n<=mU},BU=function(n){return vU(n)||wU(n)},CU=function(n){return n>=nU},fl=function(n){return n===xc||n===HQ||n===OQ},Ic=function(n){return BU(n)||CU(n)||n===KQ},Dg=function(n){return Ic(n)||We(n)||n===ln},bU=function(n){return n>=oU&&n<=AU||n===aU||n>=lU&&n<=cU||n===uU},Er=function(n,t){return n!==kA?!1:t!==xc},pl=function(n,t,e){return n===ln?Ic(t)||Er(t,e):Ic(n)?!0:!!(n===kA&&Er(n,t))},wd=function(n,t,e){return n===hi||n===ln?We(t)?!0:t===ua&&We(e):We(n===ua?t:n)},yU=function(n){var t=0,e=1;(n[t]===hi||n[t]===ln)&&(n[t]===ln&&(e=-1),t++);for(var s=[];We(n[t]);)s.push(n[t++]);var r=s.length?parseInt(ue.apply(void 0,s),10):0;n[t]===ua&&t++;for(var i=[];We(n[t]);)i.push(n[t++]);var o=i.length,A=o?parseInt(ue.apply(void 0,i),10):0;(n[t]===UB||n[t]===MB)&&t++;var a=1;(n[t]===hi||n[t]===ln)&&(n[t]===ln&&(a=-1),t++);for(var l=[];We(n[t]);)l.push(n[t++]);var c=l.length?parseInt(ue.apply(void 0,l),10):0;return e*(r+A*Math.pow(10,-o))*Math.pow(10,a*c)},SU={type:2},EU={type:3},xU={type:4},IU={type:13},FU={type:8},TU={type:21},_U={type:9},MU={type:10},QU={type:11},UU={type:12},PU={type:14},ml={type:23},NU={type:1},DU={type:25},LU={type:24},kU={type:26},RU={type:27},HU={type:28},OU={type:29},VU={type:31},Mh={type:32},NB=(function(){function n(){this._value=[]}return n.prototype.write=function(t){this._value=this._value.concat(Fu(t))},n.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==Mh;)t.push(e),e=this.consumeToken();return t},n.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case cl:return this.consumeStringToken(cl);case VQ:var e=this.peekCodePoint(0),s=this.peekCodePoint(1),r=this.peekCodePoint(2);if(Dg(e)||Er(s,r)){var i=pl(e,s,r)?RQ:kQ,o=this.consumeName();return{type:5,value:o,flags:i}}break;case WQ:if(this.peekCodePoint(0)===AA)return this.consumeCodePoint(),IU;break;case ul:return this.consumeStringToken(ul);case dl:return SU;case aA:return EU;case vd:if(this.peekCodePoint(0)===AA)return this.consumeCodePoint(),PU;break;case hi:if(wd(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case sU:return xU;case ln:var A=t,a=this.peekCodePoint(0),l=this.peekCodePoint(1);if(wd(A,a,l))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(pl(A,a,l))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(a===ln&&l===$Q)return this.consumeCodePoint(),this.consumeCodePoint(),LU;break;case ua:if(wd(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case Ug:if(this.peekCodePoint(0)===vd)for(this.consumeCodePoint();;){var c=this.consumeCodePoint();if(c===vd&&(c=this.consumeCodePoint(),c===Ug))return this.consumeToken();if(c===fs)return this.consumeToken()}break;case rU:return kU;case iU:return RU;case zQ:if(this.peekCodePoint(0)===qQ&&this.peekCodePoint(1)===ln&&this.peekCodePoint(2)===ln)return this.consumeCodePoint(),this.consumeCodePoint(),DU;break;case XQ:var u=this.peekCodePoint(0),d=this.peekCodePoint(1),p=this.peekCodePoint(2);if(pl(u,d,p)){var o=this.consumeName();return{type:7,value:o}}break;case YQ:return HU;case kA:if(Er(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case jQ:return OU;case JQ:if(this.peekCodePoint(0)===AA)return this.consumeCodePoint(),FU;break;case ZQ:return QU;case tU:return UU;case hU:case pU:var h=this.peekCodePoint(0),m=this.peekCodePoint(1);return h===hi&&(Xi(m)||m===hl)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case Pg:if(this.peekCodePoint(0)===AA)return this.consumeCodePoint(),_U;if(this.peekCodePoint(0)===Pg)return this.consumeCodePoint(),TU;break;case eU:if(this.peekCodePoint(0)===AA)return this.consumeCodePoint(),MU;break;case fs:return Mh}return fl(t)?(this.consumeWhiteSpace(),VU):We(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):Ic(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:ue(t)}},n.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},n.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},n.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},n.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();Xi(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var s=!1;e===hl&&t.length<6;)t.push(e),e=this.consumeCodePoint(),s=!0;if(s){var r=parseInt(ue.apply(void 0,t.map(function(a){return a===hl?TB:a})),16),i=parseInt(ue.apply(void 0,t.map(function(a){return a===hl?PB:a})),16);return{type:30,start:r,end:i}}var o=parseInt(ue.apply(void 0,t),16);if(this.peekCodePoint(0)===ln&&Xi(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var A=[];Xi(e)&&A.length<6;)A.push(e),e=this.consumeCodePoint();var i=parseInt(ue.apply(void 0,A),16);return{type:30,start:o,end:i}}else return{type:30,start:o,end:o}},n.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===dl?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===dl?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},n.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===fs)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===ul||e===cl){var s=this.consumeStringToken(this.consumeCodePoint());return s.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===fs||this.peekCodePoint(0)===aA)?(this.consumeCodePoint(),{type:22,value:s.value}):(this.consumeBadUrlRemnants(),ml)}for(;;){var r=this.consumeCodePoint();if(r===fs||r===aA)return{type:22,value:ue.apply(void 0,t)};if(fl(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===fs||this.peekCodePoint(0)===aA?(this.consumeCodePoint(),{type:22,value:ue.apply(void 0,t)}):(this.consumeBadUrlRemnants(),ml);if(r===cl||r===ul||r===dl||bU(r))return this.consumeBadUrlRemnants(),ml;if(r===kA)if(Er(r,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),ml;else t.push(r)}},n.prototype.consumeWhiteSpace=function(){for(;fl(this.peekCodePoint(0));)this.consumeCodePoint()},n.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===aA||t===fs)return;Er(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},n.prototype.consumeStringSlice=function(t){for(var e=5e4,s="";t>0;){var r=Math.min(e,t);s+=ue.apply(void 0,this._value.splice(0,r)),t-=r}return this._value.shift(),s},n.prototype.consumeStringToken=function(t){var e="",s=0;do{var r=this._value[s];if(r===fs||r===void 0||r===t)return e+=this.consumeStringSlice(s),{type:0,value:e};if(r===xc)return this._value.splice(0,s),NU;if(r===kA){var i=this._value[s+1];i!==fs&&i!==void 0&&(i===xc?(e+=this.consumeStringSlice(s),s=-1,this._value.shift()):Er(r,i)&&(e+=this.consumeStringSlice(s),e+=ue(this.consumeEscapedCodePoint()),s=-1))}s++}while(!0)},n.prototype.consumeNumber=function(){var t=[],e=La,s=this.peekCodePoint(0);for((s===hi||s===ln)&&t.push(this.consumeCodePoint());We(this.peekCodePoint(0));)t.push(this.consumeCodePoint());s=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(s===ua&&We(r))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=Qg;We(this.peekCodePoint(0));)t.push(this.consumeCodePoint());s=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((s===UB||s===MB)&&((r===hi||r===ln)&&We(i)||We(r)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=Qg;We(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[yU(t),e]},n.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],s=t[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),o=this.peekCodePoint(2);if(pl(r,i,o)){var A=this.consumeName();return{type:15,number:e,flags:s,unit:A}}return r===GQ?(this.consumeCodePoint(),{type:16,number:e,flags:s}):{type:17,number:e,flags:s}},n.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(Xi(t)){for(var e=ue(t);Xi(this.peekCodePoint(0))&&e.length<6;)e+=ue(this.consumeCodePoint());fl(this.peekCodePoint(0))&&this.consumeCodePoint();var s=parseInt(e,16);return s===0||gU(s)||s>1114111?Ng:s}return t===fs?Ng:t},n.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(Dg(e))t+=ue(e);else if(Er(e,this.peekCodePoint(0)))t+=ue(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(e),t}},n})(),DB=(function(){function n(t){this._tokens=t}return n.create=function(t){var e=new NB;return e.write(t),new n(e.read())},n.parseValue=function(t){return n.create(t).parseComponentValue()},n.parseValues=function(t){return n.create(t).parseComponentValues()},n.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},n.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(e.type===32)return t;t.push(e),t.push()}},n.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},n.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},s=this.consumeToken();;){if(s.type===32||GU(s,t))return e;this.reconsumeToken(s),e.values.push(this.consumeComponentValue()),s=this.consumeToken()}},n.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var s=this.consumeToken();if(s.type===32||s.type===3)return e;this.reconsumeToken(s),e.values.push(this.consumeComponentValue())}},n.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?Mh:t},n.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},n})(),ka=function(n){return n.type===15},sA=function(n){return n.type===17},qt=function(n){return n.type===20},WU=function(n){return n.type===0},Qh=function(n,t){return qt(n)&&n.value===t},LB=function(n){return n.type!==31},Wo=function(n){return n.type!==31&&n.type!==4},ks=function(n){var t=[],e=[];return n.forEach(function(s){if(s.type===4){if(e.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(e),e=[];return}s.type!==31&&e.push(s)}),e.length&&t.push(e),t},GU=function(n,t){return t===11&&n.type===12||t===28&&n.type===29?!0:t===2&&n.type===3},Xr=function(n){return n.type===17||n.type===15},me=function(n){return n.type===16||Xr(n)},kB=function(n){return n.length>1?[n[0],n[1]]:[n[0]]},De={type:17,number:0,flags:La},yp={type:16,number:50,flags:La},Pr={type:16,number:100,flags:La},wA=function(n,t,e){var s=n[0],r=n[1];return[Xt(s,t),Xt(typeof r<"u"?r:s,e)]},Xt=function(n,t){if(n.type===16)return n.number/100*t;if(ka(n))switch(n.unit){case"rem":case"em":return 16*n.number;case"px":default:return n.number}return n.number},RB="deg",HB="grad",OB="rad",VB="turn",Tu={name:"angle",parse:function(n,t){if(t.type===15)switch(t.unit){case RB:return Math.PI*t.number/180;case HB:return Math.PI/200*t.number;case OB:return t.number;case VB:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},WB=function(n){return n.type===15&&(n.unit===RB||n.unit===HB||n.unit===OB||n.unit===VB)},GB=function(n){var t=n.filter(qt).map(function(e){return e.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[De,De];case"to top":case"bottom":return qn(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[De,Pr];case"to right":case"left":return qn(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Pr,Pr];case"to bottom":case"top":return qn(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Pr,De];case"to left":case"right":return qn(270)}return 0},qn=function(n){return Math.PI*n/180},Hr={name:"color",parse:function(n,t){if(t.type===18){var e=KU[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return e(n,t.values)}if(t.type===5){if(t.value.length===3){var s=t.value.substring(0,1),r=t.value.substring(1,2),i=t.value.substring(2,3);return Nr(parseInt(s+s,16),parseInt(r+r,16),parseInt(i+i,16),1)}if(t.value.length===4){var s=t.value.substring(0,1),r=t.value.substring(1,2),i=t.value.substring(2,3),o=t.value.substring(3,4);return Nr(parseInt(s+s,16),parseInt(r+r,16),parseInt(i+i,16),parseInt(o+o,16)/255)}if(t.value.length===6){var s=t.value.substring(0,2),r=t.value.substring(2,4),i=t.value.substring(4,6);return Nr(parseInt(s,16),parseInt(r,16),parseInt(i,16),1)}if(t.value.length===8){var s=t.value.substring(0,2),r=t.value.substring(2,4),i=t.value.substring(4,6),o=t.value.substring(6,8);return Nr(parseInt(s,16),parseInt(r,16),parseInt(i,16),parseInt(o,16)/255)}}if(t.type===20){var A=sr[t.value.toUpperCase()];if(typeof A<"u")return A}return sr.TRANSPARENT}},Or=function(n){return(255&n)===0},xe=function(n){var t=255&n,e=255&n>>8,s=255&n>>16,r=255&n>>24;return t<255?"rgba("+r+","+s+","+e+","+t/255+")":"rgb("+r+","+s+","+e+")"},Nr=function(n,t,e,s){return(n<<24|t<<16|e<<8|Math.round(s*255)<<0)>>>0},Lg=function(n,t){if(n.type===17)return n.number;if(n.type===16){var e=t===3?1:255;return t===3?n.number/100*e:Math.round(n.number/100*e)}return 0},kg=function(n,t){var e=t.filter(Wo);if(e.length===3){var s=e.map(Lg),r=s[0],i=s[1],o=s[2];return Nr(r,i,o,1)}if(e.length===4){var A=e.map(Lg),r=A[0],i=A[1],o=A[2],a=A[3];return Nr(r,i,o,a)}return 0};function Bd(n,t,e){return e<0&&(e+=1),e>=1&&(e-=1),e<1/6?(t-n)*e*6+n:e<1/2?t:e<2/3?(t-n)*6*(2/3-e)+n:n}var Rg=function(n,t){var e=t.filter(Wo),s=e[0],r=e[1],i=e[2],o=e[3],A=(s.type===17?qn(s.number):Tu.parse(n,s))/(Math.PI*2),a=me(r)?r.number/100:0,l=me(i)?i.number/100:0,c=typeof o<"u"&&me(o)?Xt(o,1):1;if(a===0)return Nr(l*255,l*255,l*255,1);var u=l<=.5?l*(a+1):l+a-l*a,d=l*2-u,p=Bd(d,u,A+1/3),h=Bd(d,u,A),m=Bd(d,u,A-1/3);return Nr(p*255,h*255,m*255,c)},KU={hsl:Rg,hsla:Rg,rgb:kg,rgba:kg},RA=function(n,t){return Hr.parse(n,DB.create(t).parseComponentValue())},sr={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},qU={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(n,t){return t.map(function(e){if(qt(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},zU={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},_u=function(n,t){var e=Hr.parse(n,t[0]),s=t[1];return s&&me(s)?{color:e,stop:s}:{color:e,stop:null}},Hg=function(n,t){var e=n[0],s=n[n.length-1];e.stop===null&&(e.stop=De),s.stop===null&&(s.stop=Pr);for(var r=[],i=0,o=0;o<n.length;o++){var A=n[o].stop;if(A!==null){var a=Xt(A,t);a>i?r.push(a):r.push(i),i=a}else r.push(null)}for(var l=null,o=0;o<r.length;o++){var c=r[o];if(c===null)l===null&&(l=o);else if(l!==null){for(var u=o-l,d=r[l-1],p=(c-d)/(u+1),h=1;h<=u;h++)r[l+h-1]=p*h;l=null}}return n.map(function(m,g){var v=m.color;return{color:v,stop:Math.max(Math.min(1,r[g]/t),0)}})},$U=function(n,t,e){var s=t/2,r=e/2,i=Xt(n[0],t)-s,o=r-Xt(n[1],e);return(Math.atan2(o,i)+Math.PI*2)%(Math.PI*2)},XU=function(n,t,e){var s=typeof n=="number"?n:$U(n,t,e),r=Math.abs(t*Math.sin(s))+Math.abs(e*Math.cos(s)),i=t/2,o=e/2,A=r/2,a=Math.sin(s-Math.PI/2)*A,l=Math.cos(s-Math.PI/2)*A;return[r,i-l,i+l,o-a,o+a]},ts=function(n,t){return Math.sqrt(n*n+t*t)},Og=function(n,t,e,s,r){var i=[[0,0],[0,t],[n,0],[n,t]];return i.reduce(function(o,A){var a=A[0],l=A[1],c=ts(e-a,s-l);return(r?c<o.optimumDistance:c>o.optimumDistance)?{optimumCorner:A,optimumDistance:c}:o},{optimumDistance:r?1/0:-1/0,optimumCorner:null}).optimumCorner},YU=function(n,t,e,s,r){var i=0,o=0;switch(n.size){case 0:n.shape===0?i=o=Math.min(Math.abs(t),Math.abs(t-s),Math.abs(e),Math.abs(e-r)):n.shape===1&&(i=Math.min(Math.abs(t),Math.abs(t-s)),o=Math.min(Math.abs(e),Math.abs(e-r)));break;case 2:if(n.shape===0)i=o=Math.min(ts(t,e),ts(t,e-r),ts(t-s,e),ts(t-s,e-r));else if(n.shape===1){var A=Math.min(Math.abs(e),Math.abs(e-r))/Math.min(Math.abs(t),Math.abs(t-s)),a=Og(s,r,t,e,!0),l=a[0],c=a[1];i=ts(l-t,(c-e)/A),o=A*i}break;case 1:n.shape===0?i=o=Math.max(Math.abs(t),Math.abs(t-s),Math.abs(e),Math.abs(e-r)):n.shape===1&&(i=Math.max(Math.abs(t),Math.abs(t-s)),o=Math.max(Math.abs(e),Math.abs(e-r)));break;case 3:if(n.shape===0)i=o=Math.max(ts(t,e),ts(t,e-r),ts(t-s,e),ts(t-s,e-r));else if(n.shape===1){var A=Math.max(Math.abs(e),Math.abs(e-r))/Math.max(Math.abs(t),Math.abs(t-s)),u=Og(s,r,t,e,!1),l=u[0],c=u[1];i=ts(l-t,(c-e)/A),o=A*i}break}return Array.isArray(n.size)&&(i=Xt(n.size[0],s),o=n.size.length===2?Xt(n.size[1],r):i),[i,o]},jU=function(n,t){var e=qn(180),s=[];return ks(t).forEach(function(r,i){if(i===0){var o=r[0];if(o.type===20&&o.value==="to"){e=GB(r);return}else if(WB(o)){e=Tu.parse(n,o);return}}var A=_u(n,r);s.push(A)}),{angle:e,stops:s,type:1}},gl=function(n,t){var e=qn(180),s=[];return ks(t).forEach(function(r,i){if(i===0){var o=r[0];if(o.type===20&&["top","left","right","bottom"].indexOf(o.value)!==-1){e=GB(r);return}else if(WB(o)){e=(Tu.parse(n,o)+qn(270))%qn(360);return}}var A=_u(n,r);s.push(A)}),{angle:e,stops:s,type:1}},JU=function(n,t){var e=qn(180),s=[],r=1,i=0,o=3,A=[];return ks(t).forEach(function(a,l){var c=a[0];if(l===0){if(qt(c)&&c.value==="linear"){r=1;return}else if(qt(c)&&c.value==="radial"){r=2;return}}if(c.type===18){if(c.name==="from"){var u=Hr.parse(n,c.values[0]);s.push({stop:De,color:u})}else if(c.name==="to"){var u=Hr.parse(n,c.values[0]);s.push({stop:Pr,color:u})}else if(c.name==="color-stop"){var d=c.values.filter(Wo);if(d.length===2){var u=Hr.parse(n,d[1]),p=d[0];sA(p)&&s.push({stop:{type:16,number:p.number*100,flags:p.flags},color:u})}}}}),r===1?{angle:(e+qn(180))%qn(360),stops:s,type:r}:{size:o,shape:i,stops:s,position:A,type:r}},KB="closest-side",qB="farthest-side",zB="closest-corner",$B="farthest-corner",XB="circle",YB="ellipse",jB="cover",JB="contain",ZU=function(n,t){var e=0,s=3,r=[],i=[];return ks(t).forEach(function(o,A){var a=!0;if(A===0){var l=!1;a=o.reduce(function(u,d){if(l)if(qt(d))switch(d.value){case"center":return i.push(yp),u;case"top":case"left":return i.push(De),u;case"right":case"bottom":return i.push(Pr),u}else(me(d)||Xr(d))&&i.push(d);else if(qt(d))switch(d.value){case XB:return e=0,!1;case YB:return e=1,!1;case"at":return l=!0,!1;case KB:return s=0,!1;case jB:case qB:return s=1,!1;case JB:case zB:return s=2,!1;case $B:return s=3,!1}else if(Xr(d)||me(d))return Array.isArray(s)||(s=[]),s.push(d),!1;return u},a)}if(a){var c=_u(n,o);r.push(c)}}),{size:s,shape:e,stops:r,position:i,type:2}},vl=function(n,t){var e=0,s=3,r=[],i=[];return ks(t).forEach(function(o,A){var a=!0;if(A===0?a=o.reduce(function(c,u){if(qt(u))switch(u.value){case"center":return i.push(yp),!1;case"top":case"left":return i.push(De),!1;case"right":case"bottom":return i.push(Pr),!1}else if(me(u)||Xr(u))return i.push(u),!1;return c},a):A===1&&(a=o.reduce(function(c,u){if(qt(u))switch(u.value){case XB:return e=0,!1;case YB:return e=1,!1;case JB:case KB:return s=0,!1;case qB:return s=1,!1;case zB:return s=2,!1;case jB:case $B:return s=3,!1}else if(Xr(u)||me(u))return Array.isArray(s)||(s=[]),s.push(u),!1;return c},a)),a){var l=_u(n,o);r.push(l)}}),{size:s,shape:e,stops:r,position:i,type:2}},t3=function(n){return n.type===1},e3=function(n){return n.type===2},Sp={name:"image",parse:function(n,t){if(t.type===22){var e={url:t.value,type:0};return n.cache.addImage(t.value),e}if(t.type===18){var s=ZB[t.name];if(typeof s>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return s(n,t.values)}throw new Error("Unsupported image type "+t.type)}};function n3(n){return!(n.type===20&&n.value==="none")&&(n.type!==18||!!ZB[n.name])}var ZB={"linear-gradient":jU,"-moz-linear-gradient":gl,"-ms-linear-gradient":gl,"-o-linear-gradient":gl,"-webkit-linear-gradient":gl,"radial-gradient":ZU,"-moz-radial-gradient":vl,"-ms-radial-gradient":vl,"-o-radial-gradient":vl,"-webkit-radial-gradient":vl,"-webkit-gradient":JU},s3={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(n,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t.filter(function(s){return Wo(s)&&n3(s)}).map(function(s){return Sp.parse(n,s)})}},r3={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(n,t){return t.map(function(e){if(qt(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},i3={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(n,t){return ks(t).map(function(e){return e.filter(me)}).map(kB)}},o3={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(n,t){return ks(t).map(function(e){return e.filter(qt).map(function(s){return s.value}).join(" ")}).map(A3)}},A3=function(n){switch(n){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Mo;(function(n){n.AUTO="auto",n.CONTAIN="contain",n.COVER="cover"})(Mo||(Mo={}));var a3={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(n,t){return ks(t).map(function(e){return e.filter(l3)})}},l3=function(n){return qt(n)||me(n)},Mu=function(n){return{name:"border-"+n+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},c3=Mu("top"),u3=Mu("right"),d3=Mu("bottom"),h3=Mu("left"),Qu=function(n){return{name:"border-radius-"+n,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return kB(e.filter(me))}}},f3=Qu("top-left"),p3=Qu("top-right"),m3=Qu("bottom-right"),g3=Qu("bottom-left"),Uu=function(n){return{name:"border-"+n+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},v3=Uu("top"),w3=Uu("right"),B3=Uu("bottom"),C3=Uu("left"),Pu=function(n){return{name:"border-"+n+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return ka(e)?e.number:0}}},b3=Pu("top"),y3=Pu("right"),S3=Pu("bottom"),E3=Pu("left"),x3={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},I3={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(n,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},F3={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(n,t){return t.filter(qt).reduce(function(e,s){return e|T3(s.value)},0)}},T3=function(n){switch(n){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},_3={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},M3={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(n,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},Fc;(function(n){n.NORMAL="normal",n.STRICT="strict"})(Fc||(Fc={}));var Q3={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"strict":return Fc.STRICT;case"normal":default:return Fc.NORMAL}}},U3={name:"line-height",initialValue:"normal",prefix:!1,type:4},Vg=function(n,t){return qt(n)&&n.value==="normal"?1.2*t:n.type===17?t*n.number:me(n)?Xt(n,t):t},P3={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(n,t){return t.type===20&&t.value==="none"?null:Sp.parse(n,t)}},N3={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(n,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},Uh={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Nu=function(n){return{name:"margin-"+n,initialValue:"0",prefix:!1,type:4}},D3=Nu("top"),L3=Nu("right"),k3=Nu("bottom"),R3=Nu("left"),H3={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(n,t){return t.filter(qt).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},O3={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},Du=function(n){return{name:"padding-"+n,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},V3=Du("top"),W3=Du("right"),G3=Du("bottom"),K3=Du("left"),q3={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(n,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},z3={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(n,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},$3={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.length===1&&Qh(t[0],"none")?[]:ks(t).map(function(e){for(var s={color:sr.TRANSPARENT,offsetX:De,offsetY:De,blur:De},r=0,i=0;i<e.length;i++){var o=e[i];Xr(o)?(r===0?s.offsetX=o:r===1?s.offsetY=o:s.blur=o,r++):s.color=Hr.parse(n,o)}return s})}},X3={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Y3={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(n,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var e=Z3[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return e(t.values)}return null}},j3=function(n){var t=n.filter(function(e){return e.type===17}).map(function(e){return e.number});return t.length===6?t:null},J3=function(n){var t=n.filter(function(a){return a.type===17}).map(function(a){return a.number}),e=t[0],s=t[1];t[2],t[3];var r=t[4],i=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var o=t[12],A=t[13];return t[14],t[15],t.length===16?[e,s,r,i,o,A]:null},Z3={matrix:j3,matrix3d:J3},Wg={type:16,number:50,flags:La},tP=[Wg,Wg],eP={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(n,t){var e=t.filter(me);return e.length!==2?tP:[e[0],e[1]]}},nP={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},HA;(function(n){n.NORMAL="normal",n.BREAK_ALL="break-all",n.KEEP_ALL="keep-all"})(HA||(HA={}));var sP={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"break-all":return HA.BREAK_ALL;case"keep-all":return HA.KEEP_ALL;case"normal":default:return HA.NORMAL}}},rP={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(n,t){if(t.type===20)return{auto:!0,order:0};if(sA(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},tC={name:"time",parse:function(n,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},iP={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(n,t){return sA(t)?t.number:1}},oP={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},AP={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(n,t){return t.filter(qt).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return e!==0})}},aP={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(n,t){var e=[],s=[];return t.forEach(function(r){switch(r.type){case 20:case 0:e.push(r.value);break;case 17:e.push(r.number.toString());break;case 4:s.push(e.join(" ")),e.length=0;break}}),e.length&&s.push(e.join(" ")),s.map(function(r){return r.indexOf(" ")===-1?r:"'"+r+"'"})}},lP={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},cP={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(n,t){if(sA(t))return t.number;if(qt(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},uP={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.filter(qt).map(function(e){return e.value})}},dP={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},be=function(n,t){return(n&t)!==0},hP={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(n,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t}},fP={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;for(var s=[],r=t.filter(LB),i=0;i<r.length;i++){var o=r[i],A=r[i+1];if(o.type===20){var a=A&&sA(A)?A.number:1;s.push({counter:o.value,increment:a})}}return s}},pP={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return[];for(var e=[],s=t.filter(LB),r=0;r<s.length;r++){var i=s[r],o=s[r+1];if(qt(i)&&i.value!=="none"){var A=o&&sA(o)?o.number:0;e.push({counter:i.value,reset:A})}}return e}},mP={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(n,t){return t.filter(ka).map(function(e){return tC.parse(n,e)})}},gP={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;var s=[],r=t.filter(WU);if(r.length%2!==0)return null;for(var i=0;i<r.length;i+=2){var o=r[i].value,A=r[i+1].value;s.push({open:o,close:A})}return s}},Gg=function(n,t,e){if(!n)return"";var s=n[Math.min(t,n.length-1)];return s?e?s.open:s.close:""},vP={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.length===1&&Qh(t[0],"none")?[]:ks(t).map(function(e){for(var s={color:255,offsetX:De,offsetY:De,blur:De,spread:De,inset:!1},r=0,i=0;i<e.length;i++){var o=e[i];Qh(o,"inset")?s.inset=!0:Xr(o)?(r===0?s.offsetX=o:r===1?s.offsetY=o:r===2?s.blur=o:s.spread=o,r++):s.color=Hr.parse(n,o)}return s})}},wP={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(n,t){var e=[0,1,2],s=[];return t.filter(qt).forEach(function(r){switch(r.value){case"stroke":s.push(1);break;case"fill":s.push(0);break;case"markers":s.push(2);break}}),e.forEach(function(r){s.indexOf(r)===-1&&s.push(r)}),s}},BP={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},CP={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(n,t){return ka(t)?t.number:0}},bP=(function(){function n(t,e){var s,r;this.animationDuration=dt(t,mP,e.animationDuration),this.backgroundClip=dt(t,qU,e.backgroundClip),this.backgroundColor=dt(t,zU,e.backgroundColor),this.backgroundImage=dt(t,s3,e.backgroundImage),this.backgroundOrigin=dt(t,r3,e.backgroundOrigin),this.backgroundPosition=dt(t,i3,e.backgroundPosition),this.backgroundRepeat=dt(t,o3,e.backgroundRepeat),this.backgroundSize=dt(t,a3,e.backgroundSize),this.borderTopColor=dt(t,c3,e.borderTopColor),this.borderRightColor=dt(t,u3,e.borderRightColor),this.borderBottomColor=dt(t,d3,e.borderBottomColor),this.borderLeftColor=dt(t,h3,e.borderLeftColor),this.borderTopLeftRadius=dt(t,f3,e.borderTopLeftRadius),this.borderTopRightRadius=dt(t,p3,e.borderTopRightRadius),this.borderBottomRightRadius=dt(t,m3,e.borderBottomRightRadius),this.borderBottomLeftRadius=dt(t,g3,e.borderBottomLeftRadius),this.borderTopStyle=dt(t,v3,e.borderTopStyle),this.borderRightStyle=dt(t,w3,e.borderRightStyle),this.borderBottomStyle=dt(t,B3,e.borderBottomStyle),this.borderLeftStyle=dt(t,C3,e.borderLeftStyle),this.borderTopWidth=dt(t,b3,e.borderTopWidth),this.borderRightWidth=dt(t,y3,e.borderRightWidth),this.borderBottomWidth=dt(t,S3,e.borderBottomWidth),this.borderLeftWidth=dt(t,E3,e.borderLeftWidth),this.boxShadow=dt(t,vP,e.boxShadow),this.color=dt(t,x3,e.color),this.direction=dt(t,I3,e.direction),this.display=dt(t,F3,e.display),this.float=dt(t,_3,e.cssFloat),this.fontFamily=dt(t,aP,e.fontFamily),this.fontSize=dt(t,lP,e.fontSize),this.fontStyle=dt(t,dP,e.fontStyle),this.fontVariant=dt(t,uP,e.fontVariant),this.fontWeight=dt(t,cP,e.fontWeight),this.letterSpacing=dt(t,M3,e.letterSpacing),this.lineBreak=dt(t,Q3,e.lineBreak),this.lineHeight=dt(t,U3,e.lineHeight),this.listStyleImage=dt(t,P3,e.listStyleImage),this.listStylePosition=dt(t,N3,e.listStylePosition),this.listStyleType=dt(t,Uh,e.listStyleType),this.marginTop=dt(t,D3,e.marginTop),this.marginRight=dt(t,L3,e.marginRight),this.marginBottom=dt(t,k3,e.marginBottom),this.marginLeft=dt(t,R3,e.marginLeft),this.opacity=dt(t,iP,e.opacity);var i=dt(t,H3,e.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=dt(t,O3,e.overflowWrap),this.paddingTop=dt(t,V3,e.paddingTop),this.paddingRight=dt(t,W3,e.paddingRight),this.paddingBottom=dt(t,G3,e.paddingBottom),this.paddingLeft=dt(t,K3,e.paddingLeft),this.paintOrder=dt(t,wP,e.paintOrder),this.position=dt(t,z3,e.position),this.textAlign=dt(t,q3,e.textAlign),this.textDecorationColor=dt(t,oP,(s=e.textDecorationColor)!==null&&s!==void 0?s:e.color),this.textDecorationLine=dt(t,AP,(r=e.textDecorationLine)!==null&&r!==void 0?r:e.textDecoration),this.textShadow=dt(t,$3,e.textShadow),this.textTransform=dt(t,X3,e.textTransform),this.transform=dt(t,Y3,e.transform),this.transformOrigin=dt(t,eP,e.transformOrigin),this.visibility=dt(t,nP,e.visibility),this.webkitTextStrokeColor=dt(t,BP,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=dt(t,CP,e.webkitTextStrokeWidth),this.wordBreak=dt(t,sP,e.wordBreak),this.zIndex=dt(t,rP,e.zIndex)}return n.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},n.prototype.isTransparent=function(){return Or(this.backgroundColor)},n.prototype.isTransformed=function(){return this.transform!==null},n.prototype.isPositioned=function(){return this.position!==0},n.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},n.prototype.isFloating=function(){return this.float!==0},n.prototype.isInlineLevel=function(){return be(this.display,4)||be(this.display,33554432)||be(this.display,268435456)||be(this.display,536870912)||be(this.display,67108864)||be(this.display,134217728)},n})(),yP=(function(){function n(t,e){this.content=dt(t,hP,e.content),this.quotes=dt(t,gP,e.quotes)}return n})(),Kg=(function(){function n(t,e){this.counterIncrement=dt(t,fP,e.counterIncrement),this.counterReset=dt(t,pP,e.counterReset)}return n})(),dt=function(n,t,e){var s=new NB,r=e!==null&&typeof e<"u"?e.toString():t.initialValue;s.write(r);var i=new DB(s.read());switch(t.type){case 2:var o=i.parseComponentValue();return t.parse(n,qt(o)?o.value:t.initialValue);case 0:return t.parse(n,i.parseComponentValue());case 1:return t.parse(n,i.parseComponentValues());case 4:return i.parseComponentValue();case 3:switch(t.format){case"angle":return Tu.parse(n,i.parseComponentValue());case"color":return Hr.parse(n,i.parseComponentValue());case"image":return Sp.parse(n,i.parseComponentValue());case"length":var A=i.parseComponentValue();return Xr(A)?A:De;case"length-percentage":var a=i.parseComponentValue();return me(a)?a:De;case"time":return tC.parse(n,i.parseComponentValue())}break}},SP="data-html2canvas-debug",EP=function(n){var t=n.getAttribute(SP);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Ph=function(n,t){var e=EP(n);return e===1||t===e},Rs=(function(){function n(t,e){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,Ph(e,3))debugger;this.styles=new bP(t,window.getComputedStyle(e,null)),Lh(e)&&(this.styles.animationDuration.some(function(s){return s>0})&&(e.style.animationDuration="0s"),this.styles.transform!==null&&(e.style.transform="none")),this.bounds=Iu(this.context,e),Ph(e,4)&&(this.flags|=16)}return n})(),xP="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",qg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BA=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var wl=0;wl<qg.length;wl++)BA[qg.charCodeAt(wl)]=wl;var IP=function(n){var t=n.length*.75,e=n.length,s,r=0,i,o,A,a;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);var l=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),c=Array.isArray(l)?l:new Uint8Array(l);for(s=0;s<e;s+=4)i=BA[n.charCodeAt(s)],o=BA[n.charCodeAt(s+1)],A=BA[n.charCodeAt(s+2)],a=BA[n.charCodeAt(s+3)],c[r++]=i<<2|o>>4,c[r++]=(o&15)<<4|A>>2,c[r++]=(A&3)<<6|a&63;return l},FP=function(n){for(var t=n.length,e=[],s=0;s<t;s+=2)e.push(n[s+1]<<8|n[s]);return e},TP=function(n){for(var t=n.length,e=[],s=0;s<t;s+=4)e.push(n[s+3]<<24|n[s+2]<<16|n[s+1]<<8|n[s]);return e},xi=5,Ep=11,Cd=2,_P=Ep-xi,eC=65536>>xi,MP=1<<xi,bd=MP-1,QP=1024>>xi,UP=eC+QP,PP=UP,NP=32,DP=PP+NP,LP=65536>>Ep,kP=1<<_P,RP=kP-1,zg=function(n,t,e){return n.slice?n.slice(t,e):new Uint16Array(Array.prototype.slice.call(n,t,e))},HP=function(n,t,e){return n.slice?n.slice(t,e):new Uint32Array(Array.prototype.slice.call(n,t,e))},OP=function(n,t){var e=IP(n),s=Array.isArray(e)?TP(e):new Uint32Array(e),r=Array.isArray(e)?FP(e):new Uint16Array(e),i=24,o=zg(r,i/2,s[4]/2),A=s[5]===2?zg(r,(i+s[4])/2):HP(s,Math.ceil((i+s[4])/4));return new VP(s[0],s[1],s[2],s[3],o,A)},VP=(function(){function n(t,e,s,r,i,o){this.initialValue=t,this.errorValue=e,this.highStart=s,this.highValueIndex=r,this.index=i,this.data=o}return n.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>xi],e=(e<<Cd)+(t&bd),this.data[e];if(t<=65535)return e=this.index[eC+(t-55296>>xi)],e=(e<<Cd)+(t&bd),this.data[e];if(t<this.highStart)return e=DP-LP+(t>>Ep),e=this.index[e],e+=t>>xi&RP,e=this.index[e],e=(e<<Cd)+(t&bd),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},n})(),$g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",WP=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Bl=0;Bl<$g.length;Bl++)WP[$g.charCodeAt(Bl)]=Bl;var GP=1,yd=2,Sd=3,Xg=4,Yg=5,KP=7,jg=8,Ed=9,xd=10,Jg=11,Zg=12,t0=13,e0=14,Id=15,qP=function(n){for(var t=[],e=0,s=n.length;e<s;){var r=n.charCodeAt(e++);if(r>=55296&&r<=56319&&e<s){var i=n.charCodeAt(e++);(i&64512)===56320?t.push(((r&1023)<<10)+(i&1023)+65536):(t.push(r),e--)}else t.push(r)}return t},zP=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,n);var e=n.length;if(!e)return"";for(var s=[],r=-1,i="";++r<e;){var o=n[r];o<=65535?s.push(o):(o-=65536,s.push((o>>10)+55296,o%1024+56320)),(r+1===e||s.length>16384)&&(i+=String.fromCharCode.apply(String,s),s.length=0)}return i},$P=OP(xP),Nn="",Fd="",XP=function(n){return $P.get(n)},YP=function(n,t,e){var s=e-2,r=t[s],i=t[e-1],o=t[e];if(i===yd&&o===Sd)return Nn;if(i===yd||i===Sd||i===Xg||o===yd||o===Sd||o===Xg)return Fd;if(i===jg&&[jg,Ed,Jg,Zg].indexOf(o)!==-1||(i===Jg||i===Ed)&&(o===Ed||o===xd)||(i===Zg||i===xd)&&o===xd||o===t0||o===Yg||o===KP||i===GP)return Nn;if(i===t0&&o===e0){for(;r===Yg;)r=t[--s];if(r===e0)return Nn}if(i===Id&&o===Id){for(var A=0;r===Id;)A++,r=t[--s];if(A%2===0)return Nn}return Fd},jP=function(n){var t=qP(n),e=t.length,s=0,r=0,i=t.map(XP);return{next:function(){if(s>=e)return{done:!0,value:null};for(var o=Nn;s<e&&(o=YP(t,i,++s))===Nn;);if(o!==Nn||s===e){var A=zP.apply(null,t.slice(r,s));return r=s,{value:A,done:!1}}return{done:!0,value:null}}}},JP=function(n){for(var t=jP(n),e=[],s;!(s=t.next()).done;)s.value&&e.push(s.value.slice());return e},ZP=function(n){var t=123;if(n.createRange){var e=n.createRange();if(e.getBoundingClientRect){var s=n.createElement("boundtest");s.style.height=t+"px",s.style.display="block",n.body.appendChild(s),e.selectNode(s);var r=e.getBoundingClientRect(),i=Math.round(r.height);if(n.body.removeChild(s),i===t)return!0}}return!1},t4=function(n){var t=n.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",n.body.appendChild(t);var e=n.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var s=t.firstChild,r=Fu(s.data).map(function(a){return ue(a)}),i=0,o={},A=r.every(function(a,l){e.setStart(s,i),e.setEnd(s,i+a.length);var c=e.getBoundingClientRect();i+=a.length;var u=c.x>o.x||c.y>o.y;return o=c,l===0?!0:u});return n.body.removeChild(t),A},e4=function(){return typeof new Image().crossOrigin<"u"},n4=function(){return typeof new XMLHttpRequest().responseType=="string"},s4=function(n){var t=new Image,e=n.createElement("canvas"),s=e.getContext("2d");if(!s)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{s.drawImage(t,0,0),e.toDataURL()}catch{return!1}return!0},n0=function(n){return n[0]===0&&n[1]===255&&n[2]===0&&n[3]===255},r4=function(n){var t=n.createElement("canvas"),e=100;t.width=e,t.height=e;var s=t.getContext("2d");if(!s)return Promise.reject(!1);s.fillStyle="rgb(0, 255, 0)",s.fillRect(0,0,e,e);var r=new Image,i=t.toDataURL();r.src=i;var o=Nh(e,e,0,0,r);return s.fillStyle="red",s.fillRect(0,0,e,e),s0(o).then(function(A){s.drawImage(A,0,0);var a=s.getImageData(0,0,e,e).data;s.fillStyle="red",s.fillRect(0,0,e,e);var l=n.createElement("div");return l.style.backgroundImage="url("+i+")",l.style.height=e+"px",n0(a)?s0(Nh(e,e,0,0,l)):Promise.reject(!1)}).then(function(A){return s.drawImage(A,0,0),n0(s.getImageData(0,0,e,e).data)}).catch(function(){return!1})},Nh=function(n,t,e,s,r){var i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg"),A=document.createElementNS(i,"foreignObject");return o.setAttributeNS(null,"width",n.toString()),o.setAttributeNS(null,"height",t.toString()),A.setAttributeNS(null,"width","100%"),A.setAttributeNS(null,"height","100%"),A.setAttributeNS(null,"x",e.toString()),A.setAttributeNS(null,"y",s.toString()),A.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(A),A.appendChild(r),o},s0=function(n){return new Promise(function(t,e){var s=new Image;s.onload=function(){return t(s)},s.onerror=e,s.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(n))})},Ue={get SUPPORT_RANGE_BOUNDS(){var n=ZP(document);return Object.defineProperty(Ue,"SUPPORT_RANGE_BOUNDS",{value:n}),n},get SUPPORT_WORD_BREAKING(){var n=Ue.SUPPORT_RANGE_BOUNDS&&t4(document);return Object.defineProperty(Ue,"SUPPORT_WORD_BREAKING",{value:n}),n},get SUPPORT_SVG_DRAWING(){var n=s4(document);return Object.defineProperty(Ue,"SUPPORT_SVG_DRAWING",{value:n}),n},get SUPPORT_FOREIGNOBJECT_DRAWING(){var n=typeof Array.from=="function"&&typeof window.fetch=="function"?r4(document):Promise.resolve(!1);return Object.defineProperty(Ue,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:n}),n},get SUPPORT_CORS_IMAGES(){var n=e4();return Object.defineProperty(Ue,"SUPPORT_CORS_IMAGES",{value:n}),n},get SUPPORT_RESPONSE_TYPE(){var n=n4();return Object.defineProperty(Ue,"SUPPORT_RESPONSE_TYPE",{value:n}),n},get SUPPORT_CORS_XHR(){var n="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Ue,"SUPPORT_CORS_XHR",{value:n}),n},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var n=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Ue,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:n}),n}},OA=(function(){function n(t,e){this.text=t,this.bounds=e}return n})(),i4=function(n,t,e,s){var r=a4(t,e),i=[],o=0;return r.forEach(function(A){if(e.textDecorationLine.length||A.trim().length>0)if(Ue.SUPPORT_RANGE_BOUNDS){var a=r0(s,o,A.length).getClientRects();if(a.length>1){var l=xp(A),c=0;l.forEach(function(d){i.push(new OA(d,cr.fromDOMRectList(n,r0(s,c+o,d.length).getClientRects()))),c+=d.length})}else i.push(new OA(A,cr.fromDOMRectList(n,a)))}else{var u=s.splitText(A.length);i.push(new OA(A,o4(n,s))),s=u}else Ue.SUPPORT_RANGE_BOUNDS||(s=s.splitText(A.length));o+=A.length}),i},o4=function(n,t){var e=t.ownerDocument;if(e){var s=e.createElement("html2canvaswrapper");s.appendChild(t.cloneNode(!0));var r=t.parentNode;if(r){r.replaceChild(s,t);var i=Iu(n,s);return s.firstChild&&r.replaceChild(s.firstChild,s),i}}return cr.EMPTY},r0=function(n,t,e){var s=n.ownerDocument;if(!s)throw new Error("Node has no owner document");var r=s.createRange();return r.setStart(n,t),r.setEnd(n,t+e),r},xp=function(n){if(Ue.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(n)).map(function(e){return e.segment})}return JP(n)},A4=function(n,t){if(Ue.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(e.segment(n)).map(function(s){return s.segment})}return c4(n,t)},a4=function(n,t){return t.letterSpacing!==0?xp(n):A4(n,t)},l4=[32,160,4961,65792,65793,4153,4241],c4=function(n,t){for(var e=LQ(n,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),s=[],r,i=function(){if(r.value){var o=r.value.slice(),A=Fu(o),a="";A.forEach(function(l){l4.indexOf(l)===-1?a+=ue(l):(a.length&&s.push(a),s.push(ue(l)),a="")}),a.length&&s.push(a)}};!(r=e.next()).done;)i();return s},u4=(function(){function n(t,e,s){this.text=d4(e.data,s.textTransform),this.textBounds=i4(t,this.text,s,e)}return n})(),d4=function(n,t){switch(t){case 1:return n.toLowerCase();case 3:return n.replace(h4,f4);case 2:return n.toUpperCase();default:return n}},h4=/(^|\s|:|-|\(|\))([a-z])/g,f4=function(n,t,e){return n.length>0?t+e.toUpperCase():n},nC=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.src=s.currentSrc||s.src,r.intrinsicWidth=s.naturalWidth,r.intrinsicHeight=s.naturalHeight,r.context.cache.addImage(r.src),r}return t})(Rs),sC=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.canvas=s,r.intrinsicWidth=s.width,r.intrinsicHeight=s.height,r}return t})(Rs),rC=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this,i=new XMLSerializer,o=Iu(e,s);return s.setAttribute("width",o.width+"px"),s.setAttribute("height",o.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(s)),r.intrinsicWidth=s.width.baseVal.value,r.intrinsicHeight=s.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t})(Rs),iC=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.value=s.value,r}return t})(Rs),Dh=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.start=s.start,r.reversed=typeof s.reversed=="boolean"&&s.reversed===!0,r}return t})(Rs),p4=[{type:15,flags:0,unit:"px",number:3}],m4=[{type:16,flags:0,number:50}],g4=function(n){return n.width>n.height?new cr(n.left+(n.width-n.height)/2,n.top,n.height,n.height):n.width<n.height?new cr(n.left,n.top+(n.height-n.width)/2,n.width,n.width):n},v4=function(n){var t=n.type===w4?new Array(n.value.length+1).join(""):n.value;return t.length===0?n.placeholder||"":t},Tc="checkbox",_c="radio",w4="password",i0=707406591,Ip=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;switch(r.type=s.type.toLowerCase(),r.checked=s.checked,r.value=v4(s),(r.type===Tc||r.type===_c)&&(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=g4(r.bounds)),r.type){case Tc:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=p4;break;case _c:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=m4;break}return r}return t})(Rs),oC=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this,i=s.options[s.selectedIndex||0];return r.value=i&&i.text||"",r}return t})(Rs),AC=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.value=s.value,r}return t})(Rs),aC=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;r.src=s.src,r.width=parseInt(s.width,10)||0,r.height=parseInt(s.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(s.contentWindow&&s.contentWindow.document&&s.contentWindow.document.documentElement){r.tree=cC(e,s.contentWindow.document.documentElement);var i=s.contentWindow.document.documentElement?RA(e,getComputedStyle(s.contentWindow.document.documentElement).backgroundColor):sr.TRANSPARENT,o=s.contentWindow.document.body?RA(e,getComputedStyle(s.contentWindow.document.body).backgroundColor):sr.TRANSPARENT;r.backgroundColor=Or(i)?Or(o)?r.styles.backgroundColor:o:i}}catch{}return r}return t})(Rs),B4=["OL","UL","MENU"],$l=function(n,t,e,s){for(var r=t.firstChild,i=void 0;r;r=i)if(i=r.nextSibling,uC(r)&&r.data.trim().length>0)e.textNodes.push(new u4(n,r,e.styles));else if(fo(r))if(pC(r)&&r.assignedNodes)r.assignedNodes().forEach(function(A){return $l(n,A,e,s)});else{var o=lC(n,r);o.styles.isVisible()&&(C4(r,o,s)?o.flags|=4:b4(o.styles)&&(o.flags|=2),B4.indexOf(r.tagName)!==-1&&(o.flags|=8),e.elements.push(o),r.slot,r.shadowRoot?$l(n,r.shadowRoot,o,s):!Mc(r)&&!dC(r)&&!Qc(r)&&$l(n,r,o,s))}},lC=function(n,t){return kh(t)?new nC(n,t):hC(t)?new sC(n,t):dC(t)?new rC(n,t):y4(t)?new iC(n,t):S4(t)?new Dh(n,t):E4(t)?new Ip(n,t):Qc(t)?new oC(n,t):Mc(t)?new AC(n,t):fC(t)?new aC(n,t):new Rs(n,t)},cC=function(n,t){var e=lC(n,t);return e.flags|=4,$l(n,t,e,e),e},C4=function(n,t,e){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Fp(n)&&e.styles.isTransparent()},b4=function(n){return n.isPositioned()||n.isFloating()},uC=function(n){return n.nodeType===Node.TEXT_NODE},fo=function(n){return n.nodeType===Node.ELEMENT_NODE},Lh=function(n){return fo(n)&&typeof n.style<"u"&&!Xl(n)},Xl=function(n){return typeof n.className=="object"},y4=function(n){return n.tagName==="LI"},S4=function(n){return n.tagName==="OL"},E4=function(n){return n.tagName==="INPUT"},x4=function(n){return n.tagName==="HTML"},dC=function(n){return n.tagName==="svg"},Fp=function(n){return n.tagName==="BODY"},hC=function(n){return n.tagName==="CANVAS"},o0=function(n){return n.tagName==="VIDEO"},kh=function(n){return n.tagName==="IMG"},fC=function(n){return n.tagName==="IFRAME"},A0=function(n){return n.tagName==="STYLE"},I4=function(n){return n.tagName==="SCRIPT"},Mc=function(n){return n.tagName==="TEXTAREA"},Qc=function(n){return n.tagName==="SELECT"},pC=function(n){return n.tagName==="SLOT"},a0=function(n){return n.tagName.indexOf("-")>0},F4=(function(){function n(){this.counters={}}return n.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},n.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},n.prototype.pop=function(t){var e=this;t.forEach(function(s){return e.counters[s].pop()})},n.prototype.parse=function(t){var e=this,s=t.counterIncrement,r=t.counterReset,i=!0;s!==null&&s.forEach(function(A){var a=e.counters[A.counter];a&&A.increment!==0&&(i=!1,a.length||a.push(1),a[Math.max(0,a.length-1)]+=A.increment)});var o=[];return i&&r.forEach(function(A){var a=e.counters[A.counter];o.push(A.counter),a||(a=e.counters[A.counter]=[]),a.push(A.reset)}),o},n})(),l0={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},c0={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},T4={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},_4={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Yi=function(n,t,e,s,r,i){return n<t||n>e?da(n,r,i.length>0):s.integers.reduce(function(o,A,a){for(;n>=A;)n-=A,o+=s.values[a];return o},"")+i},mC=function(n,t,e,s){var r="";do e||n--,r=s(n)+r,n/=t;while(n*t>=t);return r},ce=function(n,t,e,s,r){var i=e-t+1;return(n<0?"-":"")+(mC(Math.abs(n),i,s,function(o){return ue(Math.floor(o%i)+t)})+r)},ii=function(n,t,e){e===void 0&&(e=". ");var s=t.length;return mC(Math.abs(n),s,!1,function(r){return t[Math.floor(r%s)]})+e},ro=1,br=2,yr=4,CA=8,Ws=function(n,t,e,s,r,i){if(n<-9999||n>9999)return da(n,4,r.length>0);var o=Math.abs(n),A=r;if(o===0)return t[0]+A;for(var a=0;o>0&&a<=4;a++){var l=o%10;l===0&&be(i,ro)&&A!==""?A=t[l]+A:l>1||l===1&&a===0||l===1&&a===1&&be(i,br)||l===1&&a===1&&be(i,yr)&&n>100||l===1&&a>1&&be(i,CA)?A=t[l]+(a>0?e[a-1]:"")+A:l===1&&a>0&&(A=e[a-1]+A),o=Math.floor(o/10)}return(n<0?s:"")+A},u0="",d0="",h0="",Td="",da=function(n,t,e){var s=e?". ":"",r=e?"":"",i=e?", ":"",o=e?" ":"";switch(t){case 0:return""+o;case 1:return""+o;case 2:return""+o;case 5:var A=ce(n,48,57,!0,s);return A.length<4?"0"+A:A;case 4:return ii(n,"",r);case 6:return Yi(n,1,3999,l0,3,s).toLowerCase();case 7:return Yi(n,1,3999,l0,3,s);case 8:return ce(n,945,969,!1,s);case 9:return ce(n,97,122,!1,s);case 10:return ce(n,65,90,!1,s);case 11:return ce(n,1632,1641,!0,s);case 12:case 49:return Yi(n,1,9999,c0,3,s);case 35:return Yi(n,1,9999,c0,3,s).toLowerCase();case 13:return ce(n,2534,2543,!0,s);case 14:case 30:return ce(n,6112,6121,!0,s);case 15:return ii(n,"",r);case 16:return ii(n,"",r);case 17:case 48:return Ws(n,"",u0,"",r,br|yr|CA);case 47:return Ws(n,"",d0,"",r,ro|br|yr|CA);case 42:return Ws(n,"",u0,"",r,br|yr|CA);case 41:return Ws(n,"",d0,"",r,ro|br|yr|CA);case 26:return Ws(n,"","",h0,r,0);case 25:return Ws(n,"","",h0,r,ro|br|yr);case 31:return Ws(n,"","",Td,i,ro|br|yr);case 33:return Ws(n,"","",Td,i,0);case 32:return Ws(n,"","",Td,i,ro|br|yr);case 18:return ce(n,2406,2415,!0,s);case 20:return Yi(n,1,19999,_4,3,s);case 21:return ce(n,2790,2799,!0,s);case 22:return ce(n,2662,2671,!0,s);case 22:return Yi(n,1,10999,T4,3,s);case 23:return ii(n,"");case 24:return ii(n,"");case 27:return ce(n,3302,3311,!0,s);case 28:return ii(n,"",r);case 29:return ii(n,"",r);case 34:return ce(n,3792,3801,!0,s);case 37:return ce(n,6160,6169,!0,s);case 38:return ce(n,4160,4169,!0,s);case 39:return ce(n,2918,2927,!0,s);case 40:return ce(n,1776,1785,!0,s);case 43:return ce(n,3046,3055,!0,s);case 44:return ce(n,3174,3183,!0,s);case 45:return ce(n,3664,3673,!0,s);case 46:return ce(n,3872,3881,!0,s);case 3:default:return ce(n,48,57,!0,s)}},gC="data-html2canvas-ignore",f0=(function(){function n(t,e,s){if(this.context=t,this.options=s,this.scrolledElements=[],this.referenceElement=e,this.counters=new F4,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return n.prototype.toIFrame=function(t,e){var s=this,r=M4(t,e);if(!r.contentWindow)return Promise.reject("Unable to find iframe window");var i=t.defaultView.pageXOffset,o=t.defaultView.pageYOffset,A=r.contentWindow,a=A.document,l=P4(r).then(function(){return Ze(s,void 0,void 0,function(){var c,u;return Oe(this,function(d){switch(d.label){case 0:return this.scrolledElements.forEach(k4),A&&(A.scrollTo(e.left,e.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(A.scrollY!==e.top||A.scrollX!==e.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(A.scrollX-e.left,A.scrollY-e.top,0,0))),c=this.options.onclone,u=this.clonedReferenceElement,typeof u>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:a.fonts&&a.fonts.ready?[4,a.fonts.ready]:[3,2];case 1:d.sent(),d.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,U4(a)]:[3,4];case 3:d.sent(),d.label=4;case 4:return typeof c=="function"?[2,Promise.resolve().then(function(){return c(a,u)}).then(function(){return r})]:[2,r]}})})});return a.open(),a.write(D4(document.doctype)+"<html></html>"),L4(this.referenceElement.ownerDocument,i,o),a.replaceChild(a.adoptNode(this.documentElement),a.documentElement),a.close(),l},n.prototype.createElementClone=function(t){if(Ph(t,2))debugger;if(hC(t))return this.createCanvasClone(t);if(o0(t))return this.createVideoClone(t);if(A0(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return kh(e)&&(kh(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),e.loading==="lazy"&&(e.loading="eager")),a0(e)?this.createCustomElementClone(e):e},n.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return _d(t.style,e),e},n.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var s=[].slice.call(e.cssRules,0).reduce(function(i,o){return o&&typeof o.cssText=="string"?i+o.cssText:i},""),r=t.cloneNode(!1);return r.textContent=s,r}}catch(i){if(this.context.logger.error("Unable to access cssRules property",i),i.name!=="SecurityError")throw i}return t.cloneNode(!1)},n.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var s=t.ownerDocument.createElement("img");try{return s.src=t.toDataURL(),s}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var r=t.cloneNode(!1);try{r.width=t.width,r.height=t.height;var i=t.getContext("2d"),o=r.getContext("2d");if(o)if(!this.options.allowTaint&&i)o.putImageData(i.getImageData(0,0,t.width,t.height),0,0);else{var A=(e=t.getContext("webgl2"))!==null&&e!==void 0?e:t.getContext("webgl");if(A){var a=A.getContextAttributes();(a==null?void 0:a.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}o.drawImage(t,0,0)}return r}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return r},n.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var s=e.getContext("2d");try{return s&&(s.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||s.getImageData(0,0,e.width,e.height)),e}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var r=t.ownerDocument.createElement("canvas");return r.width=t.offsetWidth,r.height=t.offsetHeight,r},n.prototype.appendChildNode=function(t,e,s){(!fo(e)||!I4(e)&&!e.hasAttribute(gC)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(e)))&&(!this.options.copyStyles||!fo(e)||!A0(e))&&t.appendChild(this.cloneNode(e,s))},n.prototype.cloneChildNodes=function(t,e,s){for(var r=this,i=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;i;i=i.nextSibling)if(fo(i)&&pC(i)&&typeof i.assignedNodes=="function"){var o=i.assignedNodes();o.length&&o.forEach(function(A){return r.appendChildNode(e,A,s)})}else this.appendChildNode(e,i,s)},n.prototype.cloneNode=function(t,e){if(uC(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var s=t.ownerDocument.defaultView;if(s&&fo(t)&&(Lh(t)||Xl(t))){var r=this.createElementClone(t);r.style.transitionProperty="none";var i=s.getComputedStyle(t),o=s.getComputedStyle(t,":before"),A=s.getComputedStyle(t,":after");this.referenceElement===t&&Lh(r)&&(this.clonedReferenceElement=r),Fp(r)&&O4(r);var a=this.counters.parse(new Kg(this.context,i)),l=this.resolvePseudoContent(t,r,o,VA.BEFORE);a0(t)&&(e=!0),o0(t)||this.cloneChildNodes(t,r,e),l&&r.insertBefore(l,r.firstChild);var c=this.resolvePseudoContent(t,r,A,VA.AFTER);return c&&r.appendChild(c),this.counters.pop(a),(i&&(this.options.copyStyles||Xl(t))&&!fC(t)||e)&&_d(i,r),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([r,t.scrollLeft,t.scrollTop]),(Mc(t)||Qc(t))&&(Mc(r)||Qc(r))&&(r.value=t.value),r}return t.cloneNode(!1)},n.prototype.resolvePseudoContent=function(t,e,s,r){var i=this;if(s){var o=s.content,A=e.ownerDocument;if(!(!A||!o||o==="none"||o==="-moz-alt-content"||s.display==="none")){this.counters.parse(new Kg(this.context,s));var a=new yP(this.context,s),l=A.createElement("html2canvaspseudoelement");_d(s,l),a.content.forEach(function(u){if(u.type===0)l.appendChild(A.createTextNode(u.value));else if(u.type===22){var d=A.createElement("img");d.src=u.value,d.style.opacity="1",l.appendChild(d)}else if(u.type===18){if(u.name==="attr"){var p=u.values.filter(qt);p.length&&l.appendChild(A.createTextNode(t.getAttribute(p[0].value)||""))}else if(u.name==="counter"){var h=u.values.filter(Wo),m=h[0],g=h[1];if(m&&qt(m)){var v=i.counters.getCounterValue(m.value),w=g&&qt(g)?Uh.parse(i.context,g.value):3;l.appendChild(A.createTextNode(da(v,w,!1)))}}else if(u.name==="counters"){var y=u.values.filter(Wo),m=y[0],I=y[1],g=y[2];if(m&&qt(m)){var B=i.counters.getCounterValues(m.value),C=g&&qt(g)?Uh.parse(i.context,g.value):3,b=I&&I.type===0?I.value:"",S=B.map(function(_){return da(_,C,!1)}).join(b);l.appendChild(A.createTextNode(S))}}}else if(u.type===20)switch(u.value){case"open-quote":l.appendChild(A.createTextNode(Gg(a.quotes,i.quoteDepth++,!0)));break;case"close-quote":l.appendChild(A.createTextNode(Gg(a.quotes,--i.quoteDepth,!1)));break;default:l.appendChild(A.createTextNode(u.value))}}),l.className=Rh+" "+Hh;var c=r===VA.BEFORE?" "+Rh:" "+Hh;return Xl(e)?e.className.baseValue+=c:e.className+=c,l}}},n.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},n})(),VA;(function(n){n[n.BEFORE=0]="BEFORE",n[n.AFTER=1]="AFTER"})(VA||(VA={}));var M4=function(n,t){var e=n.createElement("iframe");return e.className="html2canvas-container",e.style.visibility="hidden",e.style.position="fixed",e.style.left="-10000px",e.style.top="0px",e.style.border="0",e.width=t.width.toString(),e.height=t.height.toString(),e.scrolling="no",e.setAttribute(gC,"true"),n.body.appendChild(e),e},Q4=function(n){return new Promise(function(t){if(n.complete){t();return}if(!n.src){t();return}n.onload=t,n.onerror=t})},U4=function(n){return Promise.all([].slice.call(n.images,0).map(Q4))},P4=function(n){return new Promise(function(t,e){var s=n.contentWindow;if(!s)return e("No window assigned for iframe");var r=s.document;s.onload=n.onload=function(){s.onload=n.onload=null;var i=setInterval(function(){r.body.childNodes.length>0&&r.readyState==="complete"&&(clearInterval(i),t(n))},50)}})},N4=["all","d","content"],_d=function(n,t){for(var e=n.length-1;e>=0;e--){var s=n.item(e);N4.indexOf(s)===-1&&t.style.setProperty(s,n.getPropertyValue(s))}return t},D4=function(n){var t="";return n&&(t+="<!DOCTYPE ",n.name&&(t+=n.name),n.internalSubset&&(t+=n.internalSubset),n.publicId&&(t+='"'+n.publicId+'"'),n.systemId&&(t+='"'+n.systemId+'"'),t+=">"),t},L4=function(n,t,e){n&&n.defaultView&&(t!==n.defaultView.pageXOffset||e!==n.defaultView.pageYOffset)&&n.defaultView.scrollTo(t,e)},k4=function(n){var t=n[0],e=n[1],s=n[2];t.scrollLeft=e,t.scrollTop=s},R4=":before",H4=":after",Rh="___html2canvas___pseudoelement_before",Hh="___html2canvas___pseudoelement_after",p0=`{
    content: "" !important;
    display: none !important;
}`,O4=function(n){V4(n,"."+Rh+R4+p0+`
         .`+Hh+H4+p0)},V4=function(n,t){var e=n.ownerDocument;if(e){var s=e.createElement("style");s.textContent=t,n.appendChild(s)}},vC=(function(){function n(){}return n.getOrigin=function(t){var e=n._link;return e?(e.href=t,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},n.isSameOrigin=function(t){return n.getOrigin(t)===n._origin},n.setContext=function(t){n._link=t.document.createElement("a"),n._origin=n.getOrigin(t.location.href)},n._origin="about:blank",n})(),W4=(function(){function n(t,e){this.context=t,this._options=e,this._cache={}}return n.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)||(Qd(t)||z4(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),e},n.prototype.match=function(t){return this._cache[t]},n.prototype.loadImage=function(t){return Ze(this,void 0,void 0,function(){var e,s,r,i,o=this;return Oe(this,function(A){switch(A.label){case 0:return e=vC.isSameOrigin(t),s=!Md(t)&&this._options.useCORS===!0&&Ue.SUPPORT_CORS_IMAGES&&!e,r=!Md(t)&&!e&&!Qd(t)&&typeof this._options.proxy=="string"&&Ue.SUPPORT_CORS_XHR&&!s,!e&&this._options.allowTaint===!1&&!Md(t)&&!Qd(t)&&!r&&!s?[2]:(i=t,r?[4,this.proxy(i)]:[3,2]);case 1:i=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(a,l){var c=new Image;c.onload=function(){return a(c)},c.onerror=l,($4(i)||s)&&(c.crossOrigin="anonymous"),c.src=i,c.complete===!0&&setTimeout(function(){return a(c)},500),o._options.imageTimeout>0&&setTimeout(function(){return l("Timed out ("+o._options.imageTimeout+"ms) loading image")},o._options.imageTimeout)})];case 3:return[2,A.sent()]}})})},n.prototype.has=function(t){return typeof this._cache[t]<"u"},n.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},n.prototype.proxy=function(t){var e=this,s=this._options.proxy;if(!s)throw new Error("No proxy defined");var r=t.substring(0,256);return new Promise(function(i,o){var A=Ue.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(a.status===200)if(A==="text")i(a.response);else{var u=new FileReader;u.addEventListener("load",function(){return i(u.result)},!1),u.addEventListener("error",function(d){return o(d)},!1),u.readAsDataURL(a.response)}else o("Failed to proxy resource "+r+" with status code "+a.status)},a.onerror=o;var l=s.indexOf("?")>-1?"&":"?";if(a.open("GET",""+s+l+"url="+encodeURIComponent(t)+"&responseType="+A),A!=="text"&&a instanceof XMLHttpRequest&&(a.responseType=A),e._options.imageTimeout){var c=e._options.imageTimeout;a.timeout=c,a.ontimeout=function(){return o("Timed out ("+c+"ms) proxying "+r)}}a.send()})},n})(),G4=/^data:image\/svg\+xml/i,K4=/^data:image\/.*;base64,/i,q4=/^data:image\/.*/i,z4=function(n){return Ue.SUPPORT_SVG_DRAWING||!X4(n)},Md=function(n){return q4.test(n)},$4=function(n){return K4.test(n)},Qd=function(n){return n.substr(0,4)==="blob"},X4=function(n){return n.substr(-3).toLowerCase()==="svg"||G4.test(n)},ut=(function(){function n(t,e){this.type=0,this.x=t,this.y=e}return n.prototype.add=function(t,e){return new n(this.x+t,this.y+e)},n})(),ji=function(n,t,e){return new ut(n.x+(t.x-n.x)*e,n.y+(t.y-n.y)*e)},Cl=(function(){function n(t,e,s,r){this.type=1,this.start=t,this.startControl=e,this.endControl=s,this.end=r}return n.prototype.subdivide=function(t,e){var s=ji(this.start,this.startControl,t),r=ji(this.startControl,this.endControl,t),i=ji(this.endControl,this.end,t),o=ji(s,r,t),A=ji(r,i,t),a=ji(o,A,t);return e?new n(this.start,s,o,a):new n(a,A,i,this.end)},n.prototype.add=function(t,e){return new n(this.start.add(t,e),this.startControl.add(t,e),this.endControl.add(t,e),this.end.add(t,e))},n.prototype.reverse=function(){return new n(this.end,this.endControl,this.startControl,this.start)},n})(),Vn=function(n){return n.type===1},Y4=(function(){function n(t){var e=t.styles,s=t.bounds,r=wA(e.borderTopLeftRadius,s.width,s.height),i=r[0],o=r[1],A=wA(e.borderTopRightRadius,s.width,s.height),a=A[0],l=A[1],c=wA(e.borderBottomRightRadius,s.width,s.height),u=c[0],d=c[1],p=wA(e.borderBottomLeftRadius,s.width,s.height),h=p[0],m=p[1],g=[];g.push((i+a)/s.width),g.push((h+u)/s.width),g.push((o+m)/s.height),g.push((l+d)/s.height);var v=Math.max.apply(Math,g);v>1&&(i/=v,o/=v,a/=v,l/=v,u/=v,d/=v,h/=v,m/=v);var w=s.width-a,y=s.height-d,I=s.width-u,B=s.height-m,C=e.borderTopWidth,b=e.borderRightWidth,S=e.borderBottomWidth,T=e.borderLeftWidth,x=Xt(e.paddingTop,t.bounds.width),_=Xt(e.paddingRight,t.bounds.width),F=Xt(e.paddingBottom,t.bounds.width),Q=Xt(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||o>0?te(s.left+T/3,s.top+C/3,i-T/3,o-C/3,Lt.TOP_LEFT):new ut(s.left+T/3,s.top+C/3),this.topRightBorderDoubleOuterBox=i>0||o>0?te(s.left+w,s.top+C/3,a-b/3,l-C/3,Lt.TOP_RIGHT):new ut(s.left+s.width-b/3,s.top+C/3),this.bottomRightBorderDoubleOuterBox=u>0||d>0?te(s.left+I,s.top+y,u-b/3,d-S/3,Lt.BOTTOM_RIGHT):new ut(s.left+s.width-b/3,s.top+s.height-S/3),this.bottomLeftBorderDoubleOuterBox=h>0||m>0?te(s.left+T/3,s.top+B,h-T/3,m-S/3,Lt.BOTTOM_LEFT):new ut(s.left+T/3,s.top+s.height-S/3),this.topLeftBorderDoubleInnerBox=i>0||o>0?te(s.left+T*2/3,s.top+C*2/3,i-T*2/3,o-C*2/3,Lt.TOP_LEFT):new ut(s.left+T*2/3,s.top+C*2/3),this.topRightBorderDoubleInnerBox=i>0||o>0?te(s.left+w,s.top+C*2/3,a-b*2/3,l-C*2/3,Lt.TOP_RIGHT):new ut(s.left+s.width-b*2/3,s.top+C*2/3),this.bottomRightBorderDoubleInnerBox=u>0||d>0?te(s.left+I,s.top+y,u-b*2/3,d-S*2/3,Lt.BOTTOM_RIGHT):new ut(s.left+s.width-b*2/3,s.top+s.height-S*2/3),this.bottomLeftBorderDoubleInnerBox=h>0||m>0?te(s.left+T*2/3,s.top+B,h-T*2/3,m-S*2/3,Lt.BOTTOM_LEFT):new ut(s.left+T*2/3,s.top+s.height-S*2/3),this.topLeftBorderStroke=i>0||o>0?te(s.left+T/2,s.top+C/2,i-T/2,o-C/2,Lt.TOP_LEFT):new ut(s.left+T/2,s.top+C/2),this.topRightBorderStroke=i>0||o>0?te(s.left+w,s.top+C/2,a-b/2,l-C/2,Lt.TOP_RIGHT):new ut(s.left+s.width-b/2,s.top+C/2),this.bottomRightBorderStroke=u>0||d>0?te(s.left+I,s.top+y,u-b/2,d-S/2,Lt.BOTTOM_RIGHT):new ut(s.left+s.width-b/2,s.top+s.height-S/2),this.bottomLeftBorderStroke=h>0||m>0?te(s.left+T/2,s.top+B,h-T/2,m-S/2,Lt.BOTTOM_LEFT):new ut(s.left+T/2,s.top+s.height-S/2),this.topLeftBorderBox=i>0||o>0?te(s.left,s.top,i,o,Lt.TOP_LEFT):new ut(s.left,s.top),this.topRightBorderBox=a>0||l>0?te(s.left+w,s.top,a,l,Lt.TOP_RIGHT):new ut(s.left+s.width,s.top),this.bottomRightBorderBox=u>0||d>0?te(s.left+I,s.top+y,u,d,Lt.BOTTOM_RIGHT):new ut(s.left+s.width,s.top+s.height),this.bottomLeftBorderBox=h>0||m>0?te(s.left,s.top+B,h,m,Lt.BOTTOM_LEFT):new ut(s.left,s.top+s.height),this.topLeftPaddingBox=i>0||o>0?te(s.left+T,s.top+C,Math.max(0,i-T),Math.max(0,o-C),Lt.TOP_LEFT):new ut(s.left+T,s.top+C),this.topRightPaddingBox=a>0||l>0?te(s.left+Math.min(w,s.width-b),s.top+C,w>s.width+b?0:Math.max(0,a-b),Math.max(0,l-C),Lt.TOP_RIGHT):new ut(s.left+s.width-b,s.top+C),this.bottomRightPaddingBox=u>0||d>0?te(s.left+Math.min(I,s.width-T),s.top+Math.min(y,s.height-S),Math.max(0,u-b),Math.max(0,d-S),Lt.BOTTOM_RIGHT):new ut(s.left+s.width-b,s.top+s.height-S),this.bottomLeftPaddingBox=h>0||m>0?te(s.left+T,s.top+Math.min(B,s.height-S),Math.max(0,h-T),Math.max(0,m-S),Lt.BOTTOM_LEFT):new ut(s.left+T,s.top+s.height-S),this.topLeftContentBox=i>0||o>0?te(s.left+T+Q,s.top+C+x,Math.max(0,i-(T+Q)),Math.max(0,o-(C+x)),Lt.TOP_LEFT):new ut(s.left+T+Q,s.top+C+x),this.topRightContentBox=a>0||l>0?te(s.left+Math.min(w,s.width+T+Q),s.top+C+x,w>s.width+T+Q?0:a-T+Q,l-(C+x),Lt.TOP_RIGHT):new ut(s.left+s.width-(b+_),s.top+C+x),this.bottomRightContentBox=u>0||d>0?te(s.left+Math.min(I,s.width-(T+Q)),s.top+Math.min(y,s.height+C+x),Math.max(0,u-(b+_)),d-(S+F),Lt.BOTTOM_RIGHT):new ut(s.left+s.width-(b+_),s.top+s.height-(S+F)),this.bottomLeftContentBox=h>0||m>0?te(s.left+T+Q,s.top+B,Math.max(0,h-(T+Q)),m-(S+F),Lt.BOTTOM_LEFT):new ut(s.left+T+Q,s.top+s.height-(S+F))}return n})(),Lt;(function(n){n[n.TOP_LEFT=0]="TOP_LEFT",n[n.TOP_RIGHT=1]="TOP_RIGHT",n[n.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",n[n.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Lt||(Lt={}));var te=function(n,t,e,s,r){var i=4*((Math.sqrt(2)-1)/3),o=e*i,A=s*i,a=n+e,l=t+s;switch(r){case Lt.TOP_LEFT:return new Cl(new ut(n,l),new ut(n,l-A),new ut(a-o,t),new ut(a,t));case Lt.TOP_RIGHT:return new Cl(new ut(n,t),new ut(n+o,t),new ut(a,l-A),new ut(a,l));case Lt.BOTTOM_RIGHT:return new Cl(new ut(a,t),new ut(a,t+A),new ut(n+o,l),new ut(n,l));case Lt.BOTTOM_LEFT:default:return new Cl(new ut(a,l),new ut(a-o,l),new ut(n,t+A),new ut(n,t))}},Uc=function(n){return[n.topLeftBorderBox,n.topRightBorderBox,n.bottomRightBorderBox,n.bottomLeftBorderBox]},j4=function(n){return[n.topLeftContentBox,n.topRightContentBox,n.bottomRightContentBox,n.bottomLeftContentBox]},Pc=function(n){return[n.topLeftPaddingBox,n.topRightPaddingBox,n.bottomRightPaddingBox,n.bottomLeftPaddingBox]},J4=(function(){function n(t,e,s){this.offsetX=t,this.offsetY=e,this.matrix=s,this.type=0,this.target=6}return n})(),bl=(function(){function n(t,e){this.path=t,this.target=e,this.type=1}return n})(),Z4=(function(){function n(t){this.opacity=t,this.type=2,this.target=6}return n})(),tN=function(n){return n.type===0},wC=function(n){return n.type===1},eN=function(n){return n.type===2},m0=function(n,t){return n.length===t.length?n.some(function(e,s){return e===t[s]}):!1},nN=function(n,t,e,s,r){return n.map(function(i,o){switch(o){case 0:return i.add(t,e);case 1:return i.add(t+s,e);case 2:return i.add(t+s,e+r);case 3:return i.add(t,e+r)}return i})},BC=(function(){function n(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return n})(),CC=(function(){function n(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new Y4(this.container),this.container.styles.opacity<1&&this.effects.push(new Z4(this.container.styles.opacity)),this.container.styles.transform!==null){var s=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new J4(s,r,i))}if(this.container.styles.overflowX!==0){var o=Uc(this.curves),A=Pc(this.curves);m0(o,A)?this.effects.push(new bl(o,6)):(this.effects.push(new bl(o,2)),this.effects.push(new bl(A,4)))}}return n.prototype.getEffects=function(t){for(var e=[2,3].indexOf(this.container.styles.position)===-1,s=this.parent,r=this.effects.slice(0);s;){var i=s.effects.filter(function(a){return!wC(a)});if(e||s.container.styles.position!==0||!s.parent){if(r.unshift.apply(r,i),e=[2,3].indexOf(s.container.styles.position)===-1,s.container.styles.overflowX!==0){var o=Uc(s.curves),A=Pc(s.curves);m0(o,A)||r.unshift(new bl(A,6))}}else r.unshift.apply(r,i);s=s.parent}return r.filter(function(a){return be(a.target,t)})},n})(),Oh=function(n,t,e,s){n.container.elements.forEach(function(r){var i=be(r.flags,4),o=be(r.flags,2),A=new CC(r,n);be(r.styles.display,2048)&&s.push(A);var a=be(r.flags,8)?[]:s;if(i||o){var l=i||r.styles.isPositioned()?e:t,c=new BC(A);if(r.styles.isPositioned()||r.styles.opacity<1||r.styles.isTransformed()){var u=r.styles.zIndex.order;if(u<0){var d=0;l.negativeZIndex.some(function(h,m){return u>h.element.container.styles.zIndex.order?(d=m,!1):d>0}),l.negativeZIndex.splice(d,0,c)}else if(u>0){var p=0;l.positiveZIndex.some(function(h,m){return u>=h.element.container.styles.zIndex.order?(p=m+1,!1):p>0}),l.positiveZIndex.splice(p,0,c)}else l.zeroOrAutoZIndexOrTransformedOrOpacity.push(c)}else r.styles.isFloating()?l.nonPositionedFloats.push(c):l.nonPositionedInlineLevel.push(c);Oh(A,c,i?c:e,a)}else r.styles.isInlineLevel()?t.inlineLevel.push(A):t.nonInlineLevel.push(A),Oh(A,t,e,a);be(r.flags,8)&&bC(r,a)})},bC=function(n,t){for(var e=n instanceof Dh?n.start:1,s=n instanceof Dh?n.reversed:!1,r=0;r<t.length;r++){var i=t[r];i.container instanceof iC&&typeof i.container.value=="number"&&i.container.value!==0&&(e=i.container.value),i.listValue=da(e,i.container.styles.listStyleType,!0),e+=s?-1:1}},sN=function(n){var t=new CC(n,null),e=new BC(t),s=[];return Oh(t,e,e,s),bC(t.container,s),e},g0=function(n,t){switch(t){case 0:return zn(n.topLeftBorderBox,n.topLeftPaddingBox,n.topRightBorderBox,n.topRightPaddingBox);case 1:return zn(n.topRightBorderBox,n.topRightPaddingBox,n.bottomRightBorderBox,n.bottomRightPaddingBox);case 2:return zn(n.bottomRightBorderBox,n.bottomRightPaddingBox,n.bottomLeftBorderBox,n.bottomLeftPaddingBox);case 3:default:return zn(n.bottomLeftBorderBox,n.bottomLeftPaddingBox,n.topLeftBorderBox,n.topLeftPaddingBox)}},rN=function(n,t){switch(t){case 0:return zn(n.topLeftBorderBox,n.topLeftBorderDoubleOuterBox,n.topRightBorderBox,n.topRightBorderDoubleOuterBox);case 1:return zn(n.topRightBorderBox,n.topRightBorderDoubleOuterBox,n.bottomRightBorderBox,n.bottomRightBorderDoubleOuterBox);case 2:return zn(n.bottomRightBorderBox,n.bottomRightBorderDoubleOuterBox,n.bottomLeftBorderBox,n.bottomLeftBorderDoubleOuterBox);case 3:default:return zn(n.bottomLeftBorderBox,n.bottomLeftBorderDoubleOuterBox,n.topLeftBorderBox,n.topLeftBorderDoubleOuterBox)}},iN=function(n,t){switch(t){case 0:return zn(n.topLeftBorderDoubleInnerBox,n.topLeftPaddingBox,n.topRightBorderDoubleInnerBox,n.topRightPaddingBox);case 1:return zn(n.topRightBorderDoubleInnerBox,n.topRightPaddingBox,n.bottomRightBorderDoubleInnerBox,n.bottomRightPaddingBox);case 2:return zn(n.bottomRightBorderDoubleInnerBox,n.bottomRightPaddingBox,n.bottomLeftBorderDoubleInnerBox,n.bottomLeftPaddingBox);case 3:default:return zn(n.bottomLeftBorderDoubleInnerBox,n.bottomLeftPaddingBox,n.topLeftBorderDoubleInnerBox,n.topLeftPaddingBox)}},oN=function(n,t){switch(t){case 0:return yl(n.topLeftBorderStroke,n.topRightBorderStroke);case 1:return yl(n.topRightBorderStroke,n.bottomRightBorderStroke);case 2:return yl(n.bottomRightBorderStroke,n.bottomLeftBorderStroke);case 3:default:return yl(n.bottomLeftBorderStroke,n.topLeftBorderStroke)}},yl=function(n,t){var e=[];return Vn(n)?e.push(n.subdivide(.5,!1)):e.push(n),Vn(t)?e.push(t.subdivide(.5,!0)):e.push(t),e},zn=function(n,t,e,s){var r=[];return Vn(n)?r.push(n.subdivide(.5,!1)):r.push(n),Vn(e)?r.push(e.subdivide(.5,!0)):r.push(e),Vn(s)?r.push(s.subdivide(.5,!0).reverse()):r.push(s),Vn(t)?r.push(t.subdivide(.5,!1).reverse()):r.push(t),r},yC=function(n){var t=n.bounds,e=n.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},Nc=function(n){var t=n.styles,e=n.bounds,s=Xt(t.paddingLeft,e.width),r=Xt(t.paddingRight,e.width),i=Xt(t.paddingTop,e.width),o=Xt(t.paddingBottom,e.width);return e.add(s+t.borderLeftWidth,i+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+s+r),-(t.borderTopWidth+t.borderBottomWidth+i+o))},AN=function(n,t){return n===0?t.bounds:n===2?Nc(t):yC(t)},aN=function(n,t){return n===0?t.bounds:n===2?Nc(t):yC(t)},Ud=function(n,t,e){var s=AN(io(n.styles.backgroundOrigin,t),n),r=aN(io(n.styles.backgroundClip,t),n),i=lN(io(n.styles.backgroundSize,t),e,s),o=i[0],A=i[1],a=wA(io(n.styles.backgroundPosition,t),s.width-o,s.height-A),l=cN(io(n.styles.backgroundRepeat,t),a,i,s,r),c=Math.round(s.left+a[0]),u=Math.round(s.top+a[1]);return[l,c,u,o,A]},Ji=function(n){return qt(n)&&n.value===Mo.AUTO},Sl=function(n){return typeof n=="number"},lN=function(n,t,e){var s=t[0],r=t[1],i=t[2],o=n[0],A=n[1];if(!o)return[0,0];if(me(o)&&A&&me(A))return[Xt(o,e.width),Xt(A,e.height)];var a=Sl(i);if(qt(o)&&(o.value===Mo.CONTAIN||o.value===Mo.COVER)){if(Sl(i)){var l=e.width/e.height;return l<i!=(o.value===Mo.COVER)?[e.width,e.width/i]:[e.height*i,e.height]}return[e.width,e.height]}var c=Sl(s),u=Sl(r),d=c||u;if(Ji(o)&&(!A||Ji(A))){if(c&&u)return[s,r];if(!a&&!d)return[e.width,e.height];if(d&&a){var p=c?s:r*i,h=u?r:s/i;return[p,h]}var m=c?s:e.width,g=u?r:e.height;return[m,g]}if(a){var v=0,w=0;return me(o)?v=Xt(o,e.width):me(A)&&(w=Xt(A,e.height)),Ji(o)?v=w*i:(!A||Ji(A))&&(w=v/i),[v,w]}var y=null,I=null;if(me(o)?y=Xt(o,e.width):A&&me(A)&&(I=Xt(A,e.height)),y!==null&&(!A||Ji(A))&&(I=c&&u?y/s*r:e.height),I!==null&&Ji(o)&&(y=c&&u?I/r*s:e.width),y!==null&&I!==null)return[y,I];throw new Error("Unable to calculate background-size for element")},io=function(n,t){var e=n[t];return typeof e>"u"?n[0]:e},cN=function(n,t,e,s,r){var i=t[0],o=t[1],A=e[0],a=e[1];switch(n){case 2:return[new ut(Math.round(s.left),Math.round(s.top+o)),new ut(Math.round(s.left+s.width),Math.round(s.top+o)),new ut(Math.round(s.left+s.width),Math.round(a+s.top+o)),new ut(Math.round(s.left),Math.round(a+s.top+o))];case 3:return[new ut(Math.round(s.left+i),Math.round(s.top)),new ut(Math.round(s.left+i+A),Math.round(s.top)),new ut(Math.round(s.left+i+A),Math.round(s.height+s.top)),new ut(Math.round(s.left+i),Math.round(s.height+s.top))];case 1:return[new ut(Math.round(s.left+i),Math.round(s.top+o)),new ut(Math.round(s.left+i+A),Math.round(s.top+o)),new ut(Math.round(s.left+i+A),Math.round(s.top+o+a)),new ut(Math.round(s.left+i),Math.round(s.top+o+a))];default:return[new ut(Math.round(r.left),Math.round(r.top)),new ut(Math.round(r.left+r.width),Math.round(r.top)),new ut(Math.round(r.left+r.width),Math.round(r.height+r.top)),new ut(Math.round(r.left),Math.round(r.height+r.top))]}},uN="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",v0="Hidden Text",dN=(function(){function n(t){this._data={},this._document=t}return n.prototype.parseMetrics=function(t,e){var s=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),o=this._document.body;s.style.visibility="hidden",s.style.fontFamily=t,s.style.fontSize=e,s.style.margin="0",s.style.padding="0",s.style.whiteSpace="nowrap",o.appendChild(s),r.src=uN,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=t,i.style.fontSize=e,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(v0)),s.appendChild(i),s.appendChild(r);var A=r.offsetTop-i.offsetTop+2;s.removeChild(i),s.appendChild(this._document.createTextNode(v0)),s.style.lineHeight="normal",r.style.verticalAlign="super";var a=r.offsetTop-s.offsetTop+2;return o.removeChild(s),{baseline:A,middle:a}},n.prototype.getMetrics=function(t,e){var s=t+" "+e;return typeof this._data[s]>"u"&&(this._data[s]=this.parseMetrics(t,e)),this._data[s]},n})(),SC=(function(){function n(t,e){this.context=t,this.options=e}return n})(),hN=1e4,fN=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r._activeEffects=[],r.canvas=s.canvas?s.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),s.canvas||(r.canvas.width=Math.floor(s.width*s.scale),r.canvas.height=Math.floor(s.height*s.scale),r.canvas.style.width=s.width+"px",r.canvas.style.height=s.height+"px"),r.fontMetrics=new dN(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-s.x,-s.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+s.width+"x"+s.height+") with scale "+s.scale),r}return t.prototype.applyEffects=function(e){for(var s=this;this._activeEffects.length;)this.popEffect();e.forEach(function(r){return s.applyEffect(r)})},t.prototype.applyEffect=function(e){this.ctx.save(),eN(e)&&(this.ctx.globalAlpha=e.opacity),tN(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),wC(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return Ze(this,void 0,void 0,function(){var s;return Oe(this,function(r){switch(r.label){case 0:return s=e.element.container.styles,s.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(e){return Ze(this,void 0,void 0,function(){return Oe(this,function(s){switch(s.label){case 0:if(be(e.container.flags,16))debugger;return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return s.sent(),[4,this.renderNodeContent(e)];case 2:s.sent(),s.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(e,s,r){var i=this;if(s===0)this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+r);else{var o=xp(e.text);o.reduce(function(A,a){return i.ctx.fillText(a,A,e.bounds.top+r),A+i.ctx.measureText(a).width},e.bounds.left)}},t.prototype.createFontStyle=function(e){var s=e.fontVariant.filter(function(o){return o==="normal"||o==="small-caps"}).join(""),r=wN(e.fontFamily).join(", "),i=ka(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,s,e.fontWeight,i,r].join(" "),r,i]},t.prototype.renderTextNode=function(e,s){return Ze(this,void 0,void 0,function(){var r,i,o,A,a,l,c,u,d=this;return Oe(this,function(p){return r=this.createFontStyle(s),i=r[0],o=r[1],A=r[2],this.ctx.font=i,this.ctx.direction=s.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(o,A),l=a.baseline,c=a.middle,u=s.paintOrder,e.textBounds.forEach(function(h){u.forEach(function(m){switch(m){case 0:d.ctx.fillStyle=xe(s.color),d.renderTextWithLetterSpacing(h,s.letterSpacing,l);var g=s.textShadow;g.length&&h.text.trim().length&&(g.slice(0).reverse().forEach(function(v){d.ctx.shadowColor=xe(v.color),d.ctx.shadowOffsetX=v.offsetX.number*d.options.scale,d.ctx.shadowOffsetY=v.offsetY.number*d.options.scale,d.ctx.shadowBlur=v.blur.number,d.renderTextWithLetterSpacing(h,s.letterSpacing,l)}),d.ctx.shadowColor="",d.ctx.shadowOffsetX=0,d.ctx.shadowOffsetY=0,d.ctx.shadowBlur=0),s.textDecorationLine.length&&(d.ctx.fillStyle=xe(s.textDecorationColor||s.color),s.textDecorationLine.forEach(function(v){switch(v){case 1:d.ctx.fillRect(h.bounds.left,Math.round(h.bounds.top+l),h.bounds.width,1);break;case 2:d.ctx.fillRect(h.bounds.left,Math.round(h.bounds.top),h.bounds.width,1);break;case 3:d.ctx.fillRect(h.bounds.left,Math.ceil(h.bounds.top+c),h.bounds.width,1);break}}));break;case 1:s.webkitTextStrokeWidth&&h.text.trim().length&&(d.ctx.strokeStyle=xe(s.webkitTextStrokeColor),d.ctx.lineWidth=s.webkitTextStrokeWidth,d.ctx.lineJoin=window.chrome?"miter":"round",d.ctx.strokeText(h.text,h.bounds.left,h.bounds.top+l)),d.ctx.strokeStyle="",d.ctx.lineWidth=0,d.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(e,s,r){if(r&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var i=Nc(e),o=Pc(s);this.path(o),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,e.intrinsicWidth,e.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return Ze(this,void 0,void 0,function(){var s,r,i,o,A,a,w,w,l,c,u,d,I,p,h,B,m,g,v,w,y,I,B;return Oe(this,function(C){switch(C.label){case 0:this.applyEffects(e.getEffects(4)),s=e.container,r=e.curves,i=s.styles,o=0,A=s.textNodes,C.label=1;case 1:return o<A.length?(a=A[o],[4,this.renderTextNode(a,i)]):[3,4];case 2:C.sent(),C.label=3;case 3:return o++,[3,1];case 4:if(!(s instanceof nC))return[3,8];C.label=5;case 5:return C.trys.push([5,7,,8]),[4,this.context.cache.match(s.src)];case 6:return w=C.sent(),this.renderReplacedElement(s,r,w),[3,8];case 7:return C.sent(),this.context.logger.error("Error loading image "+s.src),[3,8];case 8:if(s instanceof sC&&this.renderReplacedElement(s,r,s.canvas),!(s instanceof rC))return[3,12];C.label=9;case 9:return C.trys.push([9,11,,12]),[4,this.context.cache.match(s.svg)];case 10:return w=C.sent(),this.renderReplacedElement(s,r,w),[3,12];case 11:return C.sent(),this.context.logger.error("Error loading svg "+s.svg.substring(0,255)),[3,12];case 12:return s instanceof aC&&s.tree?(l=new t(this.context,{scale:this.options.scale,backgroundColor:s.backgroundColor,x:0,y:0,width:s.width,height:s.height}),[4,l.render(s.tree)]):[3,14];case 13:c=C.sent(),s.width&&s.height&&this.ctx.drawImage(c,0,0,s.width,s.height,s.bounds.left,s.bounds.top,s.bounds.width,s.bounds.height),C.label=14;case 14:if(s instanceof Ip&&(u=Math.min(s.bounds.width,s.bounds.height),s.type===Tc?s.checked&&(this.ctx.save(),this.path([new ut(s.bounds.left+u*.39363,s.bounds.top+u*.79),new ut(s.bounds.left+u*.16,s.bounds.top+u*.5549),new ut(s.bounds.left+u*.27347,s.bounds.top+u*.44071),new ut(s.bounds.left+u*.39694,s.bounds.top+u*.5649),new ut(s.bounds.left+u*.72983,s.bounds.top+u*.23),new ut(s.bounds.left+u*.84,s.bounds.top+u*.34085),new ut(s.bounds.left+u*.39363,s.bounds.top+u*.79)]),this.ctx.fillStyle=xe(i0),this.ctx.fill(),this.ctx.restore()):s.type===_c&&s.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(s.bounds.left+u/2,s.bounds.top+u/2,u/4,0,Math.PI*2,!0),this.ctx.fillStyle=xe(i0),this.ctx.fill(),this.ctx.restore())),pN(s)&&s.value.length){switch(d=this.createFontStyle(i),I=d[0],p=d[1],h=this.fontMetrics.getMetrics(I,p).baseline,this.ctx.font=I,this.ctx.fillStyle=xe(i.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=gN(s.styles.textAlign),B=Nc(s),m=0,s.styles.textAlign){case 1:m+=B.width/2;break;case 2:m+=B.width;break}g=B.add(m,0,0,-B.height/2+1),this.ctx.save(),this.path([new ut(B.left,B.top),new ut(B.left+B.width,B.top),new ut(B.left+B.width,B.top+B.height),new ut(B.left,B.top+B.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new OA(s.value,g),i.letterSpacing,h),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!be(s.styles.display,2048))return[3,20];if(s.styles.listStyleImage===null)return[3,19];if(v=s.styles.listStyleImage,v.type!==0)return[3,18];w=void 0,y=v.url,C.label=15;case 15:return C.trys.push([15,17,,18]),[4,this.context.cache.match(y)];case 16:return w=C.sent(),this.ctx.drawImage(w,s.bounds.left-(w.width+10),s.bounds.top),[3,18];case 17:return C.sent(),this.context.logger.error("Error loading list-style-image "+y),[3,18];case 18:return[3,20];case 19:e.listValue&&s.styles.listStyleType!==-1&&(I=this.createFontStyle(i)[0],this.ctx.font=I,this.ctx.fillStyle=xe(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",B=new cr(s.bounds.left,s.bounds.top+Xt(s.styles.paddingTop,s.bounds.width),s.bounds.width,Vg(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new OA(e.listValue,B),i.letterSpacing,Vg(i.lineHeight,i.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),C.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(e){return Ze(this,void 0,void 0,function(){var s,r,v,i,o,v,A,a,v,l,c,v,u,d,v,p,h,v,m,g,v;return Oe(this,function(w){switch(w.label){case 0:if(be(e.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:w.sent(),s=0,r=e.negativeZIndex,w.label=2;case 2:return s<r.length?(v=r[s],[4,this.renderStack(v)]):[3,5];case 3:w.sent(),w.label=4;case 4:return s++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:w.sent(),i=0,o=e.nonInlineLevel,w.label=7;case 7:return i<o.length?(v=o[i],[4,this.renderNode(v)]):[3,10];case 8:w.sent(),w.label=9;case 9:return i++,[3,7];case 10:A=0,a=e.nonPositionedFloats,w.label=11;case 11:return A<a.length?(v=a[A],[4,this.renderStack(v)]):[3,14];case 12:w.sent(),w.label=13;case 13:return A++,[3,11];case 14:l=0,c=e.nonPositionedInlineLevel,w.label=15;case 15:return l<c.length?(v=c[l],[4,this.renderStack(v)]):[3,18];case 16:w.sent(),w.label=17;case 17:return l++,[3,15];case 18:u=0,d=e.inlineLevel,w.label=19;case 19:return u<d.length?(v=d[u],[4,this.renderNode(v)]):[3,22];case 20:w.sent(),w.label=21;case 21:return u++,[3,19];case 22:p=0,h=e.zeroOrAutoZIndexOrTransformedOrOpacity,w.label=23;case 23:return p<h.length?(v=h[p],[4,this.renderStack(v)]):[3,26];case 24:w.sent(),w.label=25;case 25:return p++,[3,23];case 26:m=0,g=e.positiveZIndex,w.label=27;case 27:return m<g.length?(v=g[m],[4,this.renderStack(v)]):[3,30];case 28:w.sent(),w.label=29;case 29:return m++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var s=this;e.forEach(function(r,i){var o=Vn(r)?r.start:r;i===0?s.ctx.moveTo(o.x,o.y):s.ctx.lineTo(o.x,o.y),Vn(r)&&s.ctx.bezierCurveTo(r.startControl.x,r.startControl.y,r.endControl.x,r.endControl.y,r.end.x,r.end.y)})},t.prototype.renderRepeat=function(e,s,r,i){this.path(e),this.ctx.fillStyle=s,this.ctx.translate(r,i),this.ctx.fill(),this.ctx.translate(-r,-i)},t.prototype.resizeImage=function(e,s,r){var i;if(e.width===s&&e.height===r)return e;var o=(i=this.canvas.ownerDocument)!==null&&i!==void 0?i:document,A=o.createElement("canvas");A.width=Math.max(1,s),A.height=Math.max(1,r);var a=A.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,s,r),A},t.prototype.renderBackgroundImage=function(e){return Ze(this,void 0,void 0,function(){var s,r,i,o,A,a;return Oe(this,function(l){switch(l.label){case 0:s=e.styles.backgroundImage.length-1,r=function(c){var u,d,p,x,D,R,Q,U,S,h,x,D,R,Q,U,m,g,v,w,y,I,B,C,b,S,T,x,_,F,Q,U,W,D,R,N,q,J,nt,At,ot,V,H;return Oe(this,function(G){switch(G.label){case 0:if(c.type!==0)return[3,5];u=void 0,d=c.url,G.label=1;case 1:return G.trys.push([1,3,,4]),[4,i.context.cache.match(d)];case 2:return u=G.sent(),[3,4];case 3:return G.sent(),i.context.logger.error("Error loading background-image "+d),[3,4];case 4:return u&&(p=Ud(e,s,[u.width,u.height,u.width/u.height]),x=p[0],D=p[1],R=p[2],Q=p[3],U=p[4],S=i.ctx.createPattern(i.resizeImage(u,Q,U),"repeat"),i.renderRepeat(x,S,D,R)),[3,6];case 5:t3(c)?(h=Ud(e,s,[null,null,null]),x=h[0],D=h[1],R=h[2],Q=h[3],U=h[4],m=XU(c.angle,Q,U),g=m[0],v=m[1],w=m[2],y=m[3],I=m[4],B=document.createElement("canvas"),B.width=Q,B.height=U,C=B.getContext("2d"),b=C.createLinearGradient(v,y,w,I),Hg(c.stops,g).forEach(function(Y){return b.addColorStop(Y.stop,xe(Y.color))}),C.fillStyle=b,C.fillRect(0,0,Q,U),Q>0&&U>0&&(S=i.ctx.createPattern(B,"repeat"),i.renderRepeat(x,S,D,R))):e3(c)&&(T=Ud(e,s,[null,null,null]),x=T[0],_=T[1],F=T[2],Q=T[3],U=T[4],W=c.position.length===0?[yp]:c.position,D=Xt(W[0],Q),R=Xt(W[W.length-1],U),N=YU(c,D,R,Q,U),q=N[0],J=N[1],q>0&&J>0&&(nt=i.ctx.createRadialGradient(_+D,F+R,0,_+D,F+R,q),Hg(c.stops,q*2).forEach(function(Y){return nt.addColorStop(Y.stop,xe(Y.color))}),i.path(x),i.ctx.fillStyle=nt,q!==J?(At=e.bounds.left+.5*e.bounds.width,ot=e.bounds.top+.5*e.bounds.height,V=J/q,H=1/V,i.ctx.save(),i.ctx.translate(At,ot),i.ctx.transform(1,0,0,V,0,0),i.ctx.translate(-At,-ot),i.ctx.fillRect(_,H*(F-ot)+ot,Q,U*H),i.ctx.restore()):i.ctx.fill())),G.label=6;case 6:return s--,[2]}})},i=this,o=0,A=e.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return o<A.length?(a=A[o],[5,r(a)]):[3,4];case 2:l.sent(),l.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(e,s,r){return Ze(this,void 0,void 0,function(){return Oe(this,function(i){return this.path(g0(r,s)),this.ctx.fillStyle=xe(e),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(e,s,r,i){return Ze(this,void 0,void 0,function(){var o,A;return Oe(this,function(a){switch(a.label){case 0:return s<3?[4,this.renderSolidBorder(e,r,i)]:[3,2];case 1:return a.sent(),[2];case 2:return o=rN(i,r),this.path(o),this.ctx.fillStyle=xe(e),this.ctx.fill(),A=iN(i,r),this.path(A),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(e){return Ze(this,void 0,void 0,function(){var s,r,i,o,A,a,l,c,u=this;return Oe(this,function(d){switch(d.label){case 0:return this.applyEffects(e.getEffects(2)),s=e.container.styles,r=!Or(s.backgroundColor)||s.backgroundImage.length,i=[{style:s.borderTopStyle,color:s.borderTopColor,width:s.borderTopWidth},{style:s.borderRightStyle,color:s.borderRightColor,width:s.borderRightWidth},{style:s.borderBottomStyle,color:s.borderBottomColor,width:s.borderBottomWidth},{style:s.borderLeftStyle,color:s.borderLeftColor,width:s.borderLeftWidth}],o=mN(io(s.backgroundClip,0),e.curves),r||s.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),Or(s.backgroundColor)||(this.ctx.fillStyle=xe(s.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:d.sent(),this.ctx.restore(),s.boxShadow.slice(0).reverse().forEach(function(p){u.ctx.save();var h=Uc(e.curves),m=p.inset?0:hN,g=nN(h,-m+(p.inset?1:-1)*p.spread.number,(p.inset?1:-1)*p.spread.number,p.spread.number*(p.inset?-2:2),p.spread.number*(p.inset?-2:2));p.inset?(u.path(h),u.ctx.clip(),u.mask(g)):(u.mask(h),u.ctx.clip(),u.path(g)),u.ctx.shadowOffsetX=p.offsetX.number+m,u.ctx.shadowOffsetY=p.offsetY.number,u.ctx.shadowColor=xe(p.color),u.ctx.shadowBlur=p.blur.number,u.ctx.fillStyle=p.inset?xe(p.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()}),d.label=2;case 2:A=0,a=0,l=i,d.label=3;case 3:return a<l.length?(c=l[a],c.style!==0&&!Or(c.color)&&c.width>0?c.style!==2?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,A,e.curves,2)]:[3,11]):[3,13];case 4:return d.sent(),[3,11];case 5:return c.style!==3?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,A,e.curves,3)];case 6:return d.sent(),[3,11];case 7:return c.style!==4?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,A,e.curves)];case 8:return d.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,A,e.curves)];case 10:d.sent(),d.label=11;case 11:A++,d.label=12;case 12:return a++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(e,s,r,i,o){return Ze(this,void 0,void 0,function(){var A,a,l,c,u,d,p,h,m,g,v,w,y,I,B,C,B,C;return Oe(this,function(b){return this.ctx.save(),A=oN(i,r),a=g0(i,r),o===2&&(this.path(a),this.ctx.clip()),Vn(a[0])?(l=a[0].start.x,c=a[0].start.y):(l=a[0].x,c=a[0].y),Vn(a[1])?(u=a[1].end.x,d=a[1].end.y):(u=a[1].x,d=a[1].y),r===0||r===2?p=Math.abs(l-u):p=Math.abs(c-d),this.ctx.beginPath(),o===3?this.formatPath(A):this.formatPath(a.slice(0,2)),h=s<3?s*3:s*2,m=s<3?s*2:s,o===3&&(h=s,m=s),g=!0,p<=h*2?g=!1:p<=h*2+m?(v=p/(2*h+m),h*=v,m*=v):(w=Math.floor((p+m)/(h+m)),y=(p-w*h)/(w-1),I=(p-(w+1)*h)/w,m=I<=0||Math.abs(m-y)<Math.abs(m-I)?y:I),g&&(o===3?this.ctx.setLineDash([0,h+m]):this.ctx.setLineDash([h,m])),o===3?(this.ctx.lineCap="round",this.ctx.lineWidth=s):this.ctx.lineWidth=s*2+1.1,this.ctx.strokeStyle=xe(e),this.ctx.stroke(),this.ctx.setLineDash([]),o===2&&(Vn(a[0])&&(B=a[3],C=a[0],this.ctx.beginPath(),this.formatPath([new ut(B.end.x,B.end.y),new ut(C.start.x,C.start.y)]),this.ctx.stroke()),Vn(a[1])&&(B=a[1],C=a[2],this.ctx.beginPath(),this.formatPath([new ut(B.end.x,B.end.y),new ut(C.start.x,C.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(e){return Ze(this,void 0,void 0,function(){var s;return Oe(this,function(r){switch(r.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=xe(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),s=sN(e),[4,this.renderStack(s)];case 1:return r.sent(),this.applyEffects([]),[2,this.canvas]}})})},t})(SC),pN=function(n){return n instanceof AC||n instanceof oC?!0:n instanceof Ip&&n.type!==_c&&n.type!==Tc},mN=function(n,t){switch(n){case 0:return Uc(t);case 2:return j4(t);case 1:default:return Pc(t)}},gN=function(n){switch(n){case 1:return"center";case 2:return"right";case 0:default:return"left"}},vN=["-apple-system","system-ui"],wN=function(n){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?n.filter(function(t){return vN.indexOf(t)===-1}):n},BN=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.canvas=s.canvas?s.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=s,r.canvas.width=Math.floor(s.width*s.scale),r.canvas.height=Math.floor(s.height*s.scale),r.canvas.style.width=s.width+"px",r.canvas.style.height=s.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-s.x,-s.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+s.width+"x"+s.height+" at "+s.x+","+s.y+") with scale "+s.scale),r}return t.prototype.render=function(e){return Ze(this,void 0,void 0,function(){var s,r;return Oe(this,function(i){switch(i.label){case 0:return s=Nh(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,CN(s)];case 1:return r=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=xe(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(r,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t})(SC),CN=function(n){return new Promise(function(t,e){var s=new Image;s.onload=function(){t(s)},s.onerror=e,s.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(n))})},bN=(function(){function n(t){var e=t.id,s=t.enabled;this.id=e,this.enabled=s,this.start=Date.now()}return n.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,nl([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.prototype.getTime=function(){return Date.now()-this.start},n.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,nl([this.id,this.getTime()+"ms"],t))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,nl([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,nl([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.instances={},n})(),yN=(function(){function n(t,e){var s;this.windowBounds=e,this.instanceName="#"+n.instanceCount++,this.logger=new bN({id:this.instanceName,enabled:t.logging}),this.cache=(s=t.cache)!==null&&s!==void 0?s:new W4(this,t)}return n.instanceCount=1,n})(),SN=function(n,t){return t===void 0&&(t={}),EN(n,t)};typeof window<"u"&&vC.setContext(window);var EN=function(n,t){return Ze(void 0,void 0,void 0,function(){var e,s,r,i,o,A,a,l,c,u,d,p,h,m,g,v,w,y,I,B,b,C,b,S,T,x,_,F,Q,U,W,D,R,N,q,J,nt,At,ot,V;return Oe(this,function(H){switch(H.label){case 0:if(!n||typeof n!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(e=n.ownerDocument,!e)throw new Error("Element is not attached to a Document");if(s=e.defaultView,!s)throw new Error("Document is not attached to a Window");return r={allowTaint:(S=t.allowTaint)!==null&&S!==void 0?S:!1,imageTimeout:(T=t.imageTimeout)!==null&&T!==void 0?T:15e3,proxy:t.proxy,useCORS:(x=t.useCORS)!==null&&x!==void 0?x:!1},i=Bh({logging:(_=t.logging)!==null&&_!==void 0?_:!0,cache:t.cache},r),o={windowWidth:(F=t.windowWidth)!==null&&F!==void 0?F:s.innerWidth,windowHeight:(Q=t.windowHeight)!==null&&Q!==void 0?Q:s.innerHeight,scrollX:(U=t.scrollX)!==null&&U!==void 0?U:s.pageXOffset,scrollY:(W=t.scrollY)!==null&&W!==void 0?W:s.pageYOffset},A=new cr(o.scrollX,o.scrollY,o.windowWidth,o.windowHeight),a=new yN(i,A),l=(D=t.foreignObjectRendering)!==null&&D!==void 0?D:!1,c={allowTaint:(R=t.allowTaint)!==null&&R!==void 0?R:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:l,copyStyles:l},a.logger.debug("Starting document clone with size "+A.width+"x"+A.height+" scrolled to "+-A.left+","+-A.top),u=new f0(a,n,c),d=u.clonedReferenceElement,d?[4,u.toIFrame(e,A)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return p=H.sent(),h=Fp(d)||x4(d)?nQ(d.ownerDocument):Iu(a,d),m=h.width,g=h.height,v=h.left,w=h.top,y=xN(a,d,t.backgroundColor),I={canvas:t.canvas,backgroundColor:y,scale:(q=(N=t.scale)!==null&&N!==void 0?N:s.devicePixelRatio)!==null&&q!==void 0?q:1,x:((J=t.x)!==null&&J!==void 0?J:0)+v,y:((nt=t.y)!==null&&nt!==void 0?nt:0)+w,width:(At=t.width)!==null&&At!==void 0?At:Math.ceil(m),height:(ot=t.height)!==null&&ot!==void 0?ot:Math.ceil(g)},l?(a.logger.debug("Document cloned, using foreign object rendering"),b=new BN(a,I),[4,b.render(d)]):[3,3];case 2:return B=H.sent(),[3,5];case 3:return a.logger.debug("Document cloned, element located at "+v+","+w+" with size "+m+"x"+g+" using computed rendering"),a.logger.debug("Starting DOM parsing"),C=cC(a,d),y===C.styles.backgroundColor&&(C.styles.backgroundColor=sr.TRANSPARENT),a.logger.debug("Starting renderer for element at "+I.x+","+I.y+" with size "+I.width+"x"+I.height),b=new fN(a,I),[4,b.render(C)];case 4:B=H.sent(),H.label=5;case 5:return(!((V=t.removeContainer)!==null&&V!==void 0)||V)&&(f0.destroy(p)||a.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),a.logger.debug("Finished rendering"),[2,B]}})})},xN=function(n,t,e){var s=t.ownerDocument,r=s.documentElement?RA(n,getComputedStyle(s.documentElement).backgroundColor):sr.TRANSPARENT,i=s.body?RA(n,getComputedStyle(s.body).backgroundColor):sr.TRANSPARENT,o=typeof e=="string"?RA(n,e):e===null?sr.TRANSPARENT:4294967295;return t===s.documentElement?Or(r)?Or(i)?o:i:r:o};const WA={},xr={},IN=600,Pd=.25,w0={letter:{width:8.5,height:11},"11x14":{width:11,height:14},"11x17":{width:11,height:17}};async function FN(n,t){const e=document.getElementById("button-grid");if(!e)return E.warn("PrintService","Button grid element not found",null,"print"),null;const s=e.querySelector(".button-grid-left-cell"),r=e.querySelector(".button-grid-right-cell");try{const i=e.getBoundingClientRect(),o=(s==null?void 0:s.getBoundingClientRect().width)??0,A=(r==null?void 0:r.getBoundingClientRect().width)??0,a=Math.min(window.devicePixelRatio||1,2),l=await SN(e,{scale:a,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),c=i.width>0?l.width/i.width:1,u=n?0:Math.round(o*c),d=t?0:Math.round(A*c),p=Math.max(0,Math.min(l.width-1,u)),h=Math.max(p+1,Math.min(l.width,l.width-d)),m=Math.max(1,h-p),g=document.createElement("canvas");g.width=m,g.height=l.height,(g.getContext("2d",{willReadFrequently:!0})||g.getContext("2d")).drawImage(l,p,0,m,l.height,0,0,m,l.height);const w=UN(g,n,t);return E.debug("PrintService",`Captured button grid: ${w.width}x${w.height}`,null,"print"),w}catch(i){return E.error("PrintService","Failed to capture button grid",i,"print"),null}}function TN(n,t){const e=document.getElementById("notation-grid"),s=document.getElementById("legend-left-canvas"),r=document.getElementById("legend-right-canvas");if(!e)return E.warn("PrintService","Notation grid canvas not found",null,"print"),null;const i=n&&s?s.width:0,o=t&&r?r.width:0,A=i+e.width+o,a=i,l=document.createElement("canvas");l.width=A,l.height=e.height;const c=l.getContext("2d");return n&&s&&i>0&&c.drawImage(s,0,0),c.drawImage(e,a,0),t&&r&&o>0&&c.drawImage(r,a+e.width,0),E.debug("PrintService",`Captured pitch grid: ${l.width}x${l.height}`,null,"print"),l}function _N(n,t){const e=document.getElementById("drum-grid"),s=document.querySelector(".drum-grid-left-cell"),r=document.querySelector(".drum-grid-right-cell");if(!e||e.width===0)return E.debug("PrintService","Drum grid not found or empty",null,"print"),null;const i=e.offsetWidth?e.width/e.offsetWidth:1,o=n?Math.max(0,Math.round(((s==null?void 0:s.offsetWidth)||0)*i)):0,A=t?Math.max(0,Math.round(((r==null?void 0:r.offsetWidth)||0)*i)):0,a=o+e.width+A,l=getComputedStyle(document.documentElement).getPropertyValue("--c-surface")||"#ffffff",c=document.createElement("canvas");c.width=a,c.height=e.height;const u=c.getContext("2d");return u.fillStyle=l.trim()||"#ffffff",u.fillRect(0,0,a,e.height),u.drawImage(e,o,0),E.debug("PrintService",`Captured drum grid: ${c.width}x${c.height}`,null,"print"),c}function MN(n){const t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=t.getContext("2d");e.drawImage(n,0,0);const s=e.getImageData(0,0,t.width,t.height),r=s.data;for(let i=0;i<r.length;i+=4){const o=r[i]*.299+r[i+1]*.587+r[i+2]*.114;r[i]=o,r[i+1]=o,r[i+2]=o}return e.putImageData(s,0,0),t}async function QN(n,t){E.debug("PrintService","Generating score canvas...",{printOptions:n,targetDimensions:t},"print");const e=[];if(n.includeButtonGrid){const I=await EC(n.includeLeftLegend,n.includeRightLegend);I&&e.push({canvas:I,name:"buttons"})}const s=TN(n.includeLeftLegend,n.includeRightLegend);if(s&&e.push({canvas:s,name:"pitch"}),n.includeDrums){const I=_N(n.includeLeftLegend,n.includeRightLegend);I&&e.push({canvas:I,name:"drums"})}if(e.length===0)return E.warn("PrintService","No content captured for printing",null,"print"),null;n.colorMode==="bw"&&(e.forEach(I=>{I.canvas=MN(I.canvas)}),E.debug("PrintService","Applied black & white filter",null,"print"));const r=Math.max(...e.map(I=>I.canvas.width)),i=e.reduce((I,B)=>I+B.canvas.height,0),o=n.cropTop||0,A=n.cropBottom||1,a=n.cropLeft||0,l=n.cropRight||1,c=i*(A-o),u=r*(l-a),d=i*o,p=r*a;E.debug("PrintService",`Applying crop: top=${o.toFixed(2)}, bottom=${A.toFixed(2)}, left=${a.toFixed(2)}, right=${l.toFixed(2)}`,null,"print");const h=Math.min(t.width/u,t.height/c),m=document.createElement("canvas");m.width=u*h,m.height=c*h;const g=m.getContext("2d");g.fillStyle="#FFFFFF",g.fillRect(0,0,m.width,m.height);const v=document.createElement("canvas");v.width=r,v.height=i;const w=v.getContext("2d");let y=0;return e.forEach(({canvas:I,name:B})=>{w.drawImage(I,0,y),E.debug("PrintService",`Drew ${B} at y=${y}, height=${I.height}`,null,"print"),y+=I.height}),g.drawImage(v,p,d,u,c,0,0,m.width,m.height),E.debug("PrintService",`Generated composite canvas: ${m.width}x${m.height}`,null,"print"),m}const Yl={generateScoreCanvas:QN,async generateAndPrint(){const n=f.state.printOptions,t=300,e=n.pageSize,s=e&&e in w0?e:"letter",r=w0[s],i=n.orientation==="landscape"?r.height:r.width,o=n.orientation==="landscape"?r.width:r.height,A=Math.max(1,i-2*Pd),a=Math.max(1,o-2*Pd),l=A*t,c=a*t;E.info("PrintService","Generating print canvas at high resolution",{width:l,height:c,options:n},"print");const u=await this.generateScoreCanvas(n,{width:l,height:c});if(!u){E.error("PrintService","Failed to generate print canvas",null,"print");return}const d=document.getElementById("print-staging-area");d.innerHTML="";const p=document.getElementById("print-style-rules");p.textContent=`@page { size: ${i}in ${o}in; margin: ${Pd}in; }`;const h=document.createElement("img");h.src=u.toDataURL("image/png"),h.style.width="100%",h.style.height="auto",d.appendChild(h),E.info("PrintService","Opening print dialog",null,"print"),setTimeout(()=>window.print(),100)},async prefetchButtonGridSnapshot(n=!0,t=!0){try{await EC(n,t)}catch(e){E.warn("PrintService","Button grid prefetch failed",e,"print")}},invalidateButtonGridSnapshot(){xC()}};function UN(n,t,e){if(!n)return n;const s=document.getElementById("notation-grid"),r=document.getElementById("legend-left-canvas"),i=document.getElementById("legend-right-canvas"),o=t&&r?r.width:0,A=e&&i?i.width:0,a=((s==null?void 0:s.width)??0)+o+A||n.width;if(!a||a===n.width)return n;const l=a/n.width,c=Math.max(1,Math.round(n.height*l)),u=document.createElement("canvas");return u.width=a,u.height=c,(u.getContext("2d",{willReadFrequently:!0})||u.getContext("2d")).drawImage(n,0,0,u.width,u.height),u}async function EC(n,t){const e=`${n}-${t}`;return WA[e]!==void 0?WA[e]??null:(xr[e]||(xr[e]=(async()=>{await PN();const s=await FN(n,t);return WA[e]=s,xr[e]=null,s})().catch(s=>{throw xr[e]=null,s})),xr[e])}function PN(){return new Promise(n=>{typeof window.requestIdleCallback=="function"?requestIdleCallback(()=>n(),{timeout:IN}):requestAnimationFrame(()=>n())})}function xC(){Object.keys(WA).forEach(n=>{delete WA[n]}),Object.keys(xr).forEach(n=>{delete xr[n]})}typeof window<"u"&&window.addEventListener("resize",()=>xC());function xs(n,t){if(!n)return`rgba(204, 204, 204, ${t})`;const e=parseInt(n.slice(Ww,qm),Ol),s=parseInt(n.slice(qm,zm),Ol),r=parseInt(n.slice(zm,ZT),Ol);return`rgba(${e}, ${s}, ${r}, ${t})`}function Lu(n,t){if(!n||typeof n!="string")return JT;const e=parseInt(n.slice(Ww),Ol),s=t<0?t_:e_,r=t<0?t*-1:t,i=e>>16,o=e>>8&255,A=e&255;return"#"+(16777216+(Math.round((s-i)*r)+i)*65536+(Math.round((s-o)*r)+o)*256+(Math.round((s-A)*r)+A)).toString(16).slice(1)}const NN=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor"/>\r
</svg>`,DN=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(90, 12, 12)"/>\r
</svg>`,LN=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(180, 12, 12)"/>\r
</svg>`,kN=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(270, 12, 12)"/>\r
</svg>`,IC=Eo;function bA(n,t){const{blend:e,cutoff:s,resonance:r}=t,i=(s-1)/30,o=20,A=n-i,a=i-n;let l=1/(1+Math.pow(Math.max(0,A*o),2)),c=1/(1+Math.pow(Math.max(0,a*o),2));const u=.01;l<u&&(l=0),c<u&&(c=0);const d=l*c;let p;e<=1?p=c*(1-e)+d*e:p=d*(2-e)+l*(e-1);const h=1-(r||0)/105,m=Math.max(.01,.2*h*h),g=Math.exp(-Math.pow((n-i)/m,2)),v=(r||0)/100*.6,w=p+g*v,y=Math.max(0,Math.min(1,w));return y<u?0:y}function RN(n,t){const e=t/100;return 1-e+e*n}function ha(n,t){const e=t.mix||0;if(e===0)return new Float32Array(n);const s=new Float32Array(n.length),r=e/100;for(let i=0;i<n.length;i++){const o=n[i]??0,A=(i+.5)/IC,a=bA(A,t);if(a<o){const u=(o-a)*r;s[i]=o-u}else s[i]=o;const l=s[i]??0;s[i]=Math.max(0,l)}return s}function Vh(n){const t=f.state.timbres[n];if(!t)return new Float32Array(IC);const e=t.filter;return e&&e.enabled!==!1&&(e.mix||0)>0?ha(t.coeffs,e):new Float32Array(t.coeffs)}E.moduleLoaded("OvertoneBins with Columnar Structure");function Wh(n,...t){}const jl={0:NN,90:DN,180:LN,270:kN},Ms=Eo;let Ie=null,Be=null,Ve=new Float32Array(Ms).fill(0),Kt=null,En=new Float32Array(Ms).fill(0);const Tp=[],Gh=[];let po=!1,Hn=null;const El=new Array(Ms).fill(null);let xl=!1;const Il=new Float32Array(Ms).fill(1);new Float32Array(Ms).fill(0);function Kh(){var A;if(!Kt||((!Ie||!Be||!Hn)&&(Ie=document.getElementById("filter-overlay-canvas"),Hn=document.querySelector(".overtone-bins-grid"),Ie&&(Be=Ie.getContext("2d"))),!Ie||!Be||!Hn))return;const{width:n,height:t}=Ie;Be.clearRect(0,0,n,t);const s=t*.95,r=t,i=(A=f.state.timbres[Kt])==null?void 0:A.filter,o=i&&i.enabled!==!1;if(i&&o){const a=i.mix||0;if(a===0){Il.fill(1);return}const l=[];for(let h=0;h<Ms;h++){const m=(h+.5)/Ms,g=bA(m,i);Il[h]=RN(g,a),l.push({bin:h+1,rawFilterAmp:g.toFixed(3),afterMix:(Il[h]??0).toFixed(3)})}Be.beginPath();const c=2;for(let h=0;h<=n;h+=c){const m=h/n,g=bA(m,i),v=r-g*s;h===0?Be.moveTo(h,v):Be.lineTo(h,v)}const d=.4+a/100*.6;Be.strokeStyle=xs(Lu(Kt,-.3),d),Be.lineWidth=2.5,Be.stroke();const p=a/100;if(p>0){Be.beginPath(),Be.moveTo(0,0),Be.lineTo(n,0);const h=bA(1,i),m=r-h*s;Be.lineTo(n,m);for(let g=n;g>=0;g-=2){const v=g/n,w=bA(v,i),y=r-w*s;Be.lineTo(g,y)}Be.closePath(),Be.fillStyle=`rgba(255, 255, 255, ${p})`,Be.fill()}}else Il.fill(1)}function GA(){if(!Kt)return;const n=Kt;Tp.forEach((t,e)=>{const s=t.sliderTrack.querySelector(".slider-fill"),r=t.sliderTrack.querySelector(".harmonic-label-internal");if(!s||!r)return;const i=Ve[e]??0;if(s.style.height=`${i*100}%`,i>0){const A=Lu(n,-.1);s.style.backgroundColor=xs(A,1)}else s.style.backgroundColor="transparent";const o=s.querySelector("canvas");o&&o.remove(),i>.1?(r.style.color="rgba(255, 255, 255, 0.35)",r.style.textShadow="0 0 2px rgba(0,0,0,0.3)"):(r.style.color="rgba(51, 51, 51, 0.5)",r.style.textShadow="0 0 1px rgba(255,255,255,0.3)")}),Kh()}function B0(n,t=null){var u,d,p,h;if(!Kt||!Hn)return;const e=n.target instanceof Element?n.target:null;if(Wh("log","[BINS DRAG] handleBinPointerEvent called",{clientX:n.clientX,clientY:n.clientY}),E.debug("OvertoneBins","handleBinPointerEvent called",{target:e==null?void 0:e.className},"filter"),e!=null&&e.classList.contains("phase-button")||e!=null&&e.closest(".phase-button")||(e==null?void 0:e.tagName)==="path"||(e==null?void 0:e.tagName)==="svg"){E.debug("OvertoneBins","Blocking phase button interaction in handleBinPointerEvent",null,"filter");return}if(t===null){const m=Hn.getBoundingClientRect(),g=n.clientX-m.left,v=m.width/Ms,w=Math.floor(g/v);t=Math.max(0,Math.min(Ms-1,w))}if(E.debug("OvertoneBins","handleBinPointerEvent - binIndex",{binIndex:t},"filter"),t===null)return;const s=f.state.timbres[Kt];if(!s)return;const r=Tp[t];if(!r)return;const o=r.sliderTrack.getBoundingClientRect(),A=n.clientY-o.top,a=o.height,l=(a-A)/a,c=Math.max(0,Math.min(1,l));if(Wh("log","[BINS DRAG] Setting bin",t+1,"value:",c.toFixed(3)),c===0){E.debug("OvertoneBins","Setting coefficient to zero immediately for bin",{binIndex:t},"filter");const m=new Float32Array(s.coeffs);m[t]=0,Ve[t]=0,f.setHarmonicCoefficients(Kt,m);const g=El[t];typeof g=="number"&&(clearTimeout(g),El[t]=null),po||(Wt.triggerAttack("C4",Kt),f.emit("spacebarPlayback",{color:Kt,isPlaying:!0}),po=!0);const v=(u=f.state.timbres[Kt])==null?void 0:u.filter;v&&v.enabled!==!1&&(v.mix||0)>0&&ha(m,v),(d=window.waveformVisualizer)!=null&&d.generateWaveform&&window.waveformVisualizer.generateWaveform(),E.debug("OvertoneBins",`Set coefficient H${t+1} to 0 for color ${Kt}`,null,"filter")}else{const m=El[t];typeof m=="number"&&(clearTimeout(m),El[t]=null),po||(Wt.triggerAttack("C4",Kt),f.emit("spacebarPlayback",{color:Kt,isPlaying:!0}),po=!0),E.debug("OvertoneBins","BEFORE creating newCoeffs - store coeffs",{coeffs:s.coeffs},"filter");const g=new Float32Array(s.coeffs);E.debug("OvertoneBins","AFTER copying to newCoeffs",{newCoeffs:g},"filter"),g[t]=c,Ve[t]=c,E.debug("OvertoneBins",`AFTER setting newCoeffs[${t}] = ${c}`,{newCoeffs:g},"filter"),f.setHarmonicCoefficients(Kt,g);const v=(p=f.state.timbres[Kt])==null?void 0:p.filter;v&&v.enabled!==!1&&(v.mix||0)>0&&ha(g,v),(h=window.waveformVisualizer)!=null&&h.generateWaveform&&window.waveformVisualizer.generateWaveform(),E.debug("OvertoneBins",`Updated coefficient H${t+1} to ${c} for color ${Kt}`,null,"filter"),E.debug("OvertoneBins","All coefficients",{newCoeffs:g},"filter")}GA()}function qh(n,t,e,s){const r=e.coeffs,i=e.phases||new Float32Array(r.length).fill(0);let o=!0,A=!0;if(n.length!==r.length)o=!1;else for(let l=0;l<n.length;l++){const c=n[l]??0,u=r[l]??0;if(Math.abs(c-u)>.001){o=!1;break}}if(t.length!==i.length)A=!1;else for(let l=0;l<t.length;l++){const c=t[l]??0,u=i[l]??0;if(Math.abs(c-u)>.001){A=!1;break}}return o&&A}function C0(n){if(!n)return;Kt=n;const t=f.state.timbres[n];t&&(t.filter?t.filter.enabled===void 0&&(t.filter.enabled=!0):t.filter={enabled:!0,blend:1,cutoff:16,resonance:0,type:"lowpass",mix:0},E.debug("OvertoneBins","updateForNewColor - timbre.coeffs",{coeffs:t.coeffs},"filter"),E.debug("OvertoneBins","updateForNewColor - timbre.phases",{phases:t.phases},"filter"),Ve=new Float32Array(t.coeffs),t.phases?En=new Float32Array(t.phases):En=new Float32Array(Ve.length).fill(0),qh(Ve,En,t),E.debug("OvertoneBins","updateForNewColor - final coeffs",{coeffs:Ve},"filter"),E.debug("OvertoneBins","updateForNewColor - final phases",{phases:En},"filter"),Gh.forEach(({phaseBtn:e},s)=>{if(!e)return;let i=(En[s]||0)%(2*Math.PI);i<0&&(i+=2*Math.PI);const o=.1;let A=0;Math.abs(i-Math.PI/2)<o?A=90:Math.abs(i-Math.PI)<o?A=180:Math.abs(i-3*Math.PI/2)<o&&(A=270),e.innerHTML=jl[A]}),GA())}function HN(){var A;const n=document.querySelector(".filter-container"),t=n==null?void 0:n.querySelector(".filter-bins-wrapper"),e=n==null?void 0:n.querySelector(".filter-vertical-blend-wrapper");if(!n||!t||!e){E.error("OvertoneBins","Missing required elements - aborting init",null,"audio");return}Hn=document.createElement("div"),Hn.className="overtone-bins-grid";for(let a=0;a<Ms;a++){const l=document.createElement("div");l.className="slider-column";const c=document.createElement("div");c.className="slider-track";const u=document.createElement("div");u.className="slider-fill",c.appendChild(u);const d=document.createElement("div");d.className="harmonic-label-internal",d.textContent=`${a+1}`,c.appendChild(d),l.appendChild(c);const p=document.createElement("button");p.className="phase-button",p.innerHTML=jl[0],p.dataset.binIndex=String(a),p.addEventListener("pointerenter",()=>{var h,m,g;if(xl){const w=Pe(),y=Wt.synths,I=Kt;if(I&&((m=(h=y==null?void 0:y[I])==null?void 0:h.activeNotes)!=null&&m.C4)){const B=y[I].activeNotes.C4;(g=B.oscillators)!=null&&g[a]&&B.oscillators[a].volume.linearRampTo(-1/0,.015,w)}setTimeout(()=>{var T;const B=Kt,C=B?f.state.timbres[B]:void 0;if(!B||!C)return;const b=new Float32Array(C.coeffs);b[a]=0,Ve[a]=0,f.setHarmonicCoefficients(B,b);const S=(T=f.state.timbres[B])==null?void 0:T.filter;S&&S.enabled!==!1&&(S.mix||0)>0&&ha(b,S),GA()},.015*1e3)}}),p.addEventListener("click",h=>{var b;if(xl){h.preventDefault();return}const m=Kt;if(!m)return;E.debug("OvertoneBins","Phase button click handler started",null,"filter"),E.debug("OvertoneBins","Current coeffs before phase change",{coeffs:Ve},"filter"),h.preventDefault();const g=new Float32Array(En),v=new Float32Array(En);let y=(v[a]||0)%(2*Math.PI);y<0&&(y+=2*Math.PI);const I=.1;let B=0;Math.abs(y)<I?B=Math.PI/2:Math.abs(y-Math.PI/2)<I?B=Math.PI:Math.abs(y-Math.PI)<I?B=3*Math.PI/2:B=0,v[a]=B,En=v,(b=window.waveformVisualizer)!=null&&b.startPhaseTransition&&window.waveformVisualizer.startPhaseTransition(g,v,a),f.setHarmonicPhases(m,v);const C=B===0?0:Math.abs(B-Math.PI/2)<I?90:Math.abs(B-Math.PI)<I?180:270;p.innerHTML=jl[C],E.debug("OvertoneBins",`Phase button clicked for H${a+1}, new phase: ${C}`,null,"filter")}),l.appendChild(p),Hn.appendChild(l),Tp.push({column:l,label:d,sliderTrack:c,sliderFill:u,phaseBtn:p}),Gh.push({phaseBtn:p})}Hn.addEventListener("pointerdown",a=>{const l=a.target instanceof Element?a.target:null;if(Wh("log","[BINS DRAG] Pointerdown event fired",{target:l,className:l==null?void 0:l.className}),l!=null&&l.classList.contains("phase-button")||l!=null&&l.closest(".phase-button")){E.debug("OvertoneBins","Pointerdown blocked - phase button clicked",null,"filter");return}if(E.debug("OvertoneBins","Pointerdown - handling bin interaction",null,"filter"),a.preventDefault(),xl=!0,!Kt)return;const c=Kt;Wt.triggerAttack("C4",c),f.emit("spacebarPlayback",{color:c,isPlaying:!0}),po=!0,B0(a);const u=p=>B0(p),d=()=>{var h;window.removeEventListener("pointermove",u),window.removeEventListener("pointerup",d),xl=!1;const p=!!((h=window.waveformVisualizer)!=null&&h.generateWaveform);f.recordState(),Wt.triggerRelease("C4",c),f.emit("spacebarPlayback",{color:c,isPlaying:!1}),po=!1,p?setTimeout(()=>{var m,g;(g=(m=window.waveformVisualizer)==null?void 0:m.generateWaveform)==null||g.call(m)},0):E.warn("OvertoneBins","Static waveform visualizer not ready when drag ended",null,"audio")};window.addEventListener("pointermove",u),window.addEventListener("pointerup",d)}),Ie=document.createElement("canvas"),Ie.id="filter-overlay-canvas",Ie.className="filter-overlay-canvas",Ie.style.pointerEvents="none",Be=Ie.getContext("2d"),Hn.appendChild(Ie);const s=document.createElement("div");s.className="vertical-blend-wrapper";const r=document.createElement("div");r.id="vertical-blend-track";const i=document.createElement("div");i.id="vertical-blend-thumb",i.textContent="M",r.appendChild(i),s.appendChild(r),t.appendChild(Hn),e.appendChild(s);const o=()=>{if(!Ie)return;const a=Ie.getBoundingClientRect();(Ie.width!==a.width||Ie.height!==a.height)&&(Ie.width=a.width,Ie.height=a.height,Kh())};Kt=((A=f.state.selectedNote)==null?void 0:A.color)||"#4a90e2",C0(Kt),f.on("timbreChanged",a=>{if(a&&a===Kt){E.debug("OvertoneBins","timbreChanged event - checking what changed",null,"filter");const l=f.state.timbres[a];if(!l)return;const c=l.coeffs,u=l.phases;let d=!1;if(E.debug("OvertoneBins","Comparing coefficients...",null,"filter"),E.debug("OvertoneBins","Local coeffs",{coeffs:Ve},"filter"),E.debug("OvertoneBins","Store coeffs",{newCoeffs:c},"filter"),Ve.length!==c.length)E.debug("OvertoneBins","Array length mismatch - coeffsChanged = true",null,"filter"),d=!0;else for(let p=0;p<c.length;p++){const h=Ve[p]??0,m=c[p]??0,g=Math.abs(h-m);if(g>.001){E.debug("OvertoneBins",`Coefficient ${p} changed: ${h} -> ${m} (diff: ${g})`,null,"filter"),d=!0;break}}E.debug("OvertoneBins","Force syncing local coeffs with store",null,"filter"),qh(Ve,En,l),Ve=new Float32Array(c),u?En=new Float32Array(u):En=new Float32Array(Ve.length).fill(0),qh(Ve,En,l),d?(E.debug("OvertoneBins","Coefficients changed - updating visuals",null,"filter"),GA()):(E.debug("OvertoneBins","No coefficient changes detected - but local coeffs synced",null,"filter"),Kh()),Gh.forEach(({phaseBtn:p},h)=>{if(!p)return;let g=(En[h]||0)%(2*Math.PI);g<0&&(g+=2*Math.PI);const v=.1;let w=0;Math.abs(g-Math.PI/2)<v?w=90:Math.abs(g-Math.PI)<v?w=180:Math.abs(g-3*Math.PI/2)<v&&(w=270),p.innerHTML=jl[w]})}}),f.on("noteChanged",({newNote:a}={})=>{a!=null&&a.color&&a.color!==Kt&&C0(a.color)}),f.on("filterChanged",a=>{const l=Kt;if(l&&a===l){GA();const c=f.state.timbres[l],u=c==null?void 0:c.filter;if(!c)return;u&&u.enabled!==!1&&(u.mix||0)>0?ha(c.coeffs,u):new Float32Array(c.coeffs)}}),new ResizeObserver(o).observe(Hn),o(),E.info("OvertoneBins","Initialized with columnar div structure and perfect alignment",null,"filter")}E.moduleLoaded("EngineAudio","general");let bt=null;const Wt={init(){E.info("EngineAudio","Initializing with engine createSynthEngine()",null,"audio"),bt=uF({timbres:f.state.timbres,masterVolume:0,harmonicFilter:{getFilteredCoefficients:n=>Vh(n)},effectsManager:window.audioEffectsManager?{applySynthEffects:(n,t,e)=>{var s;(s=window.audioEffectsManager)==null||s.applySynthEffects(n,t,e)},applyEffectsToVoice:(n,t)=>{var e;(e=window.audioEffectsManager)==null||e.applyEffectsToVoice(n,t)}}:void 0,logger:{debug:(n,t,e)=>{E.debug(n,t,e,"audio")},info:(n,t,e)=>{E.info(n,t,e,"audio")},warn:(n,t,e)=>{E.warn(n,t,e,"audio")}}}),bt.init(),f.on("timbreChanged",n=>{n&&this.updateSynthForColor(n)}),f.on("filterChanged",n=>{n&&this.updateSynthForColor(n)}),f.on("audioEffectChanged",n=>{if(!n||!n.color||!n.effectType)return;const{effectType:t,color:e}=n;(t==="vibrato"||t==="tremolo")&&this.updateSynthForColor(e)}),f.on("volumeChanged",n=>{typeof n=="number"&&this.setVolume(n)}),window.synthEngine=this,E.info("EngineAudio","Initialization complete",null,"audio")},updateSynthForColor(n){if(!bt)return;const t=f.state.timbres[n];t&&(t.vibrato||(t.vibrato={speed:0,span:0}),t.tremelo||(t.tremelo={speed:0,span:0}),bt.updateSynthForColor(n))},playNote(n,t,e){bt&&bt.playNote(n,t,e)},triggerAttack(n,t,e,s){bt&&bt.triggerAttack(n,t,e,s)},triggerAttackInteractive(n,t){bt&&bt.triggerAttackInteractive(n,t)},triggerRelease(n,t,e){bt&&bt.triggerRelease(n,t,e)},releaseAll(){bt&&bt.releaseAll()},quickReleasePitches(n,t){bt&&bt.quickReleasePitches(n,t)},setSynth(n,t){var e;bt&&((e=bt.setSynth)==null||e.call(bt,n,t))},getSynth(n){return bt?bt.getSynth(n):null},getAllSynths(){return bt?bt.getAllSynths():{}},setBpm(n){bt&&bt.setBpm(n)},setVolume(n){bt&&bt.setVolume(n)},getMasterGainNode(){return bt?bt.getMasterGainNode():null},getMainVolumeNode(){return bt?bt.getMainVolumeNode():null},createWaveformAnalyzer(n){return bt?bt.createWaveformAnalyzer(n):null},getWaveformAnalyzer(n){return bt?bt.getWaveformAnalyzer(n):null},getAllWaveformAnalyzers(){return bt?bt.getAllWaveformAnalyzers():new Map},removeWaveformAnalyzer(n){bt&&bt.removeWaveformAnalyzer(n)},disposeAllWaveformAnalyzers(){bt&&bt.disposeAllWaveformAnalyzers()},stopBackgroundMonitors(){bt&&bt.stopBackgroundMonitors()},teardown(){this.dispose()},dispose(){bt&&(bt.dispose(),bt=null)}};class ON{constructor(){M(this,"elements",new Map);M(this,"initialized",!1)}init(){this.initialized||(this.cacheElement("notationGrid","notation-grid"),this.cacheElement("playheadCanvas","playhead-canvas"),this.cacheElement("hoverCanvas","hover-canvas"),this.cacheElement("drumGrid","drum-grid"),this.cacheElement("drumPlayheadCanvas","drum-playhead-canvas"),this.cacheElement("drumHoverCanvas","drum-hover-canvas"),this.cacheElement("appContainer","app-container"),this.cacheElement("pitchGridWrapper","pitch-grid-wrapper"),this.cacheElement("drumGridWrapper","drum-grid-wrapper"),this.cacheElement("eraserButton","eraser-tool-button"),this.cacheElement("playButton","play-button"),this.cacheElement("stopButton","stop-button"),this.cacheElement("clearButton","clear-button"),this.cacheElement("loopButton","loop-button"),this.cacheElement("undoButton","undo-button"),this.cacheElement("redoButton","redo-button"),this.cacheElement("noteBankContainer","note-bank-container"),this.cacheElement("tonicModeGrid","tonic-mode-grid"),this.cacheElement("degreeVisibilityToggle","degree-visibility-toggle"),this.cacheElement("degreeModeToggle","degree-mode-toggle"),this.cacheElement("flatBtn","flat-toggle-btn"),this.cacheElement("sharpBtn","sharp-toggle-btn"),this.cacheElement("frequencyBtn","hz-toggle-btn"),this.cacheElement("octaveLabelBtn","spn-octave-toggle-btn"),this.cacheElement("focusColoursToggle","focus-colours-toggle"),this.cacheElement("harmonyContainerMain","chordShape-container"),this.cacheElement("tempoSlider","tempo-slider"),this.cacheElement("volumeSlider","vertical-volume-slider"),this.initialized=!0)}cacheElement(t,e){const s=document.getElementById(e);s&&this.elements.set(t,s)}get(t){return this.initialized?this.elements.get(t)??null:null}getMultiple(...t){const e={};return t.forEach(s=>{e[s]=this.get(s)}),e}has(t){return this.elements.has(t)}refresh(){this.elements.clear(),this.initialized=!1,this.init()}getStats(){const t=this.elements.size,e=Array.from(this.elements.values()).filter(s=>s!==null).length;return{totalCached:t,foundElements:e,missingElements:t-e}}}const ur=new ON;let VN=[],WN=0,b0=null,Jl=[];function GN(){const n=f.state,t=Ne.getColumnMap(n);if(b0!==t){b0=t,Jl=[];for(const e of t.entries){if(e.type!=="beat"||e.canvasIndex===null||e.macrobeatIndex===null)continue;const s=e.macrobeatIndex,r=Jl[s];if(!r){Jl[s]={start:e.canvasIndex,end:e.canvasIndex};continue}r.start=Math.min(r.start,e.canvasIndex),r.end=Math.max(r.end,e.canvasIndex)}}}function _p(){return{cellWidth:f.state.cellWidth,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.baseMicrobeatPx}}function y0(){return VN}function KN(){return WN}function Dc(n){const t=_p(),e=Math.max(0,Math.floor(n)),s=Zr.getColumnPixelPosition(e,t,f.state);return(s==null?void 0:s.xStart)??0}function FC(n){const t=_p(),e=Math.max(0,Math.floor(n)),s=Zr.getColumnPixelPosition(e,t,f.state);return(s==null?void 0:s.width)??0}function qN(){return Array.isArray(f.state.columnWidths)?f.state.columnWidths.length:0}function zN(){const n=_p(),t=qN(),e=Zr.getColumnPixelPosition(t,n,f.state);return(e==null?void 0:e.xStart)??0}function zh(n){const t=f.state;GN();const e=Ne.getColumnMap(t),s=e.canvasToVisual.get(Math.floor(n));if(s===void 0)return null;const r=e.entries[s],i=r==null?void 0:r.macrobeatIndex;if(i==null)return null;const o=Jl[i];if(!o)return null;const A=Dc(o.start),a=Dc(o.end+1);return{x:A,width:Math.max(0,a-A)}}const $N={hz:0,minAlpha:.2,maxAlpha:.2,maxExpandPx:0,colorRgb:"rgb(255, 235, 0)"};function yA(n,t,e,s,r,i,o=$N){if(!Number.isFinite(t)||!Number.isFinite(e)||!Number.isFinite(s)||!Number.isFinite(r)||s<=0||r<=0)return;const A=i/1e3,a=o.hz>0?.5+.5*Math.sin(A*(2*Math.PI)*o.hz):1,l=o.minAlpha+(o.maxAlpha-o.minAlpha)*a,c=Math.min(o.maxExpandPx,Math.max(0,s*.1))*a;n.save(),n.globalAlpha=l,n.fillStyle=o.colorRgb,n.fillRect(t-c/2,e,s+c,r),n.restore()}class XN{constructor(){M(this,"canvas",null);M(this,"ctx",null);M(this,"animationFrameId",null);M(this,"_lastColumnIndex",null);M(this,"_lastColumnProgress",0);M(this,"_lastColumnStartX",0);M(this,"_lastColumnWidth",0);M(this,"_lastDebugLogTime",0);M(this,"activeAnimations",new Map);M(this,"popDuration",{scaleUp:100,scaleDown:300});M(this,"popScale",1.5)}ensureContext(){return this.canvas||(this.canvas=document.getElementById("drum-playhead-canvas")),this.canvas?(this.ctx||(this.ctx=this.canvas.getContext("2d")),this.ctx):null}initialize(){this.canvas=document.getElementById("drum-playhead-canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),f.on("playbackStateChanged",()=>this.handlePlaybackStateChange()),f.on("tempoChanged",()=>this.invalidateTimeMap()))}drawPlayheadLine(t){const e=this.ensureContext();if(!e||!this.canvas)return;const s=ie(this.canvas);e.strokeStyle="rgba(255, 0, 0, 0.8)",e.lineWidth=2,e.beginPath(),e.moveTo(t,0),e.lineTo(t,s),e.stroke()}drawColumnHighlight(t,e,s){const r=this.ensureContext();if(!r||!this.canvas)return;const i=ie(this.canvas);yA(r,t,0,e,i,s)}handlePlaybackStateChange(){f.state.isPlaying&&!f.state.isPaused?this.startRendering():this.stopRendering({clear:!f.state.isPaused})}invalidateTimeMap(){}startRendering(){this.animationFrameId||this.render()}stopRendering({clear:t}={clear:!0}){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),t&&this.ctx&&this.canvas&&this.ctx.clearRect(0,0,$e(this.canvas),ie(this.canvas))}render(){if(!f.state.isPlaying||f.state.isPaused||!this.ctx||!this.canvas){this.animationFrameId=null;return}this.ctx.clearRect(0,0,$e(this.canvas),ie(this.canvas));const t=Number(ht.seconds||0),e=this.calculateXFromTime(t);if(e===null){this.animationFrameId=requestAnimationFrame(()=>this.render());return}const s=ie(this.canvas);if(f.state.playheadMode==="macrobeat"){const r=this._lastColumnIndex,i=(r!==null?zh(r):null)??(r!==null?zh(r+1):null);i?yA(this.ctx,i.x,0,i.width,s,performance.now()):yA(this.ctx,this._lastColumnStartX,0,this._lastColumnWidth,s,performance.now())}else f.state.playheadMode==="microbeat"?yA(this.ctx,this._lastColumnStartX,0,this._lastColumnWidth,s,performance.now()):(this.ctx.strokeStyle="#FF6B35",this.ctx.lineWidth=3,this.ctx.shadowColor="#FF6B35",this.ctx.shadowBlur=6,this.ctx.beginPath(),this.ctx.moveTo(e,0),this.ctx.lineTo(e,s),this.ctx.stroke(),this.ctx.shadowBlur=0);this.debugPlayhead(ht.seconds,e),this.animationFrameId=requestAnimationFrame(()=>this.render())}calculateXFromTime(t){this._lastColumnIndex=null,this._lastColumnProgress=0,this._lastColumnStartX=0,this._lastColumnWidth=0;const e=y0();if(!Array.isArray(e)||e.length<2)return null;for(let s=0;s<e.length-1;s++){const r=e[s],i=e[s+1];if(!(typeof r!="number"||typeof i!="number")&&t>=r&&t<i){const o=i-r,A=t-r,a=Dc(s)??0,l=FC(s)??0;return this._lastColumnIndex=s,this._lastColumnProgress=o>0?A/o:0,this._lastColumnStartX=a,this._lastColumnWidth=l,a+(o>0?A/o*l:0)}}return null}debugPlayhead(t,e){if(!window.__DEBUG_PLAYHEAD_SYNC__)return;const s=performance.now();if(s-this._lastDebugLogTime<250)return;this._lastDebugLogTime=s;const r=y0(),i=this._lastColumnIndex,o=Array.isArray(r)&&i!==null&&i>=0?r[i]:void 0,A=Array.isArray(r)&&i!==null&&i+1<r.length?r[i+1]:void 0,a=Array.isArray(r)?r[r.length-1]??0:0,l=KN(),c={transportSeconds:Number(t.toFixed(3)),drumX:Number((e??0).toFixed(2)),columnIndex:i,columnProgress:Number(this._lastColumnProgress.toFixed(3)),drumStartTime:Number((o==null?void 0:o.toFixed(3))??NaN),transportStartTime:Number((o==null?void 0:o.toFixed(3))??NaN),startDelta:0,drumEndTime:Number((A==null?void 0:A.toFixed(3))??NaN),transportEndTime:Number((A==null?void 0:A.toFixed(3))??NaN),endDelta:0,drumTimelineEnd:Number(a.toFixed(3)),transportTimelineEnd:Number(l.toFixed(3)),timelineDelta:Number((a-l).toFixed(3)),toneLoopStart:Number(Number(ht.loopStart??0).toFixed(3)),toneLoopEnd:Number(Number(ht.loopEnd??0).toFixed(3)),storeLooping:f.state.isLooping};E.debug("DrumPlayheadRenderer","Playhead diagnostics",c,"canvas")}triggerNotePop(t,e){const s=`${t}-${e}`;this.activeAnimations.set(s,{startTime:performance.now(),phase:"scaleUp"}),window.drumGridRenderer&&window.drumGridRenderer.render()}getAnimationScale(t,e){const s=`${t}-${e}`,r=this.activeAnimations.get(s);if(!r)return 1;const i=performance.now(),o=i-r.startTime;if(r.phase==="scaleUp"){if(o>=this.popDuration.scaleUp)return r.phase="scaleDown",r.startTime=i,this.popScale;{const A=o/this.popDuration.scaleUp;return 1+(this.popScale-1)*A}}else if(r.phase==="scaleDown"){if(o>=this.popDuration.scaleDown)return this.activeAnimations.delete(s),1;{const A=o/this.popDuration.scaleDown;return this.popScale-(this.popScale-1)*A}}return 1}hasActiveAnimations(){return this.activeAnimations.size>0}cleanupAnimations(){const t=performance.now();for(const[e,s]of this.activeAnimations.entries()){const r=t-s.startTime,i=s.phase==="scaleUp"?this.popDuration.scaleUp:this.popDuration.scaleUp+this.popDuration.scaleDown;r>i&&this.activeAnimations.delete(e)}}}const rr=new XN;E.moduleLoaded("SixteenthStampPlacements","stamps");function YN(n,t,e,s="#4a90e2"){return Eu(n)?f.addSixteenthStampPlacement(n,t,e,s):(E.warn("SixteenthStampPlacements",`Invalid sixteenth stamp ID: ${n}`,{sixteenthStampId:n},"stamps"),null)}function jN(n,t,e,s){return f.eraseSixteenthStampsInArea(n,t,e,s)}function TC(){f.clearAllSixteenthStamps()}function JN(){return f.getSixteenthStampPlaybackData()}E.moduleLoaded("SixteenthStampScheduler","stamps");const S0=["0","16n","8n",{"8n":1,"16n":1}];function _C(n,t=null){const e=Eu(n);if(!e)return E.warn("SixteenthStampScheduler",`Unknown sixteenth stamp ID: ${n}`,{sixteenthStampId:n},"stamps"),[];const s=[];return e.ovals.forEach(r=>{var A;const i=`oval_${r}`,o=((A=t==null?void 0:t.shapeOffsets)==null?void 0:A[i])||0;s.push({offset:S0[r],duration:"8n",type:"oval",slot:r,shapeKey:i,rowOffset:o})}),e.diamonds.forEach(r=>{var A;const i=`diamond_${r}`,o=((A=t==null?void 0:t.shapeOffsets)==null?void 0:A[i])||0;s.push({offset:S0[r],duration:"16n",type:"diamond",slot:r,shapeKey:i,rowOffset:o})}),s}E.moduleLoaded("TripletStampPlacements","triplets");function ZN(n,t,e,s="#4a90e2"){const r=xu(n);if(!r)return E.warn("TripletStampPlacements",`Invalid triplet stamp ID: ${n}`,{tripletStampId:n},"triplets"),null;const i=fB[r.span]??1;if(!tD(t,i,e))return E.debug("TripletStampPlacements",`Cannot place triplet at time ${t}, row ${e} - collision detected`,{tripletStampId:n,startTimeIndex:t,row:e,span:i},"triplets"),null;const o=e,A={id:`triplet_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,tripletStampId:n,startTimeIndex:t,span:i,row:e,globalRow:o,color:s,timestamp:Date.now()};return f.addTripletStampPlacement(A)}function tD(n,t,e){const s=f.state,r=Ye(s),i=t*2,o=Cn(n,s);for(const A of r){const a=A.columnIndex,l=A.columnIndex+1;if(a>=o&&a<o+i||o>=a&&o<=l)return!1}if(s.sixteenthStampPlacements){for(const A of s.sixteenthStampPlacements)if(A.row===e){const a=$r(A.startColumn,s);if(a===null)return!1;const l=a+2,c=n+i;if(!(l<=n||a>=c))return!1}}if(s.tripletStampPlacements){for(const A of s.tripletStampPlacements)if(A.row===e){const a=A.startTimeIndex+A.span*2;if(!(n+i<=A.startTimeIndex||n>=a))return!1}}return!0}function eD(n,t,e,s){const r=f.state;if(!r.tripletStampPlacements)return!1;const i=[];for(const o of r.tripletStampPlacements)if(o.row>=e&&o.row<=s){const A=o.span*2,a=Cn(o.startTimeIndex,r);a+A-1<n||a>t||i.push(o.id)}return i.length>0?(i.forEach(o=>f.removeTripletStampPlacement(o)),E.debug("TripletStampPlacements",`Erased ${i.length} triplet groups`,{removedIds:i,eraseArea:{eraseStartCol:n,eraseEndCol:t,eraseStartRow:e,eraseEndRow:s}},"triplets"),!0):!1}function nD(){return f.getTripletStampPlaybackData()}function MC(){f.clearAllTripletStamps(),E.info("TripletStampPlacements","Cleared all triplet stamp placements",null,"triplets")}E.moduleLoaded("TripletScheduler","triplets");function QC(n,t=null){const e=xu(n);if(!e)return E.warn("TripletScheduler",`Unknown triplet stamp ID: ${n}`,{tripletStampId:n},"triplets"),[];const s=[],r=e.span==="eighth"?"8t":"4t",i=r;return e.hits.forEach(o=>{var c;const A=`triplet_${o}`,a=((c=t==null?void 0:t.shapeOffsets)==null?void 0:c[A])||0;let l;if(o===0)l="0";else if(o===1)l=r;else if(o===2){const u=Ce(r).toSeconds();l=Ce(u*2).toNotation()}else{const u=Ce(r).toSeconds();l=Ce(u*o).toNotation()}s.push({offset:l,duration:i,type:e.span==="eighth"?"triplet-eighth":"triplet-quarter",slot:o,shapeKey:A,rowOffset:a}),E.debug("TripletScheduler",`Triplet stamp ${n} ${e.span} at slot ${o} with offset "${l}", rowOffset: ${a}`,"triplets")}),E.debug("TripletScheduler",`Total events for triplet stamp ${n}:`,s.length,"triplets"),s}E.moduleLoaded("EngineTransport","general");let Je=null;const lA=()=>ur.get("playheadCanvas")??document.getElementById("playhead-canvas"),Fl=()=>ur.get("drumPlayheadCanvas")??document.getElementById("drum-playhead-canvas"),sD=()=>ur.get("beatLineHighlight")??document.getElementById("beat-line-highlight"),Zs={init(){E.info("EngineTransport","Initializing with engine createTransportService()",null,"transport"),Je=gF({synthEngine:Wt,stateCallbacks:{getState:()=>({tempo:f.state.tempo,columnWidths:f.state.columnWidths,hasAnacrusis:f.state.hasAnacrusis,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles,tempoModulationMarkers:f.state.tempoModulationMarkers,isLooping:f.state.isLooping,isPaused:f.state.isPaused,cellWidth:f.state.cellWidth,placedNotes:f.state.placedNotes,timbres:f.state.timbres,fullRowData:f.state.fullRowData,playheadMode:f.state.playheadMode}),getStampPlaybackData:()=>JN().map(n=>({sixteenthStampId:String(n.sixteenthStampId),column:n.column,row:n.row,color:n.color,placement:n.placement})),getStampScheduleEvents:(n,t)=>{const e=typeof n=="string"?Number(n):n;return Number.isFinite(e)?_C(e,t??null):[]},getTripletPlaybackData:()=>nD().map(n=>({tripletStampId:String(n.tripletStampId),startTimeIndex:n.startTimeIndex,row:n.row,color:n.color,placement:n.placement})),getTripletScheduleEvents:(n,t)=>{const e=typeof n=="string"?Number(n):n;return Number.isFinite(e)?QC(e,t??null):[]},timeToCanvas:(n,t)=>Cn(n,t),getPlacedTonicSigns:()=>Ye(f.state),getTonicSpanColumnIndices:n=>N_(n),getMacrobeatInfo:n=>mn(f.state,n),getColumnStartX:n=>Dc(n),getColumnWidth:n=>FC(n),getCanvasWidth:()=>zN(),getMacrobeatHighlightRect:n=>zh(n)},eventCallbacks:{on:(n,t)=>f.on(n,t),emit:(n,t)=>f.emit(n,t),setPlaybackState:(n,t)=>f.setPlaybackState(n,t)},visualCallbacks:{clearPlayheadCanvas:()=>{const n=lA();if(!n)return;const t=n.getContext("2d");if(!t)return;const e=$e(n),s=ie(n);t.clearRect(0,0,e,s)},clearDrumPlayheadCanvas:()=>{const n=Fl();if(!n)return;const t=n.getContext("2d");if(!t)return;const e=$e(n),s=ie(n);t.clearRect(0,0,e,s)},drawPlayheadLine:(n,t)=>{const e=lA();if(!e)return;const s=e.getContext("2d");s&&(s.strokeStyle="rgba(255, 0, 0, 0.8)",s.lineWidth=2,s.beginPath(),s.moveTo(n,0),s.lineTo(n,t),s.stroke())},drawPlayheadHighlight:(n,t,e,s)=>{const r=lA();if(!r)return;const i=r.getContext("2d");i&&yA(i,n,0,t,e,s)},drawDrumPlayheadLine:(n,t)=>{Fl()&&rr.drawPlayheadLine(n)},drawDrumPlayheadHighlight:(n,t,e,s)=>{Fl()&&rr.drawColumnHighlight(n,t,s)},updateBeatLineHighlight:(n,t,e)=>{const s=sD();s&&(e?(s.style.left=`${n}px`,s.style.width=`${t}px`,s.style.display="block"):s.style.display="none")},triggerDrumNotePop:(n,t)=>{rr.triggerNotePop(n,t)},triggerAdsrVisual:(n,t,e,s)=>{window.adsrComponent&&window.adsrComponent.triggerPlayheadVisual(n,t,e,s)},clearAdsrVisuals:()=>{window.adsrComponent&&window.adsrComponent.clearAllPlayheadVisuals()},getPlayheadCanvasWidth:()=>{const n=lA();return n?$e(n):0},getPlayheadCanvasHeight:()=>{const n=lA();return n?ie(n):0},getDrumCanvasHeight:()=>{const n=Fl();return n?ie(n):0}},logger:{debug:(n,t,e)=>{E.debug(n,t,e,"transport")},info:(n,t,e)=>{E.info(n,t,e,"transport")},warn:(n,t,e)=>{E.warn(n,t,e,"transport")}}}),Je.init(),E.info("EngineTransport","Initialization complete",null,"transport")},handleStateChange(){Je&&Je.handleStateChange()},start(){Je&&Je.start()},resume(){Je&&Je.resume()},pause(){Je&&Je.pause()},stop(){Je&&Je.stop()},dispose(){Je&&(Je.dispose(),Je=null)}},rD=/(Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini)/i,UC=900;let E0=!1,Zl=UC,Nd=!1;const iD=Object.freeze({isMobile:!1,isTouch:!1,isCoarsePointer:!1,orientation:"landscape",width:0,height:0});function Mp(){return typeof window<"u"?window:null}function oD(){const n=Mp();if(!n)return{...iD};const{innerWidth:t=0,innerHeight:e=0}=n,s=n.matchMedia?n.matchMedia("(orientation: portrait)"):null,r=s?s.matches?"portrait":"landscape":e>=t?"portrait":"landscape",i=!!(n.matchMedia&&n.matchMedia("(pointer: coarse)").matches),o=!!(n.matchMedia&&n.matchMedia("(hover: none)").matches),A=typeof navigator<"u"?navigator:null,a=(A==null?void 0:A.maxTouchPoints)??(A==null?void 0:A.msMaxTouchPoints)??0,l="ontouchstart"in n||a>0,c=A!=null&&A.userAgent?rD.test(A.userAgent):!1,u=t>0?t<=Zl:!1;return{isMobile:!!(c||l&&(i||o||u)),isTouch:l,isCoarsePointer:i,orientation:r,width:t,height:e}}function AD(n){if(typeof document>"u")return;[document.documentElement,document.body].filter(Boolean).forEach(e=>{e.classList.toggle("is-mobile",!!n.isMobile),e.classList.toggle("is-touch",!!n.isTouch),e.classList.toggle("orientation-portrait",n.orientation==="portrait"),e.classList.toggle("orientation-landscape",n.orientation==="landscape")})}function Tl(){if(Nd)return;const n=Mp();n&&(Nd=!0,n.requestAnimationFrame(()=>{Nd=!1;const t=oD();f.setDeviceProfile(t),AD(t)}))}function aD(n,t){return n?typeof n.addEventListener=="function"?(n.addEventListener("change",t),()=>n.removeEventListener("change",t)):typeof n.addListener=="function"?(n.addListener(t),()=>n.removeListener(t)):()=>{}:()=>{}}function lD(n={}){const t=Mp();if(!t||E0)return;Zl=n.maxMobileWidth??UC,E0=!0;const e=()=>Tl(),s=()=>Tl();t.addEventListener("resize",e),t.addEventListener("orientationchange",s),[t.matchMedia&&t.matchMedia("(pointer: coarse)"),t.matchMedia&&t.matchMedia("(hover: none)"),t.matchMedia&&t.matchMedia(`(max-width: ${Zl}px)`),t.matchMedia&&t.matchMedia("(orientation: portrait)")].filter(Boolean).forEach(i=>{aD(i,Tl)}),Tl(),E.debug("DeviceProfileService",`Initialized (breakpoint <= ${Zl}px)`,null,"ui")}const cD=()=>{const n="/music-learning-tools/student-notation/";return n.endsWith("/")?n:`${n}/`},uD=`${cD()}assets/`;function dD(n=""){const t=n.replace(/^\/+/,"");return`${uD}${t}`}function vs(n){return dD(`icons/${n}`)}class hD{constructor(){M(this,"tasks",[]);M(this,"completedTasks",0);M(this,"totalTasks",0);M(this,"startTime",null);M(this,"loadingScreen",null);M(this,"progressBar",null);M(this,"progressText",null);M(this,"statusText",null);M(this,"initialized",!1);M(this,"cache",{fonts:new Map,icons:new Map,modules:new Map});M(this,"diagnostics",[])}createLoadingScreen(){if(this.loadingScreen)return;const t=document.getElementById("app-loading-screen");t?this.loadingScreen=t:(this.loadingScreen=document.createElement("div"),this.loadingScreen.id="app-loading-screen",this.loadingScreen.innerHTML=`
            <div class="loading-container">
                <div class="loading-logo">
                    <svg viewBox="0 0 100 100" class="logo-svg">
                        <circle cx="50" cy="50" r="45" class="logo-circle" />
                        <path d="M 30 50 Q 50 30, 70 50 T 70 70" class="logo-path" />
                    </svg>
                </div>
                <h1 class="loading-title">Student Notation</h1>
                <div class="loading-progress-container">
                    <div class="loading-progress-bar">
                        <div class="loading-progress-fill" id="loading-progress-fill"></div>
                    </div>
                    <div class="loading-progress-text" id="loading-progress-text">0%</div>
                </div>
                <div class="loading-status" id="loading-status">Initializing...</div>
            </div>
        `,document.body.appendChild(this.loadingScreen)),this.progressBar=this.loadingScreen.querySelector("#loading-progress-fill"),this.progressText=this.loadingScreen.querySelector("#loading-progress-text"),this.statusText=this.loadingScreen.querySelector("#loading-status")}registerTask(t,e=1){this.tasks.push({name:t,weight:e,completed:!1}),this.totalTasks+=e}completeTask(t){const e=this.tasks.find(s=>s.name===t&&!s.completed);e&&(e.completed=!0,this.completedTasks+=e.weight,this.updateProgress())}updateProgress(){if(!this.progressBar||!this.progressText)return;const t=this.totalTasks>0?this.completedTasks/this.totalTasks*100:0;this.progressBar.style.width=`${t}%`,this.progressText.textContent=`${Math.floor(t)}%`,t>=100&&this.completeLoading()}async nextFrame(t=200){await new Promise(e=>{let s=!1;const r=()=>{s||(s=!0,e())};typeof requestAnimationFrame=="function"?(requestAnimationFrame(()=>r()),setTimeout(()=>r(),t)):setTimeout(()=>r(),0)})}setStatus(t){this.statusText&&(this.statusText.textContent=t)}start(){this.initialized||(this.initialized=!0,this.startTime=performance.now())}completeLoading(){this.loadingScreen&&(this.loadingScreen.classList.add("fade-out"),setTimeout(()=>{var t;(t=this.loadingScreen)==null||t.remove(),this.loadingScreen=null},400))}showError(t){if(this.statusText){const e=t instanceof Error?t.message:String(t);this.statusText.textContent=`Error: ${e}`,this.statusText.style.color="#ff4444"}}init(){this.createLoadingScreen(),this.start()}updateStatus(t){this.setStatus(t)}async complete(){this.completeLoading()}async preloadIcon(t){if(this.cache.icons.has(t))return this.cache.icons.get(t);const e=vs(t);return this.cache.icons.set(t,e),e}getDiagnostics(){return[...this.diagnostics]}}const wt=new hD;let Qp=!1,Up=[],tc=null;function PC(){Qp=!0}function fD(){Qp=!1}function NC(n){try{return JSON.parse(JSON.stringify(n,(t,e)=>e instanceof Float32Array?{__type:"Float32Array",data:Array.from(e)}:e))}catch{return null}}function $h(n,t,e="root"){const s=[];if(!n||!t)return s;if(typeof n!=typeof t)return s.push({path:e,type:"type_change",oldValue:typeof n,newValue:typeof t,timestamp:Date.now()}),s;if(typeof n!="object")return n!==t&&s.push({path:e,type:"value_change",oldValue:n,newValue:t,timestamp:Date.now()}),s;if(Array.isArray(n)){if(!Array.isArray(t))return s.push({path:e,type:"array_to_non_array",oldLength:n.length,newType:typeof t,timestamp:Date.now()}),s;n.length!==t.length&&s.push({path:e,type:"array_length_change",oldLength:n.length,newLength:t.length,timestamp:Date.now()});const i=Math.max(n.length,t.length);for(let o=0;o<i;o++){const A=$h(n[o],t[o],`${e}[${o}]`);s.push(...A)}return s}const r=new Set([...Object.keys(n),...Object.keys(t)]);for(const i of r)if(!(i in n))s.push({path:`${e}.${String(i)}`,type:"property_added",newValue:t[i],timestamp:Date.now()});else if(!(i in t))s.push({path:`${e}.${String(i)}`,type:"property_removed",oldValue:n[i],timestamp:Date.now()});else{const o=$h(n[i],t[i],`${e}.${String(i)}`);s.push(...o)}return s}function pD(n){tc=NC(n)}function mD(n,t="unknown"){if(!Qp||!tc)return;const e=NC(n),s=$h(tc,e);if(s.length>0){const r=s.filter(i=>!i.path.includes("tempo")&&!i.path.includes("isPlaying")&&!i.path.includes("fullRowData")&&!i.path.includes("columnWidths"));r.length>0&&Up.push({action:t,mutations:r,timestamp:Date.now()})}tc=e}function gD(){return[...Up]}function vD(){Up=[]}typeof window<"u"&&(window.stateGuard={enable:PC,disable:fD,getLog:gD,clearLog:vD});E.moduleLoaded("RhythmPlaybackService");class wD{constructor(){M(this,"scheduledEvents",[]);M(this,"isInitialized",!1);this.scheduledEvents=[],this.isInitialized=!1}init(){return this.initialize()}refresh(){this.stopCurrentPattern()}async initialize(){this.isInitialized||(this.isInitialized=!0,E.info("RhythmPlaybackService","Initialized"),window.rhythmPlaybackService=this)}playRhythmPattern(t,e,s,r="oval",i=null){if(!this.isInitialized){E.warn("RhythmPlaybackService","Not initialized, call initialize() first");return}this.stopCurrentPattern();const o=_C(t,i);if(!o||o.length===0){E.warn("RhythmPlaybackService",`No events found for sixteenth stamp ${t}`);return}E.debug("RhythmPlaybackService",`Playing pattern for sixteenth stamp ${t}: ${o.length} notes`,{sixteenthStampId:t,basePitch:e,color:s,events:o,hasShapeOffsets:!!(i!=null&&i.shapeOffsets)});const A=Pe(),a=(i==null?void 0:i.globalRow)??(i==null?void 0:i.row);o.forEach((l,c)=>{try{const u=Ce(String(l.offset)).toSeconds(),d=A+u,p=Ce(String(l.duration)).toSeconds(),h=r==="circle"?p*2:p,m=d+h;let g=e;if(a!==void 0&&l.rowOffset!==0){const v=a+l.rowOffset,w=f.state.fullRowData[v];w&&(g=w.toneNote.replace("","b").replace("","#"))}Wt.triggerAttack(g,s,d),Wt.triggerRelease(g,s,m),this.scheduledEvents.push({pitch:g,color:s,attackTime:d,releaseTime:m})}catch(u){E.warn("RhythmPlaybackService",`Error scheduling note ${c+1}`,u)}}),E.info("RhythmPlaybackService",`Scheduled ${o.length} notes for rhythm pattern ${t}`)}stopCurrentPattern(){this.scheduledEvents.length!==0&&(E.debug("RhythmPlaybackService",`Clearing ${this.scheduledEvents.length} scheduled events`),Wt.releaseAll(),this.scheduledEvents=[])}getSixteenthStampAtPosition(t,e){return f.state.sixteenthStampPlacements&&f.state.sixteenthStampPlacements.find(r=>{const i=r.row===e,o=t>=r.startColumn&&t<r.endColumn;return i&&o})||null}playTripletPattern(t,e,s,r=null){if(!this.isInitialized){E.warn("RhythmPlaybackService","Not initialized, call initialize() first");return}this.stopCurrentPattern();const i=QC(t,r);if(!i||i.length===0){E.warn("RhythmPlaybackService",`No events found for triplet ${t}`);return}E.debug("RhythmPlaybackService",`Playing triplet pattern ${t}: ${i.length} notes`,{tripletStampId:t,basePitch:e,color:s,events:i,hasShapeOffsets:!!(r!=null&&r.shapeOffsets)});const o=Pe(),A=(r==null?void 0:r.globalRow)??(r==null?void 0:r.row);i.forEach((a,l)=>{try{const c=Ce(a.offset).toSeconds(),u=o+c,d=Ce(a.duration).toSeconds(),p=u+d;let h=e;if(A!==void 0&&a.rowOffset!==0){const m=A+a.rowOffset,g=f.state.fullRowData[m];g&&(h=g.toneNote.replace("?T-","b").replace("?T_","#"))}Wt.triggerAttack(h,s,u),Wt.triggerRelease(h,s,p),this.scheduledEvents.push({pitch:h,color:s,attackTime:u,releaseTime:p})}catch(c){E.warn("RhythmPlaybackService",`Error scheduling triplet note ${l+1}`,c)}}),E.info("RhythmPlaybackService",`Scheduled ${i.length} notes for triplet pattern ${t}`)}getTripletStampAtPosition(t,e){return f.state.tripletStampPlacements&&f.state.tripletStampPlacements.find(s=>s.row===e&&t>=s.startTimeIndex&&t<s.startTimeIndex+s.span*2)||null}dispose(){this.stopCurrentPattern(),this.isInitialized=!1,E.info("RhythmPlaybackService","Disposed")}}const re=new wD,BD={H:"https://tonejs.github.io/audio/drum-samples/CR78/hihat.mp3",M:"https://tonejs.github.io/audio/drum-samples/CR78/snare.mp3",L:"https://tonejs.github.io/audio/drum-samples/CR78/kick.mp3"};let Zi=null,x0=!1;async function CD(){if(!x0){Zi=new vu(BD);try{await Zi.loaded,x0=!0}catch(n){console.warn("Drum sample preloading failed, will load on-demand:",n),Zi==null||Zi.dispose(),Zi=null}}}const DC=[];function ee(...n){DC.push(n)}const LC={enableModulationTool(){f.setSelectedTool("modulation"),ee("[MODULATION TEST] Modulation tool enabled. Click on the grid to place markers."),ee("[MODULATION TEST] Click marker labels to toggle 2:3  3:2"),ee("[MODULATION TEST] Drag marker barlines to move them")},addTestMarker(){const t=this.findNearestGridLine(200),e=this.findMeasureIndexForX(t.x),s=f.addModulationMarker(e,Fn.COMPRESSION_2_3,t.x,t.columnIndex);return ee("[MODULATION TEST] Added test marker at measure",e,"columnIndex=",t.columnIndex,"x=",t.x,"(snapped from",200,")"),s},addTestMarker2(){const t=this.findNearestGridLine(400),e=this.findMeasureIndexForX(t.x),s=f.addModulationMarker(e,Fn.EXPANSION_3_2,t.x,t.columnIndex);return ee("[MODULATION TEST] Added test marker 2 at measure",e,"columnIndex=",t.columnIndex,"x=",t.x,"(snapped from",400,")"),s},findNearestGridLine(n){const t=f.state;let e=0,s=0,r=1/0,i=0;for(let o=0;o<t.columnWidths.length;o++){const A=Math.abs(i-n);A<r&&(r=A,s=i,e=o);const a=t.columnWidths[o]||0;i+=a*t.cellWidth}return ee("[MODULATION TEST] findNearestGridLine:",{targetX:n,closestColumnIndex:e,closestX:s,minDistance:r}),{columnIndex:e,x:s}},findMeasureIndexForX(n){const t=f.state.cellWidth||40,e=5,s=Math.round(n/t);return Math.max(1,Math.round(s/e))},clearAllMarkers(){[...f.state.tempoModulationMarkers||[]].forEach(t=>{f.removeModulationMarker(t.id)}),ee("[MODULATION TEST] Cleared all markers")},testMapping(){var e;const n=f.state.baseMicrobeatPx||f.state.cellWidth||40;ee("[MODULATION TEST] Base microbeat pixels:",n),ee("[MODULATION TEST] Modulation markers:",f.state.tempoModulationMarkers);const t=typeof window<"u"?(e=window.getModulationMapping)==null?void 0:e.call(window):void 0;t&&(ee("[MODULATION TEST] Coordinate mapping:",t),[0,100,200,300,400,500].forEach(r=>{const i=t.canvasXToMicrobeat(r),o=t.microbeatToCanvasX(i);ee(`[MODULATION TEST] x=${r}  microbeat=${i.toFixed(3)}  x=${o.toFixed(1)}`)}))},testVisualExpansion(){var t;ee("[MODULATION TEST] Testing visual grid expansion..."),this.clearAllMarkers();const n=this.addTestMarker2();ee("[MODULATION TEST] Added 3:2 expansion marker:",n),typeof window<"u"&&((t=window.LayoutService)!=null&&t.recalculateLayout)&&(ee("[MODULATION TEST] Manually triggering layout recalculation..."),window.LayoutService.recalculateLayout()),setTimeout(()=>{ee("[MODULATION TEST] Grid should now show expansion after x=400"),ee("[MODULATION TEST] Container should be wider to accommodate expansion"),ee("[MODULATION TEST] Check console for [LAYOUT], [GETCOLX], [GRIDLINES], and [NOTES] logs")},100)},testVisualCompression(){var t;ee("[MODULATION TEST] Testing visual grid compression..."),this.clearAllMarkers();const n=this.addTestMarker();ee("[MODULATION TEST] Added 2:3 compression marker:",n),typeof window<"u"&&((t=window.LayoutService)!=null&&t.recalculateLayout)&&(ee("[MODULATION TEST] Manually triggering layout recalculation..."),window.LayoutService.recalculateLayout()),setTimeout(()=>{ee("[MODULATION TEST] Grid should now show compression after x=200"),ee("[MODULATION TEST] Container should adjust to accommodate compression"),ee("[MODULATION TEST] Check console for [LAYOUT], [GETCOLX], [GRIDLINES], and [NOTES] logs")},100)},logState(){ee("[MODULATION TEST] Current state:",{selectedTool:f.state.selectedTool,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.baseMicrobeatPx,cellWidth:f.state.cellWidth})}};typeof window<"u"&&(window.ModulationTest=LC,window.ModulationTestLogs=DC);E.moduleLoaded("ToolbarComponent","toolbar");const bD={init(){E.info("ToolbarComponent","Toolbar init called (all controls managed by Svelte)",null,"toolbar")}},Xh=!1;var kC=Array.isArray,yD=Array.prototype.indexOf,ku=Array.from,SD=Object.defineProperty,Qo=Object.getOwnPropertyDescriptor,ED=Object.getOwnPropertyDescriptors,xD=Object.prototype,ID=Array.prototype,RC=Object.getPrototypeOf,I0=Object.isExtensible;function FD(n){for(var t=0;t<n.length;t++)n[t]()}function HC(){var n,t,e=new Promise((s,r)=>{n=s,t=r});return{promise:e,resolve:n,reject:t}}const ke=2,Pp=4,Np=8,TD=1<<24,mr=16,gr=32,Gi=64,Ru=128,ls=512,ze=1024,Bn=2048,Qs=4096,Mn=8192,ir=16384,Dp=32768,Di=65536,F0=1<<17,OC=1<<18,rA=1<<19,_D=1<<20,Dr=1<<25,Li=32768,Yh=1<<21,Lp=1<<22,Vr=1<<23,KA=Symbol("$state"),MD=Symbol("legacy props"),QD=Symbol(""),mo=new class extends Error{constructor(){super(...arguments);M(this,"name","StaleReactionError");M(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function kp(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function UD(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function PD(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ND(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function DD(n){throw new Error("https://svelte.dev/e/effect_orphan")}function LD(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function kD(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function RD(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function HD(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function OD(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function VD(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const WD=1,GD=2,KD=16,qD=1,zD=4,$D=8,XD=16,YD=1,jD=2,He=Symbol(),JD="http://www.w3.org/1999/xhtml";function ZD(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function VC(n){return n===this.v}function tL(n,t){return n!=n?t==t:n!==t||n!==null&&typeof n=="object"||typeof n=="function"}function WC(n){return!tL(n,this.v)}let eL=!1,ye=null;function Go(n){ye=n}function nL(n,t){return sL().set(n,t),t}function Me(n,t=!1,e){ye={p:ye,i:!1,c:null,e:null,s:n,x:null,l:null}}function Qe(n){var t=ye,e=t.e;if(e!==null){t.e=null;for(var s of e)ob(s)}return t.i=!0,ye=t.p,{}}function GC(){return!0}function sL(n){return ye===null&&kp(),ye.c??(ye.c=new Map(rL(ye)||void 0))}function rL(n){let t=n.p;for(;t!==null;){const e=t.c;if(e!==null)return e;t=t.p}return null}let go=[];function iL(){var n=go;go=[],FD(n)}function Ra(n){if(go.length===0){var t=go;queueMicrotask(()=>{t===go&&iL()})}go.push(n)}function KC(n){var t=Gt;if(t===null)return Ut.f|=Vr,n;if((t.f&Dp)===0){if((t.f&Ru)===0)throw n;t.b.error(n)}else Ko(n,t)}function Ko(n,t){for(;t!==null;){if((t.f&Ru)!==0)try{t.b.error(n);return}catch(e){n=e}t=t.parent}throw n}const _l=new Set;let Vt=null,pe=null,ws=[],Rp=null,jh=!1;var Uo,Po,gi,vi,Ca,No,Do,Le,Jh,SA,Zh,qC,zC;const Yc=class Yc{constructor(){Pt(this,Le);M(this,"committed",!1);M(this,"current",new Map);M(this,"previous",new Map);Pt(this,Uo,new Set);Pt(this,Po,new Set);Pt(this,gi,0);Pt(this,vi,0);Pt(this,Ca,null);Pt(this,No,new Set);Pt(this,Do,new Set);M(this,"skipped_effects",new Set);M(this,"is_fork",!1)}is_deferred(){return this.is_fork||j(this,vi)>0}process(t){var s;ws=[],this.apply();var e={parent:null,effect:null,effects:[],render_effects:[]};for(const r of t)le(this,Le,Jh).call(this,r,e);this.is_fork||le(this,Le,qC).call(this),this.is_deferred()?(le(this,Le,SA).call(this,e.effects),le(this,Le,SA).call(this,e.render_effects)):(Vt=null,T0(e.render_effects),T0(e.effects),(s=j(this,Ca))==null||s.resolve()),pe=null}capture(t,e){this.previous.has(t)||this.previous.set(t,e),(t.f&Vr)===0&&(this.current.set(t,t.v),pe==null||pe.set(t,t.v))}activate(){Vt=this,this.apply()}deactivate(){Vt===this&&(Vt=null,pe=null)}flush(){if(this.activate(),ws.length>0){if(oL(),Vt!==null&&Vt!==this)return}else j(this,gi)===0&&this.process([]);this.deactivate()}discard(){for(const t of j(this,Po))t(this);j(this,Po).clear()}increment(t){It(this,gi,j(this,gi)+1),t&&It(this,vi,j(this,vi)+1)}decrement(t){It(this,gi,j(this,gi)-1),t&&It(this,vi,j(this,vi)-1),this.revive()}revive(){for(const t of j(this,No))j(this,Do).delete(t),Xe(t,Bn),ki(t);for(const t of j(this,Do))Xe(t,Qs),ki(t);this.flush()}oncommit(t){j(this,Uo).add(t)}ondiscard(t){j(this,Po).add(t)}settled(){return(j(this,Ca)??It(this,Ca,HC())).promise}static ensure(){if(Vt===null){const t=Vt=new Yc;_l.add(Vt),Yc.enqueue(()=>{Vt===t&&t.flush()})}return Vt}static enqueue(t){Ra(t)}apply(){}};Uo=new WeakMap,Po=new WeakMap,gi=new WeakMap,vi=new WeakMap,Ca=new WeakMap,No=new WeakMap,Do=new WeakMap,Le=new WeakSet,Jh=function(t,e){var c;t.f^=ze;for(var s=t.first;s!==null;){var r=s.f,i=(r&(gr|Gi))!==0,o=i&&(r&ze)!==0,A=o||(r&Mn)!==0||this.skipped_effects.has(s);if((s.f&Ru)!==0&&((c=s.b)!=null&&c.is_pending())&&(e={parent:e,effect:s,effects:[],render_effects:[]}),!A&&s.fn!==null){i?s.f^=ze:(r&Pp)!==0?e.effects.push(s):Oa(s)&&((s.f&mr)!==0&&j(this,No).add(s),ga(s));var a=s.first;if(a!==null){s=a;continue}}var l=s.parent;for(s=s.next;s===null&&l!==null;)l===e.effect&&(le(this,Le,SA).call(this,e.effects),le(this,Le,SA).call(this,e.render_effects),e=e.parent),s=l.next,l=l.parent}},SA=function(t){for(const e of t)(e.f&Bn)!==0?j(this,No).add(e):(e.f&Qs)!==0&&j(this,Do).add(e),le(this,Le,Zh).call(this,e.deps),Xe(e,ze)},Zh=function(t){if(t!==null)for(const e of t)(e.f&ke)===0||(e.f&Li)===0||(e.f^=Li,le(this,Le,Zh).call(this,e.deps))},qC=function(){if(j(this,vi)===0){for(const t of j(this,Uo))t();j(this,Uo).clear()}j(this,gi)===0&&le(this,Le,zC).call(this)},zC=function(){var i;if(_l.size>1){this.previous.clear();var t=pe,e=!0,s={parent:null,effect:null,effects:[],render_effects:[]};for(const o of _l){if(o===this){e=!1;continue}const A=[];for(const[l,c]of this.current){if(o.current.has(l))if(e&&c!==o.current.get(l))o.current.set(l,c);else continue;A.push(l)}if(A.length===0)continue;const a=[...o.current.keys()].filter(l=>!this.current.has(l));if(a.length>0){var r=ws;ws=[];const l=new Set,c=new Map;for(const u of A)$C(u,a,l,c);if(ws.length>0){Vt=o,o.apply();for(const u of ws)le(i=o,Le,Jh).call(i,u,s);o.deactivate()}ws=r}}Vt=null,pe=t}this.committed=!0,_l.delete(this)};let tr=Yc;function oL(){var n=Ti;jh=!0;var t=null;try{var e=0;for(kc(!0);ws.length>0;){var s=tr.ensure();if(e++>1e3){var r,i;AL()}s.process(ws),Wr.clear()}}finally{jh=!1,kc(n),Rp=null}}function AL(){try{LD()}catch(n){Ko(n,Rp)}}let es=null;function T0(n){var t=n.length;if(t!==0){for(var e=0;e<t;){var s=n[e++];if((s.f&(ir|Mn))===0&&Oa(s)&&(es=new Set,ga(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?cb(s):s.fn=null),(es==null?void 0:es.size)>0)){Wr.clear();for(const r of es){if((r.f&(ir|Mn))!==0)continue;const i=[r];let o=r.parent;for(;o!==null;)es.has(o)&&(es.delete(o),i.push(o)),o=o.parent;for(let A=i.length-1;A>=0;A--){const a=i[A];(a.f&(ir|Mn))===0&&ga(a)}}es.clear()}}es=null}}function $C(n,t,e,s){if(!e.has(n)&&(e.add(n),n.reactions!==null))for(const r of n.reactions){const i=r.f;(i&ke)!==0?$C(r,t,e,s):(i&(Lp|mr))!==0&&(i&Bn)===0&&XC(r,t,s)&&(Xe(r,Bn),ki(r))}}function XC(n,t,e){const s=e.get(n);if(s!==void 0)return s;if(n.deps!==null)for(const r of n.deps){if(t.includes(r))return!0;if((r.f&ke)!==0&&XC(r,t,e))return e.set(r,!0),!0}return e.set(n,!1),!1}function ki(n){for(var t=Rp=n;t.parent!==null;){t=t.parent;var e=t.f;if(jh&&t===Gt&&(e&mr)!==0&&(e&OC)===0)return;if((e&(Gi|gr))!==0){if((e&ze)===0)return;t.f^=ze}}ws.push(t)}function aL(n){let t=0,e=Ri(0),s;return()=>{pa()&&(Z(e),Ab(()=>(t===0&&(s=Va(()=>n(()=>qA(e)))),t+=1,()=>{Ra(()=>{t-=1,t===0&&(s==null||s(),s=void 0,qA(e))})})))}}var lL=Di|rA|Ru;function cL(n,t,e){new uL(n,t,e)}var Ln,kn,gf,Bs,wi,Cs,Rn,an,bs,Ys,_r,Bi,Mr,Ci,Qr,jc,_e,dL,hL,tf,ec,nc,ef;class uL{constructor(t,e,s){Pt(this,_e);M(this,"parent");Pt(this,Ln,!1);Pt(this,kn);Pt(this,gf,null);Pt(this,Bs);Pt(this,wi);Pt(this,Cs);Pt(this,Rn,null);Pt(this,an,null);Pt(this,bs,null);Pt(this,Ys,null);Pt(this,_r,null);Pt(this,Bi,0);Pt(this,Mr,0);Pt(this,Ci,!1);Pt(this,Qr,null);Pt(this,jc,aL(()=>(It(this,Qr,Ri(j(this,Bi))),()=>{It(this,Qr,null)})));It(this,kn,t),It(this,Bs,e),It(this,wi,s),this.parent=Gt.b,It(this,Ln,!!j(this,Bs).pending),It(this,Cs,Ou(()=>{Gt.b=this;{var r=le(this,_e,tf).call(this);try{It(this,Rn,On(()=>s(r)))}catch(i){this.error(i)}j(this,Mr)>0?le(this,_e,nc).call(this):It(this,Ln,!1)}return()=>{var i;(i=j(this,_r))==null||i.remove()}},lL))}is_pending(){return j(this,Ln)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!j(this,Bs).pending}update_pending_count(t){le(this,_e,ef).call(this,t),It(this,Bi,j(this,Bi)+t),j(this,Qr)&&qo(j(this,Qr),j(this,Bi))}get_effect_pending(){return j(this,jc).call(this),Z(j(this,Qr))}error(t){var e=j(this,Bs).onerror;let s=j(this,Bs).failed;if(j(this,Ci)||!e&&!s)throw t;j(this,Rn)&&(gn(j(this,Rn)),It(this,Rn,null)),j(this,an)&&(gn(j(this,an)),It(this,an,null)),j(this,bs)&&(gn(j(this,bs)),It(this,bs,null));var r=!1,i=!1;const o=()=>{if(r){ZD();return}r=!0,i&&VD(),tr.ensure(),It(this,Bi,0),j(this,bs)!==null&&Fi(j(this,bs),()=>{It(this,bs,null)}),It(this,Ln,this.has_pending_snippet()),It(this,Rn,le(this,_e,ec).call(this,()=>(It(this,Ci,!1),On(()=>j(this,wi).call(this,j(this,kn)))))),j(this,Mr)>0?le(this,_e,nc).call(this):It(this,Ln,!1)};var A=Ut;try{fn(null),i=!0,e==null||e(t,o),i=!1}catch(a){Ko(a,j(this,Cs)&&j(this,Cs).parent)}finally{fn(A)}s&&Ra(()=>{It(this,bs,le(this,_e,ec).call(this,()=>{tr.ensure(),It(this,Ci,!0);try{return On(()=>{s(j(this,kn),()=>t,()=>o)})}catch(a){return Ko(a,j(this,Cs).parent),null}finally{It(this,Ci,!1)}}))})}}Ln=new WeakMap,kn=new WeakMap,gf=new WeakMap,Bs=new WeakMap,wi=new WeakMap,Cs=new WeakMap,Rn=new WeakMap,an=new WeakMap,bs=new WeakMap,Ys=new WeakMap,_r=new WeakMap,Bi=new WeakMap,Mr=new WeakMap,Ci=new WeakMap,Qr=new WeakMap,jc=new WeakMap,_e=new WeakSet,dL=function(){try{It(this,Rn,On(()=>j(this,wi).call(this,j(this,kn))))}catch(t){this.error(t)}It(this,Ln,!1)},hL=function(){const t=j(this,Bs).pending;t&&(It(this,an,On(()=>t(j(this,kn)))),tr.enqueue(()=>{var e=le(this,_e,tf).call(this);It(this,Rn,le(this,_e,ec).call(this,()=>(tr.ensure(),On(()=>j(this,wi).call(this,e))))),j(this,Mr)>0?le(this,_e,nc).call(this):(Fi(j(this,an),()=>{It(this,an,null)}),It(this,Ln,!1))}))},tf=function(){var t=j(this,kn);return j(this,Ln)&&(It(this,_r,Gr()),j(this,kn).before(j(this,_r)),t=j(this,_r)),t},ec=function(t){var e=Gt,s=Ut,r=ye;Us(j(this,Cs)),fn(j(this,Cs)),Go(j(this,Cs).ctx);try{return t()}catch(i){return KC(i),null}finally{Us(e),fn(s),Go(r)}},nc=function(){const t=j(this,Bs).pending;j(this,Rn)!==null&&(It(this,Ys,document.createDocumentFragment()),j(this,Ys).append(j(this,_r)),hb(j(this,Rn),j(this,Ys))),j(this,an)===null&&It(this,an,On(()=>t(j(this,kn))))},ef=function(t){var e;if(!this.has_pending_snippet()){this.parent&&le(e=this.parent,_e,ef).call(e,t);return}It(this,Mr,j(this,Mr)+t),j(this,Mr)===0&&(It(this,Ln,!1),j(this,an)&&Fi(j(this,an),()=>{It(this,an,null)}),j(this,Ys)&&(j(this,kn).before(j(this,Ys)),It(this,Ys,null)))};function fL(n,t,e,s){const r=Hu;if(e.length===0&&n.length===0){s(t.map(r));return}var i=Vt,o=Gt,A=pL();function a(){Promise.all(e.map(l=>mL(l))).then(l=>{A();try{s([...t.map(r),...l])}catch(c){(o.f&ir)===0&&Ko(c,o)}i==null||i.deactivate(),Lc()}).catch(l=>{Ko(l,o)})}n.length>0?Promise.all(n).then(()=>{A();try{return a()}finally{i==null||i.deactivate(),Lc()}}):a()}function pL(){var n=Gt,t=Ut,e=ye,s=Vt;return function(i=!0){Us(n),fn(t),Go(e),i&&(s==null||s.activate())}}function Lc(){Us(null),fn(null),Go(null)}function Hu(n){var t=ke|Bn,e=Ut!==null&&(Ut.f&ke)!==0?Ut:null;return Gt!==null&&(Gt.f|=rA),{ctx:ye,deps:null,effects:null,equals:VC,f:t,fn:n,reactions:null,rv:0,v:He,wv:0,parent:e??Gt,ac:null}}function mL(n,t){let e=Gt;e===null&&UD();var s=e.b,r=void 0,i=Ri(He),o=!Ut,A=new Map;return xL(()=>{var d;var a=HC();r=a.promise;try{Promise.resolve(n()).then(a.resolve,a.reject).then(()=>{l===Vt&&l.committed&&l.deactivate(),Lc()})}catch(p){a.reject(p),Lc()}var l=Vt;if(o){var c=!s.is_pending();s.update_pending_count(1),l.increment(c),(d=A.get(l))==null||d.reject(mo),A.delete(l),A.set(l,a)}const u=(p,h=void 0)=>{if(l.activate(),h)h!==mo&&(i.f|=Vr,qo(i,h));else{(i.f&Vr)!==0&&(i.f^=Vr),qo(i,p);for(const[m,g]of A){if(A.delete(m),m===l)break;g.reject(mo)}}o&&(s.update_pending_count(-1),l.decrement(c))};a.promise.then(u,p=>u(null,p||"unknown"))}),ib(()=>{for(const a of A.values())a.reject(mo)}),new Promise(a=>{function l(c){function u(){c===r?a(i):l(r)}c.then(u,u)}l(r)})}function fi(n){const t=Hu(n);return fb(t),t}function YC(n){const t=Hu(n);return t.equals=WC,t}function jC(n){var t=n.effects;if(t!==null){n.effects=null;for(var e=0;e<t.length;e+=1)gn(t[e])}}function gL(n){for(var t=n.parent;t!==null;){if((t.f&ke)===0)return(t.f&ir)===0?t:null;t=t.parent}return null}function Hp(n){var t,e=Gt;Us(gL(n));try{n.f&=~Li,jC(n),t=vb(n)}finally{Us(e)}return t}function JC(n){var t=Hp(n);if(n.equals(t)||(Vt!=null&&Vt.is_fork||(n.v=t),n.wv=mb()),!Ki)if(pe!==null)(pa()||Vt!=null&&Vt.is_fork)&&pe.set(n,t);else{var e=(n.f&ls)===0?Qs:ze;Xe(n,e)}}let nf=new Set;const Wr=new Map;let ZC=!1;function Ri(n,t){var e={f:0,v:n,reactions:null,equals:VC,rv:0,wv:0};return e}function Rt(n,t){const e=Ri(n);return fb(e),e}function vL(n,t=!1,e=!0){const s=Ri(n);return t||(s.equals=WC),s}function St(n,t,e=!1){Ut!==null&&(!Is||(Ut.f&F0)!==0)&&GC()&&(Ut.f&(ke|mr|Lp|F0))!==0&&!(rn!=null&&rn.includes(n))&&OD();let s=e?Tn(t):t;return qo(n,s)}function qo(n,t){if(!n.equals(t)){var e=n.v;Ki?Wr.set(n,t):Wr.set(n,e),n.v=t;var s=tr.ensure();s.capture(n,e),(n.f&ke)!==0&&((n.f&Bn)!==0&&Hp(n),Xe(n,(n.f&ls)!==0?ze:Qs)),n.wv=mb(),tb(n,Bn),Gt!==null&&(Gt.f&ze)!==0&&(Gt.f&(gr|Gi))===0&&(Dn===null?TL([n]):Dn.push(n)),!s.is_fork&&nf.size>0&&!ZC&&wL()}return t}function wL(){ZC=!1;var n=Ti;kc(!0);const t=Array.from(nf);try{for(const e of t)(e.f&ze)!==0&&Xe(e,Qs),Oa(e)&&ga(e)}finally{kc(n)}nf.clear()}function qA(n){St(n,n.v+1)}function tb(n,t){var e=n.reactions;if(e!==null)for(var s=e.length,r=0;r<s;r++){var i=e[r],o=i.f,A=(o&Bn)===0;if(A&&Xe(i,t),(o&ke)!==0){var a=i;pe==null||pe.delete(a),(o&Li)===0&&(o&ls&&(i.f|=Li),tb(a,Qs))}else A&&((o&mr)!==0&&es!==null&&es.add(i),ki(i))}}function Tn(n){if(typeof n!="object"||n===null||KA in n)return n;const t=RC(n);if(t!==xD&&t!==ID)return n;var e=new Map,s=kC(n),r=Rt(0),i=_i,o=A=>{if(_i===i)return A();var a=Ut,l=_i;fn(null),M0(i);var c=A();return fn(a),M0(l),c};return s&&e.set("length",Rt(n.length)),new Proxy(n,{defineProperty(A,a,l){(!("value"in l)||l.configurable===!1||l.enumerable===!1||l.writable===!1)&&RD();var c=e.get(a);return c===void 0?c=o(()=>{var u=Rt(l.value);return e.set(a,u),u}):St(c,l.value,!0),!0},deleteProperty(A,a){var l=e.get(a);if(l===void 0){if(a in A){const c=o(()=>Rt(He));e.set(a,c),qA(r)}}else St(l,He),qA(r);return!0},get(A,a,l){var p;if(a===KA)return n;var c=e.get(a),u=a in A;if(c===void 0&&(!u||(p=Qo(A,a))!=null&&p.writable)&&(c=o(()=>{var h=Tn(u?A[a]:He),m=Rt(h);return m}),e.set(a,c)),c!==void 0){var d=Z(c);return d===He?void 0:d}return Reflect.get(A,a,l)},getOwnPropertyDescriptor(A,a){var l=Reflect.getOwnPropertyDescriptor(A,a);if(l&&"value"in l){var c=e.get(a);c&&(l.value=Z(c))}else if(l===void 0){var u=e.get(a),d=u==null?void 0:u.v;if(u!==void 0&&d!==He)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return l},has(A,a){var d;if(a===KA)return!0;var l=e.get(a),c=l!==void 0&&l.v!==He||Reflect.has(A,a);if(l!==void 0||Gt!==null&&(!c||(d=Qo(A,a))!=null&&d.writable)){l===void 0&&(l=o(()=>{var p=c?Tn(A[a]):He,h=Rt(p);return h}),e.set(a,l));var u=Z(l);if(u===He)return!1}return c},set(A,a,l,c){var y;var u=e.get(a),d=a in A;if(s&&a==="length")for(var p=l;p<u.v;p+=1){var h=e.get(p+"");h!==void 0?St(h,He):p in A&&(h=o(()=>Rt(He)),e.set(p+"",h))}if(u===void 0)(!d||(y=Qo(A,a))!=null&&y.writable)&&(u=o(()=>Rt(void 0)),St(u,Tn(l)),e.set(a,u));else{d=u.v!==He;var m=o(()=>Tn(l));St(u,m)}var g=Reflect.getOwnPropertyDescriptor(A,a);if(g!=null&&g.set&&g.set.call(c,l),!d){if(s&&typeof a=="string"){var v=e.get("length"),w=Number(a);Number.isInteger(w)&&w>=v.v&&St(v,w+1)}qA(r)}return!0},ownKeys(A){Z(r);var a=Reflect.ownKeys(A).filter(u=>{var d=e.get(u);return d===void 0||d.v!==He});for(var[l,c]of e)c.v!==He&&!(l in A)&&a.push(l);return a},setPrototypeOf(){HD()}})}var sf,eb,nb,sb;function BL(){if(sf===void 0){sf=window,eb=/Firefox/.test(navigator.userAgent);var n=Element.prototype,t=Node.prototype,e=Text.prototype;nb=Qo(t,"firstChild").get,sb=Qo(t,"nextSibling").get,I0(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),I0(e)&&(e.__t=void 0)}}function Gr(n=""){return document.createTextNode(n)}function zo(n){return nb.call(n)}function Ha(n){return sb.call(n)}function Fe(n,t){return zo(n)}function fa(n,t=!1){{var e=zo(n);return e instanceof Comment&&e.data===""?Ha(e):e}}function Ge(n,t=1,e=!1){let s=n;for(;t--;)s=Ha(s);return s}function CL(n){n.textContent=""}function rb(){return!1}function Op(n){var t=Ut,e=Gt;fn(null),Us(null);try{return n()}finally{fn(t),Us(e)}}function bL(n){Gt===null&&(Ut===null&&DD(),ND()),Ki&&PD()}function yL(n,t){var e=t.last;e===null?t.last=t.first=n:(e.next=n,n.prev=e,t.last=n)}function vr(n,t,e){var s=Gt;s!==null&&(s.f&Mn)!==0&&(n|=Mn);var r={ctx:ye,deps:null,nodes:null,f:n|Bn|ls,first:null,fn:t,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(e)try{ga(r),r.f|=Dp}catch(A){throw gn(r),A}else t!==null&&ki(r);var i=r;if(e&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&rA)===0&&(i=i.first,(n&mr)!==0&&(n&Di)!==0&&i!==null&&(i.f|=Di)),i!==null&&(i.parent=s,s!==null&&yL(i,s),Ut!==null&&(Ut.f&ke)!==0&&(n&Gi)===0)){var o=Ut;(o.effects??(o.effects=[])).push(i)}return r}function pa(){return Ut!==null&&!Is}function ib(n){const t=vr(Np,null,!1);return Xe(t,ze),t.teardown=n,t}function Qn(n){bL();var t=Gt.f,e=!Ut&&(t&gr)!==0&&(t&Dp)===0;if(e){var s=ye;(s.e??(s.e=[])).push(n)}else return ob(n)}function ob(n){return vr(Pp|_D,n,!1)}function SL(n){tr.ensure();const t=vr(Gi|rA,n,!0);return(e={})=>new Promise(s=>{e.outro?Fi(t,()=>{gn(t),s(void 0)}):(gn(t),s(void 0))})}function EL(n){return vr(Pp,n,!1)}function xL(n){return vr(Lp|rA,n,!0)}function Ab(n,t=0){return vr(Np|t,n,!0)}function Ii(n,t=[],e=[],s=[]){fL(s,t,e,r=>{vr(Np,()=>n(...r.map(Z)),!0)})}function Ou(n,t=0){var e=vr(mr|t,n,!0);return e}function On(n){return vr(gr|rA,n,!0)}function ab(n){var t=n.teardown;if(t!==null){const e=Ki,s=Ut;_0(!0),fn(null);try{t.call(null)}finally{_0(e),fn(s)}}}function lb(n,t=!1){var e=n.first;for(n.first=n.last=null;e!==null;){const r=e.ac;r!==null&&Op(()=>{r.abort(mo)});var s=e.next;(e.f&Gi)!==0?e.parent=null:gn(e,t),e=s}}function IL(n){for(var t=n.first;t!==null;){var e=t.next;(t.f&gr)===0&&gn(t),t=e}}function gn(n,t=!0){var e=!1;(t||(n.f&OC)!==0)&&n.nodes!==null&&n.nodes.end!==null&&(FL(n.nodes.start,n.nodes.end),e=!0),lb(n,t&&!e),Rc(n,0),Xe(n,ir);var s=n.nodes&&n.nodes.t;if(s!==null)for(const i of s)i.stop();ab(n);var r=n.parent;r!==null&&r.first!==null&&cb(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function FL(n,t){for(;n!==null;){var e=n===t?null:Ha(n);n.remove(),n=e}}function cb(n){var t=n.parent,e=n.prev,s=n.next;e!==null&&(e.next=s),s!==null&&(s.prev=e),t!==null&&(t.first===n&&(t.first=s),t.last===n&&(t.last=e))}function Fi(n,t,e=!0){var s=[];ub(n,s,!0);var r=()=>{e&&gn(n),t&&t()},i=s.length;if(i>0){var o=()=>--i||r();for(var A of s)A.out(o)}else r()}function ub(n,t,e){if((n.f&Mn)===0){n.f^=Mn;var s=n.nodes&&n.nodes.t;if(s!==null)for(const A of s)(A.is_global||e)&&t.push(A);for(var r=n.first;r!==null;){var i=r.next,o=(r.f&Di)!==0||(r.f&gr)!==0&&(n.f&mr)!==0;ub(r,t,o?e:!1),r=i}}}function Vp(n){db(n,!0)}function db(n,t){if((n.f&Mn)!==0){n.f^=Mn,(n.f&ze)===0&&(Xe(n,Bn),ki(n));for(var e=n.first;e!==null;){var s=e.next,r=(e.f&Di)!==0||(e.f&gr)!==0;db(e,r?t:!1),e=s}var i=n.nodes&&n.nodes.t;if(i!==null)for(const o of i)(o.is_global||t)&&o.in()}}function hb(n,t){if(n.nodes)for(var e=n.nodes.start,s=n.nodes.end;e!==null;){var r=e===s?null:Ha(e);t.append(e),e=r}}let Ti=!1;function kc(n){Ti=n}let Ki=!1;function _0(n){Ki=n}let Ut=null,Is=!1;function fn(n){Ut=n}let Gt=null;function Us(n){Gt=n}let rn=null;function fb(n){Ut!==null&&(rn===null?rn=[n]:rn.push(n))}let en=null,yn=0,Dn=null;function TL(n){Dn=n}let pb=1,ma=0,_i=ma;function M0(n){_i=n}function mb(){return++pb}function Oa(n){var t=n.f;if((t&Bn)!==0)return!0;if(t&ke&&(n.f&=~Li),(t&Qs)!==0){var e=n.deps;if(e!==null)for(var s=e.length,r=0;r<s;r++){var i=e[r];if(Oa(i)&&JC(i),i.wv>n.wv)return!0}(t&ls)!==0&&pe===null&&Xe(n,ze)}return!1}function gb(n,t,e=!0){var s=n.reactions;if(s!==null&&!(rn!=null&&rn.includes(n)))for(var r=0;r<s.length;r++){var i=s[r];(i.f&ke)!==0?gb(i,t,!1):t===i&&(e?Xe(i,Bn):(i.f&ze)!==0&&Xe(i,Qs),ki(i))}}function vb(n){var h;var t=en,e=yn,s=Dn,r=Ut,i=rn,o=ye,A=Is,a=_i,l=n.f;en=null,yn=0,Dn=null,Ut=(l&(gr|Gi))===0?n:null,rn=null,Go(n.ctx),Is=!1,_i=++ma,n.ac!==null&&(Op(()=>{n.ac.abort(mo)}),n.ac=null);try{n.f|=Yh;var c=n.fn,u=c(),d=n.deps;if(en!==null){var p;if(Rc(n,yn),d!==null&&yn>0)for(d.length=yn+en.length,p=0;p<en.length;p++)d[yn+p]=en[p];else n.deps=d=en;if(pa()&&(n.f&ls)!==0)for(p=yn;p<d.length;p++)((h=d[p]).reactions??(h.reactions=[])).push(n)}else d!==null&&yn<d.length&&(Rc(n,yn),d.length=yn);if(GC()&&Dn!==null&&!Is&&d!==null&&(n.f&(ke|Qs|Bn))===0)for(p=0;p<Dn.length;p++)gb(Dn[p],n);return r!==null&&r!==n&&(ma++,Dn!==null&&(s===null?s=Dn:s.push(...Dn))),(n.f&Vr)!==0&&(n.f^=Vr),u}catch(m){return KC(m)}finally{n.f^=Yh,en=t,yn=e,Dn=s,Ut=r,rn=i,Go(o),Is=A,_i=a}}function _L(n,t){let e=t.reactions;if(e!==null){var s=yD.call(e,n);if(s!==-1){var r=e.length-1;r===0?e=t.reactions=null:(e[s]=e[r],e.pop())}}e===null&&(t.f&ke)!==0&&(en===null||!en.includes(t))&&(Xe(t,Qs),(t.f&ls)!==0&&(t.f^=ls,t.f&=~Li),jC(t),Rc(t,0))}function Rc(n,t){var e=n.deps;if(e!==null)for(var s=t;s<e.length;s++)_L(n,e[s])}function ga(n){var t=n.f;if((t&ir)===0){Xe(n,ze);var e=Gt,s=Ti;Gt=n,Ti=!0;try{(t&(mr|TD))!==0?IL(n):lb(n),ab(n);var r=vb(n);n.teardown=typeof r=="function"?r:null,n.wv=pb;var i;Xh&&eL&&(n.f&Bn)!==0&&n.deps}finally{Ti=s,Gt=e}}}function Z(n){var t=n.f,e=(t&ke)!==0;if(Ut!==null&&!Is){var s=Gt!==null&&(Gt.f&ir)!==0;if(!s&&!(rn!=null&&rn.includes(n))){var r=Ut.deps;if((Ut.f&Yh)!==0)n.rv<ma&&(n.rv=ma,en===null&&r!==null&&r[yn]===n?yn++:en===null?en=[n]:en.includes(n)||en.push(n));else{(Ut.deps??(Ut.deps=[])).push(n);var i=n.reactions;i===null?n.reactions=[Ut]:i.includes(Ut)||i.push(Ut)}}}if(Ki){if(Wr.has(n))return Wr.get(n);if(e){var o=n,A=o.v;return((o.f&ze)===0&&o.reactions!==null||Bb(o))&&(A=Hp(o)),Wr.set(o,A),A}}else e&&(!(pe!=null&&pe.has(n))||Vt!=null&&Vt.is_fork&&!pa())&&(o=n,Oa(o)&&JC(o),Ti&&pa()&&(o.f&ls)===0&&wb(o));if(pe!=null&&pe.has(n))return pe.get(n);if((n.f&Vr)!==0)throw n.v;return n.v}function wb(n){if(n.deps!==null){n.f^=ls;for(const t of n.deps)(t.reactions??(t.reactions=[])).push(n),(t.f&ke)!==0&&(t.f&ls)===0&&wb(t)}}function Bb(n){if(n.v===He)return!0;if(n.deps===null)return!1;for(const t of n.deps)if(Wr.has(t)||(t.f&ke)!==0&&Bb(t))return!0;return!1}function Va(n){var t=Is;try{return Is=!0,n()}finally{Is=t}}const ML=-7169;function Xe(n,t){n.f=n.f&ML|t}const QL=["touchstart","touchmove"];function UL(n){return QL.includes(n)}const Cb=new Set,rf=new Set;function PL(n,t,e,s={}){function r(i){if(s.capture||EA.call(t,i),!i.cancelBubble)return Op(()=>e==null?void 0:e.call(this,i))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Ra(()=>{t.addEventListener(n,r,s)}):t.addEventListener(n,r,s),r}function vo(n,t,e,s,r){var i={capture:s,passive:r},o=PL(n,t,e,i);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&ib(()=>{t.removeEventListener(n,o,i)})}function Vu(n){for(var t=0;t<n.length;t++)Cb.add(n[t]);for(var e of rf)e(n)}let Q0=null;function EA(n){var g;var t=this,e=t.ownerDocument,s=n.type,r=((g=n.composedPath)==null?void 0:g.call(n))||[],i=r[0]||n.target;Q0=n;var o=0,A=Q0===n&&n.__root;if(A){var a=r.indexOf(A);if(a!==-1&&(t===document||t===window)){n.__root=t;return}var l=r.indexOf(t);if(l===-1)return;a<=l&&(o=a)}if(i=r[o]||n.target,i!==t){SD(n,"currentTarget",{configurable:!0,get(){return i||e}});var c=Ut,u=Gt;fn(null),Us(null);try{for(var d,p=[];i!==null;){var h=i.assignedSlot||i.parentNode||i.host||null;try{var m=i["__"+s];m!=null&&(!i.disabled||n.target===i)&&m.call(i,n)}catch(v){d?p.push(v):d=v}if(n.cancelBubble||h===t||h===null)break;i=h}if(d){for(let v of p)queueMicrotask(()=>{throw v});throw d}}finally{n.__root=t,delete n.currentTarget,fn(c),Us(u)}}}function bb(n){var t=document.createElement("template");return t.innerHTML=n.replaceAll("<!>","<!---->"),t.content}function Hc(n,t){var e=Gt;e.nodes===null&&(e.nodes={start:n,end:t,a:null,t:null})}function ti(n,t){var e=(t&YD)!==0,s=(t&jD)!==0,r,i=!n.startsWith("<!>");return()=>{r===void 0&&(r=bb(i?n:"<!>"+n),e||(r=zo(r)));var o=s||eb?document.importNode(r,!0):r.cloneNode(!0);if(e){var A=zo(o),a=o.lastChild;Hc(A,a)}else Hc(o,o);return o}}function NL(n,t,e="svg"){var s=!n.startsWith("<!>"),r=`<${e}>${s?n:"<!>"+n}</${e}>`,i;return()=>{if(!i){var o=bb(r),A=zo(o);i=zo(A)}var a=i.cloneNode(!0);return Hc(a,a),a}}function DL(n,t){return NL(n,t,"svg")}function Oc(){var n=document.createDocumentFragment(),t=document.createComment(""),e=Gr();return n.append(t,e),Hc(t,e),n}function Un(n,t){n!==null&&n.before(t)}function sc(n,t){var e=t==null?"":typeof t=="object"?t+"":t;e!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=e,n.nodeValue=e+"")}function yb(n,t){return LL(n,t)}const to=new Map;function LL(n,{target:t,anchor:e,props:s={},events:r,context:i,intro:o=!0}){BL();var A=new Set,a=u=>{for(var d=0;d<u.length;d++){var p=u[d];if(!A.has(p)){A.add(p);var h=UL(p);t.addEventListener(p,EA,{passive:h});var m=to.get(p);m===void 0?(document.addEventListener(p,EA,{passive:h}),to.set(p,1)):to.set(p,m+1)}}};a(ku(Cb)),rf.add(a);var l=void 0,c=SL(()=>{var u=e??t.appendChild(Gr());return cL(u,{pending:()=>{}},d=>{if(i){Me({});var p=ye;p.c=i}r&&(s.$$events=r),l=n(d,s)||{},i&&Qe()}),()=>{var h;for(var d of A){t.removeEventListener(d,EA);var p=to.get(d);--p===0?(document.removeEventListener(d,EA),to.delete(d)):to.set(d,p)}rf.delete(a),u!==e&&((h=u.parentNode)==null||h.removeChild(u))}});return of.set(l,c),l}let of=new WeakMap;function kL(n,t){const e=of.get(n);return e?(of.delete(n),e(t)):Promise.resolve()}var ns,ys,Sn,bi,ba,ya,Jc;class Sb{constructor(t,e=!0){M(this,"anchor");Pt(this,ns,new Map);Pt(this,ys,new Map);Pt(this,Sn,new Map);Pt(this,bi,new Set);Pt(this,ba,!0);Pt(this,ya,()=>{var t=Vt;if(j(this,ns).has(t)){var e=j(this,ns).get(t),s=j(this,ys).get(e);if(s)Vp(s),j(this,bi).delete(e);else{var r=j(this,Sn).get(e);r&&(j(this,ys).set(e,r.effect),j(this,Sn).delete(e),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),s=r.effect)}for(const[i,o]of j(this,ns)){if(j(this,ns).delete(i),i===t)break;const A=j(this,Sn).get(o);A&&(gn(A.effect),j(this,Sn).delete(o))}for(const[i,o]of j(this,ys)){if(i===e||j(this,bi).has(i))continue;const A=()=>{if(Array.from(j(this,ns).values()).includes(i)){var l=document.createDocumentFragment();hb(o,l),l.append(Gr()),j(this,Sn).set(i,{effect:o,fragment:l})}else gn(o);j(this,bi).delete(i),j(this,ys).delete(i)};j(this,ba)||!s?(j(this,bi).add(i),Fi(o,A,!1)):A()}}});Pt(this,Jc,t=>{j(this,ns).delete(t);const e=Array.from(j(this,ns).values());for(const[s,r]of j(this,Sn))e.includes(s)||(gn(r.effect),j(this,Sn).delete(s))});this.anchor=t,It(this,ba,e)}ensure(t,e){var s=Vt,r=rb();if(e&&!j(this,ys).has(t)&&!j(this,Sn).has(t))if(r){var i=document.createDocumentFragment(),o=Gr();i.append(o),j(this,Sn).set(t,{effect:On(()=>e(o)),fragment:i})}else j(this,ys).set(t,On(()=>e(this.anchor)));if(j(this,ns).set(s,t),r){for(const[A,a]of j(this,ys))A===t?s.skipped_effects.delete(a):s.skipped_effects.add(a);for(const[A,a]of j(this,Sn))A===t?s.skipped_effects.delete(a.effect):s.skipped_effects.add(a.effect);s.oncommit(j(this,ya)),s.ondiscard(j(this,Jc))}else j(this,ya).call(this)}}ns=new WeakMap,ys=new WeakMap,Sn=new WeakMap,bi=new WeakMap,ba=new WeakMap,ya=new WeakMap,Jc=new WeakMap;function Wa(n,t,e=!1){var s=new Sb(n),r=e?Di:0;function i(o,A){s.ensure(o,A)}Ou(()=>{var o=!1;t((A,a=!0)=>{o=!0,i(a,A)}),o||i(!1,null)},r)}function RL(n,t){return t}function HL(n,t,e){for(var s=[],r=t.length,i,o=t.length,A=0;A<r;A++){let u=t[A];Fi(u,()=>{if(i){if(i.pending.delete(u),i.done.add(u),i.pending.size===0){var d=n.outrogroups;Af(ku(i.done)),d.delete(i),d.size===0&&(n.outrogroups=null)}}else o-=1},!1)}if(o===0){var a=s.length===0&&e!==null;if(a){var l=e,c=l.parentNode;CL(c),c.append(l),n.items.clear()}Af(t,!a)}else i={pending:new Set(t),done:new Set},(n.outrogroups??(n.outrogroups=new Set)).add(i)}function Af(n,t=!0){for(var e=0;e<n.length;e++)gn(n[e],t)}var U0;function OL(n,t,e,s,r,i=null){var o=n,A=new Map;{var a=n;o=a.appendChild(Gr())}var l=null,c=YC(()=>{var g=e();return kC(g)?g:g==null?[]:ku(g)}),u,d=!0;function p(){m.fallback=l,VL(m,u,o,t,s),l!==null&&(u.length===0?(l.f&Dr)===0?Vp(l):(l.f^=Dr,xA(l,null,o)):Fi(l,()=>{l=null}))}var h=Ou(()=>{u=Z(c);for(var g=u.length,v=new Set,w=Vt,y=rb(),I=0;I<g;I+=1){var B=u[I],C=s(B,I),b=d?null:A.get(C);b?(b.v&&qo(b.v,B),b.i&&qo(b.i,I),y&&w.skipped_effects.delete(b.e)):(b=WL(A,d?o:U0??(U0=Gr()),B,C,I,r,t,e),d||(b.e.f|=Dr),A.set(C,b)),v.add(C)}if(g===0&&i&&!l&&(d?l=On(()=>i(o)):(l=On(()=>i(U0??(U0=Gr()))),l.f|=Dr)),!d)if(y){for(const[S,T]of A)v.has(S)||w.skipped_effects.add(T.e);w.oncommit(p),w.ondiscard(()=>{})}else p();Z(c)}),m={effect:h,items:A,outrogroups:null,fallback:l};d=!1}function VL(n,t,e,s,r){var S;var i=t.length,o=n.items,A=n.effect.first,a,l=null,c=[],u=[],d,p,h,m;for(m=0;m<i;m+=1){if(d=t[m],p=r(d,m),h=o.get(p).e,n.outrogroups!==null)for(const T of n.outrogroups)T.pending.delete(h),T.done.delete(h);if((h.f&Dr)!==0)if(h.f^=Dr,h===A)xA(h,null,e);else{var g=l?l.next:A;h===n.effect.last&&(n.effect.last=h.prev),h.prev&&(h.prev.next=h.next),h.next&&(h.next.prev=h.prev),Cr(n,l,h),Cr(n,h,g),xA(h,g,e),l=h,c=[],u=[],A=l.next;continue}if((h.f&Mn)!==0&&Vp(h),h!==A){if(a!==void 0&&a.has(h)){if(c.length<u.length){var v=u[0],w;l=v.prev;var y=c[0],I=c[c.length-1];for(w=0;w<c.length;w+=1)xA(c[w],v,e);for(w=0;w<u.length;w+=1)a.delete(u[w]);Cr(n,y.prev,I.next),Cr(n,l,y),Cr(n,I,v),A=v,l=I,m-=1,c=[],u=[]}else a.delete(h),xA(h,A,e),Cr(n,h.prev,h.next),Cr(n,h,l===null?n.effect.first:l.next),Cr(n,l,h),l=h;continue}for(c=[],u=[];A!==null&&A!==h;)(a??(a=new Set)).add(A),u.push(A),A=A.next;if(A===null)continue}(h.f&Dr)===0&&c.push(h),l=h,A=h.next}if(n.outrogroups!==null){for(const T of n.outrogroups)T.pending.size===0&&(Af(ku(T.done)),(S=n.outrogroups)==null||S.delete(T));n.outrogroups.size===0&&(n.outrogroups=null)}if(A!==null||a!==void 0){var B=[];if(a!==void 0)for(h of a)(h.f&Mn)===0&&B.push(h);for(;A!==null;)(A.f&Mn)===0&&A!==n.fallback&&B.push(A),A=A.next;var C=B.length;if(C>0){var b=i===0?e:null;HL(n,B,b)}}}function WL(n,t,e,s,r,i,o,A){var a=(o&WD)!==0?(o&KD)===0?vL(e,!1,!1):Ri(e):null,l=(o&GD)!==0?Ri(r):null;return{v:a,i:l,e:On(()=>(i(t,a??e,l??r,A),()=>{n.delete(s)}))}}function xA(n,t,e){if(n.nodes)for(var s=n.nodes.start,r=n.nodes.end,i=t&&(t.f&Dr)===0?t.nodes.start:e;s!==null;){var o=Ha(s);if(i.before(s),s===r)return;s=o}}function Cr(n,t,e){t===null?n.effect.first=e:t.next=e,e===null?n.effect.last=t:e.prev=t}function GL(n,t,...e){var s=new Sb(n);Ou(()=>{const r=t()??null;s.ensure(r,r&&(i=>r(i,...e)))},Di)}const P0=[...` 	
\r\f\v\uFEFF`];function KL(n,t,e){var s=n==null?"":""+n;if(t&&(s=s?s+" "+t:t),e){for(var r in e)if(e[r])s=s?s+" "+r:r;else if(s.length)for(var i=r.length,o=0;(o=s.indexOf(r,o))>=0;){var A=o+i;(o===0||P0.includes(s[o-1]))&&(A===s.length||P0.includes(s[A]))?s=(o===0?"":s.substring(0,o))+s.substring(A+1):o=A}}return s===""?null:s}function N0(n,t=!1){var e=t?" !important;":";",s="";for(var r in n){var i=n[r];i!=null&&i!==""&&(s+=" "+r+": "+i+e)}return s}function qL(n,t){if(t){var e="",s,r;return Array.isArray(t)?(s=t[0],r=t[1]):s=t,s&&(e+=N0(s)),r&&(e+=N0(r,!0)),e=e.trim(),e===""?null:e}return String(n)}function Eb(n,t,e,s,r,i){var o=n.__className;if(o!==e||o===void 0){var A=KL(e,s,i);A==null?n.removeAttribute("class"):n.className=A,n.__className=e}else if(i&&r!==i)for(var a in i){var l=!!i[a];(r==null||l!==!!r[a])&&n.classList.toggle(a,l)}return i}function Dd(n,t={},e,s){for(var r in e){var i=e[r];t[r]!==i&&(e[r]==null?n.style.removeProperty(r):n.style.setProperty(r,i,s))}}function zL(n,t,e,s){var r=n.__style;if(r!==t){var i=qL(t,s);i==null?n.removeAttribute("style"):n.style.cssText=i,n.__style=t}else s&&(Array.isArray(s)?(Dd(n,e==null?void 0:e[0],s[0]),Dd(n,e==null?void 0:e[1],s[1],"important")):Dd(n,e,s));return s}const $L=Symbol("is custom element"),XL=Symbol("is html");function Nt(n,t,e,s){var r=YL(n);r[t]!==(r[t]=e)&&(t==="loading"&&(n[QD]=e),e==null?n.removeAttribute(t):typeof e!="string"&&jL(n).includes(t)?n[t]=e:n.setAttribute(t,e))}function YL(n){return n.__attributes??(n.__attributes={[$L]:n.nodeName.includes("-"),[XL]:n.namespaceURI===JD})}var D0=new Map;function jL(n){var t=n.getAttribute("is")||n.nodeName,e=D0.get(t);if(e)return e;D0.set(t,e=[]);for(var s,r=n,i=Element.prototype;i!==r;){s=ED(r);for(var o in s)s[o].set&&e.push(o);r=RC(r)}return e}function L0(n,t){return n===t||(n==null?void 0:n[KA])===t}function oo(n={},t,e,s){return EL(()=>{var r,i;return Ab(()=>{r=i,i=[],Va(()=>{n!==e(...i)&&(t(n,...i),r&&L0(e(...r),n)&&t(null,...r))})}),()=>{Ra(()=>{i&&L0(e(...i),n)&&t(null,...i)})}}),n}let Ml=!1;function JL(n){var t=Ml;try{return Ml=!1,[n(),Ml]}finally{Ml=t}}function Pn(n,t,e,s){var w;var r=(e&$D)!==0,i=(e&XD)!==0,o=s,A=!0,a=()=>(A&&(A=!1,o=i?Va(s):s),o),l;if(r){var c=KA in n||MD in n;l=((w=Qo(n,t))==null?void 0:w.set)??(c&&t in n?y=>n[t]=y:void 0)}var u,d=!1;r?[u,d]=JL(()=>n[t]):u=n[t],u===void 0&&s!==void 0&&(u=a(),l&&(kD(),l(u)));var p;if(p=()=>{var y=n[t];return y===void 0?a():(A=!0,y)},(e&zD)===0)return p;if(l){var h=n.$$legacy;return(function(y,I){return arguments.length>0?((!I||h||d)&&l(I?p():y),y):p()})}var m=!1,g=((e&qD)!==0?Hu:YC)(()=>(m=!1,p()));r&&Z(g);var v=Gt;return(function(y,I){if(arguments.length>0){const B=I?Z(g):r?Tn(y):y;return St(g,B),m=!0,o!==void 0&&(o=B),y}return Ki&&m||(v.f&ir)!==0?g.v:Z(g)})}function Hs(n){ye===null&&kp(),Qn(()=>{const t=Va(n);if(typeof t=="function")return t})}function ei(n){ye===null&&kp(),Hs(()=>()=>Va(n))}const ZL="5";var cv;typeof window<"u"&&((cv=window.__svelte??(window.__svelte={})).v??(cv.v=new Set)).add(ZL);var t5=ti('<img alt="Pause" class="svelte-1sr4oe7"/>'),e5=ti('<img alt="Play" class="svelte-1sr4oe7"/>'),n5=ti('<div class="playback-controls svelte-1sr4oe7"><button class="toolbar-button svelte-1sr4oe7"><!></button> <button class="toolbar-button svelte-1sr4oe7" title="Stop"><img alt="Stop" class="svelte-1sr4oe7"/></button> <button><img alt="Loop" class="svelte-1sr4oe7"/></button> <div class="separator svelte-1sr4oe7"></div> <button class="toolbar-button svelte-1sr4oe7" title="Clear All Notes"><img alt="Clear" class="svelte-1sr4oe7"/></button> <div class="separator svelte-1sr4oe7"></div> <button class="toolbar-button svelte-1sr4oe7" title="Undo"><img alt="Undo" class="svelte-1sr4oe7"/></button> <button class="toolbar-button svelte-1sr4oe7" title="Redo"><img alt="Redo" class="svelte-1sr4oe7"/></button></div>');function s5(n,t){Me(t,!0);let e=Rt(Tn(f.state.isPlaying)),s=Rt(Tn(f.state.isPaused)),r=Rt(Tn(f.state.isLooping)),i=Rt(f.state.historyIndex>0),o=Rt(f.state.historyIndex<f.state.history.length-1);Qn(()=>{const D=q=>{q&&(St(e,q.isPlaying,!0),St(s,q.isPaused,!0))},R=q=>{q!==void 0&&St(r,q,!0)},N=()=>{St(i,f.state.historyIndex>0),St(o,f.state.historyIndex<f.state.history.length-1)};return f.on("playbackStateChanged",D),f.on("loopingChanged",R),f.on("historyChanged",N),N(),()=>{}});const A=fi(()=>vs("play.svg")),a=fi(()=>vs("pause.svg")),l=fi(()=>Z(e)&&!Z(s));function c(){Z(e)&&Z(s)?(f.setPlaybackState(!0,!1),Zs.resume()):Z(e)&&!Z(s)?(f.setPlaybackState(!0,!0),Zs.pause()):(f.setPlaybackState(!0,!1),Zs.start())}function u(){f.setPlaybackState(!1,!1),Zs.stop()}function d(){f.clearAllNotes(),TC(),MC()}function p(){f.setLooping(!Z(r))}function h(){f.undo()}function m(){f.redo()}var g=n5(),v=Fe(g);v.__click=c;var w=Fe(v);{var y=D=>{var R=t5();Ii(()=>Nt(R,"src",Z(a))),Un(D,R)},I=D=>{var R=e5();Ii(()=>Nt(R,"src",Z(A))),Un(D,R)};Wa(w,D=>{Z(l)?D(y):D(I,!1)})}var B=Ge(v,2);B.__click=u;var C=Fe(B),b=Ge(B,2);let S;b.__click=p;var T=Fe(b),x=Ge(b,4);x.__click=d;var _=Fe(x),F=Ge(x,4);F.__click=h;var Q=Fe(F),U=Ge(F,2);U.__click=m;var W=Fe(U);Ii((D,R,N,q,J)=>{Nt(v,"title",Z(l)?"Pause":"Play"),Nt(C,"src",D),S=Eb(b,1,"toolbar-button svelte-1sr4oe7",null,S,{active:Z(r)}),Nt(b,"title",Z(r)?"Disable Loop":"Enable Loop"),Nt(T,"src",R),Nt(_,"src",N),F.disabled=!Z(i),Nt(Q,"src",q),U.disabled=!Z(o),Nt(W,"src",J)},[()=>vs("stop.svg"),()=>vs("loop.svg"),()=>vs("clear.svg"),()=>vs("undo.svg"),()=>vs("redo.svg")]),Un(n,g),Qe()}Vu(["click"]);function r5(n,t){Me(t,!0);let e=f.state.isPlaying,s=f.state.isPaused,r=f.state.isLooping,i=f.state.historyIndex>0,o=f.state.historyIndex<f.state.history.length-1,A=null,a=null,l=null,c=null,u=null,d=null;function p(){e&&s?(f.setPlaybackState(!0,!1),Zs.resume()):e&&!s?(f.setPlaybackState(!0,!0),Zs.pause()):(f.setPlaybackState(!0,!1),Zs.start())}function h(){f.setPlaybackState(!1,!1),Zs.stop(),a==null||a.blur()}function m(){c==null||c.classList.add("flash"),setTimeout(()=>c==null?void 0:c.classList.remove("flash"),300),f.clearAllNotes(),TC(),MC(),c==null||c.blur()}function g(){f.setLooping(!r)}function v(){f.undo(),u==null||u.blur()}function w(){f.redo(),d==null||d.blur()}function y(){if(!A)return;const C=`<img src="${vs("play.svg")}" alt="Play">`,b=`<img src="${vs("pause.svg")}" alt="Pause">`;A.innerHTML=e&&!s?b:C}function I(){l&&l.classList.toggle("active",r)}function B(){u&&(u.disabled=!i),d&&(d.disabled=!o)}Hs(()=>{A=document.getElementById("play-button"),a=document.getElementById("stop-button"),l=document.getElementById("loop-button"),c=document.getElementById("clear-button"),u=document.getElementById("undo-button"),d=document.getElementById("redo-button"),A==null||A.addEventListener("click",p),a==null||a.addEventListener("click",h),l==null||l.addEventListener("click",g),c==null||c.addEventListener("click",m),u==null||u.addEventListener("click",v),d==null||d.addEventListener("click",w);const C=T=>{T&&(e=T.isPlaying,s=T.isPaused,y())},b=T=>{T!==void 0&&(r=T,I())},S=()=>{i=f.state.historyIndex>0,o=f.state.historyIndex<f.state.history.length-1,B()};f.on("playbackStateChanged",C),f.on("loopingChanged",b),f.on("historyChanged",S),y(),I(),B(),console.log("[Svelte] PlaybackControlsBridge mounted")}),ei(()=>{A==null||A.removeEventListener("click",p),a==null||a.removeEventListener("click",h),l==null||l.removeEventListener("click",g),c==null||c.removeEventListener("click",m),u==null||u.removeEventListener("click",v),d==null||d.removeEventListener("click",w),console.log("[Svelte] PlaybackControlsBridge unmounted")}),Qe()}function i5(n,t){Me(t,!0);let e=null,s=null,r=null,i=null;function o(){const h=new Date,m=h.toLocaleDateString("en-US",{month:"long"}),g=h.getDate();return`SN-score-${m}${g}.csv`}async function A(h){try{const m={suggestedName:o(),types:[{description:"Student Notation CSV File",accept:{"text/csv":[".csv"]}}]},v=await(await window.showSaveFilePicker(m)).createWritable();await v.write(h),await v.close()}catch(m){m.name!=="AbortError"&&E.error("FileActionsBridge","Error saving file with picker",m,"toolbar")}}function a(h){const m=document.createElement("a"),g=URL.createObjectURL(h);m.setAttribute("href",g),m.setAttribute("download",o()),document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(g)}function l(){return f.state.placedNotes.map(h=>[h.row,h.startColumnIndex,h.endColumnIndex,h.color,h.shape,h.tonicNumber||"",h.isDrum,h.drumTrack||""].join(",")).join(`
`)}async function c(){const h=l(),m=new Blob([h],{type:"text/csv;charset=utf-8;"});window.showSaveFilePicker?await A(m):a(m)}function u(){const h=document.createElement("input");h.type="file",h.accept=".csv,.txt",h.onchange=m=>{var y;const v=(y=m.target.files)==null?void 0:y[0];if(!v)return;const w=new FileReader;w.onload=I=>{var S;const B=(S=I.target)==null?void 0:S.result;if(!B){E.warn("FileActionsBridge","Imported file was empty",null,"toolbar");return}const C=new Set(["circle","oval","diamond"]),b=[];if(B.split(`
`).map(T=>T.trim()).filter(T=>T.length>0).forEach(T=>{const x=T.split(",");if(x.length<7){E.warn("FileActionsBridge","Skipping invalid note row",{line:T},"toolbar");return}const _=Number.parseInt(x[0]??"",10),F=Number.parseInt(x[1]??"",10),Q=Number.parseInt(x[2]??"",10),U=(x[3]??"").trim(),W=(x[4]??"").trim().toLowerCase(),D=x[5]?Number.parseInt(x[5],10):null,R=(x[6]??"").trim().toLowerCase()==="true",N=x[7]?Number.parseInt(x[7],10):null,q=typeof N=="number"&&Number.isFinite(N)?N:void 0;if(!U){E.warn("FileActionsBridge","Skipping note with missing color",{line:T},"toolbar");return}if(!Number.isFinite(_)||!Number.isFinite(F)||!Number.isFinite(Q)){E.warn("FileActionsBridge","Skipping note with invalid coordinates",{line:T},"toolbar");return}const J=C.has(W)?W:"circle";C.has(W)||E.warn("FileActionsBridge",`Unknown shape "${W}", defaulting to circle`,null,"toolbar"),b.push({row:_,startColumnIndex:F,endColumnIndex:Q,color:U,shape:J,tonicNumber:D,isDrum:R,drumTrack:q})}),b.length===0){E.warn("FileActionsBridge","No valid notes found in imported file",null,"toolbar");return}f.loadNotes(b)},w.readAsText(v)},h.click()}function d(){document.body.classList.remove("sidebar-open"),f.emit("printPreviewStateChanged",!0)}function p(){window.confirm("Are you sure you want to reset the canvas? This will clear all your work and cannot be undone.")&&f.clearSavedState()}Hs(()=>{e=document.getElementById("save-as-button"),s=document.getElementById("import-button"),r=document.getElementById("print-button"),i=document.getElementById("reset-canvas-button"),e==null||e.addEventListener("click",()=>void c()),s==null||s.addEventListener("click",u),r==null||r.addEventListener("click",d),i==null||i.addEventListener("click",p),console.log("[Svelte] FileActionsBridge mounted")}),ei(()=>{e==null||e.removeEventListener("click",()=>void c()),s==null||s.removeEventListener("click",u),r==null||r.removeEventListener("click",d),i==null||i.removeEventListener("click",p),console.log("[Svelte] FileActionsBridge unmounted")}),Qe()}function o5(n,t){Me(t,!0);let e=null,s=null,r=null,i=null;function o(){const u=document.querySelector('.tab-button[data-tab="pitch"]'),d=document.querySelector('.pitch-tab-button[data-pitch-tab="range"]');u==null||u.click(),d==null||d.click()}function A(){o(),f.emit("zoomIn",{source:"button"}),e==null||e.blur()}function a(){o(),f.emit("zoomOut",{source:"button"}),s==null||s.blur()}function l(){f.increaseMacrobeatCount()}function c(){f.decreaseMacrobeatCount()}Hs(()=>{e=document.getElementById("grid-zoom-in"),s=document.getElementById("grid-zoom-out"),r=document.getElementById("macrobeat-increase"),i=document.getElementById("macrobeat-decrease"),e==null||e.addEventListener("click",A),s==null||s.addEventListener("click",a),r==null||r.addEventListener("click",l),i==null||i.addEventListener("click",c),console.log("[Svelte] GridControlsBridge mounted")}),ei(()=>{e==null||e.removeEventListener("click",A),s==null||s.removeEventListener("click",a),r==null||r.removeEventListener("click",l),i==null||i.removeEventListener("click",c),console.log("[Svelte] GridControlsBridge unmounted")}),Qe()}function A5(n,t){Me(t,!0);let e=null,s=null,r=null,i=null;function o(){i===Fn.COMPRESSION_2_3?(i=null,e==null||e.classList.remove("active"),f.setSelectedTool("note"),E.info("ModulationBridge","2:3 modulation tool deactivated",null,"ui")):(i=Fn.COMPRESSION_2_3,e==null||e.classList.add("active"),s==null||s.classList.remove("active"),f.setSelectedTool("modulation"),f.state.selectedModulationRatio=i,E.info("ModulationBridge","2:3 modulation tool activated",null,"ui"))}function A(){i===Fn.EXPANSION_3_2?(i=null,s==null||s.classList.remove("active"),f.setSelectedTool("note"),E.info("ModulationBridge","3:2 modulation tool deactivated",null,"ui")):(i=Fn.EXPANSION_3_2,s==null||s.classList.add("active"),e==null||e.classList.remove("active"),f.setSelectedTool("modulation"),f.state.selectedModulationRatio=i,E.info("ModulationBridge","3:2 modulation tool activated",null,"ui"))}function a(){const d=(f.state.tempoModulationMarkers||[]).length;if(d===0){E.info("ModulationBridge","No modulation markers to clear",null,"ui");return}f.clearModulationMarkers(),E.info("ModulationBridge",`Cleared ${d} modulation markers`,null,"ui")}function l(){if(!r)return;const d=(f.state.tempoModulationMarkers||[]).length;d===0?(r.disabled=!0,r.style.opacity="0.5"):(r.disabled=!1,r.style.opacity="1"),r.textContent=d>0?`Clear (${d})`:"Clear"}function c(d){const p=d;(typeof p=="string"?p:p.newTool||p)!=="modulation"&&(i=null,e==null||e.classList.remove("active"),s==null||s.classList.remove("active"))}function u(){l()}Hs(()=>{if(e=document.getElementById("modulation-2-3-btn"),s=document.getElementById("modulation-3-2-btn"),r=document.getElementById("modulation-clear-btn"),!e||!s||!r){E.warn("ModulationBridge","Modulation control buttons not found in DOM",null,"ui");return}e.addEventListener("click",o),s.addEventListener("click",A),r.addEventListener("click",a),f.on("toolChanged",c),f.on("tempoModulationMarkersChanged",u),l(),E.info("ModulationBridge","Modulation controls initialized",null,"ui"),console.log("[Svelte] ModulationBridge mounted")}),ei(()=>{e==null||e.removeEventListener("click",o),s==null||s.removeEventListener("click",A),r==null||r.removeEventListener("click",a),console.log("[Svelte] ModulationBridge unmounted")}),Qe()}const a5=1,l5="mlt-handoff",c5=1,Vc="handoff-slots",u5="mlt-handoff-slot";function xb(){return new Promise((n,t)=>{const e=indexedDB.open(l5,c5);e.onerror=()=>{t(new Error("Failed to open IndexedDB"))},e.onsuccess=()=>{n(e.result)},e.onupgradeneeded=s=>{const r=s.target.result;r.objectStoreNames.contains(Vc)||r.createObjectStore(Vc,{keyPath:"handoffId"})}})}async function d5(){if(typeof indexedDB>"u")return!1;try{return(await xb()).close(),!0}catch{return!1}}function h5(){const n=Date.now().toString(36),t=Math.random().toString(36).substring(2,10);return`handoff-${n}-${t}`}async function f5(n){const t=await xb();return new Promise((e,s)=>{const r=t.transaction(Vc,"readwrite"),i=r.objectStore(Vc),o=i.clear();o.onsuccess=()=>{const A=i.add(n);A.onsuccess=()=>{e()},A.onerror=()=>{s(new Error("Failed to write to IndexedDB"))}},o.onerror=()=>{s(new Error("Failed to clear IndexedDB"))},r.oncomplete=()=>{t.close()}})}function k0(n){try{const t=JSON.stringify(n);localStorage.setItem(u5,t)}catch(t){throw new Error(`Failed to write to localStorage: ${t}`)}}async function p5(n){const t=h5(),e={snapshot:n,writtenAt:Date.now(),handoffId:t};if(await d5())try{return await f5(e),t}catch{return k0(e),t}else return k0(e),t}function m5(n,t){const e=n.endMicrobeatCol<t.startMicrobeatCol,s=t.endMicrobeatCol<n.startMicrobeatCol;return!e&&!s}function g5(n,t){const e=Math.max(n.startMicrobeatCol,t.startMicrobeatCol),s=Math.min(n.endMicrobeatCol,t.endMicrobeatCol);if(e>s)return[];const r=[];for(let i=e;i<=s;i++)r.push(i);return r}function v5(n){const t=[],e=n.notes;for(let s=0;s<e.length;s++)for(let r=s+1;r<e.length;r++){const i=e[s],o=e[r];if(m5(i,o)){const A=g5(i,o);t.push({voiceId:n.voiceId,color:n.color,conflictColumns:A,note1:{startMicrobeatCol:i.startMicrobeatCol,endMicrobeatCol:i.endMicrobeatCol,midiPitch:i.midiPitch},note2:{startMicrobeatCol:o.startMicrobeatCol,endMicrobeatCol:o.endMicrobeatCol,midiPitch:o.midiPitch}})}}return t}function w5(n){const t=`Note 1: cols ${n.note1.startMicrobeatCol}-${n.note1.endMicrobeatCol}, MIDI ${n.note1.midiPitch}`,e=`Note 2: cols ${n.note2.startMicrobeatCol}-${n.note2.endMicrobeatCol}, MIDI ${n.note2.midiPitch}`,s=n.conflictColumns.length===1?`column ${n.conflictColumns[0]}`:`columns ${n.conflictColumns[0]}-${n.conflictColumns[n.conflictColumns.length-1]}`;return`Voice "${n.voiceId}" (${n.color}): Overlap at ${s}
  ${t}
  ${e}`}function B5(n){const t=[],e=[];if(n.schemaVersion!==1&&e.push(`Unsupported schema version: ${n.schemaVersion}. Expected: 1`),n.timeGrid||e.push("Missing required field: timeGrid"),(!n.voices||!Array.isArray(n.voices))&&e.push("Missing or invalid field: voices"),n.clefPitchRange){const{minMidi:s,maxMidi:r}=n.clefPitchRange;!Number.isFinite(s)||!Number.isFinite(r)?e.push("Invalid clefPitchRange: MIDI values must be finite numbers"):s>r&&e.push("Invalid clefPitchRange: minMidi exceeds maxMidi")}if(n.voices)for(const s of n.voices){const r=v5(s);t.push(...r)}for(const s of t)e.push(w5(s));return{isValid:t.length===0&&e.length===0,conflicts:t,errorMessages:e}}function C5(n){const t=B5(n);if(t.isValid)return{isValid:!0,summary:"Validation passed. Ready to export to Singing Trainer.",details:t};const e=new Set(t.conflicts.map(r=>r.voiceId));return{isValid:!1,summary:`Cannot export: ${t.conflicts.length} overlap(s) found in ${e.size} voice(s).`,details:t}}function b5(n){return n.reduce((t,e)=>t+e,0)}function y5(n){if(n.length===0)return 2;const t=n.filter(s=>s===2).length;return n.filter(s=>s===3).length>t?3:2}function S5(n,t,e){const s=e.topIndex+n;if(s<0||s>=t.length)return-1;const r=t[s];return(r==null?void 0:r.midi)??-1}function E5(n,t,e){const s=e.topIndex+n;if(s<0||s>=t.length)return"Unknown";const r=t[s];return(r==null?void 0:r.toneNote)??"Unknown"}function x5(n,t){const e=n[t.topIndex],s=n[t.bottomIndex],r=e==null?void 0:e.midi,i=s==null?void 0:s.midi;return typeof r!="number"||typeof i!="number"?null:{minMidi:Math.min(r,i),maxMidi:Math.max(r,i)}}function I5(n,t,e={}){const s=n.placedNotes.filter(d=>!d.isDrum),r=new Map;for(const d of s){const p=d.color;r.has(p)||r.set(p,[]),r.get(p).push(d)}const i=[];let o=1/0,A=-1/0;for(const[d,p]of r){const h=[];for(const m of p){const g=S5(m.row,n.fullRowData,n.pitchRange),v=E5(m.row,n.fullRowData,n.pitchRange);g>0&&(o=Math.min(o,g),A=Math.max(A,g)),h.push({startMicrobeatCol:m.startColumnIndex,endMicrobeatCol:m.endColumnIndex,midiPitch:g,pitchName:v,shape:m.shape})}h.sort((m,g)=>m.startMicrobeatCol-g.startMicrobeatCol),i.push({voiceId:d,color:d,notes:h})}const a={microbeatCount:b5(n.macrobeatGroupings),microbeatsPerMacrobeat:y5(n.macrobeatGroupings),macrobeatGroupings:[...n.macrobeatGroupings],macrobeatBoundaryStyles:[...n.macrobeatBoundaryStyles]},l=[];if(n.annotations&&Array.isArray(n.annotations))for(const d of n.annotations)l.push({type:"freehand",id:d.id??`overlay-${Date.now()}`,data:d,coordinateSystem:"pixel"});const c=e.includeClefPitchRange===!1?null:x5(n.fullRowData,n.pitchRange),u={schemaVersion:a5,createdAt:Date.now(),sourceFileId:t,sourceApp:"student-notation",timeGrid:a,voices:i,tempo:n.tempo,minMidiPitch:o===1/0?void 0:o,maxMidiPitch:A===-1/0?void 0:A};return c&&(u.clefPitchRange=c),e.preferredPitchRangeSource&&(u.preferredPitchRangeSource=e.preferredPitchRangeSource),l.length>0&&(u.visualOverlays=l),e.tonalCenter&&(u.tonalCenter=e.tonalCenter),u}function F5(n){switch(n){case"student-notation":return"/student-notation/";case"singing-trainer":return"/singing-trainer/";default:throw new Error(`Unknown app: ${n}`)}}function T5(n,t){let e=F5(n);if(t&&Object.keys(t).length>0){const s=new URLSearchParams(t);e+=`?${s.toString()}`}window.location.href=e}function _5(n){const t={};n&&(t.handoff=n),t.from="student-notation",T5("singing-trainer",t)}function M5(n,t){Me(t,!0);let e=null,s=null,r=null,i=null,o=null,A=null,a=null,l=null,c=null,u=null,d=null,p=null,h=null,m=null,g=null,v=null,w=null,y=null,I=null,B=null,C=null,b=null,S=!0,T=!0,x=!0,_=!0;const F="app.volumeSliderValue";function Q($){return Math.min(100,Math.max(0,$))}function U(){try{const $=window.localStorage.getItem(F);if($!==null){const rt=Number($);if(!Number.isNaN(rt))return Q(rt)}}catch{}return 70}function W($){try{window.localStorage.setItem(F,String(Q($)))}catch{}}function D(){document.body.classList.toggle("sidebar-open")}function R($){if($.stopPropagation(),!o||!i)return;const rt=o.classList.toggle("visible");i.classList.toggle("active",rt)}function N(){const $=parseInt(this.value,10),rt=$===0?-1/0:$/100*37.5-50;f.emit("volumeChanged",rt),W($)}function q($){!o||!i||!o.contains($.target)&&$.target!==i&&(o.classList.remove("visible"),i.classList.remove("active"))}function J(){f.setAnacrusis(!0)}function nt(){f.setAnacrusis(!1)}function At($){const rt=$;a==null||a.classList.toggle("active",rt),l==null||l.classList.toggle("active",!rt)}function ot(){f.setLongNoteStyle("style1")}function V(){f.setLongNoteStyle("style2")}function H($){const rt=$;c==null||c.classList.toggle("active",rt==="style1"),u==null||u.classList.toggle("active",rt==="style2")}function G(){f.setPlayheadMode("cursor")}function Y(){f.setPlayheadMode("microbeat")}function P(){f.setPlayheadMode("macrobeat")}function st($){const rt=$==="macrobeat"?"macrobeat":$==="microbeat"?"microbeat":"cursor";d==null||d.classList.toggle("active",rt==="cursor"),p==null||p.classList.toggle("active",rt==="microbeat"),h==null||h.classList.toggle("active",rt==="macrobeat")}function L(){S=!S,g&&(g.style.display=S?"flex":"none");const $=m==null?void 0:m.querySelector(".sidebar-button-text");$&&($.textContent=S?"Hide Drum Grid":"Show Drum Grid"),setTimeout(()=>fe.recalculateLayout(),10)}function K(){T=!T,w&&(w.style.display=T?"flex":"none");const $=v==null?void 0:v.querySelector(".sidebar-button-text");$&&($.textContent=T?"Hide Button Grid":"Show Button Grid"),setTimeout(()=>fe.recalculateLayout(),10)}function O(){x=!x,I&&(I.style.display=x?"block":"none"),y&&(y.textContent=x?"Hide Left Legend":"Show Left Legend"),setTimeout(()=>fe.recalculateLayout(),10)}function X(){_=!_,C&&(C.style.display=_?"block":"none"),B&&(B.textContent=_?"Hide Right Legend":"Show Right Legend"),setTimeout(()=>fe.recalculateLayout(),10)}function tt($,rt,et=[]){const it=document.getElementById("notification-overlay"),at=it==null?void 0:it.querySelector(".notification-message"),Ct=it==null?void 0:it.querySelector(".notification-title");if(!it||!at){alert(`${$}

${rt}${et.length>0?`

`+et.join(`
`):""}`);return}Ct&&(Ct.textContent=$);const yt=et.length>0?`<ul style="text-align: left; margin-top: 8px; padding-left: 20px;">${et.map(ct=>`<li style="margin-bottom: 4px;">${ct.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</li>`).join("")}</ul>`:"";at.innerHTML=`<p>${rt.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</p>${yt}`,it.classList.add("visible");const Bt=it.querySelector(".notification-close"),Et=it.querySelector(".notification-button"),Qt=()=>{it.classList.remove("visible"),Bt==null||Bt.removeEventListener("click",Qt),Et==null||Et.removeEventListener("click",Qt)};Bt==null||Bt.addEventListener("click",Qt),Et==null||Et.addEventListener("click",Qt)}function k(){return f.state.placedNotes.some($=>!$.isDrum)}async function z(){if(console.log("[Svelte] Take to Singing Trainer clicked"),!k()){tt("Cannot Export","No notes to export. Add some pitch notes to the grid before exporting to Singing Trainer.");return}const $={placedNotes:f.state.placedNotes,macrobeatGroupings:f.state.macrobeatGroupings,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles,fullRowData:f.state.fullRowData,pitchRange:f.state.pitchRange,tempo:f.state.tempo,annotations:f.state.annotations},rt=I5($),et=C5(rt);if(!et.isValid){console.warn("[Svelte] Handoff validation failed",et.details);const it=[];for(const at of et.details.conflicts){const Ct=at.conflictColumns.length===1?`column ${at.conflictColumns[0]}`:`columns ${at.conflictColumns[0]}-${at.conflictColumns[at.conflictColumns.length-1]}`;it.push(`Voice "${at.color}": Overlap at ${Ct}`)}tt("Cannot Export to Singing Trainer",et.summary,it);return}try{const it=await p5(rt);console.log("[Svelte] Handoff slot written",it),_5(it)}catch(it){console.error("[Svelte] Failed to write handoff slot",it),tt("Export Failed","An error occurred while preparing the handoff. Please try again.")}}Hs(()=>{if(e=document.getElementById("settings-button"),s=document.getElementById("sidebar"),r=document.getElementById("sidebar-overlay"),i=document.getElementById("volume-icon-button"),o=document.getElementById("volume-popup"),A=document.getElementById("vertical-volume-slider"),a=document.getElementById("anacrusis-on-btn"),l=document.getElementById("anacrusis-off-btn"),c=document.getElementById("long-note-style1-btn"),u=document.getElementById("long-note-style2-btn"),d=document.getElementById("playhead-mode-cursor-btn"),p=document.getElementById("playhead-mode-microbeat-btn"),h=document.getElementById("playhead-mode-macrobeat-btn"),m=document.getElementById("hide-drumgrid-toggle"),g=document.getElementById("drum-grid-wrapper"),v=document.getElementById("hide-buttongrid-toggle"),w=document.getElementById("button-grid"),y=document.getElementById("hide-leftlegend-toggle"),I=document.getElementById("legend-left-canvas"),B=document.getElementById("hide-rightlegend-toggle"),C=document.getElementById("legend-right-canvas"),b=document.getElementById("take-to-singing-trainer-button"),e&&s&&r&&(e.addEventListener("click",D),r.addEventListener("click",D)),i&&o&&A){const $=U();A.value=String($),i.addEventListener("click",R),A.addEventListener("input",N),document.addEventListener("click",q),A.dispatchEvent(new Event("input"))}if(a&&l&&(a.addEventListener("click",J),l.addEventListener("click",nt),f.on("anacrusisChanged",At),a.classList.toggle("active",f.state.hasAnacrusis),l.classList.toggle("active",!f.state.hasAnacrusis)),c&&u){c.addEventListener("click",ot),u.addEventListener("click",V),f.on("longNoteStyleChanged",H);const $=f.state.longNoteStyle||"style1";c.classList.toggle("active",$==="style1"),u.classList.toggle("active",$==="style2")}if(d&&p&&h){d.addEventListener("click",G),p.addEventListener("click",Y),h.addEventListener("click",P),f.on("playheadModeChanged",st);const $=f.state.playheadMode||"cursor";d.classList.toggle("active",$==="cursor"),p.classList.toggle("active",$==="microbeat"),h.classList.toggle("active",$==="macrobeat")}m&&g&&m.addEventListener("click",L),v&&w&&v.addEventListener("click",K),y&&I&&y.addEventListener("click",O),B&&C&&B.addEventListener("click",X),b&&b.addEventListener("click",()=>{z()}),console.log("[Svelte] SidebarBridge mounted")}),ei(()=>{e==null||e.removeEventListener("click",D),r==null||r.removeEventListener("click",D),i==null||i.removeEventListener("click",R),A==null||A.removeEventListener("input",N),document.removeEventListener("click",q),a==null||a.removeEventListener("click",J),l==null||l.removeEventListener("click",nt),c==null||c.removeEventListener("click",ot),u==null||u.removeEventListener("click",V),d==null||d.removeEventListener("click",G),p==null||p.removeEventListener("click",Y),h==null||h.removeEventListener("click",P),m==null||m.removeEventListener("click",L),v==null||v.removeEventListener("click",K),y==null||y.removeEventListener("click",O),B==null||B.removeEventListener("click",X),console.log("[Svelte] SidebarBridge unmounted")}),Qe()}const Wu={selectedSixteenthStampId:1,updateSixteenthStampColors:n=>{},init(){this.render(),this.bindEvents(),E.info("SixteenthStampsToolbar","Sixteenth stamps toolbar initialized",null,"stamps")},render(){const n=document.getElementById("sixteenth-stamps-toolbar-container");if(!n){E.warn("SixteenthStampsToolbar","Container not found",null,"stamps");return}n.innerHTML="";const t=document.createElement("div");t.className="sixteenth-stamps-grid",[[1,2,3,4],[5,8,14,6,9,7],[10,13,12,11,15]].forEach((s,r)=>{const i=document.createElement("div");i.className=`sixteenth-stamps-row sixteenth-stamps-row-${r+1}`,s.forEach(o=>{const A=mh.find(a=>a.id===o);if(A){const a=this.createSixteenthStampButton(A);i.appendChild(a)}}),t.appendChild(i)}),n.appendChild(t),this.setInitialSelection(this.selectedSixteenthStampId)},createSixteenthStampButton(n){const t=document.createElement("button");t.className="sixteenth-stamp-button",t.dataset.sixteenthStampId=`${n.id}`,t.setAttribute("title",`${n.id}: ${n.label}`);const e=this.createSixteenthStampPreview(n);return t.appendChild(e),t},createSixteenthStampPreview(n){const t=Cp.renderToSVG(n,100,100);return t.setAttribute("width","40"),t.setAttribute("height","40"),t},bindEvents(){const n=document.getElementById("sixteenth-stamps-toolbar-container");if(!n)return;n.addEventListener("click",e=>{var r;const s=(r=e.target)==null?void 0:r.closest(".sixteenth-stamp-button");if(s){const i=parseInt(s.dataset.sixteenthStampId||"",10);Number.isNaN(i)||this.selectSixteenthStamp(i)}}),this.updateSixteenthStampColors=e=>{if(!e||!n)return;const s=(l,c=50)=>{const u=parseInt(l.slice(1,3),16),d=parseInt(l.slice(3,5),16),p=parseInt(l.slice(5,7),16),h=Math.min(255,Math.floor(u+(255-u)*(c/100))),m=Math.min(255,Math.floor(d+(255-d)*(c/100))),g=Math.min(255,Math.floor(p+(255-p)*(c/100)));return`#${h.toString(16).padStart(2,"0")}${m.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}`},r=(l,c=20)=>{const u=parseInt(l.slice(1,3),16),d=parseInt(l.slice(3,5),16),p=parseInt(l.slice(5,7),16),h=Math.max(0,Math.floor(u*(1-c/100))),m=Math.max(0,Math.floor(d*(1-c/100))),g=Math.max(0,Math.floor(p*(1-c/100)));return`#${h.toString(16).padStart(2,"0")}${m.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}`},i=f.state.colorPalette[e]||{primary:e,light:e},o=s(i.light,60),A=i.primary,a=r(A,20);n.style.setProperty("--c-accent",A),n.style.setProperty("--c-accent-light",o),n.style.setProperty("--c-accent-hover",a)},f.on("noteChanged",({newNote:e}={})=>{e!=null&&e.color&&this.updateSixteenthStampColors(e.color)});const t=f.state.selectedNote;t!=null&&t.color&&this.updateSixteenthStampColors(t.color),f.on("toolChanged",({newTool:e}={})=>{e&&e!=="sixteenthStamp"&&this.clearSelection()}),f.on("tripletStampToolSelected",()=>{this.clearSelection()})},setInitialSelection(n){this.selectedSixteenthStampId=n;const t=document.getElementById("sixteenth-stamps-toolbar-container");t&&t.querySelectorAll(".sixteenth-stamp-button").forEach(e=>{const s=e;s.classList.toggle("active",parseInt(s.dataset.sixteenthStampId||"",10)===n)})},selectSixteenthStamp(n){this.selectedSixteenthStampId=n;const t=document.getElementById("sixteenth-stamps-toolbar-container");t&&t.querySelectorAll(".sixteenth-stamp-button").forEach(e=>{const s=e;s.classList.toggle("active",parseInt(s.dataset.sixteenthStampId||"",10)===n)}),f.setSelectedTool("sixteenthStamp"),f.emit("sixteenthStampSelected",n),f.emit("sixteenthStampToolSelected")},clearSelection(){const n=document.getElementById("sixteenth-stamps-toolbar-container");n&&n.querySelectorAll(".sixteenth-stamp-button").forEach(t=>{t.classList.remove("active")})},getSelectedSixteenthStamp(){return mh.find(t=>t.id===this.selectedSixteenthStampId)}};class Q5{constructor(){M(this,"overlay");M(this,"modal");M(this,"title");M(this,"message");M(this,"actionsContainer");M(this,"closeButton");var t,e,s,r,i;this.overlay=document.getElementById("notification-overlay"),this.modal=(t=this.overlay)==null?void 0:t.querySelector(".notification-modal"),this.title=(e=this.overlay)==null?void 0:e.querySelector(".notification-title"),this.message=(s=this.overlay)==null?void 0:s.querySelector(".notification-message"),this.actionsContainer=(r=this.overlay)==null?void 0:r.querySelector(".notification-actions"),this.closeButton=(i=this.overlay)==null?void 0:i.querySelector(".notification-close"),this.setupEventListeners()}setupEventListeners(){var t;this.overlay&&((t=this.closeButton)==null||t.addEventListener("click",()=>this.hide()),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.hide()}),document.addEventListener("keydown",e=>{var s;e.key==="Escape"&&((s=this.overlay)!=null&&s.classList.contains("visible"))&&this.hide()}))}show(t={}){const e=this.overlay;if(!e)return;const{title:s="Notice",message:r="",buttons:i=[{text:"OK",primary:!0,action:()=>this.hide()}]}=t;this.title&&(this.title.textContent=s),this.message&&(this.message.textContent=r);const o=this.actionsContainer;o&&(o.innerHTML="",i.forEach(A=>{const a=document.createElement("button");a.className=`notification-button ${A.primary?"":"secondary"}`,a.textContent=A.text,a.addEventListener("click",()=>{A.action?A.action():this.hide()}),o.appendChild(a)})),e.classList.add("visible"),setTimeout(()=>{var a;const A=(a=this.actionsContainer)==null?void 0:a.querySelector(".notification-button");A==null||A.focus()},100)}hide(){this.overlay&&this.overlay.classList.remove("visible")}alert(t,e="Notice"){this.show({title:e,message:t,buttons:[{text:"OK",primary:!0,action:()=>this.hide()}]})}confirm(t,e="Confirm"){return new Promise(s=>{this.show({title:e,message:t,buttons:[{text:"Cancel",primary:!1,action:()=>{this.hide(),s(!1)}},{text:"OK",primary:!0,action:()=>{this.hide(),s(!0)}}]})})}}const R0=new Q5,af=40,U5=af;class H0{constructor(t,e,s,r,i){M(this,"element");M(this,"viewportEl");M(this,"optionsEl");M(this,"onChange");M(this,"onBeforeChange");M(this,"options");M(this,"optionNodes",[]);M(this,"selectedIndex",0);M(this,"pointerActive",!1);M(this,"pointerId",null);M(this,"lastPointerY",0);M(this,"deltaBuffer",0);M(this,"optionHeight",af);M(this,"resizeObserver",null);this.element=t,this.viewportEl=t==null?void 0:t.querySelector(".clef-wheel-viewport"),this.optionsEl=t==null?void 0:t.querySelector(".clef-wheel-options"),this.onChange=r,this.onBeforeChange=i||null,this.options=e,!(!t||!this.viewportEl||!this.optionsEl)&&(this.renderOptions(),this.setIndex(s,{silent:!0}),this.attachEvents(),this.observeSize())}renderOptions(){const t=this.optionsEl;t&&(t.innerHTML="",this.optionNodes=this.options.map((e,s)=>{const r=document.createElement("div");return r.className="clef-wheel-option",r.dataset.index=s.toString(),r.textContent=e.label,t.appendChild(r),r}))}attachEvents(){if(!this.element)return;this.element.addEventListener("wheel",e=>{e.preventDefault(),e.stopPropagation();const s=Math.sign(e.deltaY);s!==0&&this.increment(s)},{passive:!1}),this.element.addEventListener("keydown",e=>{e.key==="ArrowUp"?(e.preventDefault(),this.increment(-1)):e.key==="ArrowDown"?(e.preventDefault(),this.increment(1)):e.key==="Home"?(e.preventDefault(),this.setIndex(0)):e.key==="End"&&(e.preventDefault(),this.setIndex(this.options.length-1))}),this.element.addEventListener("pointerdown",e=>{var s;if(this.pointerActive=!0,this.pointerId=e.pointerId,this.lastPointerY=e.clientY,this.deltaBuffer=0,typeof((s=this.element)==null?void 0:s.setPointerCapture)=="function")try{this.element.setPointerCapture(this.pointerId)}catch{}}),this.element.addEventListener("pointermove",e=>{if(!this.pointerActive||e.pointerId!==this.pointerId)return;const s=e.clientY-this.lastPointerY;if(this.lastPointerY=e.clientY,s===0)return;this.deltaBuffer+=s;const r=this.optionHeight||U5;for(;Math.abs(this.deltaBuffer)>=r;){const i=-Math.sign(this.deltaBuffer);this.increment(i),this.deltaBuffer-=Math.sign(this.deltaBuffer)*r}});const t=e=>{var s,r;this.pointerActive&&e.pointerId===this.pointerId&&(this.pointerActive=!1,this.pointerId=null,this.deltaBuffer=0,(r=(s=this.element)==null?void 0:s.hasPointerCapture)!=null&&r.call(s,e.pointerId)&&this.element.releasePointerCapture(e.pointerId))};this.element.addEventListener("pointerup",t),this.element.addEventListener("pointercancel",t),this.element.addEventListener("pointerleave",t)}observeSize(){this.element&&(typeof ResizeObserver=="function"?(this.resizeObserver=new ResizeObserver(t=>{for(const e of t)e.target===this.element&&e.contentRect.height>0&&this.updateVisuals()}),this.resizeObserver.observe(this.element)):window.addEventListener("resize",()=>this.updateVisuals()))}getIndex(){return this.selectedIndex}increment(t){t===0||!this.options||this.options.length===0||this.setIndex(this.selectedIndex+t)}setIndex(t,{silent:e=!1}={}){if(!this.optionsEl)return;let s=t;!e&&typeof this.onBeforeChange=="function"&&(s=this.onBeforeChange(t));const r=Math.max(0,Math.min(this.options.length-1,s));if(r===this.selectedIndex){this.updateVisuals();return}if(this.selectedIndex=r,this.updateVisuals(),!e&&typeof this.onChange=="function"){const i=this.options[r];i&&this.onChange(r,i)}}updateVisuals(){var a,l,c;if(!this.optionsEl||!this.viewportEl)return;const t=this.viewportEl.clientHeight||0,e=(a=this.optionNodes)==null?void 0:a[this.selectedIndex],s=(l=this.optionNodes)==null?void 0:l[0],r=(e==null?void 0:e.offsetHeight)||(s==null?void 0:s.offsetHeight)||af;if(this.optionHeight=r,(c=this.optionNodes)==null||c.forEach((u,d)=>{const p=Math.abs(d-this.selectedIndex);u.dataset.distance=String(Math.min(p,3))}),t===0||r===0)return;const i=Math.max(0,(t-r)/2);this.optionsEl.style.paddingTop=`${i}px`,this.optionsEl.style.paddingBottom=`${i}px`;const o=e?e.offsetTop+r/2:i+r/2,A=t/2-o;this.optionsEl.style.transform=`translateY(${A}px)`}}class P5{constructor(){M(this,"initialized",!1);M(this,"topPicker",null);M(this,"bottomPicker",null);M(this,"topWheel",null);M(this,"bottomWheel",null);M(this,"rangeLabel",null);M(this,"rangeCount",null);M(this,"fullRangeButton",null);M(this,"trebleButton",null);M(this,"altoButton",null);M(this,"bassButton",null);M(this,"presetContainer",null);M(this,"presetButtons",[]);M(this,"activePresetId",null);M(this,"masterOptions",[]);M(this,"presetRanges",{});M(this,"constrainTopIndex",t=>{if(!this.bottomPicker)return t;const e=this.bottomPicker.getIndex(),s=this.masterOptions.length;return C_(e,t,s,oe)});M(this,"constrainBottomIndex",t=>{if(!this.topPicker)return t;const e=this.topPicker.getIndex(),s=this.masterOptions.length;return b_(e,t,s,oe)})}init(){if(this.initialized)return;if(this.topWheel=document.getElementById("clef-top-wheel"),this.bottomWheel=document.getElementById("clef-bottom-wheel"),this.rangeLabel=document.getElementById("clef-range-label"),this.rangeCount=document.getElementById("clef-range-count"),this.fullRangeButton=document.getElementById("clef-full-range-button"),this.trebleButton=document.getElementById("clef-treble-button"),this.altoButton=document.getElementById("clef-alto-button"),this.bassButton=document.getElementById("clef-bass-button"),this.presetContainer=document.querySelector(".clef-preset-buttons"),this.presetButtons=Array.from(document.querySelectorAll(".clef-preset-button")),!this.topWheel||!this.bottomWheel){E.warn("ClefViewportController","Clef tab elements not found; skipping initialization",null,"ui");return}this.masterOptions=$s.map((e,s)=>({index:s,label:e.pitch,toneNote:e.toneNote,frequency:e.frequency}));const t=this.getViewportRange();this.topPicker=new H0(this.topWheel,this.masterOptions,t.topIndex,e=>this.handleTopSelection(e),e=>this.constrainTopIndex(e)),this.bottomPicker=new H0(this.bottomWheel,this.masterOptions,t.bottomIndex,e=>this.handleBottomSelection(e),e=>this.constrainBottomIndex(e)),this.computePresetRanges(),this.fullRangeButton&&this.fullRangeButton.addEventListener("click",()=>this.applyPresetView("full")),this.trebleButton&&this.trebleButton.addEventListener("click",()=>this.applyPresetView("treble")),this.altoButton&&this.altoButton.addEventListener("click",()=>this.applyPresetView("alto")),this.bassButton&&this.bassButton.addEventListener("click",()=>this.applyPresetView("bass")),f.on("pitchRangeChanged",()=>{this.syncFromViewport()}),f.on("zoomChanged",()=>{this.syncFromViewport()}),this.calculateAndSetWheelHeight(),window.addEventListener("resize",()=>this.calculateAndSetWheelHeight()),this.syncFromViewport(),this.initialized=!0,E.moduleLoaded("ClefViewportController","ui")}refreshWheelVisuals(){var t,e;(t=this.topPicker)==null||t.updateVisuals(),(e=this.bottomPicker)==null||e.updateVisuals()}getViewportRange(){var A;const t=Math.max(0,this.masterOptions.length-1),e=qe.getViewportInfo(),s=(e==null?void 0:e.startRank)??((A=f.state.pitchRange)==null?void 0:A.topIndex)??0,r=(e==null?void 0:e.endRank)??s+1,i=Math.max(0,Math.min(t,s)),o=Math.max(i,Math.min(t,r-1));return{topIndex:i,bottomIndex:o}}syncFromViewport(){if(!this.topPicker||!this.bottomPicker)return;const{topIndex:t,bottomIndex:e}=this.getViewportRange();this.topPicker.setIndex(t,{silent:!0}),this.bottomPicker.setIndex(e,{silent:!0}),this.updateSummary(t,e),this.updatePresetHighlight(t,e)}handleTopSelection(t){E.debug("ClefViewportController","handleTopSelection called",{newTopIndex:t},"ui"),qe.setViewportTopIndex(t)}handleBottomSelection(t){E.debug("ClefViewportController","handleBottomSelection called",{newBottomIndex:t},"ui"),qe.setViewportBottomIndex(t)}updateSummary(t,e){const s=this.masterOptions[t],r=this.masterOptions[e],i=e-t+1;this.rangeLabel&&s&&r&&(this.rangeLabel.textContent=`${s.label}  ${r.label}`),this.rangeCount&&(this.rangeCount.textContent=`${i} ${i===1?"pitch":"pitches"}`)}computePresetRanges(){const t=(e,s)=>{const r=this.findToneNoteIndex(e),i=this.findToneNoteIndex(s);return r===-1||i===-1?null:{topIndex:Math.min(r,i),bottomIndex:Math.max(r,i)}};this.presetRanges={full:{topIndex:0,bottomIndex:Math.max(0,this.masterOptions.length-1)},treble:t("G5","C4"),alto:t("A4","D3"),bass:t("C4","E2"),voice1:t("A5","A3"),voice2:t("C5","C3"),voice3:t("E4","E2")}}updatePresetHighlight(t,e){var r;let s=null;Object.entries(this.presetRanges).forEach(([i,o])=>{o&&o.topIndex===t&&o.bottomIndex===e&&(s=i)}),this.activePresetId=s,(r=this.presetButtons)!=null&&r.length&&(this.presetButtons.forEach(i=>{var a;const o=(a=i.dataset)!=null&&a.preset?i.dataset.preset??"":(i.id||"").replace(/^clef-/,"").replace(/-button$/,"").replace(/-range$/,"").replace(/-/g,""),A=this.activePresetId&&o===this.activePresetId;i.classList.toggle("active",!!A)}),this.presetContainer&&this.presetContainer.classList.toggle("locked",!1))}applyPresetView(t){const e=this.presetRanges[t];if(!e){E.warn("ClefViewportController","Preset range could not be resolved",{preset:t},"ui");return}const s=t==="full"?420:280;qe.setPitchViewportRange(e,{animateMs:s,source:`preset:${t}`})}findNoteIndex(t){return this.masterOptions.findIndex(e=>e.label===t)}findToneNoteIndex(t){return this.masterOptions.findIndex(e=>e.toneNote===t)}calculateAndSetWheelHeight(){const t=document.querySelector(".range-panel-section.wheels-section"),e=t==null?void 0:t.querySelector(".panel-section-title");if(!t||!this.topWheel||!this.bottomWheel)return;const s=t.clientHeight,r=(e==null?void 0:e.offsetHeight)||0,o=s-r-15,A=Math.max(120,Math.min(o,300));this.topWheel.style.setProperty("--clef-wheel-height",`${A}px`),this.bottomWheel.style.setProperty("--clef-wheel-height",`${A}px`),setTimeout(()=>{var a,l;(a=this.topPicker)==null||a.updateVisuals(),(l=this.bottomPicker)==null||l.updateVisuals()},0)}}const O0=new P5,N5={X:["1P","3M","5P"],x:["1P","3m","5P"],"x":["1P","3m","5d"],"X+":["1P","3M","5A"],"X":["1P","3M","5P","7m"],"x":["1P","3m","5P","7m"],"Xmaj":["1P","3M","5P","7M"],"":["1P","3m","5d","7m"],"x":["1P","3m","5d","6M"],"X":["1P","3M","5P","6M"],Xsus2:["1P","2M","5P"],Xsus4:["1P","4P","5P"]},D5={"xmaj":["1P","3m","5P","7M"],Xadd9:["1P","3M","5P","9M"],xadd9:["1P","3m","5P","9M"],"X6/9":["1P","3M","5P","6M","9M"],X9:["1P","3M","5P","7m","9M"],X11:["1P","3M","5P","7m","9M","11P"],X13:["1P","3M","5P","7m","9M","13M"],Xmaj9:["1P","3M","5P","7M","9M"],"x":["1P","3m","5P","7m","9M"],"x":["1P","3m","5P","6M"],"x":["1P","3m","5P","7m","9M","11P"],"Xmaj711":["1P","3M","5P","7M","11A"]},V0={...N5,...D5},W0={M6:["6M"],A6:["6A"],m7:["7m"],M7:["7M"],d5:["5d"],P5:["5P"],A5:["5A"],m6:["6m"],m3:["3m"],M3:["3M"],P4:["4P"],A4:["4A"],U:["1P"],m2:["2m"],M2:["2M"],A2:["2A"]},L5={"9m":"2m","9M":"2M","9A":"2A","11P":"4P","11A":"4A","13m":"6m","13M":"6M","13A":"6A"};function Ld(n){return L5[n]??n}function k5(n,t){Me(t,!0);const e=15;let s="diatonic",r="position",i=null,o=null,A=null,a=null,l=null,c=null,u=null,d=null,p=null,h=null,m=null,g=null,v=null,w=null,y=[];function I(){return Object.keys(f.state.tonicSignGroups).length>0}function B(L=f.state.degreeDisplayMode){const K=A==null?void 0:A.querySelector('[data-mode="diatonic"]'),O=A==null?void 0:A.querySelector('[data-mode="modal"]');if(!K||!O)return;L!=="off"&&(s=L);const X=L==="off"?s:L,tt=L==="off";[K,O].forEach(k=>{k.disabled=tt,k.classList.toggle("disabled",tt)}),A&&A.classList.toggle("disabled",tt),K.classList.toggle("active",X==="diatonic"),K.setAttribute("aria-pressed",X==="diatonic"?"true":"false"),O.classList.toggle("active",X==="modal"),O.setAttribute("aria-pressed",X==="modal"?"true":"false")}function C(L,K){if(!K)return;const O=L!=="off";K.classList.toggle("active",O),K.setAttribute("aria-pressed",O?"true":"false")}function b(){var L;if(v&&(v.querySelectorAll(".harmony-preset-button").forEach(K=>{K.classList.remove("selected","partial-match")}),f.state.activeChordIntervals)){const K=f.state.activeChordIntervals,O=K.toString(),X=K.map(Ld),tt=v.querySelectorAll(".harmony-preset-button");for(const k of tt){const z=((L=k.textContent)==null?void 0:L.trim())??"",$=V0[z];if(!$)continue;const rt=$.toString(),et=$.map(Ld);if(rt===O){k.classList.add("selected");continue}X.every(at=>et.includes(at))&&k.classList.add("partial-match")}}}function S(){if(w&&(w.querySelectorAll(".harmony-preset-button").forEach(L=>L.classList.remove("selected")),f.state.activeChordIntervals)){const K=f.state.activeChordIntervals.map(Ld);w.querySelectorAll(".harmony-preset-button").forEach(O=>{var z;const X=((z=O.textContent)==null?void 0:z.trim())??"",tt=W0[X],k=tt==null?void 0:tt[0];k&&K.includes(k)&&O.classList.add("selected")})}}const T=(L,K=50)=>{const O=parseInt(L.slice(1,3),16),X=parseInt(L.slice(3,5),16),tt=parseInt(L.slice(5,7),16),k=Math.min(255,Math.floor(O+(255-O)*(K/100))),z=Math.min(255,Math.floor(X+(255-X)*(K/100))),$=Math.min(255,Math.floor(tt+(255-tt)*(K/100)));return`#${k.toString(16).padStart(2,"0")}${z.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")}`},x=(L,K=1)=>{const O=L.startsWith("#")?L.slice(1):L;if(O.length!==6)return L;const X=parseInt(O.slice(0,2),16),tt=parseInt(O.slice(2,4),16),k=parseInt(O.slice(4,6),16);return`rgba(${X}, ${tt}, ${k}, ${K})`},_=(L,K)=>{if(!L)return;const O=T(K,50),X=T(O,60);L.style.setProperty("--c-accent",K),L.style.setProperty("--c-accent-light",X),L.style.setProperty("--harmony-partial-bg",x(X,.25)),L.style.setProperty("--harmony-partial-border",x(K,.4)),L.style.setProperty("--harmony-partial-bg-hover",x(X,.4)),L.style.setProperty("--harmony-partial-border-hover",x(K,.6))};function F(){var K;return(((K=f.state.activeChordIntervals)==null?void 0:K.length)??0)===2?"inversion":"position"}function Q(){var K;const L=((K=f.state.activeChordIntervals)==null?void 0:K.length)??1;return L===2?2:Math.max(1,L)}function U(){return F()==="inversion"?f.state.isIntervalsInverted?1:0:f.state.chordPositionState}function W(L){F()==="inversion"?f.setIntervalsInversion(L===1):f.setChordPosition(L)}function D(){var X;if(!g)return;const L=F(),K=U(),O=((X=f.state.activeChordIntervals)==null?void 0:X.length)??1;g.classList.toggle("inversion-mode",L==="inversion"),g.classList.toggle("position-mode",L==="position"),g.classList.remove("state-1","state-2","state-3","state-4","state-5"),K>=1&&K<=5&&g.classList.add(`state-${K}`);for(let tt=1;tt<=5;tt++)g.classList.remove(`disabled-state-${tt}`);L==="position"&&(O<=1?g.classList.add("disabled-state-1"):O===2?g.classList.add("disabled-state-2"):O===3?g.classList.add("disabled-state-3"):O===4?g.classList.add("disabled-state-4"):O===5&&g.classList.add("disabled-state-5"))}function R(){var O;const L=F(),K=((O=f.state.activeChordIntervals)==null?void 0:O.length)??1;if(r!==L){if(L==="inversion"){const X=f.state.chordPositionState===0;f.setIntervalsInversion(!X)}else f.setChordPosition(0);r=L}else if(L==="position"){const X=Math.max(0,K-1);f.state.chordPositionState>X&&f.setChordPosition(0)}D()}function N(){R()}function q(L=f.state.selectedToolTonicNumber){if(!y.length)return;const K=y[0]?parseInt(y[0].dataset.tonic??"1",10):1,O=typeof L=="number"?L:parseInt(String(L??""),10),X=Number.isNaN(O)?K:O;y.forEach(tt=>{const k=tt.dataset.tonic,$=(k?parseInt(k,10):NaN)===X;tt.classList.toggle("selected",$),tt.setAttribute("aria-pressed",$?"true":"false")})}function J(){return l!=null&&l.classList.contains("active")?"modal":a!=null&&a.classList.contains("active")?"diatonic":s}function nt(){const L=document.querySelector('[data-tab="rhythm"]');L&&!L.classList.contains("active")&&L.click();const K=document.querySelector('[data-rhythm-stamp-tab="sixteenth"]');K&&!K.classList.contains("active")&&K.click()}const At=L=>{[c,u,p].forEach(K=>{K&&(K.classList.toggle("accidental-btn--disabled",L),K.setAttribute("aria-disabled",L?"true":"false"))})},ot=L=>{L!==void 0&&(d&&(d.classList.toggle("active",L),d.setAttribute("aria-pressed",L?"true":"false")),At(L))},V=L=>{L!==void 0&&p&&(p.classList.toggle("active",L),p.setAttribute("aria-pressed",L?"true":"false"))};function H({newTool:L}={}){var K;if(i==null||i.classList.remove("selected"),m&&m.classList.remove("active-tool"),L==="eraser")i==null||i.classList.add("selected");else if(L==="chord")m==null||m.classList.add("active-tool");else if(L==="note"){const O=f.state.selectedNote;if(O){const X=document.querySelector(`.note-pair[data-color='${O.color}']`);X==null||X.classList.add("selected"),(K=X==null?void 0:X.querySelector(`.note[data-type='${O.shape}']`))==null||K.classList.add("selected")}}q()}function G(){b(),S(),N()}function Y({newNote:L}={}){var k;if(!(L!=null&&L.color)||!L.shape)return;const{color:K,shape:O}=L;document.querySelectorAll(".note, .note-pair").forEach(z=>z.classList.remove("selected"));const X=document.querySelector(`.note[data-color='${K}'][data-type='${O}']`);if(X)X.classList.add("selected");else{const z=document.querySelector(`.note-pair[data-color='${K}']`);z==null||z.classList.add("selected"),(k=z==null?void 0:z.querySelector(`.note[data-type='${O}']`))==null||k.classList.add("selected")}_(m,K);const tt=document.querySelector(".tab-sidebar");tt&&tt.style.setProperty("--c-accent",K)}function P(L){L&&(C(L,o),B(L))}function st(L){L&&(u==null||u.classList.toggle("active",L.sharp),c==null||c.classList.toggle("active",L.flat))}Hs(()=>{var Et,Qt;const L=ur.getMultiple("noteBankContainer","eraserButton","degreeVisibilityToggle","degreeModeToggle","flatBtn","sharpBtn","frequencyBtn","octaveLabelBtn","focusColoursToggle");i=L.eraserButton,o=L.degreeVisibilityToggle??null,A=L.degreeModeToggle,a=(A==null?void 0:A.querySelector('[data-mode="diatonic"]'))??null,l=(A==null?void 0:A.querySelector('[data-mode="modal"]'))??null,c=L.flatBtn,u=L.sharpBtn,d=L.frequencyBtn,p=L.octaveLabelBtn,h=L.focusColoursToggle,m=document.querySelector(".pitch-tabs-container"),g=document.getElementById("unified-position-toggle"),v=document.querySelector("#chords-panel .chords-grid"),w=document.querySelector("#chords-panel .intervals-4x4-grid"),y=Array.from(document.querySelectorAll(".tonic-mode-button")),O0.init(),document.querySelectorAll(".note").forEach(ct=>{ct.addEventListener("click",()=>{var Ot;const gt=ct.dataset.type,mt=ct.dataset.color||((Ot=ct.closest(".note-pair"))==null?void 0:Ot.dataset.color);if(!(!gt||!mt)){if(gt==="diamond"){f.setSelectedNote("diamond",mt);const ve=document.querySelector(".sixteenth-stamp-button.active"),we=ve?parseInt(ve.dataset.sixteenthStampId??"",10):NaN;if(f.state.selectedTool==="sixteenthStamp"&&ve&&!Number.isNaN(we)&&we!==e)return;nt(),Wu.selectSixteenthStamp(e);return}f.setSelectedNote(gt,mt),f.setSelectedTool("note")}})}),i&&i.addEventListener("click",()=>{if(f.state.selectedTool==="eraser"){f.setSelectedTool(f.state.previousTool||"note");return}f.setSelectedTool("eraser")});const O=document.getElementById("lasso-shortcut-button");O&&O.addEventListener("click",()=>{var ct,gt,mt;(ct=document.querySelector('[data-tab="pitch"]'))==null||ct.click(),(gt=document.querySelector('[data-pitch-tab="draw"]'))==null||gt.click(),(mt=document.querySelector('button.draw-tool-button[data-draw-tool="lasso"]'))==null||mt.click()});const X=document.getElementById("marker-shortcut-button");X&&X.addEventListener("click",()=>{var ct,gt,mt;(ct=document.querySelector('[data-tab="pitch"]'))==null||ct.click(),(gt=document.querySelector('[data-pitch-tab="draw"]'))==null||gt.click(),(mt=document.querySelector('button.draw-tool-button[data-draw-tool="marker"]'))==null||mt.click()}),y.length&&(y.forEach(ct=>{ct.addEventListener("click",()=>{const gt=ct.getAttribute("data-tonic");if(!gt)return;const mt=parseInt(gt,10);f.setSelectedTool("tonicization",mt),q(mt)})}),q()),v&&v.querySelectorAll(".harmony-preset-button").forEach(ct=>{ct.addEventListener("click",()=>{var Ot;const gt=((Ot=ct.textContent)==null?void 0:Ot.trim())??"",mt=V0[gt];mt&&mt.length>0&&(f.setActiveChordIntervals(mt),f.setSelectedTool("chord")),ct.blur()}),ct.addEventListener("dblclick",()=>{ct.classList.contains("selected")&&f.setSelectedTool("note"),ct.blur()})}),w&&w.querySelectorAll(".harmony-preset-button").forEach(ct=>{ct.addEventListener("click",()=>{var Ot;const gt=((Ot=ct.textContent)==null?void 0:Ot.trim())??"",mt=W0[gt];if(mt&&mt.length>0){const ve=mt[0];if(!ve)return;let we=f.state.selectedTool==="chord"&&f.state.activeChordIntervals?[...f.state.activeChordIntervals]:["1P"];we.includes(ve)?ve!=="1P"&&(we=we.filter(jn=>jn!==ve)):we.push(ve),we.includes("1P")||we.unshift("1P");const wr=["1P","2m","2M","2A","3m","3M","4P","4A","5d","5P","5A","6m","6M","6A","7m","7M","9M","11P","11A","13M"];we.sort((jn,ni)=>wr.indexOf(jn)-wr.indexOf(ni)),f.setActiveChordIntervals(we),f.setSelectedTool("chord")}ct.blur()}),ct.addEventListener("dblclick",()=>{f.setActiveChordIntervals(["1P"]),f.setSelectedTool("chord"),ct.blur()})});const tt=document.querySelectorAll(".pitch-tab-button"),k=document.querySelectorAll(".pitch-tab-panel");tt.forEach(ct=>{ct.addEventListener("click",()=>{var mt;const gt=ct.dataset.pitchTab;gt&&(tt.forEach(Ot=>Ot.classList.remove("active")),ct.classList.add("active"),k.forEach(Ot=>Ot.classList.remove("active")),(mt=document.getElementById(`${gt}-panel`))==null||mt.classList.add("active"),localStorage.setItem("selectedPitchTab",gt),gt==="chords"&&N(),gt==="range"&&setTimeout(()=>O0.refreshWheelVisuals(),0))})});const z=localStorage.getItem("selectedPitchTab")||"chords",$=document.querySelector(`[data-pitch-tab="${z}"]`);$&&(tt.forEach(ct=>ct.classList.remove("active")),k.forEach(ct=>ct.classList.remove("active")),$.classList.add("active"),(Et=document.getElementById(`${z}-panel`))==null||Et.classList.add("active"));const rt=document.querySelectorAll(".rhythm-stamp-tab-button"),et=document.querySelectorAll(".rhythm-stamp-tab-panel");rt.forEach(ct=>{ct.addEventListener("click",()=>{var mt;const gt=ct.dataset.rhythmStampTab;gt&&(rt.forEach(Ot=>Ot.classList.remove("active")),ct.classList.add("active"),et.forEach(Ot=>Ot.classList.remove("active")),(mt=document.getElementById(`${gt}-stamps-panel`))==null||mt.classList.add("active"),localStorage.setItem("selectedRhythmStampTab",gt))})});const it=localStorage.getItem("selectedRhythmStampTab")||localStorage.getItem("selectedRhythmTab"),at=it==="stamps"?"sixteenth":it==="triplets"?"triplet":it||"sixteenth",Ct=document.querySelector(`[data-rhythm-stamp-tab="${at}"]`);if(Ct&&(rt.forEach(ct=>ct.classList.remove("active")),et.forEach(ct=>ct.classList.remove("active")),Ct.classList.add("active"),(Qt=document.getElementById(`${at}-stamps-panel`))==null||Qt.classList.add("active")),g){const ct=g.querySelector(".toggle-track");ct==null||ct.addEventListener("click",()=>{const gt=U(),mt=Q();W((gt+1)%mt),g==null||g.blur()}),g.querySelectorAll(".left-labels .state-label").forEach(gt=>{gt.addEventListener("click",()=>{F()==="inversion"&&W(parseInt(gt.dataset.step??"0",10))})}),g.querySelectorAll(".right-labels .state-label").forEach(gt=>{gt.addEventListener("click",()=>{if(F()!=="position")return;const mt=parseInt(gt.dataset.step??"0",10);mt<Q()&&W(mt)})}),f.on("chordPositionChanged",D),f.on("intervalsInversionChanged",D),D()}o&&o.addEventListener("click",()=>{if(f.state.degreeDisplayMode==="off"){if(!I()){R0.alert("Please place a tonal center on the canvas before showing degrees.","Tonal Center Required");return}f.setDegreeDisplayMode(J())}else f.setDegreeDisplayMode("off");o==null||o.blur()}),a&&a.addEventListener("click",()=>{f.state.degreeDisplayMode!=="off"&&f.state.degreeDisplayMode!=="diatonic"&&f.setDegreeDisplayMode("diatonic"),a==null||a.blur()}),l&&l.addEventListener("click",()=>{f.state.degreeDisplayMode!=="off"&&f.state.degreeDisplayMode!=="modal"&&f.setDegreeDisplayMode("modal"),l==null||l.blur()}),c&&c.addEventListener("click",()=>{f.state.showFrequencyLabels&&f.toggleFrequencyLabels(),f.toggleAccidentalMode("flat"),c==null||c.blur()}),u&&u.addEventListener("click",()=>{f.state.showFrequencyLabels&&f.toggleFrequencyLabels(),f.toggleAccidentalMode("sharp"),u==null||u.blur()}),d&&d.addEventListener("click",()=>{f.toggleFrequencyLabels(),d==null||d.blur()}),p&&p.addEventListener("click",()=>{f.state.showFrequencyLabels&&f.toggleFrequencyLabels(),f.toggleOctaveLabels(),p==null||p.blur()}),h&&h.addEventListener("change",()=>{if(!f.state.focusColours&&!I()){R0.alert("Please place a tonal center on the canvas before enabling focus colours.","Tonal Center Required"),h&&(h.checked=!1);return}f.toggleFocusColours()}),f.on("toolChanged",H),f.on("activeChordIntervalsChanged",G),f.on("noteChanged",Y),f.on("degreeDisplayModeChanged",P),f.on("accidentalModeChanged",st),f.on("frequencyLabelsChanged",ot),f.on("octaveLabelsChanged",V),ot(f.state.showFrequencyLabels),V(f.state.showOctaveLabels),m&&f.state.selectedNote&&_(m,f.state.selectedNote.color);const yt=document.querySelector(".tab-sidebar");yt&&f.state.selectedNote&&yt.style.setProperty("--c-accent",f.state.selectedNote.color),setTimeout(()=>N(),50);const Bt=f.state.degreeDisplayMode;C(Bt,o),B(Bt),b(),S(),N(),console.log("[Svelte] ToolSelectorBridge mounted")}),ei(()=>{console.log("[Svelte] ToolSelectorBridge unmounted")}),Qe()}class kd{constructor(t,e={}){M(this,"parent");M(this,"settings");M(this,"_em");M(this,"_value");M(this,"decimalPlaces");M(this,"colors");M(this,"element");M(this,"_minDimension");M(this,"actual",0);M(this,"hasMoved",!1);M(this,"clicked",!1);M(this,"_start",{y:0});M(this,"_changeFactor",1);var a,l,c,u;const s=typeof t=="string"?document.querySelector(t):t;if(this.parent=s,!this.parent)throw new Error("DraggableNumber: parent element not found");const r={size:[60,30],value:0,min:0,max:2e4,step:1,decimalPlaces:2,colors:{fill:"#e7e7e7",dark:"#333",light:"#fff",accent:"#b35"},useAppStyling:!1},i={fill:((a=e.colors)==null?void 0:a.fill)??r.colors.fill,dark:((l=e.colors)==null?void 0:l.dark)??r.colors.dark,light:((c=e.colors)==null?void 0:c.light)??r.colors.light,accent:((u=e.colors)==null?void 0:u.accent)??r.colors.accent};this.settings={...r,...e,colors:i},this._em=new H5,this._value=new R5(this.settings.min,this.settings.max,this.settings.step,this.settings.value),this.decimalPlaces=this.settings.decimalPlaces,this.colors=this.settings.colors,this.element=document.createElement("input"),this.element.type="text",this.parent.appendChild(this.element);const[o,A]=this.settings.size;this._minDimension=Math.min(o,A),this.settings.useAppStyling?(this.element.className="draggable-number-input",this.element.style.cssText=[`width:${o}px`,`height:${A}px`,"background-color: var(--c-surface)","color: var(--c-text)","border: 1px solid var(--c-border)","border-radius: var(--border-radius-sm)","font-family: var(--main-font)","font-weight: 400","font-size: 14px","text-align: center","outline: none","padding: 0","box-sizing: border-box","user-select: text"].join(";")):this.element.style.cssText=[`width:${o}px`,`height:${A}px`,`background-color:${this.colors.fill}`,`color:${this.colors.dark}`,"font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif","font-weight:500",`font-size:${this._minDimension/2}px`,"border: none","outline: none",`padding:${this._minDimension/4}px ${this._minDimension/4}px`,"box-sizing:border-box","user-select:text"].join(";"),V5(this.element,d=>/^-?\d*\.?\d*$/.test(d)),this.actual=0,this.hasMoved=!1,this.clicked=!1,this.element.value=G0(this._value.value,this.decimalPlaces),this._bind()}on(t,e){return this._em.on(t,e),()=>this._em.off(t,e)}emit(t,e){this._em.emit(t,e)}get value(){return this._value.value}set value(t){this._value.update(t),this.emit("change",this._value.value),this._render()}get min(){return this._value.min}set min(t){this._value.min=t,this._render()}get max(){return this._value.max}set max(t){this._value.max=t,this._render()}get step(){return this._value.step}set step(t){this._value.step=t,this._render()}passiveUpdate(t){this._value.update(t),this._render()}link(t){this.min=t.min,this.max=t.max,this.step=t.step,typeof t.on=="function"&&t.on("change",e=>this.passiveUpdate(e)),this.on("change",e=>{"value"in t&&(t.value=e)}),this.value=t.value}_bind(){this.element.addEventListener("blur",()=>{this.settings.useAppStyling?(this.element.style.backgroundColor="var(--c-surface)",this.element.style.color="var(--c-text)"):(this.element.style.backgroundColor=this.colors.fill,this.element.style.color=this.colors.dark);const t=parseFloat(this.element.value);!Number.isNaN(t)&&t!==this.value?this.value=t:this._render()}),this.element.addEventListener("keydown",t=>{if(t.key==="Enter"){this.element.blur();const e=parseFloat(this.element.value);Number.isNaN(e)||(this.value=e)}},!0),this.element.addEventListener("mousedown",t=>this._onMouseDown(t)),this.element.addEventListener("dragstart",t=>t.preventDefault())}_onMouseDown(t){this.hasMoved=!1,this.clicked=!0,this.element.readOnly=!0,this.actual=this.value,this._start={y:t.clientY};const e=this.element.getBoundingClientRect(),s=(t.clientX-e.left)/e.width;this._changeFactor=O5(s);const r=o=>this._onMouseMove(o),i=()=>this._onMouseUp(r,i);window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)}_onMouseMove(t){if(!this.clicked)return;this.hasMoved=!0;const e=t.clientY-this._start.y,r=Wp(this.max-this.min,0,1e3)/200*Math.pow(this._changeFactor,2),i=this.actual-e*r;this._value.update(i),this._render(),this._value.changed&&this.emit("change",this._value.value)}_onMouseUp(t,e){this.clicked=!1,window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",e),this.hasMoved?document.body.focus():(this.element.readOnly=!1,this.element.focus(),this.element.setSelectionRange(0,this.element.value.length),this.settings.useAppStyling?(this.element.style.backgroundColor="var(--c-accent)",this.element.style.color="var(--c-surface)"):(this.element.style.backgroundColor=this.colors.accent,this.element.style.color=this.colors.light))}_render(){this.element.value=G0(this._value.value,this.decimalPlaces)}}class R5{constructor(t,e,s,r){M(this,"min");M(this,"max");M(this,"step");M(this,"_value");M(this,"changed");this.min=Number(t),this.max=Number(e),this.step=Number(s)||1,this._value=0,this.changed=!1,this.update(r)}get value(){return this._value}update(t){const e=Wp(Number(t),this.min,this.max),s=this._stepTo(e),r=this._value;this._value=s,this.changed=s!==r}_stepTo(t){if(!isFinite(this.step)||this.step<=0)return t;const e=Math.round((t-this.min)/this.step);return this.min+e*this.step}}class H5{constructor(){M(this,"_m");this._m=new Map}on(t,e){const s=this._m.get(t)||[];s.push(e),this._m.set(t,s)}off(t,e){const s=this._m.get(t);if(!s)return;const r=s.indexOf(e);r>=0&&s.splice(r,1)}emit(t,e){const s=this._m.get(t);if(s)for(const r of s.slice())r(e)}}function Wp(n,t,e){return Math.max(t,Math.min(e,n))}function O5(n){return 1-Wp(n,0,1)}function G0(n,t=2){return isFinite(n)?Number(n).toFixed(Math.max(0,t)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):""}function V5(n,t){let e=n.value;n.addEventListener("input",()=>{t(n.value)?e=n.value:n.value=e})}class W5{constructor(){M(this,"isActive",!1);M(this,"pulseIntervals",new Map);M(this,"tempoElements",new Map);M(this,"popDuration",{scaleUp:40,scaleDown:80});M(this,"popScale",1.4);M(this,"activeAnimations",new Map);this.initElements()}initElements(){[{type:"eighth",containerId:"eighth-note-tempo",bpmMultiplier:2},{type:"quarter",containerId:"quarter-note-tempo",bpmMultiplier:1},{type:"dottedQuarter",containerId:"dotted-quarter-tempo",bpmMultiplier:.666}].forEach(({type:e,containerId:s,bpmMultiplier:r})=>{const i=document.getElementById(s),o=i==null?void 0:i.parentElement,A=o==null?void 0:o.querySelector(".tempo-label-icon");i&&A?this.tempoElements.set(e,{container:i,icon:A,bpmMultiplier:r,originalTransform:i.style.transform||"",originalIconTransform:A.style.transform||""}):E.warn("TempoVisualizer",`Could not find elements for ${e} tempo`,{container:!!i,icon:!!A,tempoGroup:!!o},"toolbar")})}start(){this.isActive||(this.isActive=!0,this.tempoElements.size===0&&this.initElements(),this.tempoElements.forEach((t,e)=>{this.startPulseForType(e)}))}stop(){this.isActive&&(this.isActive=!1,this.pulseIntervals.forEach(t=>{clearInterval(t)}),this.pulseIntervals.clear(),this.activeAnimations.clear(),this.tempoElements.forEach(t=>{t.container.style.transform=t.originalTransform,t.icon.style.transform=t.originalIconTransform}))}startPulseForType(t){const e=this.tempoElements.get(t);if(!e)return;const i=60/(f.state.tempo*e.bpmMultiplier)*1e3;this.triggerPulse(t);const o=setInterval(()=>{this.isActive&&this.triggerPulse(t)},i);this.pulseIntervals.set(t,o)}triggerPulse(t){const s={startTime:performance.now(),phase:"scaleUp"};this.activeAnimations.set(t,s);const r=this.isActive;this.isActive=!0,this.activeAnimations.size===1&&this.animationLoop(),r||setTimeout(()=>{this.activeAnimations.size===0&&(this.isActive=!1)},this.popDuration.scaleUp+this.popDuration.scaleDown+50)}animationLoop(){if(this.activeAnimations.size===0||!this.isActive)return;const t=performance.now();this.activeAnimations.forEach((e,s)=>{const r=this.calculateScale(e,t);this.applyScale(s,r),r===1&&e.phase==="complete"&&this.activeAnimations.delete(s)}),this.activeAnimations.size>0&&requestAnimationFrame(()=>this.animationLoop())}calculateScale(t,e){const s=e-t.startTime;if(t.phase==="scaleUp"){if(s>=this.popDuration.scaleUp)return t.phase="scaleDown",t.startTime=e,this.popScale;{const r=Math.min(s/this.popDuration.scaleUp,1);return 1+(this.popScale-1)*r}}else if(t.phase==="scaleDown"){if(s>=this.popDuration.scaleDown)return t.phase="complete",1;{const r=Math.min(s/this.popDuration.scaleDown,1);return this.popScale-(this.popScale-1)*r}}return 1}applyScale(t,e){const s=this.tempoElements.get(t);if(!s)return;const r=`scale(${e})`;s.container.style.transform=s.originalTransform+" "+r,s.icon.style.transform=s.originalIconTransform+" "+r;const i=e<this.popScale?"transform 0.08s ease-out":"none";s.container.style.transition=i,s.icon.style.transition=i}updateTempo(){this.isActive&&(this.stop(),this.start())}}const eo=new W5,Hi=Eo,ps={blend:2,cutoff:31,resonance:0,type:"lowpass"};function Ga(){return{coeffs:new Float32Array(Hi).fill(0),phases:new Float32Array(Hi).fill(0)}}function G5(){const n=Ga();return n.coeffs[0]=1,n}function K5(){const n=Ga();for(let t=1;t<=Hi;t+=2){const e=t-1;n.coeffs[e]=1/t,n.phases[e]=0}return n}function q5(){const n=Ga();for(let t=1;t<=Hi;t+=2){const e=t-1;n.coeffs[e]=1/(t*t),n.phases[e]=Math.PI/2}return n}function z5(){const n=Ga();for(let t=1;t<=Hi;t++){const e=t-1;n.coeffs[e]=1/t,n.phases[e]=t&1?0:Math.PI}return n}const $5={strings:{amps:[.995,.94,.425,.48,0,.365,.04,.085,0,.09,0,0],phases:[0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,0]},piano:{amps:[1,.7,.6,.5,.4,.32,.25,.2,.17,.14,.12,.1],phases:Array(12).fill(0)},marimba:{amps:[1,.2,.15,.7,.05,.18,.03,.05,.02,.01,0,0],phases:Array(12).fill(0)},woodwind:{amps:[1,.05,.5,.05,.3,.05,.2,.05,.12,.05,.08,.05],phases:Array(12).fill(0)}};function Ql(n){const t=Ga(),e=$5[n];if(!e)return t;const s=Math.min(Hi,e.amps.length);for(let r=0;r<s;r++)t.coeffs[r]=e.amps[r]||0,t.phases[r]=e.phases[r]||0;return t}const cA={attack:.1,decay:.2,sustain:.8,release:.3},X5={sine:{name:"sine",gain:1,adsr:cA,...G5(),filter:{...ps}},triangle:{name:"triangle",gain:.81,adsr:cA,...q5(),filter:{...ps}},square:{name:"square",gain:4/Math.PI,adsr:cA,...K5(),filter:{...ps}},sawtooth:{name:"sawtooth",gain:2/Math.PI,adsr:cA,...z5(),filter:{...ps}},trapezium:{name:"trapezium",gain:4/Math.PI,adsr:cA,coeffs:new Float32Array([.993,0,.314,0,.168,0,.101,0,.06,0,.033,0]),phases:new Float32Array(Hi).fill(0),filter:{...ps}},impulse:{name:"impulse",gain:.18,adsr:{attack:.01,decay:.3,sustain:0,release:.2},coeffs:new Float32Array([1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0,0]),phases:new Float32Array([0,Math.PI*1.5,Math.PI,Math.PI/2,0,Math.PI*1.5,Math.PI,Math.PI/2,0,Math.PI*1.5,Math.PI,0]),filter:{...ps}},strings:{name:"strings",gain:.49,adsr:{attack:.08,decay:.4,sustain:.7,release:.5},...Ql("strings"),filter:{...ps,cutoff:28}},piano:{name:"piano",gain:.8,adsr:{attack:.01,decay:1.5,sustain:0,release:.4},...Ql("piano"),filter:{...ps,cutoff:28}},marimba:{name:"marimba",gain:.9,adsr:{attack:.01,decay:.8,sustain:0,release:.4},...Ql("marimba"),filter:{...ps,cutoff:25}},woodwind:{name:"woodwind",gain:.6,adsr:{attack:.1,decay:.2,sustain:.8,release:.3},...Ql("woodwind"),filter:{...ps}}};function Y5(n,t){Me(t,!0);let e=null,s=null,r=null,i=null,o=null,A=!1;const a=(b,S=20)=>{const T=parseInt(b.slice(1,3),16),x=parseInt(b.slice(3,5),16),_=parseInt(b.slice(5,7),16),F=Math.max(0,Math.floor(T*(1-S/100))),Q=Math.max(0,Math.floor(x*(1-S/100))),U=Math.max(0,Math.floor(_*(1-S/100)));return`#${F.toString(16).padStart(2,"0")}${Q.toString(16).padStart(2,"0")}${U.toString(16).padStart(2,"0")}`},l=(b,S=50)=>{const T=parseInt(b.slice(1,3),16),x=parseInt(b.slice(3,5),16),_=parseInt(b.slice(5,7),16),F=Math.min(255,Math.floor(T+(255-T)*(S/100))),Q=Math.min(255,Math.floor(x+(255-x)*(S/100))),U=Math.min(255,Math.floor(_+(255-_)*(S/100)));return`#${F.toString(16).padStart(2,"0")}${Q.toString(16).padStart(2,"0")}${U.toString(16).padStart(2,"0")}`};function c(b){const S=Math.round(b),T=e||document.getElementById("tempo-slider");T&&parseInt(T.value,10)!==S&&(T.value=`${S}`);const x=S*2,_=Math.round(S/1.5);s&&s.value!==x&&s.passiveUpdate(x),r&&r.value!==S&&r.passiveUpdate(S),i&&i.value!==_&&i.passiveUpdate(_),f.state.tempo!==S&&(f.setTempo(S),eo.updateTempo())}function u(b){if(!b)return;const S=b.closest(".tempo-slider-container");if(!S||S.querySelector(".tempo-slider-marks"))return;const T=[60,90,120,160,200],x=document.createElement("div");x.className="tempo-slider-marks",S.appendChild(x);const _=Number(b.min)||0,F=Number(b.max)||1,Q=Math.max(F-_,1),U=[],W=()=>{const N=b.getBoundingClientRect().height||b.clientHeight,q=getComputedStyle(b),J=parseFloat(q.getPropertyValue("--slider-thumb-size"))||0,nt=parseFloat(q.getPropertyValue("--slider-thumb-border"))||0,At=J+nt*2,ot=Math.max(N-At,1),V=At/2;U.forEach(({el:H,bpm:G})=>{if(G<_||G>F){H.style.display="none";return}H.style.display="";const Y=(G-_)/Q,P=V+ot*Y;H.style.bottom=`${P}px`})};T.forEach(R=>{const N=document.createElement("span");N.className="tempo-slider-mark",N.setAttribute("aria-hidden","true"),x.appendChild(N),U.push({el:N,bpm:R})}),W(),new ResizeObserver(W).observe(b)}function d(b){if(!b||!o)return;const S=f.state.timbres[b],T=f.state.colorPalette[b]||{primary:b,light:b},x=T.light,_=T.primary;document.querySelectorAll(".preset-button").forEach(Q=>{const U=Q,W=U.id.replace("preset-",""),D=(S==null?void 0:S.activePresetName)===W;U.classList.toggle("selected",D)});const F=l(x,60);o.style.setProperty("--c-accent",_),o.style.setProperty("--c-accent-light",F),o.style.setProperty("--c-accent-hover",a(_,20))}function p(){A=!0,eo.start()}function h(){A=!0,eo.start()}function m(b){const S=b.target,T=S?parseInt(S.value,10):NaN;c(T)}function g(){e==null||e.blur()}function v(){A&&(A=!1,eo.stop())}function w(){A&&(A=!1,eo.stop())}function y(){A&&(A=!1,eo.stop())}function I(b){var S;(S=b==null?void 0:b.newNote)!=null&&S.color?d(b.newNote.color):(document.querySelectorAll(".preset-button").forEach(T=>T.classList.remove("selected")),o&&(o.style.setProperty("--c-accent","#4A90E2"),o.style.setProperty("--c-accent-hover","#357ABD")))}function B(b){var S;b&&b===((S=f.state.selectedNote)==null?void 0:S.color)&&d(b)}function C(b){b!==void 0&&c(b)}Hs(()=>{var T;e=document.getElementById("tempo-slider"),o=document.querySelector(".preset-effects-container");const b={size:[45,24],step:1,decimalPlaces:0,useAppStyling:!0};s=new kd("#eighth-note-tempo",{...b,value:180,min:60,max:480}),r=new kd("#quarter-note-tempo",{...b,value:90,min:30,max:240}),i=new kd("#dotted-quarter-tempo",{...b,value:60,min:20,max:160}),s.on("change",x=>{!isNaN(x)&&x>0&&c(x/2)}),r.on("change",x=>{!isNaN(x)&&x>0&&c(x)}),i.on("change",x=>{!isNaN(x)&&x>0&&c(x*1.5)}),c(f.state.tempo),e?(u(e),e.addEventListener("mousedown",p),e.addEventListener("touchstart",h),e.addEventListener("input",m),e.addEventListener("mouseup",g),c(f.state.tempo)):E.warn("AudioControlsBridge","Tempo slider not found - will initialize when rhythm tab is opened",null,"toolbar"),document.addEventListener("mouseup",v),document.addEventListener("touchend",w),document.addEventListener("touchcancel",y),document.querySelectorAll(".preset-button").forEach(x=>{const _=x,F=_.id.replace("preset-",""),Q=X5[F];Q&&_.addEventListener("click",()=>{var W;const U=(W=f.state.selectedNote)==null?void 0:W.color;U&&(f.applyPreset(U,Q),setTimeout(()=>d(U),10)),_.blur()})}),f.on("noteChanged",I),f.on("timbreChanged",B),f.on("tempoChanged",C);const S=(T=f.state.selectedNote)==null?void 0:T.color;S&&d(S),console.log("[Svelte] AudioControlsBridge mounted")}),ei(()=>{e==null||e.removeEventListener("mousedown",p),e==null||e.removeEventListener("touchstart",h),e==null||e.removeEventListener("input",m),e==null||e.removeEventListener("mouseup",g),document.removeEventListener("mouseup",v),document.removeEventListener("touchend",w),document.removeEventListener("touchcancel",y),console.log("[Svelte] AudioControlsBridge unmounted")}),Qe()}function j5(n,t){Me(t,!0);const e="selectedTab",s="selectedPresetTab",r="timbre",i="presets";function o(V){try{localStorage.setItem(e,V),E.debug("TabManagement",`Saved tab to localStorage: ${V}`,void 0,"ui")}catch(H){E.warn("TabManagement","Failed to save tab to localStorage",H,"ui")}}function A(){try{return localStorage.getItem(e)||r}catch(V){return E.warn("TabManagement","Failed to read tab from localStorage",V,"ui"),r}}function a(V){try{localStorage.setItem(s,V),E.debug("TabManagement",`Saved preset tab to localStorage: ${V}`,void 0,"ui")}catch(H){E.warn("TabManagement","Failed to save preset tab to localStorage",H,"ui")}}function l(){try{return localStorage.getItem(s)||i}catch(V){return E.warn("TabManagement","Failed to read preset tab from localStorage",V,"ui"),i}}let c=null,u=null,d=null;const p=new Map,h=new Map,m=new Map,g=[{label:"effectsPanelActive",selector:"#effects-panel.preset-tab-panel.active"},{label:"effectsPanel",selector:"#effects-panel"},{label:"effectsContentBox",selector:"#effects-panel .effects-content-box"},{label:"presetsPanelActive",selector:"#presets-panel.preset-tab-panel.active"},{label:"presetsPanel",selector:"#presets-panel"},{label:"presetContentBox",selector:"#presets-panel .preset-content-box"},{label:"presetEffectsContent",selector:".preset-effects-content"},{label:"presetEffectsControls",selector:".preset-effects-controls"},{label:"presetEffectsContainer",selector:".preset-effects-container"},{label:"presetEffectsTabs",selector:".preset-effects-tabs"}];let v=null,w=null;const y=new Map;let I=null,B="",C=!1,b=null;function S(V,H){if(!V)return{selector:H,missing:!0};const G=V,Y=G.getBoundingClientRect(),P=window.getComputedStyle(G),st=G.parentElement,L=st==null?void 0:st.getBoundingClientRect(),K=st?window.getComputedStyle(st):null;return{selector:H,tag:G.tagName.toLowerCase(),id:G.id||null,className:G.className||null,rectWidth:Number(Y.width.toFixed(1)),rectHeight:Number(Y.height.toFixed(1)),offsetWidth:G.offsetWidth,clientWidth:G.clientWidth,scrollWidth:G.scrollWidth,computed:{display:P.display,position:P.position,width:P.width,minWidth:P.minWidth,maxWidth:P.maxWidth,flex:P.flex,flexGrow:P.flexGrow,flexShrink:P.flexShrink,flexBasis:P.flexBasis,alignSelf:P.alignSelf,alignItems:P.alignItems,justifyContent:P.justifyContent,justifySelf:P.justifySelf,gap:P.gap,boxSizing:P.boxSizing,paddingLeft:P.paddingLeft,paddingRight:P.paddingRight,borderLeftWidth:P.borderLeftWidth,borderRightWidth:P.borderRightWidth,overflowX:P.overflowX,overflowY:P.overflowY},parent:st?{tag:st.tagName.toLowerCase(),id:st.id||null,className:st.className||null,rectWidth:Number(((L==null?void 0:L.width)||0).toFixed(1)),computedWidth:K==null?void 0:K.width,display:K==null?void 0:K.display,flex:K==null?void 0:K.flex}:null}}function T(V){const H=Array.from(document.querySelectorAll(V));return{selector:V,count:H.length,entries:H.map((G,Y)=>({index:Y,...S(G,V)}))}}function x(V,H,G=4){if(!V)return{selector:H,missing:!0,chain:[]};const Y=[];let P=V,st=0;for(;P&&st<G;){const L=P.getBoundingClientRect(),K=window.getComputedStyle(P);Y.push({tag:P.tagName.toLowerCase(),id:P.id||null,className:P.className||null,rectWidth:Number(L.width.toFixed(1)),offsetWidth:P.offsetWidth,clientWidth:P.clientWidth,computed:{display:K.display,width:K.width,minWidth:K.minWidth,maxWidth:K.maxWidth,flex:K.flex,flexGrow:K.flexGrow,flexShrink:K.flexShrink,flexBasis:K.flexBasis,alignItems:K.alignItems,justifyContent:K.justifyContent,alignSelf:K.alignSelf,boxSizing:K.boxSizing,paddingLeft:K.paddingLeft,paddingRight:K.paddingRight,gap:K.gap}}),P=P.parentElement,st+=1}return{selector:H,missing:!1,chain:Y}}function _(V){const H=Object.keys(V.elements).sort(),G={activePresetTab:V.activePresetTab,activePresetPanelId:V.activePresetPanelId};return H.forEach(Y=>{const P=V.elements[Y];if(!P||P.missing){G[Y]="missing";return}G[Y]={rectWidth:P.rectWidth,rectHeight:P.rectHeight,offsetWidth:P.offsetWidth,clientWidth:P.clientWidth,scrollWidth:P.scrollWidth}}),JSON.stringify(G)}function F(V,H,G,Y){if(H.missing||Y.missing)return{pair:`${V} vs ${G}`,missing:!0};const P=["rectWidth","offsetWidth","clientWidth","scrollWidth"],st=["display","position","width","minWidth","maxWidth","flex","alignSelf","boxSizing","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","overflowX","overflowY"],L=["computedWidth","display","flex"],K=[];return P.forEach(O=>{const X=H[O],tt=Y[O];X!==tt&&K.push({property:O,[V]:X,[G]:tt})}),st.forEach(O=>{var k,z;const X=(k=H.computed)==null?void 0:k[O],tt=(z=Y.computed)==null?void 0:z[O];X!==tt&&K.push({property:`computed.${O}`,[V]:X,[G]:tt})}),L.forEach(O=>{var k,z;const X=(k=H.parent)==null?void 0:k[O],tt=(z=Y.parent)==null?void 0:z[O];X!==tt&&K.push({property:`parent.${O}`,[V]:X,[G]:tt})}),{pair:`${V} vs ${G}`,missing:!1,differences:K}}function Q(V){C&&(B=B?`${B}; ${V}`:V,I===null&&(I=requestAnimationFrame(()=>{const H=B||"auto";I=null,B="",R(H)})))}function U(){v&&g.forEach(V=>{document.querySelectorAll(V.selector).forEach(H=>{y.has(H)||(y.set(H,V.label),v.observe(H))})})}function W(){v||(C=!0,b=null,v=new ResizeObserver(V=>{const H=V.map(G=>y.get(G.target)||G.target.id||G.target.tagName.toLowerCase()).filter(Boolean);H.length&&Q(`Resize: ${H.join(", ")}`)}),w=new MutationObserver(()=>U()),document.body?w.observe(document.body,{childList:!0,subtree:!0}):document.addEventListener("DOMContentLoaded",()=>{w==null||w.observe(document.body,{childList:!0,subtree:!0}),U(),Q("init")},{once:!0}),window.addEventListener("resize",()=>Q("window resize")),U(),Q("init"))}function D(){C=!1,b=null,v&&(v.disconnect(),v=null),w&&(w.disconnect(),w=null),y.clear(),I!==null&&(cancelAnimationFrame(I),I=null),B=""}function R(V){requestAnimationFrame(()=>{var it;const H=document.querySelector(".preset-tab-button.active"),G=document.querySelector(".preset-tab-panel.active"),Y=S(document.querySelector("#effects-panel.preset-tab-panel.active"),"#effects-panel.preset-tab-panel.active"),P=S(document.getElementById("effects-panel"),"#effects-panel"),st=S(document.querySelector("#effects-panel .effects-content-box"),"#effects-panel .effects-content-box"),L=S(document.querySelector("#presets-panel.preset-tab-panel.active"),"#presets-panel.preset-tab-panel.active"),K=S(document.getElementById("presets-panel"),"#presets-panel"),O=S(document.querySelector("#presets-panel .preset-content-box"),"#presets-panel .preset-content-box"),X=S(document.querySelector(".preset-effects-content"),".preset-effects-content"),tt=S(document.querySelector(".preset-effects-controls"),".preset-effects-controls"),k=S(document.querySelector(".preset-effects-container"),".preset-effects-container"),z=S(document.querySelector(".preset-effects-tabs"),".preset-effects-tabs"),$={reason:V,activePresetTab:((it=H==null?void 0:H.dataset)==null?void 0:it.presetTab)||null,activePresetPanelId:(G==null?void 0:G.id)||null,elements:{effectsPanelActive:Y,effectsPanel:P,effectsContentBox:st,presetsPanelActive:L,presetsPanel:K,presetContentBox:O,presetEffectsContent:X,presetEffectsControls:tt,presetEffectsContainer:k,presetEffectsTabs:z},comparisons:{activePanelVsEffectsContent:F("effectsPanelActive",Y.missing?P:Y,"effectsContentBox",st),panelVsEffectsContent:F("effectsPanel",P,"effectsContentBox",st),contentBoxes:F("effectsContentBox",st,"presetContentBox",O),panels:F("effectsPanel",P,"presetsPanel",K),tabsVsEffectsContent:F("presetEffectsTabs",z,"effectsContentBox",st)},chains:{effectsPanelActive:x(document.querySelector("#effects-panel.preset-tab-panel.active"),"#effects-panel.preset-tab-panel.active"),effectsContentBox:x(document.querySelector("#effects-panel .effects-content-box"),"#effects-panel .effects-content-box"),presetEffectsContent:x(document.querySelector(".preset-effects-content"),".preset-effects-content")},lists:{presetTabButtons:T(".preset-effects-tabs .preset-tab-button")}},rt=_($);(V.startsWith("Resize")||V==="auto"||V==="init"||V==="window resize")&&rt===b||(b=rt,console.groupCollapsed(`[Sizing] Preset/Effects widths (${V})`),console.log($),console.groupEnd())})}function N(V){window.enablePresetEffectsSizingDiagnostics&&R(V)}function q(){const V=A();document.querySelectorAll(".tab-button").forEach(Y=>Y.classList.remove("active")),document.querySelectorAll(".tab-panel").forEach(Y=>Y.classList.remove("active"));const H=document.querySelector(`[data-tab="${V}"]`),G=document.getElementById(`${V}-panel`);H&&G?(H.classList.add("active"),G.classList.add("active"),V==="rhythm"&&setTimeout(()=>{const Y=window.initTempoSliderIfNeeded;typeof Y=="function"&&Y()},200)):E.warn("TabManagement",`Could not restore tab: ${V}. Tab button or panel not found.`)}function J(){const V=l();document.querySelectorAll(".preset-tab-button:not([disabled])").forEach(Y=>Y.classList.remove("active")),document.querySelectorAll(".preset-tab-panel").forEach(Y=>Y.classList.remove("active"));const H=document.querySelector(`[data-preset-tab="${V}"]`),G=document.getElementById(`${V}-panel`);if(H&&G&&!H.hasAttribute("disabled")){H.classList.add("active"),G.classList.add("active");const Y=document.querySelector(".harmonic-bins-container");Y&&(V==="effects"?Y.style.display="none":Y.style.display="flex")}else E.warn("TabManagement",`Could not restore preset tab: ${V}. Tab button or panel not found.`);N("restore preset tab")}function nt(){q(),c=document.querySelectorAll(".tab-button"),c.forEach(V=>{const H=()=>{const G=V.dataset.tab;if(!G)return;document.querySelectorAll(".tab-button").forEach(P=>P.classList.remove("active")),V.classList.add("active"),document.querySelectorAll(".tab-panel").forEach(P=>P.classList.remove("active"));const Y=document.getElementById(`${G}-panel`);Y&&Y.classList.add("active"),o(G),G==="rhythm"&&setTimeout(()=>{const P=window.initTempoSliderIfNeeded;typeof P=="function"&&P()},50)};V.addEventListener("click",H),p.set(V,H)}),E.info("TabManagementBridge","Main tabs initialized",null,"ui")}function At(){J(),u=document.querySelectorAll(".preset-tab-button"),u.forEach(V=>{const H=()=>{const G=V.dataset.presetTab;if(!G)return;document.querySelectorAll(".preset-tab-button:not([disabled])").forEach(st=>st.classList.remove("active")),V.classList.add("active"),document.querySelectorAll(".preset-tab-panel").forEach(st=>st.classList.remove("active"));const Y=document.getElementById(`${G}-panel`);Y&&Y.classList.add("active"),a(G);const P=document.querySelector(".harmonic-bins-container");P&&(G==="effects"?P.style.display="none":P.style.display="flex"),N(`preset tab click: ${G}`)};V.addEventListener("click",H),h.set(V,H)}),E.info("TabManagementBridge","Preset tabs initialized",null,"ui")}function ot(){d=document.querySelectorAll(".pitch-tab-button"),d.forEach(V=>{const H=()=>{const G=V.dataset.pitchTab;if(!G)return;document.querySelectorAll(".pitch-tab-button").forEach(P=>P.classList.remove("active")),V.classList.add("active"),document.querySelectorAll(".pitch-tab-panel").forEach(P=>P.classList.remove("active"));const Y=document.getElementById(`${G}-panel`);Y&&Y.classList.add("active")};V.addEventListener("click",H),m.set(V,H)}),E.info("TabManagementBridge","Pitch tabs initialized",null,"ui")}Qn(()=>(nt(),At(),ot(),window.logPresetEffectsSizing=(V="manual")=>{R(V)},window.enablePresetEffectsSizingAutoLog=()=>{window.enablePresetEffectsSizingDiagnostics=!0,W()},window.disablePresetEffectsSizingAutoLog=()=>{window.enablePresetEffectsSizingDiagnostics=!1,D()},window.enablePresetEffectsSizingDiagnostics&&W(),console.log("[Svelte 5] TabManagementBridge mounted"),()=>{p.forEach((V,H)=>{H.removeEventListener("click",V)}),p.clear(),h.forEach((V,H)=>{H.removeEventListener("click",V)}),h.clear(),m.forEach((V,H)=>{H.removeEventListener("click",V)}),m.clear(),D(),console.log("[Svelte 5] TabManagementBridge unmounted")})),Qe()}function J5(n,t){Me(t,!0);const e=16,s={letter:{width:8.5,height:11},"11x14":{width:11,height:14},"11x17":{width:11,height:17}};let r=null,i=null,o=null,A=null,a=null,l=null,c=null,u=null,d=null,p=null,h=null,m=null,g=null,v=!1,w=null;const y=20,I=5;let B=null,C=null;function b(){f.state.isPrintPreviewActive||f.setPrintPreviewActive(!0),r==null||r.classList.remove("hidden");const O=et=>et?getComputedStyle(et).display!=="none":!1,X=f.state.printOptions.pageSize,tt=X&&X in s?X:"letter",k=O(document.getElementById("button-grid")),z=O(document.getElementById("drum-grid-wrapper")),$=O(document.getElementById("legend-left-canvas")),rt=O(document.getElementById("legend-right-canvas"));f.setPrintOptions({pageSize:tt,cropTop:0,cropBottom:1,cropLeft:0,cropRight:1,includeButtonGrid:k,includeDrums:z,includeLeftLegend:$,includeRightLegend:rt}),k&&Yl.prefetchButtonGridSnapshot($,rt),_()}function S(){f.state.isPrintPreviewActive&&f.setPrintPreviewActive(!1),r==null||r.classList.add("hidden")}function T(O,X){const k=f.state.printOptions[O]===X[0]?X[1]:X[0];f.setPrintOptions({[O]:k})}function x(){if([u,d,p,h,m,g].some(at=>at===null))return;const X=f.state.printOptions.pageSize,tt=X&&X in s?X:"letter",{orientation:k,colorMode:z,includeButtonGrid:$,includeDrums:rt,includeLeftLegend:et,includeRightLegend:it}=f.state.printOptions;c&&(c.value=tt),u&&(u.textContent=k.charAt(0).toUpperCase()+k.slice(1)),d&&(d.textContent=z==="color"?"Color":"B&W",d.classList.toggle("active",z==="color")),p&&(p.textContent=$?"Include":"Exclude",p.classList.toggle("active",$)),h&&(h.textContent=rt?"Include":"Exclude",h.classList.toggle("active",rt)),m&&(m.textContent=et?"Include":"Exclude",m.classList.toggle("active",et)),g&&(g.textContent=it?"Include":"Exclude",g.classList.toggle("active",it))}async function _(){if(!f.state.isPrintPreviewActive||!i||!o)return;x();const O=(l==null?void 0:l.clientWidth)??0,X=(l==null?void 0:l.clientHeight)??0;if(O===0||X===0)return;const{orientation:tt}=f.state.printOptions,k=f.state.printOptions.pageSize,z=k&&k in s?k:"letter",$=s[z],rt=tt==="landscape"?$.height:$.width,et=tt==="landscape"?$.width:$.height,it=.25,at=rt/et,Ct=e*2;let yt=Math.max(O-Ct,100),Bt=Math.max(X-Ct,100);yt/Bt>at?yt=Bt*at:Bt=yt/at;const Et=it/rt*yt,Qt=yt-2*Et,ct=Bt-2*Et,gt={...f.state.printOptions,cropTop:0,cropBottom:1,cropLeft:0,cropRight:1},mt=await Yl.generateScoreCanvas(gt,{width:Qt,height:ct});if(!mt)return;i.width=yt,i.height=Bt,o.fillStyle="#FFFFFF",o.fillRect(0,0,yt,Bt),o.strokeStyle="#E0E0E0",o.lineWidth=1,o.strokeRect(Et,Et,Qt,ct);const Ot=Et+Math.max(0,(Qt-mt.width)/2),ve=Et+Math.max(0,(ct-mt.height)/2);o.drawImage(mt,Ot,ve),F(Et,Qt,ct),Q(yt,Bt,{contentTop:ve,contentLeft:Ot,contentWidth:mt.width,contentHeight:mt.height})}function F(O,X,tt){if(!o)return;o.strokeStyle="#CCCCCC",o.lineWidth=1;const k=10,z=O+X,$=O+tt;o.beginPath(),o.moveTo(O,O-k),o.lineTo(O,O+k),o.moveTo(O-k,O),o.lineTo(O+k,O),o.moveTo(z,O-k),o.lineTo(z,O+k),o.moveTo(z-k,O),o.lineTo(z+k,O),o.moveTo(O,$-k),o.lineTo(O,$+k),o.moveTo(O-k,$),o.lineTo(O+k,$),o.moveTo(z,$-k),o.lineTo(z,$+k),o.moveTo(z-k,$),o.lineTo(z+k,$),o.stroke()}function Q(O,X,tt){const k=i==null?void 0:i.getBoundingClientRect(),z=l==null?void 0:l.getBoundingClientRect();if(!k||!z||!A||!a)return;A.width=O,A.height=X,A.style.left=`${k.left-z.left}px`,A.style.top=`${k.top-z.top}px`,A.style.width=`${O}px`,A.style.height=`${X}px`;const{cropTop:$,cropBottom:rt,cropLeft:et,cropRight:it}=f.state.printOptions,{contentTop:at,contentLeft:Ct,contentHeight:yt,contentWidth:Bt}=tt,Et=at+$*yt,Qt=at+rt*yt,ct=Ct+et*Bt,gt=Ct+it*Bt,mt=at+yt,Ot=Ct+Bt;a.clearRect(0,0,O,X),a.fillStyle="rgba(0, 0, 0, 0.5)",$>0&&a.fillRect(Ct,at,Bt,Et-at),rt<1&&a.fillRect(Ct,Qt,Bt,mt-Qt),et>0&&a.fillRect(Ct,Et,ct-Ct,Qt-Et),it<1&&a.fillRect(gt,Et,Ot-gt,Qt-Et),U(Et,Ct,Ot,"top"),U(Qt,Ct,Ot,"bottom"),W(ct,at,mt,"left"),W(gt,at,mt,"right"),B={pageWidth:O,pageHeight:X,contentTop:at,contentLeft:Ct,contentHeight:yt,contentWidth:Bt,cropTopY:Et,cropBottomY:Qt,cropLeftX:ct,cropRightX:gt}}function U(O,X,tt,k){if(!a)return;const z=60,$=tt-X,rt=X+($-z)/2,et=k==="top"?O-y-4:O+4;a.fillStyle="#4a90e2",a.fillRect(X,O-1,$,2),a.fillRect(rt,et,z,y),a.strokeStyle="#FFFFFF",a.lineWidth=2,a.strokeRect(rt,et,z,y),a.strokeStyle="#FFFFFF",a.lineWidth=1;const it=3,at=6,Ct=30,yt=X+($-Ct)/2;for(let Bt=0;Bt<it;Bt++){const Et=et+y/2+(Bt-1)*at;a.beginPath(),a.moveTo(yt,Et),a.lineTo(yt+Ct,Et),a.stroke()}}function W(O,X,tt,k){if(!a)return;const z=60,$=tt-X,rt=X+($-z)/2,et=k==="left"?O-y-4:O+4;a.fillStyle="#4a90e2",a.fillRect(O-1,X,2,$),a.fillRect(et,rt,y,z),a.strokeStyle="#FFFFFF",a.lineWidth=2,a.strokeRect(et,rt,y,z),a.strokeStyle="#FFFFFF",a.lineWidth=1;const it=3,at=6,Ct=30,yt=X+($-Ct)/2;for(let Bt=0;Bt<it;Bt++){const Et=et+y/2+(Bt-1)*at;a.beginPath(),a.moveTo(Et,yt),a.lineTo(Et,yt+Ct),a.stroke()}}function D(O){if(!B||!A)return;const X=A.getBoundingClientRect(),tt=O.clientX-X.left,k=O.clientY-X.top,z=tt>=B.contentLeft&&tt<=B.contentLeft+B.contentWidth,$=k>=B.contentTop&&k<=B.contentTop+B.contentHeight,rt=z&&Math.abs(k-B.cropTopY)<y+I,et=z&&Math.abs(k-B.cropBottomY)<y+I,it=$&&Math.abs(tt-B.cropLeftX)<y+I,at=$&&Math.abs(tt-B.cropRightX)<y+I;rt?(v=!0,w="top",A.style.cursor="ns-resize"):et?(v=!0,w="bottom",A.style.cursor="ns-resize"):it?(v=!0,w="left",A.style.cursor="ew-resize"):at&&(v=!0,w="right",A.style.cursor="ew-resize")}function R(O){if(!B||!A)return;const X=A.getBoundingClientRect(),tt=O.clientX-X.left,k=O.clientY-X.top;if(v&&w){N(tt,k);return}const z=tt>=B.contentLeft&&tt<=B.contentLeft+B.contentWidth,$=k>=B.contentTop&&k<=B.contentTop+B.contentHeight,rt=z&&Math.abs(k-B.cropTopY)<y+I,et=z&&Math.abs(k-B.cropBottomY)<y+I,it=$&&Math.abs(tt-B.cropLeftX)<y+I,at=$&&Math.abs(tt-B.cropRightX)<y+I;rt||et?A.style.cursor="ns-resize":it||at?A.style.cursor="ew-resize":A.style.cursor="default"}function N(O,X){if(!B)return;const{contentTop:tt,contentLeft:k,contentHeight:z,contentWidth:$}=B,rt=.05;if(w==="top"){const et=Math.max(0,Math.min(1,(X-tt)/z)),it=f.state.printOptions.cropBottom;et<it-rt&&f.setPrintOptions({cropTop:et})}else if(w==="bottom"){const et=Math.max(0,Math.min(1,(X-tt)/z)),it=f.state.printOptions.cropTop;et>it+rt&&f.setPrintOptions({cropBottom:et})}else if(w==="left"){const et=Math.max(0,Math.min(1,(O-k)/$)),it=f.state.printOptions.cropRight;et<it-rt&&f.setPrintOptions({cropLeft:et})}else if(w==="right"){const et=Math.max(0,Math.min(1,(O-k)/$)),it=f.state.printOptions.cropLeft;et>it+rt&&f.setPrintOptions({cropRight:et})}}function q(){v=!1,w=null,A&&(A.style.cursor="default")}function J(){S()}function nt(){Yl.generateAndPrint(),S()}function At(){T("orientation",["landscape","portrait"])}function ot(){T("colorMode",["color","bw"])}function V(){T("includeButtonGrid",[!0,!1])}function H(){T("includeDrums",[!0,!1])}function G(){T("includeLeftLegend",[!0,!1])}function Y(){T("includeRightLegend",[!0,!1])}function P(){if(!c)return;const O=c.value;O in s&&f.setPrintOptions({pageSize:O})}function st(O){O!==void 0&&(O?b():S())}function L(){_()}function K(){f.state.isPrintPreviewActive&&_()}Hs(()=>{var O,X;r=document.getElementById("print-preview-overlay"),i=document.getElementById("print-preview-canvas"),o=(i==null?void 0:i.getContext("2d"))??null,A=document.getElementById("print-crop-overlay"),a=(A==null?void 0:A.getContext("2d"))??null,l=(i==null?void 0:i.parentElement)??null,c=document.getElementById("print-page-size"),u=document.getElementById("print-orientation-toggle"),d=document.getElementById("print-color-mode-toggle"),p=document.getElementById("print-button-grid-toggle"),h=document.getElementById("print-drum-grid-toggle"),m=document.getElementById("print-left-legend-toggle"),g=document.getElementById("print-right-legend-toggle"),(O=document.getElementById("print-close-button"))==null||O.addEventListener("click",J),(X=document.getElementById("print-confirm-button"))==null||X.addEventListener("click",nt),u==null||u.addEventListener("click",At),d==null||d.addEventListener("click",ot),p==null||p.addEventListener("click",V),h==null||h.addEventListener("click",H),m==null||m.addEventListener("click",G),g==null||g.addEventListener("click",Y),c==null||c.addEventListener("change",P),A==null||A.addEventListener("mousedown",D),A==null||A.addEventListener("mousemove",R),A==null||A.addEventListener("mouseup",q),A==null||A.addEventListener("mouseleave",q),f.on("printPreviewStateChanged",st),f.on("printOptionsChanged",L),f.on("notesChanged",K),l&&(C=new ResizeObserver(()=>{f.state.isPrintPreviewActive&&_()}),C.observe(l)),console.log("[Svelte] PrintPreviewBridge mounted")}),ei(()=>{var O,X;(O=document.getElementById("print-close-button"))==null||O.removeEventListener("click",J),(X=document.getElementById("print-confirm-button"))==null||X.removeEventListener("click",nt),u==null||u.removeEventListener("click",At),d==null||d.removeEventListener("click",ot),p==null||p.removeEventListener("click",V),h==null||h.removeEventListener("click",H),m==null||m.removeEventListener("click",G),g==null||g.removeEventListener("click",Y),c==null||c.removeEventListener("change",P),A==null||A.removeEventListener("mousedown",D),A==null||A.removeEventListener("mousemove",R),A==null||A.removeEventListener("mouseup",q),A==null||A.removeEventListener("mouseleave",q),C==null||C.disconnect(),console.log("[Svelte] PrintPreviewBridge unmounted")}),Qe()}const Rd={stroke:"#c7cfd8",background:"rgba(207, 214, 222, 0.32)"};let Ul=null;function Ib(){if(Ul)return Ul;if(typeof window>"u")return Rd;const n=window.getComputedStyle(document.documentElement);return Ul={stroke:n.getPropertyValue("--c-anacrusis-border").trim()||Rd.stroke,background:n.getPropertyValue("--c-anacrusis-bg").trim()||Rd.background},Ul}function Z5(n){if(n.length===0)return[];const t=[...n].sort((s,r)=>s.start-r.start),e=[];for(const s of t){if(e.length===0){e.push({...s});continue}const r=e[e.length-1];s.start<=r.end?r.end=Math.max(r.end,s.end):e.push({...s})}return e}function tk(n){const t=[],e=nk(f.state);return e!==null&&e>0&&t.push({start:pi(0,n),end:pi(e,n)}),n.placedTonicSigns.forEach(s=>{const r=pi(s.columnIndex,n),i=pi(s.columnIndex+2,n);t.push({start:r,end:i})}),Z5(t)}function ek(n,t,e){const s=new Set([n,t]);e.forEach(o=>{const A=Math.max(n,Math.min(t,o.start)),a=Math.max(n,Math.min(t,o.end));a>A&&(s.add(A),s.add(a))});const r=Array.from(s).sort((o,A)=>o-A),i=[];for(let o=0;o<r.length-1;o++){const A=r[o],a=r[o+1],l=(A+a)/2,c=e.some(u=>l>=u.start&&l<u.end);a>A&&i.push({from:A,to:a,light:c})}return i}function nk(n){if(!n.hasAnacrusis||!Array.isArray(n.macrobeatBoundaryStyles))return null;const t=n.macrobeatBoundaryStyles.findIndex(s=>s==="solid");if(t<0)return null;const e=mn(n,t);return e?e.endColumn+1:null}function pi(n,t){return lt(n,t)}function Fb(n,t,e,s,r,i,o=1){const A=e+r/2,a=s+i/2,l=Math.min(r,i)*.4*o;if(n.beginPath(),t===0)n.moveTo(A,a-l),n.lineTo(A-l,a+l),n.lineTo(A+l,a+l),n.closePath();else if(t===1)n.moveTo(A,a-l),n.lineTo(A+l,a),n.lineTo(A,a+l),n.lineTo(A-l,a),n.closePath();else{for(let u=0;u<5;u++){const d=2*Math.PI/5*u-Math.PI/2,p=A+l*Math.cos(d),h=a+l*Math.sin(d);u===0?n.moveTo(p,h):n.lineTo(p,h)}n.closePath()}n.fill()}function sk(n,t){const{columnWidths:e,musicalColumnWidths:s,macrobeatGroupings:r,macrobeatBoundaryStyles:i,placedTonicSigns:o}=t,a=(s&&s.length>0?s:e).length,l=r.map((c,u)=>{const{endColumn:d}=mn(f.state,u);return d+1});for(let c=0;c<=a;c++){const u=c===0||c===a,d=eB(c,o),p=o.some(w=>c===w.columnIndex+2),h=l.includes(c);if(!nB(c,o))continue;let g=null;if(u||d||p)g={lineWidth:2,strokeStyle:"#adb5bd",dash:[]};else if(h){const w=l.indexOf(c),y=i[w];if(y==="anacrusis"){const{stroke:I}=Ib();g={lineWidth:1,strokeStyle:I,dash:[4,4]}}else g={lineWidth:1,strokeStyle:"#adb5bd",dash:y==="solid"?[]:[5,5]}}if(!g)continue;const v=pi(c,t);n.beginPath(),n.moveTo(v,0),n.lineTo(v,ie(n.canvas)),n.lineWidth=g.lineWidth,n.strokeStyle=g.strokeStyle,n.setLineDash(g.dash),n.stroke()}n.setLineDash([])}function rk(n,t){const{placedNotes:e,columnWidths:s,cellWidth:r,cellHeight:i,placedTonicSigns:o}=t;n.clearRect(0,0,$e(n.canvas),ie(n.canvas));const A=Math.max(sa,ra*i),a=s.length,l=["H","M","L"],c=tk(t),u=ek(0,$e(n.canvas),c),{stroke:d}=Ib();for(let p=0;p<4;p++){const h=p*A;u.forEach(m=>{m.to<=m.from||(n.beginPath(),n.moveTo(m.from,h),n.lineTo(m.to,h),n.strokeStyle=m.light?d:"#ced4da",n.lineWidth=1,n.globalAlpha=m.light?.6:1,n.stroke(),n.globalAlpha=1)})}sk(n,t);for(let p=0;p<a;p++){if(o.some(g=>p===g.columnIndex||p===g.columnIndex+1))continue;const h=pi(p,t);let m;t.tempoModulationMarkers&&t.tempoModulationMarkers.length>0?m=pi(p+1,t)-h:m=(s[p]??0)*r;for(let g=0;g<3;g++){const v=g*A,w=l[g],y=e.find(I=>I.isDrum&&(typeof I.drumTrack=="number"?String(I.drumTrack):I.drumTrack)===w&&I.startColumnIndex===p);if(y){n.fillStyle=y.color;const I=rr.getAnimationScale(p,w);Fb(n,g,h,v,m,A,I)}else n.fillStyle="#ced4da",n.beginPath(),n.arc(h+m/2,v+A/2,2,0,Math.PI*2),n.fill()}}t.tempoModulationMarkers&&t.tempoModulationMarkers.length>0&&gB(n,t)}const Ps={getColumnIndex(n){const{cellWidth:t,tempoModulationMarkers:e,cellHeight:s,musicalColumnWidths:r}=f.state,i=f.state.columnWidths||[];if(t===0)return 0;const o={...f.state,tempoModulationMarkers:e,cellWidth:t,columnWidths:i,baseMicrobeatPx:f.state.baseMicrobeatPx||t},A=uh(n,o),a=Math.floor(A);return a},getPitchRowIndex(n){const t=qe.getViewportInfo();if(!(t!=null&&t.halfUnit)||t.halfUnit===0)return-1;const e=t.halfUnit,s=Math.round(n/e-1),r=t.startRank+s,i=t.startRank,o=Math.max(i,(t.endRank??i+1)-1);return Math.max(i,Math.min(o,r))},getDrumRowIndex(n){const t=Math.max(sa,ra*f.state.cellHeight);return t===0?-1:Math.floor(n/t)}},Gp=["H","M","L"],ik="canvas-container",ok="drum-grid-wrapper",Tb="eraser-tool-button",Ak="drum-grid",ak="drum-hover-canvas";let dn=null,Wc=!1,va=!1,rc=1,Gs=null,K0=0;const lk=500,Gc=n=>{f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths:f.state.columnWidths;const t={tempoModulationMarkers:f.state.tempoModulationMarkers||[],columnWidths:f.state.columnWidths,cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,baseMicrobeatPx:f.state.baseMicrobeatPx||f.state.cellWidth||40};return lt(n,t)},_b=n=>{if(f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0){const r=Gc(n);return Gc(n+1)-r}return((f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths:f.state.columnWidths)[n]??1)*f.state.cellWidth},Kc=()=>Math.max(sa,ra*f.state.cellHeight),Kp=()=>{dn&&dn.clearRect(0,0,$e(dn.canvas),ie(dn.canvas))};function lf(n,t,e){if(!dn)return;const s=Gc(n),r=t*Kc(),i=_b(n);dn.fillStyle=e,dn.fillRect(s,r,i,Kc())}function ck(n,t){var a;if(!dn)return;const e=Gc(n),s=t*Kc(),r=_b(n),i=Gp[t];if(!i)return;const o=rr.getAnimationScale(n,i),A=((a=f.state.selectedTool)==null?void 0:a.color)??"#212529";dn.globalAlpha=.4,dn.fillStyle=A,Fb(dn,t,e,s,r,Kc(),o),dn.globalAlpha=1}const Mb=()=>{const n=document.getElementById(ik);return(n==null?void 0:n.scrollLeft)??0};function uk(n){var l;const t=n.currentTarget;if(!t)return;const e=t.getBoundingClientRect(),s=n.clientX-e.left,r=n.clientY-e.top,i=Ps.getColumnIndex(s+Mb()),o=Ps.getDrumRowIndex(r),A=f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths.length:f.state.columnWidths.length;if(!dn||i<0||i>=A||o<0||o>2){qp();return}Kp();const a=Gp[o];a&&(Wc?((l=f.eraseDrumNoteAt)!=null&&l.call(f,i,a,!1)&&(va=!0),lf(i,o,"rgba(220, 53, 69, 0.3)")):(lf(i,o,"rgba(74, 144, 226, 0.2)"),ck(i,o)))}function qp(){Kp()}function dk(n){var l,c,u,d;n.preventDefault();const t=n.currentTarget;if(!t)return;const e=t.getBoundingClientRect(),s=n.clientX-e.left,r=n.clientY-e.top,i=Ps.getColumnIndex(s+Mb()),o=f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths.length:f.state.columnWidths.length;if(i<0||i>=o||!A_(i,f.state))return;const A=Ps.getDrumRowIndex(r);if(A<0||A>2)return;const a=Gp[A];if(a){if(n.button===2){Wc=!0,va=!1,(l=document.getElementById(Tb))==null||l.classList.add("erasing-active"),(c=f.eraseDrumNoteAt)!=null&&c.call(f,i,a,!1)&&(va=!0),Kp(),lf(i,A,"rgba(220, 53, 69, 0.3)");return}if(n.button===0){const p=((u=f.state.selectedTool)==null?void 0:u.color)??"#000000",h={isDrum:!0,drumTrack:a,startColumnIndex:i,endColumnIndex:i,color:p,shape:a==="H"?"triangle":a==="M"?"square":"pentagon"};(d=f.toggleDrumNote)==null||d.call(f,h);const m=window.transportService,g=m==null?void 0:m.drumPlayers;g!=null&&g.player&&(g.player(a).start(),rr.triggerNotePop(i,a))}}}function hk(){var n,t;Wc&&(va&&((n=f.recordState)==null||n.call(f)),Wc=!1,va=!1,(t=document.getElementById(Tb))==null||t.classList.remove("erasing-active")),qp()}function fk(){const n=document.getElementById(ok),t=n==null?void 0:n.querySelector(".drum-grid-left-cell");if(!n||!t)return;let e=t.querySelector(".drum-left-content");if(!e){e=document.createElement("div"),e.className="drum-left-content";const o=e,A=document.createElement("button");A.className="drum-volume-button",A.type="button",A.setAttribute("aria-label","Drum volume"),A.innerHTML=`
      <span class="drum-volume-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false" role="img">
          <path d="M3 10v4h4l5 5V5L7 10H3z" fill="currentColor"></path>
          <path d="M16 8.82v6.36c1.18-.85 2-2.22 2-3.64s-.82-2.79-2-3.64z" fill="currentColor"></path>
          <path d="M16 4v2c2.9 1.06 5 3.86 5 7s-2.1 5.94-5 7v2c4.01-1.15 7-4.97 7-9s-2.99-7.85-7-9z" fill="currentColor"></path>
        </svg>
      </span>
    `,A.style.gridRow="1 / span 3",A.style.gridColumn="1",["H","M","L"].forEach((a,l)=>{const c=document.createElement("span");c.className="drum-track-label",c.textContent=a,c.style.gridColumn="2",c.style.gridRow=`${l+1}`,o.appendChild(c)}),o.appendChild(A),t.appendChild(o)}const s=document.createElement("div");s.className="drum-volume-control",Gs=document.createElement("input"),Gs.type="range",Gs.min="0",Gs.max="100",Gs.value="100",Gs.className="drum-volume-slider",Gs.style.cssText="width: 80px; margin: 0;",Gs.addEventListener("input",o=>{const A=o.currentTarget;rc=Number(A.value)/100;const a=window.drumVolumeNode;if(a!=null&&a.volume){const l=rc===0?-60:20*Math.log10(rc);a.volume.value=l;const c=window.transportService,u=c==null?void 0:c.drumPlayers,d=Date.now();u!=null&&u.player&&d-K0>=lk&&(u.player("M").start("+0.1"),K0=d)}}),s.appendChild(Gs),t.appendChild(s);const r=()=>{if(!s)return;s.classList.contains("visible")?s.classList.remove("visible"):s.classList.add("visible")},i=t.querySelector(".drum-volume-button");i&&i.addEventListener("click",o=>{o.stopPropagation(),r()}),document.addEventListener("click",o=>{const A=o.target,a=A==null?void 0:A.closest(".drum-volume-control"),l=A==null?void 0:A.closest(".drum-volume-button");!a&&!l&&s.classList.remove("visible")})}function pk(){return rc}window.getDrumVolume=pk;function mk(){const n=document.getElementById(Ak),t=document.getElementById(ak);!n||!t||(dn=t.getContext("2d"),n.addEventListener("mousedown",dk),n.addEventListener("mousemove",uk),n.addEventListener("mouseleave",qp),n.addEventListener("contextmenu",e=>e.preventDefault()),window.addEventListener("mouseup",hk),fk())}function q0(){const n=oa.getDrumContext();if(!(n!=null&&n.canvas))return;const t={placedNotes:OT(f.state),placedTonicSigns:Ye(f.state),columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.musicalColumnWidths,cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,macrobeatGroupings:f.state.macrobeatGroupings,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth};rk(n,t)}const tn={animationFrameId:null,render(){q0(),rr.hasActiveAnimations()?tn.animationFrameId||tn.startAnimationLoop():tn.stopAnimationLoop()},startAnimationLoop(){if(tn.animationFrameId)return;const n=()=>{rr.cleanupAnimations(),q0(),rr.hasActiveAnimations()?tn.animationFrameId=requestAnimationFrame(n):tn.animationFrameId=null};tn.animationFrameId=requestAnimationFrame(n)},stopAnimationLoop(){tn.animationFrameId&&(cancelAnimationFrame(tn.animationFrameId),tn.animationFrameId=null)}};window.drumGridRenderer=tn;const gk=Symbol("store-context");function vk(n,t){Me(t,!0),nL(gk,{store:f});function e(){var o;try{Vo.render(),(o=tn.render)==null||o.call(tn),E.debug("StoreContext","renderAll invoked",null,"grid")}catch(A){E.error("StoreContext","renderAll failed",A,"grid")}}Qn(()=>{const o=()=>{Wt.setBpm(f.state.tempo)},A=()=>{fe.reflow()},a=()=>{re.refresh&&re.refresh()},l=()=>{Vo.renderMacrobeatTools()},c=()=>{fe.reflow()},u=()=>{fe.reflow(),e()};return f.on("tempoChanged",o),f.on("layoutChanged",A),f.on("rhythmPatternChanged",a),f.on("notesChanged",e),f.on("sixteenthStampPlacementsChanged",e),f.on("tripletStampPlacementsChanged",e),f.on("accidentalModeChanged",e),f.on("frequencyLabelsChanged",e),f.on("focusColoursChanged",e),f.on("octaveLabelsChanged",e),f.on("degreeDisplayModeChanged",e),f.on("longNoteStyleChanged",e),f.on("layoutConfigChanged",l),f.on("rhythmStructureChanged",c),f.on("tempoModulationMarkersChanged",u),E.initSuccess("StoreContext"),()=>{f.off("tempoChanged",o),f.off("layoutChanged",A),f.off("rhythmPatternChanged",a),f.off("notesChanged",e),f.off("sixteenthStampPlacementsChanged",e),f.off("tripletStampPlacementsChanged",e),f.off("accidentalModeChanged",e),f.off("frequencyLabelsChanged",e),f.off("focusColoursChanged",e),f.off("octaveLabelsChanged",e),f.off("degreeDisplayModeChanged",e),f.off("longNoteStyleChanged",e),f.off("layoutConfigChanged",l),f.off("rhythmStructureChanged",c),f.off("tempoModulationMarkersChanged",u)}});var s=Oc(),r=fa(s);{var i=o=>{var A=Oc(),a=fa(A);GL(a,()=>t.children),Un(o,A)};Wa(r,o=>{t.children&&o(i)})}Un(n,s),Qe()}function wk(n,t){var C;Me(t,!0);const e=1,s=31,r=0,i=2;let o=!1,A=!1,a=!1,l=((C=f.state.selectedNote)==null?void 0:C.color)||"#4a90e2",c=null,u=null,d=null,p=null,h=null,m=null,g=null;function v(){if(!l)return null;const b=f.state.timbres[l];return b?(b.filter?b.filter.enabled===void 0&&(b.filter.enabled=!0):b.filter={enabled:!0,blend:1,cutoff:16,resonance:0,type:"lowpass",mix:0},b.filter):null}function w(){const b=v();if(!b)return;const{cutoff:S=16,blend:T=0,mix:x=0}=b;if(c&&u){const _=(i-T)/(i-r);c.style.left=`${_*100}%`,u.style.setProperty("--progress",`${_*100}%`)}if(m&&g){const _=(x||0)/100;m.style.bottom=`${_*100}%`,g.style.setProperty("--blend-progress",`${_*100}%`)}if(d&&p){const _=(S-e)/(s-e);d.style.left=`${_*100}%`,d.style.top="50%",d.style.transform="translate(-50%, -50%)",p.style.setProperty("--progress",`${_*100}%`)}h&&l&&h.style.setProperty("--c-accent",l)}function y(b){if(!o||!l||!p)return;const S=p.getBoundingClientRect(),T=b.clientX-S.left,x=S.width;let _=T/x;_=Math.max(0,Math.min(1,_));const F=_*(s-e)+e;f.setFilterSettings(l,{cutoff:F})}function I(b){if(!A||!l||!u)return;const S=u.getBoundingClientRect(),T=b.clientX-S.left,x=S.width;let _=T/x;_=Math.max(0,Math.min(1,_));const F=i-_*(i-r);f.setFilterSettings(l,{blend:F})}function B(b){if(!a||!l||!g)return;const S=g.getBoundingClientRect(),T=b.clientY-S.top,x=S.height;let _=1-T/x;_=Math.max(0,Math.min(1,_));const F=_*100;f.setFilterSettings(l,{mix:F})}Qn(()=>{if(h=document.querySelector(".filter-container"),c=document.getElementById("thumb-b"),u=document.getElementById("blend-slider-container"),d=document.getElementById("thumb-c"),p=document.getElementById("cutoff-slider-container"),g=document.getElementById("vertical-blend-track"),m=document.getElementById("vertical-blend-thumb"),!h||!c||!d||!m||!g){E.error("FilterControlsBridge","Missing required elements",{container:h,blendThumb:c,cutoffThumb:d,verticalBlendSlider:m,verticalBlendTrack:g},"filter");return}const b=F=>{F.preventDefault(),A=!0,document.body.style.cursor="ew-resize";const Q=W=>I(W),U=()=>{A=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",Q),window.removeEventListener("pointerup",U),f.recordState()};window.addEventListener("pointermove",Q),window.addEventListener("pointerup",U)},S=F=>{F.preventDefault(),o=!0,document.body.style.cursor="ew-resize";const Q=W=>y(W),U=()=>{o=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",Q),window.removeEventListener("pointerup",U),f.recordState()};window.addEventListener("pointermove",Q),window.addEventListener("pointerup",U)},T=F=>{F.preventDefault(),a=!0,document.body.style.cursor="ns-resize";const Q=W=>B(W),U=()=>{a=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",Q),window.removeEventListener("pointerup",U),f.recordState()};window.addEventListener("pointermove",Q),window.addEventListener("pointerup",U)};c.addEventListener("pointerdown",b),d.addEventListener("pointerdown",S),m.addEventListener("pointerdown",T);const x=({newNote:F}={})=>{F!=null&&F.color&&F.color!==l&&(l=F.color,w())},_=F=>{F&&F===l&&w()};return f.on("noteChanged",x),f.on("timbreChanged",_),w(),E.info("FilterControlsBridge","Filter controls initialized",null,"filter"),()=>{c==null||c.removeEventListener("pointerdown",b),d==null||d.removeEventListener("pointerdown",S),m==null||m.removeEventListener("pointerdown",T),f.off("noteChanged",x),f.off("timbreChanged",_)}}),Qe()}function Pl(n,t){if(!(typeof window>"u"||!window.__adsrFlowDebug)){if(t===void 0){console.log("[ADSR Flow]",n);return}console.log("[ADSR Flow]",n,t)}}function Bk(n,{width:t,height:e},s){for(;n.firstChild;)n.removeChild(n.firstChild);if(s>0){for(let A=1;A<=5;A++)if(A<=s){const a=A/s*t,l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(a)),l.setAttribute("y",String(e-5)),l.setAttribute("fill","#d0d0d0"),l.setAttribute("font-size","24"),l.setAttribute("font-weight","bold"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","auto"),l.setAttribute("opacity","0.3"),l.textContent=`${A}s`,n.appendChild(l)}}const r=f.state.tempo;if(r<=0||s<=0)return;const i=30/r;let o=0;for(let A=i;A<s;A+=i){const a=A/s*t,l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",String(a)),l.setAttribute("y1","0"),l.setAttribute("x2",String(a)),l.setAttribute("y2",String(e));const c=(o+1)%2===0;l.setAttribute("stroke",c?"#adb5bd":"#ced4da"),l.setAttribute("stroke-width",c?"1":"0.5"),l.setAttribute("stroke-dasharray","3,3"),n.appendChild(l),o++}}function Ck(n,t,e,{height:s,width:r},i,o,A){for(;n.firstChild;)n.removeChild(n.firstChild);for(;t.firstChild;)t.removeChild(t.firstChild);if(e.length<4)return;const a=e[0],l=e[1],c=e[2],u=e[3];if(!a||!l||!c||!u)return;const d=f.state.colorPalette[i]||{primary:i,light:i},p=d.primary,h=d.light;let m={time:0,feedback:0};if(window.effectsCoordinator&&(m=window.effectsCoordinator.getEffectParameters(i,"delay")),A&&A.clearRect(0,0,r,s),(m.time||0)>0&&(m.feedback||0)>0&&o){const S=Math.max(.01,(m.time||0)/100*.5),T=Math.min(.95,(m.feedback||0)/100),x=.05;let _=T,F=0;for(;_>x&&F<10;){F++;const Q=S*F/o*r,U=e.map(R=>({x:R.x+Q,y:R.y})),W=U[0],D=U[3];if(!(!W||!D)){if(W.x<r){const R=document.createElementNS("http://www.w3.org/2000/svg","polygon"),N=`${W.x},${s} `+U.map(J=>`${J.x},${J.y}`).join(" ")+` ${Math.min(D.x,r)},${s}`;R.setAttribute("points",N),R.setAttribute("fill",xs(h,.7*_)),R.setAttribute("class","delay-echo"),n.appendChild(R);const q=document.createElementNS("http://www.w3.org/2000/svg","polyline");q.setAttribute("points",U.map(J=>`${J.x},${J.y}`).join(" ")),q.setAttribute("stroke-width","2"),q.setAttribute("fill","none"),q.setAttribute("stroke",xs(p,_)),q.setAttribute("class","delay-echo"),n.appendChild(q)}_*=T}}}const g=document.createElementNS("http://www.w3.org/2000/svg","polygon"),v=`0,${s} `+e.map(S=>`${S.x},${S.y}`).join(" ")+` ${r},${s}`;g.setAttribute("points",v),g.setAttribute("fill",xs(h,.7)),n.appendChild(g);const w=document.createElementNS("http://www.w3.org/2000/svg","line");w.setAttribute("x1",String(a.x)),w.setAttribute("y1",String(a.y)),w.setAttribute("x2",String(l.x)),w.setAttribute("y2",String(l.y)),w.setAttribute("stroke",p),w.setAttribute("stroke-width","2"),n.appendChild(w);const y=document.createElementNS("http://www.w3.org/2000/svg","line");y.setAttribute("x1",String(l.x)),y.setAttribute("y1",String(l.y)),y.setAttribute("x2",String(c.x)),y.setAttribute("y2",String(c.y)),y.setAttribute("stroke",p),y.setAttribute("stroke-width","2"),n.appendChild(y);const I=1,B=document.createElementNS("http://www.w3.org/2000/svg","line");B.setAttribute("x1",String(c.x)),B.setAttribute("y1",String(c.y)),B.setAttribute("x2",String(u.x)),B.setAttribute("y2",String(u.y)),B.setAttribute("stroke",xs(p,I)),B.setAttribute("stroke-width","2"),n.appendChild(B);const C=["attack-node","decay-sustain-node","release-node"];[l,c,u].forEach((S,T)=>{const x=document.createElementNS("http://www.w3.org/2000/svg","circle");x.setAttribute("id",C[T]),x.setAttribute("class","adsr-node"),x.setAttribute("cx",String(S.x)),x.setAttribute("cy",String(S.y)),x.setAttribute("r","8"),x.setAttribute("fill",p),x.setAttribute("stroke",Lu(p,-.3)),x.setAttribute("stroke-width","2"),x.style.cursor="grab";const _=document.createElementNS("http://www.w3.org/2000/svg","title");x.appendChild(_),t.appendChild(x)})}function bk(n,t){if(!n)return;const e=Lu(t,-.2);n.style.setProperty("--c-accent",t),n.style.setProperty("--c-accent-hover",e)}var yk=ti('<canvas class="adsr-reverb-canvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></canvas> <svg width="100%" height="100%"><g></g><g></g><g></g></svg>',1);function Sk(n,t){var Y;Me(t,!0);const e=2.5,s=.01,r=1e-4;let i=0,o=0,A=0,a=0,l=((Y=f.state.selectedNote)==null?void 0:Y.color)||"#4a90e2",c=f.state.adsrTimeAxisScale,u=0,d=0,p=!1,h=null,m=null,g=null,v=null,w=null,y=null,I=null,B=null,C=null,b=null,S=null,T=null,x=null,_=null;function F(){if(p)return;p=!0;const P=()=>{p=!1,q(),N()};typeof requestAnimationFrame=="function"?requestAnimationFrame(P):setTimeout(P,0)}function Q(P){var O,X;let st=1;const L=window.animationEffectsManager;return(O=L==null?void 0:L.shouldTremoloBeRunning)!=null&&O.call(L)&&(st=L.getADSRTremoloAmplitudeMultiplier(P)),(((X=window.waveformVisualizer)==null?void 0:X.calculatedAmplitude)??1)*st}function U(P){const st=Q(l);if(!Number.isFinite(st))return P;if(P.sustain-st>r){const L={...P,sustain:st};return f.setADSR(l,L),Pl("adsrEnvelope:clampSustain",{color:l,adsr:L,normalizedAmplitude:st}),L}return P}function W(){const P=f.state.timbres[l];if(!P)return;const st=U(P.adsr);i=st.attack,o=st.decay,A=st.sustain,a=st.release,F()}function D(){return e*c}function R(P){const st=f.state.timbres[l];if(!st)return;const{sustain:L}=st.adsr,K={...P};K.d=Math.max(K.a+s,K.d),K.r=Math.max(K.d+s,K.r);const O=K.a,X=K.d-K.a,tt=K.r-K.d;if(Number.isNaN(O)||Number.isNaN(X)||Number.isNaN(tt)){E.error("ADSREnvelope","NaN value detected before setting ADSR. Aborting update.",{nextAttack:O,nextDecay:X,nextRelease:tt},"audio");return}const k={attack:O,decay:X,release:tt,sustain:L};f.setADSR(l,k),Pl("adsrEnvelope:updateADSRFromAbsoluteTimes",{color:l,adsr:k})}function N(){if(!v||!g||!y||!I||!B||!w||!f.state.timbres[l])return;const L=Q(l)*100,K=A*100;v.style.bottom=`${K}%`,g.style.setProperty("--sustain-progress",`${K}%`);const O=100-L;g.style.setProperty("--ineligible-height",`${O}%`);const X=D(),tt=X>0?i/X*100:0,k=X>0?(i+o)/X*100:0,z=X>0?(i+o+a)/X*100:0;y.style.left=`${tt}%`,I.style.left=`${k}%`,B.style.left=`${z}%`,w.style.setProperty("--adr-progress",`${z}%`);const $=Ct=>`${Ct.toFixed(3)}s`,rt=Ct=>`${(Ct*100).toFixed(0)}%`;y.title=`Attack: ${$(i)}`,I.title=`Decay: ${$(o)}`,B.title=`Release: ${$(a)}`,v.title=`Sustain: ${rt(A)}`;const et=_==null?void 0:_.querySelector("#attack-node > title");et&&(et.textContent=`Attack: ${$(i)}`);const it=_==null?void 0:_.querySelector("#decay-sustain-node > title");it&&(it.textContent=`Decay: ${$(o)}
Sustain: ${rt(A)}`);const at=_==null?void 0:_.querySelector("#release-node > title");at&&(at.textContent=`Release: ${$(a)}`)}function q(){if(!T||!x||!_||!u||!d)return;const P=D();if(!Number.isFinite(P)||P<=0)return;const st=Q(l);if(!Number.isFinite(st))return;const L=O=>O/P*u,K=[{x:0,y:d},{x:L(i),y:d*(1-st)},{x:L(i+o),y:d*(1-Math.min(A*st,st))},{x:L(i+o+a),y:d}];Bk(T,{width:u,height:d},P),Ck(x,_,K,{width:u,height:d},l,P,b),bk(m,l)}function J(){if(!h)return;const P=h.clientWidth,st=h.clientHeight;if(!(P<=0||st<=0)){if(u=P,d=st,C){const L=window.devicePixelRatio||1;C.width=P*L,C.height=st*L,b||(b=C.getContext("2d")),b&&(b.setTransform(1,0,0,1,0,0),b.scale(L,L))}S&&S.setAttribute("viewBox",`0 0 ${P} ${st}`),F()}}Qn(()=>{if(h=document.getElementById("adsr-envelope"),!h){E.error("ADSREnvelope","ADSR container element not found",null,"adsr");return}m=h.closest(".adsr-container"),g=document.getElementById("sustain-slider-track"),v=document.getElementById("sustain-slider-thumb"),w=document.getElementById("multi-thumb-slider-container"),y=document.getElementById("thumb-a"),I=document.getElementById("thumb-d"),B=document.getElementById("thumb-r"),b=(C==null?void 0:C.getContext("2d"))??null;const P=new ResizeObserver(()=>J());return P.observe(h),J(),()=>{P.disconnect()}}),Qn(()=>{const P=(tt={})=>{var z;const k=(z=tt.newNote)==null?void 0:z.color;k&&k!==l&&(l=k,W())},st=tt=>{tt===l&&W()},L=()=>F(),K=()=>{c=f.state.adsrTimeAxisScale,F()},O=tt=>{var k;(k=tt==null?void 0:tt.activeColors)!=null&&k.includes(l)&&F()},X=tt=>{tt&&tt.color===l&&(tt.effectType==="delay"||tt.effectType==="reverb")&&F()};return f.on("noteChanged",P),f.on("timbreChanged",st),f.on("tempoChanged",L),f.on("adsrTimeAxisScaleChanged",K),f.on("tremoloAmplitudeUpdate",O),f.on("audioEffectChanged",X),W(),()=>{f.off("noteChanged",P),f.off("timbreChanged",st),f.off("tempoChanged",L),f.off("adsrTimeAxisScaleChanged",K),f.off("tremoloAmplitudeUpdate",O),f.off("audioEffectChanged",X)}}),Qn(()=>{if(!g||!w||!S||!_)return;let P=!1,st=null,L=null;const K=it=>{var gt,mt;if(!P||!g)return;const at=g.getBoundingClientRect();let yt=100-(it.clientY-at.top)/at.height*100;yt=Math.max(0,Math.min(100,yt));const Et=(((mt=(gt=window.waveformVisualizer)==null?void 0:gt.getNormalizedAmplitude)==null?void 0:mt.call(gt))||1)*100;yt=Math.min(yt,Et);const Qt=f.state.timbres[l];if(!Qt)return;const ct={...Qt.adsr,sustain:yt/100};f.setADSR(l,ct),Pl("adsrEnvelope:sustainSlider",{color:l,adsr:ct})},O=it=>{P=!0,K(it)},X=()=>{P=!1},tt=it=>{if(!st||!w)return;const at=w.getBoundingClientRect();let yt=(it.clientX-at.left)/at.width*100;yt=Math.max(0,Math.min(100,yt));const Bt=yt/100*D(),Et=f.state.timbres[l];if(!Et)return;const{attack:Qt,decay:ct,release:gt}=Et.adsr,mt={a:Qt,d:Qt+ct,r:Qt+ct+gt};st.id==="thumb-a"&&(mt.a=Bt),st.id==="thumb-d"&&(mt.d=Bt),st.id==="thumb-r"&&(mt.r=Bt),R(mt)},k=it=>{const at=it.target;at!=null&&at.classList.contains("time-slider-thumb")&&(st=at,tt(it))},z=()=>{st=null},$=it=>{var jn,ni;if(!L||!S||!u||!d)return;const at=S.createSVGPoint();at.x=it.clientX,at.y=it.clientY;const Ct=S.getScreenCTM();if(!Ct)return;const yt=at.matrixTransform(Ct.inverse());let Bt=yt.x/u*100,Et=1-yt.y/d;Bt=Math.max(0,Math.min(100,Bt)),Et=Math.max(0,Math.min(1,Et));const Qt=Bt/100*D(),ct=f.state.timbres[l];if(!ct)return;const{attack:gt,decay:mt,release:Ot}=ct.adsr;let ve=ct.adsr.sustain;const we={a:gt,d:gt+mt,r:gt+mt+Ot};switch(L.id){case"attack-node":we.a=Qt;break;case"decay-sustain-node":{we.d=Qt;const si=((ni=(jn=window.waveformVisualizer)==null?void 0:jn.getNormalizedAmplitude)==null?void 0:ni.call(jn))||1;ve=Math.min(Et,si);break}case"release-node":we.r=Qt;break}const wr=ct.adsr.sustain;if(ve!==wr){const si={attack:gt,decay:mt,release:Ot,sustain:ve};f.setADSR(l,si),Pl("adsrEnvelope:nodeDragSustain",{color:l,adsr:si})}R(we)},rt=it=>{const at=it.target;at!=null&&at.classList.contains("adsr-node")&&(L=at,L.style.cursor="grabbing",$(it))},et=()=>{L&&(L.style.cursor="grab",L=null)};return g.addEventListener("pointerdown",O),document.addEventListener("pointermove",K),document.addEventListener("pointerup",X),w.addEventListener("pointerdown",k),document.addEventListener("pointermove",tt),document.addEventListener("pointerup",z),_.addEventListener("pointerdown",rt),document.addEventListener("pointermove",$),document.addEventListener("pointerup",et),()=>{g==null||g.removeEventListener("pointerdown",O),document.removeEventListener("pointermove",K),document.removeEventListener("pointerup",X),w==null||w.removeEventListener("pointerdown",k),document.removeEventListener("pointermove",tt),document.removeEventListener("pointerup",z),_==null||_.removeEventListener("pointerdown",rt),document.removeEventListener("pointermove",$),document.removeEventListener("pointerup",et)}});var nt=yk(),At=fa(nt);oo(At,P=>C=P,()=>C);var ot=Ge(At,2),V=Fe(ot);oo(V,P=>T=P,()=>T);var H=Ge(V);oo(H,P=>x=P,()=>x);var G=Ge(H);oo(G,P=>_=P,()=>_),oo(ot,P=>S=P,()=>S),Un(n,nt),Qe()}E.moduleLoaded("EffectsCoordinator");class Ek{constructor(){this.effectParameters=new Map,this.defaultEffects={vibrato:{speed:0,span:0,wet:100},tremolo:{speed:0,span:0,wet:100},delay:{time:0,feedback:0,wet:20}},E.info("EffectsCoordinator","Initialized as main coordinator",null,"effects")}init(){return Object.keys(f.state.timbres).forEach(t=>{this.initializeColorEffects(t)}),f.on("timbreCreated",({color:t})=>{this.initializeColorEffects(t)}),this.loadSavedValues(),E.info("EffectsCoordinator","Event subscriptions established",null,"effects"),!0}initializeColorEffects(t){if(!this.effectParameters.has(t)){const e={};Object.entries(this.defaultEffects).forEach(([r,i])=>{e[r]={...i}}),this.effectParameters.set(t,e);const s=f.state.timbres[t];s&&(s.vibrato&&(e.vibrato={...s.vibrato}),s.tremelo&&(e.tremolo={...s.tremelo})),E.debug("EffectsCoordinator",`Initialized effects for color ${t}`,e,"effects")}}updateParameter(t,e,s,r){if(!r){E.warn("EffectsCoordinator","Cannot update parameter: no color provided",{effectType:t,parameter:e,value:s},"effects");return}this.initializeColorEffects(r);const i=this.effectParameters.get(r);i[t]||(i[t]={...this.defaultEffects[t]}),i[t][e]=s,this.notifyAudioSystem(t,e,s,r,i[t]),this.notifyAnimationSystem(t,e,s,r,i[t]),this.updateTimbreState(t,i[t],r),this.saveValues()}notifyAudioSystem(t,e,s,r,i){f.emit("audioEffectChanged",{effectType:t,parameter:e,value:s,color:r,effectParams:{...i}}),E.debug("EffectsCoordinator",`Notified audio system: ${t}.${e} = ${s} for ${r}`,null,"effects")}notifyAnimationSystem(t,e,s,r,i){(t==="vibrato"||t==="tremolo")&&(f.emit("visualEffectChanged",{effectType:t,parameter:e,value:s,color:r,effectParams:{...i}}),E.debug("EffectsCoordinator",`Notified animation system: ${t}.${e} = ${s} for ${r}`,null,"effects"))}updateTimbreState(t,e,s){const r=f.state.timbres[s];if(!r)return;const o={vibrato:"vibrato",tremolo:"tremelo"}[t];o&&(r[o]||(r[o]={}),Object.assign(r[o],e),f.recordState())}getEffectParameters(t,e){const s=this.effectParameters.get(t);return s!=null&&s[e]?{...s[e]}:{...this.defaultEffects[e]}}getAllEffectParameters(t){const e=this.effectParameters.get(t);return e?{...e}:{...this.defaultEffects}}resetColorEffects(t){const e={};Object.entries(this.defaultEffects).forEach(([s,r])=>{e[s]={...r}}),this.effectParameters.set(t,e),Object.keys(e).forEach(s=>{Object.keys(e[s]).forEach(r=>{this.notifyAudioSystem(s,r,e[s][r],t,e[s]),this.notifyAnimationSystem(s,r,e[s][r],t,e[s])})}),E.info("EffectsCoordinator",`Reset all effects for color ${t}`,e,"effects")}saveValues(){const t={};Object.keys(f.state.timbres).forEach(e=>{const s=this.effectParameters.get(e);s&&(t[e]={vibrato:s.vibrato||{speed:0,span:0,wet:100},tremelo:s.tremolo||{speed:0,span:0,wet:100},delay:s.delay||{time:0,feedback:0,wet:20}})});try{localStorage.setItem("effectDialValues",JSON.stringify(t)),E.debug("EffectsCoordinator","Saved effect values to localStorage",null,"effects")}catch(e){E.warn("EffectsCoordinator","Failed to save effect values to localStorage",e,"effects")}}loadSavedValues(){try{const t=localStorage.getItem("effectDialValues");if(!t){E.debug("EffectsCoordinator","No saved effect values found",null,"effects");return}const e=JSON.parse(t);E.debug("EffectsCoordinator","Loading saved effect values",null,"effects"),Object.keys(e).forEach(s=>{const r=f.state.timbres[s],i=e[s];r&&i&&(i.vibrato&&Object.entries(i.vibrato).forEach(([o,A])=>{typeof A=="number"&&this.updateParameter("vibrato",o,A,s)}),i.tremelo&&Object.entries(i.tremelo).forEach(([o,A])=>{typeof A=="number"&&this.updateParameter("tremolo",o,A,s)}),i.delay&&Object.entries(i.delay).forEach(([o,A])=>{typeof A=="number"&&this.updateParameter("delay",o,A,s)}))}),E.info("EffectsCoordinator","Applied saved effect values",null,"effects"),window.synthEngine&&Object.keys(e).forEach(s=>{const r=e[s];r.delay&&(r.delay.time>0||r.delay.feedback>0)&&(window.synthEngine.updateSynthForColor(s),E.debug("EffectsCoordinator",`Re-applied effects to synth for ${s}`,null,"effects"))})}catch(t){E.warn("EffectsCoordinator","Failed to load saved effect values",t,"effects")}}dispose(){this.effectParameters.clear(),E.info("EffectsCoordinator","Disposed",null,"effects")}}const Ir=new Ek;class xk{constructor(){M(this,"currentEffect",null);M(this,"effectControlsContainer",null);M(this,"effectButtons",[]);M(this,"dials",[]);M(this,"currentColor",null);M(this,"isDialInteractionActive",!1);M(this,"lastPreviewAt",{});M(this,"previewThrottleMs",180);M(this,"previewDurationMs",220);M(this,"previewPitch","C4");M(this,"holdPreviews",{});M(this,"effectConfigs",{delay:{name:"Delay",controls:{time:{label:"Time",min:0,max:100,default:0,unit:"%"},feedback:{label:"Echoes",min:0,max:95,default:0,unit:"%"},wet:{label:"Mix",min:0,max:100,default:15,unit:"%"}}},vibrato:{name:"Vibrato",controls:{speed:{label:"Speed",min:0,max:100,default:0,unit:"%"},span:{label:"Span",min:0,max:100,default:0,unit:"%"}}},tremolo:{name:"Tremolo",controls:{speed:{label:"Speed",min:0,max:100,default:0,unit:"%"},span:{label:"Span",min:0,max:100,default:0,unit:"%"}}}})}init(){return E.initStart("Effects Controller"),this.effectControlsContainer=document.getElementById("effect-controls"),this.effectButtons=document.querySelectorAll(".effect-button[data-effect]"),this.effectButtons.length>0&&this.setupEventListeners(),this.initializeSelectedColorTracking(),this.setupGlobalMouseUpHandler(),E.initSuccess("Effects Controller"),!0}setupGlobalMouseUpHandler(){document.addEventListener("mouseup",()=>{this.isDialInteractionActive&&this.onDialInteractionEnd(this.currentEffect)})}setupEventListeners(){this.effectButtons.forEach(t=>{t.addEventListener("click",e=>{const r=e.currentTarget.dataset.effect;r&&this.selectEffect(r)})})}selectEffect(t){if(E.debug("Effects",`Selecting effect: ${t}`,null,"ui"),!this.effectConfigs[t]){E.info("Effects",`Effect ${t} not configured`,null,"ui");return}if(this.effectButtons.forEach(e=>{e.classList.remove("active"),e.dataset.effect===t&&e.classList.add("active")}),this.currentEffect===t){this.currentEffect=null,this.hideEffectControls();return}this.currentEffect=t,this.showEffectControls(t)}showEffectControls(t){const e=this.effectConfigs[t];if(!e||!this.effectControlsContainer){E.warn("Effects",`No configuration found for effect: ${t}`,null,"ui");return}this.clearControls(),this.effectControlsContainer.innerHTML='<div class="effect-controls"></div>';const s=this.effectControlsContainer.querySelector(".effect-controls");s&&Object.entries(e.controls).forEach(([r,i])=>{var h;const o=this.currentColor?(h=Ir.getEffectParameters)==null?void 0:h.call(Ir,this.currentColor,t):null,A=(o==null?void 0:o[r])??i.default??0,a=document.createElement("div");a.className="effect-slider-group",a.style.cssText="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;",s.appendChild(a);const l=document.createElement("label");l.className="effect-slider-label",l.textContent=i.label,l.style.cssText="display: block; margin-bottom: 5px; font-weight: bold; color: #333;",a.appendChild(l);const c=document.createElement("input");c.type="range",c.min=`${i.min}`,c.max=`${i.max}`,c.value=`${A}`,c.className="effect-slider",c.style.cssText="width: 100%; margin: 5px 0;",a.appendChild(c);const u=document.createElement("div");u.className="effect-slider-value";const d=i.unit?`${Math.round(A)}${i.unit}`:Math.round(A);u.textContent=`${d}`,u.style.cssText="text-align: center; font-size: 12px; color: #666;",a.appendChild(u),this.dials.push({dial:{element:c,value:A,destroy:()=>{}},control:r,effectType:t,valueDisplay:u,controlConfig:i});const p=m=>{const g=m.target;if(!g)return;const v=parseFloat(g.value),w=i.unit?`${Math.round(v)}${i.unit}`:Math.round(v);u.textContent=`${w}`,E.debug("Effects",`${t} ${r}: ${v}`,null,"audio"),this.onEffectParameterChange(t,r,v)};c.addEventListener("input",p),c.addEventListener("change",p),c.addEventListener("mousedown",()=>this.onDialInteractionStart(t)),c.addEventListener("mouseup",()=>this.onDialInteractionEnd(t)),c.addEventListener("mouseleave",m=>{(m.buttons&1)===1&&this.onDialInteractionEnd(t)})})}hideEffectControls(){this.clearControls(),this.currentEffect=null}clearControls(){this.dials.forEach(t=>t.dial.destroy()),this.dials=[],this.effectControlsContainer&&(this.effectControlsContainer.innerHTML="")}onEffectParameterChange(t,e,s){var i;const r=this.currentColor||((i=f.state.selectedNote)==null?void 0:i.color);r&&Ir.updateParameter(t,e,s,r)}updateEffect(t,e){var r;const s=this.currentColor||((r=f.state.selectedNote)==null?void 0:r.color);s&&Object.entries(e).forEach(([i,o])=>{typeof o=="number"&&Ir.updateParameter(t,i,o,s)})}getEffectState(t){var s;const e=this.currentColor||((s=f.state.selectedNote)==null?void 0:s.color);return e?Ir.getEffectParameters(e,t)||{}:{}}getActiveColor(){var t;return this.currentColor||((t=f.state.selectedNote)==null?void 0:t.color)||null}getPreviewNotes(){var o;const t=this.getActiveColor();if(!t)return null;const e=f.state.placedNotes.slice().reverse().find(A=>!A.isDrum),s=e?((o=f.state.fullRowData[e.row])==null?void 0:o.toneNote)||this.previewPitch:this.previewPitch,r=f.state.selectedTool;let i=[s];return r==="chord"&&Array.isArray(f.state.activeChordIntervals)&&(i=f.state.activeChordIntervals.map(a=>UA(So(s,a)))),{pitches:i,root:s,color:t}}previewEffect(t){var a;const e=this.getActiveColor();if(!e)return;const s=Date.now(),r=this.lastPreviewAt[t]??0;if(s-r<this.previewThrottleMs)return;this.lastPreviewAt[t]=s;const{isPlaying:i,isPaused:o}=f.state;if(i&&!o)return;const A=`effect-preview-${t}`;(a=f.emit)==null||a.call(f,"noteAttack",{noteId:A,color:e});try{Wt.triggerAttack(this.previewPitch,e),setTimeout(()=>Wt.triggerRelease(this.previewPitch,e),this.previewDurationMs)}catch(l){E.warn("Effects","Preview trigger failed",{err:l},"audio")}finally{setTimeout(()=>{var l;return(l=f.emit)==null?void 0:l.call(f,"noteRelease",{noteId:A,color:e})},this.previewDurationMs)}}startHoldPreview(t){if(this.holdPreviews[t])return;const e=this.getPreviewNotes();if(!e)return;const{pitches:s,root:r,color:i}=e,o=`effect-hold-${t}-${Date.now()}`;this.holdPreviews[t]={pitches:s,root:r,color:i,noteId:o};const{isPlaying:A,isPaused:a}=f.state;if(A&&!a)return;s.forEach(c=>Wt.triggerAttack(c,i));const l=f.state.fullRowData.find(c=>c.toneNote===r);l&&l.hex,f.state.timbres[i],f.emit("spacebarPlayback",{note:r,color:i,isPlaying:!0}),f.emit("noteAttack",{noteId:o,color:i})}stopHoldPreview(t){const e=this.holdPreviews[t];if(!e)return;delete this.holdPreviews[t];const{pitches:s,root:r,color:i,noteId:o}=e;s.forEach(a=>Wt.triggerRelease(a,i));const A=f.state.fullRowData.find(a=>a.toneNote===r);A&&A.hex,f.state.timbres[i],f.emit("spacebarPlayback",{note:r,color:i,isPlaying:!1}),f.emit("noteRelease",{noteId:o,color:i})}initializeSelectedColorTracking(){var t;f.on("noteChanged",({newNote:e}={})=>{this.currentColor=(e==null?void 0:e.color)||null,this.currentColor&&this.currentEffect&&this.showEffectControls(this.currentEffect)}),this.currentColor=((t=f.state.selectedNote)==null?void 0:t.color)||null}onDialInteractionStart(t){if(this.isDialInteractionActive=!0,t){E.debug("Effects",`Dial interaction start for ${t}`,null,"ui");const e=this.getActiveColor();e&&f.emit("effectDialInteractionStart",{effectType:t,color:e}),this.startHoldPreview(t)}}onDialInteractionEnd(t){if(this.isDialInteractionActive=!1,t){E.debug("Effects",`Dial interaction end for ${t}`,null,"ui");const e=this.getActiveColor();e&&f.emit("effectDialInteractionEnd",{effectType:t,color:e}),this.stopHoldPreview(t)}}}const Fr=new xk;var Ik=DL('<svg class="svelte-w1yw4"><defs><pattern width="20" height="20" patternUnits="userSpaceOnUse"><rect width="20" height="20" fill="none" stroke-width="1"></rect></pattern></defs><rect x="0" y="0"></rect><rect x="0" y="0" opacity="0.2"></rect><line y1="0" stroke-width="1" opacity="0.6"></line><line x1="0" stroke-width="1" opacity="0.6"></line><circle r="10" stroke="#fff" stroke-width="2"></circle></svg>');function Fk(n,t){Me(t,!0);let e=Pn(t,"x",15,.5),s=Pn(t,"y",15,.5),r=Pn(t,"minX",3,0),i=Pn(t,"maxX",3,1),o=Pn(t,"stepX",3,0),A=Pn(t,"minY",3,0),a=Pn(t,"maxY",3,1),l=Pn(t,"stepY",3,0),c=Pn(t,"size",19,()=>[200,200]),u=Pn(t,"mode",3,"absolute"),d=Pn(t,"reverseX",3,!1),p=Pn(t,"colors",19,()=>({}));const h={accent:"#4a90e2",fill:"#1f1f1f",stroke:"#555",grid:"#333",text:"#fff"};let m=Rt(Tn({...h}));Qn(()=>{try{const ot=getComputedStyle(document.documentElement),V=ot.getPropertyValue("--c-surface").trim(),H=ot.getPropertyValue("--c-border").trim(),G=ot.getPropertyValue("--c-border-strong").trim(),Y=ot.getPropertyValue("--c-text").trim();St(m,{...h,fill:V||h.fill,stroke:H||h.stroke,grid:G||h.grid,text:Y||h.text,...p()},!0)}catch{St(m,{...h,...p()},!0)}});let g=Rt(!1),v=Rt(0),w=Rt(0);const y=fi(()=>c()[0]),I=fi(()=>c()[1]),B=`pos-grid-${Math.random().toString(36).slice(2,8)}`;function C(ot,V,H){return Math.max(V,Math.min(H,ot))}function b(ot,V,H,G){if(G<=0)return ot;const Y=ot-V,P=Math.round(Y/G),st=V+P*G;return C(st,V,H)}function S(){if(!(e()===r()&&s()===A())){if(e()===r()){const ot=o()>0?o():Math.max((i()-r())/100,.01);e(r()+ot)}if(s()===A()){const ot=l()>0?l():Math.max((a()-A())/100,.01);s(A()+ot)}}St(v,C((e()-r())/(i()-r()||1),0,1),!0),St(w,C((s()-A())/(a()-A()||1),0,1),!0)}const T=fi(()=>d()?(1-Z(v))*Z(y):Z(v)*Z(y)),x=fi(()=>u()==="absolute"?Z(w)*Z(I):(1-Z(w))*Z(I));function _(ot){var V,H;St(g,!0),F(ot),(H=(V=ot.target).setPointerCapture)==null||H.call(V,ot.pointerId)}function F(ot){var L;if(!Z(g))return;const H=ot.currentTarget.getBoundingClientRect(),G=(ot.clientX-H.left)/H.width,Y=d()?1-G:G,P=(ot.clientY-H.top)/H.height;St(v,C(Y,0,1),!0);const st=u()==="relative"?1-P:P;if(St(w,C(st,0,1),!0),e(r()+Z(v)*(i()-r())),s(A()+Z(w)*(a()-A())),o()>0&&e(b(e(),r(),i(),o())),l()>0&&s(b(s(),A(),a(),l())),!(e()===r()&&s()===A())){if(e()===r()){const K=o()>0?o():Math.max((i()-r())/100,.01);e(r()+K)}if(s()===A()){const K=l()>0?l():Math.max((a()-A())/100,.01);s(A()+K)}}St(v,C((e()-r())/(i()-r()||1),0,1),!0),St(w,C((s()-A())/(a()-A()||1),0,1),!0),(L=t.onchange)==null||L.call(t,{x:e(),y:s()})}function Q(ot){var V,H;St(g,!1),(H=(V=ot.target).releasePointerCapture)==null||H.call(V,ot.pointerId)}Qn(()=>{S()}),Qn(()=>{Z(g)||S()});var U=Ik();U.__pointerdown=_,U.__pointermove=F,U.__pointerup=Q,zL(U,"",{},{"touch-action":"none"});var W=Fe(U),D=Fe(W),R=Fe(D),N=Ge(W),q=Ge(N),J=Ge(q),nt=Ge(J),At=Ge(nt);Ii(()=>{Nt(U,"width",Z(y)),Nt(U,"height",Z(I)),Nt(U,"viewBox",`0 0 ${Z(y)??""} ${Z(I)??""}`),Nt(D,"id",B),Nt(R,"stroke",Z(m).grid),Nt(N,"width",Z(y)),Nt(N,"height",Z(I)),Nt(N,"fill",Z(m).fill),Nt(N,"stroke",Z(m).stroke),Nt(q,"width",Z(y)),Nt(q,"height",Z(I)),Nt(q,"fill",`url(#${B})`),Nt(J,"x1",Z(T)),Nt(J,"x2",Z(T)),Nt(J,"y2",Z(I)),Nt(J,"stroke",Z(m).grid),Nt(nt,"x2",Z(y)),Nt(nt,"y1",Z(x)),Nt(nt,"y2",Z(x)),Nt(nt,"stroke",Z(m).grid),Nt(At,"cx",Z(T)),Nt(At,"cy",Z(x)),Nt(At,"fill",Z(m).accent)}),vo("pointercancel",U,Q),Un(n,U),Qe()}Vu(["pointerdown","pointermove","pointerup"]);var Tk=ti('<div class="effects-cartesian-slider svelte-96fy48"><!></div>');function _k(n,t){var _;Me(t,!0);const e={delay:{xParam:"time",yParam:"feedback",xRange:{min:0,max:100,step:1},yRange:{min:0,max:95,step:1},backgroundOpacity:.2},vibrato:{xParam:"speed",yParam:"span",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1},backgroundOpacity:.5},tremolo:{xParam:"speed",yParam:"span",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1},backgroundOpacity:.5}},s=120;let r=Rt(null),i=null,o=Rt(null),A=Rt(null),a=Rt(Tn([s,s])),l=Rt(0),c=Rt(0),u=Rt(Tn({})),d=((_=f.state.selectedNote)==null?void 0:_.color)??null,p=!1;const h=F=>Math.max(0,Math.min(255,F)),m=(F,Q)=>{const U=F.replace("#",""),W=h(parseInt(U.slice(0,2),16)+Q),D=h(parseInt(U.slice(2,4),16)+Q),R=h(parseInt(U.slice(4,6),16)+Q);return`#${W.toString(16).padStart(2,"0")}${D.toString(16).padStart(2,"0")}${R.toString(16).padStart(2,"0")}`},g=(F,Q)=>{const U=F.replace("#",""),W=parseInt(U.slice(0,2),16),D=parseInt(U.slice(2,4),16),R=parseInt(U.slice(4,6),16);return`rgba(${W}, ${D}, ${R}, ${Q})`};function v(F){const Q=F.getBoundingClientRect();let U=(Q==null?void 0:Q.width)||F.clientWidth||F.offsetWidth||s,W=(Q==null?void 0:Q.height)||F.clientHeight||F.offsetHeight||U;return(!U||U<10)&&(U=s),(!W||W<10)&&(W=U),[Math.round(U),Math.round(W)]}function w(){i&&St(a,v(i),!0)}function y(F){var D;const Q=f.state.colorPalette[F]||{primary:F,light:F},U=Q.light||m(Q.primary,80),W=((D=Z(A))==null?void 0:D.backgroundOpacity)??.5;St(u,{accent:Q.primary,fill:g(U,W),stroke:"#c3c9d0",grid:"#d7dce4",text:"#3c4048"},!0)}function I(){if(!Z(A)||!Z(o))return;const F=Fr.getEffectState(Z(o))||{},Q=typeof F[Z(A).xParam]=="number"?F[Z(A).xParam]:Z(A).xRange.min,U=typeof F[Z(A).yParam]=="number"?F[Z(A).yParam]:Z(A).yRange.min;St(l,Q,!0),St(c,U,!0)}function B({x:F,y:Q}){!Z(A)||!Z(o)||Fr.updateEffect(Z(o),{[Z(A).xParam]:F,[Z(A).yParam]:Q})}function C(){if(!Z(o)||p)return;p=!0;const F=Fr.getActiveColor();f.emit("effectDialInteractionStart",{effectType:Z(o),color:F}),Fr.startHoldPreview(Z(o))}function b(){if(!Z(o)||!p)return;p=!1;const F=Fr.getActiveColor();f.emit("effectDialInteractionEnd",{effectType:Z(o),color:F}),Fr.stopHoldPreview(Z(o))}Hs(()=>{if(!Z(r)||(i=Z(r).parentElement,!i))return;const F=i.dataset.effect;if(F==="delay"||F==="vibrato"||F==="tremolo")St(o,F,!0),St(A,e[F],!0),St(l,Z(A).xRange.min,!0),St(c,Z(A).yRange.min,!0);else{F&&console.warn("[EffectsCartesianSlider] Unknown effect type:",F);return}if(w(),typeof ResizeObserver>"u")return;const Q=new ResizeObserver(()=>w());return Q.observe(i),()=>Q.disconnect()}),Qn(()=>{if(!Z(A)||!Z(o))return;const F=(D={})=>{var N;const R=((N=D.newNote)==null?void 0:N.color)??null;d=R,R?y(R):St(u,{},!0),p||I()},Q=D=>{!D||D!==d||p||I()},U=D=>{if(!(!D||D.effectType!==Z(o))&&D.color===d&&!p){if(D.effectParams){const R=D.effectParams[Z(A).xParam],N=D.effectParams[Z(A).yParam];typeof R=="number"&&St(l,R,!0),typeof N=="number"&&St(c,N,!0);return}I()}};f.on("noteChanged",F),f.on("timbreChanged",Q),f.on("audioEffectChanged",U),d?y(d):St(u,{},!0),I();const W=()=>b();return window.addEventListener("pointerup",W),()=>{f.off("noteChanged",F),f.off("timbreChanged",Q),f.off("audioEffectChanged",U),window.removeEventListener("pointerup",W)}});var S=Tk(),T=Fe(S);{var x=F=>{Fk(F,{get minX(){return Z(A).xRange.min},get maxX(){return Z(A).xRange.max},get stepX(){return Z(A).xRange.step},get minY(){return Z(A).yRange.min},get maxY(){return Z(A).yRange.max},get stepY(){return Z(A).yRange.step},get size(){return Z(a)},mode:"relative",get colors(){return Z(u)},onchange:B,get x(){return Z(l)},set x(Q){St(l,Q,!0)},get y(){return Z(c)},set y(Q){St(c,Q,!0)}})};Wa(T,F=>{Z(A)&&F(x)})}oo(S,F=>St(r,F),()=>Z(r)),vo("pointerdown",S,C),vo("pointerup",S,b),vo("pointerleave",S,b),vo("pointercancel",S,b),Un(n,S),Qe()}var Mk=ti("<button> </button>"),Qk=ti('<div class="notification-overlay visible svelte-12566qp" role="button" tabindex="0" aria-label="Dismiss notification"><div class="notification-modal svelte-12566qp"><button class="notification-close svelte-12566qp" aria-label="Close"></button> <h2 class="notification-title svelte-12566qp"> </h2> <p class="notification-message svelte-12566qp"> </p> <div class="notification-actions svelte-12566qp"></div></div></div>');function Uk(n,t){Me(t,!0);let e=Rt(!1),s=Rt("Notice"),r=Rt(""),i=Rt(Tn([{text:"OK",primary:!0}]));function o(p){p.target===p.currentTarget&&St(e,!1)}function A(p){(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),St(e,!1))}function a(p){p.key==="Escape"&&Z(e)&&St(e,!1)}function l(p){p.action?p.action():St(e,!1)}var c=Oc();vo("keydown",sf,a);var u=fa(c);{var d=p=>{var h=Qk();h.__click=o,h.__keydown=A;var m=Fe(h),g=Fe(m);g.__click=()=>St(e,!1);var v=Ge(g,2),w=Fe(v),y=Ge(v,2),I=Fe(y),B=Ge(y,2);OL(B,21,()=>Z(i),RL,(C,b)=>{var S=Mk();S.__click=()=>l(Z(b));var T=Fe(S);Ii(()=>{Eb(S,1,`notification-button ${Z(b).primary?"":"secondary"}`,"svelte-12566qp"),sc(T,Z(b).text)}),Un(C,S)}),Ii(()=>{sc(w,Z(s)),sc(I,Z(r))}),Un(p,h)};Wa(u,p=>{Z(e)&&p(d)})}Un(n,c),Qe()}Vu(["click","keydown"]);var Pk=ti('<div class="zoom-indicator svelte-lpl7xl"> </div>');function Nk(n,t){Me(t,!0);let e=Rt(!1),s=Rt("Zoom: 100%"),r=null;function i(){let c=100,u="";const d=qe.getViewportInfo();if(d)if(c=Math.round((d.zoomLevel??1)*100),d.canSeeFullRange)u=" (Full Range)";else{const p=d.startRank??d.startRow??0,h=d.endRank??d.endRow??p;u=` (~${Math.max(0,Math.floor(h-p))} semitones)`}St(s,`Zoom: ${c}%${u}`)}function o(){i(),St(e,!0),r!==null&&clearTimeout(r),r=setTimeout(()=>{St(e,!1),r=null},2e3)}Qn(()=>{const c=()=>o();return f.on("zoomIn",c),f.on("zoomOut",c),()=>{f.off("zoomIn",c),f.off("zoomOut",c),r!==null&&clearTimeout(r)}});var A=Oc(),a=fa(A);{var l=c=>{var u=Pk(),d=Fe(u);Ii(()=>sc(d,Z(s))),Un(c,u)};Wa(a,c=>{Z(e)&&c(l)})}Un(n,A),Qe()}const wa=()=>{if(typeof window>"u")return!1;const n=window.__initDebug;return n===!0},Xs=(n,t)=>{if(wa()){if(t===void 0){console.log(`[SvelteMount] ${n}`);return}console.log(`[SvelteMount] ${n}`,t)}};let z0=!1;const Qb=()=>{if(!z0&&(z0=!0,!(typeof window>"u")))try{const n=window,t=new URLSearchParams(window.location.search),e=t.get("allowSvelte")??t.get("onlySvelte"),s=t.get("skipSvelte"),r=t.get("skipSvelteAll")==="1";if(!Array.isArray(n.__svelteAllowComponents)||n.__svelteAllowComponents.length===0){if(e==="*"||e==="all")n.__svelteAllowComponents=["*"];else if(e){const i=e.split(",").map(o=>o.trim()).filter(Boolean);i.length>0&&(n.__svelteAllowComponents=i)}}if(!Array.isArray(n.__svelteSkipComponents)||n.__svelteSkipComponents.length===0){if(r||s==="*"||s==="all")n.__svelteSkipComponents=["*"];else if(s){const i=s.split(",").map(o=>o.trim()).filter(Boolean);i.length>0&&(n.__svelteSkipComponents=i)}}wa()&&(n.__svelteAllowComponents&&console.warn("[SvelteMount] allow list",n.__svelteAllowComponents),n.__svelteSkipComponents&&console.warn("[SvelteMount] skip list",n.__svelteSkipComponents))}catch(n){console.error("[SvelteMount] filter list parse failed",n)}},Ub=n=>{if(typeof window>"u")return!1;Qb();const t=window.__svelteAllowComponents;if(Array.isArray(t)&&t.length>0)return!(t.includes("*")||t.includes(n));const e=window.__svelteSkipComponents;return!Array.isArray(e)||e.length===0?!1:e.includes("*")||e.includes(n)},Pb={"playback-controls":s5,"playback-controls-bridge":r5,"file-actions-bridge":i5,"grid-controls-bridge":o5,"modulation-bridge":A5,"sidebar-bridge":M5,"tool-selector-bridge":k5,"audio-controls-bridge":Y5,"tab-management-bridge":j5,"print-preview-bridge":J5,"store-context":vk,"adsr-envelope":Sk,"effects-cartesian-slider":_k,"filter-controls-bridge":wk,"notification-modal":Uk,"zoom-indicator":Nk},qc=[];function Dk(){Qb();const n=document.querySelectorAll("[data-svelte-component]");Xs("placeholders found",n.length),n.forEach(t=>{const e=t.getAttribute("data-svelte-component");if(!e)return;const s=Pb[e];if(!s){console.warn(`[Svelte] Unknown component: ${e}`);return}try{if(Ub(e)){Xs("mount:skip",e),wa()&&console.warn(`[Svelte] Skipped: ${e}`);return}Xs("mount:start",e),t.innerHTML="";const r=yb(s,{target:t});qc.push({target:t,component:r}),wa()&&console.log(`[Svelte] Mounted: ${e}`),Xs("mount:done",e)}catch(r){console.error(`[Svelte] Failed to mount ${e}:`,r),Xs("mount:failed",e)}}),Xs("mountSvelteComponents:complete")}function Lk(){qc.forEach(({component:n})=>{try{kL(n)}catch(t){console.error("[Svelte] Failed to unmount component:",t)}}),qc.length=0}function $0(n,t){const e=Pb[n];if(!e)return console.error(`[Svelte] Unknown component: ${n}`),null;if(Ub(n))return Xs("mount:skip",n),wa()&&console.warn(`[Svelte] Skipped: ${n}`),null;const s=typeof t=="string"?document.querySelector(t):t;if(!s)return console.error(`[Svelte] Target not found: ${t}`),null;Xs("mount:start",n);const r=yb(e,{target:s});return qc.push({target:s,component:r}),Xs("mount:done",n),r}Vu(["input","mousedown","keydown"]);const kk=()=>{if(typeof window>"u")return!1;const n=window.__initDebug;return n===!0},Nl=(n,t)=>{if(kk()){console.log(`[InitUiComponents] ${n}`);return}};function Rk(){Nl("start"),bD.init(),Nl("mountSvelteComponents:start"),Dk(),Nl("mountSvelteComponents:done"),E.initSuccess("UiComponents"),Nl("done")}const Hd=()=>window.synthEngine??null,X0=()=>window.animationEffectsManager??null;E.moduleLoaded("DynamicWaveformVisualizer");class Hk{constructor(){M(this,"canvas",null);M(this,"ctx",null);M(this,"currentColor",null);M(this,"isPlaybackActive",!1);M(this,"liveAnalysers",new Map);M(this,"liveWaveforms",new Map);M(this,"playbackAnimationId",null);M(this,"animationSpeed",100);M(this,"frameSkipCounter",0);M(this,"onWaveformUpdate")}initialize(t,e){var s;return this.canvas=t,this.ctx=e,this.currentColor=((s=f.state.selectedNote)==null?void 0:s.color)||"#4a90e2",this.setupEventListeners(),E.info("DynamicWaveformVisualizer","Initialized with canvas context",null,"waveform"),!0}setupEventListeners(){f.on("noteChanged",({newNote:t}={})=>{t!=null&&t.color&&t.color!==this.currentColor&&(this.currentColor=t.color)}),f.on("playbackStateChanged",({isPlaying:t=!1,isPaused:e=!1}={})=>{t&&!e?this.startLiveVisualization():this.stopLiveVisualization()}),f.on("spacebarPlayback",({color:t,isPlaying:e=!1}={})=>{e&&t?this.startSingleNoteVisualization(t):this.stopLiveVisualization()}),f.on("tremoloAmplitudeUpdate",({activeColors:t}={})=>{this.isPlaybackActive&&(t!=null&&t.some(e=>this.liveWaveforms.has(e)))&&E.debug("DynamicWaveformVisualizer","Tremolo update received for active colors",t,"waveform")}),E.info("DynamicWaveformVisualizer","Event subscriptions established",null,"waveform")}setAnimationSpeed(t){this.animationSpeed=t,this.frameSkipCounter=0}startLiveVisualization(){this.isPlaybackActive||(this.isPlaybackActive=!0,this.setupLiveAnalysers(),this.updateContainerState(!0),this.animateLiveWaveforms(),E.debug("DynamicWaveformVisualizer","Started live visualization",null,"waveform"))}startSingleNoteVisualization(t){this.isPlaybackActive||(this.isPlaybackActive=!0,this.setupSingleAnalyser(t),this.updateContainerState(!0),this.animateLiveWaveforms(),E.debug("DynamicWaveformVisualizer",`Started single note visualization for ${t}`,null,"waveform"))}stopLiveVisualization(){this.isPlaybackActive=!1;const t=Hd();this.liveAnalysers.forEach((e,s)=>{var r;(r=t==null?void 0:t.removeWaveformAnalyzer)==null||r.call(t,s)}),this.liveAnalysers.clear(),this.liveWaveforms.clear(),this.playbackAnimationId&&(cancelAnimationFrame(this.playbackAnimationId),this.playbackAnimationId=null),this.updateContainerState(!1),E.debug("DynamicWaveformVisualizer","Stopped live visualization",null,"waveform")}updateContainerState(t){var s;const e=(s=this.canvas)==null?void 0:s.parentElement;e&&(t?(e.classList.add("live-mode"),f.state.isPlaying&&!f.state.isPaused&&e.classList.add("pulsing")):e.classList.remove("live-mode","pulsing"))}setupLiveAnalysers(){const t=Hd();if(!t){E.warn("DynamicWaveformVisualizer","SynthEngine not available for live analysis",null,"waveform");return}this.getActivePlayingColors().forEach(s=>{var i;const r=(i=t.createWaveformAnalyzer)==null?void 0:i.call(t,s);r&&(this.liveAnalysers.set(s,r),this.liveWaveforms.set(s,new Float32Array(1024)),E.debug("DynamicWaveformVisualizer",`Created analyser for ${s}`,null,"waveform"))})}setupSingleAnalyser(t){var r;const e=Hd();if(!e)return;const s=(r=e.createWaveformAnalyzer)==null?void 0:r.call(e,t);s&&(this.liveAnalysers.set(t,s),this.liveWaveforms.set(t,new Float32Array(1024)),E.debug("DynamicWaveformVisualizer",`Created single analyser for ${t}`,null,"waveform"))}getActivePlayingColors(){const t=new Set,e=f.state.placedNotes;f.state.isPlaying&&e.forEach(r=>{!r.isDrum&&r.color&&t.add(r.color)}),t.size===0&&this.currentColor&&t.add(this.currentColor);const s=Array.from(t);return E.debug("DynamicWaveformVisualizer","Active playing colors detected",s,"waveform"),s}animateLiveWaveforms(){var e;if(!this.isPlaybackActive)return;this.frameSkipCounter++;const t=Math.max(1,Math.floor(100/Math.max(this.animationSpeed,1)));if(this.frameSkipCounter%t!==0){this.playbackAnimationId=requestAnimationFrame(()=>this.animateLiveWaveforms());return}this.liveAnalysers.forEach((s,r)=>{const i=s.getValue();this.liveWaveforms.set(r,i)}),(e=this.onWaveformUpdate)==null||e.call(this),this.playbackAnimationId=requestAnimationFrame(()=>this.animateLiveWaveforms())}drawLiveWaveforms(t,e,s){if(!this.ctx)return;const i=Array.from(this.liveWaveforms.keys());if(i.length===1){const o=i[0];if(!o)return;const A=this.liveWaveforms.get(o);this.drawSingleLiveWaveform(A,o,t,e,s)}else i.length>1&&i.forEach(o=>{if(!o)return;const A=this.liveWaveforms.get(o);this.drawLayeredLiveWaveform(A,o,t,e,s,i.length)})}drawSingleLiveWaveform(t,e,s,r,i){const o=this.ctx;if(!o||!t||t.length===0)return;const A=X0();let a=i;if(A){const g=A.getTremoloAmplitudeMultiplier(e);a*=g}let l=0;const c=A==null?void 0:A.vibratoCanvasEffect,u=c==null?void 0:c.animations.get(e);c&&u&&c.shouldBeRunning()&&(l=Math.sin(u.phase)*u.amplitude*.4);let d=0;for(let g=0;g<t.length;g++){const v=t[g]??0;d=Math.max(d,Math.abs(v))}const p=d>1?1/d:1;o.strokeStyle=e,o.lineWidth=2,o.beginPath();const m=t.length/s*(1+l);for(let g=0;g<s;g++){const v=l*s*.3,w=g+v,y=Math.floor(w*m),I=Math.max(0,Math.min(t.length-1,y)),B=(t[I]??0)*p,C=r-B*a;g===0?o.moveTo(g,C):o.lineTo(g,C)}o.stroke(),E.debug("DynamicWaveformVisualizer",`Drew single live waveform for ${e} with tremolo and vibrato stretch`,{amplitudeRatio:a/i,vibratoStretch:l},"waveform")}drawLayeredLiveWaveform(t,e,s,r,i,o){const A=this.ctx;if(!A||!t||t.length===0)return;const a=X0();let l=i;a&&(l*=a.getTremoloAmplitudeMultiplier(e));let c=0;const u=a==null?void 0:a.vibratoCanvasEffect,d=u==null?void 0:u.animations.get(e);u&&d&&u.shouldBeRunning()&&(c=Math.sin(d.phase)*d.amplitude*.4);let p=0;for(let w=0;w<t.length;w++){const y=t[w]??0;p=Math.max(p,Math.abs(y))}const h=p>1?1/p:1,m=Math.max(.4,1/o);A.strokeStyle=xs(e,m*2),A.lineWidth=1.5,A.beginPath();const v=t.length/s*(1+c);for(let w=0;w<s;w++){const y=c*s*.3,I=w+y,B=Math.floor(I*v),C=Math.max(0,Math.min(t.length-1,B)),b=(t[C]??0)*h,S=r-b*l*.7;w===0?A.moveTo(w,S):A.lineTo(w,S)}A.stroke()}isLiveMode(){return this.isPlaybackActive}getLiveColors(){return Array.from(this.liveWaveforms.keys())}dispose(){this.stopLiveVisualization(),E.info("DynamicWaveformVisualizer","Disposed",null,"waveform")}}const Ok=512,oi=360,uA=480,Vk=()=>window.animationEffectsManager;E.moduleLoaded("StaticWaveformVisualizer");class Wk{constructor(){M(this,"canvas",null);M(this,"ctx",null);M(this,"currentColor",null);M(this,"animationFrameId",null);M(this,"waveformData",new Float32Array(Ok));M(this,"isInitialized",!1);M(this,"isTransitioning",!1);M(this,"transitionStartTime",0);M(this,"transitionDuration",300);M(this,"fromWaveform",null);M(this,"toWaveform",null);M(this,"transitionAnimationId",null);M(this,"dynamicVisualizer",new Hk);M(this,"animationSpeed",100);M(this,"frameSkipCounter",0);M(this,"resizeObserver",null);M(this,"calculatedAmplitude",0);E.info("StaticWaveformVisualizer","Initialized with dynamic visualizer integration",null,"waveform")}initialize(){var s,r;if(this.canvas=document.getElementById("static-waveform-canvas"),!this.canvas)return!1;const t=this.canvas.getContext("2d");if(!t)return!1;this.ctx=t,this.currentColor=((s=f.state.selectedNote)==null?void 0:s.color)||"#4a90e2";const e=this.canvas.parentElement;return e&&typeof ResizeObserver<"u"&&((r=this.resizeObserver)==null||r.disconnect(),this.resizeObserver=new ResizeObserver(()=>this.resize()),this.resizeObserver.observe(e)),this.resize(),this.setupEventListeners(),this.dynamicVisualizer.initialize(this.canvas,this.ctx),this.dynamicVisualizer.onWaveformUpdate=()=>this.draw(),this.generateWaveform(),this.isInitialized=!0,!0}resize(){if(!this.canvas||!this.ctx)return;const t=this.canvas.parentElement;if(!t)return;const{clientWidth:e,clientHeight:s}=t,r=this.canvas.width,i=this.canvas.height;if((e===0||s===0)&&this.canvas.width>0&&this.canvas.height>0)return;const A=Math.abs(e-r),a=Math.abs(s-i);(A>2||a>2)&&(this.canvas.width=e,this.canvas.height=s,this.draw())}setupEventListeners(){f.on("noteChanged",(e={})=>{var r;const s=(r=e.newNote)==null?void 0:r.color;s&&s!==this.currentColor&&(this.currentColor=s,this.generateWaveform())}),f.on("timbreChanged",e=>{e&&e===this.currentColor&&this.generateWaveform()}),f.on("waveformExtendedViewChanged",()=>{this.generateWaveform(),this.updateToggleButton()}),document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{e.dataset.tab==="timbre"&&setTimeout(()=>this.resize(),100)})}),this.setupSpeedControls(),this.setupExtendToggle()}setupSpeedControls(){const t=Array.from(document.querySelectorAll(".waveform-speed-btn"));t.length!==0&&t.forEach(e=>{e.addEventListener("click",()=>{const s=e.dataset.speed,r=s?parseInt(s,10):NaN;Number.isFinite(r)&&(e.classList.contains("active")?(e.classList.remove("active"),this.setAnimationSpeed(100)):(t.forEach(i=>i.classList.remove("active")),e.classList.add("active"),this.setAnimationSpeed(r)))})})}setAnimationSpeed(t){Number.isFinite(t)&&(this.animationSpeed=t,this.frameSkipCounter=0,this.dynamicVisualizer.setAnimationSpeed(t))}setupExtendToggle(){const t=document.getElementById("waveform-extend-toggle");t instanceof HTMLElement&&(t.addEventListener("click",()=>{f.toggleWaveformExtendedView()}),this.updateToggleButton())}updateToggleButton(){const t=document.getElementById("waveform-extend-toggle");if(!(t instanceof HTMLElement))return;const e=f.state.waveformExtendedView;t.classList.toggle("extended",e),t.textContent=e?"480 View":"360 View",t.title=e?"Switch to 360 waveform view":"Switch to 480 waveform view (shows extra 120)"}generateWaveform(){if(this.isTransitioning||!this.currentColor)return;const t=f.state.timbres[this.currentColor];if(!(t!=null&&t.coeffs))return;const e=Vh(this.currentColor),s=t.phases??new Float32Array(Eo),r=this.waveformData.length;this.waveformData.fill(0);let i=0;for(let o=0;o<r;o++){const a=(f.state.waveformExtendedView?uA:oi)/oi,l=o/r*a*2*Math.PI;let c=0;for(let u=0;u<Eo;u++){const d=e[u]??0;if(d<=.001)continue;const p=s[u]??0,h=u+1;c+=d*Math.sin(h*l+p)}this.waveformData[o]=c,i=Math.max(i,Math.abs(c))}if(this.calculatedAmplitude=Math.min(1,i),i>1){const o=1/i;for(let A=0;A<this.waveformData.length;A++){const a=this.waveformData[A]??0;this.waveformData[A]=a*o}}this.draw()}startPhaseTransition(t,e,s){!this.isInitialized||!this.currentColor||(this.isTransitioning&&this.transitionAnimationId&&cancelAnimationFrame(this.transitionAnimationId),this.fromWaveform=new Float32Array(this.waveformData),this.generateTargetWaveform(e),this.toWaveform=new Float32Array(this.waveformData),this.waveformData=this.fromWaveform,this.isTransitioning=!0,this.transitionStartTime=performance.now(),this.animateTransition())}generateTargetWaveform(t){if(!this.currentColor||!t)return;const e=f.state.timbres[this.currentColor];if(!(e!=null&&e.coeffs))return;const s=Vh(this.currentColor),r=t instanceof Float32Array?t:new Float32Array(t),i=this.waveformData.length;this.waveformData.fill(0);let o=0;for(let A=0;A<i;A++){const l=(f.state.waveformExtendedView?uA:oi)/oi,c=A/i*l*2*Math.PI;let u=0;for(let d=0;d<Eo;d++){const p=s[d]??0;if(p<=.001)continue;const h=r[d]??0,m=d+1;u+=p*Math.sin(m*c+h)}this.waveformData[A]=u,o=Math.max(o,Math.abs(u))}if(this.calculatedAmplitude=Math.min(1,o),o>1){const A=1/o;for(let a=0;a<this.waveformData.length;a++){const l=this.waveformData[a]??0;this.waveformData[a]=l*A}}}animateTransition(){const t=this.fromWaveform,e=this.toWaveform;if(!this.isTransitioning||!t||!e)return;const s=performance.now()-this.transitionStartTime,r=Math.min(s/this.transitionDuration,1),i=1-Math.pow(1-r,3);for(let o=0;o<this.waveformData.length;o++){const A=t[o]??0,a=e[o]??0;this.waveformData[o]=A+(a-A)*i}this.draw(),r>=1?(this.isTransitioning=!1,this.fromWaveform=null,this.toWaveform=null,this.transitionAnimationId=null):this.transitionAnimationId=requestAnimationFrame(()=>this.animateTransition())}normalizeWaveform(){let t=0;for(let e=0;e<this.waveformData.length;e++){const s=this.waveformData[e]??0;t=Math.max(t,Math.abs(s))}if(t>0){const e=.9/t;for(let s=0;s<this.waveformData.length;s++){const r=this.waveformData[s]??0;this.waveformData[s]=r*e}}}draw(){const t=this.ctx,e=this.canvas;if(!t||!e)return;const{width:s,height:r}=e,i=r/2,o=r/2;t.fillStyle="#ffffff",t.fillRect(0,0,s,r),this.drawGrid(s,r,i,o),this.dynamicVisualizer.isLiveMode()?this.dynamicVisualizer.drawLiveWaveforms(s,i,o):this.drawWaveform(s,i,o),s>200&&r>100&&this.drawLabels(s,r)}drawGrid(t,e,s,r){const i=this.ctx;if(!i)return;i.strokeStyle="#ced4da",i.lineWidth=1,i.setLineDash([2,2]),i.beginPath(),i.moveTo(0,s),i.lineTo(t,s),i.stroke();const o=f.state.waveformExtendedView?uA:oi;if((f.state.waveformExtendedView?[90,180,270,360,450]:[90,180,270]).forEach(u=>{const d=t/o*u;i.beginPath(),i.moveTo(d,0),i.lineTo(d,e),i.stroke()}),f.state.waveformExtendedView){const u=t/uA*oi;i.fillStyle="rgba(128, 128, 128, 0.15)",i.fillRect(u,0,t-u,e)}[.5].forEach(u=>{const d=s-r*u,p=s+r*u;i.beginPath(),i.moveTo(0,d),i.lineTo(t,d),i.moveTo(0,p),i.lineTo(t,p),i.stroke()}),i.setLineDash([]),i.strokeStyle="#999999",i.lineWidth=1;const l=s-r,c=s+r;i.beginPath(),i.moveTo(0,l),i.lineTo(t,l),i.stroke(),i.beginPath(),i.moveTo(0,c),i.lineTo(t,c),i.stroke()}drawWaveform(t,e,s){const r=this.ctx;if(!r||this.waveformData.length===0)return;const i=this.currentColor||"#4a90e2";r.strokeStyle=i,r.lineWidth=2,r.beginPath();const o=this.waveformData.length/t;for(let a=0;a<t;a++){const l=Math.floor(a*o),c=this.waveformData[l]||0,u=e-c*s;a===0?r.moveTo(a,u):r.lineTo(a,u)}r.stroke(),r.lineTo(t,e),r.lineTo(0,e),r.closePath();const A=r.createLinearGradient(0,e-s,0,e+s);A.addColorStop(0,xs(i,.3)),A.addColorStop(.5,xs(i,.1)),A.addColorStop(1,xs(i,.3)),r.fillStyle=A,r.fill()}drawLabels(t,e){const s=this.ctx;if(!s)return;const r=f.state.waveformExtendedView,i=r?uA:oi,o=r?["0","90","180","270","360","450"]:["0","90","180","270","360"],A=r?[0,90,180,270,360,450]:[0,90,180,270,360];s.fillStyle="#666666",s.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',s.textAlign="center",o.forEach((a,l)=>{const c=A[l]??0,u=t/i*c+10;s.fillText(a,u,e/2+4)}),s.textAlign="left",s.fillText("+1.0",5,15),s.fillText("-1.0",5,e-8)}getNormalizedAmplitude(){return this.calculatedAmplitude||0}getADSRTremoloAmplitude(){const t=this.calculatedAmplitude||0,e=Vk();if(this.currentColor&&(e!=null&&e.getADSRTremoloAmplitudeMultiplier)){const s=e.getADSRTremoloAmplitudeMultiplier(this.currentColor);return t*s}return t}startSingleNoteVisualization(t){this.dynamicVisualizer.startSingleNoteVisualization(t)}stopLiveVisualization(){this.dynamicVisualizer.stopLiveVisualization()}startLiveVisualization(){this.dynamicVisualizer.startLiveVisualization()}dispose(){var t;this.dynamicVisualizer.dispose(),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.transitionAnimationId&&(cancelAnimationFrame(this.transitionAnimationId),this.transitionAnimationId=null),(t=this.resizeObserver)==null||t.disconnect(),this.resizeObserver=null,this.isTransitioning=!1,this.fromWaveform=null,this.toWaveform=null,this.isInitialized=!1}}const Nb=new Wk;window.waveformVisualizer=Nb;function Gk(){return Nb.initialize()}class zp{constructor(t){M(this,"effectName");M(this,"animations");M(this,"activeNoteAnimations");M(this,"ghostNoteAnimation");M(this,"activeSoundingNotes");M(this,"isPlaybackActive");M(this,"hasActiveInteraction");M(this,"hasDialInteraction");this.effectName=t,this.animations=new Map,this.activeNoteAnimations=new Map,this.ghostNoteAnimation=null,this.activeSoundingNotes=new Map,this.isPlaybackActive=!1,this.hasActiveInteraction=!1,this.hasDialInteraction=!1,E.info(`${t}AnimationEffect`,"Base initialized",null,"animation")}initBase(){f.on("visualEffectChanged",t=>{if(!t)return;const{effectType:e,color:s,effectParams:r}=t;e===this.effectName.toLowerCase()&&this.updateAnimationParameters(s,r)}),f.on("playbackStarted",()=>{this.isPlaybackActive=!0,this.requestAnimationStateUpdate()}),f.on("playbackStopped",()=>{this.isPlaybackActive=!1,this.activeNoteAnimations.clear(),this.activeSoundingNotes.clear(),this.requestAnimationStateUpdate()}),f.on("noteInteractionStart",t=>{t&&this.onNoteInteractionStart(t.noteId,t.color)}),f.on("noteInteractionEnd",t=>{const e=t==null?void 0:t.noteId;e&&this.onNoteInteractionEnd(e)}),f.on("ghostNoteUpdated",t=>{t&&this.onGhostNoteUpdated(t.color)}),f.on("ghostNoteCleared",()=>this.onGhostNoteCleared()),f.on("spacebarPlayback",t=>{t&&(this.isPlaybackActive=t.isPlaying,this.requestAnimationStateUpdate())}),f.on("noteAttack",t=>{t&&this.onNoteAttack(t.noteId,t.color)}),f.on("noteRelease",t=>{t&&this.onNoteRelease(t.noteId,t.color)}),f.on("effectDialInteractionStart",t=>{t&&t.effectType===this.effectName.toLowerCase()&&this.onDialInteractionStart(t.color)}),f.on("effectDialInteractionEnd",t=>{t&&t.effectType===this.effectName.toLowerCase()&&this.onDialInteractionEnd(t.color)}),E.info(`${this.effectName}AnimationEffect`,"Base event subscriptions established",null,"animation")}shouldAnimateColor(t){return this.animations.has(t)}shouldAnimateNote(t){if(!(t!=null&&t.color)||!this.shouldAnimateColor(t.color))return!1;if(this.hasDialInteraction&&this.activeNoteAnimations.has("dial-preview")){const e=this.activeNoteAnimations.get("dial-preview");if(e&&t.color===e)return!0}return!!(this.isPlaybackActive&&t.uuid&&this.activeSoundingNotes.has(t.uuid)||this.hasActiveInteraction&&t.uuid&&this.activeNoteAnimations.has(t.uuid)||!t.uuid&&this.ghostNoteAnimation&&this.ghostNoteAnimation.color===t.color&&this.isPlaybackActive)}shouldBeRunning(){const t=this.animations.size>0;return t?!!(this.isPlaybackActive||this.hasActiveInteraction||this.hasDialInteraction||this.ghostNoteAnimation!==null||t):!1}onNoteInteractionStart(t,e){this.shouldAnimateColor(e)&&(this.activeNoteAnimations.set(t,e),this.hasActiveInteraction=!0,E.debug(`${this.effectName}AnimationEffect`,`Started interaction animation for note ${t} (${e})`,null,"animation"),this.requestAnimationStateUpdate())}onNoteInteractionEnd(t){this.activeNoteAnimations.delete(t),this.hasActiveInteraction=this.activeNoteAnimations.size>0,E.debug(`${this.effectName}AnimationEffect`,`Ended interaction animation for note ${t}`,null,"animation"),this.requestAnimationStateUpdate()}onGhostNoteUpdated(t){this.shouldAnimateColor(t)?(this.ghostNoteAnimation={color:t,active:!0},E.debug(`${this.effectName}AnimationEffect`,`Ghost note animation updated for color ${t}`,null,"animation")):this.ghostNoteAnimation=null}onGhostNoteCleared(){this.ghostNoteAnimation=null,E.debug(`${this.effectName}AnimationEffect`,"Ghost note animation cleared",null,"animation")}onNoteAttack(t,e){this.shouldAnimateColor(e)&&(this.activeSoundingNotes.set(t,e),E.debug(`${this.effectName}AnimationEffect`,`Note attack: ${t} (${e}) added to active sounding notes`,null,"animation"),this.requestAnimationStateUpdate())}onNoteRelease(t,e){this.activeSoundingNotes.delete(t),E.debug(`${this.effectName}AnimationEffect`,`Note release: ${t} (${e}) removed from active sounding notes`,null,"animation"),this.requestAnimationStateUpdate()}onDialInteractionStart(t){this.shouldAnimateColor(t)&&(this.hasDialInteraction=!0,this.activeNoteAnimations.set("dial-preview",t),E.debug(`${this.effectName}AnimationEffect`,`Dial interaction started for ${t}`,null,"animation"),this.requestAnimationStateUpdate())}onDialInteractionEnd(t){this.hasDialInteraction=!1,this.activeNoteAnimations.delete("dial-preview"),E.debug(`${this.effectName}AnimationEffect`,`Dial interaction ended for ${t}`,null,"animation"),this.requestAnimationStateUpdate()}getActiveColors(){const t=new Set;for(const[,e]of this.activeSoundingNotes.entries())this.shouldAnimateColor(e)&&t.add(e);for(const[,e]of this.activeNoteAnimations.entries())this.shouldAnimateColor(e)&&t.add(e);return this.ghostNoteAnimation&&this.shouldAnimateColor(this.ghostNoteAnimation.color)&&t.add(this.ghostNoteAnimation.color),Array.from(t)}disposeBase(){this.animations.clear(),this.activeNoteAnimations.clear(),this.activeSoundingNotes.clear(),this.ghostNoteAnimation=null,E.info(`${this.effectName}AnimationEffect`,"Base disposed",null,"animation")}requestAnimationStateUpdate(){var t;(t=window.animationEffectsManager)==null||t.updateAnimationState()}}E.moduleLoaded("VibratoCanvasEffect");class Kk extends zp{constructor(){super("Vibrato"),E.info("VibratoCanvasEffect","Initialized for canvas note positions",null,"animation")}init(){return this.initBase(),E.info("VibratoCanvasEffect","Ready for canvas animation",null,"animation"),!0}updateAnimationParameters(t,e){const{speed:s,span:r}=e;if(s===0||r===0)this.animations.delete(t),E.debug("VibratoCanvasEffect",`Disabled vibrato animation for ${t}`,null,"animation");else{const i=this.animations.get(t),o=s/100*16,A=r/100*.5,a={frequency:o,amplitude:A,phase:(i==null?void 0:i.phase)||0,lastUpdate:performance.now()};this.animations.set(t,a),E.debug("VibratoCanvasEffect",`Updated vibrato animation for ${t}`,{frequency:o,amplitude:A,preservedPhase:!!i},"animation")}}updateAnimationPhases(t){this.animations.forEach(e=>{const s=(t-e.lastUpdate)/1e3;e.phase+=e.frequency*s*2*Math.PI,e.lastUpdate=t,e.phase>4*Math.PI&&(e.phase-=4*Math.PI)})}getVibratoYOffset(t){if(!t)return 0;const e=this.animations.get(t);if(!e||window.animationEffectsManager&&!window.animationEffectsManager.shouldVibratoBeRunning())return 0;const s=Math.sin(e.phase),r=-s*e.amplitude;return E.debug("VibratoCanvasEffect","Visual vibrato",{sine:s.toFixed(3),offset:r.toFixed(3),phase:e.phase.toFixed(3)},"effects"),r}shouldBeRunning(){return this.animations.size>0?this.isPlaybackActive||this.hasActiveInteraction||this.hasDialInteraction||this.ghostNoteAnimation!==null&&this.isPlaybackActive:!1}shouldAnimateColor(t){const e=this.animations.get(t);return e?e.frequency>0&&e.amplitude>0:!1}dispose(){this.disposeBase(),E.info("VibratoCanvasEffect","Disposed",null,"animation")}}E.moduleLoaded("TremoloWaveformEffect");class qk extends zp{constructor(){super("Tremolo"),E.info("TremoloWaveformEffect","Initialized for waveform/ADSR amplitude",null,"animation")}init(){return this.initBase(),E.info("TremoloWaveformEffect","Ready for waveform/ADSR animation",null,"animation"),!0}updateAnimationParameters(t,e){var i,o;const{speed:s,span:r}=e;if(s===0||r===0)this.animations.delete(t),E.debug("TremoloWaveformEffect",`Disabled tremolo animation for ${t}`,null,"animation");else{const A=this.animations.get(t),a=s/100*16,l=r/100,c=(o=(i=window.Tone)==null?void 0:i.now)==null?void 0:o.call(i),u=typeof c=="number"?c*1e3:performance.now(),d={frequency:a,span:l,phase:(A==null?void 0:A.phase)||0,lastUpdate:u};this.animations.set(t,d),E.debug("TremoloWaveformEffect",`Updated tremolo animation for ${t}`,{frequency:a,span:l,preservedPhase:!!A},"animation")}}updateAnimationPhases(t){var i,o,A,a;let e=0;const s=(o=(i=window.Tone)==null?void 0:i.now)==null?void 0:o.call(i),r=typeof s=="number"?s*1e3:t;if(this.animations.forEach((l,c)=>{const u=(r-l.lastUpdate)/1e3,d=l.phase;l.phase+=l.frequency*u*2*Math.PI,l.lastUpdate=r,e++,Math.abs(l.phase-d)<.001&&E.warn("TremoloWaveformEffect",`Phase not advancing for ${c}`,{deltaSeconds:Number(u.toFixed(4)),frequency:l.frequency},"animation"),l.phase>4*Math.PI&&(l.phase-=4*Math.PI)}),e>0&&Math.random()<.05){const l=(A=window.Tone)!=null&&A.now?"Tone.js":"performance";E.debug("TremoloWaveformEffect","Timing sample",{hasTone:!!window.Tone,hasToneNow:!!((a=window.Tone)!=null&&a.now),toneTime:r,currentTime:t,timingSource:l},"animation")}}getTremoloAmplitudeMultiplier(t){var m,g,v;const e=this.animations.get(t);if(!e||window.animationEffectsManager&&!window.animationEffectsManager.shouldTremoloBeRunning())return 1;const s=((m=window.waveformVisualizer)==null?void 0:m.calculatedAmplitude)??1,r=Math.sin(e.phase),i=e.span,o=s,A=s*(1-i),a=(o+A)/2,l=(o-A)/2,u=(a+r*l)/s,d=(v=(g=window.Tone)==null?void 0:g.now)==null?void 0:v.call(g),h=(typeof d=="number"?d*1e3:performance.now())-e.lastUpdate;if(h>100&&e.span>0){const w=e.frequency*(h/1e3)*2*Math.PI;w>.1&&E.warn("TremoloWaveformEffect",`Phase stagnation detected for ${t}`,{phase:Number(e.phase.toFixed(3)),millisecondsSinceUpdate:Number(h.toFixed(1)),expectedAdvancement:Number(w.toFixed(3))},"animation")}return Math.max(0,Math.min(1,u))}getADSRTremoloAmplitudeMultiplier(t){return this.getTremoloAmplitudeMultiplier(t)}shouldAnimateColor(t){const e=this.animations.get(t);return e?e.frequency>0&&e.span>0:!1}dispose(){this.disposeBase(),E.info("TremoloWaveformEffect","Disposed",null,"animation")}}E.moduleLoaded("EnvelopeFillEffect");class zk{constructor(){M(this,"activeFills");M(this,"instanceId");this.activeFills=new Map,this.instanceId=Math.random().toString(36).substring(7),E.info("EnvelopeFillEffect","Initialized",null,"animation")}init(){f.on("noteAttack",t=>{var i,o;const e=t==null?void 0:t.noteId,s=t==null?void 0:t.color;if(!e||!s)return;const r=(i=f.state.timbres)==null?void 0:i[s];if(!r){E.warn("EnvelopeFillEffect","No timbre found for color",{color:s},"effects");return}this.activeFills.set(e,{fillLevel:0,color:s,startTime:Pe(),adsr:r.adsr,phase:"attack"}),E.debug("EnvelopeFillEffect",`Started fill animation for note ${e}`,null,"animation"),(o=window.animationEffectsManager)==null||o.updateAnimationState()}),f.on("noteRelease",t=>{const e=t==null?void 0:t.noteId;if(!e)return;const s=this.activeFills.get(e);s?(s.phase="release",s.releaseStartTime=Pe(),s.releaseStartLevel=s.fillLevel,E.debug("EnvelopeFillEffect",`Started release phase for note ${e}`,null,"animation")):E.warn("EnvelopeFillEffect","No fill data found for release",{noteId:e},"effects")}),f.on("playbackStopped",()=>{var t;this.activeFills.clear(),(t=window.animationEffectsManager)==null||t.updateAnimationState(),f.emit("animationUpdate",{type:"envelopeFill",activeColors:[],hasEnvelopeFills:!1})}),E.info("EnvelopeFillEffect","Event subscriptions established",null,"animation")}updateAnimationPhases(t){var s;const e=Pe();for(const[r,i]of this.activeFills.entries()){const{adsr:o,startTime:A,phase:a,releaseStartTime:l,releaseStartLevel:c}=i,u=e-A;if(a==="attack"){const d=o.attack||.01;u<d?i.fillLevel=u/d:(i.phase="decay",i.decayStartTime=e)}else if(a==="decay"){const d=o.decay||.1,p=e-(i.decayStartTime??e),h=o.sustain??.5;if(p<d){const m=p/d;i.fillLevel=1-m*(1-h)}else i.phase="sustain",i.fillLevel=h}else if(a==="sustain"){const d=o.sustain??.5;i.fillLevel=d}else if(a==="release"){const d=o.release||.5,p=l?e-l:0,h=c??i.fillLevel;if(p<d){const m=p/d;i.fillLevel=h*(1-m)}else this.activeFills.delete(r),E.debug("EnvelopeFillEffect",`Completed fill animation for note ${r}`,null,"animation"),this.activeFills.size===0&&((s=window.animationEffectsManager)==null||s.updateAnimationState())}}}getFillLevel(t){if(!t.uuid)return 0;const e=this.activeFills.get(t.uuid);return e?e.fillLevel:0}shouldFillNote(t){return t.uuid?this.activeFills.has(t.uuid):!1}shouldBeRunning(){return this.activeFills.size>0}dispose(){this.activeFills.clear(),E.info("EnvelopeFillEffect","Disposed",null,"animation")}}E.moduleLoaded("DelayADSREffect");class $k extends zp{constructor(){super("Delay"),E.info("DelayADSREffect","Initialized for delay visualization (PLACEHOLDER)",null,"animation")}init(){return this.initBase(),E.info("DelayADSREffect","Ready for delay animation (PLACEHOLDER)",null,"animation"),!0}updateAnimationParameters(t,e){const{time:s,feedback:r}=e;if(s===0&&r===0)this.animations.delete(t),E.debug("DelayADSREffect",`Disabled delay animation for ${t}`,null,"animation");else{const i=s/100*500,o=r/100,A={delayTime:i,feedback:o,echoCount:Math.floor(o*5),lastTrigger:0,echoPhases:[],lastUpdate:performance.now()};this.animations.set(t,A),E.debug("DelayADSREffect",`Updated delay animation for ${t} (PLACEHOLDER)`,{delayTime:i,feedback:o},"animation")}}updateAnimationPhases(t){this.animations.forEach(e=>{e.lastUpdate=t})}getDelayEffects(t){const e=this.animations.get(t);if(!e)return[];const s=[];for(let r=0;r<e.echoCount;r++)s.push({delay:e.delayTime*(r+1),opacity:1-r*.3,scale:1-r*.1,active:!1});return s}triggerDelay(t,e){const s=this.animations.get(t);s&&(s.lastTrigger=e,E.debug("DelayADSREffect",`Triggered delay for ${t} (PLACEHOLDER)`,null,"animation"))}shouldBeRunning(){return this.animations.size>0?this.isPlaybackActive||this.hasActiveInteraction||this.ghostNoteAnimation!==null:!1}shouldAnimateColor(t){const e=this.animations.get(t);return e?e.delayTime>0||e.feedback>0:!1}dispose(){this.disposeBase(),E.info("DelayADSREffect","Disposed",null,"animation")}}E.moduleLoaded("AnimationEffectsManager");class Xk{constructor(){M(this,"vibratoEffect");M(this,"tremoloEffect");M(this,"envelopeFillEffect");M(this,"delayEffect");M(this,"isRunning");M(this,"animationFrameId");M(this,"lastTime");M(this,"lastRenderTrigger");this.vibratoEffect=new Kk,this.tremoloEffect=new qk,this.envelopeFillEffect=new zk,this.delayEffect=new $k,this.isRunning=!1,this.animationFrameId=null,this.lastTime=0,this.lastRenderTrigger=0,E.info("AnimationEffectsManager","Initialized with single animation loop",null,"animation")}init(){return this.vibratoEffect.init(),this.tremoloEffect.init(),this.envelopeFillEffect.init(),this.delayEffect.init(),f.on("visualEffectChanged",t=>{const e=t==null?void 0:t.effectType;(e==="vibrato"||e==="tremolo")&&(setTimeout(()=>this.updateAnimationState(),0),e==="tremolo"&&setTimeout(()=>this.triggerTremoloAmplitudeUpdate(),0))}),f.on("audioEffectChanged",t=>{if(!t)return;const{effectType:e,color:s,effectParams:r}=t;!s||!r||e==="delay"&&this.delayEffect.updateAnimationParameters(s,r)}),E.info("AnimationEffectsManager","Event subscriptions established",null,"animation"),!0}animate(t){this.isRunning&&(this.lastTime=t,this.vibratoEffect.updateAnimationPhases(t),this.tremoloEffect.updateAnimationPhases(t),this.envelopeFillEffect.updateAnimationPhases(t),this.triggerVisualUpdates(t),this.animationFrameId=requestAnimationFrame(e=>this.animate(e)))}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationFrameId=requestAnimationFrame(t=>this.animate(t)),E.debug("AnimationEffectsManager","Single animation loop started",null,"animation"))}stop(){this.isRunning&&(this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.triggerFinalUpdates(),E.debug("AnimationEffectsManager","Animation loop stopped",null,"animation"))}shouldTremoloBeRunning(){if(!(this.tremoloEffect.animations.size>0))return!1;const e=this.tremoloEffect.activeSoundingNotes.size>0,s=this.tremoloEffect.hasDialInteraction;return e||s}shouldVibratoBeRunning(){return this.vibratoEffect.animations.size>0?this.vibratoEffect.isPlaybackActive||this.vibratoEffect.hasActiveInteraction||this.vibratoEffect.hasDialInteraction||this.vibratoEffect.ghostNoteAnimation!==null:!1}shouldEnvelopeFillBeRunning(){return this.envelopeFillEffect.shouldBeRunning()}updateAnimationState(){const t=this.shouldVibratoBeRunning(),e=this.shouldTremoloBeRunning(),s=this.shouldEnvelopeFillBeRunning(),r=t||e||s;r&&!this.isRunning?this.start():!r&&this.isRunning&&this.stop()}triggerVisualUpdates(t){if(!this.lastRenderTrigger||t-this.lastRenderTrigger>=16.67){this.lastRenderTrigger=t;const e=this.vibratoEffect.getActiveColors(),s=this.tremoloEffect.getActiveColors(),r=this.envelopeFillEffect.activeFills.size>0;(e.length>0||r)&&f.emit("animationUpdate",{type:e.length>0?"vibrato":"envelopeFill",activeColors:e,hasEnvelopeFills:r}),s.length>0&&f.emit("tremoloAmplitudeUpdate",{activeColors:s})}}triggerFinalUpdates(){const t=Array.from(this.vibratoEffect.animations.keys());t.length>0&&f.emit("animationUpdate",{type:"vibrato",activeColors:t});const e=Array.from(this.tremoloEffect.animations.keys());e.length>0&&f.emit("tremoloAmplitudeUpdate",{activeColors:e})}shouldAnimateNote(t){return this.vibratoEffect.shouldAnimateNote(t)}getVibratoYOffset(t){return this.vibratoEffect.getVibratoYOffset(t)}getTremoloAmplitudeMultiplier(t){return this.tremoloEffect.getTremoloAmplitudeMultiplier(t)}getADSRTremoloAmplitudeMultiplier(t){return this.tremoloEffect.getADSRTremoloAmplitudeMultiplier(t)}getFillLevel(t){return this.envelopeFillEffect.getFillLevel(t)}shouldFillNote(t){return this.envelopeFillEffect.shouldFillNote(t)}getDelayEffects(t){return this.delayEffect.getDelayEffects(t)}hasDelayEffect(t){return this.delayEffect.shouldAnimateColor(t)}triggerTremoloAmplitudeUpdate(){const t=this.tremoloEffect.getActiveColors();t.length>0&&f.emit("tremoloAmplitudeUpdate",{activeColors:t})}getAllActiveColors(){const t=this.vibratoEffect.getActiveColors(),e=this.tremoloEffect.getActiveColors();return[...new Set([...t,...e])]}dispose(){this.stop(),this.vibratoEffect.dispose(),this.tremoloEffect.dispose(),this.envelopeFillEffect.dispose(),this.delayEffect.dispose(),E.info("AnimationEffectsManager","Disposed",null,"animation")}}const Y0=new Xk;E.moduleLoaded("VibratoAudioEffect");class Yk{constructor(){M(this,"currentSettings",new Map);E.info("VibratoAudioEffect","Initialized",null,"audio")}init(){return E.info("VibratoAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,e){const{speed:s,span:r}=t;this.currentSettings.set(e,{speed:s,span:r}),E.debug("VibratoAudioEffect",`Updated parameters for ${e}`,{speed:s,span:r},"audio")}applyToVoice(t,e){if(!t||typeof t._setVibrato!="function")return;const s=this.currentSettings.get(e);if(!s){E.debug("VibratoAudioEffect",`No vibrato settings found for color ${e}`,null,"audio");return}try{t._setVibrato(s),t.vibratoApplied=!0,E.debug("VibratoAudioEffect",`Applied vibrato to voice for ${e}`,s,"audio")}catch(r){E.warn("VibratoAudioEffect",`Failed to apply vibrato to voice for ${e}`,r,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{speed:0,span:0}}getEffectInstance(){return null}createVibratoSettings(t,e){if(t===0||e===0)return null;const s=t/100*16,r=e/100*50;return{frequency:s,depth:r}}disableForColor(t){this.updateParameters({speed:0,span:0},t)}dispose(){this.currentSettings.clear(),E.info("VibratoAudioEffect","Disposed",null,"audio")}}E.moduleLoaded("TremoloAudioEffect");class jk{constructor(){M(this,"currentSettings",new Map);E.info("TremoloAudioEffect","Initialized",null,"audio")}init(){return E.info("TremoloAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,e){const{speed:s,span:r}=t;this.currentSettings.set(e,{speed:s,span:r}),E.debug("TremoloAudioEffect",`Updated parameters for ${e}`,{speed:s,span:r},"audio")}applyToVoice(t,e){if(!t||typeof t._setTremolo!="function")return;const s=this.currentSettings.get(e);if(!s){E.debug("TremoloAudioEffect",`No tremolo settings found for color ${e}`,null,"audio");return}try{t._setTremolo(s),t.tremoloApplied=!0,E.debug("TremoloAudioEffect",`Applied tremolo to voice for ${e}`,s,"audio")}catch(r){E.warn("TremoloAudioEffect",`Failed to apply tremolo to voice for ${e}`,r,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{speed:0,span:0}}getEffectInstance(){return null}createTremoloSettings(t,e){if(t===0||e===0)return null;const s=t/100*16,r=e/100;return{frequency:s,depth:r}}disableForColor(t){this.updateParameters({speed:0,span:0},t)}dispose(){this.currentSettings.clear(),E.info("TremoloAudioEffect","Disposed",null,"audio")}}E.moduleLoaded("DelayAudioEffect");const Jk=()=>window.synthEngine;class Zk{constructor(){M(this,"currentSettings",new Map);M(this,"delayInstances",new Map)}init(){return E.info("DelayAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,e){var A,a;const{time:s,feedback:r,wet:i}=t;this.currentSettings.set(e,{time:s,feedback:r,wet:i}),E.debug("DelayAudioEffect",`Updated parameters for ${e}`,{time:s,feedback:r,wet:i},"audio");let o=this.delayInstances.get(e);o?this.updateDelayInstance(o,s,r,i):(s>0||r>0)&&(o=this.createDelayInstance(s,r,i),o&&(this.delayInstances.set(e,o),E.debug("DelayAudioEffect",`Created new delay instance for ${e}`,{time:s,feedback:r,wet:i},"audio"),(a=(A=Jk())==null?void 0:A.updateSynthForColor)==null||a.call(A,e)))}applyToVoice(t,e){var r,i,o;if(!t)return;const s=this.currentSettings.get(e);if(!(!s||s.time===0&&s.feedback===0))try{let A=this.delayInstances.get(e);if(!A){if(A=this.createDelayInstance(s.time,s.feedback,s.wet),!A)return;this.delayInstances.set(e,A)}if(typeof t.isDisposed=="function"&&t.isDisposed())return;try{(r=t.connect)==null||r.call(t,A)}catch{(o=(i=t.output)==null?void 0:i.connect)==null||o.call(i,A)}E.debug("DelayAudioEffect",`Applied delay to voice for ${e}`,s,"audio")}catch(A){E.warn("DelayAudioEffect",`Failed to apply delay to voice for ${e}`,A,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{time:0,feedback:0,wet:0}}getEffectInstance(t){const e=this.getCurrentSettings(t);return e.time>0&&e.wet>0?this.delayInstances.get(t)??null:null}createDelayInstance(t,e,s=30){if(t===0&&e===0)return null;const r=Math.max(.01,t/100*.5),i=Math.min(.95,e/100),o=s/100,A=new rp({delayTime:r,feedback:i,wet:o});return A._wetAmount=o,E.debug("DelayAudioEffect","Created delay instance",{delayTime:r,feedbackAmount:i,wetAmount:o},"audio"),A}updateDelayInstance(t,e,s,r=15){const i=Math.max(.01,e/100*.5),o=Math.min(.95,s/100),A=r/100;try{t.delayTime.value=i,t.feedback.value=o,t._crossFade&&(t._crossFade.fade.value=A),t._wetAmount=A,E.debug("DelayAudioEffect","Updated delay instance",{delayTime:i,feedbackAmount:o,wetAmount:A},"audio")}catch(a){E.warn("DelayAudioEffect","Failed to update delay instance",a,"audio")}}createDelaySettings(t,e,s=30){if(t===0&&e===0)return null;const r=Math.max(.01,t/100*.5),i=Math.min(.95,e/100),o=s/100;return{time:r,feedback:i,wet:o}}disableForColor(t){var s;this.updateParameters({time:0,feedback:0,wet:0},t);const e=this.delayInstances.get(t);if(e)try{(s=e._crossFade)==null||s.dispose(),e.dispose()}finally{this.delayInstances.delete(t)}}dispose(){this.delayInstances.forEach((t,e)=>{var s;try{(s=t._crossFade)==null||s.dispose(),t.dispose()}catch(r){E.warn("DelayAudioEffect",`Failed to dispose delay for ${e}`,r,"audio")}}),this.currentSettings.clear(),this.delayInstances.clear(),E.info("DelayAudioEffect","Disposed",null,"audio")}}E.moduleLoaded("AudioEffectsManager");const tR=()=>window.synthEngine;class eR{constructor(){M(this,"vibratoEffect",new Yk);M(this,"tremoloEffect",new jk);M(this,"delayEffect",new Zk)}init(){return this.vibratoEffect.init(),this.tremoloEffect.init(),this.delayEffect.init(),f.on("audioEffectChanged",t=>{if(!t)return;const{effectType:e,parameter:s,value:r,color:i,effectParams:o}=t;this.handleAudioEffectChange(e,s,r,i,o)}),E.info("AudioEffectsManager","Event subscriptions established",null,"audio"),!0}handleAudioEffectChange(t,e,s,r,i){switch(E.debug("AudioEffectsManager",`Processing audio effect: ${t}.${e} = ${s} for ${r}`,null,"audio"),t){case"vibrato":this.vibratoEffect.updateParameters(i,r);break;case"tremolo":this.tremoloEffect.updateParameters(i,r);break;case"delay":this.delayEffect.updateParameters(i,r);break;default:E.debug("AudioEffectsManager",`Effect type ${t} not handled by audio system`,null,"audio")}}getEffectHandler(t){switch(t){case"vibrato":return this.vibratoEffect;case"tremolo":return this.tremoloEffect;case"delay":return this.delayEffect;default:return null}}applySynthEffects(t,e,s){var o,A;const r=this.delayEffect.getEffectInstance(e);try{t.disconnect()}catch{}let i=t;if(r)try{i.connect(r),i=r}catch(a){E.error("AudioEffectsManager","Delay connection error",a,"audio")}try{i.connect(s);const a=(A=(o=tR())==null?void 0:o.getWaveformAnalyzer)==null?void 0:A.call(o,e);a&&t.connect(a)}catch(a){E.error("AudioEffectsManager","masterGain connection error",a,"audio")}}applyEffectsToVoice(t,e){this.vibratoEffect.applyToVoice(t,e),this.tremoloEffect.applyToVoice(t,e)}dispose(){this.vibratoEffect.dispose(),this.tremoloEffect.dispose(),this.delayEffect.dispose(),E.info("AudioEffectsManager","Disposed",null,"audio")}}const j0=new eR;function nR(){$0("adsr-envelope","#adsr-envelope"),HN(),$0("filter-controls-bridge",document.body),E.initStart("Waveform Visualizer"),Gk()?E.initSuccess("Waveform Visualizer"):E.initFailed("Waveform Visualizer"),E.initStart("Effects Managers"),Y0.init(),j0.init(),Ir.init(),Fr.init();const n=window;n.effectsCoordinator=Ir,n.animationEffectsManager=Y0,n.audioEffectsManager=j0,n.effectsController=Fr,E.initSuccess("Effects Managers")}function sR({cx:n,cy:t,rx:e,ry:s,stroke:r="currentColor",strokeWidth:i=3}){const o=document.createElementNS("http://www.w3.org/2000/svg","ellipse");return o.setAttribute("cx",`${n}`),o.setAttribute("cy",`${t}`),o.setAttribute("rx",`${e}`),o.setAttribute("ry",`${s}`),o.setAttribute("fill","none"),o.setAttribute("stroke",r),o.setAttribute("stroke-width",`${i}`),o.setAttribute("stroke-linecap","round"),o}function rR(n,t=48,e=48){const s=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=n.span==="quarter",i=r?200:100;s.setAttribute("viewBox",`0 0 ${i} 100`),s.setAttribute("width",`${t}`),s.setAttribute("height",`${e}`),s.setAttribute("aria-label",n.label),s.style.color="#000000";const A=50,a=r?32:16,l=40,c=r?[33.33,100,166.67]:[16.67,50,83.33];return n.hits.forEach(u=>{const d=sR({cx:c[u]??0,cy:A,rx:a,ry:l,stroke:"currentColor",strokeWidth:3});s.appendChild(d)}),s}const Ba={selectedTripletStampId:1,init(){this.render(),this.bindEvents(),E.info("TripletStampsToolbar","Triplet stamps toolbar initialized",null,"triplets")},render(){const n=document.getElementById("triplet-stamps-toolbar-container");if(!n){E.warn("TripletStampsToolbar","Container not found",null,"triplets");return}n.innerHTML="";const t=Kl.filter(r=>r.span==="eighth"),e=Kl.filter(r=>r.span==="quarter"),s=document.createElement("div");if(s.className="triplet-stamps-grid",t.length>0){const r=document.createElement("div");r.className="triplet-stamps-row triplet-stamps-eighth-row",t.forEach(i=>{const o=this.createTripletStampButton(i);r.appendChild(o)}),s.appendChild(r)}if(e.length>0){const r=document.createElement("div");if(r.className="triplet-stamps-row triplet-stamps-quarter-row",e.slice(0,3).forEach(i=>{const o=this.createTripletStampButton(i);o.classList.add("triplet-stamp-button-wide"),r.appendChild(o)}),s.appendChild(r),e.length>3){const i=document.createElement("div");i.className="triplet-stamps-row triplet-stamps-quarter-row",e.slice(3).forEach(o=>{const A=this.createTripletStampButton(o);A.classList.add("triplet-stamp-button-wide"),i.appendChild(A)}),s.appendChild(i)}}n.appendChild(s),this.setInitialSelection(this.selectedTripletStampId)},createTripletStampButton(n){const t=document.createElement("button");t.className="triplet-stamp-button",t.dataset.tripletStampId=`${n.id}`,t.setAttribute("title",n.label||`Triplet ${n.id}`);const s=n.span==="quarter"?80:40,i=rR(n,s,40);return i.style.width="100%",i.style.height="100%",i.style.maxWidth="100%",i.style.maxHeight="100%",t.appendChild(i),t},bindEvents(){const n=document.getElementById("triplet-stamps-toolbar-container");n&&(n.addEventListener("click",t=>{var r;const e=(r=t.target)==null?void 0:r.closest(".triplet-stamp-button");if(!e)return;const s=parseInt(e.dataset.tripletStampId||"",10);Number.isNaN(s)||this.selectTripletStamp(s)}),f.on("toolChanged",({newTool:t}={})=>{t&&t!=="tripletStamp"&&this.clearSelection()}),f.on("sixteenthStampToolSelected",()=>{this.clearSelection()}))},setInitialSelection(n){this.selectedTripletStampId=n;const t=document.getElementById("triplet-stamps-toolbar-container");t&&t.querySelectorAll(".triplet-stamp-button").forEach(e=>{const s=e;s.classList.toggle("active",parseInt(s.dataset.tripletStampId||"",10)===n)})},selectTripletStamp(n){this.selectedTripletStampId=n;const t=document.getElementById("triplet-stamps-toolbar-container");t&&t.querySelectorAll(".triplet-stamp-button").forEach(e=>{const s=e;s.classList.toggle("active",parseInt(s.dataset.tripletStampId||"",10)===n)}),f.setSelectedTool("tripletStamp"),f.emit("tripletStampSelected",n),f.emit("tripletStampToolSelected")},clearSelection(){const n=document.getElementById("triplet-stamps-toolbar-container");n&&n.querySelectorAll(".triplet-stamp-button").forEach(t=>{t.classList.remove("active")})},getSelectedTripletStamp(){return Kl.find(t=>t.id===this.selectedTripletStampId)}};function iR(){var n,t;zM.init(),((n=re.initialize)==null?void 0:n.call(re))??((t=re.init)==null||t.call(re)),Wu.init(),Ba.init(),E.initSuccess("RhythmUi")}class oR{constructor(){M(this,"gridsWrapper",null);M(this,"pitchGridWrapper",null);M(this,"drumGridWrapper",null);M(this,"gridScrollbarProxy",null);M(this,"isInitialized",!1);M(this,"lastScrollTime",0);M(this,"isSyncingFromProxy",!1);M(this,"isSyncingFromWrapper",!1);M(this,"handleWrapperScroll");M(this,"handleProxyScroll")}init(){if(this.gridsWrapper=document.getElementById("grids-wrapper"),this.pitchGridWrapper=document.getElementById("pitch-grid-wrapper"),this.drumGridWrapper=document.getElementById("drum-grid-wrapper"),this.gridScrollbarProxy=document.getElementById("grid-scrollbar-proxy"),!this.gridsWrapper||!this.pitchGridWrapper||!this.drumGridWrapper){E.error("ScrollSyncService","Required elements not found for scroll sync",null,"scroll");return}this.setupScrollSynchronization(),this.isInitialized=!0,E.info("ScrollSyncService","Initialized with unified grids-wrapper structure",null,"scroll")}setupScrollSynchronization(){this.handleWrapperScroll=this.handleWrapperScrollInternal.bind(this),this.handleProxyScroll=this.handleProxyScrollInternal.bind(this),this.gridsWrapper.addEventListener("scroll",this.handleWrapperScroll,{passive:!0}),this.gridScrollbarProxy?this.gridScrollbarProxy.addEventListener("scroll",this.handleProxyScroll,{passive:!0}):E.warn("ScrollSyncService","Grid scrollbar proxy not found; falling back to native scrollbars.",null,"scroll")}handleWrapperScrollInternal(t){if(this.isSyncingFromProxy||!this.gridsWrapper)return;const e=Date.now();if(this.lastScrollTime=e,this.gridScrollbarProxy){const r=this.gridsWrapper.scrollLeft;Math.abs(this.gridScrollbarProxy.scrollLeft-r)>.5&&(this.isSyncingFromWrapper=!0,this.gridScrollbarProxy.scrollLeft=r,this.isSyncingFromWrapper=!1)}const s=t.target;E.debug("ScrollSyncService",`Unified scroll: ${(s==null?void 0:s.scrollLeft)??0}px`,null,"scroll")}handleProxyScrollInternal(){if(this.isSyncingFromWrapper||!this.gridScrollbarProxy)return;const t=this.gridScrollbarProxy.scrollLeft;this.gridsWrapper&&Math.abs(this.gridsWrapper.scrollLeft-t)>.5&&(this.isSyncingFromProxy=!0,this.gridsWrapper.scrollLeft=t,this.isSyncingFromProxy=!1)}syncScrollTo(t){!this.isInitialized||!this.gridsWrapper||(this.isSyncingFromProxy=!0,this.isSyncingFromWrapper=!0,this.gridsWrapper.scrollLeft=t,this.gridScrollbarProxy&&(this.gridScrollbarProxy.scrollLeft=t),this.isSyncingFromProxy=!1,this.isSyncingFromWrapper=!1)}}const AR=new oR;function J0(n){if(n)return n.uuid}function Db(n,t=null){const e=Array.isArray(t)?t:n.macrobeatGroupings||[],r=[...Ye(n)].sort((c,u)=>c.preMacrobeatIndex-u.preMacrobeatIndex);let i=0;const o=[];let A=0;const a=c=>{o.push({visualIndex:o.length,type:`legend-${c}`,timeIndex:null})},l=c=>{for(;i<r.length;){const u=r[i];if((u==null?void 0:u.preMacrobeatIndex)!==c)break;o.push({visualIndex:o.length,type:"tonic",timeIndex:null}),o.push({visualIndex:o.length,type:"tonic",timeIndex:null});const d=J0(u);if(d)do i++;while(i<r.length&&J0(r[i])===d);else i++}};return a("left"),a("left"),l(-1),e.forEach((c,u)=>{for(let d=0;d<c;d++)o.push({visualIndex:o.length,type:"time",timeIndex:A++});l(u)}),a("right"),a("right"),{entries:o,totalTimeColumns:A}}function aR(n,t,e=null){if(e!==null){const{entries:s}=Db(n,e),r=s[t];return r?r.timeIndex:null}return r_(t,n)}function lR(n,t,e=null){if(t==null)return null;if(e!==null){const{entries:s,totalTimeColumns:r}=Db(n,e);if(t<0||t>=r)return null;const i=s.find(o=>o.timeIndex===t);return i?i.visualIndex:null}return i_(t,n)}let Dl=!1,Tr="C4",zc=null;function ic(){var n;return{pitches:[],rootNote:Tr,color:((n=f.state.selectedNote)==null?void 0:n.color)||"#000000"}}let ms=ic();function cR(){const n=document.activeElement;if(!(n instanceof HTMLElement))return!0;const t=n.tagName.toLowerCase();return!(["input","textarea","select"].includes(t)||n.isContentEditable)}function uR(n){const t=n.globalRow??n.row,e=f.state.fullRowData[t];return e?e.toneNote:"C4"}function Z0(){const n=f.state.placedNotes.slice().reverse().find(t=>!t.isDrum);Tr=n?uR(n):"C4"}function tv(n){const{activeChordIntervals:t}=f.state;return!n||!(t!=null&&t.length)?[]:t.map(e=>{const s=So(n,e);return UA(s)})}function dR(){Z0(),f.on("notesChanged",Z0),document.addEventListener("keydown",n=>{var r;if(n.code!=="Enter"||Dl||n.repeat||!cR())return;n.preventDefault(),Dl=!0;const t=(r=f.state.selectedNote)==null?void 0:r.color;let e,s=[];if(zc&&t){const i=f.state.fullRowData[zc.row];e=i?i.toneNote:Tr,f.state.selectedTool==="chord"?s=tv(e):s=[e]}else t&&Tr&&(e=Tr,f.state.selectedTool==="chord"?s=tv(Tr):s=[Tr]);if(s.length>0&&t&&e){ms={pitches:[...s],rootNote:e,color:t},s.forEach(a=>{Wt.triggerAttack(a,t)});const i=f.state.fullRowData.find(a=>a.toneNote===e);i&&i.hex;const o=f.state.timbres[t];if(!o)return;o.adsr,f.emit("spacebarPlayback",{note:e,color:t,isPlaying:!0});const A=`spacebar-${Date.now()}`;f.emit("noteAttack",{noteId:A,color:t}),ms.noteId=A}}),document.addEventListener("keyup",n=>{if(n.code!=="Enter"||!Dl)return;n.preventDefault(),Dl=!1;const t=ms.pitches;if(!Array.isArray(t)||t.length===0){ms=ic();return}const e=ms.color;if(e){t.forEach(o=>{Wt.triggerRelease(o,e)});const s=ms.rootNote??Tr,r=f.state.fullRowData.find(o=>o.toneNote===s);r&&r.hex;const i=f.state.timbres[e];if(!i){ms=ic();return}i.adsr,f.emit("spacebarPlayback",{note:s,color:e,isPlaying:!1}),ms.noteId&&f.emit("noteRelease",{noteId:ms.noteId,color:e})}ms=ic()})}function Lb(n,t){var s;zc={col:n,row:t};const e=(s=f.state.selectedNote)==null?void 0:s.color;e&&f.emit("ghostNoteUpdated",{color:e})}function kb(){zc=null,f.emit("ghostNoteCleared")}const hR={single:40,chord:20,transient:30};function Rb(n){return String(n)}function fR(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}const ev={single:0,chord:0,transient:0},Lr=new Map;function nv(n,t){const e=Rb(t),s=Lr.get(n)??new Set;s.add(e),Lr.set(n,s)}function sv(n,t){const e=Lr.get(n);e&&(e.delete(Rb(t)),e.size===0&&Lr.delete(n))}const un={shouldPlayPreview(n){const t=fR(),e=hR[n],s=ev[n];return t-s<e?!1:(ev[n]=t,!0)},triggerAttack(n,t,e={}){const s=e.kind??"single";return!e.bypassThrottle&&!this.shouldPlayPreview(s)?!1:(Wt.triggerAttack(n,t),nv(t,n),!0)},triggerAttacks(n,t,e={}){const s=e.kind??"chord";return!e.bypassThrottle&&!this.shouldPlayPreview(s)?!1:(n.forEach(r=>{Wt.triggerAttack(r,t),nv(t,r)}),!0)},triggerRelease(n,t){Wt.triggerRelease(n,t),sv(t,n)},releasePitches(n,t){n.forEach(e=>{this.triggerRelease(e,t)})},quickReleasePitches(n,t){!n||n.length===0||(Wt.quickReleasePitches(n,t),n.forEach(e=>sv(t,e)))},playTransient(n,t,e=100){this.triggerAttack(n,t,{kind:"transient"})&&setTimeout(()=>this.triggerRelease(n,t),e)},releaseAll(n){if(typeof n=="string"){const t=Lr.get(n);if(!t)return;Array.from(t.values()).forEach(e=>{Wt.triggerRelease(e,n)}),Lr.delete(n);return}for(const[t,e]of Lr.entries())Array.from(e.values()).forEach(s=>{Wt.triggerRelease(s,t)});Lr.clear()}};class pR{constructor(){M(this,"isDragging",!1);M(this,"draggedModulationMarker",null);M(this,"lastModulationHoverResult",null)}handleMouseDown(t,e){for(const s of f.state.tempoModulationMarkers||[]){const r=s.xCanvas??s.xPosition??0,i=Ag(t,e,{...s,xCanvas:r});if(i){if(i.type==="label"){const o=s.ratio===Fn.COMPRESSION_2_3?Fn.EXPANSION_3_2:Fn.COMPRESSION_2_3;return f.setModulationRatio(s.id,o),!0}if(i.type==="barline"&&i.canDrag)return this.isDragging=!0,this.draggedModulationMarker=s,document.body.style.cursor=ag(i),!0}}return!1}handlePlacementClick(t,e){if(f.state.selectedTool!=="modulation")return!1;const s=f.state.selectedModulationRatio;if(typeof s!="number")return E.warn("PitchGridModulationToolInteractor","No modulation ratio selected before placement",null,"grid"),!0;const r=e(t);if(!r)return E.warn("PitchGridModulationToolInteractor","Modulation placement must be near a measure boundary",{clickX:t},"grid"),!0;E.debug("PitchGridModulationToolInteractor","Placing modulation marker at boundary",{measureIndex:r.measureIndex,ratio:s,clickX:t,boundaryX:r.xPosition},"grid");const i=f.addModulationMarker(r.measureIndex,s,r.xPosition,null,r.macrobeatIndex);return E.debug("PitchGridModulationToolInteractor","Modulation marker placed",{markerId:i,measureIndex:r.measureIndex,ratio:s},"grid"),!0}handleMouseMove(t){if(!this.isDragging||!this.draggedModulationMarker)return!1;const e=f.state.baseMicrobeatPx||f.state.cellWidth||40,s=Math.round(t/e)*e;return f.moveModulationMarker(this.draggedModulationMarker.id,s),!0}getHoveredMarker(t,e){for(const s of f.state.tempoModulationMarkers||[]){const r=s.xCanvas??s.xPosition??0,i=Ag(t,e,{...s,xCanvas:r});if(i)return i}return null}updateCursor(t,e){if(e){t.style.cursor=ag(e),this.lastModulationHoverResult=e;return}this.lastModulationHoverResult&&(t.style.cursor="default",this.lastModulationHoverResult=null)}handleMouseUp(){return this.isDragging?(this.isDragging=!1,this.draggedModulationMarker=null,!0):!1}}class mR{handleExistingNoteMouseDown(t,e,s,r){var l,c;if(f.state.selectedTool!=="note")return{handled:!1,state:s};const i=f.state.placedNotes.find(u=>!u.isDrum&&u.row===e&&t>=u.startColumnIndex&&t<=u.endColumnIndex);if(!i)return{handled:!1,state:s};const o=r.getPitchForRow(e);if(!o)return{handled:!0,state:s};const A=window.waveformVisualizer;A&&(A.currentColor=i.color,A.generateWaveform(),A.startSingleNoteVisualization(i.color));const a=re.getSixteenthStampAtPosition(t,e);return a?(re.playRhythmPattern(a.sixteenthStampId,o,i.color,i.shape,a),{handled:!0,state:{...s,activePreviewPitches:[o],activeNote:i}}):(un.triggerAttack(o,i.color,{kind:"single",bypassThrottle:!0}),(l=f.state.fullRowData[e])!=null&&l.hex,(c=f.state.timbres[i.color])==null||c.adsr,{handled:!0,state:{...s,activePreviewPitches:[o],activeNote:i}})}attemptPlaceNoteAt(t,e,s,r,i){var h,m;if(f.state.selectedTool!=="note")return{placed:!1,state:s,shouldStartDragging:!1};if(!Aa(t,f.state))return{placed:!1,state:s,shouldStartDragging:!1};const o=f.state.selectedNote;if(!o)return{placed:!1,state:s,shouldStartDragging:!1};const{shape:A,color:a}=o;if(A==="circle"&&!Aa(t+1,f.state))return{placed:!1,state:s,shouldStartDragging:!1};const l=A==="circle"?t+1:t,c={row:e,startColumnIndex:t,endColumnIndex:l,color:a,shape:A,isDrum:!1},u=f.addNote(c);if(!u)return{placed:!1,state:s,shouldStartDragging:!1};const d={...s,activeNote:u,lastDragRow:e};u.uuid&&f.emit("noteInteractionStart",{noteId:u.uuid,color:u.color});const p=i.getPitchForRow(e);if(p){u.uuid&&(r.add(u.uuid),f.emit("noteAttack",{noteId:u.uuid,color:u.color})),d.activePreviewPitches=[p],un.triggerAttack(p,u.color,{kind:"single",bypassThrottle:!0}),(h=f.state.fullRowData[e])!=null&&h.hex,(m=f.state.timbres[u.color])==null||m.adsr;const g=window.waveformVisualizer;g&&(g.currentColor=u.color,g.generateWaveform(),g.startSingleNoteVisualization(u.color))}return{placed:!0,state:d,shouldStartDragging:!0}}handleActiveNoteDrag(t,e,s,r){var l,c,u,d;const i=s.activeNote;if(!i)return s;const o=t,A=e,a=i.uuid;if(i.shape==="circle"){if(o!==i.endColumnIndex&&f.updateNoteTail(i,o),A!==s.lastDragRow){const p=r.getPitchForRow(A);if(!p)return s;s.activePreviewPitches.length>0&&un.quickReleasePitches(s.activePreviewPitches,i.color);const h=f.state.placedNotes.find(y=>y.uuid===a);h&&f.updateNoteRow(h,A);const g=f.state.placedNotes.find(y=>y.uuid===a)||h||i;let v=s.activePreviewPitches;return un.triggerAttack(p,g.color,{kind:"single"})&&(v=[p]),(l=f.state.fullRowData[A])!=null&&l.hex,((c=f.state.timbres[g.color])==null?void 0:c.adsr)&&g.uuid,{...s,activeNote:g,lastDragRow:A,activePreviewPitches:v}}return s}if(i.shape==="oval"){const p=t;if(p!==i.startColumnIndex&&f.updateNotePosition(i,p),A!==s.lastDragRow){const h=r.getPitchForRow(A);if(!h)return s;s.activePreviewPitches.length>0&&un.quickReleasePitches(s.activePreviewPitches,i.color);const m=f.state.placedNotes.find(I=>I.uuid===a);m&&f.updateNoteRow(m,A);const v=f.state.placedNotes.find(I=>I.uuid===a)||m||i;let w=s.activePreviewPitches;return un.triggerAttack(h,v.color,{kind:"single"})&&(w=[h]),(u=f.state.fullRowData[A])!=null&&u.hex,((d=f.state.timbres[v.color])==null?void 0:d.adsr)&&v.uuid,{...s,activeNote:v,lastDragRow:A,activePreviewPitches:w}}}return s}}class gR{handleMouseDown(t,e){if(f.state.selectedTool!=="eraser")return{handled:!1,shouldStartDrag:!1};f.eraseInPitchArea(t,e,2,!1);const s=t+2-1,r=e-1,i=e+1;return jN(t,s,r,i),eD(t,s,r,i),{handled:!0,shouldStartDrag:!0}}handleMouseMove(t,e,s){if(!s)return!1;f.eraseInPitchArea(t,e,2,!1);const r=t+2-1,i=e-1,o=e+1;return f.eraseSixteenthStampsInArea(t,r,i,o),f.eraseTripletStampsInArea(t,r,i,o),!0}}class vR{handleMouseDown(t,e,s,r,i){var d,p;if(f.state.selectedTool!=="chord")return{handled:!1,state:s,shouldStartDragging:!1};if(!Aa(t,f.state))return{handled:!0,state:s,shouldStartDragging:!1};const o=i.getPitchForRow(e);if(!o)return{handled:!0,state:s,shouldStartDragging:!1};const A=i.getChordPitchesForRootPitch(o),a=f.state.selectedNote;if(!a)return{handled:!0,state:s,shouldStartDragging:!1};const{shape:l,color:c}=a;un.triggerAttacks(A,c,{kind:"chord",bypassThrottle:!0}),(d=f.state.fullRowData[e])!=null&&d.hex,(p=f.state.timbres[c])==null||p.adsr;const u=[];return A.forEach(h=>{const m=f.state.fullRowData.findIndex(y=>y.toneNote===h);if(m===-1)return;const g=l==="circle"?t+1:t,v={row:m,startColumnIndex:t,endColumnIndex:g,color:c,shape:l,isDrum:!1},w=f.addNote(v);w&&(u.push(w),w.uuid&&(r.add(w.uuid),f.emit("noteAttack",{noteId:w.uuid,color:w.color}),f.emit("noteInteractionStart",{noteId:w.uuid,color:w.color})))}),{handled:!0,shouldStartDragging:!0,state:{...s,activeChordNotes:u,activePreviewPitches:[...A],lastDragRow:e}}}handleActiveChordDrag(t,e,s,r){if(!s.activeChordNotes||s.activeChordNotes.length===0)return s;const i=s.activeChordNotes[0];if(!i)return s;const o=i.color,A=e;if(i.shape==="circle"){const a=t,l=s.activeChordNotes.filter(c=>a!==c.endColumnIndex);if(l.length>0&&f.updateMultipleNoteTails(l,a),A!==s.lastDragRow){const c=s.lastDragRow??i.row,u=A-c;if(u===0)return s;un.quickReleasePitches(s.activePreviewPitches,o);const d=s.activeChordNotes.map(m=>m.row+u);if(!d.every(m=>r.getPitchForRow(m)!==null))return s;f.updateMultipleNoteRows(s.activeChordNotes,d);const h=d.map(m=>r.getPitchForRow(m)).filter(m=>typeof m=="string");return un.triggerAttacks(h,o,{kind:"chord"}),{...s,activePreviewPitches:h,lastDragRow:A}}return s}if(i.shape==="oval"){const a=t,l=s.activeChordNotes.filter(m=>a!==m.startColumnIndex);l.length>0&&f.updateMultipleNotePositions(l,a);const c=s.lastDragRow!==null?s.lastDragRow:i.row,u=A-c;if(u===0)return s;un.quickReleasePitches(s.activePreviewPitches,o);const d=s.activeChordNotes.map(m=>m.row+u);if(!d.every(m=>r.getPitchForRow(m)!==null))return s;f.updateMultipleNoteRows(s.activeChordNotes,d);const h=d.map(m=>r.getPitchForRow(m)).filter(m=>typeof m=="string");return un.triggerAttacks(h,o,{kind:"chord"}),{...s,activePreviewPitches:h,lastDragRow:A}}return s}}function wR(n,t,e,s){var l,c;const r=Eu(e.sixteenthStampId);if(!r)return null;const i=lt(e.startColumn,s),o=s.cellWidth*2,A=s.cellHeight,a=[.125,.375,.625,.875].map(u=>i+u*o);for(const u of r.diamonds){const d=`diamond_${u}`,p=((l=e.shapeOffsets)==null?void 0:l[d])||0,h=e.row+p,m=xt(h,s),g=a[u];if(g===void 0)continue;const v=Math.sqrt(Math.pow(n-g,2)+Math.pow(t-m,2)),w=Math.min(o*.2,A*1);if(v<w)return{type:"diamond",slot:u??0,shapeKey:d,cx:g,cy:m,placement:e}}for(const u of r.ovals){const d=`oval_${u}`,p=((c=e.shapeOffsets)==null?void 0:c[d])||0,h=e.row+p,m=xt(h,s),g=u===0?i+.25*o:i+.75*o,v=Math.sqrt(Math.pow(n-g,2)+Math.pow(t-m,2)),w=Math.min(o*.25,A*1);if(v<w)return{type:"oval",slot:u,shapeKey:d,cx:g,cy:m,placement:e}}return null}function rv(n,t,e,s){for(const r of e){const i=wR(n,t,r,s);if(i)return i}return null}class BR{constructor(){M(this,"draggedStampShape",null)}isDraggingShape(){return this.draggedStampShape!==null}tryStartShapeDrag(t){const e=f.getAllSixteenthStampPlacements(),s={...f.state},r=rv(t.actualX,t.canvasY,e,s);return r?(this.draggedStampShape={...r,startRow:f.getSixteenthStampShapeRow(r.placement,r.shapeKey),startMouseY:t.canvasY},!0):!1}handleMouseDown(t){if(this.tryStartShapeDrag({actualX:t.actualX,canvasY:t.canvasY}))return{handled:!0};if(f.state.selectedTool!=="sixteenthStamp")return{handled:!1};const e=re.getSixteenthStampAtPosition(t.colIndex,t.rowIndex);if(e){const l=t.getPitchForRow(t.rowIndex);if(!l)return{handled:!0};const c=f.state.placedNotes.find(d=>!d.isDrum&&d.row===t.rowIndex&&t.colIndex>=d.startColumnIndex&&t.colIndex<=d.endColumnIndex),u=c?c.shape:"oval";return re.playRhythmPattern(e.sixteenthStampId,l,e.color,u,e),{handled:!0,activePreviewPitches:[l]}}const s=Wu.getSelectedSixteenthStamp();if(!s)return{handled:!0};const r=t.getTimeAlignedCanvasColumn(t.colIndex);if(r===null)return{handled:!0};const i=f.state.selectedNote;if(!i)return{handled:!0};const{color:o,shape:A}=i;YN(s.id,r,t.rowIndex,o);const a=t.getPitchForRow(t.rowIndex);return a?(re.playRhythmPattern(s.id,a,o,A),f.recordState(),{handled:!0,activePreviewPitches:[a]}):(f.recordState(),{handled:!0})}handleMouseMove(t){var s;if(!this.draggedStampShape)return!1;const e=t.rowIndex-this.draggedStampShape.placement.row;if(f.updateSixteenthStampShapeOffset(this.draggedStampShape.placement.id,this.draggedStampShape.shapeKey,e),t.rowIndex!==this.draggedStampShape.startRow){const r=t.getPitchForRow(t.rowIndex);if(r){const i=this.draggedStampShape.placement.color||((s=f.state.selectedNote)==null?void 0:s.color);i&&un.playTransient(r,i,100)}this.draggedStampShape.startRow=t.rowIndex}return t.canvasEl&&(t.canvasEl.style.cursor="ns-resize"),!0}updateHoverCursor(t){if(f.state.selectedTool!=="sixteenthStamp"||this.draggedStampShape)return;const e=t.canvasEl;if(!e)return;const s=f.getAllSixteenthStampPlacements(),r={...f.state};rv(t.actualX,t.canvasY,s,r)||CR(t.actualX,t.canvasY,s,r)?e.style.cursor="grab":e.style.cursor="default"}handleMouseUp(){if(!this.draggedStampShape)return!1;this.draggedStampShape=null,f.recordState();const t=document.getElementById("notation-grid");return t&&(t.style.cursor="default"),!0}}function CR(n,t,e,s){const r=s.columnWidths||[];for(const i of e){const o=i.startColumn,A=Math.min(i.endColumn,r.length),a=lt(o,s),l=lt(A,s),u=xt(i.row,s)-s.cellHeight/2;if(n>=a&&n<=l&&t>=u&&t<=u+s.cellHeight)return!0}return!1}function bR(n,t,e,s){var d;const r=xu(e.tripletStampId);if(!r)return null;const i=e.span*2,o=Cn(e.startTimeIndex,f.state),A=o+i,a=lt(o,s),c=lt(A,s)-a,u=s.cellHeight;for(const p of r.hits){const h=`triplet_${p}`,m=((d=e.shapeOffsets)==null?void 0:d[h])||0,g=e.row+m,v=xt(g,s),w=pB[p];if(w===void 0)continue;const y=a+c*w/100,I=Math.sqrt(Math.pow(n-y,2)+Math.pow(t-v,2)),B=Math.min(c*.15,u*1);if(I<B)return{type:"tripletStamp",slot:p,shapeKey:h,cx:y,cy:v,placement:e}}return null}function iv(n,t,e,s){for(const r of e){const i=bR(n,t,r,s);if(i)return i}return null}class yR{constructor(){M(this,"draggedTripletShape",null)}isDraggingShape(){return this.draggedTripletShape!==null}tryStartShapeDrag(t){const e=f.getAllTripletStampPlacements(),s={...f.state},r=iv(t.actualX,t.canvasY,e,s);return r?(this.draggedTripletShape={...r,startRow:f.getTripletStampShapeRow(r.placement,r.shapeKey),startMouseY:t.canvasY},!0):!1}handleMouseDown(t){if(this.tryStartShapeDrag({actualX:t.actualX,canvasY:t.canvasY}))return{handled:!0};if(f.state.selectedTool!=="tripletStamp")return{handled:!1};const e=$r(t.colIndex,f.state);if(e===null)return{handled:!0};const s=e,r=re.getTripletStampAtPosition(s,t.rowIndex);if(r){const a=t.getPitchForRow(t.rowIndex);return a?(re.playTripletPattern(r.tripletStampId,a,r.color,r),{handled:!0,activePreviewPitches:[a]}):{handled:!0}}const i=Ba.getSelectedTripletStamp();if(!i||!f.state.selectedNote)return{handled:!0};const o=ZN(i.id,s,t.rowIndex,f.state.selectedNote.color),A=t.getPitchForRow(t.rowIndex);return A&&o?(re.playTripletPattern(i.id,A,f.state.selectedNote.color,o),f.recordState(),{handled:!0,activePreviewPitches:[A]}):(f.recordState(),{handled:!0})}handleMouseMove(t){var s;if(!this.draggedTripletShape)return!1;const e=t.rowIndex-this.draggedTripletShape.placement.row;if(f.updateTripletStampShapeOffset(this.draggedTripletShape.placement.id,this.draggedTripletShape.shapeKey,e),t.rowIndex!==this.draggedTripletShape.startRow){const r=t.getPitchForRow(t.rowIndex);if(r){const i=this.draggedTripletShape.placement.color||((s=f.state.selectedNote)==null?void 0:s.color);i&&un.playTransient(r,i,100)}this.draggedTripletShape.startRow=t.rowIndex}return t.canvasEl&&(t.canvasEl.style.cursor="ns-resize"),!0}updateHoverCursor(t){if(f.state.selectedTool!=="tripletStamp"||this.draggedTripletShape)return;const e=t.canvasEl;if(!e)return;const s=f.getAllTripletStampPlacements(),r={...f.state};iv(t.actualX,t.canvasY,s,r)||SR(t.actualX,t.canvasY,s,r)?e.style.cursor="grab":e.style.cursor="default"}handleMouseUp(){if(!this.draggedTripletShape)return!1;this.draggedTripletShape=null,f.recordState();const t=document.getElementById("notation-grid");return t&&(t.style.cursor="default"),!0}}function SR(n,t,e,s){for(const r of e){const i=r.span*2,o=Cn(r.startTimeIndex,f.state),A=o+i,a=lt(o,s),l=lt(A,s),u=xt(r.row,s)-s.cellHeight/2;if(n>=a&&n<=l&&t>=u&&t<=u+s.cellHeight)return!0}return!1}function ER(n){const{macrobeatGroupings:t,macrobeatBoundaryStyles:e,columnWidths:s}=f.state,r=s.length;if(n<0||n>=r)return null;let i=-1;for(let u=0;u<t.length;u++){const{startColumn:d,endColumn:p}=mn(f.state,u);if(n>=d&&n<=p){i=u;break}}if(i===-1)return null;let o=0;for(let u=i-1;u>=0;u--)if(e[u]==="solid"){o=u+1;break}const A=o-1;return(u=>u<=0?!0:e[u-1]==="solid")(o)?{drawColumn:mn(f.state,o).startColumn,preMacrobeatIndex:A}:null}function ov(n){return n.replace(/\d+$/,"")}class xR{constructor(){M(this,"lastHoveredTonicPoint",null);M(this,"lastHoveredOctaveRows",[])}resetHoverState(){this.lastHoveredTonicPoint=null,this.lastHoveredOctaveRows=[]}handleMouseMove(t){if(f.state.selectedTool!=="tonicization")return(this.lastHoveredTonicPoint||this.lastHoveredOctaveRows.length>0)&&this.resetHoverState(),!1;const e=ER(t.colIndex);if(!e)return this.resetHoverState(),!0;if(Ye(f.state).some(c=>c.preMacrobeatIndex===e.preMacrobeatIndex))return this.resetHoverState(),!0;const i=t.getPitchForRow(t.rowIndex);if(!i)return this.resetHoverState(),!0;const o=ov(i),A=$s.map((c,u)=>({rowData:c,masterIndex:u})).filter(({rowData:c})=>c.toneNote&&ov(c.toneNote)===o).map(({masterIndex:c})=>c);this.lastHoveredTonicPoint=e,this.lastHoveredOctaveRows=A;const a=A.filter(c=>c>=0&&c<f.state.fullRowData.length);t.hoverCtx.globalAlpha=.5;const l={...f.state,zoomLevel:qe.getViewportInfo().zoomLevel};return a.forEach(c=>{const u={row:c,globalRow:c,columnIndex:e.drawColumn,tonicNumber:f.state.selectedToolTonicNumber,preMacrobeatIndex:e.preMacrobeatIndex};hB(t.hoverCtx,l,u)}),t.hoverCtx.globalAlpha=1,!0}handleMouseDown(){if(f.state.selectedTool!=="tonicization")return!1;if(!this.lastHoveredTonicPoint||this.lastHoveredOctaveRows.length===0)return!0;const t=this.lastHoveredTonicPoint;if(Ye(f.state).some(i=>i.preMacrobeatIndex===t.preMacrobeatIndex))return this.resetHoverState(),!0;const r=this.lastHoveredOctaveRows.map(i=>({row:i,tonicNumber:f.state.selectedToolTonicNumber,preMacrobeatIndex:t.preMacrobeatIndex,columnIndex:t.drawColumn}));return f.addTonicSignGroup(r),this.resetHoverState(),!0}}class IR{constructor(t){this.deps=t}handleToolMouseDown(t){const{toolType:e,colIndex:s,rowIndex:r,actualX:i,canvasY:o}=t,A=t.state;if(e==="chord"){const a=this.deps.chordToolInteractor.handleMouseDown(s,r,{activeChordNotes:A.activeChordNotes,lastDragRow:A.lastDragRow,activePreviewPitches:A.activePreviewPitches},this.deps.placementFillNoteIds,{getPitchForRow:this.deps.getPitchForRow,getChordPitchesForRootPitch:this.deps.getChordPitchesForRootPitch});return{handled:a.handled,state:{...A,isDragging:a.shouldStartDragging?!0:A.isDragging,activeChordNotes:a.state.activeChordNotes,lastDragRow:a.state.lastDragRow,activePreviewPitches:a.state.activePreviewPitches}}}if(e==="tonicization")return this.deps.tonicizationToolInteractor.handleMouseDown(),{handled:!0,state:A};if(e==="eraser"){const a=this.deps.eraserToolInteractor.handleMouseDown(s,r);return{handled:a.handled,state:{...A,isEraserDragActive:a.handled?a.shouldStartDrag:A.isEraserDragActive}}}if(e==="sixteenthStamp"){const a=this.deps.stampToolInteractor.handleMouseDown({colIndex:s,rowIndex:r,actualX:i,canvasY:o,getPitchForRow:this.deps.getPitchForRow,getTimeAlignedCanvasColumn:this.deps.getTimeAlignedCanvasColumn});return{handled:a.handled,state:{...A,activePreviewPitches:a.activePreviewPitches??A.activePreviewPitches}}}if(e==="tripletStamp"){const a=this.deps.tripletToolInteractor.handleMouseDown({colIndex:s,rowIndex:r,actualX:i,canvasY:o,getPitchForRow:this.deps.getPitchForRow});return{handled:a.handled,state:{...A,activePreviewPitches:a.activePreviewPitches??A.activePreviewPitches}}}if(e==="modulation")return this.deps.modulationToolInteractor.handlePlacementClick(i,this.deps.findNearestMeasureBoundary),{handled:!0,state:A};if(e==="note"){const a=this.deps.noteToolInteractor.attemptPlaceNoteAt(s,r,{activeNote:A.activeNote,lastDragRow:A.lastDragRow,activePreviewPitches:A.activePreviewPitches},this.deps.placementFillNoteIds,{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...A,isDragging:a.placed&&a.shouldStartDragging?!0:A.isDragging,activeNote:a.state.activeNote,lastDragRow:a.state.lastDragRow,activePreviewPitches:a.state.activePreviewPitches}}}return{handled:!1,state:A}}handleToolMouseMoveBeforeBoundsCheck(t){const{actualX:e,rowIndex:s,canvasEl:r,state:i}=t;return this.deps.modulationToolInteractor.handleMouseMove(e)?{handled:!0,state:i}:this.deps.stampToolInteractor.handleMouseMove({rowIndex:s,canvasEl:r,getPitchForRow:this.deps.getPitchForRow})?{handled:!0,state:i}:this.deps.tripletToolInteractor.handleMouseMove({rowIndex:s,canvasEl:r,getPitchForRow:this.deps.getPitchForRow})?{handled:!0,state:i}:{handled:!1,state:i}}handleNoteOrChordDragMouseMove(t){const{colIndex:e,rowIndex:s}=t,r=t.state;if(!r.isDragging||!r.activeNote&&r.activeChordNotes.length===0)return{handled:!1,state:r};if(r.activeNote){const o=this.deps.noteToolInteractor.handleActiveNoteDrag(e,s,{activeNote:r.activeNote,lastDragRow:r.lastDragRow,activePreviewPitches:r.activePreviewPitches},{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...r,activeNote:o.activeNote,lastDragRow:o.lastDragRow,activePreviewPitches:o.activePreviewPitches}}}const i=this.deps.chordToolInteractor.handleActiveChordDrag(e,s,{activeChordNotes:r.activeChordNotes,lastDragRow:r.lastDragRow,activePreviewPitches:r.activePreviewPitches},{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...r,activeChordNotes:i.activeChordNotes,lastDragRow:i.lastDragRow,activePreviewPitches:i.activePreviewPitches}}}handleToolHoverVisuals(t){const{toolType:e,actualX:s,canvasY:r,pitchHoverCtx:i,canvasEl:o}=t;e==="sixteenthStamp"?this.deps.stampToolInteractor.updateHoverCursor({actualX:s,canvasY:r,canvasEl:o}):e==="tripletStamp"&&this.deps.tripletToolInteractor.updateHoverCursor({actualX:s,canvasY:r,canvasEl:o});const A=this.deps.modulationToolInteractor.getHoveredMarker(s,r);if(e==="modulation"&&!A&&i){const a=t.findNearestMeasureBoundary(s),l=t.selectedModulationRatio;a&&typeof l=="number"&&t.drawModulationPreview(i,a.xPosition,l)}o&&this.deps.modulationToolInteractor.updateCursor(o,A)}handleToolMouseUp(){return!!(this.deps.stampToolInteractor.handleMouseUp()||this.deps.tripletToolInteractor.handleMouseUp()||this.deps.modulationToolInteractor.handleMouseUp())}handleChordToolHover(t){if(f.state.selectedTool!=="chord")return!1;const e=this.deps.getPitchForRow(t.rowIndex);if(!e)return!0;const s=this.deps.getChordPitchesForRootPitch(e),r=f.state.selectedNote;if(!r)return!0;const{shape:i,color:o}=r;return t.pitchHoverCtx.globalAlpha=.4,s.forEach(A=>{const a=f.state.fullRowData.findIndex(d=>d.toneNote===A);if(a<=-1)return;const l=i==="circle"?t.colIndex+1:t.colIndex,c={row:a,startColumnIndex:t.colIndex,endColumnIndex:l,color:o,shape:i,isDrum:!1},u={...f.state,zoomLevel:t.zoomLevel};i==="oval"?t.drawSingleColumnOvalNote(t.pitchHoverCtx,u,c,a):t.drawTwoColumnOvalNote(t.pitchHoverCtx,u,c,a)}),t.pitchHoverCtx.globalAlpha=1,!0}}class FR{constructor(){M(this,"isActive",!1);M(this,"actionTaken",!1);M(this,"previousTool",null)}getIsActive(){return this.isActive}handleMouseDown(t){var c;const{event:e,colIndex:s,rowIndex:r,annotationService:i}=t;if(e.button!==2)return!1;e.preventDefault(),this.isActive=!0,this.actionTaken=!1,f.state.selectedTool!=="eraser"&&(this.previousTool=f.state.selectedTool,f.setSelectedTool("eraser")),(c=ur.get("eraserButton"))==null||c.classList.add("erasing-active"),this.actionTaken||(this.actionTaken=!!f.eraseInPitchArea(s,r,2,!1)),this.actionTaken||(this.actionTaken=!!f.eraseTonicSignAt(s,!1));const o=s+2-1,A=r-1,a=r+1;this.actionTaken||(this.actionTaken=!!f.eraseSixteenthStampsInArea(s,o,A,a)),this.actionTaken||(this.actionTaken=!!f.eraseTripletStampsInArea(s,o,A,a));const l=e.target instanceof Element?e.target:null;if(l){const u=l.getBoundingClientRect(),d=e.clientX-u.left,p=e.clientY-u.top;this.actionTaken||(this.actionTaken=!!i.eraseAtPoint(d,p))}return!0}handleMouseMove(t){if(!this.isActive)return!1;const{event:e,colIndex:s,rowIndex:r,annotationService:i}=t;this.actionTaken||(this.actionTaken=!!f.eraseInPitchArea(s,r,2,!1)),this.actionTaken||(this.actionTaken=!!f.eraseTonicSignAt(s,!1));const o=s+2-1,A=r-1,a=r+1;this.actionTaken||(this.actionTaken=!!f.eraseSixteenthStampsInArea(s,o,A,a)),this.actionTaken||(this.actionTaken=!!f.eraseTripletStampsInArea(s,o,A,a));const l=e.target instanceof Element?e.target:null;if(l){const c=l.getBoundingClientRect(),u=e.clientX-c.left,d=e.clientY-c.top;this.actionTaken||(this.actionTaken=!!i.eraseAtPoint(u,d))}return!0}handleGlobalMouseUp(){var t;return this.isActive?(this.actionTaken&&f.recordState(),this.isActive=!1,this.actionTaken=!1,this.previousTool&&(f.setSelectedTool(this.previousTool),this.previousTool=null),(t=ur.get("eraserButton"))==null||t.classList.remove("erasing-active"),!0):!1}}class TR{constructor(t,e){M(this,"pitchCanvasElement",null);M(this,"mobileLongPressTimer",null);M(this,"mobileTouchState",null);M(this,"mobileGhostActive",!1);this.deps=t,this.options=e}setPitchCanvasElement(t){this.pitchCanvasElement=t}handleTouchStart(t){var r;if(!this.deps.shouldUseMobileLongPress()||this.mobileTouchState)return;const e=(r=t.changedTouches)==null?void 0:r[0];if(!e)return;const s=this.getTouchGridPosition(e);!s||!this.deps.isPositionWithinPitchGrid(s.colIndex,s.rowIndex)||(t.preventDefault(),this.mobileTouchState={identifier:e.identifier,colIndex:s.colIndex,rowIndex:s.rowIndex},this.mobileLongPressTimer=window.setTimeout(()=>{this.activateMobileGhostPreview()},this.options.longPressDelayMs))}handleTouchMove(t){if(!this.mobileTouchState)return;const e=this.findTouchById(t.changedTouches,this.mobileTouchState.identifier)||this.findTouchById(t.touches,this.mobileTouchState.identifier);if(!e)return;const s=this.getTouchGridPosition(e);if(!s){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive});return}if(!this.deps.isPositionWithinPitchGrid(s.colIndex,s.rowIndex)){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive});return}t.preventDefault(),this.mobileTouchState.colIndex=s.colIndex,this.mobileTouchState.rowIndex=s.rowIndex,this.mobileGhostActive&&this.renderMobileGhostPreview()}handleTouchEnd(t){if(!this.mobileTouchState||!this.findTouchById(t.changedTouches,this.mobileTouchState.identifier))return;t.preventDefault();const s=this.mobileGhostActive,r=this.mobileTouchState.colIndex,i=this.mobileTouchState.rowIndex;if(this.resetMobileTouchState(),!s||this.deps.getSelectedTool()!=="note")return;this.deps.attemptPlaceNoteAt(r,i)?this.deps.onNotePlaced():this.deps.onNoteNotPlaced()}handleTouchCancel(){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive})}getTouchGridPosition(t){var a;if(!this.pitchCanvasElement)return null;const e=this.pitchCanvasElement.getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top,i=((a=document.getElementById("canvas-container"))==null?void 0:a.scrollLeft)??0,o=Ps.getColumnIndex(s+i),A=Ps.getPitchRowIndex(r);return{colIndex:o,rowIndex:A}}findTouchById(t,e){if(!t)return null;for(let s=0;s<t.length;s++){const r=t.item(s);if(r&&r.identifier===e)return r}return null}renderMobileGhostPreview(){const t=this.deps.getPitchHoverCtx();!t||!this.mobileTouchState||(t.clearRect(0,0,$e(t.canvas),ie(t.canvas)),this.deps.drawHoverHighlight(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex,this.deps.getNoteHoverColor(this.options.ghostAlpha)),this.deps.drawGhostNote(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex),this.deps.setGhostNotePosition(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex))}activateMobileGhostPreview(){if(this.mobileTouchState){if(!this.deps.isPositionWithinPitchGrid(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex)){this.resetMobileTouchState({clearOverlay:!1});return}this.mobileGhostActive=!0,this.renderMobileGhostPreview()}}resetMobileTouchState({clearOverlay:t=!1}={}){this.mobileLongPressTimer&&(clearTimeout(this.mobileLongPressTimer),this.mobileLongPressTimer=null),t&&this.mobileGhostActive&&this.deps.clearOverlay(),this.mobileTouchState=null,this.mobileGhostActive=!1}}function _R(n,t){const{activeChordIntervals:e,isIntervalsInverted:s,chordPositionState:r}=t;if(!n||!e||e.length===0)return[];if(s&&e.length===2&&e[0]==="1P"){const A="-"+e[1],a=So(n,A),l=UA(a),c=l.includes("#")&&PA(l).includes("b")?PA(l):l;return[n,c]}const i=e.map(o=>{const A=So(n,o),a=UA(A);if(a.includes("#")){const l=PA(a);if(l.includes("b"))return l}return a});if(e.length>=3&&r>0){const o=[...i];for(let p=0;p<r;p++){const h=o.shift();if(!h)break;const m=So(h,"8P");o.push(UA(m)??h)}const A=o[0],a=n;if(!A)return i;const l=td(A),c=td(a);if(l===null||c===null)return i;let u=0,d=l;for(;d>c;)d-=12,u-=12;for(;d+12<=c;)d+=12,u+=12;return o.map(p=>{const h=td(p);if(h===null)return p;const m=h+u;return IT(m)??p})}return i}let $c=!1,cf=null,uf=null,df=null,IA=null;const mi="grab";function MR(n){if($c){n&&(n.style.cursor=mi);return}cf=document.body.style.cursor||null,uf=document.documentElement.style.cursor||null,df=(n==null?void 0:n.style.cursor)??null,IA=n??null,n&&(n.style.cursor=mi),document.body.style.cursor=mi,document.documentElement.style.cursor=mi,document.body.dataset.cursorOverride="stamp",$c=!0}function Hb(){$c&&(IA&&IA.style.cursor===mi&&(IA.style.cursor=df??""),document.body.style.cursor===mi&&(document.body.style.cursor=cf??""),document.documentElement.style.cursor===mi&&(document.documentElement.style.cursor=uf??""),document.body.dataset.cursorOverride==="stamp"&&delete document.body.dataset.cursorOverride,$c=!1,cf=null,uf=null,df=null,IA=null)}let kt=null,Kr=!1,jt=null,er=[],hn=[];const wo=new Set;let kr=!1,Fs=null;const Ob=new pR,$p=new mR,Vb=new gR,QR=new vR,Xp=new BR,Yp=new yR,Xc=new xR,Gu=new FR,Bo=new IR({noteToolInteractor:$p,chordToolInteractor:QR,eraserToolInteractor:Vb,stampToolInteractor:Xp,tripletToolInteractor:Yp,modulationToolInteractor:Ob,tonicizationToolInteractor:Xc,placementFillNoteIds:wo,getPitchForRow:$o,getTimeAlignedCanvasColumn:hf,getChordPitchesForRootPitch:n=>_R(n,f.state),findNearestMeasureBoundary:Xb}),UR=275,PR=.25,dA=new TR({shouldUseMobileLongPress:LR,isPositionWithinPitchGrid:qb,getSelectedTool:()=>f.state.selectedTool,getPitchHoverCtx:()=>kt,clearOverlay:Xo,drawHoverHighlight:zA,getNoteHoverColor:Gb,drawGhostNote:zb,setGhostNotePosition:Lb,attemptPlaceNoteAt:DR,onNotePlaced:$b,onNoteNotPlaced:Xo},{longPressDelayMs:UR,ghostAlpha:PR}),Wb="#4a90e2";function NR(n,t=1){const e=n.startsWith("#")?n.slice(1):n;if(e.length!==6)return n;const s=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),i=parseInt(e.slice(4,6),16);return`rgba(${s}, ${r}, ${i}, ${t})`}function Gb(n=.2){var e;const t=((e=f.state.selectedNote)==null?void 0:e.color)||Wb;return NR(t,n)}function Av(){var n;return((n=f.state.selectedNote)==null?void 0:n.color)||Wb}function Kb(){return!!Jt.currentTool}function $o(n){const t=f.state.fullRowData[n];return!t||t.isBoundary?null:t.toneNote}function hf(n){const t=n+2,e=aR(f.state,t);if(e===null)return null;const s=lR(f.state,e);return s===null?null:Math.max(0,s-2)}function qb(n,t){var o;const e=(f.state.selectedTool==="note"||f.state.selectedTool==="chord")&&((o=f.state.selectedNote)==null?void 0:o.shape)==="circle",r=(f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths:f.state.columnWidths||[]).length,i=e?r-1:r;return n<0||n>=i?!1:$o(t)!==null}function zA(n,t,e){var l;if(!kt)return;const s={...f.state,zoomLevel:qe.getViewportInfo().zoomLevel},r=lt(n,s),o=xt(t,f.state)-f.state.cellHeight/2,A=f.state.selectedTool;let a;if(f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+1,s)-r:a=(f.state.columnWidths[n]??1)*f.state.cellWidth,A==="eraser"||Gu.getIsActive())f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+2,s)-r:a=f.state.cellWidth*2;else if(A==="note"&&((l=f.state.selectedNote)==null?void 0:l.shape)==="circle")f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+2,s)-r:a=f.state.cellWidth*2;else if(A==="sixteenthStamp")f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+2,s)-r:a=f.state.cellWidth*2;else if(A==="tripletStamp"){const c=Ba.getSelectedTripletStamp();if(c){const d=2*(c.span==="eighth"?1:2);f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+d,s)-r:a=f.state.cellWidth*d}else a=f.state.cellWidth*2}else A==="tonicization"&&(f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+2,s)-r:a=f.state.cellWidth*2);kt.fillStyle=e,kt.fillRect(r,o,a,f.state.cellHeight)}function zb(n,t,e=!1){if(!kt||!f.state.selectedNote)return;const s=f.state.selectedTool,{shape:r,color:i}=f.state.selectedNote;if(kt.globalAlpha=e?.2:.4,s==="note"){const o=r==="circle"?n+1:n,A={uuid:"ghost-note",globalRow:t,row:t,startColumnIndex:n,endColumnIndex:o,color:i,shape:r,isDrum:!1},a={...f.state,zoomLevel:qe.getViewportInfo().zoomLevel};r==="oval"?Bp(kt,a,A,t):wp(kt,a,A,t)}kt.globalAlpha=1}function DR(n,t){const e=$p.attemptPlaceNoteAt(n,t,{activeNote:jt,lastDragRow:Fs,activePreviewPitches:hn},wo,{getPitchForRow:$o});return jt=e.state.activeNote,Fs=e.state.lastDragRow,hn=e.state.activePreviewPitches,e.placed&&e.shouldStartDragging&&(Kr=!0),e.placed}function LR(){if(f.state.selectedTool!=="note")return!1;const n=f.state.deviceProfile;if(n&&typeof n.isMobile=="boolean")return n.isMobile;if(typeof window<"u"&&typeof window.matchMedia=="function")try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}return!1}function kR(n){var a;if(Kb()){Xo();return}if(!kt)return;const t=n.target instanceof Element?n.target:null;if(!t)return;const e=t.getBoundingClientRect(),s=n.clientX-e.left,r=n.clientY-e.top,i=((a=document.getElementById("canvas-container"))==null?void 0:a.scrollLeft)??0,o=Ps.getColumnIndex(s+i),A=Ps.getPitchRowIndex(r);if(!qb(o,A)){f.state.selectedTool;return}if(n.button===2&&Gu.handleMouseDown({event:n,colIndex:o,rowIndex:A,annotationService:Jt})){kt.clearRect(0,0,$e(kt.canvas),ie(kt.canvas)),zA(o,A,"rgba(220, 53, 69, 0.3)");return}if(n.button===0){const l=s+i;if(Ob.handleMouseDown(l,r))return;const c=$p.handleExistingNoteMouseDown(o,A,{activeNote:jt,lastDragRow:Fs,activePreviewPitches:hn},{getPitchForRow:$o});if(c.handled){jt=c.state.activeNote,Fs=c.state.lastDragRow,hn=c.state.activePreviewPitches;return}const u=f.state.selectedTool;if(u==="note"||u==="chord"){const p=Xp.tryStartShapeDrag({actualX:s+i,canvasY:r}),h=!p&&Yp.tryStartShapeDrag({actualX:s+i,canvasY:r});if(p||h)return;const m=re.getSixteenthStampAtPosition(o,A),g=$r(o,f.state),v=g===null?null:re.getTripletStampAtPosition(g,A);if(m||v)return}const d=Bo.handleToolMouseDown({toolType:u,colIndex:o,rowIndex:A,actualX:s+i,canvasY:r,state:{isDragging:Kr,isEraserDragActive:kr,activeNote:jt,activeChordNotes:er,activePreviewPitches:hn,lastDragRow:Fs}});if(d.handled){Kr=d.state.isDragging,kr=d.state.isEraserDragActive,jt=d.state.activeNote,er=d.state.activeChordNotes,hn=d.state.activePreviewPitches,Fs=d.state.lastDragRow;return}}}function RR(n){var Q,U,W;if(Kb()){Xo();return}if(!kt)return;const t=n.target instanceof Element?n.target:null;if(!t)return;const e=t.getBoundingClientRect(),s=n.clientX-e.left,r=n.clientY-e.top,i=((Q=document.getElementById("canvas-container"))==null?void 0:Q.scrollLeft)??0,o=Ps.getColumnIndex(s+i),A=Ps.getPitchRowIndex(r);if(!kt)return;kt.clearRect(0,0,$e(kt.canvas),ie(kt.canvas));const a=n.target instanceof HTMLElement?n.target:null,l=f.state.selectedTool,c=s+i,u=$r(o,f.state);if(Bo.handleToolMouseMoveBeforeBoundsCheck({actualX:c,rowIndex:A,canvasEl:a,state:{isDragging:Kr,isEraserDragActive:kr,activeNote:jt,activeChordNotes:er,activePreviewPitches:hn,lastDragRow:Fs}}).handled)return;Bo.handleToolHoverVisuals({toolType:l,actualX:c,canvasY:r,pitchHoverCtx:kt,canvasEl:a,selectedModulationRatio:f.state.selectedModulationRatio,findNearestMeasureBoundary:Xb,drawModulationPreview:HR});const p=(f.state.selectedTool==="note"||f.state.selectedTool==="chord")&&((U=f.state.selectedNote)==null?void 0:U.shape)==="circle",h=f.state.columnWidths.length,m=p?h-1:h;if(o<0||o>=m||$o(A)===null){Xc.resetHoverState(),kb();return}Lb(o,A);const g=re.getSixteenthStampAtPosition(o,A),v=u===null?null:re.getTripletStampAtPosition(u,A),w=!!(g||v),y=w&&(l==="note"||l==="chord");if(w&&l!=="eraser"&&!Xp.isDraggingShape()&&!Yp.isDraggingShape()?MR(a):Hb(),(l==="sixteenthStamp"||l==="tripletStamp")&&w)return;const C=Bo.handleNoteOrChordDragMouseMove({colIndex:o,rowIndex:A,state:{isDragging:Kr,isEraserDragActive:kr,activeNote:jt,activeChordNotes:er,activePreviewPitches:hn,lastDragRow:Fs}});if(C.handled){Kr=C.state.isDragging,kr=C.state.isEraserDragActive,jt=C.state.activeNote,er=C.state.activeChordNotes,hn=C.state.activePreviewPitches,Fs=C.state.lastDragRow;return}if(!y&&Bo.handleChordToolHover({colIndex:o,rowIndex:A,pitchHoverCtx:kt,zoomLevel:qe.getViewportInfo().zoomLevel,drawSingleColumnOvalNote:Bp,drawTwoColumnOvalNote:wp}))return;if(Gu.handleMouseMove({event:n,colIndex:o,rowIndex:A,annotationService:Jt})){zA(o,A,"rgba(220, 53, 69, 0.3)");return}if(Vb.handleMouseMove(o,A,kr)){zA(o,A,"rgba(220, 53, 69, 0.3)");return}if(kt&&Xc.handleMouseMove({colIndex:o,rowIndex:A,hoverCtx:kt,getPitchForRow:$o})||y)return;const b=Ye(f.state),S=((W=f.state.selectedNote)==null?void 0:W.shape)==="circle";let T=null,x=!0;if(f.state.selectedTool==="note"||f.state.selectedTool==="chord")x=Aa(o,f.state)&&(!S||Aa(o+1,f.state));else if(f.state.selectedTool==="sixteenthStamp"){const D=hf(o);x=D!==null&&!dh(D,b)&&!dh(D+1,b)}else if(f.state.selectedTool==="tripletStamp"){const D=Ba.getSelectedTripletStamp();if(D){const R=$r(o,f.state);if(R===null)x=!1;else{T=R;const q=(fB[D.span]??1)*2,J=Cn(T,f.state);x=!0;for(const nt of b){const At=nt.columnIndex,ot=nt.columnIndex+1;if(At>=J&&At<J+q){x=!1;break}if(J>=At&&J<=ot){x=!1;break}}}}}const _=f.state.selectedTool==="eraser"?"rgba(220, 53, 69, 0.3)":x?Gb(.2):"rgba(220, 53, 69, 0.15)";if(zA(o,A,_),f.state.selectedTool==="sixteenthStamp"){const D=Wu.getSelectedSixteenthStamp();if(D&&x){const R=hf(o);if(R===null)return;const N={cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.columnWidths,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth,macrobeatGroupings:f.state.macrobeatGroupings,previewColor:Av()};aM(kt,R,A,D,N)}}else if(f.state.selectedTool==="tripletStamp"){const D=Ba.getSelectedTripletStamp();if(D&&x&&T!==null){const R={cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.columnWidths,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth,macrobeatGroupings:f.state.macrobeatGroupings,previewColor:Av()};dM(kt,T,A,D,R)}}else x&&zb(o,A)}function Xo(){kt&&kt.clearRect(0,0,$e(kt.canvas),ie(kt.canvas)),Hb(),Xc.resetHoverState(),kb()}function $b(){var n,t,e,s,r;if(!Bo.handleToolMouseUp()){if(hn.length>0){re.stopCurrentPattern();const i=(jt==null?void 0:jt.color)??((n=er[0])==null?void 0:n.color)??((t=f.state.selectedNote)==null?void 0:t.color);i&&un.releasePitches(hn,i);const o=jt;if(o&&i)((e=f.state.timbres[i])==null?void 0:e.adsr)&&(s=f.state.fullRowData[o.row])!=null&&s.hex;else if(i){const a=hn[0];if(!a){hn=[];return}const l=f.state.fullRowData.find(c=>c.toneNote===a);l&&((r=f.state.timbres[i])!=null&&r.adsr)&&l.hex}hn=[];const A=window.waveformVisualizer;A&&A.stopLiveVisualization()}jt!=null&&jt.uuid&&wo.has(jt.uuid)&&(f.emit("noteRelease",{noteId:jt.uuid,color:jt.color}),wo.delete(jt.uuid)),er.forEach(i=>{i!=null&&i.uuid&&wo.has(i.uuid)&&(f.emit("noteRelease",{noteId:i.uuid,color:i.color}),wo.delete(i.uuid))}),Kr&&f.recordState(),Kr=!1,Fs=null,jt!=null&&jt.uuid&&f.emit("noteInteractionEnd",{noteId:jt.uuid}),er.forEach(i=>{i.uuid&&f.emit("noteInteractionEnd",{noteId:i.uuid})}),jt=null,er=[],kr&&(f.recordState(),kr=!1),Gu.handleGlobalMouseUp(),Xo()}}function Xb(n){const{macrobeatBoundaryStyles:t}=f.state,e=100,s=[],r=f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0;E.debug("PitchGridInteractor","Boundary calculation modulation state",{hasModulation:r},"grid");for(let a=0;a<t.length;a++)if(t[a]==="solid"){const l=mn(f.state,a);if(l){const c=l.endColumn+1,u=lt(c,{...f.state,tempoModulationMarkers:f.state.tempoModulationMarkers||[],cellWidth:f.state.cellWidth,columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.columnWidths,baseMicrobeatPx:f.state.cellWidth});E.debug("PitchGridInteractor","Computed measure boundary",{boundaryIndex:a,endColumn:l.endColumn,calculatedX:u,method:"canvas-space"},"grid"),s.push({measureIndex:a+1,xPosition:u,macrobeatIndex:a})}}const i=lt(0,{...f.state,tempoModulationMarkers:f.state.tempoModulationMarkers||[],cellWidth:f.state.cellWidth,columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.columnWidths,baseMicrobeatPx:f.state.cellWidth});E.debug("PitchGridInteractor","Start boundary position",{startBoundaryX:i,method:"canvas-space"},"grid"),s.unshift({measureIndex:0,xPosition:i,macrobeatIndex:-1}),E.debug("PitchGridInteractor","Available measure boundaries",{boundaries:s},"grid"),E.debug("PitchGridInteractor","Modulation click context",{clickX:n,tolerance:e},"grid");let o=null,A=1/0;return s.forEach(a=>{const l=Math.abs(n-a.xPosition);E.debug("PitchGridInteractor","Boundary distance check",{boundaryX:a.xPosition,distance:l},"grid"),l<=e&&l<A&&(A=l,o=a)}),o?E.debug("PitchGridInteractor","Found closest boundary",{boundary:o,distance:A},"grid"):E.debug("PitchGridInteractor","No boundary found within tolerance",{tolerance:e},"grid"),o}function HR(n,t,e){if(!e)return;const s=Kw(e),r=Gw(e);n.save();const i=3,o=2,A=ie(n.canvas);n.strokeStyle=s,n.lineWidth=o,n.globalAlpha=.7,n.setLineDash([]);for(let a=-1;a<=1;a++){const l=t+a*i;n.beginPath(),n.moveTo(l,0),n.lineTo(l,A),n.stroke()}n.globalAlpha=.8,n.font="12px Arial, sans-serif",n.textAlign="center",n.textBaseline="top",n.fillStyle=s,n.fillText(`Preview: ${r}`,t,10),n.restore()}function OR(){const n=document.getElementById("notation-grid"),t=document.getElementById("hover-canvas");if(!n||!t){E.error("PitchGridInteractor","Could not find required canvas elements.",{hasPitchCanvas:!!n,hasHoverCanvas:!!t},"grid");return}if(kt=t.getContext("2d"),!kt){E.error("PitchGridInteractor","Could not get hover canvas context.",null,"grid");return}dA.setPitchCanvasElement(n),n.addEventListener("mousedown",kR),n.addEventListener("mousemove",RR),n.addEventListener("mouseleave",Xo),n.addEventListener("contextmenu",e=>e.preventDefault()),n.addEventListener("touchstart",e=>dA.handleTouchStart(e),{passive:!1}),n.addEventListener("touchmove",e=>dA.handleTouchMove(e),{passive:!1}),n.addEventListener("touchend",e=>dA.handleTouchEnd(e),{passive:!1}),n.addEventListener("touchcancel",()=>dA.handleTouchCancel(),{passive:!1}),window.addEventListener("mouseup",$b)}const VR={init(){OR(),mk(),document.addEventListener("canvasResized",()=>{this.renderPitchGrid(),this.renderDrumGrid()}),f.on("animationUpdate",n=>{n.type==="vibrato"&&n.activeColors&&n.activeColors.length>0?this.renderPitchGrid():n.type==="envelopeFill"||n.hasEnvelopeFills?this.renderPitchGrid():n.type==="combined"&&n.vibratoColors&&n.vibratoColors.length>0&&this.renderPitchGrid()}),E.debug("GridManager","Initialized pitch and drum grid interactions",null,"grid")},renderPitchGrid:Vo.render,renderDrumGrid:tn.render};function WR(){const n=fe.init();return oa.setContexts(n),AR.init(),VR.init(),n}class GR{constructor(){M(this,"currentTool",null);M(this,"toolButtons",[]);M(this,"toolPanels",[]);M(this,"lastSelectedNote",null);M(this,"optionsContainers",{arrow:null,text:null,marker:null,highlighter:null,lasso:null});M(this,"settings",{arrow:{lineStyle:"solid",strokeWeight:4,startArrowhead:"none",endArrowhead:"filled-arrow",arrowheadSize:12},text:{color:"#000000",size:16,bold:!1,italic:!1,underline:!1,background:!1,superscript:!1,subscript:!1},marker:{color:"#4a90e2",size:6},highlighter:{color:"#4a90e2",size:10},lasso:{}})}initialize(){if(this.toolButtons=document.querySelectorAll(".draw-tool-button"),this.toolPanels=document.querySelectorAll(".draw-tool-panel"),this.optionsContainers={arrow:document.getElementById("arrow-tool-options"),text:document.getElementById("text-tool-options"),marker:document.getElementById("marker-tool-options"),highlighter:document.getElementById("highlighter-tool-options"),lasso:document.getElementById("lasso-tool-options")},!this.toolButtons.length||!this.optionsContainers.arrow){E.warn("DrawToolsController","Could not find draw tool elements",null,"draw");return}this.attachEventListeners(),this.setupChordTabListeners(),this.setupMainTabListeners(),this.populateAllPanels(),this.initializePanelWidthSync(),this.logPanelMetrics(),window.addEventListener("resize",()=>this.logPanelMetrics(),{passive:!0}),f.on("noteChanged",({newNote:t}={})=>{this.lastSelectedNote=t??null,this.currentTool&&this.deselectAllTools()})}attachEventListeners(){this.toolButtons.forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.drawTool;this.selectTool(e)})})}setupMainTabListeners(){document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{e.dataset.tab!=="pitch"&&this.currentTool&&(this.deselectAllTools(),this.restoreLastSelectedNote())})})}setupChordTabListeners(){document.querySelectorAll(".pitch-tab-button").forEach(e=>{e.addEventListener("click",()=>{e.dataset.pitchTab!=="draw"&&this.currentTool&&(this.deselectAllTools(),this.restoreLastSelectedNote())})})}restoreLastSelectedNote(){this.lastSelectedNote?(f.setSelectedNote(this.lastSelectedNote.shape,this.lastSelectedNote.color),f.setSelectedTool("note")):f.state.selectedNote&&(f.setSelectedNote(f.state.selectedNote.shape,f.state.selectedNote.color),f.setSelectedTool("note"))}deselectAllTools(){this.toolButtons.forEach(t=>t.classList.remove("active")),this.toolPanels.forEach(t=>t.classList.remove("active")),this.currentTool=null,Jt.setTool(null,null),f.state.selectedTool==="draw"&&f.setSelectedTool("note")}selectTool(t){var s;this.toolButtons.forEach(r=>r.classList.remove("active")),this.toolPanels.forEach(r=>r.classList.remove("active"));const e=Array.from(this.toolButtons).find(r=>r.dataset.drawTool===t);if(e){e.classList.add("active");const r=e.closest(".draw-tool-panel");r==null||r.classList.add("active")}this.currentTool=t,Jt.setTool(t,this.settings),f.setSelectedTool("draw"),f.state.selectedNote={shape:"circle",color:((s=f.state.selectedNote)==null?void 0:s.color)||"#4a90e2"}}populateAllPanels(){this.populateArrowOptions(),this.populateTextOptions(),this.populateMarkerOptions(),this.populateHighlighterOptions()}initializePanelWidthSync(){const t=Array.from(this.toolPanels);t.length&&t.forEach(e=>{e.style.minWidth="",e.style.width="fit-content",e.style.maxWidth="100%",e.style.flex="0 0 auto"})}logPanelMetrics(){try{const t=document.querySelector(".draw-layout-grid");Array.from(this.toolPanels??[]).forEach(s=>{s.getBoundingClientRect()}),t==null||t.getBoundingClientRect()}catch{}}populateArrowOptions(){const t=this.optionsContainers.arrow;if(!t)return;const e=t.querySelector("#arrow-start-head-trigger"),s=t.querySelector("#arrow-end-head-trigger"),r=(d,p)=>p!=="filled-arrow"?`
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="4" y1="12" x2="20" y2="12"/>
          </svg>
        `:d==="start"?`
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9,5 3,12 9,19"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
          </svg>
        `:`
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,5 21,12 15,19"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
        </svg>
      `,i=(d,p,h)=>{d&&(d.innerHTML=r(p,h))},o=t.querySelector("#arrow-stroke-weight");o&&(o.value=`${this.settings.arrow.strokeWeight}`,o.addEventListener("input",()=>{this.settings.arrow.strokeWeight=parseInt(o.value,10),Jt.setTool("arrow",this.settings)}));const A=t.querySelector("#arrow-head-size");A&&(A.value=`${this.settings.arrow.arrowheadSize}`,A.addEventListener("input",()=>{this.settings.arrow.arrowheadSize=parseInt(A.value,10),Jt.setTool("arrow",this.settings)}));const a=Array.from(t.querySelectorAll("[data-line-style]"));if(a.length){const d=p=>{a.forEach(h=>h.classList.toggle("active",h.dataset.lineStyle===p))};d(this.settings.arrow.lineStyle),a.forEach(p=>{p.addEventListener("click",()=>{const h=p.dataset.lineStyle;h&&(this.settings.arrow.lineStyle=h,d(h),Jt.setTool("arrow",this.settings))})})}const l=Array.from(t.querySelectorAll("[data-arrow-start]"));if(l.length){const d=p=>{l.forEach(h=>h.classList.toggle("active",h.dataset.arrowStart===p)),i(e,"start",p)};d(this.settings.arrow.startArrowhead),l.forEach(p=>{p.addEventListener("click",()=>{const h=p.dataset.arrowStart;h&&(this.settings.arrow.startArrowhead=h,d(h),Jt.setTool("arrow",this.settings))})})}const c=Array.from(t.querySelectorAll("[data-arrow-end]"));if(c.length){const d=p=>{c.forEach(h=>h.classList.toggle("active",h.dataset.arrowEnd===p)),i(s,"end",p)};d(this.settings.arrow.endArrowhead),c.forEach(p=>{p.addEventListener("click",()=>{const h=p.dataset.arrowEnd;h&&(this.settings.arrow.endArrowhead=h,d(h),Jt.setTool("arrow",this.settings))})})}const u=t.querySelector("#arrow-swap-heads");u&&u.addEventListener("click",()=>{const d=this.settings.arrow.startArrowhead;if(this.settings.arrow.startArrowhead=this.settings.arrow.endArrowhead,this.settings.arrow.endArrowhead=d,l.length){const p=this.settings.arrow.startArrowhead;l.forEach(h=>h.classList.toggle("active",h.dataset.arrowStart===p)),i(e,"start",p)}if(c.length){const p=this.settings.arrow.endArrowhead;c.forEach(h=>h.classList.toggle("active",h.dataset.arrowEnd===p)),i(s,"end",p)}Jt.setTool("arrow",this.settings)})}populateTextOptions(){const t=this.optionsContainers.text;if(!t)return;const e=t.querySelector("#text-size-input");e&&(e.value=`${this.settings.text.size}`,e.addEventListener("input",()=>{this.settings.text.size=parseInt(e.value,10),Jt.setTool("text",this.settings)}));const s=Array.from(t.querySelectorAll(".draw-color-button"));if(s.length){const i=o=>{s.forEach(A=>{const a=A.dataset.color||"";A.classList.toggle("active",a.toLowerCase()===o.toLowerCase())})};i(this.settings.text.color),s.forEach(o=>{o.addEventListener("click",()=>{const A=o.dataset.color;A&&(this.settings.text.color=A,i(A),Jt.setTool("text",this.settings))})})}const r=Array.from(t.querySelectorAll("[data-text-style]"));if(r.length){const i=["bold","italic","underline","background","superscript","subscript"],o=A=>{this.settings.text[A]=!this.settings.text[A],Jt.setTool("text",this.settings)};r.forEach(A=>{const a=A.dataset.textStyle;a&&i.includes(a)&&A.classList.toggle("active",!!this.settings.text[a])}),r.forEach(A=>{A.addEventListener("click",()=>{const a=A.dataset.textStyle;!a||!i.includes(a)||(o(a),A.classList.toggle("active",!!this.settings.text[a]))})})}}populateMarkerOptions(){const t=this.optionsContainers.marker;if(!t)return;const e=t.querySelector("#marker-size-input");e&&(e.value=`${this.settings.marker.size}`,e.addEventListener("input",()=>{this.settings.marker.size=parseInt(e.value,10),Jt.setTool("marker",this.settings)}));const s=Array.from(t.querySelectorAll(".draw-color-button"));if(s.length){const r=i=>{s.forEach(o=>{const A=o.dataset.color||"";o.classList.toggle("active",A.toLowerCase()===i.toLowerCase())})};r(this.settings.marker.color),s.forEach(i=>{i.addEventListener("click",()=>{const o=i.dataset.color;o&&(this.settings.marker.color=o,r(o),Jt.setTool("marker",this.settings))})})}}populateHighlighterOptions(){const t=this.optionsContainers.highlighter;if(!t)return;const e=t.querySelector("#highlighter-size-input");e&&(e.value=`${this.settings.highlighter.size}`,e.addEventListener("input",()=>{this.settings.highlighter.size=parseInt(e.value,10),Jt.setTool("highlighter",this.settings)}));const s=Array.from(t.querySelectorAll(".draw-color-button"));if(s.length){const r=i=>{s.forEach(o=>{const A=o.dataset.color||"";o.classList.toggle("active",A.toLowerCase()===i.toLowerCase())})};r(this.settings.highlighter.color),s.forEach(i=>{i.addEventListener("click",()=>{const o=i.dataset.color;o&&(this.settings.highlighter.color=o,r(o),Jt.setTool("highlighter",this.settings))})})}}}const Od=new GR;function KR(){var n;return Jt.initialize(),(n=Od.initialize)==null||n.call(Od),E.initSuccess("DrawSystem"),typeof window<"u"&&(window.annotationService=Jt),{annotationService:Jt}}E.moduleLoaded("KeyboardHandler","keyboard");function qR(){document.addEventListener("keydown",n=>{var i;const t=document.activeElement;if(!t)return;const e=t.tagName.toLowerCase(),s=t.contentEditable==="true";if(["input","textarea"].includes(e)||s)return;if(n.ctrlKey&&n.key.toLowerCase()==="p"){n.preventDefault(),E.info("KeyboardHandler","Ctrl+P pressed. Opening print preview",null,"keyboard"),f.emit("printPreviewStateChanged",!0);return}if(n.ctrlKey&&n.key.toLowerCase()==="z"){n.preventDefault(),f.undo();return}if(n.ctrlKey&&n.key.toLowerCase()==="y"){n.preventDefault(),f.redo();return}let r=!1;switch(n.key){case"Backspace":case"Delete":if((i=f.state.lassoSelection)!=null&&i.isActive){const o=f.state.lassoSelection.selectedItems;o.forEach(A=>{if(A.type==="note"){const a=A.data,l=f.state.placedNotes.findIndex(c=>c.uuid===a.uuid);l!==-1&&f.state.placedNotes.splice(l,1)}else if(A.type==="sixteenthStamp"){const a=A.data,l=f.state.sixteenthStampPlacements.findIndex(c=>c.id===a.id);l!==-1&&f.state.sixteenthStampPlacements.splice(l,1)}else if(A.type==="tripletStamp"){const a=A.data,l=f.state.tripletStampPlacements.findIndex(c=>c.id===a.id);l!==-1&&f.state.tripletStampPlacements.splice(l,1)}}),f.state.lassoSelection={selectedItems:[],convexHull:null,isActive:!1},f.recordState(),f.emit("render"),r=!0,E.info("KeyboardHandler",`Deleted ${o.length} items from lasso selection`,null,"keyboard")}break}r&&n.preventDefault()}),E.info("KeyboardHandler","Initialized",null,"keyboard")}E.moduleLoaded("TransportKeyboardShortcuts","keyboard");function zR(){const n=document.activeElement;if(!(n instanceof HTMLElement))return!0;const t=n.tagName.toLowerCase();return!(["input","textarea","select"].includes(t)||n.isContentEditable)}function $R(){let n=!1;document.addEventListener("keydown",t=>{if(t.code!=="Space"||n||t.repeat||!zR())return;const e=document.getElementById("play-button");e&&(t.preventDefault(),n=!0,e.click())}),document.addEventListener("keyup",t=>{t.code==="Space"&&(n=!1)}),E.info("TransportKeyboardShortcuts","Initialized",null,"keyboard")}const XR=[{label:"Toolbar",selector:"#toolbar"},{label:"Toolbar Primary",selector:"#toolbar-primary"},{label:"Primary Actions Grid",selector:"#toolbar-primary .primary-toolbar-actions"},{label:"Primary Playback Row",selector:"#toolbar-primary .primary-toolbar-playback"},{label:"Toolbar Secondary",selector:"#toolbar-secondary"},{label:"Toolbar Preset Controls",selector:"#toolbar-secondary .preset-effects-controls"},{label:"Toolbar Tab Sidebar",selector:"#toolbar-secondary .tab-sidebar"},{label:"Sidebar",selector:"#sidebar"},{label:"Timbre Tab Panel",selector:"#timbre-panel"},{label:"Pitch Tab Panel",selector:"#pitch-panel"},{label:"Rhythm Tab Panel",selector:"#rhythm-panel"},{label:"Macrobeat Tools",selector:"#canvas-macrobeat-tools, #macrobeat-tools"},{label:"Waveform Card",selector:"#timbre-panel .waveform-content-box"},{label:"Preset Card",selector:"#timbre-panel .preset-content-box"},{label:"Effects Card",selector:"#timbre-panel #effects-panel .effects-content-box"},{label:"Envelope Card",selector:"#adsr-envelope"},{label:"Harmonics Card",selector:".harmonic-bins-container"},{label:"Canvas Container",selector:"#canvas-container"},{label:"Pitch Grid Wrapper",selector:"#pitch-grid-wrapper"},{label:"Pitch Grid Container",selector:"#pitch-grid-container"},{label:"Drum Grid Wrapper",selector:"#drum-grid-wrapper"},{label:"Drum Grid",selector:"#drum-grid"}],ff=new Map;let pf,Vd,Wd=null,hA="",Co=!1;function Ll(n){return Number.isFinite(n)?Number(n.toFixed(1)):n}function YR(n){const t=n.getBoundingClientRect(),e=window.getComputedStyle(n);return{tag:n.tagName.toLowerCase(),id:n.id||null,class:n.className||null,top:Ll(t.top),left:Ll(t.left),width:Ll(t.width),height:Ll(t.height),offsetWidth:n.offsetWidth,offsetHeight:n.offsetHeight,scrollWidth:n.scrollWidth,scrollHeight:n.scrollHeight,clientWidth:n.clientWidth,clientHeight:n.clientHeight,display:e.display,position:e.position,overflowX:e.overflowX,overflowY:e.overflowY,transform:e.transform!=="none"?e.transform:void 0}}function Yb(n="manual"){const t=window.__uiDiagnosticsTrackedElements;if(!t)return[];if(!Co&&n!=="manual")return[];oc();const e=[];return t.forEach(s=>{const r=Array.from(document.querySelectorAll(s.selector));if(!r.length){e.push({label:s.label,selector:s.selector,missing:!0});return}r.forEach((i,o)=>{const A=r.length>1?`${s.label} [${o}]`:s.label,a=YR(i);e.push({label:A,selector:s.selector,info:a})})}),window.__uiDiagnosticsLastSnapshot=e,e}function Ao(n){Co&&(hA=hA?`${hA}; ${n}`:n,Wd===null&&(Wd=requestAnimationFrame(()=>{const t=hA||"auto";Wd=null,hA="",Yb(t)})))}function oc(){const n=window.__uiDiagnosticsTrackedElements;!n||!pf||n.forEach(t=>{document.querySelectorAll(t.selector).forEach(s=>{ff.has(s)||(ff.set(s,t.label),pf.observe(s),s.addEventListener("scroll",()=>Ao(`${t.label} scroll`),{passive:!0}))})})}function jR(n={}){if(window.__uiDiagnosticsInitialized)return;window.__uiDiagnosticsInitialized=!0;const{elements:t,autoLog:e=!1}=n;Co=!!e,window.__uiDiagnosticsAutoLog=Co;const s=t||XR;window.__uiDiagnosticsTrackedElements=s,pf=new ResizeObserver(r=>{const i=r.map(o=>ff.get(o.target)||o.target.id||o.target.tagName.toLowerCase()).filter(Boolean);i.length&&Ao(`Resize: ${i.join(", ")}`)}),Vd=new MutationObserver(()=>oc()),document.body?Vd.observe(document.body,{childList:!0,subtree:!0}):document.addEventListener("DOMContentLoaded",()=>{Vd.observe(document.body,{childList:!0,subtree:!0}),oc(),Ao("init")},{once:!0}),window.addEventListener("resize",()=>Ao("window resize")),oc(),Ao("init"),window.logUIState=(r="manual")=>Yb(r),window.enableUIDiagnosticsAutoLog=()=>{Co=!0,window.__uiDiagnosticsAutoLog=!0,Ao("auto-log enabled")},window.disableUIDiagnosticsAutoLog=()=>{Co=!1,window.__uiDiagnosticsAutoLog=!1}}function JR(){E.section("SETTING UP INPUT HANDLERS"),qR(),$R(),dR(),window.enableUIDiagnostics&&jR()}const ZR=()=>{if(typeof window>"u")return!1;const n=window.__initDebug;return n===!0},gs=(n,t)=>{if(ZR()){if(t===void 0){console.log(`[Init] ${n}`);return}console.log(`[Init] ${n}`,t)}};let mf=!1,li=[],Gd=!1,no=null,Kd=!1;function tH(){Gd=!1,no=null,Kd=!1,window.initAudio=async()=>{if(!Gd)return no||(no=(async()=>{try{ta.state!=="running"&&(await gc(),E.info("Main.js","AudioContext started successfully")),Gd=!0}catch(e){throw E.error("Main.js","Could not start AudioContext",e),no=null,e}})(),no)};const n=()=>{var e;Kd||(Kd=!0,(e=window.initAudio)==null||e.call(window).catch(s=>E.warn("Main.js","Failed to initialize audio after user interaction",s,"initialization")),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",n,!0),document.removeEventListener("touchstart",n,!0))},t=()=>{typeof Wt.teardown=="function"&&Wt.teardown()};document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),document.addEventListener("touchstart",n,!0),window.addEventListener("beforeunload",t),li.push(()=>document.removeEventListener("click",n,!0)),li.push(()=>document.removeEventListener("keydown",n,!0)),li.push(()=>document.removeEventListener("touchstart",n,!0)),li.push(()=>window.removeEventListener("beforeunload",t)),li.push(()=>{delete window.initAudio})}const Yo={domCache:!1,layoutService:!1,canvasContextService:!1,synthEngine:!1,transportService:!1,scrollSync:!1,uiComponents:!1,audioComponents:!1,rhythmPlaybackService:!1,initialized:!1},eH={top:"G5",bottom:"C4"};function nH(n){if(!(n!=null&&n.top)||!(n!=null&&n.bottom))return null;const t=Wn.findIndex(s=>s.toneNote===n.top),e=Wn.findIndex(s=>s.toneNote===n.bottom);return t===-1||e===-1?(E.warn("Main.js","Failed to resolve preset range from tone notes",n),null):{topIndex:Math.min(t,e),bottomIndex:Math.max(t,e)}}function sH(){return nH(eH)}function Ks(n){Yo[n]=!0}function av(n,t=5e3){return new Promise((e,s)=>{if(Yo[n]){e();return}const r=Date.now(),i=()=>{Yo[n]?e():Date.now()-r>t?s(new Error(`Component ${n} not ready within ${t}ms`)):setTimeout(i,50)};i()})}function jb(){Object.keys(Yo).forEach(n=>{Yo[n]=!1})}async function rH(){var t,e;window.initStartTime=Date.now(),E.info("Main.js","Initialization triggered"),E.section("STARTING INITIALIZATION");const n=["dom-cache","drum-samples","state-setup","canvas-services","layout-ready","synth-engine","rhythm-playback","transport-service","input-handlers","store-hooks","ui-components","audio-components","state-subscriptions","initial-render","finalize"];try{wt.init(),n.forEach(c=>wt.registerTask(c)),gs("startup rhythm defaults",{macrobeatGroupings:f.state.macrobeatGroupings,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles});const s=((t=f.state.selectedNote)==null?void 0:t.color)??"#4a90e2",r=(e=f.state.timbres)==null?void 0:e[s];gs("startup adsr defaults",{color:s,adsr:(r==null?void 0:r.adsr)??null,preset:(r==null?void 0:r.activePresetName)??null}),await wt.nextFrame(),lD(),wF({latencyHint:"playback",lookAhead:.1}),E.info("Main.js","AudioContext configured with latencyHint: playback"),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&PC(),wt.updateStatus("Initializing interface..."),ur.init(),Ks("domCache"),wt.completeTask("dom-cache"),await wt.nextFrame(),wt.updateStatus("Loading audio samples..."),await CD(),wt.completeTask("drum-samples"),E.info("Main.js","Drum samples preloaded"),await wt.nextFrame(),(()=>{const c=ur.get("appContainer")||document.getElementById("app-container");if(c){const u=["click","keydown","touchstart"],d=()=>{var p;(p=window.initAudio)==null||p.call(window)};u.forEach(p=>{c.addEventListener(p,d,{once:!0})})}})(),wt.updateStatus("Preparing core systems..."),pD(f.state);const o=f.state.pitchRange||{topIndex:0,bottomIndex:Wn.length-1},A=Math.max(0,Math.min(Wn.length-1,o.topIndex??0)),a=Math.max(A,Math.min(Wn.length-1,o.bottomIndex??Wn.length-1));f.state.pitchRange={topIndex:A,bottomIndex:a},f.state.fullRowData=[...Wn],wt.completeTask("state-setup"),await wt.nextFrame(),wt.updateStatus("Sizing canvas..."),WR(),Ks("layoutService"),Ks("canvasContextService"),wt.completeTask("canvas-services"),await wt.nextFrame(),wt.updateStatus("Calculating layout..."),await fe.waitForInitialLayout(),wt.completeTask("layout-ready"),await wt.nextFrame(),wt.updateStatus("Initializing synth engine..."),Wt.init(),Ks("synthEngine"),wt.completeTask("synth-engine"),await wt.nextFrame(),wt.updateStatus("Preparing rhythm playback..."),re.initialize().catch(c=>{E.warn("Main.js","RhythmPlaybackService initialization deferred (needs user interaction)",c,"initialization")}),Ks("rhythmPlaybackService"),wt.completeTask("rhythm-playback"),await wt.nextFrame(),wt.updateStatus("Configuring transport..."),Zs.init(),Ks("transportService"),wt.completeTask("transport-service"),await wt.nextFrame(),wt.updateStatus("Registering input handlers..."),JR(),wt.completeTask("input-handlers"),await wt.nextFrame(),wt.updateStatus("Syncing state services..."),s_(f),d_(f),yF({getColumnMap:c=>Ne.getColumnMap(c),visualToTimeIndex:(c,u)=>Ne.getColumnMap(c).visualToTime.get(u)??null,timeIndexToVisualColumn:(c,u)=>Ne.getColumnMap(c).timeToVisual.get(u)??null,getTimeBoundaryAfterMacrobeat:(c,u)=>{const p=Ne.getColumnMap(c).macrobeatBoundaries.find(h=>h.macrobeatIndex===u);return p?p.timeColumn+1:0}}),wt.completeTask("store-hooks"),await wt.nextFrame(),wt.updateStatus("Loading interface components..."),gs("Loading interface components..."),gs("initUiComponents:start"),Rk(),gs("initUiComponents:done"),Ks("uiComponents"),gs("uiComponents marked ready"),wt.completeTask("ui-components"),gs("ui-components task complete"),await wt.nextFrame(),gs("ui-components nextFrame resolved"),gs("waitForComponent:uiComponents"),await av("uiComponents"),gs("waitForComponent:uiComponents resolved"),wt.updateStatus("Preparing audio components..."),nR(),Ks("audioComponents"),wt.completeTask("audio-components"),await wt.nextFrame(),mD(f.state,"audio-components-initialization"),iR(),KR(),await av("audioComponents"),E.section("SETTING UP STATE SUBSCRIPTIONS"),wt.updateStatus("Binding state subscriptions...");const l=()=>{try{Vo.render();const c=window.DrumGridController;c!=null&&c.render&&c.render(),E.debug("Main","renderAll invoked",null,"grid")}catch(c){E.error("Main","renderAll failed",c,"grid")}};if(wt.completeTask("state-subscriptions"),await wt.nextFrame(),E.section("PERFORMING INITIAL RENDER"),f.setSelectedTool("note"),f.setSelectedNote("circle","#4a90e2"),wt.updateStatus("Rendering workspace..."),l(),Vo.renderMacrobeatTools(),wt.completeTask("initial-render"),Yl.prefetchButtonGridSnapshot(),await wt.nextFrame(),Ks("initialized"),E.section("INITIALIZATION COMPLETE"),wt.updateStatus("Finalizing..."),wt.completeTask("finalize"),await wt.nextFrame(),f.isColdStart){const c=sH();c?qe.setPitchViewportRange(c,{animateMs:0,source:"coldStart:treble"}):E.warn("Main.js","Treble Clef preset range could not be resolved during cold start")}await wt.complete(),window.ModulationTest=LC}catch(s){E.error("Main.js","Initialization failed",s,"initialization"),E.error("Main.js","Component readiness snapshot at failure",{...Yo},"initialization");const r=s instanceof Error?s:new Error(String(s));wt.showError(r);const i=document.createElement("div");i.style.cssText=`
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #ff4444; color: white; padding: 20px; border-radius: 8px;
            z-index: 10000; font-family: monospace; max-width: 80vw;
        `,i.innerHTML=`
            <h3>Initialization Error</h3>
            <p>The application failed to initialize properly.</p>
            <details>
                <summary>Technical Details</summary>
                <pre>${r.message}</pre>
                <pre>Stack: ${r.stack}</pre>
            </details>
            <button onclick="location.reload()">Reload Page</button>
        `,document.body.appendChild(i)}}function iH(){mf||(mf=!0,jb(),tH(),ur.refresh(),rH())}function oH(){li.forEach(t=>t()),li=[];try{Lk()}catch(t){E.warn("Main.js","Failed to unmount Svelte components",t,"cleanup")}typeof Wt.teardown=="function"&&Wt.teardown(),typeof re.dispose=="function"&&re.dispose();const n=["is-mobile","is-touch","orientation-portrait","orientation-landscape"];[document.documentElement,document.body].forEach(t=>{n.forEach(e=>t==null?void 0:t.classList.remove(e))}),jb(),mf=!1}const AH=Object.assign({"../public/apple-touch-icon.png":n2,"../public/assets/icons/clear.svg":s2,"../public/assets/icons/diamond-note.svg":r2,"../public/assets/icons/eraser.svg":i2,"../public/assets/icons/lasso-tool.svg":o2,"../public/assets/icons/loop.svg":A2,"../public/assets/icons/marker-tool.svg":a2,"../public/assets/icons/pause.svg":l2,"../public/assets/icons/play.svg":c2,"../public/assets/icons/redo.svg":u2,"../public/assets/icons/settings.svg":d2,"../public/assets/icons/stop.svg":h2,"../public/assets/icons/undo.svg":f2,"../public/assets/icons/volume.svg":p2,"../public/assets/icons/zoomIn.svg":m2,"../public/assets/icons/zoomOut.svg":g2,"../public/assets/sidebar/hideAnalysis.svg":v2,"../public/assets/sidebar/hideDrums.svg":w2,"../public/assets/sidebar/newPage.svg":B2,"../public/assets/sidebar/open.svg":C2,"../public/assets/sidebar/print.svg":b2,"../public/assets/sidebar/saveAs.svg":y2,"../public/assets/tabicons/dottedQuarterNote.svg":S2,"../public/assets/tabicons/eigthNote.svg":E2,"../public/assets/tabicons/phaseButton_0.svg":x2,"../public/assets/tabicons/phaseButton_180.svg":I2,"../public/assets/tabicons/phaseButton_270.svg":F2,"../public/assets/tabicons/phaseButton_90.svg":T2,"../public/assets/tabicons/quarterNote.svg":_2,"../public/assets/tabicons/tonicShape_1.svg":M2,"../public/assets/tabicons/tonicShape_2.svg":Q2,"../public/assets/tabicons/tonicShape_3.svg":U2,"../public/assets/tabicons/tonicShape_4.svg":P2,"../public/assets/tabicons/tonicShape_5.svg":N2,"../public/assets/tabicons/tonicShape_6.svg":D2,"../public/assets/tabicons/tonicShape_7.svg":L2,"../public/favicon-96x96.png":k2,"../public/favicon.ico":R2,"../public/favicon.svg":H2,"../public/fonts/atkinsonHyperlegibleNextBold.otf":O2,"../public/fonts/atkinsonHyperlegibleNextRegular.otf":V2,"../public/fonts/atkinsonHyperlegibleNextRegularItalic.otf":W2,"../public/site.webmanifest":G2,"../public/web-app-manifest-192x192.png":K2,"../public/web-app-manifest-512x512.png":q2}),aH="../public/",lH=()=>{if(typeof window>"u")return!1;const n=window.__initDebug;return n===!0},kl=(n,t)=>{if(lH()){if(t===void 0){console.log(n);return}console.log(n,t)}};function cH(n){const t=n.replace(/^\/+/,""),e=`${aH}${t}`;return AH[e]??n}function uH(n){n.querySelectorAll("[src], [href]").forEach(e=>{const s=e.hasAttribute("src")?"src":"href",r=e.getAttribute(s);!r||r.startsWith("http")||r.startsWith("data:")||r.startsWith("#")||!r.startsWith("assets/")&&!r.startsWith("fonts/")&&!r.startsWith("favicon")||e.setAttribute(s,cH(r))})}function dH(n){return kl("[StudentNotation] mount:start",{hasTemplate:!!zu,templateLength:zu.length,containerId:n.id||null}),n.innerHTML=zu,kl("[StudentNotation] template injected"),uH(n),kl("[StudentNotation] assets rewritten"),iH(),kl("[StudentNotation] initStudentNotation:called"),{destroy:()=>{oH(),n.innerHTML=""}}}const lv=document.getElementById("app");lv&&dH(lv);
//# sourceMappingURL=index-DJd7F_mx.js.map
