var Ab=Object.defineProperty;var sm=n=>{throw TypeError(n)};var ab=(n,t,e)=>t in n?Ab(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var M=(n,t,e)=>ab(n,typeof t!="symbol"?t+"":t,e),$u=(n,t,e)=>t.has(n)||sm("Cannot "+e);var j=(n,t,e)=>($u(n,t,"read from private field"),e?e.call(n):t.get(n)),Pt=(n,t,e)=>t.has(n)?sm("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),It=(n,t,e,s)=>($u(n,t,"write to private field"),s?s.call(n,e):t.set(n,e),e),le=(n,t,e)=>($u(n,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const lb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAAAXNSR0IArs4c6QAACC9JREFUeF7tnU9rXFUcQH93Jgm0iVXQrQtFIaAJdSvu9QNY/PMt/Br6BRR1objShXRjSlxLK1QRBXEnqYKplNTWRsR05sqb9KWvw5vJmzb32HFONk0mM+/enHc4eZle7kvb79/M4UdRAsNI8eyfP8cw9YqO48EjkkKX10ChyzOuR1BogLVCA5DvDKHQAGuFBiArNAdZoTnWFhpgrdAAZAvNQVZojrWFBlgrNADZQnOQFZpjbaEB1goNQLbQHGSF5lhbaIC1QgOQLTQHWaE51hYaYK3QAGQLzUEeRIqnb+242g5AbqEByL2c46e1U9EfjZUiolqxW/3b9tH83vjzpr2ueaxpr5tl7Hq+1b+zvK75s7FzVmhI6O8ePXNHaGDABR5CoYGTXxVaoQHQ1e89F/iXB63Q5RnXIyg0wFqhAci+y8FBVmiOtYUGWCs0ANlCc5AVmmNtoQHWCg1AttAcZIXmWFtogLVCA5AtNAdZoTnWFhpgrdAAZAvNQVZojnX64oObuV4bNR/rqQ7hzNOcK6F/OOPiJELr9Nb5/dHuoylHHJndGHn88ebX9eeTntPl8Unjjv/wbWPNy5yHOcdTf6+28iVO8iKNkV6/8Jfb6RY+44PI8dIfp2M4aQl04fEX6fAKDZxthQYg138UWujysBW6PON6BAsNsFZoALKF5iArNMfaQgOsFRqAbKE5yArNsbbQAGuFBiBbaA6yQnOsLTTAWqEByBaag6zQHGsLDbBWaACyheYgKzTH2kIDrCuhX7xxKgaNxUnTVhlW32v7aFsNOWn6sx6jy6rHeZizQgNCL+UUF9auxHK+e/P649aet01rlsV6k5ZQdtnzdBKSeZizQgNC93OKrbWdWIq7QgPDLuQQCg2cdoUGIPtHIQdZoTnWFhpgrdAAZAvNQVZojrWFBlgrNADZQnOQFZpjbaEB1goNQLbQHGSF5lhbaIC1QgOQLTQHWaE51hYaYK3QAGQLzUFWaI51enX7+mhh1v3ckbl+zaQ7S3d5vOvdrNvGmpc5V0J/eXrXxUmA1+mFi1tu1lgc9CB+PViPlIbFR1r0AdLGpfMKXdiCFIP47Z9NhS7MuTq8QhOQFRqgfDiEQgOoLTQAuX6Xw0uO8rAVujzjegQLDbBWaACyhQYhew2NwbbQAGoLDUC20CBkC43BttAAagsNQLbQIGQLjcG20ABqCw1AttAgZAuNwbbQAGoLDUC20CDkUaE3oudqu+LQLXRxxBGDSLF+cC1ySpGj3v+zuchx2mNtE6xf29xLtO2x8dceN2b1/OqYzZXm458f/SfznU/ajvnfzVmhAaFvRy9eObgcg9QHRlvsIRQaOP8KDUD2GpqDrNAcawsNsFZoALKF5iArNMfaQgOsFRqAbKE5yArNsbbQAGuFBiBbaA6yQnOsLTTAWqEByBaag6zQHGsLDbBWaACyheYgKzTHOp299Pk9e9vNw/2cx/E87HM+iF68fPBt3HZxUnGz00fbb9wjdL14sG3kaTc+7zrTWY8xbT71mA/7nPt5EBdXN6Mf7j7a1ZP7fV76ZPs1dx+9X3odX9fLg/hq9axCd+T1IE9T6Aeh1/G1Ct0R1Ak8TaFPAOJxh1Do4wid3PcV+uRYTjySQgOQ67ftvIYuD1uhyzM+eoNAocvDVujyjBWaYxwKzcH2GhpgrdAAZK+hOcgKzbG20ABrhQYgW2gOskJzrC00wFqhAcgWmoOs0BxrCw2wrlbbfX16w8VJAGuFBiAPUopnblyPYaoXzx634LW5k+j47p5dFkeOH7/59SxjV3AmzaUJbtrxuywAro51MnNWaEjozb3dGKYeMNpiD6HQwPmvCq3QAOiq867lKA9aocszdi0HxzgUmoNtoQHWCg1A9n1oDrJCc6wtNMBaoQHIFpqDrNAcawsNsFZoALKF5iArNMfaQgOsFRqAbKE5yArNsbbQAGuFBiDXhf50y73tSuMepIj1G1ddnFQadLWWY+fDc/noXuXjKxOPu8/6+Fais9xTfdI90asfum3F4aR7qs/BnFNOcfWx36OXXW1X2um0+965LgtsS8/jf338NExx5QmFJk6yQgOUFRqAXF9DW+jysBW6PON6BAsNsFZoALKFBiF7DY3BttAAagsNQLbQIGQLjcG20ABqCw1AttAgZAuNwbbQAGoLDUC20CBkC43BttAAagsNQLbQIGQLjcG20ADqqtC/PH4tennSnc6BSSzIEAoNnOgcw1jbfy4iefP60rgVujTh0Ya0w3jk1vMKDbBWaACyQgOQ/aOQg6zQHGsLDbBWaACyheYgKzTH2kIDrBUagGyhOcgKzbG20ABrhQYgW2gOskJzrC00wFqhAcgWmoOs0BxrCw2wVmgAsoXmICs0xzrtvvtmPryf87QdEpsTau7gWGK3xrYdIqvxZ9mtcdoOjvycR0Lvr7s4CfA67b3zsZs1Fgfdi5X+jxHRLz7Sog+Qrr/9mUIXtiDnXqwsf6PQhTmPfo8rdHnKCl2ecT2CQgOsFRqAXL/LYaHLw1bo8owtNMc4FJqD7SUHwFqhAchecnCQFZpjbaEB1goNQLbQHGSF5lhbaIC1QgOQLTQHWaE51hYaYK3QAGQLzUFWaI61hQZYV0IvLX/v4iSAtUITkPMw9laejBTuPloat0KXJlwtacyDuLqyGT2FLk5boYsjVmgA8dEQCg3QttAAZN/lACF7yYHBttAAagsNQLbQIGQLjcG20ABqCw1AttAgZAuNwbbQAGoLDUC20CBkC43BttAAagsNQLbQIGQLjcG20ABqCw1AttAgZAuNwf4X8h6Lm5rywjsAAAAASUVORK5CYII=",cb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20372%20372'%20fill='none'%20aria-hidden='true'%3e%3cpath%20fill='currentColor'%20fill-rule='evenodd'%20d='M%20167.00%20326.50%20L%20156.00%20324.50%20L%2045.50%20215.00%20L%2042.50%20210.00%20L%2043.50%20199.00%20L%2049.00%20192.50%20L%20128.00%20151.50%20L%20147.00%20132.50%20L%20151.00%20130.50%20L%20163.00%20129.50%20L%20169.00%20131.50%20L%20189.00%20149.50%20L%20291.00%2046.50%20L%20298.00%2043.50%20L%20307.00%2043.50%20L%20312.00%2045.50%20L%20321.50%2054.00%20L%20326.50%2063.00%20L%20327.50%2070.00%20L%20323.50%2081.00%20L%20221.50%20184.00%20L%20238.50%20202.00%20L%20240.50%20207.00%20L%20239.50%20219.00%20L%20222.50%20236.00%20L%20179.50%20316.00%20L%20172.00%20324.50%20L%20167.00%20326.50%20Z%20M%20210.50%20172.00%20L%20309.50%2073.00%20L%20310.50%2068.00%20L%20304.00%2060.50%20L%20300.00%2060.50%20L%20198.50%20161.00%20L%20209.00%20172.50%20L%20210.50%20172.00%20Z%20M%20215.50%20221.00%20L%20224.50%20212.00%20L%20224.50%20209.00%20L%20160.00%20145.50%20L%20158.00%20145.50%20L%20148.50%20155.00%20L%20148.50%20157.00%20L%20212.00%20219.50%20L%20215.50%20221.00%20Z%20M%20164.50%20308.00%20L%20204.50%20235.00%20L%20137.00%20167.50%20L%20134.00%20165.50%20L%2059.50%20206.00%20L%2088.00%20234.50%20L%20116.00%20215.50%20L%20120.00%20213.50%20L%20127.00%20214.50%20L%20129.50%20218.00%20L%20129.50%20224.00%20L%20100.50%20247.00%20L%20124.00%20270.50%20L%20145.00%20248.50%20L%20153.00%20248.50%20L%20157.50%20254.00%20L%20156.50%20259.00%20L%20136.50%20281.00%20L%20136.50%20283.00%20L%20162.00%20308.50%20L%20164.50%20308.00%20Z%20M%20252.00%20295.50%20L%20245.00%20295.50%20L%20238.50%20289.00%20L%20239.50%20280.00%20L%20248.00%20274.50%20L%20253.00%20275.50%20L%20258.50%20281.00%20L%20259.50%20285.00%20L%20257.50%20291.00%20L%20252.00%20295.50%20Z%20M%20218.00%20326.50%20L%20211.00%20325.50%20L%20205.50%20318.00%20L%20206.50%20312.00%20L%20212.00%20306.50%20L%20220.00%20306.50%20L%20225.50%20312.00%20L%20225.50%20321.00%20L%20218.00%20326.50%20Z'/%3e%3c/svg%3e",ub="data:image/svg+xml,%3csvg%20class='diamond-icon'%20viewBox='0%200%20120%20120'%20aria-hidden='true'%20focusable='false'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M60%205%20L35%2048.3%20L35%2071.7%20L60%20115%20L85%2071.7%20L85%2048.3%20Z'%20/%3e%3c/svg%3e",db="/music-learning-tools/student-notation/assets/eraser-vjnwKGf-.svg",hb="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-dasharray='3%202'%20xmlns='http://www.w3.org/2000/svg'%3e%3cellipse%20cx='12'%20cy='12'%20rx='8'%20ry='6'%20transform='rotate(-15%2012%2012)'/%3e%3c/svg%3e",fb="/music-learning-tools/student-notation/assets/loop-DCKCNdJ9.svg",pb="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M18%202L6%2014l-2%206%206-2L22%206l-4-4z'/%3e%3cline%20x1='14'%20y1='6'%20x2='18'%20y2='10'/%3e%3c/svg%3e",fv="/music-learning-tools/student-notation/assets/pause-BvM7-xog.svg",pv="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%20fill='none'%20aria-hidden='true'%3e%3cpath%20fill='currentColor'%20d='M%20152%20104%20L%20144%20106%20L%20143%20108%20L%20141%20108%20L%20133%20114%20L%20130%20120%20L%20128%20130%20L%20128%20382%20L%20132%20396%20L%20140%20404%20L%20147%20406%20L%20149%20408%20L%20164%20408%20L%20165%20406%20L%20168%20406%20L%20178%20401%20L%20180%20398%20L%20184%20397%20L%20207%20381%20L%20224%20372%20L%20229%20367%20L%20240%20362%20L%20242%20359%20L%20249%20356%20L%20254%20351%20L%20267%20345%20L%20269%20342%20L%20286%20333%20L%20293%20327%20L%20304%20322%20L%20306%20319%20L%20316%20314%20L%20322%20309%20L%20326%20308%20L%20331%20303%20L%20335%20302%20L%20344%20295%20L%20354%20290%20L%20356%20287%20L%20367%20282%20L%20378%20271%20L%20381%20265%20L%20382%20250%20L%20377%20239%20L%20367%20230%20L%20363%20229%20L%20343%20215%20L%20325%20205%20L%20318%20199%20L%20309%20195%20L%20308%20193%20L%20301%20190%20L%20287%20180%20L%20283%20179%20L%20281%20176%20L%20274%20173%20L%20268%20168%20L%20259%20164%20L%20257%20161%20L%20246%20156%20L%20244%20153%20L%20237%20150%20L%20232%20145%20L%20221%20140%20L%20217%20136%20L%20210%20133%20L%20201%20126%20L%20197%20125%20L%20195%20122%20L%20183%20116%20L%20177%20111%20L%20164%20105%20Z'/%3e%3c/svg%3e",mb="/music-learning-tools/student-notation/assets/redo-C3TqBHBd.svg",gb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20aria-hidden='true'%3e%3ccircle%20cx='12'%20cy='12'%20r='3'/%3e%3cpath%20d='M19.4%2015a1.65%201.65%200%200%200%20.33%201.82l.06.06a2%202%200%200%201%200%202.83%202%202%200%200%201-2.83%200l-.06-.06a1.65%201.65%200%200%200-1.82-.33%201.65%201.65%200%200%200-1%201.51V21a2%202%200%200%201-2%202%202%202%200%200%201-2-2v-.09a1.65%201.65%200%200%200-1-1.51%201.65%201.65%200%200%200-1.82.33l-.06.06a2%202%200%200%201-2.83%200%202%202%200%200%201%200-2.83l.06-.06A1.65%201.65%200%200%200%204.6%2015a1.65%201.65%200%200%200-1.51-1H3a2%202%200%200%201-2-2%202%202%200%200%201%202-2h.09A1.65%201.65%200%200%200%204.6%209a1.65%201.65%200%200%200-.33-1.82l-.06-.06a2%202%200%200%201%200-2.83%202%202%200%200%201%202.83%200l.06.06A1.65%201.65%200%200%200%209%204.6a1.65%201.65%200%200%200%201-1.51V3a2%202%200%200%201%202-2%202%202%200%200%201%202%202v.09A1.65%201.65%200%200%200%2015%204.6a1.65%201.65%200%200%200%201.82-.33l.06-.06a2%202%200%200%201%202.83%200%202%202%200%200%201%200%202.83l-.06.06A1.65%201.65%200%200%200%2019.4%209a1.65%201.65%200%200%200%201.51%201H21a2%202%200%200%201%202%202%202%202%200%200%201-2%202h-.09A1.65%201.65%200%200%200%2019.4%2015z'/%3e%3c/svg%3e",vb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3c!--%20Rounded%20stop%20square%20--%3e%3crect%20x='5'%20y='5'%20width='14'%20height='14'%20rx='3'%20ry='3'%20/%3e%3c/svg%3e",wb="/music-learning-tools/student-notation/assets/undo-D1s0pqx2.svg",Bb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3c!--%20Rounded%20speaker%20--%3e%3cpath%20d='%20M4%209.5%20Q4%209%204.5%209%20H7.3%20L11.4%205.6%20Q12%205.1%2012.5%205.4%20Q13%205.7%2013%206.3%20V17.7%20Q13%2018.3%2012.5%2018.6%20Q12%2018.9%2011.4%2018.4%20L7.3%2015%20H4.5%20Q4%2015%204%2014.5%20Z%20'/%3e%3c!--%20Inner%20rounded%20wave%20--%3e%3cpath%20d='%20M15.7%209.7%20Q17.5%2012%2015.7%2014.3%20Q15.3%2014.8%2014.8%2014.4%20Q14.3%2014%2014.8%2013.4%20Q15.9%2012%2014.8%2010.6%20Q14.3%2010%2014.8%209.6%20Q15.3%209.2%2015.7%209.7%20Z%20'/%3e%3c!--%20Outer%20rounded%20wave%20--%3e%3cpath%20d='%20M18.7%207.5%20Q22%2012%2018.7%2016.5%20Q18.3%2017%2017.8%2016.6%20Q17.3%2016.2%2017.7%2015.6%20Q20.3%2012%2017.7%208.4%20Q17.3%207.8%2017.8%207.4%20Q18.3%207%2018.7%207.5%20Z%20'/%3e%3c/svg%3e",Cb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3c!--%20Magnifying%20glass%20--%3e%3cpath%20d='%20M10.5%204%20C6.9%204%204%206.9%204%2010.5%20C4%2014.1%206.9%2017%2010.5%2017%20C12.0%2017%2013.4%2016.5%2014.5%2015.6%20L18.6%2019.7%20Q19%2020.1%2019.5%2019.7%20Q20%2019.3%2019.6%2018.9%20L15.5%2014.8%20C16.5%2013.7%2017%2012.2%2017%2010.5%20C17%206.9%2014.1%204%2010.5%204%20Z%20M10.5%206%20C13.0%206%2015%208.0%2015%2010.5%20C15%2013.0%2013.0%2015%2010.5%2015%20C8.0%2015%206%2013.0%206%2010.5%20C6%208.0%208.0%206%2010.5%206%20Z%20'/%3e%3c!--%20Plus%20sign%20--%3e%3cpath%20d='%20M10%208.3%20Q10%208%2010.3%208%20H10.7%20Q11%208%2011%208.3%20V10%20H12.7%20Q13%2010%2013%2010.3%20V10.7%20Q13%2011%2012.7%2011%20H11%20V12.7%20Q11%2013%2010.7%2013%20H10.3%20Q10%2013%2010%2012.7%20V11%20H8.3%20Q8%2011%208%2010.7%20V10.3%20Q8%2010%208.3%2010%20H10%20Z%20'/%3e%3c/svg%3e",bb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%3e%3c!--%20Magnifying%20glass%20--%3e%3cpath%20d='%20M10.5%204%20C6.9%204%204%206.9%204%2010.5%20C4%2014.1%206.9%2017%2010.5%2017%20C12.0%2017%2013.4%2016.5%2014.5%2015.6%20L18.6%2019.7%20Q19%2020.1%2019.5%2019.7%20Q20%2019.3%2019.6%2018.9%20L15.5%2014.8%20C16.5%2013.7%2017%2012.2%2017%2010.5%20C17%206.9%2014.1%204%2010.5%204%20Z%20M10.5%206%20C13.0%206%2015%208.0%2015%2010.5%20C15%2013.0%2013.0%2015%2010.5%2015%20C8.0%2015%206%2013.0%206%2010.5%20C6%208.0%208.0%206%2010.5%206%20Z%20'/%3e%3c!--%20Minus%20sign%20--%3e%3cpath%20d='%20M8.3%2010%20Q8%2010%208%2010.3%20V10.7%20Q8%2011%208.3%2011%20H12.7%20Q13%2011%2013%2010.7%20V10.3%20Q13%2010%2012.7%2010%20H8.3%20Z%20'/%3e%3c/svg%3e",yb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3c!--%20Grid%20pattern%20--%3e%3cline%20x1='3'%20y1='3'%20x2='3'%20y2='21'%20/%3e%3cline%20x1='9'%20y1='3'%20x2='9'%20y2='21'%20/%3e%3cline%20x1='15'%20y1='3'%20x2='15'%20y2='21'%20/%3e%3cline%20x1='21'%20y1='3'%20x2='21'%20y2='21'%20/%3e%3cline%20x1='3'%20y1='6'%20x2='21'%20y2='6'%20/%3e%3cline%20x1='3'%20y1='12'%20x2='21'%20y2='12'%20/%3e%3cline%20x1='3'%20y1='18'%20x2='21'%20y2='18'%20/%3e%3c!--%20Eye%20with%20slash%20(hide)%20--%3e%3cpath%20d='M1%201%20L23%2023'%20stroke-width='2.5'/%3e%3c/svg%3e",Sb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3c!--%20Drum%20pattern%20--%3e%3cellipse%20cx='12'%20cy='7'%20rx='7'%20ry='3'/%3e%3cpath%20d='M%205%207%20L%205%2017%20Q%205%2020%2012%2020%20Q%2019%2020%2019%2017%20L%2019%207'/%3e%3cline%20x1='8'%20y1='10'%20x2='8'%20y2='16'/%3e%3cline%20x1='16'%20y1='10'%20x2='16'%20y2='16'/%3e%3c!--%20Slash%20(hide)%20--%3e%3cpath%20d='M2%202%20L22%2022'%20stroke-width='2.5'/%3e%3c/svg%3e",Eb="/music-learning-tools/student-notation/assets/newPage-C3DkqRnq.svg",xb="/music-learning-tools/student-notation/assets/open-yWU2irvQ.svg",Ib="/music-learning-tools/student-notation/assets/print-y0OmDKSR.svg",Fb="/music-learning-tools/student-notation/assets/saveAs-DyEXJ3e_.svg",Tb="/music-learning-tools/student-notation/assets/dottedQuarterNote-Cf79kpGq.svg",_b="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='168'%20zoomAndPan='magnify'%20viewBox='0%200%20126%20231.75'%20height='309'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='f11b48ab54'%3e%3cpath%20d='M%200.0664062%200%20L%20125%200%20L%20125%20230.75%20L%200.0664062%20230.75%20Z%20M%200.0664062%200%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='9738701237'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23f11b48ab54)'%3e%3cpath%20style='%20stroke:none;fill-rule:nonzero;fill:%23000000;fill-opacity:1;'%20d='M%208.109375%20225.367188%20C%20-6.25%20212.289062%201.699219%20191.523438%2025.289062%20179.214844%20C%2033.234375%20175.371094%2039.132812%20173.574219%2049.386719%20173.832031%20C%2055.796875%20174.089844%2062.976562%20177.679688%2062.976562%20177.679688%20C%2062.976562%20131.273438%2062.71875%2043.585938%2062.71875%200.511719%20C%2065.285156%200.511719%2067.078125%200.257812%2070.667969%200.257812%20C%2070.667969%202.820312%2070.667969%204.871094%2070.667969%206.921875%20C%2070.667969%209.230469%2070.667969%2010.511719%2070.925781%2012.050781%20C%2073.488281%2028.203125%2077.078125%2034.613281%2095.023438%2054.355469%20C%20117.84375%2079.738281%20124.511719%2094.863281%20124.511719%20115.121094%20C%20124.253906%20134.09375%20107.589844%20174.601562%20104%20173.0625%20C%20109.125%20158.707031%20116.304688%20143.320312%20118.101562%20130.503906%20C%20120.40625%20114.863281%20114%2092.8125%20103.742188%2081.277344%20C%2095.539062%2071.53125%2076.050781%2063.070312%2070.667969%2063.070312%20C%2070.667969%2063.070312%2070.410156%20156.398438%2070.410156%20191.78125%20C%2070.410156%20197.675781%2065.027344%20208.1875%2061.949219%20211.777344%20C%2047.847656%20228.699219%2020.414062%20236.390625%208.109375%20225.367188%20Z%20M%208.109375%20225.367188%20'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Mb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20stroke='currentColor'%20stroke-width='1.5'%20fill='none'/%3e%3cpath%20d='M%2012%2012%20L%2022%2012%20A%2010%2010%200%200%200%2012%202%20Z'%20fill='currentColor'/%3e%3c/svg%3e",Qb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20stroke='currentColor'%20stroke-width='1.5'%20fill='none'/%3e%3cpath%20d='M%2012%2012%20L%2022%2012%20A%2010%2010%200%200%200%2012%202%20Z'%20fill='currentColor'%20transform='rotate(180,%2012,%2012)'/%3e%3c/svg%3e",Ub="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20stroke='currentColor'%20stroke-width='1.5'%20fill='none'/%3e%3cpath%20d='M%2012%2012%20L%2022%2012%20A%2010%2010%200%200%200%2012%202%20Z'%20fill='currentColor'%20transform='rotate(270,%2012,%2012)'/%3e%3c/svg%3e",Pb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20stroke='currentColor'%20stroke-width='1.5'%20fill='none'/%3e%3cpath%20d='M%2012%2012%20L%2022%2012%20A%2010%2010%200%200%200%2012%202%20Z'%20fill='currentColor'%20transform='rotate(90,%2012,%2012)'/%3e%3c/svg%3e",Nb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='111'%20zoomAndPan='magnify'%20viewBox='0%200%2083.25%20230.999992'%20height='308'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='084e4edff4'%3e%3cpath%20d='M%201%20165%20L%2081.761719%20165%20L%2081.761719%20229.226562%20L%201%20229.226562%20Z%20M%201%20165%20'/%3e%3c/clipPath%3e%3cclipPath%20id='fdeab4882e'%3e%3cpath%20d='M%2073%201.03125%20L%2081.761719%201.03125%20L%2081.761719%20192%20L%2073%20192%20Z%20M%2073%201.03125%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='45713f1632'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23084e4edff4)'%3e%3cpath%20style='%20stroke:none;fill-rule:evenodd;fill:%23000000;fill-opacity:0.9;'%20d='M%2057.546875%20222.390625%20C%2076.429688%20212.289062%2086.492188%20194.003906%2080.304688%20180.25%20C%2073.699219%20165.578125%2051.011719%20161.4375%2029.660156%20171.003906%20C%208.308594%20180.574219%20-3.664062%20200.25%202.9375%20214.921875%20C%209.542969%20229.59375%2032.230469%20233.734375%2053.582031%20224.164062%20C%2054.917969%20223.566406%2056.285156%20223.0625%2057.546875%20222.390625%20Z%20M%2057.546875%20222.390625%20'/%3e%3c/g%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23fdeab4882e)'%3e%3cpath%20style='fill:none;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%20299.504676%20305.984569%20L%20299.504676%20339.572267%20'%20transform='matrix(-5.561147,0,0,-5.549953,1743.335656,1885.43835)'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Lb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='456e80bb30'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='87c9148330'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='d7032f28cc'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23456e80bb30)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%2387c9148330)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(44.895794,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2017.8125%200%20L%2017.8125%20-40.09375%20L%204.203125%20-40.09375%20L%204.203125%20-51.09375%20C%207.367188%20-51.09375%209.992188%20-51.253906%2012.078125%20-51.578125%20C%2014.171875%20-51.910156%2015.914062%20-52.6875%2017.3125%20-53.90625%20C%2018.71875%20-55.132812%2019.957031%20-57.09375%2021.03125%20-59.78125%20L%2031.3125%20-59.78125%20L%2031.3125%200%20Z%20M%2017.8125%200%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Db="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='af2f53afe5'%3e%3cpath%20d='M%2017.898438%2024.566406%20L%20111.859375%2024.566406%20L%20111.859375%20118.527344%20L%2017.898438%20118.527344%20Z%20M%2017.898438%2024.566406%20'/%3e%3c/clipPath%3e%3cclipPath%20id='c8dd529e93'%3e%3cpath%20d='M%2064.878906%2024.566406%20C%2038.933594%2024.566406%2017.898438%2045.601562%2017.898438%2071.546875%20C%2017.898438%2097.496094%2038.933594%20118.527344%2064.878906%20118.527344%20C%2090.828125%20118.527344%20111.859375%2097.496094%20111.859375%2071.546875%20C%20111.859375%2045.601562%2090.828125%2024.566406%2064.878906%2024.566406%20Z%20M%2064.878906%2024.566406%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='4829c2bf70'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23af2f53afe5)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23c8dd529e93)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%200.00130943%20C%2028.250074%200.00130943%200.0009548%2028.250428%200.0009548%2063.093632%20C%200.0009548%2097.942081%2028.250074%20126.185954%2063.093277%20126.185954%20C%2097.941726%20126.185954%20126.185599%2097.942081%20126.185599%2063.093632%20C%20126.185599%2028.250428%2097.941726%200.00130943%2063.093277%200.00130943%20Z%20M%2063.093277%200.00130943%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.565431)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(38.720147,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%203.046875%200%20L%203.046875%20-11.1875%20C%2010.921875%20-16.726562%2017.179688%20-21.421875%2021.828125%20-25.265625%20C%2026.484375%20-29.117188%2029.835938%20-32.507812%2031.890625%20-35.4375%20C%2033.953125%20-38.363281%2034.984375%20-41.109375%2034.984375%20-43.671875%20C%2034.984375%20-45.992188%2034.160156%20-47.75%2032.515625%20-48.9375%20C%2030.878906%20-50.132812%2028.957031%20-50.734375%2026.75%20-50.734375%20C%2024.90625%20-50.734375%2023.085938%20-50.210938%2021.296875%20-49.171875%20C%2019.503906%20-48.128906%2018.28125%20-46.207031%2017.625%20-43.40625%20L%205.28125%20-47.875%20C%206.894531%20-52.050781%209.664062%20-55.253906%2013.59375%20-57.484375%20C%2017.53125%20-59.722656%2022.125%20-60.84375%2027.375%20-60.84375%20C%2031.4375%20-60.84375%2035.078125%20-60.171875%2038.296875%20-58.828125%20C%2041.515625%20-57.492188%2044.046875%20-55.523438%2045.890625%20-52.921875%20C%2047.742188%20-50.328125%2048.671875%20-47.15625%2048.671875%20-43.40625%20C%2048.671875%20-37.375%2046.148438%20-31.773438%2041.109375%20-26.609375%20C%2036.078125%20-21.453125%2029.175781%20-16.3125%2020.40625%20-11.1875%20L%2048.953125%20-11.1875%20L%2048.953125%200%20Z%20M%203.046875%200%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",kb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='0551ece328'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='073daee785'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='04a7d7f831'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%230551ece328)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23073daee785)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(37.869539,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2026.046875%201.078125%20C%2022.703125%201.078125%2019.492188%200.597656%2016.421875%20-0.359375%20C%2013.347656%20-1.316406%2010.644531%20-2.789062%208.3125%20-4.78125%20C%205.988281%20-6.78125%204.203125%20-9.363281%202.953125%20-12.53125%20L%2015.296875%20-17%20C%2016.078125%20-14.082031%2017.507812%20-12.023438%2019.59375%20-10.828125%20C%2021.6875%20-9.628906%2023.953125%20-9.03125%2026.390625%20-9.03125%20C%2029.203125%20-9.03125%2031.441406%20-9.71875%2033.109375%20-11.09375%20C%2034.773438%20-12.46875%2035.609375%20-14.378906%2035.609375%20-16.828125%20C%2035.609375%20-19.265625%2034.832031%20-21.15625%2033.28125%20-22.5%20C%2031.738281%20-23.84375%2029.695312%20-24.769531%2027.15625%20-25.28125%20C%2024.625%20-25.789062%2021.863281%20-26.046875%2018.875%20-26.046875%20L%2018.875%20-35.53125%20C%2024.007812%20-35.53125%2027.960938%20-36.242188%2030.734375%20-37.671875%20C%2033.515625%20-39.109375%2034.90625%20-41.140625%2034.90625%20-43.765625%20C%2034.90625%20-46.085938%2033.960938%20-47.828125%2032.078125%20-48.984375%20C%2030.203125%20-50.148438%2028.039062%20-50.734375%2025.59375%20-50.734375%20C%2023.382812%20-50.734375%2021.351562%20-50.195312%2019.5%20-49.125%20C%2017.65625%20-48.050781%2016.4375%20-46.144531%2015.84375%20-43.40625%20L%203.578125%20-47.875%20C%204.773438%20-50.914062%206.535156%20-53.390625%208.859375%20-55.296875%20C%2011.179688%20-57.210938%2013.863281%20-58.613281%2016.90625%20-59.5%20C%2019.945312%20-60.394531%2023.109375%20-60.84375%2026.390625%20-60.84375%20C%2029.140625%20-60.84375%2031.828125%20-60.546875%2034.453125%20-59.953125%20C%2037.078125%20-59.359375%2039.445312%20-58.421875%2041.5625%20-57.140625%20C%2043.6875%20-55.859375%2045.390625%20-54.242188%2046.671875%20-52.296875%20C%2047.953125%20-50.359375%2048.59375%20-48.050781%2048.59375%20-45.375%20C%2048.59375%20-42.144531%2047.726562%20-39.320312%2046%20-36.90625%20C%2044.269531%20-34.488281%2042.359375%20-32.6875%2040.265625%20-31.5%20C%2042.234375%20-30.78125%2043.914062%20-29.644531%2045.3125%20-28.09375%20C%2046.71875%20-26.539062%2047.78125%20-24.835938%2048.5%20-22.984375%20C%2049.21875%20-21.140625%2049.578125%20-19.296875%2049.578125%20-17.453125%20C%2049.578125%20-13.273438%2048.472656%20-9.828125%2046.265625%20-7.109375%20C%2044.054688%20-4.398438%2041.160156%20-2.359375%2037.578125%20-0.984375%20C%2034.003906%200.390625%2030.160156%201.078125%2026.046875%201.078125%20Z%20M%2026.046875%201.078125%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Rb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='0f524ef70a'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='786a2dceed'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='1bb9b822db'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%230f524ef70a)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23786a2dceed)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(36.937365,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2031.140625%200%20L%2031.140625%20-12.625%20L%202.0625%20-12.625%20L%202.0625%20-22.546875%20L%2031.140625%20-59.78125%20L%2044.75%20-59.78125%20L%2044.75%20-24.609375%20L%2052.96875%20-24.609375%20L%2052.96875%20-12.625%20L%2044.75%20-12.625%20L%2044.75%200%20Z%20M%2016.828125%20-24.609375%20L%2031.140625%20-24.609375%20L%2031.140625%20-41.96875%20Z%20M%2016.828125%20-24.609375%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Hb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='0d82974cc8'%3e%3cpath%20d='M%2017.898438%2024.789062%20L%20111.859375%2024.789062%20L%20111.859375%20118.753906%20L%2017.898438%20118.753906%20Z%20M%2017.898438%2024.789062%20'/%3e%3c/clipPath%3e%3cclipPath%20id='37694f020a'%3e%3cpath%20d='M%2064.878906%2024.789062%20C%2038.933594%2024.789062%2017.898438%2045.824219%2017.898438%2071.769531%20C%2017.898438%2097.71875%2038.933594%20118.753906%2064.878906%20118.753906%20C%2090.828125%20118.753906%20111.859375%2097.71875%20111.859375%2071.769531%20C%20111.859375%2045.824219%2090.828125%2024.789062%2064.878906%2024.789062%20Z%20M%2064.878906%2024.789062%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='22003a5ccc'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%230d82974cc8)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%2337694f020a)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.000119013%20C%2028.250074%20-0.000119013%200.0009548%2028.249%200.0009548%2063.092203%20C%200.0009548%2097.940652%2028.250074%20126.189771%2063.093277%20126.189771%20C%2097.941726%20126.189771%20126.185599%2097.940652%20126.185599%2063.092203%20C%20126.185599%2028.249%2097.941726%20-0.000119013%2063.093277%20-0.000119013%20Z%20M%2063.093277%20-0.000119013%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.789151)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(37.55493,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2026.390625%201.078125%20C%2021.203125%201.078125%2016.59375%20-0.0664062%2012.5625%20-2.359375%20C%208.539062%20-4.660156%205.578125%20-8.019531%203.671875%20-12.4375%20L%2015.484375%20-16.734375%20C%2016.316406%20-13.804688%2017.671875%20-11.789062%2019.546875%20-10.6875%20C%2021.429688%20-9.582031%2023.476562%20-9.03125%2025.6875%20-9.03125%20C%2028.84375%20-9.03125%2031.4375%20-9.957031%2033.46875%20-11.8125%20C%2035.5%20-13.664062%2036.515625%20-16.320312%2036.515625%20-19.78125%20C%2036.515625%20-23.476562%2035.453125%20-26.191406%2033.328125%20-27.921875%20C%2031.210938%20-29.648438%2028.753906%20-30.515625%2025.953125%20-30.515625%20C%2021.535156%20-30.515625%2018.253906%20-28.578125%2016.109375%20-24.703125%20L%204.03125%20-29.171875%20L%207.78125%20-59.78125%20L%2047.78125%20-59.78125%20L%2047.78125%20-48.671875%20L%2019.0625%20-48.671875%20L%2017.71875%20-37.5%20C%2019.09375%20-38.507812%2020.894531%20-39.28125%2023.125%20-39.8125%20C%2025.363281%20-40.351562%2027.53125%20-40.625%2029.625%20-40.625%20C%2033.195312%20-40.625%2036.578125%20-39.847656%2039.765625%20-38.296875%20C%2042.960938%20-36.742188%2045.5625%20-34.429688%2047.5625%20-31.359375%20C%2049.5625%20-28.285156%2050.5625%20-24.425781%2050.5625%20-19.78125%20C%2050.5625%20-15.238281%2049.441406%20-11.414062%2047.203125%20-8.3125%20C%2044.960938%20-5.21875%2042.007812%20-2.878906%2038.34375%20-1.296875%20C%2034.675781%200.285156%2030.691406%201.078125%2026.390625%201.078125%20Z%20M%2026.390625%201.078125%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Ob="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='2a134d5da5'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='1436cb12ac'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='0d388df51e'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%232a134d5da5)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%231436cb12ac)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(36.669365,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%2028.71875%201.078125%20C%2023%201.078125%2018.363281%20-0.113281%2014.8125%20-2.5%20C%2011.257812%20-4.882812%208.660156%20-8.222656%207.015625%20-12.515625%20C%205.378906%20-16.816406%204.5625%20-21.769531%204.5625%20-27.375%20C%204.5625%20-31.675781%205.035156%20-35.820312%205.984375%20-39.8125%20C%206.941406%20-43.8125%208.453125%20-47.390625%2010.515625%20-50.546875%20C%2012.578125%20-53.710938%2015.242188%20-56.21875%2018.515625%20-58.0625%20C%2021.796875%20-59.914062%2025.765625%20-60.84375%2030.421875%20-60.84375%20C%2034.953125%20-60.84375%2038.738281%20-60.050781%2041.78125%20-58.46875%20C%2044.832031%20-56.894531%2047.128906%20-54.796875%2048.671875%20-52.171875%20L%2036.515625%20-47.78125%20C%2035.910156%20-48.800781%2034.984375%20-49.59375%2033.734375%20-50.15625%20C%2032.484375%20-50.71875%2031.082031%20-51%2029.53125%20-51%20C%2026.363281%20-51%2023.78125%20-49.789062%2021.78125%20-47.375%20C%2019.789062%20-44.96875%2018.796875%20-41.195312%2018.796875%20-36.0625%20C%2020.285156%20-37.4375%2022.054688%20-38.507812%2024.109375%20-39.28125%20C%2026.171875%20-40.0625%2028.664062%20-40.453125%2031.59375%20-40.453125%20C%2035.113281%20-40.453125%2038.40625%20-39.628906%2041.46875%20-37.984375%20C%2044.539062%20-36.347656%2047.015625%20-34.019531%2048.890625%20-31%20C%2050.773438%20-27.988281%2051.71875%20-24.425781%2051.71875%20-20.3125%20C%2051.71875%20-16.195312%2050.734375%20-12.523438%2048.765625%20-9.296875%20C%2046.796875%20-6.078125%2044.082031%20-3.539062%2040.625%20-1.6875%20C%2037.164062%200.15625%2033.195312%201.078125%2028.71875%201.078125%20Z%20M%2028.640625%20-9.03125%20C%2031.554688%20-9.03125%2033.847656%20-10%2035.515625%20-11.9375%20C%2037.191406%20-13.882812%2038.03125%20-16.4375%2038.03125%20-19.59375%20C%2038.03125%20-22.757812%2037.191406%20-25.328125%2035.515625%20-27.296875%20C%2033.847656%20-29.265625%2031.523438%20-30.25%2028.546875%20-30.25%20C%2025.679688%20-30.25%2023.367188%20-29.289062%2021.609375%20-27.375%20C%2019.847656%20-25.46875%2018.96875%20-22.90625%2018.96875%20-19.6875%20C%2018.96875%20-16.46875%2019.847656%20-13.882812%2021.609375%20-11.9375%20C%2023.367188%20-10%2025.710938%20-9.03125%2028.640625%20-9.03125%20Z%20M%2028.640625%20-9.03125%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Vb="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='175'%20zoomAndPan='magnify'%20viewBox='0%200%20131.25%20143.999998'%20height='192'%20preserveAspectRatio='xMidYMid%20meet'%20version='1.2'%3e%3cdefs%3e%3cclipPath%20id='d5d49c9923'%3e%3cpath%20d='M%2017.898438%2024.675781%20L%20111.859375%2024.675781%20L%20111.859375%20118.640625%20L%2017.898438%20118.640625%20Z%20M%2017.898438%2024.675781%20'/%3e%3c/clipPath%3e%3cclipPath%20id='0ef729529e'%3e%3cpath%20d='M%2064.878906%2024.675781%20C%2038.933594%2024.675781%2017.898438%2045.710938%2017.898438%2071.660156%20C%2017.898438%2097.605469%2038.933594%20118.640625%2064.878906%20118.640625%20C%2090.828125%20118.640625%20111.859375%2097.605469%20111.859375%2071.660156%20C%20111.859375%2045.710938%2090.828125%2024.675781%2064.878906%2024.675781%20Z%20M%2064.878906%2024.675781%20'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20id='926e811c6f'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%23d5d49c9923)'%3e%3cg%20clip-rule='nonzero'%20clip-path='url(%230ef729529e)'%3e%3cpath%20style='fill:none;stroke-width:8;stroke-linecap:butt;stroke-linejoin:miter;stroke:%23000000;stroke-opacity:1;stroke-miterlimit:4;'%20d='M%2063.093277%20-0.00202662%20C%2028.250074%20-0.00202662%200.0009548%2028.247092%200.0009548%2063.095541%20C%200.0009548%2097.938745%2028.250074%20126.187864%2063.093277%20126.187864%20C%2097.941726%20126.187864%20126.185599%2097.938745%20126.185599%2063.095541%20C%20126.185599%2028.247092%2097.941726%20-0.00202662%2063.093277%20-0.00202662%20Z%20M%2063.093277%20-0.00202662%20'%20transform='matrix(0.744631,0,0,0.744631,17.897727,24.67729)'/%3e%3c/g%3e%3c/g%3e%3cg%20style='fill:%23000000;fill-opacity:1;'%3e%3cg%20transform='translate(40.642754,%20101.083803)'%3e%3cpath%20style='stroke:none'%20d='M%207.421875%200%20L%2031.671875%20-48.59375%20L%201.34375%20-48.59375%20L%201.34375%20-59.78125%20L%2046.078125%20-59.78125%20L%2046.078125%20-48.59375%20L%2023.09375%200%20Z%20M%207.421875%200%20'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Wb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAAXNSR0IArs4c6QAABFNJREFUeF7tnU1rFEEQhqvBrOQbveshCupiUG/iSfwNfgRP/h7Be0RBEG8q6EExAQ+5SMRLFBWPEjeiyWqCaxQSoaXdDNszzi61U907U8u7t52pqp59n+nu6o+ZNYu3flhS+rFkaab1icgo/QFEZACgXHgAUK7+qAEl6w8AACBQAJ2wQLwQrgAQQkVBDJc/H9puEBlGHmotz05wPUVcVWdBRJZWR2tFfndlfHQDsJbeTU9VRswiF6IewNvpKc0DYd1pKFlLAFCk3oXyAYBQShaMAwAFhQvlNgwAHt5JT0e7jDo7P513LE/DxK5XjH5j+eVkfY0l+jg+qbsTvvbkV0fvPAX9Y74azit7zj/GJSSI70bCp1tjutcD5p55AEI1DQOK4wCc3QKAAcn9fzEAUJr07YIBAADEChj0AWINRQEAQCSf3Fk9gNmWNx3NWBbY6zzCp65JCs5h4tmqBuAGYkvja2QUD8VUA3BD9ucTDcXyEwEAp8mIaAMAEcXlhAYAjkoRbQAgoric0ADAUSmijbm4sKV2e7qbDVoaW9edhp55sZABkHz1RzV5SzTt6bD2p9sSjH/r9FrmScrqVk62rM73xp8Z1r6siDexKLSZXX6sugZ83amHH9WKJO3PGQD60yu4NQAEl7S/gADQn17BrQEguKT9BQSA/vQKbq0ewMbOcWRBwW8LZkCXP5/b/VDBBy/4qzOqa4D7mRd2VyoIgHkHuSGs5oEYAPBBR7EEgCiy8oMCAF+rKJYAEEVWftChAHBq+ZE3G9otfeo1TdxNsFg+nWt0e0PP777RnQXdXZzzlOr2+ER2xxNnBjuWT/oaX43VdW9Lubd4haMmv10YpKW19HL8JAAMUvNUWQBQmvTtggEAAKQKGPQBUgll/gAg00/srR7AyugxVhZk/+0eql7CpxqAk/NwqyW+C8sMoB5AfWujTP3EZesHsLmhe0lScxbkmqA6AIhrYeEAAFBYujCOABBGx8JRhgLAg6eXU8mxy5fdtvP05vT0FHB2M3nnbOfdM9mcO4mbbGX3I+ZvTk/n7e2L7BxLLnqm1dTdCa/evlS90Qm3Tlii9emm7gc0vtzUDWDtYHPvAREutWrZGQAoFwgAlKs/AQAACBSwROgDBPqJXQFALKEsgCX6fGCTtR4gKyiet+o+wG3MGv19lMi9OCj1EtNezy+3B3T5zzhnX5zqDxF7vVQ1G9MHlleWN2DVnIY6AJM/T+geCQNAvOaFE1l9E4QawMEcyQZNUCRhuWEBgKtUJLvhADB/Ve90NFma2HZpaCTCAwhrvt2YVwyAaL9p6J6O3rx+Xy0A9+d4tZHXADCAmppbBACUpfxeuQAAAGIFDPoAsYaiAAAgkk/urB7AvpH3yILk90HBCNbS99qRnLn9bnPwfjnZNQR3zj+Wd03h/2hNdQ1wT0k2a/WC9KrhBgAlcwAAABAogCZIIF4IVwAIoaIgBgAIxAvhOgQA/gLvdplS6vruLgAAAABJRU5ErkJggg==",Gb="/music-learning-tools/student-notation/assets/favicon-Bc4v39Jn.ico",Kb="/music-learning-tools/student-notation/assets/favicon-BsWgUeI5.svg",qb="/music-learning-tools/student-notation/assets/atkinsonHyperlegibleNextBold-CRDaWt1k.otf",zb="/music-learning-tools/student-notation/assets/atkinsonHyperlegibleNextRegular-DOJsAlq1.otf",$b="/music-learning-tools/student-notation/assets/atkinsonHyperlegibleNextRegularItalic-DruWc0Qu.otf",Xb="data:application/manifest+json;base64,ew0KICAibmFtZSI6ICJTdHVkZW50Tm90YXRpb24iLA0KICAic2hvcnRfbmFtZSI6ICJTTiIsDQogICJpY29ucyI6IFsNCiAgICB7DQogICAgICAic3JjIjogIi93ZWItYXBwLW1hbmlmZXN0LTE5MngxOTIucG5nIiwNCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwNCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIsDQogICAgICAicHVycG9zZSI6ICJtYXNrYWJsZSINCiAgICB9LA0KICAgIHsNCiAgICAgICJzcmMiOiAiL3dlYi1hcHAtbWFuaWZlc3QtNTEyeDUxMi5wbmciLA0KICAgICAgInNpemVzIjogIjUxMng1MTIiLA0KICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIiwNCiAgICAgICJwdXJwb3NlIjogIm1hc2thYmxlIg0KICAgIH0NCiAgXSwNCiAgInRoZW1lX2NvbG9yIjogIiNmZmZmZmYiLA0KICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwNCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSINCn0=",Yb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAAAXNSR0IArs4c6QAACJhJREFUeF7tncFuG1UYRv9rO0ElaRFSt0gsCgKhNu0esUasQeQ9eAvEA4DoBsQKNmUBgWwRVSWKEEKCZUkXNICUJhAQajIedF1PNRnZjok6OmN8solke+Zen29OPju6vk7b7/9Rhj8IgSJSPP/nnRimHjK+g0YkBeAuAwXg2FcjKwCYgQKA8MdDKwCYgQKA8BWAh68AfAY2AJiBAoDwbQAevgLwGdgAYAYKAMK3AXj4CsBnYAOAGSgACN8G4OErAJ+BDQBmoAAgfBuAh68AfAY2AJiBAoDwbQAevgLwGdgAYAZF9OLS4Z0oXA6NpaAAGPqIflnGT+vnYjCeQ/5gRoqI6ne+uX5bfar1x1Uf6Gge23xqnv8k28xHAWABvnvqQvTBOSz70AoAXgG5ARQADMAGYOErAMvfl0AwfwWAA7AB2AAUgOVvA8D8FQAOwAZgA1AAlr8NAPNXADgAG4ANQAFY/jYAzF8B4ABsADYABWD52wAwfwWAA7AB2AAUgOVvA8D8FQAOIDfA59fdHp2KIQvwwwVXg1L8Rw3w1o2//H4AKIFhDOPZf9ZjmBfy+4MQSJtf/K0ACPqI4yjjlf0no1AAKIEIBcDQKwCI/tHQCgCmYAOA8MdDKwCYgQKA8BWAh68AfAY2AJiBAoDwbQAevgLwGdgAYAYKAMK3AXj4CsBnYAOAGSgACN8G4OErAJ+BDQBmoAAgfBuAh68AfAY2AJiBAoDwbQAefhbg5f1zrgYFo7ABQPiDMsXW+k6sRO/hNwPUvxigPq/mgvV5lk+3dcy0Oeb5LuD8FQAVoBefrf88FgCcyBIPrQBg+INSAUD8o6EVAExAAUD4vgnm4SsAn4ENAGagACB8G4CHrwB8BjYAmIECgPBtAB6+AvAZ2ABgBgoAwrcBePgKwGdgA4AZKAAI3wbg4SsAn4ENAGagACB8G4CHrwB8Bun17fvuDg3lMBj24su1e64GhfjnYdO1m1sKAAWQooi7xy9GLxXQDBw2Xb71qQJA10EW4JcHGwoA8R81gAJw9BWAY1+NrABgBgoAwq/+C2QDcCEoAMfeBuDZhwLwIfgSCMxAAUD4vgTqAHz/C4SHYAOAEdgAIHwboAPwbQA8BBsAjMAGAOHbAB2AbwPgIdgAYAQ2AAjfBugAfBsAD8EGACOwAUD4NkAH4EcR9x5ccTUoGIUNAMLPnwJ47ugghqm+4f+kTfZnbcpffwLV42ad47+ea9L5Z0FbrPkrACjAUfTjtaNv4jj1wVks99AKAOavACB83wPw8BWAz8AGADNQABC+DcDDVwA+AxsAzEABQPg2AA9fAfgMbAAwAwUA4dsAPHwF4DOwAcAMFACEbwPw8BWAz8AGADNQABC+DcDDVwA+AxsAzEABQPhVA2zculHbHXraUtnmBtL15bvTnkRbx8xazrtY8z+KXrx69K2rQUEP0ofbm7UrNV/Yk3ZLb17w8+yo3tYx0+aYKS7W/PtlEV+vXY1B+P0AlAPpo+0357maqfn9r8fNAny1dk0BwJQVAISvACD86j2ADcCFoAAc+2pkGwDMQAFA+DYAD18B+AxsADADBQDh2wA8fAXgM7ABwAwUAIRvA/DwFYDPwAYAM1AAEL4NwMNXAD4DGwDMQAFA+DYAD18B+AxsADADBQDh2wA8/H55HDfzcujS5dBUGjYART4iipTi0sH+6Hf+mfVJh/o0q8fVf+f7698OMOlpNY+rj1kf+yyfuFjU+SsAKMBxSnF1bzeK1ANnsdxDKwCYvwKA8H0PwMNXAD4DGwDMQAFA+DYAD18B+AxsADADBQDh2wA8fAXgM7ABwAwUAIRvA/DwFYDPwAYAM1AAEL4NwMNXAD4DGwDMQAFA+DYAD18B+AxsADADBQDhVw3w8Za7Q1Mx5GXQLxzsxtDVoFQEkXauv3Fie/RqV//6jdN2+q8/9rRvA5h0f3OsWeeYNK9J1BZp/r1hit2nf4te6XJoyoC0+95JAaiJLOO4WYCdiwpAZq8AIH0FAOFX7wFsAC4EBeDYVyPbAGAGCgDCtwF4+ArAZ2ADgBkoAAjfBuDhKwCfgQ0AZqAAIHwbgIevAHwGNgCYgQKA8G0AHr4C8BnYAGAGCgDCtwF4+ArAZ2ADgBkoAAjfBugA/GGKuxd/j361HLra37w5tRML1sf7qJ82/baOmTbHPJ8FnL8NcNqF1OL9ZRRx/vBylGn8BRnTNuY/7cMWk+bY1jFn+fKAtubSfN7zjNOYvwK0eIGfduqHAlyJqAQ47QDvf+wEFOCxI53/hAowP6u2HqkAbZGd47wKMAeklh+iAC0DnnV6BQDh+18gHr4C8BnYAGAGCgDCtwF4+ArAZ2ADgBkoAAjfBuDhKwCfgQ0AZqAAIHwbgIevAHwGNgCYgQKA8G0AHr4C8BnYAGAGCgDCf9QA7242V47zs1qSGeRl0OcPX3I1KJh32nvng5oAsxZ712dZPa7+O99ffSJimlPN4/Ixs26bROYsC9Kb5+nG/MuyH0/0f4yIPngJLPfQ6f7bn9gA0DWQBVhdua0AEP/Rn18F4OgrAMe+GlkBwAwUAIRfvQm2AbgQFIBjbwPw7EMB+BB8CQRmoAAgfF8C8fAVgM/ABgAzUAAQvg3Aw1cAPgMbAMxAAUD4NgAPXwH4DGwAMAMFAOHbADx8BeAzsAHADBQAhG8D8PCzAIOV7yNiMJ7MvJvv15edV3uCT7qt+Ryby9WnLQufxWbeOU4bO9/enfnbAKAHqSxib/WZSKMLwh+CgAIQ1Kv6LYv4dXUjejH+ggxwLss6tAKAyecGUAAwAD8QA8NXADYABWD52wAs/zy6L4HADBQAhO+/QTsA35dAeAg2ABiBDQDCtwE6AN8GwEOwAcAIbAAQvg3QAfg2AB6CDQBGYAOA8G2ADsC3AfAQbAAwAhsAhG8DdAC+DYCHYAOAEdgAIPzx0P8CpKm0wymYN9kAAAAASUVORK5CYII=",jb="/music-learning-tools/student-notation/assets/web-app-manifest-512x512-Dz8l3SBy.png",Xu=`<div id="app-loading-screen">\r
  <div class="loading-container">\r
    <div class="loading-logo">\r
      <svg viewBox="0 0 100 100" class="logo-svg">\r
        <circle cx="50" cy="50" r="45" class="logo-circle" />\r
        <path d="M 30 50 Q 50 30, 70 50 T 70 70" class="logo-path" />\r
      </svg>\r
    </div>\r
    <h1 class="loading-title">Student Notation</h1>\r
    <div class="loading-progress-container">\r
      <div class="loading-progress-bar">\r
        <div class="loading-progress-fill" id="loading-progress-fill"></div>\r
      </div>\r
      <div class="loading-progress-text" id="loading-progress-text">0%</div>\r
    </div>\r
    <div class="loading-status" id="loading-status">Initializing...</div>\r
  </div>\r
</div>\r
<!-- Sidebar for File/App Actions -->\r
<div id="sidebar-overlay"></div>\r
<aside id="sidebar" role="complementary" aria-label="Application settings and controls">\r
<div class="sidebar-container">\r
<div class="app-title">Student Notation</div>\r
</div>\r
<div class="sidebar-container">\r
<button class="sidebar-button" id="save-as-button" title="Save As"><img src="assets/sidebar/saveAs.svg" alt="Save As"><span class="sidebar-button-text">Save As</span></button>\r
<button class="sidebar-button" id="import-button" title="Open"><img src="assets/sidebar/open.svg" alt="Open"><span class="sidebar-button-text">Open</span></button>\r
<button class="sidebar-button" id="print-button" title="Print"><img src="assets/sidebar/print.svg" alt="Print"><span class="sidebar-button-text">Print</span></button>\r
<button class="sidebar-button" id="reset-canvas-button" title="New File"><img src="assets/sidebar/newPage.svg" alt="New Page"><span class="sidebar-button-text">New Page</span></button>\r
</div>\r
<div class="sidebar-container">\r
<h4 class="sidebar-section-header">Handoff</h4>\r
<button class="sidebar-button" id="take-to-singing-trainer-button" title="Take to Singing Trainer">\r
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\r
<path d="M7 17L17 7"/><path d="M7 7h10v10"/>\r
</svg>\r
<span class="sidebar-button-text">Take to Singing Trainer</span></button>\r
</div>\r
<div class="sidebar-container">\r
<button class="sidebar-button" id="hide-drumgrid-toggle" title="Toggle Drum Grid"><img src="assets/sidebar/hideDrums.svg" alt="Toggle Drum Grid"><span class="sidebar-button-text">Hide Drum Grid</span></button>\r
<button class="sidebar-button" id="hide-buttongrid-toggle" title="Toggle Button Grid"><img src="assets/sidebar/hideAnalysis.svg" alt="Toggle Button Grid"><span class="sidebar-button-text">Hide Button Grid</span></button>\r
<div class="sidebar-legend-toggle-row" role="group" aria-label="Legend visibility">\r
  <button class="sidebar-toggle-button" id="hide-leftlegend-toggle" type="button">Hide Left Legend</button>\r
  <button class="sidebar-toggle-button" id="hide-rightlegend-toggle" type="button">Hide Right Legend</button>\r
</div>\r
</div>\r
<div class="sidebar-container">\r
<h4 class="sidebar-section-header">Long Notes Style</h4>\r
<div class="toggle-button-group"><button class="sidebar-toggle-button active" id="long-note-style1-btn">Circle & Tails</button><button class="sidebar-toggle-button" id="long-note-style2-btn">Stadium</button></div>\r
</div>\r
<div class="sidebar-container">\r
<h4 class="sidebar-section-header">Playhead</h4>\r
<div class="toggle-button-group"><button class="sidebar-toggle-button active" id="playhead-mode-cursor-btn">Cursor Playhead</button><button class="sidebar-toggle-button" id="playhead-mode-microbeat-btn">Pulsing Microbeat</button><button class="sidebar-toggle-button" id="playhead-mode-macrobeat-btn">Pulsing Macrobeat</button></div>\r
</div>\r
</aside>\r
<main id="app-container" role="main">\r
  <!-- Toolbar Container -->\r
  <nav id="toolbar" role="navigation" aria-label="Music notation tools">\r
    <!-- Primary Toolbar -->\r
    <div id="toolbar-primary" class="toolbar-primary">\r
        <div class="primary-toolbar-grid-5x5">\r
            <!-- Row 1: settings, volume, blue notes -->\r
            <button class="toolkit-icon-button" id="settings-button" title="Settings"><img src="assets/icons/settings.svg" alt="Settings"></button>\r
            <div id="volume-control-wrapper">\r
                <button class="toolkit-icon-button" id="volume-icon-button" aria-label="Volume" title="Volume"><img src="assets/icons/volume.svg" alt="Volume"></button>\r
                <div id="volume-popup">\r
                    <input type="range" id="vertical-volume-slider" orient="vertical" min="0" max="100" value="70" step="1" />\r
                </div>\r
            </div>\r
            <div class="note circle-note" data-type="circle" data-color="#4a90e2"></div>\r
            <div class="note oval-note" data-type="oval" data-color="#4a90e2"></div>\r
            <div class="note diamond-note" data-type="diamond" data-color="#4a90e2" aria-label="Sixteenth note jewel">\r
                <svg class="diamond-icon" viewBox="0 0 120 120" aria-hidden="true" focusable="false">\r
                    <path d="M60 5 L35 48.3 L35 71.7 L60 115 L85 71.7 L85 48.3 Z" />\r
                </svg>\r
            </div>\r
            <!-- Row 2: zoom in/out, black notes -->\r
            <button class="toolkit-icon-button" id="grid-zoom-in" title="Zoom In"><img src="assets/icons/zoomIn.svg" alt="Zoom In"></button>\r
            <button class="toolkit-icon-button" id="grid-zoom-out" title="Zoom Out"><img src="assets/icons/zoomOut.svg" alt="Zoom Out"></button>\r
            <div class="note circle-note" data-type="circle" data-color="#2d2d2d"></div>\r
            <div class="note oval-note" data-type="oval" data-color="#2d2d2d"></div>\r
            <div class="note diamond-note" data-type="diamond" data-color="#2d2d2d" aria-label="Sixteenth note jewel">\r
                <svg class="diamond-icon" viewBox="0 0 120 120" aria-hidden="true" focusable="false">\r
                    <path d="M60 5 L35 48.3 L35 71.7 L60 115 L85 71.7 L85 48.3 Z" />\r
                </svg>\r
            </div>\r
            <!-- Row 3: redo/undo, red notes -->\r
            <button class="toolkit-icon-button" id="redo-button" title="Redo"><img src="assets/icons/redo.svg" alt="Redo"></button>\r
            <button class="toolkit-icon-button" id="undo-button" title="Undo"><img src="assets/icons/undo.svg" alt="Undo"></button>\r
            <div class="note circle-note" data-type="circle" data-color="#d66573"></div>\r
            <div class="note oval-note" data-type="oval" data-color="#d66573"></div>\r
            <div class="note diamond-note" data-type="diamond" data-color="#d66573" aria-label="Sixteenth note jewel">\r
                <svg class="diamond-icon" viewBox="0 0 120 120" aria-hidden="true" focusable="false">\r
                    <path d="M60 5 L35 48.3 L35 71.7 L60 115 L85 71.7 L85 48.3 Z" />\r
                </svg>\r
            </div>\r
            <!-- Row 4: clear/eraser, green notes -->\r
            <button class="toolkit-icon-button" id="clear-button" title="Clear"><img src="assets/icons/clear.svg" alt="Clear"></button>\r
            <button class="toolkit-icon-button eraser-button" id="eraser-tool-button" title="Eraser">\r
                <img src="assets/icons/eraser.svg" alt="Eraser" class="eraser-icon">\r
            </button>\r
            <div class="note circle-note" data-type="circle" data-color="#68a03f"></div>\r
            <div class="note oval-note" data-type="oval" data-color="#68a03f"></div>\r
            <div class="note diamond-note" data-type="diamond" data-color="#68a03f" aria-label="Sixteenth note jewel">\r
                <svg class="diamond-icon" viewBox="0 0 120 120" aria-hidden="true" focusable="false">\r
                    <path d="M60 5 L35 48.3 L35 71.7 L60 115 L85 71.7 L85 48.3 Z" />\r
                </svg>\r
            </div>\r
            <!-- Row 5: lasso/marker shortcuts, playback controls -->\r
            <button class="toolkit-icon-button" id="lasso-shortcut-button" title="Lasso Tool">\r
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="3 2">\r
                    <ellipse cx="12" cy="12" rx="8" ry="6" transform="rotate(-15 12 12)"/>\r
                </svg>\r
            </button>\r
            <button class="toolkit-icon-button" id="marker-shortcut-button" title="Marker Tool">\r
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                    <path d="M18 2L6 14l-2 6 6-2L22 6l-4-4z"/>\r
                    <line x1="14" y1="6" x2="18" y2="10"/>\r
                </svg>\r
            </button>\r
            <button class="toolkit-icon-button" id="play-button" title="Play"><img src="assets/icons/play.svg" alt="Play"></button>\r
            <button class="toolkit-icon-button" id="stop-button" title="Stop"><img src="assets/icons/stop.svg" alt="Stop"></button>\r
            <button class="toolkit-icon-button" id="loop-button" title="Loop"><img src="assets/icons/loop.svg" alt="Loop"></button>\r
        </div>\r
    </div>\r
    <!-- Secondary Toolbar -->\r
    <div id="toolbar-secondary" class="toolbar-secondary">\r
        <div class="tab-sidebar">\r
            <button class="tab-button" data-tab="timbre">Timbre</button>\r
            <button class="tab-button" data-tab="pitch">Pitch</button>\r
            <button class="tab-button" data-tab="rhythm">Rhythm</button>\r
        </div>\r
        <div class="tab-content">\r
            <!-- Timbre Tab -->\r
            <div class="tab-panel" id="timbre-panel">\r
                <!-- Presets/Effects Section (Separate) -->\r
                <div class="control-section preset-effects-container">\r
                    <div class="preset-effects-controls">\r
                            <div class="preset-effects-tabs">\r
                                <button class="preset-tab-button active" data-preset-tab="presets">Presets</button>\r
                                <button class="preset-tab-button" data-preset-tab="effects">Effects</button>\r
                            </div>\r
                            <div class="preset-effects-content">\r
                                <!-- Presets Tab -->\r
                                <div class="preset-tab-panel active" id="presets-panel">\r
                            <div class="preset-content-box">\r
                                <div class="preset-grid" id="preset-buttons">\r
                                    <div class="preset-column">\r
                                        <button class="preset-button" id="preset-sine">Sine</button>\r
                                        <button class="preset-button" id="preset-triangle">Triangle</button>\r
                                        <button class="preset-button" id="preset-square">Square</button>\r
                                        <button class="preset-button" id="preset-sawtooth">Sawtooth</button>\r
                                    </div>\r
                                    <div class="preset-column">\r
                                        <button class="preset-button" id="preset-piano">Piano</button>\r
                                        <button class="preset-button" id="preset-marimba">Marimba</button>\r
                                        <button class="preset-button" id="preset-woodwind">Woodwind</button>\r
                                        <button class="preset-button" id="preset-strings">Strings</button>\r
                                    </div>\r
                                </div>\r
                            </div>\r
                        </div>\r
                        <!-- Effects Tab -->\r
                        <div class="preset-tab-panel" id="effects-panel">\r
                            <div class="effects-content-box">\r
                                <div class="position-controls-container">\r
                                    <div class="position-control-group">\r
                                        <h5 class="position-label">Delay</h5>\r
                                        <div class="position-component-wrapper">
                                            <div class="position-component" id="delay-position" data-svelte-component="effects-cartesian-slider" data-effect="delay"></div>
                                            <div id="delay-mix-wrapper"></div>
                                        </div>
                                        <div class="position-axis-labels" data-axis-x="Time" data-axis-y="Echoes"></div>\r
                                    </div>\r
                                    <div class="position-control-group">\r
                                        <h5 class="position-label">Vibrato</h5>\r
                                        <div class="position-component-wrapper">
                                            <div class="position-component" id="vibrato-position" data-svelte-component="effects-cartesian-slider" data-effect="vibrato"></div>
                                            <div id="vibrato-mix-wrapper"></div>
                                        </div>
                                        <div class="position-axis-labels" data-axis-x="Speed" data-axis-y="Span"></div>\r
                                    </div>\r
                                    <div class="position-control-group">\r
                                        <h5 class="position-label">Tremolo</h5>\r
                                        <div class="position-component-wrapper">
                                            <div class="position-component" id="tremolo-position" data-svelte-component="effects-cartesian-slider" data-effect="tremolo"></div>
                                            <div id="tremolo-mix-wrapper"></div>
                                        </div>
                                        <div class="position-axis-labels" data-axis-x="Speed" data-axis-y="Span"></div>\r
                                    </div>\r
                                </div>\r
                            </div>\r
                        </div>                        \r
                        <div class="effect-controls-container" id="effect-controls" style="display: none;">\r
                            <!-- Effect controls will be dynamically inserted here for data synchronization -->\r
                        </div>\r
                            </div>\r
                    </div>\r
                </div>\r
                <div class="control-section filter-container">\r
                    <!-- Row 1, Col 1: Blend slider -->\r
                    <div class="blend-slider-container"><div id="blend-slider-container"><div class="filter-blend-thumb" id="thumb-b" tabindex="0">B</div></div></div>\r
                    <!-- Row 2, Col 1: Bins grid (appended via JS) -->\r
                    <div class="filter-bins-wrapper"></div>\r
                    <!-- Row 3, Col 1: Cutoff slider -->\r
                    <div id="cutoff-slider-container"><div class="filter-cutoff-thumb" id="thumb-c" tabindex="0">C</div></div>\r
                    <!-- Row 2, Col 2: Vertical M slider (appended via JS) -->\r
                    <div class="filter-vertical-blend-wrapper"></div>\r
                </div>\r
                <div class="control-section adsr-container">\r
                    <!-- Row 1, Col 1: ADSR graph -->\r
                    <div class="adsr-graph-wrapper"><div id="adsr-envelope"></div></div>\r
                    <!-- Row 1, Col 2: Sustain slider -->\r
                    <div class="sustain-slider-wrapper"><div id="sustain-slider-track"><div id="sustain-slider-thumb" tabindex="0">S</div></div></div>\r
                    <!-- Row 2, Col 1: ADR slider -->\r
                    <div id="multi-thumb-slider-container"><div class="time-slider-thumb" id="thumb-a" tabindex="0">A</div><div class="time-slider-thumb" id="thumb-d" tabindex="0">D</div><div class="time-slider-thumb" id="thumb-r" tabindex="0">R</div></div>\r
                </div>\r
                  <!-- Waveform Section (Separate) -->\r
                  <div class="control-section">\r
                      <div class="waveform-section">\r
                          <div class="waveform-content-box">\r
                              <div class="waveform-display-wrapper">\r
                                  <canvas id="static-waveform-canvas"></canvas>\r
                                  <div class="waveform-speed-controls">\r
                                      <button class="waveform-speed-btn" data-speed="50">50%</button>\r
                                      <button class="waveform-speed-btn" data-speed="10">10%</button>\r
                                  </div>\r
                              </div>\r
                          </div>\r
                      </div>\r
                  </div>\r
              </div>\r
              <!-- Pitch Tab -->\r
            <div class="tab-panel" id="pitch-panel">\r
                <div class="control-section pitch-tabs-container">\r
                    <div class="pitch-tabs">\r
                        <button class="pitch-tab-button active" data-pitch-tab="range">Range</button>\r
                        <button class="pitch-tab-button" data-pitch-tab="chords">Chords</button>\r
                        <button class="pitch-tab-button" data-pitch-tab="draw">Draw</button>\r
                    </div>\r
                    <div class="pitch-tab-content">\r
                        <div class="pitch-tab-panel active" id="range-panel">\r
                            <div class="range-content-box">\r
                                <div class="range-layout">\r
                                   <div class="range-panel-section modes-section">\r
                                       <!-- <h4 class="panel-section-title">Modes</h4> -->\r
                                       <div class="tonic-modes-container">\r
                                           <div class="tonic-modes-grid">\r
                                               <button class="tonic-mode-button" data-tonic="1">\r
                                                   <img src="assets/tabicons/tonicShape_1.svg" alt="Major" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Major</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="2">\r
                                                   <img src="assets/tabicons/tonicShape_2.svg" alt="Dorian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Dorian</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="3">\r
                                                   <img src="assets/tabicons/tonicShape_3.svg" alt="Phrygian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Phrygian</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="4">\r
                                                   <img src="assets/tabicons/tonicShape_4.svg" alt="Lydian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Lydian</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="5">\r
                                                   <img src="assets/tabicons/tonicShape_5.svg" alt="Mixolydian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Mixolydian</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="6">\r
                                                   <img src="assets/tabicons/tonicShape_6.svg" alt="Minor" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Minor</span>\r
                                               </button>\r
                                               <button class="tonic-mode-button" data-tonic="7">\r
                                                   <img src="assets/tabicons/tonicShape_7.svg" alt="Locrian" class="tonic-mode-icon">\r
                                                   <span class="tonic-mode-label">Locrian</span>\r
                                               </button>\r
                                           </div>\r
                                       </div>\r
                                   </div>\r
                                   <div class="range-panel-section degrees-section">\r
                                       <!-- <h4 class="panel-section-title">Degrees</h4> -->\r
                                       <div class="degree-visibility-toggle-container">\r
                                           <button class="degree-visibility-button" id="degree-visibility-toggle" type="button">\r
                                               Show Degrees\r
                                           </button>\r
                                       </div>\r
                                       <div class="degree-mode-toggle-container" id="degree-mode-toggle">\r
                                           <button class="degree-mode-button" data-mode="diatonic" type="button">Scale</button>\r
                                           <button class="degree-mode-button" data-mode="modal" type="button">Mode</button>\r
                                       </div>\r
                                       <label class="checkbox-label">\r
                                            <input type="checkbox" id="focus-colours-toggle">\r
                                            <span class="checkbox-text">Focus Colours</span>\r
                                        </label>\r
                                   </div>\r
                                   <div class="range-panel-section wheels-section">\r
                                       <!-- <h4 class="panel-section-title">Select Range</h4> -->\r
                                       <div class="clef-wheels-wrapper">\r
                                           <div class="clef-picker-column">\r
                                               <div class="clef-wheel" id="clef-top-wheel" tabindex="0" aria-label="Select top note">\r
                                                   <div class="clef-wheel-viewport">\r
                                                       <div class="clef-wheel-options"></div>\r
                                                   </div>\r
                                                   <div class="clef-wheel-overlay"></div>\r
                                               </div>\r
                                           </div>\r
                                           <div class="clef-picker-column">\r
                                               <div class="clef-wheel" id="clef-bottom-wheel" tabindex="0" aria-label="Select bottom note">\r
                                                   <div class="clef-wheel-viewport">\r
                                                       <div class="clef-wheel-options"></div>\r
                                                   </div>\r
                                                   <div class="clef-wheel-overlay"></div>\r
                                               </div>\r
                                           </div>\r
                                       </div>\r
                                   </div>\r
                                   <div class="range-panel-section presets-section">\r
                                       <!-- <h4 class="panel-section-title">Presets</h4> -->\r
                                       <div class="clef-presets-column">\r
                                           <div class="clef-preset-buttons">\r
                                               <button class="toolkit-button clef-preset-button" id="clef-full-range-button" type="button">\r
                                                   Full Range\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-treble-button" type="button">\r
                                                   Treble\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-alto-button" type="button">\r
                                                   Alto\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-bass-button" type="button">\r
                                                   Bass\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-voice1-button" type="button">\r
                                                   Voice I\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-voice2-button" type="button">\r
                                                   Voice II\r
                                               </button>\r
                                               <button class="toolkit-button clef-preset-button" id="clef-voice3-button" type="button">\r
                                                   Voice III\r
                                               </button>\r
                                           </div>\r
                                       </div>\r
                                   </div>\r
                                </div>\r
                        </div>\r
                    </div>\r
                        <div class="pitch-tab-panel" id="chords-panel">\r
            <div class="chords-content-box">\r
                <div class="chords-layout">\r
                    <div class="chords-panel-section intervals-grid-section">\r
                        <h4 class="panel-section-title">Intervals</h4>\r
                        <div class="intervals-grid-column">\r
                            <div class="harmony-preset-grid intervals-4x4-grid">\r
                                <button class="harmony-preset-button">M6</button>\r
                                <button class="harmony-preset-button">A6</button>\r
                                <button class="harmony-preset-button">m7</button>\r
                                <button class="harmony-preset-button">M7</button>\r
                                <button class="harmony-preset-button">d5</button>\r
                                <button class="harmony-preset-button">P5</button>\r
                                <button class="harmony-preset-button">A5</button>\r
                                <button class="harmony-preset-button">m6</button>\r
                                <button class="harmony-preset-button">m3</button>\r
                                <button class="harmony-preset-button">M3</button>\r
                                <button class="harmony-preset-button">P4</button>\r
                                <button class="harmony-preset-button">A4</button>\r
                                <button class="harmony-preset-button">U</button>\r
                                <button class="harmony-preset-button">m2</button>\r
                                <button class="harmony-preset-button">M2</button>\r
                                <button class="harmony-preset-button">A2</button>\r
                            </div>\r
                        </div>\r
                    </div>\r
                    <div class="chords-panel-section unified-position-section">\r
                        <h4 class="panel-section-title">Position</h4>\r
                        <div class="unified-position-column">\r
                            <div class="unified-position-toggle" id="unified-position-toggle">\r
                                <div class="left-labels">\r
                                    <span class="state-label" data-step="0">Asc.</span>\r
                                    <span class="state-label" data-step="1">Desc.</span>\r
                                </div>\r
                                <div class="toggle-track">\r
                                    <div class="unified-slider"></div>\r
                                </div>\r
                                <div class="right-labels">\r
                                    <span class="state-label" data-step="0">Root</span>\r
                                    <span class="state-label" data-step="1">1st</span>\r
                                    <span class="state-label" data-step="2">2nd</span>\r
                                    <span class="state-label" data-step="3">3rd</span>\r
                                    <span class="state-label" data-step="4">4th</span>\r
                                    <span class="state-label" data-step="5">5th</span>\r
                                </div>\r
                            </div>\r
                        </div>\r
                    </div>\r
                    <div class="chords-panel-section chords-grid-section">\r
                        <h4 class="panel-section-title">Chords</h4>\r
                        <div class="chords-grid-column">\r
                            <div class="harmony-preset-grid chords-grid chords-grid-6col" id="chords-preset-grid">\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;]" title="Major triad">X</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;]" title="Minor triad">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5d&quot;]" title="Diminished triad">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;6m&quot;]" title="Augmented triad">X+</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7m&quot;]" title="Dominant 7">X</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;7m&quot;]" title="Minor 7">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7M&quot;]" title="Major 7">Xmaj</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5d&quot;, &quot;7m&quot;]" title="Half-diminished 7"></button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5d&quot;, &quot;6M&quot;]" title="Fully diminished 7">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;6M&quot;]" title="Major 6">X</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;2M&quot;, &quot;5P&quot;]" title="Suspended 2">Xsus2</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;4P&quot;, &quot;5P&quot;]" title="Suspended 4">Xsus4</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;7M&quot;]" title="Minor-major 7">xmaj</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;9M&quot;]" title="Major add 9">Xadd9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;9M&quot;]" title="Minor add 9">xadd9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;6M&quot;, &quot;9M&quot;]" title="Major 6/9">X6/9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;]" title="Dominant 9">X9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;, &quot;11P&quot;]" title="Dominant 11">X11</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;, &quot;13M&quot;]" title="Dominant 13">X13</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7M&quot;, &quot;9M&quot;]" title="Major 9">Xmaj9</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;]" title="Minor 9">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;6M&quot;]" title="Minor 6">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3m&quot;, &quot;5P&quot;, &quot;7m&quot;, &quot;9M&quot;, &quot;11P&quot;]" title="Minor 11">x</button>\r
                                <button class="harmony-preset-button" data-chord-intervals="[&quot;1P&quot;, &quot;3M&quot;, &quot;5P&quot;, &quot;7M&quot;, &quot;11A&quot;]" title="Major 7 sharp 11 (Lydian)">Xmaj711</button>\r
                            </div>\r
                        </div>\r
                    </div>\r
                </div>\r
            </div>\r
        </div>\r
                        <div class="pitch-tab-panel" id="draw-panel">\r
                            <div class="draw-content-box">\r
                                <div class="draw-layout-grid">\r
                                    <!-- Arrow Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-arrow-controls" data-draw-tool="arrow">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="arrow" title="Arrow Tool">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                    <line x1="4" y1="20" x2="20" y2="4"/>\r
                                                    <polyline points="14,4 20,4 20,10"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="arrow-tool-options">\r
                                            <div class="draw-option-group">\r
                                                <div class="draw-toolbar-row">\r
                                                    <!-- Stroke weight popup -->\r
                                                    <div class="draw-popup-trigger">\r
                                                        <button class="draw-toolbar-button" title="Stroke width">\r
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                                <line x1="4" y1="12" x2="20" y2="12"/>\r
                                                            </svg>\r
                                                        </button>\r
                                                        <div class="draw-popup-menu">\r
                                                            <div class="draw-option-label">Stroke</div>\r
                                                            <input type="range" id="arrow-stroke-weight" min="1" max="20" value="4" aria-label="Arrow stroke weight">\r
                                                        </div>\r
                                                    </div>\r
\r
                                                    <!-- Line style popup -->\r
                                                    <div class="draw-popup-trigger">\r
                                                        <button class="draw-toolbar-button" title="Line style">\r
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                                <line x1="4" y1="8" x2="20" y2="8" stroke-dasharray="4 3"/>\r
                                                                <line x1="4" y1="16" x2="20" y2="16"/>\r
                                                            </svg>\r
                                                        </button>\r
                                                        <div class="draw-popup-menu">\r
                                                            <div class="draw-option-label">Line Style</div>\r
                                                            <div class="draw-button-group">\r
                                                                <button class="draw-option-button active" data-line-style="solid">Solid</button>\r
                                                                <button class="draw-option-button" data-line-style="dashed">Dashed</button>\r
                                                            </div>\r
                                                        </div>\r
                                                    </div>\r
                                                </div>\r
                                                <div class="draw-toolbar-row">\r
                                                    <!-- Left arrowhead popup -->\r
                                                    <div class="draw-popup-trigger">\r
                                                        <button class="draw-toolbar-button" id="arrow-start-head-trigger" title="Start head">\r
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                                <polyline points="9,5 3,12 9,19"/>\r
                                                                <line x1="3" y1="12" x2="21" y2="12"/>\r
                                                            </svg>\r
                                                        </button>\r
                                                                <div class="draw-popup-menu">\r
                                                                    <div class="draw-option-label">Start</div>\r
                                                                    <div class="draw-button-group">\r
                                                                    <button class="draw-option-button active" data-arrow-start="none">No head</button>\r
                                                                    <button class="draw-option-button" data-arrow-start="filled-arrow">Arrow</button>\r
                                                                    </div>\r
                                                                </div>\r
                                                            </div>\r
                                                    <!-- Swap heads -->\r
                                                    <button class="draw-toolbar-button" id="arrow-swap-heads" title="Swap heads">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <polyline points="9 5 15 5 15 11"/>\r
                                                            <polyline points="15 19 9 19 9 13"/>\r
                                                            <line x1="9" y1="5" x2="5" y2="9"/>\r
                                                            <line x1="15" y1="19" x2="19" y2="15"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <!-- Right arrowhead popup -->\r
                                                    <div class="draw-popup-trigger">\r
                                                        <button class="draw-toolbar-button" id="arrow-end-head-trigger" title="End head">\r
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                                <polyline points="15,5 21,12 15,19"/>\r
                                                                <line x1="3" y1="12" x2="21" y2="12"/>\r
                                                            </svg>\r
                                                        </button>\r
                                                                <div class="draw-popup-menu">\r
                                                                    <div class="draw-option-label">End</div>\r
                                                                    <div class="draw-button-group">\r
                                                                    <button class="draw-option-button active" data-arrow-end="filled-arrow">Arrow</button>\r
                                                                    <button class="draw-option-button" data-arrow-end="none">No head</button>\r
                                                                    </div>\r
                                                                    <div class="draw-option-label">Head Size</div>\r
                                                                    <input type="range" id="arrow-head-size" min="8" max="32" value="12" aria-label="Arrowhead size">\r
                                                                </div>\r
                                                            </div>\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                    <!-- Text Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-text-controls" data-draw-tool="text">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="text" title="Text Tool">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                    <polyline points="4,7 4,4 20,4 20,7"/>\r
                                                    <line x1="12" y1="4" x2="12" y2="20"/>\r
                                                    <line x1="9" y1="20" x2="15" y2="20"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="text-tool-options">\r
                                            <div class="draw-option-group draw-toolbar-row">\r
                                                <!-- Size popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Text size">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <path d="M4 18h16"/>\r
                                                            <path d="M8 18l4-12 4 12"/>\r
                                                            <path d="M10 12h4"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Size (px)</div>\r
                                                        <input type="number" id="text-size-input" min="8" max="72" value="16" aria-label="Text size (px)">\r
                                                    </div>\r
                                                </div>\r
                                                <!-- Colour popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Text colour">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <path d="M12 3l6 16"/>\r
                                                            <path d="M6 19l6-16"/>\r
                                                            <path d="M10 12h4"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Colour</div>\r
                                                        <div class="draw-color-picker">\r
                                                            <button class="draw-color-button active" data-color="#000000" style="background-color: #000000;" aria-label="Black text"></button>\r
                                                            <button class="draw-color-button" data-color="#4a90e2" style="background-color: #4a90e2;" aria-label="Blue text"></button>\r
                                                            <button class="draw-color-button" data-color="#d66573" style="background-color: #d66573;" aria-label="Red text"></button>\r
                                                            <button class="draw-color-button" data-color="#68a03f" style="background-color: #68a03f;" aria-label="Green text"></button>\r
                                                        </div>\r
                                                    </div>\r
                                                </div>\r
                                                <!-- Style buttons -->\r
                                                <div class="text-style-rows">\r
                                                    <div class="draw-button-group">\r
                                                        <button class="draw-option-button" data-text-style="bold">B</button>\r
                                                        <button class="draw-option-button" data-text-style="italic">I</button>\r
                                                        <button class="draw-option-button" data-text-style="underline">U</button>\r
                                                    </div>\r
                                                    <div class="draw-button-group">\r
                                                        <button class="draw-option-button" data-text-style="background">Bg</button>\r
                                                        <button class="draw-option-button" data-text-style="superscript">x<sup>2</sup></button>\r
                                                        <button class="draw-option-button" data-text-style="subscript">x<sub>2</sub></button>\r
                                                    </div>\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                    <!-- Marker Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-marker-controls" data-draw-tool="marker">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="marker" title="Marker Tool">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                    <!-- Pointed marker tip -->\r
                                                    <path d="M18 2L6 14l-2 6 6-2L22 6l-4-4z"/>\r
                                                    <line x1="10" y1="18" x2="6" y2="14"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="marker-tool-options">\r
                                            <div class="draw-option-group draw-toolbar-row">\r
                                                <!-- Size popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Marker size">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <path d="M6 19l12-14"/>\r
                                                            <path d="M6 19l-2 4 4-2"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Size</div>\r
                                                        <input type="range" id="marker-size-input" min="2" max="20" value="6" aria-label="Marker size">\r
                                                    </div>\r
                                                </div>\r
                                                <!-- Colours popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Marker colour">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <path d="M19 4l-7 7"/>\r
                                                            <path d="M5 20l3.5-1.5"/>\r
                                                            <path d="M16 7l1.5 1.5"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Colours</div>\r
                                                        <div class="draw-color-picker">\r
                                                            <button class="draw-color-button" data-color="#4a90e2" style="background-color: #4a90e2;" aria-label="Blue marker"></button>\r
                                                            <button class="draw-color-button" data-color="#2d2d2d" style="background-color: #2d2d2d;" aria-label="Black marker"></button>\r
                                                            <button class="draw-color-button" data-color="#d66573" style="background-color: #d66573;" aria-label="Red marker"></button>\r
                                                            <button class="draw-color-button" data-color="#68a03f" style="background-color: #68a03f;" aria-label="Green marker"></button>\r
                                                        </div>\r
                                                    </div>\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                    <!-- Highlighter Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-highlighter-controls" data-draw-tool="highlighter">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="highlighter" title="Highlighter Tool">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" opacity="0.5">\r
                                                    <!-- Flat highlighter head -->\r
                                                    <rect x="3" y="3" width="4" height="18" rx="1"/>\r
                                                    <path d="M7 5h12l-2 14H7z"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="highlighter-tool-options">\r
                                            <div class="draw-option-group draw-toolbar-row">\r
                                                <!-- Size popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Highlighter size">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <rect x="5" y="5" width="10" height="10" rx="2"/>\r
                                                            <path d="M9 15l-2 4"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Size</div>\r
                                                        <input type="range" id="highlighter-size-input" min="4" max="30" value="10" aria-label="Highlighter size">\r
                                                    </div>\r
                                                </div>\r
                                                <!-- Colours popup -->\r
                                                <div class="draw-popup-trigger">\r
                                                    <button class="draw-toolbar-button" title="Highlighter colour">\r
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\r
                                                            <rect x="7" y="7" width="10" height="10" rx="2"/>\r
                                                        </svg>\r
                                                    </button>\r
                                                    <div class="draw-popup-menu">\r
                                                        <div class="draw-option-label">Colours</div>\r
                                                        <div class="draw-color-picker">\r
                                                            <button class="draw-color-button" data-color="#9fc5ff" style="background-color: #9fc5ff;" aria-label="Light blue highlighter"></button>\r
                                                            <button class="draw-color-button" data-color="#c2c2c2" style="background-color: #c2c2c2;" aria-label="Gray highlighter"></button>\r
                                                            <button class="draw-color-button" data-color="#ffd166" style="background-color: #ffd166;" aria-label="Yellow highlighter"></button>\r
                                                        </div>\r
                                                    </div>\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                    <!-- Lasso Tool Panel -->\r
                                    <div class="draw-tool-panel" id="draw-lasso-controls" data-draw-tool="lasso">\r
                                        <div class="draw-tool-header">\r
                                            <button class="draw-tool-button" data-draw-tool="lasso" title="Lasso Select">\r
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="3 2">\r
                                                    <ellipse cx="12" cy="12" rx="8" ry="6" transform="rotate(-15 12 12)"/>\r
                                                </svg>\r
                                            </button>\r
                                        </div>\r
                                        <div class="draw-tool-options" id="lasso-tool-options">\r
                                            <div class="draw-option-group draw-toolbar-row">\r
                                                <div class="draw-option-help">\r
                                                    Draw around notes to select and drag them as a group.\r
                                                </div>\r
                                            </div>\r
                                        </div>\r
                                    </div>\r
                                </div>\r
                            </div>\r
                        </div>\r
                    </div>\r
                </div>\r
            </div>\r
            <!-- Rhythm Tab -->\r
            <div class="tab-panel" id="rhythm-panel">\r
\r
                <!-- Stamps/Triplets Section (Separate) -->\r
                <div class="control-section rhythm-stamp-tabs-container">\r
                    <div class="rhythm-stamp-tabs-controls">\r
                        <div class="rhythm-tab-stamps">\r
                            <button class="rhythm-tab-button rhythm-stamp-tab-button active" data-rhythm-stamp-tab="sixteenth">Sixteenths</button>\r
                            <button class="rhythm-tab-button rhythm-stamp-tab-button" data-rhythm-stamp-tab="triplet">Triplets</button>\r
                        </div>\r
                        <div class="rhythm-stamp-tab-content">\r
                            <div class="rhythm-stamp-tab-panel active" id="sixteenth-stamps-panel">\r
                                <div id="sixteenth-stamps-toolbar-container" class="sixteenth-stamps-toolbar-container">\r
                                    <!-- Stamps toolbar will be rendered here by JavaScript -->\r
                                </div>\r
                            </div>\r
                            <div class="rhythm-stamp-tab-panel" id="triplet-stamps-panel">\r
                                <div id="triplet-stamps-toolbar-container" class="triplet-stamps-toolbar-container">\r
                                    <!-- Triplets toolbar will be rendered here by JavaScript -->\r
                                </div>\r
                            </div>\r
                        </div>\r
                    </div>\r
                </div>\r
                                <!-- Controls Section (Separate) -->\r
                <div class="control-section rhythm-controls-container">\r
                    <div class="rhythm-controls-section">\r
                        <button class="rhythm-tab-button rhythm-controls-tab-button active" disabled>Controls</button>\r
                        <div class="rhythm-controls-content-box">\r
                            <div class="tempo-content-box">\r
                                <div class="tempo-container">\r
                                    <div class="tempo-boxes-container">\r
                                        <div class="tempo-input-group tempo-row">\r
                                            <img src="assets/tabicons/eigthNote.svg" alt="Eighth Note Tempo" class="tempo-label-icon">\r
                                            <div id="eighth-note-tempo"></div>\r
                                        </div>\r
                                        <div class="tempo-input-group tempo-row">\r
                                            <img src="assets/tabicons/quarterNote.svg" alt="Quarter Note Tempo" class="tempo-label-icon">\r
                                            <div id="quarter-note-tempo"></div>\r
                                        </div>\r
                                        <div class="tempo-input-group tempo-row">\r
                                            <img src="assets/tabicons/dottedQuarterNote.svg" alt="Dotted Quarter Note Tempo" class="tempo-label-icon">\r
                                            <div id="dotted-quarter-tempo"></div>\r
                                        </div>\r
                                    </div>\r
                                    <div class="tempo-slider-container tempo-column-2">\r
                                        <input type="range" id="tempo-slider" min="30" max="240" value="90">\r
                                    </div>\r
                                </div>\r
                            </div>\r
                            <div class="rhythm-structure-container">\r
                                <div class="control-subsection">\r
                                    <h4>Add/Del Beat</h4>\r
                                    <div class="macrobeat-adjust-group">\r
                                        <button class="toolkit-button" id="macrobeat-decrease"></button>\r
                                        <button class="toolkit-button" id="macrobeat-increase">+</button>\r
                                    </div>\r
                                </div>\r
                                <div class="control-subsection">\r
                                    <h4>Pickup</h4>\r
                                    <div class="toggle-button-group"><button class="sidebar-toggle-button" id="anacrusis-on-btn">On</button><button class="sidebar-toggle-button" id="anacrusis-off-btn">Off</button></div>\r
                                </div>\r
                            </div>\r
                            <div class="modulation-container">\r
                                <div class="control-subsection">\r
                                    <h4>Modulation</h4>\r
                                    <div class="modulation-controls">\r
                                        <button class="toolkit-button modulation-ratio-btn" id="modulation-2-3-btn" data-ratio="2:3" title="Place 2:3 modulation marker (33% faster)">2:3 - 33% faster</button>\r
                                        <button class="toolkit-button modulation-ratio-btn" id="modulation-3-2-btn" data-ratio="3:2" title="Place 3:2 modulation marker (33% slower)">3:2 - 33% slower</button>\r
                                        <button class="toolkit-button" id="modulation-clear-btn" title="Clear all modulation markers">Clear</button>\r
                                    </div>\r
                                </div>\r
                            </div>\r
                        </div>\r
                    </div>\r
                </div>\r
            </div>\r
        </div>\r
    </div>\r
  </nav>\r
  <div id="canvas-container" role="region" aria-label="Musical notation canvas">\r
    <div id="canvas-content">\r
        <div id="grids-wrapper">\r
            <div id="button-grid">\r
                <div class="button-grid-left-cell">\r
                    <div class="left-cell-grid">\r
                        <div id="flat-toggle-btn" class="accidental-btn active" role="button" tabindex="0" aria-pressed="true"></div>\r
                        <div id="sharp-toggle-btn" class="accidental-btn active" role="button" tabindex="0" aria-pressed="true"></div>\r
                        <div id="hz-toggle-btn" class="accidental-btn" role="button" tabindex="0" aria-pressed="false">Hz</div>\r
                        <div id="spn-octave-toggle-btn" class="accidental-btn octave-toggle-btn active" role="button" tabindex="0" aria-pressed="true" title="Show SPN octave digits" aria-label="Toggle SPN octave digits">\r
                            <span class="octave-label">\r
                                A<span class="octave-digit">1</span>\r
                            </span>\r
                        </div>\r
                    </div>\r
                </div>\r
                <div class="button-grid-middle-cell">\r
                    <div id="beat-line-button-layer">\r
                        <div id="time-signature-row" class="beat-line-row"></div>\r
                        <div id="grouping-buttons-row" class="beat-line-row"></div>\r
                        <div id="boundary-buttons-row" class="beat-line-row"></div>\r
                    </div>\r
                </div>\r
                <div class="button-grid-right-cell">\r
                    <!-- Null/empty cell for alignment with pitch grid right legend -->\r
                </div>\r
            </div>\r
            <div id="pitch-grid-wrapper">\r
                <div id="pitch-grid-container">\r
                    <div id="grid-container">\r
                        <div id="pitch-canvas-wrapper">\r
                            <canvas id="legend-left-canvas"></canvas>\r
                            <canvas id="notation-grid"></canvas>\r
                            <canvas id="note-animation-canvas"></canvas>\r
                            <canvas id="legend-right-canvas"></canvas>\r
                            <canvas id="playhead-canvas"></canvas>\r
                            <canvas id="hover-canvas"></canvas>\r
                        </div>\r
                    </div>\r
                </div>\r
            </div>\r
            <div id="grid-scrollbar-proxy" role="scrollbar" aria-label="Horizontal scroll for notation grids" tabindex="0">\r
                <div class="grid-scrollbar-inner"></div>\r
            </div>\r
            <div id="drum-grid-wrapper">\r
                <div class="drum-grid-left-cell">\r
                    <!-- Reserved for future drum legends/controls -->\r
                </div>\r
                <div class="drum-grid-middle-cell">\r
                    <div id="drum-canvas-wrapper">\r
                        <canvas id="drum-grid"></canvas>\r
                        <canvas id="drum-playhead-canvas"></canvas>\r
                        <canvas id="drum-hover-canvas"></canvas>\r
                    </div>\r
                </div>\r
                <div class="drum-grid-right-cell">\r
                    <!-- Placeholder for alignment with right legend spacing -->\r
                </div>\r
            </div>\r
        </div>\r
    </div>\r
</div>\r
</main>\r
<!-- Notification Overlay -->\r
<div id="notification-overlay">\r
    <div class="notification-modal">\r
        <div class="notification-header">\r
            <h3 class="notification-title">Notice</h3>\r
            <button class="notification-close"></button>\r
        </div>\r
        <div class="notification-message"></div>\r
        <div class="notification-actions">\r
            <button class="notification-button">OK</button>\r
        </div>\r
    </div>\r
</div>\r
<!-- ... (Print Preview Modal remains the same) ... -->\r
<div id="print-preview-overlay" class="hidden">\r
    <div id="print-preview-modal">\r
        <div class="print-preview-header">\r
            <h2>Print Preview</h2>\r
            <button id="print-close-button" class="close-button"></button>\r
        </div>\r
        <div class="print-preview-content">\r
            <div class="print-preview-canvas-wrapper">\r
                <canvas id="print-preview-canvas"></canvas>\r
                <canvas id="print-crop-overlay"></canvas>\r
            </div>\r
                <div class="print-preview-options">\r
                <div class="print-info-box">\r
                    <p>Use the crop handles on the preview to trim what gets sent to the printer.</p>\r
                </div>\r
                <h3>Layout</h3>\r
                <div class="print-option-row">\r
                    <label>Paper</label>\r
                    <select id="print-page-size" class="print-select">\r
                        <option value="letter">Letter (8.511)</option>\r
                        <option value="11x14">1114</option>\r
                        <option value="11x17">1117</option>\r
                    </select>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Orientation</label>\r
                    <button id="print-orientation-toggle" class="toggle-button">Landscape</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Buttons</label>\r
                    <button id="print-button-grid-toggle" class="toggle-button active">Include</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Drums</label>\r
                    <button id="print-drum-grid-toggle" class="toggle-button active">Include</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Left Legend</label>\r
                    <button id="print-left-legend-toggle" class="toggle-button active">Include</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Right Legend</label>\r
                    <button id="print-right-legend-toggle" class="toggle-button active">Include</button>\r
                </div>\r
                <div class="print-option-row">\r
                    <label>Color</label>\r
                    <button id="print-color-mode-toggle" class="toggle-button active">Color</button>\r
                </div>\r
            </div>\r
        </div>\r
        <div class="print-preview-footer">\r
            <button id="print-confirm-button" class="confirm-button">Print</button>\r
        </div>\r
    </div>\r
</div>\r
<div id="print-staging-area"></div>\r
\r
<!-- Svelte component mount points (headless components) -->\r
<!-- Toolbar bridges -->\r
<div data-svelte-component="playback-controls-bridge" style="display: none;"></div>\r
<div data-svelte-component="file-actions-bridge" style="display: none;"></div>\r
<div data-svelte-component="grid-controls-bridge" style="display: none;"></div>\r
<div data-svelte-component="modulation-bridge" style="display: none;"></div>\r
<div data-svelte-component="sidebar-bridge" style="display: none;"></div>\r
<div data-svelte-component="tool-selector-bridge" style="display: none;"></div>\r
<div data-svelte-component="audio-controls-bridge" style="display: none;"></div>\r
<!-- Tab management bridge -->\r
<div data-svelte-component="tab-management-bridge" style="display: none;"></div>\r
<!-- Modal bridges -->\r
<div data-svelte-component="print-preview-bridge" style="display: none;"></div>\r
<!-- Phase 3: Modernized Svelte 5 components -->\r
<div data-svelte-component="store-context" style="display: none;"></div>
<div data-svelte-component="notification-modal"></div>
<div data-svelte-component="zoom-indicator"></div>
`,mv="15.1.22",rm=(n,t,e)=>({endTime:t,insertTime:e,type:"exponentialRampToValue",value:n}),im=(n,t,e)=>({endTime:t,insertTime:e,type:"linearRampToValue",value:n}),zd=(n,t)=>({startTime:t,type:"setValue",value:n}),gv=(n,t,e)=>({duration:e,startTime:t,type:"setValueCurve",values:n}),vv=(n,t,{startTime:e,target:s,timeConstant:r})=>s+(t-s)*Math.exp((e-n)/r),co=n=>n.type==="exponentialRampToValue",cc=n=>n.type==="linearRampToValue",Ir=n=>co(n)||cc(n),Bf=n=>n.type==="setValue",$s=n=>n.type==="setValueCurve",uc=(n,t,e,s)=>{const r=n[t];return r===void 0?s:Ir(r)||Bf(r)?r.value:$s(r)?r.values[r.values.length-1]:vv(e,uc(n,t-1,r.startTime,s),r)},om=(n,t,e,s,r)=>e===void 0?[s.insertTime,r]:Ir(e)?[e.endTime,e.value]:Bf(e)?[e.startTime,e.value]:$s(e)?[e.startTime+e.duration,e.values[e.values.length-1]]:[e.startTime,uc(n,t-1,e.startTime,r)],$d=n=>n.type==="cancelAndHold",Xd=n=>n.type==="cancelScheduledValues",br=n=>$d(n)||Xd(n)?n.cancelTime:co(n)||cc(n)?n.endTime:n.startTime,Am=(n,t,e,{endTime:s,value:r})=>e===r?r:0<e&&0<r||e<0&&r<0?e*(r/e)**((n-t)/(s-t)):0,am=(n,t,e,{endTime:s,value:r})=>e+(n-t)/(s-t)*(r-e),Jb=(n,t)=>{const e=Math.floor(t),s=Math.ceil(t);return e===s?n[e]:(1-(t-e))*n[e]+(1-(s-t))*n[s]},Zb=(n,{duration:t,startTime:e,values:s})=>{const r=(n-e)/t*(s.length-1);return Jb(s,r)},za=n=>n.type==="setTarget";class ty{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(t){const e=br(t);if($d(t)||Xd(t)){const s=this._automationEvents.findIndex(i=>Xd(t)&&$s(i)?i.startTime+i.duration>=e:br(i)>=e),r=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),$d(t)){const i=this._automationEvents[this._automationEvents.length-1];if(r!==void 0&&Ir(r)){if(i!==void 0&&za(i))throw new Error("The internal list is malformed.");const o=i===void 0?r.insertTime:$s(i)?i.startTime+i.duration:br(i),A=i===void 0?this._defaultValue:$s(i)?i.values[i.values.length-1]:i.value,a=co(r)?Am(e,o,A,r):am(e,o,A,r),l=co(r)?rm(a,e,this._currenTime):im(a,e,this._currenTime);this._automationEvents.push(l)}if(i!==void 0&&za(i)&&this._automationEvents.push(zd(this.getValue(e),e)),i!==void 0&&$s(i)&&i.startTime+i.duration>e){const o=e-i.startTime,A=(i.values.length-1)/i.duration,a=Math.max(2,1+Math.ceil(o*A)),l=o/(a-1)*A,c=i.values.slice(0,a);if(l<1)for(let u=1;u<a;u+=1){const d=l*u%1;c[u]=i.values[u-1]*(1-d)+i.values[u]*d}this._automationEvents[this._automationEvents.length-1]=gv(c,i.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>br(o)>e),r=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(r!==void 0&&$s(r)&&br(r)+r.duration>e)return!1;const i=co(t)?rm(t.value,t.endTime,this._currenTime):cc(t)?im(t.value,e,this._currenTime):t;if(s===-1)this._automationEvents.push(i);else{if($s(t)&&e+t.duration>br(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,i)}}return!0}flush(t){const e=this._automationEvents.findIndex(s=>br(s)>t);if(e>1){const s=this._automationEvents.slice(e-1),r=s[0];za(r)&&s.unshift(zd(uc(this._automationEvents,e-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=s}}getValue(t){if(this._automationEvents.length===0)return this._defaultValue;const e=this._automationEvents.findIndex(o=>br(o)>t),s=this._automationEvents[e],r=(e===-1?this._automationEvents.length:e)-1,i=this._automationEvents[r];if(i!==void 0&&za(i)&&(s===void 0||!Ir(s)||s.insertTime>t))return vv(t,uc(this._automationEvents,r-1,i.startTime,this._defaultValue),i);if(i!==void 0&&Bf(i)&&(s===void 0||!Ir(s)))return i.value;if(i!==void 0&&$s(i)&&(s===void 0||!Ir(s)||i.startTime+i.duration>t))return t<i.startTime+i.duration?Zb(t,i):i.values[i.values.length-1];if(i!==void 0&&Ir(i)&&(s===void 0||!Ir(s)))return i.value;if(s!==void 0&&co(s)){const[o,A]=om(this._automationEvents,r,i,s,this._defaultValue);return Am(t,o,A,s)}if(s!==void 0&&cc(s)){const[o,A]=om(this._automationEvents,r,i,s,this._defaultValue);return am(t,o,A,s)}return this._defaultValue}}const ey=n=>({cancelTime:n,type:"cancelAndHold"}),ny=n=>({cancelTime:n,type:"cancelScheduledValues"}),sy=(n,t)=>({endTime:t,type:"exponentialRampToValue",value:n}),ry=(n,t)=>({endTime:t,type:"linearRampToValue",value:n}),iy=(n,t,e)=>({startTime:t,target:n,timeConstant:e,type:"setTarget"}),oy=()=>new DOMException("","AbortError"),Ay=n=>(t,e,[s,r,i],o)=>{n(t[r],[e,s,i],A=>A[0]===e&&A[1]===s,o)},ay=n=>(t,e,s)=>{const r=[];for(let i=0;i<s.numberOfInputs;i+=1)r.push(new Set);n.set(t,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:e})},ly=n=>(t,e)=>{n.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})},Ro=new WeakSet,wv=new WeakMap,Cf=new WeakMap,Bv=new WeakMap,bf=new WeakMap,nu=new WeakMap,Cv=new WeakMap,Yd=new WeakMap,jd=new WeakMap,Jd=new WeakMap,bv={construct(){return bv}},cy=n=>{try{const t=new Proxy(n,bv);new t}catch{return!1}return!0},lm=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,cm=(n,t)=>{const e=[];let s=n.replace(/^[\s]+/,""),r=s.match(lm);for(;r!==null;){const i=r[1].slice(1,-1),o=r[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,t).toString());e.push(o),s=s.slice(r[0].length).replace(/^[\s]+/,""),r=s.match(lm)}return[e.join(";"),s]},um=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},dm=n=>{if(!cy(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},uy=(n,t,e,s,r,i,o,A,a,l,c,u,d)=>{let p=0;return(h,m,g={credentials:"omit"})=>{const v=c.get(h);if(v!==void 0&&v.has(m))return Promise.resolve();const w=l.get(h);if(w!==void 0){const B=w.get(m);if(B!==void 0)return B}const y=i(h),I=y.audioWorklet===void 0?r(m).then(([B,C])=>{const[b,S]=cm(B,C),T=`${b};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${S}
})})(window,'_AWGS')`;return e(T)}).then(()=>{const B=d._AWGS.pop();if(B===void 0)throw new SyntaxError;s(y.currentTime,y.sampleRate,()=>B(class{},void 0,(C,b)=>{if(C.trim()==="")throw t();const S=jd.get(y);if(S!==void 0){if(S.has(C))throw t();dm(b),um(b.parameterDescriptors),S.set(C,b)}else dm(b),um(b.parameterDescriptors),jd.set(y,new Map([[C,b]]))},y.sampleRate,void 0,void 0))}):Promise.all([r(m),Promise.resolve(n(u,u))]).then(([[B,C],b])=>{const S=p+1;p=S;const[T,x]=cm(B,C),U=`${T};((AudioWorkletProcessor,registerProcessor)=>{${x}
})(${b?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${b?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${b?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${S}',class extends AudioWorkletProcessor{process(){return !1}})`,W=new Blob([U],{type:"application/javascript; charset=utf-8"}),L=URL.createObjectURL(W);return y.audioWorklet.addModule(L,g).then(()=>{if(A(y))return y;const R=o(y);return R.audioWorklet.addModule(L,g).then(()=>R)}).then(R=>{if(a===null)throw new SyntaxError;try{new a(R,`__sac${S}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(L))});return w===void 0?l.set(h,new Map([[m,I]])):w.set(m,I),I.then(()=>{const B=c.get(h);B===void 0?c.set(h,new Set([m])):B.add(m)}).finally(()=>{const B=l.get(h);B!==void 0&&B.delete(m)}),I}},as=(n,t)=>{const e=n.get(t);if(e===void 0)throw new Error("A value with the given key could not be found.");return e},su=(n,t)=>{const e=Array.from(n).filter(t);if(e.length>1)throw Error("More than one element was found.");if(e.length===0)throw Error("No element was found.");const[s]=e;return n.delete(s),s},yv=(n,t,e,s)=>{const r=as(n,t),i=su(r,o=>o[0]===e&&o[1]===s);return r.size===0&&n.delete(t),i},Ea=n=>as(Cv,n),Ho=n=>{if(Ro.has(n))throw new Error("The AudioNode is already stored.");Ro.add(n),Ea(n).forEach(t=>t(!0))},Sv=n=>"port"in n,xa=n=>{if(!Ro.has(n))throw new Error("The AudioNode is not stored.");Ro.delete(n),Ea(n).forEach(t=>t(!1))},Zd=(n,t)=>{!Sv(n)&&t.every(e=>e.size===0)&&xa(n)},dy=(n,t,e,s,r,i,o,A,a,l,c,u,d)=>{const p=new WeakMap;return(h,m,g,v,w)=>{const{activeInputs:y,passiveInputs:I}=i(m),{outputs:B}=i(h),C=A(h),b=S=>{const T=a(m),x=a(h);if(S){const _=yv(I,h,g,v);n(y,h,_,!1),!w&&!u(h)&&e(x,T,g,v),d(m)&&Ho(m)}else{const _=s(y,h,g,v);t(I,v,_,!1),!w&&!u(h)&&r(x,T,g,v);const F=o(m);if(F===0)c(m)&&Zd(m,y);else{const Q=p.get(m);Q!==void 0&&clearTimeout(Q),p.set(m,setTimeout(()=>{c(m)&&Zd(m,y)},F*1e3))}}};return l(B,[m,g,v],S=>S[0]===m&&S[1]===g&&S[2]===v,!0)?(C.add(b),c(h)?n(y,h,[g,v,b],!0):t(I,v,[h,g,b],!0),!0):!1}},hy=n=>(t,e,[s,r,i],o)=>{const A=t.get(s);A===void 0?t.set(s,new Set([[r,e,i]])):n(A,[r,e,i],a=>a[0]===r&&a[1]===e,o)},fy=n=>(t,e)=>{const s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(s).connect(t.destination);const r=()=>{e.removeEventListener("ended",r),e.disconnect(s),s.disconnect()};e.addEventListener("ended",r)},py=n=>(t,e)=>{n(t).add(e)},my={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},gy=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=r(A),c={...my,...a},u=s(l,c),d=i(l)?t():null;super(A,!1,u,d),this._nativeAnalyserNode=u}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(A){this._nativeAnalyserNode.fftSize=A}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(A){const a=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=A,!(A>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=a,e()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(A){const a=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=A,!(this._nativeAnalyserNode.maxDecibels>A))throw this._nativeAnalyserNode.minDecibels=a,e()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(A){this._nativeAnalyserNode.smoothingTimeConstant=A}getByteFrequencyData(A){this._nativeAnalyserNode.getByteFrequencyData(A)}getByteTimeDomainData(A){this._nativeAnalyserNode.getByteTimeDomainData(A)}getFloatFrequencyData(A){this._nativeAnalyserNode.getFloatFrequencyData(A)}getFloatTimeDomainData(A){this._nativeAnalyserNode.getFloatTimeDomainData(A)}},je=(n,t)=>n.context===t,vy=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,fftSize:A.fftSize,maxDecibels:A.maxDecibels,minDecibels:A.minDecibels,smoothingTimeConstant:A.smoothingTimeConstant};A=n(o,l)}return s.set(o,A),await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},dc=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Ns=()=>new DOMException("","IndexSizeError"),yf=n=>{n.getChannelData=(t=>e=>{try{return t.call(n,e)}catch(s){throw s.code===12?Ns():s}})(n.getChannelData)},wy={numberOfChannels:1},By=(n,t,e,s,r,i,o,A)=>{let a=null;return class Ev{constructor(c){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:d,sampleRate:p}={...wy,...c};a===null&&(a=new r(1,1,44100));const h=s!==null&&t(i,i)?new s({length:u,numberOfChannels:d,sampleRate:p}):a.createBuffer(d,u,p);if(h.numberOfChannels===0)throw e();return typeof h.copyFromChannel!="function"?(o(h),yf(h)):t(dc,()=>dc(h))||A(h),n.add(h),h}static[Symbol.hasInstance](c){return c!==null&&typeof c=="object"&&Object.getPrototypeOf(c)===Ev.prototype||n.has(c)}}},cn=-34028234663852886e22,nn=-cn,ir=n=>Ro.has(n),Cy={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},by=(n,t,e,s,r,i,o,A)=>class extends n{constructor(l,c){const u=i(l),d={...Cy,...c},p=r(u,d),h=o(u),m=h?t():null;super(l,!1,p,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=p,this._onended=null,this._playbackRate=e(this,h,p.playbackRate,nn,cn)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const c=typeof l=="function"?A(this,l):null;this._nativeAudioBufferSourceNode.onended=c;const u=this._nativeAudioBufferSourceNode.onended;this._onended=u!==null&&u===c?l:u}get playbackRate(){return this._playbackRate}start(l=0,c=0,u){if(this._nativeAudioBufferSourceNode.start(l,c,u),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=u===void 0?[l,c]:[l,c,u]),this.context.state!=="closed"){Ho(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),ir(this)&&xa(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},yy=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,A=null;const a=async(l,c)=>{let u=e(l);const d=je(u,c);if(!d){const p={buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,loop:u.loop,loopEnd:u.loopEnd,loopStart:u.loopStart,playbackRate:u.playbackRate.value};u=t(c,p),o!==null&&u.start(...o),A!==null&&u.stop(A)}return i.set(c,u),d?await n(c,l.playbackRate,u.playbackRate):await s(c,l.playbackRate,u.playbackRate),await r(l,c,u),u};return{set start(l){o=l},set stop(l){A=l},render(l,c){const u=i.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},Sy=n=>"playbackRate"in n,Ey=n=>"frequency"in n&&"gain"in n,xy=n=>"offset"in n,Iy=n=>!("frequency"in n)&&"gain"in n,Fy=n=>"detune"in n&&"frequency"in n&&!("gain"in n),Ty=n=>"pan"in n,sn=n=>as(wv,n),Ia=n=>as(Bv,n),th=(n,t)=>{const{activeInputs:e}=sn(n);e.forEach(r=>r.forEach(([i])=>{t.includes(n)||th(i,[...t,n])}));const s=Sy(n)?[n.playbackRate]:Sv(n)?Array.from(n.parameters.values()):Ey(n)?[n.Q,n.detune,n.frequency,n.gain]:xy(n)?[n.offset]:Iy(n)?[n.gain]:Fy(n)?[n.detune,n.frequency]:Ty(n)?[n.pan]:[];for(const r of s){const i=Ia(r);i!==void 0&&i.activeInputs.forEach(([o])=>th(o,t))}ir(n)&&xa(n)},xv=n=>{th(n.destination,[])},_y=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),My=(n,t,e,s,r,i,o,A,a)=>class extends n{constructor(c={}){if(a===null)throw new Error("Missing the native AudioContext constructor.");let u;try{u=new a(c)}catch(h){throw h.code===12&&h.message==="sampleRate is not in range"?e():h}if(u===null)throw s();if(!_y(c.latencyHint))throw new TypeError(`The provided value '${c.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(c.sampleRate!==void 0&&u.sampleRate!==c.sampleRate)throw e();super(u,2);const{latencyHint:d}=c,{sampleRate:p}=u;if(this._baseLatency=typeof u.baseLatency=="number"?u.baseLatency:d==="balanced"?512/p:d==="interactive"||d===void 0?256/p:d==="playback"?1024/p:Math.max(2,Math.min(128,Math.round(d*p/128)))*128/p,this._nativeAudioContext=u,a.name==="webkitAudioContext"?(this._nativeGainNode=u.createGain(),this._nativeOscillatorNode=u.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(u.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,u.state==="running"){this._state="suspended";const h=()=>{this._state==="suspended"&&(this._state=null),u.removeEventListener("statechange",h)};u.addEventListener("statechange",h)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),xv(this)}))}createMediaElementSource(c){return new r(this,{mediaElement:c})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(c){return new o(this,{mediaStream:c})}createMediaStreamTrackSource(c){return new A(this,{mediaStreamTrack:c})}resume(){return this._state==="suspended"?new Promise((c,u)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?c():this.resume().then(c,u)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(c=>{throw c===void 0||c.code===15?t():c})}suspend(){return this._nativeAudioContext.suspend().catch(c=>{throw c===void 0?t():c})}},Qy=(n,t,e,s,r,i,o,A)=>class extends n{constructor(l,c){const u=i(l),d=o(u),p=r(u,c,d),h=d?t(A):null;super(l,!1,p,h),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=p}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw e();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},Uy=n=>{const t=new WeakMap,e=async(s,r)=>{const i=r.destination;return t.set(r,i),await n(s,r,i),i};return{render(s,r){const i=t.get(r);return i!==void 0?Promise.resolve(i):e(s,r)}}},Py=(n,t,e,s,r,i,o,A)=>(a,l)=>{const c=l.listener,u=()=>{const B=new Float32Array(1),C=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),b=o(l);let S=!1,T=[0,0,-1,0,1,0],x=[0,0,0];const _=()=>{if(S)return;S=!0;const W=s(l,256,9,0);W.onaudioprocess=({inputBuffer:L})=>{const R=[i(L,B,0),i(L,B,1),i(L,B,2),i(L,B,3),i(L,B,4),i(L,B,5)];R.some((q,J)=>q!==T[J])&&(c.setOrientation(...R),T=R);const N=[i(L,B,6),i(L,B,7),i(L,B,8)];N.some((q,J)=>q!==x[J])&&(c.setPosition(...N),x=N)},C.connect(W)},F=W=>L=>{L!==T[W]&&(T[W]=L,c.setOrientation(...T))},Q=W=>L=>{L!==x[W]&&(x[W]=L,c.setPosition(...x))},U=(W,L,R)=>{const N=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:L});N.connect(C,0,W),N.start(),Object.defineProperty(N.offset,"defaultValue",{get(){return L}});const q=n({context:a},b,N.offset,nn,cn);return A(q,"value",J=>()=>J.call(q),J=>nt=>{try{J.call(q,nt)}catch(At){if(At.code!==9)throw At}_(),b&&R(nt)}),q.cancelAndHoldAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.cancelAndHoldAtTime),q.cancelScheduledValues=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.cancelScheduledValues),q.exponentialRampToValueAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.exponentialRampToValueAtTime),q.linearRampToValueAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.linearRampToValueAtTime),q.setTargetAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.setTargetAtTime),q.setValueAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.setValueAtTime),q.setValueCurveAtTime=(J=>b?()=>{throw r()}:(...nt)=>{const At=J.apply(q,nt);return _(),At})(q.setValueCurveAtTime),q};return{forwardX:U(0,0,F(0)),forwardY:U(1,0,F(1)),forwardZ:U(2,-1,F(2)),positionX:U(6,0,Q(0)),positionY:U(7,0,Q(1)),positionZ:U(8,0,Q(2)),upX:U(3,0,F(3)),upY:U(4,1,F(4)),upZ:U(5,0,F(5))}},{forwardX:d,forwardY:p,forwardZ:h,positionX:m,positionY:g,positionZ:v,upX:w,upY:y,upZ:I}=c.forwardX===void 0?u():c;return{get forwardX(){return d},get forwardY(){return p},get forwardZ(){return h},get positionX(){return m},get positionY(){return g},get positionZ(){return v},get upX(){return w},get upY(){return y},get upZ(){return I}}},hc=n=>"context"in n,Fa=n=>hc(n[0]),Gi=(n,t,e,s)=>{for(const r of n)if(e(r)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(t),!0},hm=(n,t,[e,s],r)=>{Gi(n,[t,e,s],i=>i[0]===t&&i[1]===e,r)},fm=(n,[t,e,s],r)=>{const i=n.get(t);i===void 0?n.set(t,new Set([[e,s]])):Gi(i,[e,s],o=>o[0]===e,r)},Zo=n=>"inputs"in n,fc=(n,t,e,s)=>{if(Zo(t)){const r=t.inputs[s];return n.connect(r,e,0),[r,e,0]}return n.connect(t,e,s),[t,e,s]},Iv=(n,t,e)=>{for(const s of n)if(s[0]===t&&s[1]===e)return n.delete(s),s;return null},Ny=(n,t,e)=>su(n,s=>s[0]===t&&s[1]===e),Fv=(n,t)=>{if(!Ea(n).delete(t))throw new Error("Missing the expected event listener.")},Tv=(n,t,e)=>{const s=as(n,t),r=su(s,i=>i[0]===e);return s.size===0&&n.delete(t),r},pc=(n,t,e,s)=>{Zo(t)?n.disconnect(t.inputs[s],e,0):n.disconnect(t,e,s)},Zt=n=>as(Cf,n),YA=n=>as(bf,n),Pi=n=>Yd.has(n),Vl=n=>!Ro.has(n),pm=(n,t)=>new Promise(e=>{if(t!==null)e(!0);else{const s=n.createScriptProcessor(256,1,1),r=n.createGain(),i=n.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const A=n.createBufferSource();A.buffer=i,A.loop=!0,A.connect(s).connect(n.destination),A.connect(r),A.disconnect(r),s.onaudioprocess=a=>{const l=a.inputBuffer.getChannelData(0);Array.prototype.some.call(l,c=>c===1)?e(!0):e(!1),A.stop(),s.onaudioprocess=null,A.disconnect(s),s.disconnect(n.destination)},A.start()}}),Yu=(n,t)=>{const e=new Map;for(const s of n)for(const r of s){const i=e.get(r);e.set(r,i===void 0?1:i+1)}e.forEach((s,r)=>t(r,s))},mc=n=>"context"in n,Ly=n=>{const t=new Map;n.connect=(e=>(s,r=0,i=0)=>{const o=mc(s)?e(s,r,i):e(s,r),A=t.get(s);return A===void 0?t.set(s,[{input:i,output:r}]):A.every(a=>a.input!==i||a.output!==r)&&A.push({input:i,output:r}),o})(n.connect.bind(n)),n.disconnect=(e=>(s,r,i)=>{if(e.apply(n),s===void 0)t.clear();else if(typeof s=="number")for(const[o,A]of t){const a=A.filter(l=>l.output!==s);a.length===0?t.delete(o):t.set(o,a)}else if(t.has(s))if(r===void 0)t.delete(s);else{const o=t.get(s);if(o!==void 0){const A=o.filter(a=>a.output!==r&&(a.input!==i||i===void 0));A.length===0?t.delete(s):t.set(s,A)}}for(const[o,A]of t)A.forEach(a=>{mc(o)?n.connect(o,a.output,a.input):n.connect(o,a.output)})})(n.disconnect)},Dy=(n,t,e,s)=>{const{activeInputs:r,passiveInputs:i}=Ia(t),{outputs:o}=sn(n),A=Ea(n),a=l=>{const c=Zt(n),u=YA(t);if(l){const d=Tv(i,n,e);hm(r,n,d,!1),!s&&!Pi(n)&&c.connect(u,e)}else{const d=Ny(r,n,e);fm(i,d,!1),!s&&!Pi(n)&&c.disconnect(u,e)}};return Gi(o,[t,e],l=>l[0]===t&&l[1]===e,!0)?(A.add(a),ir(n)?hm(r,n,[e,a],!0):fm(i,[n,e,a],!0),!0):!1},ky=(n,t,e,s)=>{const{activeInputs:r,passiveInputs:i}=sn(t),o=Iv(r[s],n,e);return o===null?[yv(i,n,e,s)[2],!1]:[o[2],!0]},Ry=(n,t,e)=>{const{activeInputs:s,passiveInputs:r}=Ia(t),i=Iv(s,n,e);return i===null?[Tv(r,n,e)[1],!1]:[i[2],!0]},Sf=(n,t,e,s,r)=>{const[i,o]=ky(n,e,s,r);if(i!==null&&(Fv(n,i),o&&!t&&!Pi(n)&&pc(Zt(n),Zt(e),s,r)),ir(e)){const{activeInputs:A}=sn(e);Zd(e,A)}},Ef=(n,t,e,s)=>{const[r,i]=Ry(n,e,s);r!==null&&(Fv(n,r),i&&!t&&!Pi(n)&&Zt(n).disconnect(YA(e),s))},Hy=(n,t)=>{const e=sn(n),s=[];for(const r of e.outputs)Fa(r)?Sf(n,t,...r):Ef(n,t,...r),s.push(r[0]);return e.outputs.clear(),s},Oy=(n,t,e)=>{const s=sn(n),r=[];for(const i of s.outputs)i[1]===e&&(Fa(i)?Sf(n,t,...i):Ef(n,t,...i),r.push(i[0]),s.outputs.delete(i));return r},Vy=(n,t,e,s,r)=>{const i=sn(n);return Array.from(i.outputs).filter(o=>o[0]===e&&(s===void 0||o[1]===s)&&(r===void 0||o[2]===r)).map(o=>(Fa(o)?Sf(n,t,...o):Ef(n,t,...o),i.outputs.delete(o),o[0]))},Wy=(n,t,e,s,r,i,o,A,a,l,c,u,d,p,h,m)=>class extends l{constructor(v,w,y,I){super(y),this._context=v,this._nativeAudioNode=y;const B=c(v);u(B)&&e(pm,()=>pm(B,m))!==!0&&Ly(y),Cf.set(this,y),Cv.set(this,new Set),v.state!=="closed"&&w&&Ho(this),n(this,I,y)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,w=0,y=0){if(w<0||w>=this._nativeAudioNode.numberOfOutputs)throw r();const I=c(this._context),B=h(I);if(d(v)||p(v))throw i();if(hc(v)){const S=Zt(v);try{const x=fc(this._nativeAudioNode,S,w,y),_=Vl(this);(B||_)&&this._nativeAudioNode.disconnect(...x),this.context.state!=="closed"&&!_&&Vl(v)&&Ho(v)}catch(x){throw x.code===12?i():x}if(t(this,v,w,y,B)){const x=a([this],v);Yu(x,s(B))}return v}const C=YA(v);if(C.name==="playbackRate"&&C.maxValue===1024)throw o();try{this._nativeAudioNode.connect(C,w),(B||Vl(this))&&this._nativeAudioNode.disconnect(C,w)}catch(S){throw S.code===12?i():S}if(Dy(this,v,w,B)){const S=a([this],v);Yu(S,s(B))}}disconnect(v,w,y){let I;const B=c(this._context),C=h(B);if(v===void 0)I=Hy(this,C);else if(typeof v=="number"){if(v<0||v>=this.numberOfOutputs)throw r();I=Oy(this,C,v)}else{if(w!==void 0&&(w<0||w>=this.numberOfOutputs)||hc(v)&&y!==void 0&&(y<0||y>=v.numberOfInputs))throw r();if(I=Vy(this,C,v,w,y),I.length===0)throw i()}for(const b of I){const S=a([this],b);Yu(S,A)}}},Gy=(n,t,e,s,r,i,o,A,a,l,c,u,d)=>(p,h,m,g=null,v=null)=>{const w=m.value,y=new ty(w),I=h?s(y):null,B={get defaultValue(){return w},get maxValue(){return g===null?m.maxValue:g},get minValue(){return v===null?m.minValue:v},get value(){return m.value},set value(C){m.value=C,B.setValueAtTime(C,p.context.currentTime)},cancelAndHoldAtTime(C){if(typeof m.cancelAndHoldAtTime=="function")I===null&&y.flush(p.context.currentTime),y.add(r(C)),m.cancelAndHoldAtTime(C);else{const b=Array.from(y).pop();I===null&&y.flush(p.context.currentTime),y.add(r(C));const S=Array.from(y).pop();m.cancelScheduledValues(C),b!==S&&S!==void 0&&(S.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(S.value,S.endTime):S.type==="linearRampToValue"?m.linearRampToValueAtTime(S.value,S.endTime):S.type==="setValue"?m.setValueAtTime(S.value,S.startTime):S.type==="setValueCurve"&&m.setValueCurveAtTime(S.values,S.startTime,S.duration))}return B},cancelScheduledValues(C){return I===null&&y.flush(p.context.currentTime),y.add(i(C)),m.cancelScheduledValues(C),B},exponentialRampToValueAtTime(C,b){if(C===0)throw new RangeError;if(!Number.isFinite(b)||b<0)throw new RangeError;const S=p.context.currentTime;return I===null&&y.flush(S),Array.from(y).length===0&&(y.add(l(w,S)),m.setValueAtTime(w,S)),y.add(o(C,b)),m.exponentialRampToValueAtTime(C,b),B},linearRampToValueAtTime(C,b){const S=p.context.currentTime;return I===null&&y.flush(S),Array.from(y).length===0&&(y.add(l(w,S)),m.setValueAtTime(w,S)),y.add(A(C,b)),m.linearRampToValueAtTime(C,b),B},setTargetAtTime(C,b,S){return I===null&&y.flush(p.context.currentTime),y.add(a(C,b,S)),m.setTargetAtTime(C,b,S),B},setValueAtTime(C,b){return I===null&&y.flush(p.context.currentTime),y.add(l(C,b)),m.setValueAtTime(C,b),B},setValueCurveAtTime(C,b,S){const T=C instanceof Float32Array?C:new Float32Array(C);if(u!==null&&u.name==="webkitAudioContext"){const x=b+S,_=p.context.sampleRate,F=Math.ceil(b*_),Q=Math.floor(x*_),U=Q-F,W=new Float32Array(U);for(let R=0;R<U;R+=1){const N=(T.length-1)/S*((F+R)/_-b),q=Math.floor(N),J=Math.ceil(N);W[R]=q===J?T[q]:(1-(N-q))*T[q]+(1-(J-N))*T[J]}I===null&&y.flush(p.context.currentTime),y.add(c(W,b,S)),m.setValueCurveAtTime(W,b,S);const L=Q/_;L<x&&d(B,W[W.length-1],L),d(B,T[T.length-1],x)}else I===null&&y.flush(p.context.currentTime),y.add(c(T,b,S)),m.setValueCurveAtTime(T,b,S);return B}};return e.set(B,m),t.set(B,p),n(B,I),B},Ky=n=>({replay(t){for(const e of n)if(e.type==="exponentialRampToValue"){const{endTime:s,value:r}=e;t.exponentialRampToValueAtTime(r,s)}else if(e.type==="linearRampToValue"){const{endTime:s,value:r}=e;t.linearRampToValueAtTime(r,s)}else if(e.type==="setTarget"){const{startTime:s,target:r,timeConstant:i}=e;t.setTargetAtTime(r,s,i)}else if(e.type==="setValue"){const{startTime:s,value:r}=e;t.setValueAtTime(r,s)}else if(e.type==="setValueCurve"){const{duration:s,startTime:r,values:i}=e;t.setValueCurveAtTime(i,r,s)}else throw new Error("Can't apply an unknown automation.")}});class _v{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach((s,r)=>t.call(e,s,r,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const qy={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},zy=(n,t,e,s,r,i,o,A,a,l,c,u,d,p)=>class extends t{constructor(m,g,v){var w;const y=A(m),I=a(y),B=c({...qy,...v});d(B);const C=jd.get(y),b=C==null?void 0:C.get(g),S=I||y.state!=="closed"?y:(w=o(y))!==null&&w!==void 0?w:y,T=r(S,I?null:m.baseLatency,l,g,b,B),x=I?s(g,B,b):null;super(m,!0,T,x);const _=[];T.parameters.forEach((Q,U)=>{const W=e(this,I,Q);_.push([U,W])}),this._nativeAudioWorkletNode=T,this._onprocessorerror=null,this._parameters=new _v(_),I&&n(y,this);const{activeInputs:F}=i(this);u(T,F)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const g=typeof m=="function"?p(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=g;const v=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=v!==null&&v===g?m:v}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function gc(n,t,e,s,r){if(typeof n.copyFromChannel=="function")t[e].byteLength===0&&(t[e]=new Float32Array(128)),n.copyFromChannel(t[e],s,r);else{const i=n.getChannelData(s);if(t[e].byteLength===0)t[e]=i.slice(r,r+128);else{const o=new Float32Array(i.buffer,r*Float32Array.BYTES_PER_ELEMENT,128);t[e].set(o)}}}const Mv=(n,t,e,s,r)=>{typeof n.copyToChannel=="function"?t[e].byteLength!==0&&n.copyToChannel(t[e],s,r):t[e].byteLength!==0&&n.getChannelData(s).set(t[e],r)},vc=(n,t)=>{const e=[];for(let s=0;s<n;s+=1){const r=[],i=typeof t=="number"?t:t[s];for(let o=0;o<i;o+=1)r.push(new Float32Array(128));e.push(r)}return e},$y=(n,t)=>{const e=as(Jd,n),s=Zt(t);return as(e,s)},Xy=async(n,t,e,s,r,i,o)=>{const A=t===null?Math.ceil(n.context.length/128)*128:t.length,a=s.channelCount*s.numberOfInputs,l=r.reduce((g,v)=>g+v,0),c=l===0?null:e.createBuffer(l,A,e.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const u=sn(n),d=await $y(e,n),p=vc(s.numberOfInputs,s.channelCount),h=vc(s.numberOfOutputs,r),m=Array.from(n.parameters.keys()).reduce((g,v)=>({...g,[v]:new Float32Array(128)}),{});for(let g=0;g<A;g+=128){if(s.numberOfInputs>0&&t!==null)for(let v=0;v<s.numberOfInputs;v+=1)for(let w=0;w<s.channelCount;w+=1)gc(t,p[v],w,w,g);i.parameterDescriptors!==void 0&&t!==null&&i.parameterDescriptors.forEach(({name:v},w)=>{gc(t,m,v,a+w,g)});for(let v=0;v<s.numberOfInputs;v+=1)for(let w=0;w<r[v];w+=1)h[v][w].byteLength===0&&(h[v][w]=new Float32Array(128));try{const v=p.map((y,I)=>u.activeInputs[I].size===0?[]:y),w=o(g/e.sampleRate,e.sampleRate,()=>d.process(v,h,m));if(c!==null)for(let y=0,I=0;y<s.numberOfOutputs;y+=1){for(let B=0;B<r[y];B+=1)Mv(c,h[y],B,I+B,g);I+=r[y]}if(!w)break}catch(v){n.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return c},Yy=(n,t,e,s,r,i,o,A,a,l,c,u,d,p,h,m)=>(g,v,w)=>{const y=new WeakMap;let I=null;const B=async(C,b)=>{let S=c(C),T=null;const x=je(S,b),_=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(u===null){const F=_.reduce((L,R)=>L+R,0),Q=r(b,{channelCount:Math.max(1,F),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,F)}),U=[];for(let L=0;L<C.numberOfOutputs;L+=1)U.push(s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[L]}));const W=o(b,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});W.connect=t.bind(null,U),W.disconnect=a.bind(null,U),T=[Q,U,W]}else x||(S=new u(b,g));if(y.set(b,T===null?S:T[2]),T!==null){if(I===null){if(w===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const R=C.channelCount*C.numberOfInputs,N=w.parameterDescriptors===void 0?0:w.parameterDescriptors.length,q=R+N;I=Xy(C,q===0?null:await(async()=>{const nt=new d(q,Math.ceil(C.context.length/128)*128,b.sampleRate),At=[],ot=[];for(let G=0;G<v.numberOfInputs;G+=1)At.push(o(nt,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),ot.push(r(nt,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const V=await Promise.all(Array.from(C.parameters.values()).map(async G=>{const Y=i(nt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:G.value});return await p(nt,G,Y.offset),Y})),H=s(nt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,R+N)});for(let G=0;G<v.numberOfInputs;G+=1){At[G].connect(ot[G]);for(let Y=0;Y<v.channelCount;Y+=1)ot[G].connect(H,Y,G*v.channelCount+Y)}for(const[G,Y]of V.entries())Y.connect(H,0,R+G),Y.start(0);return H.connect(nt.destination),await Promise.all(At.map(G=>h(C,nt,G))),m(nt)})(),b,v,_,w,l)}const F=await I,Q=e(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[U,W,L]=T;F!==null&&(Q.buffer=F,Q.start(0)),Q.connect(U);for(let R=0,N=0;R<C.numberOfOutputs;R+=1){const q=W[R];for(let J=0;J<_[R];J+=1)U.connect(q,N+J,J);N+=_[R]}return L}if(x)for(const[F,Q]of C.parameters.entries())await n(b,Q,S.parameters.get(F));else for(const[F,Q]of C.parameters.entries())await p(b,Q,S.parameters.get(F));return await h(C,b,S),S};return{render(C,b){A(b,C);const S=y.get(b);return S!==void 0?Promise.resolve(S):B(C,b)}}},jy=(n,t,e,s,r,i,o,A,a,l,c,u,d,p,h,m,g,v,w,y)=>class extends h{constructor(B,C){super(B,C),this._nativeContext=B,this._audioWorklet=n===void 0?void 0:{addModule:(b,S)=>n(this,b,S)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new r(this)}createBuffer(B,C,b){return new e({length:C,numberOfChannels:B,sampleRate:b})}createBufferSource(){return new s(this)}createChannelMerger(B=6){return new i(this,{numberOfInputs:B})}createChannelSplitter(B=6){return new o(this,{numberOfOutputs:B})}createConstantSource(){return new A(this)}createConvolver(){return new a(this)}createDelay(B=1){return new c(this,{maxDelayTime:B})}createDynamicsCompressor(){return new u(this)}createGain(){return new d(this)}createIIRFilter(B,C){return new p(this,{feedback:C,feedforward:B})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(B,C,b={disableNormalization:!1}){return new v(this,{...b,imag:C,real:B})}createStereoPanner(){return new w(this)}createWaveShaper(){return new y(this)}decodeAudioData(B,C,b){return l(this._nativeContext,B).then(S=>(typeof C=="function"&&C(S),S),S=>{throw typeof b=="function"&&b(S),S})}},Jy={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Zy=(n,t,e,s,r,i,o,A)=>class extends n{constructor(l,c){const u=i(l),d={...Jy,...c},p=r(u,d),h=o(u),m=h?e():null;super(l,!1,p,m),this._Q=t(this,h,p.Q,nn,cn),this._detune=t(this,h,p.detune,1200*Math.log2(nn),-1200*Math.log2(nn)),this._frequency=t(this,h,p.frequency,l.sampleRate/2,0),this._gain=t(this,h,p.gain,40*Math.log10(nn),cn),this._nativeBiquadFilterNode=p,A(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,c,u){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,c,u)}catch(d){throw d.code===11?s():d}if(l.length!==c.length||c.length!==u.length)throw s()}},t1=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(A,a)=>{let l=e(A);const c=je(l,a);if(!c){const u={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=t(a,u)}return i.set(a,l),c?(await n(a,A.Q,l.Q),await n(a,A.detune,l.detune),await n(a,A.frequency,l.frequency),await n(a,A.gain,l.gain)):(await s(a,A.Q,l.Q),await s(a,A.detune,l.detune),await s(a,A.frequency,l.frequency),await s(a,A.gain,l.gain)),await r(A,a,l),l};return{render(A,a){const l=i.get(a);return l!==void 0?Promise.resolve(l):o(A,a)}}},e1=(n,t)=>(e,s)=>{const r=t.get(e);if(r!==void 0)return r;const i=n.get(e);if(i!==void 0)return i;try{const o=s();return o instanceof Promise?(n.set(e,o),o.catch(()=>!1).then(A=>(n.delete(e),t.set(e,A),A))):(t.set(e,o),o)}catch{return t.set(e,!1),!1}},n1={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},s1=(n,t,e,s,r)=>class extends n{constructor(o,A){const a=s(o),l={...n1,...A},c=e(a,l),u=r(a)?t():null;super(o,!1,c,u)}},r1=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,numberOfInputs:A.numberOfInputs};A=n(o,l)}return s.set(o,A),await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},i1={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},o1=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=s(A),c=i({...i1,...a}),u=e(l,c),d=r(l)?t():null;super(A,!1,u,d)}},A1=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,numberOfOutputs:A.numberOfOutputs};A=n(o,l)}return s.set(o,A),await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},a1=n=>(t,e,s)=>n(e,t,s),l1=n=>(t,e,s=0,r=0)=>{const i=t[s];if(i===void 0)throw n();return mc(e)?i.connect(e,0,r):i.connect(e,0)},c1=n=>(t,e)=>{const s=n(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=t.createBuffer(1,2,44100);return s.buffer=r,s.loop=!0,s.connect(e),s.start(),()=>{s.stop(),s.disconnect(e)}},u1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},d1=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...u1,...l},d=s(c,u),p=i(c),h=p?e():null;super(a,!1,d,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=d,this._offset=t(this,p,d.offset,nn,cn),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(a){const l=typeof a=="function"?o(this,a):null;this._nativeConstantSourceNode.onended=l;const c=this._nativeConstantSourceNode.onended;this._onended=c!==null&&c===l?a:c}start(a=0){if(this._nativeConstantSourceNode.start(a),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=a),this.context.state!=="closed"){Ho(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),ir(this)&&xa(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(a=0){this._nativeConstantSourceNode.stop(a),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=a)}},h1=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,A=null;const a=async(l,c)=>{let u=e(l);const d=je(u,c);if(!d){const p={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,offset:u.offset.value};u=t(c,p),o!==null&&u.start(o),A!==null&&u.stop(A)}return i.set(c,u),d?await n(c,l.offset,u.offset):await s(c,l.offset,u.offset),await r(l,c,u),u};return{set start(l){o=l},set stop(l){A=l},render(l,c){const u=i.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},f1=n=>t=>(n[0]=t,n[0]),p1={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},m1=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=s(A),c={...p1,...a},u=e(l,c),p=r(l)?t():null;super(A,!1,u,p),this._isBufferNullified=!1,this._nativeConvolverNode=u,c.buffer!==null&&i(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(A){if(this._nativeConvolverNode.buffer=A,A===null&&this._nativeConvolverNode.buffer!==null){const a=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=a.createBuffer(1,1,a.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(A){this._nativeConvolverNode.normalize=A}},g1=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={buffer:A.buffer,channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,disableNormalization:!A.normalize};A=n(o,l)}return s.set(o,A),Zo(A)?await e(i,o,A.inputs[0]):await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},v1=(n,t)=>(e,s,r)=>{if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(e,s,r)}catch(i){throw i.name==="SyntaxError"?n():i}},w1=()=>new DOMException("","DataCloneError"),mm=n=>{const{port1:t,port2:e}=new MessageChannel;return new Promise(s=>{const r=()=>{e.onmessage=null,t.close(),e.close(),s()};e.onmessage=()=>r();try{t.postMessage(n,[n])}catch{}finally{r()}})},B1=(n,t,e,s,r,i,o,A,a,l,c)=>(u,d)=>{const p=o(u)?u:i(u);if(r.has(d)){const h=e();return Promise.reject(h)}try{r.add(d)}catch{}return t(a,()=>a(p))?p.decodeAudioData(d).then(h=>(mm(d).catch(()=>{}),t(A,()=>A(h))||c(h),n.add(h),h)):new Promise((h,m)=>{const g=async()=>{try{await mm(d)}catch{}},v=w=>{m(w),g()};try{p.decodeAudioData(d,w=>{typeof w.copyFromChannel!="function"&&(l(w),yf(w)),n.add(w),g().then(()=>h(w))},w=>{v(w===null?s():w)})}catch(w){v(w)}})},C1=(n,t,e,s,r,i,o,A)=>(a,l)=>{const c=t.get(a);if(c===void 0)throw new Error("Missing the expected cycle count.");const u=i(a.context),d=A(u);if(c===l){if(t.delete(a),!d&&o(a)){const p=s(a),{outputs:h}=e(a);for(const m of h)if(Fa(m)){const g=s(m[0]);n(p,g,m[1],m[2])}else{const g=r(m[0]);p.connect(g,m[1])}}}else t.set(a,c-l)},b1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},y1=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...b1,...l},d=s(c,u),p=i(c),h=p?e(u.maxDelayTime):null;super(a,!1,d,h),this._delayTime=t(this,p,d.delayTime),o(this,u.maxDelayTime)}get delayTime(){return this._delayTime}},S1=(n,t,e,s,r)=>i=>{const o=new WeakMap,A=async(a,l)=>{let c=e(a);const u=je(c,l);if(!u){const d={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,delayTime:c.delayTime.value,maxDelayTime:i};c=t(l,d)}return o.set(l,c),u?await n(l,a.delayTime,c.delayTime):await s(l,a.delayTime,c.delayTime),await r(a,l,c),c};return{render(a,l){const c=o.get(l);return c!==void 0?Promise.resolve(c):A(a,l)}}},E1=n=>(t,e,s,r)=>n(t[r],i=>i[0]===e&&i[1]===s),x1=n=>(t,e)=>{n(t).delete(e)},I1=n=>"delayTime"in n,F1=(n,t,e)=>function s(r,i){const o=hc(i)?i:e(n,i);if(I1(o))return[];if(r[0]===o)return[r];if(r.includes(o))return[];const{outputs:A}=t(o);return Array.from(A).map(a=>s([...r,o],a[0])).reduce((a,l)=>a.concat(l),[])},$a=(n,t,e)=>{const s=t[e];if(s===void 0)throw n();return s},T1=n=>(t,e=void 0,s=void 0,r=0)=>e===void 0?t.forEach(i=>i.disconnect()):typeof e=="number"?$a(n,t,e).disconnect():mc(e)?s===void 0?t.forEach(i=>i.disconnect(e)):r===void 0?$a(n,t,s).disconnect(e,0):$a(n,t,s).disconnect(e,0,r):s===void 0?t.forEach(i=>i.disconnect(e)):$a(n,t,s).disconnect(e,0),_1={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},M1=(n,t,e,s,r,i,o,A)=>class extends n{constructor(l,c){const u=i(l),d={..._1,...c},p=s(u,d),h=o(u),m=h?e():null;super(l,!1,p,m),this._attack=t(this,h,p.attack),this._knee=t(this,h,p.knee),this._nativeDynamicsCompressorNode=p,this._ratio=t(this,h,p.ratio),this._release=t(this,h,p.release),this._threshold=t(this,h,p.threshold),A(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const c=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=c,r()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const c=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=c,r()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},Q1=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(A,a)=>{let l=e(A);const c=je(l,a);if(!c){const u={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=t(a,u)}return i.set(a,l),c?(await n(a,A.attack,l.attack),await n(a,A.knee,l.knee),await n(a,A.ratio,l.ratio),await n(a,A.release,l.release),await n(a,A.threshold,l.threshold)):(await s(a,A.attack,l.attack),await s(a,A.knee,l.knee),await s(a,A.ratio,l.ratio),await s(a,A.release,l.release),await s(a,A.threshold,l.threshold)),await r(A,a,l),l};return{render(A,a){const l=i.get(a);return l!==void 0?Promise.resolve(l):o(A,a)}}},U1=()=>new DOMException("","EncodingError"),P1=n=>t=>new Promise((e,s)=>{if(n===null){s(new SyntaxError);return}const r=n.document.head;if(r===null)s(new SyntaxError);else{const i=n.document.createElement("script"),o=new Blob([t],{type:"application/javascript"}),A=URL.createObjectURL(o),a=n.onerror,l=()=>{n.onerror=a,URL.revokeObjectURL(A)};n.onerror=(c,u,d,p,h)=>{if(u===A||u===n.location.href&&d===1&&p===1)return l(),s(h),!1;if(a!==null)return a(c,u,d,p,h)},i.onerror=()=>{l(),s(new SyntaxError)},i.onload=()=>{l(),e()},i.src=A,i.type="module",r.appendChild(i)}}),N1=n=>class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(e,s,r){if(s!==null){let i=this._listeners.get(s);i===void 0&&(i=n(this,s),typeof s=="function"&&this._listeners.set(s,i)),this._nativeEventTarget.addEventListener(e,i,r)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,s,r){const i=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(e,i===void 0?null:i,r)}},L1=n=>(t,e,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(t*e)}},currentTime:{configurable:!0,get(){return t}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},D1=n=>async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw n()},k1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},R1=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=r(A),c={...k1,...a},u=s(l,c),d=i(l),p=d?e():null;super(A,!1,u,p),this._gain=t(this,d,u.gain,nn,cn)}get gain(){return this._gain}},H1=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(A,a)=>{let l=e(A);const c=je(l,a);if(!c){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=t(a,u)}return i.set(a,l),c?await n(a,A.gain,l.gain):await s(a,A.gain,l.gain),await r(A,a,l),l};return{render(A,a){const l=i.get(a);return l!==void 0?Promise.resolve(l):o(A,a)}}},O1=(n,t)=>e=>t(n,e),V1=n=>t=>{const e=n(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer},W1=n=>t=>{var e;return(e=n.get(t))!==null&&e!==void 0?e:0},G1=n=>t=>{const e=n(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return e.renderer},K1=n=>t=>n.get(t),_e=()=>new DOMException("","InvalidStateError"),q1=n=>t=>{const e=n.get(t);if(e===void 0)throw _e();return e},z1=(n,t)=>e=>{let s=n.get(e);if(s!==void 0)return s;if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new t(1,1,44100),n.set(e,s),s},$1=n=>t=>{const e=n.get(t);if(e===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return e},ru=()=>new DOMException("","InvalidAccessError"),X1=n=>{n.getFrequencyResponse=(t=>(e,s,r)=>{if(e.length!==s.length||s.length!==r.length)throw ru();return t.call(n,e,s,r)})(n.getFrequencyResponse)},Y1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},j1=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=s(A),c=r(l),u={...Y1,...a},d=t(l,c?null:A.baseLatency,u),p=c?e(u.feedback,u.feedforward):null;super(A,!1,d,p),X1(d),this._nativeIIRFilterNode=d,i(this,1)}getFrequencyResponse(A,a,l){return this._nativeIIRFilterNode.getFrequencyResponse(A,a,l)}},Qv=(n,t,e,s,r,i,o,A,a,l,c)=>{const u=l.length;let d=A;for(let p=0;p<u;p+=1){let h=e[0]*l[p];for(let m=1;m<r;m+=1){const g=d-m&a-1;h+=e[m]*i[g],h-=n[m]*o[g]}for(let m=r;m<s;m+=1)h+=e[m]*i[d-m&a-1];for(let m=r;m<t;m+=1)h-=n[m]*o[d-m&a-1];i[d]=l[p],o[d]=h,d=d+1&a-1,c[p]=h}return d},J1=(n,t,e,s)=>{const r=e instanceof Float64Array?e:new Float64Array(e),i=s instanceof Float64Array?s:new Float64Array(s),o=r.length,A=i.length,a=Math.min(o,A);if(r[0]!==1){for(let h=0;h<o;h+=1)i[h]/=r[0];for(let h=1;h<A;h+=1)r[h]/=r[0]}const l=32,c=new Float32Array(l),u=new Float32Array(l),d=t.createBuffer(n.numberOfChannels,n.length,n.sampleRate),p=n.numberOfChannels;for(let h=0;h<p;h+=1){const m=n.getChannelData(h),g=d.getChannelData(h);c.fill(0),u.fill(0),Qv(r,o,i,A,a,c,u,0,l,m,g)}return d},Z1=(n,t,e,s,r)=>(i,o)=>{const A=new WeakMap;let a=null;const l=async(c,u)=>{let d=null,p=t(c);const h=je(p,u);if(u.createIIRFilter===void 0?d=n(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):h||(p=u.createIIRFilter(o,i)),A.set(u,d===null?p:d),d!==null){if(a===null){if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new e(c.context.destination.channelCount,c.context.length,u.sampleRate);a=(async()=>{await s(c,g,g.destination);const v=await r(g);return J1(v,u,i,o)})()}const m=await a;return d.buffer=m,d.start(0),d}return await s(c,u,p),p};return{render(c,u){const d=A.get(u);return d!==void 0?Promise.resolve(d):l(c,u)}}},tS=(n,t,e,s,r,i)=>o=>(A,a)=>{const l=n.get(A);if(l===void 0){if(!o&&i(A)){const c=s(A),{outputs:u}=e(A);for(const d of u)if(Fa(d)){const p=s(d[0]);t(c,p,d[1],d[2])}else{const p=r(d[0]);c.disconnect(p,d[1])}}n.set(A,a)}else n.set(A,l+a)},eS=(n,t)=>e=>{const s=n.get(e);return t(s)||t(e)},nS=(n,t)=>e=>n.has(e)||t(e),sS=(n,t)=>e=>n.has(e)||t(e),rS=(n,t)=>e=>{const s=n.get(e);return t(s)||t(e)},iS=n=>t=>n!==null&&t instanceof n,oS=n=>t=>n!==null&&typeof n.AudioNode=="function"&&t instanceof n.AudioNode,AS=n=>t=>n!==null&&typeof n.AudioParam=="function"&&t instanceof n.AudioParam,aS=(n,t)=>e=>n(e)||t(e),lS=n=>t=>n!==null&&t instanceof n,cS=n=>n!==null&&n.isSecureContext,uS=(n,t,e,s)=>class extends n{constructor(i,o){const A=e(i),a=t(A,o);if(s(A))throw TypeError();super(i,!0,a,null),this._nativeMediaElementAudioSourceNode=a}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},dS={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},hS=(n,t,e,s)=>class extends n{constructor(i,o){const A=e(i);if(s(A))throw new TypeError;const a={...dS,...o},l=t(A,a);super(i,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},fS=(n,t,e,s)=>class extends n{constructor(i,o){const A=e(i),a=t(A,o);if(s(A))throw new TypeError;super(i,!0,a,null),this._nativeMediaStreamAudioSourceNode=a}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},pS=(n,t,e)=>class extends n{constructor(r,i){const o=e(r),A=t(o,i);super(r,!0,A,null)}},mS=(n,t,e,s,r,i)=>class extends e{constructor(A,a){super(A),this._nativeContext=A,nu.set(this,A),s(A)&&r.set(A,new Set),this._destination=new n(this,a),this._listener=t(this,A),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(A){const a=typeof A=="function"?i(this,A):null;this._nativeContext.onstatechange=a;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===a?A:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},jA=n=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const e=n.decodeAudioData(t.buffer,()=>{});return e===void 0?!1:(e.catch(()=>{}),!0)}catch{}return!1},gS=(n,t)=>(e,s,r)=>{const i=new Set;return e.connect=(o=>(A,a=0,l=0)=>{const c=i.size===0;if(t(A))return o.call(e,A,a,l),n(i,[A,a,l],u=>u[0]===A&&u[1]===a&&u[2]===l,!0),c&&s(),A;o.call(e,A,a),n(i,[A,a],u=>u[0]===A&&u[1]===a,!0),c&&s()})(e.connect),e.disconnect=(o=>(A,a,l)=>{const c=i.size>0;if(A===void 0)o.apply(e),i.clear();else if(typeof A=="number"){o.call(e,A);for(const d of i)d[1]===A&&i.delete(d)}else{t(A)?o.call(e,A,a,l):o.call(e,A,a);for(const d of i)d[0]===A&&(a===void 0||d[1]===a)&&(l===void 0||d[2]===l)&&i.delete(d)}const u=i.size===0;c&&u&&r()})(e.disconnect),e},se=(n,t,e)=>{const s=t[e];s!==void 0&&s!==n[e]&&(n[e]=s)},xe=(n,t)=>{se(n,t,"channelCount"),se(n,t,"channelCountMode"),se(n,t,"channelInterpretation")},gm=n=>typeof n.getFloatTimeDomainData=="function",vS=n=>{n.getFloatTimeDomainData=t=>{const e=new Uint8Array(t.length);n.getByteTimeDomainData(e);const s=Math.max(e.length,n.fftSize);for(let r=0;r<s;r+=1)t[r]=(e[r]-128)*.0078125;return t}},wS=(n,t)=>(e,s)=>{const r=e.createAnalyser();if(xe(r,s),!(s.maxDecibels>s.minDecibels))throw t();return se(r,s,"fftSize"),se(r,s,"maxDecibels"),se(r,s,"minDecibels"),se(r,s,"smoothingTimeConstant"),n(gm,()=>gm(r))||vS(r),r},BS=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,Ae=(n,t,e)=>{const s=t[e];s!==void 0&&s!==n[e].value&&(n[e].value=s)},CS=n=>{n.start=(t=>{let e=!1;return(s=0,r=0,i)=>{if(e)throw _e();t.call(n,s,r,i),e=!0}})(n.start)},xf=n=>{n.start=(t=>(e=0,s=0,r)=>{if(typeof r=="number"&&r<0||s<0||e<0)throw new RangeError("The parameters can't be negative.");t.call(n,e,s,r)})(n.start)},If=n=>{n.stop=(t=>(e=0)=>{if(e<0)throw new RangeError("The parameter can't be negative.");t.call(n,e)})(n.stop)},bS=(n,t,e,s,r,i,o,A,a,l,c)=>(u,d)=>{const p=u.createBufferSource();return xe(p,d),Ae(p,d,"playbackRate"),se(p,d,"buffer"),se(p,d,"loop"),se(p,d,"loopEnd"),se(p,d,"loopStart"),t(e,()=>e(u))||CS(p),t(s,()=>s(u))||a(p),t(r,()=>r(u))||l(p,u),t(i,()=>i(u))||xf(p),t(o,()=>o(u))||c(p,u),t(A,()=>A(u))||If(p),n(u,p),p},yS=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,SS=(n,t)=>(e,s,r)=>{const i=e.destination;if(i.channelCount!==s)try{i.channelCount=s}catch{}r&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:s});const o=n(e,{channelCount:s,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return t(o,"channelCount",A=>()=>A.call(o),A=>a=>{A.call(o,a);try{i.channelCount=a}catch(l){if(a>i.maxChannelCount)throw l}}),t(o,"channelCountMode",A=>()=>A.call(o),A=>a=>{A.call(o,a),i.channelCountMode=a}),t(o,"channelInterpretation",A=>()=>A.call(o),A=>a=>{A.call(o,a),i.channelInterpretation=a}),Object.defineProperty(o,"maxChannelCount",{get:()=>i.maxChannelCount}),o.connect(i),o},ES=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,xS=n=>{const{port1:t}=new MessageChannel;try{t.postMessage(n)}finally{t.close()}},IS=(n,t,e,s,r)=>(i,o,A,a,l,c)=>{if(A!==null)try{const u=new A(i,a,c),d=new Map;let p=null;if(Object.defineProperties(u,{channelCount:{get:()=>c.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>p,set:h=>{typeof p=="function"&&u.removeEventListener("processorerror",p),p=typeof h=="function"?h:null,typeof p=="function"&&u.addEventListener("processorerror",p)}}}),u.addEventListener=(h=>(...m)=>{if(m[0]==="processorerror"){const g=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(g!==null){const v=d.get(m[1]);v!==void 0?m[1]=v:(m[1]=w=>{w.type==="error"?(Object.defineProperties(w,{type:{value:"processorerror"}}),g(w)):g(new ErrorEvent(m[0],{...w}))},d.set(g,m[1]))}}return h.call(u,"error",m[1],m[2]),h.call(u,...m)})(u.addEventListener),u.removeEventListener=(h=>(...m)=>{if(m[0]==="processorerror"){const g=d.get(m[1]);g!==void 0&&(d.delete(m[1]),m[1]=g)}return h.call(u,"error",m[1],m[2]),h.call(u,m[0],m[1],m[2])})(u.removeEventListener),c.numberOfOutputs!==0){const h=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return u.connect(h).connect(i.destination),r(u,()=>h.disconnect(),()=>h.connect(i.destination))}return u}catch(u){throw u.code===11?s():u}if(l===void 0)throw s();return xS(c),t(i,o,l,c)},Uv=(n,t)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*t))))),FS=n=>new Promise((t,e)=>{const{port1:s,port2:r}=new MessageChannel;s.onmessage=({data:i})=>{s.close(),r.close(),t(i)},s.onmessageerror=({data:i})=>{s.close(),r.close(),e(i)},r.postMessage(n)}),TS=async(n,t)=>{const e=await FS(t);return new n(e)},_S=(n,t,e,s)=>{let r=Jd.get(n);r===void 0&&(r=new WeakMap,Jd.set(n,r));const i=TS(e,s);return r.set(t,i),i},MS=(n,t,e,s,r,i,o,A,a,l,c,u,d)=>(p,h,m,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw a();const v=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(v.some(k=>k<1))throw a();if(v.length!==g.numberOfOutputs)throw t();if(g.channelCountMode!=="explicit")throw a();const w=g.channelCount*g.numberOfInputs,y=v.reduce((k,z)=>k+z,0),I=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(w+I>6||y>6)throw a();const B=new MessageChannel,C=[],b=[];for(let k=0;k<g.numberOfInputs;k+=1)C.push(o(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),b.push(r(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const S=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:k,maxValue:z,minValue:$,name:rt}of m.parameterDescriptors){const et=i(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[rt]!==void 0?g.parameterData[rt]:k===void 0?0:k});Object.defineProperties(et.offset,{defaultValue:{get:()=>k===void 0?0:k},maxValue:{get:()=>z===void 0?nn:z},minValue:{get:()=>$===void 0?cn:$}}),S.push(et)}const T=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,w+I)}),x=Uv(h,p.sampleRate),_=A(p,x,w+I,Math.max(1,y)),F=r(p,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),Q=[];for(let k=0;k<g.numberOfOutputs;k+=1)Q.push(s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[k]}));for(let k=0;k<g.numberOfInputs;k+=1){C[k].connect(b[k]);for(let z=0;z<g.channelCount;z+=1)b[k].connect(T,z,k*g.channelCount+z)}const U=new _v(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:k},z)=>{const $=S[z];return $.connect(T,0,w+z),$.start(0),[k,$.offset]}));T.connect(_);let W=g.channelInterpretation,L=null;const R=g.numberOfOutputs===0?[_]:Q,N={get bufferSize(){return x},get channelCount(){return g.channelCount},set channelCount(k){throw e()},get channelCountMode(){return g.channelCountMode},set channelCountMode(k){throw e()},get channelInterpretation(){return W},set channelInterpretation(k){for(const z of C)z.channelInterpretation=k;W=k},get context(){return _.context},get inputs(){return C},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return L},set onprocessorerror(k){typeof L=="function"&&N.removeEventListener("processorerror",L),L=typeof k=="function"?k:null,typeof L=="function"&&N.addEventListener("processorerror",L)},get parameters(){return U},get port(){return B.port2},addEventListener(...k){return _.addEventListener(k[0],k[1],k[2])},connect:n.bind(null,R),disconnect:l.bind(null,R),dispatchEvent(...k){return _.dispatchEvent(k[0])},removeEventListener(...k){return _.removeEventListener(k[0],k[1],k[2])}},q=new Map;B.port1.addEventListener=(k=>(...z)=>{if(z[0]==="message"){const $=typeof z[1]=="function"?z[1]:typeof z[1]=="object"&&z[1]!==null&&typeof z[1].handleEvent=="function"?z[1].handleEvent:null;if($!==null){const rt=q.get(z[1]);rt!==void 0?z[1]=rt:(z[1]=et=>{c(p.currentTime,p.sampleRate,()=>$(et))},q.set($,z[1]))}}return k.call(B.port1,z[0],z[1],z[2])})(B.port1.addEventListener),B.port1.removeEventListener=(k=>(...z)=>{if(z[0]==="message"){const $=q.get(z[1]);$!==void 0&&(q.delete(z[1]),z[1]=$)}return k.call(B.port1,z[0],z[1],z[2])})(B.port1.removeEventListener);let J=null;Object.defineProperty(B.port1,"onmessage",{get:()=>J,set:k=>{typeof J=="function"&&B.port1.removeEventListener("message",J),J=typeof k=="function"?k:null,typeof J=="function"&&(B.port1.addEventListener("message",J),B.port1.start())}}),m.prototype.port=B.port1;let nt=null;_S(p,N,m,g).then(k=>nt=k);const ot=vc(g.numberOfInputs,g.channelCount),V=vc(g.numberOfOutputs,v),H=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((k,{name:z})=>({...k,[z]:new Float32Array(128)}),{});let G=!0;const Y=()=>{g.numberOfOutputs>0&&_.disconnect(F);for(let k=0,z=0;k<g.numberOfOutputs;k+=1){const $=Q[k];for(let rt=0;rt<v[k];rt+=1)F.disconnect($,z+rt,rt);z+=v[k]}},P=new Map;_.onaudioprocess=({inputBuffer:k,outputBuffer:z})=>{if(nt!==null){const $=u(N);for(let rt=0;rt<x;rt+=128){for(let et=0;et<g.numberOfInputs;et+=1)for(let it=0;it<g.channelCount;it+=1)gc(k,ot[et],it,it,rt);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:et},it)=>{gc(k,H,et,w+it,rt)});for(let et=0;et<g.numberOfInputs;et+=1)for(let it=0;it<v[et];it+=1)V[et][it].byteLength===0&&(V[et][it]=new Float32Array(128));try{const et=ot.map((at,Ct)=>{if($[Ct].size>0)return P.set(Ct,x/128),at;const Bt=P.get(Ct);return Bt===void 0?[]:(at.every(Et=>Et.every(Qt=>Qt===0))&&(Bt===1?P.delete(Ct):P.set(Ct,Bt-1)),at)});G=c(p.currentTime+rt/p.sampleRate,p.sampleRate,()=>nt.process(et,V,H));for(let at=0,Ct=0;at<g.numberOfOutputs;at+=1){for(let yt=0;yt<v[at];yt+=1)Mv(z,V[at],yt,Ct+yt,rt);Ct+=v[at]}}catch(et){G=!1,N.dispatchEvent(new ErrorEvent("processorerror",{colno:et.colno,filename:et.filename,lineno:et.lineno,message:et.message}))}if(!G){for(let et=0;et<g.numberOfInputs;et+=1){C[et].disconnect(b[et]);for(let it=0;it<g.channelCount;it+=1)b[rt].disconnect(T,it,et*g.channelCount+it)}if(m.parameterDescriptors!==void 0){const et=m.parameterDescriptors.length;for(let it=0;it<et;it+=1){const at=S[it];at.disconnect(T,0,w+it),at.stop()}}T.disconnect(_),_.onaudioprocess=null,st?Y():O();break}}}};let st=!1;const D=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),K=()=>_.connect(D).connect(p.destination),O=()=>{_.disconnect(D),D.disconnect()},X=()=>{if(G){O(),g.numberOfOutputs>0&&_.connect(F);for(let k=0,z=0;k<g.numberOfOutputs;k+=1){const $=Q[k];for(let rt=0;rt<v[k];rt+=1)F.connect($,z+rt,rt);z+=v[k]}}st=!0},tt=()=>{G&&(K(),Y()),st=!1};return K(),d(N,X,tt)},Pv=(n,t)=>{const e=n.createBiquadFilter();return xe(e,t),Ae(e,t,"Q"),Ae(e,t,"detune"),Ae(e,t,"frequency"),Ae(e,t,"gain"),se(e,t,"type"),e},QS=(n,t)=>(e,s)=>{const r=e.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&t(e,r),xe(r,s),r},US=n=>{const t=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw _e()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:e=>{if(e!=="explicit")throw _e()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:e=>{if(e!=="discrete")throw _e()}})},Ta=(n,t)=>{const e=n.createChannelSplitter(t.numberOfOutputs);return xe(e,t),US(e),e},PS=(n,t,e,s,r)=>(i,o)=>{if(i.createConstantSource===void 0)return e(i,o);const A=i.createConstantSource();return xe(A,o),Ae(A,o,"offset"),t(s,()=>s(i))||xf(A),t(r,()=>r(i))||If(A),n(i,A),A},tA=(n,t)=>(n.connect=t.connect.bind(t),n.disconnect=t.disconnect.bind(t),n),NS=(n,t,e,s)=>(r,{offset:i,...o})=>{const A=r.createBuffer(1,2,44100),a=t(r,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=e(r,{...o,gain:i}),c=A.getChannelData(0);c[0]=1,c[1]=1,a.buffer=A,a.loop=!0;const u={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(h){l.channelCount=h},get channelCountMode(){return l.channelCountMode},set channelCountMode(h){l.channelCountMode=h},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(h){l.channelInterpretation=h},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return a.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return a.onended},set onended(h){a.onended=h},addEventListener(...h){return a.addEventListener(h[0],h[1],h[2])},dispatchEvent(...h){return a.dispatchEvent(h[0])},removeEventListener(...h){return a.removeEventListener(h[0],h[1],h[2])},start(h=0){a.start.call(a,h)},stop(h=0){a.stop.call(a,h)}},d=()=>a.connect(l),p=()=>a.disconnect(l);return n(r,a),s(tA(u,l),d,p)},LS=(n,t)=>(e,s)=>{const r=e.createConvolver();if(xe(r,s),s.disableNormalization===r.normalize&&(r.normalize=!s.disableNormalization),se(r,s,"buffer"),s.channelCount>2||(t(r,"channelCount",i=>()=>i.call(r),i=>o=>{if(o>2)throw n();return i.call(r,o)}),s.channelCountMode==="max"))throw n();return t(r,"channelCountMode",i=>()=>i.call(r),i=>o=>{if(o==="max")throw n();return i.call(r,o)}),r},Nv=(n,t)=>{const e=n.createDelay(t.maxDelayTime);return xe(e,t),Ae(e,t,"delayTime"),e},DS=n=>(t,e)=>{const s=t.createDynamicsCompressor();if(xe(s,e),e.channelCount>2||e.channelCountMode==="max")throw n();return Ae(s,e,"attack"),Ae(s,e,"knee"),Ae(s,e,"ratio"),Ae(s,e,"release"),Ae(s,e,"threshold"),s},vn=(n,t)=>{const e=n.createGain();return xe(e,t),Ae(e,t,"gain"),e},kS=n=>(t,e,s)=>{if(t.createIIRFilter===void 0)return n(t,e,s);const r=t.createIIRFilter(s.feedforward,s.feedback);return xe(r,s),r};function RS(n,t){const e=t[0]*t[0]+t[1]*t[1];return[(n[0]*t[0]+n[1]*t[1])/e,(n[1]*t[0]-n[0]*t[1])/e]}function HS(n,t){return[n[0]*t[0]-n[1]*t[1],n[0]*t[1]+n[1]*t[0]]}function vm(n,t){let e=[0,0];for(let s=n.length-1;s>=0;s-=1)e=HS(e,t),e[0]+=n[s];return e}const OS=(n,t,e,s)=>(r,i,{channelCount:o,channelCountMode:A,channelInterpretation:a,feedback:l,feedforward:c})=>{const u=Uv(i,r.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),p=c instanceof Float64Array?c:new Float64Array(c),h=d.length,m=p.length,g=Math.min(h,m);if(h===0||h>20)throw s();if(d[0]===0)throw t();if(m===0||m>20)throw s();if(p[0]===0)throw t();if(d[0]!==1){for(let S=0;S<m;S+=1)p[S]/=d[0];for(let S=1;S<h;S+=1)d[S]/=d[0]}const v=e(r,u,o,o);v.channelCount=o,v.channelCountMode=A,v.channelInterpretation=a;const w=32,y=[],I=[],B=[];for(let S=0;S<o;S+=1){y.push(0);const T=new Float32Array(w),x=new Float32Array(w);T.fill(0),x.fill(0),I.push(T),B.push(x)}v.onaudioprocess=S=>{const T=S.inputBuffer,x=S.outputBuffer,_=T.numberOfChannels;for(let F=0;F<_;F+=1){const Q=T.getChannelData(F),U=x.getChannelData(F);y[F]=Qv(d,h,p,m,g,I[F],B[F],y[F],w,Q,U)}};const C=r.sampleRate/2;return tA({get bufferSize(){return u},get channelCount(){return v.channelCount},set channelCount(S){v.channelCount=S},get channelCountMode(){return v.channelCountMode},set channelCountMode(S){v.channelCountMode=S},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(S){v.channelInterpretation=S},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener(...S){return v.addEventListener(S[0],S[1],S[2])},dispatchEvent(...S){return v.dispatchEvent(S[0])},getFrequencyResponse(S,T,x){if(S.length!==T.length||T.length!==x.length)throw n();const _=S.length;for(let F=0;F<_;F+=1){const Q=-Math.PI*(S[F]/C),U=[Math.cos(Q),Math.sin(Q)],W=vm(p,U),L=vm(d,U),R=RS(W,L);T[F]=Math.sqrt(R[0]*R[0]+R[1]*R[1]),x[F]=Math.atan2(R[1],R[0])}},removeEventListener(...S){return v.removeEventListener(S[0],S[1],S[2])}},v)},VS=(n,t)=>n.createMediaElementSource(t.mediaElement),WS=(n,t)=>{const e=n.createMediaStreamDestination();return xe(e,t),e.numberOfOutputs===1&&Object.defineProperty(e,"numberOfOutputs",{get:()=>0}),e},GS=(n,{mediaStream:t})=>{const e=t.getAudioTracks();e.sort((i,o)=>i.id<o.id?-1:i.id>o.id?1:0);const s=e.slice(0,1),r=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(r,"mediaStream",{value:t}),r},KS=(n,t)=>(e,{mediaStreamTrack:s})=>{if(typeof e.createMediaStreamTrackSource=="function")return e.createMediaStreamTrackSource(s);const r=new MediaStream([s]),i=e.createMediaStreamSource(r);if(s.kind!=="audio")throw n();if(t(e))throw new TypeError;return i},qS=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,zS=(n,t,e,s,r,i)=>(o,A)=>{const a=o.createOscillator();return xe(a,A),Ae(a,A,"detune"),Ae(a,A,"frequency"),A.periodicWave!==void 0?a.setPeriodicWave(A.periodicWave):se(a,A,"type"),t(e,()=>e(o))||xf(a),t(s,()=>s(o))||i(a,o),t(r,()=>r(o))||If(a),n(o,a),a},$S=n=>(t,e)=>{const s=t.createPanner();return s.orientationX===void 0?n(t,e):(xe(s,e),Ae(s,e,"orientationX"),Ae(s,e,"orientationY"),Ae(s,e,"orientationZ"),Ae(s,e,"positionX"),Ae(s,e,"positionY"),Ae(s,e,"positionZ"),se(s,e,"coneInnerAngle"),se(s,e,"coneOuterAngle"),se(s,e,"coneOuterGain"),se(s,e,"distanceModel"),se(s,e,"maxDistance"),se(s,e,"panningModel"),se(s,e,"refDistance"),se(s,e,"rolloffFactor"),s)},XS=(n,t,e,s,r,i,o,A,a,l)=>(c,{coneInnerAngle:u,coneOuterAngle:d,coneOuterGain:p,distanceModel:h,maxDistance:m,orientationX:g,orientationY:v,orientationZ:w,panningModel:y,positionX:I,positionY:B,positionZ:C,refDistance:b,rolloffFactor:S,...T})=>{const x=c.createPanner();if(T.channelCount>2||T.channelCountMode==="max")throw o();xe(x,T);const _={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},F=e(c,{..._,channelInterpretation:"speakers",numberOfInputs:6}),Q=s(c,{...T,gain:1}),U=s(c,{..._,gain:1}),W=s(c,{..._,gain:0}),L=s(c,{..._,gain:0}),R=s(c,{..._,gain:0}),N=s(c,{..._,gain:0}),q=s(c,{..._,gain:0}),J=r(c,256,6,1),nt=i(c,{..._,curve:new Float32Array([1,1]),oversample:"none"});let At=[g,v,w],ot=[I,B,C];const V=new Float32Array(1);J.onaudioprocess=({inputBuffer:P})=>{const st=[a(P,V,0),a(P,V,1),a(P,V,2)];st.some((K,O)=>K!==At[O])&&(x.setOrientation(...st),At=st);const D=[a(P,V,3),a(P,V,4),a(P,V,5)];D.some((K,O)=>K!==ot[O])&&(x.setPosition(...D),ot=D)},Object.defineProperty(W.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(q.gain,"defaultValue",{get:()=>0});const H={get bufferSize(){},get channelCount(){return x.channelCount},set channelCount(P){if(P>2)throw o();Q.channelCount=P,x.channelCount=P},get channelCountMode(){return x.channelCountMode},set channelCountMode(P){if(P==="max")throw o();Q.channelCountMode=P,x.channelCountMode=P},get channelInterpretation(){return x.channelInterpretation},set channelInterpretation(P){Q.channelInterpretation=P,x.channelInterpretation=P},get coneInnerAngle(){return x.coneInnerAngle},set coneInnerAngle(P){x.coneInnerAngle=P},get coneOuterAngle(){return x.coneOuterAngle},set coneOuterAngle(P){x.coneOuterAngle=P},get coneOuterGain(){return x.coneOuterGain},set coneOuterGain(P){if(P<0||P>1)throw t();x.coneOuterGain=P},get context(){return x.context},get distanceModel(){return x.distanceModel},set distanceModel(P){x.distanceModel=P},get inputs(){return[Q]},get maxDistance(){return x.maxDistance},set maxDistance(P){if(P<0)throw new RangeError;x.maxDistance=P},get numberOfInputs(){return x.numberOfInputs},get numberOfOutputs(){return x.numberOfOutputs},get orientationX(){return U.gain},get orientationY(){return W.gain},get orientationZ(){return L.gain},get panningModel(){return x.panningModel},set panningModel(P){x.panningModel=P},get positionX(){return R.gain},get positionY(){return N.gain},get positionZ(){return q.gain},get refDistance(){return x.refDistance},set refDistance(P){if(P<0)throw new RangeError;x.refDistance=P},get rolloffFactor(){return x.rolloffFactor},set rolloffFactor(P){if(P<0)throw new RangeError;x.rolloffFactor=P},addEventListener(...P){return Q.addEventListener(P[0],P[1],P[2])},dispatchEvent(...P){return Q.dispatchEvent(P[0])},removeEventListener(...P){return Q.removeEventListener(P[0],P[1],P[2])}};u!==H.coneInnerAngle&&(H.coneInnerAngle=u),d!==H.coneOuterAngle&&(H.coneOuterAngle=d),p!==H.coneOuterGain&&(H.coneOuterGain=p),h!==H.distanceModel&&(H.distanceModel=h),m!==H.maxDistance&&(H.maxDistance=m),g!==H.orientationX.value&&(H.orientationX.value=g),v!==H.orientationY.value&&(H.orientationY.value=v),w!==H.orientationZ.value&&(H.orientationZ.value=w),y!==H.panningModel&&(H.panningModel=y),I!==H.positionX.value&&(H.positionX.value=I),B!==H.positionY.value&&(H.positionY.value=B),C!==H.positionZ.value&&(H.positionZ.value=C),b!==H.refDistance&&(H.refDistance=b),S!==H.rolloffFactor&&(H.rolloffFactor=S),(At[0]!==1||At[1]!==0||At[2]!==0)&&x.setOrientation(...At),(ot[0]!==0||ot[1]!==0||ot[2]!==0)&&x.setPosition(...ot);const G=()=>{Q.connect(x),n(Q,nt,0,0),nt.connect(U).connect(F,0,0),nt.connect(W).connect(F,0,1),nt.connect(L).connect(F,0,2),nt.connect(R).connect(F,0,3),nt.connect(N).connect(F,0,4),nt.connect(q).connect(F,0,5),F.connect(J).connect(c.destination)},Y=()=>{Q.disconnect(x),A(Q,nt,0,0),nt.disconnect(U),U.disconnect(F),nt.disconnect(W),W.disconnect(F),nt.disconnect(L),L.disconnect(F),nt.disconnect(R),R.disconnect(F),nt.disconnect(N),N.disconnect(F),nt.disconnect(q),q.disconnect(F),F.disconnect(J),J.disconnect(c.destination)};return l(tA(H,x),G,Y)},YS=n=>(t,{disableNormalization:e,imag:s,real:r})=>{const i=s instanceof Float32Array?s:new Float32Array(s),o=r instanceof Float32Array?r:new Float32Array(r),A=t.createPeriodicWave(o,i,{disableNormalization:e});if(Array.from(s).length<2)throw n();return A},_a=(n,t,e,s)=>n.createScriptProcessor(t,e,s),jS=(n,t)=>(e,s)=>{const r=s.channelCountMode;if(r==="clamped-max")throw t();if(e.createStereoPanner===void 0)return n(e,s);const i=e.createStereoPanner();return xe(i,s),Ae(i,s,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>r,set:o=>{if(o!==r)throw t()}}),i},JS=(n,t,e,s,r,i)=>{const A=new Float32Array([1,1]),a=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},c={...l,oversample:"none"},u=(h,m,g,v)=>{const w=new Float32Array(16385),y=new Float32Array(16385);for(let T=0;T<16385;T+=1){const x=T/16384*a;w[T]=Math.cos(x),y[T]=Math.sin(x)}const I=e(h,{...l,gain:0}),B=s(h,{...c,curve:w}),C=s(h,{...c,curve:A}),b=e(h,{...l,gain:0}),S=s(h,{...c,curve:y});return{connectGraph(){m.connect(I),m.connect(C.inputs===void 0?C:C.inputs[0]),m.connect(b),C.connect(g),g.connect(B.inputs===void 0?B:B.inputs[0]),g.connect(S.inputs===void 0?S:S.inputs[0]),B.connect(I.gain),S.connect(b.gain),I.connect(v,0,0),b.connect(v,0,1)},disconnectGraph(){m.disconnect(I),m.disconnect(C.inputs===void 0?C:C.inputs[0]),m.disconnect(b),C.disconnect(g),g.disconnect(B.inputs===void 0?B:B.inputs[0]),g.disconnect(S.inputs===void 0?S:S.inputs[0]),B.disconnect(I.gain),S.disconnect(b.gain),I.disconnect(v,0,0),b.disconnect(v,0,1)}}},d=(h,m,g,v)=>{const w=new Float32Array(16385),y=new Float32Array(16385),I=new Float32Array(16385),B=new Float32Array(16385),C=Math.floor(16385/2);for(let R=0;R<16385;R+=1)if(R>C){const N=(R-C)/(16384-C)*a;w[R]=Math.cos(N),y[R]=Math.sin(N),I[R]=0,B[R]=1}else{const N=R/(16384-C)*a;w[R]=1,y[R]=0,I[R]=Math.cos(N),B[R]=Math.sin(N)}const b=t(h,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),S=e(h,{...l,gain:0}),T=s(h,{...c,curve:w}),x=e(h,{...l,gain:0}),_=s(h,{...c,curve:y}),F=s(h,{...c,curve:A}),Q=e(h,{...l,gain:0}),U=s(h,{...c,curve:I}),W=e(h,{...l,gain:0}),L=s(h,{...c,curve:B});return{connectGraph(){m.connect(b),m.connect(F.inputs===void 0?F:F.inputs[0]),b.connect(S,0),b.connect(x,0),b.connect(Q,1),b.connect(W,1),F.connect(g),g.connect(T.inputs===void 0?T:T.inputs[0]),g.connect(_.inputs===void 0?_:_.inputs[0]),g.connect(U.inputs===void 0?U:U.inputs[0]),g.connect(L.inputs===void 0?L:L.inputs[0]),T.connect(S.gain),_.connect(x.gain),U.connect(Q.gain),L.connect(W.gain),S.connect(v,0,0),Q.connect(v,0,0),x.connect(v,0,1),W.connect(v,0,1)},disconnectGraph(){m.disconnect(b),m.disconnect(F.inputs===void 0?F:F.inputs[0]),b.disconnect(S,0),b.disconnect(x,0),b.disconnect(Q,1),b.disconnect(W,1),F.disconnect(g),g.disconnect(T.inputs===void 0?T:T.inputs[0]),g.disconnect(_.inputs===void 0?_:_.inputs[0]),g.disconnect(U.inputs===void 0?U:U.inputs[0]),g.disconnect(L.inputs===void 0?L:L.inputs[0]),T.disconnect(S.gain),_.disconnect(x.gain),U.disconnect(Q.gain),L.disconnect(W.gain),S.disconnect(v,0,0),Q.disconnect(v,0,0),x.disconnect(v,0,1),W.disconnect(v,0,1)}}},p=(h,m,g,v,w)=>{if(m===1)return u(h,g,v,w);if(m===2)return d(h,g,v,w);throw r()};return(h,{channelCount:m,channelCountMode:g,pan:v,...w})=>{if(g==="max")throw r();const y=n(h,{...w,channelCount:1,channelCountMode:g,numberOfInputs:2}),I=e(h,{...w,channelCount:m,channelCountMode:g,gain:1}),B=e(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:v});let{connectGraph:C,disconnectGraph:b}=p(h,m,I,B,y);Object.defineProperty(B.gain,"defaultValue",{get:()=>0}),Object.defineProperty(B.gain,"maxValue",{get:()=>1}),Object.defineProperty(B.gain,"minValue",{get:()=>-1});const S={get bufferSize(){},get channelCount(){return I.channelCount},set channelCount(F){I.channelCount!==F&&(T&&b(),{connectGraph:C,disconnectGraph:b}=p(h,F,I,B,y),T&&C()),I.channelCount=F},get channelCountMode(){return I.channelCountMode},set channelCountMode(F){if(F==="clamped-max"||F==="max")throw r();I.channelCountMode=F},get channelInterpretation(){return I.channelInterpretation},set channelInterpretation(F){I.channelInterpretation=F},get context(){return I.context},get inputs(){return[I]},get numberOfInputs(){return I.numberOfInputs},get numberOfOutputs(){return I.numberOfOutputs},get pan(){return B.gain},addEventListener(...F){return I.addEventListener(F[0],F[1],F[2])},dispatchEvent(...F){return I.dispatchEvent(F[0])},removeEventListener(...F){return I.removeEventListener(F[0],F[1],F[2])}};let T=!1;const x=()=>{C(),T=!0},_=()=>{b(),T=!1};return i(tA(S,y),x,_)}},ZS=(n,t,e,s,r,i,o)=>(A,a)=>{const l=A.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&A.createGain().gain.automationRate===void 0)return e(A,a);xe(l,a);const c=a.curve===null||a.curve instanceof Float32Array?a.curve:new Float32Array(a.curve);if(c!==null&&c.length<2)throw t();se(l,{curve:c},"curve"),se(l,a,"oversample");let u=null,d=!1;return o(l,"curve",m=>()=>m.call(l),m=>g=>(m.call(l,g),d&&(s(g)&&u===null?u=n(A,l):!s(g)&&u!==null&&(u(),u=null)),g)),r(l,()=>{d=!0,s(l.curve)&&(u=n(A,l))},()=>{d=!1,u!==null&&(u(),u=null)})},tE=(n,t,e,s,r)=>(i,{curve:o,oversample:A,...a})=>{const l=i.createWaveShaper(),c=i.createWaveShaper();xe(l,a),xe(c,a);const u=e(i,{...a,gain:1}),d=e(i,{...a,gain:-1}),p=e(i,{...a,gain:1}),h=e(i,{...a,gain:-1});let m=null,g=!1,v=null;const w={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(B){u.channelCount=B,d.channelCount=B,l.channelCount=B,p.channelCount=B,c.channelCount=B,h.channelCount=B},get channelCountMode(){return l.channelCountMode},set channelCountMode(B){u.channelCountMode=B,d.channelCountMode=B,l.channelCountMode=B,p.channelCountMode=B,c.channelCountMode=B,h.channelCountMode=B},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(B){u.channelInterpretation=B,d.channelInterpretation=B,l.channelInterpretation=B,p.channelInterpretation=B,c.channelInterpretation=B,h.channelInterpretation=B},get context(){return l.context},get curve(){return v},set curve(B){if(B!==null&&B.length<2)throw t();if(B===null)l.curve=B,c.curve=B;else{const C=B.length,b=new Float32Array(C+2-C%2),S=new Float32Array(C+2-C%2);b[0]=B[0],S[0]=-B[C-1];const T=Math.ceil((C+1)/2),x=(C+1)/2-1;for(let _=1;_<T;_+=1){const F=_/T*x,Q=Math.floor(F),U=Math.ceil(F);b[_]=Q===U?B[Q]:(1-(F-Q))*B[Q]+(1-(U-F))*B[U],S[_]=Q===U?-B[C-1-Q]:-((1-(F-Q))*B[C-1-Q])-(1-(U-F))*B[C-1-U]}b[T]=C%2===1?B[T-1]:(B[T-2]+B[T-1])/2,l.curve=b,c.curve=S}v=B,g&&(s(v)&&m===null?m=n(i,u):m!==null&&(m(),m=null))},get inputs(){return[u]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(B){l.oversample=B,c.oversample=B},addEventListener(...B){return u.addEventListener(B[0],B[1],B[2])},dispatchEvent(...B){return u.dispatchEvent(B[0])},removeEventListener(...B){return u.removeEventListener(B[0],B[1],B[2])}};o!==null&&(w.curve=o instanceof Float32Array?o:new Float32Array(o)),A!==w.oversample&&(w.oversample=A);const y=()=>{u.connect(l).connect(p),u.connect(d).connect(c).connect(h).connect(p),g=!0,s(v)&&(m=n(i,u))},I=()=>{u.disconnect(l),l.disconnect(p),u.disconnect(d),d.disconnect(c),c.disconnect(h),h.disconnect(p),g=!1,m!==null&&(m(),m=null)};return r(tA(w,p),y,I)},An=()=>new DOMException("","NotSupportedError"),eE={numberOfChannels:1},nE=(n,t,e,s,r)=>class extends n{constructor(o,A,a){let l;if(typeof o=="number"&&A!==void 0&&a!==void 0)l={length:A,numberOfChannels:o,sampleRate:a};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:c,numberOfChannels:u,sampleRate:d}={...eE,...l},p=s(u,c,d);t(jA,()=>jA(p))||p.addEventListener("statechange",(()=>{let h=0;const m=g=>{this._state==="running"&&(h>0?(p.removeEventListener("statechange",m),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):h+=1)};return m})()),super(p,u),this._length=c,this._nativeOfflineAudioContext=p,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(e()):(this._state="running",r(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,xv(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},sE={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},rE=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...sE,...l},d=e(c,u),p=i(c),h=p?s():null,m=a.sampleRate/2;super(a,!1,d,h),this._detune=t(this,p,d.detune,153600,-153600),this._frequency=t(this,p,d.frequency,m,-m),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=h,this._oscillatorNodeRenderer!==null&&u.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=u.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(a){const l=typeof a=="function"?o(this,a):null;this._nativeOscillatorNode.onended=l;const c=this._nativeOscillatorNode.onended;this._onended=c!==null&&c===l?a:c}get type(){return this._nativeOscillatorNode.type}set type(a){this._nativeOscillatorNode.type=a,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(a){this._nativeOscillatorNode.setPeriodicWave(a),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=a)}start(a=0){if(this._nativeOscillatorNode.start(a),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=a),this.context.state!=="closed"){Ho(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),ir(this)&&xa(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(a=0){this._nativeOscillatorNode.stop(a),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=a)}},iE=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,A=null,a=null;const l=async(c,u)=>{let d=e(c);const p=je(d,u);if(!p){const h={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=t(u,h),A!==null&&d.start(A),a!==null&&d.stop(a)}return i.set(u,d),p?(await n(u,c.detune,d.detune),await n(u,c.frequency,d.frequency)):(await s(u,c.detune,d.detune),await s(u,c.frequency,d.frequency)),await r(c,u,d),d};return{set periodicWave(c){o=c},set start(c){A=c},set stop(c){a=c},render(c,u){const d=i.get(u);return d!==void 0?Promise.resolve(d):l(c,u)}}},oE={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},AE=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...oE,...l},d=e(c,u),p=i(c),h=p?s():null;super(a,!1,d,h),this._nativePannerNode=d,this._orientationX=t(this,p,d.orientationX,nn,cn),this._orientationY=t(this,p,d.orientationY,nn,cn),this._orientationZ=t(this,p,d.orientationZ,nn,cn),this._positionX=t(this,p,d.positionX,nn,cn),this._positionY=t(this,p,d.positionY,nn,cn),this._positionZ=t(this,p,d.positionZ,nn,cn),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(a){this._nativePannerNode.coneInnerAngle=a}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(a){this._nativePannerNode.coneOuterAngle=a}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(a){this._nativePannerNode.coneOuterGain=a}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(a){this._nativePannerNode.distanceModel=a}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(a){this._nativePannerNode.maxDistance=a}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(a){this._nativePannerNode.panningModel=a}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(a){this._nativePannerNode.refDistance=a}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(a){this._nativePannerNode.rolloffFactor=a}},aE=(n,t,e,s,r,i,o,A,a,l)=>()=>{const c=new WeakMap;let u=null;const d=async(p,h)=>{let m=null,g=i(p);const v={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},w={...v,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},y=je(g,h);if("bufferSize"in g)m=s(h,{...v,gain:1});else if(!y){const I={...w,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=r(h,I)}if(c.set(h,m===null?g:m),m!==null){if(u===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _=new o(6,p.context.length,h.sampleRate),F=t(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});F.connect(_.destination),u=(async()=>{const Q=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map(async(U,W)=>{const L=e(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:W===0?1:0});return await A(_,U,L.offset),L}));for(let U=0;U<6;U+=1)Q[U].connect(F,0,U),Q[U].start(0);return l(_)})()}const I=await u,B=s(h,{...v,gain:1});await a(p,h,B);const C=[];for(let _=0;_<I.numberOfChannels;_+=1)C.push(I.getChannelData(_));let b=[C[0][0],C[1][0],C[2][0]],S=[C[3][0],C[4][0],C[5][0]],T=s(h,{...v,gain:1}),x=r(h,{...w,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:S[0],positionY:S[1],positionZ:S[2]});B.connect(T).connect(x.inputs[0]),x.connect(m);for(let _=128;_<I.length;_+=128){const F=[C[0][_],C[1][_],C[2][_]],Q=[C[3][_],C[4][_],C[5][_]];if(F.some((U,W)=>U!==b[W])||Q.some((U,W)=>U!==S[W])){b=F,S=Q;const U=_/h.sampleRate;T.gain.setValueAtTime(0,U),T=s(h,{...v,gain:0}),x=r(h,{...w,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:S[0],positionY:S[1],positionZ:S[2]}),T.gain.setValueAtTime(1,U),B.connect(T).connect(x.inputs[0]),x.connect(m)}}return m}return y?(await n(h,p.orientationX,g.orientationX),await n(h,p.orientationY,g.orientationY),await n(h,p.orientationZ,g.orientationZ),await n(h,p.positionX,g.positionX),await n(h,p.positionY,g.positionY),await n(h,p.positionZ,g.positionZ)):(await A(h,p.orientationX,g.orientationX),await A(h,p.orientationY,g.orientationY),await A(h,p.orientationZ,g.orientationZ),await A(h,p.positionX,g.positionX),await A(h,p.positionY,g.positionY),await A(h,p.positionZ,g.positionZ)),Zo(g)?await a(p,h,g.inputs[0]):await a(p,h,g),g};return{render(p,h){const m=c.get(h);return m!==void 0?Promise.resolve(m):d(p,h)}}},lE={disableNormalization:!1},cE=(n,t,e,s)=>class Lv{constructor(i,o){const A=t(i),a=s({...lE,...o}),l=n(A,a);return e.add(l),l}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===Lv.prototype||e.has(i)}},uE=(n,t)=>(e,s,r)=>(n(s).replay(r),t(s,e,r)),dE=(n,t,e)=>async(s,r,i)=>{const o=n(s);await Promise.all(o.activeInputs.map((A,a)=>Array.from(A).map(async([l,c])=>{const d=await t(l).render(l,r),p=s.context.destination;!e(l)&&(s!==p||!e(s))&&d.connect(i,c,a)})).reduce((A,a)=>[...A,...a],[]))},hE=(n,t,e)=>async(s,r,i)=>{const o=t(s);await Promise.all(Array.from(o.activeInputs).map(async([A,a])=>{const c=await n(A).render(A,r);e(A)||c.connect(i,a)}))},fE=(n,t,e,s)=>r=>n(jA,()=>jA(r))?Promise.resolve(n(s,s)).then(i=>{if(!i){const o=e(r,512,0,1);r.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>r.currentTime,o.connect(r.destination)}return r.startRendering()}):new Promise(i=>{const o=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.oncomplete=A=>{o.disconnect(),i(A.renderedBuffer)},o.connect(r.destination),r.startRendering()}),pE=n=>(t,e)=>{n.set(t,e)},mE=n=>(t,e)=>n.set(t,e),gE=(n,t,e,s,r,i,o,A)=>(a,l)=>e(a).render(a,l).then(()=>Promise.all(Array.from(s(l)).map(c=>e(c).render(c,l)))).then(()=>r(l)).then(c=>(typeof c.copyFromChannel!="function"?(o(c),yf(c)):t(i,()=>i(c))||A(c),n.add(c),c)),vE={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},wE=(n,t,e,s,r,i)=>class extends n{constructor(A,a){const l=r(A),c={...vE,...a},u=e(l,c),d=i(l),p=d?s():null;super(A,!1,u,p),this._pan=t(this,d,u.pan)}get pan(){return this._pan}},BE=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(A,a)=>{let l=e(A);const c=je(l,a);if(!c){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=t(a,u)}return i.set(a,l),c?await n(a,A.pan,l.pan):await s(a,A.pan,l.pan),Zo(l)?await r(A,a,l.inputs[0]):await r(A,a,l),l};return{render(A,a){const l=i.get(a);return l!==void 0?Promise.resolve(l):o(A,a)}}},CE=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},bE=(n,t)=>async()=>{if(n===null)return!0;if(t===null)return!1;const e=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,44100),r=URL.createObjectURL(e);let i=!1,o=!1;try{await s.audioWorklet.addModule(r);const A=new n(s,"a",{numberOfOutputs:0}),a=s.createOscillator();A.port.onmessage=()=>i=!0,A.onprocessorerror=()=>o=!0,a.connect(A),a.start(0),await s.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(r)}return i&&!o},yE=(n,t)=>()=>{if(t===null)return Promise.resolve(!1);const e=new t(1,1,44100),s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(r=>{e.oncomplete=()=>{s.disconnect(),r(e.currentTime!==0)},e.startRendering()})},SE=()=>new DOMException("","UnknownError"),EE={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},xE=(n,t,e,s,r,i,o)=>class extends n{constructor(a,l){const c=r(a),u={...EE,...l},d=e(c,u),h=i(c)?s():null;super(a,!0,d,h),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(a){if(a===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(a.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=a}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(a){this._nativeWaveShaperNode.oversample=a}},IE=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let A=t(i);if(!je(A,o)){const l={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,curve:A.curve,oversample:A.oversample};A=n(o,l)}return s.set(o,A),Zo(A)?await e(i,o,A.inputs[0]):await e(i,o,A),A};return{render(i,o){const A=s.get(o);return A!==void 0?Promise.resolve(A):r(i,o)}}},FE=()=>typeof window>"u"?null:window,TE=(n,t)=>e=>{e.copyFromChannel=(s,r,i=0)=>{const o=n(i),A=n(r);if(A>=e.numberOfChannels)throw t();const a=e.length,l=e.getChannelData(A),c=s.length;for(let u=o<0?-o:0;u+o<a&&u<c;u+=1)s[u]=l[u+o]},e.copyToChannel=(s,r,i=0)=>{const o=n(i),A=n(r);if(A>=e.numberOfChannels)throw t();const a=e.length,l=e.getChannelData(A),c=s.length;for(let u=o<0?-o:0;u+o<a&&u<c;u+=1)l[u+o]=s[u]}},_E=n=>t=>{t.copyFromChannel=(e=>(s,r,i=0)=>{const o=n(i),A=n(r);if(o<t.length)return e.call(t,s,A,o)})(t.copyFromChannel),t.copyToChannel=(e=>(s,r,i=0)=>{const o=n(i),A=n(r);if(o<t.length)return e.call(t,s,A,o)})(t.copyToChannel)},ME=n=>(t,e)=>{const s=e.createBuffer(1,1,44100);t.buffer===null&&(t.buffer=s),n(t,"buffer",r=>()=>{const i=r.call(t);return i===s?null:i},r=>i=>r.call(t,i===null?s:i))},QE=(n,t)=>(e,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const r=e.createBufferSource();t(s,()=>{const A=s.numberOfInputs;for(let a=0;a<A;a+=1)r.connect(s,0,a)},()=>r.disconnect(s))},Dv=(n,t,e)=>n.copyFromChannel===void 0?n.getChannelData(e)[0]:(n.copyFromChannel(t,e),t[0]),kv=n=>{if(n===null)return!1;const t=n.length;return t%2!==0?n[Math.floor(t/2)]!==0:n[t/2-1]+n[t/2]!==0},Ma=(n,t,e,s)=>{let r=n;for(;!r.hasOwnProperty(t);)r=Object.getPrototypeOf(r);const{get:i,set:o}=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(n,t,{get:e(i),set:s(o)})},UE=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),PE=n=>({...n,channelCount:n.numberOfOutputs}),NE=n=>{const{imag:t,real:e}=n;return t===void 0?e===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(e,()=>0),real:e}:e===void 0?{...n,imag:t,real:Array.from(t,()=>0)}:{...n,imag:t,real:e}},Rv=(n,t,e)=>{try{n.setValueAtTime(t,e)}catch(s){if(s.code!==9)throw s;Rv(n,t,e+1e-7)}},LE=n=>{const t=n.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},DE=n=>{const t=n.createBufferSource(),e=n.createBuffer(1,1,44100);t.buffer=e;try{t.start(0,1)}catch{return!1}return!0},kE=n=>{const t=n.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},Ff=n=>{const t=n.createOscillator();try{t.start(-1)}catch(e){return e instanceof RangeError}return!1},Hv=n=>{const t=n.createBuffer(1,1,44100),e=n.createBufferSource();e.buffer=t,e.start(),e.stop();try{return e.stop(),!0}catch{return!1}},Tf=n=>{const t=n.createOscillator();try{t.stop(-1)}catch(e){return e instanceof RangeError}return!1},RE=n=>{const{port1:t,port2:e}=new MessageChannel;try{t.postMessage(n)}finally{t.close(),e.close()}},HE=n=>{n.start=(t=>(e=0,s=0,r)=>{const i=n.buffer,o=i===null?s:Math.min(i.duration,s);i!==null&&o>i.duration-.5/n.context.sampleRate?t.call(n,e,0,0):t.call(n,e,o,r)})(n.start)},Ov=(n,t)=>{const e=t.createGain();n.connect(e);const s=(r=>()=>{r.call(n,e),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),tA(n,e),n.stop=(r=>{let i=!1;return(o=0)=>{if(i)try{r.call(n,o)}catch{e.gain.setValueAtTime(0,o)}else r.call(n,o),i=!0}})(n.stop)},eA=(n,t)=>e=>{const s={value:n};return Object.defineProperties(e,{currentTarget:s,target:s}),typeof t=="function"?t.call(n,e):t.handleEvent.call(n,e)},OE=Ay(Gi),VE=hy(Gi),WE=E1(su),Vv=new WeakMap,GE=W1(Vv),cs=e1(new Map,new WeakMap),Ts=FE(),Wv=wS(cs,Ns),_f=V1(sn),Re=dE(sn,_f,Pi),KE=vy(Wv,Zt,Re),Yt=q1(nu),pr=qS(Ts),zt=lS(pr),Gv=new WeakMap,Kv=N1(eA),Qa=yS(Ts),Mf=iS(Qa),Qf=oS(Ts),qv=AS(Ts),JA=ES(Ts),de=Wy(ay(wv),dy(OE,VE,fc,WE,pc,sn,GE,Ea,Zt,Gi,ir,Pi,Vl),cs,tS(Yd,pc,sn,Zt,YA,ir),Ns,ru,An,C1(fc,Yd,sn,Zt,YA,Yt,ir,zt),F1(Gv,sn,as),Kv,Yt,Mf,Qf,qv,zt,JA),qE=gy(de,KE,Ns,Wv,Yt,zt),Uf=new WeakSet,wm=BS(Ts),zv=f1(new Uint32Array(1)),Pf=TE(zv,Ns),Nf=_E(zv),$v=By(Uf,cs,An,wm,pr,CE(wm),Pf,Nf),iu=fy(vn),Xv=hE(_f,Ia,Pi),Ls=a1(Xv),nA=bS(iu,cs,LE,DE,kE,Ff,Hv,Tf,HE,ME(Ma),Ov),Ds=uE(G1(Ia),Xv),zE=yy(Ls,nA,Zt,Ds,Re),us=Gy(ly(Bv),Gv,bf,Ky,ey,ny,sy,ry,iy,zd,gv,Qa,Rv),$E=by(de,zE,us,_e,nA,Yt,zt,eA),XE=Qy(de,Uy,Ns,_e,SS(vn,Ma),Yt,zt,Re),YE=t1(Ls,Pv,Zt,Ds,Re),Ki=mE(Vv),jE=Zy(de,us,YE,ru,Pv,Yt,zt,Ki),Jr=gS(Gi,Qf),JE=QE(_e,Jr),Zr=QS(Qa,JE),ZE=r1(Zr,Zt,Re),tx=s1(de,ZE,Zr,Yt,zt),ex=A1(Ta,Zt,Re),nx=o1(de,ex,Ta,Yt,zt,PE),sx=NS(iu,nA,vn,Jr),sA=PS(iu,cs,sx,Ff,Tf),rx=h1(Ls,sA,Zt,Ds,Re),ix=d1(de,us,rx,sA,Yt,zt,eA),Yv=LS(An,Ma),ox=g1(Yv,Zt,Re),Ax=m1(de,ox,Yv,Yt,zt,Ki),ax=S1(Ls,Nv,Zt,Ds,Re),lx=y1(de,us,ax,Nv,Yt,zt,Ki),jv=DS(An),cx=Q1(Ls,jv,Zt,Ds,Re),ux=M1(de,us,cx,jv,An,Yt,zt,Ki),dx=H1(Ls,vn,Zt,Ds,Re),hx=R1(de,us,dx,vn,Yt,zt),fx=OS(ru,_e,_a,An),ou=fE(cs,vn,_a,yE(vn,pr)),px=Z1(nA,Zt,pr,Re,ou),mx=kS(fx),gx=j1(de,mx,px,Yt,zt,Ki),vx=Py(us,Zr,sA,_a,An,Dv,zt,Ma),Jv=new WeakMap,wx=mS(XE,vx,Kv,zt,Jv,eA),Zv=zS(iu,cs,Ff,Hv,Tf,Ov),Bx=iE(Ls,Zv,Zt,Ds,Re),Cx=rE(de,us,Zv,Bx,Yt,zt,eA),tw=c1(nA),bx=tE(tw,_e,vn,kv,Jr),Au=ZS(tw,_e,bx,kv,Jr,Qa,Ma),yx=XS(fc,_e,Zr,vn,_a,Au,An,pc,Dv,Jr),ew=$S(yx),Sx=aE(Ls,Zr,sA,vn,ew,Zt,pr,Ds,Re,ou),Ex=AE(de,us,ew,Sx,Yt,zt,Ki),xx=YS(Ns),Ix=cE(xx,Yt,new WeakSet,NE),Fx=JS(Zr,Ta,vn,Au,An,Jr),nw=jS(Fx,An),Tx=BE(Ls,nw,Zt,Ds,Re),_x=wE(de,us,nw,Tx,Yt,zt),Mx=IE(Au,Zt,Re),Qx=xE(de,_e,Au,Mx,Yt,zt,Ki),sw=cS(Ts),Lf=L1(Ts),rw=new WeakMap,Ux=z1(rw,pr),Px=sw?uy(cs,An,P1(Ts),Lf,D1(oy),Yt,Ux,zt,JA,new WeakMap,new WeakMap,bE(JA,pr),Ts):void 0,Nx=aS(Mf,zt),Lx=B1(Uf,cs,w1,U1,new WeakSet,Yt,Nx,dc,jA,Pf,Nf),iw=jy(Px,qE,$v,$E,jE,tx,nx,ix,Ax,Lx,lx,ux,hx,gx,wx,Cx,Ex,Ix,_x,Qx),Dx=uS(de,VS,Yt,zt),kx=hS(de,WS,Yt,zt),Rx=fS(de,GS,Yt,zt),Hx=KS(_e,zt),Ox=pS(de,Hx,Yt),Vx=My(iw,_e,An,SE,Dx,kx,Rx,Ox,Qa),Df=$1(Jv),Wx=py(Df),ow=l1(Ns),Gx=x1(Df),Aw=T1(Ns),aw=new WeakMap,Kx=O1(aw,as),qx=MS(ow,Ns,_e,Zr,Ta,sA,vn,_a,An,Aw,Lf,Kx,Jr),zx=IS(_e,qx,vn,An,Jr),$x=Yy(Ls,ow,nA,Zr,Ta,sA,vn,Gx,Aw,Lf,Zt,JA,pr,Ds,Re,ou),Xx=K1(rw),Yx=pE(aw),Bm=sw?zy(Wx,de,us,$x,zx,sn,Xx,Yt,zt,JA,UE,Yx,RE,eA):void 0,jx=v1(An,pr),Jx=gE(Uf,cs,_f,Df,ou,dc,Pf,Nf),Zx=nE(iw,cs,_e,jx,Jx),tI=eS(nu,Mf),eI=nS(Cf,Qf),nI=sS(bf,qv),sI=rS(nu,zt);function $n(n){return n===void 0}function _t(n){return n!==void 0}function rI(n){return typeof n=="function"}function lr(n){return typeof n=="number"}function xi(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function iI(n){return typeof n=="boolean"}function _n(n){return Array.isArray(n)}function cr(n){return typeof n=="string"}function Xa(n){return cr(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function vt(n,t){if(!n)throw new Error(t)}function ur(n,t,e=1/0){if(!(t<=n&&n<=e))throw new RangeError(`Value must be within [${t}, ${e}], got: ${n}`)}function lw(n){!n.isOffline&&n.state!=="running"&&Ua('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let cw=!1,Cm=!1;function bm(n){cw=n}function oI(n){$n(n)&&cw&&!Cm&&(Cm=!0,Ua("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let uw=console;function AI(...n){uw.log(...n)}function Ua(...n){uw.warn(...n)}function aI(n){return new Vx(n)}function lI(n,t,e){return new Zx(n,t,e)}const xn=typeof self=="object"?self:null,cI=xn&&(xn.hasOwnProperty("AudioContext")||xn.hasOwnProperty("webkitAudioContext"));function uI(n,t,e){return vt(_t(Bm),"AudioWorkletNode only works in a secure context (https or localhost)"),new(n instanceof(xn==null?void 0:xn.BaseAudioContext)?xn==null?void 0:xn.AudioWorkletNode:Bm)(n,t,e)}function ds(n,t,e,s){var r=arguments.length,i=r<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,t,e,s);else for(var A=n.length-1;A>=0;A--)(o=n[A])&&(i=(r<3?o(i):r>3?o(t,e,i):o(t,e))||i);return r>3&&i&&Object.defineProperty(t,e,i),i}function ge(n,t,e,s){function r(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function A(c){try{l(s.next(c))}catch(u){o(u)}}function a(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?i(c.value):r(c.value).then(A,a)}l((s=s.apply(n,t||[])).next())})}class dI{constructor(t,e,s,r){this._callback=t,this._type=e,this._minimumUpdateInterval=Math.max(128/(r||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new Worker(e);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){var e;this._updateInterval=Math.max(t,this._minimumUpdateInterval),this._type==="worker"&&((e=this._worker)===null||e===void 0||e.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Ni(n){return nI(n)}function Or(n){return eI(n)}function Wl(n){return sI(n)}function io(n){return tI(n)}function hI(n){return n instanceof $v}function fI(n,t){return n==="value"||Ni(t)||Or(t)||hI(t)}function Ii(n,...t){if(!t.length)return n;const e=t.shift();if(xi(n)&&xi(e))for(const s in e)fI(s,e[s])?n[s]=e[s]:xi(e[s])?(n[s]||Object.assign(n,{[s]:{}}),Ii(n[s],e[s])):Object.assign(n,{[s]:e[s]});return Ii(n,...t)}function pI(n,t){return n.length===t.length&&n.every((e,s)=>t[s]===e)}function pt(n,t,e=[],s){const r={},i=Array.from(t);if(xi(i[0])&&s&&!Reflect.has(i[0],s)&&(Object.keys(i[0]).some(A=>Reflect.has(n,A))||(Ii(r,{[s]:i[0]}),e.splice(e.indexOf(s),1),i.shift())),i.length===1&&xi(i[0]))Ii(r,i[0]);else for(let o=0;o<e.length;o++)_t(i[o])&&(r[e[o]]=i[o]);return Ii(n,r)}function mI(n){return n.constructor.getDefaults()}function So(n,t){return $n(n)?t:n}function eh(n,t){return t.forEach(e=>{Reflect.has(n,e)&&delete n[e]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class mr{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||xn&&this.toString()===xn.TONE_DEBUG_CLASS)&&AI(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}mr.version=mv;const kf=1e-6;function Oo(n,t){return n>t+kf}function nh(n,t){return Oo(n,t)||ss(n,t)}function wc(n,t){return n+kf<t}function ss(n,t){return Math.abs(n-t)<kf}function gI(n,t,e){return Math.max(Math.min(n,e),t)}class Xn extends mr{constructor(){super(),this.name="Timeline",this._timeline=[];const t=pt(Xn.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(vt(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];vt(nh(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(t){const e=this._timeline.indexOf(t);return e!==-1&&this._timeline.splice(e,1),this}get(t,e="time"){const s=this._search(t,e);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const s=this._search(t,e);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const s=this._search(t);return s-1>=0?this._timeline[s-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(ss(this._timeline[e].time,t)){for(let s=e;s>=0&&ss(this._timeline[s].time,t);s--)e=s;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else this._timeline.length===1&&nh(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(this._timeline.length===0)return-1;let s=0;const r=this._timeline.length;let i=r;if(r>0&&this._timeline[r-1][e]<=t)return r-1;for(;s<i;){let o=Math.floor(s+(i-s)/2);const A=this._timeline[o],a=this._timeline[o+1];if(ss(A[e],t)){for(let l=o;l<this._timeline.length;l++){const c=this._timeline[l];if(ss(c[e],t))o=l;else break}return o}else{if(wc(A[e],t)&&Oo(a[e],t))return o;Oo(A[e],t)?i=o:s=o+1}}return-1}_iterate(t,e=0,s=this._timeline.length-1){this._timeline.slice(e,s+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const s=this._search(t);return s!==-1&&this._iterate(e,0,s),this}forEachAfter(t,e){const s=this._search(t);return this._iterate(e,s+1),this}forEachBetween(t,e,s){let r=this._search(t),i=this._search(e);return r!==-1&&i!==-1?(this._timeline[r].time!==t&&(r+=1),this._timeline[i].time===e&&(i-=1),this._iterate(s,r,i)):r===-1&&this._iterate(s,0,i),this}forEachFrom(t,e){let s=this._search(t);for(;s>=0&&this._timeline[s].time>=t;)s--;return this._iterate(e,s+1),this}forEachAtTime(t,e){const s=this._search(t);if(s!==-1&&ss(this._timeline[s].time,t)){let r=s;for(let i=s;i>=0&&ss(this._timeline[i].time,t);i--)r=i;this._iterate(i=>{e(i)},r,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const dw=[];function au(n){dw.push(n)}function vI(n){dw.forEach(t=>t(n))}const hw=[];function lu(n){hw.push(n)}function wI(n){hw.forEach(t=>t(n))}let Rf=class fw extends mr{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(r=>{$n(this._events)&&(this._events={}),this._events.hasOwnProperty(r)||(this._events[r]=[]),this._events[r].push(e)}),this}once(t,e){const s=(...r)=>{e(...r),this.off(t,s)};return this.on(t,s),this}off(t,e){return t.split(/\W+/).forEach(r=>{if($n(this._events)&&(this._events={}),this._events.hasOwnProperty(r))if($n(e))this._events[r]=[];else{const i=this._events[r];for(let o=i.length-1;o>=0;o--)i[o]===e&&i.splice(o,1)}}),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const s=this._events[t].slice(0);for(let r=0,i=s.length;r<i;r++)s[r].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach(e=>{const s=Object.getOwnPropertyDescriptor(fw.prototype,e);Object.defineProperty(t.prototype,e,s)})}dispose(){return super.dispose(),this._events=void 0,this}};class pw extends Rf{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}let cu=class mw extends pw{constructor(){var t,e;super(),this.name="Context",this._constants=new Map,this._timeouts=new Xn,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=pt(mw.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((t=arguments[0])===null||t===void 0?void 0:t.latencyHint)||""):(this._context=aI({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new dI(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((e=arguments[0])===null||e===void 0)&&e.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(vI(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,s){return this._context.createBuffer(t,e,s)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,s){return this._context.createPeriodicWave(t,e,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return vt(io(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return vt(io(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return vt(io(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){vt(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){vt(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){vt(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){vt(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return uI(this.rawContext,t,e)}addAudioWorkletModule(t){return ge(this,void 0,void 0,function*(){vt(_t(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(t)),yield this._workletPromise})}workletsAreReady(){return ge(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get lookAhead(){return this._lookAhead}set lookAhead(t){this._lookAhead=t,this.updateInterval=t?t/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return io(this._context)?this._context.resume():Promise.resolve()}close(){return ge(this,void 0,void 0,function*(){io(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&wI(this)})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),s=e.getChannelData(0);for(let i=0;i<s.length;i++)s[i]=t;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=e,r.loop=!0,r.start(0),this._constants.set(t,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this.close(),this}_timeoutLoop(){const t=this.now();this._timeouts.forEachBefore(t,e=>{e.callback(),this._timeouts.remove(e)})}setTimeout(t,e){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:s+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const s=++this._timeoutIds,r=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),r()},id:s,time:i+e})};return r(),s}};class BI extends pw{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,s){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t){return ge(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}}function Lt(n,t){_n(t)?t.forEach(e=>Lt(n,e)):Object.defineProperty(n,t,{enumerable:!0,writable:!1})}function Hf(n,t){_n(t)?t.forEach(e=>Hf(n,e)):Object.defineProperty(n,t,{writable:!0})}const Ht=()=>{};class ne extends mr{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ht;const t=pt(ne.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,cr(t.url)?this.load(t.url).catch(t.onerror):t.url&&this.set(t.url)}static getDefaults(){return{onerror:Ht,onload:Ht,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ke().sampleRate}set(t){return t instanceof ne?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return ge(this,void 0,void 0,function*(){const e=ne.load(t).then(s=>{this.set(s),this.onload(this)});ne.downloads.push(e);try{yield e}finally{const s=ne.downloads.indexOf(e);ne.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=_n(t)&&t[0].length>0,s=e?t.length:1,r=e?t[0].length:t.length,i=Ke(),o=i.createBuffer(s,r,i.sampleRate),A=!e&&s===1?[t]:t;for(let a=0;a<s;a++)o.copyToChannel(A[a],a);return this._buffer=o,this}toMono(t){if(lr(t))this.fromArray(this.toArray(t));else{let e=new Float32Array(this.length);const s=this.numberOfChannels;for(let r=0;r<s;r++){const i=this.toArray(r);for(let o=0;o<i.length;o++)e[o]+=i[o]}e=e.map(r=>r/s),this.fromArray(e)}return this}toArray(t){if(lr(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{const e=[];for(let s=0;s<this.numberOfChannels;s++)e[s]=this.getChannelData(s);return e}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){vt(this.loaded,"Buffer is not loaded");const s=Math.floor(t*this.sampleRate),r=Math.floor(e*this.sampleRate);vt(s<r,"The start time must be less than the end time");const i=r-s,o=Ke().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let A=0;A<this.numberOfChannels;A++)o.copyToChannel(this.getChannelData(A).subarray(s,r),A);return new ne(o)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new ne().fromArray(t)}static fromUrl(t){return ge(this,void 0,void 0,function*(){return yield new ne().load(t)})}static load(t){return ge(this,void 0,void 0,function*(){const e=ne.baseUrl===""||ne.baseUrl.endsWith("/")?ne.baseUrl:ne.baseUrl+"/",s=yield fetch(e+t);if(!s.ok)throw new Error(`could not load url: ${t}`);const r=yield s.arrayBuffer();return yield Ke().decodeAudioData(r)})}static supportsType(t){const e=t.split("."),s=e[e.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return ge(this,void 0,void 0,function*(){for(yield Promise.resolve();ne.downloads.length;)yield ne.downloads[0]})}}ne.baseUrl="";ne.downloads=[];class Of extends cu{constructor(){super({clockSource:"offline",context:Wl(arguments[0])?arguments[0]:lI(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Wl(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Wl(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return ge(this,void 0,void 0,function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const s=Math.floor(this.sampleRate/128);t&&e%s===0&&(yield new Promise(r=>setTimeout(r,1)))}})}render(){return ge(this,arguments,void 0,function*(t=!0){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new ne(e)})}close(){return Promise.resolve()}}const gw=new BI;let di=gw;function Ke(){return di===gw&&cI&&vw(new cu),di}function vw(n,t=!1){t&&di.dispose(),io(n)?di=new cu(n):Wl(n)?di=new Of(n):di=n}function Bc(){return di.resume()}if(xn&&!xn.TONE_SILENCE_LOGGING){const t=` * Tone.js v${mv} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function CI(n){return Math.pow(10,n/20)}function ww(n){return 20*(Math.log(n)/Math.LN10)}function Bw(n){return Math.pow(2,n/12)}let uu=440;function bI(){return uu}function yI(n){uu=n}function hi(n){return Math.round(Cw(n))}function Cw(n){return 69+12*Math.log2(n/uu)}function bw(n){return uu*Math.pow(2,(n-69)/12)}class Vf extends mr{constructor(t,e,s){super(),this.defaultUnits="s",this._val=e,this._units=s,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const s=parseInt(t,10),r=e==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/s)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(Math.floor(e)*3))},regexp:/^(\d+)t$/i},tr:{method:(t,e,s)=>{let r=0;return t&&t!=="0"&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(r+=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(r+=this._beatsToUnits(parseFloat(s)/4)),r},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Vf&&this.fromType(this._val),$n(this._val))return this._noArg();if(cr(this._val)&&$n(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(xi(this._val)){let t=0;for(const e in this._val)if(_t(this._val[e])){const s=this._val[e],r=new this.constructor(this.context,e).valueOf()*s;t+=r}return t}if(_t(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}else return cr(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Gn extends Vf{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Gn(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const s=new this.constructor(this.context,t).valueOf(),r=this.valueOf(),A=Math.round(r/s)*s-r;return r+A*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let i=1;i<9;i++){const o=Math.pow(2,i);e.push(o+"n."),e.push(o+"n"),e.push(o+"t")}e.push("0");let s=e[0],r=new Gn(this.context,e[0]).toSeconds();return e.forEach(i=>{const o=new Gn(this.context,i).toSeconds();Math.abs(o-t)<Math.abs(r-t)&&(s=i,r=o)}),s}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const s=Math.floor(e/this._getTimeSignature());let r=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=r.toString();return i.length>3&&(r=parseFloat(parseFloat(i).toFixed(3))),[s,e,r].join(":")}toTicks(){const t=this._beatsToUnits(1);return this.valueOf()/t*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return hi(this.toFrequency())}_now(){return this.context.now()}}function Ce(n,t){return new Gn(Ke(),n,t)}class In extends Gn{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return bI()}static set A4(t){yI(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return this.defaultUnits==="midi"?t:In.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(t,e){const r=SI[t.toLowerCase()]+(parseInt(e,10)+1)*12;return this.defaultUnits==="midi"?r:In.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,s){let r=1;return t&&t!=="0"&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(r*=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(r*=this._beatsToUnits(parseFloat(s)/4)),r}}})}transpose(t){return new In(this.context,this.valueOf()*Bw(t))}harmonize(t){return t.map(e=>this.transpose(e))}toMidi(){return hi(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/In.A4);let s=Math.round(12*e)+57;const r=Math.floor(s/12);return r<0&&(s+=-12*r),EI[s%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(t*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return bw(t)}static ftom(t){return hi(t)}}const SI={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},EI=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class _A extends Gn{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class pn extends mr{constructor(){super();const t=pt(pn.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Ke()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return oI(t),new Gn(this.context,t).toSeconds()}toFrequency(t){return new In(this.context,t).toFrequency()}toTicks(t){return new _A(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach(s=>{$n(t[s])&&delete e[s]}),e}get(){const t=mI(this);return Object.keys(t).forEach(e=>{if(Reflect.has(this,e)){const s=this[e];_t(s)&&_t(s.value)&&_t(s.setValueAtTime)?t[e]=s.value:s instanceof pn?t[e]=s._getPartialProperties(t[e]):_n(s)||lr(s)||cr(s)||iI(s)?t[e]=s:delete t[e]}}),t}set(t){return Object.keys(t).forEach(e=>{Reflect.has(this,e)&&_t(this[e])&&(this[e]&&_t(this[e].value)&&_t(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof pn?this[e].set(t[e]):this[e]=t[e])}),this}}class Wf extends Xn{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return e!==null?e.state:this._initial}setStateAtTime(t,e,s){return ur(e,0),this.add(Object.assign({},s,{state:t,time:e})),this}getLastState(t,e){const s=this._search(e);for(let r=s;r>=0;r--){const i=this._timeline[r];if(i.state===t)return i}}getNextState(t,e){const s=this._search(e);if(s!==-1)for(let r=s;r<this._timeline.length;r++){const i=this._timeline[r];if(i.state===t)return i}}}class Ft extends pn{constructor(){const t=pt(Ft.getDefaults(),arguments,["param","units","convert"]);for(super(t),this.name="Param",this.overridden=!1,this._minOutput=1e-7,vt(_t(t.param)&&(Ni(t.param)||t.param instanceof Ft),"param must be an AudioParam");!Ni(t.param);)t.param=t.param._param;this._swappable=_t(t.swappable)?t.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Xn(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,_t(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(pn.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return _t(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return _t(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return _t(this.maxValue)&&_t(this.minValue)&&ur(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?CI(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&this.units==="decibels"?ww(t):t}setValueAtTime(t,e){const s=this.toSeconds(e),r=this._fromType(t);return vt(isFinite(r)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(r),this.log(this.units,"setValueAtTime",t,s),this._events.add({time:s,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,s),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),s=this._events.getAfter(e),r=this._events.get(e);let i=this._initialValue;if(r===null)i=this._initialValue;else if(r.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(r.time);let A;o===null?A=this._initialValue:A=o.value,r.type==="setTargetAtTime"&&(i=this._exponentialApproach(r.time,A,r.value,r.constant,e))}else if(s===null)i=r.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=r.value;if(r.type==="setTargetAtTime"){const A=this._events.getBefore(r.time);A===null?o=this._initialValue:o=A.value}s.type==="linearRampToValueAtTime"?i=this._linearInterpolate(r.time,o,s.time,s.value,e):i=this._exponentialInterpolate(r.time,o,s.time,s.value,e)}else i=r.value;return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),this._fromType(e)===0&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const s=this._fromType(t),r=this.toSeconds(e);return vt(isFinite(s)&&isFinite(r),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this._events.add({time:r,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",t,r),this._param.linearRampToValueAtTime(s,r),this}exponentialRampToValueAtTime(t,e){let s=this._fromType(t);s=ss(s,0)?this._minOutput:s,this._assertRange(s);const r=this.toSeconds(e);return vt(isFinite(s)&&isFinite(r),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",t,r),this._param.exponentialRampToValueAtTime(s,r),this}exponentialRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(t,s+this.toSeconds(e)),this}linearRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(t,s+this.toSeconds(e)),this}targetRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(t,s,e),this}exponentialApproachValueAtTime(t,e,s){e=this.toSeconds(e),s=this.toSeconds(s);const r=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(t,e,r),this.cancelAndHoldAtTime(e+s*.9),this.linearRampToValueAtTime(t,e+s),this}setTargetAtTime(t,e,s){const r=this._fromType(t);vt(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(r),vt(isFinite(r)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:s,time:i,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",t,i,s),this._param.setTargetAtTime(r,i,s),this}setValueCurveAtTime(t,e,s,r=1){s=this.toSeconds(s),e=this.toSeconds(e);const i=this._fromType(t[0])*r;this.setValueAtTime(this._toType(i),e);const o=s/(t.length-1);for(let A=1;A<t.length;A++){const a=this._fromType(t[A])*r;this.linearRampToValueAtTime(this._toType(a),e+A*o)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return vt(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),s=this._fromType(this.getValueAtTime(e));vt(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+s);const r=this._events.get(e),i=this._events.getAfter(e);return r&&ss(r.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),e):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),e)),this._events.add({time:e,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,e),this}rampTo(t,e=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(t,e,s):this.linearRampTo(t,e,s),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const s=this._events.get(e);if(s&&s.type==="setTargetAtTime"){const r=this._events.getAfter(s.time),i=r?r.time:e+2,o=(i-e)/10;for(let A=e;A<i;A+=o)t.linearRampToValueAtTime(this.getValueAtTime(A),A)}return this._events.forEachAfter(this.context.currentTime,r=>{r.type==="cancelScheduledValues"?t.cancelScheduledValues(r.time):r.type==="setTargetAtTime"?t.setTargetAtTime(r.value,r.time,r.constant):t[r.type](r.value,r.time)}),this}setParam(t){vt(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,s,r,i){return s+(e-s)*Math.exp(-(i-t)/r)}_linearInterpolate(t,e,s,r,i){return e+(r-e)*((i-t)/(s-t))}_exponentialInterpolate(t,e,s,r,i){return e*Math.pow(r/e,(i-t)/(s-t))}}class ft extends pn{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return _t(this.input)?Ni(this.input)||this.input instanceof Ft?1:this.input.numberOfInputs:0}get numberOfOutputs(){return _t(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return _t(t)&&(t instanceof ft||Or(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(s=>{s.channelCount=t.channelCount,s.channelCountMode=t.channelCountMode,s.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();vt(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,s=0){return dr(this,t,e,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Ua("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,s=0){return yw(this,t,e,s),this}chain(...t){return ZA(this,...t),this}fan(...t){return t.forEach(e=>this.connect(e)),this}dispose(){return super.dispose(),_t(this.input)&&(this.input instanceof ft?this.input.dispose():Or(this.input)&&this.input.disconnect()),_t(this.output)&&(this.output instanceof ft?this.output.dispose():Or(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function ZA(...n){const t=n.shift();n.reduce((e,s)=>(e instanceof ft?e.connect(s):Or(e)&&dr(e,s),s),t)}function dr(n,t,e=0,s=0){for(vt(_t(n),"Cannot connect from undefined node"),vt(_t(t),"Cannot connect to undefined node"),(t instanceof ft||Or(t))&&vt(t.numberOfInputs>0,"Cannot connect to node with no inputs"),vt(n.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof ft||t instanceof Ft;)_t(t.input)&&(t=t.input);for(;n instanceof ft;)_t(n.output)&&(n=n.output);Ni(t)?n.connect(t,e):n.connect(t,e,s)}function yw(n,t,e=0,s=0){if(_t(t))for(;t instanceof ft;)t=t.input;for(;!Or(n);)_t(n.output)&&(n=n.output);Ni(t)?n.disconnect(t,e):Or(t)?n.disconnect(t,e,s):n.disconnect()}class Mt extends ft{constructor(){const t=pt(Mt.getDefaults(),arguments,["gain","units"]);super(t),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Ft({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),Lt(this,"gain")}static getDefaults(){return Object.assign(ft.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Vo extends ft{constructor(t){super(t),this.onended=Ht,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Mt({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const s=this.toSeconds(e);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(ft.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ht})}_startGain(t,e=1){vt(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(e,t+s):this._gainNode.gain.exponentialApproachValueAtTime(e,t,s)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){vt(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.now()),e>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?e*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ht&&(this.onended(this),this.onended=Ht,!this.context.isOffline)){const t=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(t):setTimeout(t,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),vt(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Ht,this}}class Gf extends Vo{constructor(){const t=pt(Gf.getDefaults(),arguments,["offset"]);super(t),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),dr(this._source,this._gainNode),this.offset=new Ft({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Vo.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class $t extends ft{constructor(){const t=pt($t.getDefaults(),arguments,["value","units"]);super(t),this.name="Signal",this.override=!0,this.output=this._constantSource=new Gf({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ft.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,s=0){return du(this,t,e,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,s){return this._param.exponentialRampTo(t,e,s),this}linearRampTo(t,e,s){return this._param.linearRampTo(t,e,s),this}targetRampTo(t,e,s){return this._param.targetRampTo(t,e,s),this}exponentialApproachValueAtTime(t,e,s){return this._param.exponentialApproachValueAtTime(t,e,s),this}setTargetAtTime(t,e,s){return this._param.setTargetAtTime(t,e,s),this}setValueCurveAtTime(t,e,s,r){return this._param.setValueCurveAtTime(t,e,s,r),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,s){return this._param.rampTo(t,e,s),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function du(n,t,e,s){(t instanceof Ft||Ni(t)||t instanceof $t&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof $t&&(t.overridden=!0)),dr(n,t,e,s)}class Kf extends Ft{constructor(){const t=pt(Kf.getDefaults(),arguments,["value"]);super(t),this.name="TickParam",this._events=new Xn(1/0),this._multiplier=1,this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ft.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,s){e=this.toSeconds(e),this.setRampPoint(e);const r=this._fromType(t),i=this._events.get(e),o=Math.round(Math.max(1/s,1));for(let A=0;A<=o;A++){const a=s*A+e,l=this._exponentialApproach(i.time,i.value,r,s,a);this.linearRampToValueAtTime(this._toType(l),a)}return this}setValueAtTime(t,e){const s=this.toSeconds(e);super.setValueAtTime(t,e);const r=this._events.get(s),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,s);return r.ticks=Math.max(o,0),this}linearRampToValueAtTime(t,e){const s=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const r=this._events.get(s),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,s);return r.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const s=this._fromType(t),r=this._events.get(e),i=Math.round(Math.max((e-r.time)*10,1)),o=(e-r.time)/i;for(let A=0;A<=i;A++){const a=o*A+r.time,l=this._exponentialInterpolate(r.time,r.value,e,s,a);this.linearRampToValueAtTime(this._toType(l),a)}return this}_getTicksUntilEvent(t,e){if(t===null)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if($n(t.ticks)){const o=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(o,t.time)}const s=this._fromType(this.getValueAtTime(t.time));let r=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&i.type==="setValueAtTime"&&(r=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(s+r)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),s=this._events.get(e);return Math.max(this._getTicksUntilEvent(s,e),0)}getDurationOfTicks(t,e){const s=this.toSeconds(e),r=this.getTicksAtTime(e);return this.getTimeOfTick(r+t)-s}getTimeOfTick(t){const e=this._events.get(t,"ticks"),s=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&s&&s.type==="linearRampToValueAtTime"&&e.value!==s.value){const r=this._fromType(this.getValueAtTime(e.time)),o=(this._fromType(this.getValueAtTime(s.time))-r)/(s.time-e.time),A=Math.sqrt(Math.pow(r,2)-2*o*(e.ticks-t)),a=(-r+A)/o,l=(-r-A)/o;return(a>0?a:l)+e.time}else return e?e.value===0?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const s=this.toSeconds(e),r=this.toSeconds(t),i=this.getTicksAtTime(s);return this.getTicksAtTime(s+r)-i}_fromType(t){return this.units==="bpm"&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return this.units==="bpm"&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class qf extends $t{constructor(){const t=pt(qf.getDefaults(),arguments,["value"]);super(t),this.name="TickSignal",this.input=this._param=new Kf({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign($t.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class zf extends pn{constructor(){const t=pt(zf.getDefaults(),arguments,["frequency"]);super(t),this.name="TickSource",this._state=new Wf,this._tickOffset=new Xn,this._ticksAtTime=new Xn,this._secondsAtTime=new Xn,this.frequency=new qf({context:this.context,units:t.units,value:t.frequency}),Lt(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},pn.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const s=this.toSeconds(t);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),_t(e)&&this.setTicksAtTime(e,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(t){const e=this.toSeconds(t);if(this._state.getValueAtTime(e)==="stopped"){const s=this._state.get(e);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e)),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),s=this._state.getLastState("stopped",e),r=this._ticksAtTime.get(e),i={state:"paused",time:e};this._state.add(i);let o=r||s,A=r?r.ticks:0,a=null;return this._state.forEachBetween(o.time,e+this.sampleTime,l=>{let c=o.time;const u=this._tickOffset.get(l.time);u&&u.time>=o.time&&(A=u.ticks,c=u.time),o.state==="started"&&l.state!=="started"&&(A+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(c),l.time!==i.time&&(a={state:l.state,time:l.time,ticks:A})),o=l}),this._state.remove(i),a&&this._ticksAtTime.add(a),A}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),s=this.frequency.timeToTicks(t,e);this.setTicksAtTime(s,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);const r=this._secondsAtTime.get(t);let i=r||e,o=r?r.seconds:0,A=null;return this._state.forEachBetween(i.time,t+this.sampleTime,a=>{let l=i.time;const c=this._tickOffset.get(a.time);c&&c.time>=i.time&&(o=c.seconds,l=c.time),i.state==="started"&&a.state!=="started"&&(o+=a.time-l,a.time!==s.time&&(A={state:a.state,time:a.time,seconds:o})),i=a}),this._state.remove(s),A&&this._secondsAtTime.add(A),o}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const s=this._tickOffset.get(e),r=this._state.get(e),i=Math.max(s.time,r.time),o=this.frequency.getTicksAtTime(i)+t-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(t,e,s){let r=this._state.get(t);this._state.forEachBetween(t,e,o=>{r&&r.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(r.time,t),o.time-this.sampleTime,s),r=o});let i=null;if(r&&r.state==="started"){const o=Math.max(r.time,t),A=this.frequency.getTicksAtTime(o),a=this.frequency.getTicksAtTime(r.time),l=A-a;let c=Math.ceil(l)-l;c=ss(c,1)?0:c;let u=this.frequency.getTimeOfTick(A+c);for(;u<e;){try{s(u,Math.round(this.getTicksAtTime(u)))}catch(d){i=d;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class hu extends pn{constructor(){const t=pt(hu.getDefaults(),arguments,["callback","frequency"]);super(t),this.name="Clock",this.callback=Ht,this._lastUpdate=0,this._state=new Wf("stopped"),this._boundLoop=this._loop.bind(this),this.callback=t.callback,this._tickSource=new zf({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Lt(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(pn.getDefaults(),{callback:Ht,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){lw(this.context);const s=this.toSeconds(t);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,e),s<this._lastUpdate&&this.emit("start",s,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const s=this.toSeconds(e),r=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(r+t,s)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,s=>{switch(s.state){case"started":const r=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,r);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(t,e,(s,r)=>{this.callback(s,r)}))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Rf.mixin(hu);class $f extends ft{constructor(){const t=pt($f.getDefaults(),arguments,["delayTime","maxDelay"]);super(t),this.name="Delay";const e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new Ft({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),Lt(this,"delayTime")}static getDefaults(){return Object.assign(ft.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class ks extends ft{constructor(){const t=pt(ks.getDefaults(),arguments,["volume"]);super(t),this.name="Volume",this.input=this.output=new Mt({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,Lt(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Xf extends ft{constructor(){const t=pt(Xf.getDefaults(),arguments);super(t),this.name="Destination",this.input=new ks({context:this.context}),this.output=new Mt({context:this.context}),this.volume=this.input.volume,ZA(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),ZA(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}au(n=>{n.destination=new Xf({context:n})});lu(n=>{n.destination.dispose()});class xI extends ft{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ft({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ft({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ft({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ft({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ft({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ft({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ft({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ft({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ft({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ft.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}au(n=>{n.listener=new xI({context:n})});lu(n=>{n.listener.dispose()});class fu extends mr{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=pt(fu.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(e=>{this._loadingCount++;const s=t.urls[e];this.add(e,s,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Ht,onload:Ht,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return vt(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,this._loadingCount===0&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,e])=>e.loaded)}add(t,e,s=Ht,r=Ht){return cr(e)?(this.baseUrl&&e.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(t.toString(),new ne(this.baseUrl+e,s,r))):this._buffers.set(t.toString(),new ne(e,s,r)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class ta extends In{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return hi(super._frequencyToUnits(t))}_ticksToUnits(t){return hi(super._ticksToUnits(t))}_beatsToUnits(t){return hi(super._beatsToUnits(t))}_secondsToUnits(t){return hi(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return bw(this.toMidi())}transpose(t){return new ta(this.context,this.toMidi()+t)}}function II(n,t){return new ta(Ke(),n,t)}class uo extends _A{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class FI extends pn{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Xn,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;this._events.forEachBefore(t+this.anticipation,e=>{t-e.time<=this.expiration&&e.callback(),this._events.remove(e)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}au(n=>{n.draw=new FI({context:n})});lu(n=>{n.draw.dispose()});class TI extends mr{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){vt(_t(t.time),"Events must have a time property"),vt(_t(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new _I(t.time,t.time+t.duration,t);for(this._root===null?this._root=e:this._root.insert(e),this._length++;e!==null;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(this._root!==null){const e=[];this._root.search(t.time,e);for(const s of e)if(s.event===t){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,e=>this.remove(e)),this}_setRoot(t){this._root=t,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(t,e){t.parent!==null?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(t.left===null&&t.right===null)this._replaceNodeInParent(t,null);else if(t.right===null)this._replaceNodeInParent(t,t.left);else if(t.left===null)this._replaceNodeInParent(t,t.right);else{const e=t.getBalance();let s,r=null;if(e>0)if(t.left.right===null)s=t.left,s.right=t.right,r=s;else{for(s=t.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,r=s.parent,s.left=t.left,s.right=t.right)}else if(t.right.left===null)s=t.right,s.left=t.left,r=s;else{for(s=t.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,r=s.parent,s.left=t.left,s.right=t.right)}t.parent!==null?t.isLeftChild()?t.parent.left=s:t.parent.right=s:this._setRoot(s),r&&this._rebalance(r)}t.dispose()}_rotateLeft(t){const e=t.parent,s=t.isLeftChild(),r=t.right;r&&(t.right=r.left,r.left=t),e!==null?s?e.left=r:e.right=r:this._setRoot(r)}_rotateRight(t){const e=t.parent,s=t.isLeftChild(),r=t.left;r&&(t.left=r.right,r.right=t),e!==null?s?e.left=r:e.right=r:this._setRoot(r)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(this._root!==null){const e=[];if(this._root.search(t,e),e.length>0){let s=e[0];for(let r=1;r<e.length;r++)e[r].low>s.low&&(s=e[r]);return s.event}}return null}forEach(t){if(this._root!==null){const e=[];this._root.traverse(s=>e.push(s)),e.forEach(s=>{s.event&&t(s.event)})}return this}forEachAtTime(t,e){if(this._root!==null){const s=[];this._root.search(t,s),s.forEach(r=>{r.event&&e(r.event)})}return this}forEachFrom(t,e){if(this._root!==null){const s=[];this._root.searchAfter(t,s),s.forEach(r=>{r.event&&e(r.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class _I{constructor(t,e,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?this.left===null?this.left=t:this.left.insert(t):this.right===null?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(this.left!==null&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),!(this.low>t)&&this.right!==null&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),this.left!==null&&this.left.searchAfter(t,e)),this.right!==null&&this.right.searchAfter(t,e)}traverse(t){t(this),this.left!==null&&this.left.traverse(t),this.right!==null&&this.right.traverse(t)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return this.left!==null&&this.right!==null?t=this.left.height-this.right.height:this.left!==null?t=this.left.height+1:this.right!==null&&(t=-(this.right.height+1)),t}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class MI extends mr{constructor(t){super(),this.name="TimelineValue",this._timeline=new Xn({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class _s extends ft{constructor(){super(pt(_s.getDefaults(),arguments,["context"]))}connect(t,e=0,s=0){return du(this,t,e,s),this}}class rA extends _s{constructor(){const t=pt(rA.getDefaults(),arguments,["mapping","length"]);super(t),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,_n(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):rI(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign($t.getDefaults(),{length:1024})}setMap(t,e=1024){const s=new Float32Array(e);for(let r=0,i=e;r<i;r++){const o=r/(i-1)*2-1;s[r]=t(o,r)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){const e=["none","2x","4x"].some(s=>s.includes(t));vt(e,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Yf extends _s{constructor(){const t=pt(Yf.getDefaults(),arguments,["value"]);super(t),this.name="Pow",this._exponentScaler=this.input=this.output=new rA({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(_s.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class $r{constructor(t,e){this.id=$r._eventId++,this._remainderTime=0;const s=Object.assign($r.getDefaults(),e);this.transport=t,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:Ht,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){const e=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*e),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}$r._eventId=0;class jf extends $r{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(jf.getDefaults(),e);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},$r.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvent(){return wc(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new uo(this.context,this._nextTick).toSeconds()):-1}_createEvents(t){wc(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new uo(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const e=this.transport.getTicksAtTime(t);Oo(e,this.time)&&(this._nextTick=this.floatTime+Math.ceil((e-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class pu extends pn{constructor(){const t=pt(pu.getDefaults(),arguments);super(t),this.name="Transport",this._loop=new MI(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Xn,this._repeatedEvents=new TI,this._syncedSignals=[],this._swingAmount=0,this._ppq=t.ppq,this._clock=new hu({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),Lt(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(pn.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!==0&&e%(this._swingTicks*2)!==0){const s=e%(this._swingTicks*2)/(this._swingTicks*2),r=Math.sin(s*Math.PI)*this._swingAmount;t+=new uo(this.context,this._swingTicks*2/3).toSeconds()*r}bm(!0),this._timeline.forEachAtTime(e,s=>s.invoke(t)),bm(!1)}schedule(t,e){const s=new $r(this,{callback:t,time:new _A(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(t,e,s,r=1/0){const i=new jf(this,{callback:t,duration:new Gn(this.context,r).toTicks(),interval:new Gn(this.context,e).toTicks(),time:new _A(this.context,s).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const s=new $r(this,{callback:t,once:!0,time:new _A(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(e,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new uo(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){this.context.resume();let s;return _t(e)&&(s=this.toTicks(e)),this._clock.start(t,s),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!=="started"?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){_n(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Gn(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Gn(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new uo(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new uo(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),s=this._clock.frequency.timeToTicks(t,e);this.ticks=s}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(e),r=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,e),i=e+r;this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this.emit("ticks",e),this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return this._clock.getTicksAtTime(t)}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),this.state!=="started")return 0;{const e=this.now(),s=this.getTicksAtTime(e),r=t-s%t;return this._clock.nextTickTime(r,e)}}syncSignal(t,e){const s=this.now();let r=this.bpm,i=1/(60/r.getValueAtTime(s)/this.PPQ),o=[];if(t.units==="time"){const a=.015625/i,l=new Mt(a),c=new Yf(-1),u=new Mt(a);r.chain(l,c,u),r=u,i=1/i,o=[l,c,u]}e||(t.getValueAtTime(s)!==0?e=t.getValueAtTime(s)/i:e=0);const A=new Mt(e);return r.connect(A),A.connect(t._param),o.push(A),this._syncedSignals.push({initial:t.value,nodes:o,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const s=this._syncedSignals[e];s.signal===t&&(s.nodes.forEach(r=>r.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Hf(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Rf.mixin(pu);au(n=>{n.transport=new pu({context:n})});lu(n=>{n.transport.dispose()});class wn extends ft{constructor(t){super(t),this.input=void 0,this._state=new Wf("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ht,this._syncedStop=Ht,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ks({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,Lt(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,onstop:Ht,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,s){let r=$n(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(r=this._clampToCurrentTime(r),!this._synced&&this._state.getValueAtTime(r)==="started")vt(Oo(r,this._state.get(r).time),"Start time must be strictly greater than previous start time"),this._state.cancel(r),this._state.setStateAtTime("started",r),this.log("restart",r),this.restart(r,e,s);else if(this.log("start",r),this._state.setStateAtTime("started",r),this._synced){const i=this._state.get(r);i&&(i.offset=this.toSeconds(So(e,0)),i.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(A=>{this._start(A,e,s)},r);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>r&&this._syncedStart(this.now(),this.context.transport.seconds)}else lw(this.context),this._start(r,e,s);return this}stop(t){let e=$n(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),this._state.getValueAtTime(e)==="started"||_t(this._state.getNextState("started",e))){if(this.log("stop",e),!this._synced)this._stop(e);else{const s=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(s)}this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,s){return t=this.toSeconds(t),this._state.getValueAtTime(t)==="started"&&(this._state.cancel(t),this._restart(t,e,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(Oo(e,0)){const s=this._state.get(e);if(s&&s.state==="started"&&s.time!==e){const r=e-this.toSeconds(s.time);let i;s.duration&&(i=this.toSeconds(s.duration)-r),this._start(t,this.toSeconds(s.offset)+r,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(e)==="started"&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ht,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class mu extends Vo{constructor(){const t=pt(mu.getDefaults(),arguments,["url","onload"]);super(t),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,dr(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ft({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new ne(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Vo.getDefaults(),{url:new ne,loop:!1,loopEnd:0,loopStart:0,onload:Ht,onerror:Ht,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,s,r=1){vt(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,r),this.loop?e=So(e,this.loopStart):e=So(e,0);let o=Math.max(this.toSeconds(e),0);if(this.loop){const A=this.toSeconds(this.loopEnd)||this.buffer.duration,a=this.toSeconds(this.loopStart),l=A-a;nh(o,A)&&(o=(o-a)%l+a),ss(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,wc(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),_t(s)){let A=this.toSeconds(s);A=Math.max(A,0),this.stop(i+A)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function qi(n,t){return ge(this,void 0,void 0,function*(){const e=t/n.context.sampleRate,s=new Of(1,e,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/e,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class Jf extends Vo{constructor(){const t=pt(Jf.getDefaults(),arguments,["frequency","type"]);super(t),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],dr(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Ft({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Ft({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),Lt(this,["frequency","detune"])}static getDefaults(){return Object.assign(Vo.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ae extends wn{constructor(){const t=pt(ae.getDefaults(),arguments,["frequency","type"]);super(t),this.name="Oscillator",this._oscillator=null,this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),Lt(this,"frequency"),this.detune=new $t({context:this.context,units:"cents",value:t.detune}),Lt(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(wn.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),s=new Jf({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return ae._periodicWaveCache.find(e=>e.phase===this._phase&&pI(e.partials,this._partials));{const t=ae._periodicWaveCache.find(e=>e.type===this._type&&e.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&e)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{const s=this._getCachedPeriodicWave();if(_t(s)){const{partials:r,wave:i}=s;this._wave=i,this._partials=r,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[r,i]=this._getRealImaginary(t,this._phase),o=this.context.createPeriodicWave(r,i);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),ae._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:r,type:this._type,wave:this._wave}),ae._periodicWaveCache.length>100&&ae._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){ur(t,0);let e=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(e=s[1]),this._type!=="custom")t===0?this.type=e:this.type=e+t.toString();else{const r=new Float32Array(t);this._partials.forEach((i,o)=>r[o]=i),this._partials=Array.from(r),this.type=this._type}}_getRealImaginary(t,e){let r=2048;const i=new Float32Array(r),o=new Float32Array(r);let A=1;if(t==="custom"){if(A=this._partials.length+1,this._partialCount=this._partials.length,r=A,this._partials.length===0)return[i,o]}else{const a=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);a?(A=parseInt(a[2],10)+1,this._partialCount=parseInt(a[2],10),t=a[1],A=Math.max(A,2),r=A):this._partialCount=0,this._partials=[]}for(let a=1;a<r;++a){const l=2/(a*Math.PI);let c;switch(t){case"sine":c=a<=A?1:0,this._partials[a-1]=c;break;case"square":c=a&1?2*l:0,this._partials[a-1]=c;break;case"sawtooth":c=l*(a&1?1:-1),this._partials[a-1]=c;break;case"triangle":a&1?c=2*(l*l)*(a-1>>1&1?-1:1):c=0,this._partials[a-1]=c;break;case"custom":c=this._partials[a-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}c!==0?(i[a]=-c*Math.sin(e*a),o[a]=c*Math.cos(e*a)):(i[a]=0,o[a]=0)}return[i,o]}_inverseFFT(t,e,s){let r=0;const i=t.length;for(let o=0;o<i;o++)r+=t[o]*Math.cos(o*s)+e[o]*Math.sin(o*s);return r}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let s=0;const r=Math.PI*2,i=32;for(let o=0;o<i;o++)s=Math.max(this._inverseFFT(t,e,o/i*r),s);return gI(-this._inverseFFT(t,e,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){return ge(this,arguments,void 0,function*(t=1024){return qi(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ae._periodicWaveCache=[];class Sw extends _s{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new rA({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Li extends $t{constructor(){const t=pt(Li.getDefaults(),arguments,["value"]);super(t),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Mt({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign($t.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class gu extends wn{constructor(){const t=pt(gu.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="AMOscillator",this._modulationScale=new Sw({context:this.context}),this._modulationNode=new Mt({context:this.context}),this._carrier=new ae({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ae({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Li({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Lt(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ae.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return ge(this,arguments,void 0,function*(t=1024){return qi(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class vu extends wn{constructor(){const t=pt(vu.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="FMOscillator",this._modulationNode=new Mt({context:this.context,gain:0}),this._carrier=new ae({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new ae({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Li({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Li({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Lt(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ae.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return ge(this,arguments,void 0,function*(t=1024){return qi(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Pa extends wn{constructor(){const t=pt(Pa.getDefaults(),arguments,["frequency","width"]);super(t),this.name="PulseOscillator",this._widthGate=new Mt({context:this.context,gain:0}),this._thresh=new rA({context:this.context,mapping:e=>e<=0?-1:1}),this.width=new $t({context:this.context,units:"audioRange",value:t.width}),this._triangle=new ae({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Lt(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(wn.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(){return ge(this,arguments,void 0,function*(t=1024){return qi(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class wu extends wn{constructor(){const t=pt(wu.getDefaults(),arguments,["frequency","type","spread"]);super(t),this.name="FatOscillator",this._oscillators=[],this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $t({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,Lt(this,["frequency","detune"])}static getDefaults(){return Object.assign(ae.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(e=>e.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(e=>e.stop(t))}_restart(t){this._forEach(e=>e.restart(t))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,s=t/(this._oscillators.length-1);this._forEach((r,i)=>r.detune.value=e+s*i)}}get count(){return this._oscillators.length}set count(t){if(ur(t,1),this._oscillators.length!==t){this._forEach(e=>e.dispose()),this._oscillators=[];for(let e=0;e<t;e++){const s=new ae({context:this.context,volume:-6-t*1.1,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:e===0?()=>this.onstop(this):Ht});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[e]=s}this.spread=this._spread,this.state==="started"&&this._forEach(e=>e.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((e,s)=>e.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(){return ge(this,arguments,void 0,function*(t=1024){return qi(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class Bu extends wn{constructor(){const t=pt(Bu.getDefaults(),arguments,["frequency","modulationFrequency"]);super(t),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Li({context:this.context,value:2}),this._pulse=new Pa({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ae({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Lt(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(wn.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(){return ge(this,arguments,void 0,function*(t=1024){return qi(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const ym={am:gu,fat:wu,fm:vu,oscillator:ae,pulse:Pa,pwm:Bu};class Cc extends wn{constructor(){const t=pt(Cc.getDefaults(),arguments,["frequency","type"]);super(t),this.name="OmniOscillator",this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $t({context:this.context,units:"cents",value:t.detune}),Lt(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(ae.getDefaults(),vu.getDefaults(),gu.getDefaults(),wu.getDefaults(),Pa.getDefaults(),Bu.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(e=>this._sourceType===e)&&(t=this._sourceType),t+this._oscillator.type}set type(t){t.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):t==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):t==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=ym[t],s=this.now();if(this._oscillator){const r=this._oscillator;r.stop(s),this.context.setTimeout(()=>r.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(e=this._oscillator.type),t==="fm"?this.type="fm"+e:t==="am"?this.type="am"+e:t==="fat"?this.type="fat"+e:t==="oscillator"?this.type=e:t==="pulse"?this.type="pulse":t==="pwm"&&(this.type="pwm")}_getOscType(t,e){return t instanceof ym[e]}get baseType(){return this._oscillator.baseType}set baseType(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&t!=="pulse"&&t!=="pwm"&&(this._oscillator.baseType=t)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(t){this._getOscType(this._oscillator,"fat")&&lr(t)&&(this._oscillator.count=t)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(t){this._getOscType(this._oscillator,"fat")&&lr(t)&&(this._oscillator.spread=t)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&cr(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return ge(this,arguments,void 0,function*(t=1024){return qi(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Zf extends $t{constructor(){super(pt(Zf.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new Mt({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,ZA(this._constantSource,this._sum)}static getDefaults(){return Object.assign($t.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class ea extends _s{constructor(){const t=pt(ea.getDefaults(),arguments,["min","max"]);super(t),this.name="Scale",this._mult=this.input=new Li({context:this.context,value:t.max-t.min}),this._add=this.output=new Zf({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(_s.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class tp extends _s{constructor(){super(pt(tp.getDefaults(),arguments)),this.name="Zero",this._gain=new Mt({context:this.context}),this.output=this._gain,this.input=void 0,dr(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),yw(this.context.getConstant(0),this._gain),this}}class bc extends ft{constructor(){const t=pt(bc.getDefaults(),arguments,["frequency","min","max"]);super(t),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Ft.prototype._fromType,this._toType=Ft.prototype._toType,this._is=Ft.prototype._is,this._clampValue=Ft.prototype._clampValue,this._oscillator=new ae(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Mt({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new $t({context:this.context,units:"audioRange",value:0}),this._zeros=new tp({context:this.context}),this._a2g=new Sw({context:this.context}),this._scaler=this.output=new ea({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Lt(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(ae.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,s=this.max;this._units=t,this.min=e,this.max=s}get state(){return this._oscillator.state}connect(t,e,s){return(t instanceof Ft||t instanceof $t)&&(this.convert=t.convert,this.units=t.units),du(this,t,e,s),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Ew(n,t=1/0){const e=new WeakMap;return function(s,r){Reflect.defineProperty(s,r,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(i){ur(i,n,t),e.set(this,i)}})}}function gr(n,t=1/0){const e=new WeakMap;return function(s,r){Reflect.defineProperty(s,r,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(i){ur(this.toSeconds(i),n,t),e.set(this,i)}})}}class Na extends wn{constructor(){const t=pt(Na.getDefaults(),arguments,["url","onload"]);super(t),this.name="Player",this._activeSources=new Set,this._buffer=new ne({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(wn.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ht,onerror:Ht,playbackRate:1,reverse:!1})}load(t){return ge(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=Ht){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,s){return super.start(t,e,s),this}_start(t,e,s){this._loop?e=So(e,this._loopStart):e=So(e,0);const r=this.toSeconds(e),i=s;s=So(s,Math.max(this._buffer.duration-r,0));let o=this.toSeconds(s);o=o/this._playbackRate,t=this.toSeconds(t);const A=new mu({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(t+o),this._state.setStateAtTime("stopped",t+o,{implicitEnd:!0})),this._activeSources.add(A),this._loop&&$n(i)?A.start(t,r):A.start(t,r,o-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach(s=>s.stop(e))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){var r;(r=[...this._activeSources].pop())===null||r===void 0||r.stop(t),this._start(t,e,s)}seek(t,e){const s=this.toSeconds(e);if(this._state.getValueAtTime(s)==="started"){const r=this.toSeconds(t);this._stop(s),this._start(s,r)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&ur(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&ur(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(e=>{e.loop=t}),t)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),s=this._state.getNextState("stopped",e);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(r=>r.cancelStop())),this._activeSources.forEach(r=>{r.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}ds([gr(0)],Na.prototype,"fadeIn",void 0);ds([gr(0)],Na.prototype,"fadeOut",void 0);class La extends ft{constructor(){const t=pt(La.getDefaults(),arguments,["urls","onload"],"urls");super(t),this.name="Players",this.input=void 0,this._players=new Map,this._volume=this.output=new ks({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Lt(this,"volume"),this._buffers=new fu({urls:t.urls,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.mute=t.mute,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(wn.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Ht,onerror:Ht,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._players.forEach(e=>{e.fadeIn=t})}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._players.forEach(e=>{e.fadeOut=t})}get state(){return Array.from(this._players).some(([e,s])=>s.state==="started")?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){if(vt(this.has(t),`No Player with the name ${t} exists on this object`),!this._players.has(t)){const e=new Na({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output);this._players.set(t,e)}return this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,e,s){return vt(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,e,s),this}stopAll(t){return this._players.forEach(e=>e.stop(t)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(t=>t.dispose()),this._buffers.dispose(),this}}class QI extends _s{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new rA({context:this.context,mapping:t=>Math.abs(t)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class ti extends ft{constructor(){const t=pt(ti.getDefaults(),arguments,["attack","decay","sustain","release"]);super(t),this.name="Envelope",this._sig=new $t({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(ft.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(cr(t))return t;{let s;for(s in Ya)if(Ya[s][e]===t)return s;return t}}_setCurve(t,e,s){if(cr(s)&&Reflect.has(Ya,s)){const r=Ya[s];xi(r)?t!=="_decayCurve"&&(this[t]=r[e]):this[t]=r}else if(_n(s)&&t!=="_decayCurve")this[t]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(t){this._setCurve("_decayCurve","Out",t)}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let r=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(t);if(o>0){const A=1/r;r=(1-o)/A}if(r<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if(this._attackCurve==="linear")this._sig.linearRampTo(e,r,t);else if(this._attackCurve==="exponential")this._sig.targetRampTo(e,r,t);else{this._sig.cancelAndHoldAtTime(t);let A=this._attackCurve;for(let a=1;a<A.length;a++)if(A[a-1]<=o&&o<=A[a]){A=this._attackCurve.slice(a),A[0]=o;break}this._sig.setValueCurveAtTime(A,t,r,e)}if(i&&this.sustain<1){const A=e*this.sustain,a=t+r;this.log("decay",a),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(A,i+a):this._sig.exponentialApproachValueAtTime(A,a,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,t):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,t):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,t):(vt(_n(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,s,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),this.triggerAttack(e,s),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,s=0){return du(this,t,e,s),this}asArray(){return ge(this,arguments,void 0,function*(t=1024){const e=t/this.context.sampleRate,s=new Of(1,e,this.context.sampleRate),r=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=r+this.toSeconds(this.release),o=i*.1,A=i+o,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/A,decay:e*this.toSeconds(this.decay)/A,release:e*this.toSeconds(this.release)/A,context:s}));return a._sig.toDestination(),a.triggerAttackRelease(e*(r+o)/A,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}ds([gr(0)],ti.prototype,"attack",void 0);ds([gr(0)],ti.prototype,"decay",void 0);ds([Ew(0,1)],ti.prototype,"sustain",void 0);ds([gr(0)],ti.prototype,"release",void 0);const Ya=(()=>{let t,e;const s=[];for(t=0;t<128;t++)s[t]=Math.sin(t/127*(Math.PI/2));const r=[],i=6.4;for(t=0;t<127;t++){e=t/127;const d=Math.sin(e*(Math.PI*2)*i-Math.PI/2)+1;r[t]=d/10+e*.83}r[127]=1;const o=[],A=5;for(t=0;t<128;t++)o[t]=Math.ceil(t/127*A)/A;const a=[];for(t=0;t<128;t++)e=t/127,a[t]=.5*(1-Math.cos(Math.PI*e));const l=[];for(t=0;t<128;t++){e=t/127;const d=Math.pow(e,3)*4+.2,p=Math.cos(d*Math.PI*2*e);l[t]=Math.abs(p*(1-e))}function c(d){const p=new Array(d.length);for(let h=0;h<d.length;h++)p[h]=1-d[h];return p}function u(d){return d.slice(0).reverse()}return{bounce:{In:c(l),Out:l},cosine:{In:s,Out:u(s)},exponential:"exponential",linear:"linear",ripple:{In:r,Out:c(r)},sine:{In:a,Out:c(a)},step:{In:o,Out:c(o)}}})();class Xr extends ft{constructor(){const t=pt(Xr.getDefaults(),arguments);super(t),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=e=>this._original_triggerRelease(e),this._volume=this.output=new ks({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Lt(this,"volume")}static getDefaults(){return Object.assign(ft.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const s=this["_original_"+t]=this[t];this[t]=(...r)=>{const i=r[e],o=this.context.transport.schedule(A=>{r[e]=A,s.apply(this,r)},i);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(t,e,s,r){const i=this.toSeconds(s),o=this.toSeconds(e);return this.triggerAttack(t,i,r),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Di extends Xr{constructor(){const t=pt(Di.getDefaults(),arguments);super(t),this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Xr.getDefaults(),{detune:0,onsilence:Ht,portamento:0})}triggerAttack(t,e,s=1){this.log("triggerAttack",t,e,s);const r=this.toSeconds(e);return this._triggerEnvelopeAttack(r,s),this.setNote(t,r),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const s=this.toSeconds(e),r=t instanceof In?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,i,s)}else this.frequency.setValueAtTime(r,s);return this}}ds([gr(0)],Di.prototype,"portamento",void 0);class ep extends ti{constructor(){super(pt(ep.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Mt({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Wo extends Di{constructor(){const t=pt(Wo.getDefaults(),arguments);super(t),this.name="Synth",this.oscillator=new Cc(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new ep(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),Lt(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Di.getDefaults(),{envelope:Object.assign(eh(ti.getDefaults(),Object.keys(ft.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(eh(Cc.getDefaults(),[...Object.keys(wn.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+s+r)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class yc extends ft{constructor(){const t=pt(yc.getDefaults(),arguments,["frequency","type"]);super(t),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Ft({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new Ft({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new Ft({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new Ft({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(ft.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){vt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let o=0;o<t;o++){const a=Math.pow(o/t,2)*19980+20;e[o]=a}const s=new Float32Array(t),r=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,s,r),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class MA extends ft{constructor(){const t=pt(MA.getDefaults(),arguments,["frequency","type","rolloff"]);super(t),this.name="Filter",this.input=new Mt({context:this.context}),this.output=new Mt({context:this.context}),this._filters=[],this._filters=[],this.Q=new $t({context:this.context,units:"positive",value:t.Q}),this.frequency=new $t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $t({context:this.context,units:"cents",value:t.detune}),this.gain=new $t({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,Lt(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(ft.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){vt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,`Invalid filter type: ${t}`),this._type=t,this._filters.forEach(s=>s.type=t)}get rolloff(){return this._rolloff}set rolloff(t){const e=lr(t)?t:parseInt(t,10),s=[-12,-24,-48,-96];let r=s.indexOf(e);vt(r!==-1,`rolloff can only be ${s.join(", ")}`),r+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach(i=>i.disconnect()),this._filters=new Array(r);for(let i=0;i<r;i++){const o=new yc({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[i]=o}this._internalChannels=this._filters,ZA(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new yc({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(t).map(()=>1);return this._filters.forEach(()=>{e.getFrequencyResponse(t).forEach((i,o)=>s[o]*=i)}),e.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(t=>{t.dispose()}),Hf(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Cu extends Wo{constructor(){const t=pt(Cu.getDefaults(),arguments);super(t),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,Lt(this,["oscillator","envelope"])}static getDefaults(){return Ii(Di.getDefaults(),Wo.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const s=this.toSeconds(e),r=this.toFrequency(t instanceof In?t.toFrequency():t),i=r*this.octaves;return this.oscillator.frequency.setValueAtTime(i,s),this.oscillator.frequency.exponentialRampToValueAtTime(r,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}ds([Ew(0)],Cu.prototype,"octaves",void 0);ds([gr(0)],Cu.prototype,"pitchDecay",void 0);const xw=new Set;function np(n){xw.add(n)}function Iw(n,t){const e=`registerProcessor("${n}", ${t})`;xw.add(e)}const UI=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;np(UI);const PI=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;np(PI);const NI=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;np(NI);const LI="feedback-comb-filter",DI=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Iw(LI,DI);class sp extends Xr{constructor(){const t=pt(sp.getDefaults(),arguments,["voice","options"]);super(t),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=r=>this.releaseAll(r),vt(!lr(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const s=this._voices.indexOf(this._dummyVoice);this._voices.splice(s,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Xr.getDefaults(),{maxPolyphony:32,options:{},voice:Wo})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex(s=>s.voice===t);this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return vt(t instanceof Di,"Voice must extend Monophonic class"),t.connect(this.output),this._voices.push(t),t}else Ua("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,s){t.forEach(r=>{const i=new ta(this.context,r).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(r,e,s),this._activeVoices.push({midi:i,voice:o,released:!1}),this.log("triggerAttack",r,e))})}_triggerRelease(t,e){t.forEach(s=>{const r=new ta(this.context,s).toMidi(),i=this._activeVoices.find(({midi:o,released:A})=>o===r&&!A);i&&(i.voice.triggerRelease(e),i.released=!0,this.log("triggerRelease",s,e))})}_scheduleEvent(t,e,s,r){vt(!this.disposed,"Synth was already disposed"),s<=this.now()?t==="attack"?this._triggerAttack(e,s,r):this._triggerRelease(e,s):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(t,e,s,r)},s-this.now())}triggerAttack(t,e,s){Array.isArray(t)||(t=[t]);const r=this.toSeconds(e);return this._scheduleEvent("attack",t,r,s),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("release",t,s),this}triggerAttackRelease(t,e,s,r){const i=this.toSeconds(s);if(this.triggerAttack(t,i,r),_n(e)){vt(_n(t),"If the duration is an array, the notes must also be an array"),t=t;for(let o=0;o<t.length;o++){const A=e[Math.min(o,e.length-1)],a=this.toSeconds(A);vt(a>0,"The duration must be greater than 0"),this.triggerRelease(t[o],i+a)}}else{const o=this.toSeconds(e);vt(o>0,"The duration must be greater than 0"),this.triggerRelease(t,i+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(t){const e=eh(t,["onsilence","context"]);return this.options=Ii(this.options,e),this._voices.forEach(s=>s.set(e)),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach(({voice:s})=>{s.triggerRelease(e)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(t=>t.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class bu extends Xr{constructor(){const t=pt(bu.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(t),this.name="Sampler",this._activeSources=new Map;const e={};Object.keys(t.urls).forEach(s=>{const r=parseInt(s,10);if(vt(Xa(s)||lr(r)&&isFinite(r),`url key is neither a note or midi pitch: ${s}`),Xa(s)){const i=new In(this.context,s).toMidi();e[i]=t.urls[s]}else lr(r)&&isFinite(r)&&(e[r]=t.urls[r])}),this._buffers=new fu({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Xr.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ht,onerror:Ht,release:.1,urls:{}})}_findClosest(t){let s=0;for(;s<96;){if(this._buffers.has(t+s))return-s;if(this._buffers.has(t-s))return s;s++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,s=1){return this.log("triggerAttack",t,e,s),Array.isArray(t)||(t=[t]),t.forEach(r=>{const i=Cw(new In(this.context,r).toFrequency()),o=Math.round(i),A=i-o,a=this._findClosest(o),l=o-a,c=this._buffers.get(l),u=Bw(a+A),d=new mu({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:u}).connect(this.output);d.start(e,0,c.duration/u,s),_n(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const p=this._activeSources.get(o),h=p.indexOf(d);h!==-1&&p.splice(h,1)}}}),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach(s=>{const r=new In(this.context,s).toMidi();if(this._activeSources.has(r)&&this._activeSources.get(r).length){const i=this._activeSources.get(r);e=this.toSeconds(e),i.forEach(o=>{o.stop(e)}),this._activeSources.set(r,[])}}),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(e)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,s,r=1){const i=this.toSeconds(s);return this.triggerAttack(t,i,r),_n(e)?(vt(_n(t),"notes must be an array when duration is array"),t.forEach((o,A)=>{const a=e[Math.min(A,e.length-1)];this.triggerRelease(o,i+this.toSeconds(a))})):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,s){if(vt(Xa(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Xa(t)){const r=new In(this.context,t).toMidi();this._buffers.add(r,e,s)}else this._buffers.add(t,e,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(e=>e.dispose())}),this._activeSources.clear(),this}}ds([gr(0)],bu.prototype,"attack",void 0);ds([gr(0)],bu.prototype,"release",void 0);class Eo extends ft{constructor(){const t=pt(Eo.getDefaults(),arguments,["fade"]);super(t),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new QI({context:this.context}),this.a=new Mt({context:this.context,gain:0}),this.b=new Mt({context:this.context,gain:0}),this.output=new Mt({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new $t({context:this.context,units:"normalRange",value:t.fade}),Lt(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",dr(this._split,this.a.gain,0),dr(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(ft.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Sm extends ft{constructor(t){super(t),this.name="Effect",this._dryWet=new Eo({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Mt({context:this.context}),this.effectReturn=new Mt({context:this.context}),this.input=new Mt({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Lt(this,"wet")}static getDefaults(){return Object.assign(ft.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class rp extends ft{constructor(){const t=pt(rp.getDefaults(),arguments,["pan"]);super(t),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Ft({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",Lt(this,"pan")}static getDefaults(){return Object.assign(ft.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const kI="bit-crusher",RI=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Iw(kI,RI);class ip extends ft{constructor(){const t=pt(ip.getDefaults(),arguments,["channels"]);super(t),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(ft.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Em extends Sm{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new Mt({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Lt(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Sm.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class op extends Em{constructor(){const t=pt(op.getDefaults(),arguments,["delayTime","feedback"]);super(t),this.name="FeedbackDelay",this._delayNode=new $f({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Lt(this,"delayTime")}static getDefaults(){return Object.assign(Em.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class Da extends ft{constructor(){const t=pt(Da.getDefaults(),arguments,["type","size"]);super(t),this.name="Analyser",this._analysers=[],this._buffers=[],this.input=this.output=this._gain=new Mt({context:this.context}),this._split=new ip({context:this.context,channels:t.channels}),this.input.connect(this._split),ur(t.channels,1);for(let e=0;e<t.channels;e++)this._analysers[e]=this.context.createAnalyser(),this._split.connect(this._analysers[e],e,0);this.size=t.size,this.type=t.type,this.smoothing=t.smoothing}static getDefaults(){return Object.assign(ft.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,e)=>{const s=this._buffers[e];this._type==="fft"?t.getFloatFrequencyData(s):this._type==="waveform"&&t.getFloatTimeDomainData(s)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach((e,s)=>{e.fftSize=t*2,this._buffers[s]=new Float32Array(t)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){vt(t==="waveform"||t==="fft",`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach(e=>e.smoothingTimeConstant=t)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class Sc extends ft{constructor(){super(pt(Sc.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Da({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class Ap extends Sc{constructor(){const t=pt(Ap.getDefaults(),arguments,["smoothing"]);super(t),this.name="Meter",this.input=this.output=this._analyser=new Da({context:this.context,size:256,type:"waveform",channels:t.channelCount}),this.smoothing=t.smoothing,this.normalRange=t.normalRange,this._rms=new Array(t.channelCount),this._rms.fill(0)}static getDefaults(){return Object.assign(Sc.getDefaults(),{smoothing:.8,normalRange:!1,channelCount:1})}getLevel(){return Ua("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),s=(this.channels===1?[t]:t).map((r,i)=>{const o=r.reduce((a,l)=>a+l*l,0),A=Math.sqrt(o/r.length);return this._rms[i]=Math.max(A,this._rms[i]*this.smoothing),this.normalRange?this._rms[i]:ww(this._rms[i])});return this.channels===1?s[0]:s}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class he extends ft{constructor(){const t=pt(he.getDefaults(),arguments,["solo"]);super(t),this.name="Solo",this.input=this.output=new Mt({context:this.context}),he._allSolos.has(this.context)||he._allSolos.set(this.context,new Set),he._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(ft.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),he._allSolos.get(this.context).forEach(e=>e._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){he._soloed.has(this.context)||he._soloed.set(this.context,new Set),he._soloed.get(this.context).add(this)}_removeSolo(){he._soloed.has(this.context)&&he._soloed.get(this.context).delete(this)}_isSoloed(){return he._soloed.has(this.context)&&he._soloed.get(this.context).has(this)}_noSolos(){return!he._soloed.has(this.context)||he._soloed.has(this.context)&&he._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),he._allSolos.get(this.context).delete(this),this._removeSolo(),this}}he._allSolos=new Map;he._soloed=new Map;class ap extends ft{constructor(){const t=pt(ap.getDefaults(),arguments,["pan","volume"]);super(t),this.name="PanVol",this._panner=this.input=new rp({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new ks({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,Lt(this,["pan","volume"])}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class ho extends ft{constructor(){const t=pt(ho.getDefaults(),arguments,["volume","pan"]);super(t),this.name="Channel",this._solo=this.input=new he({solo:t.solo,context:this.context}),this._panVol=this.output=new ap({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Lt(this,["pan","volume"])}static getDefaults(){return Object.assign(ft.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return ho.buses.has(t)||ho.buses.set(t,new Mt({context:this.context})),ho.buses.get(t)}send(t,e=0){const s=this._getBus(t),r=new Mt({context:this.context,units:"decibels",gain:e});return this.connect(r),r.connect(s),r}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}ho.buses=new Map;class yu extends ft{constructor(){const t=pt(yu.getDefaults(),arguments,["threshold","ratio"]);super(t),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new Ft({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new Ft({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new Ft({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new Ft({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new Ft({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),Lt(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(ft.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class lp extends ft{constructor(){const t=pt(lp.getDefaults(),arguments,["threshold"]);super(t),this.name="Limiter",this._compressor=this.input=this.output=new yu({context:this.context,ratio:20,attack:.003,release:.01,threshold:t.threshold}),this.threshold=this._compressor.threshold,Lt(this,"threshold")}static getDefaults(){return Object.assign(ft.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}function be(){return Ke().now()}const ht=Ke().transport;Ke().destination;Ke().destination;Ke().listener;const QA=Ke().draw,er=Ke(),Wn=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fcfcfc",isAccidental:!1,midi:108,pitchClass:0,octave:8},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fcf7fc",isAccidental:!1,midi:107,pitchClass:11,octave:7},{pitch:"B/A7",flatName:"B7",sharpName:"A7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f7f5fd",isAccidental:!0,midi:106,pitchClass:10,octave:7},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f0f4ff",isAccidental:!1,midi:105,pitchClass:9,octave:7},{pitch:"A/G7",flatName:"A7",sharpName:"G7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#e6f3fd",isAccidental:!0,midi:104,pitchClass:8,octave:7},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#def3f7",isAccidental:!1,midi:103,pitchClass:7,octave:7},{pitch:"G/F7",flatName:"G7",sharpName:"F7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#daf2ec",isAccidental:!0,midi:102,pitchClass:6,octave:7},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#dcefdf",isAccidental:!1,midi:101,pitchClass:5,octave:7},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#e3ebd1",isAccidental:!1,midi:100,pitchClass:4,octave:7},{pitch:"E/D7",flatName:"E7",sharpName:"D7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#eee4c8",isAccidental:!0,midi:99,pitchClass:3,octave:7},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#f8dcc6",isAccidental:!1,midi:98,pitchClass:2,octave:7},{pitch:"D/C7",flatName:"D7",sharpName:"C7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fcd4cd",isAccidental:!0,midi:97,pitchClass:1,octave:7},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#facfdb",isAccidental:!1,midi:96,pitchClass:0,octave:7},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#efcdeb",isAccidental:!1,midi:95,pitchClass:11,octave:6},{pitch:"B/A6",flatName:"B6",sharpName:"A6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#ddcff9",isAccidental:!0,midi:94,pitchClass:10,octave:6},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#c4d3ff",isAccidental:!1,midi:93,pitchClass:9,octave:6},{pitch:"A/G6",flatName:"A6",sharpName:"G6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#abd9fa",isAccidental:!0,midi:92,pitchClass:8,octave:6},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#98dde9",isAccidental:!1,midi:91,pitchClass:7,octave:6},{pitch:"G/F6",flatName:"G6",sharpName:"F6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#96ddcf",isAccidental:!0,midi:90,pitchClass:6,octave:6},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#a6d9b0",isAccidental:!1,midi:89,pitchClass:5,octave:6},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#c0d093",isAccidental:!1,midi:88,pitchClass:4,octave:6},{pitch:"E/D6",flatName:"E6",sharpName:"D6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#dbc383",isAccidental:!0,midi:87,pitchClass:3,octave:6},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#efb586",isAccidental:!1,midi:86,pitchClass:2,octave:6},{pitch:"D/C6",flatName:"D6",sharpName:"C6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#f8a99c",isAccidental:!0,midi:85,pitchClass:1,octave:6},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#f3a2bb",isAccidental:!1,midi:84,pitchClass:0,octave:6},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e1a3db",isAccidental:!1,midi:83,pitchClass:11,octave:5},{pitch:"B/A5",flatName:"B5",sharpName:"A5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#c3a9f4",isAccidental:!0,midi:82,pitchClass:10,octave:5},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#9ab2ff",isAccidental:!1,midi:81,pitchClass:9,octave:5},{pitch:"A/G5",flatName:"A5",sharpName:"G5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#67bdf7",isAccidental:!0,midi:80,pitchClass:8,octave:5},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#30c6dc",isAccidental:!1,midi:79,pitchClass:7,octave:5},{pitch:"G/F5",flatName:"G5",sharpName:"F5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#32c8b2",isAccidental:!0,midi:78,pitchClass:6,octave:5},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#6dc281",isAccidental:!1,midi:77,pitchClass:5,octave:5},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#a0b556",isAccidental:!1,midi:76,pitchClass:4,octave:5},{pitch:"E/D5",flatName:"E5",sharpName:"D5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#c5a33f",isAccidental:!0,midi:75,pitchClass:3,octave:5},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#dc9150",isAccidental:!1,midi:74,pitchClass:2,octave:5},{pitch:"D/C5",flatName:"D5",sharpName:"C5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#e38475",isAccidental:!0,midi:73,pitchClass:1,octave:5},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#dc7f9d",isAccidental:!1,midi:72,pitchClass:0,octave:5},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#c781c0",isAccidental:!1,midi:71,pitchClass:11,octave:4},{pitch:"B/A4",flatName:"B4",sharpName:"A4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#a68ad8",isAccidental:!0,midi:70,pitchClass:10,octave:4},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#7d94e0",isAccidental:!1,midi:69,pitchClass:9,octave:4},{pitch:"A/G4",flatName:"A4",sharpName:"G4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#4c9fd5",isAccidental:!0,midi:68,pitchClass:8,octave:4},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#0fa6ba",isAccidental:!1,midi:67,pitchClass:7,octave:4},{pitch:"G/F4",flatName:"G4",sharpName:"F4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#24a794",isAccidental:!0,midi:66,pitchClass:6,octave:4},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#5aa26a",isAccidental:!1,midi:65,pitchClass:5,octave:4},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#849646",isAccidental:!1,midi:64,pitchClass:4,octave:4},{pitch:"E/D4",flatName:"E4",sharpName:"D4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#a38733",isAccidental:!0,midi:63,pitchClass:3,octave:4},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#b67740",isAccidental:!1,midi:62,pitchClass:2,octave:4},{pitch:"D/C4",flatName:"D4",sharpName:"C4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#bc6c5f",isAccidental:!0,midi:61,pitchClass:1,octave:4},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#b56880",isAccidental:!1,midi:60,pitchClass:0,octave:4},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#a3699e",isAccidental:!1,midi:59,pitchClass:11,octave:3},{pitch:"B/A3",flatName:"B3",sharpName:"A3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#8870b1",isAccidental:!0,midi:58,pitchClass:10,octave:3},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#6578b7",isAccidental:!1,midi:57,pitchClass:9,octave:3},{pitch:"A/G3",flatName:"A3",sharpName:"G3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#3c81ad",isAccidental:!0,midi:56,pitchClass:8,octave:3},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#0e8696",isAccidental:!1,midi:55,pitchClass:7,octave:3},{pitch:"G/F3",flatName:"G3",sharpName:"F3",toneNote:"Gb3",frequency:185,column:"A",hex:"#1b8777",isAccidental:!0,midi:54,pitchClass:6,octave:3},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#478255",isAccidental:!1,midi:53,pitchClass:5,octave:3},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#697836",isAccidental:!1,midi:52,pitchClass:4,octave:3},{pitch:"E/D3",flatName:"E3",sharpName:"D3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#836b27",isAccidental:!0,midi:51,pitchClass:3,octave:3},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#925e32",isAccidental:!1,midi:50,pitchClass:2,octave:3},{pitch:"D/C3",flatName:"D3",sharpName:"C3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#96554b",isAccidental:!0,midi:49,pitchClass:1,octave:3},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#905165",isAccidental:!1,midi:48,pitchClass:0,octave:3},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#80527c",isAccidental:!1,midi:47,pitchClass:11,octave:2},{pitch:"B/A2",flatName:"B2",sharpName:"A2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#6a578c",isAccidental:!0,midi:46,pitchClass:10,octave:2},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#4e5e90",isAccidental:!1,midi:45,pitchClass:9,octave:2},{pitch:"A/G2",flatName:"A2",sharpName:"G2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#2d6488",isAccidental:!0,midi:44,pitchClass:8,octave:2},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#096875",isAccidental:!1,midi:43,pitchClass:7,octave:2},{pitch:"G/F2",flatName:"G2",sharpName:"F2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#13685b",isAccidental:!0,midi:42,pitchClass:6,octave:2},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#356440",isAccidental:!1,midi:41,pitchClass:5,octave:2},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#505c28",isAccidental:!1,midi:40,pitchClass:4,octave:2},{pitch:"E/D2",flatName:"E2",sharpName:"D2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#63511c",isAccidental:!0,midi:39,pitchClass:3,octave:2},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#6e4724",isAccidental:!1,midi:38,pitchClass:2,octave:2},{pitch:"D/C2",flatName:"D2",sharpName:"C2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#713f37",isAccidental:!0,midi:37,pitchClass:1,octave:2},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#6c3c4b",isAccidental:!1,midi:36,pitchClass:0,octave:2},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#603c5d",isAccidental:!1,midi:35,pitchClass:11,octave:1},{pitch:"B/A1",flatName:"B1",sharpName:"A1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#4e4068",isAccidental:!0,midi:34,pitchClass:10,octave:1},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#38446b",isAccidental:!1,midi:33,pitchClass:9,octave:1},{pitch:"A/G1",flatName:"A1",sharpName:"G1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#1f4964",isAccidental:!0,midi:32,pitchClass:8,octave:1},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#044b55",isAccidental:!1,midi:31,pitchClass:7,octave:1},{pitch:"G/F1",flatName:"G1",sharpName:"F1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#0c4b41",isAccidental:!0,midi:30,pitchClass:6,octave:1},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#24472c",isAccidental:!1,midi:29,pitchClass:5,octave:1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#38401a",isAccidental:!1,midi:28,pitchClass:4,octave:1},{pitch:"E/D1",flatName:"E1",sharpName:"D1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#463811",isAccidental:!0,midi:27,pitchClass:3,octave:1},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#4d3017",isAccidental:!1,midi:26,pitchClass:2,octave:1},{pitch:"D/C1",flatName:"D1",sharpName:"C1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#4f2a24",isAccidental:!0,midi:25,pitchClass:1,octave:1},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#4a2733",isAccidental:!1,midi:24,pitchClass:0,octave:1},{pitch:"B0",flatName:"B0",sharpName:"B0",toneNote:"B0",frequency:30.87,column:"B",hex:"#41273f",isAccidental:!1,midi:23,pitchClass:11,octave:0},{pitch:"B/A0",flatName:"B0",sharpName:"A0",toneNote:"Bb0",frequency:29.14,column:"A",hex:"#342a46",isAccidental:!0,midi:22,pitchClass:10,octave:0},{pitch:"A0",flatName:"A0",sharpName:"A0",toneNote:"A0",frequency:27.5,column:"B",hex:"#242c48",isAccidental:!1,midi:21,pitchClass:9,octave:0}],Fw=new Map,HI=new Map;Wn.forEach((n,t)=>{Fw.set(n.toneNote,t),n.midi!==void 0&&HI.set(n.midi,t)});function xm(n){return Fw.get(n)??-1}function OI(n,t){const e=xm(n),s=xm(t);return e===-1||s===-1?null:{topIndex:Math.min(e,s),bottomIndex:Math.max(e,s)}}const VI={attack:.1,decay:.2,sustain:.8,release:.3},WI={enabled:!1,blend:.5,cutoff:.5,resonance:0,type:"lowpass",mix:1},GI={speed:5,span:0},KI={speed:5,span:0};function qI(){const n=["#4a90e2","#e24a4a","#4ae24a","#e2e24a","#e24ae2","#4ae2e2","#e2a04a","#a04ae2"],t={};return n.forEach(e=>{const s=new Float32Array(32);s[0]=1;const r=new Float32Array(32);t[e]={name:"Sine",adsr:{...VI},coeffs:s,phases:r,filter:{...WI},activePresetName:"sine",gain:1,vibrato:{...GI},tremelo:{...KI}}}),t}function zI(){const n=new Array(16).fill(2),t=n.slice(0,-1).map((e,s)=>(s+1)%4===0?"solid":"dashed");return{macrobeatGroupings:n,macrobeatBoundaryStyles:t,hasAnacrusis:!1,baseMicrobeatPx:40,tempoModulationMarkers:[]}}function $I(){const n=OI("G5","C4");return n||{topIndex:0,bottomIndex:Math.max(0,Wn.length-1)}}function XI(){const n=qI();return{placedNotes:[],placedChords:[],tonicSignGroups:{},sixteenthStampPlacements:[],tripletStampPlacements:[],annotations:[],lassoSelection:{selectedItems:[],convexHull:null,isActive:!1},history:[{notes:[],tonicSignGroups:{},timbres:JSON.parse(JSON.stringify(n)),placedChords:[],sixteenthStampPlacements:[],tripletStampPlacements:[],annotations:[],lassoSelection:{selectedItems:[],convexHull:null,isActive:!1}}],historyIndex:0,fullRowData:[...Wn],pitchRange:$I(),...zI(),selectedModulationRatio:null,timbres:n,colorPalette:{"#4a90e2":{primary:"#4a90e2",light:"#a8c8f0"},"#e24a4a":{primary:"#e24a4a",light:"#f0a8a8"},"#4ae24a":{primary:"#4ae24a",light:"#a8f0a8"},"#e2e24a":{primary:"#e2e24a",light:"#f0f0a8"},"#e24ae2":{primary:"#e24ae2",light:"#f0a8f0"},"#4ae2e2":{primary:"#4ae2e2",light:"#a8f0f0"},"#e2a04a":{primary:"#e2a04a",light:"#f0d0a8"},"#a04ae2":{primary:"#a04ae2",light:"#d0a8f0"}},selectedTool:"note",previousTool:"note",selectedToolTonicNumber:1,selectedNote:{shape:"circle",color:"#4a90e2"},deviceProfile:{isMobile:!1,isTouch:!1,isCoarsePointer:!1,orientation:"landscape",width:0,height:0},activeChordId:null,activeChordIntervals:["1P"],isIntervalsInverted:!1,chordPositionState:0,gridPosition:0,viewportRows:0,logicRows:0,cellWidth:0,cellHeight:0,columnWidths:[],musicalColumnWidths:[],degreeDisplayMode:"off",accidentalMode:{sharp:!0,flat:!0},showFrequencyLabels:!1,showOctaveLabels:!0,focusColours:!1,isPlaying:!1,isPaused:!1,isLooping:!1,tempo:90,playheadMode:"cursor",waveformExtendedView:!1,adsrTimeAxisScale:1,isPrintPreviewActive:!1,printOptions:{pageSize:"letter",includeButtonGrid:!0,includeDrums:!0,includeLeftLegend:!0,includeRightLegend:!0,orientation:"landscape",colorMode:"color",cropTop:0,cropBottom:1,cropLeft:0,cropRight:1},longNoteStyle:"style1"}}function Im(n){if(!(!n||n.isDrum)&&n.shape==="circle"&&typeof n.startColumnIndex=="number"){const t=n.startColumnIndex+1;(typeof n.endColumnIndex!="number"||n.endColumnIndex<t)&&(n.endColumnIndex=t)}}function ju(n,t){if(typeof n.row!="number")return;const e=t.length>0?t.length-1:-1;if(e<0)return;const s=typeof n.globalRow=="number"?n.globalRow:n.row,r=Math.max(0,Math.min(e,Math.round(s)));n.globalRow=r,n.row=r}function ja(){return`uuid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function YI(n={}){const{getMacrobeatInfo:t,getDegreeForNote:e,hasAccidental:s,log:r=()=>{}}=n;return{addNote(i){const o=this.state.placedNotes.find(a=>!a.isDrum&&a.row===i.row&&a.startColumnIndex===i.startColumnIndex&&a.color===i.color);if(o){if(this.state.degreeDisplayMode!=="off"&&e&&s){const a=e(o,this.state);if(a&&s(a))return o.enharmonicPreference=!o.enharmonicPreference,r("debug","[ENHARMONIC] Toggled enharmonic preference for note",{noteUuid:o.uuid,currentDegree:a,enharmonicPreference:o.enharmonicPreference}),this.emit("notesChanged"),o}return null}const A={...i,uuid:ja()};return Im(A),ju(A,this.state.fullRowData),this.state.placedNotes.push(A),this.emit("notesChanged"),A},updateNoteTail(i,o){let A=o;i.shape==="circle"&&(A=Math.max(i.startColumnIndex+1,o)),i.endColumnIndex=A,this.emit("notesChanged")},updateMultipleNoteTails(i,o){i.forEach(A=>{let a=o;A.shape==="circle"&&(a=Math.max(A.startColumnIndex+1,o)),A.endColumnIndex=a}),this.emit("notesChanged")},updateNoteRow(i,o){i.row=o,i.globalRow=o,this.emit("notesChanged")},updateMultipleNoteRows(i,o){i.forEach((A,a)=>{const l=o[a];l!==void 0&&(A.row=l,ju(A,this.state.fullRowData))}),this.emit("notesChanged")},updateNotePosition(i,o){i.startColumnIndex=o,i.endColumnIndex=i.shape==="circle"?o+1:o,this.emit("notesChanged")},updateMultipleNotePositions(i,o){i.forEach(A=>{A.startColumnIndex=o,A.endColumnIndex=A.shape==="circle"?o+1:o}),this.emit("notesChanged")},removeNote(i){const o=this.state.placedNotes.indexOf(i);o>-1&&(this.state.placedNotes.splice(o,1),this.emit("notesChanged"))},removeMultipleNotes(i){const o=new Set(i);this.state.placedNotes=this.state.placedNotes.filter(A=>!o.has(A)),this.emit("notesChanged")},eraseInPitchArea(i,o,A=1,a=!0){const l=i+A-1,c=o-1,u=o+1;let d=!1;const p=this.state.placedNotes.length;return this.state.placedNotes=this.state.placedNotes.filter(h=>{if(h.isDrum)return!0;if(h.shape==="circle"){const m=h.startColumnIndex+1,g=typeof h.endColumnIndex=="number"?Math.max(m,h.endColumnIndex):m,v=h.startColumnIndex<=l&&g>=i,w=h.row>=c&&h.row<=u;if(v&&w)return!1}else if(h.row>=c&&h.row<=u&&h.startColumnIndex<=l&&h.endColumnIndex>=i)return!1;return!0}),this.state.placedNotes.length<p&&(d=!0),d&&(this.emit("notesChanged"),a&&this.recordState()),d},eraseDrumNoteAt(i,o,A=!0){const a=String(o),l=this.state.placedNotes.length;this.state.placedNotes=this.state.placedNotes.filter(u=>!(u.isDrum&&String(u.drumTrack)===a&&u.startColumnIndex===i));const c=this.state.placedNotes.length<l;return c&&(this.emit("notesChanged"),A&&this.recordState()),c},toggleDrumNote(i){const o=String(i.drumTrack),A=this.state.placedNotes.findIndex(a=>a.isDrum&&String(a.drumTrack)===o&&a.startColumnIndex===i.startColumnIndex);if(A>=0)this.state.placedNotes.splice(A,1);else{const a={...i,uuid:ja(),isDrum:!0,endColumnIndex:i.endColumnIndex??i.startColumnIndex};this.state.placedNotes.push(a)}this.emit("notesChanged"),this.recordState()},addTonicSignGroup(i){r("debug","Starting addTonicSignGroup",{tonicSignGroup:i});const o=i[0];if(!o)return;const{preMacrobeatIndex:A}=o;if(r("debug","preMacrobeatIndex",{preMacrobeatIndex:A}),Object.entries(this.state.tonicSignGroups).find(([,p])=>p.some(h=>h.preMacrobeatIndex===A))){r("debug","Existing tonic already present for measure, skipping",{preMacrobeatIndex:A});return}if(!t){r("error","getMacrobeatInfo callback not provided");return}const l=t(this.state,A+1).startColumn;r("debug","Boundary column (canvas-space) for shifting notes",{boundaryColumn:l});const c=this.state.placedNotes.filter(p=>p.startColumnIndex>=l);r("debug","Notes that will be shifted",{noteRanges:c.map(p=>`${p.startColumnIndex}-${p.endColumnIndex}`)}),this.state.placedNotes.forEach(p=>{if(p.startColumnIndex>=l){const h=p.startColumnIndex,m=p.endColumnIndex;p.startColumnIndex=p.startColumnIndex+2,p.endColumnIndex=p.endColumnIndex+2,r("debug",`Shifted note from ${h}-${m} to ${p.startColumnIndex}-${p.endColumnIndex}`)}});const u=ja(),d=i.map(p=>({...p,uuid:u,globalRow:typeof p.globalRow=="number"?p.globalRow:p.row}));this.state.tonicSignGroups[u]=d,r("debug","Added tonic group",{uuid:u,columns:d.map(p=>p.columnIndex)}),r("debug","Emitting events: notesChanged, rhythmStructureChanged"),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},eraseTonicSignAt(i,o=!0){const A=Object.entries(this.state.tonicSignGroups).find(([,p])=>p.some(h=>h.columnIndex===i));if(!A)return!1;if(!t)return r("error","getMacrobeatInfo callback not provided"),!1;const[a,l]=A,c=l[0];if(!c)return!1;const u=c.preMacrobeatIndex,d=t(this.state,u+1).startColumn;return delete this.state.tonicSignGroups[a],this.state.placedNotes.forEach(p=>{p.startColumnIndex>=d&&(p.startColumnIndex=p.startColumnIndex-2,p.endColumnIndex=p.endColumnIndex-2)}),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),o&&this.recordState(),!0},clearAllNotes(){this.state.placedNotes=[],this.state.tonicSignGroups={},this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},loadNotes(i){const o=(i||[]).map(A=>{const a={...A,uuid:(A==null?void 0:A.uuid)??ja()};return Im(a),ju(a,this.state.fullRowData),a});this.state.placedNotes=o,this.emit("notesChanged"),this.recordState()}}}function jI(){return`sixteenth-stamp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function JI(n={}){const{getPlacedTonicSigns:t,isWithinTonicSpan:e,log:s=()=>{}}=n;return{addSixteenthStampPlacement(r,i,o,A="#4a90e2"){const a=i+2;if(t&&e){const d=t(this.state);(e(i,d)||e(i+1,d))&&s("debug","Cannot place sixteenth stamp - overlaps tonic column",{sixteenthStampId:r,startColumn:i,row:o})}const l=this.state.sixteenthStampPlacements.find(d=>d.row===o&&d.startColumn<a&&d.endColumn>i);l&&this.removeSixteenthStampPlacement(l.id);const c=o,u={id:jI(),sixteenthStampId:r,startColumn:i,endColumn:a,row:o,globalRow:c,color:A,timestamp:Date.now(),shapeOffsets:{}};return this.state.sixteenthStampPlacements.push(u),this.emit("sixteenthStampPlacementsChanged"),s("debug",`Added sixteenth stamp ${r} at canvas-space ${i}-${a},${o}`,{sixteenthStampId:r,startColumn:i,endColumn:a,row:o,placementId:u.id}),u},removeSixteenthStampPlacement(r){const i=this.state.sixteenthStampPlacements.findIndex(A=>A.id===r);if(i===-1)return!1;const o=this.state.sixteenthStampPlacements.splice(i,1)[0];return o?(this.emit("sixteenthStampPlacementsChanged"),s("debug",`Removed sixteenth stamp ${o.sixteenthStampId} at ${o.startColumn}-${o.endColumn},${o.row}`,{placementId:r,sixteenthStampId:o.sixteenthStampId,startColumn:o.startColumn,endColumn:o.endColumn,row:o.row}),!0):!1},eraseSixteenthStampsInArea(r,i,o,A){const a=[];for(const c of this.state.sixteenthStampPlacements){const u=c.startColumn<=i&&c.endColumn>=r,d=c.row>=o&&c.row<=A;u&&d&&a.push(c.id)}let l=!1;return a.forEach(c=>{this.removeSixteenthStampPlacement(c)&&(l=!0)}),l},getAllSixteenthStampPlacements(){return[...this.state.sixteenthStampPlacements]},getSixteenthStampAt(r,i){return this.state.sixteenthStampPlacements.find(o=>o.row===i&&r>=o.startColumn&&r<o.endColumn)||null},clearAllSixteenthStamps(){const r=this.state.sixteenthStampPlacements.length>0;this.state.sixteenthStampPlacements=[],r&&(this.emit("sixteenthStampPlacementsChanged"),s("info","Cleared all sixteenth stamp placements"))},getSixteenthStampPlaybackData(){return this.state.sixteenthStampPlacements.map(r=>{const i=this.state.fullRowData[r.row];return{sixteenthStampId:r.sixteenthStampId,column:r.startColumn,startColumn:r.startColumn,endColumn:r.endColumn,row:r.row,pitch:(i==null?void 0:i.toneNote)||"",color:r.color,placement:r}}).filter(r=>r.pitch)},updateSixteenthStampShapeOffset(r,i,o){const A=this.state.sixteenthStampPlacements.find(a=>a.id===r);if(!A){s("warn","[SIXTEENTH STAMP SHAPE OFFSET] Placement not found",{placementId:r});return}A.shapeOffsets||(A.shapeOffsets={}),s("debug","[SIXTEENTH STAMP SHAPE OFFSET] Updating shape offset",{placementId:r,shapeKey:i,oldOffset:A.shapeOffsets[i]||0,newOffset:o,baseRow:A.row,targetRow:A.row+o}),A.shapeOffsets[i]=o,this.emit("sixteenthStampPlacementsChanged")},getSixteenthStampShapeRow(r,i){var A;const o=((A=r.shapeOffsets)==null?void 0:A[i])||0;return r.row+o}}}function ZI(){return`triplet-stamp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function tF(n={}){const{canvasToTime:t,timeToCanvas:e,getColumnMap:s,log:r=()=>{}}=n;return{addTripletStampPlacement(i){this.state.tripletStampPlacements||(this.state.tripletStampPlacements=[]);const o=i.startTimeIndex+i.span*2,A=this.state.tripletStampPlacements.find(l=>l.row!==i.row?!1:!(l.startTimeIndex+l.span*2<=i.startTimeIndex||o<=l.startTimeIndex));if(A&&this.removeTripletStampPlacement(A.id),this.state.sixteenthStampPlacements&&t&&s){const l=s(this.state);this.state.sixteenthStampPlacements.filter(u=>{if(u.row!==i.row)return!1;const d=t(u.startColumn,l);return d===null?!0:!(d+2<=i.startTimeIndex||d>=o)}).forEach(u=>{this.removeSixteenthStampPlacement&&this.removeSixteenthStampPlacement(u.id)})}const a={id:ZI(),...i,shapeOffsets:i.shapeOffsets||{}};return this.state.tripletStampPlacements.push(a),this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),r("debug",`Added triplet stamp ${i.tripletStampId} at time ${i.startTimeIndex}, row ${i.row}`,{tripletStampId:i.tripletStampId,startTimeIndex:i.startTimeIndex,span:i.span,row:i.row,placementId:a.id}),a},removeTripletStampPlacement(i){if(!this.state.tripletStampPlacements)return!1;const o=this.state.tripletStampPlacements.findIndex(a=>a.id===i);if(o===-1)return!1;const A=this.state.tripletStampPlacements.splice(o,1)[0];return A?(this.emit("tripletStampPlacementsChanged"),r("debug",`Removed triplet stamp ${A.tripletStampId} at time ${A.startTimeIndex}, row ${A.row}`,{placementId:i,tripletStampId:A.tripletStampId,startTimeIndex:A.startTimeIndex,span:A.span,row:A.row}),!0):!1},eraseTripletStampsInArea(i,o,A,a){if(!this.state.tripletStampPlacements||!e||!s)return!1;const l=s(this.state),c=[];for(const d of this.state.tripletStampPlacements)if(d.row>=A&&d.row<=a){const p=d.span*2,h=e(d.startTimeIndex,l);h+p-1<i||h>o||c.push(d.id)}let u=!1;return c.forEach(d=>{this.removeTripletStampPlacement(d)&&(u=!0)}),u},getAllTripletStampPlacements(){return[...this.state.tripletStampPlacements||[]]},getTripletStampAt(i,o){return this.state.tripletStampPlacements&&this.state.tripletStampPlacements.find(A=>A.row===o&&i>=A.startTimeIndex&&i<A.startTimeIndex+A.span*2)||null},clearAllTripletStamps(){if(!this.state.tripletStampPlacements)return;const i=this.state.tripletStampPlacements.length>0;this.state.tripletStampPlacements=[],i&&(this.emit("tripletStampPlacementsChanged"),r("info","Cleared all triplet stamp placements"))},getTripletStampPlaybackData(){return this.state.tripletStampPlacements?this.state.tripletStampPlacements.map(i=>{const o=this.state.fullRowData[i.row];return{startTimeIndex:i.startTimeIndex,tripletStampId:i.tripletStampId,row:i.row,pitch:(o==null?void 0:o.toneNote)??"",color:i.color,span:i.span,placement:i}}).filter(i=>i.pitch):[]},updateTripletStampShapeOffset(i,o,A){var l;const a=(l=this.state.tripletStampPlacements)==null?void 0:l.find(c=>c.id===i);if(!a){r("warn","[TRIPLET STAMP SHAPE OFFSET] Placement not found",{placementId:i});return}a.shapeOffsets||(a.shapeOffsets={}),r("debug","[TRIPLET STAMP SHAPE OFFSET] Updating shape offset",{placementId:i,shapeKey:o,oldOffset:a.shapeOffsets[o]||0,newOffset:A,baseRow:a.row,targetRow:a.row+A}),a.shapeOffsets[o]=A,this.emit("tripletStampPlacementsChanged")},getTripletStampShapeRow(i,o){var a;const A=((a=i.shapeOffsets)==null?void 0:a[o])||0;return i.row+A}}}const Fm={COMPRESSION_2_3:2/3,EXPANSION_3_2:3/2};function eF(n,t,e=null,s=null,r=null){return{id:`mod_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,measureIndex:n,ratio:t,active:!0,xPosition:e,columnIndex:s,macrobeatIndex:r}}const Tm=new Array(19).fill(2),nF=["anacrusis","anacrusis","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid"],_m=new Array(16).fill(2),sF=["dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed"];function Mm(n,t){const e=t(n),s=new Map;e.entries.forEach(r=>{r.type==="tonic"&&r.tonicSignUuid&&typeof r.canvasIndex=="number"&&s.set(r.tonicSignUuid,r.canvasIndex)}),Object.entries(n.tonicSignGroups||{}).forEach(([r,i])=>{const o=s.get(r);o!==void 0&&i.forEach(A=>{A.columnIndex=o})})}const rF={entries:[],visualToCanvas:new Map,visualToTime:new Map,canvasToVisual:new Map,canvasToTime:new Map,timeToCanvas:new Map,timeToVisual:new Map,macrobeatBoundaries:[],totalVisualColumns:0,totalCanvasColumns:0,totalTimeColumns:0,totalWidthUnmodulated:0};function iF(n={}){const{getColumnMap:t=()=>rF,visualToTimeIndex:e=()=>null,timeIndexToVisualColumn:s=()=>null,getTimeBoundaryAfterMacrobeat:r=()=>0,log:i=()=>{}}=n;return{setAnacrusis(o){var h,m,g;if(this.state.hasAnacrusis===o)return;const A=[...this.state.macrobeatGroupings],a=[...this.state.macrobeatBoundaryStyles],l=A.reduce((v,w)=>v+w,0);let c,u;if(o){const v=this._anacrusisCache,w=Tm.length-_m.length,y=Tm.slice(0,w),I=nF.slice(0,w),B=(h=v==null?void 0:v.groupings)!=null&&h.length?[...v.groupings]:[...y],C=(m=v==null?void 0:v.boundaryStyles)!=null&&m.length?[...v.boundaryStyles]:[...I];if(c=[...B,...A],u=[...C,...a],!((g=v==null?void 0:v.boundaryStyles)!=null&&g.length))for(let b=0;b<C.length;b++)u[b]=b<C.length-1?"anacrusis":"solid";this._anacrusisCache=null,i("debug","rhythmActions","Enabled anacrusis",{insertedCount:B.length,insertedColumns:B.reduce((b,S)=>b+S,0)},"state")}else{const v=a.findIndex(B=>B==="solid");let w=0;if(v!==-1)w=v+1;else for(;w<a.length&&a[w]==="anacrusis";)w++;w=Math.min(w,A.length);const y=A.slice(0,w),I=a.slice(0,w);w>0?this._anacrusisCache={groupings:y,boundaryStyles:I}:this._anacrusisCache=null,c=A.slice(w),u=a.slice(w).map(B=>B==="anacrusis"?"dashed":B),c.length===0&&(c=[..._m],u=[...sF]),i("debug","rhythmActions","Disabled anacrusis",{removalCount:w,removedColumns:y.reduce((B,C)=>B+C,0)},"state")}const p=c.reduce((v,w)=>v+w,0)-l;if(this.state.hasAnacrusis=o,this.state.macrobeatGroupings=[...c],this.state.macrobeatBoundaryStyles=[...u],Mm(this.state,t),p!==0){const v=[];this.state.placedNotes.forEach(C=>{const b=e(this.state,C.startColumnIndex,A),S=e(this.state,C.endColumnIndex,A);if(b===null||S===null)return;const T=b+p,x=S+p;if(T<0){v.push(C);return}const _=s(this.state,T,c),F=s(this.state,x,c);if(_===null||F===null){v.push(C);return}C.startColumnIndex=_,C.endColumnIndex=F}),v.forEach(C=>{const b=this.state.placedNotes.indexOf(C);b>-1&&this.state.placedNotes.splice(b,1)});const w=[];this.state.sixteenthStampPlacements.forEach(C=>{const b=e(this.state,C.startColumn,A),S=e(this.state,C.endColumn,A);if(b===null||S===null)return;const T=b+p,x=S+p;if(T<0){w.push(C);return}const _=s(this.state,T,c),F=s(this.state,x,c);if(_===null||F===null){w.push(C);return}C.startColumn=_,C.endColumn=F}),w.forEach(C=>{const b=this.state.sixteenthStampPlacements.indexOf(C);b>-1&&this.state.sixteenthStampPlacements.splice(b,1)});const y=[];this.state.tripletStampPlacements&&(this.state.tripletStampPlacements.forEach(C=>{const b=C.startTimeIndex+p;b<0?y.push(C):C.startTimeIndex=b}),y.forEach(C=>{const b=this.state.tripletStampPlacements.indexOf(C);b>-1&&this.state.tripletStampPlacements.splice(b,1)}));const I=[],B=o?c.length-A.length:-(A.length-c.length);this.state.tempoModulationMarkers.forEach(C=>{const b=C.measureIndex+B;if(b<0){I.push(C);return}C.measureIndex=b,C.columnIndex=null,C.xPosition=null,C.macrobeatIndex=null}),I.forEach(C=>{const b=this.state.tempoModulationMarkers.indexOf(C);b>-1&&this.state.tempoModulationMarkers.splice(b,1)})}this.emit("anacrusisChanged",o),this.emit("notesChanged"),this.emit("sixteenthStampPlacementsChanged"),this.emit("tripletStampPlacementsChanged"),this.emit("tempoModulationMarkersChanged"),this.emit("rhythmStructureChanged"),this.recordState()},toggleMacrobeatGrouping(o){if(o===void 0||o<0||o>=this.state.macrobeatGroupings.length){i("error","rhythmActions",`Invalid index for toggleMacrobeatGrouping: ${o}`,null,"state");return}const A=[...this.state.macrobeatGroupings],a=A[o],l=a===2?3:2,c=l-a,u=[...A];u[o]=l;const d=r(this.state,o,A),p=[];this.state.placedNotes.forEach(h=>{const m=e(this.state,h.startColumnIndex,A),g=e(this.state,h.endColumnIndex,A);if(!(m===null||g===null)&&m>=d){const v=m+c,w=g+c,y=s(this.state,v,u),I=s(this.state,w,u);y!==null&&I!==null?(h.startColumnIndex=y,h.endColumnIndex=I):p.push(h)}}),p.length&&p.forEach(h=>{const m=this.state.placedNotes.indexOf(h);m>-1&&this.state.placedNotes.splice(m,1)}),this.state.macrobeatGroupings=u,Mm(this.state,t),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},cycleMacrobeatBoundaryStyle(o){if(o===void 0||o<0||o>=this.state.macrobeatBoundaryStyles.length){i("error","rhythmActions",`Invalid index for cycleMacrobeatBoundaryStyle: ${o}`,null,"state");return}const A=this._isBoundaryInAnacrusis(o);let a;A?a=["dashed","solid","anacrusis"]:a=["dashed","solid"];const l=this.state.macrobeatBoundaryStyles[o]??"dashed",c=a.indexOf(l),u=c===-1?0:(c+1)%a.length,d=a[u]??"dashed";this.state.macrobeatBoundaryStyles[o]=d,this.emit("rhythmStructureChanged"),this.recordState()},_isBoundaryInAnacrusis(o){if(!this.state.hasAnacrusis)return!1;for(let A=0;A<=o;A++)if(this.state.macrobeatBoundaryStyles[A]==="solid")return A===o;return!0},increaseMacrobeatCount(){this.state.macrobeatGroupings.push(2),this.state.macrobeatBoundaryStyles.push("dashed"),this.emit("rhythmStructureChanged"),this.recordState()},decreaseMacrobeatCount(){if(this.state.macrobeatGroupings.length>1){const o=this.state.macrobeatGroupings.length-1,A=r(this.state,o-1,this.state.macrobeatGroupings),a=[];this.state.placedNotes.forEach(u=>{const d=e(this.state,u.startColumnIndex,this.state.macrobeatGroupings);d!==null&&d>=A&&a.push(u)}),a.forEach(u=>{const d=this.state.placedNotes.indexOf(u);d>-1&&this.state.placedNotes.splice(d,1)});const l=[];this.state.sixteenthStampPlacements.forEach(u=>{const d=e(this.state,u.startColumn,this.state.macrobeatGroupings);d!==null&&d>=A&&l.push(u)}),l.forEach(u=>{const d=this.state.sixteenthStampPlacements.indexOf(u);d>-1&&this.state.sixteenthStampPlacements.splice(d,1)});const c=[];this.state.tripletStampPlacements&&(this.state.tripletStampPlacements.forEach(u=>{u.startTimeIndex>=A&&c.push(u)}),c.forEach(u=>{const d=this.state.tripletStampPlacements.indexOf(u);d>-1&&this.state.tripletStampPlacements.splice(d,1)})),this.state.macrobeatGroupings.pop(),this.state.macrobeatBoundaryStyles.pop(),a.length>0&&this.emit("notesChanged"),l.length>0&&this.emit("sixteenthStampPlacementsChanged"),c.length>0&&this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),this.recordState()}},updateTimeSignature(o,A){if(!Array.isArray(A)||A.length===0){i("error","rhythmActions","Invalid groupings provided to updateTimeSignature",null,"state");return}let a=0,l=0,c=0;for(let y=0;y<this.state.macrobeatGroupings.length;y++){if(c===o){a=y;break}const I=y===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[y]==="solid"||I)&&c++}c=0;for(let y=0;y<this.state.macrobeatGroupings.length;y++)if(c===o){const I=y===this.state.macrobeatGroupings.length-1;if(this.state.macrobeatBoundaryStyles[y]==="solid"||I){l=y;break}}else if(c<o){const I=y===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[y]==="solid"||I)&&c++}const u=l-a+1,d=A.length,p=this.state.macrobeatGroupings.slice(a,l+1).reduce((y,I)=>y+I,0),m=A.reduce((y,I)=>y+I,0)-p,g=r(this.state,l,this.state.macrobeatGroupings);if(m!==0){const y=(()=>{const B=[...this.state.macrobeatGroupings];return B.splice(a,u,...A),B})(),I=[];this.state.placedNotes.forEach(B=>{const C=e(this.state,B.startColumnIndex,this.state.macrobeatGroupings),b=e(this.state,B.endColumnIndex,this.state.macrobeatGroupings);if(!(C===null||b===null)&&C>=g){const S=C+m,T=b+m,x=s(this.state,S,y),_=s(this.state,T,y);x!==null&&_!==null?(B.startColumnIndex=x,B.endColumnIndex=_):I.push(B)}}),I.length&&I.forEach(B=>{const C=this.state.placedNotes.indexOf(B);C>-1&&this.state.placedNotes.splice(C,1)})}const v=[...A],w=new Array(Math.max(d-1,0)).fill("dashed");if(l<this.state.macrobeatBoundaryStyles.length){const y=this.state.macrobeatBoundaryStyles[l]??"dashed";w.push(y)}this.state.macrobeatGroupings.splice(a,u,...v),this.state.macrobeatBoundaryStyles.splice(a,u-1,...w),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},addModulationMarker(o,A,a=null,l=null,c=null){if(!Object.values(Fm).includes(A))return i("error","rhythmActions",`Invalid modulation ratio: ${A}`,null,"state"),null;const u=this.state.tempoModulationMarkers.findIndex(p=>p.measureIndex===o||c!==null&&p.macrobeatIndex===c||l!==null&&p.columnIndex===l);if(u!==-1){const p=this.state.tempoModulationMarkers[u];return i("info","rhythmActions",`Replacing existing modulation marker ${p.id} at measure ${o} (old ratio: ${p.ratio}, new ratio: ${A})`,null,"state"),p.ratio=A,p.xPosition=a,l!==null&&(p.columnIndex=l),c!==null&&(p.macrobeatIndex=c),this.emit("tempoModulationMarkersChanged"),this.recordState(),p.id}const d=eF(o,A,a,l,c);return this.state.tempoModulationMarkers.push(d),this.state.tempoModulationMarkers.sort((p,h)=>p.measureIndex-h.measureIndex),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Added modulation marker ${d.id} at measure ${o} with ratio=${A}, columnIndex=${l}`,null,"state"),d.id},removeModulationMarker(o){const A=this.state.tempoModulationMarkers.findIndex(a=>a.id===o);if(A===-1){i("warn","rhythmActions",`Modulation marker not found: ${o}`,null,"state");return}this.state.tempoModulationMarkers.splice(A,1),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Removed modulation marker ${o}`,null,"state")},setModulationRatio(o,A){if(!Object.values(Fm).includes(A)){i("error","rhythmActions",`Invalid modulation ratio: ${A}`,null,"state");return}const a=this.state.tempoModulationMarkers.find(l=>l.id===o);if(!a){i("warn","rhythmActions",`Modulation marker not found: ${o}`,null,"state");return}a.ratio=A,this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Updated modulation marker ${o} ratio to ${A}`,null,"state")},moveModulationMarker(o,A){const a=this.state.tempoModulationMarkers.find(l=>l.id===o);if(!a){i("warn","rhythmActions",`Modulation marker not found: ${o}`,null,"state");return}a.measureIndex=A,this.state.tempoModulationMarkers.sort((l,c)=>l.measureIndex-c.measureIndex),this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Moved modulation marker ${o} to measure ${A}`,null,"state")},toggleModulationMarker(o){const A=this.state.tempoModulationMarkers.find(a=>a.id===o);if(!A){i("warn","rhythmActions",`Modulation marker not found: ${o}`,null,"state");return}A.active=!A.active,this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Toggled modulation marker ${o} active state to ${A.active}`,null,"state")},clearModulationMarkers(){const o=this.state.tempoModulationMarkers.length;this.state.tempoModulationMarkers=[],this.emit("tempoModulationMarkersChanged"),this.recordState(),i("info","rhythmActions",`Cleared ${o} modulation markers`,null,"state")}}}function Qm(n){const t=JSON.parse(JSON.stringify(n));for(const e in t){const s=t[e];s.coeffs&&typeof s.coeffs=="object"&&!Array.isArray(s.coeffs)?s.coeffs=new Float32Array(Object.values(s.coeffs)):Array.isArray(s.coeffs)&&(s.coeffs=new Float32Array(s.coeffs)),s.phases&&typeof s.phases=="object"&&!Array.isArray(s.phases)?s.phases=new Float32Array(Object.values(s.phases)):Array.isArray(s.phases)&&(s.phases=new Float32Array(s.phases))}return t}const oF=new Set(["dashed","solid","anacrusis"]);function AF(n){return Array.isArray(n)&&n.length>0&&n.every(t=>t===2||t===3)}function aF(n,t){return Array.isArray(n)&&n.length===Math.max(t-1,0)&&n.every(e=>oF.has(e))}function lF(n,t){if(n)try{const e=n.getItem(t);if(e===null)return;const s=JSON.parse(e),r=s.macrobeatGroupings;if(!AF(r)){n.removeItem(t);return}if(!aF(s.macrobeatBoundaryStyles,r.length)){n.removeItem(t);return}if(delete s.timbres,s.pitchRange){const i=Wn.length,o=Math.max(0,i-1),A=Math.max(0,Math.min(o,s.pitchRange.topIndex??0)),a=Math.max(A,Math.min(o,s.pitchRange.bottomIndex??o));s.pitchRange={topIndex:A,bottomIndex:a}}if("playheadMode"in s){const i=s.playheadMode;i!=="cursor"&&i!=="microbeat"&&i!=="macrobeat"&&delete s.playheadMode}return s.fullRowData=[...Wn],s}catch{return}}function cF(n,t,e){if(t)try{const s=JSON.parse(JSON.stringify({placedNotes:n.placedNotes,placedChords:n.placedChords,tonicSignGroups:n.tonicSignGroups,sixteenthStampPlacements:n.sixteenthStampPlacements,tripletStampPlacements:n.tripletStampPlacements,macrobeatGroupings:n.macrobeatGroupings,macrobeatBoundaryStyles:n.macrobeatBoundaryStyles,hasAnacrusis:n.hasAnacrusis,baseMicrobeatPx:n.baseMicrobeatPx,tempoModulationMarkers:n.tempoModulationMarkers,tempo:n.tempo,activeChordIntervals:n.activeChordIntervals,selectedNote:n.selectedNote,annotations:n.annotations,pitchRange:n.pitchRange,degreeDisplayMode:n.degreeDisplayMode,showOctaveLabels:n.showOctaveLabels,longNoteStyle:n.longNoteStyle,playheadMode:n.playheadMode})),r=JSON.stringify(s);t.setItem(e,r)}catch{}}function uF(n={}){const{storageKey:t="studentNotationState",storage:e,initialState:s,onClearState:r,noteActionCallbacks:i={},sixteenthStampActionCallbacks:o={},tripletStampActionCallbacks:A={},rhythmActionCallbacks:a={}}=n,l={},c=lF(e,t),u=!c,h={state:{...XI(),...c,...s},isColdStart:u,on(m,g){l[m]||(l[m]=[]),l[m].push(g)},off(m,g){if(l[m]){const v=l[m].indexOf(g);v>-1&&l[m].splice(v,1)}},emit(m,g){l[m]&&l[m].forEach(v=>{try{v(g)}catch(w){console.error(`Error in listener for event "${m}"`,w)}})},dispose(){for(const m in l)delete l[m]},saveState(){cF(h.state,e,t)},recordState(){h.state.history=h.state.history.slice(0,h.state.historyIndex+1);const m=JSON.parse(JSON.stringify(h.state.timbres)),g={notes:JSON.parse(JSON.stringify(h.state.placedNotes)),tonicSignGroups:JSON.parse(JSON.stringify(h.state.tonicSignGroups)),placedChords:JSON.parse(JSON.stringify(h.state.placedChords)),sixteenthStampPlacements:JSON.parse(JSON.stringify(h.state.sixteenthStampPlacements)),tripletStampPlacements:JSON.parse(JSON.stringify(h.state.tripletStampPlacements||[])),timbres:m,annotations:h.state.annotations?JSON.parse(JSON.stringify(h.state.annotations)):[],lassoSelection:JSON.parse(JSON.stringify(h.state.lassoSelection))};h.state.history.push(g),h.state.historyIndex++,h.emit("historyChanged"),h.saveState()},undo(){var m;if(h.state.historyIndex>0){h.state.historyIndex--;const g=h.state.history[h.state.historyIndex];if(!g)return;h.state.placedNotes=JSON.parse(JSON.stringify(g.notes)),h.state.tonicSignGroups=JSON.parse(JSON.stringify(g.tonicSignGroups)),h.state.sixteenthStampPlacements=JSON.parse(JSON.stringify(g.sixteenthStampPlacements||[])),h.state.tripletStampPlacements=JSON.parse(JSON.stringify(g.tripletStampPlacements||[])),h.state.timbres=Qm(g.timbres),h.state.annotations=g.annotations?JSON.parse(JSON.stringify(g.annotations)):[],h.emit("notesChanged"),h.emit("sixteenthStampPlacementsChanged"),h.emit("tripletStampPlacementsChanged"),h.emit("rhythmStructureChanged"),(m=h.state.selectedNote)!=null&&m.color&&h.emit("timbreChanged",h.state.selectedNote.color),h.emit("annotationsChanged"),h.emit("historyChanged")}},redo(){var m;if(h.state.historyIndex<h.state.history.length-1){h.state.historyIndex++;const g=h.state.history[h.state.historyIndex];if(!g)return;h.state.placedNotes=JSON.parse(JSON.stringify(g.notes)),h.state.tonicSignGroups=JSON.parse(JSON.stringify(g.tonicSignGroups)),h.state.sixteenthStampPlacements=JSON.parse(JSON.stringify(g.sixteenthStampPlacements||[])),h.state.tripletStampPlacements=JSON.parse(JSON.stringify(g.tripletStampPlacements||[])),h.state.timbres=Qm(g.timbres),h.state.annotations=g.annotations?JSON.parse(JSON.stringify(g.annotations)):[],h.emit("notesChanged"),h.emit("sixteenthStampPlacementsChanged"),h.emit("tripletStampPlacementsChanged"),h.emit("rhythmStructureChanged"),(m=h.state.selectedNote)!=null&&m.color&&h.emit("timbreChanged",h.state.selectedNote.color),h.emit("annotationsChanged"),h.emit("historyChanged")}},clearSavedState(){e&&(e.removeItem(t),e.removeItem("effectDialValues")),r&&r()},setPlaybackState(m,g){h.state.isPlaying=m,h.state.isPaused=g,h.emit("playbackStateChanged",{isPlaying:m,isPaused:g})},setLooping(m){h.state.isLooping=m,h.emit("loopingChanged",m)},setTempo(m){h.state.tempo=m,h.emit("tempoChanged",m)},setPlayheadMode(m){h.state.playheadMode=m,h.emit("playheadModeChanged",m)},setSelectedTool(m,g){const v=h.state.selectedTool;if(h.state.previousTool=v,h.state.selectedTool=m,g!==void 0){const w=typeof g=="string"?parseInt(g,10):g;isNaN(w)||(h.state.selectedToolTonicNumber=w)}h.emit("toolChanged",{newTool:m,oldTool:v})},setSelectedNote(m,g){const v={...h.state.selectedNote};h.state.selectedNote={shape:m,color:g},h.emit("noteChanged",{newNote:h.state.selectedNote,oldNote:v})},setPitchRange(m){h.state.pitchRange={...h.state.pitchRange,...m},h.emit("pitchRangeChanged",h.state.pitchRange)},setDegreeDisplayMode(m){h.state.degreeDisplayMode=m,h.emit("degreeDisplayModeChanged",m)},setLongNoteStyle(m){h.state.longNoteStyle=m,h.emit("longNoteStyleChanged",m)},toggleAccidentalMode(m){h.state.accidentalMode[m]=!h.state.accidentalMode[m],h.emit("accidentalModeChanged",h.state.accidentalMode)},toggleFrequencyLabels(){h.state.showFrequencyLabels=!h.state.showFrequencyLabels,h.emit("frequencyLabelsChanged",h.state.showFrequencyLabels)},toggleOctaveLabels(){h.state.showOctaveLabels=!h.state.showOctaveLabels,h.emit("octaveLabelsChanged",h.state.showOctaveLabels)},toggleFocusColours(){h.state.focusColours=!h.state.focusColours,h.emit("focusColoursChanged",h.state.focusColours)},toggleWaveformExtendedView(){h.state.waveformExtendedView=!h.state.waveformExtendedView,h.emit("waveformExtendedViewChanged",h.state.waveformExtendedView)},setLayoutConfig(m){m.cellWidth!==void 0&&(h.state.cellWidth=m.cellWidth),m.cellHeight!==void 0&&(h.state.cellHeight=m.cellHeight),m.columnWidths!==void 0&&(h.state.columnWidths=m.columnWidths),h.emit("layoutConfigChanged",m)},setDeviceProfile(m){h.state.deviceProfile={...h.state.deviceProfile,...m},h.emit("deviceProfileChanged",h.state.deviceProfile)},setPrintPreviewActive(m){h.state.isPrintPreviewActive=m,h.emit("printPreviewStateChanged",m)},setPrintOptions(m){h.state.printOptions={...h.state.printOptions,...m},h.emit("printOptionsChanged",h.state.printOptions)},setAdsrTimeAxisScale(m){h.state.adsrTimeAxisScale=m,h.emit("adsrTimeAxisScaleChanged",m)},setAdsrComponentWidth(){},shiftGridUp(){},shiftGridDown(){},setGridPosition(){},setKeySignature(m){h.state.keySignature=m,h.emit("keySignatureChanged",m)},setActiveChordIntervals(m){h.state.activeChordIntervals=m,h.emit("activeChordIntervalsChanged",m)},setIntervalsInversion(m){h.state.isIntervalsInverted=m,h.emit("intervalsInversionChanged",m)},setChordPosition(m){h.state.chordPositionState=m,h.emit("chordPositionChanged",m)},setADSR(m,g){h.state.timbres[m]&&(h.state.timbres[m].adsr={...h.state.timbres[m].adsr,...g},h.emit("timbreChanged",m))},setHarmonicCoefficients(m,g){h.state.timbres[m]&&(h.state.timbres[m].coeffs=g,h.emit("timbreChanged",m))},setHarmonicPhases(m,g){h.state.timbres[m]&&(h.state.timbres[m].phases=g,h.emit("timbreChanged",m))},setFilterSettings(m,g){h.state.timbres[m]&&(h.state.timbres[m].filter={...h.state.timbres[m].filter,...g},h.emit("timbreChanged",m))},applyPreset(m,g){h.state.timbres[m]&&(Object.assign(h.state.timbres[m],g),h.emit("timbreChanged",m))},...YI(i),...JI(o),...tF(A),...iF(a)};return e&&(h.on("tempoChanged",()=>h.saveState()),h.on("degreeDisplayModeChanged",()=>h.saveState()),h.on("longNoteStyleChanged",()=>h.saveState()),h.on("playheadModeChanged",()=>h.saveState())),u&&e&&h.saveState(),h}class dF extends Wo{constructor(e){super(e);M(this,"presetGain");M(this,"vibratoLFO");M(this,"vibratoDepth");M(this,"vibratoGain");M(this,"tremoloLFO");M(this,"tremoloDepth");M(this,"tremoloGain");M(this,"hpFilter");M(this,"lpFilterForBP");M(this,"lpFilterSolo");M(this,"hpOutput");M(this,"bpOutput");M(this,"lpOutput");M(this,"hp_bp_fade");M(this,"main_fade");M(this,"wetDryFade");this.presetGain=new Mt(e.gain||1),this.vibratoLFO=new bc(0,0),this.vibratoDepth=new ea(-1,1),this.vibratoGain=new Mt(0),this.vibratoLFO.connect(this.vibratoDepth),this.vibratoDepth.connect(this.vibratoGain),this.vibratoGain.connect(this.oscillator.frequency),this.tremoloLFO=new bc(0,0),this.tremoloDepth=new ea(0,1),this.tremoloGain=new Mt(1),this.tremoloLFO.connect(this.tremoloDepth),this.tremoloDepth.connect(this.tremoloGain.gain),this.hpFilter=new MA({type:"highpass"}),this.lpFilterForBP=new MA({type:"lowpass"}),this.lpFilterSolo=new MA({type:"lowpass"}),this.hpOutput=new Mt,this.bpOutput=new Mt,this.lpOutput=new Mt,this.hp_bp_fade=new Eo(0),this.main_fade=new Eo(0),this.wetDryFade=new Eo(0),this.oscillator.connect(this.presetGain),this.presetGain.connect(this.wetDryFade.a),this.presetGain.connect(this.hpFilter),this.hpFilter.connect(this.hpOutput),this.hpFilter.connect(this.lpFilterForBP),this.lpFilterForBP.connect(this.bpOutput),this.presetGain.connect(this.lpFilterSolo),this.lpFilterSolo.connect(this.lpOutput),this.hpOutput.connect(this.hp_bp_fade.a),this.bpOutput.connect(this.hp_bp_fade.b),this.lpOutput.connect(this.main_fade.b),this.hp_bp_fade.connect(this.main_fade.a),this.main_fade.connect(this.wetDryFade.b),this.wetDryFade.connect(this.tremoloGain),this.tremoloGain.connect(this.envelope),e.filter&&this._setFilter(e.filter),e.vibrato?this._setVibrato(e.vibrato):this._setVibrato({speed:0,span:0}),e.tremelo?this._setTremolo(e.tremelo):this._setTremolo({speed:0,span:0})}_setPresetGain(e){this.presetGain&&(this.presetGain.gain.value=e)}_setVibrato(e,s=be()){var p,h;if(!this.vibratoLFO||!this.vibratoGain)return;const r=e.speed/100*16,o=(((h=(p=Ke())==null?void 0:p.rawContext)==null?void 0:h.state)??er.state)==="running";if(e.speed===0||e.span===0){o&&this.vibratoLFO.state==="started"&&this.vibratoLFO.stop(s),this.vibratoLFO.frequency.value=0,this.vibratoGain.gain.value=0;return}o&&this.vibratoLFO.state!=="started"&&this.vibratoLFO.start(s),this.vibratoLFO.frequency.value=r;const l=e.span/100*50/1200,d=440*(Math.pow(2,l)-1);this.vibratoGain.gain.value=d}_setTremolo(e,s=be()){var c,u;if(!this.tremoloLFO||!this.tremoloGain)return;const r=e.speed/100*16,o=(((u=(c=Ke())==null?void 0:c.rawContext)==null?void 0:u.state)??er.state)==="running";if(e.speed===0||e.span===0){o&&this.tremoloLFO.state==="started"&&this.tremoloLFO.stop(s),this.tremoloLFO.frequency.value=0,this.tremoloGain.gain.cancelScheduledValues(s),this.tremoloGain.gain.value=1;return}o&&this.tremoloLFO.state!=="started"&&this.tremoloLFO.start(s),this.tremoloLFO.frequency.value=r;const A=e.span/100,a=Math.max(0,1-A),l=1;this.tremoloDepth.min=a,this.tremoloDepth.max=l}_setFilter(e){this.wetDryFade.fade.value=e.enabled?1:0;const s=II(e.cutoff+35).toFrequency(),r=e.resonance/100*12+.1;this.hpFilter.set({frequency:s,Q:r}),this.lpFilterForBP.set({frequency:s,Q:r}),this.lpFilterSolo.set({frequency:s,Q:r});const i=e.blend;i<=1?(this.main_fade.fade.value=0,this.hp_bp_fade.fade.value=i):(this.main_fade.fade.value=i-1,this.hp_bp_fade.fade.value=1)}}const Tw={polyphonyReference:32,smoothingTauMs:200,masterGainRampMs:50,gainUpdateIntervalMs:16};function _w(n=Tw.polyphonyReference){return 1/Math.sqrt(n)}class hF{constructor(t,e={}){M(this,"masterGain");M(this,"options");M(this,"perVoiceBaselineGain");M(this,"activeVoiceCount",0);M(this,"smoothedVoiceCount");M(this,"gainUpdateLoopId",null);this.masterGain=t,this.options={...Tw,...e},this.perVoiceBaselineGain=_w(this.options.polyphonyReference),this.smoothedVoiceCount=this.options.polyphonyReference}start(){this.stop(),this.gainUpdateLoopId=setInterval(()=>this.updateMasterGain(),this.options.gainUpdateIntervalMs)}stop(){this.gainUpdateLoopId!==null&&(clearInterval(this.gainUpdateLoopId),this.gainUpdateLoopId=null)}noteOn(t=1){t<=0||(this.activeVoiceCount+=t)}noteOff(t=1){t<=0||(this.activeVoiceCount=Math.max(0,this.activeVoiceCount-t))}clampActiveVoiceCountToAtMost(t){Number.isFinite(t)&&(this.activeVoiceCount=Math.max(0,Math.min(this.activeVoiceCount,Math.floor(t))))}resetActiveVoiceCount(){this.activeVoiceCount=0}getActiveVoiceCount(){return this.activeVoiceCount}updateMasterGain(){const{polyphonyReference:t,smoothingTauMs:e,masterGainRampMs:s,gainUpdateIntervalMs:r}=this.options,i=be();if(this.activeVoiceCount===0){this.smoothedVoiceCount=.01*t+(1-.01)*this.smoothedVoiceCount;return}const o=r/1e3,A=1-Math.exp(-o/(e/1e3)),a=Math.max(1,this.activeVoiceCount);this.smoothedVoiceCount=A*a+(1-A)*this.smoothedVoiceCount;const l=Math.sqrt(t/this.smoothedVoiceCount),c=this.perVoiceBaselineGain*l;this.masterGain.gain.rampTo(c,s/1e3,i)}}const fF={clippingWarningThresholdDb:-3,clippingMonitorIntervalMs:500,clippingWarningCooldownMs:2e3};class pF{constructor(t,e={}){M(this,"meter");M(this,"options");M(this,"clippingMonitorId",null);M(this,"lastClippingWarningAt",0);this.meter=t,this.options={...fF,...e}}start(){this.stop(),this.lastClippingWarningAt=0,this.clippingMonitorId=setInterval(()=>{var r,i;const t=this.meter.getValue(),e=Array.isArray(t)?t[0]:t;if(e===void 0||e<=this.options.clippingWarningThresholdDb)return;const s=Date.now();s-this.lastClippingWarningAt<this.options.clippingWarningCooldownMs||(this.lastClippingWarningAt=s,(i=(r=this.options).onWarning)==null||i.call(r,e))},this.options.clippingMonitorIntervalMs)}stop(){this.clippingMonitorId!==null&&(clearInterval(this.clippingMonitorId),this.clippingMonitorId=null)}}function mF(n){const{timbres:t,masterVolume:e=0,effectsManager:s,harmonicFilter:r,logger:i,audioInit:o,getDrumVolume:A}=n,a={};let l=null,c=null,u=null,d=null,p=null,h={},m=null,g=null;const v={...t},w=i??{debug:()=>{},info:()=>{},warn:()=>{}};function y(C){if(r)return r.getFilteredCoefficients(C);const b=v[C];return b!=null&&b.coeffs?b.coeffs:new Float32Array([0,1])}function I(C){const b=C.reduce((S,T)=>S+Math.abs(T),0);return b>1?Array.from(C).map(S=>S/b):Array.from(C)}const B={init(){this.stopBackgroundMonitors(),l=new Mt(_w()),m=new hF(l),m.start(),c=new ks(e),u=new yu({threshold:-12,ratio:3,attack:.01,release:.1,knee:6}),d=new lp(-3),p=new Ap,l.connect(c),c.connect(u),u.connect(d),d.toDestination(),d.connect(p),p&&(g=new pF(p,{onWarning:C=>{w.warn("SynthEngine","Limiter input approaching clipping threshold",{level:C},"audio")}}),g.start());for(const C in v){const b=v[C];if(!b)continue;b.vibrato||(b.vibrato={speed:0,span:0}),b.tremelo||(b.tremelo={speed:0,span:0});const S=y(C),T=I(S),x=b.gain||1,_=new sp({voice:dF,options:{oscillator:{type:"custom",partials:T},envelope:b.adsr,filter:b.filter,vibrato:b.vibrato,tremelo:b.tremelo,gain:x}}).connect(l);s&&l&&s.applySynthEffects(_,C,l);const F=_.triggerAttack.bind(_);_.triggerAttack=function(...Q){const U=F(...Q),L=(Q[1]??be())+.005;return QA.schedule(()=>{const R=this._activeVoices;s?R&&R.size>0?R.forEach(N=>{N.effectsApplied||(s.applyEffectsToVoice(N,C),N.effectsApplied=!0)}):this._voices&&Array.isArray(this._voices)&&this._voices.forEach(N=>{N&&!N.effectsApplied&&(s.applyEffectsToVoice(N,C),N.effectsApplied=!0)}):R&&R.size>0?R.forEach(N=>{N._setVibrato&&N.vibratoApplied!==!0&&(N._setVibrato(this._currentVibrato),N.vibratoApplied=!0),N._setTremolo&&N.tremoloApplied!==!0&&(N._setTremolo(this._currentTremolo),N.tremoloApplied=!0)}):this._voices&&Array.isArray(this._voices)&&this._voices.forEach(N=>{N!=null&&N._setVibrato&&N.vibratoApplied!==!0&&(N._setVibrato(this._currentVibrato),N.vibratoApplied=!0),N!=null&&N._setTremolo&&N.tremoloApplied!==!0&&(N._setTremolo(this._currentTremolo),N.tremoloApplied=!0)})},L),U},_._currentVibrato=b.vibrato,_._currentTremolo=b.tremelo,_._currentFilter=b.filter,a[C]=_,w.debug("SynthEngine",`Created filtered synth for color: ${C}`,null,"audio")}w.info("SynthEngine","Initialized with multi-timbral support",null,"audio")},updateSynthForColor(C){const b=v[C],S=a[C];if(!S||!b)return;b.vibrato||(b.vibrato={speed:0,span:0}),b.tremelo||(b.tremelo={speed:0,span:0}),w.debug("SynthEngine",`Updating timbre for color ${C}`,null,"audio");const T=y(C),x=I(T);S.set({oscillator:{partials:x},envelope:b.adsr}),s&&l&&s.applySynthEffects(S,C,l),S._currentVibrato=b.vibrato,S._currentTremolo=b.tremelo,S._currentFilter=b.filter;const _=S._activeVoices;_&&_.size>0?_.forEach(F=>{if(F._setFilter&&F._setFilter(b.filter),F._setVibrato&&(F._setVibrato(b.vibrato),F.vibratoApplied=!0),F._setTremolo&&(F._setTremolo(b.tremelo),F.tremoloApplied=!0),F._setPresetGain){const Q=b.gain||1;F._setPresetGain(Q)}}):S._voices&&Array.isArray(S._voices)&&S._voices.forEach(F=>{if(F!=null&&F._setVibrato&&(F._setVibrato(b.vibrato),F.vibratoApplied=!0),F!=null&&F._setTremolo&&(F._setTremolo(b.tremelo),F.tremoloApplied=!0),F!=null&&F._setFilter&&F._setFilter(b.filter),F!=null&&F._setPresetGain){const Q=b.gain||1;F._setPresetGain(Q)}})},setBpm(C){try{ht!=null&&ht.bpm&&(ht.bpm.value=C,w.debug("SynthEngine",`Tone.Transport BPM updated to ${C}`,null,"audio"))}catch(b){w.warn("SynthEngine","Unable to update BPM on Tone.Transport",{tempo:C,error:b},"audio")}},setVolume(C){c&&(c.volume.value=C)},async playNote(C,b,S=be()){await(o||(()=>Bc()))();const x=Object.keys(a);if(x.length===0)return;const[_]=x;if(!_)return;const F=a[_];F&&F.triggerAttackRelease(C,b,S)},triggerAttack(C,b,S=be(),T=!1){const x=a[b];if(x)if(m==null||m.noteOn(1),T&&A){const _=A(),F=x.volume.value,Q=F+20*Math.log10(_);x.volume.value=Q,x.triggerAttack(C,S),QA.schedule(()=>{x!=null&&x.volume&&(x.volume.value=F)},S+.1)}else x.triggerAttack(C,S)},triggerAttackInteractive(C,b){B.triggerAttack(C,b,be()+.02)},quickReleasePitches(C,b){var x,_,F;const S=a[b];if(!S||!C||C.length===0)return;let T;try{const Q=typeof S.get=="function"?S.get():null,U=(x=Q==null?void 0:Q.envelope)==null?void 0:x.release;T=typeof U=="number"?U:void 0,S.set({envelope:{release:.01}}),C.forEach(L=>{S.triggerRelease(L,be())});const W=((_=S._activeVoices)==null?void 0:_.size)??((F=S._voices)==null?void 0:F.length)??(m==null?void 0:m.getActiveVoiceCount())??0;m==null||m.clampActiveVoiceCountToAtMost(W)}catch(Q){w.warn("SynthEngine","quickReleasePitches failed",{err:Q,color:b,pitches:C},"audio")}finally{if(T!==void 0)try{S.set({envelope:{release:T}})}catch{}}},triggerRelease(C,b,S=be()){var _,F;const T=a[b];if(!T)return;T.triggerRelease(C,S),m==null||m.noteOff(1);const x=((_=T._activeVoices)==null?void 0:_.size)??((F=T._voices)==null?void 0:F.length)??(m==null?void 0:m.getActiveVoiceCount())??0;m==null||m.clampActiveVoiceCountToAtMost(x)},releaseAll(){var C;for(const b in a)(C=a[b])==null||C.releaseAll();m==null||m.resetActiveVoiceCount()},createWaveformAnalyzer(C){const b=a[C];return b?(h[C]||(h[C]=new Da("waveform",1024),b.connect(h[C]),w.debug("SynthEngine",`Created waveform analyzer for color: ${C}`,null,"waveform")),h[C]):(w.warn("SynthEngine",`No synth found for color: ${C}`,null,"audio"),null)},getWaveformAnalyzer(C){return h[C]||null},getAllWaveformAnalyzers(){const C=new Map;for(const b in h)h[b]&&C.set(b,h[b]);return C},removeWaveformAnalyzer(C){h[C]&&(h[C].dispose(),delete h[C],w.debug("SynthEngine",`Removed waveform analyzer for color: ${C}`,null,"waveform"))},disposeAllWaveformAnalyzers(){for(const C in h)h[C]&&h[C].dispose();h={},w.debug("SynthEngine","Disposed all waveform analyzers",null,"waveform")},getSynth(C){return a[C]||null},getAllSynths(){return{...a}},getMainVolumeNode(){return c||null},getMasterGainNode(){return l||null},stopBackgroundMonitors(){g==null||g.stop(),m==null||m.stop()},dispose(){var C;this.stopBackgroundMonitors(),this.disposeAllWaveformAnalyzers();for(const b in a)(C=a[b])==null||C.dispose();l==null||l.dispose(),c==null||c.dispose(),u==null||u.dispose(),d==null||d.dispose(),p==null||p.dispose(),w.debug("SynthEngine","Disposed SynthEngine",null,"audio")}};return B}const Um=1e-4;function gF(n){const{getMacrobeatInfo:t,getPlacedTonicSigns:e,getTonicSpanColumnIndices:s,updatePlayheadModel:r,logger:i}=n;let o=[],A=0,a=0,l=0;const c=i??{debug:()=>{}};function u(h){return 60/(h*2)}function d(h,m,g){let v=0;c.debug("TimeMapCalculator","[TIMEMAP] Building timeMap",{columnCount:m.length,tonicSignCount:g.length,microbeatDuration:h});const w=m.length,y=s(g);for(let I=0;I<w;I++){o[I]=v;const B=y.has(I);if(B?c.debug("TimeMapCalculator",`[TIMEMAP] Column ${I} is tonic, not advancing time`):v+=(m[I]||0)*h,I<5){const C=o[I];C!==void 0&&c.debug("TimeMapCalculator",`[TIMEMAP] timeMap[${I}] = ${C.toFixed(3)}s (isTonic: ${B})`)}}w>0&&(o[w]=v),c.debug("TimeMapCalculator",`[TIMEMAP] Complete. Total columns: ${w}, Final time: ${v.toFixed(3)}s`)}function p(h){var y;const m=o.length>0?o[o.length-1]??0:0;if(!Number.isFinite(m)||m===0){A=0;return}const g=((y=h.tempoModulationMarkers)==null?void 0:y.filter(I=>I.active))||[];if(g.length===0){A=m;return}const v=[...g].sort((I,B)=>I.measureIndex-B.measureIndex);let w=m;for(const I of v){const B=t(I.measureIndex);if(B){const C=B.endColumn-1,b=o[C]??m,S=m-b,T=S*I.ratio;w=w-S+T}}A=w}return{getMicrobeatDuration:u,calculate(h){var y,I;c.debug("TimeMapCalculator","calculate",{tempo:`${h.tempo} BPM`}),o=[];const m=u(h.tempo),{columnWidths:g}=h,v=e();d(m,g,v),(I=c.timing)==null||I.call(c,"TimeMapCalculator","calculate",{totalDuration:`${(y=o[o.length-1])==null?void 0:y.toFixed(2)}s`}),p(h);const w=A;r==null||r({timeMap:o,musicalEndTime:w,columnWidths:h.columnWidths,cellWidth:h.cellWidth})},getTimeMap(){return o},getMusicalEndTime(){return A},findNonAnacrusisStart(h){if(!h.hasAnacrusis)return c.debug("TimeMapCalculator","[ANACRUSIS] No anacrusis, starting from time 0"),0;for(let m=0;m<h.macrobeatBoundaryStyles.length;m++)if(h.macrobeatBoundaryStyles[m]==="solid"){const g=t(m+1);if(g){const v=o[g.startColumn]||0;return c.debug("TimeMapCalculator",`[ANACRUSIS] Found solid boundary at macrobeat ${m}, non-anacrusis starts at column ${g.startColumn}, time ${v.toFixed(3)}s`),v}}return c.debug("TimeMapCalculator","[ANACRUSIS] No solid boundary found, starting from time 0"),0},applyModulationToTime(h,m,g){var I;const v=((I=g.tempoModulationMarkers)==null?void 0:I.filter(B=>B.active))||[];if(v.length===0)return h;const w=[...v].sort((B,C)=>B.measureIndex-C.measureIndex);let y=h;m<5&&c.debug("TimeMapCalculator",`[MODULATION] Column ${m}: baseTime ${h.toFixed(3)}s, ${w.length} active markers`);for(const B of w){const C=t(B.measureIndex);if(C){const b=C.endColumn;if(m>b){const S=o[b]!==void 0?o[b]:0,T=h-S,x=T*B.ratio;y=y-T+x,m<5&&c.debug("TimeMapCalculator",`[MODULATION] Column ${m}: Applied marker at measure ${B.measureIndex} (col ${b}), ratio ${B.ratio}, adjustedTime ${y.toFixed(3)}s`)}}}return y},setLoopBounds(h,m,g){const v=u(g),w=Math.max(v,.001),y=Number.isFinite(h)?h:0;let I=Number.isFinite(m)?m:y+w;I<=y&&(I=y+w),a=y,l=I,ht&&(ht.loopStart=y,ht.loopEnd=I)},getConfiguredLoopBounds(){return{loopStart:a,loopEnd:l}},setConfiguredLoopBounds(h,m){a=h,l=m},clearConfiguredLoopBounds(){a=0,l=0},reapplyConfiguredLoopBounds(h){if(l>a){const m=Ce(ht.loopStart).toSeconds(),g=Ce(ht.loopEnd).toSeconds(),v=Math.abs(m-a),w=Math.abs(g-l);(v>Um||w>Um)&&(ht.loopStart=a,ht.loopEnd=l),ht.loop!==h&&(ht.loop=h)}},updateLoopBoundsFromTimeline(h){const m=this.findNonAnacrusisStart(h),g=A;this.setLoopBounds(m,g,h.tempo)}}}const vF={H:"https://tonejs.github.io/audio/drum-samples/CR78/hihat.mp3",M:"https://tonejs.github.io/audio/drum-samples/CR78/snare.mp3",L:"https://tonejs.github.io/audio/drum-samples/CR78/kick.mp3"},wF=1e-4;function BF(n={}){var a;const{samples:t=vF,synthEngine:e,initialVolume:s=0}=n;let r=null,i=null;const o=new Map;function A(l,c){let u=Number.isFinite(c)?c:be();const d=o.get(l)??-1/0;return u>d||(u=d+wF),o.set(l,u),u}if(i=new ks(s),r=new La(t).connect(i),e){const l=(a=e.getMainVolumeNode)==null?void 0:a.call(e);l?i.connect(l):i.toDestination()}else i.toDestination();return{getPlayers(){return r},getVolumeNode(){return i},trigger(l,c){var d;if(!r)return;const u=A(l,c);(d=r.player(l))==null||d.start(u)},reset(){o.clear()},dispose(){r==null||r.dispose(),i==null||i.dispose(),r=null,i=null,o.clear()},isLoaded(){return(r==null?void 0:r.loaded)??!1},async waitForLoad(){r&&await r.loaded}}}const Pm="",Nm="";function CF(n,t){if(n.length<2||t<n[0]||t>=n[n.length-1])return-1;let e=0,s=n.length-2;for(;e<=s;){const r=e+s>>>1,i=n[r],o=n[r+1];if(t>=i&&t<o)return r;t<i?s=r-1:e=r+1}return-1}function bF(n){const{synthEngine:t,stateCallbacks:e,eventCallbacks:s,visualCallbacks:r,logger:i,audioInit:o,playbackMode:A="standard"}=n,a=i??{debug:()=>{},info:()=>{},warn:()=>{}};let l=null,c=!1,u=null,d=null,p=1;const h=[];function m(x,_){const F=_.fullRowData[x];return F?F.toneNote.replace(Pm,"b").replace(Nm,"#"):"C4"}function g(x,_){const F=x.globalRow??x.row,Q=_.fullRowData[F];return Q?Q.toneNote.replace(Pm,"b").replace(Nm,"#"):"C4"}function v(){var L,R,N;if(!u)return;const x=e.getState();a.debug("TransportService","scheduleNotes","Clearing previous transport events and rescheduling all notes"),ht.cancel(),d==null||d.reset(),u.calculate(x),(L=r==null?void 0:r.clearAdsrVisuals)==null||L.call(r);const _=u.getTimeMap(),{loopEnd:F}=u.getConfiguredLoopBounds(),Q=u.findNonAnacrusisStart(x);a.debug("TransportService",`[ANACRUSIS] hasAnacrusis: ${x.hasAnacrusis}, anacrusisOffset: ${Q.toFixed(3)}s`),x.placedNotes.forEach((q,J)=>{const nt=q.startColumnIndex,At=q.endColumnIndex,ot=_[nt];if(ot===void 0){a.warn("TransportService",`[NOTE SCHEDULE] Note ${J}: timeMap[${nt}] undefined, skipping`);return}const V=u.applyModulationToTime(ot,nt,x),H=_[At+1];if(H===void 0){a.warn("TransportService",`Skipping note with invalid endColumnIndex: ${q.endColumnIndex+1}`);return}const Y=u.applyModulationToTime(H,At+1,x)-V;q.isDrum?w(q,V):y(q,V,Y,F,x)});const U=((R=e.getStampPlaybackData)==null?void 0:R.call(e))??[];U.forEach(q=>{I(q,_,x)});const W=((N=e.getTripletPlaybackData)==null?void 0:N.call(e))??[];W.forEach(q=>{B(q,_,x)}),a.debug("TransportService","scheduleNotes",`Finished scheduling ${x.placedNotes.length} notes, ${U.length} stamps, and ${W.length} triplets`)}function w(x,_){const F=e.getState();ht.schedule(Q=>{if(F.isPaused)return;const U=x.drumTrack;if(U==null)return;const W=String(U);d==null||d.trigger(W,Q),QA.schedule(()=>{var L;(L=r==null?void 0:r.triggerDrumNotePop)==null||L.call(r,x.startColumnIndex,U)},Q)},_)}function y(x,_,F,Q,U){var V;const W=g(x,U),L=x.color,R=x.globalRow??x.row,N=((V=U.fullRowData[R])==null?void 0:V.hex)||"#888888",q=x.uuid,J=U.timbres[L];if(!J){a.warn("TransportService",`Timbre not found for color ${L}. Skipping note ${q}`);return}let nt=_+F;const ot=Q-.001;nt>=Q&&(nt=Math.max(_+.001,ot)),ht.schedule(H=>{e.getState().isPaused||(t.triggerAttack(W,L,H),QA.schedule(()=>{var G;(G=r==null?void 0:r.triggerAdsrVisual)==null||G.call(r,q,"attack",N,J.adsr),s.emit("noteAttack",{noteId:q,color:L})},H))},_),ht.schedule(H=>{t.triggerRelease(W,L,H),QA.schedule(()=>{var G;(G=r==null?void 0:r.triggerAdsrVisual)==null||G.call(r,q,"release",N,J.adsr),s.emit("noteRelease",{noteId:q,color:L})},H)},nt)}function I(x,_,F){var L;const Q=x.column,U=_[Q];if(U===void 0)return;(((L=e.getStampScheduleEvents)==null?void 0:L.call(e,x.sixteenthStampId,x.placement))??[]).forEach(R=>{C(R,U,x.row,x.color,F)})}function B(x,_,F){var L,R;const Q=((L=e.timeToCanvas)==null?void 0:L.call(e,x.startTimeIndex,F))??x.startTimeIndex,U=_[Q];if(U===void 0)return;(((R=e.getTripletScheduleEvents)==null?void 0:R.call(e,x.tripletStampId,x.placement))??[]).forEach(N=>{C(N,U,x.row,x.color,F)})}function C(x,_,F,Q,U){const W=Ce(x.offset).toSeconds(),L=Ce(x.duration).toSeconds(),R=_+W,N=R+L,q=F+x.rowOffset,J=m(q,U);ht.schedule(nt=>{e.getState().isPaused||t.triggerAttack(J,Q,nt)},R),ht.schedule(nt=>{e.getState().isPaused||t.triggerRelease(J,Q,nt)},N)}function b(){var R;const _=e.getState().tempo,F=1e-4,Q=.5,U=N=>(N==null?void 0:N.xPosition)??477.5,W=typeof((R=ht==null?void 0:ht.bpm)==null?void 0:R.value)=="number"?ht.bpm.value:_;p=_!==0?W/_:1,c=!0;function L(){var yt,Bt,Et,Qt,ct,gt,mt,Ot,ve,we,Cr,jn,ri,ii,Zp;if(!c||!u)return;if(ht.state==="stopped"){l=requestAnimationFrame(L);return}const N=e.getState(),q=Ce(ht.loopEnd).toSeconds(),J=N.isLooping,nt=u.getMusicalEndTime(),At=J&&q>0?q:nt,ot=ht.seconds,V=ot*1e3,H=ot>=At-.001;if(!J&&H){a.info("TransportService","Playback reached end. Stopping playhead."),T.stop();return}if(N.isPaused){l=requestAnimationFrame(L);return}const G=u.getTimeMap();(yt=r==null?void 0:r.clearPlayheadCanvas)==null||yt.call(r),(Bt=r==null?void 0:r.clearDrumPlayheadCanvas)==null||Bt.call(r);let Y=ot;if(J){const Xi=Ce(ht.loopStart).toSeconds(),Vs=Ce(ht.loopEnd).toSeconds()-Xi;Vs>0&&(Y=(ot-Xi)%Vs+Xi)}const P=((Et=e.getCanvasWidth)==null?void 0:Et.call(e))??1e3,st=((Qt=e.getPlacedTonicSigns)==null?void 0:Qt.call(e))??[],D=((ct=e.getTonicSpanColumnIndices)==null?void 0:ct.call(e,st))??new Set;let K=0,O=0,X=0,tt=-1;const k=CF(G,Y);if(k>=0){const Xi=G[k],tm=G[k+1];let Vs=k;for(;D.has(Vs)&&Vs<G.length-1;)Vs++;const zu=((gt=e.getColumnStartX)==null?void 0:gt.call(e,Vs))??0,em=((mt=e.getColumnWidth)==null?void 0:mt.call(e,Vs))??10;if(O=zu,X=em,tt=Vs,D.has(k))K=zu;else{const nm=tm-Xi,ib=Y-Xi,ob=nm>0?ib/nm:0;K=zu+ob*em}}const z=Math.min(K,P);S(N,z,_,U,F,Q);const $=((Ot=r==null?void 0:r.getPlayheadCanvasHeight)==null?void 0:Ot.call(r))??500,rt=((ve=r==null?void 0:r.getDrumCanvasHeight)==null?void 0:ve.call(r))??100,et=N.playheadMode==="macrobeat"&&tt>=0?(we=e.getMacrobeatHighlightRect)==null?void 0:we.call(e,tt):null,it=(et==null?void 0:et.x)??O,at=(et==null?void 0:et.width)??X;z>=0&&(N.playheadMode==="macrobeat"||N.playheadMode==="microbeat"?((Cr=r==null?void 0:r.drawPlayheadHighlight)==null||Cr.call(r,it,at,$,V),(jn=r==null?void 0:r.drawDrumPlayheadHighlight)==null||jn.call(r,it,at,rt,V)):((ri=r==null?void 0:r.drawPlayheadLine)==null||ri.call(r,z,$),(ii=r==null?void 0:r.drawDrumPlayheadLine)==null||ii.call(r,z,rt)));const Ct=N.playheadMode==="macrobeat"||N.playheadMode==="microbeat";(Zp=r==null?void 0:r.updateBeatLineHighlight)==null||Zp.call(r,it,at,Ct),l=requestAnimationFrame(L)}L()}function S(x,_,F,Q,U,W){if(!u)return;const R=(Array.isArray(x.tempoModulationMarkers)?x.tempoModulationMarkers:[]).filter(N=>(N==null?void 0:N.active)&&typeof N.ratio=="number"&&N.ratio!==0).sort((N,q)=>Q(N)-Q(q));if(R.length>0){let N=1;for(const q of R){const J=Q(q);if(_+W>=J)N*=1/q.ratio;else break}if((!Number.isFinite(N)||N<=0)&&(N=1),Math.abs(N-p)>U){const q=F*N;ht.bpm.value=q,u.reapplyConfiguredLoopBounds(x.isLooping),p=N,a.debug("TransportService",`Tempo multiplier updated to ${N.toFixed(3)} (${q.toFixed(2)} BPM)`)}}else Math.abs(p-1)>U&&(ht.bpm.value=F,u.reapplyConfiguredLoopBounds(x.isLooping),p=1,a.debug("TransportService",`Tempo reset to base ${F} BPM`))}const T={init(){const x=e.getState();u=gF({getMacrobeatInfo:e.getMacrobeatInfo??(()=>null),getPlacedTonicSigns:e.getPlacedTonicSigns??(()=>[]),getTonicSpanColumnIndices:e.getTonicSpanColumnIndices??(()=>new Set),logger:a}),d=BF({samples:{H:"https://tonejs.github.io/audio/drum-samples/CR78/hihat.mp3",M:"https://tonejs.github.io/audio/drum-samples/CR78/snare.mp3",L:"https://tonejs.github.io/audio/drum-samples/CR78/kick.mp3"},synthEngine:{getMainVolumeNode:()=>t.getMainVolumeNode()}}),ht.bpm.value=x.tempo;const _=()=>this.handleStateChange(),F=()=>this.handleStateChange(),Q=()=>this.handleStateChange(),U=()=>{if(u&&u.getTimeMap().length>0){const N=e.getState();u.calculate(N)}this.handleStateChange()},W=N=>{var nt,At;const q=((nt=N==null?void 0:N.oldConfig)==null?void 0:nt.columnWidths)||[],J=((At=N==null?void 0:N.newConfig)==null?void 0:At.columnWidths)||[];q.length!==J.length&&u&&u.calculate(e.getState())},L=N=>{if(a.info("TransportService",`tempoChanged triggered with new value: ${N} BPM`),ht.state==="started"){const q=ht.position;ht.pause(),l&&(cancelAnimationFrame(l),l=null),ht.bpm.value=N,u==null||u.reapplyConfiguredLoopBounds(e.getState().isLooping),v(),ht.start(void 0,q),A==="standard"&&b()}else ht.bpm.value=N,u==null||u.reapplyConfiguredLoopBounds(e.getState().isLooping),u==null||u.calculate(e.getState())},R=N=>{ht.loop=N;const q=Ce(ht.loopStart).toSeconds(),J=Ce(ht.loopEnd).toSeconds();N&&J<=q&&u&&(ht.loopEnd=q+Math.max(u.getMicrobeatDuration(e.getState().tempo),.001)),N&&u?u.setConfiguredLoopBounds(Ce(ht.loopStart).toSeconds(),Ce(ht.loopEnd).toSeconds()):u==null||u.clearConfiguredLoopBounds()};s.on("rhythmStructureChanged",_),s.on("notesChanged",F),s.on("sixteenthStampPlacementsChanged",Q),s.on("tempoModulationMarkersChanged",U),s.on("layoutConfigChanged",W),s.on("tempoChanged",L),s.on("loopingChanged",R),h.push(()=>{}),ht.on("stop",()=>{var N,q;a.info("TransportService","Tone.Transport 'stop' fired. Resetting playback state"),(N=s.setPlaybackState)==null||N.call(s,!1,!1),(q=r==null?void 0:r.clearAdsrVisuals)==null||q.call(r),l&&(cancelAnimationFrame(l),l=null)}),a.info("TransportService","Initialized")},handleStateChange(){if(ht.state==="started"){a.debug("TransportService","handleStateChange: Notes or rhythm changed during playback. Rescheduling");const _=ht.position;ht.pause(),v(),ht.start(void 0,_)}else u==null||u.calculate(e.getState())},start(){a.info("TransportService","Starting playback"),(o||(()=>Bc()))().then(async()=>{er.state!=="running"&&await er.resume(),d&&await d.waitForLoad();const _=e.getState();u==null||u.calculate(_);const F=(u==null?void 0:u.getMusicalEndTime())??0,Q=(u==null?void 0:u.findNonAnacrusisStart(_))??0;u==null||u.setLoopBounds(Q,F,_.tempo),ht.bpm.value=_.tempo,v();const U=be()+.1;ht.start(U,0),A==="standard"&&b(),s.emit("playbackStarted")})},resume(){a.info("TransportService","Resuming playback"),(o||(()=>Bc()))().then(async()=>{er.state!=="running"&&await er.resume(),ht.start(),A==="standard"&&b(),s.emit("playbackResumed")})},pause(){a.info("TransportService","Pausing playback"),ht.pause(),l&&(cancelAnimationFrame(l),l=null),s.emit("playbackPaused")},stop(){var _,F,Q;a.info("TransportService","Stopping playback and clearing visuals"),c=!1,l&&(cancelAnimationFrame(l),l=null),ht.stop(),ht.cancel(),d==null||d.reset();const x=e.getState();ht.bpm.value=x.tempo,u==null||u.reapplyConfiguredLoopBounds(x.isLooping),t.releaseAll(),(_=r==null?void 0:r.clearPlayheadCanvas)==null||_.call(r),(F=r==null?void 0:r.clearDrumPlayheadCanvas)==null||F.call(r),(Q=r==null?void 0:r.updateBeatLineHighlight)==null||Q.call(r,0,0,!1),s.emit("playbackStopped")},dispose(){this.stop(),d==null||d.dispose(),h.forEach(x=>x()),a.debug("TransportService","Disposed")}};return T}const yF={latencyHint:"playback",lookAhead:.1};function SF(n={}){const{latencyHint:t,lookAhead:e}={...yF,...n};let s=!1;if(er.state==="suspended")try{vw(new cu({latencyHint:t})),s=!0}catch(r){console.warn("Failed to create new AudioContext, using default:",r)}return e!==void 0&&(er.lookAhead=e),s}let EF=class{constructor(){M(this,"logLevel");M(this,"enabledLevels");M(this,"categories");this.logLevel="ERROR",this.enabledLevels={DEBUG:!1,INFO:!1,WARN:!1,ERROR:!0},this.categories={general:!1,state:!1,canvas:!1,audio:!1,ui:!1,layout:!1,harmony:!1,performance:!1,initialization:!1,transport:!1,grid:!1,toolbar:!1,zoom:!1,scroll:!1,keyboard:!1,mouse:!1,adsr:!1,filter:!1,waveform:!1,debug:!1}}enable(...t){t.forEach(e=>{Object.prototype.hasOwnProperty.call(this.categories,e)&&(this.categories[e]=!0)})}disable(...t){t.forEach(e=>{Object.prototype.hasOwnProperty.call(this.categories,e)&&(this.categories[e]=!1)})}enableAll(){Object.keys(this.categories).forEach(t=>{this.categories[t]=!0}),this.setLevel("DEBUG")}disableAll(){Object.keys(this.categories).forEach(t=>{this.categories[t]=!1}),this.setLevel("ERROR")}isCategoryEnabled(t){return this.categories[t]===!0}setLevel(t){const s=["DEBUG","INFO","WARN","ERROR"].indexOf(t);s!==-1&&(this.logLevel=t,this.enabledLevels={DEBUG:s<=0,INFO:s<=1,WARN:s<=2,ERROR:s<=3})}logWithConsole(t,e,s,r=null){if(typeof console<"u"&&console[t]){const i=r!==null?[e,s,r]:[e,s];console[t](...i)}}event(t,e,s="",r="ui"){!this.enabledLevels.INFO||this.isCategoryEnabled(r)}state(t,e,s=null,r="state"){!this.enabledLevels.INFO||this.isCategoryEnabled(r)}debug(t,e,s=null,r="debug"){!this.enabledLevels.DEBUG||!this.isCategoryEnabled(r)||this.logWithConsole("debug",t,e,s)}timing(t,e,s,r="performance"){!this.enabledLevels.DEBUG||!this.isCategoryEnabled(r)||this.logWithConsole("debug",t,e,s)}warn(t,e,s=null,r="general"){!this.enabledLevels.WARN||!this.isCategoryEnabled(r)||this.logWithConsole("warn",t,e,s)}error(t,e,s=null,r="general"){this.enabledLevels.ERROR&&this.logWithConsole("error",t,e,s)}info(t,e,s=null,r="general"){!this.enabledLevels.INFO||!this.isCategoryEnabled(r)||this.logWithConsole("info",t,e,s)}getConfig(){return{logLevel:this.logLevel,enabledLevels:{...this.enabledLevels},enabledCategories:Object.entries(this.categories).filter(([,t])=>t).map(([t])=>t)}}getAvailableCategories(){return Object.keys(this.categories)}section(t){this.enabledLevels.INFO&&this.info("Logger",`===== ${t} =====`,null,"general")}initStart(t){this.enabledLevels.INFO&&this.info(t,"init start",null,"initialization")}initSuccess(t){this.enabledLevels.INFO&&this.info(t,"init success",null,"initialization")}initFailed(t,e){if(this.enabledLevels.ERROR){const s=e?`init failed: ${e}`:"init failed";this.error(t,s,null,"initialization")}}moduleLoaded(t,e="initialization"){this.isCategoryEnabled(e)&&this.enabledLevels.INFO&&this.info(t,"loaded",null,e)}log(t,e,s=null){this.info(t,e,s,"general")}};const E=new EF;typeof window<"u"&&(window.logger=E);E.moduleLoaded("EngineStore","general");function Lm(){return{entries:[],visualToCanvas:new Map,visualToTime:new Map,canvasToVisual:new Map,canvasToTime:new Map,timeToCanvas:new Map,timeToVisual:new Map,macrobeatBoundaries:[],totalVisualColumns:0,totalCanvasColumns:0,totalTimeColumns:0,totalWidthUnmodulated:0}}const xF="studentNotationState",IF={getItem:n=>localStorage.getItem(n),setItem:(n,t)=>localStorage.setItem(n,t),removeItem:n=>localStorage.removeItem(n)},Ja=(n,t,e,s,r)=>{const i=r||"general";switch(n){case"debug":E.debug(t,e,s,i);break;case"info":E.info(t,e,s,i);break;case"warn":E.warn(t,e,s,i);break;case"error":E.error(t,e,s,i);break}};let Jn={};function FF(n){Jn=n,E.info("EngineStore","Column map callbacks registered")}const f=uF({storageKey:xF,storage:IF,onClearState:()=>{localStorage.removeItem("effectDialValues"),window.location.reload()},noteActionCallbacks:{getMacrobeatInfo:(n,t)=>{const e=n.macrobeatGroupings||[];let s=0;for(let i=0;i<t&&i<e.length;i++)s+=e[i]||2;const r=s+(e[t]||2)-1;return{startColumn:s,endColumn:r}},log:(n,t,e)=>Ja(n,"noteActions",t,e)},rhythmActionCallbacks:{getColumnMap:n=>Jn.getColumnMap?Jn.getColumnMap(n):Lm(),visualToTimeIndex:(n,t,e)=>Jn.visualToTimeIndex?Jn.visualToTimeIndex(n,t,e):t,timeIndexToVisualColumn:(n,t,e)=>Jn.timeIndexToVisualColumn?Jn.timeIndexToVisualColumn(n,t,e):t,getTimeBoundaryAfterMacrobeat:(n,t,e)=>{if(Jn.getTimeBoundaryAfterMacrobeat)return Jn.getTimeBoundaryAfterMacrobeat(n,t,e);let s=0;for(let r=0;r<=t&&r<e.length;r++)s+=e[r]||2;return s},log:Ja},sixteenthStampActionCallbacks:{log:(n,t,e)=>Ja(n,"sixteenthStampActions",t,e)},tripletStampActionCallbacks:{canvasToTime:(n,t)=>t.canvasToTime.get(n)??null,timeToCanvas:(n,t)=>t.timeToCanvas.get(n)??n,getColumnMap:n=>Jn.getColumnMap?Jn.getColumnMap(n):Lm(),log:(n,t,e)=>Ja(n,"tripletStampActions",t,e)}});function cp(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function up(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var Mw=[0,2,4,-1,1,3,5],Qw=Mw.map(n=>Math.floor(n*7/12));function Uw(n){const{step:t,alt:e,oct:s,dir:r=1}=n,i=Mw[t]+7*e;if(s===void 0)return[r*i];const o=s-Qw[t]-4*e;return[r*i,r*o]}var TF=[3,0,4,1,5,2,6];function Pw(n){const[t,e,s]=n,r=TF[_F(t)],i=Math.floor((t+1)/7);if(e===void 0)return{step:r,alt:i,dir:s};const o=e+4*i+Qw[r];return{step:r,alt:i,oct:o,dir:s}}function _F(n){const t=(n+1)%7;return t<0?7+t:t}var Dm=(n,t)=>Array(Math.abs(t)+1).join(n),sh=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),MF="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",QF="(AA|A|P|M|m|d|dd)([-+]?\\d+)",UF=new RegExp("^"+MF+"|"+QF+"$");function PF(n){const t=UF.exec(`${n}`);return t===null?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}var km={};function Yn(n){return typeof n=="string"?km[n]||(km[n]=NF(n)):up(n)?Yn(DF(n)):cp(n)?Yn(n.name):sh}var Rm=[0,2,4,5,7,9,11],Nw="PMMPPMM";function NF(n){const t=PF(n);if(t[0]==="")return sh;const e=+t[0],s=t[1],r=(Math.abs(e)-1)%7,i=Nw[r];if(i==="M"&&s==="P")return sh;const o=i==="M"?"majorable":"perfectable",A=""+e+s,a=e<0?-1:1,l=e===8||e===-8?e:a*(r+1),c=LF(o,s),u=Math.floor((Math.abs(e)-1)/7),d=a*(Rm[r]+c+12*u),p=(a*(Rm[r]+c)%12+12)%12,h=Uw({step:r,alt:c,oct:u,dir:a});return{empty:!1,name:A,num:e,q:s,step:r,alt:c,dir:a,type:o,simple:l,semitones:d,chroma:p,coord:h,oct:u}}function Lw(n,t){const[e,s=0]=n,r=e*7+s*12<0,i=t||r?[-e,-s,-1]:[e,s,1];return Yn(Pw(i))}function LF(n,t){return t==="M"&&n==="majorable"||t==="P"&&n==="perfectable"?0:t==="m"&&n==="majorable"?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*(n==="perfectable"?t.length:t.length+1):0}function DF(n){const{step:t,alt:e,oct:s=0,dir:r}=n;if(!r)return"";const i=t+1+7*s,o=i===0?t+1:i,A=r<0?"-":"",a=Nw[t]==="M"?"majorable":"perfectable";return A+o+kF(a,e)}function kF(n,t){return t===0?n==="majorable"?"M":"P":t===-1&&n==="majorable"?"m":t>0?Dm("A",t):Dm("d",n==="perfectable"?t:t+1)}var Hm=(n,t)=>Array(Math.abs(t)+1).join(n),Dw=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),Om=new Map,RF=n=>"CDEFGAB".charAt(n),kw=n=>n<0?Hm("b",-n):Hm("#",n),Rw=n=>n[0]==="b"?-n.length:n.length;function Ee(n){const t=JSON.stringify(n),e=Om.get(t);if(e)return e;const s=typeof n=="string"?WF(n):up(n)?Ee(GF(n)):cp(n)?Ee(n.name):Dw;return Om.set(t,s),s}var HF=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function dp(n){const t=HF.exec(n);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:["","","",""]}function OF(n){return Ee(Pw(n))}var VF=(n,t)=>(n%t+t)%t,Ju=[0,2,4,5,7,9,11];function WF(n){const t=dp(n);if(t[0]===""||t[3]!=="")return Dw;const e=t[0],s=t[1],r=t[2],i=(e.charCodeAt(0)+3)%7,o=Rw(s),A=r.length?+r:void 0,a=Uw({step:i,alt:o,oct:A}),l=e+s+r,c=e+s,u=(Ju[i]+o+120)%12,d=A===void 0?VF(Ju[i]+o,12)-1188:Ju[i]+o+12*(A+1),p=d>=0&&d<=127?d:null,h=A===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:s,alt:o,chroma:u,coord:a,freq:h,height:d,letter:e,midi:p,name:l,oct:A,pc:c,step:i}}function GF(n){const{step:t,alt:e,oct:s}=n,r=RF(t);if(!r)return"";const i=r+kw(e);return s||s===0?i+s:i}function Su(n,t){const e=Ee(n),s=Array.isArray(t)?t:Yn(t).coord;if(e.empty||!s||s.length<2)return"";const r=e.coord,i=r.length===1?[r[0]+s[0]]:[r[0]+s[0],r[1]+s[1]];return OF(i).name}function Ec(n,t){const e=Ee(n),s=Ee(t);if(e.empty||s.empty)return"";const r=e.coord,i=s.coord,o=i[0]-r[0],A=r.length===2&&i.length===2?i[1]-r[1]:-Math.floor(o*7/12),a=s.height===e.height&&s.midi!==null&&e.oct===s.oct&&e.step>s.step;return Lw([o,A],a).name}function hp(n,t){const e=t.length,s=(n%e+e)%e;return t.slice(s,e).concat(t.slice(0,s))}function KF(n){return n.filter(t=>t===0||t)}var ki={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Hw=n=>Number(n).toString(2).padStart(12,"0"),Vm=n=>parseInt(n,2),qF=/^[01]{12}$/;function Ow(n){return qF.test(n)}var zF=n=>typeof n=="number"&&n>=0&&n<=4095,$F=n=>n&&Ow(n.chroma),Wm={[ki.chroma]:ki};function fp(n){const t=Ow(n)?n:zF(n)?Hw(n):Array.isArray(n)?tT(n):$F(n)?n.chroma:ki.chroma;return Wm[t]=Wm[t]||ZF(t)}var XF=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function YF(n){const t=[];for(let e=0;e<12;e++)n.charAt(e)==="1"&&t.push(XF[e]);return t}function jF(n,t=!0){const s=fp(n).chroma.split("");return KF(s.map((r,i)=>{const o=hp(i,s);return t&&o[0]==="0"?null:o.join("")}))}function JF(n){const t=n.split("");return t.map((e,s)=>hp(s,t).join(""))}function ZF(n){const t=Vm(n),e=JF(n).map(Vm).filter(i=>i>=2048).sort()[0],s=Hw(e),r=YF(n);return{empty:!1,name:"",setNum:t,chroma:n,normalized:s,intervals:r}}function tT(n){if(n.length===0)return ki.chroma;let t;const e=[0,0,0,0,0,0,0,0,0,0,0,0];for(let s=0;s<n.length;s++)t=Ee(n[s]),t.empty&&(t=Yn(n[s])),t.empty||(e[t.chroma]=1);return e.join("")}var eT=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],nT=eT,sT={...ki,name:"",quality:"Unknown",intervals:[],aliases:[]},pp=[],UA={};function rT(n){return UA[n]||sT}function iT(){return pp.slice()}function oT(n,t,e){const s=aT(n),r={...fp(n),name:e||"",quality:s,intervals:n,aliases:t};pp.push(r),r.name&&(UA[r.name]=r),UA[r.setNum]=r,UA[r.chroma]=r,r.aliases.forEach(i=>AT(r,i))}function AT(n,t){UA[t]=n}function aT(n){const t=e=>n.indexOf(e)!==-1;return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}nT.forEach(([n,t,e])=>oT(n.split(" "),e.split(" "),t));pp.sort((n,t)=>n.setNum-t.setNum);var lT=n=>{const t=n.reduce((e,s)=>{const r=Ee(s).chroma;return r!==void 0&&(e[r]=e[r]||Ee(s).name),e},{});return e=>t[e]};function cT(n,t={}){const e=n.map(r=>Ee(r).pc).filter(r=>r);return Ee.length===0?[]:gT(e,1,t).filter(r=>r.weight).sort((r,i)=>i.weight-r.weight).map(r=>r.name)}var Eu={anyThirds:384,perfectFifth:16,nonPerfectFifths:40,anySeventh:3},xu=n=>t=>!!(t&n),uT=xu(Eu.anyThirds),dT=xu(Eu.perfectFifth),hT=xu(Eu.anySeventh),fT=xu(Eu.nonPerfectFifths);function pT(n){const t=parseInt(n.chroma,2);return uT(t)&&dT(t)&&hT(t)}function mT(n){const t=parseInt(n,2);return fT(t)?n:(t|16).toString(2)}function gT(n,t,e){const s=n[0],r=Ee(s).chroma,i=lT(n),o=jF(n,!1),A=[];return o.forEach((a,l)=>{const c=e.assumePerfectFifth&&mT(a);iT().filter(d=>e.assumePerfectFifth&&pT(d)?d.chroma===c:d.chroma===a).forEach(d=>{const p=d.aliases[0],h=i(l);l!==r?A.push({weight:.5*t,name:`${h}${p}/${s}`}):A.push({weight:1*t,name:`${h}${p}`})})}),A}var vT=Yn;function wT(n){const t=Yn(n);if(t.empty)return"";const e=(7-t.step)%7,s=t.type==="perfectable"?-t.alt:-(t.alt+1);return Yn({step:e,alt:s,oct:t.oct,dir:t.dir}).name}var Gm=Ec,BT=CT((n,t)=>[n[0]-t[0],n[1]-t[1]]);function CT(n){return(t,e)=>{const s=Yn(t).coord,r=Yn(e).coord;if(s&&r){const i=n(s,r);return Lw(i).name}}}var bT=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],yT=bT,ST={...ki,intervals:[],aliases:[]},PA={};function Vw(n){return PA[n]||ST}function ET(n,t,e=[]){const s={...fp(n),name:t,intervals:n,aliases:e};return PA[s.name]=s,PA[s.setNum]=s,PA[s.chroma]=s,s.aliases.forEach(r=>xT(s,r)),s}function xT(n,t){PA[t]=n}yT.forEach(([n,t,...e])=>ET(n.split(" "),t,e));var Ww={empty:!0,name:"",symbol:"",root:"",bass:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Gw(n){const[t,e,s,r]=dp(n);return t===""?Zu("",n):t==="A"&&r==="ug"?Zu("","aug"):Zu(t+e,s+r)}function Zu(n,t){const e=t.split("/");if(e.length===1)return[n,e[0],""];const[s,r,i,o]=dp(e[1]);return s!==""&&i===""&&o===""?[n,e[0],s+r]:[n,t,""]}function IT(n){if(Array.isArray(n))return td(n[1]||"",n[0],n[2]);if(n==="")return Ww;{const[t,e,s]=Gw(n),r=td(e,t,s);return r.empty?td(n):r}}function td(n,t,e){const s=rT(n),r=Ee(t||""),i=Ee(e||"");if(s.empty||t&&r.empty||e&&i.empty)return Ww;const o=Ec(r.pc,i.pc),A=s.intervals.indexOf(o),a=A>=0,l=a?i:Ee(""),c=A===-1?NaN:A+1,u=i.pc&&i.pc!==r.pc,d=Array.from(s.intervals);if(a)for(let g=1;g<c;g++){const v=d[0][0],w=d[0][1],y=parseInt(v,10)+7;d.push(`${y}${w}`),d.shift()}else if(u){const g=BT(Ec(r.pc,i.pc),"8P");g&&d.unshift(g)}const p=r.empty?[]:d.map(g=>Su(r.pc,g));n=s.aliases.indexOf(n)!==-1?n:s.aliases[0];const h=`${r.empty?"":r.pc}${n}${a&&c>1?"/"+l.pc:u?"/"+i.pc:""}`,m=`${t?r.pc+" ":""}${s.name}${a&&c>1?" over "+l.pc:u?" over "+i.pc:""}`;return{...s,name:m,symbol:h,tonic:r.pc,type:s.name,root:l.pc,bass:u?i.pc:"",intervals:d,rootDegree:c,notes:p}}var FT=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],TT=FT;TT.forEach(([n,t,e])=>void 0);var _T="C C# D D# E F F# G G# A A# B".split(" "),MT="C Db D Eb E F Gb G Ab A Bb B".split(" ");function mp(n,t={}){if(isNaN(n)||n===-1/0||n===1/0)return"";n=Math.round(n);const s=(t.sharps===!0?_T:MT)[n%12];if(t.pitchClass)return s;const r=Math.floor(n/12)-1;return s+r}var na=Ee,rh=n=>na(n).pc,ed=n=>na(n).midi;function QT(n){return mp(n)}var xo=Su,NA=n=>{const t=na(n);return t.empty?"":mp(t.midi||t.chroma,{sharps:t.alt>0,pitchClass:t.midi===null})};function LA(n,t){const e=na(n);if(e.empty)return"";const s=na(t||mp(e.midi||e.chroma,{sharps:e.alt<0,pitchClass:!0}));if(s.empty||s.chroma!==e.chroma)return"";if(e.oct===void 0)return s.pc;const r=e.chroma-e.alt,i=s.chroma-s.alt,o=r>11||i<0?-1:r<0||i>11?1:0,A=e.oct+o;return s.pc+A}var Kw={empty:!0,name:"",chordType:""},Km={};function sa(n){return typeof n=="string"?Km[n]||(Km[n]=DT(n)):typeof n=="number"?sa(gp[n]||""):up(n)?UT(n):cp(n)?sa(n.name):Kw}function UT(n){return sa(kw(n.alt)+gp[n.step])}var PT=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function NT(n){return PT.exec(n)||["","","",""]}var LT="I II III IV V VI VII",gp=LT.split(" ");function DT(n){const[t,e,s,r]=NT(n);if(!s)return Kw;const i=s.toUpperCase(),o=gp.indexOf(i),A=Rw(e),a=1;return{empty:!1,name:t,roman:s,interval:Yn({step:o,alt:A,dir:a}).name,acc:e,chordType:r,alt:A,step:o,major:s===i,oct:0,dir:a}}var vp=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],qm={...ki,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},kT=vp.map(RT),ih={};kT.forEach(n=>{ih[n.name]=n,n.aliases.forEach(t=>{ih[t]=n})});function qw(n){return typeof n=="string"?ih[n.toLowerCase()]||qm:n&&n.name?qw(n.name):qm}function RT(n){const[t,e,s,r,i,o,A]=n,a=A?[A]:[],l=Number(e).toString(2);return{empty:!1,intervals:Vw(r).intervals,modeNum:t,chroma:l,normalized:l,name:r,setNum:e,alt:s,triad:i,seventh:o,aliases:a}}function zw(n){return(t,e)=>{const s=qw(t);if(s.empty)return[];const r=hp(s.modeNum,n),i=s.intervals.map(o=>Su(e,o));return r.map((o,A)=>i[A]+o)}}zw(vp.map(n=>n[4]));zw(vp.map(n=>n[5]));function HT(n,t){return t.map(e=>{const[s,r]=Gw(e),i=Ec(n,s);return sa(Yn(i)).name+r})}var OT={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function VT(n){if(typeof n!="string")return["",""];const t=n.indexOf(" "),e=Ee(n.substring(0,t));if(e.empty){const r=Ee(n);return r.empty?["",n.toLowerCase()]:[r.name,""]}const s=n.substring(e.name.length+1).toLowerCase();return[e.name,s.length?s:""]}function WT(n){const t=Array.isArray(n)?n:VT(n),e=Ee(t[0]).name,s=Vw(t[1]);if(s.empty)return OT;const r=s.name,i=e?s.intervals.map(A=>Su(e,A)):[],o=e?e+" "+r:r;return{...s,name:o,type:r,tonic:e,notes:i}}const Xs=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fcfcfc",isAccidental:!1},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fcf7fc",isAccidental:!1},{pitch:"B/A7",flatName:"B7",sharpName:"A7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f7f5fd",isAccidental:!0},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f0f4ff",isAccidental:!1},{pitch:"A/G7",flatName:"A7",sharpName:"G7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#e6f3fd",isAccidental:!0},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#def3f7",isAccidental:!1},{pitch:"G/F7",flatName:"G7",sharpName:"F7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#daf2ec",isAccidental:!0},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#dcefdf",isAccidental:!1},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#e3ebd1",isAccidental:!1},{pitch:"E/D7",flatName:"E7",sharpName:"D7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#eee4c8",isAccidental:!0},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#f8dcc6",isAccidental:!1},{pitch:"D/C7",flatName:"D7",sharpName:"C7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fcd4cd",isAccidental:!0},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#facfdb",isAccidental:!1},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#efcdeb",isAccidental:!1},{pitch:"B/A6",flatName:"B6",sharpName:"A6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#ddcff9",isAccidental:!0},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#c4d3ff",isAccidental:!1},{pitch:"A/G6",flatName:"A6",sharpName:"G6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#abd9fa",isAccidental:!0},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#98dde9",isAccidental:!1},{pitch:"G/F6",flatName:"G6",sharpName:"F6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#96ddcf",isAccidental:!0},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#a6d9b0",isAccidental:!1},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#c0d093",isAccidental:!1},{pitch:"E/D6",flatName:"E6",sharpName:"D6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#dbc383",isAccidental:!0},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#efb586",isAccidental:!1},{pitch:"D/C6",flatName:"D6",sharpName:"C6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#f8a99c",isAccidental:!0},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#f3a2bb",isAccidental:!1},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e1a3db",isAccidental:!1},{pitch:"B/A5",flatName:"B5",sharpName:"A5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#c3a9f4",isAccidental:!0},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#9ab2ff",isAccidental:!1},{pitch:"A/G5",flatName:"A5",sharpName:"G5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#67bdf7",isAccidental:!0},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#30c6dc",isAccidental:!1},{pitch:"G/F5",flatName:"G5",sharpName:"F5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#32c8b2",isAccidental:!0},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#6dc281",isAccidental:!1},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#a0b556",isAccidental:!1},{pitch:"E/D5",flatName:"E5",sharpName:"D5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#c5a33f",isAccidental:!0},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#dc9150",isAccidental:!1},{pitch:"D/C5",flatName:"D5",sharpName:"C5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#e38475",isAccidental:!0},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#dc7f9d",isAccidental:!1},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#c781c0",isAccidental:!1},{pitch:"B/A4",flatName:"B4",sharpName:"A4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#a68ad8",isAccidental:!0},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#7d94e0",isAccidental:!1},{pitch:"A/G4",flatName:"A4",sharpName:"G4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#4c9fd5",isAccidental:!0},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#0fa6ba",isAccidental:!1},{pitch:"G/F4",flatName:"G4",sharpName:"F4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#24a794",isAccidental:!0},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#5aa26a",isAccidental:!1},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#849646",isAccidental:!1},{pitch:"E/D4",flatName:"E4",sharpName:"D4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#a38733",isAccidental:!0},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#b67740",isAccidental:!1},{pitch:"D/C4",flatName:"D4",sharpName:"C4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#bc6c5f",isAccidental:!0},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#b56880",isAccidental:!1},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#a3699e",isAccidental:!1},{pitch:"B/A3",flatName:"B3",sharpName:"A3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#8870b1",isAccidental:!0},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#6578b7",isAccidental:!1},{pitch:"A/G3",flatName:"A3",sharpName:"G3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#3c81ad",isAccidental:!0},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#0e8696",isAccidental:!1},{pitch:"G/F3",flatName:"G3",sharpName:"F3",toneNote:"Gb3",frequency:185,column:"A",hex:"#1b8777",isAccidental:!0},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#478255",isAccidental:!1},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#697836",isAccidental:!1},{pitch:"E/D3",flatName:"E3",sharpName:"D3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#836b27",isAccidental:!0},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#925e32",isAccidental:!1},{pitch:"D/C3",flatName:"D3",sharpName:"C3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#96554b",isAccidental:!0},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#905165",isAccidental:!1},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#80527c",isAccidental:!1},{pitch:"B/A2",flatName:"B2",sharpName:"A2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#6a578c",isAccidental:!0},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#4e5e90",isAccidental:!1},{pitch:"A/G2",flatName:"A2",sharpName:"G2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#2d6488",isAccidental:!0},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#096875",isAccidental:!1},{pitch:"G/F2",flatName:"G2",sharpName:"F2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#13685b",isAccidental:!0},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#356440",isAccidental:!1},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#505c28",isAccidental:!1},{pitch:"E/D2",flatName:"E2",sharpName:"D2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#63511c",isAccidental:!0},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#6e4724",isAccidental:!1},{pitch:"D/C2",flatName:"D2",sharpName:"C2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#713f37",isAccidental:!0},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#6c3c4b",isAccidental:!1},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#603c5d",isAccidental:!1},{pitch:"B/A1",flatName:"B1",sharpName:"A1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#4e4068",isAccidental:!0},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#38446b",isAccidental:!1},{pitch:"A/G1",flatName:"A1",sharpName:"G1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#1f4964",isAccidental:!0},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#044b55",isAccidental:!1},{pitch:"G/F1",flatName:"G1",sharpName:"F1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#0c4b41",isAccidental:!0},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#24472c",isAccidental:!1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#38401a",isAccidental:!1},{pitch:"E/D1",flatName:"E1",sharpName:"D1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#463811",isAccidental:!0},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#4d3017",isAccidental:!1},{pitch:"D/C1",flatName:"D1",sharpName:"C1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#4f2a24",isAccidental:!0},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#4a2733",isAccidental:!1},{pitch:"B0",flatName:"B0",sharpName:"B0",toneNote:"B0",frequency:30.87,column:"B",hex:"#41273f",isAccidental:!1},{pitch:"B/A0",flatName:"B0",sharpName:"A0",toneNote:"Bb0",frequency:29.14,column:"A",hex:"#342a46",isAccidental:!0},{pitch:"A0",flatName:"A0",sharpName:"A0",toneNote:"A0",frequency:27.5,column:"B",hex:"#242c48",isAccidental:!1}],GT=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"],Ye=n=>n.tonicSignGroups?Object.values(n.tonicSignGroups).flat():[],mn=(n,t)=>{const e=Ne.getColumnMap(n),{macrobeatGroupings:s}=n,r=s[t]??0;let i=null,o=null;for(const A of e.entries)A.macrobeatIndex===t&&A.type==="beat"&&((i===null||A.canvasIndex!==null&&A.canvasIndex<i)&&(i=A.canvasIndex),(o===null||A.canvasIndex!==null&&A.canvasIndex>o)&&(o=A.canvasIndex));if(i===null||o===null){let A=0;const a=Ye(n);a.some(l=>l.preMacrobeatIndex===-1)&&(A+=2);for(let l=0;l<t;l++)A+=s[l]??0,a.some(c=>c.preMacrobeatIndex===l)&&(A+=2);i=A,o=i+r-1}return{startColumn:i,endColumn:o,grouping:r}},KT=n=>n.placedNotes.filter(t=>!t.isDrum),qT=n=>n.placedNotes.filter(t=>t.isDrum),zT=(n,t)=>{const s=Ye(n).filter(l=>l.columnIndex<=t);if(s.length===0)return{keyTonic:"C",keyMode:"major"};const r=s.reduce((l,c)=>c.columnIndex>l.columnIndex?c:l),i=typeof r.globalRow=="number"?r.globalRow:r.row,o=Xs[i]??n.fullRowData[r.row];if(!o)return{keyTonic:"C",keyMode:"major"};const A=rh(o.toneNote),a=GT[r.tonicNumber-1]||"major";return{keyTonic:A,keyMode:a}},Io=12,$T=50,XT=.5,rs=3,Za=1,DA=30,ra=30,ia=.5,zm=3,YT=.7,jT=.9,JT=4,ZT=1.5,t_=.15,e_=.2,n_=1,oa=1.5,s_="#CCCCCC",$w=1,$m=3,Xm=5,r_=7,Gl=16,i_=0,o_=255;class A_{constructor(){M(this,"cachedMap",null);M(this,"cacheKey",null)}getColumnMap(t){const e=this.buildCacheKey(t);return this.cachedMap&&this.isCacheValid(e)?this.cachedMap:(this.cachedMap=this.buildColumnMap(t),this.cacheKey=e,this.cachedMap)}invalidate(){this.cachedMap=null,this.cacheKey=null}buildCacheKey(t){const s=Ye(t).map(r=>`${r.columnIndex}:${r.preMacrobeatIndex}:${r.uuid||""}`).sort().join("|");return{macrobeatGroupings:[...t.macrobeatGroupings],tonicSignsHash:s,macrobeatBoundaryStyles:[...t.macrobeatBoundaryStyles]}}isCacheValid(t){return this.cacheKey?this.cacheKey.tonicSignsHash===t.tonicSignsHash&&JSON.stringify(this.cacheKey.macrobeatGroupings)===JSON.stringify(t.macrobeatGroupings)&&JSON.stringify(this.cacheKey.macrobeatBoundaryStyles)===JSON.stringify(t.macrobeatBoundaryStyles):!1}buildColumnMap(t){const{macrobeatGroupings:e,macrobeatBoundaryStyles:s}=t,i=[...Ye(t)].sort((B,C)=>B.preMacrobeatIndex-C.preMacrobeatIndex),o=[],A=[];let a=0,l=0,c=0,u=0,d=0;const p=B=>{var C;for(;d<i.length;){const b=i[d];if(!b||b.preMacrobeatIndex!==B)break;const S=b.uuid||"";for(let x=0;x<2;x++)o.push({visualIndex:a,canvasIndex:l,timeIndex:null,type:"tonic",widthMultiplier:Za,xOffsetUnmodulated:u,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:x===0?S:null}),a++,l++,u+=Za;const T=S;do d++;while(d<i.length&&(((C=i[d])==null?void 0:C.uuid)||"")===T)}};for(let B=0;B<2;B++)o.push({visualIndex:a,canvasIndex:null,timeIndex:null,type:"legend-left",widthMultiplier:rs,xOffsetUnmodulated:u,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:null}),a++,u+=rs;p(-1),e.forEach((B,C)=>{for(let S=0;S<B;S++)o.push({visualIndex:a,canvasIndex:l,timeIndex:c,type:"beat",widthMultiplier:Za,xOffsetUnmodulated:u,macrobeatIndex:C,beatInMacrobeat:S,isMacrobeatStart:S===0,isMacrobeatEnd:S===B-1,isPlayable:!0,tonicSignUuid:null}),a++,l++,c++,u+=Za;const b=s[C]||"dashed";A.push({macrobeatIndex:C,visualColumn:a-1,canvasColumn:l-1,timeColumn:c-1,boundaryType:b,isMeasureStart:b==="solid"}),p(C)});for(let B=0;B<2;B++)o.push({visualIndex:a,canvasIndex:null,timeIndex:null,type:"legend-right",widthMultiplier:rs,xOffsetUnmodulated:u,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:null}),a++,u+=rs;const h=new Map,m=new Map,g=new Map,v=new Map,w=new Map,y=new Map;return o.forEach(B=>{h.set(B.visualIndex,B.canvasIndex),m.set(B.visualIndex,B.timeIndex),B.canvasIndex!==null&&(g.set(B.canvasIndex,B.visualIndex),v.set(B.canvasIndex,B.timeIndex)),B.timeIndex!==null&&(B.canvasIndex!==null&&w.set(B.timeIndex,B.canvasIndex),y.set(B.timeIndex,B.visualIndex))}),{entries:o,visualToCanvas:h,visualToTime:m,canvasToVisual:g,canvasToTime:v,timeToCanvas:w,timeToVisual:y,macrobeatBoundaries:A,totalVisualColumns:a,totalCanvasColumns:l,totalTimeColumns:c,totalWidthUnmodulated:u}}}const Ne=new A_;function a_(n){n.on("rhythmStructureChanged",()=>{Ne.invalidate()})}function l_(n,t){return Ne.getColumnMap(t).visualToTime.get(n)??null}function Yr(n,t){return Ne.getColumnMap(t).canvasToTime.get(n)??null}function Cn(n,t){const s=Ne.getColumnMap(t).timeToCanvas.get(n);return s!==void 0?s:n}function c_(n,t){const s=Ne.getColumnMap(t).timeToVisual.get(n);return s!==void 0?s:n+2}function u_(n,t){const e=Ne.getColumnMap(t),s=e.canvasToVisual.get(n);return s!==void 0&&e.entries[s]||null}function d_(n,t){const e=u_(n,t);return(e==null?void 0:e.isPlayable)??!1}function h_(n){const t=Ne.getColumnMap(n),e=[];for(const s of t.entries)s.canvasIndex!==null&&(e[s.canvasIndex]=s.widthMultiplier);return e}function oh(n,...t){}const Fn={COMPRESSION_2_3:2/3,EXPANSION_3_2:3/2};function f_(n,t){if(!t||!t.macrobeatGroupings)return n*4;if(n===0)return 0;const e=n-1,s=mn(t,e);if(s){const i=s.endColumn+1;return oh("log","[MODULATION] Found measure info, canvas-space endColumn:",s.endColumn,"first column after:",i),i}return n*4}function Xw(n){return Math.abs(n-Fn.COMPRESSION_2_3)<.001?"2:3":Math.abs(n-Fn.EXPANSION_3_2)<.001?"3:2":`${n}`}function Yw(n){const t="#ffc107";return Math.abs(n-Fn.COMPRESSION_2_3)<.001||Math.abs(n-Fn.EXPANSION_3_2)<.001,t}function Ym(){const n=[{startColumn:0,endColumn:1/0,scale:1}];return{segments:n,getScaleForColumn(t){return 1},microbeatToCanvasX(){return 0},canvasXToMicrobeat(){return 0},getSegmentAtX(){return n[0]||null},getGhostGridPositions(){return[]}}}function p_(n,t,e=null){if(!n||n.length===0)return Ym();const s=[...n.filter(l=>l.active)].sort((l,c)=>l.measureIndex-c.measureIndex);if(s.length===0)return Ym();const r=s.map(l=>{const c=f_(l.measureIndex,e);return oh("log",`[MODULATION] Marker at measure ${l.measureIndex} calculated column=${c}`),oh("log","[MODULATION] Final marker position:",{id:l.id,measureIndex:l.measureIndex,columnIndex:c}),{...l,columnIndex:c}}),i=[];let o=1;const A=r[0];if(r.length===0||A&&A.columnIndex>0){const l=A?A.columnIndex:1/0;i.push({startColumn:0,endColumn:l,scale:1})}for(let l=0;l<r.length;l++){const c=r[l],u=r[l+1],d=u?u.columnIndex:1/0;o*=c.ratio,i.push({startColumn:c.columnIndex,endColumn:d,scale:o,marker:c})}return{segments:i,getScaleForColumn(l){for(const c of i)if(l>=c.startColumn&&l<c.endColumn)return c.scale;return 1},microbeatToCanvasX(l){return 0},canvasXToMicrobeat(l){return 0},getSegmentAtX(l){return i[0]||null},getGhostGridPositions(l,c){return[]}}}class m_{constructor(){M(this,"cachedPixelMap",null);M(this,"lastPixelMapHash",null)}getColumnPixelPosition(t,e,s){const r=this.getOrBuildPixelMap(e,s),i=r.columnPositions.get(Math.floor(t));if(i)return i;const o=r.columnPositions.size;return t===o&&r.columnPositions.get(o-1)?{canvasIndex:t,xStart:r.totalPixelWidth,xEnd:r.totalPixelWidth,width:0,modulationScale:1}:this.calculateFallbackPosition(t,e)}columnToPixelX(t,e,s){const r=Math.floor(t),i=t-r,o=this.getColumnPixelPosition(r,e,s);return o.xStart+i*o.width}pixelXToColumn(t,e,s){const r=this.getOrBuildPixelMap(e,s),i=Array.from(r.columnPositions.values()).sort((a,l)=>a.canvasIndex-l.canvasIndex);for(const a of i)if(t>=a.xStart&&t<a.xEnd){const l=(t-a.xStart)/a.width;return a.canvasIndex+l}if(i.length===0)return 0;const o=i[0];if(!o||t<o.xStart)return 0;const A=i[i.length-1];return(A==null?void 0:A.canvasIndex)??0}invalidate(){this.cachedPixelMap=null,this.lastPixelMapHash=null}getOrBuildPixelMap(t,e){const s=this.buildPixelMapHash(t,e);return this.cachedPixelMap&&this.lastPixelMapHash===s?this.cachedPixelMap:(this.cachedPixelMap=this.buildPixelMap(t,e),this.lastPixelMapHash=s,this.cachedPixelMap)}buildPixelMapHash(t,e){const s=t.tempoModulationMarkers?JSON.stringify(t.tempoModulationMarkers.map(r=>({id:r.id,col:r.columnIndex,ratio:r.ratio}))):"none";return JSON.stringify({cellWidth:t.cellWidth,modulation:s,columnCount:e?Ne.getColumnMap(e).totalCanvasColumns:0})}buildPixelMap(t,e){const{cellWidth:s,tempoModulationMarkers:r}=t,i=Ne.getColumnMap(e),o=new Map,A=t.baseMicrobeatPx??s,a=r&&r.length>0?p_(r,A,e):null;let l=0;for(const c of i.entries){if(c.canvasIndex===null)continue;const u=c.widthMultiplier*s,d=a?a.getScaleForColumn(c.canvasIndex):1,p=u*d;o.set(c.canvasIndex,{canvasIndex:c.canvasIndex,xStart:l,xEnd:l+p,width:p,modulationScale:d}),l+=p}return{columnPositions:o,totalPixelWidth:l}}calculateFallbackPosition(t,e){const{cellWidth:s}=e,r=s;return{canvasIndex:t,xStart:t*r,xEnd:(t+1)*r,width:r,modulationScale:1}}}const ei=new m_;function g_(n){n.on("rhythmStructureChanged",()=>{ei.invalidate()})}function v_(n,t){const e=t.state||t;return ei.columnToPixelX(n,t,e)}function jw(n){const t=n.state||n;return ei.getOrBuildPixelMap(n,t).totalPixelWidth}function w_(n){return h_(n)}function B_(n,t){return n.reduce((e,s)=>e+s,0)*t}const oe=9,C_=2,b_=5;function on(n,t,e){return Number.isFinite(n)?Math.max(t,Math.min(e,Math.round(n))):t}function y_(n){return Number.isFinite(n)?Math.max(1,n):1}function jm(n,t,{maxStep:e=b_}={}){const s=Math.max(1,Math.round(t)),i=Math.max(1,Math.round(n))/s;let o=1;i>=.85?o=5:i>=.65?o=4:i>=.45?o=3:i>=.25?o=2:o=1;const A=Math.max(1,Math.round(e));return Math.max(1,Math.min(A,o))}function Jw(n,t,e){const s=Math.max(0,e-1),r=Math.max(1,Math.round(t)),i=(r-1)/2;let o=Math.round(n-i),A=o+r-1;if(o<0&&(A+=-o,o=0),A>s){const a=A-s;o-=a,A=s}return o=on(o,0,s),A=on(A,o,s),{topIndex:o,bottomIndex:A}}function is(n){return n.bottomIndex-n.topIndex+1}function Zw(n,t){const e=Math.max(0,t-1),s=on(n.topIndex??0,0,e),r=on(n.bottomIndex??e,0,e);return r<s?{topIndex:r,bottomIndex:s}:{topIndex:s,bottomIndex:r}}function Kn(n,t,e=oe){const s=Zw(n,t),r=Math.max(1,Math.round(e));if(is(s)>=r)return s;const o=(s.topIndex+s.bottomIndex)/2;return Jw(o,r,t)}function S_(n,t,e,s=oe){const r=Math.max(0,e-1),i=on(n.bottomIndex,0,r),o=Math.max(1,Math.round(s)),A=Math.max(0,i-(o-1));return{topIndex:on(t,0,A),bottomIndex:i}}function E_(n,t,e,s=oe){const r=Math.max(0,e-1),i=on(n.topIndex,0,r),o=Math.max(1,Math.round(s)),A=Math.min(r,i+(o-1)),a=on(t,A,r);return{topIndex:i,bottomIndex:a}}function x_(n,t,e,s=oe){const r=Math.max(0,e-1),i=on(n,0,r),o=Math.max(1,Math.round(s)),A=Math.max(0,i-(o-1));return on(t,0,A)}function I_(n,t,e,s=oe){const r=Math.max(0,e-1),i=on(n,0,r),o=Math.max(1,Math.round(s)),A=Math.min(r,i+(o-1));return on(t,A,r)}function F_(n,t,e){const s=Math.max(0,e-1),r=Math.max(1,is(n)),i=Math.max(0,s+1-r),o=on(n.topIndex+t,0,i),A=Math.min(s,o+r-1);return{topIndex:o,bottomIndex:A}}function Jm(n,t,{totalRanks:e,minSpan:s=oe,zoomStep:r=C_}){const i=Math.max(0,e-1),o=Math.max(1,Math.round(s)),A=Math.max(0,Math.round(r)),a=Zw(n,e);if(A===0)return Kn(a,e,o);const l=is(a);if(t==="in"){if(l<=o)return Kn(a,e,o);const h=Math.max(o,l-2*A),m=(a.topIndex+a.bottomIndex)/2;return Jw(m,h,e)}const c=a.topIndex-A,u=a.bottomIndex+A,d=on(c,0,i),p=on(u,0,i);return Kn({topIndex:d,bottomIndex:p},e,o)}function T_(n,t,{baseUnit:e,paddingRows:s=1}){if(!n||n<=0||!t||t<=0)return 1;const r=Math.max(1,Math.round(t)+Math.max(0,Math.round(s))),i=y_(e);return 2*n/(r*i)}let fo=1,Fo=0,li,Es,Ah,Zs,tr,zs,mA,ah,t2,e2,n2,s2,Zn,fi,lh,nd=null,Kl=!1,kA=!1,sd=!1,rd=!1,ch=!1,Zm=0,tl=null,To=null,uh=0,ql=null,id=!1,el=0;const __=new Promise(n=>{ql=()=>n()});let od=0,Ad=0;function r2(){const n=document.getElementById("pitch-grid-container"),t=Fo||window.innerHeight||0;return(n==null?void 0:n.clientHeight)||(t?t*.7:0)}function tg(n,t){return T_(n,t,{baseUnit:DA,paddingRows:1})}function _o(){const n=f.state.fullRowData.length,t=Math.max(0,n-1),e=f.state.pitchRange||{topIndex:0,bottomIndex:t};return Kn(e,n,oe)}function zl(){To!==null&&(cancelAnimationFrame(To),To=null),uh+=1,kA=!1}function nl(n,t){const e=f.state.fullRowData.length,s=_o(),r=Kn(n,e,oe);if(r.topIndex===s.topIndex&&r.bottomIndex===s.bottomIndex)return;const i=s.topIndex,o=is(s);f.setPitchRange(r),f.emit("scrollChanged");const A=r.topIndex-i;if(A!==0&&f.emit("scrollByUnits",A),is(r)!==o){Ss(),f.emit("zoomChanged");return}document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:t}}))}function sl(n,t,e){zl(),kA=!0;const s=f.state.fullRowData.length,r=_o(),i=Kn(n,s,oe);if(i.topIndex===r.topIndex&&i.bottomIndex===r.bottomIndex){kA=!1;return}const o=uh,A=performance.now(),a=Math.max(0,Math.round(t));let l=r.topIndex;const c=d=>d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,u=()=>{if(o!==uh)return;const d=performance.now(),p=a>0?(d-A)/a:1,h=Math.max(0,Math.min(1,p)),m=c(h),g=Math.round(r.topIndex+(i.topIndex-r.topIndex)*m),v=Math.round(r.bottomIndex+(i.bottomIndex-r.bottomIndex)*m),w=Kn({topIndex:g,bottomIndex:v},s,oe);f.setPitchRange(w),f.emit("scrollChanged");const y=w.topIndex-l;if(y!==0&&(f.emit("scrollByUnits",y),l=w.topIndex),Ss(),f.emit("zoomChanged"),h<1){To=requestAnimationFrame(u);return}To=null,kA=!1};To=requestAnimationFrame(u)}function M_(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let Q_=!1;function i2(n,t){var e;if(M_())try{const s=((e=performance==null?void 0:performance.now)==null?void 0:e.call(performance))??Date.now();if(s-Zm<500)return;Zm=s,Q_=!0}catch{}}function U_(){const n=(window==null?void 0:window.devicePixelRatio)??1;return!Number.isFinite(n)||n<=0?1:n}function oi(n,t,e,s,r){if(!n)return!1;const i=Number.isFinite(s)&&s>0?s:1;n.dataset.pixelRatio=`${i}`;let o=!1;if(typeof t=="number"){const A=Math.max(1,Math.round(t*i));Math.abs(n.width-A)>.5&&(n.width=A,o=!0),n.style.width=`${t}px`,n.dataset.logicalWidth=`${t}`}if(typeof e=="number"){const A=Math.max(1,Math.round(e*i));Math.abs(n.height-A)>.5&&(n.height=A,o=!0),n.style.height=`${e}px`,n.dataset.logicalHeight=`${e}`}if(o){const A=r||n.getContext("2d");A&&A.setTransform(i,0,0,i,0,0)}return o}function P_(){li=document.getElementById("pitch-grid-wrapper"),Es=document.getElementById("notation-grid"),Zs=document.getElementById("legend-left-canvas"),tr=document.getElementById("legend-right-canvas"),zs=document.getElementById("drum-grid-wrapper"),mA=document.getElementById("drum-grid"),t2=document.getElementById("drum-playhead-canvas"),e2=document.getElementById("playhead-canvas"),n2=document.getElementById("hover-canvas"),s2=document.getElementById("drum-hover-canvas"),Zn=document.getElementById("button-grid"),fi=document.getElementById("grid-scrollbar-proxy"),lh=(fi==null?void 0:fi.querySelector(".grid-scrollbar-inner"))||null;const n=document.getElementById("canvas-container");if(!li||!Es||!n)return{};Ah=Es.getContext("2d"),ah=(mA==null?void 0:mA.getContext("2d"))||null;const t=(Zs==null?void 0:Zs.getContext("2d"))||null,e=(tr==null?void 0:tr.getContext("2d"))||null;return{ctx:Ah,drumCtx:ah,legendLeftCtx:t,legendRightCtx:e,canvasContainer:n}}function N_(){var e;if(ch)return;const n=(((e=f.state.columnWidths)==null?void 0:e.length)||0)>0,t=!!(f.state.cellWidth&&f.state.cellWidth>0);!n||!t||(ch=!0,ql==null||ql())}function Ss(){var V,H;if(!li||li.clientHeight===0){sd||(E.warn("LayoutService","Pitch grid wrapper not ready for layout (height=0). Retrying on next frame.",null,"layout"),sd=!0),requestAnimationFrame(Ss);return}if(sd=!1,Kl)return;Kl=!0;const n=document.getElementById("pitch-grid-container");li.clientWidth;const t=window.innerHeight;(Math.abs(t-Fo)>3||Fo===0)&&(Fo=t);const s=DA,r=s*XT,i=_o(),o=r2(),A=Math.max(1,is(i));fo=tg(o,A);const a=Math.round(s*fo),l=Math.round(r*fo);f.setLayoutConfig({cellHeight:a,cellWidth:l});const c=w_(f.state);f.setLayoutConfig({columnWidths:c}),N_(),(!f.state.cellWidth||!c.length)&&E.warn("LayoutService","Unexpected layout configuration",{cellWidth:f.state.cellWidth,columnCount:c.length},"layout");const d=c.reduce((G,Y)=>G+Y,0)*f.state.cellWidth,p=fe.getModulatedCanvasWidth(),h=f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0,m=h?p:d,g=rs*2*f.state.cellWidth,v=rs*2*f.state.cellWidth,w=Math.round(m+g+v),y=U_();document.getElementById("drum-grid-wrapper");const I=document.getElementById("grids-wrapper"),B=w+"px";if(n&&(n.style.width=B),li&&(li.style.width=B),zs&&(zs.style.width=B),lh&&fi){lh.style.width=B;const G=(I==null?void 0:I.getBoundingClientRect().width)||0;w>G?fi.style.display="":fi.style.display="none"}const C=Math.max(ra,ia*f.state.cellHeight),b=zm*C,S=`${b}px`,T=((V=f.state.columnWidths)==null?void 0:V.length)??0;let x=0;if(h){const G={cellWidth:f.state.cellWidth,columnWidths:f.state.columnWidths,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth,cellHeight:f.state.cellHeight,state:f.state};x=jw(G)}else for(let G=0;G<T;G++)x+=(f.state.columnWidths[G]||0)*f.state.cellWidth;if(T===0&&E.warn("LayoutService","Column widths array is empty.",{columnWidthsCount:T,columnWidths:f.state.columnWidths},"layout"),x<50&&T>0&&E.warn("LayoutService","Computed button-grid middle cell width is unexpectedly small.",{middleCellWidth:x,columnWidthsSample:(H=f.state.columnWidths)==null?void 0:H.slice(0,10),cellWidth:f.state.cellWidth,macrobeatGroupings:f.state.macrobeatGroupings},"layout"),Zn){const G=Zn.querySelector(".button-grid-left-cell"),Y=Zn.querySelector(".button-grid-middle-cell"),P=Zn.querySelector(".button-grid-right-cell"),st=rs*2*f.state.cellWidth,D=rs*2*f.state.cellWidth;(Math.abs(Ad-b)>5||Ad===0)&&(Zn.style.height=S,Ad=b);const X=(z,$)=>{if(!z)return;const rt=`${Math.max(0,$)}px`;z.style.width=rt,z.style.flex=`0 0 ${rt}`,z.style.maxWidth=rt,z.style.minWidth=rt,z.style.height=S};if(G){X(G,st);const z=G.getBoundingClientRect();st>0&&z.width===0&&E.warn("LayoutService","Left button-grid cell measured width is 0 after assignment.",{assignedWidth:st,measuredWidth:z.width,computedDisplay:window.getComputedStyle(G).display},"layout")}if(Y){x===0&&E.warn("LayoutService","Calculated middle button-grid width is 0. Check column width data.",{columnWidths:f.state.columnWidths,cellWidth:f.state.cellWidth},"layout"),X(Y,x);const z=Y.getBoundingClientRect();if(x>0&&z.width===0&&E.warn("LayoutService","Middle button-grid cell assigned width but still measures 0.",{assignedWidth:x,measuredWidth:z.width,computedStyles:window.getComputedStyle(Y)},"layout"),Math.abs(z.width-x)>5&&(E.warn("LayoutService","Middle cell measured width does not match assigned width.",{assignedWidth:x,measuredWidth:z.width,styleWidth:Y.style.width,cellWidth:f.state.cellWidth},"layout"),requestAnimationFrame(()=>{const $=Y.getBoundingClientRect();Math.abs($.width-x)>5&&E.warn("LayoutService","Middle cell still mismatched after RAF.",{assignedWidth:x,measuredWidth:$.width,delta:$.width-x,computedStyles:window.getComputedStyle(Y)},"layout")})),!rd){const $=Y.querySelector("#beat-line-button-layer");if($){const rt=$.getBoundingClientRect();if(rt.width===0){const et=window.getComputedStyle($);E.warn("LayoutService","#beat-line-button-layer width is 0 despite middle cell sizing.",{beatLineRect:rt,beatLineStyles:{display:et.display,position:et.position,flex:{direction:et.flexDirection,grow:et.flexGrow,shrink:et.flexShrink,basis:et.flexBasis},width:et.width,minWidth:et.minWidth,maxWidth:et.maxWidth},middleRect:z,middleCellComputedWidth:et.width},"layout"),rd=!0}}else E.warn("LayoutService","Could not find #beat-line-button-layer inside middle cell to measure.",null,"layout"),rd=!0}}if(P){X(P,D);const z=P.getBoundingClientRect();D>0&&z.width===0&&E.warn("LayoutService","Right button-grid cell measured width is 0 after assignment.",{assignedWidth:D,measuredWidth:z.width,computedDisplay:window.getComputedStyle(P).display},"layout")}const tt=st+x+D;Number.isFinite(tt)&&tt>0&&(Zn.style.width=B,Zn.style.maxWidth=B,Zn.style.minWidth=B),Zn.getBoundingClientRect().width===0&&E.warn("LayoutService","Entire button grid wrapper width is 0 after layout pass.",{leftCellWidth:st,middleCellWidth:x,rightCellWidth:D,wrapperStyles:window.getComputedStyle(Zn)},"layout")}const _=Math.max(ra,ia*f.state.cellHeight),F=zm*_,Q=`${F}px`,U=(n==null?void 0:n.clientHeight)||0;if(U>0){const G=f.state.cellHeight,Y=f.state.cellWidth,P=Math.max(1,is(i)),st=tg(U,P),D=Math.round(s*st),K=Math.round(r*st);f.setLayoutConfig({cellHeight:D,cellWidth:K}),fo=st,(D!==G||K!==Y)&&(id=!0)}const W=Math.round(rs*2*f.state.cellWidth),L=Math.round(rs*2*f.state.cellWidth),R=Math.round(m),N=[{element:Es,context:Ah},{element:e2},{element:n2}];if(N.forEach(({element:G,context:Y})=>{oi(G,R,U,y,Y),G&&(G.style.left=`${W}px`)}),oi(Zs,W,U,y,null),oi(tr,L,U,y,null),[{element:mA,context:ah},{element:t2},{element:s2}].forEach(({element:G,context:Y})=>{oi(G,R,F,y,Y)}),zs){const G=zs.querySelector(".drum-grid-left-cell"),Y=zs.querySelector(".drum-grid-middle-cell"),P=zs.querySelector(".drum-grid-right-cell"),st=(K,O)=>{if(!K)return;const X=`${Math.max(0,Math.round(O))}px`;K.style.width=X,K.style.flex=`0 0 ${X}`,K.style.maxWidth=X,K.style.minWidth=X,K.style.height=Q};st(G,W),st(Y,R),st(P,L);const D=Y==null?void 0:Y.querySelector("#drum-canvas-wrapper");D&&(D.style.width="100%",D.style.height=Q)}const nt=Math.abs(od-F)>5||od===0;zs&&nt&&(zs.style.height=Q,od=F);const At=y,ot=R;tl&&clearTimeout(tl),tl=setTimeout(()=>{var P,st,D;tl=null;const G=document.getElementById("pitch-grid-container"),Y=(G==null?void 0:G.clientHeight)||0;N.forEach(({element:K,context:O})=>{oi(K,ot,Y,At,O),K&&(K.style.left=`${W}px`)}),oi(Zs,W,Y,At,null),oi(tr,L,Y,At,null),i2("deferredResize",{finalContainerHeight:Y,pitchCanvasLogicalHeight:(P=Es==null?void 0:Es.dataset)==null?void 0:P.logicalHeight,legendLeftLogicalHeight:(st=Zs==null?void 0:Zs.dataset)==null?void 0:st.logicalHeight,legendRightLogicalHeight:(D=tr==null?void 0:tr.dataset)==null?void 0:D.logicalHeight}),document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:"layoutService-deferred"}}))});try{const G=f.state.fullRowData.length,Y=Math.max(0,G-1),P=f.state.pitchRange||{topIndex:0,bottomIndex:Y},st=Kn(P,G,oe);(P.topIndex!==st.topIndex||P.bottomIndex!==st.bottomIndex)&&f.setPitchRange(st)}catch{}f.emit("layoutConfigChanged"),Kl=!1,id?(id=!1,el<1?(el+=1,requestAnimationFrame(Ss)):E.warn("LayoutService","Skipped additional layout pass after repeated final zoom adjustments.",{finalRecalcAttempts:el},"layout")):el=0}const fe={init(){const{ctx:n,drumCtx:t,legendLeftCtx:e,legendRightCtx:s}=P_();requestAnimationFrame(Ss),this.initScrollHandler();const r=()=>{Kl||(nd!==null&&clearTimeout(nd),nd=setTimeout(()=>{Ss()},$T))};return window.addEventListener("resize",r),f.on("zoomIn",i=>{this.zoomIn(i)}),f.on("zoomOut",i=>{this.zoomOut(i)}),{ctx:n,drumCtx:t,legendLeftCtx:e,legendRightCtx:s}},waitForInitialLayout(){return ch?Promise.resolve():__},getCurrentZoomLevel(){return fo},setZoomLevel(n){const t=Number.isFinite(n)&&n>0?n:1,e=r2(),s=f.state.fullRowData.length,r=Math.max(0,s-1);if(!s||s<=0)return;const i=2*e/(t*DA),o=Math.max(oe,Math.min(s,Math.round(i)-1)),A=_o(),a=(A.topIndex+A.bottomIndex)/2,l=(o-1)/2;let c=Math.round(a-l),u=c+o-1;if(c<0&&(u+=-c,c=0),u>r){const d=u-r;c-=d,u=r}nl({topIndex:c,bottomIndex:u},"setZoomLevel")},setPitchViewportRange(n,t={}){const e=t.source??"setPitchViewportRange",s=Math.max(0,Math.round(t.animateMs??0));if(s>0){sl(n,s);return}nl(n,e)},_canScrollRange(n){const t=f.state.pitchRange;if(!t||!Xs||Xs.length===0)return!1;const e=Xs.length-1,s=typeof n=="string"?n==="up"?-1:1:n,r=s<0&&t.topIndex>0,i=s>0&&t.bottomIndex<e;return r||i},initScrollHandler(){const n=document.getElementById("pitch-grid-wrapper");n&&n.addEventListener("wheel",t=>{if(t.preventDefault(),t.ctrlKey||t.metaKey)t.deltaY<0?this.zoomIn({source:"wheel"}):this.zoomOut({source:"wheel"});else{const e=t.deltaY>0?1:-1;this._canScrollRange(e)&&this.scrollByUnits(e)}},{passive:!1})},zoomIn(n){const t=f.state.fullRowData.length;if(!t)return;const e=_o(),s=is(e),r=jm(s,t),i=Jm(e,"in",{totalRanks:t,minSpan:oe,zoomStep:r}),o=is(i),A=(n==null?void 0:n.source)??"unknown",a=A==="wheel"?0:280;E.debug("LayoutService",`[Zoom] Range zoom in (span ${s} -> ${o})`,{source:A},"layout"),a>0?sl(i,a):(nl(i,`zoomIn:${A}`),f.emit("zoomChanged"))},zoomOut(n){const t=f.state.fullRowData.length;if(!t)return;const e=_o(),s=is(e),r=jm(s,t),i=Jm(e,"out",{totalRanks:t,minSpan:oe,zoomStep:r}),o=is(i),A=(n==null?void 0:n.source)??"unknown",a=A==="wheel"?0:280;E.debug("LayoutService",`[Zoom] Range zoom out (span ${s} -> ${o})`,{source:A},"layout"),a>0?sl(i,a):(nl(i,`zoomOut:${A}`),f.emit("zoomChanged"))},resetZoom(n){const t=f.state.fullRowData.length;if(!t)return;const e=Math.max(0,t-1);n==null||n.source,sl({topIndex:0,bottomIndex:e},320)},scroll(n){const e=this.getViewportInfo().startRank;f.emit("scrollChanged");const i=this.getViewportInfo().startRank-e;i!==0&&f.emit("scrollByUnits",i),f.emit("layoutConfigChanged")},scrollByUnits(n){zl();const t=f.state.pitchRange;if(!t||!Xs||Xs.length===0)return;const e=Math.sign(n||0);if(e===0)return;const s=Xs.length,r=Kn(t,s,oe),i=F_(r,e,s);i.topIndex===r.topIndex&&i.bottomIndex===r.bottomIndex||(f.setPitchRange(i),f.emit("scrollChanged"),f.emit("scrollByUnits",e),document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:"viewportScroll"}})))},setViewportTopIndex(n){zl();const t=f.state.pitchRange||{topIndex:0,bottomIndex:Math.max(0,f.state.fullRowData.length-1)},e=f.state.fullRowData.length,s=Kn(t,e,oe),r=S_(s,n,e,oe),i=r.topIndex-(s.topIndex??0);r.topIndex===s.topIndex&&r.bottomIndex===s.bottomIndex||(f.setPitchRange(r),f.emit("scrollChanged"),i!==0&&f.emit("scrollByUnits",i),Ss(),f.emit("zoomChanged"))},setViewportBottomIndex(n){zl();const t=f.state.pitchRange||{topIndex:0,bottomIndex:Math.max(0,f.state.fullRowData.length-1)},e=f.state.fullRowData.length,s=Kn(t,e,oe),r=E_(s,n,e,oe),i=r.topIndex-(s.topIndex??0);E.debug("LayoutService","setViewportBottomIndex",{requestedBottom:n,currentRange:t,normalized:s,nextRange:r,willUpdate:!(r.topIndex===s.topIndex&&r.bottomIndex===s.bottomIndex)},"layout"),!(r.topIndex===s.topIndex&&r.bottomIndex===s.bottomIndex)&&(f.setPitchRange(r),f.emit("scrollChanged"),i!==0&&f.emit("scrollByUnits",i),Ss(),f.emit("zoomChanged"))},scrollByPixels(n,t=0){const s=this.getViewportInfo().startRank;f.state.fullRowData.length,f.state.cellHeight,f.emit("scrollChanged");const o=this.getViewportInfo().startRank-s;o!==0&&f.emit("scrollByUnits",o),f.emit("layoutConfigChanged")},getViewportInfo(){var I,B,C,b,S,T;const n=f.state.fullRowData.length,t=Math.max(0,n-1),e=document.getElementById("pitch-grid-container"),s=(e==null?void 0:e.clientHeight)||Fo*.7,r=f.state.cellHeight||DA,i=r/2,o=Kn(f.state.pitchRange||{topIndex:0,bottomIndex:t},n,oe),A=Math.max(0,Math.min(t,o.topIndex??0)),a=Math.max(A,Math.min(t,o.bottomIndex??t)),l=Math.min(n,a+1),c=A*i,u=document.getElementById("legend-left-canvas"),d=document.getElementById("legend-right-canvas"),p=i?s/i:0,h=Math.max(1,a-A+1),m=h*i,g=f.state.fullRowData[A],v=f.state.fullRowData[a],w=A<=0,y=a>=t;return i2("getViewportInfo",{containerHeight:s,containerRectHeight:(I=e==null?void 0:e.getBoundingClientRect)==null?void 0:I.call(e).height,cellHeight:r,halfUnit:i,ratio:p,rowCount:h,coveragePx:m,coverageGapPx:s-m,totalRanks:n,pitchRange:o,startRank:A,endRank:l,atTopGamutEdge:w,atBottomGamutEdge:y,scrollOffset:c,startRowSummary:g?{pitch:g.pitch,column:g.column,isBoundary:!!g.isBoundary}:null,endRowSummary:v?{pitch:v.pitch,column:v.column,isBoundary:!!v.isBoundary}:null,pitchCanvasLogicalHeight:(B=Es==null?void 0:Es.dataset)==null?void 0:B.logicalHeight,legendLeftLogicalHeight:(C=u==null?void 0:u.dataset)==null?void 0:C.logicalHeight,legendRightLogicalHeight:(b=d==null?void 0:d.dataset)==null?void 0:b.logicalHeight,legendLeftCssHeight:(S=u==null?void 0:u.getBoundingClientRect)==null?void 0:S.call(u).height,legendRightCssHeight:(T=d==null?void 0:d.getBoundingClientRect)==null?void 0:T.call(d).height}),{zoomLevel:fo,viewportHeight:Fo,containerHeight:s,cellHeight:r,halfUnit:i,startRank:A,endRank:l,scrollOffset:c}},getMacrobeatWidthPx(n,t){return t*n.cellWidth},getColumnX(n){const t=f.state.cellWidth||40,e=f.state.columnWidths||[];return v_(n,{cellWidth:t,columnWidths:e,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:t,state:f.state})},getCanvasWidth(){return B_(f.state.columnWidths,f.state.cellWidth)},getModulatedCanvasWidth(){const n=this.getCanvasWidth();if(!f.state.tempoModulationMarkers||f.state.tempoModulationMarkers.length===0)return n;try{const t=f.state.cellWidth||40,e=f.state.columnWidths||[],s={cellWidth:t,columnWidths:e,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:t,cellHeight:f.state.cellHeight||40,state:f.state};return jw(s)}catch{return n}},recalculateLayout(){Ss()},reflow(){Ss()},get isZooming(){return kA}};let ad=null,ld=null,cd=null,ud=null;const Aa={setContexts({ctx:n,drumCtx:t,legendLeftCtx:e,legendRightCtx:s}){ad=n??null,ld=t??null,cd=e??null,ud=s??null},getPitchContext(){return ad||E.error("CanvasContextService","Pitch context requested before it was set.",null,"canvas"),ad},getDrumContext(){return ld||E.error("CanvasContextService","Drum context requested before it was set.",null,"canvas"),ld},getLegendLeftContext(){return cd||E.error("CanvasContextService","Legend left context requested before it was set.",null,"canvas"),cd},getLegendRightContext(){return ud||E.error("CanvasContextService","Legend right context requested before it was set.",null,"canvas"),ud}},qe={getViewportInfo:()=>fe.getViewportInfo(),setViewportTopIndex(n){var t;(t=fe.setViewportTopIndex)==null||t.call(fe,n)},setViewportBottomIndex(n){var t;(t=fe.setViewportBottomIndex)==null||t.call(fe,n)},setPitchViewportRange(n,t={}){var e;(e=fe.setPitchViewportRange)==null||e.call(fe,n,t)}};let Mo=null,Qo=null;f.on("tempoModulationMarkersChanged",()=>{});f.on("scrollChanged",()=>{Mo=null,Qo=null});f.on("zoomChanged",()=>{Mo=null,Qo=null});f.on("pitchRangeChanged",()=>{Mo=null,Qo=null});function wp(){const n=performance.now();return(!Mo||!Qo||n-Qo>1)&&(Mo=qe.getViewportInfo(),Qo=n),Mo}function lt(n,t){const e=f.state,s={cellWidth:t.cellWidth,tempoModulationMarkers:t.tempoModulationMarkers,baseMicrobeatPx:t.baseMicrobeatPx,columnWidths:t.columnWidths,state:e};return ei.columnToPixelX(n,s,e)}function xt(n,t){const e=wp(),s=n-e.startRank,r=t.cellHeight/2;return(s+1)*r}function L_(n){let t=(n||"").replace(/\d/g,"").trim();return t=t.replace(/b/g,"b-").replace(/#/g,"b_"),t}function D_(n){switch(n){case"C":return{lineWidth:3.33,dash:[],color:"#adb5bd"};case"E":return{lineWidth:1,dash:[5,5],color:"#adb5bd"};case"G":return{lineWidth:1,dash:[],color:"#dee2e6"};case"B":case"A":case"F":case"Eb/Db":case"Db/C#":return{lineWidth:1,dash:[],color:"#ced4da"};default:return{lineWidth:1,dash:[],color:"#ced4da"}}}function k_(){const n=wp(),{startRank:t,endRank:e}=n,s=Math.max(t,e-1);return{startRow:t,endRow:s}}function dh(n,t){const e=f.state,s={cellWidth:t.cellWidth,tempoModulationMarkers:t.tempoModulationMarkers,baseMicrobeatPx:t.baseMicrobeatPx,columnWidths:t.columnWidths,state:e};return ei.pixelXToColumn(n,s,e)}function R_(n,t){const e=wp(),s=t.cellHeight/2;return n/s-1+e.startRank}function o2(n,t){return t.some(e=>e.columnIndex===n)}function hh(n,t){return t.some(e=>n===e.columnIndex||n===e.columnIndex+1)}function aa(n,t){const e=Ye(t);return!hh(n,e)}function A2(n,t){for(const e of t)if(n===e.columnIndex+1)return!1;return t.some(e=>n===e.columnIndex+2),!0}function H_(n){const t=new Set;return n.forEach(e=>{t.add(e.columnIndex),t.add(e.columnIndex+1)}),t}function $e(n){var s;if(!n)return 0;const t=(s=n.dataset)==null?void 0:s.logicalWidth,e=t!==void 0?Number(t):NaN;return Number.isFinite(e)?e:n.width||0}function ie(n){var s;if(!n)return 0;const t=(s=n.dataset)==null?void 0:s.logicalHeight,e=t!==void 0?Number(t):NaN;return Number.isFinite(e)?e:n.height||0}function O_(n){var s;if(!n)return 1;const t=(s=n.dataset)==null?void 0:s.pixelRatio,e=t!==void 0?Number(t):NaN;return Number.isFinite(e)&&e>0?e:1}const dd={stroke:"#c7cfd8",background:"rgba(207, 214, 222, 0.32)"};let rl=null;function a2(){if(rl)return rl;if(typeof window>"u")return dd;const n=window.getComputedStyle(document.documentElement);return rl={stroke:n.getPropertyValue("--c-anacrusis-border").trim()||dd.stroke,background:n.getPropertyValue("--c-anacrusis-bg").trim()||dd.background},rl}function V_(n){if(n.length===0)return[];const t=[...n].sort((s,r)=>s.start-r.start),e=[];for(const s of t){if(e.length===0){e.push({...s});continue}const r=e[e.length-1];s.start<=r.end?r.end=Math.max(r.end,s.end):e.push({...s})}return e}function W_(n){const t=[],e=K_();return e!==null&&e>0&&t.push({start:lt(0,n),end:lt(e,n)}),Ye(f.state).forEach(r=>{const i=lt(r.columnIndex,n),o=lt(r.columnIndex+2,n);t.push({start:i,end:o})}),V_(t)}function G_(n,t,e){const s=new Set([n,t]);e.forEach(o=>{const A=Math.max(n,Math.min(t,o.start)),a=Math.max(n,Math.min(t,o.end));a>A&&(s.add(A),s.add(a))});const r=Array.from(s).sort((o,A)=>o-A),i=[];for(let o=0;o<r.length-1;o++){const A=r[o],a=r[o+1],l=(A+a)/2,c=e.some(u=>l>=u.start&&l<u.end);a>A&&i.push({from:A,to:a,light:c})}return i}function K_(){const n=f.state;if(!(n!=null&&n.hasAnacrusis)||!Array.isArray(n.macrobeatBoundaryStyles))return null;const t=n.macrobeatBoundaryStyles.findIndex(s=>s==="solid");if(t<0)return null;const e=mn(n,t);return e?e.endColumn+1:null}function q_(n,t,e,s){const r=W_(t),{stroke:i}=a2();for(let o=e;o<=s;o++){const A=t.fullRowData[o];if(!A||A.isBoundary)continue;const a=xt(o,t);if(a<-10||a>t.viewportHeight+10)continue;const l=L_(A.pitch);if(["B","A","F","E/D","D/C"].includes(l))continue;const u=D_(l),d=t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:t.columnWidths||[],p=lt(0,t),h=lt(d.length,t),m=G_(p,h,r);l==="G"?m.forEach(g=>{const v=g.to-g.from;v<=0||(n.save(),n.fillStyle=g.light?i:u.color,n.globalAlpha=g.light?.5:1,n.fillRect(g.from,a-t.cellHeight/2,v,t.cellHeight),n.restore())}):m.forEach(g=>{g.to-g.from<=0||(n.beginPath(),n.moveTo(g.from,a),n.lineTo(g.to,a),n.lineWidth=u.lineWidth,n.strokeStyle=g.light?i:u.color,n.setLineDash(u.dash),n.globalAlpha=g.light?.6:1,n.stroke(),n.setLineDash([]),n.globalAlpha=1)})}}function z_(n,t,e,s){q_(n,t,e,s)}function $_(n,t){X_(n,t)}function X_(n,t){const{columnWidths:e,macrobeatGroupings:s,macrobeatBoundaryStyles:r,placedTonicSigns:i}=t,A=(t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:e).length,a=s.map((l,c)=>{const{endColumn:u}=mn(f.state,c);return u+1});for(let l=0;l<=A;l++){const c=l===0||l===A,u=o2(l,i),d=i.some(v=>l===v.columnIndex+2),p=a.includes(l);if(!A2(l,i))continue;let m=null;if(c||u||d)m={lineWidth:2,strokeStyle:"#adb5bd",dash:[]};else if(p){const v=a.indexOf(l),w=r[v]??"dashed";if(w==="anacrusis"){const{stroke:y}=a2();m={lineWidth:1,strokeStyle:y,dash:[4,4]}}else m={lineWidth:1,strokeStyle:"#adb5bd",dash:w==="solid"?[]:[5,5]}}if(!m)continue;const g=lt(l,t);n.beginPath(),n.moveTo(g,0),n.lineTo(g,ie(n.canvas)),n.lineWidth=m.lineWidth,n.strokeStyle=m.strokeStyle,n.setLineDash(m.dash),n.stroke()}n.setLineDash([])}let eg=0;function l2(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let Y_=!1;function j_(n,t){var e;if(l2())try{const s=((e=performance==null?void 0:performance.now)==null?void 0:e.call(performance))??Date.now();if(s-eg<500)return;eg=s,Y_=!0}catch{}}const ng=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"];function J_(n){const t=n.replace(/\d+$/,"");return t.length>0?t:n}function c2(n,t){return!Number.isFinite(t)||t<=0?n:Math.round(n*t)/t}function Z_(n,t,e,s){const r=Math.max(10,Math.min(n*1.2,t*1.2)),i=e<=3?1:.7,o=s<=1?1.08:1;return c2(r*i*o,s)}function tM(n,t){const e=t[n];if(!e)return null;const r=e.pitch.replace(/\d+$/,"");return(r.includes("/")?r.split("/")[0]??r:r).replace(//g,"b").replace(//g,"#")}function eM(n,t){if(!n||!t)return[];const e=t-1;if(e<0||e>=ng.length)return E.warn("LegendRenderer",`Invalid tonic number: ${t}`,null,"grid"),[];const s=ng[e];try{const r=`${n} ${s}`;return WT(r).notes||[]}catch(r){return E.warn("LegendRenderer",`Could not generate ${s} scale`,{tonic:n,error:r},"grid"),[]}}function xc(n){return n?n.replace(/\d+$/,"").replace(/T-/g,"b").replace(/T_/g,"#").replace(/-/g,"b").replace(/_/g,"#").replace(//g,"b").replace(//g,"#"):""}function nM(n){const t=new Set;return n.forEach(e=>{const s=xc(e);if(s){t.add(s);try{const r=xc(LA(s));r&&t.add(r)}catch{}}}),t}function sg(n,t){if(!t.size)return!0;const e=xc(n.toneNote||n.pitch);if(!e)return!1;if(t.has(e))return!0;try{const s=xc(LA(e));if(s&&t.has(s))return!0}catch{}return e.includes("/")?e.split("/").some(s=>t.has(s)):!1}function sM(n,t,e,s,r){const{fullRowData:i,columnWidths:o,cellWidth:A,cellHeight:a,colorMode:l}=e,c=l??"color",{sharp:u,flat:d}=f.state.accidentalMode,{focusColours:p,showFrequencyLabels:h}=f.state,m=e.showOctaveLabels??!0,g=S=>m?S:J_(S),v=(S,T)=>{var ot;if(!l2())return;const x=a/2,_=ie(S.canvas),F=xt(r,e),Q=F+x,U=((ot=document.getElementById("pitch-grid-container"))==null?void 0:ot.clientHeight)??null,W=i.length,L=s<=0,R=r>=W-1,N=V=>{if(V===null)return null;const H=i[V];return H?{rowIndex:V,pitch:H.pitch,column:H.column,isBoundary:!!H.isBoundary}:{rowIndex:V,exists:!1}},q=V=>{let H=null,G=null;for(let Y=s;Y<=r;Y++){const P=i[Y];!P||P.isDummy||P.column===V&&(H===null&&(H=Y),G=Y)}return{first:H,last:G}},J=q("A"),nt=q("B"),At=V=>{if(V===null)return null;const H=xt(V,e);return{rowIndex:V,y:H,topEdge:H-x,bottomEdge:H+x,gapCanvasMinusBottomEdge:_-(H+x)}};j_("legendCoverage",{side:T,startRow:s,endRow:r,atTopGamutEdge:L,atBottomGamutEdge:R,cellHeight:a,halfUnit:x,yEnd:F,bottomEdge:Q,canvasHeight:_,gapCanvasMinusBottomEdge:_-Q,containerHeight:U,gapCanvasMinusContainer:typeof U=="number"?_-U:null,startRowSummary:N(s),endRowSummary:N(r),firstLastA:{...J,firstSummary:N(J.first),lastSummary:N(J.last)},firstLastB:{...nt,firstSummary:N(nt.first),lastSummary:N(nt.last)},aLastCoverage:At(J.last),bLastCoverage:At(nt.last)})};let w=[],y=new Set;if(p){const S=Ye(f.state),T=new Set;S.length||E.info("LegendRenderer","Focus Colours ON but no tonic placements found",null,"grid"),S.forEach(x=>{const _=tM(x.row,i),F=eM(_,x.tonicNumber);E.debug("LegendRenderer","Focus Colours tonic scale",{tonicNote:_,tonicNumber:x.tonicNumber,scaleNotes:F},"grid"),F.forEach(Q=>T.add(Q))}),w=Array.from(T),E.debug("LegendRenderer","Focus Colours combined scale",{focusScale:w},"grid"),y=nM(w)}const I=(S,T=[],x=null)=>{if(h){const W=p&&y.size>0,L=x?sg(x,y):!1;return W&&x&&!L?null:x&&x.frequency?String(x.frequency):S}if(!x){if(!S.includes("/"))return g(S);const W=S.slice(-1),L=S.substring(0,S.length-1),[R,N]=L.split("/");return g(u&&d?`${R}/${N}${W}`:u?`${N}${W}`:d?`${R}${W}`:`${N}${W}`)}const{flatName:_,sharpName:F,isAccidental:Q}=x;if(!Q)return g(_);let U;return u&&d?U=x.pitch:u&&!d?U=F:d&&!u?U=_:U=F,g(U)},B=()=>!u&&!d,C=S=>{S.clearRect(0,0,$e(S.canvas),ie(S.canvas))};function b(S,T,x,_){const F=rs*2*A,Q=[F/2,F/2],U=O_(S.canvas),W=q=>c2(q,U);let L=0,R=0,N=0;x.forEach((q,J)=>{const nt=Q[J]??0;for(let At=s;At<=r;At++){const ot=i[At];if(!(!ot||ot.isDummy)&&ot.column===q){const V=xt(At,e),H=ot.isAccidental??ot.pitch.includes("/"),G=!h&&H&&B(),Y=sg(ot,y),P=I(ot.pitch,_,ot);if(P===null)continue;const st=!!ot.isBoundary;let D=c==="bw"?"#ffffff":ot.hex||"#ffffff";p&&!Y&&!h&&(D="#ffffff");const K=G||st?"00":p&&!Y?"55":"FF";p&&y.size>0&&(N+=1,Y||(R+=1)),S.fillStyle=G?"rgba(255,255,255,0)":D,S.fillRect(L,V-a/2,nt,a);const O=Z_(A,a,P.length,U);S.font=`bold ${O}px 'Atkinson Hyperlegible', sans-serif`,S.textAlign="center",S.textBaseline="middle";const X=W(L+nt/2),tt=W(V);S.strokeStyle=`#212529${K}`,S.lineWidth=Math.max(1.2,2.5/U),S.lineJoin="round",S.strokeText(P,X,tt),S.fillStyle=`#ffffff${K}`,S.fillText(P,X,tt)}}L+=nt}),p&&y.size>0&&E.debug("LegendRenderer","Focus filter summary (separate)",{side:T===0?"left":"right",startCol:T,relevantScale:_,totalLabels:N,filteredLabels:R},"grid")}n&&(C(n),v(n,"left"),b(n,0,["B","A"],w)),t&&(C(t),v(t,"right"),b(t,o.length,["A","B"],w))}const u2={0:{degree:1,alt:0},1:{degree:2,alt:-1},2:{degree:2,alt:0},3:{degree:3,alt:-1},4:{degree:3,alt:0},5:{degree:4,alt:0},6:{degree:5,alt:-1},7:{degree:5,alt:0},8:{degree:6,alt:-1},9:{degree:6,alt:0},10:{degree:7,alt:-1},11:{degree:7,alt:0}};function rM(n){if(Math.abs(n.num)!==8||n.alt>=0)return null;const e=(n.semitones%12+12)%12;return u2[e]||null}function rg(n){if(!n)return null;const t=vT(n);if((t==null?void 0:t.num)===void 0)return null;const e=rM(t);if(e){const a=e.degree,l=e.alt;let c="";return l<0?c="".repeat(Math.abs(l)):l>0&&(c="".repeat(l)),`${c}${a}`}const s=(t.semitones%12+12)%12,r=u2[s];if(!r){const a=Math.abs(t.num),l=t.alt;let c="";return l<0?c="".repeat(Math.abs(l)):l>0&&(c="".repeat(l)),`${c}${a}`}const i=r.degree,o=r.alt;let A="";return o<0?A="".repeat(Math.abs(o)):o>0&&(A="".repeat(o)),`${A}${i}`}function ig(n){return n&&{"1":"2","2":"1","2":"3","3":"2","4":"5","5":"4","5":"6","6":"5","6":"7","7":"6"}[n]||null}function og(n){return!!(n&&(n.includes("")||n.includes("")))}const hd={getEnharmonicDegree:ig,hasAccidental:og,getDegreeForNote(n,t){var u;if(!n||!t)return null;const{keyTonic:e,keyMode:s}=zT(t,n.startColumnIndex);if(!e)return null;const r=n.globalRow??n.row,i=(u=t.fullRowData[r])==null?void 0:u.toneNote;if(!i)return null;const o=rh(i)||i;let A=e;if(t.degreeDisplayMode!=="modal"&&s!=="major"){const p=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"].indexOf(s);if(p>0){const m=["1P","2M","3M","4P","5P","6M","7M"][p];if(m){const g=wT(m);A=xo(e,g)||A}}}const l=Gm(A,o),c=rg(l);if(n.enharmonicPreference&&c&&og(c)){const d=ig(c);if(d)return d}return c},getDegreesForNotes(n,t){return!n||n.length===0?[]:n.map(e=>{const s=rh(e)||e,r=Gm(t,s);return rg(r)}).filter(e=>e!==null)},getRomanNumeralForNotes(n,t){if(!n||n.length<2)return null;const[e]=cT(n);if(!e)return null;const s=IT(e),r=s==null?void 0:s.symbol;if(!r)return null;const[i]=HT(t,[r]);if(!i)return null;const o=sa(i),A=o==null?void 0:o.roman;if(!A)return null;let a=o.name.replace(A,"");const l=(s==null?void 0:s.tonic)||t;return a==="6"&&(a="add6"),{roman:A,ext:a,root:l}}},fh="",ph="",Ic="/",ka=()=>window.animationEffectsManager,mh=()=>f.state.placedNotes,Fc=n=>{const t=n==null?void 0:n.split("-")[1];return Number.parseInt(t??"0",10)};function d2(n){if(!n||typeof n.startColumnIndex!="number"||typeof n.endColumnIndex!="number")return!1;const t=n.shape==="circle"?n.startColumnIndex+1:n.startColumnIndex;return n.endColumnIndex>t}function h2(n,t,e){const{cellWidth:s}=e,r=s*.25,i=n.uuid;if(!i)return 0;const o=t.filter(l=>!l.isDrum&&l.row===n.row&&l.startColumnIndex===n.startColumnIndex&&l.uuid&&l.uuid!==i);if(o.length===0)return 0;const A=[n,...o];return A.sort((l,c)=>Fc(l.uuid)-Fc(c.uuid)),A.findIndex(l=>l.uuid===i)*r}function f2(n,t){var i,o;const{cellHeight:e}=t,s=ka();return(i=s==null?void 0:s.shouldAnimateNote)!=null&&i.call(s,n)?(((o=s.getVibratoYOffset)==null?void 0:o.call(s,n.color))??0)*e:0}function p2(n,t,e){const s=ka(),r=s==null?void 0:s.hasReverbEffect;if(!(typeof r=="function"?r(t.color):!!r))return{shouldApply:!1,blur:0,spread:0};const{cellWidth:o}=e,A=s==null?void 0:s.getReverbEffect,a=typeof A=="function"?A(t.color):void 0;if(!a)return{shouldApply:!1,blur:0,spread:0};const l=a.blur*(o/2),c=a.spread*(o/3);return{shouldApply:l>0||c>0,blur:l,spread:c}}function m2(n,t,e,s,r,i,o){var c,u;const A=ka();if(!((c=A==null?void 0:A.hasDelayEffect)!=null&&c.call(A,t.color)))return;const{cellWidth:a}=e,l=(u=A.getDelayEffects)==null?void 0:u.call(A,t.color);!l||l.length===0||l.forEach((d,p)=>{const h=d.delay/500*a*2,m=s+h,g=i*d.scale,v=o*d.scale;n.save(),n.globalAlpha=d.opacity*.6,n.beginPath(),n.ellipse(m,r,g,v,0,0,2*Math.PI),n.strokeStyle=t.color,n.lineWidth=Math.max(.5,g*.1),n.setLineDash([2,2]),n.stroke(),n.restore()})}function g2(n,t,e,s,r,i){var c,u;const o=ka();if(!((c=o==null?void 0:o.shouldFillNote)!=null&&c.call(o,t)))return;const A=((u=o.getFillLevel)==null?void 0:u.call(o,t))??0;if(A<=0)return;n.save();const a=1-A,l=n.createRadialGradient(e,s,0,e,s,Math.max(r,i));l.addColorStop(0,"transparent"),l.addColorStop(Math.max(0,a-.05),"transparent"),l.addColorStop(a,`${t.color}1F`),l.addColorStop(1,`${t.color}BF`),n.beginPath(),n.ellipse(e,s,r,i,0,0,2*Math.PI),n.clip(),n.fillStyle=l,n.fillRect(e-r-10,s-i-10,(r+10)*2,(i+10)*2),n.restore()}function iM(n,t,e,s,r,i){var p,h;const o=ka();if(!((p=o==null?void 0:o.shouldFillNote)!=null&&p.call(o,t)))return;const A=((h=o.getFillLevel)==null?void 0:h.call(o,t))??0;if(A<=0)return;n.save(),n.beginPath(),n.arc(e,r,i,Math.PI/2,-Math.PI/2,!1),n.lineTo(s,r-i),n.arc(s,r,i,-Math.PI/2,Math.PI/2,!1),n.lineTo(e,r+i),n.closePath(),n.clip();const a=(e+s)/2,l=s-e,c=Math.max(l/2+i,i),u=1-A,d=n.createRadialGradient(a,r,0,a,r,c);d.addColorStop(0,"transparent"),d.addColorStop(Math.max(0,u-.05),"transparent"),d.addColorStop(u,`${t.color}1F`),d.addColorStop(1,`${t.color}BF`),n.fillStyle=d,n.fillRect(e-i-10,r-i-10,l+(i+10)*2,(i+10)*2),n.restore()}function oM(n,t,e,s,r,i,o,A){if(iM(n,t,s,r,i,o),n.save(),n.beginPath(),n.arc(s,i,o,Math.PI/2,-Math.PI/2,!1),n.lineTo(r,i-o),n.arc(r,i,o,-Math.PI/2,Math.PI/2,!1),n.lineTo(s,i+o),n.closePath(),n.strokeStyle=t.color,n.lineWidth=A,n.shadowColor=t.color,n.shadowBlur=oa,n.stroke(),n.shadowBlur=0,n.shadowColor="transparent",n.restore(),e.degreeDisplayMode!=="off"){const a=(s+r)/2;Bp(n,t,e,a,i,o)}}function AM(n,t,e){const{cellHeight:s}=e,r=s/2*.12,i=n.uuid;if(!i)return 0;const o=t.filter(l=>!l.isDrum&&l.row===n.row&&l.startColumnIndex===n.startColumnIndex&&l.uuid&&l.uuid!==i&&d2(l));if(o.length===0)return 0;const A=[n,...o];return A.sort((l,c)=>Fc(l.uuid)-Fc(c.uuid)),A.findIndex(l=>l.uuid===i)*r}function aM(n,t){const e=hd.getDegreeForNote(n,t);if(!e)return{label:null,isAccidental:!1};if(!hd.hasAccidental(e))return{label:e,isAccidental:!1};const r=f.state.accidentalMode||{},i=r.sharp??!0,o=r.flat??!0;if(!i&&!o)return{label:null,isAccidental:!0};let A=e.includes(fh)?e:null,a=e.includes(ph)?e:null;const l=hd.getEnharmonicDegree(e);l&&(l.includes(fh)&&!A&&(A=l),l.includes(ph)&&!a&&(a=l));let c=null;if(i&&o){const u=[];A&&u.push(A),a&&(!A||a!==A)&&u.push(a),c=u.join(Ic),c||(c=e)}else i?c=A||e:o&&(c=a||e);return{label:c,isAccidental:!0}}function lM(n){if(!n)return{multiplier:1,category:"natural"};const t=n.includes(ph),e=n.includes(fh),s=n.includes(Ic);return!t&&!e?{multiplier:1,category:"natural"}:s?{multiplier:.75,category:"both-accidentals"}:{multiplier:.88,category:"single-accidental"}}function Bp(n,t,e,s,r,i,o){const{label:A}=aM(t,e);if(!A)return;const{multiplier:a,category:l}=lM(A);let c;if(t.shape==="circle"){const d=i*2*jT;switch(l){case"natural":c=d;break;case"single-accidental":c=d*.8;break;case"both-accidentals":c=d*.4;break;default:c=d*a}}else{const d=i*2*YT;switch(l){case"natural":c=d*1.5;break;case"single-accidental":c=d*1.2;break;case"both-accidentals":c=d;break;default:c=d*a}}const u=c;if(!(u<JT))if(n.fillStyle="#212529",n.font=`bold ${u}px 'Atkinson Hyperlegible', sans-serif`,n.textAlign="center",n.textBaseline="middle",t.shape==="oval"&&l==="both-accidentals"&&A.includes(Ic)){const d=A.split(Ic),p=u*1.1,h=p*(d.length-1),m=r-h/2;d.forEach((g,v)=>{const w=m+v*p,y=u*.08;n.fillText(g.trim(),s,w+y)})}else{const d=u*.08;n.fillText(A,s,r+d)}}function RA(n,t){return Number.isFinite(n)&&n>0&&Number.isFinite(t)&&t>0}function Cp(n,t,e,s){const{cellWidth:r,cellHeight:i,tempoModulationMarkers:o}=t,A=xt(s,t),a=f2(e,t),l=A+a,c=lt(e.startColumnIndex,t);let u;if(o&&o.length>0?u=lt(e.startColumnIndex+1,t)-c:u=r,!RA(u,i))return;const d=h2(e,mh(),t),p=c+u+d,h=Math.max(ZT,u*t_),m=i/2-h/2,g=d2(e),v=f.state.longNoteStyle||"style1";if(g&&v==="style2"){const I=p,B=lt(e.endColumnIndex,t);if(!RA(B-I,m))return;oM(n,e,t,I,B,l,m,h);return}if(g){const I=lt(e.endColumnIndex+1,t),B=AM(e,mh(),t),C=l+B;n.beginPath(),n.moveTo(p,C),n.lineTo(I,C),n.strokeStyle=e.color,n.lineWidth=Math.max(n_,u*e_),n.stroke()}const w=u-h/2;if(!RA(w,m))return;m2(n,e,t,p,l,w,m),n.save(),g2(n,e,p,l,w,m);const y=p2(n,e,t);y.shouldApply&&(n.shadowColor=e.color,n.shadowBlur=oa+y.blur,n.shadowOffsetX=y.spread),n.beginPath(),n.ellipse(p,l,w,m,0,0,2*Math.PI),n.strokeStyle=e.color,n.lineWidth=h,y.shouldApply||(n.shadowColor=e.color,n.shadowBlur=oa),n.stroke(),n.shadowBlur=0,n.shadowColor="transparent",n.shadowOffsetX=0,n.restore(),t.degreeDisplayMode!=="off"&&Bp(n,e,t,p,l,w)}function bp(n,t,e,s){const{columnWidths:r,cellWidth:i,cellHeight:o,tempoModulationMarkers:A}=t,a=xt(s,t),l=f2(e,t),c=a+l,u=lt(e.startColumnIndex,t);let d;if(A&&A.length>0?d=lt(e.startColumnIndex+1,t)-u:d=((t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:r)[e.startColumnIndex]??0)*i,!RA(d,o))return;const p=h2(e,mh(),t),h=Math.max(.5,d*.15),m=u+d/2+p,g=d/2-h/2,v=o/2-h/2;if(!RA(g,v))return;m2(n,e,t,m,c,g,v),n.save(),g2(n,e,m,c,g,v);const w=p2(n,e,t);w.shouldApply&&(n.shadowColor=e.color,n.shadowBlur=oa+w.blur,n.shadowOffsetX=w.spread),n.beginPath(),n.ellipse(m,c,g,v,0,0,2*Math.PI),n.strokeStyle=e.color,n.lineWidth=h,w.shouldApply||(n.shadowColor=e.color,n.shadowBlur=oa),n.stroke(),n.shadowBlur=0,n.shadowColor="transparent",n.shadowOffsetX=0,n.restore(),t.degreeDisplayMode!=="off"&&Bp(n,e,t,m,c,g)}function v2(n,t,e){const{cellWidth:s,cellHeight:r,tempoModulationMarkers:i}=t,o=xt(e.globalRow??e.row,t);let A=e.columnIndex;if(e.uuid){const g=Ne.getColumnMap(f.state).entries.find(v=>v.type==="tonic"&&v.tonicSignUuid===e.uuid&&typeof v.canvasIndex=="number");g&&typeof g.canvasIndex=="number"&&(A=g.canvasIndex)}const a=lt(A,t);let l;i&&i.length>0?l=lt(A+1,t)-a:l=s;const c=l*2,u=a+c/2,d=Math.min(c,r)/2*.9;if(d<2||(n.beginPath(),n.arc(u,o,d,0,2*Math.PI),n.strokeStyle="#212529",n.lineWidth=Math.max(.5,l*.05),n.stroke(),e.tonicNumber==null))return;const p=e.tonicNumber.toString(),h=d*1.5;h<6||(n.fillStyle="#212529",n.font=`bold ${h}px 'Atkinson Hyperlegible', sans-serif`,n.textAlign="center",n.textBaseline="middle",n.fillText(p,u,o))}const gh=[{id:1,diamonds:[0],ovals:[],label:"left 8th"},{id:2,diamonds:[1],ovals:[],label:"e"},{id:3,diamonds:[2],ovals:[],label:"right 8th"},{id:4,diamonds:[3],ovals:[],label:"a"},{id:5,diamonds:[0,1],ovals:[],label:"1 e"},{id:6,diamonds:[1,2],ovals:[],label:"e &"},{id:7,diamonds:[2,3],ovals:[],label:"& a"},{id:8,diamonds:[0,2],ovals:[],label:"two 8ths"},{id:9,diamonds:[1,3],ovals:[],label:"e a"},{id:10,diamonds:[0,1,2],ovals:[],label:"1 e + right 8th"},{id:11,diamonds:[1,2,3],ovals:[],label:"e & a"},{id:12,diamonds:[0,1,3],ovals:[],label:"1 e a"},{id:13,diamonds:[0,2,3],ovals:[],label:"left 8th + & a"},{id:14,diamonds:[0,3],ovals:[],label:"left 8th + a"},{id:15,diamonds:[0,1,2,3],ovals:[],label:"1 e & a"}];function Iu(n){return gh.find(t=>t.id===n)}function Ag(n,t,e,s){const r=Math.sqrt(3)/2*e,i=Math.max(1,s-2*r),o=t-(i/2+r),A=o+r,a=A+i,l=a+r,c=n-e/2,u=n+e/2;return`M ${[`${n},${o}`,`${c},${A}`,`${c},${a}`,`${n},${l}`,`${u},${a}`,`${u},${A}`].join(" ")} Z`.replace(/,/g," ")}class cM{constructor(t={}){M(this,"options");this.options={diamondW:30,diamondH:120,ovalRx:30,ovalRy:60,strokeWidth:2,...t}}renderToCanvas(t,e,s,r,i,o,A="#000",a=null,l=null){const c=i/100*.8,u=o/100*.8,d=this.options.diamondW*c,p=this.options.diamondH*u,h=this.options.ovalRx*c,m=this.options.ovalRy*u,g=[.125,.375,.625,.875].map(w=>s+w*i),v=r+o/2;t.save(),t.strokeStyle=A,t.fillStyle=A,t.lineWidth=this.options.strokeWidth,t.lineCap="round",t.lineJoin="round",e.ovals.forEach(w=>{var B;const y=w===0?s+.25*i:s+.75*i;let I=v;if(a&&l){const C=`oval_${w}`,b=((B=a.shapeOffsets)==null?void 0:B[C])||0,S=a.row+b;I=l(S)}t.beginPath(),t.ellipse(y,I,h,m,0,0,Math.PI*2),t.stroke()}),e.diamonds.forEach(w=>{var b;const y=g[w];if(y===void 0)return;let I=v;if(a&&l){const S=`diamond_${w}`,T=((b=a.shapeOffsets)==null?void 0:b[S])||0,x=a.row+T;I=l(x)}const B=Ag(y,I,d,p),C=new Path2D(B);t.stroke(C)}),t.restore()}renderToSVG(t,e=100,s=100){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox",`0 0 ${e} ${s}`),r.style.color="#000000";const i=Math.min(e/100,s/100)*.8,o=this.options.diamondW*i,A=this.options.diamondH*i,a=this.options.ovalRx*i,l=this.options.ovalRy*i,c=[12.5,37.5,62.5,87.5],u=s/2;return t.ovals.forEach(d=>{const p=d===0?25:75,h=document.createElementNS("http://www.w3.org/2000/svg","ellipse");h.setAttribute("cx",String(p)),h.setAttribute("cy",String(u)),h.setAttribute("rx",String(a)),h.setAttribute("ry",String(l)),h.setAttribute("fill","none"),h.setAttribute("stroke","currentColor"),h.setAttribute("stroke-width",String(this.options.strokeWidth*2)),h.setAttribute("stroke-linecap","round"),r.appendChild(h)}),t.diamonds.forEach(d=>{const p=c[d];if(p===void 0)return;const h=Ag(p,u,o,A),m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",h),m.setAttribute("fill","none"),m.setAttribute("stroke","currentColor"),m.setAttribute("stroke-width",String(this.options.strokeWidth*2)),m.setAttribute("stroke-linejoin","round"),m.setAttribute("stroke-linecap","round"),r.appendChild(m)}),r}}const yp=new cM;E.moduleLoaded("SixteenthStampRenderer","stamps");function uM(n,t){var s,r;const e=((s=f.getAllSixteenthStampPlacements)==null?void 0:s.call(f))??((r=f.state)==null?void 0:r.sixteenthStampPlacements)??[];e.length!==0&&(E.debug("SixteenthStampRenderer",`Rendering ${e.length} stamps`,{count:e.length},"stamps"),e.forEach(i=>{dM(n,i,t)}))}function dM(n,t,e){const s=Iu(t.sixteenthStampId);if(!s)return;const{startColumn:r,row:i,color:o}=t,A=f.state,a=lt(r,e),c=xt(i,e)-e.cellHeight/2,u=Yr(r,A);let d;if(u!==null){const w=u+2;d=Cn(w,A)}else d=r+2;const h=lt(d,e)-a,m=e.cellHeight,g=$e(n.canvas);if(a+h<0||a>g)return;const v=w=>xt(w,e);yp.renderToCanvas(n,s,a,c,h,m,o,t,v),n.save(),n.globalAlpha=.1,n.fillStyle=o,n.fillRect(a+1,c+1,h-2,m-2),n.restore(),E.debug("SixteenthStampRenderer",`Rendered stamp ${t.sixteenthStampId} at ${r}-${d},${i}`,{sixteenthStampId:t.sixteenthStampId,startColumn:r,effectiveEndColumn:d,row:i,stampX:a,stampY:c,hasOffsets:!!t.shapeOffsets},"stamps")}function hM(n,t,e,s,r){if(!s)return;const i=f.state,o=lt(t,r),a=xt(e,r)-r.cellHeight/2,l=Yr(t,i);let c;if(l!==null){const h=l+2;c=Cn(h,i)}else c=t+2;const d=lt(c,r)-o,p=r.cellHeight;n.save(),n.globalAlpha=.6,yp.renderToCanvas(n,s,o,a,d,p,r.previewColor||"#4a90e2"),n.restore()}function ag(n,t,e){return[{id:t+0,span:n,hits:[0],label:`${e} [1]`},{id:t+1,span:n,hits:[1],label:`${e} [2]`},{id:t+2,span:n,hits:[2],label:`${e} [3]`},{id:t+3,span:n,hits:[0,1],label:`${e} [1 2]`},{id:t+4,span:n,hits:[1,2],label:`${e} [2 3]`},{id:t+5,span:n,hits:[0,2],label:`${e} [1 3]`},{id:t+6,span:n,hits:[0,1,2],label:`${e} [1 2 3]`}]}const $l=[...ag("eighth",1,"8th triplet"),...ag("quarter",8,"Quarter triplet")],w2={eighth:1,quarter:2},B2=[16.6667,50,83.3333];function Fu(n){return $l.find(t=>t.id===n)}E.moduleLoaded("TripletStampRenderer","triplets");function fM(n,t){var s,r;const e=((s=f.getAllTripletStampPlacements)==null?void 0:s.call(f))??((r=f.state)==null?void 0:r.tripletStampPlacements)??[];e.length!==0&&(E.debug("TripletStampRenderer",`Rendering ${e.length} triplet groups`,{count:e.length},"triplets"),e.forEach(i=>{pM(n,i,t)}))}function pM(n,t,e){const s=Fu(t.tripletStampId);if(!s)return;const{startTimeIndex:r,span:i,row:o,color:A}=t,a=i*2,l=Cn(r,f.state),c=l+a,u=lt(l,e),d=xt(o,e),p=d-e.cellHeight/2,m=lt(c,e)-u,g=e.cellHeight,v=$e(n.canvas);if(u+m<0||u>v)return;C2(n,s,u,d,m,g,A,t,y=>xt(y,e)),n.save(),n.globalAlpha=.1,n.fillStyle=A,n.fillRect(u+1,p+1,m-2,g-2),n.restore()}function C2(n,t,e,s,r,i,o,A=null,a=null){const l=r/100*.8,c=i/100*.8,u=Math.max(1,3*c);t.hits.forEach(d=>{var g;const p=B2[d]??50,h=e+r*p/100;let m=s;if(A&&a){const v=`triplet_${d}`,w=((g=A.shapeOffsets)==null?void 0:g[v])||0,y=A.row+w;m=a(y),w!==0&&E.debug("TripletStampRenderer","Drawing notehead with offset",{slot:d,shapeKey:v,rowOffset:w,baseRow:A.row,shapeRow:y,y:m},"triplets")}mM(n,h,m,o,u,l,c)})}function mM(n,t,e,s="currentColor",r=4,i=1,o=1){const A=20*i,a=60*o;n.strokeStyle=s,n.lineWidth=r,n.fillStyle="none",n.beginPath(),n.ellipse(t,e,A,a,0,0,2*Math.PI),n.stroke()}function gM(n,t,e,s,r){if(!s)return;const o=(s.span==="eighth"?1:2)*2,A=Cn(t,f.state),a=lt(A,r),l=xt(e,r),c=A+o,d=lt(c,r)-a,p=r.cellHeight;n.save(),n.globalAlpha=.6;const h=r.previewColor||"#4a90e2";C2(n,s,a,l,d,p,h),n.restore()}function vM(n,t){if(n===0)return lt(0,t);const e=n-1,s=mn(f.state,e);return s?lt(s.endColumn+1,t):(E.warn("ModulationRenderer","Could not find measure info for index",{measureIndex:n},"grid"),n*200)}function b2(n,t){const{tempoModulationMarkers:e}=t;if(!e||e.length===0)return;const s=e.filter(i=>i.active).map(i=>{let o;if(i.columnIndex!==null&&i.columnIndex!==void 0)o=lt(i.columnIndex+1,t);else if(i.macrobeatIndex!==null&&i.macrobeatIndex!==void 0&&i.macrobeatIndex>=0){const A=mn(f.state,i.macrobeatIndex);A?o=lt(A.endColumn+1,t):(E.warn("ModulationRenderer","Could not find macrobeat info for index",{macrobeatIndex:i.macrobeatIndex},"grid"),o=i.xPosition??0)}else i.measureIndex!==null&&i.measureIndex!==void 0?o=vM(i.measureIndex,t):o=i.xPosition??0;return{...i,xCanvas:o}});n.save();const r=t.showModulationLabel!==!1;s.forEach(i=>{wM(n,i,r)}),n.restore()}function wM(n,t,e){const s=t.xCanvas,r=t.ratio,i=Yw(r),o=Xw(r);BM(n,s,i),e&&CM(n,s,o,i)}function BM(n,t,e){const r=ie(n.canvas);n.beginPath(),n.moveTo(t,0),n.lineTo(t,r),n.lineWidth=3,n.strokeStyle=e,n.setLineDash([]),n.stroke()}function CM(n,t,e,s){const i="Arial, sans-serif";n.font=`14px ${i}`,n.textAlign="center",n.textBaseline="middle";const c=n.measureText(e).width,u=14,d=c+12,p=u+12,h=t-d/2,m=20;bM(n,h,m,d,p,8,s),n.fillStyle="#212529",n.fillText(e,t,m+p/2)}function bM(n,t,e,s,r,i,o){n.beginPath(),n.moveTo(t+i,e),n.lineTo(t+s-i,e),n.quadraticCurveTo(t+s,e,t+s,e+i),n.lineTo(t+s,e+r-i),n.quadraticCurveTo(t+s,e+r,t+s-i,e+r),n.lineTo(t+i,e+r),n.quadraticCurveTo(t,e+r,t,e+r-i),n.lineTo(t,e+i),n.quadraticCurveTo(t,e,t+i,e),n.closePath(),n.fillStyle=o,n.fill(),n.strokeStyle="rgba(0, 0, 0, 0.2)",n.lineWidth=1,n.stroke()}function lg(n,t,e){const{xCanvas:s}=e,r=6,i=40;return Math.abs(n-s)<=r/2?t<=i?{marker:e,type:"label",canDrag:!1}:{marker:e,type:"barline",canDrag:!0}:null}function cg(n){if(!n)return"default";switch(n.type){case"label":return"pointer";case"barline":return n.canDrag?"ew-resize":"pointer";default:return"default"}}function os(n){return n.x??n.col??0}function As(n){return n.y??n.row??0}function la(n,t){if(!t||t.length<3)return!1;const e=os(n),s=As(n);let r=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const A=os(t[i]),a=As(t[i]),l=os(t[o]),c=As(t[o]);a>s!=c>s&&e<(l-A)*(s-a)/(c-a)+A&&(r=!r)}return r}function yM(n){if(!n||n.length<3)return n;const t=n.map(i=>({x:os(i),y:As(i)}));if(t.length===0)return[];let e=t[0];for(let i=1;i<t.length;i++){const o=t[i];(o.y<e.y||o.y===e.y&&o.x<e.x)&&(e=o)}const s=t.filter(i=>i!==e);if(s.sort((i,o)=>{const A=Math.atan2(i.y-e.y,i.x-e.x),a=Math.atan2(o.y-e.y,o.x-e.x);if(A!==a)return A-a;const l=Math.hypot(i.x-e.x,i.y-e.y),c=Math.hypot(o.x-e.x,o.y-e.y);return l-c}),s.length===0)return[e];const r=[e,s[0]];for(let i=1;i<s.length;i++){const o=s[i];for(;r.length>1&&!SM(r[r.length-2],r[r.length-1],o);)r.pop();r.push(o)}return r}function SM(n,t,e){const s=os(n),r=As(n),i=os(t),o=As(t),A=os(e),a=As(e);return(i-s)*(a-r)-(o-r)*(A-s)>0}function EM(n,t,e,s=10){const r=os(n),i=As(n),o=os(t),A=As(t),a=os(e),l=As(e),c=a-o,u=l-A,d=c*c+u*u;if(d===0)return Math.hypot(r-o,i-A)<=s;let p=((r-o)*c+(i-A)*u)/d;p=Math.max(0,Math.min(1,p));const h=o+p*c,m=A+p*u;return Math.hypot(r-h,i-m)<=s}function ug(n,t,e=10){if(!t||t.length<2)return!1;for(let s=0;s<t.length;s++){const r=t[s],i=t[(s+1)%t.length];if(EM(n,r,i,e))return!0}return!1}function xM(n,t){const{centerX:e,centerY:s,rx:r,ry:i}=t,o=16;for(let A=0;A<o;A++){const a=A/o*2*Math.PI,l=e+r*Math.cos(a),c=s+i*Math.sin(a);if(la({x:l,y:c},n))return!0}return!!la({x:e,y:s},n)}function dg(n,t){const{x:e,y:s,width:r,height:i}=t,o=[{x:e,y:s},{x:e+r,y:s},{x:e+r,y:s+i},{x:e,y:s+i}];for(const A of o)if(la(A,n))return!0;for(const A of n){const a=os(A),l=As(A);if(a>=e&&a<=e+r&&l>=s&&l<=s+i)return!0}return!1}function y2(n,t,e,s,r,i){const o=r-e,A=i-s,a=o*o+A*A;if(a===0){const h=n-e,m=t-s;return Math.sqrt(h*h+m*m)}let l=((n-e)*o+(t-s)*A)/a;l=Math.max(0,Math.min(1,l));const c=e+l*o,u=s+l*A,d=n-c,p=t-u;return Math.sqrt(d*d+p*p)}function IM(n){const{x:t,y:e,annotations:s,getRenderOptions:r}=n,i=10;let o=!1;const A=r();return{nextAnnotations:s.filter(l=>{let c=!0;if(l.type==="arrow"){const u=lt(l.startCol,A),d=xt(l.startRow,A),p=lt(l.endCol,A),h=xt(l.endRow,A);y2(t,e,u,d,p,h)<i&&(c=!1,o=!0)}else if(l.type==="text"){const u=lt(l.col,A),d=xt(l.row,A),p=lt(l.col+l.widthCols,A),h=xt(l.row+l.heightRows,A);t>=u&&t<=p&&e>=d&&e<=h&&(c=!1,o=!0)}else if(l.type==="marker"||l.type==="highlighter")for(let u=0;u<l.path.length;u++){const d=lt(l.path[u].col,A),p=xt(l.path[u].row,A),h=t-d,m=e-p;if(Math.sqrt(h*h+m*m)<i){c=!1,o=!0;break}}return c}),changed:o}}function FM(n){const{lassoPath:t,state:e,renderOptions:s,isAdditive:r,existingSelectedItems:i}=n,o=[];r&&Array.isArray(i)&&o.push(...i),e.placedNotes.forEach((a,l)=>{if(a.isDrum)return;const c=a.startColumnIndex,u=lt(c,s),d=xt(a.row,s),{cellWidth:p,cellHeight:h}=s;let m=p;s.tempoModulationMarkers&&s.tempoModulationMarkers.length>0&&(m=lt(c+1,s)-u);const g=a.shape==="oval"?u+m:u+m/2,v=d,w=a.shape==="oval"?m:m/2,y=h/2;if(xM(t,{centerX:g,centerY:v,rx:w,ry:y})){const I=`note-${a.row}-${c}-${a.color}-${a.shape}`;o.find(B=>B.id===I)||o.push({type:"note",id:I,data:a,index:l})}}),e.sixteenthStampPlacements.forEach((a,l)=>{const{cellWidth:c,cellHeight:u}=s,d=lt(a.startColumn,s),p=xt(a.row,s)-u/2,h=c*2;if(dg(t,{x:d,y:p,width:h,height:u})){const g=`sixteenth-stamp-${a.row}-${a.startColumn}-${a.sixteenthStampId}`;o.find(v=>v.id===g)||o.push({type:"sixteenthStamp",id:g,data:a,index:l})}}),e.tripletStampPlacements.forEach((a,l)=>{const{cellHeight:c}=s,u=Cn(a.startTimeIndex,e),d=u+a.span*2,p=lt(u,s),h=lt(d,s)-p,m=xt(a.row,s)-c/2;if(dg(t,{x:p,y:m,width:h,height:c})){const v=`triplet-stamp-${a.row}-${u}-${a.tripletStampId}`;o.find(w=>w.id===v)||o.push({type:"tripletStamp",id:v,data:a,index:l})}});const A=ca({selectedItems:o,renderOptions:s,state:e});return{selectedItems:o,convexHull:A,isActive:o.length>0}}function ca(n){const{selectedItems:t,renderOptions:e,state:s}=n;if(!t.length)return null;const r=s??f.state,i=t.map(o=>{const A=o.type==="note"?o.data.startColumnIndex:o.type==="sixteenthStamp"?o.data.startColumn:Cn(o.data.startTimeIndex,r),a=lt(A,e),l=xt(o.data.row,e);return{x:a,y:l}});return yM(i)}function TM(n){const{canvasX:t,canvasY:e,state:s,renderOptions:r,selection:i}=n;if(!(i!=null&&i.isActive))return null;const o=n.thresholdPx??15;let A=null;if(s.placedNotes.forEach(c=>{const u=c.startColumnIndex,d=lt(u,r),p=xt(c.row,r);Math.hypot(t-d,e-p)<=o&&(A=`note-${c.row}-${u}-${c.color}-${c.shape}`)}),A||s.sixteenthStampPlacements.forEach(c=>{const u=c.startColumn+1,d=lt(u,r),p=xt(c.row,r);Math.hypot(t-d,e-p)<=o&&(A=`sixteenth-stamp-${c.row}-${c.startColumn}-${c.sixteenthStampId}`)}),A||s.tripletStampPlacements.forEach(c=>{const u=Cn(c.startTimeIndex,s),d=u+c.span,p=lt(d,r),h=xt(c.row,r);Math.hypot(t-p,e-h)<=o&&(A=`triplet-stamp-${c.row}-${u}-${c.tripletStampId}`)}),!A)return null;const a=i.selectedItems.filter(c=>c.id!==A),l=ca({selectedItems:a,renderOptions:r});return{nextSelection:{selectedItems:a,convexHull:l,isActive:a.length>0},changed:!0}}function _M(n){const{selection:t,selectionDragStart:e,selectionDragTotal:s,currentPointerGrid:r,initialDragStartRank:i,currentStartRank:o,renderOptions:A}=n,a=i!==null?o-i:0,l=r.row-a,c=Math.round(r.col-e.col),u=Math.round(l-e.row),d={col:c-s.col,row:u-s.row};if(d.col===0&&d.row===0)return{moved:!1,nextSelectionDragTotal:s,nextConvexHull:t.convexHull};const p=(v,w)=>typeof w=="number"?w:v,h=(v,w)=>{var B;const y=((B=f.state.columnWidths)==null?void 0:B.length)??0;let I=v;for(;I>=0&&I<y;){const C=Yr(I,f.state);if(C!==null)return C;I+=w}return null};t.selectedItems.forEach(v=>{if(v.type==="note"){const y=p(v.data.row,v.data.globalRow)+d.row;v.data.globalRow=y,v.data.row=y,v.data.startColumnIndex=v.data.startColumnIndex+d.col,v.data.endColumnIndex=v.data.endColumnIndex+d.col}else if(v.type==="sixteenthStamp"){const y=p(v.data.row,v.data.globalRow)+d.row;v.data.globalRow=y,v.data.row=y,v.data.startColumn=v.data.startColumn+d.col,v.data.endColumn=v.data.endColumn+d.col}else if(v.type==="tripletStamp"){const y=p(v.data.row,v.data.globalRow)+d.row;if(v.data.globalRow=y,v.data.row=y,d.col!==0){const B=Cn(v.data.startTimeIndex,f.state)+d.col,C=Math.sign(d.col)||1,b=h(B,C);b!==null&&(v.data.startTimeIndex=b)}}});const m={col:c,row:u},g=ca({selectedItems:t.selectedItems,renderOptions:A,state:f.state});return t.convexHull=g,{moved:!0,nextSelectionDragTotal:m,nextConvexHull:g}}function MM(n){const{ctx:t,annotation:e,isTemp:s=!1,isSelected:r=!1,isHovered:i=!1,getStrokeWidth:o,getLineDash:A}=n,{startX:a,startY:l,endX:c,endY:u,settings:d}=e;t.save(),r&&(t.strokeStyle="#4a90e2",t.lineWidth=o(d.strokeWeight)+4,t.globalAlpha=.3,t.setLineDash([]),t.beginPath(),t.moveTo(a,l),t.lineTo(c,u),t.stroke(),t.globalAlpha=1),i&&!r&&(t.strokeStyle="#4a90e2",t.lineWidth=o(d.strokeWeight)+4,t.globalAlpha=.15,t.setLineDash([]),t.beginPath(),t.moveTo(a,l),t.lineTo(c,u),t.stroke(),t.globalAlpha=1),t.strokeStyle=s?"rgba(0, 0, 0, 0.5)":"#000000",t.lineWidth=o(d.strokeWeight),t.setLineDash(A(d.lineStyle));const p=Math.atan2(u-l,c-a),h=d.arrowheadSize||12;let m=a,g=l,v=c,w=u;d.startArrowhead!=="none"&&(m=a+Math.cos(p)*h,g=l+Math.sin(p)*h),d.endArrowhead!=="none"&&(v=c-Math.cos(p)*h,w=u-Math.sin(p)*h),t.beginPath(),t.moveTo(m,g),t.lineTo(v,w),t.stroke(),d.startArrowhead!=="none"&&hg({ctx:t,x:a,y:l,angle:p+Math.PI,type:d.startArrowhead,size:h}),d.endArrowhead!=="none"&&hg({ctx:t,x:c,y:u,angle:p,type:d.endArrowhead,size:h}),t.restore()}function hg(n){const{ctx:t,x:e,y:s,angle:r,type:i,size:o}=n;switch(t.save(),t.translate(e,s),t.rotate(r),t.setLineDash([]),i){case"filled":case"filled-arrow":t.beginPath(),t.moveTo(0,0),t.lineTo(-o,-o/2),t.lineTo(-o,o/2),t.closePath(),t.fillStyle=t.strokeStyle,t.fill();break;case"unfilled":case"unfilled-arrow":t.beginPath(),t.moveTo(0,0),t.lineTo(-o,-o/2),t.lineTo(-o,o/2),t.closePath(),t.stroke();break;case"circle":t.beginPath(),t.arc(0,0,o/3,0,Math.PI*2),t.fillStyle=t.strokeStyle,t.fill();break}t.restore()}E.moduleLoaded("AnnotationService","annotation");class QM{constructor(){M(this,"canvas");M(this,"ctx");M(this,"currentTool");M(this,"toolSettings");M(this,"tempEraserMode");M(this,"isDrawing");M(this,"currentPath");M(this,"startPoint");M(this,"tempAnnotation");M(this,"selectedAnnotation");M(this,"hoverAnnotation");M(this,"eraserCursor");M(this,"isDragging");M(this,"dragOffset");M(this,"isResizing");M(this,"resizeHandle");M(this,"resizeStartBounds");M(this,"isDraggingSelection");M(this,"selectionDragStart");M(this,"selectionDragTotal");M(this,"lastPointerPosition");M(this,"initialDragStartRank");this.toolSettings=null,this.tempEraserMode=!1,this.currentTool=null,this.isDrawing=!1,this.currentPath=[],this.startPoint=null,this.tempAnnotation=null,this.selectedAnnotation=null,this.hoverAnnotation=null,this.eraserCursor=null,this.isDragging=!1,this.dragOffset=null,this.isResizing=!1,this.resizeHandle=null,this.resizeStartBounds=null,this.isDraggingSelection=!1,this.selectionDragStart=null,this.selectionDragTotal=null,this.lastPointerPosition=null,this.initialDragStartRank=null}initialize(){const t=document.getElementById("notation-grid");if(!(t instanceof HTMLCanvasElement)){E.error("AnnotationService","Pitch grid canvas not found",null,"annotation");return}const e=t.getContext("2d");if(!e){E.error("AnnotationService","Pitch grid context not available",null,"annotation");return}this.canvas=t,this.ctx=e,this.setupEventListeners(),f.on("annotationsChanged",()=>{this.selectedAnnotation=null,this.render()}),f.on("scrollByUnits",s=>{typeof s=="number"&&this.handleSelectionScroll(s)}),E.initSuccess("AnnotationService")}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("dblclick",this.handleDoubleClick.bind(this)),this.canvas.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),this.canvas.addEventListener("contextmenu",t=>t.preventDefault()),this.registerScrollSyncTarget(document.getElementById("pitch-grid-wrapper")),this.registerScrollSyncTarget(document.getElementById("canvas-container")),window.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}),window.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),document.addEventListener("keydown",this.handleKeyDown.bind(this))}handleKeyDown(t){if(!this.selectedAnnotation)return;const e=document.activeElement;if(e instanceof HTMLElement){const s=e.isContentEditable,r=e.tagName.toLowerCase();if(["input","textarea"].includes(r)||s)return}(t.key==="Delete"||t.key==="Backspace")&&(t.preventDefault(),this.deleteSelectedAnnotation())}deleteSelectedAnnotation(){if(!this.selectedAnnotation)return;const t=f.state.annotations.indexOf(this.selectedAnnotation);t>-1&&(f.state.annotations.splice(t,1),this.selectedAnnotation=null,f.recordState(),this.render(),E.log("AnnotationService","Deleted annotation","annotation"))}resize(){const t=document.getElementById("notation-grid");t instanceof HTMLCanvasElement&&(this.canvas.width=t.width,this.canvas.height=t.height,this.render())}getRenderOptions(){return{columnWidths:f.state.columnWidths,cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth}}canvasToGrid(t,e){const s=this.getRenderOptions();return{col:dh(t,s),row:R_(e,s)}}canvasToGridFresh(t,e){const s=this.getRenderOptions(),r=qe.getViewportInfo(),i=s.cellHeight/2;return{col:dh(t,s),row:e/i+r.startRank-1}}gridToCanvas(t,e){const s=this.getRenderOptions();return{x:lt(t,s),y:xt(e,s)}}setTool(t,e){if(this.currentTool=t,this.toolSettings=e,this.canvas)switch(t){case"arrow":case"text":this.canvas.style.cursor="crosshair";break;case"marker":case"highlighter":this.canvas.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><circle cx='8' cy='8' r='4' fill='rgba(0,0,0,0.5)'/></svg>") 8 8, crosshair`;break;case"lasso":this.canvas.style.cursor="crosshair";break;default:this.canvas.style.cursor="default"}}handleMouseDown(t){var A,a,l;if(!this.currentTool||!this.toolSettings)return;const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top;this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY};const i=this.canvasToGridFresh(s,r);if(t.button===2){if(this.currentTool==="lasso"&&((A=f.state.lassoSelection)!=null&&A.isActive)){this.removeFromLassoSelection(s,r);return}this.tempEraserMode=!0,this.isDrawing=!0,this.eraseAtPoint(s,r),this.showEraserCursor(s,r);return}if(((a=this.selectedAnnotation)==null?void 0:a.type)==="text"){const c=this.getResizeHandleAt(s,r,this.selectedAnnotation);if(c){this.isResizing=!0,this.resizeHandle=c,this.resizeStartBounds={col:this.selectedAnnotation.col,row:this.selectedAnnotation.row,widthCols:this.selectedAnnotation.widthCols,heightRows:this.selectedAnnotation.heightRows,mouseCol:i.col,mouseRow:i.row};return}}if((l=f.state.lassoSelection)!=null&&l.isActive&&f.state.lassoSelection.convexHull){const c=ug({x:s,y:r},f.state.lassoSelection.convexHull,10),u=la({x:s,y:r},f.state.lassoSelection.convexHull);if(c||u){this.isDraggingSelection=!0,this.selectionDragStart={col:i.col,row:i.row},this.selectionDragTotal={col:0,row:0},this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY},this.initialDragStartRank=qe.getViewportInfo().startRank;return}}const o=this.getAnnotationAt(s,r);if(o&&(o.type==="arrow"||o.type==="text")){if(this.selectedAnnotation===o){this.isDragging=!0,o.type==="arrow"?this.dragOffset={startCol:i.col-o.startCol,startRow:i.row-o.startRow,endCol:i.col-o.endCol,endRow:i.row-o.endRow}:o.type==="text"&&(this.dragOffset={col:i.col-o.col,row:i.row-o.row});return}if(this.currentTool==="text"&&o.type==="text"){this.editTextAnnotation(o);return}this.selectedAnnotation=o,this.loadAnnotationSettings(o),this.render();return}else this.selectedAnnotation=null;switch(this.isDrawing=!0,this.startPoint=i,this.currentPath=[i],this.currentTool){case"arrow":this.tempAnnotation={type:"arrow",startCol:i.col,startRow:i.row,endCol:i.col,endRow:i.row,settings:{...this.toolSettings.arrow}};break;case"text":this.tempAnnotation={type:"text",startCol:i.col,startRow:i.row,endCol:i.col,endRow:i.row};break;case"marker":case"highlighter":this.tempAnnotation={type:this.currentTool,path:[i],settings:{...this.toolSettings[this.currentTool]}};break;case"lasso":this.tempAnnotation={type:"lasso",path:[{x:s,y:r}]};break}}handleMouseMove(t){var o;const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top;this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY};const i=this.canvasToGridFresh(s,r);if(this.tempEraserMode){this.eraseAtPoint(s,r),this.showEraserCursor(s,r);return}if(this.isResizing&&((o=this.selectedAnnotation)==null?void 0:o.type)==="text"){if(!this.resizeHandle||!this.resizeStartBounds)return;const A=i.col-this.resizeStartBounds.mouseCol,a=i.row-this.resizeStartBounds.mouseRow;let l=this.resizeStartBounds.col,c=this.resizeStartBounds.row,u=this.resizeStartBounds.widthCols,d=this.resizeStartBounds.heightRows;this.resizeHandle.includes("n")&&(c=this.resizeStartBounds.row+a,d=this.resizeStartBounds.heightRows-a),this.resizeHandle.includes("s")&&(d=this.resizeStartBounds.heightRows+a),this.resizeHandle.includes("w")&&(l=this.resizeStartBounds.col+A,u=this.resizeStartBounds.widthCols-A),this.resizeHandle.includes("e")&&(u=this.resizeStartBounds.widthCols+A);const p=2,h=1;u<p&&(this.resizeHandle.includes("w")&&(l=this.resizeStartBounds.col+this.resizeStartBounds.widthCols-p),u=p),d<h&&(this.resizeHandle.includes("n")&&(c=this.resizeStartBounds.row+this.resizeStartBounds.heightRows-h),d=h),this.selectedAnnotation.col=l,this.selectedAnnotation.row=c,this.selectedAnnotation.widthCols=u,this.selectedAnnotation.heightRows=d,this.render();return}if(this.isDraggingSelection&&this.selectionDragStart&&this.selectionDragTotal){this.applySelectionDrag(s,r);return}if(this.isDragging&&this.selectedAnnotation){this.selectedAnnotation.type==="arrow"?(this.selectedAnnotation.startCol=i.col-this.dragOffset.startCol,this.selectedAnnotation.startRow=i.row-this.dragOffset.startRow,this.selectedAnnotation.endCol=i.col-this.dragOffset.endCol,this.selectedAnnotation.endRow=i.row-this.dragOffset.endRow):this.selectedAnnotation.type==="text"&&(this.selectedAnnotation.col=i.col-this.dragOffset.col,this.selectedAnnotation.row=i.row-this.dragOffset.row),this.render();return}if(!this.isDrawing){this.updateHover(s,r);return}if(this.tempAnnotation)switch(this.currentTool){case"arrow":this.tempAnnotation.endCol=i.col,this.tempAnnotation.endRow=i.row,this.render();break;case"text":this.tempAnnotation.endCol=i.col,this.tempAnnotation.endRow=i.row,this.render();break;case"marker":case"highlighter":if(this.tempAnnotation.path.length>0){const A=this.tempAnnotation.path[this.tempAnnotation.path.length-1],a=this.interpolatePoints(A,i);this.tempAnnotation.path.push(...a)}else this.tempAnnotation.path.push(i);this.render();break;case"lasso":this.tempAnnotation.path.push({x:s,y:r}),this.render();break}}handleMouseUp(t){if(this.isResizing){this.isResizing=!1,this.resizeHandle=null,this.resizeStartBounds=null,f.recordState();return}if(this.isDraggingSelection){this.isDraggingSelection=!1,this.selectionDragStart=null,this.selectionDragTotal=null,this.lastPointerPosition=null,this.initialDragStartRank=null,f.recordState();return}if(this.isDragging){this.isDragging=!1,this.dragOffset=null,f.recordState();return}if(this.isDrawing){if(this.isDrawing=!1,this.tempEraserMode){this.tempEraserMode=!1,this.render();return}if(this.tempAnnotation){if(this.currentTool==="text"){const{startCol:e,startRow:s,endCol:r,endRow:i}=this.tempAnnotation,o=Math.abs(r-e),A=Math.abs(i-s),a=Math.min(e,r),l=Math.min(s,i);o>.5&&A>.2?this.createTextAnnotation(a,l,o,A):this.createTextAnnotation(e,s,8,2),this.tempAnnotation=null,this.render();return}this.currentTool==="lasso"?this.handleLassoSelection(t.shiftKey):(f.state.annotations.push(this.tempAnnotation),this.currentTool==="arrow"&&(this.selectedAnnotation=this.tempAnnotation),f.recordState()),this.tempAnnotation=null,this.render()}}}handleWheel(t){!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal||((t.clientX!==0||t.clientY!==0)&&(this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY}),requestAnimationFrame(()=>this.applySelectionDragFromLastPointer()))}handleScroll(){!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal||requestAnimationFrame(()=>this.applySelectionDragFromLastPointer())}applySelectionDragFromLastPointer(){if(!this.canvas||!this.lastPointerPosition)return;const t=this.canvas.getBoundingClientRect(),e=this.lastPointerPosition.clientX-t.left,s=this.lastPointerPosition.clientY-t.top;this.applySelectionDrag(e,s)}registerScrollSyncTarget(t){t&&(t.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),t.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}))}applySelectionDrag(t,e){if(!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal)return;const s=this.getRenderOptions(),i=qe.getViewportInfo().startRank,o=this.canvasToGridFresh(t,e),{moved:A,nextSelectionDragTotal:a}=_M({selection:f.state.lassoSelection,selectionDragStart:this.selectionDragStart,selectionDragTotal:this.selectionDragTotal,currentPointerGrid:o,initialDragStartRank:this.initialDragStartRank,currentStartRank:i,renderOptions:s});A&&(this.selectionDragTotal.col=a.col,this.selectionDragTotal.row=a.row,this.render())}handleSelectionScroll(t){var s;if(!((s=f.state.lassoSelection)!=null&&s.isActive)||this.isDraggingSelection)return;const e=this.getRenderOptions();f.state.lassoSelection.convexHull=ca({selectedItems:f.state.lassoSelection.selectedItems,renderOptions:e}),this.render()}handleMouseLeave(t){this.isDrawing&&this.handleMouseUp(t)}handleDoubleClick(t){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top,i=this.getAnnotationAt(s,r);(i==null?void 0:i.type)==="text"&&this.editTextAnnotation(i)}editTextAnnotation(t){const{col:e,row:s,widthCols:r,heightRows:i,text:o,settings:A}=t,a=f.state.annotations.indexOf(t);a>-1&&(f.state.annotations.splice(a,1),this.selectedAnnotation=null,this.render()),this.createTextAnnotation(e,s,r,i,o,A)}createTextAnnotation(t,e,s,r,i=null,o=null){this.isDrawing=!1;const A=this.gridToCanvas(t,e),a=this.gridToCanvas(t+s,e+r),l=A.x,c=A.y,u=a.x-l,d=a.y-c,h=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',m=o||this.toolSettings.text,g=document.createElement("div");g.contentEditable="true",g.className="annotation-text-input",g.textContent=i||"Type here...";const v=m.size,w=v*1.2;g.style.width=`${u}px`,g.style.height=`${d}px`,g.style.padding=m.background?"4px 8px":"4px",g.style.border="2px dashed rgba(74, 144, 226, 0.5)",g.style.backgroundColor=m.background?"#ffffff":"transparent",g.style.color=m.color,g.style.fontSize=`${v}px`,g.style.lineHeight=`${w}px`,g.style.fontWeight=m.bold?"bold":"normal",g.style.fontStyle=m.italic?"italic":"normal",g.style.textDecoration=m.underline?"underline":"none",m.superscript?(g.style.fontSize=`${v*.6}px`,g.style.verticalAlign="super"):m.subscript&&(g.style.fontSize=`${v*.6}px`,g.style.verticalAlign="sub"),g.style.outline="none",g.style.zIndex="10000",g.style.position="fixed",g.style.cursor="text",g.style.pointerEvents="auto",g.style.fontFamily=h,g.style.whiteSpace="pre-wrap",g.style.wordWrap="break-word",g.style.overflow="hidden",g.style.boxSizing="border-box";const y=this.canvas.getBoundingClientRect();g.style.left=`${y.left+l}px`,g.style.top=`${y.top+c}px`,document.body.appendChild(g),g.focus();const I=document.createRange();I.selectNodeContents(g);const B=window.getSelection();B&&(B.removeAllRanges(),B.addRange(I));let C=!1;const b=()=>{if(C)return;C=!0;const T=g.textContent.trim();if(T&&T!=="Type here..."){const x={type:"text",col:t,row:e,widthCols:s,heightRows:r,text:T,settings:{...m}};f.state.annotations.push(x),this.selectedAnnotation=f.state.annotations[f.state.annotations.length-1],f.recordState(),this.render()}document.body.contains(g)&&document.body.removeChild(g)};let S=!1;g.addEventListener("input",()=>{!S&&g.textContent==="Type here..."&&(g.textContent="",S=!0)}),setTimeout(()=>{g.addEventListener("blur",b)},100),g.addEventListener("keydown",T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),b()),T.key==="Escape"&&(C=!0,document.body.contains(g)&&document.body.removeChild(g))})}handleLassoSelection(t=!1){var s,r;if(!((s=this.tempAnnotation)!=null&&s.path))return;const e=this.getRenderOptions();f.state.lassoSelection=FM({lassoPath:this.tempAnnotation.path,state:f.state,renderOptions:e,isAdditive:t,existingSelectedItems:(r=f.state.lassoSelection)==null?void 0:r.selectedItems}),f.recordState(),E.log("AnnotationService",`Lasso selection completed: ${f.state.lassoSelection.selectedItems.length} items selected`,"annotation"),this.render()}updateLassoConvexHull(){var e,s;if(!((e=f.state.lassoSelection)!=null&&e.isActive)||!((s=f.state.lassoSelection.selectedItems)!=null&&s.length))return;const t=this.getRenderOptions();f.state.lassoSelection.convexHull=ca({selectedItems:f.state.lassoSelection.selectedItems,renderOptions:t})}removeFromLassoSelection(t,e){var i;if(!((i=f.state.lassoSelection)!=null&&i.isActive))return;const s=this.getRenderOptions(),r=TM({canvasX:t,canvasY:e,state:f.state,renderOptions:s,selection:f.state.lassoSelection});r!=null&&r.changed&&(f.state.lassoSelection=r.nextSelection,f.recordState(),this.render(),E.log("AnnotationService",`Removed item from lasso selection. ${r.nextSelection.selectedItems.length} items remain.`,"annotation"))}drawTempAnnotation(){if(this.tempAnnotation)switch(this.tempAnnotation.type){case"arrow":this.drawArrow(this.tempAnnotation,!0);break;case"text":this.drawTextBoxPreview(this.tempAnnotation);break;case"marker":this.drawPath(this.tempAnnotation,!1);break;case"highlighter":this.drawPath(this.tempAnnotation,!0);break;case"lasso":this.drawLassoPath(this.tempAnnotation);break}}drawTextBoxPreview(t){const{startX:e,startY:s,endX:r,endY:i}=t,o=this.ctx,A=Math.min(e,r),a=Math.min(s,i),l=Math.abs(r-e),c=Math.abs(i-s);o.save(),o.strokeStyle="rgba(74, 144, 226, 0.6)",o.lineWidth=2,o.setLineDash([5,5]),o.strokeRect(A,a,l,c),this.toolSettings.text.background&&(o.fillStyle="rgba(255, 255, 255, 0.8)",o.fillRect(A,a,l,c)),o.restore()}render(){Go.render()}drawArrow(t,e=!1,s=!1,r=!1){MM({ctx:this.ctx,annotation:t,isTemp:e,isSelected:s,isHovered:r,getStrokeWidth:this.getStrokeWidth.bind(this),getLineDash:this.getLineDash.bind(this)})}wrapText(t,e,s){const r=e.split(`
`),i=[];return r.forEach(o=>{if(!o.trim()){i.push("");return}const A=o.split(" ");let a="";A.forEach((l,c)=>{const u=a?a+" "+l:l;t.measureText(u).width>s&&a?(i.push(a),a=l):a=u}),a&&i.push(a)}),i}drawText(t,e=!1,s=!1){const{x:r,y:i,text:o,settings:A}=t,a=this.ctx;a.save();const c=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',u=this.getSizeValue(A.size);a.font=`${A.italic?"italic ":""}${A.bold?"bold ":""}${u} ${c}`,a.textBaseline="top";const d=parseInt(u)*1.2,p=t.width||0,h=t.height||0,m=A.background?16:8,g=p-m,v=this.wrapText(a,o,g);if(A.background){a.fillStyle="#ffffff";const y=8;a.fillRect(r-y/2,i-y/2,p+y,h+y/2)}if(s&&!e){a.fillStyle="rgba(74, 144, 226, 0.1)";const y=A.background?8:2;a.fillRect(r-y/2,i-y/2,p+y,h+y/2)}if(e){a.fillStyle="rgba(74, 144, 226, 0.2)";const y=A.background?8:2;a.fillRect(r-y/2,i-y/2,p+y,h+y/2)}a.fillStyle=A.color;const w=parseInt(u);v.forEach((y,I)=>{const B=i+I*d;this.drawTextWithSuperscripts(a,y,r,B,w,A,c)}),e&&this.drawResizeHandles(r,i,p,h),a.restore()}drawTextWithSuperscripts(t,e,s,r,i,o,A){if(o.superscript||o.subscript){t.save();const u=i*.6,d=o.superscript?-i*.4:i*.3;if(t.font=`${o.italic?"italic ":""}${o.bold?"bold ":""}${u}px ${A}`,t.fillText(e,s,r+d),o.underline){const p=t.measureText(e);t.beginPath(),t.strokeStyle=o.color,t.lineWidth=1,t.moveTo(s,r+d+u*1.2-2),t.lineTo(s+p.width,r+d+u*1.2-2),t.stroke()}t.restore();return}let a=s;const l=this.parseFormattedText(e),c=(u,d)=>{const p=u;if(p){if(t.save(),d==="superscript"){const h=i*.6,m=-i*.4;t.font=`${o.italic?"italic ":""}${o.bold?"bold ":""}${h}px ${A}`,t.fillText(p,a,r+m),a+=t.measureText(p).width}else if(d==="subscript"){const h=i*.6,m=i*.3;t.font=`${o.italic?"italic ":""}${o.bold?"bold ":""}${h}px ${A}`,t.fillText(p,a,r+m),a+=t.measureText(p).width}else{if(t.font=`${o.italic?"italic ":""}${o.bold?"bold ":""}${i}px ${A}`,t.fillText(p,a,r),o.underline){const h=t.measureText(p);t.beginPath(),t.strokeStyle=o.color,t.lineWidth=1,t.moveTo(a,r+i*1.2-2),t.lineTo(a+h.width,r+i*1.2-2),t.stroke()}a+=t.measureText(p).width}t.restore()}};l.forEach(u=>{c(u.text,u.format)})}parseFormattedText(t){const e=[];let s=0,r="",i=!1;for(;s<t.length;){if(t.substr(s,5)==="<sup>"){r&&(e.push({text:r,format:"normal"}),r="");const o=t.indexOf("</sup>",s);if(o!==-1){const A=t.substring(s+5,o);e.push({text:A,format:"superscript"}),s=o+6;continue}}if(t.substr(s,5)==="<sub>"){r&&(e.push({text:r,format:"normal"}),r="");const o=t.indexOf("</sub>",s);if(o!==-1){const A=t.substring(s+5,o);e.push({text:A,format:"subscript"}),s=o+6;continue}}if(t[s]==="^"&&!i){r&&(e.push({text:r,format:"normal"}),r=""),i=!0,s++;continue}if(i&&t[s]===" "){r&&(e.push({text:r,format:"superscript"}),r=""),i=!1,e.push({text:" ",format:"normal"}),s++;continue}r+=t[s],s++}return r&&e.push({text:r,format:i?"superscript":"normal"}),e}drawResizeHandles(t,e,s,r){const i=this.ctx,o=8,A=[{pos:"nw",x:t,y:e},{pos:"n",x:t+s/2,y:e},{pos:"ne",x:t+s,y:e},{pos:"e",x:t+s,y:e+r/2},{pos:"se",x:t+s,y:e+r},{pos:"s",x:t+s/2,y:e+r},{pos:"sw",x:t,y:e+r},{pos:"w",x:t,y:e+r/2}];i.save(),A.forEach(a=>{i.fillStyle="#4a90e2",i.strokeStyle="#ffffff",i.lineWidth=2,i.fillRect(a.x-o/2,a.y-o/2,o,o),i.strokeRect(a.x-o/2,a.y-o/2,o,o)}),i.restore()}drawPath(t,e){const{path:s,settings:r}=t,i=this.ctx;if(!(s.length<2)){i.save(),e&&(i.globalAlpha=.3),i.strokeStyle=r.color,i.lineWidth=this.getStrokeWidth(r.size),i.lineCap="round",i.lineJoin="round",i.beginPath(),i.moveTo(s[0].x,s[0].y);for(let o=1;o<s.length;o++)i.lineTo(s[o].x,s[o].y);i.stroke(),i.restore()}}drawLassoPath(t){const{path:e}=t,s=this.ctx;if(!(e.length<2)){s.save(),s.strokeStyle="rgba(0, 100, 255, 0.8)",s.lineWidth=2,s.setLineDash([5,5]),s.beginPath(),s.moveTo(e[0].x,e[0].y);for(let r=1;r<e.length;r++)s.lineTo(e[r].x,e[r].y);s.lineTo(e[0].x,e[0].y),s.stroke(),s.restore()}}getStrokeWidth(t){if(typeof t=="number")return t;switch(t){case"small":return 2;case"medium":return 4;case"large":return 6;default:return 2}}getLineDash(t){switch(t){case"solid":return[];case"dashed-big":return[10,5];case"dashed-small":return[5,3];case"dotted":return[2,3];default:return[]}}getSizeValue(t){if(typeof t=="number")return`${t}px`;switch(t){case"small":return"14px";case"medium":return"18px";case"large":return"24px";default:return"16px"}}updateHover(t,e){var o,A,a,l;const s=this.hoverAnnotation,r=typeof document<"u"&&((A=(o=document.body)==null?void 0:o.dataset)==null?void 0:A.cursorOverride)==="stamp";if(((a=this.selectedAnnotation)==null?void 0:a.type)==="text"){const c=this.getResizeHandleAt(t,e,this.selectedAnnotation);if(c){const u={nw:"nwse-resize",n:"ns-resize",ne:"nesw-resize",e:"ew-resize",se:"nwse-resize",s:"ns-resize",sw:"nesw-resize",w:"ew-resize"};this.canvas.style.cursor=u[c]??"default";return}}if((l=f.state.lassoSelection)!=null&&l.isActive&&f.state.lassoSelection.convexHull){const c=ug({x:t,y:e},f.state.lassoSelection.convexHull,10),u=la({x:t,y:e},f.state.lassoSelection.convexHull);if(c||u){this.canvas.style.cursor="move";return}}const i=this.getAnnotationAt(t,e);i&&(i.type==="arrow"||i.type==="text")?(r||(this.currentTool==="text"&&i.type==="text"?this.selectedAnnotation===i?this.canvas.style.cursor="move":this.canvas.style.cursor="pointer":this.canvas.style.cursor="move"),this.hoverAnnotation=i):(r||(this.currentTool?this.setTool(this.currentTool,this.toolSettings):s&&(this.canvas.style.cursor="default")),this.hoverAnnotation=null),s!==this.hoverAnnotation&&this.render()}getResizeHandleAt(t,e,s){if((s==null?void 0:s.type)!=="text")return null;const i=8/2+2,o=this.getRenderOptions(),A=lt(s.col,o),a=xt(s.row,o),l=lt(s.col+s.widthCols,o),c=xt(s.row+s.heightRows,o),u=l-A,d=c-a,p=[{pos:"nw",x:A,y:a},{pos:"n",x:A+u/2,y:a},{pos:"ne",x:A+u,y:a},{pos:"e",x:A+u,y:a+d/2},{pos:"se",x:A+u,y:a+d},{pos:"s",x:A+u/2,y:a+d},{pos:"sw",x:A,y:a+d},{pos:"w",x:A,y:a+d/2}];for(const h of p)if(Math.sqrt(Math.pow(t-h.x,2)+Math.pow(e-h.y,2))<=i)return h.pos;return null}getAnnotationAt(t,e){for(let r=f.state.annotations.length-1;r>=0;r--){const i=f.state.annotations[r];if(i.type==="arrow"){if(y2(t,e,i.startX,i.startY,i.endX,i.endY)<10)return i}else if(i.type==="text"){const o=this.getRenderOptions(),A=lt(i.col,o),a=xt(i.row,o),l=lt(i.col+i.widthCols,o),c=xt(i.row+i.heightRows,o),u=l-A,d=c-a;if(t>=A&&t<=A+u&&e>=a&&e<=a+d)return i}}return null}showEraserCursor(t,e){this.render();const r=(f.state.cellWidth||40)*2;this.ctx.save(),this.ctx.fillStyle="rgba(220, 53, 69, 0.3)",this.ctx.fillRect(t-r/2,e-r/2,r,r),this.ctx.restore()}loadAnnotationSettings(t){if(t.type==="arrow"&&window.drawToolsController){const e=t.settings;window.drawToolsController.settings.arrow={...e},window.drawToolsController.renderArrowOptions()}else if(t.type==="text"&&window.drawToolsController){const e=t.settings;window.drawToolsController.settings.text={...e},window.drawToolsController.renderTextOptions()}}applyCurrentSettingsToSelected(){this.selectedAnnotation&&(this.selectedAnnotation.type==="arrow"&&this.toolSettings.arrow?(this.selectedAnnotation.settings={...this.toolSettings.arrow},this.render()):this.selectedAnnotation.type==="text"&&this.toolSettings.text&&(this.selectedAnnotation.settings={...this.toolSettings.text},this.render()))}clearAnnotations(){f.state.annotations=[],this.render()}eraseAtPoint(t,e){const{nextAnnotations:s,changed:r}=IM({x:t,y:e,annotations:f.state.annotations,getRenderOptions:()=>this.getRenderOptions()});return f.state.annotations=s,r&&this.render(),r}interpolatePoints(t,e){const s=[],r=e.col-t.col,i=e.row-t.row,o=Math.sqrt(r*r+i*i),A=Math.max(1,Math.floor(o/.1));for(let a=1;a<=A;a++){const l=a/A;s.push({col:t.col+l*r,row:t.row+l*i})}return s}deleteAnnotationAt(t,e){this.eraseAtPoint(t,e)}getAnnotations(){return f.state.annotations}loadAnnotations(t){f.state.annotations=t||[],this.render()}applyInlineFormatting(t){const e=document.querySelector(".annotation-text-input");if(!e)return;const s=window.getSelection();if(!s||!s.rangeCount)return;const r=s.getRangeAt(0),i=r.toString();if(!i)return;let o;if(t==="superscript")o=`<sup>${i}</sup>`;else if(t==="subscript")o=`<sub>${i}</sub>`;else return;r.deleteContents();const A=document.createTextNode(o);r.insertNode(A),r.setStartAfter(A),r.setEndAfter(A),s.removeAllRanges(),s.addRange(r),e instanceof HTMLElement&&e.focus()}}const Jt=new QM;function fg(n){if((n==null?void 0:n.type)!=="arrow")return!1;const t=n,e=t.settings;return typeof t.startCol=="number"&&typeof t.startRow=="number"&&typeof t.endCol=="number"&&typeof t.endRow=="number"&&!!e&&typeof e.strokeWeight=="number"&&typeof e.lineStyle=="string"}function pg(n){if((n==null?void 0:n.type)!=="text")return!1;const t=n,e=t.settings;return typeof t.col=="number"&&typeof t.row=="number"&&typeof t.widthCols=="number"&&typeof t.heightRows=="number"&&typeof t.text=="string"&&!!e&&typeof e.size=="number"&&typeof e.color=="string"}function UM(n){if((n==null?void 0:n.type)!=="text")return!1;const t=n,e=typeof n.col=="number";return typeof t.startCol=="number"&&typeof t.startRow=="number"&&typeof t.endCol=="number"&&typeof t.endRow=="number"&&!e}function mg(n){if(!n||n.type!=="marker"&&n.type!=="highlighter")return!1;const t=n,e=t.settings;return Array.isArray(t.path)&&!!e&&typeof e.color=="string"&&(typeof e.size=="number"||e.size==="small"||e.size==="medium"||e.size==="large")}function PM(n){return(n==null?void 0:n.type)==="lasso"&&Array.isArray(n.path)}function NM(n,t){const e=f.state.annotations,s=Jt.tempAnnotation,r=Jt.selectedAnnotation,i=Jt.hoverAnnotation;if(e&&e.length>0&&e.forEach(A=>{const a=A===r,l=A===i;switch(A.type){case"arrow":fg(A)&&gg(n,A,a,l,t);break;case"text":pg(A)&&wg(n,A,a,l,t);break;case"marker":case"highlighter":mg(A)&&Bg(n,A,t);break}}),s)switch(s.type){case"arrow":fg(s)&&gg(n,s,!1,!1,t);break;case"text":UM(s)?HM(n,s,t):pg(s)&&wg(n,s,!1,!1,t);break;case"marker":case"highlighter":mg(s)&&Bg(n,s,t);break;case"lasso":PM(s)&&VM(n,s);break}const o=f.state.lassoSelection;o!=null&&o.isActive&&Array.isArray(o.convexHull)&&(Jt.updateLassoConvexHull(),WM(n,o.convexHull))}function gg(n,t,e=!1,s=!1,r){const{startCol:i,startRow:o,endCol:A,endRow:a,settings:l}=t,c=lt(i,r),u=xt(o,r),d=lt(A,r),p=xt(a,r);n.save(),n.strokeStyle=t.color||"#000000",n.lineWidth=vh(l.strokeWeight),n.setLineDash(OM(l.lineStyle));const h=Math.atan2(p-u,d-c),m=l.arrowheadSize||12;let g=c,v=u,w=d,y=p;l.startArrowhead&&l.startArrowhead!=="none"&&(g=c+Math.cos(h)*m,v=u+Math.sin(h)*m),l.endArrowhead&&l.endArrowhead!=="none"&&(w=d-Math.cos(h)*m,y=p-Math.sin(h)*m),n.beginPath(),n.moveTo(g,v),n.lineTo(w,y),n.stroke(),n.setLineDash([]),l.startArrowhead&&l.startArrowhead!=="none"&&vg(n,c,u,h+Math.PI,l.startArrowhead,m),l.endArrowhead&&l.endArrowhead!=="none"&&vg(n,d,p,h,l.endArrowhead,m),(e||s)&&(n.strokeStyle=e?"rgba(74, 144, 226, 0.6)":"rgba(74, 144, 226, 0.3)",n.lineWidth=vh(l.strokeWeight)+4,n.setLineDash([]),n.beginPath(),n.moveTo(c,u),n.lineTo(d,p),n.stroke()),n.restore()}function vg(n,t,e,s,r,i){switch(n.save(),n.translate(t,e),n.rotate(s),r){case"filled":case"filled-arrow":n.beginPath(),n.moveTo(0,0),n.lineTo(-i,-i/2),n.lineTo(-i,i/2),n.closePath(),n.fillStyle=n.strokeStyle,n.fill();break;case"unfilled":case"unfilled-arrow":n.beginPath(),n.moveTo(0,0),n.lineTo(-i,-i/2),n.lineTo(-i,i/2),n.closePath(),n.stroke();break;case"circle":n.beginPath(),n.arc(0,0,i/3,0,Math.PI*2),n.fillStyle=n.strokeStyle,n.fill();break}n.restore()}function wg(n,t,e=!1,s=!1,r){const{col:i,row:o,text:A,widthCols:a,heightRows:l,settings:c}=t,u=lt(i,r),d=xt(o,r),p=lt(i+(typeof a=="number"?a:2),r)-u,h=xt(o+(typeof l=="number"?l:1),r)-d;n.save(),n.textBaseline="top";const g=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',v=c.size,w=v*1.2,y=c.background?8:4,I=4,B=p-y*2,C=LM(n,A,B,v,c,g);c.background&&(n.fillStyle="#ffffff",n.fillRect(u,d,p,h)),s&&!e&&(n.fillStyle="rgba(74, 144, 226, 0.1)",n.fillRect(u,d,p,h)),e&&(n.fillStyle="rgba(74, 144, 226, 0.2)",n.fillRect(u,d,p,h)),n.fillStyle=c.color,C.forEach((b,S)=>{const T=d+I+S*w;DM(n,b,u+y,T,v,c,g)}),e&&RM(n,u,d,p,h),n.restore()}function LM(n,t,e,s,r,i){n.font=`${r.italic?"italic ":""}${r.bold?"bold ":""}${s}px ${i}`;const o=t.split(`
`),A=[];return o.forEach(a=>{if(!a.trim()){A.push("");return}const l=a.split(" ");let c="";l.forEach(u=>{const d=c?c+" "+u:u;n.measureText(d).width>e&&c?(A.push(c),c=u):c=d}),c&&A.push(c)}),A}function DM(n,t,e,s,r,i,o){if(i.superscript||i.subscript){n.save();const l=r*.6,c=i.superscript?-r*.4:r*.3;if(n.font=`${i.italic?"italic ":""}${i.bold?"bold ":""}${l}px ${o}`,n.fillText(t,e,s+c),i.underline){const u=n.measureText(t);n.beginPath(),n.strokeStyle=i.color,n.lineWidth=1,n.moveTo(e,s+c+l*1.2-2),n.lineTo(e+u.width,s+c+l*1.2-2),n.stroke()}n.restore();return}const A=kM(t);let a=e;A.forEach(l=>{if(n.save(),l.format==="superscript"){const c=r*.6,u=-r*.4;n.font=`${i.italic?"italic ":""}${i.bold?"bold ":""}${c}px ${o}`,n.fillText(l.text,a,s+u),a+=n.measureText(l.text).width}else if(l.format==="subscript"){const c=r*.6,u=r*.3;n.font=`${i.italic?"italic ":""}${i.bold?"bold ":""}${c}px ${o}`,n.fillText(l.text,a,s+u),a+=n.measureText(l.text).width}else{if(n.font=`${i.italic?"italic ":""}${i.bold?"bold ":""}${r}px ${o}`,n.fillText(l.text,a,s),i.underline){const c=n.measureText(l.text);n.beginPath(),n.strokeStyle=i.color,n.lineWidth=1,n.moveTo(a,s+r*1.2-2),n.lineTo(a+c.width,s+r*1.2-2),n.stroke()}a+=n.measureText(l.text).width}n.restore()})}function kM(n){const t=[];let e=0,s="",r=!1;for(;e<n.length;){if(n.substr(e,5)==="<sup>"){s&&(t.push({text:s,format:"normal"}),s="");const i=n.indexOf("</sup>",e);if(i!==-1){const o=n.substring(e+5,i);t.push({text:o,format:"superscript"}),e=i+6;continue}}if(n.substr(e,5)==="<sub>"){s&&(t.push({text:s,format:"normal"}),s="");const i=n.indexOf("</sub>",e);if(i!==-1){const o=n.substring(e+5,i);t.push({text:o,format:"subscript"}),e=i+6;continue}}if(n[e]==="^"&&!r){s&&(t.push({text:s,format:"normal"}),s=""),r=!0,e++;continue}if(r&&n[e]===" "){s&&(t.push({text:s,format:"superscript"}),s=""),r=!1,t.push({text:" ",format:"normal"}),e++;continue}s+=n[e],e++}return s&&t.push({text:s,format:r?"superscript":"normal"}),t}function RM(n,t,e,s,r){const o=[{x:t,y:e},{x:t+s/2,y:e},{x:t+s,y:e},{x:t+s,y:e+r/2},{x:t+s,y:e+r},{x:t+s/2,y:e+r},{x:t,y:e+r},{x:t,y:e+r/2}];n.save(),o.forEach(A=>{n.fillStyle="#4a90e2",n.strokeStyle="#ffffff",n.lineWidth=2,n.fillRect(A.x-8/2,A.y-8/2,8,8),n.strokeRect(A.x-8/2,A.y-8/2,8,8)}),n.restore()}function HM(n,t,e){const{startCol:s,startRow:r,endCol:i,endRow:o}=t,A=lt(s,e),a=xt(r,e),l=lt(i,e),c=xt(o,e),u=Math.min(A,l),d=Math.min(a,c),p=Math.abs(l-A),h=Math.abs(c-a);n.save(),n.strokeStyle="rgba(74, 144, 226, 0.6)",n.lineWidth=2,n.setLineDash([5,5]),n.strokeRect(u,d,p,h),n.restore()}function Bg(n,t,e){const{path:s,settings:r,type:i}=t;if(!s||s.length<2)return;const o=s.map(a=>({x:lt(a.col,e),y:xt(a.row,e)}));n.save(),i==="highlighter"&&(n.globalAlpha=.3),n.strokeStyle=r.color,n.lineWidth=typeof r.size=="number"?r.size:vh(r.size),n.lineCap="round",n.lineJoin="round",n.beginPath();const A=o[0];if(!A){n.restore();return}n.moveTo(A.x,A.y);for(let a=1;a<o.length;a++){const l=o[a];l&&n.lineTo(l.x,l.y)}n.stroke(),n.restore()}function vh(n){if(typeof n=="number")return n;switch(n){case"small":return 2;case"medium":return 4;case"large":return 6;default:return 4}}function OM(n){switch(n){case"solid":return[];case"dashed-big":return[10,5];case"dashed-small":return[5,3];case"dotted":return[2,3];default:return[]}}function VM(n,t){const e=t.path;if(!e||e.length<2)return;const s=e[0];if(s){n.save(),n.strokeStyle="#4a90e2",n.lineWidth=2,n.setLineDash([5,5]),n.globalAlpha=.7,n.beginPath(),n.moveTo(s.x,s.y);for(let r=1;r<e.length;r++){const i=e[r];i&&n.lineTo(i.x,i.y)}e.length>2&&n.lineTo(s.x,s.y),n.stroke(),n.restore()}}function WM(n,t){if(!t||t.length<3)return;const e=t[0];if(e){n.save(),n.strokeStyle="#4a90e2",n.lineWidth=2,n.setLineDash([8,4]),n.globalAlpha=.8,n.beginPath(),n.moveTo(e.x,e.y);for(let s=1;s<t.length;s++){const r=t[s];r&&n.lineTo(r.x,r.y)}n.closePath(),n.stroke(),n.fillStyle="rgba(74, 144, 226, 0.1)",n.fill(),n.restore()}}let Cg=0;function S2(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let GM=!1;function KM(n,t){var e;if(S2())try{const s=((e=performance==null?void 0:performance.now)==null?void 0:e.call(performance))??Date.now();if(s-Cg<500)return;Cg=s,GM=!0}catch{}}function qM(n,t){var m,g,v,w,y,I;const e={...f.state,...t};if(!((m=e.columnWidths)!=null&&m.length)||!((g=e.fullRowData)!=null&&g.length))return;n.clearRect(0,0,$e(n.canvas),ie(n.canvas));const{startRow:s,endRow:r}=k_(),i=Math.max(0,s-1),o=Math.max(0,(((v=e.fullRowData)==null?void 0:v.length)??1)-1),A=Math.min(o,r+1);if(S2()){const B=ie(n.canvas),C=e.cellHeight/2,b=xt(r,e),S=b+C,T=((w=e.fullRowData)==null?void 0:w.length)??0,x=s<=0,_=T>0?r>=T-1:!1,F=(y=e.fullRowData)==null?void 0:y[s],Q=(I=e.fullRowData)==null?void 0:I[r];KM("pitchCanvasCoverage",{startRow:s,endRow:r,paddedStartRow:i,paddedEndRow:A,atTopGamutEdge:x,atBottomGamutEdge:_,canvasHeight:B,containerHeight:e.viewportHeight,halfUnit:C,yEnd:b,bottomEdge:S,gapCanvasMinusBottomEdge:B-S,gapCanvasMinusContainer:B-e.viewportHeight,startRowSummary:F?{pitch:F.pitch,column:F.column,isBoundary:!!F.isBoundary}:null,endRowSummary:Q?{pitch:Q.pitch,column:Q.column,isBoundary:!!Q.isBoundary}:null})}const a=e.cellHeight,l=B=>{const C=xt(B,e);return C>=-a&&C<=e.viewportHeight+a},c=e.placedTonicSigns.filter(B=>B.globalRow===void 0?!1:l(B.globalRow)),u=Aa.getLegendLeftContext(),d=Aa.getLegendRightContext();sM(u,d,e,i,A),z_(n,e,i,A),$_(n,e);const p=t.placedNotes.filter(B=>B.isDrum||B.globalRow===void 0?!1:l(B.globalRow)),h=c;p.forEach(B=>{B.shape==="oval"?bp(n,e,B,B.globalRow):B.shape==="circle"&&Cp(n,e,B,B.globalRow)}),h.forEach(B=>{v2(n,e,B)}),uM(n,e),fM(n,e),b2(n,e),NM(n,e)}const E2={getTimeSignatureSegments(){const n=f.state,t=n.macrobeatGroupings??[],e=n.macrobeatBoundaryStyles??[],s=[];let r=!!n.hasAnacrusis,i=mn(n,0).startColumn,o=0,A=!1;return t.forEach((a,l)=>{o+=a,a===3&&(A=!0);const c=l===t.length-1,d=e[l]==="solid";if(d||c){const h=mn(n,l).endColumn+1,m=Array.isArray(n.tempoModulationMarkers)&&n.tempoModulationMarkers.length>0,g={...n,tempoModulationMarkers:m?n.tempoModulationMarkers:[],cellWidth:n.cellWidth,columnWidths:n.columnWidths,musicalColumnWidths:n.musicalColumnWidths,baseMicrobeatPx:n.cellWidth},v=lt(i,g),w=lt(h,g),y=A?`${o}/8`:`${o/2}/4`;s.push({label:y,centerX:(v+w)/2,startX:v,endX:w,isAnacrusis:r}),c||(i=h,o=0,A=!1,d&&(r=!1))}}),s},getRhythmUIButtons(){const n=f.state,t=n.macrobeatGroupings??[],e=n.macrobeatBoundaryStyles??[],s=[],r=Ye(n),i=new Set(r.map(o=>o.columnIndex+2));return t.forEach((o,A)=>{const a=mn(n,A),{startColumn:l,endColumn:c}=a,u={...n,tempoModulationMarkers:n.tempoModulationMarkers||[],cellWidth:n.cellWidth,columnWidths:n.columnWidths,musicalColumnWidths:n.columnWidths,baseMicrobeatPx:n.cellWidth},d=lt(l,u),p=lt(c+1,u),h=(d+p)/2,m=e[A]??null,g=A>0?e[A-1]??null:null,v=g!==null&&i.has(l);s.push({type:"grouping",content:o,x:h,startX:d,endX:p,index:A,nextBoundaryStyle:m,prevBoundaryStyle:g,hasLeftDivider:v}),A<t.length-1&&s.push({type:"boundary",boundaryStyle:m,x:p,index:A})}),s}},zM="data-rhythm-ui-element",wh=n=>`${Math.round(n*100)/100}px`,$M=n=>{n.querySelectorAll(`[${zM}]`).forEach(t=>t.remove())},XM=n=>{const t=document.getElementById("notation-grid");if(!t)return null;const e=t.getBoundingClientRect(),s=n.getBoundingClientRect();return e.width===0?null:e.left-s.left},YM=(n,t)=>{const e=document.createElement("button");return e.type="button",e.className="grouping-segment",e.dataset.rhythmUiElement="grouping",e.dataset.index=`${n.index}`,e.textContent=`${n.content}`,e.style.left=wh(t+n.startX),e.style.width=wh(Math.max(0,n.endX-n.startX)),e.dataset.nextBoundaryStyle=`${n.nextBoundaryStyle??""}`,e.dataset.prevBoundaryStyle=`${n.prevBoundaryStyle??""}`,e.dataset.hasLeftDivider=n.hasLeftDivider?"true":"false",e.setAttribute("aria-label",`Toggle macrobeat grouping (${n.content}) at position ${n.index+1}`),e.addEventListener("click",s=>{s.stopPropagation(),f.toggleMacrobeatGrouping(n.index)}),e},jM=(n,t)=>{const e=document.createElement("button");e.type="button",e.className="buttonGrid-ui-button buttonGrid-ui-button--boundary",e.dataset.rhythmUiElement="boundary",e.dataset.index=`${n.index}`,e.style.left=wh(t+n.x),e.setAttribute("aria-label","Cycle boundary style");const s=document.createElement("span");return s.className="boundary-diamond",s.dataset.style=n.boundaryStyle||"dashed",e.appendChild(s),e.addEventListener("click",r=>{r.stopPropagation(),f.cycleMacrobeatBoundaryStyle(n.index)}),e};function x2(){const n=document.getElementById("beat-line-button-layer");if(!n){E.warn("rhythmUI","Cannot render rhythm UI without beat-line container",null,"ui");return}const t=XM(n);if(t===null)return;const e=n.querySelector("#grouping-buttons-row"),s=n.querySelector("#boundary-buttons-row");$M(n);const r=E2.getRhythmUIButtons();if(!Array.isArray(r)||r.length===0)return;const i=document.createDocumentFragment(),o=document.createDocumentFragment();r.forEach(A=>{A.type==="grouping"?i.appendChild(YM(A,t)):A.type==="boundary"&&o.appendChild(jM(A,t))}),e?e.appendChild(i):n.appendChild(i),s?s.appendChild(o):n.appendChild(o)}const JM={init:ZM};function ZM(){x2()}const tQ={getTimeSignatureOptions(){return{"Single Macrobeat":[{label:"1/4",groupings:[2],description:"one 2-beat"},{label:"2/8",groupings:[2],description:"one 2-beat"},{label:"3/8",groupings:[3],description:"one 3-beat"}],"Two Macrobeats":[{label:"2/4",groupings:[2,2],description:"two 2-beats"},{label:"4/8",groupings:[2,2],description:"two 2-beats"},{label:"5/8",groupings:[2,3],description:"2+3"},{label:"5/8",groupings:[3,2],description:"3+2"},{label:"6/8",groupings:[3,3],description:"two 3-beats"}],"Three Macrobeats":[{label:"3/4",groupings:[2,2,2],description:"three 2-beats"},{label:"7/8",groupings:[2,2,3],description:"2+2+3"},{label:"7/8",groupings:[3,2,2],description:"3+2+2"},{label:"7/8",groupings:[2,3,2],description:"2+3+2"},{label:"8/8",groupings:[3,3,2],description:"3+3+2"},{label:"8/8",groupings:[3,2,3],description:"3+2+3"},{label:"8/8",groupings:[2,3,3],description:"2+3+3"},{label:"9/8",groupings:[3,3,3],description:"three 3-beats"}],"Four Macrobeats":[{label:"4/4",groupings:[2,2,2,2],description:"four 2-beats"},{label:"10/8",groupings:[2,2,3,3],description:"2+2+3+3"},{label:"10/8",groupings:[2,3,2,3],description:"2+3+2+3"},{label:"10/8",groupings:[2,3,3,2],description:"2+3+3+2"},{label:"10/8",groupings:[3,2,3,2],description:"3+2+3+2"},{label:"10/8",groupings:[3,3,2,2],description:"3+3+2+2"},{label:"10/8",groupings:[3,2,2,3],description:"3+2+2+3"},{label:"11/8",groupings:[3,3,3,2],description:"3+3+3+2"},{label:"11/8",groupings:[3,3,2,3],description:"3+3+2+3"},{label:"11/8",groupings:[3,2,3,3],description:"3+2+3+3"},{label:"11/8",groupings:[2,3,3,3],description:"2+3+3+3"},{label:"12/8",groupings:[3,3,3,3],description:"four 3-beats"}],"Five Macrobeats":[{label:"5/4",groupings:[2,2,2,2,2],description:"five 2-beats"},{label:"11/8",groupings:[2,2,2,2,3],description:"2+2+2+2+3"},{label:"11/8",groupings:[2,2,2,3,2],description:"2+2+2+3+2"},{label:"11/8",groupings:[2,2,3,2,2],description:"2+2+3+2+2"},{label:"11/8",groupings:[2,3,2,2,2],description:"2+3+2+2+2"},{label:"11/8",groupings:[3,2,2,2,2],description:"3+2+2+2+2"},{label:"12/8",groupings:[2,2,2,3,3],description:"2+2+2+3+3"},{label:"12/8",groupings:[2,2,3,2,3],description:"2+2+3+2+3"},{label:"12/8",groupings:[2,2,3,3,2],description:"2+2+3+3+2"},{label:"12/8",groupings:[2,3,2,2,3],description:"2+3+2+2+3"},{label:"12/8",groupings:[2,3,2,3,2],description:"2+3+2+3+2"},{label:"12/8",groupings:[2,3,3,2,2],description:"2+3+3+2+2"},{label:"12/8",groupings:[3,2,2,2,3],description:"3+2+2+2+3"},{label:"12/8",groupings:[3,2,2,3,2],description:"3+2+2+3+2"},{label:"12/8",groupings:[3,2,3,2,2],description:"3+2+3+2+2"},{label:"12/8",groupings:[3,3,2,2,2],description:"3+3+2+2+2"},{label:"13/8",groupings:[3,2,2,3,3],description:"3+2+2+3+3"},{label:"13/8",groupings:[3,3,2,3,2],description:"3+3+2+3+2"},{label:"13/8",groupings:[3,3,3,2,2],description:"3+3+3+2+2"},{label:"15/8",groupings:[3,3,3,3,3],description:"five 3-beats"}]}},generateDropdownHTML(){const n=this.getTimeSignatureOptions();let t='<div id="time-signature-dropdown" class="time-signature-dropdown hidden">';return Object.entries(n).forEach(([e,s])=>{t+='<div class="dropdown-category">',t+=`<div class="dropdown-category-header">${e}</div>`,s.forEach((r,i)=>{const o=`${e}-${i}`;t+=`<div class="dropdown-option" data-groupings="${JSON.stringify(r.groupings)}" data-key="${o}">`,t+=`<span class="dropdown-label">${r.label}</span>`,t+=`<span class="dropdown-description">${r.description}</span>`,t+="</div>"}),t+="</div>"}),t+="</div>",t},getTimeSignatureLabel(n){const t=n.reduce((s,r)=>s+r,0);return n.includes(3)?`${t}/8`:`${t/2}/4`}};let po=null;function eQ(){const n=document.getElementById("beat-line-button-layer");if(!n)return;const t=n.querySelector("#time-signature-row")||n;n.querySelectorAll(".time-signature-label").forEach(a=>a.remove());const s=document.getElementById("notation-grid");if(!s)return;const r=s.getBoundingClientRect(),i=n.getBoundingClientRect(),o=r.left-i.left;E2.getTimeSignatureSegments().forEach((a,l)=>{const c=document.createElement("div");c.className="time-signature-label",a.isAnacrusis&&c.classList.add("anacrusis-label"),c.textContent=a.label,c.style.position="absolute",c.style.left=`${o+a.startX}px`,c.style.width=`${Math.max(0,a.endX-a.startX)}px`,c.style.transform="none",c.style.pointerEvents="auto",c.addEventListener("click",u=>{u.stopPropagation(),sQ(c,l)}),t.appendChild(c)}),nQ()}function nQ(){if(!document.getElementById("time-signature-dropdown")){const n=tQ.generateDropdownHTML();document.body.insertAdjacentHTML("beforeend",n);const t=document.getElementById("time-signature-dropdown");t==null||t.addEventListener("click",iQ)}}function sQ(n,t){const e=document.getElementById("time-signature-dropdown");if(!e)return;e.dataset.measureIndex=String(t);const s=n.getBoundingClientRect();e.style.left=`${s.left}px`,e.style.top=`${s.bottom+5}px`;const r=e.getBoundingClientRect(),i=window.innerWidth,o=window.innerHeight;s.left+r.width>i&&(e.style.left=`${i-r.width-10}px`),s.bottom+r.height>o&&(e.style.top=`${s.top-r.height-5}px`),e.classList.remove("hidden"),po={dropdown:e,measureIndex:t},setTimeout(()=>{document.addEventListener("click",rQ,{once:!0})},0)}function rQ(n){const t=document.getElementById("time-signature-dropdown"),e=n.target;t&&e&&!t.contains(e)&&(t.classList.add("hidden"),po=null)}function iQ(n){const t=n.target,e=t==null?void 0:t.closest(".dropdown-option");if(!e)return;const s=e.dataset.groupings,r=(po==null?void 0:po.measureIndex)??NaN;if(!(!s||Number.isNaN(r)))try{const i=JSON.parse(s);f.updateTimeSignature(r,i);const o=document.getElementById("time-signature-dropdown");o==null||o.classList.add("hidden"),po=null}catch{}}E.moduleLoaded("PitchGridController","grid");function oQ(){var s,r;const n=Aa.getPitchContext();if(!(n!=null&&n.canvas)){E.error("PitchGridController","Pitch grid context not available for rendering",null,"grid");return}const t=qe.getViewportInfo(),e={placedNotes:KT(f.state),placedTonicSigns:Ye(f.state),fullRowData:f.state.fullRowData,columnWidths:f.state.columnWidths,cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,rowHeight:f.state.cellHeight*.5,macrobeatGroupings:f.state.macrobeatGroupings,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles,accidentalMode:f.state.accidentalMode,showFrequencyLabels:f.state.showFrequencyLabels,showOctaveLabels:f.state.showOctaveLabels,colorMode:"color",degreeDisplayMode:f.state.degreeDisplayMode,zoomLevel:t.zoomLevel,viewportHeight:t.containerHeight,tempoModulationMarkers:f.state.tempoModulationMarkers,showModulationLabel:!1};E.debug("PitchGridController","renderPitchGrid options",{columns:(s=e.columnWidths)==null?void 0:s.length,rows:(r=e.fullRowData)==null?void 0:r.length,placedNotes:e.placedNotes.length,tonicSigns:e.placedTonicSigns.length,zoomLevel:e.zoomLevel,viewportHeight:e.viewportHeight},"grid"),qM(n,e)}const Go={render(){oQ()},renderMacrobeatTools(){x2(),eQ()}};/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Bh=function(n,t){return Bh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])},Bh(n,t)};function hs(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Bh(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Ch=function(){return Ch=Object.assign||function(t){for(var e,s=1,r=arguments.length;s<r;s++){e=arguments[s];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Ch.apply(this,arguments)};function Ze(n,t,e,s){function r(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function A(c){try{l(s.next(c))}catch(u){o(u)}}function a(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?i(c.value):r(c.value).then(A,a)}l((s=s.apply(n,[])).next())})}function Oe(n,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,r,i,o;return o={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function A(l){return function(c){return a([l,c])}}function a(l){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,r&&(i=l[0]&2?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,r=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){e.label=l[1];break}if(l[0]===6&&e.label<i[1]){e.label=i[1],i=l;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(l);break}i[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(n,e)}catch(c){l=[6,c],r=0}finally{s=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function il(n,t,e){if(arguments.length===2)for(var s=0,r=t.length,i;s<r;s++)(i||!(s in t))&&(i||(i=Array.prototype.slice.call(t,0,s)),i[s]=t[s]);return n.concat(i||t)}var hr=(function(){function n(t,e,s,r){this.left=t,this.top=e,this.width=s,this.height=r}return n.prototype.add=function(t,e,s,r){return new n(this.left+t,this.top+e,this.width+s,this.height+r)},n.fromClientRect=function(t,e){return new n(e.left+t.windowBounds.left,e.top+t.windowBounds.top,e.width,e.height)},n.fromDOMRectList=function(t,e){var s=Array.from(e).find(function(r){return r.width!==0});return s?new n(s.left+t.windowBounds.left,s.top+t.windowBounds.top,s.width,s.height):n.EMPTY},n.EMPTY=new n(0,0,0,0),n})(),Tu=function(n,t){return hr.fromClientRect(n,t.getBoundingClientRect())},AQ=function(n){var t=n.body,e=n.documentElement;if(!t||!e)throw new Error("Unable to get document size");var s=Math.max(Math.max(t.scrollWidth,e.scrollWidth),Math.max(t.offsetWidth,e.offsetWidth),Math.max(t.clientWidth,e.clientWidth)),r=Math.max(Math.max(t.scrollHeight,e.scrollHeight),Math.max(t.offsetHeight,e.offsetHeight),Math.max(t.clientHeight,e.clientHeight));return new hr(0,0,s,r)},_u=function(n){for(var t=[],e=0,s=n.length;e<s;){var r=n.charCodeAt(e++);if(r>=55296&&r<=56319&&e<s){var i=n.charCodeAt(e++);(i&64512)===56320?t.push(((r&1023)<<10)+(i&1023)+65536):(t.push(r),e--)}else t.push(r)}return t},ue=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,n);var e=n.length;if(!e)return"";for(var s=[],r=-1,i="";++r<e;){var o=n[r];o<=65535?s.push(o):(o-=65536,s.push((o>>10)+55296,o%1024+56320)),(r+1===e||s.length>16384)&&(i+=String.fromCharCode.apply(String,s),s.length=0)}return i},bg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",aQ=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ol=0;ol<bg.length;ol++)aQ[bg.charCodeAt(ol)]=ol;var yg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",gA=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Al=0;Al<yg.length;Al++)gA[yg.charCodeAt(Al)]=Al;var lQ=function(n){var t=n.length*.75,e=n.length,s,r=0,i,o,A,a;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);var l=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),c=Array.isArray(l)?l:new Uint8Array(l);for(s=0;s<e;s+=4)i=gA[n.charCodeAt(s)],o=gA[n.charCodeAt(s+1)],A=gA[n.charCodeAt(s+2)],a=gA[n.charCodeAt(s+3)],c[r++]=i<<2|o>>4,c[r++]=(o&15)<<4|A>>2,c[r++]=(A&3)<<6|a&63;return l},cQ=function(n){for(var t=n.length,e=[],s=0;s<t;s+=2)e.push(n[s+1]<<8|n[s]);return e},uQ=function(n){for(var t=n.length,e=[],s=0;s<t;s+=4)e.push(n[s+3]<<24|n[s+2]<<16|n[s+1]<<8|n[s]);return e},Fi=5,Sp=11,fd=2,dQ=Sp-Fi,I2=65536>>Fi,hQ=1<<Fi,pd=hQ-1,fQ=1024>>Fi,pQ=I2+fQ,mQ=pQ,gQ=32,vQ=mQ+gQ,wQ=65536>>Sp,BQ=1<<dQ,CQ=BQ-1,Sg=function(n,t,e){return n.slice?n.slice(t,e):new Uint16Array(Array.prototype.slice.call(n,t,e))},bQ=function(n,t,e){return n.slice?n.slice(t,e):new Uint32Array(Array.prototype.slice.call(n,t,e))},yQ=function(n,t){var e=lQ(n),s=Array.isArray(e)?uQ(e):new Uint32Array(e),r=Array.isArray(e)?cQ(e):new Uint16Array(e),i=24,o=Sg(r,i/2,s[4]/2),A=s[5]===2?Sg(r,(i+s[4])/2):bQ(s,Math.ceil((i+s[4])/4));return new SQ(s[0],s[1],s[2],s[3],o,A)},SQ=(function(){function n(t,e,s,r,i,o){this.initialValue=t,this.errorValue=e,this.highStart=s,this.highValueIndex=r,this.index=i,this.data=o}return n.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>Fi],e=(e<<fd)+(t&pd),this.data[e];if(t<=65535)return e=this.index[I2+(t-55296>>Fi)],e=(e<<fd)+(t&pd),this.data[e];if(t<this.highStart)return e=vQ-wQ+(t>>Sp),e=this.index[e],e+=t>>Fi&CQ,e=this.index[e],e=(e<<fd)+(t&pd),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},n})(),Eg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",EQ=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var al=0;al<Eg.length;al++)EQ[Eg.charCodeAt(al)]=al;var xQ="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",xg=50,IQ=1,F2=2,T2=3,FQ=4,TQ=5,Ig=7,_2=8,Fg=9,Nr=10,bh=11,Tg=12,yh=13,_Q=14,vA=15,Sh=16,ll=17,AA=18,MQ=19,_g=20,Eh=21,aA=22,md=23,Yi=24,bn=25,wA=26,BA=27,ji=28,QQ=29,ci=30,UQ=31,cl=32,ul=33,xh=34,Ih=35,Fh=36,ua=37,Th=38,Xl=39,Yl=40,gd=41,M2=42,PQ=43,NQ=[9001,65288],Q2="!",Tt="",dl="",_h=yQ(xQ),Ws=[ci,Fh],Mh=[IQ,F2,T2,TQ],U2=[Nr,_2],Mg=[BA,wA],LQ=Mh.concat(U2),Qg=[Th,Xl,Yl,xh,Ih],DQ=[vA,yh],kQ=function(n,t){t===void 0&&(t="strict");var e=[],s=[],r=[];return n.forEach(function(i,o){var A=_h.get(i);if(A>xg?(r.push(!0),A-=xg):r.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(i)!==-1)return s.push(o),e.push(Sh);if(A===FQ||A===bh){if(o===0)return s.push(o),e.push(ci);var a=e[o-1];return LQ.indexOf(a)===-1?(s.push(s[o-1]),e.push(a)):(s.push(o),e.push(ci))}if(s.push(o),A===UQ)return e.push(t==="strict"?Eh:ua);if(A===M2||A===QQ)return e.push(ci);if(A===PQ)return i>=131072&&i<=196605||i>=196608&&i<=262141?e.push(ua):e.push(ci);e.push(A)}),[s,e,r]},vd=function(n,t,e,s){var r=s[e];if(Array.isArray(n)?n.indexOf(r)!==-1:n===r)for(var i=e;i<=s.length;){i++;var o=s[i];if(o===t)return!0;if(o!==Nr)break}if(r===Nr)for(var i=e;i>0;){i--;var A=s[i];if(Array.isArray(n)?n.indexOf(A)!==-1:n===A)for(var a=e;a<=s.length;){a++;var o=s[a];if(o===t)return!0;if(o!==Nr)break}if(A!==Nr)break}return!1},Ug=function(n,t){for(var e=n;e>=0;){var s=t[e];if(s===Nr)e--;else return s}return 0},RQ=function(n,t,e,s,r){if(e[s]===0)return Tt;var i=s-1;if(Array.isArray(r)&&r[i]===!0)return Tt;var o=i-1,A=i+1,a=t[i],l=o>=0?t[o]:0,c=t[A];if(a===F2&&c===T2)return Tt;if(Mh.indexOf(a)!==-1)return Q2;if(Mh.indexOf(c)!==-1||U2.indexOf(c)!==-1)return Tt;if(Ug(i,t)===_2)return dl;if(_h.get(n[i])===bh||(a===cl||a===ul)&&_h.get(n[A])===bh||a===Ig||c===Ig||a===Fg||[Nr,yh,vA].indexOf(a)===-1&&c===Fg||[ll,AA,MQ,Yi,ji].indexOf(c)!==-1||Ug(i,t)===aA||vd(md,aA,i,t)||vd([ll,AA],Eh,i,t)||vd(Tg,Tg,i,t))return Tt;if(a===Nr)return dl;if(a===md||c===md)return Tt;if(c===Sh||a===Sh)return dl;if([yh,vA,Eh].indexOf(c)!==-1||a===_Q||l===Fh&&DQ.indexOf(a)!==-1||a===ji&&c===Fh||c===_g||Ws.indexOf(c)!==-1&&a===bn||Ws.indexOf(a)!==-1&&c===bn||a===BA&&[ua,cl,ul].indexOf(c)!==-1||[ua,cl,ul].indexOf(a)!==-1&&c===wA||Ws.indexOf(a)!==-1&&Mg.indexOf(c)!==-1||Mg.indexOf(a)!==-1&&Ws.indexOf(c)!==-1||[BA,wA].indexOf(a)!==-1&&(c===bn||[aA,vA].indexOf(c)!==-1&&t[A+1]===bn)||[aA,vA].indexOf(a)!==-1&&c===bn||a===bn&&[bn,ji,Yi].indexOf(c)!==-1)return Tt;if([bn,ji,Yi,ll,AA].indexOf(c)!==-1)for(var u=i;u>=0;){var d=t[u];if(d===bn)return Tt;if([ji,Yi].indexOf(d)!==-1)u--;else break}if([BA,wA].indexOf(c)!==-1)for(var u=[ll,AA].indexOf(a)!==-1?o:i;u>=0;){var d=t[u];if(d===bn)return Tt;if([ji,Yi].indexOf(d)!==-1)u--;else break}if(Th===a&&[Th,Xl,xh,Ih].indexOf(c)!==-1||[Xl,xh].indexOf(a)!==-1&&[Xl,Yl].indexOf(c)!==-1||[Yl,Ih].indexOf(a)!==-1&&c===Yl||Qg.indexOf(a)!==-1&&[_g,wA].indexOf(c)!==-1||Qg.indexOf(c)!==-1&&a===BA||Ws.indexOf(a)!==-1&&Ws.indexOf(c)!==-1||a===Yi&&Ws.indexOf(c)!==-1||Ws.concat(bn).indexOf(a)!==-1&&c===aA&&NQ.indexOf(n[A])===-1||Ws.concat(bn).indexOf(c)!==-1&&a===AA)return Tt;if(a===gd&&c===gd){for(var p=e[i],h=1;p>0&&(p--,t[p]===gd);)h++;if(h%2!==0)return Tt}return a===cl&&c===ul?Tt:dl},HQ=function(n,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var e=kQ(n,t.lineBreak),s=e[0],r=e[1],i=e[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(r=r.map(function(A){return[bn,ci,M2].indexOf(A)!==-1?ua:A}));var o=t.wordBreak==="keep-all"?i.map(function(A,a){return A&&n[a]>=19968&&n[a]<=40959}):void 0;return[s,r,o]},OQ=(function(){function n(t,e,s,r){this.codePoints=t,this.required=e===Q2,this.start=s,this.end=r}return n.prototype.slice=function(){return ue.apply(void 0,this.codePoints.slice(this.start,this.end))},n})(),VQ=function(n,t){var e=_u(n),s=HQ(e,t),r=s[0],i=s[1],o=s[2],A=e.length,a=0,l=0;return{next:function(){if(l>=A)return{done:!0,value:null};for(var c=Tt;l<A&&(c=RQ(e,i,r,++l,o))===Tt;);if(c!==Tt||l===A){var u=new OQ(e,c,a,l);return a=l,{value:u,done:!1}}return{done:!0,value:null}}}},WQ=1,GQ=2,Ra=4,Pg=8,Tc=10,Ng=47,HA=92,KQ=9,qQ=32,hl=34,lA=61,zQ=35,$Q=36,XQ=37,fl=39,pl=40,cA=41,YQ=95,ln=45,jQ=33,JQ=60,ZQ=62,t3=64,e3=91,n3=93,s3=61,r3=123,ml=63,i3=125,Lg=124,o3=126,A3=128,Dg=65533,wd=42,pi=43,a3=44,l3=58,c3=59,da=46,u3=0,d3=8,h3=11,f3=14,p3=31,m3=127,fs=-1,P2=48,N2=97,L2=101,g3=102,v3=117,w3=122,D2=65,k2=69,R2=70,B3=85,C3=90,We=function(n){return n>=P2&&n<=57},b3=function(n){return n>=55296&&n<=57343},Ji=function(n){return We(n)||n>=D2&&n<=R2||n>=N2&&n<=g3},y3=function(n){return n>=N2&&n<=w3},S3=function(n){return n>=D2&&n<=C3},E3=function(n){return y3(n)||S3(n)},x3=function(n){return n>=A3},gl=function(n){return n===Tc||n===KQ||n===qQ},_c=function(n){return E3(n)||x3(n)||n===YQ},kg=function(n){return _c(n)||We(n)||n===ln},I3=function(n){return n>=u3&&n<=d3||n===h3||n>=f3&&n<=p3||n===m3},Fr=function(n,t){return n!==HA?!1:t!==Tc},vl=function(n,t,e){return n===ln?_c(t)||Fr(t,e):_c(n)?!0:!!(n===HA&&Fr(n,t))},Bd=function(n,t,e){return n===pi||n===ln?We(t)?!0:t===da&&We(e):We(n===da?t:n)},F3=function(n){var t=0,e=1;(n[t]===pi||n[t]===ln)&&(n[t]===ln&&(e=-1),t++);for(var s=[];We(n[t]);)s.push(n[t++]);var r=s.length?parseInt(ue.apply(void 0,s),10):0;n[t]===da&&t++;for(var i=[];We(n[t]);)i.push(n[t++]);var o=i.length,A=o?parseInt(ue.apply(void 0,i),10):0;(n[t]===k2||n[t]===L2)&&t++;var a=1;(n[t]===pi||n[t]===ln)&&(n[t]===ln&&(a=-1),t++);for(var l=[];We(n[t]);)l.push(n[t++]);var c=l.length?parseInt(ue.apply(void 0,l),10):0;return e*(r+A*Math.pow(10,-o))*Math.pow(10,a*c)},T3={type:2},_3={type:3},M3={type:4},Q3={type:13},U3={type:8},P3={type:21},N3={type:9},L3={type:10},D3={type:11},k3={type:12},R3={type:14},wl={type:23},H3={type:1},O3={type:25},V3={type:24},W3={type:26},G3={type:27},K3={type:28},q3={type:29},z3={type:31},Qh={type:32},H2=(function(){function n(){this._value=[]}return n.prototype.write=function(t){this._value=this._value.concat(_u(t))},n.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==Qh;)t.push(e),e=this.consumeToken();return t},n.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case hl:return this.consumeStringToken(hl);case zQ:var e=this.peekCodePoint(0),s=this.peekCodePoint(1),r=this.peekCodePoint(2);if(kg(e)||Fr(s,r)){var i=vl(e,s,r)?GQ:WQ,o=this.consumeName();return{type:5,value:o,flags:i}}break;case $Q:if(this.peekCodePoint(0)===lA)return this.consumeCodePoint(),Q3;break;case fl:return this.consumeStringToken(fl);case pl:return T3;case cA:return _3;case wd:if(this.peekCodePoint(0)===lA)return this.consumeCodePoint(),R3;break;case pi:if(Bd(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case a3:return M3;case ln:var A=t,a=this.peekCodePoint(0),l=this.peekCodePoint(1);if(Bd(A,a,l))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(vl(A,a,l))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(a===ln&&l===ZQ)return this.consumeCodePoint(),this.consumeCodePoint(),V3;break;case da:if(Bd(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case Ng:if(this.peekCodePoint(0)===wd)for(this.consumeCodePoint();;){var c=this.consumeCodePoint();if(c===wd&&(c=this.consumeCodePoint(),c===Ng))return this.consumeToken();if(c===fs)return this.consumeToken()}break;case l3:return W3;case c3:return G3;case JQ:if(this.peekCodePoint(0)===jQ&&this.peekCodePoint(1)===ln&&this.peekCodePoint(2)===ln)return this.consumeCodePoint(),this.consumeCodePoint(),O3;break;case t3:var u=this.peekCodePoint(0),d=this.peekCodePoint(1),p=this.peekCodePoint(2);if(vl(u,d,p)){var o=this.consumeName();return{type:7,value:o}}break;case e3:return K3;case HA:if(Fr(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case n3:return q3;case s3:if(this.peekCodePoint(0)===lA)return this.consumeCodePoint(),U3;break;case r3:return D3;case i3:return k3;case v3:case B3:var h=this.peekCodePoint(0),m=this.peekCodePoint(1);return h===pi&&(Ji(m)||m===ml)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case Lg:if(this.peekCodePoint(0)===lA)return this.consumeCodePoint(),N3;if(this.peekCodePoint(0)===Lg)return this.consumeCodePoint(),P3;break;case o3:if(this.peekCodePoint(0)===lA)return this.consumeCodePoint(),L3;break;case fs:return Qh}return gl(t)?(this.consumeWhiteSpace(),z3):We(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):_c(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:ue(t)}},n.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},n.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},n.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},n.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();Ji(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var s=!1;e===ml&&t.length<6;)t.push(e),e=this.consumeCodePoint(),s=!0;if(s){var r=parseInt(ue.apply(void 0,t.map(function(a){return a===ml?P2:a})),16),i=parseInt(ue.apply(void 0,t.map(function(a){return a===ml?R2:a})),16);return{type:30,start:r,end:i}}var o=parseInt(ue.apply(void 0,t),16);if(this.peekCodePoint(0)===ln&&Ji(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var A=[];Ji(e)&&A.length<6;)A.push(e),e=this.consumeCodePoint();var i=parseInt(ue.apply(void 0,A),16);return{type:30,start:o,end:i}}else return{type:30,start:o,end:o}},n.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===pl?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===pl?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},n.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===fs)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===fl||e===hl){var s=this.consumeStringToken(this.consumeCodePoint());return s.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===fs||this.peekCodePoint(0)===cA)?(this.consumeCodePoint(),{type:22,value:s.value}):(this.consumeBadUrlRemnants(),wl)}for(;;){var r=this.consumeCodePoint();if(r===fs||r===cA)return{type:22,value:ue.apply(void 0,t)};if(gl(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===fs||this.peekCodePoint(0)===cA?(this.consumeCodePoint(),{type:22,value:ue.apply(void 0,t)}):(this.consumeBadUrlRemnants(),wl);if(r===hl||r===fl||r===pl||I3(r))return this.consumeBadUrlRemnants(),wl;if(r===HA)if(Fr(r,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),wl;else t.push(r)}},n.prototype.consumeWhiteSpace=function(){for(;gl(this.peekCodePoint(0));)this.consumeCodePoint()},n.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===cA||t===fs)return;Fr(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},n.prototype.consumeStringSlice=function(t){for(var e=5e4,s="";t>0;){var r=Math.min(e,t);s+=ue.apply(void 0,this._value.splice(0,r)),t-=r}return this._value.shift(),s},n.prototype.consumeStringToken=function(t){var e="",s=0;do{var r=this._value[s];if(r===fs||r===void 0||r===t)return e+=this.consumeStringSlice(s),{type:0,value:e};if(r===Tc)return this._value.splice(0,s),H3;if(r===HA){var i=this._value[s+1];i!==fs&&i!==void 0&&(i===Tc?(e+=this.consumeStringSlice(s),s=-1,this._value.shift()):Fr(r,i)&&(e+=this.consumeStringSlice(s),e+=ue(this.consumeEscapedCodePoint()),s=-1))}s++}while(!0)},n.prototype.consumeNumber=function(){var t=[],e=Ra,s=this.peekCodePoint(0);for((s===pi||s===ln)&&t.push(this.consumeCodePoint());We(this.peekCodePoint(0));)t.push(this.consumeCodePoint());s=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(s===da&&We(r))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=Pg;We(this.peekCodePoint(0));)t.push(this.consumeCodePoint());s=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((s===k2||s===L2)&&((r===pi||r===ln)&&We(i)||We(r)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=Pg;We(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[F3(t),e]},n.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],s=t[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),o=this.peekCodePoint(2);if(vl(r,i,o)){var A=this.consumeName();return{type:15,number:e,flags:s,unit:A}}return r===XQ?(this.consumeCodePoint(),{type:16,number:e,flags:s}):{type:17,number:e,flags:s}},n.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(Ji(t)){for(var e=ue(t);Ji(this.peekCodePoint(0))&&e.length<6;)e+=ue(this.consumeCodePoint());gl(this.peekCodePoint(0))&&this.consumeCodePoint();var s=parseInt(e,16);return s===0||b3(s)||s>1114111?Dg:s}return t===fs?Dg:t},n.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(kg(e))t+=ue(e);else if(Fr(e,this.peekCodePoint(0)))t+=ue(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(e),t}},n})(),O2=(function(){function n(t){this._tokens=t}return n.create=function(t){var e=new H2;return e.write(t),new n(e.read())},n.parseValue=function(t){return n.create(t).parseComponentValue()},n.parseValues=function(t){return n.create(t).parseComponentValues()},n.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},n.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(e.type===32)return t;t.push(e),t.push()}},n.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},n.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},s=this.consumeToken();;){if(s.type===32||X3(s,t))return e;this.reconsumeToken(s),e.values.push(this.consumeComponentValue()),s=this.consumeToken()}},n.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var s=this.consumeToken();if(s.type===32||s.type===3)return e;this.reconsumeToken(s),e.values.push(this.consumeComponentValue())}},n.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?Qh:t},n.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},n})(),Ha=function(n){return n.type===15},iA=function(n){return n.type===17},qt=function(n){return n.type===20},$3=function(n){return n.type===0},Uh=function(n,t){return qt(n)&&n.value===t},V2=function(n){return n.type!==31},Ko=function(n){return n.type!==31&&n.type!==4},Rs=function(n){var t=[],e=[];return n.forEach(function(s){if(s.type===4){if(e.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(e),e=[];return}s.type!==31&&e.push(s)}),e.length&&t.push(e),t},X3=function(n,t){return t===11&&n.type===12||t===28&&n.type===29?!0:t===2&&n.type===3},jr=function(n){return n.type===17||n.type===15},me=function(n){return n.type===16||jr(n)},W2=function(n){return n.length>1?[n[0],n[1]]:[n[0]]},Le={type:17,number:0,flags:Ra},Ep={type:16,number:50,flags:Ra},Lr={type:16,number:100,flags:Ra},CA=function(n,t,e){var s=n[0],r=n[1];return[Xt(s,t),Xt(typeof r<"u"?r:s,e)]},Xt=function(n,t){if(n.type===16)return n.number/100*t;if(Ha(n))switch(n.unit){case"rem":case"em":return 16*n.number;case"px":default:return n.number}return n.number},G2="deg",K2="grad",q2="rad",z2="turn",Mu={name:"angle",parse:function(n,t){if(t.type===15)switch(t.unit){case G2:return Math.PI*t.number/180;case K2:return Math.PI/200*t.number;case q2:return t.number;case z2:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},$2=function(n){return n.type===15&&(n.unit===G2||n.unit===K2||n.unit===q2||n.unit===z2)},X2=function(n){var t=n.filter(qt).map(function(e){return e.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Le,Le];case"to top":case"bottom":return qn(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Le,Lr];case"to right":case"left":return qn(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Lr,Lr];case"to bottom":case"top":return qn(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Lr,Le];case"to left":case"right":return qn(270)}return 0},qn=function(n){return Math.PI*n/180},Vr={name:"color",parse:function(n,t){if(t.type===18){var e=Y3[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return e(n,t.values)}if(t.type===5){if(t.value.length===3){var s=t.value.substring(0,1),r=t.value.substring(1,2),i=t.value.substring(2,3);return Dr(parseInt(s+s,16),parseInt(r+r,16),parseInt(i+i,16),1)}if(t.value.length===4){var s=t.value.substring(0,1),r=t.value.substring(1,2),i=t.value.substring(2,3),o=t.value.substring(3,4);return Dr(parseInt(s+s,16),parseInt(r+r,16),parseInt(i+i,16),parseInt(o+o,16)/255)}if(t.value.length===6){var s=t.value.substring(0,2),r=t.value.substring(2,4),i=t.value.substring(4,6);return Dr(parseInt(s,16),parseInt(r,16),parseInt(i,16),1)}if(t.value.length===8){var s=t.value.substring(0,2),r=t.value.substring(2,4),i=t.value.substring(4,6),o=t.value.substring(6,8);return Dr(parseInt(s,16),parseInt(r,16),parseInt(i,16),parseInt(o,16)/255)}}if(t.type===20){var A=or[t.value.toUpperCase()];if(typeof A<"u")return A}return or.TRANSPARENT}},Wr=function(n){return(255&n)===0},Ie=function(n){var t=255&n,e=255&n>>8,s=255&n>>16,r=255&n>>24;return t<255?"rgba("+r+","+s+","+e+","+t/255+")":"rgb("+r+","+s+","+e+")"},Dr=function(n,t,e,s){return(n<<24|t<<16|e<<8|Math.round(s*255)<<0)>>>0},Rg=function(n,t){if(n.type===17)return n.number;if(n.type===16){var e=t===3?1:255;return t===3?n.number/100*e:Math.round(n.number/100*e)}return 0},Hg=function(n,t){var e=t.filter(Ko);if(e.length===3){var s=e.map(Rg),r=s[0],i=s[1],o=s[2];return Dr(r,i,o,1)}if(e.length===4){var A=e.map(Rg),r=A[0],i=A[1],o=A[2],a=A[3];return Dr(r,i,o,a)}return 0};function Cd(n,t,e){return e<0&&(e+=1),e>=1&&(e-=1),e<1/6?(t-n)*e*6+n:e<1/2?t:e<2/3?(t-n)*6*(2/3-e)+n:n}var Og=function(n,t){var e=t.filter(Ko),s=e[0],r=e[1],i=e[2],o=e[3],A=(s.type===17?qn(s.number):Mu.parse(n,s))/(Math.PI*2),a=me(r)?r.number/100:0,l=me(i)?i.number/100:0,c=typeof o<"u"&&me(o)?Xt(o,1):1;if(a===0)return Dr(l*255,l*255,l*255,1);var u=l<=.5?l*(a+1):l+a-l*a,d=l*2-u,p=Cd(d,u,A+1/3),h=Cd(d,u,A),m=Cd(d,u,A-1/3);return Dr(p*255,h*255,m*255,c)},Y3={hsl:Og,hsla:Og,rgb:Hg,rgba:Hg},OA=function(n,t){return Vr.parse(n,O2.create(t).parseComponentValue())},or={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},j3={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(n,t){return t.map(function(e){if(qt(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},J3={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Qu=function(n,t){var e=Vr.parse(n,t[0]),s=t[1];return s&&me(s)?{color:e,stop:s}:{color:e,stop:null}},Vg=function(n,t){var e=n[0],s=n[n.length-1];e.stop===null&&(e.stop=Le),s.stop===null&&(s.stop=Lr);for(var r=[],i=0,o=0;o<n.length;o++){var A=n[o].stop;if(A!==null){var a=Xt(A,t);a>i?r.push(a):r.push(i),i=a}else r.push(null)}for(var l=null,o=0;o<r.length;o++){var c=r[o];if(c===null)l===null&&(l=o);else if(l!==null){for(var u=o-l,d=r[l-1],p=(c-d)/(u+1),h=1;h<=u;h++)r[l+h-1]=p*h;l=null}}return n.map(function(m,g){var v=m.color;return{color:v,stop:Math.max(Math.min(1,r[g]/t),0)}})},Z3=function(n,t,e){var s=t/2,r=e/2,i=Xt(n[0],t)-s,o=r-Xt(n[1],e);return(Math.atan2(o,i)+Math.PI*2)%(Math.PI*2)},tU=function(n,t,e){var s=typeof n=="number"?n:Z3(n,t,e),r=Math.abs(t*Math.sin(s))+Math.abs(e*Math.cos(s)),i=t/2,o=e/2,A=r/2,a=Math.sin(s-Math.PI/2)*A,l=Math.cos(s-Math.PI/2)*A;return[r,i-l,i+l,o-a,o+a]},ts=function(n,t){return Math.sqrt(n*n+t*t)},Wg=function(n,t,e,s,r){var i=[[0,0],[0,t],[n,0],[n,t]];return i.reduce(function(o,A){var a=A[0],l=A[1],c=ts(e-a,s-l);return(r?c<o.optimumDistance:c>o.optimumDistance)?{optimumCorner:A,optimumDistance:c}:o},{optimumDistance:r?1/0:-1/0,optimumCorner:null}).optimumCorner},eU=function(n,t,e,s,r){var i=0,o=0;switch(n.size){case 0:n.shape===0?i=o=Math.min(Math.abs(t),Math.abs(t-s),Math.abs(e),Math.abs(e-r)):n.shape===1&&(i=Math.min(Math.abs(t),Math.abs(t-s)),o=Math.min(Math.abs(e),Math.abs(e-r)));break;case 2:if(n.shape===0)i=o=Math.min(ts(t,e),ts(t,e-r),ts(t-s,e),ts(t-s,e-r));else if(n.shape===1){var A=Math.min(Math.abs(e),Math.abs(e-r))/Math.min(Math.abs(t),Math.abs(t-s)),a=Wg(s,r,t,e,!0),l=a[0],c=a[1];i=ts(l-t,(c-e)/A),o=A*i}break;case 1:n.shape===0?i=o=Math.max(Math.abs(t),Math.abs(t-s),Math.abs(e),Math.abs(e-r)):n.shape===1&&(i=Math.max(Math.abs(t),Math.abs(t-s)),o=Math.max(Math.abs(e),Math.abs(e-r)));break;case 3:if(n.shape===0)i=o=Math.max(ts(t,e),ts(t,e-r),ts(t-s,e),ts(t-s,e-r));else if(n.shape===1){var A=Math.max(Math.abs(e),Math.abs(e-r))/Math.max(Math.abs(t),Math.abs(t-s)),u=Wg(s,r,t,e,!1),l=u[0],c=u[1];i=ts(l-t,(c-e)/A),o=A*i}break}return Array.isArray(n.size)&&(i=Xt(n.size[0],s),o=n.size.length===2?Xt(n.size[1],r):i),[i,o]},nU=function(n,t){var e=qn(180),s=[];return Rs(t).forEach(function(r,i){if(i===0){var o=r[0];if(o.type===20&&o.value==="to"){e=X2(r);return}else if($2(o)){e=Mu.parse(n,o);return}}var A=Qu(n,r);s.push(A)}),{angle:e,stops:s,type:1}},Bl=function(n,t){var e=qn(180),s=[];return Rs(t).forEach(function(r,i){if(i===0){var o=r[0];if(o.type===20&&["top","left","right","bottom"].indexOf(o.value)!==-1){e=X2(r);return}else if($2(o)){e=(Mu.parse(n,o)+qn(270))%qn(360);return}}var A=Qu(n,r);s.push(A)}),{angle:e,stops:s,type:1}},sU=function(n,t){var e=qn(180),s=[],r=1,i=0,o=3,A=[];return Rs(t).forEach(function(a,l){var c=a[0];if(l===0){if(qt(c)&&c.value==="linear"){r=1;return}else if(qt(c)&&c.value==="radial"){r=2;return}}if(c.type===18){if(c.name==="from"){var u=Vr.parse(n,c.values[0]);s.push({stop:Le,color:u})}else if(c.name==="to"){var u=Vr.parse(n,c.values[0]);s.push({stop:Lr,color:u})}else if(c.name==="color-stop"){var d=c.values.filter(Ko);if(d.length===2){var u=Vr.parse(n,d[1]),p=d[0];iA(p)&&s.push({stop:{type:16,number:p.number*100,flags:p.flags},color:u})}}}}),r===1?{angle:(e+qn(180))%qn(360),stops:s,type:r}:{size:o,shape:i,stops:s,position:A,type:r}},Y2="closest-side",j2="farthest-side",J2="closest-corner",Z2="farthest-corner",tB="circle",eB="ellipse",nB="cover",sB="contain",rU=function(n,t){var e=0,s=3,r=[],i=[];return Rs(t).forEach(function(o,A){var a=!0;if(A===0){var l=!1;a=o.reduce(function(u,d){if(l)if(qt(d))switch(d.value){case"center":return i.push(Ep),u;case"top":case"left":return i.push(Le),u;case"right":case"bottom":return i.push(Lr),u}else(me(d)||jr(d))&&i.push(d);else if(qt(d))switch(d.value){case tB:return e=0,!1;case eB:return e=1,!1;case"at":return l=!0,!1;case Y2:return s=0,!1;case nB:case j2:return s=1,!1;case sB:case J2:return s=2,!1;case Z2:return s=3,!1}else if(jr(d)||me(d))return Array.isArray(s)||(s=[]),s.push(d),!1;return u},a)}if(a){var c=Qu(n,o);r.push(c)}}),{size:s,shape:e,stops:r,position:i,type:2}},Cl=function(n,t){var e=0,s=3,r=[],i=[];return Rs(t).forEach(function(o,A){var a=!0;if(A===0?a=o.reduce(function(c,u){if(qt(u))switch(u.value){case"center":return i.push(Ep),!1;case"top":case"left":return i.push(Le),!1;case"right":case"bottom":return i.push(Lr),!1}else if(me(u)||jr(u))return i.push(u),!1;return c},a):A===1&&(a=o.reduce(function(c,u){if(qt(u))switch(u.value){case tB:return e=0,!1;case eB:return e=1,!1;case sB:case Y2:return s=0,!1;case j2:return s=1,!1;case J2:return s=2,!1;case nB:case Z2:return s=3,!1}else if(jr(u)||me(u))return Array.isArray(s)||(s=[]),s.push(u),!1;return c},a)),a){var l=Qu(n,o);r.push(l)}}),{size:s,shape:e,stops:r,position:i,type:2}},iU=function(n){return n.type===1},oU=function(n){return n.type===2},xp={name:"image",parse:function(n,t){if(t.type===22){var e={url:t.value,type:0};return n.cache.addImage(t.value),e}if(t.type===18){var s=rB[t.name];if(typeof s>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return s(n,t.values)}throw new Error("Unsupported image type "+t.type)}};function AU(n){return!(n.type===20&&n.value==="none")&&(n.type!==18||!!rB[n.name])}var rB={"linear-gradient":nU,"-moz-linear-gradient":Bl,"-ms-linear-gradient":Bl,"-o-linear-gradient":Bl,"-webkit-linear-gradient":Bl,"radial-gradient":rU,"-moz-radial-gradient":Cl,"-ms-radial-gradient":Cl,"-o-radial-gradient":Cl,"-webkit-radial-gradient":Cl,"-webkit-gradient":sU},aU={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(n,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t.filter(function(s){return Ko(s)&&AU(s)}).map(function(s){return xp.parse(n,s)})}},lU={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(n,t){return t.map(function(e){if(qt(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},cU={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(n,t){return Rs(t).map(function(e){return e.filter(me)}).map(W2)}},uU={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(n,t){return Rs(t).map(function(e){return e.filter(qt).map(function(s){return s.value}).join(" ")}).map(dU)}},dU=function(n){switch(n){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Uo;(function(n){n.AUTO="auto",n.CONTAIN="contain",n.COVER="cover"})(Uo||(Uo={}));var hU={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(n,t){return Rs(t).map(function(e){return e.filter(fU)})}},fU=function(n){return qt(n)||me(n)},Uu=function(n){return{name:"border-"+n+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},pU=Uu("top"),mU=Uu("right"),gU=Uu("bottom"),vU=Uu("left"),Pu=function(n){return{name:"border-radius-"+n,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return W2(e.filter(me))}}},wU=Pu("top-left"),BU=Pu("top-right"),CU=Pu("bottom-right"),bU=Pu("bottom-left"),Nu=function(n){return{name:"border-"+n+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},yU=Nu("top"),SU=Nu("right"),EU=Nu("bottom"),xU=Nu("left"),Lu=function(n){return{name:"border-"+n+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Ha(e)?e.number:0}}},IU=Lu("top"),FU=Lu("right"),TU=Lu("bottom"),_U=Lu("left"),MU={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},QU={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(n,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},UU={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(n,t){return t.filter(qt).reduce(function(e,s){return e|PU(s.value)},0)}},PU=function(n){switch(n){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},NU={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},LU={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(n,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},Mc;(function(n){n.NORMAL="normal",n.STRICT="strict"})(Mc||(Mc={}));var DU={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"strict":return Mc.STRICT;case"normal":default:return Mc.NORMAL}}},kU={name:"line-height",initialValue:"normal",prefix:!1,type:4},Gg=function(n,t){return qt(n)&&n.value==="normal"?1.2*t:n.type===17?t*n.number:me(n)?Xt(n,t):t},RU={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(n,t){return t.type===20&&t.value==="none"?null:xp.parse(n,t)}},HU={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(n,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},Ph={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Du=function(n){return{name:"margin-"+n,initialValue:"0",prefix:!1,type:4}},OU=Du("top"),VU=Du("right"),WU=Du("bottom"),GU=Du("left"),KU={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(n,t){return t.filter(qt).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},qU={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},ku=function(n){return{name:"padding-"+n,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},zU=ku("top"),$U=ku("right"),XU=ku("bottom"),YU=ku("left"),jU={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(n,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},JU={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(n,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},ZU={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.length===1&&Uh(t[0],"none")?[]:Rs(t).map(function(e){for(var s={color:or.TRANSPARENT,offsetX:Le,offsetY:Le,blur:Le},r=0,i=0;i<e.length;i++){var o=e[i];jr(o)?(r===0?s.offsetX=o:r===1?s.offsetY=o:s.blur=o,r++):s.color=Vr.parse(n,o)}return s})}},t4={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},e4={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(n,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var e=r4[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return e(t.values)}return null}},n4=function(n){var t=n.filter(function(e){return e.type===17}).map(function(e){return e.number});return t.length===6?t:null},s4=function(n){var t=n.filter(function(a){return a.type===17}).map(function(a){return a.number}),e=t[0],s=t[1];t[2],t[3];var r=t[4],i=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var o=t[12],A=t[13];return t[14],t[15],t.length===16?[e,s,r,i,o,A]:null},r4={matrix:n4,matrix3d:s4},Kg={type:16,number:50,flags:Ra},i4=[Kg,Kg],o4={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(n,t){var e=t.filter(me);return e.length!==2?i4:[e[0],e[1]]}},A4={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},VA;(function(n){n.NORMAL="normal",n.BREAK_ALL="break-all",n.KEEP_ALL="keep-all"})(VA||(VA={}));var a4={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"break-all":return VA.BREAK_ALL;case"keep-all":return VA.KEEP_ALL;case"normal":default:return VA.NORMAL}}},l4={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(n,t){if(t.type===20)return{auto:!0,order:0};if(iA(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},iB={name:"time",parse:function(n,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},c4={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(n,t){return iA(t)?t.number:1}},u4={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},d4={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(n,t){return t.filter(qt).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return e!==0})}},h4={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(n,t){var e=[],s=[];return t.forEach(function(r){switch(r.type){case 20:case 0:e.push(r.value);break;case 17:e.push(r.number.toString());break;case 4:s.push(e.join(" ")),e.length=0;break}}),e.length&&s.push(e.join(" ")),s.map(function(r){return r.indexOf(" ")===-1?r:"'"+r+"'"})}},f4={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},p4={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(n,t){if(iA(t))return t.number;if(qt(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},m4={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.filter(qt).map(function(e){return e.value})}},g4={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},ye=function(n,t){return(n&t)!==0},v4={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(n,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t}},w4={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;for(var s=[],r=t.filter(V2),i=0;i<r.length;i++){var o=r[i],A=r[i+1];if(o.type===20){var a=A&&iA(A)?A.number:1;s.push({counter:o.value,increment:a})}}return s}},B4={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return[];for(var e=[],s=t.filter(V2),r=0;r<s.length;r++){var i=s[r],o=s[r+1];if(qt(i)&&i.value!=="none"){var A=o&&iA(o)?o.number:0;e.push({counter:i.value,reset:A})}}return e}},C4={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(n,t){return t.filter(Ha).map(function(e){return iB.parse(n,e)})}},b4={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;var s=[],r=t.filter($3);if(r.length%2!==0)return null;for(var i=0;i<r.length;i+=2){var o=r[i].value,A=r[i+1].value;s.push({open:o,close:A})}return s}},qg=function(n,t,e){if(!n)return"";var s=n[Math.min(t,n.length-1)];return s?e?s.open:s.close:""},y4={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.length===1&&Uh(t[0],"none")?[]:Rs(t).map(function(e){for(var s={color:255,offsetX:Le,offsetY:Le,blur:Le,spread:Le,inset:!1},r=0,i=0;i<e.length;i++){var o=e[i];Uh(o,"inset")?s.inset=!0:jr(o)?(r===0?s.offsetX=o:r===1?s.offsetY=o:r===2?s.blur=o:s.spread=o,r++):s.color=Vr.parse(n,o)}return s})}},S4={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(n,t){var e=[0,1,2],s=[];return t.filter(qt).forEach(function(r){switch(r.value){case"stroke":s.push(1);break;case"fill":s.push(0);break;case"markers":s.push(2);break}}),e.forEach(function(r){s.indexOf(r)===-1&&s.push(r)}),s}},E4={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},x4={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(n,t){return Ha(t)?t.number:0}},I4=(function(){function n(t,e){var s,r;this.animationDuration=dt(t,C4,e.animationDuration),this.backgroundClip=dt(t,j3,e.backgroundClip),this.backgroundColor=dt(t,J3,e.backgroundColor),this.backgroundImage=dt(t,aU,e.backgroundImage),this.backgroundOrigin=dt(t,lU,e.backgroundOrigin),this.backgroundPosition=dt(t,cU,e.backgroundPosition),this.backgroundRepeat=dt(t,uU,e.backgroundRepeat),this.backgroundSize=dt(t,hU,e.backgroundSize),this.borderTopColor=dt(t,pU,e.borderTopColor),this.borderRightColor=dt(t,mU,e.borderRightColor),this.borderBottomColor=dt(t,gU,e.borderBottomColor),this.borderLeftColor=dt(t,vU,e.borderLeftColor),this.borderTopLeftRadius=dt(t,wU,e.borderTopLeftRadius),this.borderTopRightRadius=dt(t,BU,e.borderTopRightRadius),this.borderBottomRightRadius=dt(t,CU,e.borderBottomRightRadius),this.borderBottomLeftRadius=dt(t,bU,e.borderBottomLeftRadius),this.borderTopStyle=dt(t,yU,e.borderTopStyle),this.borderRightStyle=dt(t,SU,e.borderRightStyle),this.borderBottomStyle=dt(t,EU,e.borderBottomStyle),this.borderLeftStyle=dt(t,xU,e.borderLeftStyle),this.borderTopWidth=dt(t,IU,e.borderTopWidth),this.borderRightWidth=dt(t,FU,e.borderRightWidth),this.borderBottomWidth=dt(t,TU,e.borderBottomWidth),this.borderLeftWidth=dt(t,_U,e.borderLeftWidth),this.boxShadow=dt(t,y4,e.boxShadow),this.color=dt(t,MU,e.color),this.direction=dt(t,QU,e.direction),this.display=dt(t,UU,e.display),this.float=dt(t,NU,e.cssFloat),this.fontFamily=dt(t,h4,e.fontFamily),this.fontSize=dt(t,f4,e.fontSize),this.fontStyle=dt(t,g4,e.fontStyle),this.fontVariant=dt(t,m4,e.fontVariant),this.fontWeight=dt(t,p4,e.fontWeight),this.letterSpacing=dt(t,LU,e.letterSpacing),this.lineBreak=dt(t,DU,e.lineBreak),this.lineHeight=dt(t,kU,e.lineHeight),this.listStyleImage=dt(t,RU,e.listStyleImage),this.listStylePosition=dt(t,HU,e.listStylePosition),this.listStyleType=dt(t,Ph,e.listStyleType),this.marginTop=dt(t,OU,e.marginTop),this.marginRight=dt(t,VU,e.marginRight),this.marginBottom=dt(t,WU,e.marginBottom),this.marginLeft=dt(t,GU,e.marginLeft),this.opacity=dt(t,c4,e.opacity);var i=dt(t,KU,e.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=dt(t,qU,e.overflowWrap),this.paddingTop=dt(t,zU,e.paddingTop),this.paddingRight=dt(t,$U,e.paddingRight),this.paddingBottom=dt(t,XU,e.paddingBottom),this.paddingLeft=dt(t,YU,e.paddingLeft),this.paintOrder=dt(t,S4,e.paintOrder),this.position=dt(t,JU,e.position),this.textAlign=dt(t,jU,e.textAlign),this.textDecorationColor=dt(t,u4,(s=e.textDecorationColor)!==null&&s!==void 0?s:e.color),this.textDecorationLine=dt(t,d4,(r=e.textDecorationLine)!==null&&r!==void 0?r:e.textDecoration),this.textShadow=dt(t,ZU,e.textShadow),this.textTransform=dt(t,t4,e.textTransform),this.transform=dt(t,e4,e.transform),this.transformOrigin=dt(t,o4,e.transformOrigin),this.visibility=dt(t,A4,e.visibility),this.webkitTextStrokeColor=dt(t,E4,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=dt(t,x4,e.webkitTextStrokeWidth),this.wordBreak=dt(t,a4,e.wordBreak),this.zIndex=dt(t,l4,e.zIndex)}return n.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},n.prototype.isTransparent=function(){return Wr(this.backgroundColor)},n.prototype.isTransformed=function(){return this.transform!==null},n.prototype.isPositioned=function(){return this.position!==0},n.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},n.prototype.isFloating=function(){return this.float!==0},n.prototype.isInlineLevel=function(){return ye(this.display,4)||ye(this.display,33554432)||ye(this.display,268435456)||ye(this.display,536870912)||ye(this.display,67108864)||ye(this.display,134217728)},n})(),F4=(function(){function n(t,e){this.content=dt(t,v4,e.content),this.quotes=dt(t,b4,e.quotes)}return n})(),zg=(function(){function n(t,e){this.counterIncrement=dt(t,w4,e.counterIncrement),this.counterReset=dt(t,B4,e.counterReset)}return n})(),dt=function(n,t,e){var s=new H2,r=e!==null&&typeof e<"u"?e.toString():t.initialValue;s.write(r);var i=new O2(s.read());switch(t.type){case 2:var o=i.parseComponentValue();return t.parse(n,qt(o)?o.value:t.initialValue);case 0:return t.parse(n,i.parseComponentValue());case 1:return t.parse(n,i.parseComponentValues());case 4:return i.parseComponentValue();case 3:switch(t.format){case"angle":return Mu.parse(n,i.parseComponentValue());case"color":return Vr.parse(n,i.parseComponentValue());case"image":return xp.parse(n,i.parseComponentValue());case"length":var A=i.parseComponentValue();return jr(A)?A:Le;case"length-percentage":var a=i.parseComponentValue();return me(a)?a:Le;case"time":return iB.parse(n,i.parseComponentValue())}break}},T4="data-html2canvas-debug",_4=function(n){var t=n.getAttribute(T4);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Nh=function(n,t){var e=_4(n);return e===1||t===e},Hs=(function(){function n(t,e){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,Nh(e,3))debugger;this.styles=new I4(t,window.getComputedStyle(e,null)),kh(e)&&(this.styles.animationDuration.some(function(s){return s>0})&&(e.style.animationDuration="0s"),this.styles.transform!==null&&(e.style.transform="none")),this.bounds=Tu(this.context,e),Nh(e,4)&&(this.flags|=16)}return n})(),M4="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",$g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bA=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var bl=0;bl<$g.length;bl++)bA[$g.charCodeAt(bl)]=bl;var Q4=function(n){var t=n.length*.75,e=n.length,s,r=0,i,o,A,a;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);var l=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),c=Array.isArray(l)?l:new Uint8Array(l);for(s=0;s<e;s+=4)i=bA[n.charCodeAt(s)],o=bA[n.charCodeAt(s+1)],A=bA[n.charCodeAt(s+2)],a=bA[n.charCodeAt(s+3)],c[r++]=i<<2|o>>4,c[r++]=(o&15)<<4|A>>2,c[r++]=(A&3)<<6|a&63;return l},U4=function(n){for(var t=n.length,e=[],s=0;s<t;s+=2)e.push(n[s+1]<<8|n[s]);return e},P4=function(n){for(var t=n.length,e=[],s=0;s<t;s+=4)e.push(n[s+3]<<24|n[s+2]<<16|n[s+1]<<8|n[s]);return e},Ti=5,Ip=11,bd=2,N4=Ip-Ti,oB=65536>>Ti,L4=1<<Ti,yd=L4-1,D4=1024>>Ti,k4=oB+D4,R4=k4,H4=32,O4=R4+H4,V4=65536>>Ip,W4=1<<N4,G4=W4-1,Xg=function(n,t,e){return n.slice?n.slice(t,e):new Uint16Array(Array.prototype.slice.call(n,t,e))},K4=function(n,t,e){return n.slice?n.slice(t,e):new Uint32Array(Array.prototype.slice.call(n,t,e))},q4=function(n,t){var e=Q4(n),s=Array.isArray(e)?P4(e):new Uint32Array(e),r=Array.isArray(e)?U4(e):new Uint16Array(e),i=24,o=Xg(r,i/2,s[4]/2),A=s[5]===2?Xg(r,(i+s[4])/2):K4(s,Math.ceil((i+s[4])/4));return new z4(s[0],s[1],s[2],s[3],o,A)},z4=(function(){function n(t,e,s,r,i,o){this.initialValue=t,this.errorValue=e,this.highStart=s,this.highValueIndex=r,this.index=i,this.data=o}return n.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>Ti],e=(e<<bd)+(t&yd),this.data[e];if(t<=65535)return e=this.index[oB+(t-55296>>Ti)],e=(e<<bd)+(t&yd),this.data[e];if(t<this.highStart)return e=O4-V4+(t>>Ip),e=this.index[e],e+=t>>Ti&G4,e=this.index[e],e=(e<<bd)+(t&yd),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},n})(),Yg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$4=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var yl=0;yl<Yg.length;yl++)$4[Yg.charCodeAt(yl)]=yl;var X4=1,Sd=2,Ed=3,jg=4,Jg=5,Y4=7,Zg=8,xd=9,Id=10,t0=11,e0=12,n0=13,s0=14,Fd=15,j4=function(n){for(var t=[],e=0,s=n.length;e<s;){var r=n.charCodeAt(e++);if(r>=55296&&r<=56319&&e<s){var i=n.charCodeAt(e++);(i&64512)===56320?t.push(((r&1023)<<10)+(i&1023)+65536):(t.push(r),e--)}else t.push(r)}return t},J4=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,n);var e=n.length;if(!e)return"";for(var s=[],r=-1,i="";++r<e;){var o=n[r];o<=65535?s.push(o):(o-=65536,s.push((o>>10)+55296,o%1024+56320)),(r+1===e||s.length>16384)&&(i+=String.fromCharCode.apply(String,s),s.length=0)}return i},Z4=q4(M4),Nn="",Td="",tP=function(n){return Z4.get(n)},eP=function(n,t,e){var s=e-2,r=t[s],i=t[e-1],o=t[e];if(i===Sd&&o===Ed)return Nn;if(i===Sd||i===Ed||i===jg||o===Sd||o===Ed||o===jg)return Td;if(i===Zg&&[Zg,xd,t0,e0].indexOf(o)!==-1||(i===t0||i===xd)&&(o===xd||o===Id)||(i===e0||i===Id)&&o===Id||o===n0||o===Jg||o===Y4||i===X4)return Nn;if(i===n0&&o===s0){for(;r===Jg;)r=t[--s];if(r===s0)return Nn}if(i===Fd&&o===Fd){for(var A=0;r===Fd;)A++,r=t[--s];if(A%2===0)return Nn}return Td},nP=function(n){var t=j4(n),e=t.length,s=0,r=0,i=t.map(tP);return{next:function(){if(s>=e)return{done:!0,value:null};for(var o=Nn;s<e&&(o=eP(t,i,++s))===Nn;);if(o!==Nn||s===e){var A=J4.apply(null,t.slice(r,s));return r=s,{value:A,done:!1}}return{done:!0,value:null}}}},sP=function(n){for(var t=nP(n),e=[],s;!(s=t.next()).done;)s.value&&e.push(s.value.slice());return e},rP=function(n){var t=123;if(n.createRange){var e=n.createRange();if(e.getBoundingClientRect){var s=n.createElement("boundtest");s.style.height=t+"px",s.style.display="block",n.body.appendChild(s),e.selectNode(s);var r=e.getBoundingClientRect(),i=Math.round(r.height);if(n.body.removeChild(s),i===t)return!0}}return!1},iP=function(n){var t=n.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",n.body.appendChild(t);var e=n.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var s=t.firstChild,r=_u(s.data).map(function(a){return ue(a)}),i=0,o={},A=r.every(function(a,l){e.setStart(s,i),e.setEnd(s,i+a.length);var c=e.getBoundingClientRect();i+=a.length;var u=c.x>o.x||c.y>o.y;return o=c,l===0?!0:u});return n.body.removeChild(t),A},oP=function(){return typeof new Image().crossOrigin<"u"},AP=function(){return typeof new XMLHttpRequest().responseType=="string"},aP=function(n){var t=new Image,e=n.createElement("canvas"),s=e.getContext("2d");if(!s)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{s.drawImage(t,0,0),e.toDataURL()}catch{return!1}return!0},r0=function(n){return n[0]===0&&n[1]===255&&n[2]===0&&n[3]===255},lP=function(n){var t=n.createElement("canvas"),e=100;t.width=e,t.height=e;var s=t.getContext("2d");if(!s)return Promise.reject(!1);s.fillStyle="rgb(0, 255, 0)",s.fillRect(0,0,e,e);var r=new Image,i=t.toDataURL();r.src=i;var o=Lh(e,e,0,0,r);return s.fillStyle="red",s.fillRect(0,0,e,e),i0(o).then(function(A){s.drawImage(A,0,0);var a=s.getImageData(0,0,e,e).data;s.fillStyle="red",s.fillRect(0,0,e,e);var l=n.createElement("div");return l.style.backgroundImage="url("+i+")",l.style.height=e+"px",r0(a)?i0(Lh(e,e,0,0,l)):Promise.reject(!1)}).then(function(A){return s.drawImage(A,0,0),r0(s.getImageData(0,0,e,e).data)}).catch(function(){return!1})},Lh=function(n,t,e,s,r){var i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg"),A=document.createElementNS(i,"foreignObject");return o.setAttributeNS(null,"width",n.toString()),o.setAttributeNS(null,"height",t.toString()),A.setAttributeNS(null,"width","100%"),A.setAttributeNS(null,"height","100%"),A.setAttributeNS(null,"x",e.toString()),A.setAttributeNS(null,"y",s.toString()),A.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(A),A.appendChild(r),o},i0=function(n){return new Promise(function(t,e){var s=new Image;s.onload=function(){return t(s)},s.onerror=e,s.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(n))})},Pe={get SUPPORT_RANGE_BOUNDS(){var n=rP(document);return Object.defineProperty(Pe,"SUPPORT_RANGE_BOUNDS",{value:n}),n},get SUPPORT_WORD_BREAKING(){var n=Pe.SUPPORT_RANGE_BOUNDS&&iP(document);return Object.defineProperty(Pe,"SUPPORT_WORD_BREAKING",{value:n}),n},get SUPPORT_SVG_DRAWING(){var n=aP(document);return Object.defineProperty(Pe,"SUPPORT_SVG_DRAWING",{value:n}),n},get SUPPORT_FOREIGNOBJECT_DRAWING(){var n=typeof Array.from=="function"&&typeof window.fetch=="function"?lP(document):Promise.resolve(!1);return Object.defineProperty(Pe,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:n}),n},get SUPPORT_CORS_IMAGES(){var n=oP();return Object.defineProperty(Pe,"SUPPORT_CORS_IMAGES",{value:n}),n},get SUPPORT_RESPONSE_TYPE(){var n=AP();return Object.defineProperty(Pe,"SUPPORT_RESPONSE_TYPE",{value:n}),n},get SUPPORT_CORS_XHR(){var n="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Pe,"SUPPORT_CORS_XHR",{value:n}),n},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var n=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Pe,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:n}),n}},WA=(function(){function n(t,e){this.text=t,this.bounds=e}return n})(),cP=function(n,t,e,s){var r=hP(t,e),i=[],o=0;return r.forEach(function(A){if(e.textDecorationLine.length||A.trim().length>0)if(Pe.SUPPORT_RANGE_BOUNDS){var a=o0(s,o,A.length).getClientRects();if(a.length>1){var l=Fp(A),c=0;l.forEach(function(d){i.push(new WA(d,hr.fromDOMRectList(n,o0(s,c+o,d.length).getClientRects()))),c+=d.length})}else i.push(new WA(A,hr.fromDOMRectList(n,a)))}else{var u=s.splitText(A.length);i.push(new WA(A,uP(n,s))),s=u}else Pe.SUPPORT_RANGE_BOUNDS||(s=s.splitText(A.length));o+=A.length}),i},uP=function(n,t){var e=t.ownerDocument;if(e){var s=e.createElement("html2canvaswrapper");s.appendChild(t.cloneNode(!0));var r=t.parentNode;if(r){r.replaceChild(s,t);var i=Tu(n,s);return s.firstChild&&r.replaceChild(s.firstChild,s),i}}return hr.EMPTY},o0=function(n,t,e){var s=n.ownerDocument;if(!s)throw new Error("Node has no owner document");var r=s.createRange();return r.setStart(n,t),r.setEnd(n,t+e),r},Fp=function(n){if(Pe.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(n)).map(function(e){return e.segment})}return sP(n)},dP=function(n,t){if(Pe.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(e.segment(n)).map(function(s){return s.segment})}return pP(n,t)},hP=function(n,t){return t.letterSpacing!==0?Fp(n):dP(n,t)},fP=[32,160,4961,65792,65793,4153,4241],pP=function(n,t){for(var e=VQ(n,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),s=[],r,i=function(){if(r.value){var o=r.value.slice(),A=_u(o),a="";A.forEach(function(l){fP.indexOf(l)===-1?a+=ue(l):(a.length&&s.push(a),s.push(ue(l)),a="")}),a.length&&s.push(a)}};!(r=e.next()).done;)i();return s},mP=(function(){function n(t,e,s){this.text=gP(e.data,s.textTransform),this.textBounds=cP(t,this.text,s,e)}return n})(),gP=function(n,t){switch(t){case 1:return n.toLowerCase();case 3:return n.replace(vP,wP);case 2:return n.toUpperCase();default:return n}},vP=/(^|\s|:|-|\(|\))([a-z])/g,wP=function(n,t,e){return n.length>0?t+e.toUpperCase():n},AB=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.src=s.currentSrc||s.src,r.intrinsicWidth=s.naturalWidth,r.intrinsicHeight=s.naturalHeight,r.context.cache.addImage(r.src),r}return t})(Hs),aB=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.canvas=s,r.intrinsicWidth=s.width,r.intrinsicHeight=s.height,r}return t})(Hs),lB=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this,i=new XMLSerializer,o=Tu(e,s);return s.setAttribute("width",o.width+"px"),s.setAttribute("height",o.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(s)),r.intrinsicWidth=s.width.baseVal.value,r.intrinsicHeight=s.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t})(Hs),cB=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.value=s.value,r}return t})(Hs),Dh=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.start=s.start,r.reversed=typeof s.reversed=="boolean"&&s.reversed===!0,r}return t})(Hs),BP=[{type:15,flags:0,unit:"px",number:3}],CP=[{type:16,flags:0,number:50}],bP=function(n){return n.width>n.height?new hr(n.left+(n.width-n.height)/2,n.top,n.height,n.height):n.width<n.height?new hr(n.left,n.top+(n.height-n.width)/2,n.width,n.width):n},yP=function(n){var t=n.type===SP?new Array(n.value.length+1).join(""):n.value;return t.length===0?n.placeholder||"":t},Qc="checkbox",Uc="radio",SP="password",A0=707406591,Tp=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;switch(r.type=s.type.toLowerCase(),r.checked=s.checked,r.value=yP(s),(r.type===Qc||r.type===Uc)&&(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=bP(r.bounds)),r.type){case Qc:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=BP;break;case Uc:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=CP;break}return r}return t})(Hs),uB=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this,i=s.options[s.selectedIndex||0];return r.value=i&&i.text||"",r}return t})(Hs),dB=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.value=s.value,r}return t})(Hs),hB=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;r.src=s.src,r.width=parseInt(s.width,10)||0,r.height=parseInt(s.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(s.contentWindow&&s.contentWindow.document&&s.contentWindow.document.documentElement){r.tree=pB(e,s.contentWindow.document.documentElement);var i=s.contentWindow.document.documentElement?OA(e,getComputedStyle(s.contentWindow.document.documentElement).backgroundColor):or.TRANSPARENT,o=s.contentWindow.document.body?OA(e,getComputedStyle(s.contentWindow.document.body).backgroundColor):or.TRANSPARENT;r.backgroundColor=Wr(i)?Wr(o)?r.styles.backgroundColor:o:i}}catch{}return r}return t})(Hs),EP=["OL","UL","MENU"],jl=function(n,t,e,s){for(var r=t.firstChild,i=void 0;r;r=i)if(i=r.nextSibling,mB(r)&&r.data.trim().length>0)e.textNodes.push(new mP(n,r,e.styles));else if(mo(r))if(BB(r)&&r.assignedNodes)r.assignedNodes().forEach(function(A){return jl(n,A,e,s)});else{var o=fB(n,r);o.styles.isVisible()&&(xP(r,o,s)?o.flags|=4:IP(o.styles)&&(o.flags|=2),EP.indexOf(r.tagName)!==-1&&(o.flags|=8),e.elements.push(o),r.slot,r.shadowRoot?jl(n,r.shadowRoot,o,s):!Pc(r)&&!gB(r)&&!Nc(r)&&jl(n,r,o,s))}},fB=function(n,t){return Rh(t)?new AB(n,t):vB(t)?new aB(n,t):gB(t)?new lB(n,t):FP(t)?new cB(n,t):TP(t)?new Dh(n,t):_P(t)?new Tp(n,t):Nc(t)?new uB(n,t):Pc(t)?new dB(n,t):wB(t)?new hB(n,t):new Hs(n,t)},pB=function(n,t){var e=fB(n,t);return e.flags|=4,jl(n,t,e,e),e},xP=function(n,t,e){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||_p(n)&&e.styles.isTransparent()},IP=function(n){return n.isPositioned()||n.isFloating()},mB=function(n){return n.nodeType===Node.TEXT_NODE},mo=function(n){return n.nodeType===Node.ELEMENT_NODE},kh=function(n){return mo(n)&&typeof n.style<"u"&&!Jl(n)},Jl=function(n){return typeof n.className=="object"},FP=function(n){return n.tagName==="LI"},TP=function(n){return n.tagName==="OL"},_P=function(n){return n.tagName==="INPUT"},MP=function(n){return n.tagName==="HTML"},gB=function(n){return n.tagName==="svg"},_p=function(n){return n.tagName==="BODY"},vB=function(n){return n.tagName==="CANVAS"},a0=function(n){return n.tagName==="VIDEO"},Rh=function(n){return n.tagName==="IMG"},wB=function(n){return n.tagName==="IFRAME"},l0=function(n){return n.tagName==="STYLE"},QP=function(n){return n.tagName==="SCRIPT"},Pc=function(n){return n.tagName==="TEXTAREA"},Nc=function(n){return n.tagName==="SELECT"},BB=function(n){return n.tagName==="SLOT"},c0=function(n){return n.tagName.indexOf("-")>0},UP=(function(){function n(){this.counters={}}return n.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},n.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},n.prototype.pop=function(t){var e=this;t.forEach(function(s){return e.counters[s].pop()})},n.prototype.parse=function(t){var e=this,s=t.counterIncrement,r=t.counterReset,i=!0;s!==null&&s.forEach(function(A){var a=e.counters[A.counter];a&&A.increment!==0&&(i=!1,a.length||a.push(1),a[Math.max(0,a.length-1)]+=A.increment)});var o=[];return i&&r.forEach(function(A){var a=e.counters[A.counter];o.push(A.counter),a||(a=e.counters[A.counter]=[]),a.push(A.reset)}),o},n})(),u0={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},d0={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},PP={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},NP={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Zi=function(n,t,e,s,r,i){return n<t||n>e?ha(n,r,i.length>0):s.integers.reduce(function(o,A,a){for(;n>=A;)n-=A,o+=s.values[a];return o},"")+i},CB=function(n,t,e,s){var r="";do e||n--,r=s(n)+r,n/=t;while(n*t>=t);return r},ce=function(n,t,e,s,r){var i=e-t+1;return(n<0?"-":"")+(CB(Math.abs(n),i,s,function(o){return ue(Math.floor(o%i)+t)})+r)},Ai=function(n,t,e){e===void 0&&(e=". ");var s=t.length;return CB(Math.abs(n),s,!1,function(r){return t[Math.floor(r%s)]})+e},oo=1,Sr=2,Er=4,yA=8,Gs=function(n,t,e,s,r,i){if(n<-9999||n>9999)return ha(n,4,r.length>0);var o=Math.abs(n),A=r;if(o===0)return t[0]+A;for(var a=0;o>0&&a<=4;a++){var l=o%10;l===0&&ye(i,oo)&&A!==""?A=t[l]+A:l>1||l===1&&a===0||l===1&&a===1&&ye(i,Sr)||l===1&&a===1&&ye(i,Er)&&n>100||l===1&&a>1&&ye(i,yA)?A=t[l]+(a>0?e[a-1]:"")+A:l===1&&a>0&&(A=e[a-1]+A),o=Math.floor(o/10)}return(n<0?s:"")+A},h0="",f0="",p0="",_d="",ha=function(n,t,e){var s=e?". ":"",r=e?"":"",i=e?", ":"",o=e?" ":"";switch(t){case 0:return""+o;case 1:return""+o;case 2:return""+o;case 5:var A=ce(n,48,57,!0,s);return A.length<4?"0"+A:A;case 4:return Ai(n,"",r);case 6:return Zi(n,1,3999,u0,3,s).toLowerCase();case 7:return Zi(n,1,3999,u0,3,s);case 8:return ce(n,945,969,!1,s);case 9:return ce(n,97,122,!1,s);case 10:return ce(n,65,90,!1,s);case 11:return ce(n,1632,1641,!0,s);case 12:case 49:return Zi(n,1,9999,d0,3,s);case 35:return Zi(n,1,9999,d0,3,s).toLowerCase();case 13:return ce(n,2534,2543,!0,s);case 14:case 30:return ce(n,6112,6121,!0,s);case 15:return Ai(n,"",r);case 16:return Ai(n,"",r);case 17:case 48:return Gs(n,"",h0,"",r,Sr|Er|yA);case 47:return Gs(n,"",f0,"",r,oo|Sr|Er|yA);case 42:return Gs(n,"",h0,"",r,Sr|Er|yA);case 41:return Gs(n,"",f0,"",r,oo|Sr|Er|yA);case 26:return Gs(n,"","",p0,r,0);case 25:return Gs(n,"","",p0,r,oo|Sr|Er);case 31:return Gs(n,"","",_d,i,oo|Sr|Er);case 33:return Gs(n,"","",_d,i,0);case 32:return Gs(n,"","",_d,i,oo|Sr|Er);case 18:return ce(n,2406,2415,!0,s);case 20:return Zi(n,1,19999,NP,3,s);case 21:return ce(n,2790,2799,!0,s);case 22:return ce(n,2662,2671,!0,s);case 22:return Zi(n,1,10999,PP,3,s);case 23:return Ai(n,"");case 24:return Ai(n,"");case 27:return ce(n,3302,3311,!0,s);case 28:return Ai(n,"",r);case 29:return Ai(n,"",r);case 34:return ce(n,3792,3801,!0,s);case 37:return ce(n,6160,6169,!0,s);case 38:return ce(n,4160,4169,!0,s);case 39:return ce(n,2918,2927,!0,s);case 40:return ce(n,1776,1785,!0,s);case 43:return ce(n,3046,3055,!0,s);case 44:return ce(n,3174,3183,!0,s);case 45:return ce(n,3664,3673,!0,s);case 46:return ce(n,3872,3881,!0,s);case 3:default:return ce(n,48,57,!0,s)}},bB="data-html2canvas-ignore",m0=(function(){function n(t,e,s){if(this.context=t,this.options=s,this.scrolledElements=[],this.referenceElement=e,this.counters=new UP,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return n.prototype.toIFrame=function(t,e){var s=this,r=LP(t,e);if(!r.contentWindow)return Promise.reject("Unable to find iframe window");var i=t.defaultView.pageXOffset,o=t.defaultView.pageYOffset,A=r.contentWindow,a=A.document,l=RP(r).then(function(){return Ze(s,void 0,void 0,function(){var c,u;return Oe(this,function(d){switch(d.label){case 0:return this.scrolledElements.forEach(WP),A&&(A.scrollTo(e.left,e.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(A.scrollY!==e.top||A.scrollX!==e.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(A.scrollX-e.left,A.scrollY-e.top,0,0))),c=this.options.onclone,u=this.clonedReferenceElement,typeof u>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:a.fonts&&a.fonts.ready?[4,a.fonts.ready]:[3,2];case 1:d.sent(),d.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,kP(a)]:[3,4];case 3:d.sent(),d.label=4;case 4:return typeof c=="function"?[2,Promise.resolve().then(function(){return c(a,u)}).then(function(){return r})]:[2,r]}})})});return a.open(),a.write(OP(document.doctype)+"<html></html>"),VP(this.referenceElement.ownerDocument,i,o),a.replaceChild(a.adoptNode(this.documentElement),a.documentElement),a.close(),l},n.prototype.createElementClone=function(t){if(Nh(t,2))debugger;if(vB(t))return this.createCanvasClone(t);if(a0(t))return this.createVideoClone(t);if(l0(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return Rh(e)&&(Rh(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),e.loading==="lazy"&&(e.loading="eager")),c0(e)?this.createCustomElementClone(e):e},n.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return Md(t.style,e),e},n.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var s=[].slice.call(e.cssRules,0).reduce(function(i,o){return o&&typeof o.cssText=="string"?i+o.cssText:i},""),r=t.cloneNode(!1);return r.textContent=s,r}}catch(i){if(this.context.logger.error("Unable to access cssRules property",i),i.name!=="SecurityError")throw i}return t.cloneNode(!1)},n.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var s=t.ownerDocument.createElement("img");try{return s.src=t.toDataURL(),s}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var r=t.cloneNode(!1);try{r.width=t.width,r.height=t.height;var i=t.getContext("2d"),o=r.getContext("2d");if(o)if(!this.options.allowTaint&&i)o.putImageData(i.getImageData(0,0,t.width,t.height),0,0);else{var A=(e=t.getContext("webgl2"))!==null&&e!==void 0?e:t.getContext("webgl");if(A){var a=A.getContextAttributes();(a==null?void 0:a.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}o.drawImage(t,0,0)}return r}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return r},n.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var s=e.getContext("2d");try{return s&&(s.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||s.getImageData(0,0,e.width,e.height)),e}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var r=t.ownerDocument.createElement("canvas");return r.width=t.offsetWidth,r.height=t.offsetHeight,r},n.prototype.appendChildNode=function(t,e,s){(!mo(e)||!QP(e)&&!e.hasAttribute(bB)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(e)))&&(!this.options.copyStyles||!mo(e)||!l0(e))&&t.appendChild(this.cloneNode(e,s))},n.prototype.cloneChildNodes=function(t,e,s){for(var r=this,i=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;i;i=i.nextSibling)if(mo(i)&&BB(i)&&typeof i.assignedNodes=="function"){var o=i.assignedNodes();o.length&&o.forEach(function(A){return r.appendChildNode(e,A,s)})}else this.appendChildNode(e,i,s)},n.prototype.cloneNode=function(t,e){if(mB(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var s=t.ownerDocument.defaultView;if(s&&mo(t)&&(kh(t)||Jl(t))){var r=this.createElementClone(t);r.style.transitionProperty="none";var i=s.getComputedStyle(t),o=s.getComputedStyle(t,":before"),A=s.getComputedStyle(t,":after");this.referenceElement===t&&kh(r)&&(this.clonedReferenceElement=r),_p(r)&&qP(r);var a=this.counters.parse(new zg(this.context,i)),l=this.resolvePseudoContent(t,r,o,GA.BEFORE);c0(t)&&(e=!0),a0(t)||this.cloneChildNodes(t,r,e),l&&r.insertBefore(l,r.firstChild);var c=this.resolvePseudoContent(t,r,A,GA.AFTER);return c&&r.appendChild(c),this.counters.pop(a),(i&&(this.options.copyStyles||Jl(t))&&!wB(t)||e)&&Md(i,r),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([r,t.scrollLeft,t.scrollTop]),(Pc(t)||Nc(t))&&(Pc(r)||Nc(r))&&(r.value=t.value),r}return t.cloneNode(!1)},n.prototype.resolvePseudoContent=function(t,e,s,r){var i=this;if(s){var o=s.content,A=e.ownerDocument;if(!(!A||!o||o==="none"||o==="-moz-alt-content"||s.display==="none")){this.counters.parse(new zg(this.context,s));var a=new F4(this.context,s),l=A.createElement("html2canvaspseudoelement");Md(s,l),a.content.forEach(function(u){if(u.type===0)l.appendChild(A.createTextNode(u.value));else if(u.type===22){var d=A.createElement("img");d.src=u.value,d.style.opacity="1",l.appendChild(d)}else if(u.type===18){if(u.name==="attr"){var p=u.values.filter(qt);p.length&&l.appendChild(A.createTextNode(t.getAttribute(p[0].value)||""))}else if(u.name==="counter"){var h=u.values.filter(Ko),m=h[0],g=h[1];if(m&&qt(m)){var v=i.counters.getCounterValue(m.value),w=g&&qt(g)?Ph.parse(i.context,g.value):3;l.appendChild(A.createTextNode(ha(v,w,!1)))}}else if(u.name==="counters"){var y=u.values.filter(Ko),m=y[0],I=y[1],g=y[2];if(m&&qt(m)){var B=i.counters.getCounterValues(m.value),C=g&&qt(g)?Ph.parse(i.context,g.value):3,b=I&&I.type===0?I.value:"",S=B.map(function(_){return ha(_,C,!1)}).join(b);l.appendChild(A.createTextNode(S))}}}else if(u.type===20)switch(u.value){case"open-quote":l.appendChild(A.createTextNode(qg(a.quotes,i.quoteDepth++,!0)));break;case"close-quote":l.appendChild(A.createTextNode(qg(a.quotes,--i.quoteDepth,!1)));break;default:l.appendChild(A.createTextNode(u.value))}}),l.className=Hh+" "+Oh;var c=r===GA.BEFORE?" "+Hh:" "+Oh;return Jl(e)?e.className.baseValue+=c:e.className+=c,l}}},n.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},n})(),GA;(function(n){n[n.BEFORE=0]="BEFORE",n[n.AFTER=1]="AFTER"})(GA||(GA={}));var LP=function(n,t){var e=n.createElement("iframe");return e.className="html2canvas-container",e.style.visibility="hidden",e.style.position="fixed",e.style.left="-10000px",e.style.top="0px",e.style.border="0",e.width=t.width.toString(),e.height=t.height.toString(),e.scrolling="no",e.setAttribute(bB,"true"),n.body.appendChild(e),e},DP=function(n){return new Promise(function(t){if(n.complete){t();return}if(!n.src){t();return}n.onload=t,n.onerror=t})},kP=function(n){return Promise.all([].slice.call(n.images,0).map(DP))},RP=function(n){return new Promise(function(t,e){var s=n.contentWindow;if(!s)return e("No window assigned for iframe");var r=s.document;s.onload=n.onload=function(){s.onload=n.onload=null;var i=setInterval(function(){r.body.childNodes.length>0&&r.readyState==="complete"&&(clearInterval(i),t(n))},50)}})},HP=["all","d","content"],Md=function(n,t){for(var e=n.length-1;e>=0;e--){var s=n.item(e);HP.indexOf(s)===-1&&t.style.setProperty(s,n.getPropertyValue(s))}return t},OP=function(n){var t="";return n&&(t+="<!DOCTYPE ",n.name&&(t+=n.name),n.internalSubset&&(t+=n.internalSubset),n.publicId&&(t+='"'+n.publicId+'"'),n.systemId&&(t+='"'+n.systemId+'"'),t+=">"),t},VP=function(n,t,e){n&&n.defaultView&&(t!==n.defaultView.pageXOffset||e!==n.defaultView.pageYOffset)&&n.defaultView.scrollTo(t,e)},WP=function(n){var t=n[0],e=n[1],s=n[2];t.scrollLeft=e,t.scrollTop=s},GP=":before",KP=":after",Hh="___html2canvas___pseudoelement_before",Oh="___html2canvas___pseudoelement_after",g0=`{
    content: "" !important;
    display: none !important;
}`,qP=function(n){zP(n,"."+Hh+GP+g0+`
         .`+Oh+KP+g0)},zP=function(n,t){var e=n.ownerDocument;if(e){var s=e.createElement("style");s.textContent=t,n.appendChild(s)}},yB=(function(){function n(){}return n.getOrigin=function(t){var e=n._link;return e?(e.href=t,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},n.isSameOrigin=function(t){return n.getOrigin(t)===n._origin},n.setContext=function(t){n._link=t.document.createElement("a"),n._origin=n.getOrigin(t.location.href)},n._origin="about:blank",n})(),$P=(function(){function n(t,e){this.context=t,this._options=e,this._cache={}}return n.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)||(Ud(t)||JP(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),e},n.prototype.match=function(t){return this._cache[t]},n.prototype.loadImage=function(t){return Ze(this,void 0,void 0,function(){var e,s,r,i,o=this;return Oe(this,function(A){switch(A.label){case 0:return e=yB.isSameOrigin(t),s=!Qd(t)&&this._options.useCORS===!0&&Pe.SUPPORT_CORS_IMAGES&&!e,r=!Qd(t)&&!e&&!Ud(t)&&typeof this._options.proxy=="string"&&Pe.SUPPORT_CORS_XHR&&!s,!e&&this._options.allowTaint===!1&&!Qd(t)&&!Ud(t)&&!r&&!s?[2]:(i=t,r?[4,this.proxy(i)]:[3,2]);case 1:i=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(a,l){var c=new Image;c.onload=function(){return a(c)},c.onerror=l,(ZP(i)||s)&&(c.crossOrigin="anonymous"),c.src=i,c.complete===!0&&setTimeout(function(){return a(c)},500),o._options.imageTimeout>0&&setTimeout(function(){return l("Timed out ("+o._options.imageTimeout+"ms) loading image")},o._options.imageTimeout)})];case 3:return[2,A.sent()]}})})},n.prototype.has=function(t){return typeof this._cache[t]<"u"},n.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},n.prototype.proxy=function(t){var e=this,s=this._options.proxy;if(!s)throw new Error("No proxy defined");var r=t.substring(0,256);return new Promise(function(i,o){var A=Pe.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(a.status===200)if(A==="text")i(a.response);else{var u=new FileReader;u.addEventListener("load",function(){return i(u.result)},!1),u.addEventListener("error",function(d){return o(d)},!1),u.readAsDataURL(a.response)}else o("Failed to proxy resource "+r+" with status code "+a.status)},a.onerror=o;var l=s.indexOf("?")>-1?"&":"?";if(a.open("GET",""+s+l+"url="+encodeURIComponent(t)+"&responseType="+A),A!=="text"&&a instanceof XMLHttpRequest&&(a.responseType=A),e._options.imageTimeout){var c=e._options.imageTimeout;a.timeout=c,a.ontimeout=function(){return o("Timed out ("+c+"ms) proxying "+r)}}a.send()})},n})(),XP=/^data:image\/svg\+xml/i,YP=/^data:image\/.*;base64,/i,jP=/^data:image\/.*/i,JP=function(n){return Pe.SUPPORT_SVG_DRAWING||!tN(n)},Qd=function(n){return jP.test(n)},ZP=function(n){return YP.test(n)},Ud=function(n){return n.substr(0,4)==="blob"},tN=function(n){return n.substr(-3).toLowerCase()==="svg"||XP.test(n)},ut=(function(){function n(t,e){this.type=0,this.x=t,this.y=e}return n.prototype.add=function(t,e){return new n(this.x+t,this.y+e)},n})(),to=function(n,t,e){return new ut(n.x+(t.x-n.x)*e,n.y+(t.y-n.y)*e)},Sl=(function(){function n(t,e,s,r){this.type=1,this.start=t,this.startControl=e,this.endControl=s,this.end=r}return n.prototype.subdivide=function(t,e){var s=to(this.start,this.startControl,t),r=to(this.startControl,this.endControl,t),i=to(this.endControl,this.end,t),o=to(s,r,t),A=to(r,i,t),a=to(o,A,t);return e?new n(this.start,s,o,a):new n(a,A,i,this.end)},n.prototype.add=function(t,e){return new n(this.start.add(t,e),this.startControl.add(t,e),this.endControl.add(t,e),this.end.add(t,e))},n.prototype.reverse=function(){return new n(this.end,this.endControl,this.startControl,this.start)},n})(),Vn=function(n){return n.type===1},eN=(function(){function n(t){var e=t.styles,s=t.bounds,r=CA(e.borderTopLeftRadius,s.width,s.height),i=r[0],o=r[1],A=CA(e.borderTopRightRadius,s.width,s.height),a=A[0],l=A[1],c=CA(e.borderBottomRightRadius,s.width,s.height),u=c[0],d=c[1],p=CA(e.borderBottomLeftRadius,s.width,s.height),h=p[0],m=p[1],g=[];g.push((i+a)/s.width),g.push((h+u)/s.width),g.push((o+m)/s.height),g.push((l+d)/s.height);var v=Math.max.apply(Math,g);v>1&&(i/=v,o/=v,a/=v,l/=v,u/=v,d/=v,h/=v,m/=v);var w=s.width-a,y=s.height-d,I=s.width-u,B=s.height-m,C=e.borderTopWidth,b=e.borderRightWidth,S=e.borderBottomWidth,T=e.borderLeftWidth,x=Xt(e.paddingTop,t.bounds.width),_=Xt(e.paddingRight,t.bounds.width),F=Xt(e.paddingBottom,t.bounds.width),Q=Xt(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||o>0?te(s.left+T/3,s.top+C/3,i-T/3,o-C/3,Dt.TOP_LEFT):new ut(s.left+T/3,s.top+C/3),this.topRightBorderDoubleOuterBox=i>0||o>0?te(s.left+w,s.top+C/3,a-b/3,l-C/3,Dt.TOP_RIGHT):new ut(s.left+s.width-b/3,s.top+C/3),this.bottomRightBorderDoubleOuterBox=u>0||d>0?te(s.left+I,s.top+y,u-b/3,d-S/3,Dt.BOTTOM_RIGHT):new ut(s.left+s.width-b/3,s.top+s.height-S/3),this.bottomLeftBorderDoubleOuterBox=h>0||m>0?te(s.left+T/3,s.top+B,h-T/3,m-S/3,Dt.BOTTOM_LEFT):new ut(s.left+T/3,s.top+s.height-S/3),this.topLeftBorderDoubleInnerBox=i>0||o>0?te(s.left+T*2/3,s.top+C*2/3,i-T*2/3,o-C*2/3,Dt.TOP_LEFT):new ut(s.left+T*2/3,s.top+C*2/3),this.topRightBorderDoubleInnerBox=i>0||o>0?te(s.left+w,s.top+C*2/3,a-b*2/3,l-C*2/3,Dt.TOP_RIGHT):new ut(s.left+s.width-b*2/3,s.top+C*2/3),this.bottomRightBorderDoubleInnerBox=u>0||d>0?te(s.left+I,s.top+y,u-b*2/3,d-S*2/3,Dt.BOTTOM_RIGHT):new ut(s.left+s.width-b*2/3,s.top+s.height-S*2/3),this.bottomLeftBorderDoubleInnerBox=h>0||m>0?te(s.left+T*2/3,s.top+B,h-T*2/3,m-S*2/3,Dt.BOTTOM_LEFT):new ut(s.left+T*2/3,s.top+s.height-S*2/3),this.topLeftBorderStroke=i>0||o>0?te(s.left+T/2,s.top+C/2,i-T/2,o-C/2,Dt.TOP_LEFT):new ut(s.left+T/2,s.top+C/2),this.topRightBorderStroke=i>0||o>0?te(s.left+w,s.top+C/2,a-b/2,l-C/2,Dt.TOP_RIGHT):new ut(s.left+s.width-b/2,s.top+C/2),this.bottomRightBorderStroke=u>0||d>0?te(s.left+I,s.top+y,u-b/2,d-S/2,Dt.BOTTOM_RIGHT):new ut(s.left+s.width-b/2,s.top+s.height-S/2),this.bottomLeftBorderStroke=h>0||m>0?te(s.left+T/2,s.top+B,h-T/2,m-S/2,Dt.BOTTOM_LEFT):new ut(s.left+T/2,s.top+s.height-S/2),this.topLeftBorderBox=i>0||o>0?te(s.left,s.top,i,o,Dt.TOP_LEFT):new ut(s.left,s.top),this.topRightBorderBox=a>0||l>0?te(s.left+w,s.top,a,l,Dt.TOP_RIGHT):new ut(s.left+s.width,s.top),this.bottomRightBorderBox=u>0||d>0?te(s.left+I,s.top+y,u,d,Dt.BOTTOM_RIGHT):new ut(s.left+s.width,s.top+s.height),this.bottomLeftBorderBox=h>0||m>0?te(s.left,s.top+B,h,m,Dt.BOTTOM_LEFT):new ut(s.left,s.top+s.height),this.topLeftPaddingBox=i>0||o>0?te(s.left+T,s.top+C,Math.max(0,i-T),Math.max(0,o-C),Dt.TOP_LEFT):new ut(s.left+T,s.top+C),this.topRightPaddingBox=a>0||l>0?te(s.left+Math.min(w,s.width-b),s.top+C,w>s.width+b?0:Math.max(0,a-b),Math.max(0,l-C),Dt.TOP_RIGHT):new ut(s.left+s.width-b,s.top+C),this.bottomRightPaddingBox=u>0||d>0?te(s.left+Math.min(I,s.width-T),s.top+Math.min(y,s.height-S),Math.max(0,u-b),Math.max(0,d-S),Dt.BOTTOM_RIGHT):new ut(s.left+s.width-b,s.top+s.height-S),this.bottomLeftPaddingBox=h>0||m>0?te(s.left+T,s.top+Math.min(B,s.height-S),Math.max(0,h-T),Math.max(0,m-S),Dt.BOTTOM_LEFT):new ut(s.left+T,s.top+s.height-S),this.topLeftContentBox=i>0||o>0?te(s.left+T+Q,s.top+C+x,Math.max(0,i-(T+Q)),Math.max(0,o-(C+x)),Dt.TOP_LEFT):new ut(s.left+T+Q,s.top+C+x),this.topRightContentBox=a>0||l>0?te(s.left+Math.min(w,s.width+T+Q),s.top+C+x,w>s.width+T+Q?0:a-T+Q,l-(C+x),Dt.TOP_RIGHT):new ut(s.left+s.width-(b+_),s.top+C+x),this.bottomRightContentBox=u>0||d>0?te(s.left+Math.min(I,s.width-(T+Q)),s.top+Math.min(y,s.height+C+x),Math.max(0,u-(b+_)),d-(S+F),Dt.BOTTOM_RIGHT):new ut(s.left+s.width-(b+_),s.top+s.height-(S+F)),this.bottomLeftContentBox=h>0||m>0?te(s.left+T+Q,s.top+B,Math.max(0,h-(T+Q)),m-(S+F),Dt.BOTTOM_LEFT):new ut(s.left+T+Q,s.top+s.height-(S+F))}return n})(),Dt;(function(n){n[n.TOP_LEFT=0]="TOP_LEFT",n[n.TOP_RIGHT=1]="TOP_RIGHT",n[n.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",n[n.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Dt||(Dt={}));var te=function(n,t,e,s,r){var i=4*((Math.sqrt(2)-1)/3),o=e*i,A=s*i,a=n+e,l=t+s;switch(r){case Dt.TOP_LEFT:return new Sl(new ut(n,l),new ut(n,l-A),new ut(a-o,t),new ut(a,t));case Dt.TOP_RIGHT:return new Sl(new ut(n,t),new ut(n+o,t),new ut(a,l-A),new ut(a,l));case Dt.BOTTOM_RIGHT:return new Sl(new ut(a,t),new ut(a,t+A),new ut(n+o,l),new ut(n,l));case Dt.BOTTOM_LEFT:default:return new Sl(new ut(a,l),new ut(a-o,l),new ut(n,t+A),new ut(n,t))}},Lc=function(n){return[n.topLeftBorderBox,n.topRightBorderBox,n.bottomRightBorderBox,n.bottomLeftBorderBox]},nN=function(n){return[n.topLeftContentBox,n.topRightContentBox,n.bottomRightContentBox,n.bottomLeftContentBox]},Dc=function(n){return[n.topLeftPaddingBox,n.topRightPaddingBox,n.bottomRightPaddingBox,n.bottomLeftPaddingBox]},sN=(function(){function n(t,e,s){this.offsetX=t,this.offsetY=e,this.matrix=s,this.type=0,this.target=6}return n})(),El=(function(){function n(t,e){this.path=t,this.target=e,this.type=1}return n})(),rN=(function(){function n(t){this.opacity=t,this.type=2,this.target=6}return n})(),iN=function(n){return n.type===0},SB=function(n){return n.type===1},oN=function(n){return n.type===2},v0=function(n,t){return n.length===t.length?n.some(function(e,s){return e===t[s]}):!1},AN=function(n,t,e,s,r){return n.map(function(i,o){switch(o){case 0:return i.add(t,e);case 1:return i.add(t+s,e);case 2:return i.add(t+s,e+r);case 3:return i.add(t,e+r)}return i})},EB=(function(){function n(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return n})(),xB=(function(){function n(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new eN(this.container),this.container.styles.opacity<1&&this.effects.push(new rN(this.container.styles.opacity)),this.container.styles.transform!==null){var s=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new sN(s,r,i))}if(this.container.styles.overflowX!==0){var o=Lc(this.curves),A=Dc(this.curves);v0(o,A)?this.effects.push(new El(o,6)):(this.effects.push(new El(o,2)),this.effects.push(new El(A,4)))}}return n.prototype.getEffects=function(t){for(var e=[2,3].indexOf(this.container.styles.position)===-1,s=this.parent,r=this.effects.slice(0);s;){var i=s.effects.filter(function(a){return!SB(a)});if(e||s.container.styles.position!==0||!s.parent){if(r.unshift.apply(r,i),e=[2,3].indexOf(s.container.styles.position)===-1,s.container.styles.overflowX!==0){var o=Lc(s.curves),A=Dc(s.curves);v0(o,A)||r.unshift(new El(A,6))}}else r.unshift.apply(r,i);s=s.parent}return r.filter(function(a){return ye(a.target,t)})},n})(),Vh=function(n,t,e,s){n.container.elements.forEach(function(r){var i=ye(r.flags,4),o=ye(r.flags,2),A=new xB(r,n);ye(r.styles.display,2048)&&s.push(A);var a=ye(r.flags,8)?[]:s;if(i||o){var l=i||r.styles.isPositioned()?e:t,c=new EB(A);if(r.styles.isPositioned()||r.styles.opacity<1||r.styles.isTransformed()){var u=r.styles.zIndex.order;if(u<0){var d=0;l.negativeZIndex.some(function(h,m){return u>h.element.container.styles.zIndex.order?(d=m,!1):d>0}),l.negativeZIndex.splice(d,0,c)}else if(u>0){var p=0;l.positiveZIndex.some(function(h,m){return u>=h.element.container.styles.zIndex.order?(p=m+1,!1):p>0}),l.positiveZIndex.splice(p,0,c)}else l.zeroOrAutoZIndexOrTransformedOrOpacity.push(c)}else r.styles.isFloating()?l.nonPositionedFloats.push(c):l.nonPositionedInlineLevel.push(c);Vh(A,c,i?c:e,a)}else r.styles.isInlineLevel()?t.inlineLevel.push(A):t.nonInlineLevel.push(A),Vh(A,t,e,a);ye(r.flags,8)&&IB(r,a)})},IB=function(n,t){for(var e=n instanceof Dh?n.start:1,s=n instanceof Dh?n.reversed:!1,r=0;r<t.length;r++){var i=t[r];i.container instanceof cB&&typeof i.container.value=="number"&&i.container.value!==0&&(e=i.container.value),i.listValue=ha(e,i.container.styles.listStyleType,!0),e+=s?-1:1}},aN=function(n){var t=new xB(n,null),e=new EB(t),s=[];return Vh(t,e,e,s),IB(t.container,s),e},w0=function(n,t){switch(t){case 0:return zn(n.topLeftBorderBox,n.topLeftPaddingBox,n.topRightBorderBox,n.topRightPaddingBox);case 1:return zn(n.topRightBorderBox,n.topRightPaddingBox,n.bottomRightBorderBox,n.bottomRightPaddingBox);case 2:return zn(n.bottomRightBorderBox,n.bottomRightPaddingBox,n.bottomLeftBorderBox,n.bottomLeftPaddingBox);case 3:default:return zn(n.bottomLeftBorderBox,n.bottomLeftPaddingBox,n.topLeftBorderBox,n.topLeftPaddingBox)}},lN=function(n,t){switch(t){case 0:return zn(n.topLeftBorderBox,n.topLeftBorderDoubleOuterBox,n.topRightBorderBox,n.topRightBorderDoubleOuterBox);case 1:return zn(n.topRightBorderBox,n.topRightBorderDoubleOuterBox,n.bottomRightBorderBox,n.bottomRightBorderDoubleOuterBox);case 2:return zn(n.bottomRightBorderBox,n.bottomRightBorderDoubleOuterBox,n.bottomLeftBorderBox,n.bottomLeftBorderDoubleOuterBox);case 3:default:return zn(n.bottomLeftBorderBox,n.bottomLeftBorderDoubleOuterBox,n.topLeftBorderBox,n.topLeftBorderDoubleOuterBox)}},cN=function(n,t){switch(t){case 0:return zn(n.topLeftBorderDoubleInnerBox,n.topLeftPaddingBox,n.topRightBorderDoubleInnerBox,n.topRightPaddingBox);case 1:return zn(n.topRightBorderDoubleInnerBox,n.topRightPaddingBox,n.bottomRightBorderDoubleInnerBox,n.bottomRightPaddingBox);case 2:return zn(n.bottomRightBorderDoubleInnerBox,n.bottomRightPaddingBox,n.bottomLeftBorderDoubleInnerBox,n.bottomLeftPaddingBox);case 3:default:return zn(n.bottomLeftBorderDoubleInnerBox,n.bottomLeftPaddingBox,n.topLeftBorderDoubleInnerBox,n.topLeftPaddingBox)}},uN=function(n,t){switch(t){case 0:return xl(n.topLeftBorderStroke,n.topRightBorderStroke);case 1:return xl(n.topRightBorderStroke,n.bottomRightBorderStroke);case 2:return xl(n.bottomRightBorderStroke,n.bottomLeftBorderStroke);case 3:default:return xl(n.bottomLeftBorderStroke,n.topLeftBorderStroke)}},xl=function(n,t){var e=[];return Vn(n)?e.push(n.subdivide(.5,!1)):e.push(n),Vn(t)?e.push(t.subdivide(.5,!0)):e.push(t),e},zn=function(n,t,e,s){var r=[];return Vn(n)?r.push(n.subdivide(.5,!1)):r.push(n),Vn(e)?r.push(e.subdivide(.5,!0)):r.push(e),Vn(s)?r.push(s.subdivide(.5,!0).reverse()):r.push(s),Vn(t)?r.push(t.subdivide(.5,!1).reverse()):r.push(t),r},FB=function(n){var t=n.bounds,e=n.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},kc=function(n){var t=n.styles,e=n.bounds,s=Xt(t.paddingLeft,e.width),r=Xt(t.paddingRight,e.width),i=Xt(t.paddingTop,e.width),o=Xt(t.paddingBottom,e.width);return e.add(s+t.borderLeftWidth,i+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+s+r),-(t.borderTopWidth+t.borderBottomWidth+i+o))},dN=function(n,t){return n===0?t.bounds:n===2?kc(t):FB(t)},hN=function(n,t){return n===0?t.bounds:n===2?kc(t):FB(t)},Pd=function(n,t,e){var s=dN(Ao(n.styles.backgroundOrigin,t),n),r=hN(Ao(n.styles.backgroundClip,t),n),i=fN(Ao(n.styles.backgroundSize,t),e,s),o=i[0],A=i[1],a=CA(Ao(n.styles.backgroundPosition,t),s.width-o,s.height-A),l=pN(Ao(n.styles.backgroundRepeat,t),a,i,s,r),c=Math.round(s.left+a[0]),u=Math.round(s.top+a[1]);return[l,c,u,o,A]},eo=function(n){return qt(n)&&n.value===Uo.AUTO},Il=function(n){return typeof n=="number"},fN=function(n,t,e){var s=t[0],r=t[1],i=t[2],o=n[0],A=n[1];if(!o)return[0,0];if(me(o)&&A&&me(A))return[Xt(o,e.width),Xt(A,e.height)];var a=Il(i);if(qt(o)&&(o.value===Uo.CONTAIN||o.value===Uo.COVER)){if(Il(i)){var l=e.width/e.height;return l<i!=(o.value===Uo.COVER)?[e.width,e.width/i]:[e.height*i,e.height]}return[e.width,e.height]}var c=Il(s),u=Il(r),d=c||u;if(eo(o)&&(!A||eo(A))){if(c&&u)return[s,r];if(!a&&!d)return[e.width,e.height];if(d&&a){var p=c?s:r*i,h=u?r:s/i;return[p,h]}var m=c?s:e.width,g=u?r:e.height;return[m,g]}if(a){var v=0,w=0;return me(o)?v=Xt(o,e.width):me(A)&&(w=Xt(A,e.height)),eo(o)?v=w*i:(!A||eo(A))&&(w=v/i),[v,w]}var y=null,I=null;if(me(o)?y=Xt(o,e.width):A&&me(A)&&(I=Xt(A,e.height)),y!==null&&(!A||eo(A))&&(I=c&&u?y/s*r:e.height),I!==null&&eo(o)&&(y=c&&u?I/r*s:e.width),y!==null&&I!==null)return[y,I];throw new Error("Unable to calculate background-size for element")},Ao=function(n,t){var e=n[t];return typeof e>"u"?n[0]:e},pN=function(n,t,e,s,r){var i=t[0],o=t[1],A=e[0],a=e[1];switch(n){case 2:return[new ut(Math.round(s.left),Math.round(s.top+o)),new ut(Math.round(s.left+s.width),Math.round(s.top+o)),new ut(Math.round(s.left+s.width),Math.round(a+s.top+o)),new ut(Math.round(s.left),Math.round(a+s.top+o))];case 3:return[new ut(Math.round(s.left+i),Math.round(s.top)),new ut(Math.round(s.left+i+A),Math.round(s.top)),new ut(Math.round(s.left+i+A),Math.round(s.height+s.top)),new ut(Math.round(s.left+i),Math.round(s.height+s.top))];case 1:return[new ut(Math.round(s.left+i),Math.round(s.top+o)),new ut(Math.round(s.left+i+A),Math.round(s.top+o)),new ut(Math.round(s.left+i+A),Math.round(s.top+o+a)),new ut(Math.round(s.left+i),Math.round(s.top+o+a))];default:return[new ut(Math.round(r.left),Math.round(r.top)),new ut(Math.round(r.left+r.width),Math.round(r.top)),new ut(Math.round(r.left+r.width),Math.round(r.height+r.top)),new ut(Math.round(r.left),Math.round(r.height+r.top))]}},mN="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",B0="Hidden Text",gN=(function(){function n(t){this._data={},this._document=t}return n.prototype.parseMetrics=function(t,e){var s=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),o=this._document.body;s.style.visibility="hidden",s.style.fontFamily=t,s.style.fontSize=e,s.style.margin="0",s.style.padding="0",s.style.whiteSpace="nowrap",o.appendChild(s),r.src=mN,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=t,i.style.fontSize=e,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(B0)),s.appendChild(i),s.appendChild(r);var A=r.offsetTop-i.offsetTop+2;s.removeChild(i),s.appendChild(this._document.createTextNode(B0)),s.style.lineHeight="normal",r.style.verticalAlign="super";var a=r.offsetTop-s.offsetTop+2;return o.removeChild(s),{baseline:A,middle:a}},n.prototype.getMetrics=function(t,e){var s=t+" "+e;return typeof this._data[s]>"u"&&(this._data[s]=this.parseMetrics(t,e)),this._data[s]},n})(),TB=(function(){function n(t,e){this.context=t,this.options=e}return n})(),vN=1e4,wN=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r._activeEffects=[],r.canvas=s.canvas?s.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),s.canvas||(r.canvas.width=Math.floor(s.width*s.scale),r.canvas.height=Math.floor(s.height*s.scale),r.canvas.style.width=s.width+"px",r.canvas.style.height=s.height+"px"),r.fontMetrics=new gN(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-s.x,-s.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+s.width+"x"+s.height+") with scale "+s.scale),r}return t.prototype.applyEffects=function(e){for(var s=this;this._activeEffects.length;)this.popEffect();e.forEach(function(r){return s.applyEffect(r)})},t.prototype.applyEffect=function(e){this.ctx.save(),oN(e)&&(this.ctx.globalAlpha=e.opacity),iN(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),SB(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return Ze(this,void 0,void 0,function(){var s;return Oe(this,function(r){switch(r.label){case 0:return s=e.element.container.styles,s.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(e){return Ze(this,void 0,void 0,function(){return Oe(this,function(s){switch(s.label){case 0:if(ye(e.container.flags,16))debugger;return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return s.sent(),[4,this.renderNodeContent(e)];case 2:s.sent(),s.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(e,s,r){var i=this;if(s===0)this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+r);else{var o=Fp(e.text);o.reduce(function(A,a){return i.ctx.fillText(a,A,e.bounds.top+r),A+i.ctx.measureText(a).width},e.bounds.left)}},t.prototype.createFontStyle=function(e){var s=e.fontVariant.filter(function(o){return o==="normal"||o==="small-caps"}).join(""),r=SN(e.fontFamily).join(", "),i=Ha(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,s,e.fontWeight,i,r].join(" "),r,i]},t.prototype.renderTextNode=function(e,s){return Ze(this,void 0,void 0,function(){var r,i,o,A,a,l,c,u,d=this;return Oe(this,function(p){return r=this.createFontStyle(s),i=r[0],o=r[1],A=r[2],this.ctx.font=i,this.ctx.direction=s.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(o,A),l=a.baseline,c=a.middle,u=s.paintOrder,e.textBounds.forEach(function(h){u.forEach(function(m){switch(m){case 0:d.ctx.fillStyle=Ie(s.color),d.renderTextWithLetterSpacing(h,s.letterSpacing,l);var g=s.textShadow;g.length&&h.text.trim().length&&(g.slice(0).reverse().forEach(function(v){d.ctx.shadowColor=Ie(v.color),d.ctx.shadowOffsetX=v.offsetX.number*d.options.scale,d.ctx.shadowOffsetY=v.offsetY.number*d.options.scale,d.ctx.shadowBlur=v.blur.number,d.renderTextWithLetterSpacing(h,s.letterSpacing,l)}),d.ctx.shadowColor="",d.ctx.shadowOffsetX=0,d.ctx.shadowOffsetY=0,d.ctx.shadowBlur=0),s.textDecorationLine.length&&(d.ctx.fillStyle=Ie(s.textDecorationColor||s.color),s.textDecorationLine.forEach(function(v){switch(v){case 1:d.ctx.fillRect(h.bounds.left,Math.round(h.bounds.top+l),h.bounds.width,1);break;case 2:d.ctx.fillRect(h.bounds.left,Math.round(h.bounds.top),h.bounds.width,1);break;case 3:d.ctx.fillRect(h.bounds.left,Math.ceil(h.bounds.top+c),h.bounds.width,1);break}}));break;case 1:s.webkitTextStrokeWidth&&h.text.trim().length&&(d.ctx.strokeStyle=Ie(s.webkitTextStrokeColor),d.ctx.lineWidth=s.webkitTextStrokeWidth,d.ctx.lineJoin=window.chrome?"miter":"round",d.ctx.strokeText(h.text,h.bounds.left,h.bounds.top+l)),d.ctx.strokeStyle="",d.ctx.lineWidth=0,d.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(e,s,r){if(r&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var i=kc(e),o=Dc(s);this.path(o),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,e.intrinsicWidth,e.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return Ze(this,void 0,void 0,function(){var s,r,i,o,A,a,w,w,l,c,u,d,I,p,h,B,m,g,v,w,y,I,B;return Oe(this,function(C){switch(C.label){case 0:this.applyEffects(e.getEffects(4)),s=e.container,r=e.curves,i=s.styles,o=0,A=s.textNodes,C.label=1;case 1:return o<A.length?(a=A[o],[4,this.renderTextNode(a,i)]):[3,4];case 2:C.sent(),C.label=3;case 3:return o++,[3,1];case 4:if(!(s instanceof AB))return[3,8];C.label=5;case 5:return C.trys.push([5,7,,8]),[4,this.context.cache.match(s.src)];case 6:return w=C.sent(),this.renderReplacedElement(s,r,w),[3,8];case 7:return C.sent(),this.context.logger.error("Error loading image "+s.src),[3,8];case 8:if(s instanceof aB&&this.renderReplacedElement(s,r,s.canvas),!(s instanceof lB))return[3,12];C.label=9;case 9:return C.trys.push([9,11,,12]),[4,this.context.cache.match(s.svg)];case 10:return w=C.sent(),this.renderReplacedElement(s,r,w),[3,12];case 11:return C.sent(),this.context.logger.error("Error loading svg "+s.svg.substring(0,255)),[3,12];case 12:return s instanceof hB&&s.tree?(l=new t(this.context,{scale:this.options.scale,backgroundColor:s.backgroundColor,x:0,y:0,width:s.width,height:s.height}),[4,l.render(s.tree)]):[3,14];case 13:c=C.sent(),s.width&&s.height&&this.ctx.drawImage(c,0,0,s.width,s.height,s.bounds.left,s.bounds.top,s.bounds.width,s.bounds.height),C.label=14;case 14:if(s instanceof Tp&&(u=Math.min(s.bounds.width,s.bounds.height),s.type===Qc?s.checked&&(this.ctx.save(),this.path([new ut(s.bounds.left+u*.39363,s.bounds.top+u*.79),new ut(s.bounds.left+u*.16,s.bounds.top+u*.5549),new ut(s.bounds.left+u*.27347,s.bounds.top+u*.44071),new ut(s.bounds.left+u*.39694,s.bounds.top+u*.5649),new ut(s.bounds.left+u*.72983,s.bounds.top+u*.23),new ut(s.bounds.left+u*.84,s.bounds.top+u*.34085),new ut(s.bounds.left+u*.39363,s.bounds.top+u*.79)]),this.ctx.fillStyle=Ie(A0),this.ctx.fill(),this.ctx.restore()):s.type===Uc&&s.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(s.bounds.left+u/2,s.bounds.top+u/2,u/4,0,Math.PI*2,!0),this.ctx.fillStyle=Ie(A0),this.ctx.fill(),this.ctx.restore())),BN(s)&&s.value.length){switch(d=this.createFontStyle(i),I=d[0],p=d[1],h=this.fontMetrics.getMetrics(I,p).baseline,this.ctx.font=I,this.ctx.fillStyle=Ie(i.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=bN(s.styles.textAlign),B=kc(s),m=0,s.styles.textAlign){case 1:m+=B.width/2;break;case 2:m+=B.width;break}g=B.add(m,0,0,-B.height/2+1),this.ctx.save(),this.path([new ut(B.left,B.top),new ut(B.left+B.width,B.top),new ut(B.left+B.width,B.top+B.height),new ut(B.left,B.top+B.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new WA(s.value,g),i.letterSpacing,h),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ye(s.styles.display,2048))return[3,20];if(s.styles.listStyleImage===null)return[3,19];if(v=s.styles.listStyleImage,v.type!==0)return[3,18];w=void 0,y=v.url,C.label=15;case 15:return C.trys.push([15,17,,18]),[4,this.context.cache.match(y)];case 16:return w=C.sent(),this.ctx.drawImage(w,s.bounds.left-(w.width+10),s.bounds.top),[3,18];case 17:return C.sent(),this.context.logger.error("Error loading list-style-image "+y),[3,18];case 18:return[3,20];case 19:e.listValue&&s.styles.listStyleType!==-1&&(I=this.createFontStyle(i)[0],this.ctx.font=I,this.ctx.fillStyle=Ie(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",B=new hr(s.bounds.left,s.bounds.top+Xt(s.styles.paddingTop,s.bounds.width),s.bounds.width,Gg(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new WA(e.listValue,B),i.letterSpacing,Gg(i.lineHeight,i.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),C.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(e){return Ze(this,void 0,void 0,function(){var s,r,v,i,o,v,A,a,v,l,c,v,u,d,v,p,h,v,m,g,v;return Oe(this,function(w){switch(w.label){case 0:if(ye(e.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:w.sent(),s=0,r=e.negativeZIndex,w.label=2;case 2:return s<r.length?(v=r[s],[4,this.renderStack(v)]):[3,5];case 3:w.sent(),w.label=4;case 4:return s++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:w.sent(),i=0,o=e.nonInlineLevel,w.label=7;case 7:return i<o.length?(v=o[i],[4,this.renderNode(v)]):[3,10];case 8:w.sent(),w.label=9;case 9:return i++,[3,7];case 10:A=0,a=e.nonPositionedFloats,w.label=11;case 11:return A<a.length?(v=a[A],[4,this.renderStack(v)]):[3,14];case 12:w.sent(),w.label=13;case 13:return A++,[3,11];case 14:l=0,c=e.nonPositionedInlineLevel,w.label=15;case 15:return l<c.length?(v=c[l],[4,this.renderStack(v)]):[3,18];case 16:w.sent(),w.label=17;case 17:return l++,[3,15];case 18:u=0,d=e.inlineLevel,w.label=19;case 19:return u<d.length?(v=d[u],[4,this.renderNode(v)]):[3,22];case 20:w.sent(),w.label=21;case 21:return u++,[3,19];case 22:p=0,h=e.zeroOrAutoZIndexOrTransformedOrOpacity,w.label=23;case 23:return p<h.length?(v=h[p],[4,this.renderStack(v)]):[3,26];case 24:w.sent(),w.label=25;case 25:return p++,[3,23];case 26:m=0,g=e.positiveZIndex,w.label=27;case 27:return m<g.length?(v=g[m],[4,this.renderStack(v)]):[3,30];case 28:w.sent(),w.label=29;case 29:return m++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var s=this;e.forEach(function(r,i){var o=Vn(r)?r.start:r;i===0?s.ctx.moveTo(o.x,o.y):s.ctx.lineTo(o.x,o.y),Vn(r)&&s.ctx.bezierCurveTo(r.startControl.x,r.startControl.y,r.endControl.x,r.endControl.y,r.end.x,r.end.y)})},t.prototype.renderRepeat=function(e,s,r,i){this.path(e),this.ctx.fillStyle=s,this.ctx.translate(r,i),this.ctx.fill(),this.ctx.translate(-r,-i)},t.prototype.resizeImage=function(e,s,r){var i;if(e.width===s&&e.height===r)return e;var o=(i=this.canvas.ownerDocument)!==null&&i!==void 0?i:document,A=o.createElement("canvas");A.width=Math.max(1,s),A.height=Math.max(1,r);var a=A.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,s,r),A},t.prototype.renderBackgroundImage=function(e){return Ze(this,void 0,void 0,function(){var s,r,i,o,A,a;return Oe(this,function(l){switch(l.label){case 0:s=e.styles.backgroundImage.length-1,r=function(c){var u,d,p,x,L,R,Q,U,S,h,x,L,R,Q,U,m,g,v,w,y,I,B,C,b,S,T,x,_,F,Q,U,W,L,R,N,q,J,nt,At,ot,V,H;return Oe(this,function(G){switch(G.label){case 0:if(c.type!==0)return[3,5];u=void 0,d=c.url,G.label=1;case 1:return G.trys.push([1,3,,4]),[4,i.context.cache.match(d)];case 2:return u=G.sent(),[3,4];case 3:return G.sent(),i.context.logger.error("Error loading background-image "+d),[3,4];case 4:return u&&(p=Pd(e,s,[u.width,u.height,u.width/u.height]),x=p[0],L=p[1],R=p[2],Q=p[3],U=p[4],S=i.ctx.createPattern(i.resizeImage(u,Q,U),"repeat"),i.renderRepeat(x,S,L,R)),[3,6];case 5:iU(c)?(h=Pd(e,s,[null,null,null]),x=h[0],L=h[1],R=h[2],Q=h[3],U=h[4],m=tU(c.angle,Q,U),g=m[0],v=m[1],w=m[2],y=m[3],I=m[4],B=document.createElement("canvas"),B.width=Q,B.height=U,C=B.getContext("2d"),b=C.createLinearGradient(v,y,w,I),Vg(c.stops,g).forEach(function(Y){return b.addColorStop(Y.stop,Ie(Y.color))}),C.fillStyle=b,C.fillRect(0,0,Q,U),Q>0&&U>0&&(S=i.ctx.createPattern(B,"repeat"),i.renderRepeat(x,S,L,R))):oU(c)&&(T=Pd(e,s,[null,null,null]),x=T[0],_=T[1],F=T[2],Q=T[3],U=T[4],W=c.position.length===0?[Ep]:c.position,L=Xt(W[0],Q),R=Xt(W[W.length-1],U),N=eU(c,L,R,Q,U),q=N[0],J=N[1],q>0&&J>0&&(nt=i.ctx.createRadialGradient(_+L,F+R,0,_+L,F+R,q),Vg(c.stops,q*2).forEach(function(Y){return nt.addColorStop(Y.stop,Ie(Y.color))}),i.path(x),i.ctx.fillStyle=nt,q!==J?(At=e.bounds.left+.5*e.bounds.width,ot=e.bounds.top+.5*e.bounds.height,V=J/q,H=1/V,i.ctx.save(),i.ctx.translate(At,ot),i.ctx.transform(1,0,0,V,0,0),i.ctx.translate(-At,-ot),i.ctx.fillRect(_,H*(F-ot)+ot,Q,U*H),i.ctx.restore()):i.ctx.fill())),G.label=6;case 6:return s--,[2]}})},i=this,o=0,A=e.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return o<A.length?(a=A[o],[5,r(a)]):[3,4];case 2:l.sent(),l.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(e,s,r){return Ze(this,void 0,void 0,function(){return Oe(this,function(i){return this.path(w0(r,s)),this.ctx.fillStyle=Ie(e),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(e,s,r,i){return Ze(this,void 0,void 0,function(){var o,A;return Oe(this,function(a){switch(a.label){case 0:return s<3?[4,this.renderSolidBorder(e,r,i)]:[3,2];case 1:return a.sent(),[2];case 2:return o=lN(i,r),this.path(o),this.ctx.fillStyle=Ie(e),this.ctx.fill(),A=cN(i,r),this.path(A),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(e){return Ze(this,void 0,void 0,function(){var s,r,i,o,A,a,l,c,u=this;return Oe(this,function(d){switch(d.label){case 0:return this.applyEffects(e.getEffects(2)),s=e.container.styles,r=!Wr(s.backgroundColor)||s.backgroundImage.length,i=[{style:s.borderTopStyle,color:s.borderTopColor,width:s.borderTopWidth},{style:s.borderRightStyle,color:s.borderRightColor,width:s.borderRightWidth},{style:s.borderBottomStyle,color:s.borderBottomColor,width:s.borderBottomWidth},{style:s.borderLeftStyle,color:s.borderLeftColor,width:s.borderLeftWidth}],o=CN(Ao(s.backgroundClip,0),e.curves),r||s.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),Wr(s.backgroundColor)||(this.ctx.fillStyle=Ie(s.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:d.sent(),this.ctx.restore(),s.boxShadow.slice(0).reverse().forEach(function(p){u.ctx.save();var h=Lc(e.curves),m=p.inset?0:vN,g=AN(h,-m+(p.inset?1:-1)*p.spread.number,(p.inset?1:-1)*p.spread.number,p.spread.number*(p.inset?-2:2),p.spread.number*(p.inset?-2:2));p.inset?(u.path(h),u.ctx.clip(),u.mask(g)):(u.mask(h),u.ctx.clip(),u.path(g)),u.ctx.shadowOffsetX=p.offsetX.number+m,u.ctx.shadowOffsetY=p.offsetY.number,u.ctx.shadowColor=Ie(p.color),u.ctx.shadowBlur=p.blur.number,u.ctx.fillStyle=p.inset?Ie(p.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()}),d.label=2;case 2:A=0,a=0,l=i,d.label=3;case 3:return a<l.length?(c=l[a],c.style!==0&&!Wr(c.color)&&c.width>0?c.style!==2?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,A,e.curves,2)]:[3,11]):[3,13];case 4:return d.sent(),[3,11];case 5:return c.style!==3?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,A,e.curves,3)];case 6:return d.sent(),[3,11];case 7:return c.style!==4?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,A,e.curves)];case 8:return d.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,A,e.curves)];case 10:d.sent(),d.label=11;case 11:A++,d.label=12;case 12:return a++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(e,s,r,i,o){return Ze(this,void 0,void 0,function(){var A,a,l,c,u,d,p,h,m,g,v,w,y,I,B,C,B,C;return Oe(this,function(b){return this.ctx.save(),A=uN(i,r),a=w0(i,r),o===2&&(this.path(a),this.ctx.clip()),Vn(a[0])?(l=a[0].start.x,c=a[0].start.y):(l=a[0].x,c=a[0].y),Vn(a[1])?(u=a[1].end.x,d=a[1].end.y):(u=a[1].x,d=a[1].y),r===0||r===2?p=Math.abs(l-u):p=Math.abs(c-d),this.ctx.beginPath(),o===3?this.formatPath(A):this.formatPath(a.slice(0,2)),h=s<3?s*3:s*2,m=s<3?s*2:s,o===3&&(h=s,m=s),g=!0,p<=h*2?g=!1:p<=h*2+m?(v=p/(2*h+m),h*=v,m*=v):(w=Math.floor((p+m)/(h+m)),y=(p-w*h)/(w-1),I=(p-(w+1)*h)/w,m=I<=0||Math.abs(m-y)<Math.abs(m-I)?y:I),g&&(o===3?this.ctx.setLineDash([0,h+m]):this.ctx.setLineDash([h,m])),o===3?(this.ctx.lineCap="round",this.ctx.lineWidth=s):this.ctx.lineWidth=s*2+1.1,this.ctx.strokeStyle=Ie(e),this.ctx.stroke(),this.ctx.setLineDash([]),o===2&&(Vn(a[0])&&(B=a[3],C=a[0],this.ctx.beginPath(),this.formatPath([new ut(B.end.x,B.end.y),new ut(C.start.x,C.start.y)]),this.ctx.stroke()),Vn(a[1])&&(B=a[1],C=a[2],this.ctx.beginPath(),this.formatPath([new ut(B.end.x,B.end.y),new ut(C.start.x,C.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(e){return Ze(this,void 0,void 0,function(){var s;return Oe(this,function(r){switch(r.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Ie(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),s=aN(e),[4,this.renderStack(s)];case 1:return r.sent(),this.applyEffects([]),[2,this.canvas]}})})},t})(TB),BN=function(n){return n instanceof dB||n instanceof uB?!0:n instanceof Tp&&n.type!==Uc&&n.type!==Qc},CN=function(n,t){switch(n){case 0:return Lc(t);case 2:return nN(t);case 1:default:return Dc(t)}},bN=function(n){switch(n){case 1:return"center";case 2:return"right";case 0:default:return"left"}},yN=["-apple-system","system-ui"],SN=function(n){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?n.filter(function(t){return yN.indexOf(t)===-1}):n},EN=(function(n){hs(t,n);function t(e,s){var r=n.call(this,e,s)||this;return r.canvas=s.canvas?s.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=s,r.canvas.width=Math.floor(s.width*s.scale),r.canvas.height=Math.floor(s.height*s.scale),r.canvas.style.width=s.width+"px",r.canvas.style.height=s.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-s.x,-s.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+s.width+"x"+s.height+" at "+s.x+","+s.y+") with scale "+s.scale),r}return t.prototype.render=function(e){return Ze(this,void 0,void 0,function(){var s,r;return Oe(this,function(i){switch(i.label){case 0:return s=Lh(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,xN(s)];case 1:return r=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Ie(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(r,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t})(TB),xN=function(n){return new Promise(function(t,e){var s=new Image;s.onload=function(){t(s)},s.onerror=e,s.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(n))})},IN=(function(){function n(t){var e=t.id,s=t.enabled;this.id=e,this.enabled=s,this.start=Date.now()}return n.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,il([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.prototype.getTime=function(){return Date.now()-this.start},n.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,il([this.id,this.getTime()+"ms"],t))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,il([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,il([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.instances={},n})(),FN=(function(){function n(t,e){var s;this.windowBounds=e,this.instanceName="#"+n.instanceCount++,this.logger=new IN({id:this.instanceName,enabled:t.logging}),this.cache=(s=t.cache)!==null&&s!==void 0?s:new $P(this,t)}return n.instanceCount=1,n})(),TN=function(n,t){return t===void 0&&(t={}),_N(n,t)};typeof window<"u"&&yB.setContext(window);var _N=function(n,t){return Ze(void 0,void 0,void 0,function(){var e,s,r,i,o,A,a,l,c,u,d,p,h,m,g,v,w,y,I,B,b,C,b,S,T,x,_,F,Q,U,W,L,R,N,q,J,nt,At,ot,V;return Oe(this,function(H){switch(H.label){case 0:if(!n||typeof n!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(e=n.ownerDocument,!e)throw new Error("Element is not attached to a Document");if(s=e.defaultView,!s)throw new Error("Document is not attached to a Window");return r={allowTaint:(S=t.allowTaint)!==null&&S!==void 0?S:!1,imageTimeout:(T=t.imageTimeout)!==null&&T!==void 0?T:15e3,proxy:t.proxy,useCORS:(x=t.useCORS)!==null&&x!==void 0?x:!1},i=Ch({logging:(_=t.logging)!==null&&_!==void 0?_:!0,cache:t.cache},r),o={windowWidth:(F=t.windowWidth)!==null&&F!==void 0?F:s.innerWidth,windowHeight:(Q=t.windowHeight)!==null&&Q!==void 0?Q:s.innerHeight,scrollX:(U=t.scrollX)!==null&&U!==void 0?U:s.pageXOffset,scrollY:(W=t.scrollY)!==null&&W!==void 0?W:s.pageYOffset},A=new hr(o.scrollX,o.scrollY,o.windowWidth,o.windowHeight),a=new FN(i,A),l=(L=t.foreignObjectRendering)!==null&&L!==void 0?L:!1,c={allowTaint:(R=t.allowTaint)!==null&&R!==void 0?R:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:l,copyStyles:l},a.logger.debug("Starting document clone with size "+A.width+"x"+A.height+" scrolled to "+-A.left+","+-A.top),u=new m0(a,n,c),d=u.clonedReferenceElement,d?[4,u.toIFrame(e,A)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return p=H.sent(),h=_p(d)||MP(d)?AQ(d.ownerDocument):Tu(a,d),m=h.width,g=h.height,v=h.left,w=h.top,y=MN(a,d,t.backgroundColor),I={canvas:t.canvas,backgroundColor:y,scale:(q=(N=t.scale)!==null&&N!==void 0?N:s.devicePixelRatio)!==null&&q!==void 0?q:1,x:((J=t.x)!==null&&J!==void 0?J:0)+v,y:((nt=t.y)!==null&&nt!==void 0?nt:0)+w,width:(At=t.width)!==null&&At!==void 0?At:Math.ceil(m),height:(ot=t.height)!==null&&ot!==void 0?ot:Math.ceil(g)},l?(a.logger.debug("Document cloned, using foreign object rendering"),b=new EN(a,I),[4,b.render(d)]):[3,3];case 2:return B=H.sent(),[3,5];case 3:return a.logger.debug("Document cloned, element located at "+v+","+w+" with size "+m+"x"+g+" using computed rendering"),a.logger.debug("Starting DOM parsing"),C=pB(a,d),y===C.styles.backgroundColor&&(C.styles.backgroundColor=or.TRANSPARENT),a.logger.debug("Starting renderer for element at "+I.x+","+I.y+" with size "+I.width+"x"+I.height),b=new wN(a,I),[4,b.render(C)];case 4:B=H.sent(),H.label=5;case 5:return(!((V=t.removeContainer)!==null&&V!==void 0)||V)&&(m0.destroy(p)||a.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),a.logger.debug("Finished rendering"),[2,B]}})})},MN=function(n,t,e){var s=t.ownerDocument,r=s.documentElement?OA(n,getComputedStyle(s.documentElement).backgroundColor):or.TRANSPARENT,i=s.body?OA(n,getComputedStyle(s.body).backgroundColor):or.TRANSPARENT,o=typeof e=="string"?OA(n,e):e===null?or.TRANSPARENT:4294967295;return t===s.documentElement?Wr(r)?Wr(i)?o:i:r:o};const KA={},Tr={},QN=600,Nd=.25,C0={letter:{width:8.5,height:11},"11x14":{width:11,height:14},"11x17":{width:11,height:17}};async function UN(n,t){const e=document.getElementById("button-grid");if(!e)return E.warn("PrintService","Button grid element not found",null,"print"),null;const s=e.querySelector(".button-grid-left-cell"),r=e.querySelector(".button-grid-right-cell");try{const i=e.getBoundingClientRect(),o=(s==null?void 0:s.getBoundingClientRect().width)??0,A=(r==null?void 0:r.getBoundingClientRect().width)??0,a=Math.min(window.devicePixelRatio||1,2),l=await TN(e,{scale:a,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),c=i.width>0?l.width/i.width:1,u=n?0:Math.round(o*c),d=t?0:Math.round(A*c),p=Math.max(0,Math.min(l.width-1,u)),h=Math.max(p+1,Math.min(l.width,l.width-d)),m=Math.max(1,h-p),g=document.createElement("canvas");g.width=m,g.height=l.height,(g.getContext("2d",{willReadFrequently:!0})||g.getContext("2d")).drawImage(l,p,0,m,l.height,0,0,m,l.height);const w=kN(g,n,t);return E.debug("PrintService",`Captured button grid: ${w.width}x${w.height}`,null,"print"),w}catch(i){return E.error("PrintService","Failed to capture button grid",i,"print"),null}}function PN(n,t){const e=document.getElementById("notation-grid"),s=document.getElementById("legend-left-canvas"),r=document.getElementById("legend-right-canvas");if(!e)return E.warn("PrintService","Notation grid canvas not found",null,"print"),null;const i=n&&s?s.width:0,o=t&&r?r.width:0,A=i+e.width+o,a=i,l=document.createElement("canvas");l.width=A,l.height=e.height;const c=l.getContext("2d");return n&&s&&i>0&&c.drawImage(s,0,0),c.drawImage(e,a,0),t&&r&&o>0&&c.drawImage(r,a+e.width,0),E.debug("PrintService",`Captured pitch grid: ${l.width}x${l.height}`,null,"print"),l}function NN(n,t){const e=document.getElementById("drum-grid"),s=document.querySelector(".drum-grid-left-cell"),r=document.querySelector(".drum-grid-right-cell");if(!e||e.width===0)return E.debug("PrintService","Drum grid not found or empty",null,"print"),null;const i=e.offsetWidth?e.width/e.offsetWidth:1,o=n?Math.max(0,Math.round(((s==null?void 0:s.offsetWidth)||0)*i)):0,A=t?Math.max(0,Math.round(((r==null?void 0:r.offsetWidth)||0)*i)):0,a=o+e.width+A,l=getComputedStyle(document.documentElement).getPropertyValue("--c-surface")||"#ffffff",c=document.createElement("canvas");c.width=a,c.height=e.height;const u=c.getContext("2d");return u.fillStyle=l.trim()||"#ffffff",u.fillRect(0,0,a,e.height),u.drawImage(e,o,0),E.debug("PrintService",`Captured drum grid: ${c.width}x${c.height}`,null,"print"),c}function LN(n){const t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=t.getContext("2d");e.drawImage(n,0,0);const s=e.getImageData(0,0,t.width,t.height),r=s.data;for(let i=0;i<r.length;i+=4){const o=r[i]*.299+r[i+1]*.587+r[i+2]*.114;r[i]=o,r[i+1]=o,r[i+2]=o}return e.putImageData(s,0,0),t}async function DN(n,t){E.debug("PrintService","Generating score canvas...",{printOptions:n,targetDimensions:t},"print");const e=[];if(n.includeButtonGrid){const I=await _B(n.includeLeftLegend,n.includeRightLegend);I&&e.push({canvas:I,name:"buttons"})}const s=PN(n.includeLeftLegend,n.includeRightLegend);if(s&&e.push({canvas:s,name:"pitch"}),n.includeDrums){const I=NN(n.includeLeftLegend,n.includeRightLegend);I&&e.push({canvas:I,name:"drums"})}if(e.length===0)return E.warn("PrintService","No content captured for printing",null,"print"),null;n.colorMode==="bw"&&(e.forEach(I=>{I.canvas=LN(I.canvas)}),E.debug("PrintService","Applied black & white filter",null,"print"));const r=Math.max(...e.map(I=>I.canvas.width)),i=e.reduce((I,B)=>I+B.canvas.height,0),o=n.cropTop||0,A=n.cropBottom||1,a=n.cropLeft||0,l=n.cropRight||1,c=i*(A-o),u=r*(l-a),d=i*o,p=r*a;E.debug("PrintService",`Applying crop: top=${o.toFixed(2)}, bottom=${A.toFixed(2)}, left=${a.toFixed(2)}, right=${l.toFixed(2)}`,null,"print");const h=Math.min(t.width/u,t.height/c),m=document.createElement("canvas");m.width=u*h,m.height=c*h;const g=m.getContext("2d");g.fillStyle="#FFFFFF",g.fillRect(0,0,m.width,m.height);const v=document.createElement("canvas");v.width=r,v.height=i;const w=v.getContext("2d");let y=0;return e.forEach(({canvas:I,name:B})=>{w.drawImage(I,0,y),E.debug("PrintService",`Drew ${B} at y=${y}, height=${I.height}`,null,"print"),y+=I.height}),g.drawImage(v,p,d,u,c,0,0,m.width,m.height),E.debug("PrintService",`Generated composite canvas: ${m.width}x${m.height}`,null,"print"),m}const Zl={generateScoreCanvas:DN,async generateAndPrint(){const n=f.state.printOptions,t=300,e=n.pageSize,s=e&&e in C0?e:"letter",r=C0[s],i=n.orientation==="landscape"?r.height:r.width,o=n.orientation==="landscape"?r.width:r.height,A=Math.max(1,i-2*Nd),a=Math.max(1,o-2*Nd),l=A*t,c=a*t;E.info("PrintService","Generating print canvas at high resolution",{width:l,height:c,options:n},"print");const u=await this.generateScoreCanvas(n,{width:l,height:c});if(!u){E.error("PrintService","Failed to generate print canvas",null,"print");return}const d=document.getElementById("print-staging-area");d.innerHTML="";const p=document.getElementById("print-style-rules");p.textContent=`@page { size: ${i}in ${o}in; margin: ${Nd}in; }`;const h=document.createElement("img");h.src=u.toDataURL("image/png"),h.style.width="100%",h.style.height="auto",d.appendChild(h),E.info("PrintService","Opening print dialog",null,"print"),setTimeout(()=>window.print(),100)},async prefetchButtonGridSnapshot(n=!0,t=!0){try{await _B(n,t)}catch(e){E.warn("PrintService","Button grid prefetch failed",e,"print")}},invalidateButtonGridSnapshot(){MB()}};function kN(n,t,e){if(!n)return n;const s=document.getElementById("notation-grid"),r=document.getElementById("legend-left-canvas"),i=document.getElementById("legend-right-canvas"),o=t&&r?r.width:0,A=e&&i?i.width:0,a=((s==null?void 0:s.width)??0)+o+A||n.width;if(!a||a===n.width)return n;const l=a/n.width,c=Math.max(1,Math.round(n.height*l)),u=document.createElement("canvas");return u.width=a,u.height=c,(u.getContext("2d",{willReadFrequently:!0})||u.getContext("2d")).drawImage(n,0,0,u.width,u.height),u}async function _B(n,t){const e=`${n}-${t}`;return KA[e]!==void 0?KA[e]??null:(Tr[e]||(Tr[e]=(async()=>{await RN();const s=await UN(n,t);return KA[e]=s,Tr[e]=null,s})().catch(s=>{throw Tr[e]=null,s})),Tr[e])}function RN(){return new Promise(n=>{typeof window.requestIdleCallback=="function"?requestIdleCallback(()=>n(),{timeout:QN}):requestAnimationFrame(()=>n())})}function MB(){Object.keys(KA).forEach(n=>{delete KA[n]}),Object.keys(Tr).forEach(n=>{delete Tr[n]})}typeof window<"u"&&window.addEventListener("resize",()=>MB());function xs(n,t){if(!n)return`rgba(204, 204, 204, ${t})`;const e=parseInt(n.slice($w,$m),Gl),s=parseInt(n.slice($m,Xm),Gl),r=parseInt(n.slice(Xm,r_),Gl);return`rgba(${e}, ${s}, ${r}, ${t})`}function Ru(n,t){if(!n||typeof n!="string")return s_;const e=parseInt(n.slice($w),Gl),s=t<0?i_:o_,r=t<0?t*-1:t,i=e>>16,o=e>>8&255,A=e&255;return"#"+(16777216+(Math.round((s-i)*r)+i)*65536+(Math.round((s-o)*r)+o)*256+(Math.round((s-A)*r)+A)).toString(16).slice(1)}const HN=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor"/>\r
</svg>`,ON=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(90, 12, 12)"/>\r
</svg>`,VN=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(180, 12, 12)"/>\r
</svg>`,WN=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(270, 12, 12)"/>\r
</svg>`,QB=Io;function SA(n,t){const{blend:e,cutoff:s,resonance:r}=t,i=(s-1)/30,o=20,A=n-i,a=i-n;let l=1/(1+Math.pow(Math.max(0,A*o),2)),c=1/(1+Math.pow(Math.max(0,a*o),2));const u=.01;l<u&&(l=0),c<u&&(c=0);const d=l*c;let p;e<=1?p=c*(1-e)+d*e:p=d*(2-e)+l*(e-1);const h=1-(r||0)/105,m=Math.max(.01,.2*h*h),g=Math.exp(-Math.pow((n-i)/m,2)),v=(r||0)/100*.6,w=p+g*v,y=Math.max(0,Math.min(1,w));return y<u?0:y}function GN(n,t){const e=t/100;return 1-e+e*n}function fa(n,t){const e=t.mix||0;if(e===0)return new Float32Array(n);const s=new Float32Array(n.length),r=e/100;for(let i=0;i<n.length;i++){const o=n[i]??0,A=(i+.5)/QB,a=SA(A,t);if(a<o){const u=(o-a)*r;s[i]=o-u}else s[i]=o;const l=s[i]??0;s[i]=Math.max(0,l)}return s}function Wh(n){const t=f.state.timbres[n];if(!t)return new Float32Array(QB);const e=t.filter;return e&&e.enabled!==!1&&(e.mix||0)>0?fa(t.coeffs,e):new Float32Array(t.coeffs)}E.moduleLoaded("OvertoneBins with Columnar Structure");function Gh(n,...t){}const tc={0:HN,90:ON,180:VN,270:WN},Ms=Io;let Fe=null,Be=null,Ve=new Float32Array(Ms).fill(0),Kt=null,En=new Float32Array(Ms).fill(0);const Mp=[],Kh=[];let go=!1,Hn=null;const Fl=new Array(Ms).fill(null);let Tl=!1;const _l=new Float32Array(Ms).fill(1);new Float32Array(Ms).fill(0);function qh(){var A;if(!Kt||((!Fe||!Be||!Hn)&&(Fe=document.getElementById("filter-overlay-canvas"),Hn=document.querySelector(".overtone-bins-grid"),Fe&&(Be=Fe.getContext("2d"))),!Fe||!Be||!Hn))return;const{width:n,height:t}=Fe;Be.clearRect(0,0,n,t);const s=t*.95,r=t,i=(A=f.state.timbres[Kt])==null?void 0:A.filter,o=i&&i.enabled!==!1;if(i&&o){const a=i.mix||0;if(a===0){_l.fill(1);return}const l=[];for(let h=0;h<Ms;h++){const m=(h+.5)/Ms,g=SA(m,i);_l[h]=GN(g,a),l.push({bin:h+1,rawFilterAmp:g.toFixed(3),afterMix:(_l[h]??0).toFixed(3)})}Be.beginPath();const c=2;for(let h=0;h<=n;h+=c){const m=h/n,g=SA(m,i),v=r-g*s;h===0?Be.moveTo(h,v):Be.lineTo(h,v)}const d=.4+a/100*.6;Be.strokeStyle=xs(Ru(Kt,-.3),d),Be.lineWidth=2.5,Be.stroke();const p=a/100;if(p>0){Be.beginPath(),Be.moveTo(0,0),Be.lineTo(n,0);const h=SA(1,i),m=r-h*s;Be.lineTo(n,m);for(let g=n;g>=0;g-=2){const v=g/n,w=SA(v,i),y=r-w*s;Be.lineTo(g,y)}Be.closePath(),Be.fillStyle=`rgba(255, 255, 255, ${p})`,Be.fill()}}else _l.fill(1)}function qA(){if(!Kt)return;const n=Kt;Mp.forEach((t,e)=>{const s=t.sliderTrack.querySelector(".slider-fill"),r=t.sliderTrack.querySelector(".harmonic-label-internal");if(!s||!r)return;const i=Ve[e]??0;if(s.style.height=`${i*100}%`,i>0){const A=Ru(n,-.1);s.style.backgroundColor=xs(A,1)}else s.style.backgroundColor="transparent";const o=s.querySelector("canvas");o&&o.remove(),i>.1?(r.style.color="rgba(255, 255, 255, 0.35)",r.style.textShadow="0 0 2px rgba(0,0,0,0.3)"):(r.style.color="rgba(51, 51, 51, 0.5)",r.style.textShadow="0 0 1px rgba(255,255,255,0.3)")}),qh()}function b0(n,t=null){var u,d,p,h;if(!Kt||!Hn)return;const e=n.target instanceof Element?n.target:null;if(Gh("log","[BINS DRAG] handleBinPointerEvent called",{clientX:n.clientX,clientY:n.clientY}),E.debug("OvertoneBins","handleBinPointerEvent called",{target:e==null?void 0:e.className},"filter"),e!=null&&e.classList.contains("phase-button")||e!=null&&e.closest(".phase-button")||(e==null?void 0:e.tagName)==="path"||(e==null?void 0:e.tagName)==="svg"){E.debug("OvertoneBins","Blocking phase button interaction in handleBinPointerEvent",null,"filter");return}if(t===null){const m=Hn.getBoundingClientRect(),g=n.clientX-m.left,v=m.width/Ms,w=Math.floor(g/v);t=Math.max(0,Math.min(Ms-1,w))}if(E.debug("OvertoneBins","handleBinPointerEvent - binIndex",{binIndex:t},"filter"),t===null)return;const s=f.state.timbres[Kt];if(!s)return;const r=Mp[t];if(!r)return;const o=r.sliderTrack.getBoundingClientRect(),A=n.clientY-o.top,a=o.height,l=(a-A)/a,c=Math.max(0,Math.min(1,l));if(Gh("log","[BINS DRAG] Setting bin",t+1,"value:",c.toFixed(3)),c===0){E.debug("OvertoneBins","Setting coefficient to zero immediately for bin",{binIndex:t},"filter");const m=new Float32Array(s.coeffs);m[t]=0,Ve[t]=0,f.setHarmonicCoefficients(Kt,m);const g=Fl[t];typeof g=="number"&&(clearTimeout(g),Fl[t]=null),go||(Wt.triggerAttack("C4",Kt),f.emit("spacebarPlayback",{color:Kt,isPlaying:!0}),go=!0);const v=(u=f.state.timbres[Kt])==null?void 0:u.filter;v&&v.enabled!==!1&&(v.mix||0)>0&&fa(m,v),(d=window.waveformVisualizer)!=null&&d.generateWaveform&&window.waveformVisualizer.generateWaveform(),E.debug("OvertoneBins",`Set coefficient H${t+1} to 0 for color ${Kt}`,null,"filter")}else{const m=Fl[t];typeof m=="number"&&(clearTimeout(m),Fl[t]=null),go||(Wt.triggerAttack("C4",Kt),f.emit("spacebarPlayback",{color:Kt,isPlaying:!0}),go=!0),E.debug("OvertoneBins","BEFORE creating newCoeffs - store coeffs",{coeffs:s.coeffs},"filter");const g=new Float32Array(s.coeffs);E.debug("OvertoneBins","AFTER copying to newCoeffs",{newCoeffs:g},"filter"),g[t]=c,Ve[t]=c,E.debug("OvertoneBins",`AFTER setting newCoeffs[${t}] = ${c}`,{newCoeffs:g},"filter"),f.setHarmonicCoefficients(Kt,g);const v=(p=f.state.timbres[Kt])==null?void 0:p.filter;v&&v.enabled!==!1&&(v.mix||0)>0&&fa(g,v),(h=window.waveformVisualizer)!=null&&h.generateWaveform&&window.waveformVisualizer.generateWaveform(),E.debug("OvertoneBins",`Updated coefficient H${t+1} to ${c} for color ${Kt}`,null,"filter"),E.debug("OvertoneBins","All coefficients",{newCoeffs:g},"filter")}qA()}function zh(n,t,e,s){const r=e.coeffs,i=e.phases||new Float32Array(r.length).fill(0);let o=!0,A=!0;if(n.length!==r.length)o=!1;else for(let l=0;l<n.length;l++){const c=n[l]??0,u=r[l]??0;if(Math.abs(c-u)>.001){o=!1;break}}if(t.length!==i.length)A=!1;else for(let l=0;l<t.length;l++){const c=t[l]??0,u=i[l]??0;if(Math.abs(c-u)>.001){A=!1;break}}return o&&A}function y0(n){if(!n)return;Kt=n;const t=f.state.timbres[n];t&&(t.filter?t.filter.enabled===void 0&&(t.filter.enabled=!0):t.filter={enabled:!0,blend:1,cutoff:16,resonance:0,type:"lowpass",mix:0},E.debug("OvertoneBins","updateForNewColor - timbre.coeffs",{coeffs:t.coeffs},"filter"),E.debug("OvertoneBins","updateForNewColor - timbre.phases",{phases:t.phases},"filter"),Ve=new Float32Array(t.coeffs),t.phases?En=new Float32Array(t.phases):En=new Float32Array(Ve.length).fill(0),zh(Ve,En,t),E.debug("OvertoneBins","updateForNewColor - final coeffs",{coeffs:Ve},"filter"),E.debug("OvertoneBins","updateForNewColor - final phases",{phases:En},"filter"),Kh.forEach(({phaseBtn:e},s)=>{if(!e)return;let i=(En[s]||0)%(2*Math.PI);i<0&&(i+=2*Math.PI);const o=.1;let A=0;Math.abs(i-Math.PI/2)<o?A=90:Math.abs(i-Math.PI)<o?A=180:Math.abs(i-3*Math.PI/2)<o&&(A=270),e.innerHTML=tc[A]}),qA())}function KN(){var A;const n=document.querySelector(".filter-container"),t=n==null?void 0:n.querySelector(".filter-bins-wrapper"),e=n==null?void 0:n.querySelector(".filter-vertical-blend-wrapper");if(!n||!t||!e){E.error("OvertoneBins","Missing required elements - aborting init",null,"audio");return}Hn=document.createElement("div"),Hn.className="overtone-bins-grid";for(let a=0;a<Ms;a++){const l=document.createElement("div");l.className="slider-column";const c=document.createElement("div");c.className="slider-track";const u=document.createElement("div");u.className="slider-fill",c.appendChild(u);const d=document.createElement("div");d.className="harmonic-label-internal",d.textContent=`${a+1}`,c.appendChild(d),l.appendChild(c);const p=document.createElement("button");p.className="phase-button",p.innerHTML=tc[0],p.dataset.binIndex=String(a),p.addEventListener("pointerenter",()=>{var h,m,g;if(Tl){const w=be(),y=Wt.synths,I=Kt;if(I&&((m=(h=y==null?void 0:y[I])==null?void 0:h.activeNotes)!=null&&m.C4)){const B=y[I].activeNotes.C4;(g=B.oscillators)!=null&&g[a]&&B.oscillators[a].volume.linearRampTo(-1/0,.015,w)}setTimeout(()=>{var T;const B=Kt,C=B?f.state.timbres[B]:void 0;if(!B||!C)return;const b=new Float32Array(C.coeffs);b[a]=0,Ve[a]=0,f.setHarmonicCoefficients(B,b);const S=(T=f.state.timbres[B])==null?void 0:T.filter;S&&S.enabled!==!1&&(S.mix||0)>0&&fa(b,S),qA()},.015*1e3)}}),p.addEventListener("click",h=>{var b;if(Tl){h.preventDefault();return}const m=Kt;if(!m)return;E.debug("OvertoneBins","Phase button click handler started",null,"filter"),E.debug("OvertoneBins","Current coeffs before phase change",{coeffs:Ve},"filter"),h.preventDefault();const g=new Float32Array(En),v=new Float32Array(En);let y=(v[a]||0)%(2*Math.PI);y<0&&(y+=2*Math.PI);const I=.1;let B=0;Math.abs(y)<I?B=Math.PI/2:Math.abs(y-Math.PI/2)<I?B=Math.PI:Math.abs(y-Math.PI)<I?B=3*Math.PI/2:B=0,v[a]=B,En=v,(b=window.waveformVisualizer)!=null&&b.startPhaseTransition&&window.waveformVisualizer.startPhaseTransition(g,v,a),f.setHarmonicPhases(m,v);const C=B===0?0:Math.abs(B-Math.PI/2)<I?90:Math.abs(B-Math.PI)<I?180:270;p.innerHTML=tc[C],E.debug("OvertoneBins",`Phase button clicked for H${a+1}, new phase: ${C}`,null,"filter")}),l.appendChild(p),Hn.appendChild(l),Mp.push({column:l,label:d,sliderTrack:c,sliderFill:u,phaseBtn:p}),Kh.push({phaseBtn:p})}Hn.addEventListener("pointerdown",a=>{const l=a.target instanceof Element?a.target:null;if(Gh("log","[BINS DRAG] Pointerdown event fired",{target:l,className:l==null?void 0:l.className}),l!=null&&l.classList.contains("phase-button")||l!=null&&l.closest(".phase-button")){E.debug("OvertoneBins","Pointerdown blocked - phase button clicked",null,"filter");return}if(E.debug("OvertoneBins","Pointerdown - handling bin interaction",null,"filter"),a.preventDefault(),Tl=!0,!Kt)return;const c=Kt;Wt.triggerAttack("C4",c),f.emit("spacebarPlayback",{color:c,isPlaying:!0}),go=!0,b0(a);const u=p=>b0(p),d=()=>{var h;window.removeEventListener("pointermove",u),window.removeEventListener("pointerup",d),Tl=!1;const p=!!((h=window.waveformVisualizer)!=null&&h.generateWaveform);f.recordState(),Wt.triggerRelease("C4",c),f.emit("spacebarPlayback",{color:c,isPlaying:!1}),go=!1,p?setTimeout(()=>{var m,g;(g=(m=window.waveformVisualizer)==null?void 0:m.generateWaveform)==null||g.call(m)},0):E.warn("OvertoneBins","Static waveform visualizer not ready when drag ended",null,"audio")};window.addEventListener("pointermove",u),window.addEventListener("pointerup",d)}),Fe=document.createElement("canvas"),Fe.id="filter-overlay-canvas",Fe.className="filter-overlay-canvas",Fe.style.pointerEvents="none",Be=Fe.getContext("2d"),Hn.appendChild(Fe);const s=document.createElement("div");s.className="vertical-blend-wrapper";const r=document.createElement("div");r.id="vertical-blend-track";const i=document.createElement("div");i.id="vertical-blend-thumb",i.textContent="M",r.appendChild(i),s.appendChild(r),t.appendChild(Hn),e.appendChild(s);const o=()=>{if(!Fe)return;const a=Fe.getBoundingClientRect();(Fe.width!==a.width||Fe.height!==a.height)&&(Fe.width=a.width,Fe.height=a.height,qh())};Kt=((A=f.state.selectedNote)==null?void 0:A.color)||"#4a90e2",y0(Kt),f.on("timbreChanged",a=>{if(a&&a===Kt){E.debug("OvertoneBins","timbreChanged event - checking what changed",null,"filter");const l=f.state.timbres[a];if(!l)return;const c=l.coeffs,u=l.phases;let d=!1;if(E.debug("OvertoneBins","Comparing coefficients...",null,"filter"),E.debug("OvertoneBins","Local coeffs",{coeffs:Ve},"filter"),E.debug("OvertoneBins","Store coeffs",{newCoeffs:c},"filter"),Ve.length!==c.length)E.debug("OvertoneBins","Array length mismatch - coeffsChanged = true",null,"filter"),d=!0;else for(let p=0;p<c.length;p++){const h=Ve[p]??0,m=c[p]??0,g=Math.abs(h-m);if(g>.001){E.debug("OvertoneBins",`Coefficient ${p} changed: ${h} -> ${m} (diff: ${g})`,null,"filter"),d=!0;break}}E.debug("OvertoneBins","Force syncing local coeffs with store",null,"filter"),zh(Ve,En,l),Ve=new Float32Array(c),u?En=new Float32Array(u):En=new Float32Array(Ve.length).fill(0),zh(Ve,En,l),d?(E.debug("OvertoneBins","Coefficients changed - updating visuals",null,"filter"),qA()):(E.debug("OvertoneBins","No coefficient changes detected - but local coeffs synced",null,"filter"),qh()),Kh.forEach(({phaseBtn:p},h)=>{if(!p)return;let g=(En[h]||0)%(2*Math.PI);g<0&&(g+=2*Math.PI);const v=.1;let w=0;Math.abs(g-Math.PI/2)<v?w=90:Math.abs(g-Math.PI)<v?w=180:Math.abs(g-3*Math.PI/2)<v&&(w=270),p.innerHTML=tc[w]})}}),f.on("noteChanged",({newNote:a}={})=>{a!=null&&a.color&&a.color!==Kt&&y0(a.color)}),f.on("filterChanged",a=>{const l=Kt;if(l&&a===l){qA();const c=f.state.timbres[l],u=c==null?void 0:c.filter;if(!c)return;u&&u.enabled!==!1&&(u.mix||0)>0?fa(c.coeffs,u):new Float32Array(c.coeffs)}}),new ResizeObserver(o).observe(Hn),o(),E.info("OvertoneBins","Initialized with columnar div structure and perfect alignment",null,"filter")}E.moduleLoaded("EngineAudio","general");let bt=null;const Wt={init(){E.info("EngineAudio","Initializing with engine createSynthEngine()",null,"audio"),bt=mF({timbres:f.state.timbres,masterVolume:0,harmonicFilter:{getFilteredCoefficients:n=>Wh(n)},effectsManager:{applySynthEffects:(n,t,e)=>{var s;(s=window.audioEffectsManager)==null||s.applySynthEffects(n,t,e)},applyEffectsToVoice:(n,t)=>{var e;(e=window.audioEffectsManager)==null||e.applyEffectsToVoice(n,t)}},logger:{debug:(n,t,e)=>{E.debug(n,t,e,"audio")},info:(n,t,e)=>{E.info(n,t,e,"audio")},warn:(n,t,e)=>{E.warn(n,t,e,"audio")}}}),bt.init(),f.on("timbreChanged",n=>{n&&this.updateSynthForColor(n)}),f.on("filterChanged",n=>{n&&this.updateSynthForColor(n)}),f.on("audioEffectChanged",n=>{if(!n||!n.color||!n.effectType)return;const{effectType:t,color:e}=n;(t==="vibrato"||t==="tremolo")&&this.updateSynthForColor(e)}),f.on("volumeChanged",n=>{typeof n=="number"&&this.setVolume(n)}),window.synthEngine=this,E.info("EngineAudio","Initialization complete",null,"audio")},updateSynthForColor(n){if(!bt)return;const t=f.state.timbres[n];t&&(t.vibrato||(t.vibrato={speed:0,span:0}),t.tremelo||(t.tremelo={speed:0,span:0}),bt.updateSynthForColor(n))},playNote(n,t,e){bt&&bt.playNote(n,t,e)},triggerAttack(n,t,e,s){bt&&bt.triggerAttack(n,t,e,s)},triggerAttackInteractive(n,t){bt&&bt.triggerAttackInteractive(n,t)},triggerRelease(n,t,e){bt&&bt.triggerRelease(n,t,e)},releaseAll(){bt&&bt.releaseAll()},quickReleasePitches(n,t){bt&&bt.quickReleasePitches(n,t)},setSynth(n,t){var e;bt&&((e=bt.setSynth)==null||e.call(bt,n,t))},getSynth(n){return bt?bt.getSynth(n):null},getAllSynths(){return bt?bt.getAllSynths():{}},setBpm(n){bt&&bt.setBpm(n)},setVolume(n){bt&&bt.setVolume(n)},getMasterGainNode(){return bt?bt.getMasterGainNode():null},getMainVolumeNode(){return bt?bt.getMainVolumeNode():null},createWaveformAnalyzer(n){return bt?bt.createWaveformAnalyzer(n):null},getWaveformAnalyzer(n){return bt?bt.getWaveformAnalyzer(n):null},getAllWaveformAnalyzers(){return bt?bt.getAllWaveformAnalyzers():new Map},removeWaveformAnalyzer(n){bt&&bt.removeWaveformAnalyzer(n)},disposeAllWaveformAnalyzers(){bt&&bt.disposeAllWaveformAnalyzers()},stopBackgroundMonitors(){bt&&bt.stopBackgroundMonitors()},teardown(){this.dispose()},dispose(){bt&&(bt.dispose(),bt=null)}};class qN{constructor(){M(this,"elements",new Map);M(this,"initialized",!1)}init(){this.initialized||(this.cacheElement("notationGrid","notation-grid"),this.cacheElement("playheadCanvas","playhead-canvas"),this.cacheElement("hoverCanvas","hover-canvas"),this.cacheElement("drumGrid","drum-grid"),this.cacheElement("drumPlayheadCanvas","drum-playhead-canvas"),this.cacheElement("drumHoverCanvas","drum-hover-canvas"),this.cacheElement("appContainer","app-container"),this.cacheElement("pitchGridWrapper","pitch-grid-wrapper"),this.cacheElement("drumGridWrapper","drum-grid-wrapper"),this.cacheElement("eraserButton","eraser-tool-button"),this.cacheElement("playButton","play-button"),this.cacheElement("stopButton","stop-button"),this.cacheElement("clearButton","clear-button"),this.cacheElement("loopButton","loop-button"),this.cacheElement("undoButton","undo-button"),this.cacheElement("redoButton","redo-button"),this.cacheElement("noteBankContainer","note-bank-container"),this.cacheElement("tonicModeGrid","tonic-mode-grid"),this.cacheElement("degreeVisibilityToggle","degree-visibility-toggle"),this.cacheElement("degreeModeToggle","degree-mode-toggle"),this.cacheElement("flatBtn","flat-toggle-btn"),this.cacheElement("sharpBtn","sharp-toggle-btn"),this.cacheElement("frequencyBtn","hz-toggle-btn"),this.cacheElement("octaveLabelBtn","spn-octave-toggle-btn"),this.cacheElement("focusColoursToggle","focus-colours-toggle"),this.cacheElement("harmonyContainerMain","chordShape-container"),this.cacheElement("tempoSlider","tempo-slider"),this.cacheElement("volumeSlider","vertical-volume-slider"),this.initialized=!0)}cacheElement(t,e){const s=document.getElementById(e);s&&this.elements.set(t,s)}get(t){return this.initialized?this.elements.get(t)??null:null}getMultiple(...t){const e={};return t.forEach(s=>{e[s]=this.get(s)}),e}has(t){return this.elements.has(t)}refresh(){this.elements.clear(),this.initialized=!1,this.init()}getStats(){const t=this.elements.size,e=Array.from(this.elements.values()).filter(s=>s!==null).length;return{totalCached:t,foundElements:e,missingElements:t-e}}}const fr=new qN;let zN=[],$N=0,S0=null,ec=[];function XN(){const n=f.state,t=Ne.getColumnMap(n);if(S0!==t){S0=t,ec=[];for(const e of t.entries){if(e.type!=="beat"||e.canvasIndex===null||e.macrobeatIndex===null)continue;const s=e.macrobeatIndex,r=ec[s];if(!r){ec[s]={start:e.canvasIndex,end:e.canvasIndex};continue}r.start=Math.min(r.start,e.canvasIndex),r.end=Math.max(r.end,e.canvasIndex)}}}function Qp(){return{cellWidth:f.state.cellWidth,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.baseMicrobeatPx}}function E0(){return zN}function YN(){return $N}function Rc(n){const t=Qp(),e=Math.max(0,Math.floor(n)),s=ei.getColumnPixelPosition(e,t,f.state);return(s==null?void 0:s.xStart)??0}function UB(n){const t=Qp(),e=Math.max(0,Math.floor(n)),s=ei.getColumnPixelPosition(e,t,f.state);return(s==null?void 0:s.width)??0}function jN(){return Array.isArray(f.state.columnWidths)?f.state.columnWidths.length:0}function JN(){const n=Qp(),t=jN(),e=ei.getColumnPixelPosition(t,n,f.state);return(e==null?void 0:e.xStart)??0}function $h(n){const t=f.state;XN();const e=Ne.getColumnMap(t),s=e.canvasToVisual.get(Math.floor(n));if(s===void 0)return null;const r=e.entries[s],i=r==null?void 0:r.macrobeatIndex;if(i==null)return null;const o=ec[i];if(!o)return null;const A=Rc(o.start),a=Rc(o.end+1);return{x:A,width:Math.max(0,a-A)}}const ZN={hz:0,minAlpha:.2,maxAlpha:.2,maxExpandPx:0,colorRgb:"rgb(255, 235, 0)"};function EA(n,t,e,s,r,i,o=ZN){if(!Number.isFinite(t)||!Number.isFinite(e)||!Number.isFinite(s)||!Number.isFinite(r)||s<=0||r<=0)return;const A=i/1e3,a=o.hz>0?.5+.5*Math.sin(A*(2*Math.PI)*o.hz):1,l=o.minAlpha+(o.maxAlpha-o.minAlpha)*a,c=Math.min(o.maxExpandPx,Math.max(0,s*.1))*a;n.save(),n.globalAlpha=l,n.fillStyle=o.colorRgb,n.fillRect(t-c/2,e,s+c,r),n.restore()}class t5{constructor(){M(this,"canvas",null);M(this,"ctx",null);M(this,"animationFrameId",null);M(this,"_lastColumnIndex",null);M(this,"_lastColumnProgress",0);M(this,"_lastColumnStartX",0);M(this,"_lastColumnWidth",0);M(this,"_lastDebugLogTime",0);M(this,"activeAnimations",new Map);M(this,"popDuration",{scaleUp:100,scaleDown:300});M(this,"popScale",1.5)}ensureContext(){return this.canvas||(this.canvas=document.getElementById("drum-playhead-canvas")),this.canvas?(this.ctx||(this.ctx=this.canvas.getContext("2d")),this.ctx):null}initialize(){this.canvas=document.getElementById("drum-playhead-canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),f.on("playbackStateChanged",()=>this.handlePlaybackStateChange()),f.on("tempoChanged",()=>this.invalidateTimeMap()))}drawPlayheadLine(t){const e=this.ensureContext();if(!e||!this.canvas)return;const s=ie(this.canvas);e.strokeStyle="rgba(255, 0, 0, 0.8)",e.lineWidth=2,e.beginPath(),e.moveTo(t,0),e.lineTo(t,s),e.stroke()}drawColumnHighlight(t,e,s){const r=this.ensureContext();if(!r||!this.canvas)return;const i=ie(this.canvas);EA(r,t,0,e,i,s)}handlePlaybackStateChange(){f.state.isPlaying&&!f.state.isPaused?this.startRendering():this.stopRendering({clear:!f.state.isPaused})}invalidateTimeMap(){}startRendering(){this.animationFrameId||this.render()}stopRendering({clear:t}={clear:!0}){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),t&&this.ctx&&this.canvas&&this.ctx.clearRect(0,0,$e(this.canvas),ie(this.canvas))}render(){if(!f.state.isPlaying||f.state.isPaused||!this.ctx||!this.canvas){this.animationFrameId=null;return}this.ctx.clearRect(0,0,$e(this.canvas),ie(this.canvas));const t=Number(ht.seconds||0),e=this.calculateXFromTime(t);if(e===null){this.animationFrameId=requestAnimationFrame(()=>this.render());return}const s=ie(this.canvas);if(f.state.playheadMode==="macrobeat"){const r=this._lastColumnIndex,i=(r!==null?$h(r):null)??(r!==null?$h(r+1):null);i?EA(this.ctx,i.x,0,i.width,s,performance.now()):EA(this.ctx,this._lastColumnStartX,0,this._lastColumnWidth,s,performance.now())}else f.state.playheadMode==="microbeat"?EA(this.ctx,this._lastColumnStartX,0,this._lastColumnWidth,s,performance.now()):(this.ctx.strokeStyle="#FF6B35",this.ctx.lineWidth=3,this.ctx.shadowColor="#FF6B35",this.ctx.shadowBlur=6,this.ctx.beginPath(),this.ctx.moveTo(e,0),this.ctx.lineTo(e,s),this.ctx.stroke(),this.ctx.shadowBlur=0);this.debugPlayhead(ht.seconds,e),this.animationFrameId=requestAnimationFrame(()=>this.render())}calculateXFromTime(t){this._lastColumnIndex=null,this._lastColumnProgress=0,this._lastColumnStartX=0,this._lastColumnWidth=0;const e=E0();if(!Array.isArray(e)||e.length<2)return null;for(let s=0;s<e.length-1;s++){const r=e[s],i=e[s+1];if(!(typeof r!="number"||typeof i!="number")&&t>=r&&t<i){const o=i-r,A=t-r,a=Rc(s)??0,l=UB(s)??0;return this._lastColumnIndex=s,this._lastColumnProgress=o>0?A/o:0,this._lastColumnStartX=a,this._lastColumnWidth=l,a+(o>0?A/o*l:0)}}return null}debugPlayhead(t,e){if(!window.__DEBUG_PLAYHEAD_SYNC__)return;const s=performance.now();if(s-this._lastDebugLogTime<250)return;this._lastDebugLogTime=s;const r=E0(),i=this._lastColumnIndex,o=Array.isArray(r)&&i!==null&&i>=0?r[i]:void 0,A=Array.isArray(r)&&i!==null&&i+1<r.length?r[i+1]:void 0,a=Array.isArray(r)?r[r.length-1]??0:0,l=YN(),c={transportSeconds:Number(t.toFixed(3)),drumX:Number((e??0).toFixed(2)),columnIndex:i,columnProgress:Number(this._lastColumnProgress.toFixed(3)),drumStartTime:Number((o==null?void 0:o.toFixed(3))??NaN),transportStartTime:Number((o==null?void 0:o.toFixed(3))??NaN),startDelta:0,drumEndTime:Number((A==null?void 0:A.toFixed(3))??NaN),transportEndTime:Number((A==null?void 0:A.toFixed(3))??NaN),endDelta:0,drumTimelineEnd:Number(a.toFixed(3)),transportTimelineEnd:Number(l.toFixed(3)),timelineDelta:Number((a-l).toFixed(3)),toneLoopStart:Number(Number(ht.loopStart??0).toFixed(3)),toneLoopEnd:Number(Number(ht.loopEnd??0).toFixed(3)),storeLooping:f.state.isLooping};E.debug("DrumPlayheadRenderer","Playhead diagnostics",c,"canvas")}triggerNotePop(t,e){const s=`${t}-${e}`;this.activeAnimations.set(s,{startTime:performance.now(),phase:"scaleUp"}),window.drumGridRenderer&&window.drumGridRenderer.render()}getAnimationScale(t,e){const s=`${t}-${e}`,r=this.activeAnimations.get(s);if(!r)return 1;const i=performance.now(),o=i-r.startTime;if(r.phase==="scaleUp"){if(o>=this.popDuration.scaleUp)return r.phase="scaleDown",r.startTime=i,this.popScale;{const A=o/this.popDuration.scaleUp;return 1+(this.popScale-1)*A}}else if(r.phase==="scaleDown"){if(o>=this.popDuration.scaleDown)return this.activeAnimations.delete(s),1;{const A=o/this.popDuration.scaleDown;return this.popScale-(this.popScale-1)*A}}return 1}hasActiveAnimations(){return this.activeAnimations.size>0}cleanupAnimations(){const t=performance.now();for(const[e,s]of this.activeAnimations.entries()){const r=t-s.startTime,i=s.phase==="scaleUp"?this.popDuration.scaleUp:this.popDuration.scaleUp+this.popDuration.scaleDown;r>i&&this.activeAnimations.delete(e)}}}const Ar=new t5;E.moduleLoaded("SixteenthStampPlacements","stamps");function e5(n,t,e,s="#4a90e2"){return Iu(n)?f.addSixteenthStampPlacement(n,t,e,s):(E.warn("SixteenthStampPlacements",`Invalid sixteenth stamp ID: ${n}`,{sixteenthStampId:n},"stamps"),null)}function n5(n,t,e,s){return f.eraseSixteenthStampsInArea(n,t,e,s)}function PB(){f.clearAllSixteenthStamps()}function s5(){return f.getSixteenthStampPlaybackData()}E.moduleLoaded("SixteenthStampScheduler","stamps");const x0=["0","16n","8n",{"8n":1,"16n":1}];function NB(n,t=null){const e=Iu(n);if(!e)return E.warn("SixteenthStampScheduler",`Unknown sixteenth stamp ID: ${n}`,{sixteenthStampId:n},"stamps"),[];const s=[];return e.ovals.forEach(r=>{var A;const i=`oval_${r}`,o=((A=t==null?void 0:t.shapeOffsets)==null?void 0:A[i])||0;s.push({offset:x0[r],duration:"8n",type:"oval",slot:r,shapeKey:i,rowOffset:o})}),e.diamonds.forEach(r=>{var A;const i=`diamond_${r}`,o=((A=t==null?void 0:t.shapeOffsets)==null?void 0:A[i])||0;s.push({offset:x0[r],duration:"16n",type:"diamond",slot:r,shapeKey:i,rowOffset:o})}),s}E.moduleLoaded("TripletStampPlacements","triplets");function r5(n,t,e,s="#4a90e2"){const r=Fu(n);if(!r)return E.warn("TripletStampPlacements",`Invalid triplet stamp ID: ${n}`,{tripletStampId:n},"triplets"),null;const i=w2[r.span]??1;if(!i5(t,i,e))return E.debug("TripletStampPlacements",`Cannot place triplet at time ${t}, row ${e} - collision detected`,{tripletStampId:n,startTimeIndex:t,row:e,span:i},"triplets"),null;const o=e,A={id:`triplet_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,tripletStampId:n,startTimeIndex:t,span:i,row:e,globalRow:o,color:s,timestamp:Date.now()};return f.addTripletStampPlacement(A)}function i5(n,t,e){const s=f.state,r=Ye(s),i=t*2,o=Cn(n,s);for(const A of r){const a=A.columnIndex,l=A.columnIndex+1;if(a>=o&&a<o+i||o>=a&&o<=l)return!1}if(s.sixteenthStampPlacements){for(const A of s.sixteenthStampPlacements)if(A.row===e){const a=Yr(A.startColumn,s);if(a===null)return!1;const l=a+2,c=n+i;if(!(l<=n||a>=c))return!1}}if(s.tripletStampPlacements){for(const A of s.tripletStampPlacements)if(A.row===e){const a=A.startTimeIndex+A.span*2;if(!(n+i<=A.startTimeIndex||n>=a))return!1}}return!0}function o5(n,t,e,s){const r=f.state;if(!r.tripletStampPlacements)return!1;const i=[];for(const o of r.tripletStampPlacements)if(o.row>=e&&o.row<=s){const A=o.span*2,a=Cn(o.startTimeIndex,r);a+A-1<n||a>t||i.push(o.id)}return i.length>0?(i.forEach(o=>f.removeTripletStampPlacement(o)),E.debug("TripletStampPlacements",`Erased ${i.length} triplet groups`,{removedIds:i,eraseArea:{eraseStartCol:n,eraseEndCol:t,eraseStartRow:e,eraseEndRow:s}},"triplets"),!0):!1}function A5(){return f.getTripletStampPlaybackData()}function LB(){f.clearAllTripletStamps(),E.info("TripletStampPlacements","Cleared all triplet stamp placements",null,"triplets")}E.moduleLoaded("TripletScheduler","triplets");function DB(n,t=null){const e=Fu(n);if(!e)return E.warn("TripletScheduler",`Unknown triplet stamp ID: ${n}`,{tripletStampId:n},"triplets"),[];const s=[],r=e.span==="eighth"?"8t":"4t",i=r;return e.hits.forEach(o=>{var c;const A=`triplet_${o}`,a=((c=t==null?void 0:t.shapeOffsets)==null?void 0:c[A])||0;let l;if(o===0)l="0";else if(o===1)l=r;else if(o===2){const u=Ce(r).toSeconds();l=Ce(u*2).toNotation()}else{const u=Ce(r).toSeconds();l=Ce(u*o).toNotation()}s.push({offset:l,duration:i,type:e.span==="eighth"?"triplet-eighth":"triplet-quarter",slot:o,shapeKey:A,rowOffset:a}),E.debug("TripletScheduler",`Triplet stamp ${n} ${e.span} at slot ${o} with offset "${l}", rowOffset: ${a}`,"triplets")}),E.debug("TripletScheduler",`Total events for triplet stamp ${n}:`,s.length,"triplets"),s}E.moduleLoaded("EngineTransport","general");let Je=null;const uA=()=>fr.get("playheadCanvas")??document.getElementById("playhead-canvas"),Ml=()=>fr.get("drumPlayheadCanvas")??document.getElementById("drum-playhead-canvas"),a5=()=>fr.get("beatLineHighlight")??document.getElementById("beat-line-highlight"),nr={init(){E.info("EngineTransport","Initializing with engine createTransportService()",null,"transport"),Je=bF({synthEngine:Wt,stateCallbacks:{getState:()=>({tempo:f.state.tempo,columnWidths:f.state.columnWidths,hasAnacrusis:f.state.hasAnacrusis,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles,tempoModulationMarkers:f.state.tempoModulationMarkers,isLooping:f.state.isLooping,isPaused:f.state.isPaused,cellWidth:f.state.cellWidth,placedNotes:f.state.placedNotes,timbres:f.state.timbres,fullRowData:f.state.fullRowData,playheadMode:f.state.playheadMode}),getStampPlaybackData:()=>s5().map(n=>({sixteenthStampId:String(n.sixteenthStampId),column:n.column,row:n.row,color:n.color,placement:n.placement})),getStampScheduleEvents:(n,t)=>{const e=typeof n=="string"?Number(n):n;return Number.isFinite(e)?NB(e,t??null):[]},getTripletPlaybackData:()=>A5().map(n=>({tripletStampId:String(n.tripletStampId),startTimeIndex:n.startTimeIndex,row:n.row,color:n.color,placement:n.placement})),getTripletScheduleEvents:(n,t)=>{const e=typeof n=="string"?Number(n):n;return Number.isFinite(e)?DB(e,t??null):[]},timeToCanvas:(n,t)=>Cn(n,t),getPlacedTonicSigns:()=>Ye(f.state),getTonicSpanColumnIndices:n=>H_(n),getMacrobeatInfo:n=>mn(f.state,n),getColumnStartX:n=>Rc(n),getColumnWidth:n=>UB(n),getCanvasWidth:()=>JN(),getMacrobeatHighlightRect:n=>$h(n)},eventCallbacks:{on:(n,t)=>f.on(n,t),emit:(n,t)=>f.emit(n,t),setPlaybackState:(n,t)=>f.setPlaybackState(n,t)},visualCallbacks:{clearPlayheadCanvas:()=>{const n=uA();if(!n)return;const t=n.getContext("2d");if(!t)return;const e=$e(n),s=ie(n);t.clearRect(0,0,e,s)},clearDrumPlayheadCanvas:()=>{const n=Ml();if(!n)return;const t=n.getContext("2d");if(!t)return;const e=$e(n),s=ie(n);t.clearRect(0,0,e,s)},drawPlayheadLine:(n,t)=>{const e=uA();if(!e)return;const s=e.getContext("2d");s&&(s.strokeStyle="rgba(255, 0, 0, 0.8)",s.lineWidth=2,s.beginPath(),s.moveTo(n,0),s.lineTo(n,t),s.stroke())},drawPlayheadHighlight:(n,t,e,s)=>{const r=uA();if(!r)return;const i=r.getContext("2d");i&&EA(i,n,0,t,e,s)},drawDrumPlayheadLine:(n,t)=>{Ml()&&Ar.drawPlayheadLine(n)},drawDrumPlayheadHighlight:(n,t,e,s)=>{Ml()&&Ar.drawColumnHighlight(n,t,s)},updateBeatLineHighlight:(n,t,e)=>{const s=a5();s&&(e?(s.style.left=`${n}px`,s.style.width=`${t}px`,s.style.display="block"):s.style.display="none")},triggerDrumNotePop:(n,t)=>{Ar.triggerNotePop(n,t)},triggerAdsrVisual:(n,t,e,s)=>{window.adsrComponent&&window.adsrComponent.triggerPlayheadVisual(n,t,e,s)},clearAdsrVisuals:()=>{window.adsrComponent&&window.adsrComponent.clearAllPlayheadVisuals()},getPlayheadCanvasWidth:()=>{const n=uA();return n?$e(n):0},getPlayheadCanvasHeight:()=>{const n=uA();return n?ie(n):0},getDrumCanvasHeight:()=>{const n=Ml();return n?ie(n):0}},logger:{debug:(n,t,e)=>{E.debug(n,t,e,"transport")},info:(n,t,e)=>{E.info(n,t,e,"transport")},warn:(n,t,e)=>{E.warn(n,t,e,"transport")}}}),Je.init(),E.info("EngineTransport","Initialization complete",null,"transport")},handleStateChange(){Je&&Je.handleStateChange()},start(){Je&&Je.start()},resume(){Je&&Je.resume()},pause(){Je&&Je.pause()},stop(){Je&&Je.stop()},dispose(){Je&&(Je.dispose(),Je=null)}},l5=/(Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini)/i,kB=900;let I0=!1,nc=kB,Ld=!1;const c5=Object.freeze({isMobile:!1,isTouch:!1,isCoarsePointer:!1,orientation:"landscape",width:0,height:0});function Up(){return typeof window<"u"?window:null}function u5(){const n=Up();if(!n)return{...c5};const{innerWidth:t=0,innerHeight:e=0}=n,s=n.matchMedia?n.matchMedia("(orientation: portrait)"):null,r=s?s.matches?"portrait":"landscape":e>=t?"portrait":"landscape",i=!!(n.matchMedia&&n.matchMedia("(pointer: coarse)").matches),o=!!(n.matchMedia&&n.matchMedia("(hover: none)").matches),A=typeof navigator<"u"?navigator:null,a=(A==null?void 0:A.maxTouchPoints)??(A==null?void 0:A.msMaxTouchPoints)??0,l="ontouchstart"in n||a>0,c=A!=null&&A.userAgent?l5.test(A.userAgent):!1,u=t>0?t<=nc:!1;return{isMobile:!!(c||l&&(i||o||u)),isTouch:l,isCoarsePointer:i,orientation:r,width:t,height:e}}function d5(n){if(typeof document>"u")return;[document.documentElement,document.body].filter(Boolean).forEach(e=>{e.classList.toggle("is-mobile",!!n.isMobile),e.classList.toggle("is-touch",!!n.isTouch),e.classList.toggle("orientation-portrait",n.orientation==="portrait"),e.classList.toggle("orientation-landscape",n.orientation==="landscape")})}function Ql(){if(Ld)return;const n=Up();n&&(Ld=!0,n.requestAnimationFrame(()=>{Ld=!1;const t=u5();f.setDeviceProfile(t),d5(t)}))}function h5(n,t){return n?typeof n.addEventListener=="function"?(n.addEventListener("change",t),()=>n.removeEventListener("change",t)):typeof n.addListener=="function"?(n.addListener(t),()=>n.removeListener(t)):()=>{}:()=>{}}function f5(n={}){const t=Up();if(!t||I0)return;nc=n.maxMobileWidth??kB,I0=!0;const e=()=>Ql(),s=()=>Ql();t.addEventListener("resize",e),t.addEventListener("orientationchange",s),[t.matchMedia&&t.matchMedia("(pointer: coarse)"),t.matchMedia&&t.matchMedia("(hover: none)"),t.matchMedia&&t.matchMedia(`(max-width: ${nc}px)`),t.matchMedia&&t.matchMedia("(orientation: portrait)")].filter(Boolean).forEach(i=>{h5(i,Ql)}),Ql(),E.debug("DeviceProfileService",`Initialized (breakpoint <= ${nc}px)`,null,"ui")}const p5=()=>{const n="/music-learning-tools/student-notation/";return n.endsWith("/")?n:`${n}/`},m5=`${p5()}assets/`;function g5(n=""){const t=n.replace(/^\/+/,"");return`${m5}${t}`}function xr(n){return g5(`icons/${n}`)}class v5{constructor(){M(this,"tasks",[]);M(this,"completedTasks",0);M(this,"totalTasks",0);M(this,"startTime",null);M(this,"loadingScreen",null);M(this,"progressBar",null);M(this,"progressText",null);M(this,"statusText",null);M(this,"initialized",!1);M(this,"cache",{fonts:new Map,icons:new Map,modules:new Map});M(this,"diagnostics",[])}createLoadingScreen(){if(this.loadingScreen)return;const t=document.getElementById("app-loading-screen");t?this.loadingScreen=t:(this.loadingScreen=document.createElement("div"),this.loadingScreen.id="app-loading-screen",this.loadingScreen.innerHTML=`
            <div class="loading-container">
                <div class="loading-logo">
                    <svg viewBox="0 0 100 100" class="logo-svg">
                        <circle cx="50" cy="50" r="45" class="logo-circle" />
                        <path d="M 30 50 Q 50 30, 70 50 T 70 70" class="logo-path" />
                    </svg>
                </div>
                <h1 class="loading-title">Student Notation</h1>
                <div class="loading-progress-container">
                    <div class="loading-progress-bar">
                        <div class="loading-progress-fill" id="loading-progress-fill"></div>
                    </div>
                    <div class="loading-progress-text" id="loading-progress-text">0%</div>
                </div>
                <div class="loading-status" id="loading-status">Initializing...</div>
            </div>
        `,document.body.appendChild(this.loadingScreen)),this.progressBar=this.loadingScreen.querySelector("#loading-progress-fill"),this.progressText=this.loadingScreen.querySelector("#loading-progress-text"),this.statusText=this.loadingScreen.querySelector("#loading-status")}registerTask(t,e=1){this.tasks.push({name:t,weight:e,completed:!1}),this.totalTasks+=e}completeTask(t){const e=this.tasks.find(s=>s.name===t&&!s.completed);e&&(e.completed=!0,this.completedTasks+=e.weight,this.updateProgress())}updateProgress(){if(!this.progressBar||!this.progressText)return;const t=this.totalTasks>0?this.completedTasks/this.totalTasks*100:0;this.progressBar.style.width=`${t}%`,this.progressText.textContent=`${Math.floor(t)}%`,t>=100&&this.completeLoading()}async nextFrame(t=200){await new Promise(e=>{let s=!1;const r=()=>{s||(s=!0,e())};typeof requestAnimationFrame=="function"?(requestAnimationFrame(()=>r()),setTimeout(()=>r(),t)):setTimeout(()=>r(),0)})}setStatus(t){this.statusText&&(this.statusText.textContent=t)}start(){this.initialized||(this.initialized=!0,this.startTime=performance.now())}completeLoading(){this.loadingScreen&&(this.loadingScreen.classList.add("fade-out"),setTimeout(()=>{var t;(t=this.loadingScreen)==null||t.remove(),this.loadingScreen=null},400))}showError(t){if(this.statusText){const e=t instanceof Error?t.message:String(t);this.statusText.textContent=`Error: ${e}`,this.statusText.style.color="#ff4444"}}init(){this.createLoadingScreen(),this.start()}updateStatus(t){this.setStatus(t)}async complete(){this.completeLoading()}async preloadIcon(t){if(this.cache.icons.has(t))return this.cache.icons.get(t);const e=xr(t);return this.cache.icons.set(t,e),e}getDiagnostics(){return[...this.diagnostics]}}const wt=new v5;let Pp=!1,Np=[],sc=null;function RB(){Pp=!0}function w5(){Pp=!1}function HB(n){try{return JSON.parse(JSON.stringify(n,(t,e)=>e instanceof Float32Array?{__type:"Float32Array",data:Array.from(e)}:e))}catch{return null}}function Xh(n,t,e="root"){const s=[];if(!n||!t)return s;if(typeof n!=typeof t)return s.push({path:e,type:"type_change",oldValue:typeof n,newValue:typeof t,timestamp:Date.now()}),s;if(typeof n!="object")return n!==t&&s.push({path:e,type:"value_change",oldValue:n,newValue:t,timestamp:Date.now()}),s;if(Array.isArray(n)){if(!Array.isArray(t))return s.push({path:e,type:"array_to_non_array",oldLength:n.length,newType:typeof t,timestamp:Date.now()}),s;n.length!==t.length&&s.push({path:e,type:"array_length_change",oldLength:n.length,newLength:t.length,timestamp:Date.now()});const i=Math.max(n.length,t.length);for(let o=0;o<i;o++){const A=Xh(n[o],t[o],`${e}[${o}]`);s.push(...A)}return s}const r=new Set([...Object.keys(n),...Object.keys(t)]);for(const i of r)if(!(i in n))s.push({path:`${e}.${String(i)}`,type:"property_added",newValue:t[i],timestamp:Date.now()});else if(!(i in t))s.push({path:`${e}.${String(i)}`,type:"property_removed",oldValue:n[i],timestamp:Date.now()});else{const o=Xh(n[i],t[i],`${e}.${String(i)}`);s.push(...o)}return s}function B5(n){sc=HB(n)}function C5(n,t="unknown"){if(!Pp||!sc)return;const e=HB(n),s=Xh(sc,e);if(s.length>0){const r=s.filter(i=>!i.path.includes("tempo")&&!i.path.includes("isPlaying")&&!i.path.includes("fullRowData")&&!i.path.includes("columnWidths"));r.length>0&&Np.push({action:t,mutations:r,timestamp:Date.now()})}sc=e}function b5(){return[...Np]}function y5(){Np=[]}typeof window<"u"&&(window.stateGuard={enable:RB,disable:w5,getLog:b5,clearLog:y5});E.moduleLoaded("RhythmPlaybackService");class S5{constructor(){M(this,"scheduledEvents",[]);M(this,"isInitialized",!1);this.scheduledEvents=[],this.isInitialized=!1}init(){return this.initialize()}refresh(){this.stopCurrentPattern()}async initialize(){this.isInitialized||(this.isInitialized=!0,E.info("RhythmPlaybackService","Initialized"),window.rhythmPlaybackService=this)}playRhythmPattern(t,e,s,r="oval",i=null){if(!this.isInitialized){E.warn("RhythmPlaybackService","Not initialized, call initialize() first");return}this.stopCurrentPattern();const o=NB(t,i);if(!o||o.length===0){E.warn("RhythmPlaybackService",`No events found for sixteenth stamp ${t}`);return}E.debug("RhythmPlaybackService",`Playing pattern for sixteenth stamp ${t}: ${o.length} notes`,{sixteenthStampId:t,basePitch:e,color:s,events:o,hasShapeOffsets:!!(i!=null&&i.shapeOffsets)});const A=be(),a=(i==null?void 0:i.globalRow)??(i==null?void 0:i.row);o.forEach((l,c)=>{try{const u=Ce(String(l.offset)).toSeconds(),d=A+u,p=Ce(String(l.duration)).toSeconds(),h=r==="circle"?p*2:p,m=d+h;let g=e;if(a!==void 0&&l.rowOffset!==0){const v=a+l.rowOffset,w=f.state.fullRowData[v];w&&(g=w.toneNote.replace("","b").replace("","#"))}Wt.triggerAttack(g,s,d),Wt.triggerRelease(g,s,m),this.scheduledEvents.push({pitch:g,color:s,attackTime:d,releaseTime:m})}catch(u){E.warn("RhythmPlaybackService",`Error scheduling note ${c+1}`,u)}}),E.info("RhythmPlaybackService",`Scheduled ${o.length} notes for rhythm pattern ${t}`)}stopCurrentPattern(){this.scheduledEvents.length!==0&&(E.debug("RhythmPlaybackService",`Clearing ${this.scheduledEvents.length} scheduled events`),Wt.releaseAll(),this.scheduledEvents=[])}getSixteenthStampAtPosition(t,e){return f.state.sixteenthStampPlacements&&f.state.sixteenthStampPlacements.find(r=>{const i=r.row===e,o=t>=r.startColumn&&t<r.endColumn;return i&&o})||null}playTripletPattern(t,e,s,r=null){if(!this.isInitialized){E.warn("RhythmPlaybackService","Not initialized, call initialize() first");return}this.stopCurrentPattern();const i=DB(t,r);if(!i||i.length===0){E.warn("RhythmPlaybackService",`No events found for triplet ${t}`);return}E.debug("RhythmPlaybackService",`Playing triplet pattern ${t}: ${i.length} notes`,{tripletStampId:t,basePitch:e,color:s,events:i,hasShapeOffsets:!!(r!=null&&r.shapeOffsets)});const o=be(),A=(r==null?void 0:r.globalRow)??(r==null?void 0:r.row);i.forEach((a,l)=>{try{const c=Ce(a.offset).toSeconds(),u=o+c,d=Ce(a.duration).toSeconds(),p=u+d;let h=e;if(A!==void 0&&a.rowOffset!==0){const m=A+a.rowOffset,g=f.state.fullRowData[m];g&&(h=g.toneNote.replace("?T-","b").replace("?T_","#"))}Wt.triggerAttack(h,s,u),Wt.triggerRelease(h,s,p),this.scheduledEvents.push({pitch:h,color:s,attackTime:u,releaseTime:p})}catch(c){E.warn("RhythmPlaybackService",`Error scheduling triplet note ${l+1}`,c)}}),E.info("RhythmPlaybackService",`Scheduled ${i.length} notes for triplet pattern ${t}`)}getTripletStampAtPosition(t,e){return f.state.tripletStampPlacements&&f.state.tripletStampPlacements.find(s=>s.row===e&&t>=s.startTimeIndex&&t<s.startTimeIndex+s.span*2)||null}dispose(){this.stopCurrentPattern(),this.isInitialized=!1,E.info("RhythmPlaybackService","Disposed")}}const re=new S5,OB={H:"https://tonejs.github.io/audio/drum-samples/CR78/hihat.mp3",M:"https://tonejs.github.io/audio/drum-samples/CR78/snare.mp3",L:"https://tonejs.github.io/audio/drum-samples/CR78/kick.mp3"};let mi=null,Ys=null;const F0=new Map,E5=1e-4;let Yh=!1;function x5(n,t){let e=Number.isFinite(t)?t:be();const s=F0.get(n)??-1/0;return e>s||(e=s+E5),F0.set(n,e),e}function T0(){return mi}async function I5(){if(!Yh){Ys=new La(OB);try{await Ys.loaded,Yh=!0}catch(n){console.warn("Drum sample preloading failed, will load on-demand:",n),Ys==null||Ys.dispose(),Ys=null}}}function F5(){var t,e;const n=new ks(0);if(Ys&&Yh?(mi=Ys,mi.connect(n),Ys=null):mi=new La(OB).connect(n),window.synthEngine){const s=(e=(t=window.synthEngine).getMainVolumeNode)==null?void 0:e.call(t);s?n.connect(s):n.toDestination()}else n.toDestination();return window.drumVolumeNode=n,mi}function T5(n,t){var s;if(!mi)return;const e=x5(n,t);(s=mi.player(n))==null||s.start(e)}const VB=[];function ee(...n){VB.push(n)}const WB={enableModulationTool(){f.setSelectedTool("modulation"),ee("[MODULATION TEST] Modulation tool enabled. Click on the grid to place markers."),ee("[MODULATION TEST] Click marker labels to toggle 2:3  3:2"),ee("[MODULATION TEST] Drag marker barlines to move them")},addTestMarker(){const t=this.findNearestGridLine(200),e=this.findMeasureIndexForX(t.x),s=f.addModulationMarker(e,Fn.COMPRESSION_2_3,t.x,t.columnIndex);return ee("[MODULATION TEST] Added test marker at measure",e,"columnIndex=",t.columnIndex,"x=",t.x,"(snapped from",200,")"),s},addTestMarker2(){const t=this.findNearestGridLine(400),e=this.findMeasureIndexForX(t.x),s=f.addModulationMarker(e,Fn.EXPANSION_3_2,t.x,t.columnIndex);return ee("[MODULATION TEST] Added test marker 2 at measure",e,"columnIndex=",t.columnIndex,"x=",t.x,"(snapped from",400,")"),s},findNearestGridLine(n){const t=f.state;let e=0,s=0,r=1/0,i=0;for(let o=0;o<t.columnWidths.length;o++){const A=Math.abs(i-n);A<r&&(r=A,s=i,e=o);const a=t.columnWidths[o]||0;i+=a*t.cellWidth}return ee("[MODULATION TEST] findNearestGridLine:",{targetX:n,closestColumnIndex:e,closestX:s,minDistance:r}),{columnIndex:e,x:s}},findMeasureIndexForX(n){const t=f.state.cellWidth||40,e=5,s=Math.round(n/t);return Math.max(1,Math.round(s/e))},clearAllMarkers(){[...f.state.tempoModulationMarkers||[]].forEach(t=>{f.removeModulationMarker(t.id)}),ee("[MODULATION TEST] Cleared all markers")},testMapping(){var e;const n=f.state.baseMicrobeatPx||f.state.cellWidth||40;ee("[MODULATION TEST] Base microbeat pixels:",n),ee("[MODULATION TEST] Modulation markers:",f.state.tempoModulationMarkers);const t=typeof window<"u"?(e=window.getModulationMapping)==null?void 0:e.call(window):void 0;t&&(ee("[MODULATION TEST] Coordinate mapping:",t),[0,100,200,300,400,500].forEach(r=>{const i=t.canvasXToMicrobeat(r),o=t.microbeatToCanvasX(i);ee(`[MODULATION TEST] x=${r}  microbeat=${i.toFixed(3)}  x=${o.toFixed(1)}`)}))},testVisualExpansion(){var t;ee("[MODULATION TEST] Testing visual grid expansion..."),this.clearAllMarkers();const n=this.addTestMarker2();ee("[MODULATION TEST] Added 3:2 expansion marker:",n),typeof window<"u"&&((t=window.LayoutService)!=null&&t.recalculateLayout)&&(ee("[MODULATION TEST] Manually triggering layout recalculation..."),window.LayoutService.recalculateLayout()),setTimeout(()=>{ee("[MODULATION TEST] Grid should now show expansion after x=400"),ee("[MODULATION TEST] Container should be wider to accommodate expansion"),ee("[MODULATION TEST] Check console for [LAYOUT], [GETCOLX], [GRIDLINES], and [NOTES] logs")},100)},testVisualCompression(){var t;ee("[MODULATION TEST] Testing visual grid compression..."),this.clearAllMarkers();const n=this.addTestMarker();ee("[MODULATION TEST] Added 2:3 compression marker:",n),typeof window<"u"&&((t=window.LayoutService)!=null&&t.recalculateLayout)&&(ee("[MODULATION TEST] Manually triggering layout recalculation..."),window.LayoutService.recalculateLayout()),setTimeout(()=>{ee("[MODULATION TEST] Grid should now show compression after x=200"),ee("[MODULATION TEST] Container should adjust to accommodate compression"),ee("[MODULATION TEST] Check console for [LAYOUT], [GETCOLX], [GRIDLINES], and [NOTES] logs")},100)},logState(){ee("[MODULATION TEST] Current state:",{selectedTool:f.state.selectedTool,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.baseMicrobeatPx,cellWidth:f.state.cellWidth})}};typeof window<"u"&&(window.ModulationTest=WB,window.ModulationTestLogs=VB);E.moduleLoaded("ToolbarComponent","toolbar");const _5={init(){E.info("ToolbarComponent","Toolbar init called (all controls managed by Svelte)",null,"toolbar")}},jh=!1;var GB=Array.isArray,M5=Array.prototype.indexOf,Hu=Array.from,Q5=Object.defineProperty,Po=Object.getOwnPropertyDescriptor,U5=Object.getOwnPropertyDescriptors,P5=Object.prototype,N5=Array.prototype,KB=Object.getPrototypeOf,_0=Object.isExtensible;function L5(n){for(var t=0;t<n.length;t++)n[t]()}function qB(){var n,t,e=new Promise((s,r)=>{n=s,t=r});return{promise:e,resolve:n,reject:t}}const ke=2,Lp=4,Dp=8,D5=1<<24,vr=16,wr=32,zi=64,Ou=128,ls=512,ze=1024,Bn=2048,Qs=4096,Mn=8192,ar=16384,kp=32768,Ri=65536,M0=1<<17,zB=1<<18,oA=1<<19,k5=1<<20,kr=1<<25,Hi=32768,Jh=1<<21,Rp=1<<22,Gr=1<<23,zA=Symbol("$state"),R5=Symbol("legacy props"),H5=Symbol(""),vo=new class extends Error{constructor(){super(...arguments);M(this,"name","StaleReactionError");M(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Hp(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function O5(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function V5(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function W5(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function G5(n){throw new Error("https://svelte.dev/e/effect_orphan")}function K5(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function q5(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function z5(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function $5(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function X5(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Y5(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const j5=1,J5=2,Z5=16,tL=1,eL=4,nL=8,sL=16,rL=1,iL=2,He=Symbol(),oL="http://www.w3.org/1999/xhtml";function AL(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function $B(n){return n===this.v}function aL(n,t){return n!=n?t==t:n!==t||n!==null&&typeof n=="object"||typeof n=="function"}function XB(n){return!aL(n,this.v)}let lL=!1,Se=null;function qo(n){Se=n}function cL(n,t){return uL().set(n,t),t}function Qe(n,t=!1,e){Se={p:Se,i:!1,c:null,e:null,s:n,x:null,l:null}}function Ue(n){var t=Se,e=t.e;if(e!==null){t.e=null;for(var s of e)dC(s)}return t.i=!0,Se=t.p,{}}function YB(){return!0}function uL(n){return Se===null&&Hp(),Se.c??(Se.c=new Map(dL(Se)||void 0))}function dL(n){let t=n.p;for(;t!==null;){const e=t.c;if(e!==null)return e;t=t.p}return null}let wo=[];function hL(){var n=wo;wo=[],L5(n)}function Oa(n){if(wo.length===0){var t=wo;queueMicrotask(()=>{t===wo&&hL()})}wo.push(n)}function jB(n){var t=Gt;if(t===null)return Ut.f|=Gr,n;if((t.f&kp)===0){if((t.f&Ou)===0)throw n;t.b.error(n)}else zo(n,t)}function zo(n,t){for(;t!==null;){if((t.f&Ou)!==0)try{t.b.error(n);return}catch(e){n=e}t=t.parent}throw n}const Ul=new Set;let Vt=null,pe=null,ws=[],Op=null,Zh=!1;var No,Lo,Bi,Ci,ba,Do,ko,De,tf,xA,ef,JB,ZB;const Zc=class Zc{constructor(){Pt(this,De);M(this,"committed",!1);M(this,"current",new Map);M(this,"previous",new Map);Pt(this,No,new Set);Pt(this,Lo,new Set);Pt(this,Bi,0);Pt(this,Ci,0);Pt(this,ba,null);Pt(this,Do,new Set);Pt(this,ko,new Set);M(this,"skipped_effects",new Set);M(this,"is_fork",!1)}is_deferred(){return this.is_fork||j(this,Ci)>0}process(t){var s;ws=[],this.apply();var e={parent:null,effect:null,effects:[],render_effects:[]};for(const r of t)le(this,De,tf).call(this,r,e);this.is_fork||le(this,De,JB).call(this),this.is_deferred()?(le(this,De,xA).call(this,e.effects),le(this,De,xA).call(this,e.render_effects)):(Vt=null,Q0(e.render_effects),Q0(e.effects),(s=j(this,ba))==null||s.resolve()),pe=null}capture(t,e){this.previous.has(t)||this.previous.set(t,e),(t.f&Gr)===0&&(this.current.set(t,t.v),pe==null||pe.set(t,t.v))}activate(){Vt=this,this.apply()}deactivate(){Vt===this&&(Vt=null,pe=null)}flush(){if(this.activate(),ws.length>0){if(fL(),Vt!==null&&Vt!==this)return}else j(this,Bi)===0&&this.process([]);this.deactivate()}discard(){for(const t of j(this,Lo))t(this);j(this,Lo).clear()}increment(t){It(this,Bi,j(this,Bi)+1),t&&It(this,Ci,j(this,Ci)+1)}decrement(t){It(this,Bi,j(this,Bi)-1),t&&It(this,Ci,j(this,Ci)-1),this.revive()}revive(){for(const t of j(this,Do))j(this,ko).delete(t),Xe(t,Bn),Oi(t);for(const t of j(this,ko))Xe(t,Qs),Oi(t);this.flush()}oncommit(t){j(this,No).add(t)}ondiscard(t){j(this,Lo).add(t)}settled(){return(j(this,ba)??It(this,ba,qB())).promise}static ensure(){if(Vt===null){const t=Vt=new Zc;Ul.add(Vt),Zc.enqueue(()=>{Vt===t&&t.flush()})}return Vt}static enqueue(t){Oa(t)}apply(){}};No=new WeakMap,Lo=new WeakMap,Bi=new WeakMap,Ci=new WeakMap,ba=new WeakMap,Do=new WeakMap,ko=new WeakMap,De=new WeakSet,tf=function(t,e){var c;t.f^=ze;for(var s=t.first;s!==null;){var r=s.f,i=(r&(wr|zi))!==0,o=i&&(r&ze)!==0,A=o||(r&Mn)!==0||this.skipped_effects.has(s);if((s.f&Ou)!==0&&((c=s.b)!=null&&c.is_pending())&&(e={parent:e,effect:s,effects:[],render_effects:[]}),!A&&s.fn!==null){i?s.f^=ze:(r&Lp)!==0?e.effects.push(s):Wa(s)&&((s.f&vr)!==0&&j(this,Do).add(s),va(s));var a=s.first;if(a!==null){s=a;continue}}var l=s.parent;for(s=s.next;s===null&&l!==null;)l===e.effect&&(le(this,De,xA).call(this,e.effects),le(this,De,xA).call(this,e.render_effects),e=e.parent),s=l.next,l=l.parent}},xA=function(t){for(const e of t)(e.f&Bn)!==0?j(this,Do).add(e):(e.f&Qs)!==0&&j(this,ko).add(e),le(this,De,ef).call(this,e.deps),Xe(e,ze)},ef=function(t){if(t!==null)for(const e of t)(e.f&ke)===0||(e.f&Hi)===0||(e.f^=Hi,le(this,De,ef).call(this,e.deps))},JB=function(){if(j(this,Ci)===0){for(const t of j(this,No))t();j(this,No).clear()}j(this,Bi)===0&&le(this,De,ZB).call(this)},ZB=function(){var i;if(Ul.size>1){this.previous.clear();var t=pe,e=!0,s={parent:null,effect:null,effects:[],render_effects:[]};for(const o of Ul){if(o===this){e=!1;continue}const A=[];for(const[l,c]of this.current){if(o.current.has(l))if(e&&c!==o.current.get(l))o.current.set(l,c);else continue;A.push(l)}if(A.length===0)continue;const a=[...o.current.keys()].filter(l=>!this.current.has(l));if(a.length>0){var r=ws;ws=[];const l=new Set,c=new Map;for(const u of A)tC(u,a,l,c);if(ws.length>0){Vt=o,o.apply();for(const u of ws)le(i=o,De,tf).call(i,u,s);o.deactivate()}ws=r}}Vt=null,pe=t}this.committed=!0,Ul.delete(this)};let sr=Zc;function fL(){var n=Qi;Zh=!0;var t=null;try{var e=0;for(Oc(!0);ws.length>0;){var s=sr.ensure();if(e++>1e3){var r,i;pL()}s.process(ws),Kr.clear()}}finally{Zh=!1,Oc(n),Op=null}}function pL(){try{K5()}catch(n){zo(n,Op)}}let es=null;function Q0(n){var t=n.length;if(t!==0){for(var e=0;e<t;){var s=n[e++];if((s.f&(ar|Mn))===0&&Wa(s)&&(es=new Set,va(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?mC(s):s.fn=null),(es==null?void 0:es.size)>0)){Kr.clear();for(const r of es){if((r.f&(ar|Mn))!==0)continue;const i=[r];let o=r.parent;for(;o!==null;)es.has(o)&&(es.delete(o),i.push(o)),o=o.parent;for(let A=i.length-1;A>=0;A--){const a=i[A];(a.f&(ar|Mn))===0&&va(a)}}es.clear()}}es=null}}function tC(n,t,e,s){if(!e.has(n)&&(e.add(n),n.reactions!==null))for(const r of n.reactions){const i=r.f;(i&ke)!==0?tC(r,t,e,s):(i&(Rp|vr))!==0&&(i&Bn)===0&&eC(r,t,s)&&(Xe(r,Bn),Oi(r))}}function eC(n,t,e){const s=e.get(n);if(s!==void 0)return s;if(n.deps!==null)for(const r of n.deps){if(t.includes(r))return!0;if((r.f&ke)!==0&&eC(r,t,e))return e.set(r,!0),!0}return e.set(n,!1),!1}function Oi(n){for(var t=Op=n;t.parent!==null;){t=t.parent;var e=t.f;if(Zh&&t===Gt&&(e&vr)!==0&&(e&zB)===0)return;if((e&(zi|wr))!==0){if((e&ze)===0)return;t.f^=ze}}ws.push(t)}function mL(n){let t=0,e=Vi(0),s;return()=>{ma()&&(Z(e),hC(()=>(t===0&&(s=Ga(()=>n(()=>$A(e)))),t+=1,()=>{Oa(()=>{t-=1,t===0&&(s==null||s(),s=void 0,$A(e))})})))}}var gL=Ri|oA|Ou;function vL(n,t,e){new wL(n,t,e)}var Dn,kn,wf,Bs,bi,Cs,Rn,an,bs,Js,Qr,yi,Ur,Si,Pr,tu,Me,BL,CL,nf,rc,ic,sf;class wL{constructor(t,e,s){Pt(this,Me);M(this,"parent");Pt(this,Dn,!1);Pt(this,kn);Pt(this,wf,null);Pt(this,Bs);Pt(this,bi);Pt(this,Cs);Pt(this,Rn,null);Pt(this,an,null);Pt(this,bs,null);Pt(this,Js,null);Pt(this,Qr,null);Pt(this,yi,0);Pt(this,Ur,0);Pt(this,Si,!1);Pt(this,Pr,null);Pt(this,tu,mL(()=>(It(this,Pr,Vi(j(this,yi))),()=>{It(this,Pr,null)})));It(this,kn,t),It(this,Bs,e),It(this,bi,s),this.parent=Gt.b,It(this,Dn,!!j(this,Bs).pending),It(this,Cs,Wu(()=>{Gt.b=this;{var r=le(this,Me,nf).call(this);try{It(this,Rn,On(()=>s(r)))}catch(i){this.error(i)}j(this,Ur)>0?le(this,Me,ic).call(this):It(this,Dn,!1)}return()=>{var i;(i=j(this,Qr))==null||i.remove()}},gL))}is_pending(){return j(this,Dn)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!j(this,Bs).pending}update_pending_count(t){le(this,Me,sf).call(this,t),It(this,yi,j(this,yi)+t),j(this,Pr)&&$o(j(this,Pr),j(this,yi))}get_effect_pending(){return j(this,tu).call(this),Z(j(this,Pr))}error(t){var e=j(this,Bs).onerror;let s=j(this,Bs).failed;if(j(this,Si)||!e&&!s)throw t;j(this,Rn)&&(gn(j(this,Rn)),It(this,Rn,null)),j(this,an)&&(gn(j(this,an)),It(this,an,null)),j(this,bs)&&(gn(j(this,bs)),It(this,bs,null));var r=!1,i=!1;const o=()=>{if(r){AL();return}r=!0,i&&Y5(),sr.ensure(),It(this,yi,0),j(this,bs)!==null&&Mi(j(this,bs),()=>{It(this,bs,null)}),It(this,Dn,this.has_pending_snippet()),It(this,Rn,le(this,Me,rc).call(this,()=>(It(this,Si,!1),On(()=>j(this,bi).call(this,j(this,kn)))))),j(this,Ur)>0?le(this,Me,ic).call(this):It(this,Dn,!1)};var A=Ut;try{fn(null),i=!0,e==null||e(t,o),i=!1}catch(a){zo(a,j(this,Cs)&&j(this,Cs).parent)}finally{fn(A)}s&&Oa(()=>{It(this,bs,le(this,Me,rc).call(this,()=>{sr.ensure(),It(this,Si,!0);try{return On(()=>{s(j(this,kn),()=>t,()=>o)})}catch(a){return zo(a,j(this,Cs).parent),null}finally{It(this,Si,!1)}}))})}}Dn=new WeakMap,kn=new WeakMap,wf=new WeakMap,Bs=new WeakMap,bi=new WeakMap,Cs=new WeakMap,Rn=new WeakMap,an=new WeakMap,bs=new WeakMap,Js=new WeakMap,Qr=new WeakMap,yi=new WeakMap,Ur=new WeakMap,Si=new WeakMap,Pr=new WeakMap,tu=new WeakMap,Me=new WeakSet,BL=function(){try{It(this,Rn,On(()=>j(this,bi).call(this,j(this,kn))))}catch(t){this.error(t)}It(this,Dn,!1)},CL=function(){const t=j(this,Bs).pending;t&&(It(this,an,On(()=>t(j(this,kn)))),sr.enqueue(()=>{var e=le(this,Me,nf).call(this);It(this,Rn,le(this,Me,rc).call(this,()=>(sr.ensure(),On(()=>j(this,bi).call(this,e))))),j(this,Ur)>0?le(this,Me,ic).call(this):(Mi(j(this,an),()=>{It(this,an,null)}),It(this,Dn,!1))}))},nf=function(){var t=j(this,kn);return j(this,Dn)&&(It(this,Qr,qr()),j(this,kn).before(j(this,Qr)),t=j(this,Qr)),t},rc=function(t){var e=Gt,s=Ut,r=Se;Us(j(this,Cs)),fn(j(this,Cs)),qo(j(this,Cs).ctx);try{return t()}catch(i){return jB(i),null}finally{Us(e),fn(s),qo(r)}},ic=function(){const t=j(this,Bs).pending;j(this,Rn)!==null&&(It(this,Js,document.createDocumentFragment()),j(this,Js).append(j(this,Qr)),wC(j(this,Rn),j(this,Js))),j(this,an)===null&&It(this,an,On(()=>t(j(this,kn))))},sf=function(t){var e;if(!this.has_pending_snippet()){this.parent&&le(e=this.parent,Me,sf).call(e,t);return}It(this,Ur,j(this,Ur)+t),j(this,Ur)===0&&(It(this,Dn,!1),j(this,an)&&Mi(j(this,an),()=>{It(this,an,null)}),j(this,Js)&&(j(this,kn).before(j(this,Js)),It(this,Js,null)))};function bL(n,t,e,s){const r=Vu;if(e.length===0&&n.length===0){s(t.map(r));return}var i=Vt,o=Gt,A=yL();function a(){Promise.all(e.map(l=>SL(l))).then(l=>{A();try{s([...t.map(r),...l])}catch(c){(o.f&ar)===0&&zo(c,o)}i==null||i.deactivate(),Hc()}).catch(l=>{zo(l,o)})}n.length>0?Promise.all(n).then(()=>{A();try{return a()}finally{i==null||i.deactivate(),Hc()}}):a()}function yL(){var n=Gt,t=Ut,e=Se,s=Vt;return function(i=!0){Us(n),fn(t),qo(e),i&&(s==null||s.activate())}}function Hc(){Us(null),fn(null),qo(null)}function Vu(n){var t=ke|Bn,e=Ut!==null&&(Ut.f&ke)!==0?Ut:null;return Gt!==null&&(Gt.f|=oA),{ctx:Se,deps:null,effects:null,equals:$B,f:t,fn:n,reactions:null,rv:0,v:He,wv:0,parent:e??Gt,ac:null}}function SL(n,t){let e=Gt;e===null&&O5();var s=e.b,r=void 0,i=Vi(He),o=!Ut,A=new Map;return PL(()=>{var d;var a=qB();r=a.promise;try{Promise.resolve(n()).then(a.resolve,a.reject).then(()=>{l===Vt&&l.committed&&l.deactivate(),Hc()})}catch(p){a.reject(p),Hc()}var l=Vt;if(o){var c=!s.is_pending();s.update_pending_count(1),l.increment(c),(d=A.get(l))==null||d.reject(vo),A.delete(l),A.set(l,a)}const u=(p,h=void 0)=>{if(l.activate(),h)h!==vo&&(i.f|=Gr,$o(i,h));else{(i.f&Gr)!==0&&(i.f^=Gr),$o(i,p);for(const[m,g]of A){if(A.delete(m),m===l)break;g.reject(vo)}}o&&(s.update_pending_count(-1),l.decrement(c))};a.promise.then(u,p=>u(null,p||"unknown"))}),uC(()=>{for(const a of A.values())a.reject(vo)}),new Promise(a=>{function l(c){function u(){c===r?a(i):l(r)}c.then(u,u)}l(r)})}function gi(n){const t=Vu(n);return BC(t),t}function nC(n){const t=Vu(n);return t.equals=XB,t}function sC(n){var t=n.effects;if(t!==null){n.effects=null;for(var e=0;e<t.length;e+=1)gn(t[e])}}function EL(n){for(var t=n.parent;t!==null;){if((t.f&ke)===0)return(t.f&ar)===0?t:null;t=t.parent}return null}function Vp(n){var t,e=Gt;Us(EL(n));try{n.f&=~Hi,sC(n),t=SC(n)}finally{Us(e)}return t}function rC(n){var t=Vp(n);if(n.equals(t)||(Vt!=null&&Vt.is_fork||(n.v=t),n.wv=bC()),!$i)if(pe!==null)(ma()||Vt!=null&&Vt.is_fork)&&pe.set(n,t);else{var e=(n.f&ls)===0?Qs:ze;Xe(n,e)}}let rf=new Set;const Kr=new Map;let iC=!1;function Vi(n,t){var e={f:0,v:n,reactions:null,equals:$B,rv:0,wv:0};return e}function Rt(n,t){const e=Vi(n);return BC(e),e}function xL(n,t=!1,e=!0){const s=Vi(n);return t||(s.equals=XB),s}function St(n,t,e=!1){Ut!==null&&(!Is||(Ut.f&M0)!==0)&&YB()&&(Ut.f&(ke|vr|Rp|M0))!==0&&!(rn!=null&&rn.includes(n))&&X5();let s=e?Tn(t):t;return $o(n,s)}function $o(n,t){if(!n.equals(t)){var e=n.v;$i?Kr.set(n,t):Kr.set(n,e),n.v=t;var s=sr.ensure();s.capture(n,e),(n.f&ke)!==0&&((n.f&Bn)!==0&&Vp(n),Xe(n,(n.f&ls)!==0?ze:Qs)),n.wv=bC(),oC(n,Bn),Gt!==null&&(Gt.f&ze)!==0&&(Gt.f&(wr|zi))===0&&(Ln===null?DL([n]):Ln.push(n)),!s.is_fork&&rf.size>0&&!iC&&IL()}return t}function IL(){iC=!1;var n=Qi;Oc(!0);const t=Array.from(rf);try{for(const e of t)(e.f&ze)!==0&&Xe(e,Qs),Wa(e)&&va(e)}finally{Oc(n)}rf.clear()}function $A(n){St(n,n.v+1)}function oC(n,t){var e=n.reactions;if(e!==null)for(var s=e.length,r=0;r<s;r++){var i=e[r],o=i.f,A=(o&Bn)===0;if(A&&Xe(i,t),(o&ke)!==0){var a=i;pe==null||pe.delete(a),(o&Hi)===0&&(o&ls&&(i.f|=Hi),oC(a,Qs))}else A&&((o&vr)!==0&&es!==null&&es.add(i),Oi(i))}}function Tn(n){if(typeof n!="object"||n===null||zA in n)return n;const t=KB(n);if(t!==P5&&t!==N5)return n;var e=new Map,s=GB(n),r=Rt(0),i=Ui,o=A=>{if(Ui===i)return A();var a=Ut,l=Ui;fn(null),P0(i);var c=A();return fn(a),P0(l),c};return s&&e.set("length",Rt(n.length)),new Proxy(n,{defineProperty(A,a,l){(!("value"in l)||l.configurable===!1||l.enumerable===!1||l.writable===!1)&&z5();var c=e.get(a);return c===void 0?c=o(()=>{var u=Rt(l.value);return e.set(a,u),u}):St(c,l.value,!0),!0},deleteProperty(A,a){var l=e.get(a);if(l===void 0){if(a in A){const c=o(()=>Rt(He));e.set(a,c),$A(r)}}else St(l,He),$A(r);return!0},get(A,a,l){var p;if(a===zA)return n;var c=e.get(a),u=a in A;if(c===void 0&&(!u||(p=Po(A,a))!=null&&p.writable)&&(c=o(()=>{var h=Tn(u?A[a]:He),m=Rt(h);return m}),e.set(a,c)),c!==void 0){var d=Z(c);return d===He?void 0:d}return Reflect.get(A,a,l)},getOwnPropertyDescriptor(A,a){var l=Reflect.getOwnPropertyDescriptor(A,a);if(l&&"value"in l){var c=e.get(a);c&&(l.value=Z(c))}else if(l===void 0){var u=e.get(a),d=u==null?void 0:u.v;if(u!==void 0&&d!==He)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return l},has(A,a){var d;if(a===zA)return!0;var l=e.get(a),c=l!==void 0&&l.v!==He||Reflect.has(A,a);if(l!==void 0||Gt!==null&&(!c||(d=Po(A,a))!=null&&d.writable)){l===void 0&&(l=o(()=>{var p=c?Tn(A[a]):He,h=Rt(p);return h}),e.set(a,l));var u=Z(l);if(u===He)return!1}return c},set(A,a,l,c){var y;var u=e.get(a),d=a in A;if(s&&a==="length")for(var p=l;p<u.v;p+=1){var h=e.get(p+"");h!==void 0?St(h,He):p in A&&(h=o(()=>Rt(He)),e.set(p+"",h))}if(u===void 0)(!d||(y=Po(A,a))!=null&&y.writable)&&(u=o(()=>Rt(void 0)),St(u,Tn(l)),e.set(a,u));else{d=u.v!==He;var m=o(()=>Tn(l));St(u,m)}var g=Reflect.getOwnPropertyDescriptor(A,a);if(g!=null&&g.set&&g.set.call(c,l),!d){if(s&&typeof a=="string"){var v=e.get("length"),w=Number(a);Number.isInteger(w)&&w>=v.v&&St(v,w+1)}$A(r)}return!0},ownKeys(A){Z(r);var a=Reflect.ownKeys(A).filter(u=>{var d=e.get(u);return d===void 0||d.v!==He});for(var[l,c]of e)c.v!==He&&!(l in A)&&a.push(l);return a},setPrototypeOf(){$5()}})}var of,AC,aC,lC;function FL(){if(of===void 0){of=window,AC=/Firefox/.test(navigator.userAgent);var n=Element.prototype,t=Node.prototype,e=Text.prototype;aC=Po(t,"firstChild").get,lC=Po(t,"nextSibling").get,_0(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),_0(e)&&(e.__t=void 0)}}function qr(n=""){return document.createTextNode(n)}function Xo(n){return aC.call(n)}function Va(n){return lC.call(n)}function Te(n,t){return Xo(n)}function pa(n,t=!1){{var e=Xo(n);return e instanceof Comment&&e.data===""?Va(e):e}}function Ge(n,t=1,e=!1){let s=n;for(;t--;)s=Va(s);return s}function TL(n){n.textContent=""}function cC(){return!1}function Wp(n){var t=Ut,e=Gt;fn(null),Us(null);try{return n()}finally{fn(t),Us(e)}}function _L(n){Gt===null&&(Ut===null&&G5(),W5()),$i&&V5()}function ML(n,t){var e=t.last;e===null?t.last=t.first=n:(e.next=n,n.prev=e,t.last=n)}function Br(n,t,e){var s=Gt;s!==null&&(s.f&Mn)!==0&&(n|=Mn);var r={ctx:Se,deps:null,nodes:null,f:n|Bn|ls,first:null,fn:t,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(e)try{va(r),r.f|=kp}catch(A){throw gn(r),A}else t!==null&&Oi(r);var i=r;if(e&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&oA)===0&&(i=i.first,(n&vr)!==0&&(n&Ri)!==0&&i!==null&&(i.f|=Ri)),i!==null&&(i.parent=s,s!==null&&ML(i,s),Ut!==null&&(Ut.f&ke)!==0&&(n&zi)===0)){var o=Ut;(o.effects??(o.effects=[])).push(i)}return r}function ma(){return Ut!==null&&!Is}function uC(n){const t=Br(Dp,null,!1);return Xe(t,ze),t.teardown=n,t}function Qn(n){_L();var t=Gt.f,e=!Ut&&(t&wr)!==0&&(t&kp)===0;if(e){var s=Se;(s.e??(s.e=[])).push(n)}else return dC(n)}function dC(n){return Br(Lp|k5,n,!1)}function QL(n){sr.ensure();const t=Br(zi|oA,n,!0);return(e={})=>new Promise(s=>{e.outro?Mi(t,()=>{gn(t),s(void 0)}):(gn(t),s(void 0))})}function UL(n){return Br(Lp,n,!1)}function PL(n){return Br(Rp|oA,n,!0)}function hC(n,t=0){return Br(Dp|t,n,!0)}function _i(n,t=[],e=[],s=[]){bL(s,t,e,r=>{Br(Dp,()=>n(...r.map(Z)),!0)})}function Wu(n,t=0){var e=Br(vr|t,n,!0);return e}function On(n){return Br(wr|oA,n,!0)}function fC(n){var t=n.teardown;if(t!==null){const e=$i,s=Ut;U0(!0),fn(null);try{t.call(null)}finally{U0(e),fn(s)}}}function pC(n,t=!1){var e=n.first;for(n.first=n.last=null;e!==null;){const r=e.ac;r!==null&&Wp(()=>{r.abort(vo)});var s=e.next;(e.f&zi)!==0?e.parent=null:gn(e,t),e=s}}function NL(n){for(var t=n.first;t!==null;){var e=t.next;(t.f&wr)===0&&gn(t),t=e}}function gn(n,t=!0){var e=!1;(t||(n.f&zB)!==0)&&n.nodes!==null&&n.nodes.end!==null&&(LL(n.nodes.start,n.nodes.end),e=!0),pC(n,t&&!e),Vc(n,0),Xe(n,ar);var s=n.nodes&&n.nodes.t;if(s!==null)for(const i of s)i.stop();fC(n);var r=n.parent;r!==null&&r.first!==null&&mC(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function LL(n,t){for(;n!==null;){var e=n===t?null:Va(n);n.remove(),n=e}}function mC(n){var t=n.parent,e=n.prev,s=n.next;e!==null&&(e.next=s),s!==null&&(s.prev=e),t!==null&&(t.first===n&&(t.first=s),t.last===n&&(t.last=e))}function Mi(n,t,e=!0){var s=[];gC(n,s,!0);var r=()=>{e&&gn(n),t&&t()},i=s.length;if(i>0){var o=()=>--i||r();for(var A of s)A.out(o)}else r()}function gC(n,t,e){if((n.f&Mn)===0){n.f^=Mn;var s=n.nodes&&n.nodes.t;if(s!==null)for(const A of s)(A.is_global||e)&&t.push(A);for(var r=n.first;r!==null;){var i=r.next,o=(r.f&Ri)!==0||(r.f&wr)!==0&&(n.f&vr)!==0;gC(r,t,o?e:!1),r=i}}}function Gp(n){vC(n,!0)}function vC(n,t){if((n.f&Mn)!==0){n.f^=Mn,(n.f&ze)===0&&(Xe(n,Bn),Oi(n));for(var e=n.first;e!==null;){var s=e.next,r=(e.f&Ri)!==0||(e.f&wr)!==0;vC(e,r?t:!1),e=s}var i=n.nodes&&n.nodes.t;if(i!==null)for(const o of i)(o.is_global||t)&&o.in()}}function wC(n,t){if(n.nodes)for(var e=n.nodes.start,s=n.nodes.end;e!==null;){var r=e===s?null:Va(e);t.append(e),e=r}}let Qi=!1;function Oc(n){Qi=n}let $i=!1;function U0(n){$i=n}let Ut=null,Is=!1;function fn(n){Ut=n}let Gt=null;function Us(n){Gt=n}let rn=null;function BC(n){Ut!==null&&(rn===null?rn=[n]:rn.push(n))}let en=null,yn=0,Ln=null;function DL(n){Ln=n}let CC=1,ga=0,Ui=ga;function P0(n){Ui=n}function bC(){return++CC}function Wa(n){var t=n.f;if((t&Bn)!==0)return!0;if(t&ke&&(n.f&=~Hi),(t&Qs)!==0){var e=n.deps;if(e!==null)for(var s=e.length,r=0;r<s;r++){var i=e[r];if(Wa(i)&&rC(i),i.wv>n.wv)return!0}(t&ls)!==0&&pe===null&&Xe(n,ze)}return!1}function yC(n,t,e=!0){var s=n.reactions;if(s!==null&&!(rn!=null&&rn.includes(n)))for(var r=0;r<s.length;r++){var i=s[r];(i.f&ke)!==0?yC(i,t,!1):t===i&&(e?Xe(i,Bn):(i.f&ze)!==0&&Xe(i,Qs),Oi(i))}}function SC(n){var h;var t=en,e=yn,s=Ln,r=Ut,i=rn,o=Se,A=Is,a=Ui,l=n.f;en=null,yn=0,Ln=null,Ut=(l&(wr|zi))===0?n:null,rn=null,qo(n.ctx),Is=!1,Ui=++ga,n.ac!==null&&(Wp(()=>{n.ac.abort(vo)}),n.ac=null);try{n.f|=Jh;var c=n.fn,u=c(),d=n.deps;if(en!==null){var p;if(Vc(n,yn),d!==null&&yn>0)for(d.length=yn+en.length,p=0;p<en.length;p++)d[yn+p]=en[p];else n.deps=d=en;if(ma()&&(n.f&ls)!==0)for(p=yn;p<d.length;p++)((h=d[p]).reactions??(h.reactions=[])).push(n)}else d!==null&&yn<d.length&&(Vc(n,yn),d.length=yn);if(YB()&&Ln!==null&&!Is&&d!==null&&(n.f&(ke|Qs|Bn))===0)for(p=0;p<Ln.length;p++)yC(Ln[p],n);return r!==null&&r!==n&&(ga++,Ln!==null&&(s===null?s=Ln:s.push(...Ln))),(n.f&Gr)!==0&&(n.f^=Gr),u}catch(m){return jB(m)}finally{n.f^=Jh,en=t,yn=e,Ln=s,Ut=r,rn=i,qo(o),Is=A,Ui=a}}function kL(n,t){let e=t.reactions;if(e!==null){var s=M5.call(e,n);if(s!==-1){var r=e.length-1;r===0?e=t.reactions=null:(e[s]=e[r],e.pop())}}e===null&&(t.f&ke)!==0&&(en===null||!en.includes(t))&&(Xe(t,Qs),(t.f&ls)!==0&&(t.f^=ls,t.f&=~Hi),sC(t),Vc(t,0))}function Vc(n,t){var e=n.deps;if(e!==null)for(var s=t;s<e.length;s++)kL(n,e[s])}function va(n){var t=n.f;if((t&ar)===0){Xe(n,ze);var e=Gt,s=Qi;Gt=n,Qi=!0;try{(t&(vr|D5))!==0?NL(n):pC(n),fC(n);var r=SC(n);n.teardown=typeof r=="function"?r:null,n.wv=CC;var i;jh&&lL&&(n.f&Bn)!==0&&n.deps}finally{Qi=s,Gt=e}}}function Z(n){var t=n.f,e=(t&ke)!==0;if(Ut!==null&&!Is){var s=Gt!==null&&(Gt.f&ar)!==0;if(!s&&!(rn!=null&&rn.includes(n))){var r=Ut.deps;if((Ut.f&Jh)!==0)n.rv<ga&&(n.rv=ga,en===null&&r!==null&&r[yn]===n?yn++:en===null?en=[n]:en.includes(n)||en.push(n));else{(Ut.deps??(Ut.deps=[])).push(n);var i=n.reactions;i===null?n.reactions=[Ut]:i.includes(Ut)||i.push(Ut)}}}if($i){if(Kr.has(n))return Kr.get(n);if(e){var o=n,A=o.v;return((o.f&ze)===0&&o.reactions!==null||xC(o))&&(A=Vp(o)),Kr.set(o,A),A}}else e&&(!(pe!=null&&pe.has(n))||Vt!=null&&Vt.is_fork&&!ma())&&(o=n,Wa(o)&&rC(o),Qi&&ma()&&(o.f&ls)===0&&EC(o));if(pe!=null&&pe.has(n))return pe.get(n);if((n.f&Gr)!==0)throw n.v;return n.v}function EC(n){if(n.deps!==null){n.f^=ls;for(const t of n.deps)(t.reactions??(t.reactions=[])).push(n),(t.f&ke)!==0&&(t.f&ls)===0&&EC(t)}}function xC(n){if(n.v===He)return!0;if(n.deps===null)return!1;for(const t of n.deps)if(Kr.has(t)||(t.f&ke)!==0&&xC(t))return!0;return!1}function Ga(n){var t=Is;try{return Is=!0,n()}finally{Is=t}}const RL=-7169;function Xe(n,t){n.f=n.f&RL|t}const HL=["touchstart","touchmove"];function OL(n){return HL.includes(n)}const IC=new Set,Af=new Set;function VL(n,t,e,s={}){function r(i){if(s.capture||IA.call(t,i),!i.cancelBubble)return Wp(()=>e==null?void 0:e.call(this,i))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Oa(()=>{t.addEventListener(n,r,s)}):t.addEventListener(n,r,s),r}function Bo(n,t,e,s,r){var i={capture:s,passive:r},o=VL(n,t,e,i);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&uC(()=>{t.removeEventListener(n,o,i)})}function Gu(n){for(var t=0;t<n.length;t++)IC.add(n[t]);for(var e of Af)e(n)}let N0=null;function IA(n){var g;var t=this,e=t.ownerDocument,s=n.type,r=((g=n.composedPath)==null?void 0:g.call(n))||[],i=r[0]||n.target;N0=n;var o=0,A=N0===n&&n.__root;if(A){var a=r.indexOf(A);if(a!==-1&&(t===document||t===window)){n.__root=t;return}var l=r.indexOf(t);if(l===-1)return;a<=l&&(o=a)}if(i=r[o]||n.target,i!==t){Q5(n,"currentTarget",{configurable:!0,get(){return i||e}});var c=Ut,u=Gt;fn(null),Us(null);try{for(var d,p=[];i!==null;){var h=i.assignedSlot||i.parentNode||i.host||null;try{var m=i["__"+s];m!=null&&(!i.disabled||n.target===i)&&m.call(i,n)}catch(v){d?p.push(v):d=v}if(n.cancelBubble||h===t||h===null)break;i=h}if(d){for(let v of p)queueMicrotask(()=>{throw v});throw d}}finally{n.__root=t,delete n.currentTarget,fn(c),Us(u)}}}function FC(n){var t=document.createElement("template");return t.innerHTML=n.replaceAll("<!>","<!---->"),t.content}function Wc(n,t){var e=Gt;e.nodes===null&&(e.nodes={start:n,end:t,a:null,t:null})}function ni(n,t){var e=(t&rL)!==0,s=(t&iL)!==0,r,i=!n.startsWith("<!>");return()=>{r===void 0&&(r=FC(i?n:"<!>"+n),e||(r=Xo(r)));var o=s||AC?document.importNode(r,!0):r.cloneNode(!0);if(e){var A=Xo(o),a=o.lastChild;Wc(A,a)}else Wc(o,o);return o}}function WL(n,t,e="svg"){var s=!n.startsWith("<!>"),r=`<${e}>${s?n:"<!>"+n}</${e}>`,i;return()=>{if(!i){var o=FC(r),A=Xo(o);i=Xo(A)}var a=i.cloneNode(!0);return Wc(a,a),a}}function GL(n,t){return WL(n,t,"svg")}function Gc(){var n=document.createDocumentFragment(),t=document.createComment(""),e=qr();return n.append(t,e),Wc(t,e),n}function Un(n,t){n!==null&&n.before(t)}function oc(n,t){var e=t==null?"":typeof t=="object"?t+"":t;e!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=e,n.nodeValue=e+"")}function TC(n,t){return KL(n,t)}const no=new Map;function KL(n,{target:t,anchor:e,props:s={},events:r,context:i,intro:o=!0}){FL();var A=new Set,a=u=>{for(var d=0;d<u.length;d++){var p=u[d];if(!A.has(p)){A.add(p);var h=OL(p);t.addEventListener(p,IA,{passive:h});var m=no.get(p);m===void 0?(document.addEventListener(p,IA,{passive:h}),no.set(p,1)):no.set(p,m+1)}}};a(Hu(IC)),Af.add(a);var l=void 0,c=QL(()=>{var u=e??t.appendChild(qr());return vL(u,{pending:()=>{}},d=>{if(i){Qe({});var p=Se;p.c=i}r&&(s.$$events=r),l=n(d,s)||{},i&&Ue()}),()=>{var h;for(var d of A){t.removeEventListener(d,IA);var p=no.get(d);--p===0?(document.removeEventListener(d,IA),no.delete(d)):no.set(d,p)}Af.delete(a),u!==e&&((h=u.parentNode)==null||h.removeChild(u))}});return af.set(l,c),l}let af=new WeakMap;function qL(n,t){const e=af.get(n);return e?(af.delete(n),e(t)):Promise.resolve()}var ns,ys,Sn,Ei,ya,Sa,eu;class _C{constructor(t,e=!0){M(this,"anchor");Pt(this,ns,new Map);Pt(this,ys,new Map);Pt(this,Sn,new Map);Pt(this,Ei,new Set);Pt(this,ya,!0);Pt(this,Sa,()=>{var t=Vt;if(j(this,ns).has(t)){var e=j(this,ns).get(t),s=j(this,ys).get(e);if(s)Gp(s),j(this,Ei).delete(e);else{var r=j(this,Sn).get(e);r&&(j(this,ys).set(e,r.effect),j(this,Sn).delete(e),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),s=r.effect)}for(const[i,o]of j(this,ns)){if(j(this,ns).delete(i),i===t)break;const A=j(this,Sn).get(o);A&&(gn(A.effect),j(this,Sn).delete(o))}for(const[i,o]of j(this,ys)){if(i===e||j(this,Ei).has(i))continue;const A=()=>{if(Array.from(j(this,ns).values()).includes(i)){var l=document.createDocumentFragment();wC(o,l),l.append(qr()),j(this,Sn).set(i,{effect:o,fragment:l})}else gn(o);j(this,Ei).delete(i),j(this,ys).delete(i)};j(this,ya)||!s?(j(this,Ei).add(i),Mi(o,A,!1)):A()}}});Pt(this,eu,t=>{j(this,ns).delete(t);const e=Array.from(j(this,ns).values());for(const[s,r]of j(this,Sn))e.includes(s)||(gn(r.effect),j(this,Sn).delete(s))});this.anchor=t,It(this,ya,e)}ensure(t,e){var s=Vt,r=cC();if(e&&!j(this,ys).has(t)&&!j(this,Sn).has(t))if(r){var i=document.createDocumentFragment(),o=qr();i.append(o),j(this,Sn).set(t,{effect:On(()=>e(o)),fragment:i})}else j(this,ys).set(t,On(()=>e(this.anchor)));if(j(this,ns).set(s,t),r){for(const[A,a]of j(this,ys))A===t?s.skipped_effects.delete(a):s.skipped_effects.add(a);for(const[A,a]of j(this,Sn))A===t?s.skipped_effects.delete(a.effect):s.skipped_effects.add(a.effect);s.oncommit(j(this,Sa)),s.ondiscard(j(this,eu))}else j(this,Sa).call(this)}}ns=new WeakMap,ys=new WeakMap,Sn=new WeakMap,Ei=new WeakMap,ya=new WeakMap,Sa=new WeakMap,eu=new WeakMap;function Ka(n,t,e=!1){var s=new _C(n),r=e?Ri:0;function i(o,A){s.ensure(o,A)}Wu(()=>{var o=!1;t((A,a=!0)=>{o=!0,i(a,A)}),o||i(!1,null)},r)}function zL(n,t){return t}function $L(n,t,e){for(var s=[],r=t.length,i,o=t.length,A=0;A<r;A++){let u=t[A];Mi(u,()=>{if(i){if(i.pending.delete(u),i.done.add(u),i.pending.size===0){var d=n.outrogroups;lf(Hu(i.done)),d.delete(i),d.size===0&&(n.outrogroups=null)}}else o-=1},!1)}if(o===0){var a=s.length===0&&e!==null;if(a){var l=e,c=l.parentNode;TL(c),c.append(l),n.items.clear()}lf(t,!a)}else i={pending:new Set(t),done:new Set},(n.outrogroups??(n.outrogroups=new Set)).add(i)}function lf(n,t=!0){for(var e=0;e<n.length;e++)gn(n[e],t)}var L0;function XL(n,t,e,s,r,i=null){var o=n,A=new Map;{var a=n;o=a.appendChild(qr())}var l=null,c=nC(()=>{var g=e();return GB(g)?g:g==null?[]:Hu(g)}),u,d=!0;function p(){m.fallback=l,YL(m,u,o,t,s),l!==null&&(u.length===0?(l.f&kr)===0?Gp(l):(l.f^=kr,FA(l,null,o)):Mi(l,()=>{l=null}))}var h=Wu(()=>{u=Z(c);for(var g=u.length,v=new Set,w=Vt,y=cC(),I=0;I<g;I+=1){var B=u[I],C=s(B,I),b=d?null:A.get(C);b?(b.v&&$o(b.v,B),b.i&&$o(b.i,I),y&&w.skipped_effects.delete(b.e)):(b=jL(A,d?o:L0??(L0=qr()),B,C,I,r,t,e),d||(b.e.f|=kr),A.set(C,b)),v.add(C)}if(g===0&&i&&!l&&(d?l=On(()=>i(o)):(l=On(()=>i(L0??(L0=qr()))),l.f|=kr)),!d)if(y){for(const[S,T]of A)v.has(S)||w.skipped_effects.add(T.e);w.oncommit(p),w.ondiscard(()=>{})}else p();Z(c)}),m={effect:h,items:A,outrogroups:null,fallback:l};d=!1}function YL(n,t,e,s,r){var S;var i=t.length,o=n.items,A=n.effect.first,a,l=null,c=[],u=[],d,p,h,m;for(m=0;m<i;m+=1){if(d=t[m],p=r(d,m),h=o.get(p).e,n.outrogroups!==null)for(const T of n.outrogroups)T.pending.delete(h),T.done.delete(h);if((h.f&kr)!==0)if(h.f^=kr,h===A)FA(h,null,e);else{var g=l?l.next:A;h===n.effect.last&&(n.effect.last=h.prev),h.prev&&(h.prev.next=h.next),h.next&&(h.next.prev=h.prev),yr(n,l,h),yr(n,h,g),FA(h,g,e),l=h,c=[],u=[],A=l.next;continue}if((h.f&Mn)!==0&&Gp(h),h!==A){if(a!==void 0&&a.has(h)){if(c.length<u.length){var v=u[0],w;l=v.prev;var y=c[0],I=c[c.length-1];for(w=0;w<c.length;w+=1)FA(c[w],v,e);for(w=0;w<u.length;w+=1)a.delete(u[w]);yr(n,y.prev,I.next),yr(n,l,y),yr(n,I,v),A=v,l=I,m-=1,c=[],u=[]}else a.delete(h),FA(h,A,e),yr(n,h.prev,h.next),yr(n,h,l===null?n.effect.first:l.next),yr(n,l,h),l=h;continue}for(c=[],u=[];A!==null&&A!==h;)(a??(a=new Set)).add(A),u.push(A),A=A.next;if(A===null)continue}(h.f&kr)===0&&c.push(h),l=h,A=h.next}if(n.outrogroups!==null){for(const T of n.outrogroups)T.pending.size===0&&(lf(Hu(T.done)),(S=n.outrogroups)==null||S.delete(T));n.outrogroups.size===0&&(n.outrogroups=null)}if(A!==null||a!==void 0){var B=[];if(a!==void 0)for(h of a)(h.f&Mn)===0&&B.push(h);for(;A!==null;)(A.f&Mn)===0&&A!==n.fallback&&B.push(A),A=A.next;var C=B.length;if(C>0){var b=i===0?e:null;$L(n,B,b)}}}function jL(n,t,e,s,r,i,o,A){var a=(o&j5)!==0?(o&Z5)===0?xL(e,!1,!1):Vi(e):null,l=(o&J5)!==0?Vi(r):null;return{v:a,i:l,e:On(()=>(i(t,a??e,l??r,A),()=>{n.delete(s)}))}}function FA(n,t,e){if(n.nodes)for(var s=n.nodes.start,r=n.nodes.end,i=t&&(t.f&kr)===0?t.nodes.start:e;s!==null;){var o=Va(s);if(i.before(s),s===r)return;s=o}}function yr(n,t,e){t===null?n.effect.first=e:t.next=e,e===null?n.effect.last=t:e.prev=t}function JL(n,t,...e){var s=new _C(n);Wu(()=>{const r=t()??null;s.ensure(r,r&&(i=>r(i,...e)))},Ri)}const D0=[...` 	
\r\f\v\uFEFF`];function ZL(n,t,e){var s=n==null?"":""+n;if(t&&(s=s?s+" "+t:t),e){for(var r in e)if(e[r])s=s?s+" "+r:r;else if(s.length)for(var i=r.length,o=0;(o=s.indexOf(r,o))>=0;){var A=o+i;(o===0||D0.includes(s[o-1]))&&(A===s.length||D0.includes(s[A]))?s=(o===0?"":s.substring(0,o))+s.substring(A+1):o=A}}return s===""?null:s}function k0(n,t=!1){var e=t?" !important;":";",s="";for(var r in n){var i=n[r];i!=null&&i!==""&&(s+=" "+r+": "+i+e)}return s}function tD(n,t){if(t){var e="",s,r;return Array.isArray(t)?(s=t[0],r=t[1]):s=t,s&&(e+=k0(s)),r&&(e+=k0(r,!0)),e=e.trim(),e===""?null:e}return String(n)}function MC(n,t,e,s,r,i){var o=n.__className;if(o!==e||o===void 0){var A=ZL(e,s,i);A==null?n.removeAttribute("class"):n.className=A,n.__className=e}else if(i&&r!==i)for(var a in i){var l=!!i[a];(r==null||l!==!!r[a])&&n.classList.toggle(a,l)}return i}function Dd(n,t={},e,s){for(var r in e){var i=e[r];t[r]!==i&&(e[r]==null?n.style.removeProperty(r):n.style.setProperty(r,i,s))}}function eD(n,t,e,s){var r=n.__style;if(r!==t){var i=tD(t,s);i==null?n.removeAttribute("style"):n.style.cssText=i,n.__style=t}else s&&(Array.isArray(s)?(Dd(n,e==null?void 0:e[0],s[0]),Dd(n,e==null?void 0:e[1],s[1],"important")):Dd(n,e,s));return s}const nD=Symbol("is custom element"),sD=Symbol("is html");function Nt(n,t,e,s){var r=rD(n);r[t]!==(r[t]=e)&&(t==="loading"&&(n[H5]=e),e==null?n.removeAttribute(t):typeof e!="string"&&iD(n).includes(t)?n[t]=e:n.setAttribute(t,e))}function rD(n){return n.__attributes??(n.__attributes={[nD]:n.nodeName.includes("-"),[sD]:n.namespaceURI===oL})}var R0=new Map;function iD(n){var t=n.getAttribute("is")||n.nodeName,e=R0.get(t);if(e)return e;R0.set(t,e=[]);for(var s,r=n,i=Element.prototype;i!==r;){s=U5(r);for(var o in s)s[o].set&&e.push(o);r=KB(r)}return e}function H0(n,t){return n===t||(n==null?void 0:n[zA])===t}function ao(n={},t,e,s){return UL(()=>{var r,i;return hC(()=>{r=i,i=[],Ga(()=>{n!==e(...i)&&(t(n,...i),r&&H0(e(...r),n)&&t(null,...r))})}),()=>{Oa(()=>{i&&H0(e(...i),n)&&t(null,...i)})}}),n}let Pl=!1;function oD(n){var t=Pl;try{return Pl=!1,[n(),Pl]}finally{Pl=t}}function Pn(n,t,e,s){var w;var r=(e&nL)!==0,i=(e&sL)!==0,o=s,A=!0,a=()=>(A&&(A=!1,o=i?Ga(s):s),o),l;if(r){var c=zA in n||R5 in n;l=((w=Po(n,t))==null?void 0:w.set)??(c&&t in n?y=>n[t]=y:void 0)}var u,d=!1;r?[u,d]=oD(()=>n[t]):u=n[t],u===void 0&&s!==void 0&&(u=a(),l&&(q5(),l(u)));var p;if(p=()=>{var y=n[t];return y===void 0?a():(A=!0,y)},(e&eL)===0)return p;if(l){var h=n.$$legacy;return(function(y,I){return arguments.length>0?((!I||h||d)&&l(I?p():y),y):p()})}var m=!1,g=((e&tL)!==0?Vu:nC)(()=>(m=!1,p()));r&&Z(g);var v=Gt;return(function(y,I){if(arguments.length>0){const B=I?Z(g):r?Tn(y):y;return St(g,B),m=!0,o!==void 0&&(o=B),y}return $i&&m||(v.f&ar)!==0?g.v:Z(g)})}function Os(n){Se===null&&Hp(),Qn(()=>{const t=Ga(n);if(typeof t=="function")return t})}function si(n){Se===null&&Hp(),Os(()=>()=>Ga(n))}const AD="5";var hv;typeof window<"u"&&((hv=window.__svelte??(window.__svelte={})).v??(hv.v=new Set)).add(AD);var aD=ni('<img alt="Pause" class="svelte-1sr4oe7"/>'),lD=ni('<img alt="Play" class="svelte-1sr4oe7"/>'),cD=ni('<div class="playback-controls svelte-1sr4oe7"><button class="toolbar-button svelte-1sr4oe7"><!></button> <button class="toolbar-button svelte-1sr4oe7" title="Stop"><img alt="Stop" class="svelte-1sr4oe7"/></button> <button><img alt="Loop" class="svelte-1sr4oe7"/></button> <div class="separator svelte-1sr4oe7"></div> <button class="toolbar-button svelte-1sr4oe7" title="Clear All Notes"><img alt="Clear" class="svelte-1sr4oe7"/></button> <div class="separator svelte-1sr4oe7"></div> <button class="toolbar-button svelte-1sr4oe7" title="Undo"><img alt="Undo" class="svelte-1sr4oe7"/></button> <button class="toolbar-button svelte-1sr4oe7" title="Redo"><img alt="Redo" class="svelte-1sr4oe7"/></button></div>');function uD(n,t){Qe(t,!0);let e=Rt(Tn(f.state.isPlaying)),s=Rt(Tn(f.state.isPaused)),r=Rt(Tn(f.state.isLooping)),i=Rt(f.state.historyIndex>0),o=Rt(f.state.historyIndex<f.state.history.length-1);Qn(()=>{const L=q=>{q&&(St(e,q.isPlaying,!0),St(s,q.isPaused,!0))},R=q=>{q!==void 0&&St(r,q,!0)},N=()=>{St(i,f.state.historyIndex>0),St(o,f.state.historyIndex<f.state.history.length-1)};return f.on("playbackStateChanged",L),f.on("loopingChanged",R),f.on("historyChanged",N),N(),()=>{}});const A=gi(()=>xr("play.svg")),a=gi(()=>xr("pause.svg")),l=gi(()=>Z(e)&&!Z(s));function c(){Z(e)&&Z(s)?(f.setPlaybackState(!0,!1),nr.resume()):Z(e)&&!Z(s)?(f.setPlaybackState(!0,!0),nr.pause()):(f.setPlaybackState(!0,!1),nr.start())}function u(){f.setPlaybackState(!1,!1),nr.stop()}function d(){f.clearAllNotes(),PB(),LB()}function p(){f.setLooping(!Z(r))}function h(){f.undo()}function m(){f.redo()}var g=cD(),v=Te(g);v.__click=c;var w=Te(v);{var y=L=>{var R=aD();_i(()=>Nt(R,"src",Z(a))),Un(L,R)},I=L=>{var R=lD();_i(()=>Nt(R,"src",Z(A))),Un(L,R)};Ka(w,L=>{Z(l)?L(y):L(I,!1)})}var B=Ge(v,2);B.__click=u;var C=Te(B),b=Ge(B,2);let S;b.__click=p;var T=Te(b),x=Ge(b,4);x.__click=d;var _=Te(x),F=Ge(x,4);F.__click=h;var Q=Te(F),U=Ge(F,2);U.__click=m;var W=Te(U);_i((L,R,N,q,J)=>{Nt(v,"title",Z(l)?"Pause":"Play"),Nt(C,"src",L),S=MC(b,1,"toolbar-button svelte-1sr4oe7",null,S,{active:Z(r)}),Nt(b,"title",Z(r)?"Disable Loop":"Enable Loop"),Nt(T,"src",R),Nt(_,"src",N),F.disabled=!Z(i),Nt(Q,"src",q),U.disabled=!Z(o),Nt(W,"src",J)},[()=>xr("stop.svg"),()=>xr("loop.svg"),()=>xr("clear.svg"),()=>xr("undo.svg"),()=>xr("redo.svg")]),Un(n,g),Ue()}Gu(["click"]);function dD(n,t){Qe(t,!0);let e=f.state.isPlaying,s=f.state.isPaused,r=f.state.isLooping,i=f.state.historyIndex>0,o=f.state.historyIndex<f.state.history.length-1,A=null,a=null,l=null,c=null,u=null,d=null;function p(){e&&s?(f.setPlaybackState(!0,!1),nr.resume()):e&&!s?(f.setPlaybackState(!0,!0),nr.pause()):(f.setPlaybackState(!0,!1),nr.start())}function h(){f.setPlaybackState(!1,!1),nr.stop(),a==null||a.blur()}function m(){c==null||c.classList.add("flash"),setTimeout(()=>c==null?void 0:c.classList.remove("flash"),300),f.clearAllNotes(),PB(),LB(),c==null||c.blur()}function g(){f.setLooping(!r)}function v(){f.undo(),u==null||u.blur()}function w(){f.redo(),d==null||d.blur()}function y(){if(!A)return;const C=`<img src="${pv}" alt="Play">`,b=`<img src="${fv}" alt="Pause">`;A.innerHTML=e&&!s?b:C}function I(){l&&l.classList.toggle("active",r)}function B(){u&&(u.disabled=!i),d&&(d.disabled=!o)}Os(()=>{A=document.getElementById("play-button"),a=document.getElementById("stop-button"),l=document.getElementById("loop-button"),c=document.getElementById("clear-button"),u=document.getElementById("undo-button"),d=document.getElementById("redo-button"),A==null||A.addEventListener("click",p),a==null||a.addEventListener("click",h),l==null||l.addEventListener("click",g),c==null||c.addEventListener("click",m),u==null||u.addEventListener("click",v),d==null||d.addEventListener("click",w);const C=T=>{T&&(e=T.isPlaying,s=T.isPaused,y())},b=T=>{T!==void 0&&(r=T,I())},S=()=>{i=f.state.historyIndex>0,o=f.state.historyIndex<f.state.history.length-1,B()};f.on("playbackStateChanged",C),f.on("loopingChanged",b),f.on("historyChanged",S),y(),I(),B(),console.log("[Svelte] PlaybackControlsBridge mounted")}),si(()=>{A==null||A.removeEventListener("click",p),a==null||a.removeEventListener("click",h),l==null||l.removeEventListener("click",g),c==null||c.removeEventListener("click",m),u==null||u.removeEventListener("click",v),d==null||d.removeEventListener("click",w),console.log("[Svelte] PlaybackControlsBridge unmounted")}),Ue()}function hD(n,t){Qe(t,!0);let e=null,s=null,r=null,i=null;function o(){const h=new Date,m=h.toLocaleDateString("en-US",{month:"long"}),g=h.getDate();return`SN-score-${m}${g}.csv`}async function A(h){try{const m={suggestedName:o(),types:[{description:"Student Notation CSV File",accept:{"text/csv":[".csv"]}}]},v=await(await window.showSaveFilePicker(m)).createWritable();await v.write(h),await v.close()}catch(m){m.name!=="AbortError"&&E.error("FileActionsBridge","Error saving file with picker",m,"toolbar")}}function a(h){const m=document.createElement("a"),g=URL.createObjectURL(h);m.setAttribute("href",g),m.setAttribute("download",o()),document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(g)}function l(){return f.state.placedNotes.map(h=>[h.row,h.startColumnIndex,h.endColumnIndex,h.color,h.shape,h.tonicNumber||"",h.isDrum,h.drumTrack||""].join(",")).join(`
`)}async function c(){const h=l(),m=new Blob([h],{type:"text/csv;charset=utf-8;"});window.showSaveFilePicker?await A(m):a(m)}function u(){const h=document.createElement("input");h.type="file",h.accept=".csv,.txt",h.onchange=m=>{var y;const v=(y=m.target.files)==null?void 0:y[0];if(!v)return;const w=new FileReader;w.onload=I=>{var S;const B=(S=I.target)==null?void 0:S.result;if(!B){E.warn("FileActionsBridge","Imported file was empty",null,"toolbar");return}const C=new Set(["circle","oval","diamond"]),b=[];if(B.split(`
`).map(T=>T.trim()).filter(T=>T.length>0).forEach(T=>{const x=T.split(",");if(x.length<7){E.warn("FileActionsBridge","Skipping invalid note row",{line:T},"toolbar");return}const _=Number.parseInt(x[0]??"",10),F=Number.parseInt(x[1]??"",10),Q=Number.parseInt(x[2]??"",10),U=(x[3]??"").trim(),W=(x[4]??"").trim().toLowerCase(),L=x[5]?Number.parseInt(x[5],10):null,R=(x[6]??"").trim().toLowerCase()==="true",N=x[7]?Number.parseInt(x[7],10):null,q=typeof N=="number"&&Number.isFinite(N)?N:void 0;if(!U){E.warn("FileActionsBridge","Skipping note with missing color",{line:T},"toolbar");return}if(!Number.isFinite(_)||!Number.isFinite(F)||!Number.isFinite(Q)){E.warn("FileActionsBridge","Skipping note with invalid coordinates",{line:T},"toolbar");return}const J=C.has(W)?W:"circle";C.has(W)||E.warn("FileActionsBridge",`Unknown shape "${W}", defaulting to circle`,null,"toolbar"),b.push({row:_,startColumnIndex:F,endColumnIndex:Q,color:U,shape:J,tonicNumber:L,isDrum:R,drumTrack:q})}),b.length===0){E.warn("FileActionsBridge","No valid notes found in imported file",null,"toolbar");return}f.loadNotes(b)},w.readAsText(v)},h.click()}function d(){document.body.classList.remove("sidebar-open"),f.emit("printPreviewStateChanged",!0)}function p(){window.confirm("Are you sure you want to reset the canvas? This will clear all your work and cannot be undone.")&&f.clearSavedState()}Os(()=>{e=document.getElementById("save-as-button"),s=document.getElementById("import-button"),r=document.getElementById("print-button"),i=document.getElementById("reset-canvas-button"),e==null||e.addEventListener("click",()=>void c()),s==null||s.addEventListener("click",u),r==null||r.addEventListener("click",d),i==null||i.addEventListener("click",p),console.log("[Svelte] FileActionsBridge mounted")}),si(()=>{e==null||e.removeEventListener("click",()=>void c()),s==null||s.removeEventListener("click",u),r==null||r.removeEventListener("click",d),i==null||i.removeEventListener("click",p),console.log("[Svelte] FileActionsBridge unmounted")}),Ue()}function fD(n,t){Qe(t,!0);let e=null,s=null,r=null,i=null;function o(){const u=document.querySelector('.tab-button[data-tab="pitch"]'),d=document.querySelector('.pitch-tab-button[data-pitch-tab="range"]');u==null||u.click(),d==null||d.click()}function A(){o(),f.emit("zoomIn",{source:"button"}),e==null||e.blur()}function a(){o(),f.emit("zoomOut",{source:"button"}),s==null||s.blur()}function l(){f.increaseMacrobeatCount()}function c(){f.decreaseMacrobeatCount()}Os(()=>{e=document.getElementById("grid-zoom-in"),s=document.getElementById("grid-zoom-out"),r=document.getElementById("macrobeat-increase"),i=document.getElementById("macrobeat-decrease"),e==null||e.addEventListener("click",A),s==null||s.addEventListener("click",a),r==null||r.addEventListener("click",l),i==null||i.addEventListener("click",c),console.log("[Svelte] GridControlsBridge mounted")}),si(()=>{e==null||e.removeEventListener("click",A),s==null||s.removeEventListener("click",a),r==null||r.removeEventListener("click",l),i==null||i.removeEventListener("click",c),console.log("[Svelte] GridControlsBridge unmounted")}),Ue()}function pD(n,t){Qe(t,!0);let e=null,s=null,r=null,i=null;function o(){i===Fn.COMPRESSION_2_3?(i=null,e==null||e.classList.remove("active"),f.setSelectedTool("note"),E.info("ModulationBridge","2:3 modulation tool deactivated",null,"ui")):(i=Fn.COMPRESSION_2_3,e==null||e.classList.add("active"),s==null||s.classList.remove("active"),f.setSelectedTool("modulation"),f.state.selectedModulationRatio=i,E.info("ModulationBridge","2:3 modulation tool activated",null,"ui"))}function A(){i===Fn.EXPANSION_3_2?(i=null,s==null||s.classList.remove("active"),f.setSelectedTool("note"),E.info("ModulationBridge","3:2 modulation tool deactivated",null,"ui")):(i=Fn.EXPANSION_3_2,s==null||s.classList.add("active"),e==null||e.classList.remove("active"),f.setSelectedTool("modulation"),f.state.selectedModulationRatio=i,E.info("ModulationBridge","3:2 modulation tool activated",null,"ui"))}function a(){const d=(f.state.tempoModulationMarkers||[]).length;if(d===0){E.info("ModulationBridge","No modulation markers to clear",null,"ui");return}f.clearModulationMarkers(),E.info("ModulationBridge",`Cleared ${d} modulation markers`,null,"ui")}function l(){if(!r)return;const d=(f.state.tempoModulationMarkers||[]).length;d===0?(r.disabled=!0,r.style.opacity="0.5"):(r.disabled=!1,r.style.opacity="1"),r.textContent=d>0?`Clear (${d})`:"Clear"}function c(d){const p=d;(typeof p=="string"?p:p.newTool||p)!=="modulation"&&(i=null,e==null||e.classList.remove("active"),s==null||s.classList.remove("active"))}function u(){l()}Os(()=>{if(e=document.getElementById("modulation-2-3-btn"),s=document.getElementById("modulation-3-2-btn"),r=document.getElementById("modulation-clear-btn"),!e||!s||!r){E.warn("ModulationBridge","Modulation control buttons not found in DOM",null,"ui");return}e.addEventListener("click",o),s.addEventListener("click",A),r.addEventListener("click",a),f.on("toolChanged",c),f.on("tempoModulationMarkersChanged",u),l(),E.info("ModulationBridge","Modulation controls initialized",null,"ui"),console.log("[Svelte] ModulationBridge mounted")}),si(()=>{e==null||e.removeEventListener("click",o),s==null||s.removeEventListener("click",A),r==null||r.removeEventListener("click",a),console.log("[Svelte] ModulationBridge unmounted")}),Ue()}const mD=1,gD="mlt-handoff",vD=1,Kc="handoff-slots",wD="mlt-handoff-slot";function QC(){return new Promise((n,t)=>{const e=indexedDB.open(gD,vD);e.onerror=()=>{t(new Error("Failed to open IndexedDB"))},e.onsuccess=()=>{n(e.result)},e.onupgradeneeded=s=>{const r=s.target.result;r.objectStoreNames.contains(Kc)||r.createObjectStore(Kc,{keyPath:"handoffId"})}})}async function BD(){if(typeof indexedDB>"u")return!1;try{return(await QC()).close(),!0}catch{return!1}}function CD(){const n=Date.now().toString(36),t=Math.random().toString(36).substring(2,10);return`handoff-${n}-${t}`}async function bD(n){const t=await QC();return new Promise((e,s)=>{const r=t.transaction(Kc,"readwrite"),i=r.objectStore(Kc),o=i.clear();o.onsuccess=()=>{const A=i.add(n);A.onsuccess=()=>{e()},A.onerror=()=>{s(new Error("Failed to write to IndexedDB"))}},o.onerror=()=>{s(new Error("Failed to clear IndexedDB"))},r.oncomplete=()=>{t.close()}})}function O0(n){try{const t=JSON.stringify(n);localStorage.setItem(wD,t)}catch(t){throw new Error(`Failed to write to localStorage: ${t}`)}}async function yD(n){const t=CD(),e={snapshot:n,writtenAt:Date.now(),handoffId:t};if(await BD())try{return await bD(e),t}catch{return O0(e),t}else return O0(e),t}function SD(n,t){const e=n.endMicrobeatCol<t.startMicrobeatCol,s=t.endMicrobeatCol<n.startMicrobeatCol;return!e&&!s}function ED(n,t){const e=Math.max(n.startMicrobeatCol,t.startMicrobeatCol),s=Math.min(n.endMicrobeatCol,t.endMicrobeatCol);if(e>s)return[];const r=[];for(let i=e;i<=s;i++)r.push(i);return r}function xD(n){const t=[],e=n.notes;for(let s=0;s<e.length;s++)for(let r=s+1;r<e.length;r++){const i=e[s],o=e[r];if(SD(i,o)){const A=ED(i,o);t.push({voiceId:n.voiceId,color:n.color,conflictColumns:A,note1:{startMicrobeatCol:i.startMicrobeatCol,endMicrobeatCol:i.endMicrobeatCol,midiPitch:i.midiPitch},note2:{startMicrobeatCol:o.startMicrobeatCol,endMicrobeatCol:o.endMicrobeatCol,midiPitch:o.midiPitch}})}}return t}function ID(n){const t=`Note 1: cols ${n.note1.startMicrobeatCol}-${n.note1.endMicrobeatCol}, MIDI ${n.note1.midiPitch}`,e=`Note 2: cols ${n.note2.startMicrobeatCol}-${n.note2.endMicrobeatCol}, MIDI ${n.note2.midiPitch}`,s=n.conflictColumns.length===1?`column ${n.conflictColumns[0]}`:`columns ${n.conflictColumns[0]}-${n.conflictColumns[n.conflictColumns.length-1]}`;return`Voice "${n.voiceId}" (${n.color}): Overlap at ${s}
  ${t}
  ${e}`}function FD(n){const t=[],e=[];if(n.schemaVersion!==1&&e.push(`Unsupported schema version: ${n.schemaVersion}. Expected: 1`),n.timeGrid||e.push("Missing required field: timeGrid"),(!n.voices||!Array.isArray(n.voices))&&e.push("Missing or invalid field: voices"),n.clefPitchRange){const{minMidi:s,maxMidi:r}=n.clefPitchRange;!Number.isFinite(s)||!Number.isFinite(r)?e.push("Invalid clefPitchRange: MIDI values must be finite numbers"):s>r&&e.push("Invalid clefPitchRange: minMidi exceeds maxMidi")}if(n.voices)for(const s of n.voices){const r=xD(s);t.push(...r)}for(const s of t)e.push(ID(s));return{isValid:t.length===0&&e.length===0,conflicts:t,errorMessages:e}}function TD(n){const t=FD(n);if(t.isValid)return{isValid:!0,summary:"Validation passed. Ready to export to Singing Trainer.",details:t};const e=new Set(t.conflicts.map(r=>r.voiceId));return{isValid:!1,summary:`Cannot export: ${t.conflicts.length} overlap(s) found in ${e.size} voice(s).`,details:t}}function _D(n){return n.reduce((t,e)=>t+e,0)}function MD(n){if(n.length===0)return 2;const t=n.filter(s=>s===2).length;return n.filter(s=>s===3).length>t?3:2}function QD(n,t,e){const s=e.topIndex+n;if(s<0||s>=t.length)return-1;const r=t[s];return(r==null?void 0:r.midi)??-1}function UD(n,t,e){const s=e.topIndex+n;if(s<0||s>=t.length)return"Unknown";const r=t[s];return(r==null?void 0:r.toneNote)??"Unknown"}function PD(n,t){const e=n[t.topIndex],s=n[t.bottomIndex],r=e==null?void 0:e.midi,i=s==null?void 0:s.midi;return typeof r!="number"||typeof i!="number"?null:{minMidi:Math.min(r,i),maxMidi:Math.max(r,i)}}function ND(n,t,e={}){const s=n.placedNotes.filter(d=>!d.isDrum),r=new Map;for(const d of s){const p=d.color;r.has(p)||r.set(p,[]),r.get(p).push(d)}const i=[];let o=1/0,A=-1/0;for(const[d,p]of r){const h=[];for(const m of p){const g=QD(m.row,n.fullRowData,n.pitchRange),v=UD(m.row,n.fullRowData,n.pitchRange);g>0&&(o=Math.min(o,g),A=Math.max(A,g)),h.push({startMicrobeatCol:m.startColumnIndex,endMicrobeatCol:m.endColumnIndex,midiPitch:g,pitchName:v,shape:m.shape})}h.sort((m,g)=>m.startMicrobeatCol-g.startMicrobeatCol),i.push({voiceId:d,color:d,notes:h})}const a={microbeatCount:_D(n.macrobeatGroupings),microbeatsPerMacrobeat:MD(n.macrobeatGroupings),macrobeatGroupings:[...n.macrobeatGroupings],macrobeatBoundaryStyles:[...n.macrobeatBoundaryStyles]},l=[];if(n.annotations&&Array.isArray(n.annotations))for(const d of n.annotations)l.push({type:"freehand",id:d.id??`overlay-${Date.now()}`,data:d,coordinateSystem:"pixel"});const c=e.includeClefPitchRange===!1?null:PD(n.fullRowData,n.pitchRange),u={schemaVersion:mD,createdAt:Date.now(),sourceFileId:t,sourceApp:"student-notation",timeGrid:a,voices:i,tempo:n.tempo,minMidiPitch:o===1/0?void 0:o,maxMidiPitch:A===-1/0?void 0:A};return c&&(u.clefPitchRange=c),e.preferredPitchRangeSource&&(u.preferredPitchRangeSource=e.preferredPitchRangeSource),l.length>0&&(u.visualOverlays=l),e.tonalCenter&&(u.tonalCenter=e.tonalCenter),u}function LD(n){switch(n){case"student-notation":return"/student-notation/";case"singing-trainer":return"/singing-trainer/";default:throw new Error(`Unknown app: ${n}`)}}function DD(n,t){let e=LD(n);if(t&&Object.keys(t).length>0){const s=new URLSearchParams(t);e+=`?${s.toString()}`}window.location.href=e}function kD(n){const t={};n&&(t.handoff=n),t.from="student-notation",DD("singing-trainer",t)}function RD(n,t){Qe(t,!0);let e=null,s=null,r=null,i=null,o=null,A=null,a=null,l=null,c=null,u=null,d=null,p=null,h=null,m=null,g=null,v=null,w=null,y=null,I=null,B=null,C=null,b=null,S=!0,T=!0,x=!0,_=!0;const F="app.volumeSliderValue";function Q($){return Math.min(100,Math.max(0,$))}function U(){try{const $=window.localStorage.getItem(F);if($!==null){const rt=Number($);if(!Number.isNaN(rt))return Q(rt)}}catch{}return 70}function W($){try{window.localStorage.setItem(F,String(Q($)))}catch{}}function L(){document.body.classList.toggle("sidebar-open")}function R($){if($.stopPropagation(),!o||!i)return;const rt=o.classList.toggle("visible");i.classList.toggle("active",rt)}function N(){const $=parseInt(this.value,10),rt=$===0?-1/0:$/100*37.5-50;f.emit("volumeChanged",rt),W($)}function q($){!o||!i||!o.contains($.target)&&$.target!==i&&(o.classList.remove("visible"),i.classList.remove("active"))}function J(){f.setAnacrusis(!0)}function nt(){f.setAnacrusis(!1)}function At($){const rt=$;a==null||a.classList.toggle("active",rt),l==null||l.classList.toggle("active",!rt)}function ot(){f.setLongNoteStyle("style1")}function V(){f.setLongNoteStyle("style2")}function H($){const rt=$;c==null||c.classList.toggle("active",rt==="style1"),u==null||u.classList.toggle("active",rt==="style2")}function G(){f.setPlayheadMode("cursor")}function Y(){f.setPlayheadMode("microbeat")}function P(){f.setPlayheadMode("macrobeat")}function st($){const rt=$==="macrobeat"?"macrobeat":$==="microbeat"?"microbeat":"cursor";d==null||d.classList.toggle("active",rt==="cursor"),p==null||p.classList.toggle("active",rt==="microbeat"),h==null||h.classList.toggle("active",rt==="macrobeat")}function D(){S=!S,g&&(g.style.display=S?"flex":"none");const $=m==null?void 0:m.querySelector(".sidebar-button-text");$&&($.textContent=S?"Hide Drum Grid":"Show Drum Grid"),setTimeout(()=>fe.recalculateLayout(),10)}function K(){T=!T,w&&(w.style.display=T?"flex":"none");const $=v==null?void 0:v.querySelector(".sidebar-button-text");$&&($.textContent=T?"Hide Button Grid":"Show Button Grid"),setTimeout(()=>fe.recalculateLayout(),10)}function O(){x=!x,I&&(I.style.display=x?"block":"none"),y&&(y.textContent=x?"Hide Left Legend":"Show Left Legend"),setTimeout(()=>fe.recalculateLayout(),10)}function X(){_=!_,C&&(C.style.display=_?"block":"none"),B&&(B.textContent=_?"Hide Right Legend":"Show Right Legend"),setTimeout(()=>fe.recalculateLayout(),10)}function tt($,rt,et=[]){const it=document.getElementById("notification-overlay"),at=it==null?void 0:it.querySelector(".notification-message"),Ct=it==null?void 0:it.querySelector(".notification-title");if(!it||!at){alert(`${$}

${rt}${et.length>0?`

`+et.join(`
`):""}`);return}Ct&&(Ct.textContent=$);const yt=et.length>0?`<ul style="text-align: left; margin-top: 8px; padding-left: 20px;">${et.map(ct=>`<li style="margin-bottom: 4px;">${ct.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</li>`).join("")}</ul>`:"";at.innerHTML=`<p>${rt.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</p>${yt}`,it.classList.add("visible");const Bt=it.querySelector(".notification-close"),Et=it.querySelector(".notification-button"),Qt=()=>{it.classList.remove("visible"),Bt==null||Bt.removeEventListener("click",Qt),Et==null||Et.removeEventListener("click",Qt)};Bt==null||Bt.addEventListener("click",Qt),Et==null||Et.addEventListener("click",Qt)}function k(){return f.state.placedNotes.some($=>!$.isDrum)}async function z(){if(console.log("[Svelte] Take to Singing Trainer clicked"),!k()){tt("Cannot Export","No notes to export. Add some pitch notes to the grid before exporting to Singing Trainer.");return}const $={placedNotes:f.state.placedNotes,macrobeatGroupings:f.state.macrobeatGroupings,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles,fullRowData:f.state.fullRowData,pitchRange:f.state.pitchRange,tempo:f.state.tempo,annotations:f.state.annotations},rt=ND($),et=TD(rt);if(!et.isValid){console.warn("[Svelte] Handoff validation failed",et.details);const it=[];for(const at of et.details.conflicts){const Ct=at.conflictColumns.length===1?`column ${at.conflictColumns[0]}`:`columns ${at.conflictColumns[0]}-${at.conflictColumns[at.conflictColumns.length-1]}`;it.push(`Voice "${at.color}": Overlap at ${Ct}`)}tt("Cannot Export to Singing Trainer",et.summary,it);return}try{const it=await yD(rt);console.log("[Svelte] Handoff slot written",it),kD(it)}catch(it){console.error("[Svelte] Failed to write handoff slot",it),tt("Export Failed","An error occurred while preparing the handoff. Please try again.")}}Os(()=>{if(e=document.getElementById("settings-button"),s=document.getElementById("sidebar"),r=document.getElementById("sidebar-overlay"),i=document.getElementById("volume-icon-button"),o=document.getElementById("volume-popup"),A=document.getElementById("vertical-volume-slider"),a=document.getElementById("anacrusis-on-btn"),l=document.getElementById("anacrusis-off-btn"),c=document.getElementById("long-note-style1-btn"),u=document.getElementById("long-note-style2-btn"),d=document.getElementById("playhead-mode-cursor-btn"),p=document.getElementById("playhead-mode-microbeat-btn"),h=document.getElementById("playhead-mode-macrobeat-btn"),m=document.getElementById("hide-drumgrid-toggle"),g=document.getElementById("drum-grid-wrapper"),v=document.getElementById("hide-buttongrid-toggle"),w=document.getElementById("button-grid"),y=document.getElementById("hide-leftlegend-toggle"),I=document.getElementById("legend-left-canvas"),B=document.getElementById("hide-rightlegend-toggle"),C=document.getElementById("legend-right-canvas"),b=document.getElementById("take-to-singing-trainer-button"),e&&s&&r&&(e.addEventListener("click",L),r.addEventListener("click",L)),i&&o&&A){const $=U();A.value=String($),i.addEventListener("click",R),A.addEventListener("input",N),document.addEventListener("click",q),A.dispatchEvent(new Event("input"))}if(a&&l&&(a.addEventListener("click",J),l.addEventListener("click",nt),f.on("anacrusisChanged",At),a.classList.toggle("active",f.state.hasAnacrusis),l.classList.toggle("active",!f.state.hasAnacrusis)),c&&u){c.addEventListener("click",ot),u.addEventListener("click",V),f.on("longNoteStyleChanged",H);const $=f.state.longNoteStyle||"style1";c.classList.toggle("active",$==="style1"),u.classList.toggle("active",$==="style2")}if(d&&p&&h){d.addEventListener("click",G),p.addEventListener("click",Y),h.addEventListener("click",P),f.on("playheadModeChanged",st);const $=f.state.playheadMode||"cursor";d.classList.toggle("active",$==="cursor"),p.classList.toggle("active",$==="microbeat"),h.classList.toggle("active",$==="macrobeat")}m&&g&&m.addEventListener("click",D),v&&w&&v.addEventListener("click",K),y&&I&&y.addEventListener("click",O),B&&C&&B.addEventListener("click",X),b&&b.addEventListener("click",()=>{z()}),console.log("[Svelte] SidebarBridge mounted")}),si(()=>{e==null||e.removeEventListener("click",L),r==null||r.removeEventListener("click",L),i==null||i.removeEventListener("click",R),A==null||A.removeEventListener("input",N),document.removeEventListener("click",q),a==null||a.removeEventListener("click",J),l==null||l.removeEventListener("click",nt),c==null||c.removeEventListener("click",ot),u==null||u.removeEventListener("click",V),d==null||d.removeEventListener("click",G),p==null||p.removeEventListener("click",Y),h==null||h.removeEventListener("click",P),m==null||m.removeEventListener("click",D),v==null||v.removeEventListener("click",K),y==null||y.removeEventListener("click",O),B==null||B.removeEventListener("click",X),console.log("[Svelte] SidebarBridge unmounted")}),Ue()}const Ku={selectedSixteenthStampId:1,updateSixteenthStampColors:n=>{},init(){this.render(),this.bindEvents(),E.info("SixteenthStampsToolbar","Sixteenth stamps toolbar initialized",null,"stamps")},render(){const n=document.getElementById("sixteenth-stamps-toolbar-container");if(!n){E.warn("SixteenthStampsToolbar","Container not found",null,"stamps");return}n.innerHTML="";const t=document.createElement("div");t.className="sixteenth-stamps-grid",[[1,2,3,4],[5,8,14,6,9,7],[10,13,12,11,15]].forEach((s,r)=>{const i=document.createElement("div");i.className=`sixteenth-stamps-row sixteenth-stamps-row-${r+1}`,s.forEach(o=>{const A=gh.find(a=>a.id===o);if(A){const a=this.createSixteenthStampButton(A);i.appendChild(a)}}),t.appendChild(i)}),n.appendChild(t),this.setInitialSelection(this.selectedSixteenthStampId)},createSixteenthStampButton(n){const t=document.createElement("button");t.className="sixteenth-stamp-button",t.dataset.sixteenthStampId=`${n.id}`,t.setAttribute("title",`${n.id}: ${n.label}`);const e=this.createSixteenthStampPreview(n);return t.appendChild(e),t},createSixteenthStampPreview(n){const t=yp.renderToSVG(n,100,100);return t.setAttribute("width","40"),t.setAttribute("height","40"),t},bindEvents(){const n=document.getElementById("sixteenth-stamps-toolbar-container");if(!n)return;n.addEventListener("click",e=>{var r;const s=(r=e.target)==null?void 0:r.closest(".sixteenth-stamp-button");if(s){const i=parseInt(s.dataset.sixteenthStampId||"",10);Number.isNaN(i)||this.selectSixteenthStamp(i)}}),this.updateSixteenthStampColors=e=>{if(!e||!n)return;const s=(l,c=50)=>{const u=parseInt(l.slice(1,3),16),d=parseInt(l.slice(3,5),16),p=parseInt(l.slice(5,7),16),h=Math.min(255,Math.floor(u+(255-u)*(c/100))),m=Math.min(255,Math.floor(d+(255-d)*(c/100))),g=Math.min(255,Math.floor(p+(255-p)*(c/100)));return`#${h.toString(16).padStart(2,"0")}${m.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}`},r=(l,c=20)=>{const u=parseInt(l.slice(1,3),16),d=parseInt(l.slice(3,5),16),p=parseInt(l.slice(5,7),16),h=Math.max(0,Math.floor(u*(1-c/100))),m=Math.max(0,Math.floor(d*(1-c/100))),g=Math.max(0,Math.floor(p*(1-c/100)));return`#${h.toString(16).padStart(2,"0")}${m.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}`},i=f.state.colorPalette[e]||{primary:e,light:e},o=s(i.light,60),A=i.primary,a=r(A,20);n.style.setProperty("--c-accent",A),n.style.setProperty("--c-accent-light",o),n.style.setProperty("--c-accent-hover",a)},f.on("noteChanged",({newNote:e}={})=>{e!=null&&e.color&&this.updateSixteenthStampColors(e.color)});const t=f.state.selectedNote;t!=null&&t.color&&this.updateSixteenthStampColors(t.color),f.on("toolChanged",({newTool:e}={})=>{e&&e!=="sixteenthStamp"&&this.clearSelection()}),f.on("tripletStampToolSelected",()=>{this.clearSelection()})},setInitialSelection(n){this.selectedSixteenthStampId=n;const t=document.getElementById("sixteenth-stamps-toolbar-container");t&&t.querySelectorAll(".sixteenth-stamp-button").forEach(e=>{const s=e;s.classList.toggle("active",parseInt(s.dataset.sixteenthStampId||"",10)===n)})},selectSixteenthStamp(n){this.selectedSixteenthStampId=n;const t=document.getElementById("sixteenth-stamps-toolbar-container");t&&t.querySelectorAll(".sixteenth-stamp-button").forEach(e=>{const s=e;s.classList.toggle("active",parseInt(s.dataset.sixteenthStampId||"",10)===n)}),f.setSelectedTool("sixteenthStamp"),f.emit("sixteenthStampSelected",n),f.emit("sixteenthStampToolSelected")},clearSelection(){const n=document.getElementById("sixteenth-stamps-toolbar-container");n&&n.querySelectorAll(".sixteenth-stamp-button").forEach(t=>{t.classList.remove("active")})},getSelectedSixteenthStamp(){return gh.find(t=>t.id===this.selectedSixteenthStampId)}};class HD{constructor(){M(this,"overlay");M(this,"modal");M(this,"title");M(this,"message");M(this,"actionsContainer");M(this,"closeButton");var t,e,s,r,i;this.overlay=document.getElementById("notification-overlay"),this.modal=(t=this.overlay)==null?void 0:t.querySelector(".notification-modal"),this.title=(e=this.overlay)==null?void 0:e.querySelector(".notification-title"),this.message=(s=this.overlay)==null?void 0:s.querySelector(".notification-message"),this.actionsContainer=(r=this.overlay)==null?void 0:r.querySelector(".notification-actions"),this.closeButton=(i=this.overlay)==null?void 0:i.querySelector(".notification-close"),this.setupEventListeners()}setupEventListeners(){var t;this.overlay&&((t=this.closeButton)==null||t.addEventListener("click",()=>this.hide()),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.hide()}),document.addEventListener("keydown",e=>{var s;e.key==="Escape"&&((s=this.overlay)!=null&&s.classList.contains("visible"))&&this.hide()}))}show(t={}){const e=this.overlay;if(!e)return;const{title:s="Notice",message:r="",buttons:i=[{text:"OK",primary:!0,action:()=>this.hide()}]}=t;this.title&&(this.title.textContent=s),this.message&&(this.message.textContent=r);const o=this.actionsContainer;o&&(o.innerHTML="",i.forEach(A=>{const a=document.createElement("button");a.className=`notification-button ${A.primary?"":"secondary"}`,a.textContent=A.text,a.addEventListener("click",()=>{A.action?A.action():this.hide()}),o.appendChild(a)})),e.classList.add("visible"),setTimeout(()=>{var a;const A=(a=this.actionsContainer)==null?void 0:a.querySelector(".notification-button");A==null||A.focus()},100)}hide(){this.overlay&&this.overlay.classList.remove("visible")}alert(t,e="Notice"){this.show({title:e,message:t,buttons:[{text:"OK",primary:!0,action:()=>this.hide()}]})}confirm(t,e="Confirm"){return new Promise(s=>{this.show({title:e,message:t,buttons:[{text:"Cancel",primary:!1,action:()=>{this.hide(),s(!1)}},{text:"OK",primary:!0,action:()=>{this.hide(),s(!0)}}]})})}}const V0=new HD,cf=40,OD=cf;class W0{constructor(t,e,s,r,i){M(this,"element");M(this,"viewportEl");M(this,"optionsEl");M(this,"onChange");M(this,"onBeforeChange");M(this,"options");M(this,"optionNodes",[]);M(this,"selectedIndex",0);M(this,"pointerActive",!1);M(this,"pointerId",null);M(this,"lastPointerY",0);M(this,"deltaBuffer",0);M(this,"optionHeight",cf);M(this,"resizeObserver",null);this.element=t,this.viewportEl=t==null?void 0:t.querySelector(".clef-wheel-viewport"),this.optionsEl=t==null?void 0:t.querySelector(".clef-wheel-options"),this.onChange=r,this.onBeforeChange=i||null,this.options=e,!(!t||!this.viewportEl||!this.optionsEl)&&(this.renderOptions(),this.setIndex(s,{silent:!0}),this.attachEvents(),this.observeSize())}renderOptions(){const t=this.optionsEl;t&&(t.innerHTML="",this.optionNodes=this.options.map((e,s)=>{const r=document.createElement("div");return r.className="clef-wheel-option",r.dataset.index=s.toString(),r.textContent=e.label,t.appendChild(r),r}))}attachEvents(){if(!this.element)return;this.element.addEventListener("wheel",e=>{e.preventDefault(),e.stopPropagation();const s=Math.sign(e.deltaY);s!==0&&this.increment(s)},{passive:!1}),this.element.addEventListener("keydown",e=>{e.key==="ArrowUp"?(e.preventDefault(),this.increment(-1)):e.key==="ArrowDown"?(e.preventDefault(),this.increment(1)):e.key==="Home"?(e.preventDefault(),this.setIndex(0)):e.key==="End"&&(e.preventDefault(),this.setIndex(this.options.length-1))}),this.element.addEventListener("pointerdown",e=>{var s;if(this.pointerActive=!0,this.pointerId=e.pointerId,this.lastPointerY=e.clientY,this.deltaBuffer=0,typeof((s=this.element)==null?void 0:s.setPointerCapture)=="function")try{this.element.setPointerCapture(this.pointerId)}catch{}}),this.element.addEventListener("pointermove",e=>{if(!this.pointerActive||e.pointerId!==this.pointerId)return;const s=e.clientY-this.lastPointerY;if(this.lastPointerY=e.clientY,s===0)return;this.deltaBuffer+=s;const r=this.optionHeight||OD;for(;Math.abs(this.deltaBuffer)>=r;){const i=-Math.sign(this.deltaBuffer);this.increment(i),this.deltaBuffer-=Math.sign(this.deltaBuffer)*r}});const t=e=>{var s,r;this.pointerActive&&e.pointerId===this.pointerId&&(this.pointerActive=!1,this.pointerId=null,this.deltaBuffer=0,(r=(s=this.element)==null?void 0:s.hasPointerCapture)!=null&&r.call(s,e.pointerId)&&this.element.releasePointerCapture(e.pointerId))};this.element.addEventListener("pointerup",t),this.element.addEventListener("pointercancel",t),this.element.addEventListener("pointerleave",t)}observeSize(){this.element&&(typeof ResizeObserver=="function"?(this.resizeObserver=new ResizeObserver(t=>{for(const e of t)e.target===this.element&&e.contentRect.height>0&&this.updateVisuals()}),this.resizeObserver.observe(this.element)):window.addEventListener("resize",()=>this.updateVisuals()))}getIndex(){return this.selectedIndex}increment(t){t===0||!this.options||this.options.length===0||this.setIndex(this.selectedIndex+t)}setIndex(t,{silent:e=!1}={}){if(!this.optionsEl)return;let s=t;!e&&typeof this.onBeforeChange=="function"&&(s=this.onBeforeChange(t));const r=Math.max(0,Math.min(this.options.length-1,s));if(r===this.selectedIndex){this.updateVisuals();return}if(this.selectedIndex=r,this.updateVisuals(),!e&&typeof this.onChange=="function"){const i=this.options[r];i&&this.onChange(r,i)}}updateVisuals(){var a,l,c;if(!this.optionsEl||!this.viewportEl)return;const t=this.viewportEl.clientHeight||0,e=(a=this.optionNodes)==null?void 0:a[this.selectedIndex],s=(l=this.optionNodes)==null?void 0:l[0],r=(e==null?void 0:e.offsetHeight)||(s==null?void 0:s.offsetHeight)||cf;if(this.optionHeight=r,(c=this.optionNodes)==null||c.forEach((u,d)=>{const p=Math.abs(d-this.selectedIndex);u.dataset.distance=String(Math.min(p,3))}),t===0||r===0)return;const i=Math.max(0,(t-r)/2);this.optionsEl.style.paddingTop=`${i}px`,this.optionsEl.style.paddingBottom=`${i}px`;const o=e?e.offsetTop+r/2:i+r/2,A=t/2-o;this.optionsEl.style.transform=`translateY(${A}px)`}}class VD{constructor(){M(this,"initialized",!1);M(this,"topPicker",null);M(this,"bottomPicker",null);M(this,"topWheel",null);M(this,"bottomWheel",null);M(this,"rangeLabel",null);M(this,"rangeCount",null);M(this,"fullRangeButton",null);M(this,"trebleButton",null);M(this,"altoButton",null);M(this,"bassButton",null);M(this,"voice1Button",null);M(this,"voice2Button",null);M(this,"voice3Button",null);M(this,"presetContainer",null);M(this,"presetButtons",[]);M(this,"activePresetId",null);M(this,"masterOptions",[]);M(this,"presetRanges",{});M(this,"constrainTopIndex",t=>{if(!this.bottomPicker)return t;const e=this.bottomPicker.getIndex(),s=this.masterOptions.length;return x_(e,t,s,oe)});M(this,"constrainBottomIndex",t=>{if(!this.topPicker)return t;const e=this.topPicker.getIndex(),s=this.masterOptions.length;return I_(e,t,s,oe)})}init(){if(this.initialized)return;if(this.topWheel=document.getElementById("clef-top-wheel"),this.bottomWheel=document.getElementById("clef-bottom-wheel"),this.rangeLabel=document.getElementById("clef-range-label"),this.rangeCount=document.getElementById("clef-range-count"),this.fullRangeButton=document.getElementById("clef-full-range-button"),this.trebleButton=document.getElementById("clef-treble-button"),this.altoButton=document.getElementById("clef-alto-button"),this.bassButton=document.getElementById("clef-bass-button"),this.voice1Button=document.getElementById("clef-voice1-button"),this.voice2Button=document.getElementById("clef-voice2-button"),this.voice3Button=document.getElementById("clef-voice3-button"),this.presetContainer=document.querySelector(".clef-preset-buttons"),this.presetButtons=Array.from(document.querySelectorAll(".clef-preset-button")),!this.topWheel||!this.bottomWheel){E.warn("ClefViewportController","Clef tab elements not found; skipping initialization",null,"ui");return}this.masterOptions=Xs.map((e,s)=>({index:s,label:e.pitch,toneNote:e.toneNote,frequency:e.frequency}));const t=this.getViewportRange();this.topPicker=new W0(this.topWheel,this.masterOptions,t.topIndex,e=>this.handleTopSelection(e),e=>this.constrainTopIndex(e)),this.bottomPicker=new W0(this.bottomWheel,this.masterOptions,t.bottomIndex,e=>this.handleBottomSelection(e),e=>this.constrainBottomIndex(e)),this.computePresetRanges(),this.fullRangeButton&&this.fullRangeButton.addEventListener("click",()=>this.applyPresetView("full")),this.trebleButton&&this.trebleButton.addEventListener("click",()=>this.applyPresetView("treble")),this.altoButton&&this.altoButton.addEventListener("click",()=>this.applyPresetView("alto")),this.bassButton&&this.bassButton.addEventListener("click",()=>this.applyPresetView("bass")),this.voice1Button&&this.voice1Button.addEventListener("click",()=>this.applyPresetView("voice1")),this.voice2Button&&this.voice2Button.addEventListener("click",()=>this.applyPresetView("voice2")),this.voice3Button&&this.voice3Button.addEventListener("click",()=>this.applyPresetView("voice3")),f.on("pitchRangeChanged",()=>{this.syncFromViewport()}),f.on("zoomChanged",()=>{this.syncFromViewport()}),this.calculateAndSetWheelHeight(),window.addEventListener("resize",()=>this.calculateAndSetWheelHeight()),this.syncFromViewport(),this.initialized=!0,E.moduleLoaded("ClefViewportController","ui")}refreshWheelVisuals(){var t,e;(t=this.topPicker)==null||t.updateVisuals(),(e=this.bottomPicker)==null||e.updateVisuals()}getViewportRange(){var A;const t=Math.max(0,this.masterOptions.length-1),e=qe.getViewportInfo(),s=(e==null?void 0:e.startRank)??((A=f.state.pitchRange)==null?void 0:A.topIndex)??0,r=(e==null?void 0:e.endRank)??s+1,i=Math.max(0,Math.min(t,s)),o=Math.max(i,Math.min(t,r-1));return{topIndex:i,bottomIndex:o}}syncFromViewport(){if(!this.topPicker||!this.bottomPicker)return;const{topIndex:t,bottomIndex:e}=this.getViewportRange();this.topPicker.setIndex(t,{silent:!0}),this.bottomPicker.setIndex(e,{silent:!0}),this.updateSummary(t,e),this.updatePresetHighlight(t,e)}handleTopSelection(t){E.debug("ClefViewportController","handleTopSelection called",{newTopIndex:t},"ui"),qe.setViewportTopIndex(t)}handleBottomSelection(t){E.debug("ClefViewportController","handleBottomSelection called",{newBottomIndex:t},"ui"),qe.setViewportBottomIndex(t)}updateSummary(t,e){const s=this.masterOptions[t],r=this.masterOptions[e],i=e-t+1;this.rangeLabel&&s&&r&&(this.rangeLabel.textContent=`${s.label}  ${r.label}`),this.rangeCount&&(this.rangeCount.textContent=`${i} ${i===1?"pitch":"pitches"}`)}computePresetRanges(){const t=(e,s)=>{const r=this.findToneNoteIndex(e),i=this.findToneNoteIndex(s);return r===-1||i===-1?null:{topIndex:Math.min(r,i),bottomIndex:Math.max(r,i)}};this.presetRanges={full:{topIndex:0,bottomIndex:Math.max(0,this.masterOptions.length-1)},treble:t("G5","C4"),alto:t("A4","D3"),bass:t("C4","F2"),voice1:t("A5","A3"),voice2:t("C5","C3"),voice3:t("E4","E2")}}updatePresetHighlight(t,e){var r;let s=null;Object.entries(this.presetRanges).forEach(([i,o])=>{o&&o.topIndex===t&&o.bottomIndex===e&&(s=i)}),this.activePresetId=s,(r=this.presetButtons)!=null&&r.length&&(this.presetButtons.forEach(i=>{var a;const o=(a=i.dataset)!=null&&a.preset?i.dataset.preset??"":(i.id||"").replace(/^clef-/,"").replace(/-button$/,"").replace(/-range$/,"").replace(/-/g,""),A=this.activePresetId&&o===this.activePresetId;i.classList.toggle("active",!!A)}),this.presetContainer&&this.presetContainer.classList.toggle("locked",!1))}applyPresetView(t){const e=this.presetRanges[t];if(!e){E.warn("ClefViewportController","Preset range could not be resolved",{preset:t},"ui");return}const s=t==="full"?420:280;qe.setPitchViewportRange(e,{animateMs:s,source:`preset:${t}`})}findNoteIndex(t){return this.masterOptions.findIndex(e=>e.label===t)}findToneNoteIndex(t){return this.masterOptions.findIndex(e=>e.toneNote===t)}calculateAndSetWheelHeight(){const t=document.querySelector(".range-panel-section.wheels-section"),e=t==null?void 0:t.querySelector(".panel-section-title");if(!t||!this.topWheel||!this.bottomWheel)return;const s=t.clientHeight,r=(e==null?void 0:e.offsetHeight)||0,o=s-r-15,A=Math.max(120,Math.min(o,300));this.topWheel.style.setProperty("--clef-wheel-height",`${A}px`),this.bottomWheel.style.setProperty("--clef-wheel-height",`${A}px`),setTimeout(()=>{var a,l;(a=this.topPicker)==null||a.updateVisuals(),(l=this.bottomPicker)==null||l.updateVisuals()},0)}}const G0=new VD,WD={X:["1P","3M","5P"],x:["1P","3m","5P"],"x":["1P","3m","5d"],"X+":["1P","3M","5A"],"X":["1P","3M","5P","7m"],"x":["1P","3m","5P","7m"],"Xmaj":["1P","3M","5P","7M"],"":["1P","3m","5d","7m"],"x":["1P","3m","5d","6M"],"X":["1P","3M","5P","6M"],Xsus2:["1P","2M","5P"],Xsus4:["1P","4P","5P"]},GD={"xmaj":["1P","3m","5P","7M"],Xadd9:["1P","3M","5P","9M"],xadd9:["1P","3m","5P","9M"],"X6/9":["1P","3M","5P","6M","9M"],X9:["1P","3M","5P","7m","9M"],X11:["1P","3M","5P","7m","9M","11P"],X13:["1P","3M","5P","7m","9M","13M"],Xmaj9:["1P","3M","5P","7M","9M"],"x":["1P","3m","5P","7m","9M"],"x":["1P","3m","5P","6M"],"x":["1P","3m","5P","7m","9M","11P"],"Xmaj711":["1P","3M","5P","7M","11A"]},K0={...WD,...GD},q0={M6:["6M"],A6:["6A"],m7:["7m"],M7:["7M"],d5:["5d"],P5:["5P"],A5:["5A"],m6:["6m"],m3:["3m"],M3:["3M"],P4:["4P"],A4:["4A"],U:["1P"],m2:["2m"],M2:["2M"],A2:["2A"]},KD={"9m":"2m","9M":"2M","9A":"2A","11P":"4P","11A":"4A","13m":"6m","13M":"6M","13A":"6A"};function kd(n){return KD[n]??n}function qD(n,t){Qe(t,!0);const e=15;let s="diatonic",r="position",i=null,o=null,A=null,a=null,l=null,c=null,u=null,d=null,p=null,h=null,m=null,g=null,v=null,w=null,y=[];function I(){return Object.keys(f.state.tonicSignGroups).length>0}function B(D=f.state.degreeDisplayMode){const K=A==null?void 0:A.querySelector('[data-mode="diatonic"]'),O=A==null?void 0:A.querySelector('[data-mode="modal"]');if(!K||!O)return;D!=="off"&&(s=D);const X=D==="off"?s:D,tt=D==="off";[K,O].forEach(k=>{k.disabled=tt,k.classList.toggle("disabled",tt)}),A&&A.classList.toggle("disabled",tt),K.classList.toggle("active",X==="diatonic"),K.setAttribute("aria-pressed",X==="diatonic"?"true":"false"),O.classList.toggle("active",X==="modal"),O.setAttribute("aria-pressed",X==="modal"?"true":"false")}function C(D,K){if(!K)return;const O=D!=="off";K.classList.toggle("active",O),K.setAttribute("aria-pressed",O?"true":"false")}function b(){var D;if(v&&(v.querySelectorAll(".harmony-preset-button").forEach(K=>{K.classList.remove("selected","partial-match")}),f.state.activeChordIntervals)){const K=f.state.activeChordIntervals,O=K.toString(),X=K.map(kd),tt=v.querySelectorAll(".harmony-preset-button");for(const k of tt){const z=((D=k.textContent)==null?void 0:D.trim())??"",$=K0[z];if(!$)continue;const rt=$.toString(),et=$.map(kd);if(rt===O){k.classList.add("selected");continue}X.every(at=>et.includes(at))&&k.classList.add("partial-match")}}}function S(){if(w&&(w.querySelectorAll(".harmony-preset-button").forEach(D=>D.classList.remove("selected")),f.state.activeChordIntervals)){const K=f.state.activeChordIntervals.map(kd);w.querySelectorAll(".harmony-preset-button").forEach(O=>{var z;const X=((z=O.textContent)==null?void 0:z.trim())??"",tt=q0[X],k=tt==null?void 0:tt[0];k&&K.includes(k)&&O.classList.add("selected")})}}const T=(D,K=50)=>{const O=parseInt(D.slice(1,3),16),X=parseInt(D.slice(3,5),16),tt=parseInt(D.slice(5,7),16),k=Math.min(255,Math.floor(O+(255-O)*(K/100))),z=Math.min(255,Math.floor(X+(255-X)*(K/100))),$=Math.min(255,Math.floor(tt+(255-tt)*(K/100)));return`#${k.toString(16).padStart(2,"0")}${z.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")}`},x=(D,K=1)=>{const O=D.startsWith("#")?D.slice(1):D;if(O.length!==6)return D;const X=parseInt(O.slice(0,2),16),tt=parseInt(O.slice(2,4),16),k=parseInt(O.slice(4,6),16);return`rgba(${X}, ${tt}, ${k}, ${K})`},_=(D,K)=>{if(!D)return;const O=T(K,50),X=T(O,60);D.style.setProperty("--c-accent",K),D.style.setProperty("--c-accent-light",X),D.style.setProperty("--harmony-partial-bg",x(X,.25)),D.style.setProperty("--harmony-partial-border",x(K,.4)),D.style.setProperty("--harmony-partial-bg-hover",x(X,.4)),D.style.setProperty("--harmony-partial-border-hover",x(K,.6))};function F(){var K;return(((K=f.state.activeChordIntervals)==null?void 0:K.length)??0)===2?"inversion":"position"}function Q(){var K;const D=((K=f.state.activeChordIntervals)==null?void 0:K.length)??1;return D===2?2:Math.max(1,D)}function U(){return F()==="inversion"?f.state.isIntervalsInverted?1:0:f.state.chordPositionState}function W(D){F()==="inversion"?f.setIntervalsInversion(D===1):f.setChordPosition(D)}function L(){var X;if(!g)return;const D=F(),K=U(),O=((X=f.state.activeChordIntervals)==null?void 0:X.length)??1;g.classList.toggle("inversion-mode",D==="inversion"),g.classList.toggle("position-mode",D==="position"),g.classList.remove("state-1","state-2","state-3","state-4","state-5"),K>=1&&K<=5&&g.classList.add(`state-${K}`);for(let tt=1;tt<=5;tt++)g.classList.remove(`disabled-state-${tt}`);D==="position"&&(O<=1?g.classList.add("disabled-state-1"):O===2?g.classList.add("disabled-state-2"):O===3?g.classList.add("disabled-state-3"):O===4?g.classList.add("disabled-state-4"):O===5&&g.classList.add("disabled-state-5"))}function R(){var O;const D=F(),K=((O=f.state.activeChordIntervals)==null?void 0:O.length)??1;if(r!==D){if(D==="inversion"){const X=f.state.chordPositionState===0;f.setIntervalsInversion(!X)}else f.setChordPosition(0);r=D}else if(D==="position"){const X=Math.max(0,K-1);f.state.chordPositionState>X&&f.setChordPosition(0)}L()}function N(){R()}function q(D=f.state.selectedToolTonicNumber){if(!y.length)return;const K=y[0]?parseInt(y[0].dataset.tonic??"1",10):1,O=typeof D=="number"?D:parseInt(String(D??""),10),X=Number.isNaN(O)?K:O;y.forEach(tt=>{const k=tt.dataset.tonic,$=(k?parseInt(k,10):NaN)===X;tt.classList.toggle("selected",$),tt.setAttribute("aria-pressed",$?"true":"false")})}function J(){return l!=null&&l.classList.contains("active")?"modal":a!=null&&a.classList.contains("active")?"diatonic":s}function nt(){const D=document.querySelector('[data-tab="rhythm"]');D&&!D.classList.contains("active")&&D.click();const K=document.querySelector('[data-rhythm-stamp-tab="sixteenth"]');K&&!K.classList.contains("active")&&K.click()}const At=D=>{[c,u,p].forEach(K=>{K&&(K.classList.toggle("accidental-btn--disabled",D),K.setAttribute("aria-disabled",D?"true":"false"))})},ot=D=>{D!==void 0&&(d&&(d.classList.toggle("active",D),d.setAttribute("aria-pressed",D?"true":"false")),At(D))},V=D=>{D!==void 0&&p&&(p.classList.toggle("active",D),p.setAttribute("aria-pressed",D?"true":"false"))};function H({newTool:D}={}){var K;if(i==null||i.classList.remove("selected"),m&&m.classList.remove("active-tool"),D==="eraser")i==null||i.classList.add("selected");else if(D==="chord")m==null||m.classList.add("active-tool");else if(D==="note"){const O=f.state.selectedNote;if(O){const X=document.querySelector(`.note-pair[data-color='${O.color}']`);X==null||X.classList.add("selected"),(K=X==null?void 0:X.querySelector(`.note[data-type='${O.shape}']`))==null||K.classList.add("selected")}}q()}function G(){b(),S(),N()}function Y({newNote:D}={}){var k;if(!(D!=null&&D.color)||!D.shape)return;const{color:K,shape:O}=D;document.querySelectorAll(".note, .note-pair").forEach(z=>z.classList.remove("selected"));const X=document.querySelector(`.note[data-color='${K}'][data-type='${O}']`);if(X)X.classList.add("selected");else{const z=document.querySelector(`.note-pair[data-color='${K}']`);z==null||z.classList.add("selected"),(k=z==null?void 0:z.querySelector(`.note[data-type='${O}']`))==null||k.classList.add("selected")}_(m,K);const tt=document.querySelector(".tab-sidebar");tt&&tt.style.setProperty("--c-accent",K)}function P(D){D&&(C(D,o),B(D))}function st(D){D&&(u==null||u.classList.toggle("active",D.sharp),c==null||c.classList.toggle("active",D.flat))}Os(()=>{var Et,Qt;const D=fr.getMultiple("noteBankContainer","eraserButton","degreeVisibilityToggle","degreeModeToggle","flatBtn","sharpBtn","frequencyBtn","octaveLabelBtn","focusColoursToggle");i=D.eraserButton,o=D.degreeVisibilityToggle??null,A=D.degreeModeToggle,a=(A==null?void 0:A.querySelector('[data-mode="diatonic"]'))??null,l=(A==null?void 0:A.querySelector('[data-mode="modal"]'))??null,c=D.flatBtn,u=D.sharpBtn,d=D.frequencyBtn,p=D.octaveLabelBtn,h=D.focusColoursToggle,m=document.querySelector(".pitch-tabs-container"),g=document.getElementById("unified-position-toggle"),v=document.querySelector("#chords-panel .chords-grid"),w=document.querySelector("#chords-panel .intervals-4x4-grid"),y=Array.from(document.querySelectorAll(".tonic-mode-button")),G0.init(),document.querySelectorAll(".note").forEach(ct=>{ct.addEventListener("click",()=>{var Ot;const gt=ct.dataset.type,mt=ct.dataset.color||((Ot=ct.closest(".note-pair"))==null?void 0:Ot.dataset.color);if(!(!gt||!mt)){if(gt==="diamond"){f.setSelectedNote("diamond",mt);const ve=document.querySelector(".sixteenth-stamp-button.active"),we=ve?parseInt(ve.dataset.sixteenthStampId??"",10):NaN;if(f.state.selectedTool==="sixteenthStamp"&&ve&&!Number.isNaN(we)&&we!==e)return;nt(),Ku.selectSixteenthStamp(e);return}f.setSelectedNote(gt,mt),f.setSelectedTool("note")}})}),i&&i.addEventListener("click",()=>{if(f.state.selectedTool==="eraser"){f.setSelectedTool(f.state.previousTool||"note");return}f.setSelectedTool("eraser")});const O=document.getElementById("lasso-shortcut-button");O&&O.addEventListener("click",()=>{var ct,gt,mt;(ct=document.querySelector('[data-tab="pitch"]'))==null||ct.click(),(gt=document.querySelector('[data-pitch-tab="draw"]'))==null||gt.click(),(mt=document.querySelector('button.draw-tool-button[data-draw-tool="lasso"]'))==null||mt.click()});const X=document.getElementById("marker-shortcut-button");X&&X.addEventListener("click",()=>{var ct,gt,mt;(ct=document.querySelector('[data-tab="pitch"]'))==null||ct.click(),(gt=document.querySelector('[data-pitch-tab="draw"]'))==null||gt.click(),(mt=document.querySelector('button.draw-tool-button[data-draw-tool="marker"]'))==null||mt.click()}),y.length&&(y.forEach(ct=>{ct.addEventListener("click",()=>{const gt=ct.getAttribute("data-tonic");if(!gt)return;const mt=parseInt(gt,10);f.setSelectedTool("tonicization",mt),q(mt)})}),q()),v&&v.querySelectorAll(".harmony-preset-button").forEach(ct=>{ct.addEventListener("click",()=>{var Ot;const gt=((Ot=ct.textContent)==null?void 0:Ot.trim())??"",mt=K0[gt];mt&&mt.length>0&&(f.setActiveChordIntervals(mt),f.setSelectedTool("chord")),ct.blur()}),ct.addEventListener("dblclick",()=>{ct.classList.contains("selected")&&f.setSelectedTool("note"),ct.blur()})}),w&&w.querySelectorAll(".harmony-preset-button").forEach(ct=>{ct.addEventListener("click",()=>{var Ot;const gt=((Ot=ct.textContent)==null?void 0:Ot.trim())??"",mt=q0[gt];if(mt&&mt.length>0){const ve=mt[0];if(!ve)return;let we=f.state.selectedTool==="chord"&&f.state.activeChordIntervals?[...f.state.activeChordIntervals]:["1P"];we.includes(ve)?ve!=="1P"&&(we=we.filter(jn=>jn!==ve)):we.push(ve),we.includes("1P")||we.unshift("1P");const Cr=["1P","2m","2M","2A","3m","3M","4P","4A","5d","5P","5A","6m","6M","6A","7m","7M","9M","11P","11A","13M"];we.sort((jn,ri)=>Cr.indexOf(jn)-Cr.indexOf(ri)),f.setActiveChordIntervals(we),f.setSelectedTool("chord")}ct.blur()}),ct.addEventListener("dblclick",()=>{f.setActiveChordIntervals(["1P"]),f.setSelectedTool("chord"),ct.blur()})});const tt=document.querySelectorAll(".pitch-tab-button"),k=document.querySelectorAll(".pitch-tab-panel");tt.forEach(ct=>{ct.addEventListener("click",()=>{var mt;const gt=ct.dataset.pitchTab;gt&&(tt.forEach(Ot=>Ot.classList.remove("active")),ct.classList.add("active"),k.forEach(Ot=>Ot.classList.remove("active")),(mt=document.getElementById(`${gt}-panel`))==null||mt.classList.add("active"),localStorage.setItem("selectedPitchTab",gt),gt==="chords"&&N(),gt==="range"&&setTimeout(()=>G0.refreshWheelVisuals(),0))})});const z=localStorage.getItem("selectedPitchTab")||"chords",$=document.querySelector(`[data-pitch-tab="${z}"]`);$&&(tt.forEach(ct=>ct.classList.remove("active")),k.forEach(ct=>ct.classList.remove("active")),$.classList.add("active"),(Et=document.getElementById(`${z}-panel`))==null||Et.classList.add("active"));const rt=document.querySelectorAll(".rhythm-stamp-tab-button"),et=document.querySelectorAll(".rhythm-stamp-tab-panel");rt.forEach(ct=>{ct.addEventListener("click",()=>{var mt;const gt=ct.dataset.rhythmStampTab;gt&&(rt.forEach(Ot=>Ot.classList.remove("active")),ct.classList.add("active"),et.forEach(Ot=>Ot.classList.remove("active")),(mt=document.getElementById(`${gt}-stamps-panel`))==null||mt.classList.add("active"),localStorage.setItem("selectedRhythmStampTab",gt))})});const it=localStorage.getItem("selectedRhythmStampTab")||localStorage.getItem("selectedRhythmTab"),at=it==="stamps"?"sixteenth":it==="triplets"?"triplet":it||"sixteenth",Ct=document.querySelector(`[data-rhythm-stamp-tab="${at}"]`);if(Ct&&(rt.forEach(ct=>ct.classList.remove("active")),et.forEach(ct=>ct.classList.remove("active")),Ct.classList.add("active"),(Qt=document.getElementById(`${at}-stamps-panel`))==null||Qt.classList.add("active")),g){const ct=g.querySelector(".toggle-track");ct==null||ct.addEventListener("click",()=>{const gt=U(),mt=Q();W((gt+1)%mt),g==null||g.blur()}),g.querySelectorAll(".left-labels .state-label").forEach(gt=>{gt.addEventListener("click",()=>{F()==="inversion"&&W(parseInt(gt.dataset.step??"0",10))})}),g.querySelectorAll(".right-labels .state-label").forEach(gt=>{gt.addEventListener("click",()=>{if(F()!=="position")return;const mt=parseInt(gt.dataset.step??"0",10);mt<Q()&&W(mt)})}),f.on("chordPositionChanged",L),f.on("intervalsInversionChanged",L),L()}o&&o.addEventListener("click",()=>{if(f.state.degreeDisplayMode==="off"){if(!I()){V0.alert("Please place a tonal center on the canvas before showing degrees.","Tonal Center Required");return}f.setDegreeDisplayMode(J())}else f.setDegreeDisplayMode("off");o==null||o.blur()}),a&&a.addEventListener("click",()=>{f.state.degreeDisplayMode!=="off"&&f.state.degreeDisplayMode!=="diatonic"&&f.setDegreeDisplayMode("diatonic"),a==null||a.blur()}),l&&l.addEventListener("click",()=>{f.state.degreeDisplayMode!=="off"&&f.state.degreeDisplayMode!=="modal"&&f.setDegreeDisplayMode("modal"),l==null||l.blur()}),c&&c.addEventListener("click",()=>{f.state.showFrequencyLabels&&f.toggleFrequencyLabels(),f.toggleAccidentalMode("flat"),c==null||c.blur()}),u&&u.addEventListener("click",()=>{f.state.showFrequencyLabels&&f.toggleFrequencyLabels(),f.toggleAccidentalMode("sharp"),u==null||u.blur()}),d&&d.addEventListener("click",()=>{f.toggleFrequencyLabels(),d==null||d.blur()}),p&&p.addEventListener("click",()=>{f.state.showFrequencyLabels&&f.toggleFrequencyLabels(),f.toggleOctaveLabels(),p==null||p.blur()}),h&&h.addEventListener("change",()=>{if(!f.state.focusColours&&!I()){V0.alert("Please place a tonal center on the canvas before enabling focus colours.","Tonal Center Required"),h&&(h.checked=!1);return}f.toggleFocusColours()}),f.on("toolChanged",H),f.on("activeChordIntervalsChanged",G),f.on("noteChanged",Y),f.on("degreeDisplayModeChanged",P),f.on("accidentalModeChanged",st),f.on("frequencyLabelsChanged",ot),f.on("octaveLabelsChanged",V),ot(f.state.showFrequencyLabels),V(f.state.showOctaveLabels),m&&f.state.selectedNote&&_(m,f.state.selectedNote.color);const yt=document.querySelector(".tab-sidebar");yt&&f.state.selectedNote&&yt.style.setProperty("--c-accent",f.state.selectedNote.color),setTimeout(()=>N(),50);const Bt=f.state.degreeDisplayMode;C(Bt,o),B(Bt),b(),S(),N(),console.log("[Svelte] ToolSelectorBridge mounted")}),si(()=>{console.log("[Svelte] ToolSelectorBridge unmounted")}),Ue()}class Rd{constructor(t,e={}){M(this,"parent");M(this,"settings");M(this,"_em");M(this,"_value");M(this,"decimalPlaces");M(this,"colors");M(this,"element");M(this,"_minDimension");M(this,"actual",0);M(this,"hasMoved",!1);M(this,"clicked",!1);M(this,"_start",{y:0});M(this,"_changeFactor",1);var a,l,c,u;const s=typeof t=="string"?document.querySelector(t):t;if(this.parent=s,!this.parent)throw new Error("DraggableNumber: parent element not found");const r={size:[60,30],value:0,min:0,max:2e4,step:1,decimalPlaces:2,colors:{fill:"#e7e7e7",dark:"#333",light:"#fff",accent:"#b35"},useAppStyling:!1},i={fill:((a=e.colors)==null?void 0:a.fill)??r.colors.fill,dark:((l=e.colors)==null?void 0:l.dark)??r.colors.dark,light:((c=e.colors)==null?void 0:c.light)??r.colors.light,accent:((u=e.colors)==null?void 0:u.accent)??r.colors.accent};this.settings={...r,...e,colors:i},this._em=new $D,this._value=new zD(this.settings.min,this.settings.max,this.settings.step,this.settings.value),this.decimalPlaces=this.settings.decimalPlaces,this.colors=this.settings.colors,this.element=document.createElement("input"),this.element.type="text",this.parent.appendChild(this.element);const[o,A]=this.settings.size;this._minDimension=Math.min(o,A),this.settings.useAppStyling?(this.element.className="draggable-number-input",this.element.style.cssText=[`width:${o}px`,`height:${A}px`,"background-color: var(--c-surface)","color: var(--c-text)","border: 1px solid var(--c-border)","border-radius: var(--border-radius-sm)","font-family: var(--main-font)","font-weight: 400","font-size: 14px","text-align: center","outline: none","padding: 0","box-sizing: border-box","user-select: text"].join(";")):this.element.style.cssText=[`width:${o}px`,`height:${A}px`,`background-color:${this.colors.fill}`,`color:${this.colors.dark}`,"font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif","font-weight:500",`font-size:${this._minDimension/2}px`,"border: none","outline: none",`padding:${this._minDimension/4}px ${this._minDimension/4}px`,"box-sizing:border-box","user-select:text"].join(";"),YD(this.element,d=>/^-?\d*\.?\d*$/.test(d)),this.actual=0,this.hasMoved=!1,this.clicked=!1,this.element.value=z0(this._value.value,this.decimalPlaces),this._bind()}on(t,e){return this._em.on(t,e),()=>this._em.off(t,e)}emit(t,e){this._em.emit(t,e)}get value(){return this._value.value}set value(t){this._value.update(t),this.emit("change",this._value.value),this._render()}get min(){return this._value.min}set min(t){this._value.min=t,this._render()}get max(){return this._value.max}set max(t){this._value.max=t,this._render()}get step(){return this._value.step}set step(t){this._value.step=t,this._render()}passiveUpdate(t){this._value.update(t),this._render()}link(t){this.min=t.min,this.max=t.max,this.step=t.step,typeof t.on=="function"&&t.on("change",e=>this.passiveUpdate(e)),this.on("change",e=>{"value"in t&&(t.value=e)}),this.value=t.value}_bind(){this.element.addEventListener("blur",()=>{this.settings.useAppStyling?(this.element.style.backgroundColor="var(--c-surface)",this.element.style.color="var(--c-text)"):(this.element.style.backgroundColor=this.colors.fill,this.element.style.color=this.colors.dark);const t=parseFloat(this.element.value);!Number.isNaN(t)&&t!==this.value?this.value=t:this._render()}),this.element.addEventListener("keydown",t=>{if(t.key==="Enter"){this.element.blur();const e=parseFloat(this.element.value);Number.isNaN(e)||(this.value=e)}},!0),this.element.addEventListener("mousedown",t=>this._onMouseDown(t)),this.element.addEventListener("dragstart",t=>t.preventDefault())}_onMouseDown(t){this.hasMoved=!1,this.clicked=!0,this.element.readOnly=!0,this.actual=this.value,this._start={y:t.clientY};const e=this.element.getBoundingClientRect(),s=(t.clientX-e.left)/e.width;this._changeFactor=XD(s);const r=o=>this._onMouseMove(o),i=()=>this._onMouseUp(r,i);window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)}_onMouseMove(t){if(!this.clicked)return;this.hasMoved=!0;const e=t.clientY-this._start.y,r=Kp(this.max-this.min,0,1e3)/200*Math.pow(this._changeFactor,2),i=this.actual-e*r;this._value.update(i),this._render(),this._value.changed&&this.emit("change",this._value.value)}_onMouseUp(t,e){this.clicked=!1,window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",e),this.hasMoved?document.body.focus():(this.element.readOnly=!1,this.element.focus(),this.element.setSelectionRange(0,this.element.value.length),this.settings.useAppStyling?(this.element.style.backgroundColor="var(--c-accent)",this.element.style.color="var(--c-surface)"):(this.element.style.backgroundColor=this.colors.accent,this.element.style.color=this.colors.light))}_render(){this.element.value=z0(this._value.value,this.decimalPlaces)}}class zD{constructor(t,e,s,r){M(this,"min");M(this,"max");M(this,"step");M(this,"_value");M(this,"changed");this.min=Number(t),this.max=Number(e),this.step=Number(s)||1,this._value=0,this.changed=!1,this.update(r)}get value(){return this._value}update(t){const e=Kp(Number(t),this.min,this.max),s=this._stepTo(e),r=this._value;this._value=s,this.changed=s!==r}_stepTo(t){if(!isFinite(this.step)||this.step<=0)return t;const e=Math.round((t-this.min)/this.step);return this.min+e*this.step}}class $D{constructor(){M(this,"_m");this._m=new Map}on(t,e){const s=this._m.get(t)||[];s.push(e),this._m.set(t,s)}off(t,e){const s=this._m.get(t);if(!s)return;const r=s.indexOf(e);r>=0&&s.splice(r,1)}emit(t,e){const s=this._m.get(t);if(s)for(const r of s.slice())r(e)}}function Kp(n,t,e){return Math.max(t,Math.min(e,n))}function XD(n){return 1-Kp(n,0,1)}function z0(n,t=2){return isFinite(n)?Number(n).toFixed(Math.max(0,t)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):""}function YD(n,t){let e=n.value;n.addEventListener("input",()=>{t(n.value)?e=n.value:n.value=e})}class jD{constructor(){M(this,"isActive",!1);M(this,"pulseIntervals",new Map);M(this,"tempoElements",new Map);M(this,"popDuration",{scaleUp:40,scaleDown:80});M(this,"popScale",1.4);M(this,"activeAnimations",new Map);this.initElements()}initElements(){[{type:"eighth",containerId:"eighth-note-tempo",bpmMultiplier:2},{type:"quarter",containerId:"quarter-note-tempo",bpmMultiplier:1},{type:"dottedQuarter",containerId:"dotted-quarter-tempo",bpmMultiplier:.666}].forEach(({type:e,containerId:s,bpmMultiplier:r})=>{const i=document.getElementById(s),o=i==null?void 0:i.parentElement,A=o==null?void 0:o.querySelector(".tempo-label-icon");i&&A?this.tempoElements.set(e,{container:i,icon:A,bpmMultiplier:r,originalTransform:i.style.transform||"",originalIconTransform:A.style.transform||""}):E.warn("TempoVisualizer",`Could not find elements for ${e} tempo`,{container:!!i,icon:!!A,tempoGroup:!!o},"toolbar")})}start(){this.isActive||(this.isActive=!0,this.tempoElements.size===0&&this.initElements(),this.tempoElements.forEach((t,e)=>{this.startPulseForType(e)}))}stop(){this.isActive&&(this.isActive=!1,this.pulseIntervals.forEach(t=>{clearInterval(t)}),this.pulseIntervals.clear(),this.activeAnimations.clear(),this.tempoElements.forEach(t=>{t.container.style.transform=t.originalTransform,t.icon.style.transform=t.originalIconTransform}))}startPulseForType(t){const e=this.tempoElements.get(t);if(!e)return;const i=60/(f.state.tempo*e.bpmMultiplier)*1e3;this.triggerPulse(t);const o=setInterval(()=>{this.isActive&&this.triggerPulse(t)},i);this.pulseIntervals.set(t,o)}triggerPulse(t){const s={startTime:performance.now(),phase:"scaleUp"};this.activeAnimations.set(t,s);const r=this.isActive;this.isActive=!0,this.activeAnimations.size===1&&this.animationLoop(),r||setTimeout(()=>{this.activeAnimations.size===0&&(this.isActive=!1)},this.popDuration.scaleUp+this.popDuration.scaleDown+50)}animationLoop(){if(this.activeAnimations.size===0||!this.isActive)return;const t=performance.now();this.activeAnimations.forEach((e,s)=>{const r=this.calculateScale(e,t);this.applyScale(s,r),r===1&&e.phase==="complete"&&this.activeAnimations.delete(s)}),this.activeAnimations.size>0&&requestAnimationFrame(()=>this.animationLoop())}calculateScale(t,e){const s=e-t.startTime;if(t.phase==="scaleUp"){if(s>=this.popDuration.scaleUp)return t.phase="scaleDown",t.startTime=e,this.popScale;{const r=Math.min(s/this.popDuration.scaleUp,1);return 1+(this.popScale-1)*r}}else if(t.phase==="scaleDown"){if(s>=this.popDuration.scaleDown)return t.phase="complete",1;{const r=Math.min(s/this.popDuration.scaleDown,1);return this.popScale-(this.popScale-1)*r}}return 1}applyScale(t,e){const s=this.tempoElements.get(t);if(!s)return;const r=`scale(${e})`;s.container.style.transform=s.originalTransform+" "+r,s.icon.style.transform=s.originalIconTransform+" "+r;const i=e<this.popScale?"transform 0.08s ease-out":"none";s.container.style.transition=i,s.icon.style.transition=i}updateTempo(){this.isActive&&(this.stop(),this.start())}}const so=new jD,Wi=Io,ps={blend:2,cutoff:31,resonance:0,type:"lowpass"};function qa(){return{coeffs:new Float32Array(Wi).fill(0),phases:new Float32Array(Wi).fill(0)}}function JD(){const n=qa();return n.coeffs[0]=1,n}function ZD(){const n=qa();for(let t=1;t<=Wi;t+=2){const e=t-1;n.coeffs[e]=1/t,n.phases[e]=0}return n}function tk(){const n=qa();for(let t=1;t<=Wi;t+=2){const e=t-1;n.coeffs[e]=1/(t*t),n.phases[e]=Math.PI/2}return n}function ek(){const n=qa();for(let t=1;t<=Wi;t++){const e=t-1;n.coeffs[e]=1/t,n.phases[e]=t&1?0:Math.PI}return n}const nk={strings:{amps:[.995,.94,.425,.48,0,.365,.04,.085,0,.09,0,0],phases:[0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,0]},piano:{amps:[1,.7,.6,.5,.4,.32,.25,.2,.17,.14,.12,.1],phases:Array(12).fill(0)},marimba:{amps:[1,.2,.15,.7,.05,.18,.03,.05,.02,.01,0,0],phases:Array(12).fill(0)},woodwind:{amps:[1,.05,.5,.05,.3,.05,.2,.05,.12,.05,.08,.05],phases:Array(12).fill(0)}};function Nl(n){const t=qa(),e=nk[n];if(!e)return t;const s=Math.min(Wi,e.amps.length);for(let r=0;r<s;r++)t.coeffs[r]=e.amps[r]||0,t.phases[r]=e.phases[r]||0;return t}const dA={attack:.1,decay:.2,sustain:.8,release:.3},sk={sine:{name:"sine",gain:1,adsr:dA,...JD(),filter:{...ps}},triangle:{name:"triangle",gain:.81,adsr:dA,...tk(),filter:{...ps}},square:{name:"square",gain:4/Math.PI,adsr:dA,...ZD(),filter:{...ps}},sawtooth:{name:"sawtooth",gain:2/Math.PI,adsr:dA,...ek(),filter:{...ps}},trapezium:{name:"trapezium",gain:4/Math.PI,adsr:dA,coeffs:new Float32Array([.993,0,.314,0,.168,0,.101,0,.06,0,.033,0]),phases:new Float32Array(Wi).fill(0),filter:{...ps}},impulse:{name:"impulse",gain:.18,adsr:{attack:.01,decay:.3,sustain:0,release:.2},coeffs:new Float32Array([1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0,0]),phases:new Float32Array([0,Math.PI*1.5,Math.PI,Math.PI/2,0,Math.PI*1.5,Math.PI,Math.PI/2,0,Math.PI*1.5,Math.PI,0]),filter:{...ps}},strings:{name:"strings",gain:.49,adsr:{attack:.08,decay:.4,sustain:.7,release:.5},...Nl("strings"),filter:{...ps,cutoff:28}},piano:{name:"piano",gain:.8,adsr:{attack:.01,decay:1.5,sustain:0,release:.4},...Nl("piano"),filter:{...ps,cutoff:28}},marimba:{name:"marimba",gain:.9,adsr:{attack:.01,decay:.8,sustain:0,release:.4},...Nl("marimba"),filter:{...ps,cutoff:25}},woodwind:{name:"woodwind",gain:.6,adsr:{attack:.1,decay:.2,sustain:.8,release:.3},...Nl("woodwind"),filter:{...ps}}};function rk(n,t){Qe(t,!0);let e=null,s=null,r=null,i=null,o=null,A=!1;const a=(b,S=20)=>{const T=parseInt(b.slice(1,3),16),x=parseInt(b.slice(3,5),16),_=parseInt(b.slice(5,7),16),F=Math.max(0,Math.floor(T*(1-S/100))),Q=Math.max(0,Math.floor(x*(1-S/100))),U=Math.max(0,Math.floor(_*(1-S/100)));return`#${F.toString(16).padStart(2,"0")}${Q.toString(16).padStart(2,"0")}${U.toString(16).padStart(2,"0")}`},l=(b,S=50)=>{const T=parseInt(b.slice(1,3),16),x=parseInt(b.slice(3,5),16),_=parseInt(b.slice(5,7),16),F=Math.min(255,Math.floor(T+(255-T)*(S/100))),Q=Math.min(255,Math.floor(x+(255-x)*(S/100))),U=Math.min(255,Math.floor(_+(255-_)*(S/100)));return`#${F.toString(16).padStart(2,"0")}${Q.toString(16).padStart(2,"0")}${U.toString(16).padStart(2,"0")}`};function c(b){const S=Math.round(b),T=e||document.getElementById("tempo-slider");T&&parseInt(T.value,10)!==S&&(T.value=`${S}`);const x=S*2,_=Math.round(S/1.5);s&&s.value!==x&&s.passiveUpdate(x),r&&r.value!==S&&r.passiveUpdate(S),i&&i.value!==_&&i.passiveUpdate(_),f.state.tempo!==S&&(f.setTempo(S),so.updateTempo())}function u(b){if(!b)return;const S=b.closest(".tempo-slider-container");if(!S||S.querySelector(".tempo-slider-marks"))return;const T=[60,90,120,160,200],x=document.createElement("div");x.className="tempo-slider-marks",S.appendChild(x);const _=Number(b.min)||0,F=Number(b.max)||1,Q=Math.max(F-_,1),U=[],W=()=>{const N=b.getBoundingClientRect().height||b.clientHeight,q=getComputedStyle(b),J=parseFloat(q.getPropertyValue("--slider-thumb-size"))||0,nt=parseFloat(q.getPropertyValue("--slider-thumb-border"))||0,At=J+nt*2,ot=Math.max(N-At,1),V=At/2;U.forEach(({el:H,bpm:G})=>{if(G<_||G>F){H.style.display="none";return}H.style.display="";const Y=(G-_)/Q,P=V+ot*Y;H.style.bottom=`${P}px`})};T.forEach(R=>{const N=document.createElement("span");N.className="tempo-slider-mark",N.setAttribute("aria-hidden","true"),x.appendChild(N),U.push({el:N,bpm:R})}),W(),new ResizeObserver(W).observe(b)}function d(b){if(!b||!o)return;const S=f.state.timbres[b],T=f.state.colorPalette[b]||{primary:b,light:b},x=T.light,_=T.primary;document.querySelectorAll(".preset-button").forEach(Q=>{const U=Q,W=U.id.replace("preset-",""),L=(S==null?void 0:S.activePresetName)===W;U.classList.toggle("selected",L)});const F=l(x,60);o.style.setProperty("--c-accent",_),o.style.setProperty("--c-accent-light",F),o.style.setProperty("--c-accent-hover",a(_,20))}function p(){A=!0,so.start()}function h(){A=!0,so.start()}function m(b){const S=b.target,T=S?parseInt(S.value,10):NaN;c(T)}function g(){e==null||e.blur()}function v(){A&&(A=!1,so.stop())}function w(){A&&(A=!1,so.stop())}function y(){A&&(A=!1,so.stop())}function I(b){var S;(S=b==null?void 0:b.newNote)!=null&&S.color?d(b.newNote.color):(document.querySelectorAll(".preset-button").forEach(T=>T.classList.remove("selected")),o&&(o.style.setProperty("--c-accent","#4A90E2"),o.style.setProperty("--c-accent-hover","#357ABD")))}function B(b){var S;b&&b===((S=f.state.selectedNote)==null?void 0:S.color)&&d(b)}function C(b){b!==void 0&&c(b)}Os(()=>{var T;e=document.getElementById("tempo-slider"),o=document.querySelector(".preset-effects-container");const b={size:[45,24],step:1,decimalPlaces:0,useAppStyling:!0};s=new Rd("#eighth-note-tempo",{...b,value:180,min:60,max:480}),r=new Rd("#quarter-note-tempo",{...b,value:90,min:30,max:240}),i=new Rd("#dotted-quarter-tempo",{...b,value:60,min:20,max:160}),s.on("change",x=>{!isNaN(x)&&x>0&&c(x/2)}),r.on("change",x=>{!isNaN(x)&&x>0&&c(x)}),i.on("change",x=>{!isNaN(x)&&x>0&&c(x*1.5)}),c(f.state.tempo),e?(u(e),e.addEventListener("mousedown",p),e.addEventListener("touchstart",h),e.addEventListener("input",m),e.addEventListener("mouseup",g),c(f.state.tempo)):E.warn("AudioControlsBridge","Tempo slider not found - will initialize when rhythm tab is opened",null,"toolbar"),document.addEventListener("mouseup",v),document.addEventListener("touchend",w),document.addEventListener("touchcancel",y),document.querySelectorAll(".preset-button").forEach(x=>{const _=x,F=_.id.replace("preset-",""),Q=sk[F];Q&&_.addEventListener("click",()=>{var W;const U=(W=f.state.selectedNote)==null?void 0:W.color;U&&(f.applyPreset(U,Q),setTimeout(()=>d(U),10)),_.blur()})}),f.on("noteChanged",I),f.on("timbreChanged",B),f.on("tempoChanged",C);const S=(T=f.state.selectedNote)==null?void 0:T.color;S&&d(S),console.log("[Svelte] AudioControlsBridge mounted")}),si(()=>{e==null||e.removeEventListener("mousedown",p),e==null||e.removeEventListener("touchstart",h),e==null||e.removeEventListener("input",m),e==null||e.removeEventListener("mouseup",g),document.removeEventListener("mouseup",v),document.removeEventListener("touchend",w),document.removeEventListener("touchcancel",y),console.log("[Svelte] AudioControlsBridge unmounted")}),Ue()}function ik(n,t){Qe(t,!0);const e="selectedTab",s="selectedPresetTab",r="timbre",i="presets";function o(V){try{localStorage.setItem(e,V),E.debug("TabManagement",`Saved tab to localStorage: ${V}`,void 0,"ui")}catch(H){E.warn("TabManagement","Failed to save tab to localStorage",H,"ui")}}function A(){try{return localStorage.getItem(e)||r}catch(V){return E.warn("TabManagement","Failed to read tab from localStorage",V,"ui"),r}}function a(V){try{localStorage.setItem(s,V),E.debug("TabManagement",`Saved preset tab to localStorage: ${V}`,void 0,"ui")}catch(H){E.warn("TabManagement","Failed to save preset tab to localStorage",H,"ui")}}function l(){try{return localStorage.getItem(s)||i}catch(V){return E.warn("TabManagement","Failed to read preset tab from localStorage",V,"ui"),i}}let c=null,u=null,d=null;const p=new Map,h=new Map,m=new Map,g=[{label:"effectsPanelActive",selector:"#effects-panel.preset-tab-panel.active"},{label:"effectsPanel",selector:"#effects-panel"},{label:"effectsContentBox",selector:"#effects-panel .effects-content-box"},{label:"presetsPanelActive",selector:"#presets-panel.preset-tab-panel.active"},{label:"presetsPanel",selector:"#presets-panel"},{label:"presetContentBox",selector:"#presets-panel .preset-content-box"},{label:"presetEffectsContent",selector:".preset-effects-content"},{label:"presetEffectsControls",selector:".preset-effects-controls"},{label:"presetEffectsContainer",selector:".preset-effects-container"},{label:"presetEffectsTabs",selector:".preset-effects-tabs"}];let v=null,w=null;const y=new Map;let I=null,B="",C=!1,b=null;function S(V,H){if(!V)return{selector:H,missing:!0};const G=V,Y=G.getBoundingClientRect(),P=window.getComputedStyle(G),st=G.parentElement,D=st==null?void 0:st.getBoundingClientRect(),K=st?window.getComputedStyle(st):null;return{selector:H,tag:G.tagName.toLowerCase(),id:G.id||null,className:G.className||null,rectWidth:Number(Y.width.toFixed(1)),rectHeight:Number(Y.height.toFixed(1)),offsetWidth:G.offsetWidth,clientWidth:G.clientWidth,scrollWidth:G.scrollWidth,computed:{display:P.display,position:P.position,width:P.width,minWidth:P.minWidth,maxWidth:P.maxWidth,flex:P.flex,flexGrow:P.flexGrow,flexShrink:P.flexShrink,flexBasis:P.flexBasis,alignSelf:P.alignSelf,alignItems:P.alignItems,justifyContent:P.justifyContent,justifySelf:P.justifySelf,gap:P.gap,boxSizing:P.boxSizing,paddingLeft:P.paddingLeft,paddingRight:P.paddingRight,borderLeftWidth:P.borderLeftWidth,borderRightWidth:P.borderRightWidth,overflowX:P.overflowX,overflowY:P.overflowY},parent:st?{tag:st.tagName.toLowerCase(),id:st.id||null,className:st.className||null,rectWidth:Number(((D==null?void 0:D.width)||0).toFixed(1)),computedWidth:K==null?void 0:K.width,display:K==null?void 0:K.display,flex:K==null?void 0:K.flex}:null}}function T(V){const H=Array.from(document.querySelectorAll(V));return{selector:V,count:H.length,entries:H.map((G,Y)=>({index:Y,...S(G,V)}))}}function x(V,H,G=4){if(!V)return{selector:H,missing:!0,chain:[]};const Y=[];let P=V,st=0;for(;P&&st<G;){const D=P.getBoundingClientRect(),K=window.getComputedStyle(P);Y.push({tag:P.tagName.toLowerCase(),id:P.id||null,className:P.className||null,rectWidth:Number(D.width.toFixed(1)),offsetWidth:P.offsetWidth,clientWidth:P.clientWidth,computed:{display:K.display,width:K.width,minWidth:K.minWidth,maxWidth:K.maxWidth,flex:K.flex,flexGrow:K.flexGrow,flexShrink:K.flexShrink,flexBasis:K.flexBasis,alignItems:K.alignItems,justifyContent:K.justifyContent,alignSelf:K.alignSelf,boxSizing:K.boxSizing,paddingLeft:K.paddingLeft,paddingRight:K.paddingRight,gap:K.gap}}),P=P.parentElement,st+=1}return{selector:H,missing:!1,chain:Y}}function _(V){const H=Object.keys(V.elements).sort(),G={activePresetTab:V.activePresetTab,activePresetPanelId:V.activePresetPanelId};return H.forEach(Y=>{const P=V.elements[Y];if(!P||P.missing){G[Y]="missing";return}G[Y]={rectWidth:P.rectWidth,rectHeight:P.rectHeight,offsetWidth:P.offsetWidth,clientWidth:P.clientWidth,scrollWidth:P.scrollWidth}}),JSON.stringify(G)}function F(V,H,G,Y){if(H.missing||Y.missing)return{pair:`${V} vs ${G}`,missing:!0};const P=["rectWidth","offsetWidth","clientWidth","scrollWidth"],st=["display","position","width","minWidth","maxWidth","flex","alignSelf","boxSizing","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","overflowX","overflowY"],D=["computedWidth","display","flex"],K=[];return P.forEach(O=>{const X=H[O],tt=Y[O];X!==tt&&K.push({property:O,[V]:X,[G]:tt})}),st.forEach(O=>{var k,z;const X=(k=H.computed)==null?void 0:k[O],tt=(z=Y.computed)==null?void 0:z[O];X!==tt&&K.push({property:`computed.${O}`,[V]:X,[G]:tt})}),D.forEach(O=>{var k,z;const X=(k=H.parent)==null?void 0:k[O],tt=(z=Y.parent)==null?void 0:z[O];X!==tt&&K.push({property:`parent.${O}`,[V]:X,[G]:tt})}),{pair:`${V} vs ${G}`,missing:!1,differences:K}}function Q(V){C&&(B=B?`${B}; ${V}`:V,I===null&&(I=requestAnimationFrame(()=>{const H=B||"auto";I=null,B="",R(H)})))}function U(){v&&g.forEach(V=>{document.querySelectorAll(V.selector).forEach(H=>{y.has(H)||(y.set(H,V.label),v.observe(H))})})}function W(){v||(C=!0,b=null,v=new ResizeObserver(V=>{const H=V.map(G=>y.get(G.target)||G.target.id||G.target.tagName.toLowerCase()).filter(Boolean);H.length&&Q(`Resize: ${H.join(", ")}`)}),w=new MutationObserver(()=>U()),document.body?w.observe(document.body,{childList:!0,subtree:!0}):document.addEventListener("DOMContentLoaded",()=>{w==null||w.observe(document.body,{childList:!0,subtree:!0}),U(),Q("init")},{once:!0}),window.addEventListener("resize",()=>Q("window resize")),U(),Q("init"))}function L(){C=!1,b=null,v&&(v.disconnect(),v=null),w&&(w.disconnect(),w=null),y.clear(),I!==null&&(cancelAnimationFrame(I),I=null),B=""}function R(V){requestAnimationFrame(()=>{var it;const H=document.querySelector(".preset-tab-button.active"),G=document.querySelector(".preset-tab-panel.active"),Y=S(document.querySelector("#effects-panel.preset-tab-panel.active"),"#effects-panel.preset-tab-panel.active"),P=S(document.getElementById("effects-panel"),"#effects-panel"),st=S(document.querySelector("#effects-panel .effects-content-box"),"#effects-panel .effects-content-box"),D=S(document.querySelector("#presets-panel.preset-tab-panel.active"),"#presets-panel.preset-tab-panel.active"),K=S(document.getElementById("presets-panel"),"#presets-panel"),O=S(document.querySelector("#presets-panel .preset-content-box"),"#presets-panel .preset-content-box"),X=S(document.querySelector(".preset-effects-content"),".preset-effects-content"),tt=S(document.querySelector(".preset-effects-controls"),".preset-effects-controls"),k=S(document.querySelector(".preset-effects-container"),".preset-effects-container"),z=S(document.querySelector(".preset-effects-tabs"),".preset-effects-tabs"),$={reason:V,activePresetTab:((it=H==null?void 0:H.dataset)==null?void 0:it.presetTab)||null,activePresetPanelId:(G==null?void 0:G.id)||null,elements:{effectsPanelActive:Y,effectsPanel:P,effectsContentBox:st,presetsPanelActive:D,presetsPanel:K,presetContentBox:O,presetEffectsContent:X,presetEffectsControls:tt,presetEffectsContainer:k,presetEffectsTabs:z},comparisons:{activePanelVsEffectsContent:F("effectsPanelActive",Y.missing?P:Y,"effectsContentBox",st),panelVsEffectsContent:F("effectsPanel",P,"effectsContentBox",st),contentBoxes:F("effectsContentBox",st,"presetContentBox",O),panels:F("effectsPanel",P,"presetsPanel",K),tabsVsEffectsContent:F("presetEffectsTabs",z,"effectsContentBox",st)},chains:{effectsPanelActive:x(document.querySelector("#effects-panel.preset-tab-panel.active"),"#effects-panel.preset-tab-panel.active"),effectsContentBox:x(document.querySelector("#effects-panel .effects-content-box"),"#effects-panel .effects-content-box"),presetEffectsContent:x(document.querySelector(".preset-effects-content"),".preset-effects-content")},lists:{presetTabButtons:T(".preset-effects-tabs .preset-tab-button")}},rt=_($);(V.startsWith("Resize")||V==="auto"||V==="init"||V==="window resize")&&rt===b||(b=rt,console.groupCollapsed(`[Sizing] Preset/Effects widths (${V})`),console.log($),console.groupEnd())})}function N(V){window.enablePresetEffectsSizingDiagnostics&&R(V)}function q(){const V=A();document.querySelectorAll(".tab-button").forEach(Y=>Y.classList.remove("active")),document.querySelectorAll(".tab-panel").forEach(Y=>Y.classList.remove("active"));const H=document.querySelector(`[data-tab="${V}"]`),G=document.getElementById(`${V}-panel`);H&&G?(H.classList.add("active"),G.classList.add("active"),V==="rhythm"&&setTimeout(()=>{const Y=window.initTempoSliderIfNeeded;typeof Y=="function"&&Y()},200)):E.warn("TabManagement",`Could not restore tab: ${V}. Tab button or panel not found.`)}function J(){const V=l();document.querySelectorAll(".preset-tab-button:not([disabled])").forEach(Y=>Y.classList.remove("active")),document.querySelectorAll(".preset-tab-panel").forEach(Y=>Y.classList.remove("active"));const H=document.querySelector(`[data-preset-tab="${V}"]`),G=document.getElementById(`${V}-panel`);if(H&&G&&!H.hasAttribute("disabled")){H.classList.add("active"),G.classList.add("active");const Y=document.querySelector(".harmonic-bins-container");Y&&(V==="effects"?Y.style.display="none":Y.style.display="flex")}else E.warn("TabManagement",`Could not restore preset tab: ${V}. Tab button or panel not found.`);N("restore preset tab")}function nt(){q(),c=document.querySelectorAll(".tab-button"),c.forEach(V=>{const H=()=>{const G=V.dataset.tab;if(!G)return;document.querySelectorAll(".tab-button").forEach(P=>P.classList.remove("active")),V.classList.add("active"),document.querySelectorAll(".tab-panel").forEach(P=>P.classList.remove("active"));const Y=document.getElementById(`${G}-panel`);Y&&Y.classList.add("active"),o(G),G==="rhythm"&&setTimeout(()=>{const P=window.initTempoSliderIfNeeded;typeof P=="function"&&P()},50)};V.addEventListener("click",H),p.set(V,H)}),E.info("TabManagementBridge","Main tabs initialized",null,"ui")}function At(){J(),u=document.querySelectorAll(".preset-tab-button"),u.forEach(V=>{const H=()=>{const G=V.dataset.presetTab;if(!G)return;document.querySelectorAll(".preset-tab-button:not([disabled])").forEach(st=>st.classList.remove("active")),V.classList.add("active"),document.querySelectorAll(".preset-tab-panel").forEach(st=>st.classList.remove("active"));const Y=document.getElementById(`${G}-panel`);Y&&Y.classList.add("active"),a(G);const P=document.querySelector(".harmonic-bins-container");P&&(G==="effects"?P.style.display="none":P.style.display="flex"),N(`preset tab click: ${G}`)};V.addEventListener("click",H),h.set(V,H)}),E.info("TabManagementBridge","Preset tabs initialized",null,"ui")}function ot(){d=document.querySelectorAll(".pitch-tab-button"),d.forEach(V=>{const H=()=>{const G=V.dataset.pitchTab;if(!G)return;document.querySelectorAll(".pitch-tab-button").forEach(P=>P.classList.remove("active")),V.classList.add("active"),document.querySelectorAll(".pitch-tab-panel").forEach(P=>P.classList.remove("active"));const Y=document.getElementById(`${G}-panel`);Y&&Y.classList.add("active")};V.addEventListener("click",H),m.set(V,H)}),E.info("TabManagementBridge","Pitch tabs initialized",null,"ui")}Qn(()=>(nt(),At(),ot(),window.logPresetEffectsSizing=(V="manual")=>{R(V)},window.enablePresetEffectsSizingAutoLog=()=>{window.enablePresetEffectsSizingDiagnostics=!0,W()},window.disablePresetEffectsSizingAutoLog=()=>{window.enablePresetEffectsSizingDiagnostics=!1,L()},window.enablePresetEffectsSizingDiagnostics&&W(),console.log("[Svelte 5] TabManagementBridge mounted"),()=>{p.forEach((V,H)=>{H.removeEventListener("click",V)}),p.clear(),h.forEach((V,H)=>{H.removeEventListener("click",V)}),h.clear(),m.forEach((V,H)=>{H.removeEventListener("click",V)}),m.clear(),L(),console.log("[Svelte 5] TabManagementBridge unmounted")})),Ue()}function ok(n,t){Qe(t,!0);const e=16,s={letter:{width:8.5,height:11},"11x14":{width:11,height:14},"11x17":{width:11,height:17}};let r=null,i=null,o=null,A=null,a=null,l=null,c=null,u=null,d=null,p=null,h=null,m=null,g=null,v=!1,w=null;const y=20,I=5;let B=null,C=null;function b(){f.state.isPrintPreviewActive||f.setPrintPreviewActive(!0),r==null||r.classList.remove("hidden");const O=et=>et?getComputedStyle(et).display!=="none":!1,X=f.state.printOptions.pageSize,tt=X&&X in s?X:"letter",k=O(document.getElementById("button-grid")),z=O(document.getElementById("drum-grid-wrapper")),$=O(document.getElementById("legend-left-canvas")),rt=O(document.getElementById("legend-right-canvas"));f.setPrintOptions({pageSize:tt,cropTop:0,cropBottom:1,cropLeft:0,cropRight:1,includeButtonGrid:k,includeDrums:z,includeLeftLegend:$,includeRightLegend:rt}),k&&Zl.prefetchButtonGridSnapshot($,rt),_()}function S(){f.state.isPrintPreviewActive&&f.setPrintPreviewActive(!1),r==null||r.classList.add("hidden")}function T(O,X){const k=f.state.printOptions[O]===X[0]?X[1]:X[0];f.setPrintOptions({[O]:k})}function x(){if([u,d,p,h,m,g].some(at=>at===null))return;const X=f.state.printOptions.pageSize,tt=X&&X in s?X:"letter",{orientation:k,colorMode:z,includeButtonGrid:$,includeDrums:rt,includeLeftLegend:et,includeRightLegend:it}=f.state.printOptions;c&&(c.value=tt),u&&(u.textContent=k.charAt(0).toUpperCase()+k.slice(1)),d&&(d.textContent=z==="color"?"Color":"B&W",d.classList.toggle("active",z==="color")),p&&(p.textContent=$?"Include":"Exclude",p.classList.toggle("active",$)),h&&(h.textContent=rt?"Include":"Exclude",h.classList.toggle("active",rt)),m&&(m.textContent=et?"Include":"Exclude",m.classList.toggle("active",et)),g&&(g.textContent=it?"Include":"Exclude",g.classList.toggle("active",it))}async function _(){if(!f.state.isPrintPreviewActive||!i||!o)return;x();const O=(l==null?void 0:l.clientWidth)??0,X=(l==null?void 0:l.clientHeight)??0;if(O===0||X===0)return;const{orientation:tt}=f.state.printOptions,k=f.state.printOptions.pageSize,z=k&&k in s?k:"letter",$=s[z],rt=tt==="landscape"?$.height:$.width,et=tt==="landscape"?$.width:$.height,it=.25,at=rt/et,Ct=e*2;let yt=Math.max(O-Ct,100),Bt=Math.max(X-Ct,100);yt/Bt>at?yt=Bt*at:Bt=yt/at;const Et=it/rt*yt,Qt=yt-2*Et,ct=Bt-2*Et,gt={...f.state.printOptions,cropTop:0,cropBottom:1,cropLeft:0,cropRight:1},mt=await Zl.generateScoreCanvas(gt,{width:Qt,height:ct});if(!mt)return;i.width=yt,i.height=Bt,o.fillStyle="#FFFFFF",o.fillRect(0,0,yt,Bt),o.strokeStyle="#E0E0E0",o.lineWidth=1,o.strokeRect(Et,Et,Qt,ct);const Ot=Et+Math.max(0,(Qt-mt.width)/2),ve=Et+Math.max(0,(ct-mt.height)/2);o.drawImage(mt,Ot,ve),F(Et,Qt,ct),Q(yt,Bt,{contentTop:ve,contentLeft:Ot,contentWidth:mt.width,contentHeight:mt.height})}function F(O,X,tt){if(!o)return;o.strokeStyle="#CCCCCC",o.lineWidth=1;const k=10,z=O+X,$=O+tt;o.beginPath(),o.moveTo(O,O-k),o.lineTo(O,O+k),o.moveTo(O-k,O),o.lineTo(O+k,O),o.moveTo(z,O-k),o.lineTo(z,O+k),o.moveTo(z-k,O),o.lineTo(z+k,O),o.moveTo(O,$-k),o.lineTo(O,$+k),o.moveTo(O-k,$),o.lineTo(O+k,$),o.moveTo(z,$-k),o.lineTo(z,$+k),o.moveTo(z-k,$),o.lineTo(z+k,$),o.stroke()}function Q(O,X,tt){const k=i==null?void 0:i.getBoundingClientRect(),z=l==null?void 0:l.getBoundingClientRect();if(!k||!z||!A||!a)return;A.width=O,A.height=X,A.style.left=`${k.left-z.left}px`,A.style.top=`${k.top-z.top}px`,A.style.width=`${O}px`,A.style.height=`${X}px`;const{cropTop:$,cropBottom:rt,cropLeft:et,cropRight:it}=f.state.printOptions,{contentTop:at,contentLeft:Ct,contentHeight:yt,contentWidth:Bt}=tt,Et=at+$*yt,Qt=at+rt*yt,ct=Ct+et*Bt,gt=Ct+it*Bt,mt=at+yt,Ot=Ct+Bt;a.clearRect(0,0,O,X),a.fillStyle="rgba(0, 0, 0, 0.5)",$>0&&a.fillRect(Ct,at,Bt,Et-at),rt<1&&a.fillRect(Ct,Qt,Bt,mt-Qt),et>0&&a.fillRect(Ct,Et,ct-Ct,Qt-Et),it<1&&a.fillRect(gt,Et,Ot-gt,Qt-Et),U(Et,Ct,Ot,"top"),U(Qt,Ct,Ot,"bottom"),W(ct,at,mt,"left"),W(gt,at,mt,"right"),B={pageWidth:O,pageHeight:X,contentTop:at,contentLeft:Ct,contentHeight:yt,contentWidth:Bt,cropTopY:Et,cropBottomY:Qt,cropLeftX:ct,cropRightX:gt}}function U(O,X,tt,k){if(!a)return;const z=60,$=tt-X,rt=X+($-z)/2,et=k==="top"?O-y-4:O+4;a.fillStyle="#4a90e2",a.fillRect(X,O-1,$,2),a.fillRect(rt,et,z,y),a.strokeStyle="#FFFFFF",a.lineWidth=2,a.strokeRect(rt,et,z,y),a.strokeStyle="#FFFFFF",a.lineWidth=1;const it=3,at=6,Ct=30,yt=X+($-Ct)/2;for(let Bt=0;Bt<it;Bt++){const Et=et+y/2+(Bt-1)*at;a.beginPath(),a.moveTo(yt,Et),a.lineTo(yt+Ct,Et),a.stroke()}}function W(O,X,tt,k){if(!a)return;const z=60,$=tt-X,rt=X+($-z)/2,et=k==="left"?O-y-4:O+4;a.fillStyle="#4a90e2",a.fillRect(O-1,X,2,$),a.fillRect(et,rt,y,z),a.strokeStyle="#FFFFFF",a.lineWidth=2,a.strokeRect(et,rt,y,z),a.strokeStyle="#FFFFFF",a.lineWidth=1;const it=3,at=6,Ct=30,yt=X+($-Ct)/2;for(let Bt=0;Bt<it;Bt++){const Et=et+y/2+(Bt-1)*at;a.beginPath(),a.moveTo(Et,yt),a.lineTo(Et,yt+Ct),a.stroke()}}function L(O){if(!B||!A)return;const X=A.getBoundingClientRect(),tt=O.clientX-X.left,k=O.clientY-X.top,z=tt>=B.contentLeft&&tt<=B.contentLeft+B.contentWidth,$=k>=B.contentTop&&k<=B.contentTop+B.contentHeight,rt=z&&Math.abs(k-B.cropTopY)<y+I,et=z&&Math.abs(k-B.cropBottomY)<y+I,it=$&&Math.abs(tt-B.cropLeftX)<y+I,at=$&&Math.abs(tt-B.cropRightX)<y+I;rt?(v=!0,w="top",A.style.cursor="ns-resize"):et?(v=!0,w="bottom",A.style.cursor="ns-resize"):it?(v=!0,w="left",A.style.cursor="ew-resize"):at&&(v=!0,w="right",A.style.cursor="ew-resize")}function R(O){if(!B||!A)return;const X=A.getBoundingClientRect(),tt=O.clientX-X.left,k=O.clientY-X.top;if(v&&w){N(tt,k);return}const z=tt>=B.contentLeft&&tt<=B.contentLeft+B.contentWidth,$=k>=B.contentTop&&k<=B.contentTop+B.contentHeight,rt=z&&Math.abs(k-B.cropTopY)<y+I,et=z&&Math.abs(k-B.cropBottomY)<y+I,it=$&&Math.abs(tt-B.cropLeftX)<y+I,at=$&&Math.abs(tt-B.cropRightX)<y+I;rt||et?A.style.cursor="ns-resize":it||at?A.style.cursor="ew-resize":A.style.cursor="default"}function N(O,X){if(!B)return;const{contentTop:tt,contentLeft:k,contentHeight:z,contentWidth:$}=B,rt=.05;if(w==="top"){const et=Math.max(0,Math.min(1,(X-tt)/z)),it=f.state.printOptions.cropBottom;et<it-rt&&f.setPrintOptions({cropTop:et})}else if(w==="bottom"){const et=Math.max(0,Math.min(1,(X-tt)/z)),it=f.state.printOptions.cropTop;et>it+rt&&f.setPrintOptions({cropBottom:et})}else if(w==="left"){const et=Math.max(0,Math.min(1,(O-k)/$)),it=f.state.printOptions.cropRight;et<it-rt&&f.setPrintOptions({cropLeft:et})}else if(w==="right"){const et=Math.max(0,Math.min(1,(O-k)/$)),it=f.state.printOptions.cropLeft;et>it+rt&&f.setPrintOptions({cropRight:et})}}function q(){v=!1,w=null,A&&(A.style.cursor="default")}function J(){S()}function nt(){Zl.generateAndPrint(),S()}function At(){T("orientation",["landscape","portrait"])}function ot(){T("colorMode",["color","bw"])}function V(){T("includeButtonGrid",[!0,!1])}function H(){T("includeDrums",[!0,!1])}function G(){T("includeLeftLegend",[!0,!1])}function Y(){T("includeRightLegend",[!0,!1])}function P(){if(!c)return;const O=c.value;O in s&&f.setPrintOptions({pageSize:O})}function st(O){O!==void 0&&(O?b():S())}function D(){_()}function K(){f.state.isPrintPreviewActive&&_()}Os(()=>{var O,X;r=document.getElementById("print-preview-overlay"),i=document.getElementById("print-preview-canvas"),o=(i==null?void 0:i.getContext("2d"))??null,A=document.getElementById("print-crop-overlay"),a=(A==null?void 0:A.getContext("2d"))??null,l=(i==null?void 0:i.parentElement)??null,c=document.getElementById("print-page-size"),u=document.getElementById("print-orientation-toggle"),d=document.getElementById("print-color-mode-toggle"),p=document.getElementById("print-button-grid-toggle"),h=document.getElementById("print-drum-grid-toggle"),m=document.getElementById("print-left-legend-toggle"),g=document.getElementById("print-right-legend-toggle"),(O=document.getElementById("print-close-button"))==null||O.addEventListener("click",J),(X=document.getElementById("print-confirm-button"))==null||X.addEventListener("click",nt),u==null||u.addEventListener("click",At),d==null||d.addEventListener("click",ot),p==null||p.addEventListener("click",V),h==null||h.addEventListener("click",H),m==null||m.addEventListener("click",G),g==null||g.addEventListener("click",Y),c==null||c.addEventListener("change",P),A==null||A.addEventListener("mousedown",L),A==null||A.addEventListener("mousemove",R),A==null||A.addEventListener("mouseup",q),A==null||A.addEventListener("mouseleave",q),f.on("printPreviewStateChanged",st),f.on("printOptionsChanged",D),f.on("notesChanged",K),l&&(C=new ResizeObserver(()=>{f.state.isPrintPreviewActive&&_()}),C.observe(l)),console.log("[Svelte] PrintPreviewBridge mounted")}),si(()=>{var O,X;(O=document.getElementById("print-close-button"))==null||O.removeEventListener("click",J),(X=document.getElementById("print-confirm-button"))==null||X.removeEventListener("click",nt),u==null||u.removeEventListener("click",At),d==null||d.removeEventListener("click",ot),p==null||p.removeEventListener("click",V),h==null||h.removeEventListener("click",H),m==null||m.removeEventListener("click",G),g==null||g.removeEventListener("click",Y),c==null||c.removeEventListener("change",P),A==null||A.removeEventListener("mousedown",L),A==null||A.removeEventListener("mousemove",R),A==null||A.removeEventListener("mouseup",q),A==null||A.removeEventListener("mouseleave",q),C==null||C.disconnect(),console.log("[Svelte] PrintPreviewBridge unmounted")}),Ue()}const Hd={stroke:"#c7cfd8",background:"rgba(207, 214, 222, 0.32)"};let Ll=null;function UC(){if(Ll)return Ll;if(typeof window>"u")return Hd;const n=window.getComputedStyle(document.documentElement);return Ll={stroke:n.getPropertyValue("--c-anacrusis-border").trim()||Hd.stroke,background:n.getPropertyValue("--c-anacrusis-bg").trim()||Hd.background},Ll}function Ak(n){if(n.length===0)return[];const t=[...n].sort((s,r)=>s.start-r.start),e=[];for(const s of t){if(e.length===0){e.push({...s});continue}const r=e[e.length-1];s.start<=r.end?r.end=Math.max(r.end,s.end):e.push({...s})}return e}function ak(n){const t=[],e=ck(f.state);return e!==null&&e>0&&t.push({start:vi(0,n),end:vi(e,n)}),n.placedTonicSigns.forEach(s=>{const r=vi(s.columnIndex,n),i=vi(s.columnIndex+2,n);t.push({start:r,end:i})}),Ak(t)}function lk(n,t,e){const s=new Set([n,t]);e.forEach(o=>{const A=Math.max(n,Math.min(t,o.start)),a=Math.max(n,Math.min(t,o.end));a>A&&(s.add(A),s.add(a))});const r=Array.from(s).sort((o,A)=>o-A),i=[];for(let o=0;o<r.length-1;o++){const A=r[o],a=r[o+1],l=(A+a)/2,c=e.some(u=>l>=u.start&&l<u.end);a>A&&i.push({from:A,to:a,light:c})}return i}function ck(n){if(!n.hasAnacrusis||!Array.isArray(n.macrobeatBoundaryStyles))return null;const t=n.macrobeatBoundaryStyles.findIndex(s=>s==="solid");if(t<0)return null;const e=mn(n,t);return e?e.endColumn+1:null}function vi(n,t){return lt(n,t)}function PC(n,t,e,s,r,i,o=1){const A=e+r/2,a=s+i/2,l=Math.min(r,i)*.4*o;if(n.beginPath(),t===0)n.moveTo(A,a-l),n.lineTo(A-l,a+l),n.lineTo(A+l,a+l),n.closePath();else if(t===1)n.moveTo(A,a-l),n.lineTo(A+l,a),n.lineTo(A,a+l),n.lineTo(A-l,a),n.closePath();else{for(let u=0;u<5;u++){const d=2*Math.PI/5*u-Math.PI/2,p=A+l*Math.cos(d),h=a+l*Math.sin(d);u===0?n.moveTo(p,h):n.lineTo(p,h)}n.closePath()}n.fill()}function uk(n,t){const{columnWidths:e,musicalColumnWidths:s,macrobeatGroupings:r,macrobeatBoundaryStyles:i,placedTonicSigns:o}=t,a=(s&&s.length>0?s:e).length,l=r.map((c,u)=>{const{endColumn:d}=mn(f.state,u);return d+1});for(let c=0;c<=a;c++){const u=c===0||c===a,d=o2(c,o),p=o.some(w=>c===w.columnIndex+2),h=l.includes(c);if(!A2(c,o))continue;let g=null;if(u||d||p)g={lineWidth:2,strokeStyle:"#adb5bd",dash:[]};else if(h){const w=l.indexOf(c),y=i[w];if(y==="anacrusis"){const{stroke:I}=UC();g={lineWidth:1,strokeStyle:I,dash:[4,4]}}else g={lineWidth:1,strokeStyle:"#adb5bd",dash:y==="solid"?[]:[5,5]}}if(!g)continue;const v=vi(c,t);n.beginPath(),n.moveTo(v,0),n.lineTo(v,ie(n.canvas)),n.lineWidth=g.lineWidth,n.strokeStyle=g.strokeStyle,n.setLineDash(g.dash),n.stroke()}n.setLineDash([])}function dk(n,t){const{placedNotes:e,columnWidths:s,cellWidth:r,cellHeight:i,placedTonicSigns:o}=t;n.clearRect(0,0,$e(n.canvas),ie(n.canvas));const A=Math.max(ra,ia*i),a=s.length,l=["H","M","L"],c=ak(t),u=lk(0,$e(n.canvas),c),{stroke:d}=UC();for(let p=0;p<4;p++){const h=p*A;u.forEach(m=>{m.to<=m.from||(n.beginPath(),n.moveTo(m.from,h),n.lineTo(m.to,h),n.strokeStyle=m.light?d:"#ced4da",n.lineWidth=1,n.globalAlpha=m.light?.6:1,n.stroke(),n.globalAlpha=1)})}uk(n,t);for(let p=0;p<a;p++){if(o.some(g=>p===g.columnIndex||p===g.columnIndex+1))continue;const h=vi(p,t);let m;t.tempoModulationMarkers&&t.tempoModulationMarkers.length>0?m=vi(p+1,t)-h:m=(s[p]??0)*r;for(let g=0;g<3;g++){const v=g*A,w=l[g],y=e.find(I=>I.isDrum&&(typeof I.drumTrack=="number"?String(I.drumTrack):I.drumTrack)===w&&I.startColumnIndex===p);if(y){n.fillStyle=y.color;const I=Ar.getAnimationScale(p,w);PC(n,g,h,v,m,A,I)}else n.fillStyle="#ced4da",n.beginPath(),n.arc(h+m/2,v+A/2,2,0,Math.PI*2),n.fill()}}t.tempoModulationMarkers&&t.tempoModulationMarkers.length>0&&b2(n,t)}const Ps={getColumnIndex(n){const{cellWidth:t,tempoModulationMarkers:e,cellHeight:s,musicalColumnWidths:r}=f.state,i=f.state.columnWidths||[];if(t===0)return 0;const o={...f.state,tempoModulationMarkers:e,cellWidth:t,columnWidths:i,baseMicrobeatPx:f.state.baseMicrobeatPx||t},A=dh(n,o),a=Math.floor(A);return a},getPitchRowIndex(n){const t=qe.getViewportInfo();if(!(t!=null&&t.halfUnit)||t.halfUnit===0)return-1;const e=t.halfUnit,s=Math.round(n/e-1),r=t.startRank+s,i=t.startRank,o=Math.max(i,(t.endRank??i+1)-1);return Math.max(i,Math.min(o,r))},getDrumRowIndex(n){const t=Math.max(ra,ia*f.state.cellHeight);return t===0?-1:Math.floor(n/t)}},qp=["H","M","L"],hk="canvas-container",fk="drum-grid-wrapper",NC="eraser-tool-button",pk="drum-grid",mk="drum-hover-canvas";let dn=null,qc=!1,wa=!1,Ac=1,Ks=null,$0=0;const gk=500,vk=()=>T0()?!0:(F5(),!!T0()),LC=(n,t=0)=>{var r;const e=()=>{vk()&&T5(n,be()+t)},s=(r=window.initAudio)==null?void 0:r.call(window);if(s&&typeof s.then=="function"){s.then(e).catch(()=>{});return}e()},zc=n=>{f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths:f.state.columnWidths;const t={tempoModulationMarkers:f.state.tempoModulationMarkers||[],columnWidths:f.state.columnWidths,cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,baseMicrobeatPx:f.state.baseMicrobeatPx||f.state.cellWidth||40};return lt(n,t)},DC=n=>{if(f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0){const r=zc(n);return zc(n+1)-r}return((f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths:f.state.columnWidths)[n]??1)*f.state.cellWidth},$c=()=>Math.max(ra,ia*f.state.cellHeight),zp=()=>{dn&&dn.clearRect(0,0,$e(dn.canvas),ie(dn.canvas))};function uf(n,t,e){if(!dn)return;const s=zc(n),r=t*$c(),i=DC(n);dn.fillStyle=e,dn.fillRect(s,r,i,$c())}function wk(n,t){var a;if(!dn)return;const e=zc(n),s=t*$c(),r=DC(n),i=qp[t];if(!i)return;const o=Ar.getAnimationScale(n,i),A=((a=f.state.selectedTool)==null?void 0:a.color)??"#212529";dn.globalAlpha=.4,dn.fillStyle=A,PC(dn,t,e,s,r,$c(),o),dn.globalAlpha=1}const kC=()=>{const n=document.getElementById(hk);return(n==null?void 0:n.scrollLeft)??0};function Bk(n){var l;const t=n.currentTarget;if(!t)return;const e=t.getBoundingClientRect(),s=n.clientX-e.left,r=n.clientY-e.top,i=Ps.getColumnIndex(s+kC()),o=Ps.getDrumRowIndex(r),A=f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths.length:f.state.columnWidths.length;if(!dn||i<0||i>=A||o<0||o>2){$p();return}zp();const a=qp[o];a&&(qc?((l=f.eraseDrumNoteAt)!=null&&l.call(f,i,a,!1)&&(wa=!0),uf(i,o,"rgba(220, 53, 69, 0.3)")):(uf(i,o,"rgba(74, 144, 226, 0.2)"),wk(i,o)))}function $p(){zp()}function Ck(n){var l,c,u,d;n.preventDefault();const t=n.currentTarget;if(!t)return;const e=t.getBoundingClientRect(),s=n.clientX-e.left,r=n.clientY-e.top,i=Ps.getColumnIndex(s+kC()),o=f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths.length:f.state.columnWidths.length;if(i<0||i>=o||!d_(i,f.state))return;const A=Ps.getDrumRowIndex(r);if(A<0||A>2)return;const a=qp[A];if(a){if(n.button===2){qc=!0,wa=!1,(l=document.getElementById(NC))==null||l.classList.add("erasing-active"),(c=f.eraseDrumNoteAt)!=null&&c.call(f,i,a,!1)&&(wa=!0),zp(),uf(i,A,"rgba(220, 53, 69, 0.3)");return}if(n.button===0){const p=((u=f.state.selectedTool)==null?void 0:u.color)??"#000000",h={isDrum:!0,drumTrack:a,startColumnIndex:i,endColumnIndex:i,color:p,shape:a==="H"?"triangle":a==="M"?"square":"pentagon"};(d=f.toggleDrumNote)==null||d.call(f,h),Ar.triggerNotePop(i,a),LC(a)}}}function bk(){var n,t;qc&&(wa&&((n=f.recordState)==null||n.call(f)),qc=!1,wa=!1,(t=document.getElementById(NC))==null||t.classList.remove("erasing-active")),$p()}function yk(){const n=document.getElementById(fk),t=n==null?void 0:n.querySelector(".drum-grid-left-cell");if(!n||!t)return;let e=t.querySelector(".drum-left-content");if(!e){e=document.createElement("div"),e.className="drum-left-content";const o=e,A=document.createElement("button");A.className="drum-volume-button",A.type="button",A.setAttribute("aria-label","Drum volume"),A.innerHTML=`
      <span class="drum-volume-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false" role="img">
          <path d="M3 10v4h4l5 5V5L7 10H3z" fill="currentColor"></path>
          <path d="M16 8.82v6.36c1.18-.85 2-2.22 2-3.64s-.82-2.79-2-3.64z" fill="currentColor"></path>
          <path d="M16 4v2c2.9 1.06 5 3.86 5 7s-2.1 5.94-5 7v2c4.01-1.15 7-4.97 7-9s-2.99-7.85-7-9z" fill="currentColor"></path>
        </svg>
      </span>
    `,A.style.gridRow="1 / span 3",A.style.gridColumn="1",["H","M","L"].forEach((a,l)=>{const c=document.createElement("span");c.className="drum-track-label",c.textContent=a,c.style.gridColumn="2",c.style.gridRow=`${l+1}`,o.appendChild(c)}),o.appendChild(A),t.appendChild(o)}const s=document.createElement("div");s.className="drum-volume-control",Ks=document.createElement("input"),Ks.type="range",Ks.min="0",Ks.max="100",Ks.value="100",Ks.className="drum-volume-slider",Ks.style.cssText="width: 80px; margin: 0;",Ks.addEventListener("input",o=>{const A=o.currentTarget;Ac=Number(A.value)/100;const a=window.drumVolumeNode;if(a!=null&&a.volume){const l=Ac===0?-60:20*Math.log10(Ac);a.volume.value=l;const c=Date.now();c-$0>=gk&&(LC("M",.1),$0=c)}}),s.appendChild(Ks),t.appendChild(s);const r=()=>{if(!s)return;s.classList.contains("visible")?s.classList.remove("visible"):s.classList.add("visible")},i=t.querySelector(".drum-volume-button");i&&i.addEventListener("click",o=>{o.stopPropagation(),r()}),document.addEventListener("click",o=>{const A=o.target,a=A==null?void 0:A.closest(".drum-volume-control"),l=A==null?void 0:A.closest(".drum-volume-button");!a&&!l&&s.classList.remove("visible")})}function Sk(){return Ac}window.getDrumVolume=Sk;function Ek(){const n=document.getElementById(pk),t=document.getElementById(mk);!n||!t||(dn=t.getContext("2d"),n.addEventListener("mousedown",Ck),n.addEventListener("mousemove",Bk),n.addEventListener("mouseleave",$p),n.addEventListener("contextmenu",e=>e.preventDefault()),window.addEventListener("mouseup",bk),yk())}function X0(){const n=Aa.getDrumContext();if(!(n!=null&&n.canvas))return;const t={placedNotes:qT(f.state),placedTonicSigns:Ye(f.state),columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.musicalColumnWidths,cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,macrobeatGroupings:f.state.macrobeatGroupings,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth};dk(n,t)}const tn={animationFrameId:null,render(){X0(),Ar.hasActiveAnimations()?tn.animationFrameId||tn.startAnimationLoop():tn.stopAnimationLoop()},startAnimationLoop(){if(tn.animationFrameId)return;const n=()=>{Ar.cleanupAnimations(),X0(),Ar.hasActiveAnimations()?tn.animationFrameId=requestAnimationFrame(n):tn.animationFrameId=null};tn.animationFrameId=requestAnimationFrame(n)},stopAnimationLoop(){tn.animationFrameId&&(cancelAnimationFrame(tn.animationFrameId),tn.animationFrameId=null)}};window.drumGridRenderer=tn;const xk=Symbol("store-context");function Ik(n,t){Qe(t,!0),cL(xk,{store:f});function e(){var o;try{Go.render(),(o=tn.render)==null||o.call(tn),E.debug("StoreContext","renderAll invoked",null,"grid")}catch(A){E.error("StoreContext","renderAll failed",A,"grid")}}Qn(()=>{const o=()=>{Wt.setBpm(f.state.tempo)},A=()=>{fe.reflow()},a=()=>{re.refresh&&re.refresh()},l=()=>{Go.renderMacrobeatTools()},c=()=>{fe.reflow()},u=()=>{fe.reflow(),e()};return f.on("tempoChanged",o),f.on("layoutChanged",A),f.on("rhythmPatternChanged",a),f.on("notesChanged",e),f.on("sixteenthStampPlacementsChanged",e),f.on("tripletStampPlacementsChanged",e),f.on("accidentalModeChanged",e),f.on("frequencyLabelsChanged",e),f.on("focusColoursChanged",e),f.on("octaveLabelsChanged",e),f.on("degreeDisplayModeChanged",e),f.on("longNoteStyleChanged",e),f.on("layoutConfigChanged",l),f.on("rhythmStructureChanged",c),f.on("tempoModulationMarkersChanged",u),E.initSuccess("StoreContext"),()=>{f.off("tempoChanged",o),f.off("layoutChanged",A),f.off("rhythmPatternChanged",a),f.off("notesChanged",e),f.off("sixteenthStampPlacementsChanged",e),f.off("tripletStampPlacementsChanged",e),f.off("accidentalModeChanged",e),f.off("frequencyLabelsChanged",e),f.off("focusColoursChanged",e),f.off("octaveLabelsChanged",e),f.off("degreeDisplayModeChanged",e),f.off("longNoteStyleChanged",e),f.off("layoutConfigChanged",l),f.off("rhythmStructureChanged",c),f.off("tempoModulationMarkersChanged",u)}});var s=Gc(),r=pa(s);{var i=o=>{var A=Gc(),a=pa(A);JL(a,()=>t.children),Un(o,A)};Ka(r,o=>{t.children&&o(i)})}Un(n,s),Ue()}function Fk(n,t){var C;Qe(t,!0);const e=1,s=31,r=0,i=2;let o=!1,A=!1,a=!1,l=((C=f.state.selectedNote)==null?void 0:C.color)||"#4a90e2",c=null,u=null,d=null,p=null,h=null,m=null,g=null;function v(){if(!l)return null;const b=f.state.timbres[l];return b?(b.filter?b.filter.enabled===void 0&&(b.filter.enabled=!0):b.filter={enabled:!0,blend:1,cutoff:16,resonance:0,type:"lowpass",mix:0},b.filter):null}function w(){const b=v();if(!b)return;const{cutoff:S=16,blend:T=0,mix:x=0}=b;if(c&&u){const _=(i-T)/(i-r);c.style.left=`${_*100}%`,u.style.setProperty("--progress",`${_*100}%`)}if(m&&g){const _=(x||0)/100;m.style.bottom=`${_*100}%`,g.style.setProperty("--blend-progress",`${_*100}%`)}if(d&&p){const _=(S-e)/(s-e);d.style.left=`${_*100}%`,d.style.top="50%",d.style.transform="translate(-50%, -50%)",p.style.setProperty("--progress",`${_*100}%`)}h&&l&&h.style.setProperty("--c-accent",l)}function y(b){if(!o||!l||!p)return;const S=p.getBoundingClientRect(),T=b.clientX-S.left,x=S.width;let _=T/x;_=Math.max(0,Math.min(1,_));const F=_*(s-e)+e;f.setFilterSettings(l,{cutoff:F})}function I(b){if(!A||!l||!u)return;const S=u.getBoundingClientRect(),T=b.clientX-S.left,x=S.width;let _=T/x;_=Math.max(0,Math.min(1,_));const F=i-_*(i-r);f.setFilterSettings(l,{blend:F})}function B(b){if(!a||!l||!g)return;const S=g.getBoundingClientRect(),T=b.clientY-S.top,x=S.height;let _=1-T/x;_=Math.max(0,Math.min(1,_));const F=_*100;f.setFilterSettings(l,{mix:F})}Qn(()=>{if(h=document.querySelector(".filter-container"),c=document.getElementById("thumb-b"),u=document.getElementById("blend-slider-container"),d=document.getElementById("thumb-c"),p=document.getElementById("cutoff-slider-container"),g=document.getElementById("vertical-blend-track"),m=document.getElementById("vertical-blend-thumb"),!h||!c||!d||!m||!g){E.error("FilterControlsBridge","Missing required elements",{container:h,blendThumb:c,cutoffThumb:d,verticalBlendSlider:m,verticalBlendTrack:g},"filter");return}const b=F=>{F.preventDefault(),A=!0,document.body.style.cursor="ew-resize";const Q=W=>I(W),U=()=>{A=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",Q),window.removeEventListener("pointerup",U),f.recordState()};window.addEventListener("pointermove",Q),window.addEventListener("pointerup",U)},S=F=>{F.preventDefault(),o=!0,document.body.style.cursor="ew-resize";const Q=W=>y(W),U=()=>{o=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",Q),window.removeEventListener("pointerup",U),f.recordState()};window.addEventListener("pointermove",Q),window.addEventListener("pointerup",U)},T=F=>{F.preventDefault(),a=!0,document.body.style.cursor="ns-resize";const Q=W=>B(W),U=()=>{a=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",Q),window.removeEventListener("pointerup",U),f.recordState()};window.addEventListener("pointermove",Q),window.addEventListener("pointerup",U)};c.addEventListener("pointerdown",b),d.addEventListener("pointerdown",S),m.addEventListener("pointerdown",T);const x=({newNote:F}={})=>{F!=null&&F.color&&F.color!==l&&(l=F.color,w())},_=F=>{F&&F===l&&w()};return f.on("noteChanged",x),f.on("timbreChanged",_),w(),E.info("FilterControlsBridge","Filter controls initialized",null,"filter"),()=>{c==null||c.removeEventListener("pointerdown",b),d==null||d.removeEventListener("pointerdown",S),m==null||m.removeEventListener("pointerdown",T),f.off("noteChanged",x),f.off("timbreChanged",_)}}),Ue()}function Dl(n,t){if(!(typeof window>"u"||!window.__adsrFlowDebug)){if(t===void 0){console.log("[ADSR Flow]",n);return}console.log("[ADSR Flow]",n,t)}}function Tk(n,{width:t,height:e},s){for(;n.firstChild;)n.removeChild(n.firstChild);if(s>0){for(let A=1;A<=5;A++)if(A<=s){const a=A/s*t,l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(a)),l.setAttribute("y",String(e-5)),l.setAttribute("fill","#d0d0d0"),l.setAttribute("font-size","24"),l.setAttribute("font-weight","bold"),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","auto"),l.setAttribute("opacity","0.3"),l.textContent=`${A}s`,n.appendChild(l)}}const r=f.state.tempo;if(r<=0||s<=0)return;const i=30/r;let o=0;for(let A=i;A<s;A+=i){const a=A/s*t,l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",String(a)),l.setAttribute("y1","0"),l.setAttribute("x2",String(a)),l.setAttribute("y2",String(e));const c=(o+1)%2===0;l.setAttribute("stroke",c?"#adb5bd":"#ced4da"),l.setAttribute("stroke-width",c?"1":"0.5"),l.setAttribute("stroke-dasharray","3,3"),n.appendChild(l),o++}}function _k(n,t,e,{height:s,width:r},i,o,A){for(;n.firstChild;)n.removeChild(n.firstChild);for(;t.firstChild;)t.removeChild(t.firstChild);if(e.length<4)return;const a=e[0],l=e[1],c=e[2],u=e[3];if(!a||!l||!c||!u)return;const d=f.state.colorPalette[i]||{primary:i,light:i},p=d.primary,h=d.light;let m={time:0,feedback:0};if(window.effectsCoordinator&&(m=window.effectsCoordinator.getEffectParameters(i,"delay")),A&&A.clearRect(0,0,r,s),(m.time||0)>0&&(m.feedback||0)>0&&o){const S=Math.max(.01,(m.time||0)/100*.5),T=Math.min(.95,(m.feedback||0)/100),x=.05;let _=T,F=0;for(;_>x&&F<10;){F++;const Q=S*F/o*r,U=e.map(R=>({x:R.x+Q,y:R.y})),W=U[0],L=U[3];if(!(!W||!L)){if(W.x<r){const R=document.createElementNS("http://www.w3.org/2000/svg","polygon"),N=`${W.x},${s} `+U.map(J=>`${J.x},${J.y}`).join(" ")+` ${Math.min(L.x,r)},${s}`;R.setAttribute("points",N),R.setAttribute("fill",xs(h,.7*_)),R.setAttribute("class","delay-echo"),n.appendChild(R);const q=document.createElementNS("http://www.w3.org/2000/svg","polyline");q.setAttribute("points",U.map(J=>`${J.x},${J.y}`).join(" ")),q.setAttribute("stroke-width","2"),q.setAttribute("fill","none"),q.setAttribute("stroke",xs(p,_)),q.setAttribute("class","delay-echo"),n.appendChild(q)}_*=T}}}const g=document.createElementNS("http://www.w3.org/2000/svg","polygon"),v=`0,${s} `+e.map(S=>`${S.x},${S.y}`).join(" ")+` ${r},${s}`;g.setAttribute("points",v),g.setAttribute("fill",xs(h,.7)),n.appendChild(g);const w=document.createElementNS("http://www.w3.org/2000/svg","line");w.setAttribute("x1",String(a.x)),w.setAttribute("y1",String(a.y)),w.setAttribute("x2",String(l.x)),w.setAttribute("y2",String(l.y)),w.setAttribute("stroke",p),w.setAttribute("stroke-width","2"),n.appendChild(w);const y=document.createElementNS("http://www.w3.org/2000/svg","line");y.setAttribute("x1",String(l.x)),y.setAttribute("y1",String(l.y)),y.setAttribute("x2",String(c.x)),y.setAttribute("y2",String(c.y)),y.setAttribute("stroke",p),y.setAttribute("stroke-width","2"),n.appendChild(y);const I=1,B=document.createElementNS("http://www.w3.org/2000/svg","line");B.setAttribute("x1",String(c.x)),B.setAttribute("y1",String(c.y)),B.setAttribute("x2",String(u.x)),B.setAttribute("y2",String(u.y)),B.setAttribute("stroke",xs(p,I)),B.setAttribute("stroke-width","2"),n.appendChild(B);const C=["attack-node","decay-sustain-node","release-node"];[l,c,u].forEach((S,T)=>{const x=document.createElementNS("http://www.w3.org/2000/svg","circle");x.setAttribute("id",C[T]),x.setAttribute("class","adsr-node"),x.setAttribute("cx",String(S.x)),x.setAttribute("cy",String(S.y)),x.setAttribute("r","8"),x.setAttribute("fill",p),x.setAttribute("stroke",Ru(p,-.3)),x.setAttribute("stroke-width","2"),x.style.cursor="grab";const _=document.createElementNS("http://www.w3.org/2000/svg","title");x.appendChild(_),t.appendChild(x)})}function Mk(n,t){if(!n)return;const e=Ru(t,-.2);n.style.setProperty("--c-accent",t),n.style.setProperty("--c-accent-hover",e)}var Qk=ni('<canvas class="adsr-reverb-canvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></canvas> <svg width="100%" height="100%"><g></g><g></g><g></g></svg>',1);function Uk(n,t){var Y;Qe(t,!0);const e=2.5,s=.01,r=1e-4;let i=0,o=0,A=0,a=0,l=((Y=f.state.selectedNote)==null?void 0:Y.color)||"#4a90e2",c=f.state.adsrTimeAxisScale,u=0,d=0,p=!1,h=null,m=null,g=null,v=null,w=null,y=null,I=null,B=null,C=null,b=null,S=null,T=null,x=null,_=null;function F(){if(p)return;p=!0;const P=()=>{p=!1,q(),N()};typeof requestAnimationFrame=="function"?requestAnimationFrame(P):setTimeout(P,0)}function Q(P){var O,X;let st=1;const D=window.animationEffectsManager;return(O=D==null?void 0:D.shouldTremoloBeRunning)!=null&&O.call(D)&&(st=D.getADSRTremoloAmplitudeMultiplier(P)),(((X=window.waveformVisualizer)==null?void 0:X.calculatedAmplitude)??1)*st}function U(P){const st=Q(l);if(!Number.isFinite(st))return P;if(P.sustain-st>r){const D={...P,sustain:st};return f.setADSR(l,D),Dl("adsrEnvelope:clampSustain",{color:l,adsr:D,normalizedAmplitude:st}),D}return P}function W(){const P=f.state.timbres[l];if(!P)return;const st=U(P.adsr);i=st.attack,o=st.decay,A=st.sustain,a=st.release,F()}function L(){return e*c}function R(P){const st=f.state.timbres[l];if(!st)return;const{sustain:D}=st.adsr,K={...P};K.d=Math.max(K.a+s,K.d),K.r=Math.max(K.d+s,K.r);const O=K.a,X=K.d-K.a,tt=K.r-K.d;if(Number.isNaN(O)||Number.isNaN(X)||Number.isNaN(tt)){E.error("ADSREnvelope","NaN value detected before setting ADSR. Aborting update.",{nextAttack:O,nextDecay:X,nextRelease:tt},"audio");return}const k={attack:O,decay:X,release:tt,sustain:D};f.setADSR(l,k),Dl("adsrEnvelope:updateADSRFromAbsoluteTimes",{color:l,adsr:k})}function N(){if(!v||!g||!y||!I||!B||!w||!f.state.timbres[l])return;const D=Q(l)*100,K=A*100;v.style.bottom=`${K}%`,g.style.setProperty("--sustain-progress",`${K}%`);const O=100-D;g.style.setProperty("--ineligible-height",`${O}%`);const X=L(),tt=X>0?i/X*100:0,k=X>0?(i+o)/X*100:0,z=X>0?(i+o+a)/X*100:0;y.style.left=`${tt}%`,I.style.left=`${k}%`,B.style.left=`${z}%`,w.style.setProperty("--adr-progress",`${z}%`);const $=Ct=>`${Ct.toFixed(3)}s`,rt=Ct=>`${(Ct*100).toFixed(0)}%`;y.title=`Attack: ${$(i)}`,I.title=`Decay: ${$(o)}`,B.title=`Release: ${$(a)}`,v.title=`Sustain: ${rt(A)}`;const et=_==null?void 0:_.querySelector("#attack-node > title");et&&(et.textContent=`Attack: ${$(i)}`);const it=_==null?void 0:_.querySelector("#decay-sustain-node > title");it&&(it.textContent=`Decay: ${$(o)}
Sustain: ${rt(A)}`);const at=_==null?void 0:_.querySelector("#release-node > title");at&&(at.textContent=`Release: ${$(a)}`)}function q(){if(!T||!x||!_||!u||!d)return;const P=L();if(!Number.isFinite(P)||P<=0)return;const st=Q(l);if(!Number.isFinite(st))return;const D=O=>O/P*u,K=[{x:0,y:d},{x:D(i),y:d*(1-st)},{x:D(i+o),y:d*(1-Math.min(A*st,st))},{x:D(i+o+a),y:d}];Tk(T,{width:u,height:d},P),_k(x,_,K,{width:u,height:d},l,P,b),Mk(m,l)}function J(){if(!h)return;const P=h.clientWidth,st=h.clientHeight;if(!(P<=0||st<=0)){if(u=P,d=st,C){const D=window.devicePixelRatio||1;C.width=P*D,C.height=st*D,b||(b=C.getContext("2d")),b&&(b.setTransform(1,0,0,1,0,0),b.scale(D,D))}S&&S.setAttribute("viewBox",`0 0 ${P} ${st}`),F()}}Qn(()=>{if(h=document.getElementById("adsr-envelope"),!h){E.error("ADSREnvelope","ADSR container element not found",null,"adsr");return}m=h.closest(".adsr-container"),g=document.getElementById("sustain-slider-track"),v=document.getElementById("sustain-slider-thumb"),w=document.getElementById("multi-thumb-slider-container"),y=document.getElementById("thumb-a"),I=document.getElementById("thumb-d"),B=document.getElementById("thumb-r"),b=(C==null?void 0:C.getContext("2d"))??null;const P=new ResizeObserver(()=>J());return P.observe(h),J(),()=>{P.disconnect()}}),Qn(()=>{const P=(tt={})=>{var z;const k=(z=tt.newNote)==null?void 0:z.color;k&&k!==l&&(l=k,W())},st=tt=>{tt===l&&W()},D=()=>F(),K=()=>{c=f.state.adsrTimeAxisScale,F()},O=tt=>{var k;(k=tt==null?void 0:tt.activeColors)!=null&&k.includes(l)&&F()},X=tt=>{tt&&tt.color===l&&(tt.effectType==="delay"||tt.effectType==="reverb")&&F()};return f.on("noteChanged",P),f.on("timbreChanged",st),f.on("tempoChanged",D),f.on("adsrTimeAxisScaleChanged",K),f.on("tremoloAmplitudeUpdate",O),f.on("audioEffectChanged",X),W(),()=>{f.off("noteChanged",P),f.off("timbreChanged",st),f.off("tempoChanged",D),f.off("adsrTimeAxisScaleChanged",K),f.off("tremoloAmplitudeUpdate",O),f.off("audioEffectChanged",X)}}),Qn(()=>{if(!g||!w||!S||!_)return;let P=!1,st=null,D=null;const K=it=>{var gt,mt;if(!P||!g)return;const at=g.getBoundingClientRect();let yt=100-(it.clientY-at.top)/at.height*100;yt=Math.max(0,Math.min(100,yt));const Et=(((mt=(gt=window.waveformVisualizer)==null?void 0:gt.getNormalizedAmplitude)==null?void 0:mt.call(gt))||1)*100;yt=Math.min(yt,Et);const Qt=f.state.timbres[l];if(!Qt)return;const ct={...Qt.adsr,sustain:yt/100};f.setADSR(l,ct),Dl("adsrEnvelope:sustainSlider",{color:l,adsr:ct})},O=it=>{P=!0,K(it)},X=()=>{P=!1},tt=it=>{if(!st||!w)return;const at=w.getBoundingClientRect();let yt=(it.clientX-at.left)/at.width*100;yt=Math.max(0,Math.min(100,yt));const Bt=yt/100*L(),Et=f.state.timbres[l];if(!Et)return;const{attack:Qt,decay:ct,release:gt}=Et.adsr,mt={a:Qt,d:Qt+ct,r:Qt+ct+gt};st.id==="thumb-a"&&(mt.a=Bt),st.id==="thumb-d"&&(mt.d=Bt),st.id==="thumb-r"&&(mt.r=Bt),R(mt)},k=it=>{const at=it.target;at!=null&&at.classList.contains("time-slider-thumb")&&(st=at,tt(it))},z=()=>{st=null},$=it=>{var jn,ri;if(!D||!S||!u||!d)return;const at=S.createSVGPoint();at.x=it.clientX,at.y=it.clientY;const Ct=S.getScreenCTM();if(!Ct)return;const yt=at.matrixTransform(Ct.inverse());let Bt=yt.x/u*100,Et=1-yt.y/d;Bt=Math.max(0,Math.min(100,Bt)),Et=Math.max(0,Math.min(1,Et));const Qt=Bt/100*L(),ct=f.state.timbres[l];if(!ct)return;const{attack:gt,decay:mt,release:Ot}=ct.adsr;let ve=ct.adsr.sustain;const we={a:gt,d:gt+mt,r:gt+mt+Ot};switch(D.id){case"attack-node":we.a=Qt;break;case"decay-sustain-node":{we.d=Qt;const ii=((ri=(jn=window.waveformVisualizer)==null?void 0:jn.getNormalizedAmplitude)==null?void 0:ri.call(jn))||1;ve=Math.min(Et,ii);break}case"release-node":we.r=Qt;break}const Cr=ct.adsr.sustain;if(ve!==Cr){const ii={attack:gt,decay:mt,release:Ot,sustain:ve};f.setADSR(l,ii),Dl("adsrEnvelope:nodeDragSustain",{color:l,adsr:ii})}R(we)},rt=it=>{const at=it.target;at!=null&&at.classList.contains("adsr-node")&&(D=at,D.style.cursor="grabbing",$(it))},et=()=>{D&&(D.style.cursor="grab",D=null)};return g.addEventListener("pointerdown",O),document.addEventListener("pointermove",K),document.addEventListener("pointerup",X),w.addEventListener("pointerdown",k),document.addEventListener("pointermove",tt),document.addEventListener("pointerup",z),_.addEventListener("pointerdown",rt),document.addEventListener("pointermove",$),document.addEventListener("pointerup",et),()=>{g==null||g.removeEventListener("pointerdown",O),document.removeEventListener("pointermove",K),document.removeEventListener("pointerup",X),w==null||w.removeEventListener("pointerdown",k),document.removeEventListener("pointermove",tt),document.removeEventListener("pointerup",z),_==null||_.removeEventListener("pointerdown",rt),document.removeEventListener("pointermove",$),document.removeEventListener("pointerup",et)}});var nt=Qk(),At=pa(nt);ao(At,P=>C=P,()=>C);var ot=Ge(At,2),V=Te(ot);ao(V,P=>T=P,()=>T);var H=Ge(V);ao(H,P=>x=P,()=>x);var G=Ge(H);ao(G,P=>_=P,()=>_),ao(ot,P=>S=P,()=>S),Un(n,nt),Ue()}E.moduleLoaded("EffectsCoordinator");class Pk{constructor(){this.effectParameters=new Map,this.defaultEffects={vibrato:{speed:0,span:0,wet:100},tremolo:{speed:0,span:0,wet:100},delay:{time:0,feedback:0,wet:20}},E.info("EffectsCoordinator","Initialized as main coordinator",null,"effects")}init(){return Object.keys(f.state.timbres).forEach(t=>{this.initializeColorEffects(t)}),f.on("timbreCreated",({color:t})=>{this.initializeColorEffects(t)}),this.loadSavedValues(),E.info("EffectsCoordinator","Event subscriptions established",null,"effects"),!0}initializeColorEffects(t){if(!this.effectParameters.has(t)){const e={};Object.entries(this.defaultEffects).forEach(([r,i])=>{e[r]={...i}}),this.effectParameters.set(t,e);const s=f.state.timbres[t];s&&(s.vibrato&&(e.vibrato={...s.vibrato}),s.tremelo&&(e.tremolo={...s.tremelo})),E.debug("EffectsCoordinator",`Initialized effects for color ${t}`,e,"effects")}}updateParameter(t,e,s,r){if(!r){E.warn("EffectsCoordinator","Cannot update parameter: no color provided",{effectType:t,parameter:e,value:s},"effects");return}this.initializeColorEffects(r);const i=this.effectParameters.get(r);i[t]||(i[t]={...this.defaultEffects[t]}),i[t][e]=s,this.notifyAudioSystem(t,e,s,r,i[t]),this.notifyAnimationSystem(t,e,s,r,i[t]),this.updateTimbreState(t,i[t],r),this.saveValues()}notifyAudioSystem(t,e,s,r,i){f.emit("audioEffectChanged",{effectType:t,parameter:e,value:s,color:r,effectParams:{...i}}),E.debug("EffectsCoordinator",`Notified audio system: ${t}.${e} = ${s} for ${r}`,null,"effects")}notifyAnimationSystem(t,e,s,r,i){(t==="vibrato"||t==="tremolo")&&(f.emit("visualEffectChanged",{effectType:t,parameter:e,value:s,color:r,effectParams:{...i}}),E.debug("EffectsCoordinator",`Notified animation system: ${t}.${e} = ${s} for ${r}`,null,"effects"))}updateTimbreState(t,e,s){const r=f.state.timbres[s];if(!r)return;const o={vibrato:"vibrato",tremolo:"tremelo"}[t];o&&(r[o]||(r[o]={}),Object.assign(r[o],e),f.recordState())}getEffectParameters(t,e){const s=this.effectParameters.get(t);return s!=null&&s[e]?{...s[e]}:{...this.defaultEffects[e]}}getAllEffectParameters(t){const e=this.effectParameters.get(t);return e?{...e}:{...this.defaultEffects}}resetColorEffects(t){const e={};Object.entries(this.defaultEffects).forEach(([s,r])=>{e[s]={...r}}),this.effectParameters.set(t,e),Object.keys(e).forEach(s=>{Object.keys(e[s]).forEach(r=>{this.notifyAudioSystem(s,r,e[s][r],t,e[s]),this.notifyAnimationSystem(s,r,e[s][r],t,e[s])})}),E.info("EffectsCoordinator",`Reset all effects for color ${t}`,e,"effects")}saveValues(){const t={};Object.keys(f.state.timbres).forEach(e=>{const s=this.effectParameters.get(e);s&&(t[e]={vibrato:s.vibrato||{speed:0,span:0,wet:100},tremelo:s.tremolo||{speed:0,span:0,wet:100},delay:s.delay||{time:0,feedback:0,wet:20}})});try{localStorage.setItem("effectDialValues",JSON.stringify(t)),E.debug("EffectsCoordinator","Saved effect values to localStorage",null,"effects")}catch(e){E.warn("EffectsCoordinator","Failed to save effect values to localStorage",e,"effects")}}loadSavedValues(){try{const t=localStorage.getItem("effectDialValues");if(!t){E.debug("EffectsCoordinator","No saved effect values found",null,"effects");return}const e=JSON.parse(t);E.debug("EffectsCoordinator","Loading saved effect values",null,"effects"),Object.keys(e).forEach(s=>{const r=f.state.timbres[s],i=e[s];r&&i&&(i.vibrato&&Object.entries(i.vibrato).forEach(([o,A])=>{typeof A=="number"&&this.updateParameter("vibrato",o,A,s)}),i.tremelo&&Object.entries(i.tremelo).forEach(([o,A])=>{typeof A=="number"&&this.updateParameter("tremolo",o,A,s)}),i.delay&&Object.entries(i.delay).forEach(([o,A])=>{typeof A=="number"&&this.updateParameter("delay",o,A,s)}))}),E.info("EffectsCoordinator","Applied saved effect values",null,"effects"),window.synthEngine&&Object.keys(e).forEach(s=>{const r=e[s];r.delay&&(r.delay.time>0||r.delay.feedback>0)&&(window.synthEngine.updateSynthForColor(s),E.debug("EffectsCoordinator",`Re-applied effects to synth for ${s}`,null,"effects"))})}catch(t){E.warn("EffectsCoordinator","Failed to load saved effect values",t,"effects")}}dispose(){this.effectParameters.clear(),E.info("EffectsCoordinator","Disposed",null,"effects")}}const vs=new Pk;class Nk{constructor(){M(this,"currentEffect",null);M(this,"effectControlsContainer",null);M(this,"effectButtons",[]);M(this,"dials",[]);M(this,"currentColor",null);M(this,"isDialInteractionActive",!1);M(this,"lastPreviewAt",{});M(this,"previewThrottleMs",180);M(this,"previewDurationMs",220);M(this,"previewPitch","C4");M(this,"holdPreviews",{});M(this,"effectConfigs",{delay:{name:"Delay",controls:{time:{label:"Time",min:0,max:100,default:0,unit:"%"},feedback:{label:"Echoes",min:0,max:95,default:0,unit:"%"},wet:{label:"Mix",min:0,max:100,default:15,unit:"%"}}},vibrato:{name:"Vibrato",controls:{speed:{label:"Speed",min:0,max:100,default:0,unit:"%"},span:{label:"Span",min:0,max:100,default:0,unit:"%"}}},tremolo:{name:"Tremolo",controls:{speed:{label:"Speed",min:0,max:100,default:0,unit:"%"},span:{label:"Span",min:0,max:100,default:0,unit:"%"}}}})}init(){return E.initStart("Effects Controller"),this.effectControlsContainer=document.getElementById("effect-controls"),this.effectButtons=document.querySelectorAll(".effect-button[data-effect]"),this.effectButtons.length>0&&this.setupEventListeners(),this.initializeSelectedColorTracking(),this.setupGlobalMouseUpHandler(),E.initSuccess("Effects Controller"),!0}setupGlobalMouseUpHandler(){document.addEventListener("mouseup",()=>{this.isDialInteractionActive&&this.onDialInteractionEnd(this.currentEffect)})}setupEventListeners(){this.effectButtons.forEach(t=>{t.addEventListener("click",e=>{const r=e.currentTarget.dataset.effect;r&&this.selectEffect(r)})})}selectEffect(t){if(E.debug("Effects",`Selecting effect: ${t}`,null,"ui"),!this.effectConfigs[t]){E.info("Effects",`Effect ${t} not configured`,null,"ui");return}if(this.effectButtons.forEach(e=>{e.classList.remove("active"),e.dataset.effect===t&&e.classList.add("active")}),this.currentEffect===t){this.currentEffect=null,this.hideEffectControls();return}this.currentEffect=t,this.showEffectControls(t)}showEffectControls(t){const e=this.effectConfigs[t];if(!e||!this.effectControlsContainer){E.warn("Effects",`No configuration found for effect: ${t}`,null,"ui");return}this.clearControls(),this.effectControlsContainer.innerHTML='<div class="effect-controls"></div>';const s=this.effectControlsContainer.querySelector(".effect-controls");s&&Object.entries(e.controls).forEach(([r,i])=>{var h;const o=this.currentColor?(h=vs.getEffectParameters)==null?void 0:h.call(vs,this.currentColor,t):null,A=(o==null?void 0:o[r])??i.default??0,a=document.createElement("div");a.className="effect-slider-group",a.style.cssText="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;",s.appendChild(a);const l=document.createElement("label");l.className="effect-slider-label",l.textContent=i.label,l.style.cssText="display: block; margin-bottom: 5px; font-weight: bold; color: #333;",a.appendChild(l);const c=document.createElement("input");c.type="range",c.min=`${i.min}`,c.max=`${i.max}`,c.value=`${A}`,c.className="effect-slider",c.style.cssText="width: 100%; margin: 5px 0;",a.appendChild(c);const u=document.createElement("div");u.className="effect-slider-value";const d=i.unit?`${Math.round(A)}${i.unit}`:Math.round(A);u.textContent=`${d}`,u.style.cssText="text-align: center; font-size: 12px; color: #666;",a.appendChild(u),this.dials.push({dial:{element:c,value:A,destroy:()=>{}},control:r,effectType:t,valueDisplay:u,controlConfig:i});const p=m=>{const g=m.target;if(!g)return;const v=parseFloat(g.value),w=i.unit?`${Math.round(v)}${i.unit}`:Math.round(v);u.textContent=`${w}`,E.debug("Effects",`${t} ${r}: ${v}`,null,"audio"),this.onEffectParameterChange(t,r,v)};c.addEventListener("input",p),c.addEventListener("change",p),c.addEventListener("mousedown",()=>this.onDialInteractionStart(t)),c.addEventListener("mouseup",()=>this.onDialInteractionEnd(t)),c.addEventListener("mouseleave",m=>{(m.buttons&1)===1&&this.onDialInteractionEnd(t)})})}hideEffectControls(){this.clearControls(),this.currentEffect=null}clearControls(){this.dials.forEach(t=>t.dial.destroy()),this.dials=[],this.effectControlsContainer&&(this.effectControlsContainer.innerHTML="")}onEffectParameterChange(t,e,s){var i;const r=this.currentColor||((i=f.state.selectedNote)==null?void 0:i.color);r&&vs.updateParameter(t,e,s,r)}updateEffect(t,e){var r;const s=this.currentColor||((r=f.state.selectedNote)==null?void 0:r.color);s&&Object.entries(e).forEach(([i,o])=>{typeof o=="number"&&vs.updateParameter(t,i,o,s)})}getEffectState(t){var s;const e=this.currentColor||((s=f.state.selectedNote)==null?void 0:s.color);return e?vs.getEffectParameters(e,t)||{}:{}}getActiveColor(){var t;return this.currentColor||((t=f.state.selectedNote)==null?void 0:t.color)||null}getPreviewNotes(){var o;const t=this.getActiveColor();if(!t)return null;const e=f.state.placedNotes.slice().reverse().find(A=>!A.isDrum),s=e?((o=f.state.fullRowData[e.row])==null?void 0:o.toneNote)||this.previewPitch:this.previewPitch,r=f.state.selectedTool;let i=[s];return r==="chord"&&Array.isArray(f.state.activeChordIntervals)&&(i=f.state.activeChordIntervals.map(a=>NA(xo(s,a)))),{pitches:i,root:s,color:t}}previewEffect(t){var a;const e=this.getActiveColor();if(!e)return;const s=Date.now(),r=this.lastPreviewAt[t]??0;if(s-r<this.previewThrottleMs)return;this.lastPreviewAt[t]=s;const{isPlaying:i,isPaused:o}=f.state;if(i&&!o)return;const A=`effect-preview-${t}`;(a=f.emit)==null||a.call(f,"noteAttack",{noteId:A,color:e});try{Wt.triggerAttack(this.previewPitch,e),setTimeout(()=>Wt.triggerRelease(this.previewPitch,e),this.previewDurationMs)}catch(l){E.warn("Effects","Preview trigger failed",{err:l},"audio")}finally{setTimeout(()=>{var l;return(l=f.emit)==null?void 0:l.call(f,"noteRelease",{noteId:A,color:e})},this.previewDurationMs)}}startHoldPreview(t){if(this.holdPreviews[t])return;const e=this.getPreviewNotes();if(!e)return;const{pitches:s,root:r,color:i}=e,o=`effect-hold-${t}-${Date.now()}`;this.holdPreviews[t]={pitches:s,root:r,color:i,noteId:o};const{isPlaying:A,isPaused:a}=f.state;if(A&&!a)return;if(t==="delay"){const c=vs.getEffectParameters(i,"delay");c&&c.wet>0&&vs.updateParameter("delay","wet",c.wet,i)}s.forEach(c=>Wt.triggerAttack(c,i));const l=f.state.fullRowData.find(c=>c.toneNote===r);l&&l.hex,f.state.timbres[i],f.emit("spacebarPlayback",{note:r,color:i,isPlaying:!0}),f.emit("noteAttack",{noteId:o,color:i})}stopHoldPreview(t){const e=this.holdPreviews[t];if(!e)return;delete this.holdPreviews[t];const{pitches:s,root:r,color:i,noteId:o}=e;s.forEach(a=>Wt.triggerRelease(a,i));const A=f.state.fullRowData.find(a=>a.toneNote===r);A&&A.hex,f.state.timbres[i],f.emit("spacebarPlayback",{note:r,color:i,isPlaying:!1}),f.emit("noteRelease",{noteId:o,color:i})}initializeSelectedColorTracking(){var t;f.on("noteChanged",({newNote:e}={})=>{this.currentColor=(e==null?void 0:e.color)||null,this.currentColor&&this.currentEffect&&this.showEffectControls(this.currentEffect)}),this.currentColor=((t=f.state.selectedNote)==null?void 0:t.color)||null}onDialInteractionStart(t){if(this.isDialInteractionActive=!0,t){E.debug("Effects",`Dial interaction start for ${t}`,null,"ui");const e=this.getActiveColor();e&&f.emit("effectDialInteractionStart",{effectType:t,color:e}),this.startHoldPreview(t)}}onDialInteractionEnd(t){if(this.isDialInteractionActive=!1,t){E.debug("Effects",`Dial interaction end for ${t}`,null,"ui");const e=this.getActiveColor();e&&f.emit("effectDialInteractionEnd",{effectType:t,color:e}),this.stopHoldPreview(t)}}}const _r=new Nk;var Lk=GL('<svg class="svelte-w1yw4"><defs><pattern width="20" height="20" patternUnits="userSpaceOnUse"><rect width="20" height="20" fill="none" stroke-width="1"></rect></pattern></defs><rect x="0" y="0"></rect><rect x="0" y="0" opacity="0.2"></rect><line y1="0" stroke-width="1" opacity="0.6"></line><line x1="0" stroke-width="1" opacity="0.6"></line><circle r="10" stroke="#fff" stroke-width="2"></circle></svg>');function Dk(n,t){Qe(t,!0);let e=Pn(t,"x",15,.5),s=Pn(t,"y",15,.5),r=Pn(t,"minX",3,0),i=Pn(t,"maxX",3,1),o=Pn(t,"stepX",3,0),A=Pn(t,"minY",3,0),a=Pn(t,"maxY",3,1),l=Pn(t,"stepY",3,0),c=Pn(t,"size",19,()=>[200,200]),u=Pn(t,"mode",3,"absolute"),d=Pn(t,"reverseX",3,!1),p=Pn(t,"colors",19,()=>({}));const h={accent:"#4a90e2",fill:"#1f1f1f",stroke:"#555",grid:"#333",text:"#fff"};let m=Rt(Tn({...h}));Qn(()=>{try{const ot=getComputedStyle(document.documentElement),V=ot.getPropertyValue("--c-surface").trim(),H=ot.getPropertyValue("--c-border").trim(),G=ot.getPropertyValue("--c-border-strong").trim(),Y=ot.getPropertyValue("--c-text").trim();St(m,{...h,fill:V||h.fill,stroke:H||h.stroke,grid:G||h.grid,text:Y||h.text,...p()},!0)}catch{St(m,{...h,...p()},!0)}});let g=Rt(!1),v=Rt(0),w=Rt(0);const y=gi(()=>c()[0]),I=gi(()=>c()[1]),B=`pos-grid-${Math.random().toString(36).slice(2,8)}`;function C(ot,V,H){return Math.max(V,Math.min(H,ot))}function b(ot,V,H,G){if(G<=0)return ot;const Y=ot-V,P=Math.round(Y/G),st=V+P*G;return C(st,V,H)}function S(){if(!(e()===r()&&s()===A())){if(e()===r()){const ot=o()>0?o():Math.max((i()-r())/100,.01);e(r()+ot)}if(s()===A()){const ot=l()>0?l():Math.max((a()-A())/100,.01);s(A()+ot)}}St(v,C((e()-r())/(i()-r()||1),0,1),!0),St(w,C((s()-A())/(a()-A()||1),0,1),!0)}const T=gi(()=>d()?(1-Z(v))*Z(y):Z(v)*Z(y)),x=gi(()=>u()==="absolute"?Z(w)*Z(I):(1-Z(w))*Z(I));function _(ot){var V,H;St(g,!0),F(ot),(H=(V=ot.target).setPointerCapture)==null||H.call(V,ot.pointerId)}function F(ot){var D;if(!Z(g))return;const H=ot.currentTarget.getBoundingClientRect(),G=(ot.clientX-H.left)/H.width,Y=d()?1-G:G,P=(ot.clientY-H.top)/H.height;St(v,C(Y,0,1),!0);const st=u()==="relative"?1-P:P;if(St(w,C(st,0,1),!0),e(r()+Z(v)*(i()-r())),s(A()+Z(w)*(a()-A())),o()>0&&e(b(e(),r(),i(),o())),l()>0&&s(b(s(),A(),a(),l())),!(e()===r()&&s()===A())){if(e()===r()){const K=o()>0?o():Math.max((i()-r())/100,.01);e(r()+K)}if(s()===A()){const K=l()>0?l():Math.max((a()-A())/100,.01);s(A()+K)}}St(v,C((e()-r())/(i()-r()||1),0,1),!0),St(w,C((s()-A())/(a()-A()||1),0,1),!0),(D=t.onchange)==null||D.call(t,{x:e(),y:s()})}function Q(ot){var V,H;St(g,!1),(H=(V=ot.target).releasePointerCapture)==null||H.call(V,ot.pointerId)}Qn(()=>{S()}),Qn(()=>{Z(g)||S()});var U=Lk();U.__pointerdown=_,U.__pointermove=F,U.__pointerup=Q,eD(U,"",{},{"touch-action":"none"});var W=Te(U),L=Te(W),R=Te(L),N=Ge(W),q=Ge(N),J=Ge(q),nt=Ge(J),At=Ge(nt);_i(()=>{Nt(U,"width",Z(y)),Nt(U,"height",Z(I)),Nt(U,"viewBox",`0 0 ${Z(y)??""} ${Z(I)??""}`),Nt(L,"id",B),Nt(R,"stroke",Z(m).grid),Nt(N,"width",Z(y)),Nt(N,"height",Z(I)),Nt(N,"fill",Z(m).fill),Nt(N,"stroke",Z(m).stroke),Nt(q,"width",Z(y)),Nt(q,"height",Z(I)),Nt(q,"fill",`url(#${B})`),Nt(J,"x1",Z(T)),Nt(J,"x2",Z(T)),Nt(J,"y2",Z(I)),Nt(J,"stroke",Z(m).grid),Nt(nt,"x2",Z(y)),Nt(nt,"y1",Z(x)),Nt(nt,"y2",Z(x)),Nt(nt,"stroke",Z(m).grid),Nt(At,"cx",Z(T)),Nt(At,"cy",Z(x)),Nt(At,"fill",Z(m).accent)}),Bo("pointercancel",U,Q),Un(n,U),Ue()}Gu(["pointerdown","pointermove","pointerup"]);var kk=ni('<div class="effects-cartesian-slider svelte-96fy48"><!></div>');function Rk(n,t){var _;Qe(t,!0);const e={delay:{xParam:"time",yParam:"feedback",xRange:{min:0,max:100,step:1},yRange:{min:0,max:95,step:1},backgroundOpacity:.5},vibrato:{xParam:"speed",yParam:"span",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1},backgroundOpacity:.5},tremolo:{xParam:"speed",yParam:"span",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1},backgroundOpacity:.5}},s=120;let r=Rt(null),i=null,o=Rt(null),A=Rt(null),a=Rt(Tn([s,s])),l=Rt(0),c=Rt(0),u=Rt(Tn({})),d=((_=f.state.selectedNote)==null?void 0:_.color)??null,p=!1;const h=F=>Math.max(0,Math.min(255,F)),m=(F,Q)=>{const U=F.replace("#",""),W=h(parseInt(U.slice(0,2),16)+Q),L=h(parseInt(U.slice(2,4),16)+Q),R=h(parseInt(U.slice(4,6),16)+Q);return`#${W.toString(16).padStart(2,"0")}${L.toString(16).padStart(2,"0")}${R.toString(16).padStart(2,"0")}`},g=(F,Q)=>{const U=F.replace("#",""),W=parseInt(U.slice(0,2),16),L=parseInt(U.slice(2,4),16),R=parseInt(U.slice(4,6),16);return`rgba(${W}, ${L}, ${R}, ${Q})`};function v(F){const Q=F.getBoundingClientRect();let U=(Q==null?void 0:Q.width)||F.clientWidth||F.offsetWidth||s,W=(Q==null?void 0:Q.height)||F.clientHeight||F.offsetHeight||U;return(!U||U<10)&&(U=s),(!W||W<10)&&(W=U),[Math.round(U),Math.round(W)]}function w(){i&&St(a,v(i),!0)}function y(F){var L;const Q=f.state.colorPalette[F]||{primary:F,light:F},U=Q.light||m(Q.primary,80),W=((L=Z(A))==null?void 0:L.backgroundOpacity)??.5;St(u,{accent:Q.primary,fill:g(U,W),stroke:"#c3c9d0",grid:"#d7dce4",text:"#3c4048"},!0)}function I(){if(!Z(A)||!Z(o))return;const F=_r.getEffectState(Z(o))||{},Q=typeof F[Z(A).xParam]=="number"?F[Z(A).xParam]:Z(A).xRange.min,U=typeof F[Z(A).yParam]=="number"?F[Z(A).yParam]:Z(A).yRange.min;St(l,Q,!0),St(c,U,!0)}function B({x:F,y:Q}){!Z(A)||!Z(o)||_r.updateEffect(Z(o),{[Z(A).xParam]:F,[Z(A).yParam]:Q})}function C(){if(!Z(o)||p)return;p=!0;const F=_r.getActiveColor();f.emit("effectDialInteractionStart",{effectType:Z(o),color:F}),_r.startHoldPreview(Z(o))}function b(){if(!Z(o)||!p)return;p=!1;const F=_r.getActiveColor();f.emit("effectDialInteractionEnd",{effectType:Z(o),color:F}),_r.stopHoldPreview(Z(o))}Os(()=>{if(!Z(r)||(i=Z(r).parentElement,!i))return;const F=i.dataset.effect;if(F==="delay"||F==="vibrato"||F==="tremolo")St(o,F,!0),St(A,e[F],!0),St(l,Z(A).xRange.min,!0),St(c,Z(A).yRange.min,!0);else{F&&console.warn("[EffectsCartesianSlider] Unknown effect type:",F);return}if(w(),typeof ResizeObserver>"u")return;const Q=new ResizeObserver(()=>w());return Q.observe(i),()=>Q.disconnect()}),Qn(()=>{if(!Z(A)||!Z(o))return;const F=(L={})=>{var N;const R=((N=L.newNote)==null?void 0:N.color)??null;d=R,R?y(R):St(u,{},!0),p||I()},Q=L=>{!L||L!==d||p||I()},U=L=>{if(!(!L||L.effectType!==Z(o))&&L.color===d&&!p){if(L.effectParams){const R=L.effectParams[Z(A).xParam],N=L.effectParams[Z(A).yParam];typeof R=="number"&&St(l,R,!0),typeof N=="number"&&St(c,N,!0);return}I()}};f.on("noteChanged",F),f.on("timbreChanged",Q),f.on("audioEffectChanged",U),d?y(d):St(u,{},!0),I();const W=()=>b();return window.addEventListener("pointerup",W),()=>{f.off("noteChanged",F),f.off("timbreChanged",Q),f.off("audioEffectChanged",U),window.removeEventListener("pointerup",W)}});var S=kk(),T=Te(S);{var x=F=>{Dk(F,{get minX(){return Z(A).xRange.min},get maxX(){return Z(A).xRange.max},get stepX(){return Z(A).xRange.step},get minY(){return Z(A).yRange.min},get maxY(){return Z(A).yRange.max},get stepY(){return Z(A).yRange.step},get size(){return Z(a)},mode:"relative",get colors(){return Z(u)},onchange:B,get x(){return Z(l)},set x(Q){St(l,Q,!0)},get y(){return Z(c)},set y(Q){St(c,Q,!0)}})};Ka(T,F=>{Z(A)&&F(x)})}ao(S,F=>St(r,F),()=>Z(r)),Bo("pointerdown",S,C),Bo("pointerup",S,b),Bo("pointerleave",S,b),Bo("pointercancel",S,b),Un(n,S),Ue()}var Hk=ni("<button> </button>"),Ok=ni('<div class="notification-overlay visible svelte-12566qp" role="button" tabindex="0" aria-label="Dismiss notification"><div class="notification-modal svelte-12566qp"><button class="notification-close svelte-12566qp" aria-label="Close"></button> <h2 class="notification-title svelte-12566qp"> </h2> <p class="notification-message svelte-12566qp"> </p> <div class="notification-actions svelte-12566qp"></div></div></div>');function Vk(n,t){Qe(t,!0);let e=Rt(!1),s=Rt("Notice"),r=Rt(""),i=Rt(Tn([{text:"OK",primary:!0}]));function o(p){p.target===p.currentTarget&&St(e,!1)}function A(p){(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),St(e,!1))}function a(p){p.key==="Escape"&&Z(e)&&St(e,!1)}function l(p){p.action?p.action():St(e,!1)}var c=Gc();Bo("keydown",of,a);var u=pa(c);{var d=p=>{var h=Ok();h.__click=o,h.__keydown=A;var m=Te(h),g=Te(m);g.__click=()=>St(e,!1);var v=Ge(g,2),w=Te(v),y=Ge(v,2),I=Te(y),B=Ge(y,2);XL(B,21,()=>Z(i),zL,(C,b)=>{var S=Hk();S.__click=()=>l(Z(b));var T=Te(S);_i(()=>{MC(S,1,`notification-button ${Z(b).primary?"":"secondary"}`,"svelte-12566qp"),oc(T,Z(b).text)}),Un(C,S)}),_i(()=>{oc(w,Z(s)),oc(I,Z(r))}),Un(p,h)};Ka(u,p=>{Z(e)&&p(d)})}Un(n,c),Ue()}Gu(["click","keydown"]);var Wk=ni('<div class="zoom-indicator svelte-lpl7xl"> </div>');function Gk(n,t){Qe(t,!0);let e=Rt(!1),s=Rt("Zoom: 100%"),r=null;function i(){let c=100,u="";const d=qe.getViewportInfo();if(d)if(c=Math.round((d.zoomLevel??1)*100),d.canSeeFullRange)u=" (Full Range)";else{const p=d.startRank??d.startRow??0,h=d.endRank??d.endRow??p;u=` (~${Math.max(0,Math.floor(h-p))} semitones)`}St(s,`Zoom: ${c}%${u}`)}function o(){i(),St(e,!0),r!==null&&clearTimeout(r),r=setTimeout(()=>{St(e,!1),r=null},2e3)}Qn(()=>{const c=()=>o();return f.on("zoomIn",c),f.on("zoomOut",c),()=>{f.off("zoomIn",c),f.off("zoomOut",c),r!==null&&clearTimeout(r)}});var A=Gc(),a=pa(A);{var l=c=>{var u=Wk(),d=Te(u);_i(()=>oc(d,Z(s))),Un(c,u)};Ka(a,c=>{Z(e)&&c(l)})}Un(n,A),Ue()}const Ba=()=>{if(typeof window>"u")return!1;const n=window.__initDebug;return n===!0},js=(n,t)=>{if(Ba()){if(t===void 0){console.log(`[SvelteMount] ${n}`);return}console.log(`[SvelteMount] ${n}`,t)}};let Y0=!1;const RC=()=>{if(!Y0&&(Y0=!0,!(typeof window>"u")))try{const n=window,t=new URLSearchParams(window.location.search),e=t.get("allowSvelte")??t.get("onlySvelte"),s=t.get("skipSvelte"),r=t.get("skipSvelteAll")==="1";if(!Array.isArray(n.__svelteAllowComponents)||n.__svelteAllowComponents.length===0){if(e==="*"||e==="all")n.__svelteAllowComponents=["*"];else if(e){const i=e.split(",").map(o=>o.trim()).filter(Boolean);i.length>0&&(n.__svelteAllowComponents=i)}}if(!Array.isArray(n.__svelteSkipComponents)||n.__svelteSkipComponents.length===0){if(r||s==="*"||s==="all")n.__svelteSkipComponents=["*"];else if(s){const i=s.split(",").map(o=>o.trim()).filter(Boolean);i.length>0&&(n.__svelteSkipComponents=i)}}Ba()&&(n.__svelteAllowComponents&&console.warn("[SvelteMount] allow list",n.__svelteAllowComponents),n.__svelteSkipComponents&&console.warn("[SvelteMount] skip list",n.__svelteSkipComponents))}catch(n){console.error("[SvelteMount] filter list parse failed",n)}},HC=n=>{if(typeof window>"u")return!1;RC();const t=window.__svelteAllowComponents;if(Array.isArray(t)&&t.length>0)return!(t.includes("*")||t.includes(n));const e=window.__svelteSkipComponents;return!Array.isArray(e)||e.length===0?!1:e.includes("*")||e.includes(n)},OC={"playback-controls":uD,"playback-controls-bridge":dD,"file-actions-bridge":hD,"grid-controls-bridge":fD,"modulation-bridge":pD,"sidebar-bridge":RD,"tool-selector-bridge":qD,"audio-controls-bridge":rk,"tab-management-bridge":ik,"print-preview-bridge":ok,"store-context":Ik,"adsr-envelope":Uk,"effects-cartesian-slider":Rk,"filter-controls-bridge":Fk,"notification-modal":Vk,"zoom-indicator":Gk},Xc=[];function Kk(){RC();const n=document.querySelectorAll("[data-svelte-component]");js("placeholders found",n.length),n.forEach(t=>{const e=t.getAttribute("data-svelte-component");if(!e)return;const s=OC[e];if(!s){console.warn(`[Svelte] Unknown component: ${e}`);return}try{if(HC(e)){js("mount:skip",e),Ba()&&console.warn(`[Svelte] Skipped: ${e}`);return}js("mount:start",e),t.innerHTML="";const r=TC(s,{target:t});Xc.push({target:t,component:r}),Ba()&&console.log(`[Svelte] Mounted: ${e}`),js("mount:done",e)}catch(r){console.error(`[Svelte] Failed to mount ${e}:`,r),js("mount:failed",e)}}),js("mountSvelteComponents:complete")}function qk(){Xc.forEach(({component:n})=>{try{qL(n)}catch(t){console.error("[Svelte] Failed to unmount component:",t)}}),Xc.length=0}function j0(n,t){const e=OC[n];if(!e)return console.error(`[Svelte] Unknown component: ${n}`),null;if(HC(n))return js("mount:skip",n),Ba()&&console.warn(`[Svelte] Skipped: ${n}`),null;const s=typeof t=="string"?document.querySelector(t):t;if(!s)return console.error(`[Svelte] Target not found: ${t}`),null;js("mount:start",n);const r=TC(e,{target:s});return Xc.push({target:s,component:r}),js("mount:done",n),r}Gu(["input","mousedown","keydown"]);const zk=()=>{if(typeof window>"u")return!1;const n=window.__initDebug;return n===!0},kl=(n,t)=>{if(zk()){console.log(`[InitUiComponents] ${n}`);return}};function $k(){kl("start"),_5.init(),kl("mountSvelteComponents:start"),Kk(),kl("mountSvelteComponents:done"),E.initSuccess("UiComponents"),kl("done")}const Od=()=>window.synthEngine??null,J0=()=>window.animationEffectsManager??null;E.moduleLoaded("DynamicWaveformVisualizer");class Xk{constructor(){M(this,"canvas",null);M(this,"ctx",null);M(this,"currentColor",null);M(this,"isPlaybackActive",!1);M(this,"liveAnalysers",new Map);M(this,"liveWaveforms",new Map);M(this,"playbackAnimationId",null);M(this,"animationSpeed",100);M(this,"frameSkipCounter",0);M(this,"onWaveformUpdate")}initialize(t,e){var s;return this.canvas=t,this.ctx=e,this.currentColor=((s=f.state.selectedNote)==null?void 0:s.color)||"#4a90e2",this.setupEventListeners(),E.info("DynamicWaveformVisualizer","Initialized with canvas context",null,"waveform"),!0}setupEventListeners(){f.on("noteChanged",({newNote:t}={})=>{t!=null&&t.color&&t.color!==this.currentColor&&(this.currentColor=t.color)}),f.on("playbackStateChanged",({isPlaying:t=!1,isPaused:e=!1}={})=>{t&&!e?this.startLiveVisualization():this.stopLiveVisualization()}),f.on("spacebarPlayback",({color:t,isPlaying:e=!1}={})=>{e&&t?this.startSingleNoteVisualization(t):this.stopLiveVisualization()}),f.on("tremoloAmplitudeUpdate",({activeColors:t}={})=>{this.isPlaybackActive&&(t!=null&&t.some(e=>this.liveWaveforms.has(e)))&&E.debug("DynamicWaveformVisualizer","Tremolo update received for active colors",t,"waveform")}),E.info("DynamicWaveformVisualizer","Event subscriptions established",null,"waveform")}setAnimationSpeed(t){this.animationSpeed=t,this.frameSkipCounter=0}startLiveVisualization(){this.isPlaybackActive||(this.isPlaybackActive=!0,this.setupLiveAnalysers(),this.updateContainerState(!0),this.animateLiveWaveforms(),E.debug("DynamicWaveformVisualizer","Started live visualization",null,"waveform"))}startSingleNoteVisualization(t){this.isPlaybackActive||(this.isPlaybackActive=!0,this.setupSingleAnalyser(t),this.updateContainerState(!0),this.animateLiveWaveforms(),E.debug("DynamicWaveformVisualizer",`Started single note visualization for ${t}`,null,"waveform"))}stopLiveVisualization(){this.isPlaybackActive=!1;const t=Od();this.liveAnalysers.forEach((e,s)=>{var r;(r=t==null?void 0:t.removeWaveformAnalyzer)==null||r.call(t,s)}),this.liveAnalysers.clear(),this.liveWaveforms.clear(),this.playbackAnimationId&&(cancelAnimationFrame(this.playbackAnimationId),this.playbackAnimationId=null),this.updateContainerState(!1),E.debug("DynamicWaveformVisualizer","Stopped live visualization",null,"waveform")}updateContainerState(t){var s;const e=(s=this.canvas)==null?void 0:s.parentElement;e&&(t?(e.classList.add("live-mode"),f.state.isPlaying&&!f.state.isPaused&&e.classList.add("pulsing")):e.classList.remove("live-mode","pulsing"))}setupLiveAnalysers(){const t=Od();if(!t){E.warn("DynamicWaveformVisualizer","SynthEngine not available for live analysis",null,"waveform");return}this.getActivePlayingColors().forEach(s=>{var i;const r=(i=t.createWaveformAnalyzer)==null?void 0:i.call(t,s);r&&(this.liveAnalysers.set(s,r),this.liveWaveforms.set(s,new Float32Array(1024)),E.debug("DynamicWaveformVisualizer",`Created analyser for ${s}`,null,"waveform"))})}setupSingleAnalyser(t){var r;const e=Od();if(!e)return;const s=(r=e.createWaveformAnalyzer)==null?void 0:r.call(e,t);s&&(this.liveAnalysers.set(t,s),this.liveWaveforms.set(t,new Float32Array(1024)),E.debug("DynamicWaveformVisualizer",`Created single analyser for ${t}`,null,"waveform"))}getActivePlayingColors(){const t=new Set,e=f.state.placedNotes;f.state.isPlaying&&e.forEach(r=>{!r.isDrum&&r.color&&t.add(r.color)}),t.size===0&&this.currentColor&&t.add(this.currentColor);const s=Array.from(t);return E.debug("DynamicWaveformVisualizer","Active playing colors detected",s,"waveform"),s}animateLiveWaveforms(){var e;if(!this.isPlaybackActive)return;this.frameSkipCounter++;const t=Math.max(1,Math.floor(100/Math.max(this.animationSpeed,1)));if(this.frameSkipCounter%t!==0){this.playbackAnimationId=requestAnimationFrame(()=>this.animateLiveWaveforms());return}this.liveAnalysers.forEach((s,r)=>{const i=s.getValue();this.liveWaveforms.set(r,i)}),(e=this.onWaveformUpdate)==null||e.call(this),this.playbackAnimationId=requestAnimationFrame(()=>this.animateLiveWaveforms())}drawLiveWaveforms(t,e,s){if(!this.ctx)return;const i=Array.from(this.liveWaveforms.keys());if(i.length===1){const o=i[0];if(!o)return;const A=this.liveWaveforms.get(o);this.drawSingleLiveWaveform(A,o,t,e,s)}else i.length>1&&i.forEach(o=>{if(!o)return;const A=this.liveWaveforms.get(o);this.drawLayeredLiveWaveform(A,o,t,e,s,i.length)})}drawSingleLiveWaveform(t,e,s,r,i){const o=this.ctx;if(!o||!t||t.length===0)return;const A=J0();let a=i;if(A){const g=A.getTremoloAmplitudeMultiplier(e);a*=g}let l=0;const c=A==null?void 0:A.vibratoCanvasEffect,u=c==null?void 0:c.animations.get(e);c&&u&&c.shouldBeRunning()&&(l=Math.sin(u.phase)*u.amplitude*.4);let d=0;for(let g=0;g<t.length;g++){const v=t[g]??0;d=Math.max(d,Math.abs(v))}const p=d>1?1/d:1;o.strokeStyle=e,o.lineWidth=2,o.beginPath();const m=t.length/s*(1+l);for(let g=0;g<s;g++){const v=l*s*.3,w=g+v,y=Math.floor(w*m),I=Math.max(0,Math.min(t.length-1,y)),B=(t[I]??0)*p,C=r-B*a;g===0?o.moveTo(g,C):o.lineTo(g,C)}o.stroke(),E.debug("DynamicWaveformVisualizer",`Drew single live waveform for ${e} with tremolo and vibrato stretch`,{amplitudeRatio:a/i,vibratoStretch:l},"waveform")}drawLayeredLiveWaveform(t,e,s,r,i,o){const A=this.ctx;if(!A||!t||t.length===0)return;const a=J0();let l=i;a&&(l*=a.getTremoloAmplitudeMultiplier(e));let c=0;const u=a==null?void 0:a.vibratoCanvasEffect,d=u==null?void 0:u.animations.get(e);u&&d&&u.shouldBeRunning()&&(c=Math.sin(d.phase)*d.amplitude*.4);let p=0;for(let w=0;w<t.length;w++){const y=t[w]??0;p=Math.max(p,Math.abs(y))}const h=p>1?1/p:1,m=Math.max(.4,1/o);A.strokeStyle=xs(e,m*2),A.lineWidth=1.5,A.beginPath();const v=t.length/s*(1+c);for(let w=0;w<s;w++){const y=c*s*.3,I=w+y,B=Math.floor(I*v),C=Math.max(0,Math.min(t.length-1,B)),b=(t[C]??0)*h,S=r-b*l*.7;w===0?A.moveTo(w,S):A.lineTo(w,S)}A.stroke()}isLiveMode(){return this.isPlaybackActive}getLiveColors(){return Array.from(this.liveWaveforms.keys())}dispose(){this.stopLiveVisualization(),E.info("DynamicWaveformVisualizer","Disposed",null,"waveform")}}const Yk=512,ai=360,hA=480,jk=()=>window.animationEffectsManager;E.moduleLoaded("StaticWaveformVisualizer");class Jk{constructor(){M(this,"canvas",null);M(this,"ctx",null);M(this,"currentColor",null);M(this,"animationFrameId",null);M(this,"waveformData",new Float32Array(Yk));M(this,"isInitialized",!1);M(this,"isTransitioning",!1);M(this,"transitionStartTime",0);M(this,"transitionDuration",300);M(this,"fromWaveform",null);M(this,"toWaveform",null);M(this,"transitionAnimationId",null);M(this,"dynamicVisualizer",new Xk);M(this,"animationSpeed",100);M(this,"frameSkipCounter",0);M(this,"resizeObserver",null);M(this,"calculatedAmplitude",0);E.info("StaticWaveformVisualizer","Initialized with dynamic visualizer integration",null,"waveform")}initialize(){var s,r;if(this.canvas=document.getElementById("static-waveform-canvas"),!this.canvas)return!1;const t=this.canvas.getContext("2d");if(!t)return!1;this.ctx=t,this.currentColor=((s=f.state.selectedNote)==null?void 0:s.color)||"#4a90e2";const e=this.canvas.parentElement;return e&&typeof ResizeObserver<"u"&&((r=this.resizeObserver)==null||r.disconnect(),this.resizeObserver=new ResizeObserver(()=>this.resize()),this.resizeObserver.observe(e)),this.resize(),this.setupEventListeners(),this.dynamicVisualizer.initialize(this.canvas,this.ctx),this.dynamicVisualizer.onWaveformUpdate=()=>this.draw(),this.generateWaveform(),this.isInitialized=!0,!0}resize(){if(!this.canvas||!this.ctx)return;const t=this.canvas.parentElement;if(!t)return;const{clientWidth:e,clientHeight:s}=t,r=this.canvas.width,i=this.canvas.height;if((e===0||s===0)&&this.canvas.width>0&&this.canvas.height>0)return;const A=Math.abs(e-r),a=Math.abs(s-i);(A>2||a>2)&&(this.canvas.width=e,this.canvas.height=s,this.draw())}setupEventListeners(){f.on("noteChanged",(e={})=>{var r;const s=(r=e.newNote)==null?void 0:r.color;s&&s!==this.currentColor&&(this.currentColor=s,this.generateWaveform())}),f.on("timbreChanged",e=>{e&&e===this.currentColor&&this.generateWaveform()}),f.on("waveformExtendedViewChanged",()=>{this.generateWaveform(),this.updateToggleButton()}),document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{e.dataset.tab==="timbre"&&setTimeout(()=>this.resize(),100)})}),this.setupSpeedControls(),this.setupExtendToggle()}setupSpeedControls(){const t=Array.from(document.querySelectorAll(".waveform-speed-btn"));t.length!==0&&t.forEach(e=>{e.addEventListener("click",()=>{const s=e.dataset.speed,r=s?parseInt(s,10):NaN;Number.isFinite(r)&&(e.classList.contains("active")?(e.classList.remove("active"),this.setAnimationSpeed(100)):(t.forEach(i=>i.classList.remove("active")),e.classList.add("active"),this.setAnimationSpeed(r)))})})}setAnimationSpeed(t){Number.isFinite(t)&&(this.animationSpeed=t,this.frameSkipCounter=0,this.dynamicVisualizer.setAnimationSpeed(t))}setupExtendToggle(){const t=document.getElementById("waveform-extend-toggle");t instanceof HTMLElement&&(t.addEventListener("click",()=>{f.toggleWaveformExtendedView()}),this.updateToggleButton())}updateToggleButton(){const t=document.getElementById("waveform-extend-toggle");if(!(t instanceof HTMLElement))return;const e=f.state.waveformExtendedView;t.classList.toggle("extended",e),t.textContent=e?"480 View":"360 View",t.title=e?"Switch to 360 waveform view":"Switch to 480 waveform view (shows extra 120)"}generateWaveform(){if(this.isTransitioning||!this.currentColor)return;const t=f.state.timbres[this.currentColor];if(!(t!=null&&t.coeffs))return;const e=Wh(this.currentColor),s=t.phases??new Float32Array(Io),r=this.waveformData.length;this.waveformData.fill(0);let i=0;for(let o=0;o<r;o++){const a=(f.state.waveformExtendedView?hA:ai)/ai,l=o/r*a*2*Math.PI;let c=0;for(let u=0;u<Io;u++){const d=e[u]??0;if(d<=.001)continue;const p=s[u]??0,h=u+1;c+=d*Math.sin(h*l+p)}this.waveformData[o]=c,i=Math.max(i,Math.abs(c))}if(this.calculatedAmplitude=Math.min(1,i),i>1){const o=1/i;for(let A=0;A<this.waveformData.length;A++){const a=this.waveformData[A]??0;this.waveformData[A]=a*o}}this.draw()}startPhaseTransition(t,e,s){!this.isInitialized||!this.currentColor||(this.isTransitioning&&this.transitionAnimationId&&cancelAnimationFrame(this.transitionAnimationId),this.fromWaveform=new Float32Array(this.waveformData),this.generateTargetWaveform(e),this.toWaveform=new Float32Array(this.waveformData),this.waveformData=this.fromWaveform,this.isTransitioning=!0,this.transitionStartTime=performance.now(),this.animateTransition())}generateTargetWaveform(t){if(!this.currentColor||!t)return;const e=f.state.timbres[this.currentColor];if(!(e!=null&&e.coeffs))return;const s=Wh(this.currentColor),r=t instanceof Float32Array?t:new Float32Array(t),i=this.waveformData.length;this.waveformData.fill(0);let o=0;for(let A=0;A<i;A++){const l=(f.state.waveformExtendedView?hA:ai)/ai,c=A/i*l*2*Math.PI;let u=0;for(let d=0;d<Io;d++){const p=s[d]??0;if(p<=.001)continue;const h=r[d]??0,m=d+1;u+=p*Math.sin(m*c+h)}this.waveformData[A]=u,o=Math.max(o,Math.abs(u))}if(this.calculatedAmplitude=Math.min(1,o),o>1){const A=1/o;for(let a=0;a<this.waveformData.length;a++){const l=this.waveformData[a]??0;this.waveformData[a]=l*A}}}animateTransition(){const t=this.fromWaveform,e=this.toWaveform;if(!this.isTransitioning||!t||!e)return;const s=performance.now()-this.transitionStartTime,r=Math.min(s/this.transitionDuration,1),i=1-Math.pow(1-r,3);for(let o=0;o<this.waveformData.length;o++){const A=t[o]??0,a=e[o]??0;this.waveformData[o]=A+(a-A)*i}this.draw(),r>=1?(this.isTransitioning=!1,this.fromWaveform=null,this.toWaveform=null,this.transitionAnimationId=null):this.transitionAnimationId=requestAnimationFrame(()=>this.animateTransition())}normalizeWaveform(){let t=0;for(let e=0;e<this.waveformData.length;e++){const s=this.waveformData[e]??0;t=Math.max(t,Math.abs(s))}if(t>0){const e=.9/t;for(let s=0;s<this.waveformData.length;s++){const r=this.waveformData[s]??0;this.waveformData[s]=r*e}}}draw(){const t=this.ctx,e=this.canvas;if(!t||!e)return;const{width:s,height:r}=e,i=r/2,o=r/2;t.fillStyle="#ffffff",t.fillRect(0,0,s,r),this.drawGrid(s,r,i,o),this.dynamicVisualizer.isLiveMode()?this.dynamicVisualizer.drawLiveWaveforms(s,i,o):this.drawWaveform(s,i,o),s>200&&r>100&&this.drawLabels(s,r)}drawGrid(t,e,s,r){const i=this.ctx;if(!i)return;i.strokeStyle="#ced4da",i.lineWidth=1,i.setLineDash([2,2]),i.beginPath(),i.moveTo(0,s),i.lineTo(t,s),i.stroke();const o=f.state.waveformExtendedView?hA:ai;if((f.state.waveformExtendedView?[90,180,270,360,450]:[90,180,270]).forEach(u=>{const d=t/o*u;i.beginPath(),i.moveTo(d,0),i.lineTo(d,e),i.stroke()}),f.state.waveformExtendedView){const u=t/hA*ai;i.fillStyle="rgba(128, 128, 128, 0.15)",i.fillRect(u,0,t-u,e)}[.5].forEach(u=>{const d=s-r*u,p=s+r*u;i.beginPath(),i.moveTo(0,d),i.lineTo(t,d),i.moveTo(0,p),i.lineTo(t,p),i.stroke()}),i.setLineDash([]),i.strokeStyle="#999999",i.lineWidth=1;const l=s-r,c=s+r;i.beginPath(),i.moveTo(0,l),i.lineTo(t,l),i.stroke(),i.beginPath(),i.moveTo(0,c),i.lineTo(t,c),i.stroke()}drawWaveform(t,e,s){const r=this.ctx;if(!r||this.waveformData.length===0)return;const i=this.currentColor||"#4a90e2";r.strokeStyle=i,r.lineWidth=2,r.beginPath();const o=this.waveformData.length/t;for(let a=0;a<t;a++){const l=Math.floor(a*o),c=this.waveformData[l]||0,u=e-c*s;a===0?r.moveTo(a,u):r.lineTo(a,u)}r.stroke(),r.lineTo(t,e),r.lineTo(0,e),r.closePath();const A=r.createLinearGradient(0,e-s,0,e+s);A.addColorStop(0,xs(i,.3)),A.addColorStop(.5,xs(i,.1)),A.addColorStop(1,xs(i,.3)),r.fillStyle=A,r.fill()}drawLabels(t,e){const s=this.ctx;if(!s)return;const r=f.state.waveformExtendedView,i=r?hA:ai,o=r?["0","90","180","270","360","450"]:["0","90","180","270","360"],A=r?[0,90,180,270,360,450]:[0,90,180,270,360];s.fillStyle="#666666",s.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',s.textAlign="center",o.forEach((a,l)=>{const c=A[l]??0,u=t/i*c+10;s.fillText(a,u,e/2+4)}),s.textAlign="left",s.fillText("+1.0",5,15),s.fillText("-1.0",5,e-8)}getNormalizedAmplitude(){return this.calculatedAmplitude||0}getADSRTremoloAmplitude(){const t=this.calculatedAmplitude||0,e=jk();if(this.currentColor&&(e!=null&&e.getADSRTremoloAmplitudeMultiplier)){const s=e.getADSRTremoloAmplitudeMultiplier(this.currentColor);return t*s}return t}startSingleNoteVisualization(t){this.dynamicVisualizer.startSingleNoteVisualization(t)}stopLiveVisualization(){this.dynamicVisualizer.stopLiveVisualization()}startLiveVisualization(){this.dynamicVisualizer.startLiveVisualization()}dispose(){var t;this.dynamicVisualizer.dispose(),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.transitionAnimationId&&(cancelAnimationFrame(this.transitionAnimationId),this.transitionAnimationId=null),(t=this.resizeObserver)==null||t.disconnect(),this.resizeObserver=null,this.isTransitioning=!1,this.fromWaveform=null,this.toWaveform=null,this.isInitialized=!1}}const VC=new Jk;window.waveformVisualizer=VC;function Zk(){return VC.initialize()}class Xp{constructor(t){M(this,"effectName");M(this,"animations");M(this,"activeNoteAnimations");M(this,"ghostNoteAnimation");M(this,"activeSoundingNotes");M(this,"isPlaybackActive");M(this,"hasActiveInteraction");M(this,"hasDialInteraction");this.effectName=t,this.animations=new Map,this.activeNoteAnimations=new Map,this.ghostNoteAnimation=null,this.activeSoundingNotes=new Map,this.isPlaybackActive=!1,this.hasActiveInteraction=!1,this.hasDialInteraction=!1,E.info(`${t}AnimationEffect`,"Base initialized",null,"animation")}initBase(){f.on("visualEffectChanged",t=>{if(!t)return;const{effectType:e,color:s,effectParams:r}=t;e===this.effectName.toLowerCase()&&this.updateAnimationParameters(s,r)}),f.on("playbackStarted",()=>{this.isPlaybackActive=!0,this.requestAnimationStateUpdate()}),f.on("playbackStopped",()=>{this.isPlaybackActive=!1,this.activeNoteAnimations.clear(),this.activeSoundingNotes.clear(),this.requestAnimationStateUpdate()}),f.on("noteInteractionStart",t=>{t&&this.onNoteInteractionStart(t.noteId,t.color)}),f.on("noteInteractionEnd",t=>{const e=t==null?void 0:t.noteId;e&&this.onNoteInteractionEnd(e)}),f.on("ghostNoteUpdated",t=>{t&&this.onGhostNoteUpdated(t.color)}),f.on("ghostNoteCleared",()=>this.onGhostNoteCleared()),f.on("spacebarPlayback",t=>{t&&(this.isPlaybackActive=t.isPlaying,this.requestAnimationStateUpdate())}),f.on("noteAttack",t=>{t&&this.onNoteAttack(t.noteId,t.color)}),f.on("noteRelease",t=>{t&&this.onNoteRelease(t.noteId,t.color)}),f.on("effectDialInteractionStart",t=>{t&&t.effectType===this.effectName.toLowerCase()&&this.onDialInteractionStart(t.color)}),f.on("effectDialInteractionEnd",t=>{t&&t.effectType===this.effectName.toLowerCase()&&this.onDialInteractionEnd(t.color)}),E.info(`${this.effectName}AnimationEffect`,"Base event subscriptions established",null,"animation")}shouldAnimateColor(t){return this.animations.has(t)}shouldAnimateNote(t){if(!(t!=null&&t.color)||!this.shouldAnimateColor(t.color))return!1;if(this.hasDialInteraction&&this.activeNoteAnimations.has("dial-preview")){const e=this.activeNoteAnimations.get("dial-preview");if(e&&t.color===e)return!0}return!!(this.isPlaybackActive&&t.uuid&&this.activeSoundingNotes.has(t.uuid)||this.hasActiveInteraction&&t.uuid&&this.activeNoteAnimations.has(t.uuid)||!t.uuid&&this.ghostNoteAnimation&&this.ghostNoteAnimation.color===t.color&&this.isPlaybackActive)}shouldBeRunning(){const t=this.animations.size>0;return t?!!(this.isPlaybackActive||this.hasActiveInteraction||this.hasDialInteraction||this.ghostNoteAnimation!==null||t):!1}onNoteInteractionStart(t,e){this.shouldAnimateColor(e)&&(this.activeNoteAnimations.set(t,e),this.hasActiveInteraction=!0,E.debug(`${this.effectName}AnimationEffect`,`Started interaction animation for note ${t} (${e})`,null,"animation"),this.requestAnimationStateUpdate())}onNoteInteractionEnd(t){this.activeNoteAnimations.delete(t),this.hasActiveInteraction=this.activeNoteAnimations.size>0,E.debug(`${this.effectName}AnimationEffect`,`Ended interaction animation for note ${t}`,null,"animation"),this.requestAnimationStateUpdate()}onGhostNoteUpdated(t){this.shouldAnimateColor(t)?(this.ghostNoteAnimation={color:t,active:!0},E.debug(`${this.effectName}AnimationEffect`,`Ghost note animation updated for color ${t}`,null,"animation")):this.ghostNoteAnimation=null}onGhostNoteCleared(){this.ghostNoteAnimation=null,E.debug(`${this.effectName}AnimationEffect`,"Ghost note animation cleared",null,"animation")}onNoteAttack(t,e){this.shouldAnimateColor(e)&&(this.activeSoundingNotes.set(t,e),E.debug(`${this.effectName}AnimationEffect`,`Note attack: ${t} (${e}) added to active sounding notes`,null,"animation"),this.requestAnimationStateUpdate())}onNoteRelease(t,e){this.activeSoundingNotes.delete(t),E.debug(`${this.effectName}AnimationEffect`,`Note release: ${t} (${e}) removed from active sounding notes`,null,"animation"),this.requestAnimationStateUpdate()}onDialInteractionStart(t){this.shouldAnimateColor(t)&&(this.hasDialInteraction=!0,this.activeNoteAnimations.set("dial-preview",t),E.debug(`${this.effectName}AnimationEffect`,`Dial interaction started for ${t}`,null,"animation"),this.requestAnimationStateUpdate())}onDialInteractionEnd(t){this.hasDialInteraction=!1,this.activeNoteAnimations.delete("dial-preview"),E.debug(`${this.effectName}AnimationEffect`,`Dial interaction ended for ${t}`,null,"animation"),this.requestAnimationStateUpdate()}getActiveColors(){const t=new Set;for(const[,e]of this.activeSoundingNotes.entries())this.shouldAnimateColor(e)&&t.add(e);for(const[,e]of this.activeNoteAnimations.entries())this.shouldAnimateColor(e)&&t.add(e);return this.ghostNoteAnimation&&this.shouldAnimateColor(this.ghostNoteAnimation.color)&&t.add(this.ghostNoteAnimation.color),Array.from(t)}disposeBase(){this.animations.clear(),this.activeNoteAnimations.clear(),this.activeSoundingNotes.clear(),this.ghostNoteAnimation=null,E.info(`${this.effectName}AnimationEffect`,"Base disposed",null,"animation")}requestAnimationStateUpdate(){var t;(t=window.animationEffectsManager)==null||t.updateAnimationState()}}E.moduleLoaded("VibratoCanvasEffect");class tR extends Xp{constructor(){super("Vibrato"),E.info("VibratoCanvasEffect","Initialized for canvas note positions",null,"animation")}init(){return this.initBase(),E.info("VibratoCanvasEffect","Ready for canvas animation",null,"animation"),!0}updateAnimationParameters(t,e){const{speed:s,span:r}=e;if(s===0||r===0)this.animations.delete(t),E.debug("VibratoCanvasEffect",`Disabled vibrato animation for ${t}`,null,"animation");else{const i=this.animations.get(t),o=s/100*16,A=r/100*.5,a={frequency:o,amplitude:A,phase:(i==null?void 0:i.phase)||0,lastUpdate:performance.now()};this.animations.set(t,a),E.debug("VibratoCanvasEffect",`Updated vibrato animation for ${t}`,{frequency:o,amplitude:A,preservedPhase:!!i},"animation")}}updateAnimationPhases(t){this.animations.forEach(e=>{const s=(t-e.lastUpdate)/1e3;e.phase+=e.frequency*s*2*Math.PI,e.lastUpdate=t,e.phase>4*Math.PI&&(e.phase-=4*Math.PI)})}getVibratoYOffset(t){if(!t)return 0;const e=this.animations.get(t);if(!e||window.animationEffectsManager&&!window.animationEffectsManager.shouldVibratoBeRunning())return 0;const s=Math.sin(e.phase),r=-s*e.amplitude;return E.debug("VibratoCanvasEffect","Visual vibrato",{sine:s.toFixed(3),offset:r.toFixed(3),phase:e.phase.toFixed(3)},"effects"),r}shouldBeRunning(){return this.animations.size>0?this.isPlaybackActive||this.hasActiveInteraction||this.hasDialInteraction||this.ghostNoteAnimation!==null&&this.isPlaybackActive:!1}shouldAnimateColor(t){const e=this.animations.get(t);return e?e.frequency>0&&e.amplitude>0:!1}dispose(){this.disposeBase(),E.info("VibratoCanvasEffect","Disposed",null,"animation")}}E.moduleLoaded("TremoloWaveformEffect");class eR extends Xp{constructor(){super("Tremolo"),E.info("TremoloWaveformEffect","Initialized for waveform/ADSR amplitude",null,"animation")}init(){return this.initBase(),E.info("TremoloWaveformEffect","Ready for waveform/ADSR animation",null,"animation"),!0}updateAnimationParameters(t,e){var i,o;const{speed:s,span:r}=e;if(s===0||r===0)this.animations.delete(t),E.debug("TremoloWaveformEffect",`Disabled tremolo animation for ${t}`,null,"animation");else{const A=this.animations.get(t),a=s/100*16,l=r/100,c=(o=(i=window.Tone)==null?void 0:i.now)==null?void 0:o.call(i),u=typeof c=="number"?c*1e3:performance.now(),d={frequency:a,span:l,phase:(A==null?void 0:A.phase)||0,lastUpdate:u};this.animations.set(t,d),E.debug("TremoloWaveformEffect",`Updated tremolo animation for ${t}`,{frequency:a,span:l,preservedPhase:!!A},"animation")}}updateAnimationPhases(t){var i,o,A,a;let e=0;const s=(o=(i=window.Tone)==null?void 0:i.now)==null?void 0:o.call(i),r=typeof s=="number"?s*1e3:t;if(this.animations.forEach((l,c)=>{const u=(r-l.lastUpdate)/1e3,d=l.phase;l.phase+=l.frequency*u*2*Math.PI,l.lastUpdate=r,e++,Math.abs(l.phase-d)<.001&&E.warn("TremoloWaveformEffect",`Phase not advancing for ${c}`,{deltaSeconds:Number(u.toFixed(4)),frequency:l.frequency},"animation"),l.phase>4*Math.PI&&(l.phase-=4*Math.PI)}),e>0&&Math.random()<.05){const l=(A=window.Tone)!=null&&A.now?"Tone.js":"performance";E.debug("TremoloWaveformEffect","Timing sample",{hasTone:!!window.Tone,hasToneNow:!!((a=window.Tone)!=null&&a.now),toneTime:r,currentTime:t,timingSource:l},"animation")}}getTremoloAmplitudeMultiplier(t){var m,g,v;const e=this.animations.get(t);if(!e||window.animationEffectsManager&&!window.animationEffectsManager.shouldTremoloBeRunning())return 1;const s=((m=window.waveformVisualizer)==null?void 0:m.calculatedAmplitude)??1,r=Math.sin(e.phase),i=e.span,o=s,A=s*(1-i),a=(o+A)/2,l=(o-A)/2,u=(a+r*l)/s,d=(v=(g=window.Tone)==null?void 0:g.now)==null?void 0:v.call(g),h=(typeof d=="number"?d*1e3:performance.now())-e.lastUpdate;if(h>100&&e.span>0){const w=e.frequency*(h/1e3)*2*Math.PI;w>.1&&E.warn("TremoloWaveformEffect",`Phase stagnation detected for ${t}`,{phase:Number(e.phase.toFixed(3)),millisecondsSinceUpdate:Number(h.toFixed(1)),expectedAdvancement:Number(w.toFixed(3))},"animation")}return Math.max(0,Math.min(1,u))}getADSRTremoloAmplitudeMultiplier(t){return this.getTremoloAmplitudeMultiplier(t)}shouldAnimateColor(t){const e=this.animations.get(t);return e?e.frequency>0&&e.span>0:!1}dispose(){this.disposeBase(),E.info("TremoloWaveformEffect","Disposed",null,"animation")}}E.moduleLoaded("EnvelopeFillEffect");class nR{constructor(){M(this,"activeFills");M(this,"instanceId");this.activeFills=new Map,this.instanceId=Math.random().toString(36).substring(7),E.info("EnvelopeFillEffect","Initialized",null,"animation")}init(){f.on("noteAttack",t=>{var i,o;const e=t==null?void 0:t.noteId,s=t==null?void 0:t.color;if(!e||!s)return;const r=(i=f.state.timbres)==null?void 0:i[s];if(!r){E.warn("EnvelopeFillEffect","No timbre found for color",{color:s},"effects");return}this.activeFills.set(e,{fillLevel:0,color:s,startTime:be(),adsr:r.adsr,phase:"attack"}),E.debug("EnvelopeFillEffect",`Started fill animation for note ${e}`,null,"animation"),(o=window.animationEffectsManager)==null||o.updateAnimationState()}),f.on("noteRelease",t=>{const e=t==null?void 0:t.noteId;if(!e)return;const s=this.activeFills.get(e);s?(s.phase="release",s.releaseStartTime=be(),s.releaseStartLevel=s.fillLevel,E.debug("EnvelopeFillEffect",`Started release phase for note ${e}`,null,"animation")):E.warn("EnvelopeFillEffect","No fill data found for release",{noteId:e},"effects")}),f.on("playbackStopped",()=>{var t;this.activeFills.clear(),(t=window.animationEffectsManager)==null||t.updateAnimationState(),f.emit("animationUpdate",{type:"envelopeFill",activeColors:[],hasEnvelopeFills:!1})}),E.info("EnvelopeFillEffect","Event subscriptions established",null,"animation")}updateAnimationPhases(t){var s;const e=be();for(const[r,i]of this.activeFills.entries()){const{adsr:o,startTime:A,phase:a,releaseStartTime:l,releaseStartLevel:c}=i,u=e-A;if(a==="attack"){const d=o.attack||.01;u<d?i.fillLevel=u/d:(i.phase="decay",i.decayStartTime=e)}else if(a==="decay"){const d=o.decay||.1,p=e-(i.decayStartTime??e),h=o.sustain??.5;if(p<d){const m=p/d;i.fillLevel=1-m*(1-h)}else i.phase="sustain",i.fillLevel=h}else if(a==="sustain"){const d=o.sustain??.5;i.fillLevel=d}else if(a==="release"){const d=o.release||.5,p=l?e-l:0,h=c??i.fillLevel;if(p<d){const m=p/d;i.fillLevel=h*(1-m)}else this.activeFills.delete(r),E.debug("EnvelopeFillEffect",`Completed fill animation for note ${r}`,null,"animation"),this.activeFills.size===0&&((s=window.animationEffectsManager)==null||s.updateAnimationState())}}}getFillLevel(t){if(!t.uuid)return 0;const e=this.activeFills.get(t.uuid);return e?e.fillLevel:0}shouldFillNote(t){return t.uuid?this.activeFills.has(t.uuid):!1}shouldBeRunning(){return this.activeFills.size>0}dispose(){this.activeFills.clear(),E.info("EnvelopeFillEffect","Disposed",null,"animation")}}E.moduleLoaded("DelayADSREffect");class sR extends Xp{constructor(){super("Delay"),E.info("DelayADSREffect","Initialized for delay visualization (PLACEHOLDER)",null,"animation")}init(){return this.initBase(),E.info("DelayADSREffect","Ready for delay animation (PLACEHOLDER)",null,"animation"),!0}updateAnimationParameters(t,e){const{time:s,feedback:r}=e;if(s===0&&r===0)this.animations.delete(t),E.debug("DelayADSREffect",`Disabled delay animation for ${t}`,null,"animation");else{const i=s/100*500,o=r/100,A={delayTime:i,feedback:o,echoCount:Math.floor(o*5),lastTrigger:0,echoPhases:[],lastUpdate:performance.now()};this.animations.set(t,A),E.debug("DelayADSREffect",`Updated delay animation for ${t} (PLACEHOLDER)`,{delayTime:i,feedback:o},"animation")}}updateAnimationPhases(t){this.animations.forEach(e=>{e.lastUpdate=t})}getDelayEffects(t){const e=this.animations.get(t);if(!e)return[];const s=[];for(let r=0;r<e.echoCount;r++)s.push({delay:e.delayTime*(r+1),opacity:1-r*.3,scale:1-r*.1,active:!1});return s}triggerDelay(t,e){const s=this.animations.get(t);s&&(s.lastTrigger=e,E.debug("DelayADSREffect",`Triggered delay for ${t} (PLACEHOLDER)`,null,"animation"))}shouldBeRunning(){return this.animations.size>0?this.isPlaybackActive||this.hasActiveInteraction||this.ghostNoteAnimation!==null:!1}shouldAnimateColor(t){const e=this.animations.get(t);return e?e.delayTime>0||e.feedback>0:!1}dispose(){this.disposeBase(),E.info("DelayADSREffect","Disposed",null,"animation")}}E.moduleLoaded("AnimationEffectsManager");class rR{constructor(){M(this,"vibratoEffect");M(this,"tremoloEffect");M(this,"envelopeFillEffect");M(this,"delayEffect");M(this,"isRunning");M(this,"animationFrameId");M(this,"lastTime");M(this,"lastRenderTrigger");this.vibratoEffect=new tR,this.tremoloEffect=new eR,this.envelopeFillEffect=new nR,this.delayEffect=new sR,this.isRunning=!1,this.animationFrameId=null,this.lastTime=0,this.lastRenderTrigger=0,E.info("AnimationEffectsManager","Initialized with single animation loop",null,"animation")}init(){return this.vibratoEffect.init(),this.tremoloEffect.init(),this.envelopeFillEffect.init(),this.delayEffect.init(),f.on("visualEffectChanged",t=>{const e=t==null?void 0:t.effectType;(e==="vibrato"||e==="tremolo")&&(setTimeout(()=>this.updateAnimationState(),0),e==="tremolo"&&setTimeout(()=>this.triggerTremoloAmplitudeUpdate(),0))}),f.on("audioEffectChanged",t=>{if(!t)return;const{effectType:e,color:s,effectParams:r}=t;!s||!r||e==="delay"&&this.delayEffect.updateAnimationParameters(s,r)}),E.info("AnimationEffectsManager","Event subscriptions established",null,"animation"),!0}animate(t){this.isRunning&&(this.lastTime=t,this.vibratoEffect.updateAnimationPhases(t),this.tremoloEffect.updateAnimationPhases(t),this.envelopeFillEffect.updateAnimationPhases(t),this.triggerVisualUpdates(t),this.animationFrameId=requestAnimationFrame(e=>this.animate(e)))}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationFrameId=requestAnimationFrame(t=>this.animate(t)),E.debug("AnimationEffectsManager","Single animation loop started",null,"animation"))}stop(){this.isRunning&&(this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.triggerFinalUpdates(),E.debug("AnimationEffectsManager","Animation loop stopped",null,"animation"))}shouldTremoloBeRunning(){if(!(this.tremoloEffect.animations.size>0))return!1;const e=this.tremoloEffect.activeSoundingNotes.size>0,s=this.tremoloEffect.hasDialInteraction;return e||s}shouldVibratoBeRunning(){return this.vibratoEffect.animations.size>0?this.vibratoEffect.isPlaybackActive||this.vibratoEffect.hasActiveInteraction||this.vibratoEffect.hasDialInteraction||this.vibratoEffect.ghostNoteAnimation!==null:!1}shouldEnvelopeFillBeRunning(){return this.envelopeFillEffect.shouldBeRunning()}updateAnimationState(){const t=this.shouldVibratoBeRunning(),e=this.shouldTremoloBeRunning(),s=this.shouldEnvelopeFillBeRunning(),r=t||e||s;r&&!this.isRunning?this.start():!r&&this.isRunning&&this.stop()}triggerVisualUpdates(t){if(!this.lastRenderTrigger||t-this.lastRenderTrigger>=16.67){this.lastRenderTrigger=t;const e=this.vibratoEffect.getActiveColors(),s=this.tremoloEffect.getActiveColors(),r=this.envelopeFillEffect.activeFills.size>0;(e.length>0||r)&&f.emit("animationUpdate",{type:e.length>0?"vibrato":"envelopeFill",activeColors:e,hasEnvelopeFills:r}),s.length>0&&f.emit("tremoloAmplitudeUpdate",{activeColors:s})}}triggerFinalUpdates(){const t=Array.from(this.vibratoEffect.animations.keys());t.length>0&&f.emit("animationUpdate",{type:"vibrato",activeColors:t});const e=Array.from(this.tremoloEffect.animations.keys());e.length>0&&f.emit("tremoloAmplitudeUpdate",{activeColors:e})}shouldAnimateNote(t){return this.vibratoEffect.shouldAnimateNote(t)}getVibratoYOffset(t){return this.vibratoEffect.getVibratoYOffset(t)}getTremoloAmplitudeMultiplier(t){return this.tremoloEffect.getTremoloAmplitudeMultiplier(t)}getADSRTremoloAmplitudeMultiplier(t){return this.tremoloEffect.getADSRTremoloAmplitudeMultiplier(t)}getFillLevel(t){return this.envelopeFillEffect.getFillLevel(t)}shouldFillNote(t){return this.envelopeFillEffect.shouldFillNote(t)}getDelayEffects(t){return this.delayEffect.getDelayEffects(t)}hasDelayEffect(t){return this.delayEffect.shouldAnimateColor(t)}triggerTremoloAmplitudeUpdate(){const t=this.tremoloEffect.getActiveColors();t.length>0&&f.emit("tremoloAmplitudeUpdate",{activeColors:t})}getAllActiveColors(){const t=this.vibratoEffect.getActiveColors(),e=this.tremoloEffect.getActiveColors();return[...new Set([...t,...e])]}dispose(){this.stop(),this.vibratoEffect.dispose(),this.tremoloEffect.dispose(),this.envelopeFillEffect.dispose(),this.delayEffect.dispose(),E.info("AnimationEffectsManager","Disposed",null,"animation")}}const Z0=new rR;E.moduleLoaded("VibratoAudioEffect");class iR{constructor(){M(this,"currentSettings",new Map);E.info("VibratoAudioEffect","Initialized",null,"audio")}init(){return E.info("VibratoAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,e){const{speed:s,span:r}=t;this.currentSettings.set(e,{speed:s,span:r}),E.debug("VibratoAudioEffect",`Updated parameters for ${e}`,{speed:s,span:r},"audio")}applyToVoice(t,e){if(!t||typeof t._setVibrato!="function")return;const s=this.currentSettings.get(e);if(!s){E.debug("VibratoAudioEffect",`No vibrato settings found for color ${e}`,null,"audio");return}try{t._setVibrato(s),t.vibratoApplied=!0,E.debug("VibratoAudioEffect",`Applied vibrato to voice for ${e}`,s,"audio")}catch(r){E.warn("VibratoAudioEffect",`Failed to apply vibrato to voice for ${e}`,r,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{speed:0,span:0}}getEffectInstance(){return null}createVibratoSettings(t,e){if(t===0||e===0)return null;const s=t/100*16,r=e/100*50;return{frequency:s,depth:r}}disableForColor(t){this.updateParameters({speed:0,span:0},t)}dispose(){this.currentSettings.clear(),E.info("VibratoAudioEffect","Disposed",null,"audio")}}E.moduleLoaded("TremoloAudioEffect");class oR{constructor(){M(this,"currentSettings",new Map);E.info("TremoloAudioEffect","Initialized",null,"audio")}init(){return E.info("TremoloAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,e){const{speed:s,span:r}=t;this.currentSettings.set(e,{speed:s,span:r}),E.debug("TremoloAudioEffect",`Updated parameters for ${e}`,{speed:s,span:r},"audio")}applyToVoice(t,e){if(!t||typeof t._setTremolo!="function")return;const s=this.currentSettings.get(e);if(!s){E.debug("TremoloAudioEffect",`No tremolo settings found for color ${e}`,null,"audio");return}try{t._setTremolo(s),t.tremoloApplied=!0,E.debug("TremoloAudioEffect",`Applied tremolo to voice for ${e}`,s,"audio")}catch(r){E.warn("TremoloAudioEffect",`Failed to apply tremolo to voice for ${e}`,r,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{speed:0,span:0}}getEffectInstance(){return null}createTremoloSettings(t,e){if(t===0||e===0)return null;const s=t/100*16,r=e/100;return{frequency:s,depth:r}}disableForColor(t){this.updateParameters({speed:0,span:0},t)}dispose(){this.currentSettings.clear(),E.info("TremoloAudioEffect","Disposed",null,"audio")}}E.moduleLoaded("DelayAudioEffect");const AR=()=>window.synthEngine;class aR{constructor(){M(this,"currentSettings",new Map);M(this,"delayInstances",new Map)}init(){return E.info("DelayAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,e){var A,a;const{time:s,feedback:r,wet:i}=t;this.currentSettings.set(e,{time:s,feedback:r,wet:i}),E.debug("DelayAudioEffect",`Updated parameters for ${e}`,{time:s,feedback:r,wet:i},"audio");let o=this.delayInstances.get(e);o?this.updateDelayInstance(o,s,r,i):i>0&&(o=this.createDelayInstance(s,r,i),o&&(this.delayInstances.set(e,o),E.debug("DelayAudioEffect",`Created new delay instance for ${e}`,{time:s,feedback:r,wet:i},"audio"),(a=(A=AR())==null?void 0:A.updateSynthForColor)==null||a.call(A,e)))}applyToVoice(t,e){var r,i,o;if(!t)return;const s=this.currentSettings.get(e);if(!(!s||s.time===0&&s.feedback===0))try{let A=this.delayInstances.get(e);if(!A){if(A=this.createDelayInstance(s.time,s.feedback,s.wet),!A)return;this.delayInstances.set(e,A)}if(typeof t.isDisposed=="function"&&t.isDisposed())return;try{(r=t.connect)==null||r.call(t,A)}catch{(o=(i=t.output)==null?void 0:i.connect)==null||o.call(i,A)}E.debug("DelayAudioEffect",`Applied delay to voice for ${e}`,s,"audio")}catch(A){E.warn("DelayAudioEffect",`Failed to apply delay to voice for ${e}`,A,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{time:0,feedback:0,wet:0}}getEffectInstance(t){return this.delayInstances.get(t)??null}createDelayInstance(t,e,s=30){if(s===0)return null;const r=Math.max(.01,t/100*.5),i=Math.min(.95,e/100),o=s/100,A=new op({delayTime:r,feedback:i,wet:o});return A._wetAmount=o,E.debug("DelayAudioEffect","Created delay instance",{delayTime:r,feedbackAmount:i,wetAmount:o},"audio"),A}updateDelayInstance(t,e,s,r=15){const i=Math.max(.01,e/100*.5),o=Math.min(.95,s/100),A=r/100;try{t.delayTime.value=i,t.feedback.value=o,t._crossFade&&(t._crossFade.fade.value=A),t._wetAmount=A,E.debug("DelayAudioEffect","Updated delay instance",{delayTime:i,feedbackAmount:o,wetAmount:A},"audio")}catch(a){E.warn("DelayAudioEffect","Failed to update delay instance",a,"audio")}}createDelaySettings(t,e,s=30){if(t===0&&e===0)return null;const r=Math.max(.01,t/100*.5),i=Math.min(.95,e/100),o=s/100;return{time:r,feedback:i,wet:o}}disableForColor(t){var s;this.updateParameters({time:0,feedback:0,wet:0},t);const e=this.delayInstances.get(t);if(e)try{(s=e._crossFade)==null||s.dispose(),e.dispose()}finally{this.delayInstances.delete(t)}}dispose(){this.delayInstances.forEach((t,e)=>{var s;try{(s=t._crossFade)==null||s.dispose(),t.dispose()}catch(r){E.warn("DelayAudioEffect",`Failed to dispose delay for ${e}`,r,"audio")}}),this.currentSettings.clear(),this.delayInstances.clear(),E.info("DelayAudioEffect","Disposed",null,"audio")}}E.moduleLoaded("AudioEffectsManager");const lR=()=>window.synthEngine;class cR{constructor(){M(this,"vibratoEffect",new iR);M(this,"tremoloEffect",new oR);M(this,"delayEffect",new aR)}init(){return this.vibratoEffect.init(),this.tremoloEffect.init(),this.delayEffect.init(),f.on("audioEffectChanged",t=>{if(!t)return;const{effectType:e,parameter:s,value:r,color:i,effectParams:o}=t;this.handleAudioEffectChange(e,s,r,i,o)}),E.info("AudioEffectsManager","Event subscriptions established",null,"audio"),!0}handleAudioEffectChange(t,e,s,r,i){switch(E.debug("AudioEffectsManager",`Processing audio effect: ${t}.${e} = ${s} for ${r}`,null,"audio"),t){case"vibrato":this.vibratoEffect.updateParameters(i,r);break;case"tremolo":this.tremoloEffect.updateParameters(i,r);break;case"delay":this.delayEffect.updateParameters(i,r);break;default:E.debug("AudioEffectsManager",`Effect type ${t} not handled by audio system`,null,"audio")}}getEffectHandler(t){switch(t){case"vibrato":return this.vibratoEffect;case"tremolo":return this.tremoloEffect;case"delay":return this.delayEffect;default:return null}}applySynthEffects(t,e,s){var o,A;const r=this.delayEffect.getEffectInstance(e);try{t.disconnect()}catch{}let i=t;if(r)try{i.connect(r),i=r}catch(a){E.error("AudioEffectsManager","Delay connection error",a,"audio")}try{i.connect(s);const a=(A=(o=lR())==null?void 0:o.getWaveformAnalyzer)==null?void 0:A.call(o,e);a&&t.connect(a)}catch(a){E.error("AudioEffectsManager","masterGain connection error",a,"audio")}}applyEffectsToVoice(t,e){this.vibratoEffect.applyToVoice(t,e),this.tremoloEffect.applyToVoice(t,e)}dispose(){this.vibratoEffect.dispose(),this.tremoloEffect.dispose(),this.delayEffect.dispose(),E.info("AudioEffectsManager","Disposed",null,"audio")}}const tv=new cR;function uR(){j0("adsr-envelope","#adsr-envelope"),KN(),j0("filter-controls-bridge",document.body),E.initStart("Waveform Visualizer"),Zk()?E.initSuccess("Waveform Visualizer"):E.initFailed("Waveform Visualizer"),E.initStart("Effects Managers"),Z0.init(),tv.init(),vs.init(),_r.init();const n=window;n.effectsCoordinator=vs,n.animationEffectsManager=Z0,n.audioEffectsManager=tv,n.effectsController=_r,E.initSuccess("Effects Managers")}function dR({cx:n,cy:t,rx:e,ry:s,stroke:r="currentColor",strokeWidth:i=3}){const o=document.createElementNS("http://www.w3.org/2000/svg","ellipse");return o.setAttribute("cx",`${n}`),o.setAttribute("cy",`${t}`),o.setAttribute("rx",`${e}`),o.setAttribute("ry",`${s}`),o.setAttribute("fill","none"),o.setAttribute("stroke",r),o.setAttribute("stroke-width",`${i}`),o.setAttribute("stroke-linecap","round"),o}function hR(n,t=48,e=48){const s=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=n.span==="quarter",i=r?200:100;s.setAttribute("viewBox",`0 0 ${i} 100`),s.setAttribute("width",`${t}`),s.setAttribute("height",`${e}`),s.setAttribute("aria-label",n.label),s.style.color="#000000";const A=50,a=r?32:16,l=40,c=r?[33.33,100,166.67]:[16.67,50,83.33];return n.hits.forEach(u=>{const d=dR({cx:c[u]??0,cy:A,rx:a,ry:l,stroke:"currentColor",strokeWidth:3});s.appendChild(d)}),s}const Ca={selectedTripletStampId:1,init(){this.render(),this.bindEvents(),E.info("TripletStampsToolbar","Triplet stamps toolbar initialized",null,"triplets")},render(){const n=document.getElementById("triplet-stamps-toolbar-container");if(!n){E.warn("TripletStampsToolbar","Container not found",null,"triplets");return}n.innerHTML="";const t=$l.filter(r=>r.span==="eighth"),e=$l.filter(r=>r.span==="quarter"),s=document.createElement("div");if(s.className="triplet-stamps-grid",t.length>0){const r=document.createElement("div");r.className="triplet-stamps-row triplet-stamps-eighth-row",t.forEach(i=>{const o=this.createTripletStampButton(i);r.appendChild(o)}),s.appendChild(r)}if(e.length>0){const r=document.createElement("div");if(r.className="triplet-stamps-row triplet-stamps-quarter-row",e.slice(0,3).forEach(i=>{const o=this.createTripletStampButton(i);o.classList.add("triplet-stamp-button-wide"),r.appendChild(o)}),s.appendChild(r),e.length>3){const i=document.createElement("div");i.className="triplet-stamps-row triplet-stamps-quarter-row",e.slice(3).forEach(o=>{const A=this.createTripletStampButton(o);A.classList.add("triplet-stamp-button-wide"),i.appendChild(A)}),s.appendChild(i)}}n.appendChild(s),this.setInitialSelection(this.selectedTripletStampId)},createTripletStampButton(n){const t=document.createElement("button");t.className="triplet-stamp-button",t.dataset.tripletStampId=`${n.id}`,t.setAttribute("title",n.label||`Triplet ${n.id}`);const s=n.span==="quarter"?80:40,i=hR(n,s,40);return i.style.width="100%",i.style.height="100%",i.style.maxWidth="100%",i.style.maxHeight="100%",t.appendChild(i),t},bindEvents(){const n=document.getElementById("triplet-stamps-toolbar-container");n&&(n.addEventListener("click",t=>{var r;const e=(r=t.target)==null?void 0:r.closest(".triplet-stamp-button");if(!e)return;const s=parseInt(e.dataset.tripletStampId||"",10);Number.isNaN(s)||this.selectTripletStamp(s)}),f.on("toolChanged",({newTool:t}={})=>{t&&t!=="tripletStamp"&&this.clearSelection()}),f.on("sixteenthStampToolSelected",()=>{this.clearSelection()}))},setInitialSelection(n){this.selectedTripletStampId=n;const t=document.getElementById("triplet-stamps-toolbar-container");t&&t.querySelectorAll(".triplet-stamp-button").forEach(e=>{const s=e;s.classList.toggle("active",parseInt(s.dataset.tripletStampId||"",10)===n)})},selectTripletStamp(n){this.selectedTripletStampId=n;const t=document.getElementById("triplet-stamps-toolbar-container");t&&t.querySelectorAll(".triplet-stamp-button").forEach(e=>{const s=e;s.classList.toggle("active",parseInt(s.dataset.tripletStampId||"",10)===n)}),f.setSelectedTool("tripletStamp"),f.emit("tripletStampSelected",n),f.emit("tripletStampToolSelected")},clearSelection(){const n=document.getElementById("triplet-stamps-toolbar-container");n&&n.querySelectorAll(".triplet-stamp-button").forEach(t=>{t.classList.remove("active")})},getSelectedTripletStamp(){return $l.find(t=>t.id===this.selectedTripletStampId)}};function fR(){var n,t;JM.init(),((n=re.initialize)==null?void 0:n.call(re))??((t=re.init)==null||t.call(re)),Ku.init(),Ca.init(),E.initSuccess("RhythmUi")}class pR{constructor(){M(this,"gridsWrapper",null);M(this,"pitchGridWrapper",null);M(this,"drumGridWrapper",null);M(this,"gridScrollbarProxy",null);M(this,"isInitialized",!1);M(this,"lastScrollTime",0);M(this,"isSyncingFromProxy",!1);M(this,"isSyncingFromWrapper",!1);M(this,"handleWrapperScroll");M(this,"handleProxyScroll")}init(){if(this.gridsWrapper=document.getElementById("grids-wrapper"),this.pitchGridWrapper=document.getElementById("pitch-grid-wrapper"),this.drumGridWrapper=document.getElementById("drum-grid-wrapper"),this.gridScrollbarProxy=document.getElementById("grid-scrollbar-proxy"),!this.gridsWrapper||!this.pitchGridWrapper||!this.drumGridWrapper){E.error("ScrollSyncService","Required elements not found for scroll sync",null,"scroll");return}this.setupScrollSynchronization(),this.isInitialized=!0,E.info("ScrollSyncService","Initialized with unified grids-wrapper structure",null,"scroll")}setupScrollSynchronization(){this.handleWrapperScroll=this.handleWrapperScrollInternal.bind(this),this.handleProxyScroll=this.handleProxyScrollInternal.bind(this),this.gridsWrapper.addEventListener("scroll",this.handleWrapperScroll,{passive:!0}),this.gridScrollbarProxy?this.gridScrollbarProxy.addEventListener("scroll",this.handleProxyScroll,{passive:!0}):E.warn("ScrollSyncService","Grid scrollbar proxy not found; falling back to native scrollbars.",null,"scroll")}handleWrapperScrollInternal(t){if(this.isSyncingFromProxy||!this.gridsWrapper)return;const e=Date.now();if(this.lastScrollTime=e,this.gridScrollbarProxy){const r=this.gridsWrapper.scrollLeft;Math.abs(this.gridScrollbarProxy.scrollLeft-r)>.5&&(this.isSyncingFromWrapper=!0,this.gridScrollbarProxy.scrollLeft=r,this.isSyncingFromWrapper=!1)}const s=t.target;E.debug("ScrollSyncService",`Unified scroll: ${(s==null?void 0:s.scrollLeft)??0}px`,null,"scroll")}handleProxyScrollInternal(){if(this.isSyncingFromWrapper||!this.gridScrollbarProxy)return;const t=this.gridScrollbarProxy.scrollLeft;this.gridsWrapper&&Math.abs(this.gridsWrapper.scrollLeft-t)>.5&&(this.isSyncingFromProxy=!0,this.gridsWrapper.scrollLeft=t,this.isSyncingFromProxy=!1)}syncScrollTo(t){!this.isInitialized||!this.gridsWrapper||(this.isSyncingFromProxy=!0,this.isSyncingFromWrapper=!0,this.gridsWrapper.scrollLeft=t,this.gridScrollbarProxy&&(this.gridScrollbarProxy.scrollLeft=t),this.isSyncingFromProxy=!1,this.isSyncingFromWrapper=!1)}}const mR=new pR;function ev(n){if(n)return n.uuid}function WC(n,t=null){const e=Array.isArray(t)?t:n.macrobeatGroupings||[],r=[...Ye(n)].sort((c,u)=>c.preMacrobeatIndex-u.preMacrobeatIndex);let i=0;const o=[];let A=0;const a=c=>{o.push({visualIndex:o.length,type:`legend-${c}`,timeIndex:null})},l=c=>{for(;i<r.length;){const u=r[i];if((u==null?void 0:u.preMacrobeatIndex)!==c)break;o.push({visualIndex:o.length,type:"tonic",timeIndex:null}),o.push({visualIndex:o.length,type:"tonic",timeIndex:null});const d=ev(u);if(d)do i++;while(i<r.length&&ev(r[i])===d);else i++}};return a("left"),a("left"),l(-1),e.forEach((c,u)=>{for(let d=0;d<c;d++)o.push({visualIndex:o.length,type:"time",timeIndex:A++});l(u)}),a("right"),a("right"),{entries:o,totalTimeColumns:A}}function gR(n,t,e=null){if(e!==null){const{entries:s}=WC(n,e),r=s[t];return r?r.timeIndex:null}return l_(t,n)}function vR(n,t,e=null){if(t==null)return null;if(e!==null){const{entries:s,totalTimeColumns:r}=WC(n,e);if(t<0||t>=r)return null;const i=s.find(o=>o.timeIndex===t);return i?i.visualIndex:null}return c_(t,n)}let Rl=!1,Mr="C4",Yc=null;function ac(){var n;return{pitches:[],rootNote:Mr,color:((n=f.state.selectedNote)==null?void 0:n.color)||"#000000"}}let ms=ac();function wR(){const n=document.activeElement;if(!(n instanceof HTMLElement))return!0;const t=n.tagName.toLowerCase();return!(["input","textarea","select"].includes(t)||n.isContentEditable)}function BR(n){const t=n.globalRow??n.row,e=f.state.fullRowData[t];return e?e.toneNote:"C4"}function nv(){const n=f.state.placedNotes.slice().reverse().find(t=>!t.isDrum);Mr=n?BR(n):"C4"}function sv(n){const{activeChordIntervals:t}=f.state;return!n||!(t!=null&&t.length)?[]:t.map(e=>{const s=xo(n,e);return NA(s)})}function CR(){nv(),f.on("notesChanged",nv),document.addEventListener("keydown",n=>{var r;if(n.code!=="Enter"||Rl||n.repeat||!wR())return;n.preventDefault(),Rl=!0;const t=(r=f.state.selectedNote)==null?void 0:r.color;let e,s=[];if(Yc&&t){const i=f.state.fullRowData[Yc.row];e=i?i.toneNote:Mr,f.state.selectedTool==="chord"?s=sv(e):s=[e]}else t&&Mr&&(e=Mr,f.state.selectedTool==="chord"?s=sv(Mr):s=[Mr]);if(s.length>0&&t&&e){ms={pitches:[...s],rootNote:e,color:t},s.forEach(a=>{Wt.triggerAttack(a,t)});const i=f.state.fullRowData.find(a=>a.toneNote===e);i&&i.hex;const o=f.state.timbres[t];if(!o)return;o.adsr,f.emit("spacebarPlayback",{note:e,color:t,isPlaying:!0});const A=`spacebar-${Date.now()}`;f.emit("noteAttack",{noteId:A,color:t}),ms.noteId=A}}),document.addEventListener("keyup",n=>{if(n.code!=="Enter"||!Rl)return;n.preventDefault(),Rl=!1;const t=ms.pitches;if(!Array.isArray(t)||t.length===0){ms=ac();return}const e=ms.color;if(e){t.forEach(o=>{Wt.triggerRelease(o,e)});const s=ms.rootNote??Mr,r=f.state.fullRowData.find(o=>o.toneNote===s);r&&r.hex;const i=f.state.timbres[e];if(!i){ms=ac();return}i.adsr,f.emit("spacebarPlayback",{note:s,color:e,isPlaying:!1}),ms.noteId&&f.emit("noteRelease",{noteId:ms.noteId,color:e})}ms=ac()})}function GC(n,t){var s;Yc={col:n,row:t};const e=(s=f.state.selectedNote)==null?void 0:s.color;e&&f.emit("ghostNoteUpdated",{color:e})}function KC(){Yc=null,f.emit("ghostNoteCleared")}const bR={single:40,chord:20,transient:30};function qC(n){return String(n)}function yR(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}const rv={single:0,chord:0,transient:0},Rr=new Map;function iv(n,t){const e=qC(t),s=Rr.get(n)??new Set;s.add(e),Rr.set(n,s)}function ov(n,t){const e=Rr.get(n);e&&(e.delete(qC(t)),e.size===0&&Rr.delete(n))}const un={shouldPlayPreview(n){const t=yR(),e=bR[n],s=rv[n];return t-s<e?!1:(rv[n]=t,!0)},triggerAttack(n,t,e={}){const s=e.kind??"single";return!e.bypassThrottle&&!this.shouldPlayPreview(s)?!1:(Wt.triggerAttack(n,t),iv(t,n),!0)},triggerAttacks(n,t,e={}){const s=e.kind??"chord";return!e.bypassThrottle&&!this.shouldPlayPreview(s)?!1:(n.forEach(r=>{Wt.triggerAttack(r,t),iv(t,r)}),!0)},triggerRelease(n,t){Wt.triggerRelease(n,t),ov(t,n)},releasePitches(n,t){n.forEach(e=>{this.triggerRelease(e,t)})},quickReleasePitches(n,t){!n||n.length===0||(Wt.quickReleasePitches(n,t),n.forEach(e=>ov(t,e)))},playTransient(n,t,e=100){this.triggerAttack(n,t,{kind:"transient"})&&setTimeout(()=>this.triggerRelease(n,t),e)},releaseAll(n){if(typeof n=="string"){const t=Rr.get(n);if(!t)return;Array.from(t.values()).forEach(e=>{Wt.triggerRelease(e,n)}),Rr.delete(n);return}for(const[t,e]of Rr.entries())Array.from(e.values()).forEach(s=>{Wt.triggerRelease(s,t)});Rr.clear()}};class SR{constructor(){M(this,"isDragging",!1);M(this,"draggedModulationMarker",null);M(this,"lastModulationHoverResult",null)}handleMouseDown(t,e){for(const s of f.state.tempoModulationMarkers||[]){const r=s.xCanvas??s.xPosition??0,i=lg(t,e,{...s,xCanvas:r});if(i){if(i.type==="label"){const o=s.ratio===Fn.COMPRESSION_2_3?Fn.EXPANSION_3_2:Fn.COMPRESSION_2_3;return f.setModulationRatio(s.id,o),!0}if(i.type==="barline"&&i.canDrag)return this.isDragging=!0,this.draggedModulationMarker=s,document.body.style.cursor=cg(i),!0}}return!1}handlePlacementClick(t,e){if(f.state.selectedTool!=="modulation")return!1;const s=f.state.selectedModulationRatio;if(typeof s!="number")return E.warn("PitchGridModulationToolInteractor","No modulation ratio selected before placement",null,"grid"),!0;const r=e(t);if(!r)return E.warn("PitchGridModulationToolInteractor","Modulation placement must be near a measure boundary",{clickX:t},"grid"),!0;E.debug("PitchGridModulationToolInteractor","Placing modulation marker at boundary",{measureIndex:r.measureIndex,ratio:s,clickX:t,boundaryX:r.xPosition},"grid");const i=f.addModulationMarker(r.measureIndex,s,r.xPosition,null,r.macrobeatIndex);return E.debug("PitchGridModulationToolInteractor","Modulation marker placed",{markerId:i,measureIndex:r.measureIndex,ratio:s},"grid"),!0}handleMouseMove(t){if(!this.isDragging||!this.draggedModulationMarker)return!1;const e=f.state.baseMicrobeatPx||f.state.cellWidth||40,s=Math.round(t/e)*e;return f.moveModulationMarker(this.draggedModulationMarker.id,s),!0}getHoveredMarker(t,e){for(const s of f.state.tempoModulationMarkers||[]){const r=s.xCanvas??s.xPosition??0,i=lg(t,e,{...s,xCanvas:r});if(i)return i}return null}updateCursor(t,e){if(e){t.style.cursor=cg(e),this.lastModulationHoverResult=e;return}this.lastModulationHoverResult&&(t.style.cursor="default",this.lastModulationHoverResult=null)}handleMouseUp(){return this.isDragging?(this.isDragging=!1,this.draggedModulationMarker=null,!0):!1}}class ER{handleExistingNoteMouseDown(t,e,s,r){var l,c;if(f.state.selectedTool!=="note")return{handled:!1,state:s};const i=f.state.placedNotes.find(u=>!u.isDrum&&u.row===e&&t>=u.startColumnIndex&&t<=u.endColumnIndex);if(!i)return{handled:!1,state:s};const o=r.getPitchForRow(e);if(!o)return{handled:!0,state:s};const A=window.waveformVisualizer;A&&(A.currentColor=i.color,A.generateWaveform(),A.startSingleNoteVisualization(i.color));const a=re.getSixteenthStampAtPosition(t,e);return a?(re.playRhythmPattern(a.sixteenthStampId,o,i.color,i.shape,a),{handled:!0,state:{...s,activePreviewPitches:[o],activeNote:i}}):(un.triggerAttack(o,i.color,{kind:"single",bypassThrottle:!0}),(l=f.state.fullRowData[e])!=null&&l.hex,(c=f.state.timbres[i.color])==null||c.adsr,{handled:!0,state:{...s,activePreviewPitches:[o],activeNote:i}})}attemptPlaceNoteAt(t,e,s,r,i){var h,m;if(f.state.selectedTool!=="note")return{placed:!1,state:s,shouldStartDragging:!1};if(!aa(t,f.state))return{placed:!1,state:s,shouldStartDragging:!1};const o=f.state.selectedNote;if(!o)return{placed:!1,state:s,shouldStartDragging:!1};const{shape:A,color:a}=o;if(A==="circle"&&!aa(t+1,f.state))return{placed:!1,state:s,shouldStartDragging:!1};const l=A==="circle"?t+1:t,c={row:e,startColumnIndex:t,endColumnIndex:l,color:a,shape:A,isDrum:!1},u=f.addNote(c);if(!u)return{placed:!1,state:s,shouldStartDragging:!1};const d={...s,activeNote:u,lastDragRow:e};u.uuid&&f.emit("noteInteractionStart",{noteId:u.uuid,color:u.color});const p=i.getPitchForRow(e);if(p){u.uuid&&(r.add(u.uuid),f.emit("noteAttack",{noteId:u.uuid,color:u.color})),d.activePreviewPitches=[p],un.triggerAttack(p,u.color,{kind:"single",bypassThrottle:!0}),(h=f.state.fullRowData[e])!=null&&h.hex,(m=f.state.timbres[u.color])==null||m.adsr;const g=window.waveformVisualizer;g&&(g.currentColor=u.color,g.generateWaveform(),g.startSingleNoteVisualization(u.color))}return{placed:!0,state:d,shouldStartDragging:!0}}handleActiveNoteDrag(t,e,s,r){var l,c,u,d;const i=s.activeNote;if(!i)return s;const o=t,A=e,a=i.uuid;if(i.shape==="circle"){if(o!==i.endColumnIndex&&f.updateNoteTail(i,o),A!==s.lastDragRow){const p=r.getPitchForRow(A);if(!p)return s;s.activePreviewPitches.length>0&&un.quickReleasePitches(s.activePreviewPitches,i.color);const h=f.state.placedNotes.find(y=>y.uuid===a);h&&f.updateNoteRow(h,A);const g=f.state.placedNotes.find(y=>y.uuid===a)||h||i;let v=s.activePreviewPitches;return un.triggerAttack(p,g.color,{kind:"single"})&&(v=[p]),(l=f.state.fullRowData[A])!=null&&l.hex,((c=f.state.timbres[g.color])==null?void 0:c.adsr)&&g.uuid,{...s,activeNote:g,lastDragRow:A,activePreviewPitches:v}}return s}if(i.shape==="oval"){const p=t;if(p!==i.startColumnIndex&&f.updateNotePosition(i,p),A!==s.lastDragRow){const h=r.getPitchForRow(A);if(!h)return s;s.activePreviewPitches.length>0&&un.quickReleasePitches(s.activePreviewPitches,i.color);const m=f.state.placedNotes.find(I=>I.uuid===a);m&&f.updateNoteRow(m,A);const v=f.state.placedNotes.find(I=>I.uuid===a)||m||i;let w=s.activePreviewPitches;return un.triggerAttack(h,v.color,{kind:"single"})&&(w=[h]),(u=f.state.fullRowData[A])!=null&&u.hex,((d=f.state.timbres[v.color])==null?void 0:d.adsr)&&v.uuid,{...s,activeNote:v,lastDragRow:A,activePreviewPitches:w}}}return s}}class xR{handleMouseDown(t,e){if(f.state.selectedTool!=="eraser")return{handled:!1,shouldStartDrag:!1};f.eraseInPitchArea(t,e,2,!1);const s=t+2-1,r=e-1,i=e+1;return n5(t,s,r,i),o5(t,s,r,i),{handled:!0,shouldStartDrag:!0}}handleMouseMove(t,e,s){if(!s)return!1;f.eraseInPitchArea(t,e,2,!1);const r=t+2-1,i=e-1,o=e+1;return f.eraseSixteenthStampsInArea(t,r,i,o),f.eraseTripletStampsInArea(t,r,i,o),!0}}class IR{handleMouseDown(t,e,s,r,i){var d,p;if(f.state.selectedTool!=="chord")return{handled:!1,state:s,shouldStartDragging:!1};if(!aa(t,f.state))return{handled:!0,state:s,shouldStartDragging:!1};const o=i.getPitchForRow(e);if(!o)return{handled:!0,state:s,shouldStartDragging:!1};const A=i.getChordPitchesForRootPitch(o),a=f.state.selectedNote;if(!a)return{handled:!0,state:s,shouldStartDragging:!1};const{shape:l,color:c}=a;un.triggerAttacks(A,c,{kind:"chord",bypassThrottle:!0}),(d=f.state.fullRowData[e])!=null&&d.hex,(p=f.state.timbres[c])==null||p.adsr;const u=[];return A.forEach(h=>{const m=f.state.fullRowData.findIndex(y=>y.toneNote===h);if(m===-1)return;const g=l==="circle"?t+1:t,v={row:m,startColumnIndex:t,endColumnIndex:g,color:c,shape:l,isDrum:!1},w=f.addNote(v);w&&(u.push(w),w.uuid&&(r.add(w.uuid),f.emit("noteAttack",{noteId:w.uuid,color:w.color}),f.emit("noteInteractionStart",{noteId:w.uuid,color:w.color})))}),{handled:!0,shouldStartDragging:!0,state:{...s,activeChordNotes:u,activePreviewPitches:[...A],lastDragRow:e}}}handleActiveChordDrag(t,e,s,r){if(!s.activeChordNotes||s.activeChordNotes.length===0)return s;const i=s.activeChordNotes[0];if(!i)return s;const o=i.color,A=e;if(i.shape==="circle"){const a=t,l=s.activeChordNotes.filter(c=>a!==c.endColumnIndex);if(l.length>0&&f.updateMultipleNoteTails(l,a),A!==s.lastDragRow){const c=s.lastDragRow??i.row,u=A-c;if(u===0)return s;un.quickReleasePitches(s.activePreviewPitches,o);const d=s.activeChordNotes.map(m=>m.row+u);if(!d.every(m=>r.getPitchForRow(m)!==null))return s;f.updateMultipleNoteRows(s.activeChordNotes,d);const h=d.map(m=>r.getPitchForRow(m)).filter(m=>typeof m=="string");return un.triggerAttacks(h,o,{kind:"chord"}),{...s,activePreviewPitches:h,lastDragRow:A}}return s}if(i.shape==="oval"){const a=t,l=s.activeChordNotes.filter(m=>a!==m.startColumnIndex);l.length>0&&f.updateMultipleNotePositions(l,a);const c=s.lastDragRow!==null?s.lastDragRow:i.row,u=A-c;if(u===0)return s;un.quickReleasePitches(s.activePreviewPitches,o);const d=s.activeChordNotes.map(m=>m.row+u);if(!d.every(m=>r.getPitchForRow(m)!==null))return s;f.updateMultipleNoteRows(s.activeChordNotes,d);const h=d.map(m=>r.getPitchForRow(m)).filter(m=>typeof m=="string");return un.triggerAttacks(h,o,{kind:"chord"}),{...s,activePreviewPitches:h,lastDragRow:A}}return s}}function FR(n,t,e,s){var l,c;const r=Iu(e.sixteenthStampId);if(!r)return null;const i=lt(e.startColumn,s),o=s.cellWidth*2,A=s.cellHeight,a=[.125,.375,.625,.875].map(u=>i+u*o);for(const u of r.diamonds){const d=`diamond_${u}`,p=((l=e.shapeOffsets)==null?void 0:l[d])||0,h=e.row+p,m=xt(h,s),g=a[u];if(g===void 0)continue;const v=Math.sqrt(Math.pow(n-g,2)+Math.pow(t-m,2)),w=Math.min(o*.2,A*1);if(v<w)return{type:"diamond",slot:u??0,shapeKey:d,cx:g,cy:m,placement:e}}for(const u of r.ovals){const d=`oval_${u}`,p=((c=e.shapeOffsets)==null?void 0:c[d])||0,h=e.row+p,m=xt(h,s),g=u===0?i+.25*o:i+.75*o,v=Math.sqrt(Math.pow(n-g,2)+Math.pow(t-m,2)),w=Math.min(o*.25,A*1);if(v<w)return{type:"oval",slot:u,shapeKey:d,cx:g,cy:m,placement:e}}return null}function Av(n,t,e,s){for(const r of e){const i=FR(n,t,r,s);if(i)return i}return null}class TR{constructor(){M(this,"draggedStampShape",null)}isDraggingShape(){return this.draggedStampShape!==null}tryStartShapeDrag(t){const e=f.getAllSixteenthStampPlacements(),s={...f.state},r=Av(t.actualX,t.canvasY,e,s);return r?(this.draggedStampShape={...r,startRow:f.getSixteenthStampShapeRow(r.placement,r.shapeKey),startMouseY:t.canvasY},!0):!1}handleMouseDown(t){if(this.tryStartShapeDrag({actualX:t.actualX,canvasY:t.canvasY}))return{handled:!0};if(f.state.selectedTool!=="sixteenthStamp")return{handled:!1};const e=re.getSixteenthStampAtPosition(t.colIndex,t.rowIndex);if(e){const l=t.getPitchForRow(t.rowIndex);if(!l)return{handled:!0};const c=f.state.placedNotes.find(d=>!d.isDrum&&d.row===t.rowIndex&&t.colIndex>=d.startColumnIndex&&t.colIndex<=d.endColumnIndex),u=c?c.shape:"oval";return re.playRhythmPattern(e.sixteenthStampId,l,e.color,u,e),{handled:!0,activePreviewPitches:[l]}}const s=Ku.getSelectedSixteenthStamp();if(!s)return{handled:!0};const r=t.getTimeAlignedCanvasColumn(t.colIndex);if(r===null)return{handled:!0};const i=f.state.selectedNote;if(!i)return{handled:!0};const{color:o,shape:A}=i;e5(s.id,r,t.rowIndex,o);const a=t.getPitchForRow(t.rowIndex);return a?(re.playRhythmPattern(s.id,a,o,A),f.recordState(),{handled:!0,activePreviewPitches:[a]}):(f.recordState(),{handled:!0})}handleMouseMove(t){var s;if(!this.draggedStampShape)return!1;const e=t.rowIndex-this.draggedStampShape.placement.row;if(f.updateSixteenthStampShapeOffset(this.draggedStampShape.placement.id,this.draggedStampShape.shapeKey,e),t.rowIndex!==this.draggedStampShape.startRow){const r=t.getPitchForRow(t.rowIndex);if(r){const i=this.draggedStampShape.placement.color||((s=f.state.selectedNote)==null?void 0:s.color);i&&un.playTransient(r,i,100)}this.draggedStampShape.startRow=t.rowIndex}return t.canvasEl&&(t.canvasEl.style.cursor="ns-resize"),!0}updateHoverCursor(t){if(f.state.selectedTool!=="sixteenthStamp"||this.draggedStampShape)return;const e=t.canvasEl;if(!e)return;const s=f.getAllSixteenthStampPlacements(),r={...f.state};Av(t.actualX,t.canvasY,s,r)||_R(t.actualX,t.canvasY,s,r)?e.style.cursor="grab":e.style.cursor="default"}handleMouseUp(){if(!this.draggedStampShape)return!1;this.draggedStampShape=null,f.recordState();const t=document.getElementById("notation-grid");return t&&(t.style.cursor="default"),!0}}function _R(n,t,e,s){const r=s.columnWidths||[];for(const i of e){const o=i.startColumn,A=Math.min(i.endColumn,r.length),a=lt(o,s),l=lt(A,s),u=xt(i.row,s)-s.cellHeight/2;if(n>=a&&n<=l&&t>=u&&t<=u+s.cellHeight)return!0}return!1}function MR(n,t,e,s){var d;const r=Fu(e.tripletStampId);if(!r)return null;const i=e.span*2,o=Cn(e.startTimeIndex,f.state),A=o+i,a=lt(o,s),c=lt(A,s)-a,u=s.cellHeight;for(const p of r.hits){const h=`triplet_${p}`,m=((d=e.shapeOffsets)==null?void 0:d[h])||0,g=e.row+m,v=xt(g,s),w=B2[p];if(w===void 0)continue;const y=a+c*w/100,I=Math.sqrt(Math.pow(n-y,2)+Math.pow(t-v,2)),B=Math.min(c*.15,u*1);if(I<B)return{type:"tripletStamp",slot:p,shapeKey:h,cx:y,cy:v,placement:e}}return null}function av(n,t,e,s){for(const r of e){const i=MR(n,t,r,s);if(i)return i}return null}class QR{constructor(){M(this,"draggedTripletShape",null)}isDraggingShape(){return this.draggedTripletShape!==null}tryStartShapeDrag(t){const e=f.getAllTripletStampPlacements(),s={...f.state},r=av(t.actualX,t.canvasY,e,s);return r?(this.draggedTripletShape={...r,startRow:f.getTripletStampShapeRow(r.placement,r.shapeKey),startMouseY:t.canvasY},!0):!1}handleMouseDown(t){if(this.tryStartShapeDrag({actualX:t.actualX,canvasY:t.canvasY}))return{handled:!0};if(f.state.selectedTool!=="tripletStamp")return{handled:!1};const e=Yr(t.colIndex,f.state);if(e===null)return{handled:!0};const s=e,r=re.getTripletStampAtPosition(s,t.rowIndex);if(r){const a=t.getPitchForRow(t.rowIndex);return a?(re.playTripletPattern(r.tripletStampId,a,r.color,r),{handled:!0,activePreviewPitches:[a]}):{handled:!0}}const i=Ca.getSelectedTripletStamp();if(!i||!f.state.selectedNote)return{handled:!0};const o=r5(i.id,s,t.rowIndex,f.state.selectedNote.color),A=t.getPitchForRow(t.rowIndex);return A&&o?(re.playTripletPattern(i.id,A,f.state.selectedNote.color,o),f.recordState(),{handled:!0,activePreviewPitches:[A]}):(f.recordState(),{handled:!0})}handleMouseMove(t){var s;if(!this.draggedTripletShape)return!1;const e=t.rowIndex-this.draggedTripletShape.placement.row;if(f.updateTripletStampShapeOffset(this.draggedTripletShape.placement.id,this.draggedTripletShape.shapeKey,e),t.rowIndex!==this.draggedTripletShape.startRow){const r=t.getPitchForRow(t.rowIndex);if(r){const i=this.draggedTripletShape.placement.color||((s=f.state.selectedNote)==null?void 0:s.color);i&&un.playTransient(r,i,100)}this.draggedTripletShape.startRow=t.rowIndex}return t.canvasEl&&(t.canvasEl.style.cursor="ns-resize"),!0}updateHoverCursor(t){if(f.state.selectedTool!=="tripletStamp"||this.draggedTripletShape)return;const e=t.canvasEl;if(!e)return;const s=f.getAllTripletStampPlacements(),r={...f.state};av(t.actualX,t.canvasY,s,r)||UR(t.actualX,t.canvasY,s,r)?e.style.cursor="grab":e.style.cursor="default"}handleMouseUp(){if(!this.draggedTripletShape)return!1;this.draggedTripletShape=null,f.recordState();const t=document.getElementById("notation-grid");return t&&(t.style.cursor="default"),!0}}function UR(n,t,e,s){for(const r of e){const i=r.span*2,o=Cn(r.startTimeIndex,f.state),A=o+i,a=lt(o,s),l=lt(A,s),u=xt(r.row,s)-s.cellHeight/2;if(n>=a&&n<=l&&t>=u&&t<=u+s.cellHeight)return!0}return!1}function PR(n){const{macrobeatGroupings:t,macrobeatBoundaryStyles:e,columnWidths:s}=f.state,r=s.length;if(n<0||n>=r)return null;let i=-1;for(let u=0;u<t.length;u++){const{startColumn:d,endColumn:p}=mn(f.state,u);if(n>=d&&n<=p){i=u;break}}if(i===-1)return null;let o=0;for(let u=i-1;u>=0;u--)if(e[u]==="solid"){o=u+1;break}const A=o-1;return(u=>u<=0?!0:e[u-1]==="solid")(o)?{drawColumn:mn(f.state,o).startColumn,preMacrobeatIndex:A}:null}function lv(n){return n.replace(/\d+$/,"")}class NR{constructor(){M(this,"lastHoveredTonicPoint",null);M(this,"lastHoveredOctaveRows",[])}resetHoverState(){this.lastHoveredTonicPoint=null,this.lastHoveredOctaveRows=[]}handleMouseMove(t){if(f.state.selectedTool!=="tonicization")return(this.lastHoveredTonicPoint||this.lastHoveredOctaveRows.length>0)&&this.resetHoverState(),!1;const e=PR(t.colIndex);if(!e)return this.resetHoverState(),!0;if(Ye(f.state).some(c=>c.preMacrobeatIndex===e.preMacrobeatIndex))return this.resetHoverState(),!0;const i=t.getPitchForRow(t.rowIndex);if(!i)return this.resetHoverState(),!0;const o=lv(i),A=Xs.map((c,u)=>({rowData:c,masterIndex:u})).filter(({rowData:c})=>c.toneNote&&lv(c.toneNote)===o).map(({masterIndex:c})=>c);this.lastHoveredTonicPoint=e,this.lastHoveredOctaveRows=A;const a=A.filter(c=>c>=0&&c<f.state.fullRowData.length);t.hoverCtx.globalAlpha=.5;const l={...f.state,zoomLevel:qe.getViewportInfo().zoomLevel};return a.forEach(c=>{const u={row:c,globalRow:c,columnIndex:e.drawColumn,tonicNumber:f.state.selectedToolTonicNumber,preMacrobeatIndex:e.preMacrobeatIndex};v2(t.hoverCtx,l,u)}),t.hoverCtx.globalAlpha=1,!0}handleMouseDown(){if(f.state.selectedTool!=="tonicization")return!1;if(!this.lastHoveredTonicPoint||this.lastHoveredOctaveRows.length===0)return!0;const t=this.lastHoveredTonicPoint;if(Ye(f.state).some(i=>i.preMacrobeatIndex===t.preMacrobeatIndex))return this.resetHoverState(),!0;const r=this.lastHoveredOctaveRows.map(i=>({row:i,tonicNumber:f.state.selectedToolTonicNumber,preMacrobeatIndex:t.preMacrobeatIndex,columnIndex:t.drawColumn}));return f.addTonicSignGroup(r),this.resetHoverState(),!0}}class LR{constructor(t){this.deps=t}handleToolMouseDown(t){const{toolType:e,colIndex:s,rowIndex:r,actualX:i,canvasY:o}=t,A=t.state;if(e==="chord"){const a=this.deps.chordToolInteractor.handleMouseDown(s,r,{activeChordNotes:A.activeChordNotes,lastDragRow:A.lastDragRow,activePreviewPitches:A.activePreviewPitches},this.deps.placementFillNoteIds,{getPitchForRow:this.deps.getPitchForRow,getChordPitchesForRootPitch:this.deps.getChordPitchesForRootPitch});return{handled:a.handled,state:{...A,isDragging:a.shouldStartDragging?!0:A.isDragging,activeChordNotes:a.state.activeChordNotes,lastDragRow:a.state.lastDragRow,activePreviewPitches:a.state.activePreviewPitches}}}if(e==="tonicization")return this.deps.tonicizationToolInteractor.handleMouseDown(),{handled:!0,state:A};if(e==="eraser"){const a=this.deps.eraserToolInteractor.handleMouseDown(s,r);return{handled:a.handled,state:{...A,isEraserDragActive:a.handled?a.shouldStartDrag:A.isEraserDragActive}}}if(e==="sixteenthStamp"){const a=this.deps.stampToolInteractor.handleMouseDown({colIndex:s,rowIndex:r,actualX:i,canvasY:o,getPitchForRow:this.deps.getPitchForRow,getTimeAlignedCanvasColumn:this.deps.getTimeAlignedCanvasColumn});return{handled:a.handled,state:{...A,activePreviewPitches:a.activePreviewPitches??A.activePreviewPitches}}}if(e==="tripletStamp"){const a=this.deps.tripletToolInteractor.handleMouseDown({colIndex:s,rowIndex:r,actualX:i,canvasY:o,getPitchForRow:this.deps.getPitchForRow});return{handled:a.handled,state:{...A,activePreviewPitches:a.activePreviewPitches??A.activePreviewPitches}}}if(e==="modulation")return this.deps.modulationToolInteractor.handlePlacementClick(i,this.deps.findNearestMeasureBoundary),{handled:!0,state:A};if(e==="note"){const a=this.deps.noteToolInteractor.attemptPlaceNoteAt(s,r,{activeNote:A.activeNote,lastDragRow:A.lastDragRow,activePreviewPitches:A.activePreviewPitches},this.deps.placementFillNoteIds,{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...A,isDragging:a.placed&&a.shouldStartDragging?!0:A.isDragging,activeNote:a.state.activeNote,lastDragRow:a.state.lastDragRow,activePreviewPitches:a.state.activePreviewPitches}}}return{handled:!1,state:A}}handleToolMouseMoveBeforeBoundsCheck(t){const{actualX:e,rowIndex:s,canvasEl:r,state:i}=t;return this.deps.modulationToolInteractor.handleMouseMove(e)?{handled:!0,state:i}:this.deps.stampToolInteractor.handleMouseMove({rowIndex:s,canvasEl:r,getPitchForRow:this.deps.getPitchForRow})?{handled:!0,state:i}:this.deps.tripletToolInteractor.handleMouseMove({rowIndex:s,canvasEl:r,getPitchForRow:this.deps.getPitchForRow})?{handled:!0,state:i}:{handled:!1,state:i}}handleNoteOrChordDragMouseMove(t){const{colIndex:e,rowIndex:s}=t,r=t.state;if(!r.isDragging||!r.activeNote&&r.activeChordNotes.length===0)return{handled:!1,state:r};if(r.activeNote){const o=this.deps.noteToolInteractor.handleActiveNoteDrag(e,s,{activeNote:r.activeNote,lastDragRow:r.lastDragRow,activePreviewPitches:r.activePreviewPitches},{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...r,activeNote:o.activeNote,lastDragRow:o.lastDragRow,activePreviewPitches:o.activePreviewPitches}}}const i=this.deps.chordToolInteractor.handleActiveChordDrag(e,s,{activeChordNotes:r.activeChordNotes,lastDragRow:r.lastDragRow,activePreviewPitches:r.activePreviewPitches},{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...r,activeChordNotes:i.activeChordNotes,lastDragRow:i.lastDragRow,activePreviewPitches:i.activePreviewPitches}}}handleToolHoverVisuals(t){const{toolType:e,actualX:s,canvasY:r,pitchHoverCtx:i,canvasEl:o}=t;e==="sixteenthStamp"?this.deps.stampToolInteractor.updateHoverCursor({actualX:s,canvasY:r,canvasEl:o}):e==="tripletStamp"&&this.deps.tripletToolInteractor.updateHoverCursor({actualX:s,canvasY:r,canvasEl:o});const A=this.deps.modulationToolInteractor.getHoveredMarker(s,r);if(e==="modulation"&&!A&&i){const a=t.findNearestMeasureBoundary(s),l=t.selectedModulationRatio;a&&typeof l=="number"&&t.drawModulationPreview(i,a.xPosition,l)}o&&this.deps.modulationToolInteractor.updateCursor(o,A)}handleToolMouseUp(){return!!(this.deps.stampToolInteractor.handleMouseUp()||this.deps.tripletToolInteractor.handleMouseUp()||this.deps.modulationToolInteractor.handleMouseUp())}handleChordToolHover(t){if(f.state.selectedTool!=="chord")return!1;const e=this.deps.getPitchForRow(t.rowIndex);if(!e)return!0;const s=this.deps.getChordPitchesForRootPitch(e),r=f.state.selectedNote;if(!r)return!0;const{shape:i,color:o}=r;return t.pitchHoverCtx.globalAlpha=.4,s.forEach(A=>{const a=f.state.fullRowData.findIndex(d=>d.toneNote===A);if(a<=-1)return;const l=i==="circle"?t.colIndex+1:t.colIndex,c={row:a,startColumnIndex:t.colIndex,endColumnIndex:l,color:o,shape:i,isDrum:!1},u={...f.state,zoomLevel:t.zoomLevel};i==="oval"?t.drawSingleColumnOvalNote(t.pitchHoverCtx,u,c,a):t.drawTwoColumnOvalNote(t.pitchHoverCtx,u,c,a)}),t.pitchHoverCtx.globalAlpha=1,!0}}class DR{constructor(){M(this,"isActive",!1);M(this,"actionTaken",!1);M(this,"previousTool",null)}getIsActive(){return this.isActive}handleMouseDown(t){var c;const{event:e,colIndex:s,rowIndex:r,annotationService:i}=t;if(e.button!==2)return!1;e.preventDefault(),this.isActive=!0,this.actionTaken=!1,f.state.selectedTool!=="eraser"&&(this.previousTool=f.state.selectedTool,f.setSelectedTool("eraser")),(c=fr.get("eraserButton"))==null||c.classList.add("erasing-active"),this.actionTaken||(this.actionTaken=!!f.eraseInPitchArea(s,r,2,!1)),this.actionTaken||(this.actionTaken=!!f.eraseTonicSignAt(s,!1));const o=s+2-1,A=r-1,a=r+1;this.actionTaken||(this.actionTaken=!!f.eraseSixteenthStampsInArea(s,o,A,a)),this.actionTaken||(this.actionTaken=!!f.eraseTripletStampsInArea(s,o,A,a));const l=e.target instanceof Element?e.target:null;if(l){const u=l.getBoundingClientRect(),d=e.clientX-u.left,p=e.clientY-u.top;this.actionTaken||(this.actionTaken=!!i.eraseAtPoint(d,p))}return!0}handleMouseMove(t){if(!this.isActive)return!1;const{event:e,colIndex:s,rowIndex:r,annotationService:i}=t;this.actionTaken||(this.actionTaken=!!f.eraseInPitchArea(s,r,2,!1)),this.actionTaken||(this.actionTaken=!!f.eraseTonicSignAt(s,!1));const o=s+2-1,A=r-1,a=r+1;this.actionTaken||(this.actionTaken=!!f.eraseSixteenthStampsInArea(s,o,A,a)),this.actionTaken||(this.actionTaken=!!f.eraseTripletStampsInArea(s,o,A,a));const l=e.target instanceof Element?e.target:null;if(l){const c=l.getBoundingClientRect(),u=e.clientX-c.left,d=e.clientY-c.top;this.actionTaken||(this.actionTaken=!!i.eraseAtPoint(u,d))}return!0}handleGlobalMouseUp(){var t;return this.isActive?(this.actionTaken&&f.recordState(),this.isActive=!1,this.actionTaken=!1,this.previousTool&&(f.setSelectedTool(this.previousTool),this.previousTool=null),(t=fr.get("eraserButton"))==null||t.classList.remove("erasing-active"),!0):!1}}class kR{constructor(t,e){M(this,"pitchCanvasElement",null);M(this,"mobileLongPressTimer",null);M(this,"mobileTouchState",null);M(this,"mobileGhostActive",!1);this.deps=t,this.options=e}setPitchCanvasElement(t){this.pitchCanvasElement=t}handleTouchStart(t){var r;if(!this.deps.shouldUseMobileLongPress()||this.mobileTouchState)return;const e=(r=t.changedTouches)==null?void 0:r[0];if(!e)return;const s=this.getTouchGridPosition(e);!s||!this.deps.isPositionWithinPitchGrid(s.colIndex,s.rowIndex)||(t.preventDefault(),this.mobileTouchState={identifier:e.identifier,colIndex:s.colIndex,rowIndex:s.rowIndex},this.mobileLongPressTimer=window.setTimeout(()=>{this.activateMobileGhostPreview()},this.options.longPressDelayMs))}handleTouchMove(t){if(!this.mobileTouchState)return;const e=this.findTouchById(t.changedTouches,this.mobileTouchState.identifier)||this.findTouchById(t.touches,this.mobileTouchState.identifier);if(!e)return;const s=this.getTouchGridPosition(e);if(!s){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive});return}if(!this.deps.isPositionWithinPitchGrid(s.colIndex,s.rowIndex)){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive});return}t.preventDefault(),this.mobileTouchState.colIndex=s.colIndex,this.mobileTouchState.rowIndex=s.rowIndex,this.mobileGhostActive&&this.renderMobileGhostPreview()}handleTouchEnd(t){if(!this.mobileTouchState||!this.findTouchById(t.changedTouches,this.mobileTouchState.identifier))return;t.preventDefault();const s=this.mobileGhostActive,r=this.mobileTouchState.colIndex,i=this.mobileTouchState.rowIndex;if(this.resetMobileTouchState(),!s||this.deps.getSelectedTool()!=="note")return;this.deps.attemptPlaceNoteAt(r,i)?this.deps.onNotePlaced():this.deps.onNoteNotPlaced()}handleTouchCancel(){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive})}getTouchGridPosition(t){var a;if(!this.pitchCanvasElement)return null;const e=this.pitchCanvasElement.getBoundingClientRect(),s=t.clientX-e.left,r=t.clientY-e.top,i=((a=document.getElementById("canvas-container"))==null?void 0:a.scrollLeft)??0,o=Ps.getColumnIndex(s+i),A=Ps.getPitchRowIndex(r);return{colIndex:o,rowIndex:A}}findTouchById(t,e){if(!t)return null;for(let s=0;s<t.length;s++){const r=t.item(s);if(r&&r.identifier===e)return r}return null}renderMobileGhostPreview(){const t=this.deps.getPitchHoverCtx();!t||!this.mobileTouchState||(t.clearRect(0,0,$e(t.canvas),ie(t.canvas)),this.deps.drawHoverHighlight(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex,this.deps.getNoteHoverColor(this.options.ghostAlpha)),this.deps.drawGhostNote(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex),this.deps.setGhostNotePosition(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex))}activateMobileGhostPreview(){if(this.mobileTouchState){if(!this.deps.isPositionWithinPitchGrid(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex)){this.resetMobileTouchState({clearOverlay:!1});return}this.mobileGhostActive=!0,this.renderMobileGhostPreview()}}resetMobileTouchState({clearOverlay:t=!1}={}){this.mobileLongPressTimer&&(clearTimeout(this.mobileLongPressTimer),this.mobileLongPressTimer=null),t&&this.mobileGhostActive&&this.deps.clearOverlay(),this.mobileTouchState=null,this.mobileGhostActive=!1}}function RR(n,t){const{activeChordIntervals:e,isIntervalsInverted:s,chordPositionState:r}=t;if(!n||!e||e.length===0)return[];if(s&&e.length===2&&e[0]==="1P"){const A="-"+e[1],a=xo(n,A),l=NA(a),c=l.includes("#")&&LA(l).includes("b")?LA(l):l;return[n,c]}const i=e.map(o=>{const A=xo(n,o),a=NA(A);if(a.includes("#")){const l=LA(a);if(l.includes("b"))return l}return a});if(e.length>=3&&r>0){const o=[...i];for(let p=0;p<r;p++){const h=o.shift();if(!h)break;const m=xo(h,"8P");o.push(NA(m)??h)}const A=o[0],a=n;if(!A)return i;const l=ed(A),c=ed(a);if(l===null||c===null)return i;let u=0,d=l;for(;d>c;)d-=12,u-=12;for(;d+12<=c;)d+=12,u+=12;return o.map(p=>{const h=ed(p);if(h===null)return p;const m=h+u;return QT(m)??p})}return i}let jc=!1,df=null,hf=null,ff=null,TA=null;const wi="grab";function HR(n){if(jc){n&&(n.style.cursor=wi);return}df=document.body.style.cursor||null,hf=document.documentElement.style.cursor||null,ff=(n==null?void 0:n.style.cursor)??null,TA=n??null,n&&(n.style.cursor=wi),document.body.style.cursor=wi,document.documentElement.style.cursor=wi,document.body.dataset.cursorOverride="stamp",jc=!0}function zC(){jc&&(TA&&TA.style.cursor===wi&&(TA.style.cursor=ff??""),document.body.style.cursor===wi&&(document.body.style.cursor=df??""),document.documentElement.style.cursor===wi&&(document.documentElement.style.cursor=hf??""),document.body.dataset.cursorOverride==="stamp"&&delete document.body.dataset.cursorOverride,jc=!1,df=null,hf=null,ff=null,TA=null)}let kt=null,zr=!1,jt=null,rr=[],hn=[];const Co=new Set;let Hr=!1,Fs=null;const $C=new SR,Yp=new ER,XC=new xR,OR=new IR,jp=new TR,Jp=new QR,Jc=new NR,qu=new DR,bo=new LR({noteToolInteractor:Yp,chordToolInteractor:OR,eraserToolInteractor:XC,stampToolInteractor:jp,tripletToolInteractor:Jp,modulationToolInteractor:$C,tonicizationToolInteractor:Jc,placementFillNoteIds:Co,getPitchForRow:Yo,getTimeAlignedCanvasColumn:pf,getChordPitchesForRootPitch:n=>RR(n,f.state),findNearestMeasureBoundary:nb}),VR=275,WR=.25,fA=new kR({shouldUseMobileLongPress:qR,isPositionWithinPitchGrid:ZC,getSelectedTool:()=>f.state.selectedTool,getPitchHoverCtx:()=>kt,clearOverlay:jo,drawHoverHighlight:XA,getNoteHoverColor:jC,drawGhostNote:tb,setGhostNotePosition:GC,attemptPlaceNoteAt:KR,onNotePlaced:eb,onNoteNotPlaced:jo},{longPressDelayMs:VR,ghostAlpha:WR}),YC="#4a90e2";function GR(n,t=1){const e=n.startsWith("#")?n.slice(1):n;if(e.length!==6)return n;const s=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),i=parseInt(e.slice(4,6),16);return`rgba(${s}, ${r}, ${i}, ${t})`}function jC(n=.2){var e;const t=((e=f.state.selectedNote)==null?void 0:e.color)||YC;return GR(t,n)}function cv(){var n;return((n=f.state.selectedNote)==null?void 0:n.color)||YC}function JC(){return!!Jt.currentTool}function Yo(n){const t=f.state.fullRowData[n];return!t||t.isBoundary?null:t.toneNote}function pf(n){const t=n+2,e=gR(f.state,t);if(e===null)return null;const s=vR(f.state,e);return s===null?null:Math.max(0,s-2)}function ZC(n,t){var o;const e=(f.state.selectedTool==="note"||f.state.selectedTool==="chord")&&((o=f.state.selectedNote)==null?void 0:o.shape)==="circle",r=(f.state.musicalColumnWidths&&f.state.musicalColumnWidths.length>0?f.state.musicalColumnWidths:f.state.columnWidths||[]).length,i=e?r-1:r;return n<0||n>=i?!1:Yo(t)!==null}function XA(n,t,e){var l;if(!kt)return;const s={...f.state,zoomLevel:qe.getViewportInfo().zoomLevel},r=lt(n,s),o=xt(t,f.state)-f.state.cellHeight/2,A=f.state.selectedTool;let a;if(f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+1,s)-r:a=(f.state.columnWidths[n]??1)*f.state.cellWidth,A==="eraser"||qu.getIsActive())f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+2,s)-r:a=f.state.cellWidth*2;else if(A==="note"&&((l=f.state.selectedNote)==null?void 0:l.shape)==="circle")f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+2,s)-r:a=f.state.cellWidth*2;else if(A==="sixteenthStamp")f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+2,s)-r:a=f.state.cellWidth*2;else if(A==="tripletStamp"){const c=Ca.getSelectedTripletStamp();if(c){const d=2*(c.span==="eighth"?1:2);f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+d,s)-r:a=f.state.cellWidth*d}else a=f.state.cellWidth*2}else A==="tonicization"&&(f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0?a=lt(n+2,s)-r:a=f.state.cellWidth*2);kt.fillStyle=e,kt.fillRect(r,o,a,f.state.cellHeight)}function tb(n,t,e=!1){if(!kt||!f.state.selectedNote)return;const s=f.state.selectedTool,{shape:r,color:i}=f.state.selectedNote;if(kt.globalAlpha=e?.2:.4,s==="note"){const o=r==="circle"?n+1:n,A={uuid:"ghost-note",globalRow:t,row:t,startColumnIndex:n,endColumnIndex:o,color:i,shape:r,isDrum:!1},a={...f.state,zoomLevel:qe.getViewportInfo().zoomLevel};r==="oval"?bp(kt,a,A,t):Cp(kt,a,A,t)}kt.globalAlpha=1}function KR(n,t){const e=Yp.attemptPlaceNoteAt(n,t,{activeNote:jt,lastDragRow:Fs,activePreviewPitches:hn},Co,{getPitchForRow:Yo});return jt=e.state.activeNote,Fs=e.state.lastDragRow,hn=e.state.activePreviewPitches,e.placed&&e.shouldStartDragging&&(zr=!0),e.placed}function qR(){if(f.state.selectedTool!=="note")return!1;const n=f.state.deviceProfile;if(n&&typeof n.isMobile=="boolean")return n.isMobile;if(typeof window<"u"&&typeof window.matchMedia=="function")try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}return!1}function zR(n){var a;if(JC()){jo();return}if(!kt)return;const t=n.target instanceof Element?n.target:null;if(!t)return;const e=t.getBoundingClientRect(),s=n.clientX-e.left,r=n.clientY-e.top,i=((a=document.getElementById("canvas-container"))==null?void 0:a.scrollLeft)??0,o=Ps.getColumnIndex(s+i),A=Ps.getPitchRowIndex(r);if(!ZC(o,A)){f.state.selectedTool;return}if(n.button===2&&qu.handleMouseDown({event:n,colIndex:o,rowIndex:A,annotationService:Jt})){kt.clearRect(0,0,$e(kt.canvas),ie(kt.canvas)),XA(o,A,"rgba(220, 53, 69, 0.3)");return}if(n.button===0){const l=s+i;if($C.handleMouseDown(l,r))return;const c=Yp.handleExistingNoteMouseDown(o,A,{activeNote:jt,lastDragRow:Fs,activePreviewPitches:hn},{getPitchForRow:Yo});if(c.handled){jt=c.state.activeNote,Fs=c.state.lastDragRow,hn=c.state.activePreviewPitches;return}const u=f.state.selectedTool;if(u==="note"||u==="chord"){const p=jp.tryStartShapeDrag({actualX:s+i,canvasY:r}),h=!p&&Jp.tryStartShapeDrag({actualX:s+i,canvasY:r});if(p||h)return;const m=re.getSixteenthStampAtPosition(o,A),g=Yr(o,f.state),v=g===null?null:re.getTripletStampAtPosition(g,A);if(m||v)return}const d=bo.handleToolMouseDown({toolType:u,colIndex:o,rowIndex:A,actualX:s+i,canvasY:r,state:{isDragging:zr,isEraserDragActive:Hr,activeNote:jt,activeChordNotes:rr,activePreviewPitches:hn,lastDragRow:Fs}});if(d.handled){zr=d.state.isDragging,Hr=d.state.isEraserDragActive,jt=d.state.activeNote,rr=d.state.activeChordNotes,hn=d.state.activePreviewPitches,Fs=d.state.lastDragRow;return}}}function $R(n){var Q,U,W;if(JC()){jo();return}if(!kt)return;const t=n.target instanceof Element?n.target:null;if(!t)return;const e=t.getBoundingClientRect(),s=n.clientX-e.left,r=n.clientY-e.top,i=((Q=document.getElementById("canvas-container"))==null?void 0:Q.scrollLeft)??0,o=Ps.getColumnIndex(s+i),A=Ps.getPitchRowIndex(r);if(!kt)return;kt.clearRect(0,0,$e(kt.canvas),ie(kt.canvas));const a=n.target instanceof HTMLElement?n.target:null,l=f.state.selectedTool,c=s+i,u=Yr(o,f.state);if(bo.handleToolMouseMoveBeforeBoundsCheck({actualX:c,rowIndex:A,canvasEl:a,state:{isDragging:zr,isEraserDragActive:Hr,activeNote:jt,activeChordNotes:rr,activePreviewPitches:hn,lastDragRow:Fs}}).handled)return;bo.handleToolHoverVisuals({toolType:l,actualX:c,canvasY:r,pitchHoverCtx:kt,canvasEl:a,selectedModulationRatio:f.state.selectedModulationRatio,findNearestMeasureBoundary:nb,drawModulationPreview:XR});const p=(f.state.selectedTool==="note"||f.state.selectedTool==="chord")&&((U=f.state.selectedNote)==null?void 0:U.shape)==="circle",h=f.state.columnWidths.length,m=p?h-1:h;if(o<0||o>=m||Yo(A)===null){Jc.resetHoverState(),KC();return}GC(o,A);const g=re.getSixteenthStampAtPosition(o,A),v=u===null?null:re.getTripletStampAtPosition(u,A),w=!!(g||v),y=w&&(l==="note"||l==="chord");if(w&&l!=="eraser"&&!jp.isDraggingShape()&&!Jp.isDraggingShape()?HR(a):zC(),(l==="sixteenthStamp"||l==="tripletStamp")&&w)return;const C=bo.handleNoteOrChordDragMouseMove({colIndex:o,rowIndex:A,state:{isDragging:zr,isEraserDragActive:Hr,activeNote:jt,activeChordNotes:rr,activePreviewPitches:hn,lastDragRow:Fs}});if(C.handled){zr=C.state.isDragging,Hr=C.state.isEraserDragActive,jt=C.state.activeNote,rr=C.state.activeChordNotes,hn=C.state.activePreviewPitches,Fs=C.state.lastDragRow;return}if(!y&&bo.handleChordToolHover({colIndex:o,rowIndex:A,pitchHoverCtx:kt,zoomLevel:qe.getViewportInfo().zoomLevel,drawSingleColumnOvalNote:bp,drawTwoColumnOvalNote:Cp}))return;if(qu.handleMouseMove({event:n,colIndex:o,rowIndex:A,annotationService:Jt})){XA(o,A,"rgba(220, 53, 69, 0.3)");return}if(XC.handleMouseMove(o,A,Hr)){XA(o,A,"rgba(220, 53, 69, 0.3)");return}if(kt&&Jc.handleMouseMove({colIndex:o,rowIndex:A,hoverCtx:kt,getPitchForRow:Yo})||y)return;const b=Ye(f.state),S=((W=f.state.selectedNote)==null?void 0:W.shape)==="circle";let T=null,x=!0;if(f.state.selectedTool==="note"||f.state.selectedTool==="chord")x=aa(o,f.state)&&(!S||aa(o+1,f.state));else if(f.state.selectedTool==="sixteenthStamp"){const L=pf(o);x=L!==null&&!hh(L,b)&&!hh(L+1,b)}else if(f.state.selectedTool==="tripletStamp"){const L=Ca.getSelectedTripletStamp();if(L){const R=Yr(o,f.state);if(R===null)x=!1;else{T=R;const q=(w2[L.span]??1)*2,J=Cn(T,f.state);x=!0;for(const nt of b){const At=nt.columnIndex,ot=nt.columnIndex+1;if(At>=J&&At<J+q){x=!1;break}if(J>=At&&J<=ot){x=!1;break}}}}}const _=f.state.selectedTool==="eraser"?"rgba(220, 53, 69, 0.3)":x?jC(.2):"rgba(220, 53, 69, 0.15)";if(XA(o,A,_),f.state.selectedTool==="sixteenthStamp"){const L=Ku.getSelectedSixteenthStamp();if(L&&x){const R=pf(o);if(R===null)return;const N={cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.columnWidths,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth,macrobeatGroupings:f.state.macrobeatGroupings,previewColor:cv()};hM(kt,R,A,L,N)}}else if(f.state.selectedTool==="tripletStamp"){const L=Ca.getSelectedTripletStamp();if(L&&x&&T!==null){const R={cellWidth:f.state.cellWidth,cellHeight:f.state.cellHeight,columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.columnWidths,tempoModulationMarkers:f.state.tempoModulationMarkers,baseMicrobeatPx:f.state.cellWidth,macrobeatGroupings:f.state.macrobeatGroupings,previewColor:cv()};gM(kt,T,A,L,R)}}else x&&tb(o,A)}function jo(){kt&&kt.clearRect(0,0,$e(kt.canvas),ie(kt.canvas)),zC(),Jc.resetHoverState(),KC()}function eb(){var n,t,e,s,r;if(!bo.handleToolMouseUp()){if(hn.length>0){re.stopCurrentPattern();const i=(jt==null?void 0:jt.color)??((n=rr[0])==null?void 0:n.color)??((t=f.state.selectedNote)==null?void 0:t.color);i&&un.releasePitches(hn,i);const o=jt;if(o&&i)((e=f.state.timbres[i])==null?void 0:e.adsr)&&(s=f.state.fullRowData[o.row])!=null&&s.hex;else if(i){const a=hn[0];if(!a){hn=[];return}const l=f.state.fullRowData.find(c=>c.toneNote===a);l&&((r=f.state.timbres[i])!=null&&r.adsr)&&l.hex}hn=[];const A=window.waveformVisualizer;A&&A.stopLiveVisualization()}jt!=null&&jt.uuid&&Co.has(jt.uuid)&&(f.emit("noteRelease",{noteId:jt.uuid,color:jt.color}),Co.delete(jt.uuid)),rr.forEach(i=>{i!=null&&i.uuid&&Co.has(i.uuid)&&(f.emit("noteRelease",{noteId:i.uuid,color:i.color}),Co.delete(i.uuid))}),zr&&f.recordState(),zr=!1,Fs=null,jt!=null&&jt.uuid&&f.emit("noteInteractionEnd",{noteId:jt.uuid}),rr.forEach(i=>{i.uuid&&f.emit("noteInteractionEnd",{noteId:i.uuid})}),jt=null,rr=[],Hr&&(f.recordState(),Hr=!1),qu.handleGlobalMouseUp(),jo()}}function nb(n){const{macrobeatBoundaryStyles:t}=f.state,e=100,s=[],r=f.state.tempoModulationMarkers&&f.state.tempoModulationMarkers.length>0;E.debug("PitchGridInteractor","Boundary calculation modulation state",{hasModulation:r},"grid");for(let a=0;a<t.length;a++)if(t[a]==="solid"){const l=mn(f.state,a);if(l){const c=l.endColumn+1,u=lt(c,{...f.state,tempoModulationMarkers:f.state.tempoModulationMarkers||[],cellWidth:f.state.cellWidth,columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.columnWidths,baseMicrobeatPx:f.state.cellWidth});E.debug("PitchGridInteractor","Computed measure boundary",{boundaryIndex:a,endColumn:l.endColumn,calculatedX:u,method:"canvas-space"},"grid"),s.push({measureIndex:a+1,xPosition:u,macrobeatIndex:a})}}const i=lt(0,{...f.state,tempoModulationMarkers:f.state.tempoModulationMarkers||[],cellWidth:f.state.cellWidth,columnWidths:f.state.columnWidths,musicalColumnWidths:f.state.columnWidths,baseMicrobeatPx:f.state.cellWidth});E.debug("PitchGridInteractor","Start boundary position",{startBoundaryX:i,method:"canvas-space"},"grid"),s.unshift({measureIndex:0,xPosition:i,macrobeatIndex:-1}),E.debug("PitchGridInteractor","Available measure boundaries",{boundaries:s},"grid"),E.debug("PitchGridInteractor","Modulation click context",{clickX:n,tolerance:e},"grid");let o=null,A=1/0;return s.forEach(a=>{const l=Math.abs(n-a.xPosition);E.debug("PitchGridInteractor","Boundary distance check",{boundaryX:a.xPosition,distance:l},"grid"),l<=e&&l<A&&(A=l,o=a)}),o?E.debug("PitchGridInteractor","Found closest boundary",{boundary:o,distance:A},"grid"):E.debug("PitchGridInteractor","No boundary found within tolerance",{tolerance:e},"grid"),o}function XR(n,t,e){if(!e)return;const s=Yw(e),r=Xw(e);n.save();const i=3,o=2,A=ie(n.canvas);n.strokeStyle=s,n.lineWidth=o,n.globalAlpha=.7,n.setLineDash([]);for(let a=-1;a<=1;a++){const l=t+a*i;n.beginPath(),n.moveTo(l,0),n.lineTo(l,A),n.stroke()}n.globalAlpha=.8,n.font="12px Arial, sans-serif",n.textAlign="center",n.textBaseline="top",n.fillStyle=s,n.fillText(`Preview: ${r}`,t,10),n.restore()}function YR(){const n=document.getElementById("notation-grid"),t=document.getElementById("hover-canvas");if(!n||!t){E.error("PitchGridInteractor","Could not find required canvas elements.",{hasPitchCanvas:!!n,hasHoverCanvas:!!t},"grid");return}if(kt=t.getContext("2d"),!kt){E.error("PitchGridInteractor","Could not get hover canvas context.",null,"grid");return}fA.setPitchCanvasElement(n),n.addEventListener("mousedown",zR),n.addEventListener("mousemove",$R),n.addEventListener("mouseleave",jo),n.addEventListener("contextmenu",e=>e.preventDefault()),n.addEventListener("touchstart",e=>fA.handleTouchStart(e),{passive:!1}),n.addEventListener("touchmove",e=>fA.handleTouchMove(e),{passive:!1}),n.addEventListener("touchend",e=>fA.handleTouchEnd(e),{passive:!1}),n.addEventListener("touchcancel",()=>fA.handleTouchCancel(),{passive:!1}),window.addEventListener("mouseup",eb)}const jR={init(){YR(),Ek(),document.addEventListener("canvasResized",()=>{this.renderPitchGrid(),this.renderDrumGrid()}),f.on("animationUpdate",n=>{n.type==="vibrato"&&n.activeColors&&n.activeColors.length>0?this.renderPitchGrid():n.type==="envelopeFill"||n.hasEnvelopeFills?this.renderPitchGrid():n.type==="combined"&&n.vibratoColors&&n.vibratoColors.length>0&&this.renderPitchGrid()}),E.debug("GridManager","Initialized pitch and drum grid interactions",null,"grid")},renderPitchGrid:Go.render,renderDrumGrid:tn.render};function JR(){const n=fe.init();return Aa.setContexts(n),mR.init(),jR.init(),n}class ZR{constructor(){M(this,"currentTool",null);M(this,"toolButtons",[]);M(this,"toolPanels",[]);M(this,"lastSelectedNote",null);M(this,"optionsContainers",{arrow:null,text:null,marker:null,highlighter:null,lasso:null});M(this,"settings",{arrow:{lineStyle:"solid",strokeWeight:4,startArrowhead:"none",endArrowhead:"filled-arrow",arrowheadSize:12},text:{color:"#000000",size:16,bold:!1,italic:!1,underline:!1,background:!1,superscript:!1,subscript:!1},marker:{color:"#4a90e2",size:6},highlighter:{color:"#4a90e2",size:10},lasso:{}})}initialize(){if(this.toolButtons=document.querySelectorAll(".draw-tool-button"),this.toolPanels=document.querySelectorAll(".draw-tool-panel"),this.optionsContainers={arrow:document.getElementById("arrow-tool-options"),text:document.getElementById("text-tool-options"),marker:document.getElementById("marker-tool-options"),highlighter:document.getElementById("highlighter-tool-options"),lasso:document.getElementById("lasso-tool-options")},!this.toolButtons.length||!this.optionsContainers.arrow){E.warn("DrawToolsController","Could not find draw tool elements",null,"draw");return}this.attachEventListeners(),this.setupChordTabListeners(),this.setupMainTabListeners(),this.populateAllPanels(),this.initializePanelWidthSync(),this.logPanelMetrics(),window.addEventListener("resize",()=>this.logPanelMetrics(),{passive:!0}),f.on("noteChanged",({newNote:t}={})=>{this.lastSelectedNote=t??null,this.currentTool&&this.deselectAllTools()})}attachEventListeners(){this.toolButtons.forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.drawTool;this.selectTool(e)})})}setupMainTabListeners(){document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{e.dataset.tab!=="pitch"&&this.currentTool&&(this.deselectAllTools(),this.restoreLastSelectedNote())})})}setupChordTabListeners(){document.querySelectorAll(".pitch-tab-button").forEach(e=>{e.addEventListener("click",()=>{e.dataset.pitchTab!=="draw"&&this.currentTool&&(this.deselectAllTools(),this.restoreLastSelectedNote())})})}restoreLastSelectedNote(){this.lastSelectedNote?(f.setSelectedNote(this.lastSelectedNote.shape,this.lastSelectedNote.color),f.setSelectedTool("note")):f.state.selectedNote&&(f.setSelectedNote(f.state.selectedNote.shape,f.state.selectedNote.color),f.setSelectedTool("note"))}deselectAllTools(){this.toolButtons.forEach(t=>t.classList.remove("active")),this.toolPanels.forEach(t=>t.classList.remove("active")),this.currentTool=null,Jt.setTool(null,null),f.state.selectedTool==="draw"&&f.setSelectedTool("note")}selectTool(t){var s;this.toolButtons.forEach(r=>r.classList.remove("active")),this.toolPanels.forEach(r=>r.classList.remove("active"));const e=Array.from(this.toolButtons).find(r=>r.dataset.drawTool===t);if(e){e.classList.add("active");const r=e.closest(".draw-tool-panel");r==null||r.classList.add("active")}this.currentTool=t,Jt.setTool(t,this.settings),f.setSelectedTool("draw"),f.state.selectedNote={shape:"circle",color:((s=f.state.selectedNote)==null?void 0:s.color)||"#4a90e2"}}populateAllPanels(){this.populateArrowOptions(),this.populateTextOptions(),this.populateMarkerOptions(),this.populateHighlighterOptions()}initializePanelWidthSync(){const t=Array.from(this.toolPanels);t.length&&t.forEach(e=>{e.style.minWidth="",e.style.width="fit-content",e.style.maxWidth="100%",e.style.flex="0 0 auto"})}logPanelMetrics(){try{const t=document.querySelector(".draw-layout-grid");Array.from(this.toolPanels??[]).forEach(s=>{s.getBoundingClientRect()}),t==null||t.getBoundingClientRect()}catch{}}populateArrowOptions(){const t=this.optionsContainers.arrow;if(!t)return;const e=t.querySelector("#arrow-start-head-trigger"),s=t.querySelector("#arrow-end-head-trigger"),r=(d,p)=>p!=="filled-arrow"?`
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="4" y1="12" x2="20" y2="12"/>
          </svg>
        `:d==="start"?`
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9,5 3,12 9,19"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
          </svg>
        `:`
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,5 21,12 15,19"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
        </svg>
      `,i=(d,p,h)=>{d&&(d.innerHTML=r(p,h))},o=t.querySelector("#arrow-stroke-weight");o&&(o.value=`${this.settings.arrow.strokeWeight}`,o.addEventListener("input",()=>{this.settings.arrow.strokeWeight=parseInt(o.value,10),Jt.setTool("arrow",this.settings)}));const A=t.querySelector("#arrow-head-size");A&&(A.value=`${this.settings.arrow.arrowheadSize}`,A.addEventListener("input",()=>{this.settings.arrow.arrowheadSize=parseInt(A.value,10),Jt.setTool("arrow",this.settings)}));const a=Array.from(t.querySelectorAll("[data-line-style]"));if(a.length){const d=p=>{a.forEach(h=>h.classList.toggle("active",h.dataset.lineStyle===p))};d(this.settings.arrow.lineStyle),a.forEach(p=>{p.addEventListener("click",()=>{const h=p.dataset.lineStyle;h&&(this.settings.arrow.lineStyle=h,d(h),Jt.setTool("arrow",this.settings))})})}const l=Array.from(t.querySelectorAll("[data-arrow-start]"));if(l.length){const d=p=>{l.forEach(h=>h.classList.toggle("active",h.dataset.arrowStart===p)),i(e,"start",p)};d(this.settings.arrow.startArrowhead),l.forEach(p=>{p.addEventListener("click",()=>{const h=p.dataset.arrowStart;h&&(this.settings.arrow.startArrowhead=h,d(h),Jt.setTool("arrow",this.settings))})})}const c=Array.from(t.querySelectorAll("[data-arrow-end]"));if(c.length){const d=p=>{c.forEach(h=>h.classList.toggle("active",h.dataset.arrowEnd===p)),i(s,"end",p)};d(this.settings.arrow.endArrowhead),c.forEach(p=>{p.addEventListener("click",()=>{const h=p.dataset.arrowEnd;h&&(this.settings.arrow.endArrowhead=h,d(h),Jt.setTool("arrow",this.settings))})})}const u=t.querySelector("#arrow-swap-heads");u&&u.addEventListener("click",()=>{const d=this.settings.arrow.startArrowhead;if(this.settings.arrow.startArrowhead=this.settings.arrow.endArrowhead,this.settings.arrow.endArrowhead=d,l.length){const p=this.settings.arrow.startArrowhead;l.forEach(h=>h.classList.toggle("active",h.dataset.arrowStart===p)),i(e,"start",p)}if(c.length){const p=this.settings.arrow.endArrowhead;c.forEach(h=>h.classList.toggle("active",h.dataset.arrowEnd===p)),i(s,"end",p)}Jt.setTool("arrow",this.settings)})}populateTextOptions(){const t=this.optionsContainers.text;if(!t)return;const e=t.querySelector("#text-size-input");e&&(e.value=`${this.settings.text.size}`,e.addEventListener("input",()=>{this.settings.text.size=parseInt(e.value,10),Jt.setTool("text",this.settings)}));const s=Array.from(t.querySelectorAll(".draw-color-button"));if(s.length){const i=o=>{s.forEach(A=>{const a=A.dataset.color||"";A.classList.toggle("active",a.toLowerCase()===o.toLowerCase())})};i(this.settings.text.color),s.forEach(o=>{o.addEventListener("click",()=>{const A=o.dataset.color;A&&(this.settings.text.color=A,i(A),Jt.setTool("text",this.settings))})})}const r=Array.from(t.querySelectorAll("[data-text-style]"));if(r.length){const i=["bold","italic","underline","background","superscript","subscript"],o=A=>{this.settings.text[A]=!this.settings.text[A],Jt.setTool("text",this.settings)};r.forEach(A=>{const a=A.dataset.textStyle;a&&i.includes(a)&&A.classList.toggle("active",!!this.settings.text[a])}),r.forEach(A=>{A.addEventListener("click",()=>{const a=A.dataset.textStyle;!a||!i.includes(a)||(o(a),A.classList.toggle("active",!!this.settings.text[a]))})})}}populateMarkerOptions(){const t=this.optionsContainers.marker;if(!t)return;const e=t.querySelector("#marker-size-input");e&&(e.value=`${this.settings.marker.size}`,e.addEventListener("input",()=>{this.settings.marker.size=parseInt(e.value,10),Jt.setTool("marker",this.settings)}));const s=Array.from(t.querySelectorAll(".draw-color-button"));if(s.length){const r=i=>{s.forEach(o=>{const A=o.dataset.color||"";o.classList.toggle("active",A.toLowerCase()===i.toLowerCase())})};r(this.settings.marker.color),s.forEach(i=>{i.addEventListener("click",()=>{const o=i.dataset.color;o&&(this.settings.marker.color=o,r(o),Jt.setTool("marker",this.settings))})})}}populateHighlighterOptions(){const t=this.optionsContainers.highlighter;if(!t)return;const e=t.querySelector("#highlighter-size-input");e&&(e.value=`${this.settings.highlighter.size}`,e.addEventListener("input",()=>{this.settings.highlighter.size=parseInt(e.value,10),Jt.setTool("highlighter",this.settings)}));const s=Array.from(t.querySelectorAll(".draw-color-button"));if(s.length){const r=i=>{s.forEach(o=>{const A=o.dataset.color||"";o.classList.toggle("active",A.toLowerCase()===i.toLowerCase())})};r(this.settings.highlighter.color),s.forEach(i=>{i.addEventListener("click",()=>{const o=i.dataset.color;o&&(this.settings.highlighter.color=o,r(o),Jt.setTool("highlighter",this.settings))})})}}}const Vd=new ZR;function tH(){var n;return Jt.initialize(),(n=Vd.initialize)==null||n.call(Vd),E.initSuccess("DrawSystem"),typeof window<"u"&&(window.annotationService=Jt),{annotationService:Jt}}E.moduleLoaded("KeyboardHandler","keyboard");function eH(){document.addEventListener("keydown",n=>{var i;const t=document.activeElement;if(!t)return;const e=t.tagName.toLowerCase(),s=t.contentEditable==="true";if(["input","textarea"].includes(e)||s)return;if(n.ctrlKey&&n.key.toLowerCase()==="p"){n.preventDefault(),E.info("KeyboardHandler","Ctrl+P pressed. Opening print preview",null,"keyboard"),f.emit("printPreviewStateChanged",!0);return}if(n.ctrlKey&&n.key.toLowerCase()==="z"){n.preventDefault(),f.undo();return}if(n.ctrlKey&&n.key.toLowerCase()==="y"){n.preventDefault(),f.redo();return}let r=!1;switch(n.key){case"Backspace":case"Delete":if((i=f.state.lassoSelection)!=null&&i.isActive){const o=f.state.lassoSelection.selectedItems;o.forEach(A=>{if(A.type==="note"){const a=A.data,l=f.state.placedNotes.findIndex(c=>c.uuid===a.uuid);l!==-1&&f.state.placedNotes.splice(l,1)}else if(A.type==="sixteenthStamp"){const a=A.data,l=f.state.sixteenthStampPlacements.findIndex(c=>c.id===a.id);l!==-1&&f.state.sixteenthStampPlacements.splice(l,1)}else if(A.type==="tripletStamp"){const a=A.data,l=f.state.tripletStampPlacements.findIndex(c=>c.id===a.id);l!==-1&&f.state.tripletStampPlacements.splice(l,1)}}),f.state.lassoSelection={selectedItems:[],convexHull:null,isActive:!1},f.recordState(),f.emit("render"),r=!0,E.info("KeyboardHandler",`Deleted ${o.length} items from lasso selection`,null,"keyboard")}break}r&&n.preventDefault()}),E.info("KeyboardHandler","Initialized",null,"keyboard")}E.moduleLoaded("TransportKeyboardShortcuts","keyboard");function nH(){const n=document.activeElement;if(!(n instanceof HTMLElement))return!0;const t=n.tagName.toLowerCase();return!(["input","textarea","select"].includes(t)||n.isContentEditable)}function sH(){let n=!1;document.addEventListener("keydown",t=>{if(t.code!=="Space"||n||t.repeat||!nH())return;const e=document.getElementById("play-button");e&&(t.preventDefault(),n=!0,e.click())}),document.addEventListener("keyup",t=>{t.code==="Space"&&(n=!1)}),E.info("TransportKeyboardShortcuts","Initialized",null,"keyboard")}const rH=[{label:"Toolbar",selector:"#toolbar"},{label:"Toolbar Primary",selector:"#toolbar-primary"},{label:"Primary Actions Grid",selector:"#toolbar-primary .primary-toolbar-actions"},{label:"Primary Playback Row",selector:"#toolbar-primary .primary-toolbar-playback"},{label:"Toolbar Secondary",selector:"#toolbar-secondary"},{label:"Toolbar Preset Controls",selector:"#toolbar-secondary .preset-effects-controls"},{label:"Toolbar Tab Sidebar",selector:"#toolbar-secondary .tab-sidebar"},{label:"Sidebar",selector:"#sidebar"},{label:"Timbre Tab Panel",selector:"#timbre-panel"},{label:"Pitch Tab Panel",selector:"#pitch-panel"},{label:"Rhythm Tab Panel",selector:"#rhythm-panel"},{label:"Macrobeat Tools",selector:"#canvas-macrobeat-tools, #macrobeat-tools"},{label:"Waveform Card",selector:"#timbre-panel .waveform-content-box"},{label:"Preset Card",selector:"#timbre-panel .preset-content-box"},{label:"Effects Card",selector:"#timbre-panel #effects-panel .effects-content-box"},{label:"Envelope Card",selector:"#adsr-envelope"},{label:"Harmonics Card",selector:".harmonic-bins-container"},{label:"Canvas Container",selector:"#canvas-container"},{label:"Pitch Grid Wrapper",selector:"#pitch-grid-wrapper"},{label:"Pitch Grid Container",selector:"#pitch-grid-container"},{label:"Drum Grid Wrapper",selector:"#drum-grid-wrapper"},{label:"Drum Grid",selector:"#drum-grid"}],mf=new Map;let gf,Wd,Gd=null,pA="",yo=!1;function Hl(n){return Number.isFinite(n)?Number(n.toFixed(1)):n}function iH(n){const t=n.getBoundingClientRect(),e=window.getComputedStyle(n);return{tag:n.tagName.toLowerCase(),id:n.id||null,class:n.className||null,top:Hl(t.top),left:Hl(t.left),width:Hl(t.width),height:Hl(t.height),offsetWidth:n.offsetWidth,offsetHeight:n.offsetHeight,scrollWidth:n.scrollWidth,scrollHeight:n.scrollHeight,clientWidth:n.clientWidth,clientHeight:n.clientHeight,display:e.display,position:e.position,overflowX:e.overflowX,overflowY:e.overflowY,transform:e.transform!=="none"?e.transform:void 0}}function sb(n="manual"){const t=window.__uiDiagnosticsTrackedElements;if(!t)return[];if(!yo&&n!=="manual")return[];lc();const e=[];return t.forEach(s=>{const r=Array.from(document.querySelectorAll(s.selector));if(!r.length){e.push({label:s.label,selector:s.selector,missing:!0});return}r.forEach((i,o)=>{const A=r.length>1?`${s.label} [${o}]`:s.label,a=iH(i);e.push({label:A,selector:s.selector,info:a})})}),window.__uiDiagnosticsLastSnapshot=e,e}function lo(n){yo&&(pA=pA?`${pA}; ${n}`:n,Gd===null&&(Gd=requestAnimationFrame(()=>{const t=pA||"auto";Gd=null,pA="",sb(t)})))}function lc(){const n=window.__uiDiagnosticsTrackedElements;!n||!gf||n.forEach(t=>{document.querySelectorAll(t.selector).forEach(s=>{mf.has(s)||(mf.set(s,t.label),gf.observe(s),s.addEventListener("scroll",()=>lo(`${t.label} scroll`),{passive:!0}))})})}function oH(n={}){if(window.__uiDiagnosticsInitialized)return;window.__uiDiagnosticsInitialized=!0;const{elements:t,autoLog:e=!1}=n;yo=!!e,window.__uiDiagnosticsAutoLog=yo;const s=t||rH;window.__uiDiagnosticsTrackedElements=s,gf=new ResizeObserver(r=>{const i=r.map(o=>mf.get(o.target)||o.target.id||o.target.tagName.toLowerCase()).filter(Boolean);i.length&&lo(`Resize: ${i.join(", ")}`)}),Wd=new MutationObserver(()=>lc()),document.body?Wd.observe(document.body,{childList:!0,subtree:!0}):document.addEventListener("DOMContentLoaded",()=>{Wd.observe(document.body,{childList:!0,subtree:!0}),lc(),lo("init")},{once:!0}),window.addEventListener("resize",()=>lo("window resize")),lc(),lo("init"),window.logUIState=(r="manual")=>sb(r),window.enableUIDiagnosticsAutoLog=()=>{yo=!0,window.__uiDiagnosticsAutoLog=!0,lo("auto-log enabled")},window.disableUIDiagnosticsAutoLog=()=>{yo=!1,window.__uiDiagnosticsAutoLog=!1}}function AH(){E.section("SETTING UP INPUT HANDLERS"),eH(),sH(),CR(),window.enableUIDiagnostics&&oH()}const aH=()=>{if(typeof window>"u")return!1;const n=window.__initDebug;return n===!0},gs=(n,t)=>{if(aH()){if(t===void 0){console.log(`[Init] ${n}`);return}console.log(`[Init] ${n}`,t)}};let vf=!1,ui=[],Kd=!1,ro=null,qd=!1;function lH(){Kd=!1,ro=null,qd=!1,window.initAudio=async()=>{if(!Kd)return ro||(ro=(async()=>{try{er.state!=="running"&&(await Bc(),E.info("Main.js","AudioContext started successfully")),Kd=!0}catch(e){throw E.error("Main.js","Could not start AudioContext",e),ro=null,e}})(),ro)};const n=()=>{var e;qd||(qd=!0,(e=window.initAudio)==null||e.call(window).catch(s=>E.warn("Main.js","Failed to initialize audio after user interaction",s,"initialization")),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",n,!0),document.removeEventListener("touchstart",n,!0))},t=()=>{typeof Wt.teardown=="function"&&Wt.teardown()};document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),document.addEventListener("touchstart",n,!0),window.addEventListener("beforeunload",t),ui.push(()=>document.removeEventListener("click",n,!0)),ui.push(()=>document.removeEventListener("keydown",n,!0)),ui.push(()=>document.removeEventListener("touchstart",n,!0)),ui.push(()=>window.removeEventListener("beforeunload",t)),ui.push(()=>{delete window.initAudio})}const Jo={domCache:!1,layoutService:!1,canvasContextService:!1,synthEngine:!1,transportService:!1,scrollSync:!1,uiComponents:!1,audioComponents:!1,rhythmPlaybackService:!1,initialized:!1},cH={top:"G5",bottom:"C4"};function uH(n){if(!(n!=null&&n.top)||!(n!=null&&n.bottom))return null;const t=Wn.findIndex(s=>s.toneNote===n.top),e=Wn.findIndex(s=>s.toneNote===n.bottom);return t===-1||e===-1?(E.warn("Main.js","Failed to resolve preset range from tone notes",n),null):{topIndex:Math.min(t,e),bottomIndex:Math.max(t,e)}}function dH(){return uH(cH)}function qs(n){Jo[n]=!0}function uv(n,t=5e3){return new Promise((e,s)=>{if(Jo[n]){e();return}const r=Date.now(),i=()=>{Jo[n]?e():Date.now()-r>t?s(new Error(`Component ${n} not ready within ${t}ms`)):setTimeout(i,50)};i()})}function rb(){Object.keys(Jo).forEach(n=>{Jo[n]=!1})}async function hH(){var t,e;window.initStartTime=Date.now(),E.info("Main.js","Initialization triggered"),E.section("STARTING INITIALIZATION");const n=["dom-cache","drum-samples","state-setup","canvas-services","layout-ready","synth-engine","rhythm-playback","transport-service","input-handlers","store-hooks","ui-components","audio-components","state-subscriptions","initial-render","finalize"];try{wt.init(),n.forEach(c=>wt.registerTask(c)),gs("startup rhythm defaults",{macrobeatGroupings:f.state.macrobeatGroupings,macrobeatBoundaryStyles:f.state.macrobeatBoundaryStyles});const s=((t=f.state.selectedNote)==null?void 0:t.color)??"#4a90e2",r=(e=f.state.timbres)==null?void 0:e[s];gs("startup adsr defaults",{color:s,adsr:(r==null?void 0:r.adsr)??null,preset:(r==null?void 0:r.activePresetName)??null}),await wt.nextFrame(),f5(),SF({latencyHint:"playback",lookAhead:.1}),E.info("Main.js","AudioContext configured with latencyHint: playback"),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&RB(),wt.updateStatus("Initializing interface..."),fr.init(),qs("domCache"),wt.completeTask("dom-cache"),await wt.nextFrame(),wt.updateStatus("Loading audio samples..."),await I5(),wt.completeTask("drum-samples"),E.info("Main.js","Drum samples preloaded"),await wt.nextFrame(),(()=>{const c=fr.get("appContainer")||document.getElementById("app-container");if(c){const u=["click","keydown","touchstart"],d=()=>{var p;(p=window.initAudio)==null||p.call(window)};u.forEach(p=>{c.addEventListener(p,d,{once:!0})})}})(),wt.updateStatus("Preparing core systems..."),B5(f.state);const o=f.state.pitchRange||{topIndex:0,bottomIndex:Wn.length-1},A=Math.max(0,Math.min(Wn.length-1,o.topIndex??0)),a=Math.max(A,Math.min(Wn.length-1,o.bottomIndex??Wn.length-1));f.state.pitchRange={topIndex:A,bottomIndex:a},f.state.fullRowData=[...Wn],wt.completeTask("state-setup"),await wt.nextFrame(),wt.updateStatus("Sizing canvas..."),JR(),qs("layoutService"),qs("canvasContextService"),wt.completeTask("canvas-services"),await wt.nextFrame(),wt.updateStatus("Calculating layout..."),await fe.waitForInitialLayout(),wt.completeTask("layout-ready"),await wt.nextFrame(),wt.updateStatus("Initializing synth engine..."),Wt.init(),qs("synthEngine"),wt.completeTask("synth-engine"),await wt.nextFrame(),wt.updateStatus("Preparing rhythm playback..."),re.initialize().catch(c=>{E.warn("Main.js","RhythmPlaybackService initialization deferred (needs user interaction)",c,"initialization")}),qs("rhythmPlaybackService"),wt.completeTask("rhythm-playback"),await wt.nextFrame(),wt.updateStatus("Configuring transport..."),nr.init(),qs("transportService"),wt.completeTask("transport-service"),await wt.nextFrame(),wt.updateStatus("Registering input handlers..."),AH(),wt.completeTask("input-handlers"),await wt.nextFrame(),wt.updateStatus("Syncing state services..."),a_(f),g_(f),FF({getColumnMap:c=>Ne.getColumnMap(c),visualToTimeIndex:(c,u)=>Ne.getColumnMap(c).visualToTime.get(u)??null,timeIndexToVisualColumn:(c,u)=>Ne.getColumnMap(c).timeToVisual.get(u)??null,getTimeBoundaryAfterMacrobeat:(c,u)=>{const p=Ne.getColumnMap(c).macrobeatBoundaries.find(h=>h.macrobeatIndex===u);return p?p.timeColumn+1:0}}),wt.completeTask("store-hooks"),await wt.nextFrame(),wt.updateStatus("Loading interface components..."),gs("Loading interface components..."),gs("initUiComponents:start"),$k(),gs("initUiComponents:done"),qs("uiComponents"),gs("uiComponents marked ready"),wt.completeTask("ui-components"),gs("ui-components task complete"),await wt.nextFrame(),gs("ui-components nextFrame resolved"),gs("waitForComponent:uiComponents"),await uv("uiComponents"),gs("waitForComponent:uiComponents resolved"),wt.updateStatus("Preparing audio components..."),uR(),qs("audioComponents"),wt.completeTask("audio-components"),await wt.nextFrame(),C5(f.state,"audio-components-initialization"),fR(),tH(),await uv("audioComponents"),E.section("SETTING UP STATE SUBSCRIPTIONS"),wt.updateStatus("Binding state subscriptions...");const l=()=>{try{Go.render();const c=window.DrumGridController;c!=null&&c.render&&c.render(),E.debug("Main","renderAll invoked",null,"grid")}catch(c){E.error("Main","renderAll failed",c,"grid")}};if(wt.completeTask("state-subscriptions"),await wt.nextFrame(),E.section("PERFORMING INITIAL RENDER"),f.setSelectedTool("note"),f.setSelectedNote("circle","#4a90e2"),wt.updateStatus("Rendering workspace..."),l(),Go.renderMacrobeatTools(),wt.completeTask("initial-render"),Zl.prefetchButtonGridSnapshot(),await wt.nextFrame(),qs("initialized"),E.section("INITIALIZATION COMPLETE"),wt.updateStatus("Finalizing..."),wt.completeTask("finalize"),await wt.nextFrame(),f.isColdStart){const c=dH();c?qe.setPitchViewportRange(c,{animateMs:0,source:"coldStart:treble"}):E.warn("Main.js","Treble Clef preset range could not be resolved during cold start")}await wt.complete(),window.ModulationTest=WB}catch(s){E.error("Main.js","Initialization failed",s,"initialization"),E.error("Main.js","Component readiness snapshot at failure",{...Jo},"initialization");const r=s instanceof Error?s:new Error(String(s));wt.showError(r);const i=document.createElement("div");i.style.cssText=`
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #ff4444; color: white; padding: 20px; border-radius: 8px;
            z-index: 10000; font-family: monospace; max-width: 80vw;
        `,i.innerHTML=`
            <h3>Initialization Error</h3>
            <p>The application failed to initialize properly.</p>
            <details>
                <summary>Technical Details</summary>
                <pre>${r.message}</pre>
                <pre>Stack: ${r.stack}</pre>
            </details>
            <button onclick="location.reload()">Reload Page</button>
        `,document.body.appendChild(i)}}function fH(){vf||(vf=!0,rb(),lH(),fr.refresh(),hH())}function pH(){ui.forEach(t=>t()),ui=[];try{qk()}catch(t){E.warn("Main.js","Failed to unmount Svelte components",t,"cleanup")}typeof Wt.teardown=="function"&&Wt.teardown(),typeof re.dispose=="function"&&re.dispose();const n=["is-mobile","is-touch","orientation-portrait","orientation-landscape"];[document.documentElement,document.body].forEach(t=>{n.forEach(e=>t==null?void 0:t.classList.remove(e))}),rb(),vf=!1}const mH=Object.assign({"../public/apple-touch-icon.png":lb,"../public/assets/icons/clear.svg":cb,"../public/assets/icons/diamond-note.svg":ub,"../public/assets/icons/eraser.svg":db,"../public/assets/icons/lasso-tool.svg":hb,"../public/assets/icons/loop.svg":fb,"../public/assets/icons/marker-tool.svg":pb,"../public/assets/icons/pause.svg":fv,"../public/assets/icons/play.svg":pv,"../public/assets/icons/redo.svg":mb,"../public/assets/icons/settings.svg":gb,"../public/assets/icons/stop.svg":vb,"../public/assets/icons/undo.svg":wb,"../public/assets/icons/volume.svg":Bb,"../public/assets/icons/zoomIn.svg":Cb,"../public/assets/icons/zoomOut.svg":bb,"../public/assets/sidebar/hideAnalysis.svg":yb,"../public/assets/sidebar/hideDrums.svg":Sb,"../public/assets/sidebar/newPage.svg":Eb,"../public/assets/sidebar/open.svg":xb,"../public/assets/sidebar/print.svg":Ib,"../public/assets/sidebar/saveAs.svg":Fb,"../public/assets/tabicons/dottedQuarterNote.svg":Tb,"../public/assets/tabicons/eigthNote.svg":_b,"../public/assets/tabicons/phaseButton_0.svg":Mb,"../public/assets/tabicons/phaseButton_180.svg":Qb,"../public/assets/tabicons/phaseButton_270.svg":Ub,"../public/assets/tabicons/phaseButton_90.svg":Pb,"../public/assets/tabicons/quarterNote.svg":Nb,"../public/assets/tabicons/tonicShape_1.svg":Lb,"../public/assets/tabicons/tonicShape_2.svg":Db,"../public/assets/tabicons/tonicShape_3.svg":kb,"../public/assets/tabicons/tonicShape_4.svg":Rb,"../public/assets/tabicons/tonicShape_5.svg":Hb,"../public/assets/tabicons/tonicShape_6.svg":Ob,"../public/assets/tabicons/tonicShape_7.svg":Vb,"../public/favicon-96x96.png":Wb,"../public/favicon.ico":Gb,"../public/favicon.svg":Kb,"../public/fonts/atkinsonHyperlegibleNextBold.otf":qb,"../public/fonts/atkinsonHyperlegibleNextRegular.otf":zb,"../public/fonts/atkinsonHyperlegibleNextRegularItalic.otf":$b,"../public/site.webmanifest":Xb,"../public/web-app-manifest-192x192.png":Yb,"../public/web-app-manifest-512x512.png":jb}),gH="../public/",vH=()=>{if(typeof window>"u")return!1;const n=window.__initDebug;return n===!0},Ol=(n,t)=>{if(vH()){if(t===void 0){console.log(n);return}console.log(n,t)}};function wH(n){const t=n.replace(/^\/+/,""),e=`${gH}${t}`;return mH[e]??n}function BH(n){n.querySelectorAll("[src], [href]").forEach(e=>{const s=e.hasAttribute("src")?"src":"href",r=e.getAttribute(s);!r||r.startsWith("http")||r.startsWith("data:")||r.startsWith("#")||!r.startsWith("assets/")&&!r.startsWith("fonts/")&&!r.startsWith("favicon")||e.setAttribute(s,wH(r))})}function CH(n){return Ol("[StudentNotation] mount:start",{hasTemplate:!!Xu,templateLength:Xu.length,containerId:n.id||null}),n.innerHTML=Xu,Ol("[StudentNotation] template injected"),BH(n),Ol("[StudentNotation] assets rewritten"),fH(),Ol("[StudentNotation] initStudentNotation:called"),{destroy:()=>{pH(),n.innerHTML=""}}}const dv=document.getElementById("app");dv&&CH(dv);
//# sourceMappingURL=index-BVBZpVTd.js.map
