{"version":3,"file":"ScreenReaderManager-xThtuh_I.js","sources":["../../../../packages/diatonic-compass-ui/src/accessibility/ScreenReaderManager.ts"],"sourcesContent":["// (file path: src/accessibility/ScreenReaderManager.ts)\r\n\r\nimport { appState } from '../state/appState.ts';\r\nimport { ErrorHandler } from '../utils/ErrorHandler.ts';\r\nimport { CONFIG } from '../core/constants.ts';\r\nimport { generateDisplayLabels, getMusicalInfo } from '../core/logic.ts';\nimport { CHROMATIC_NOTES, DIATONIC_INTERVALS, MODE_NAME } from '../core/constants.ts';\n\ntype AnnouncedState = {\n  pitch?: string;\n  mode?: string;\n  isPlaying: boolean;\n};\n\ntype AriaPriority = 'polite' | 'assertive';\ntype MusicalInfo = NonNullable<ReturnType<typeof getMusicalInfo>>;\n\ntype MusicalChangeType =\n  | 'key-change'\n  | 'mode-change'\n  | 'note-change'\n  | 'playback-start'\n  | 'playback-stop'\n  | 'playback-note'\n  | 'general';\n\ntype MusicalChangeDetails = {\n  key?: string;\n  mode?: string;\n  note?: string;\n  message?: string;\n};\n\ntype InteractionType =\n  | 'wheel-drag'\n  | 'belt-drag'\n  | 'chromatic-drag'\n  | 'playback-start'\n  | 'settings-open'\n  | 'tutorial-start';\n\ntype UIChangeType =\n  | 'orientation-change'\n  | 'theme-change'\n  | 'accidental-change'\n  | 'sidebar-toggle'\n  | 'focus-change';\n\ntype UIChangeDetails = {\n  orientation?: string;\n  theme?: string;\n  accidentalType?: string;\n  enabled?: boolean;\n  open?: boolean;\n  element?: string;\n  message?: string;\n};\n\nconst HELP_MESSAGES = {\n  general: 'Use arrow keys to rotate rings, space to play scale, S for settings, H for keyboard shortcuts help.',\n  navigation: 'Arrow keys rotate rings. Shift plus arrows for chromatic ring. Control plus arrows for large steps.',\n  playback: 'Press space or enter to play the current scale. Escape to stop playback.',\n  settings: 'Press S to open settings. Use tab to navigate options. Escape to close.',\n  keyboard: 'Press H to see all keyboard shortcuts. Use tab to navigate between interface elements.'\n};\n\ntype HelpTopic = keyof typeof HELP_MESSAGES;\n\n/**\n * Screen reader support manager for Diatonic Compass\n * Provides rich musical context and state announcements\n */\nexport class ScreenReaderManager {\n  static isEnabled = true;\n  static lastAnnouncedState: AnnouncedState | null = null;\n  static announcementQueue: Array<{ message: string; priority: AriaPriority; timestamp: number }> = [];\n  static isProcessingQueue = false;\n\r\n  /**\r\n   * Initialize screen reader support\r\n   */\r\n  static init() {\r\n    try {\r\n      this.setupLiveRegions();\r\n      this.enhanceExistingElements();\r\n      this.setupStateMonitoring();\r\n      \r\n      console.log('Screen reader support initialized');\r\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set up ARIA live regions for announcements\r\n   */\r\n  static setupLiveRegions() {\r\n    // Create main announcement region\r\n    const mainRegion = document.createElement('div');\r\n    mainRegion.id = 'sr-main-announcements';\r\n    mainRegion.setAttribute('aria-live', 'polite');\r\n    mainRegion.setAttribute('aria-atomic', 'false');\r\n    mainRegion.className = 'sr-only';\r\n    this.applySROnlyStyles(mainRegion);\r\n    document.body.appendChild(mainRegion);\r\n\r\n    // Create urgent announcement region\r\n    const urgentRegion = document.createElement('div');\r\n    urgentRegion.id = 'sr-urgent-announcements';\r\n    urgentRegion.setAttribute('aria-live', 'assertive');\r\n    urgentRegion.setAttribute('aria-atomic', 'true');\r\n    urgentRegion.className = 'sr-only';\r\n    this.applySROnlyStyles(urgentRegion);\r\n    document.body.appendChild(urgentRegion);\r\n\r\n    // Create status region for current musical information\r\n    const statusRegion = document.createElement('div');\r\n    statusRegion.id = 'sr-musical-status';\r\n    statusRegion.setAttribute('aria-live', 'polite');\r\n    statusRegion.setAttribute('aria-atomic', 'true');\r\n    statusRegion.className = 'sr-only';\r\n    this.applySROnlyStyles(statusRegion);\r\n    document.body.appendChild(statusRegion);\r\n  }\r\n\r\n  /**\n   * Apply screen reader only styles\n   */\n  static applySROnlyStyles(element: HTMLElement) {\n    element.style.position = 'absolute';\r\n    element.style.left = '-10000px';\r\n    element.style.width = '1px';\r\n    element.style.height = '1px';\r\n    element.style.overflow = 'hidden';\r\n    element.style.clip = 'rect(1px, 1px, 1px, 1px)';\r\n    element.style.whiteSpace = 'nowrap';\r\n  }\r\n\r\n  /**\r\n   * Enhance existing elements with better ARIA attributes\r\n   */\r\n  static enhanceExistingElements() {\r\n    // Enhance the main canvas\r\n    const canvas = document.querySelector<HTMLElement>('#chromaWheel');\n    if (canvas) {\r\n      canvas.setAttribute('role', 'application');\r\n      canvas.setAttribute('aria-label', 'Interactive Diatonic Compass');\r\n      canvas.setAttribute('aria-describedby', 'sr-canvas-description');\r\n      \r\n      // Add detailed description\r\n      const description = document.createElement('div');\r\n      description.id = 'sr-canvas-description';\r\n      description.className = 'sr-only';\r\n      description.textContent = 'A circular interface with three concentric rings representing pitch classes, scale degrees, and chromatic positions. Use arrow keys to rotate rings and explore different musical keys and modes.';\r\n      this.applySROnlyStyles(description);\r\n      document.body.appendChild(description);\r\n    }\r\n\r\n    // Enhance result container\r\n    const resultContainer = document.querySelector<HTMLElement>('#result-container');\n    if (resultContainer) {\r\n      resultContainer.setAttribute('role', 'status');\r\n      resultContainer.setAttribute('aria-label', 'Current musical key and mode');\r\n      resultContainer.setAttribute('aria-describedby', 'sr-result-description');\r\n      \r\n      const resultDesc = document.createElement('div');\r\n      resultDesc.id = 'sr-result-description';\r\n      resultDesc.className = 'sr-only';\r\n      resultDesc.textContent = 'Shows the current musical key and mode. Click to play the scale.';\r\n      this.applySROnlyStyles(resultDesc);\r\n      document.body.appendChild(resultDesc);\r\n    }\r\n\r\n    // Enhance belts\r\n    this.enhanceBelts();\r\n\r\n    // Enhance controls\r\n    this.enhanceControls();\r\n  }\r\n\r\n  /**\r\n   * Enhance belt elements with accessibility\r\n   */\r\n  static enhanceBelts() {\r\n    const belts = [\r\n      { selector: '#pitchBelt', name: 'Pitch Class Belt', description: 'Shows note names (C, D, E, etc.)' },\r\n      { selector: '#degreeBelt', name: 'Scale Degree Belt', description: 'Shows scale degrees (1, 2, 3, etc.)' },\r\n      { selector: '#chromaticBelt', name: 'Chromatic Belt', description: 'Shows chromatic positions (0-11)' }\r\n    ];\r\n\r\n    belts.forEach(belt => {\r\n      const element = document.querySelector<HTMLElement>(belt.selector);\n      if (element) {\r\n        element.setAttribute('role', 'listbox');\r\n        element.setAttribute('aria-label', belt.name);\r\n        element.setAttribute('aria-description', belt.description);\r\n        element.setAttribute('tabindex', '0');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Enhance control elements\r\n   */\r\n  static enhanceControls() {\r\n    // Enhance accidental toggles\r\n    const flatBtn = document.querySelector<HTMLElement>('#flat-btn');\n    const sharpBtn = document.querySelector<HTMLElement>('#sharp-btn');\n    \r\n    if (flatBtn) {\r\n      flatBtn.setAttribute('aria-describedby', 'sr-flat-description');\r\n      const desc = document.createElement('span');\r\n      desc.id = 'sr-flat-description';\r\n      desc.className = 'sr-only';\r\n      desc.textContent = 'Toggle display of flat note names like D-flat, E-flat';\r\n      this.applySROnlyStyles(desc);\r\n      flatBtn.parentNode?.appendChild(desc);\n    }\r\n\r\n    if (sharpBtn) {\r\n      sharpBtn.setAttribute('aria-describedby', 'sr-sharp-description');\r\n      const desc = document.createElement('span');\r\n      desc.id = 'sr-sharp-description';\r\n      desc.className = 'sr-only';\r\n      desc.textContent = 'Toggle display of sharp note names like C-sharp, F-sharp';\r\n      this.applySROnlyStyles(desc);\r\n      sharpBtn.parentNode?.appendChild(desc);\n    }\r\n\r\n    // Enhance sidebar button\r\n    const settingsBtn = document.querySelector<HTMLElement>('#settings-btn');\n    if (settingsBtn) {\r\n      settingsBtn.setAttribute('aria-describedby', 'sr-settings-description');\r\n      const desc = document.createElement('span');\r\n      desc.id = 'sr-settings-description';\r\n      desc.className = 'sr-only';\r\n      desc.textContent = 'Open settings panel to change display options, theme, and layout';\r\n      this.applySROnlyStyles(desc);\r\n      settingsBtn.parentNode?.appendChild(desc);\n    }\r\n  }\r\n\r\n  /**\r\n   * Set up monitoring for state changes\r\n   */\r\n  static setupStateMonitoring() {\r\n    // Monitor state changes and announce important ones\r\n    setInterval(() => {\r\n      if (this.shouldAnnounceStateChange()) {\r\n        this.announceCurrentState();\r\n      }\r\n    }, 1000); // Check every second, but don't spam\r\n  }\r\n\r\n  /**\r\n   * Check if state change should be announced\r\n   */\r\n  static shouldAnnounceStateChange() {\r\n    if (!this.isEnabled) return false;\r\n    \r\n    const currentState = this.getCurrentMusicalState();\r\n    const hasChanged = JSON.stringify(currentState) !== JSON.stringify(this.lastAnnouncedState);\r\n    \r\n    // Only announce if there's been a significant change and no drag is active\r\n    return hasChanged && !appState.drag.active && !appState.animation;\r\n  }\r\n\r\n  /**\r\n   * Get current musical state for comparison\r\n   */\r\n  static getCurrentMusicalState() {\r\n    try {\r\n      const musicalInfo = getMusicalInfo(appState);\r\n      return {\r\n        pitch: musicalInfo?.pitch,\r\n        mode: musicalInfo?.modeName,\r\n        isPlaying: appState.playback.isPlaying\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        pitch: 'Unknown',\r\n        mode: 'Unknown',\r\n        isPlaying: false\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Announce current musical state\r\n   */\r\n  static announceCurrentState() {\r\n    try {\r\n      const musicalInfo = getMusicalInfo(appState);\r\n      if (!musicalInfo) return;\r\n\r\n      const message = `${musicalInfo.pitch} ${musicalInfo.modeName}`;\r\n      this.announceToRegion(message, 'sr-musical-status');\r\n      \r\n      this.lastAnnouncedState = this.getCurrentMusicalState();\r\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\n   * Announce specific musical information\n   */\n  static announceMusicalChange(changeType: MusicalChangeType, details: MusicalChangeDetails = {}) {\n    try {\n      let message = '';\n      \r\n      switch (changeType) {\r\n        case 'key-change':\r\n          message = `Key changed to ${details.key} ${details.mode}`;\r\n          break;\r\n          \r\n        case 'mode-change':\r\n          message = `Mode changed to ${details.mode}`;\r\n          break;\r\n          \r\n        case 'note-change':\r\n          message = `Root note changed to ${details.note}`;\r\n          break;\r\n          \r\n        case 'playback-start':\r\n          message = `Playing ${details.key} ${details.mode} scale`;\r\n          break;\r\n          \r\n        case 'playback-stop':\r\n          message = 'Playback stopped';\r\n          break;\r\n          \r\n        case 'playback-note':\r\n          message = `Playing ${details.note}`;\r\n          break;\r\n          \r\n        default:\n          message = details.message || 'Musical state changed';\n      }\n      \n      this.queueAnnouncement(message);\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\n   * Announce interaction guidance\n   */\n  static announceInteractionStart(interactionType: InteractionType) {\n    const messages = {\n      'wheel-drag': 'Dragging wheel ring. Move to change musical key.',\n      'belt-drag': 'Dragging belt. Move to change scale degrees.',\n      'chromatic-drag': 'Dragging chromatic ring. Move to change perspective.',\n      'playback-start': 'Scale playback started.',\n      'settings-open': 'Settings panel opened.',\r\n      'tutorial-start': 'Tutorial started. Follow the instructions to learn the interface.'\n    };\n    \n    const message = messages[interactionType];\n    if (message) {\n      this.queueAnnouncement(message, 'polite');\n    }\n  }\n\r\n  /**\n   * Provide detailed musical context\n   */\n  static announceMusicalContext(includeTheory = false) {\n    try {\n      const musicalInfo = getMusicalInfo(appState);\n      if (!musicalInfo) return;\n\r\n      let message = `Current key: ${musicalInfo.pitch} ${musicalInfo.modeName}`;\r\n      \r\n      if (includeTheory) {\r\n        const scaleNotes = this.getScaleNotes(musicalInfo);\r\n        if (scaleNotes.length > 0) {\r\n          message += `. Scale notes: ${scaleNotes.join(', ')}`;\r\n        }\r\n        \r\n        const modeDescription = this.getModeDescription(musicalInfo.modeName);\r\n        if (modeDescription) {\r\n          message += `. ${modeDescription}`;\r\n        }\r\n      }\r\n      \r\n      this.queueAnnouncement(message, 'polite');\r\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\n   * Get scale notes for current key\n   */\n  static getScaleNotes(musicalInfo: MusicalInfo): string[] {\n    try {\n      // This would use the same logic as the playback system\n      // to get the actual scale notes\n      const labels = generateDisplayLabels(appState);\n      // Simplified - in a full implementation, this would calculate the actual scale\n      return []; // Placeholder\n    } catch (error) {\n      return [];\n    }\n  }\n\r\n  /**\n   * Get description of musical mode\n   */\n  static getModeDescription(modeName: string) {\n    const descriptions = {\n      'Major': 'A bright, happy sounding mode',\n      'Minor': 'A darker, more melancholic mode',\n      'Dorian': 'A minor mode with a raised 6th degree',\n      'Phrygian': 'A minor mode with a lowered 2nd degree',\n      'Lydian': 'A major mode with a raised 4th degree',\n      'Mixolydian': 'A major mode with a lowered 7th degree',\n      'Locrian': 'A diminished mode, rarely used in practice'\n    };\n    \n    return descriptions[modeName as keyof typeof descriptions] || '';\n  }\n\r\n  /**\n   * Announce UI state changes\n   */\n  static announceUIChange(changeType: UIChangeType, details: UIChangeDetails = {}) {\n    const messages = {\n      'orientation-change': `Layout changed to ${details.orientation}`,\n      'theme-change': `Theme changed to ${details.theme} mode`,\n      'accidental-change': `${details.accidentalType} names ${details.enabled ? 'enabled' : 'disabled'}`,\n      'sidebar-toggle': `Settings ${details.open ? 'opened' : 'closed'}`,\n      'focus-change': `Focus moved to ${details.element}`\r\n    };\r\n    \r\n    const message = messages[changeType] || details.message;\r\n    if (message) {\r\n      this.queueAnnouncement(message);\r\n    }\r\n  }\r\n\r\n  /**\n   * Queue announcement to prevent overwhelming screen readers\n   */\n  static queueAnnouncement(message: string, priority: AriaPriority = 'polite') {\n    this.announcementQueue.push({ message, priority, timestamp: Date.now() });\n    \r\n    if (!this.isProcessingQueue) {\r\n      this.processAnnouncementQueue();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process announcement queue with rate limiting\r\n   */\r\n  static async processAnnouncementQueue() {\n    this.isProcessingQueue = true;\n    \n    while (this.announcementQueue.length > 0) {\n      const announcement = this.announcementQueue.shift();\n      if (!announcement) {\n        continue;\n      }\n      \n      // Skip outdated announcements (older than 5 seconds)\n      if (Date.now() - announcement.timestamp > 5000) {\n        continue;\n      }\n      \n      this.announceToRegion(announcement.message, \n        announcement.priority === 'assertive' ? 'sr-urgent-announcements' : 'sr-main-announcements'\r\n      );\r\n      \r\n      // Rate limit: wait between announcements to avoid overwhelming\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n    }\r\n    \r\n    this.isProcessingQueue = false;\r\n  }\r\n\r\n  /**\n   * Announce message to specific ARIA live region\n   */\n  static announceToRegion(message: string, regionId: string) {\n    try {\r\n      const region = document.getElementById(regionId);\r\n      if (!region || !message) return;\r\n\r\n      // Clear previous content after a short delay to ensure it's read\r\n      region.textContent = '';\r\n      \r\n      requestAnimationFrame(() => {\r\n        region.textContent = message;\r\n      });\r\n      \r\n      // Clear after reading to prevent re-reading on focus\r\n      setTimeout(() => {\r\n        if (region.textContent === message) {\r\n          region.textContent = '';\r\n        }\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\n   * Announce tutorial steps\n   */\n  static announceTutorialStep(stepNumber: number, instruction: string, hint = '') {\n    const message = `Tutorial step ${stepNumber}. ${instruction}${hint ? '. Hint: ' + hint : ''}`;\n    this.queueAnnouncement(message, 'assertive');\n  }\n\r\n  /**\n   * Announce validation messages\n   */\n  static announceValidation(type: 'error' | 'info', message: string) {\n    const priority = type === 'error' ? 'assertive' : 'polite';\n    this.queueAnnouncement(message, priority);\n  }\n\r\n  /**\n   * Provide help and instructions\n   */\n  static announceHelp(topic: HelpTopic = 'general') {\n    const message = HELP_MESSAGES[topic] || HELP_MESSAGES.general;\n    this.queueAnnouncement(message, 'polite');\n  }\n\r\n  /**\r\n   * Enable screen reader support\r\n   */\r\n  static enable() {\r\n    this.isEnabled = true;\r\n    this.queueAnnouncement('Screen reader support enabled');\r\n  }\r\n\r\n  /**\r\n   * Disable screen reader support\r\n   */\r\n  static disable() {\r\n    this.isEnabled = false;\r\n    this.queueAnnouncement('Screen reader support disabled');\r\n  }\r\n\r\n  /**\n   * Emergency announcement (highest priority)\n   */\n  static emergencyAnnounce(message: string) {\n    const urgentRegion = document.getElementById('sr-urgent-announcements');\r\n    if (urgentRegion) {\r\n      urgentRegion.textContent = message;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up screen reader elements\r\n   */\r\n  static cleanup() {\r\n    ['sr-main-announcements', 'sr-urgent-announcements', 'sr-musical-status'].forEach(id => {\r\n      const element = document.getElementById(id);\r\n      if (element) {\r\n        element.remove();\r\n      }\r\n    });\r\n    \r\n    this.announcementQueue = [];\r\n    this.isProcessingQueue = false;\r\n  }\r\n\r\n  /**\r\n   * Get screen reader status\r\n   */\r\n  static getStatus() {\r\n    return {\r\n      isEnabled: this.isEnabled,\r\n      queueLength: this.announcementQueue.length,\r\n      isProcessingQueue: this.isProcessingQueue,\r\n      lastAnnouncedState: this.lastAnnouncedState\r\n    };\r\n  }\r\n}\r\n"],"names":["HELP_MESSAGES","ScreenReaderManager","error","ErrorHandler","CONFIG","mainRegion","urgentRegion","statusRegion","element","canvas","description","resultContainer","resultDesc","belt","flatBtn","sharpBtn","desc","_a","_b","settingsBtn","_c","currentState","appState","musicalInfo","getMusicalInfo","message","changeType","details","interactionType","includeTheory","scaleNotes","modeDescription","labels","generateDisplayLabels","modeName","priority","announcement","resolve","regionId","region","stepNumber","instruction","hint","type","topic","id","__publicField"],"mappings":"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"}