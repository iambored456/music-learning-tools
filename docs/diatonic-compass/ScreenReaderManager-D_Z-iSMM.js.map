{"version":3,"file":"ScreenReaderManager-D_Z-iSMM.js","sources":["../src/accessibility/ScreenReaderManager.ts"],"sourcesContent":["// (file path: src/accessibility/ScreenReaderManager.ts)\r\n\r\nimport { appState } from '../state/appState.ts';\r\nimport { ErrorHandler } from '../utils/ErrorHandler.ts';\r\nimport { CONFIG } from '../core/constants.ts';\r\nimport { generateDisplayLabels, getMusicalInfo } from '../core/logic.ts';\nimport { CHROMATIC_NOTES, DIATONIC_INTERVALS, MODE_NAME } from '../core/constants.ts';\n\ntype AnnouncedState = {\n  pitch?: string;\n  mode?: string;\n  isPlaying: boolean;\n};\n\ntype AriaPriority = 'polite' | 'assertive';\ntype MusicalInfo = NonNullable<ReturnType<typeof getMusicalInfo>>;\n\ntype MusicalChangeType =\n  | 'key-change'\n  | 'mode-change'\n  | 'note-change'\n  | 'playback-start'\n  | 'playback-stop'\n  | 'playback-note'\n  | 'general';\n\ntype MusicalChangeDetails = {\n  key?: string;\n  mode?: string;\n  note?: string;\n  message?: string;\n};\n\ntype InteractionType =\n  | 'wheel-drag'\n  | 'belt-drag'\n  | 'chromatic-drag'\n  | 'playback-start'\n  | 'settings-open'\n  | 'tutorial-start';\n\ntype UIChangeType =\n  | 'orientation-change'\n  | 'theme-change'\n  | 'accidental-change'\n  | 'sidebar-toggle'\n  | 'focus-change';\n\ntype UIChangeDetails = {\n  orientation?: string;\n  theme?: string;\n  accidentalType?: string;\n  enabled?: boolean;\n  open?: boolean;\n  element?: string;\n  message?: string;\n};\n\nconst HELP_MESSAGES = {\n  general: 'Use arrow keys to rotate rings, space to play scale, S for settings, H for keyboard shortcuts help.',\n  navigation: 'Arrow keys rotate rings. Shift plus arrows for chromatic ring. Control plus arrows for large steps.',\n  playback: 'Press space or enter to play the current scale. Escape to stop playback.',\n  settings: 'Press S to open settings. Use tab to navigate options. Escape to close.',\n  keyboard: 'Press H to see all keyboard shortcuts. Use tab to navigate between interface elements.'\n};\n\ntype HelpTopic = keyof typeof HELP_MESSAGES;\n\n/**\n * Screen reader support manager for Diatonic Compass\n * Provides rich musical context and state announcements\n */\nexport class ScreenReaderManager {\n  static isEnabled = true;\n  static lastAnnouncedState: AnnouncedState | null = null;\n  static announcementQueue: Array<{ message: string; priority: AriaPriority; timestamp: number }> = [];\n  static isProcessingQueue = false;\n\r\n  /**\r\n   * Initialize screen reader support\r\n   */\r\n  static init() {\r\n    try {\r\n      this.setupLiveRegions();\r\n      this.enhanceExistingElements();\r\n      this.setupStateMonitoring();\r\n      \r\n      console.log('Screen reader support initialized');\r\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set up ARIA live regions for announcements\r\n   */\r\n  static setupLiveRegions() {\r\n    // Create main announcement region\r\n    const mainRegion = document.createElement('div');\r\n    mainRegion.id = 'sr-main-announcements';\r\n    mainRegion.setAttribute('aria-live', 'polite');\r\n    mainRegion.setAttribute('aria-atomic', 'false');\r\n    mainRegion.className = 'sr-only';\r\n    this.applySROnlyStyles(mainRegion);\r\n    document.body.appendChild(mainRegion);\r\n\r\n    // Create urgent announcement region\r\n    const urgentRegion = document.createElement('div');\r\n    urgentRegion.id = 'sr-urgent-announcements';\r\n    urgentRegion.setAttribute('aria-live', 'assertive');\r\n    urgentRegion.setAttribute('aria-atomic', 'true');\r\n    urgentRegion.className = 'sr-only';\r\n    this.applySROnlyStyles(urgentRegion);\r\n    document.body.appendChild(urgentRegion);\r\n\r\n    // Create status region for current musical information\r\n    const statusRegion = document.createElement('div');\r\n    statusRegion.id = 'sr-musical-status';\r\n    statusRegion.setAttribute('aria-live', 'polite');\r\n    statusRegion.setAttribute('aria-atomic', 'true');\r\n    statusRegion.className = 'sr-only';\r\n    this.applySROnlyStyles(statusRegion);\r\n    document.body.appendChild(statusRegion);\r\n  }\r\n\r\n  /**\n   * Apply screen reader only styles\n   */\n  static applySROnlyStyles(element: HTMLElement) {\n    element.style.position = 'absolute';\r\n    element.style.left = '-10000px';\r\n    element.style.width = '1px';\r\n    element.style.height = '1px';\r\n    element.style.overflow = 'hidden';\r\n    element.style.clip = 'rect(1px, 1px, 1px, 1px)';\r\n    element.style.whiteSpace = 'nowrap';\r\n  }\r\n\r\n  /**\r\n   * Enhance existing elements with better ARIA attributes\r\n   */\r\n  static enhanceExistingElements() {\r\n    // Enhance the main canvas\r\n    const canvas = document.querySelector<HTMLElement>('#chromaWheel');\n    if (canvas) {\r\n      canvas.setAttribute('role', 'application');\r\n      canvas.setAttribute('aria-label', 'Interactive Diatonic Compass');\r\n      canvas.setAttribute('aria-describedby', 'sr-canvas-description');\r\n      \r\n      // Add detailed description\r\n      const description = document.createElement('div');\r\n      description.id = 'sr-canvas-description';\r\n      description.className = 'sr-only';\r\n      description.textContent = 'A circular interface with three concentric rings representing pitch classes, scale degrees, and chromatic positions. Use arrow keys to rotate rings and explore different musical keys and modes.';\r\n      this.applySROnlyStyles(description);\r\n      document.body.appendChild(description);\r\n    }\r\n\r\n    // Enhance result container\r\n    const resultContainer = document.querySelector<HTMLElement>('#result-container');\n    if (resultContainer) {\r\n      resultContainer.setAttribute('role', 'status');\r\n      resultContainer.setAttribute('aria-label', 'Current musical key and mode');\r\n      resultContainer.setAttribute('aria-describedby', 'sr-result-description');\r\n      \r\n      const resultDesc = document.createElement('div');\r\n      resultDesc.id = 'sr-result-description';\r\n      resultDesc.className = 'sr-only';\r\n      resultDesc.textContent = 'Shows the current musical key and mode. Click to play the scale.';\r\n      this.applySROnlyStyles(resultDesc);\r\n      document.body.appendChild(resultDesc);\r\n    }\r\n\r\n    // Enhance belts\r\n    this.enhanceBelts();\r\n\r\n    // Enhance controls\r\n    this.enhanceControls();\r\n  }\r\n\r\n  /**\r\n   * Enhance belt elements with accessibility\r\n   */\r\n  static enhanceBelts() {\r\n    const belts = [\r\n      { selector: '#pitchBelt', name: 'Pitch Class Belt', description: 'Shows note names (C, D, E, etc.)' },\r\n      { selector: '#degreeBelt', name: 'Scale Degree Belt', description: 'Shows scale degrees (1, 2, 3, etc.)' },\r\n      { selector: '#chromaticBelt', name: 'Chromatic Belt', description: 'Shows chromatic positions (0-11)' }\r\n    ];\r\n\r\n    belts.forEach(belt => {\r\n      const element = document.querySelector<HTMLElement>(belt.selector);\n      if (element) {\r\n        element.setAttribute('role', 'listbox');\r\n        element.setAttribute('aria-label', belt.name);\r\n        element.setAttribute('aria-description', belt.description);\r\n        element.setAttribute('tabindex', '0');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Enhance control elements\r\n   */\r\n  static enhanceControls() {\r\n    // Enhance accidental toggles\r\n    const flatBtn = document.querySelector<HTMLElement>('#flat-btn');\n    const sharpBtn = document.querySelector<HTMLElement>('#sharp-btn');\n    \r\n    if (flatBtn) {\r\n      flatBtn.setAttribute('aria-describedby', 'sr-flat-description');\r\n      const desc = document.createElement('span');\r\n      desc.id = 'sr-flat-description';\r\n      desc.className = 'sr-only';\r\n      desc.textContent = 'Toggle display of flat note names like D-flat, E-flat';\r\n      this.applySROnlyStyles(desc);\r\n      flatBtn.parentNode?.appendChild(desc);\n    }\r\n\r\n    if (sharpBtn) {\r\n      sharpBtn.setAttribute('aria-describedby', 'sr-sharp-description');\r\n      const desc = document.createElement('span');\r\n      desc.id = 'sr-sharp-description';\r\n      desc.className = 'sr-only';\r\n      desc.textContent = 'Toggle display of sharp note names like C-sharp, F-sharp';\r\n      this.applySROnlyStyles(desc);\r\n      sharpBtn.parentNode?.appendChild(desc);\n    }\r\n\r\n    // Enhance sidebar button\r\n    const settingsBtn = document.querySelector<HTMLElement>('#settings-btn');\n    if (settingsBtn) {\r\n      settingsBtn.setAttribute('aria-describedby', 'sr-settings-description');\r\n      const desc = document.createElement('span');\r\n      desc.id = 'sr-settings-description';\r\n      desc.className = 'sr-only';\r\n      desc.textContent = 'Open settings panel to change display options, theme, and layout';\r\n      this.applySROnlyStyles(desc);\r\n      settingsBtn.parentNode?.appendChild(desc);\n    }\r\n  }\r\n\r\n  /**\r\n   * Set up monitoring for state changes\r\n   */\r\n  static setupStateMonitoring() {\r\n    // Monitor state changes and announce important ones\r\n    setInterval(() => {\r\n      if (this.shouldAnnounceStateChange()) {\r\n        this.announceCurrentState();\r\n      }\r\n    }, 1000); // Check every second, but don't spam\r\n  }\r\n\r\n  /**\r\n   * Check if state change should be announced\r\n   */\r\n  static shouldAnnounceStateChange() {\r\n    if (!this.isEnabled) return false;\r\n    \r\n    const currentState = this.getCurrentMusicalState();\r\n    const hasChanged = JSON.stringify(currentState) !== JSON.stringify(this.lastAnnouncedState);\r\n    \r\n    // Only announce if there's been a significant change and no drag is active\r\n    return hasChanged && !appState.drag.active && !appState.animation;\r\n  }\r\n\r\n  /**\r\n   * Get current musical state for comparison\r\n   */\r\n  static getCurrentMusicalState() {\r\n    try {\r\n      const musicalInfo = getMusicalInfo(appState);\r\n      return {\r\n        pitch: musicalInfo?.pitch,\r\n        mode: musicalInfo?.modeName,\r\n        isPlaying: appState.playback.isPlaying\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        pitch: 'Unknown',\r\n        mode: 'Unknown',\r\n        isPlaying: false\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Announce current musical state\r\n   */\r\n  static announceCurrentState() {\r\n    try {\r\n      const musicalInfo = getMusicalInfo(appState);\r\n      if (!musicalInfo) return;\r\n\r\n      const message = `${musicalInfo.pitch} ${musicalInfo.modeName}`;\r\n      this.announceToRegion(message, 'sr-musical-status');\r\n      \r\n      this.lastAnnouncedState = this.getCurrentMusicalState();\r\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\n   * Announce specific musical information\n   */\n  static announceMusicalChange(changeType: MusicalChangeType, details: MusicalChangeDetails = {}) {\n    try {\n      let message = '';\n      \r\n      switch (changeType) {\r\n        case 'key-change':\r\n          message = `Key changed to ${details.key} ${details.mode}`;\r\n          break;\r\n          \r\n        case 'mode-change':\r\n          message = `Mode changed to ${details.mode}`;\r\n          break;\r\n          \r\n        case 'note-change':\r\n          message = `Root note changed to ${details.note}`;\r\n          break;\r\n          \r\n        case 'playback-start':\r\n          message = `Playing ${details.key} ${details.mode} scale`;\r\n          break;\r\n          \r\n        case 'playback-stop':\r\n          message = 'Playback stopped';\r\n          break;\r\n          \r\n        case 'playback-note':\r\n          message = `Playing ${details.note}`;\r\n          break;\r\n          \r\n        default:\n          message = details.message || 'Musical state changed';\n      }\n      \n      this.queueAnnouncement(message);\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\n   * Announce interaction guidance\n   */\n  static announceInteractionStart(interactionType: InteractionType) {\n    const messages = {\n      'wheel-drag': 'Dragging wheel ring. Move to change musical key.',\n      'belt-drag': 'Dragging belt. Move to change scale degrees.',\n      'chromatic-drag': 'Dragging chromatic ring. Move to change perspective.',\n      'playback-start': 'Scale playback started.',\n      'settings-open': 'Settings panel opened.',\r\n      'tutorial-start': 'Tutorial started. Follow the instructions to learn the interface.'\n    };\n    \n    const message = messages[interactionType];\n    if (message) {\n      this.queueAnnouncement(message, 'polite');\n    }\n  }\n\r\n  /**\n   * Provide detailed musical context\n   */\n  static announceMusicalContext(includeTheory = false) {\n    try {\n      const musicalInfo = getMusicalInfo(appState);\n      if (!musicalInfo) return;\n\r\n      let message = `Current key: ${musicalInfo.pitch} ${musicalInfo.modeName}`;\r\n      \r\n      if (includeTheory) {\r\n        const scaleNotes = this.getScaleNotes(musicalInfo);\r\n        if (scaleNotes.length > 0) {\r\n          message += `. Scale notes: ${scaleNotes.join(', ')}`;\r\n        }\r\n        \r\n        const modeDescription = this.getModeDescription(musicalInfo.modeName);\r\n        if (modeDescription) {\r\n          message += `. ${modeDescription}`;\r\n        }\r\n      }\r\n      \r\n      this.queueAnnouncement(message, 'polite');\r\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\n   * Get scale notes for current key\n   */\n  static getScaleNotes(musicalInfo: MusicalInfo): string[] {\n    try {\n      // This would use the same logic as the playback system\n      // to get the actual scale notes\n      const labels = generateDisplayLabels(appState);\n      // Simplified - in a full implementation, this would calculate the actual scale\n      return []; // Placeholder\n    } catch (error) {\n      return [];\n    }\n  }\n\r\n  /**\n   * Get description of musical mode\n   */\n  static getModeDescription(modeName: string) {\n    const descriptions = {\n      'Major': 'A bright, happy sounding mode',\n      'Minor': 'A darker, more melancholic mode',\n      'Dorian': 'A minor mode with a raised 6th degree',\n      'Phrygian': 'A minor mode with a lowered 2nd degree',\n      'Lydian': 'A major mode with a raised 4th degree',\n      'Mixolydian': 'A major mode with a lowered 7th degree',\n      'Locrian': 'A diminished mode, rarely used in practice'\n    };\n    \n    return descriptions[modeName as keyof typeof descriptions] || '';\n  }\n\r\n  /**\n   * Announce UI state changes\n   */\n  static announceUIChange(changeType: UIChangeType, details: UIChangeDetails = {}) {\n    const messages = {\n      'orientation-change': `Layout changed to ${details.orientation}`,\n      'theme-change': `Theme changed to ${details.theme} mode`,\n      'accidental-change': `${details.accidentalType} names ${details.enabled ? 'enabled' : 'disabled'}`,\n      'sidebar-toggle': `Settings ${details.open ? 'opened' : 'closed'}`,\n      'focus-change': `Focus moved to ${details.element}`\r\n    };\r\n    \r\n    const message = messages[changeType] || details.message;\r\n    if (message) {\r\n      this.queueAnnouncement(message);\r\n    }\r\n  }\r\n\r\n  /**\n   * Queue announcement to prevent overwhelming screen readers\n   */\n  static queueAnnouncement(message: string, priority: AriaPriority = 'polite') {\n    this.announcementQueue.push({ message, priority, timestamp: Date.now() });\n    \r\n    if (!this.isProcessingQueue) {\r\n      this.processAnnouncementQueue();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process announcement queue with rate limiting\r\n   */\r\n  static async processAnnouncementQueue() {\n    this.isProcessingQueue = true;\n    \n    while (this.announcementQueue.length > 0) {\n      const announcement = this.announcementQueue.shift();\n      if (!announcement) {\n        continue;\n      }\n      \n      // Skip outdated announcements (older than 5 seconds)\n      if (Date.now() - announcement.timestamp > 5000) {\n        continue;\n      }\n      \n      this.announceToRegion(announcement.message, \n        announcement.priority === 'assertive' ? 'sr-urgent-announcements' : 'sr-main-announcements'\r\n      );\r\n      \r\n      // Rate limit: wait between announcements to avoid overwhelming\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n    }\r\n    \r\n    this.isProcessingQueue = false;\r\n  }\r\n\r\n  /**\n   * Announce message to specific ARIA live region\n   */\n  static announceToRegion(message: string, regionId: string) {\n    try {\r\n      const region = document.getElementById(regionId);\r\n      if (!region || !message) return;\r\n\r\n      // Clear previous content after a short delay to ensure it's read\r\n      region.textContent = '';\r\n      \r\n      requestAnimationFrame(() => {\r\n        region.textContent = message;\r\n      });\r\n      \r\n      // Clear after reading to prevent re-reading on focus\r\n      setTimeout(() => {\r\n        if (region.textContent === message) {\r\n          region.textContent = '';\r\n        }\r\n      }, 2000);\r\n      \r\n    } catch (error) {\r\n      ErrorHandler.handle(error, CONFIG.ERROR_HANDLING.CONTEXTS.UI);\r\n    }\r\n  }\r\n\r\n  /**\n   * Announce tutorial steps\n   */\n  static announceTutorialStep(stepNumber: number, instruction: string, hint = '') {\n    const message = `Tutorial step ${stepNumber}. ${instruction}${hint ? '. Hint: ' + hint : ''}`;\n    this.queueAnnouncement(message, 'assertive');\n  }\n\r\n  /**\n   * Announce validation messages\n   */\n  static announceValidation(type: 'error' | 'info', message: string) {\n    const priority = type === 'error' ? 'assertive' : 'polite';\n    this.queueAnnouncement(message, priority);\n  }\n\r\n  /**\n   * Provide help and instructions\n   */\n  static announceHelp(topic: HelpTopic = 'general') {\n    const message = HELP_MESSAGES[topic] || HELP_MESSAGES.general;\n    this.queueAnnouncement(message, 'polite');\n  }\n\r\n  /**\r\n   * Enable screen reader support\r\n   */\r\n  static enable() {\r\n    this.isEnabled = true;\r\n    this.queueAnnouncement('Screen reader support enabled');\r\n  }\r\n\r\n  /**\r\n   * Disable screen reader support\r\n   */\r\n  static disable() {\r\n    this.isEnabled = false;\r\n    this.queueAnnouncement('Screen reader support disabled');\r\n  }\r\n\r\n  /**\n   * Emergency announcement (highest priority)\n   */\n  static emergencyAnnounce(message: string) {\n    const urgentRegion = document.getElementById('sr-urgent-announcements');\r\n    if (urgentRegion) {\r\n      urgentRegion.textContent = message;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up screen reader elements\r\n   */\r\n  static cleanup() {\r\n    ['sr-main-announcements', 'sr-urgent-announcements', 'sr-musical-status'].forEach(id => {\r\n      const element = document.getElementById(id);\r\n      if (element) {\r\n        element.remove();\r\n      }\r\n    });\r\n    \r\n    this.announcementQueue = [];\r\n    this.isProcessingQueue = false;\r\n  }\r\n\r\n  /**\r\n   * Get screen reader status\r\n   */\r\n  static getStatus() {\r\n    return {\r\n      isEnabled: this.isEnabled,\r\n      queueLength: this.announcementQueue.length,\r\n      isProcessingQueue: this.isProcessingQueue,\r\n      lastAnnouncedState: this.lastAnnouncedState\r\n    };\r\n  }\r\n}\r\n"],"names":["HELP_MESSAGES","ScreenReaderManager","error","ErrorHandler","CONFIG","mainRegion","urgentRegion","statusRegion","element","canvas","description","resultContainer","resultDesc","belt","flatBtn","sharpBtn","desc","_a","_b","settingsBtn","_c","currentState","appState","musicalInfo","getMusicalInfo","message","changeType","details","interactionType","includeTheory","scaleNotes","modeDescription","labels","generateDisplayLabels","modeName","priority","announcement","resolve","regionId","region","stepNumber","instruction","hint","type","topic","id","__publicField"],"mappings":"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"}