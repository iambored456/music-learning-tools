var nE=Object.defineProperty;var Av=e=>{throw TypeError(e)};var sE=(e,t,n)=>t in e?nE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var P=(e,t,n)=>sE(e,typeof t!="symbol"?t+"":t,n),Ff=(e,t,n)=>t.has(e)||Av("Cannot "+n);var lt=(e,t,n)=>(Ff(e,t,"read from private field"),n?n.call(e):t.get(e)),Be=(e,t,n)=>t.has(e)?Av("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),le=(e,t,n,i)=>(Ff(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),ln=(e,t,n)=>(Ff(e,t,"access private method"),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const A of r)if(A.type==="childList")for(const a of A.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const A={};return r.integrity&&(A.integrity=r.integrity),r.referrerPolicy&&(A.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?A.credentials="include":r.crossOrigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function i(r){if(r.ep)return;r.ep=!0;const A=n(r);fetch(r.href,A)}})();var Uu={exports:{}};/*! For license information please see Tone.js.LICENSE.txt */var iE=Uu.exports,ov;function rE(){return ov||(ov=1,(function(e,t){(function(n,i){e.exports=i()})(typeof self<"u"?self:iE,(()=>(()=>{var n={18:a=>{a.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},a.exports.__esModule=!0,a.exports.default=a.exports},113:a=>{a.exports=function(l,c){(c==null||c>l.length)&&(c=l.length);for(var h=0,f=Array(c);h<c;h++)f[h]=l[h];return f},a.exports.__esModule=!0,a.exports.default=a.exports},327:(a,l,c)=>{var h=c(564).default;a.exports=function(f,m){if(h(f)!="object"||!f)return f;var w=f[Symbol.toPrimitive];if(w!==void 0){var B=w.call(f,m||"default");if(h(B)!="object")return B;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(f)},a.exports.__esModule=!0,a.exports.default=a.exports},474:a=>{a.exports=function(l,c){var h=l==null?null:typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(h!=null){var f,m,w,B,y=[],b=!0,S=!1;try{if(w=(h=h.call(l)).next,c===0){if(Object(h)!==h)return;b=!1}else for(;!(b=(f=w.call(h)).done)&&(y.push(f.value),y.length!==c);b=!0);}catch(F){S=!0,m=F}finally{try{if(!b&&h.return!=null&&(B=h.return(),Object(B)!==B))return}finally{if(S)throw m}}return y}},a.exports.__esModule=!0,a.exports.default=a.exports},498:(a,l,c)=>{var h=c(564).default,f=c(327);a.exports=function(m){var w=f(m,"string");return h(w)=="symbol"?w:w+""},a.exports.__esModule=!0,a.exports.default=a.exports},564:a=>{function l(c){return a.exports=l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},a.exports.__esModule=!0,a.exports.default=a.exports,l(c)}a.exports=l,a.exports.__esModule=!0,a.exports.default=a.exports},569:a=>{a.exports=function(l){if(Array.isArray(l))return l},a.exports.__esModule=!0,a.exports.default=a.exports},744:(a,l,c)=>{var h=c(113);a.exports=function(f,m){if(f){if(typeof f=="string")return h(f,m);var w={}.toString.call(f).slice(8,-1);return w==="Object"&&f.constructor&&(w=f.constructor.name),w==="Map"||w==="Set"?Array.from(f):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?h(f,m):void 0}},a.exports.__esModule=!0,a.exports.default=a.exports},805:a=>{a.exports=function(l,c){if(!(l instanceof c))throw new TypeError("Cannot call a class as a function")},a.exports.__esModule=!0,a.exports.default=a.exports},821:(a,l,c)=>{var h=c(569),f=c(474),m=c(744),w=c(18);a.exports=function(B,y){return h(B)||f(B,y)||m(B,y)||w()},a.exports.__esModule=!0,a.exports.default=a.exports},871:function(a,l,c){(function(h,f,m,w){var B=function(J,st,ot){return{endTime:st,insertTime:ot,type:"exponentialRampToValue",value:J}},y=function(J,st,ot){return{endTime:st,insertTime:ot,type:"linearRampToValue",value:J}},b=function(J,st){return{startTime:st,type:"setValue",value:J}},S=function(J,st,ot){return{duration:ot,startTime:st,type:"setValueCurve",values:J}},F=function(J,st,ot){var vt=ot.startTime,ut=ot.target,Lt=ot.timeConstant;return ut+(st-ut)*Math.exp((vt-J)/Lt)},U=function(J){return J.type==="exponentialRampToValue"},D=function(J){return J.type==="linearRampToValue"},H=function(J){return U(J)||D(J)},Q=function(J){return J.type==="setValue"},R=function(J){return J.type==="setValueCurve"},V=function J(st,ot,vt,ut){var Lt=st[ot];return Lt===void 0?ut:H(Lt)||Q(Lt)?Lt.value:R(Lt)?Lt.values[Lt.values.length-1]:F(vt,J(st,ot-1,Lt.startTime,ut),Lt)},O=function(J,st,ot,vt,ut){return ot===void 0?[vt.insertTime,ut]:H(ot)?[ot.endTime,ot.value]:Q(ot)?[ot.startTime,ot.value]:R(ot)?[ot.startTime+ot.duration,ot.values[ot.values.length-1]]:[ot.startTime,V(J,st-1,ot.startTime,ut)]},K=function(J){return J.type==="cancelAndHold"},z=function(J){return J.type==="cancelScheduledValues"},gt=function(J){return K(J)||z(J)?J.cancelTime:U(J)||D(J)?J.endTime:J.startTime},St=function(J,st,ot,vt){var ut=vt.endTime,Lt=vt.value;return ot===Lt?Lt:0<ot&&0<Lt||ot<0&&Lt<0?ot*Math.pow(Lt/ot,(J-st)/(ut-st)):0},wt=function(J,st,ot,vt){return ot+(J-st)/(vt.endTime-st)*(vt.value-ot)},Ct=function(J,st){var ot=st.duration,vt=st.startTime,ut=st.values;return(function(Lt,$t){var Vt=Math.floor($t),Nt=Math.ceil($t);return Vt===Nt?Lt[Vt]:(1-($t-Vt))*Lt[Vt]+(1-(Nt-$t))*Lt[Nt]})(ut,(J-vt)/ot*(ut.length-1))},Mt=function(J){return J.type==="setTarget"},Tt=(function(){return w((function J(st){m(this,J),this._automationEvents=[],this._currenTime=0,this._defaultValue=st}),[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(J){var st=gt(J);if(K(J)||z(J)){var ot=this._automationEvents.findIndex((function(Bt){return z(J)&&R(Bt)?Bt.startTime+Bt.duration>=st:gt(Bt)>=st})),vt=this._automationEvents[ot];if(ot!==-1&&(this._automationEvents=this._automationEvents.slice(0,ot)),K(J)){var ut=this._automationEvents[this._automationEvents.length-1];if(vt!==void 0&&H(vt)){if(ut!==void 0&&Mt(ut))throw new Error("The internal list is malformed.");var Lt=ut===void 0?vt.insertTime:R(ut)?ut.startTime+ut.duration:gt(ut),$t=ut===void 0?this._defaultValue:R(ut)?ut.values[ut.values.length-1]:ut.value,Vt=U(vt)?St(st,Lt,$t,vt):wt(st,Lt,$t,vt),Nt=U(vt)?B(Vt,st,this._currenTime):y(Vt,st,this._currenTime);this._automationEvents.push(Nt)}if(ut!==void 0&&Mt(ut)&&this._automationEvents.push(b(this.getValue(st),st)),ut!==void 0&&R(ut)&&ut.startTime+ut.duration>st){var Dt=st-ut.startTime,Et=(ut.values.length-1)/ut.duration,Ft=Math.max(2,1+Math.ceil(Dt*Et)),jt=Dt/(Ft-1)*Et,rt=ut.values.slice(0,Ft);if(jt<1)for(var pt=1;pt<Ft;pt+=1){var it=jt*pt%1;rt[pt]=ut.values[pt-1]*(1-it)+ut.values[pt]*it}this._automationEvents[this._automationEvents.length-1]=S(rt,ut.startTime,Dt)}}}else{var Z=this._automationEvents.findIndex((function(Bt){return gt(Bt)>st})),mt=Z===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[Z-1];if(mt!==void 0&&R(mt)&&gt(mt)+mt.duration>st)return!1;var xt=U(J)?B(J.value,J.endTime,this._currenTime):D(J)?y(J.value,st,this._currenTime):J;if(Z===-1)this._automationEvents.push(xt);else{if(R(J)&&st+J.duration>gt(this._automationEvents[Z]))return!1;this._automationEvents.splice(Z,0,xt)}}return!0}},{key:"flush",value:function(J){var st=this._automationEvents.findIndex((function(ut){return gt(ut)>J}));if(st>1){var ot=this._automationEvents.slice(st-1),vt=ot[0];Mt(vt)&&ot.unshift(b(V(this._automationEvents,st-2,vt.startTime,this._defaultValue),vt.startTime)),this._automationEvents=ot}}},{key:"getValue",value:function(J){if(this._automationEvents.length===0)return this._defaultValue;var st=this._automationEvents.findIndex((function(rt){return gt(rt)>J})),ot=this._automationEvents[st],vt=(st===-1?this._automationEvents.length:st)-1,ut=this._automationEvents[vt];if(ut!==void 0&&Mt(ut)&&(ot===void 0||!H(ot)||ot.insertTime>J))return F(J,V(this._automationEvents,vt-1,ut.startTime,this._defaultValue),ut);if(ut!==void 0&&Q(ut)&&(ot===void 0||!H(ot)))return ut.value;if(ut!==void 0&&R(ut)&&(ot===void 0||!H(ot)||ut.startTime+ut.duration>J))return J<ut.startTime+ut.duration?Ct(J,ut):ut.values[ut.values.length-1];if(ut!==void 0&&H(ut)&&(ot===void 0||!H(ot)))return ut.value;if(ot!==void 0&&U(ot)){var Lt=O(this._automationEvents,vt,ut,ot,this._defaultValue),$t=f(Lt,2),Vt=$t[0],Nt=$t[1];return St(J,Vt,Nt,ot)}if(ot!==void 0&&D(ot)){var Dt=O(this._automationEvents,vt,ut,ot,this._defaultValue),Et=f(Dt,2),Ft=Et[0],jt=Et[1];return wt(J,Ft,jt,ot)}return this._defaultValue}}])})();h.AutomationEventList=Tt,h.createCancelAndHoldAutomationEvent=function(J){return{cancelTime:J,type:"cancelAndHold"}},h.createCancelScheduledValuesAutomationEvent=function(J){return{cancelTime:J,type:"cancelScheduledValues"}},h.createExponentialRampToValueAutomationEvent=function(J,st){return{endTime:st,type:"exponentialRampToValue",value:J}},h.createLinearRampToValueAutomationEvent=function(J,st){return{endTime:st,type:"linearRampToValue",value:J}},h.createSetTargetAutomationEvent=function(J,st,ot){return{startTime:st,target:J,timeConstant:ot,type:"setTarget"}},h.createSetValueAutomationEvent=b,h.createSetValueCurveAutomationEvent=S})(l,c(821),c(805),c(989))},989:(a,l,c)=>{var h=c(498);function f(m,w){for(var B=0;B<w.length;B++){var y=w[B];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,h(y.key),y)}}a.exports=function(m,w,B){return w&&f(m.prototype,w),B&&f(m,B),Object.defineProperty(m,"prototype",{writable:!1}),m},a.exports.__esModule=!0,a.exports.default=a.exports}},i={};function r(a){var l=i[a];if(l!==void 0)return l.exports;var c=i[a]={exports:{}};return n[a].call(c.exports,c,c.exports,r),c.exports}r.d=(a,l)=>{for(var c in l)r.o(l,c)&&!r.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:l[c]})},r.o=(a,l)=>Object.prototype.hasOwnProperty.call(a,l),r.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var A={};return(()=>{r.r(A),r.d(A,{AMOscillator:()=>Ma,AMSynth:()=>Qd,Abs:()=>Kw,Add:()=>vA,AmplitudeEnvelope:()=>_o,Analyser:()=>Xa,AudioToGain:()=>Dc,AutoFilter:()=>Gd,AutoPanner:()=>Kd,AutoWah:()=>qd,BaseContext:()=>Bd,BiquadFilter:()=>Da,BitCrusher:()=>$d,Buffer:()=>Jx,BufferSource:()=>tE,Buffers:()=>Zx,Channel:()=>bA,Chebyshev:()=>Xd,Chorus:()=>jd,Clock:()=>mo,Compressor:()=>or,Context:()=>lo,Convolver:()=>Cf,CrossFade:()=>So,DCMeter:()=>df,Delay:()=>Ps,Destination:()=>Wx,Distortion:()=>Jd,Draw:()=>zx,DuoSynth:()=>Ud,EQ3:()=>yf,Emitter:()=>ao,Envelope:()=>Dn,FFT:()=>hf,FMOscillator:()=>yo,FMSynth:()=>Pd,FatOscillator:()=>Qa,FeedbackCombFilter:()=>Ra,FeedbackDelay:()=>Zd,Filter:()=>ks,Follower:()=>qa,Freeverb:()=>ef,Frequency:()=>Bx,FrequencyClass:()=>es,FrequencyEnvelope:()=>ka,FrequencyShifter:()=>tf,Gain:()=>Wt,GainToAudio:()=>qw,Gate:()=>gf,GrainPlayer:()=>Id,GreaterThan:()=>Rc,GreaterThanZero:()=>Lc,IntervalTimeline:()=>Ow,JCReverb:()=>nf,LFO:()=>ss,Limiter:()=>wf,Listener:()=>qx,Loop:()=>Va,LowpassCombFilter:()=>Na,Master:()=>Gx,MembraneSynth:()=>La,Merge:()=>Hr,MetalSynth:()=>Dd,Meter:()=>uf,MidSideCompressor:()=>vf,MidSideMerge:()=>za,MidSideSplit:()=>$a,Midi:()=>Sx,MidiClass:()=>wo,Mono:()=>pf,MonoSynth:()=>yA,MultibandCompressor:()=>Bf,MultibandSplit:()=>Ya,Multiply:()=>Ye,Negate:()=>Md,Noise:()=>Lr,NoiseSynth:()=>kd,Offline:()=>_x,OfflineContext:()=>co,OmniOscillator:()=>ir,OnePoleFilter:()=>Ha,Oscillator:()=>Xe,PWMOscillator:()=>Ua,PanVol:()=>Wc,Panner:()=>Ka,Panner3D:()=>mf,Param:()=>te,Part:()=>Wa,Pattern:()=>Vd,Phaser:()=>Af,PingPongDelay:()=>sf,PitchShift:()=>rf,Player:()=>bo,Players:()=>Fd,PluckSynth:()=>Nd,PolySynth:()=>Od,Pow:()=>vo,PulseOscillator:()=>Co,Recorder:()=>Gc,Reverb:()=>of,Sampler:()=>Oa,Scale:()=>rr,ScaleExp:()=>Hc,Sequence:()=>Wd,Signal:()=>Yt,Solo:()=>an,Split:()=>CA,StateTimeline:()=>fo,StereoWidener:()=>af,Subtract:()=>BA,SyncedSignal:()=>Ix,Synth:()=>Rr,Ticks:()=>xx,TicksClass:()=>ze,Time:()=>gx,TimeClass:()=>Qs,Timeline:()=>Ms,ToneAudioBuffer:()=>ge,ToneAudioBuffers:()=>go,ToneAudioNode:()=>ft,ToneBufferSource:()=>kr,ToneEvent:()=>Ti,ToneOscillatorNode:()=>Ia,Transport:()=>Ox,TransportTime:()=>yx,TransportTimeClass:()=>dn,Tremolo:()=>lf,Unit:()=>l,UserMedia:()=>Fa,Vibrato:()=>cf,Volume:()=>nr,WaveShaper:()=>li,Waveform:()=>ff,Zero:()=>kc,connect:()=>ns,connectSeries:()=>Us,connectSignal:()=>Ta,context:()=>Yx,dbToGain:()=>uo,debug:()=>a,defaultArg:()=>Gs,disconnect:()=>bd,fanIn:()=>Cx,ftom:()=>Pr,gainToDb:()=>Ea,getContext:()=>Ve,getDestination:()=>Kx,getDraw:()=>Xx,getListener:()=>$x,getTransport:()=>Vx,immediate:()=>Nx,intervalToFrequencyRatio:()=>ho,isArray:()=>Un,isBoolean:()=>fd,isDefined:()=>Ae,isFunction:()=>Qw,isNote:()=>_a,isNumber:()=>Fs,isObject:()=>tr,isString:()=>Ai,isUndef:()=>ms,loaded:()=>jx,mtof:()=>yd,now:()=>Hx,optionsFromArguments:()=>at,setContext:()=>Mc,start:()=>mx,supported:()=>ux,version:()=>c});var a={};r.r(a),r.d(a,{assert:()=>Gt,assertContextRunning:()=>pd,assertRange:()=>wn,assertUsedScheduleTime:()=>Dw,enterScheduledCallback:()=>md,log:()=>kw,setLogger:()=>hx,warn:()=>ro});var l={};r.r(l);const c="15.1.22";var h=r(871);const f=new WeakSet,m=new WeakMap,w=new WeakMap,B=new WeakMap,y=new WeakMap,b=new WeakMap,S=new WeakMap,F=new WeakMap,U=new WeakMap,D=new WeakMap,H={construct:()=>H},Q=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,R=(g,s)=>{const o=[];let u=g.replace(/^[\s]+/,""),p=u.match(Q);for(;p!==null;){const v=p[1].slice(1,-1),C=p[0].replace(/([\s]+)?;?$/,"").replace(v,new URL(v,s).toString());o.push(C),u=u.slice(p[0].length).replace(/^[\s]+/,""),p=u.match(Q)}return[o.join(";"),u]},V=g=>{if(g!==void 0&&!Array.isArray(g))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},O=g=>{if(!(s=>{try{new new Proxy(s,H)}catch{return!1}return!0})(g))throw new TypeError("The given value for processorCtor should be a constructor.");if(g.prototype===null||typeof g.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},K=(g,s)=>{const o=g.get(s);if(o===void 0)throw new Error("A value with the given key could not be found.");return o},z=(g,s)=>{const o=Array.from(g).filter(s);if(o.length>1)throw Error("More than one element was found.");if(o.length===0)throw Error("No element was found.");const[u]=o;return g.delete(u),u},gt=(g,s,o,u)=>{const p=K(g,s),v=z(p,(C=>C[0]===o&&C[1]===u));return p.size===0&&g.delete(s),v},St=g=>K(S,g),wt=g=>{if(f.has(g))throw new Error("The AudioNode is already stored.");f.add(g),St(g).forEach((s=>s(!0)))},Ct=g=>"port"in g,Mt=g=>{if(!f.has(g))throw new Error("The AudioNode is not stored.");f.delete(g),St(g).forEach((s=>s(!1)))},Tt=(g,s)=>{!Ct(g)&&s.every((o=>o.size===0))&&Mt(g)},J={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},st=(g,s)=>g.context===s,ot=g=>{try{g.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},vt=()=>new DOMException("","IndexSizeError"),ut=g=>{var s;g.getChannelData=(s=g.getChannelData,o=>{try{return s.call(g,o)}catch(u){throw u.code===12?vt():u}})},Lt={numberOfChannels:1},$t=-34028234663852886e22,Vt=-$t,Nt=g=>f.has(g),Dt={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Et=g=>K(m,g),Ft=g=>K(B,g),jt=(g,s)=>{const{activeInputs:o}=Et(g);o.forEach((p=>p.forEach((([v])=>{s.includes(g)||jt(v,[...s,g])}))));const u=(p=>"playbackRate"in p)(g)?[g.playbackRate]:Ct(g)?Array.from(g.parameters.values()):(p=>"frequency"in p&&"gain"in p)(g)?[g.Q,g.detune,g.frequency,g.gain]:(p=>"offset"in p)(g)?[g.offset]:(p=>!("frequency"in p)&&"gain"in p)(g)?[g.gain]:(p=>"detune"in p&&"frequency"in p)(g)?[g.detune,g.frequency]:(p=>"pan"in p)(g)?[g.pan]:[];for(const p of u){const v=Ft(p);v!==void 0&&v.activeInputs.forEach((([C])=>jt(C,s)))}Nt(g)&&Mt(g)},rt=g=>{jt(g.destination,[])},pt=g=>"context"in g,it=g=>pt(g[0]),Z=(g,s,o,u)=>{for(const p of g)if(o(p)){if(u)return!1;throw Error("The set contains at least one similar element.")}return g.add(s),!0},mt=(g,s,[o,u],p)=>{Z(g,[s,o,u],(v=>v[0]===s&&v[1]===o),p)},xt=(g,[s,o,u],p)=>{const v=g.get(s);v===void 0?g.set(s,new Set([[o,u]])):Z(v,[o,u],(C=>C[0]===o),p)},Bt=g=>"inputs"in g,Ht=(g,s,o,u)=>{if(Bt(s)){const p=s.inputs[u];return g.connect(p,o,0),[p,o,0]}return g.connect(s,o,u),[s,o,u]},oe=(g,s,o)=>{for(const u of g)if(u[0]===s&&u[1]===o)return g.delete(u),u;return null},Xt=(g,s)=>{if(!St(g).delete(s))throw new Error("Missing the expected event listener.")},be=(g,s,o)=>{const u=K(g,s),p=z(u,(v=>v[0]===o));return u.size===0&&g.delete(s),p},Ce=(g,s,o,u)=>{Bt(s)?g.disconnect(s.inputs[u],o,0):g.disconnect(s,o,u)},Zt=g=>K(w,g),Ie=g=>K(y,g),me=g=>F.has(g),xe=g=>!f.has(g),Mn=(g,s)=>new Promise((o=>{if(s!==null)o(!0);else{const u=g.createScriptProcessor(256,1,1),p=g.createGain(),v=g.createBuffer(1,2,44100),C=v.getChannelData(0);C[0]=1,C[1]=1;const _=g.createBufferSource();_.buffer=v,_.loop=!0,_.connect(u).connect(g.destination),_.connect(p),_.disconnect(p),u.onaudioprocess=E=>{const T=E.inputBuffer.getChannelData(0);Array.prototype.some.call(T,(I=>I===1))?o(!0):o(!1),_.stop(),u.onaudioprocess=null,_.disconnect(u),u.disconnect(g.destination)},_.start()}})),Kt=(g,s)=>{const o=new Map;for(const u of g)for(const p of u){const v=o.get(p);o.set(p,v===void 0?1:v+1)}o.forEach(((u,p)=>s(p,u)))},ne=g=>"context"in g,re=g=>{const s=new Map;g.connect=(o=>(u,p=0,v=0)=>{const C=ne(u)?o(u,p,v):o(u,p),_=s.get(u);return _===void 0?s.set(u,[{input:v,output:p}]):_.every((E=>E.input!==v||E.output!==p))&&_.push({input:v,output:p}),C})(g.connect.bind(g)),g.disconnect=(o=>(u,p,v)=>{if(o.apply(g),u===void 0)s.clear();else if(typeof u=="number")for(const[C,_]of s){const E=_.filter((T=>T.output!==u));E.length===0?s.delete(C):s.set(C,E)}else if(s.has(u))if(p===void 0)s.delete(u);else{const C=s.get(u);if(C!==void 0){const _=C.filter((E=>E.output!==p&&(E.input!==v||v===void 0)));_.length===0?s.delete(u):s.set(u,_)}}for(const[C,_]of s)_.forEach((E=>{ne(C)?g.connect(C,E.output,E.input):g.connect(C,E.output)}))})(g.disconnect)},Le=(g,s,o,u,p)=>{const[v,C]=((_,E,T,I)=>{const{activeInputs:M,passiveInputs:L}=Et(E),k=oe(M[I],_,T);return k===null?[gt(L,_,T,I)[2],!1]:[k[2],!0]})(g,o,u,p);if(v!==null&&(Xt(g,v),!C||s||me(g)||Ce(Zt(g),Zt(o),u,p)),Nt(o)){const{activeInputs:_}=Et(o);Tt(o,_)}},Gn=(g,s,o,u)=>{const[p,v]=((C,_,E)=>{const{activeInputs:T,passiveInputs:I}=Ft(_),M=oe(T,C,E);return M===null?[be(I,C,E)[1],!1]:[M[2],!0]})(g,o,u);p!==null&&(Xt(g,p),!v||s||me(g)||Zt(g).disconnect(Ie(o),u))};class fs{constructor(s){this._map=new Map(s)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(s,o=null){return this._map.forEach(((u,p)=>s.call(o,u,p,this)))}get(s){return this._map.get(s)}has(s){return this._map.has(s)}keys(){return this._map.keys()}values(){return this._map.values()}}const wa={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function Fr(g,s,o,u,p){if(typeof g.copyFromChannel=="function")s[o].byteLength===0&&(s[o]=new Float32Array(128)),g.copyFromChannel(s[o],u,p);else{const v=g.getChannelData(u);if(s[o].byteLength===0)s[o]=v.slice(p,p+128);else{const C=new Float32Array(v.buffer,p*Float32Array.BYTES_PER_ELEMENT,128);s[o].set(C)}}}const vc=(g,s,o,u,p)=>{typeof g.copyToChannel=="function"?s[o].byteLength!==0&&g.copyToChannel(s[o],u,p):s[o].byteLength!==0&&g.getChannelData(u).set(s[o],p)},Bc=(g,s)=>{const o=[];for(let u=0;u<g;u+=1){const p=[],v=typeof s=="number"?s:s[u];for(let C=0;C<v;C+=1)p.push(new Float32Array(128));o.push(p)}return o},E_=async(g,s,o,u,p,v,C)=>{const _=s===null?128*Math.ceil(g.context.length/128):s.length,E=u.channelCount*u.numberOfInputs,T=p.reduce(((N,X)=>N+X),0),I=T===0?null:o.createBuffer(T,_,o.sampleRate);if(v===void 0)throw new Error("Missing the processor constructor.");const M=Et(g),L=await((N,X)=>{const $=K(D,N),W=Zt(X);return K($,W)})(o,g),k=Bc(u.numberOfInputs,u.channelCount),q=Bc(u.numberOfOutputs,p),G=Array.from(g.parameters.keys()).reduce(((N,X)=>({...N,[X]:new Float32Array(128)})),{});for(let N=0;N<_;N+=128){if(u.numberOfInputs>0&&s!==null)for(let X=0;X<u.numberOfInputs;X+=1)for(let $=0;$<u.channelCount;$+=1)Fr(s,k[X],$,$,N);v.parameterDescriptors!==void 0&&s!==null&&v.parameterDescriptors.forEach((({name:X},$)=>{Fr(s,G,X,E+$,N)}));for(let X=0;X<u.numberOfInputs;X+=1)for(let $=0;$<p[X];$+=1)q[X][$].byteLength===0&&(q[X][$]=new Float32Array(128));try{const X=k.map(((W,At)=>M.activeInputs[At].size===0?[]:W)),$=C(N/o.sampleRate,o.sampleRate,(()=>L.process(X,q,G)));if(I!==null)for(let W=0,At=0;W<u.numberOfOutputs;W+=1){for(let ht=0;ht<p[W];ht+=1)vc(I,q[W],ht,At+ht,N);At+=p[W]}if(!$)break}catch(X){g.dispatchEvent(new ErrorEvent("processorerror",{colno:X.colno,filename:X.filename,lineno:X.lineno,message:X.message}));break}}return I},T_={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},F_={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},I_={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},M_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Q_={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},zg=g=>{const{port1:s,port2:o}=new MessageChannel;return new Promise((u=>{const p=()=>{o.onmessage=null,s.close(),o.close(),u()};o.onmessage=()=>p();try{s.postMessage(g,[g])}catch{}finally{p()}}))},U_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},yc=(g,s,o)=>{const u=s[o];if(u===void 0)throw g();return u},P_={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},D_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},bn=()=>new DOMException("","InvalidStateError"),Cc=()=>new DOMException("","InvalidAccessError"),k_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Xg=(g,s,o,u,p,v,C,_,E,T,I)=>{const M=T.length;let L=_;for(let k=0;k<M;k+=1){let q=o[0]*T[k];for(let G=1;G<p;G+=1){const N=L-G&E-1;q+=o[G]*v[N],q-=g[G]*C[N]}for(let G=p;G<u;G+=1)q+=o[G]*v[L-G&E-1];for(let G=p;G<s;G+=1)q-=g[G]*C[L-G&E-1];v[L]=T[k],C[L]=q,L=L+1&E-1,I[k]=q}return L},L_={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},va=g=>{const s=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const o=g.decodeAudioData(s.buffer,(()=>{}));return o!==void 0&&(o.catch((()=>{})),!0)}catch{}return!1},$e=(g,s,o)=>{const u=s[o];u!==void 0&&u!==g[o]&&(g[o]=u)},gn=(g,s)=>{$e(g,s,"channelCount"),$e(g,s,"channelCountMode"),$e(g,s,"channelInterpretation")},Yg=g=>typeof g.getFloatTimeDomainData=="function",en=(g,s,o)=>{const u=s[o];u!==void 0&&u!==g[o].value&&(g[o].value=u)},ed=g=>{g.start=(s=>(o=0,u=0,p)=>{if(typeof p=="number"&&p<0||u<0||o<0)throw new RangeError("The parameters can't be negative.");s.call(g,o,u,p)})(g.start)},nd=g=>{var s;g.stop=(s=g.stop,(o=0)=>{if(o<0)throw new RangeError("The parameter can't be negative.");s.call(g,o)})},jg=(g,s)=>g===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(g*s))))),Jg=(g,s)=>{const o=g.createBiquadFilter();return gn(o,s),en(o,s,"Q"),en(o,s,"detune"),en(o,s,"frequency"),en(o,s,"gain"),$e(o,s,"type"),o},Ba=(g,s)=>{const o=g.createChannelSplitter(s.numberOfOutputs);return gn(o,s),(u=>{const p=u.numberOfOutputs;Object.defineProperty(u,"channelCount",{get:()=>p,set:v=>{if(v!==p)throw bn()}}),Object.defineProperty(u,"channelCountMode",{get:()=>"explicit",set:v=>{if(v!=="explicit")throw bn()}}),Object.defineProperty(u,"channelInterpretation",{get:()=>"discrete",set:v=>{if(v!=="discrete")throw bn()}})})(o),o},to=(g,s)=>(g.connect=s.connect.bind(s),g.disconnect=s.disconnect.bind(s),g),Zg=(g,s)=>{const o=g.createDelay(s.maxDelayTime);return gn(o,s),en(o,s,"delayTime"),o},ps=(g,s)=>{const o=g.createGain();return gn(o,s),en(o,s,"gain"),o};function R_(g,s){const o=s[0]*s[0]+s[1]*s[1];return[(g[0]*s[0]+g[1]*s[1])/o,(g[1]*s[0]-g[0]*s[1])/o]}function tw(g,s){let o=[0,0];for(let v=g.length-1;v>=0;v-=1)p=s,o=[(u=o)[0]*p[0]-u[1]*p[1],u[0]*p[1]+u[1]*p[0]],o[0]+=g[v];var u,p;return o}const ya=(g,s,o,u)=>g.createScriptProcessor(s,o,u),ts=()=>new DOMException("","NotSupportedError"),H_={numberOfChannels:1},N_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},O_={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},V_={disableNormalization:!1},W_={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},G_=()=>new DOMException("","UnknownError"),K_={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ew=(g,s,o)=>g.copyFromChannel===void 0?g.getChannelData(o)[0]:(g.copyFromChannel(s,o),s[0]),nw=g=>{if(g===null)return!1;const s=g.length;return s%2!=0?g[Math.floor(s/2)]!==0:g[s/2-1]+g[s/2]!==0},Ca=(g,s,o,u)=>{let p=g;for(;!p.hasOwnProperty(s);)p=Object.getPrototypeOf(p);const{get:v,set:C}=Object.getOwnPropertyDescriptor(p,s);Object.defineProperty(g,s,{get:o(v),set:u(C)})},sw=(g,s,o)=>{try{g.setValueAtTime(s,o)}catch(u){if(u.code!==9)throw u;sw(g,s,o+1e-7)}},sd=g=>{const s=g.createOscillator();try{s.start(-1)}catch(o){return o instanceof RangeError}return!1},iw=g=>{const s=g.createBuffer(1,1,44100),o=g.createBufferSource();o.buffer=s,o.start(),o.stop();try{return o.stop(),!0}catch{return!1}},id=g=>{const s=g.createOscillator();try{s.stop(-1)}catch(o){return o instanceof RangeError}return!1},q_=()=>{try{new DOMException}catch{return!1}return!0},$_=()=>new Promise((g=>{const s=new ArrayBuffer(0),{port1:o,port2:u}=new MessageChannel;o.onmessage=({data:p})=>g(p!==null),u.postMessage(s,[s])})),rw=(g,s)=>{const o=s.createGain();g.connect(o);const u=(p=>()=>{p.call(g,o),g.removeEventListener("ended",u)})(g.disconnect);g.addEventListener("ended",u),to(g,o),g.stop=(p=>{let v=!1;return(C=0)=>{if(v)try{p.call(g,C)}catch{o.gain.setValueAtTime(0,C)}else p.call(g,C),v=!0}})(g.stop)},eo=(g,s)=>o=>{const u={value:g};return Object.defineProperties(o,{currentTarget:u,target:u}),typeof s=="function"?s.call(g,o):s.handleEvent.call(g,o)},z_=(g=>(s,o,[u,p,v],C)=>{g(s[p],[o,u,v],(_=>_[0]===o&&_[1]===u),C)})(Z),X_=(g=>(s,o,[u,p,v],C)=>{const _=s.get(u);_===void 0?s.set(u,new Set([[p,o,v]])):g(_,[p,o,v],(E=>E[0]===p&&E[1]===o),C)})(Z),Y_=(g=>(s,o,u,p)=>g(s[p],(v=>v[0]===o&&v[1]===u)))(z),Aw=new WeakMap,j_=(g=>s=>{var o;return(o=g.get(s))!==null&&o!==void 0?o:0})(Aw),Vs=(bc=new Map,ba=new WeakMap,(g,s)=>{const o=ba.get(g);if(o!==void 0)return o;const u=bc.get(g);if(u!==void 0)return u;try{const p=s();return p instanceof Promise?(bc.set(g,p),p.catch((()=>!1)).then((v=>(bc.delete(g),ba.set(g,v),v)))):(ba.set(g,p),p)}catch{return ba.set(g,!1),!1}});var bc,ba;const ii=typeof window>"u"?null:window,ow=((g,s)=>(o,u)=>{const p=o.createAnalyser();if(gn(p,u),!(u.maxDecibels>u.minDecibels))throw s();return $e(p,u,"fftSize"),$e(p,u,"maxDecibels"),$e(p,u,"minDecibels"),$e(p,u,"smoothingTimeConstant"),g(Yg,(()=>Yg(p)))||(v=>{v.getFloatTimeDomainData=C=>{const _=new Uint8Array(C.length);v.getByteTimeDomainData(_);const E=Math.max(_.length,v.fftSize);for(let T=0;T<E;T+=1)C[T]=.0078125*(_[T]-128);return C}})(p),p})(Vs,vt),rd=(g=>s=>{const o=g(s);if(o.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return o.renderer})(Et),Qn=((g,s,o)=>async(u,p,v)=>{const C=g(u);await Promise.all(C.activeInputs.map(((_,E)=>Array.from(_).map((async([T,I])=>{const M=s(T),L=await M.render(T,p),k=u.context.destination;o(T)||u===k&&o(u)||L.connect(v,I,E)})))).reduce(((_,E)=>[..._,...E]),[]))})(Et,rd,me),J_=((g,s,o)=>()=>{const u=new WeakMap;return{render(p,v){const C=u.get(v);return C!==void 0?Promise.resolve(C):(async(_,E)=>{let T=s(_);if(!st(T,E)){const I={channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,fftSize:T.fftSize,maxDecibels:T.maxDecibels,minDecibels:T.minDecibels,smoothingTimeConstant:T.smoothingTimeConstant};T=g(E,I)}return u.set(E,T),await o(_,E,T),T})(p,v)}}})(ow,Zt,Qn),Ne=(aw=b,g=>{const s=aw.get(g);if(s===void 0)throw bn();return s});var aw;const _n=(g=>g===null?null:g.hasOwnProperty("OfflineAudioContext")?g.OfflineAudioContext:g.hasOwnProperty("webkitOfflineAudioContext")?g.webkitOfflineAudioContext:null)(ii),Me=(g=>s=>g!==null&&s instanceof g)(_n),lw=new WeakMap,cw=(g=>class{constructor(s){this._nativeEventTarget=s,this._listeners=new WeakMap}addEventListener(s,o,u){if(o!==null){let p=this._listeners.get(o);p===void 0&&(p=g(this,o),typeof o=="function"&&this._listeners.set(o,p)),this._nativeEventTarget.addEventListener(s,p,u)}}dispatchEvent(s){return this._nativeEventTarget.dispatchEvent(s)}removeEventListener(s,o,u){const p=o===null?void 0:this._listeners.get(o);this._nativeEventTarget.removeEventListener(s,p===void 0?null:p,u)}})(eo),Ir=(g=>g===null?null:g.hasOwnProperty("AudioContext")?g.AudioContext:g.hasOwnProperty("webkitAudioContext")?g.webkitAudioContext:null)(ii),Ad=(g=>s=>g!==null&&s instanceof g)(Ir),od=(g=>s=>g!==null&&typeof g.AudioNode=="function"&&s instanceof g.AudioNode)(ii),uw=(g=>s=>g!==null&&typeof g.AudioParam=="function"&&s instanceof g.AudioParam)(ii),no=(g=>g===null?null:g.hasOwnProperty("AudioWorkletNode")?g.AudioWorkletNode:null)(ii),on=((g,s,o,u,p,v,C,_,E,T,I,M,L,k,q,G)=>class extends T{constructor(N,X,$,W){super($),this._context=N,this._nativeAudioNode=$;const At=I(N);M(At)&&o(Mn,(()=>Mn(At,G)))!==!0&&re($),w.set(this,$),S.set(this,new Set),N.state!=="closed"&&X&&wt(this),g(this,W,$)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(N){this._nativeAudioNode.channelCount=N}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(N){this._nativeAudioNode.channelCountMode=N}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(N){this._nativeAudioNode.channelInterpretation=N}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(N,X=0,$=0){if(X<0||X>=this._nativeAudioNode.numberOfOutputs)throw p();const W=I(this._context),At=q(W);if(L(N)||k(N))throw v();if(pt(N)){const j=Zt(N);try{const nt=Ht(this._nativeAudioNode,j,X,$),Y=xe(this);(At||Y)&&this._nativeAudioNode.disconnect(...nt),this.context.state!=="closed"&&!Y&&xe(N)&&wt(N)}catch(nt){throw nt.code===12?v():nt}if(s(this,N,X,$,At)){const nt=E([this],N);Kt(nt,u(At))}return N}const ht=Ie(N);if(ht.name==="playbackRate"&&ht.maxValue===1024)throw C();try{this._nativeAudioNode.connect(ht,X),(At||xe(this))&&this._nativeAudioNode.disconnect(ht,X)}catch(j){throw j.code===12?v():j}if(((j,nt,Y,dt)=>{const{activeInputs:tt,passiveInputs:ct}=Ft(nt),{outputs:bt}=Et(j),_t=St(j),Jt=Ot=>{const Rt=Zt(j),ee=Ie(nt);if(Ot){const Pt=be(ct,j,Y);mt(tt,j,Pt,!1),dt||me(j)||Rt.connect(ee,Y)}else{const Pt=((se,he,we)=>z(se,(We=>We[0]===he&&We[1]===we)))(tt,j,Y);xt(ct,Pt,!1),dt||me(j)||Rt.disconnect(ee,Y)}};return!!Z(bt,[nt,Y],(Ot=>Ot[0]===nt&&Ot[1]===Y),!0)&&(_t.add(Jt),Nt(j)?mt(tt,j,[Y,Jt],!0):xt(ct,[j,Y,Jt],!0),!0)})(this,N,X,At)){const j=E([this],N);Kt(j,u(At))}}disconnect(N,X,$){let W;const At=I(this._context),ht=q(At);if(N===void 0)W=((j,nt)=>{const Y=Et(j),dt=[];for(const tt of Y.outputs)it(tt)?Le(j,nt,...tt):Gn(j,nt,...tt),dt.push(tt[0]);return Y.outputs.clear(),dt})(this,ht);else if(typeof N=="number"){if(N<0||N>=this.numberOfOutputs)throw p();W=((j,nt,Y)=>{const dt=Et(j),tt=[];for(const ct of dt.outputs)ct[1]===Y&&(it(ct)?Le(j,nt,...ct):Gn(j,nt,...ct),tt.push(ct[0]),dt.outputs.delete(ct));return tt})(this,ht,N)}else{if(X!==void 0&&(X<0||X>=this.numberOfOutputs)||pt(N)&&$!==void 0&&($<0||$>=N.numberOfInputs))throw p();if(W=((j,nt,Y,dt,tt)=>{const ct=Et(j);return Array.from(ct.outputs).filter((bt=>!(bt[0]!==Y||dt!==void 0&&bt[1]!==dt||tt!==void 0&&bt[2]!==tt))).map((bt=>(it(bt)?Le(j,nt,...bt):Gn(j,nt,...bt),ct.outputs.delete(bt),bt[0])))})(this,ht,N,X,$),W.length===0)throw v()}for(const j of W){const nt=E([this],j);Kt(nt,_)}}})((hw=m,(g,s,o)=>{const u=[];for(let p=0;p<o.numberOfInputs;p+=1)u.push(new Set);hw.set(g,{activeInputs:u,outputs:new Set,passiveInputs:new WeakMap,renderer:s})}),((g,s,o,u,p,v,C,_,E,T,I,M,L)=>{const k=new WeakMap;return(q,G,N,X,$)=>{const{activeInputs:W,passiveInputs:At}=v(G),{outputs:ht}=v(q),j=_(q),nt=Y=>{const dt=E(G),tt=E(q);if(Y){const ct=gt(At,q,N,X);g(W,q,ct,!1),$||M(q)||o(tt,dt,N,X),L(G)&&wt(G)}else{const ct=u(W,q,N,X);s(At,X,ct,!1),$||M(q)||p(tt,dt,N,X);const bt=C(G);if(bt===0)I(G)&&Tt(G,W);else{const _t=k.get(G);_t!==void 0&&clearTimeout(_t),k.set(G,setTimeout((()=>{I(G)&&Tt(G,W)}),1e3*bt))}}};return!!T(ht,[G,N,X],(Y=>Y[0]===G&&Y[1]===N&&Y[2]===X),!0)&&(j.add(nt),I(q)?g(W,q,[N,X,nt],!0):s(At,X,[q,N,nt],!0),!0)}})(z_,X_,Ht,Y_,Ce,Et,j_,St,Zt,Z,Nt,me,xe),Vs,((g,s,o,u,p,v)=>C=>(_,E)=>{const T=g.get(_);if(T===void 0){if(!C&&v(_)){const I=u(_),{outputs:M}=o(_);for(const L of M)if(it(L)){const k=u(L[0]);s(I,k,L[1],L[2])}else{const k=p(L[0]);I.disconnect(k,L[1])}}g.set(_,E)}else g.set(_,T+E)})(F,Ce,Et,Zt,Ie,Nt),vt,Cc,ts,((g,s,o,u,p,v,C,_)=>(E,T)=>{const I=s.get(E);if(I===void 0)throw new Error("Missing the expected cycle count.");const M=v(E.context),L=_(M);if(I===T){if(s.delete(E),!L&&C(E)){const k=u(E),{outputs:q}=o(E);for(const G of q)if(it(G)){const N=u(G[0]);g(k,N,G[1],G[2])}else{const N=p(G[0]);k.connect(N,G[1])}}}else s.set(E,I-T)})(Ht,F,Et,Zt,Ie,Ne,Nt,Me),((g,s,o)=>function u(p,v){const C=pt(v)?v:o(g,v);if((E=>"delayTime"in E)(C))return[];if(p[0]===C)return[p];if(p.includes(C))return[];const{outputs:_}=s(C);return Array.from(_).map((E=>u([...p,C],E[0]))).reduce(((E,T)=>E.concat(T)),[])})(lw,Et,K),cw,Ne,Ad,od,uw,Me,no);var hw;const Z_=((g,s,o,u,p,v)=>class extends g{constructor(C,_){const E=p(C),T={...J,..._},I=u(E,T);super(C,!1,I,v(E)?s():null),this._nativeAnalyserNode=I}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(C){this._nativeAnalyserNode.fftSize=C}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(C){const _=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=C,!(C>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=_,o()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(C){const _=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=C,!(this._nativeAnalyserNode.maxDecibels>C))throw this._nativeAnalyserNode.minDecibels=_,o()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(C){this._nativeAnalyserNode.smoothingTimeConstant=C}getByteFrequencyData(C){this._nativeAnalyserNode.getByteFrequencyData(C)}getByteTimeDomainData(C){this._nativeAnalyserNode.getByteTimeDomainData(C)}getFloatFrequencyData(C){this._nativeAnalyserNode.getFloatFrequencyData(C)}getFloatTimeDomainData(C){this._nativeAnalyserNode.getFloatTimeDomainData(C)}})(on,J_,vt,ow,Ne,Me),ad=new WeakSet,dw=(g=>g===null?null:g.hasOwnProperty("AudioBuffer")?g.AudioBuffer:null)(ii),fw=(ld=new Uint32Array(1),g=>(ld[0]=g,ld[0]));var ld;const cd=((g,s)=>o=>{o.copyFromChannel=(u,p,v=0)=>{const C=g(v),_=g(p);if(_>=o.numberOfChannels)throw s();const E=o.length,T=o.getChannelData(_),I=u.length;for(let M=C<0?-C:0;M+C<E&&M<I;M+=1)u[M]=T[M+C]},o.copyToChannel=(u,p,v=0)=>{const C=g(v),_=g(p);if(_>=o.numberOfChannels)throw s();const E=o.length,T=o.getChannelData(_),I=u.length;for(let M=C<0?-C:0;M+C<E&&M<I;M+=1)T[M+C]=u[M]}})(fw,vt),ud=(g=>s=>{s.copyFromChannel=(o=>(u,p,v=0)=>{const C=g(v),_=g(p);if(C<s.length)return o.call(s,u,_,C)})(s.copyFromChannel),s.copyToChannel=(o=>(u,p,v=0)=>{const C=g(v),_=g(p);if(C<s.length)return o.call(s,u,_,C)})(s.copyToChannel)})(fw),pw=((g,s,o,u,p,v,C,_)=>{let E=null;return class Oy{constructor(I){if(p===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:M,numberOfChannels:L,sampleRate:k}={...Lt,...I};E===null&&(E=new p(1,1,44100));const q=u!==null&&s(v,v)?new u({length:M,numberOfChannels:L,sampleRate:k}):E.createBuffer(L,M,k);if(q.numberOfChannels===0)throw o();return typeof q.copyFromChannel!="function"?(C(q),ut(q)):s(ot,(()=>ot(q)))||_(q),g.add(q),q}static[Symbol.hasInstance](I){return I!==null&&typeof I=="object"&&Object.getPrototypeOf(I)===Oy.prototype||g.has(I)}}})(ad,Vs,ts,dw,_n,(g=>()=>{if(g===null)return!1;try{new g({length:1,sampleRate:44100})}catch{return!1}return!0})(dw),cd,ud),_c=(g=>(s,o)=>{const u=g(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});o.connect(u).connect(s.destination);const p=()=>{o.removeEventListener("ended",p),o.disconnect(u),u.disconnect()};o.addEventListener("ended",p)})(ps),mw=((g,s,o)=>async(u,p,v)=>{const C=s(u);await Promise.all(Array.from(C.activeInputs).map((async([_,E])=>{const T=g(_),I=await T.render(_,p);o(_)||I.connect(v,E)})))})(rd,Ft,me),xi=(g=>(s,o,u)=>g(o,s,u))(mw),so=((g,s,o,u,p,v,C,_,E,T,I)=>(M,L)=>{const k=M.createBufferSource();return gn(k,L),en(k,L,"playbackRate"),$e(k,L,"buffer"),$e(k,L,"loop"),$e(k,L,"loopEnd"),$e(k,L,"loopStart"),s(o,(()=>o(M)))||(q=>{q.start=(G=>{let N=!1;return(X=0,$=0,W)=>{if(N)throw bn();G.call(q,X,$,W),N=!0}})(q.start)})(k),s(u,(()=>u(M)))||(q=>{q.start=(G=>(N=0,X=0,$)=>{const W=q.buffer,At=W===null?X:Math.min(W.duration,X);W!==null&&At>W.duration-.5/q.context.sampleRate?G.call(q,N,0,0):G.call(q,N,At,$)})(q.start)})(k),s(p,(()=>p(M)))||T(k,M),s(v,(()=>v(M)))||ed(k),s(C,(()=>C(M)))||I(k,M),s(_,(()=>_(M)))||nd(k),g(M,k),k})(_c,Vs,(g=>{const s=g.createBufferSource();s.start();try{s.start()}catch{return!0}return!1}),(g=>{const s=g.createBufferSource(),o=g.createBuffer(1,1,44100);s.buffer=o;try{s.start(0,1)}catch{return!1}return!0}),(g=>{const s=g.createBufferSource();s.start();try{s.stop()}catch{return!1}return!0}),sd,iw,id,0,(g=>(s,o)=>{const u=o.createBuffer(1,1,44100);s.buffer===null&&(s.buffer=u),g(s,"buffer",(p=>()=>{const v=p.call(s);return v===u?null:v}),(p=>v=>p.call(s,v===null?u:v)))})(Ca),rw),Ei=((g,s)=>(o,u,p)=>(g(u).replay(p),s(u,o,p)))((g=>s=>{const o=g(s);if(o.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return o.renderer})(Ft),mw),tS=((g,s,o,u,p)=>()=>{const v=new WeakMap;let C=null,_=null;return{set start(E){C=E},set stop(E){_=E},render(E,T){const I=v.get(T);return I!==void 0?Promise.resolve(I):(async(M,L)=>{let k=o(M);const q=st(k,L);if(!q){const G={buffer:k.buffer,channelCount:k.channelCount,channelCountMode:k.channelCountMode,channelInterpretation:k.channelInterpretation,loop:k.loop,loopEnd:k.loopEnd,loopStart:k.loopStart,playbackRate:k.playbackRate.value};k=s(L,G),C!==null&&k.start(...C),_!==null&&k.stop(_)}return v.set(L,k),q?await g(L,M.playbackRate,k.playbackRate):await u(L,M.playbackRate,k.playbackRate),await p(M,L,k),k})(E,T)}}})(xi,so,Zt,Ei,Qn),ri=((g,s,o,u,p,v,C,_,E,T,I,M,L)=>(k,q,G,N=null,X=null)=>{const $=G.value,W=new h.AutomationEventList($),At=q?(j=>({replay(nt){for(const Y of j)if(Y.type==="exponentialRampToValue"){const{endTime:dt,value:tt}=Y;nt.exponentialRampToValueAtTime(tt,dt)}else if(Y.type==="linearRampToValue"){const{endTime:dt,value:tt}=Y;nt.linearRampToValueAtTime(tt,dt)}else if(Y.type==="setTarget"){const{startTime:dt,target:tt,timeConstant:ct}=Y;nt.setTargetAtTime(tt,dt,ct)}else if(Y.type==="setValue"){const{startTime:dt,value:tt}=Y;nt.setValueAtTime(tt,dt)}else{if(Y.type!=="setValueCurve")throw new Error("Can't apply an unknown automation.");{const{duration:dt,startTime:tt,values:ct}=Y;nt.setValueCurveAtTime(ct,tt,dt)}}}}))(W):null,ht={get defaultValue(){return $},get maxValue(){return N===null?G.maxValue:N},get minValue(){return X===null?G.minValue:X},get value(){return G.value},set value(j){G.value=j,ht.setValueAtTime(j,k.context.currentTime)},cancelAndHoldAtTime(j){if(typeof G.cancelAndHoldAtTime=="function")At===null&&W.flush(k.context.currentTime),W.add(p(j)),G.cancelAndHoldAtTime(j);else{const nt=Array.from(W).pop();At===null&&W.flush(k.context.currentTime),W.add(p(j));const Y=Array.from(W).pop();G.cancelScheduledValues(j),nt!==Y&&Y!==void 0&&(Y.type==="exponentialRampToValue"?G.exponentialRampToValueAtTime(Y.value,Y.endTime):Y.type==="linearRampToValue"?G.linearRampToValueAtTime(Y.value,Y.endTime):Y.type==="setValue"?G.setValueAtTime(Y.value,Y.startTime):Y.type==="setValueCurve"&&G.setValueCurveAtTime(Y.values,Y.startTime,Y.duration))}return ht},cancelScheduledValues:j=>(At===null&&W.flush(k.context.currentTime),W.add(v(j)),G.cancelScheduledValues(j),ht),exponentialRampToValueAtTime(j,nt){if(j===0)throw new RangeError;if(!Number.isFinite(nt)||nt<0)throw new RangeError;const Y=k.context.currentTime;return At===null&&W.flush(Y),Array.from(W).length===0&&(W.add(T($,Y)),G.setValueAtTime($,Y)),W.add(C(j,nt)),G.exponentialRampToValueAtTime(j,nt),ht},linearRampToValueAtTime(j,nt){const Y=k.context.currentTime;return At===null&&W.flush(Y),Array.from(W).length===0&&(W.add(T($,Y)),G.setValueAtTime($,Y)),W.add(_(j,nt)),G.linearRampToValueAtTime(j,nt),ht},setTargetAtTime:(j,nt,Y)=>(At===null&&W.flush(k.context.currentTime),W.add(E(j,nt,Y)),G.setTargetAtTime(j,nt,Y),ht),setValueAtTime:(j,nt)=>(At===null&&W.flush(k.context.currentTime),W.add(T(j,nt)),G.setValueAtTime(j,nt),ht),setValueCurveAtTime(j,nt,Y){const dt=j instanceof Float32Array?j:new Float32Array(j);if(M!==null&&M.name==="webkitAudioContext"){const tt=nt+Y,ct=k.context.sampleRate,bt=Math.ceil(nt*ct),_t=Math.floor(tt*ct),Jt=_t-bt,Ot=new Float32Array(Jt);for(let ee=0;ee<Jt;ee+=1){const Pt=(dt.length-1)/Y*((bt+ee)/ct-nt),se=Math.floor(Pt),he=Math.ceil(Pt);Ot[ee]=se===he?dt[se]:(1-(Pt-se))*dt[se]+(1-(he-Pt))*dt[he]}At===null&&W.flush(k.context.currentTime),W.add(I(Ot,nt,Y)),G.setValueCurveAtTime(Ot,nt,Y);const Rt=_t/ct;Rt<tt&&L(ht,Ot[Ot.length-1],Rt),L(ht,dt[dt.length-1],tt)}else At===null&&W.flush(k.context.currentTime),W.add(I(dt,nt,Y)),G.setValueCurveAtTime(dt,nt,Y);return ht}};return o.set(ht,G),s.set(ht,k),g(ht,At),ht})((gw=B,(g,s)=>{gw.set(g,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:s})}),lw,y,0,h.createCancelAndHoldAutomationEvent,h.createCancelScheduledValuesAutomationEvent,h.createExponentialRampToValueAutomationEvent,h.createLinearRampToValueAutomationEvent,h.createSetTargetAutomationEvent,h.createSetValueAutomationEvent,h.createSetValueCurveAutomationEvent,Ir,sw);var gw;const eS=((g,s,o,u,p,v,C,_)=>class extends g{constructor(E,T){const I=v(E),M={...Dt,...T},L=p(I,M),k=C(I),q=k?s():null;super(E,!1,L,q),this._audioBufferSourceNodeRenderer=q,this._isBufferNullified=!1,this._isBufferSet=M.buffer!==null,this._nativeAudioBufferSourceNode=L,this._onended=null,this._playbackRate=o(this,k,L.playbackRate,Vt,$t)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(E){if(this._nativeAudioBufferSourceNode.buffer=E,E!==null){if(this._isBufferSet)throw u();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(E){this._nativeAudioBufferSourceNode.loop=E}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(E){this._nativeAudioBufferSourceNode.loopEnd=E}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(E){this._nativeAudioBufferSourceNode.loopStart=E}get onended(){return this._onended}set onended(E){const T=typeof E=="function"?_(this,E):null;this._nativeAudioBufferSourceNode.onended=T;const I=this._nativeAudioBufferSourceNode.onended;this._onended=I!==null&&I===T?E:I}get playbackRate(){return this._playbackRate}start(E=0,T=0,I){if(this._nativeAudioBufferSourceNode.start(E,T,I),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=I===void 0?[E,T]:[E,T,I]),this.context.state!=="closed"){wt(this);const M=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",M),Nt(this)&&Mt(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",M)}}stop(E=0){this._nativeAudioBufferSourceNode.stop(E),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=E)}})(on,tS,ri,bn,so,Ne,Me,eo),nS=((g,s,o,u,p,v,C,_)=>class extends g{constructor(E,T){const I=v(E),M=C(I),L=p(I,T,M);super(E,!1,L,M?(k=>{const q=new WeakMap;return{render(G,N){const X=q.get(N);return X!==void 0?Promise.resolve(X):(async($,W)=>{const At=W.destination;return q.set(W,At),await k($,W,At),At})(G,N)}}})(_):null),this._isNodeOfNativeOfflineAudioContext=M,this._nativeAudioDestinationNode=L}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(E){if(this._isNodeOfNativeOfflineAudioContext)throw u();if(E>this._nativeAudioDestinationNode.maxChannelCount)throw o();this._nativeAudioDestinationNode.channelCount=E}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(E){if(this._isNodeOfNativeOfflineAudioContext)throw u();this._nativeAudioDestinationNode.channelCountMode=E}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(on,0,vt,bn,((g,s)=>(o,u,p)=>{const v=o.destination;if(v.channelCount!==u)try{v.channelCount=u}catch{}p&&v.channelCountMode!=="explicit"&&(v.channelCountMode="explicit"),v.maxChannelCount===0&&Object.defineProperty(v,"maxChannelCount",{value:u});const C=g(o,{channelCount:u,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});return s(C,"channelCount",(_=>()=>_.call(C)),(_=>E=>{_.call(C,E);try{v.channelCount=E}catch(T){if(E>v.maxChannelCount)throw T}})),s(C,"channelCountMode",(_=>()=>_.call(C)),(_=>E=>{_.call(C,E),v.channelCountMode=E})),s(C,"channelInterpretation",(_=>()=>_.call(C)),(_=>E=>{_.call(C,E),v.channelInterpretation=E})),Object.defineProperty(C,"maxChannelCount",{get:()=>v.maxChannelCount}),C.connect(v),C})(ps,Ca),Ne,Me,Qn),sS=((g,s,o,u,p)=>()=>{const v=new WeakMap;return{render(C,_){const E=v.get(_);return E!==void 0?Promise.resolve(E):(async(T,I)=>{let M=o(T);const L=st(M,I);if(!L){const k={Q:M.Q.value,channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation,detune:M.detune.value,frequency:M.frequency.value,gain:M.gain.value,type:M.type};M=s(I,k)}return v.set(I,M),L?(await g(I,T.Q,M.Q),await g(I,T.detune,M.detune),await g(I,T.frequency,M.frequency),await g(I,T.gain,M.gain)):(await u(I,T.Q,M.Q),await u(I,T.detune,M.detune),await u(I,T.frequency,M.frequency),await u(I,T.gain,M.gain)),await p(T,I,M),M})(C,_)}}})(xi,Jg,Zt,Ei,Qn),pA=(g=>(s,o)=>g.set(s,o))(Aw),iS=((g,s,o,u,p,v,C,_)=>class extends g{constructor(E,T){const I=v(E),M={...T_,...T},L=p(I,M),k=C(I);super(E,!1,L,k?o():null),this._Q=s(this,k,L.Q,Vt,$t),this._detune=s(this,k,L.detune,1200*Math.log2(Vt),-1200*Math.log2(Vt)),this._frequency=s(this,k,L.frequency,E.sampleRate/2,0),this._gain=s(this,k,L.gain,40*Math.log10(Vt),$t),this._nativeBiquadFilterNode=L,_(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(E){this._nativeBiquadFilterNode.type=E}getFrequencyResponse(E,T,I){try{this._nativeBiquadFilterNode.getFrequencyResponse(E,T,I)}catch(M){throw M.code===11?u():M}if(E.length!==T.length||T.length!==I.length)throw u()}})(on,ri,sS,Cc,Jg,Ne,Me,pA),Mr=((g,s)=>(o,u,p)=>{const v=new Set;return o.connect=(C=>(_,E=0,T=0)=>{const I=v.size===0;if(s(_))return C.call(o,_,E,T),g(v,[_,E,T],(M=>M[0]===_&&M[1]===E&&M[2]===T),!0),I&&u(),_;C.call(o,_,E),g(v,[_,E],(M=>M[0]===_&&M[1]===E),!0),I&&u()})(o.connect),o.disconnect=(C=>(_,E,T)=>{const I=v.size>0;if(_===void 0)C.apply(o),v.clear();else if(typeof _=="number"){C.call(o,_);for(const L of v)L[1]===_&&v.delete(L)}else{s(_)?C.call(o,_,E,T):C.call(o,_,E);for(const L of v)L[0]!==_||E!==void 0&&L[1]!==E||T!==void 0&&L[2]!==T||v.delete(L)}const M=v.size===0;I&&M&&p()})(o.disconnect),o})(Z,od),rS=((g,s)=>(o,u)=>{u.channelCount=1,u.channelCountMode="explicit",Object.defineProperty(u,"channelCount",{get:()=>1,set:()=>{throw g()}}),Object.defineProperty(u,"channelCountMode",{get:()=>"explicit",set:()=>{throw g()}});const p=o.createBufferSource();s(u,(()=>{const v=u.numberOfInputs;for(let C=0;C<v;C+=1)p.connect(u,0,C)}),(()=>p.disconnect(u)))})(bn,Mr),Qr=((g,s)=>(o,u)=>{const p=o.createChannelMerger(u.numberOfInputs);return g!==null&&g.name==="webkitAudioContext"&&s(o,p),gn(p,u),p})(Ir,rS),AS=((g,s,o)=>()=>{const u=new WeakMap;return{render(p,v){const C=u.get(v);return C!==void 0?Promise.resolve(C):(async(_,E)=>{let T=s(_);if(!st(T,E)){const I={channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,numberOfInputs:T.numberOfInputs};T=g(E,I)}return u.set(E,T),await o(_,E,T),T})(p,v)}}})(Qr,Zt,Qn),oS=((g,s,o,u,p)=>class extends g{constructor(v,C){const _=u(v),E={...F_,...C};super(v,!1,o(_,E),p(_)?s():null)}})(on,AS,Qr,Ne,Me),aS=((g,s,o)=>()=>{const u=new WeakMap;return{render(p,v){const C=u.get(v);return C!==void 0?Promise.resolve(C):(async(_,E)=>{let T=s(_);if(!st(T,E)){const I={channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,numberOfOutputs:T.numberOfOutputs};T=g(E,I)}return u.set(E,T),await o(_,E,T),T})(p,v)}}})(Ba,Zt,Qn),lS=((g,s,o,u,p)=>class extends g{constructor(v,C){const _=u(v),E=(T=>({...T,channelCount:T.numberOfOutputs}))({...I_,...C});super(v,!1,o(_,E),p(_)?s():null)}})(on,aS,Ba,Ne,Me),cS=((g,s,o,u)=>(p,{offset:v,...C})=>{const _=p.createBuffer(1,2,44100),E=s(p,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),T=o(p,{...C,gain:v}),I=_.getChannelData(0);I[0]=1,I[1]=1,E.buffer=_,E.loop=!0;const M={get bufferSize(){},get channelCount(){return T.channelCount},set channelCount(L){T.channelCount=L},get channelCountMode(){return T.channelCountMode},set channelCountMode(L){T.channelCountMode=L},get channelInterpretation(){return T.channelInterpretation},set channelInterpretation(L){T.channelInterpretation=L},get context(){return T.context},get inputs(){return[]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return T.numberOfOutputs},get offset(){return T.gain},get onended(){return E.onended},set onended(L){E.onended=L},addEventListener:(...L)=>E.addEventListener(L[0],L[1],L[2]),dispatchEvent:(...L)=>E.dispatchEvent(L[0]),removeEventListener:(...L)=>E.removeEventListener(L[0],L[1],L[2]),start(L=0){E.start.call(E,L)},stop(L=0){E.stop.call(E,L)}};return g(p,E),u(to(M,T),(()=>E.connect(T)),(()=>E.disconnect(T)))})(_c,so,ps,Mr),io=((g,s,o,u,p)=>(v,C)=>{if(v.createConstantSource===void 0)return o(v,C);const _=v.createConstantSource();return gn(_,C),en(_,C,"offset"),s(u,(()=>u(v)))||ed(_),s(p,(()=>p(v)))||nd(_),g(v,_),_})(_c,Vs,cS,sd,id),uS=((g,s,o,u,p)=>()=>{const v=new WeakMap;let C=null,_=null;return{set start(E){C=E},set stop(E){_=E},render(E,T){const I=v.get(T);return I!==void 0?Promise.resolve(I):(async(M,L)=>{let k=o(M);const q=st(k,L);if(!q){const G={channelCount:k.channelCount,channelCountMode:k.channelCountMode,channelInterpretation:k.channelInterpretation,offset:k.offset.value};k=s(L,G),C!==null&&k.start(C),_!==null&&k.stop(_)}return v.set(L,k),q?await g(L,M.offset,k.offset):await u(L,M.offset,k.offset),await p(M,L,k),k})(E,T)}}})(xi,io,Zt,Ei,Qn),hS=((g,s,o,u,p,v,C)=>class extends g{constructor(_,E){const T=p(_),I={...M_,...E},M=u(T,I),L=v(T),k=L?o():null;super(_,!1,M,k),this._constantSourceNodeRenderer=k,this._nativeConstantSourceNode=M,this._offset=s(this,L,M.offset,Vt,$t),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(_){const E=typeof _=="function"?C(this,_):null;this._nativeConstantSourceNode.onended=E;const T=this._nativeConstantSourceNode.onended;this._onended=T!==null&&T===E?_:T}start(_=0){if(this._nativeConstantSourceNode.start(_),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=_),this.context.state!=="closed"){wt(this);const E=()=>{this._nativeConstantSourceNode.removeEventListener("ended",E),Nt(this)&&Mt(this)};this._nativeConstantSourceNode.addEventListener("ended",E)}}stop(_=0){this._nativeConstantSourceNode.stop(_),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=_)}})(on,ri,uS,io,Ne,Me,eo),ww=((g,s)=>(o,u)=>{const p=o.createConvolver();if(gn(p,u),u.disableNormalization===p.normalize&&(p.normalize=!u.disableNormalization),$e(p,u,"buffer"),u.channelCount>2||(s(p,"channelCount",(v=>()=>v.call(p)),(v=>C=>{if(C>2)throw g();return v.call(p,C)})),u.channelCountMode==="max"))throw g();return s(p,"channelCountMode",(v=>()=>v.call(p)),(v=>C=>{if(C==="max")throw g();return v.call(p,C)})),p})(ts,Ca),dS=((g,s,o)=>()=>{const u=new WeakMap;return{render(p,v){const C=u.get(v);return C!==void 0?Promise.resolve(C):(async(_,E)=>{let T=s(_);if(!st(T,E)){const I={buffer:T.buffer,channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,disableNormalization:!T.normalize};T=g(E,I)}return u.set(E,T),Bt(T)?await o(_,E,T.inputs[0]):await o(_,E,T),T})(p,v)}}})(ww,Zt,Qn),fS=((g,s,o,u,p,v)=>class extends g{constructor(C,_){const E=u(C),T={...Q_,..._},I=o(E,T);super(C,!1,I,p(E)?s():null),this._isBufferNullified=!1,this._nativeConvolverNode=I,T.buffer!==null&&v(this,T.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(C){if(this._nativeConvolverNode.buffer=C,C===null&&this._nativeConvolverNode.buffer!==null){const _=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=_.createBuffer(1,1,_.sampleRate),this._isBufferNullified=!0,v(this,0)}else this._isBufferNullified=!1,v(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(C){this._nativeConvolverNode.normalize=C}})(on,dS,ww,Ne,Me,pA),pS=((g,s,o,u,p)=>v=>{const C=new WeakMap;return{render(_,E){const T=C.get(E);return T!==void 0?Promise.resolve(T):(async(I,M)=>{let L=o(I);const k=st(L,M);if(!k){const q={channelCount:L.channelCount,channelCountMode:L.channelCountMode,channelInterpretation:L.channelInterpretation,delayTime:L.delayTime.value,maxDelayTime:v};L=s(M,q)}return C.set(M,L),k?await g(M,I.delayTime,L.delayTime):await u(M,I.delayTime,L.delayTime),await p(I,M,L),L})(_,E)}}})(xi,Zg,Zt,Ei,Qn),mS=((g,s,o,u,p,v,C)=>class extends g{constructor(_,E){const T=p(_),I={...U_,...E},M=u(T,I),L=v(T);super(_,!1,M,L?o(I.maxDelayTime):null),this._delayTime=s(this,L,M.delayTime),C(this,I.maxDelayTime)}get delayTime(){return this._delayTime}})(on,ri,pS,Zg,Ne,Me,pA),vw=(g=>(s,o)=>{const u=s.createDynamicsCompressor();if(gn(u,o),o.channelCount>2||o.channelCountMode==="max")throw g();return en(u,o,"attack"),en(u,o,"knee"),en(u,o,"ratio"),en(u,o,"release"),en(u,o,"threshold"),u})(ts),gS=((g,s,o,u,p)=>()=>{const v=new WeakMap;return{render(C,_){const E=v.get(_);return E!==void 0?Promise.resolve(E):(async(T,I)=>{let M=o(T);const L=st(M,I);if(!L){const k={attack:M.attack.value,channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation,knee:M.knee.value,ratio:M.ratio.value,release:M.release.value,threshold:M.threshold.value};M=s(I,k)}return v.set(I,M),L?(await g(I,T.attack,M.attack),await g(I,T.knee,M.knee),await g(I,T.ratio,M.ratio),await g(I,T.release,M.release),await g(I,T.threshold,M.threshold)):(await u(I,T.attack,M.attack),await u(I,T.knee,M.knee),await u(I,T.ratio,M.ratio),await u(I,T.release,M.release),await u(I,T.threshold,M.threshold)),await p(T,I,M),M})(C,_)}}})(xi,vw,Zt,Ei,Qn),wS=((g,s,o,u,p,v,C,_)=>class extends g{constructor(E,T){const I=v(E),M={...P_,...T},L=u(I,M),k=C(I);super(E,!1,L,k?o():null),this._attack=s(this,k,L.attack),this._knee=s(this,k,L.knee),this._nativeDynamicsCompressorNode=L,this._ratio=s(this,k,L.ratio),this._release=s(this,k,L.release),this._threshold=s(this,k,L.threshold),_(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(E){const T=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=E,E>2)throw this._nativeDynamicsCompressorNode.channelCount=T,p()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(E){const T=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=E,E==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=T,p()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(on,ri,gS,vw,ts,Ne,Me,pA),vS=((g,s,o,u,p)=>()=>{const v=new WeakMap;return{render(C,_){const E=v.get(_);return E!==void 0?Promise.resolve(E):(async(T,I)=>{let M=o(T);const L=st(M,I);if(!L){const k={channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation,gain:M.gain.value};M=s(I,k)}return v.set(I,M),L?await g(I,T.gain,M.gain):await u(I,T.gain,M.gain),await p(T,I,M),M})(C,_)}}})(xi,ps,Zt,Ei,Qn),BS=((g,s,o,u,p,v)=>class extends g{constructor(C,_){const E=p(C),T={...D_,..._},I=u(E,T),M=v(E);super(C,!1,I,M?o():null),this._gain=s(this,M,I.gain,Vt,$t)}get gain(){return this._gain}})(on,ri,vS,ps,Ne,Me),yS=((g,s,o,u)=>(p,v,{channelCount:C,channelCountMode:_,channelInterpretation:E,feedback:T,feedforward:I})=>{const M=jg(v,p.sampleRate),L=T instanceof Float64Array?T:new Float64Array(T),k=I instanceof Float64Array?I:new Float64Array(I),q=L.length,G=k.length,N=Math.min(q,G);if(q===0||q>20)throw u();if(L[0]===0)throw s();if(G===0||G>20)throw u();if(k[0]===0)throw s();if(L[0]!==1){for(let j=0;j<G;j+=1)k[j]/=L[0];for(let j=1;j<q;j+=1)L[j]/=L[0]}const X=o(p,M,C,C);X.channelCount=C,X.channelCountMode=_,X.channelInterpretation=E;const $=[],W=[],At=[];for(let j=0;j<C;j+=1){$.push(0);const nt=new Float32Array(32),Y=new Float32Array(32);nt.fill(0),Y.fill(0),W.push(nt),At.push(Y)}X.onaudioprocess=j=>{const nt=j.inputBuffer,Y=j.outputBuffer,dt=nt.numberOfChannels;for(let tt=0;tt<dt;tt+=1){const ct=nt.getChannelData(tt),bt=Y.getChannelData(tt);$[tt]=Xg(L,q,k,G,N,W[tt],At[tt],$[tt],32,ct,bt)}};const ht=p.sampleRate/2;return to({get bufferSize(){return M},get channelCount(){return X.channelCount},set channelCount(j){X.channelCount=j},get channelCountMode(){return X.channelCountMode},set channelCountMode(j){X.channelCountMode=j},get channelInterpretation(){return X.channelInterpretation},set channelInterpretation(j){X.channelInterpretation=j},get context(){return X.context},get inputs(){return[X]},get numberOfInputs(){return X.numberOfInputs},get numberOfOutputs(){return X.numberOfOutputs},addEventListener:(...j)=>X.addEventListener(j[0],j[1],j[2]),dispatchEvent:(...j)=>X.dispatchEvent(j[0]),getFrequencyResponse(j,nt,Y){if(j.length!==nt.length||nt.length!==Y.length)throw g();const dt=j.length;for(let tt=0;tt<dt;tt+=1){const ct=-Math.PI*(j[tt]/ht),bt=[Math.cos(ct),Math.sin(ct)],_t=R_(tw(k,bt),tw(L,bt));nt[tt]=Math.sqrt(_t[0]*_t[0]+_t[1]*_t[1]),Y[tt]=Math.atan2(_t[1],_t[0])}},removeEventListener:(...j)=>X.removeEventListener(j[0],j[1],j[2])},X)})(Cc,bn,ya,ts),Sc=((g,s,o,u)=>p=>g(va,(()=>va(p)))?Promise.resolve(g(u,u)).then((v=>{if(!v){const C=o(p,512,0,1);p.oncomplete=()=>{C.onaudioprocess=null,C.disconnect()},C.onaudioprocess=()=>p.currentTime,C.connect(p.destination)}return p.startRendering()})):new Promise((v=>{const C=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});p.oncomplete=_=>{C.disconnect(),v(_.renderedBuffer)},C.connect(p.destination),p.startRendering()})))(Vs,ps,ya,((g,s)=>()=>{if(s===null)return Promise.resolve(!1);const o=new s(1,1,44100),u=g(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((p=>{o.oncomplete=()=>{u.disconnect(),p(o.currentTime!==0)},o.startRendering()}))})(ps,_n)),CS=((g,s,o,u,p)=>(v,C)=>{const _=new WeakMap;let E=null;return{render(T,I){const M=_.get(I);return M!==void 0?Promise.resolve(M):(async(L,k)=>{let q=null,G=s(L);const N=st(G,k);if(k.createIIRFilter===void 0?q=g(k,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):N||(G=k.createIIRFilter(C,v)),_.set(k,q===null?G:q),q!==null){if(E===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const $=new o(L.context.destination.channelCount,L.context.length,k.sampleRate);E=(async()=>(await u(L,$,$.destination),((W,At,ht,j)=>{const nt=ht instanceof Float64Array?ht:new Float64Array(ht),Y=j instanceof Float64Array?j:new Float64Array(j),dt=nt.length,tt=Y.length,ct=Math.min(dt,tt);if(nt[0]!==1){for(let Rt=0;Rt<dt;Rt+=1)Y[Rt]/=nt[0];for(let Rt=1;Rt<tt;Rt+=1)nt[Rt]/=nt[0]}const bt=new Float32Array(32),_t=new Float32Array(32),Jt=At.createBuffer(W.numberOfChannels,W.length,W.sampleRate),Ot=W.numberOfChannels;for(let Rt=0;Rt<Ot;Rt+=1){const ee=W.getChannelData(Rt),Pt=Jt.getChannelData(Rt);bt.fill(0),_t.fill(0),Xg(nt,dt,Y,tt,ct,bt,_t,0,32,ee,Pt)}return Jt})(await p($),k,v,C)))()}const X=await E;return q.buffer=X,q.start(0),q}return await u(L,k,G),G})(T,I)}}})(so,Zt,_n,Qn,Sc),bS=(g=>(s,o,u)=>{if(s.createIIRFilter===void 0)return g(s,o,u);const p=s.createIIRFilter(u.feedforward,u.feedback);return gn(p,u),p})(yS),_S=((g,s,o,u,p,v)=>class extends g{constructor(C,_){const E=u(C),T=p(E),I={...k_,..._},M=s(E,T?null:C.baseLatency,I);super(C,!1,M,T?o(I.feedback,I.feedforward):null),(L=>{var k;L.getFrequencyResponse=(k=L.getFrequencyResponse,(q,G,N)=>{if(q.length!==G.length||G.length!==N.length)throw Cc();return k.call(L,q,G,N)})})(M),this._nativeIIRFilterNode=M,v(this,1)}getFrequencyResponse(C,_,E){return this._nativeIIRFilterNode.getFrequencyResponse(C,_,E)}})(on,bS,CS,Ne,Me,pA),SS=((g,s,o,u,p,v,C,_)=>(E,T)=>{const I=T.listener,{forwardX:M,forwardY:L,forwardZ:k,positionX:q,positionY:G,positionZ:N,upX:X,upY:$,upZ:W}=I.forwardX===void 0?(()=>{const At=new Float32Array(1),ht=s(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),j=C(T);let nt=!1,Y=[0,0,-1,0,1,0],dt=[0,0,0];const tt=()=>{if(nt)return;nt=!0;const Jt=u(T,256,9,0);Jt.onaudioprocess=({inputBuffer:Ot})=>{const Rt=[v(Ot,At,0),v(Ot,At,1),v(Ot,At,2),v(Ot,At,3),v(Ot,At,4),v(Ot,At,5)];Rt.some(((Pt,se)=>Pt!==Y[se]))&&(I.setOrientation(...Rt),Y=Rt);const ee=[v(Ot,At,6),v(Ot,At,7),v(Ot,At,8)];ee.some(((Pt,se)=>Pt!==dt[se]))&&(I.setPosition(...ee),dt=ee)},ht.connect(Jt)},ct=Jt=>Ot=>{Ot!==Y[Jt]&&(Y[Jt]=Ot,I.setOrientation(...Y))},bt=Jt=>Ot=>{Ot!==dt[Jt]&&(dt[Jt]=Ot,I.setPosition(...dt))},_t=(Jt,Ot,Rt)=>{const ee=o(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Ot});ee.connect(ht,0,Jt),ee.start(),Object.defineProperty(ee.offset,"defaultValue",{get:()=>Ot});const Pt=g({context:E},j,ee.offset,Vt,$t);var se,he,we,We,sn,gs,ue;return _(Pt,"value",(Qt=>()=>Qt.call(Pt)),(Qt=>He=>{try{Qt.call(Pt,He)}catch(Ee){if(Ee.code!==9)throw Ee}tt(),j&&Rt(He)})),Pt.cancelAndHoldAtTime=(se=Pt.cancelAndHoldAtTime,j?()=>{throw p()}:(...Qt)=>{const He=se.apply(Pt,Qt);return tt(),He}),Pt.cancelScheduledValues=(he=Pt.cancelScheduledValues,j?()=>{throw p()}:(...Qt)=>{const He=he.apply(Pt,Qt);return tt(),He}),Pt.exponentialRampToValueAtTime=(we=Pt.exponentialRampToValueAtTime,j?()=>{throw p()}:(...Qt)=>{const He=we.apply(Pt,Qt);return tt(),He}),Pt.linearRampToValueAtTime=(We=Pt.linearRampToValueAtTime,j?()=>{throw p()}:(...Qt)=>{const He=We.apply(Pt,Qt);return tt(),He}),Pt.setTargetAtTime=(sn=Pt.setTargetAtTime,j?()=>{throw p()}:(...Qt)=>{const He=sn.apply(Pt,Qt);return tt(),He}),Pt.setValueAtTime=(gs=Pt.setValueAtTime,j?()=>{throw p()}:(...Qt)=>{const He=gs.apply(Pt,Qt);return tt(),He}),Pt.setValueCurveAtTime=(ue=Pt.setValueCurveAtTime,j?()=>{throw p()}:(...Qt)=>{const He=ue.apply(Pt,Qt);return tt(),He}),Pt};return{forwardX:_t(0,0,ct(0)),forwardY:_t(1,0,ct(1)),forwardZ:_t(2,-1,ct(2)),positionX:_t(6,0,bt(0)),positionY:_t(7,0,bt(1)),positionZ:_t(8,0,bt(2)),upX:_t(3,0,ct(3)),upY:_t(4,1,ct(4)),upZ:_t(5,0,ct(5))}})():I;return{get forwardX(){return M},get forwardY(){return L},get forwardZ(){return k},get positionX(){return q},get positionY(){return G},get positionZ(){return N},get upX(){return X},get upY(){return $},get upZ(){return W}}})(ri,Qr,io,ya,ts,ew,Me,Ca),Bw=new WeakMap,xS=((g,s,o,u,p,v)=>class extends o{constructor(C,_){super(C),this._nativeContext=C,b.set(this,C),u(C)&&p.set(C,new Set),this._destination=new g(this,_),this._listener=s(this,C),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(C){const _=typeof C=="function"?v(this,C):null;this._nativeContext.onstatechange=_;const E=this._nativeContext.onstatechange;this._onstatechange=E!==null&&E===_?C:E}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(nS,SS,cw,Me,Bw,eo),yw=((g,s,o,u,p,v)=>(C,_)=>{const E=C.createOscillator();return gn(E,_),en(E,_,"detune"),en(E,_,"frequency"),_.periodicWave!==void 0?E.setPeriodicWave(_.periodicWave):$e(E,_,"type"),s(o,(()=>o(C)))||ed(E),s(u,(()=>u(C)))||v(E,C),s(p,(()=>p(C)))||nd(E),g(C,E),E})(_c,Vs,sd,iw,id,rw),ES=((g,s,o,u,p)=>()=>{const v=new WeakMap;let C=null,_=null,E=null;return{set periodicWave(T){C=T},set start(T){_=T},set stop(T){E=T},render(T,I){const M=v.get(I);return M!==void 0?Promise.resolve(M):(async(L,k)=>{let q=o(L);const G=st(q,k);if(!G){const N={channelCount:q.channelCount,channelCountMode:q.channelCountMode,channelInterpretation:q.channelInterpretation,detune:q.detune.value,frequency:q.frequency.value,periodicWave:C===null?void 0:C,type:q.type};q=s(k,N),_!==null&&q.start(_),E!==null&&q.stop(E)}return v.set(k,q),G?(await g(k,L.detune,q.detune),await g(k,L.frequency,q.frequency)):(await u(k,L.detune,q.detune),await u(k,L.frequency,q.frequency)),await p(L,k,q),q})(T,I)}}})(xi,yw,Zt,Ei,Qn),TS=((g,s,o,u,p,v,C)=>class extends g{constructor(_,E){const T=p(_),I={...N_,...E},M=o(T,I),L=v(T),k=L?u():null,q=_.sampleRate/2;super(_,!1,M,k),this._detune=s(this,L,M.detune,153600,-153600),this._frequency=s(this,L,M.frequency,q,-q),this._nativeOscillatorNode=M,this._onended=null,this._oscillatorNodeRenderer=k,this._oscillatorNodeRenderer!==null&&I.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=I.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(_){const E=typeof _=="function"?C(this,_):null;this._nativeOscillatorNode.onended=E;const T=this._nativeOscillatorNode.onended;this._onended=T!==null&&T===E?_:T}get type(){return this._nativeOscillatorNode.type}set type(_){this._nativeOscillatorNode.type=_,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(_){this._nativeOscillatorNode.setPeriodicWave(_),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=_)}start(_=0){if(this._nativeOscillatorNode.start(_),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=_),this.context.state!=="closed"){wt(this);const E=()=>{this._nativeOscillatorNode.removeEventListener("ended",E),Nt(this)&&Mt(this)};this._nativeOscillatorNode.addEventListener("ended",E)}}stop(_=0){this._nativeOscillatorNode.stop(_),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=_)}})(on,ri,yw,ES,Ne,Me,eo),Cw=(g=>(s,o)=>{const u=g(s,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),p=s.createBuffer(1,2,44100);return u.buffer=p,u.loop=!0,u.connect(o),u.start(),()=>{u.stop(),u.disconnect(o)}})(so),FS=((g,s,o,u,p)=>(v,{curve:C,oversample:_,...E})=>{const T=v.createWaveShaper(),I=v.createWaveShaper();gn(T,E),gn(I,E);const M=o(v,{...E,gain:1}),L=o(v,{...E,gain:-1}),k=o(v,{...E,gain:1}),q=o(v,{...E,gain:-1});let G=null,N=!1,X=null;const $={get bufferSize(){},get channelCount(){return T.channelCount},set channelCount(W){M.channelCount=W,L.channelCount=W,T.channelCount=W,k.channelCount=W,I.channelCount=W,q.channelCount=W},get channelCountMode(){return T.channelCountMode},set channelCountMode(W){M.channelCountMode=W,L.channelCountMode=W,T.channelCountMode=W,k.channelCountMode=W,I.channelCountMode=W,q.channelCountMode=W},get channelInterpretation(){return T.channelInterpretation},set channelInterpretation(W){M.channelInterpretation=W,L.channelInterpretation=W,T.channelInterpretation=W,k.channelInterpretation=W,I.channelInterpretation=W,q.channelInterpretation=W},get context(){return T.context},get curve(){return X},set curve(W){if(W!==null&&W.length<2)throw s();if(W===null)T.curve=W,I.curve=W;else{const At=W.length,ht=new Float32Array(At+2-At%2),j=new Float32Array(At+2-At%2);ht[0]=W[0],j[0]=-W[At-1];const nt=Math.ceil((At+1)/2),Y=(At+1)/2-1;for(let dt=1;dt<nt;dt+=1){const tt=dt/nt*Y,ct=Math.floor(tt),bt=Math.ceil(tt);ht[dt]=ct===bt?W[ct]:(1-(tt-ct))*W[ct]+(1-(bt-tt))*W[bt],j[dt]=ct===bt?-W[At-1-ct]:-(1-(tt-ct))*W[At-1-ct]-(1-(bt-tt))*W[At-1-bt]}ht[nt]=At%2==1?W[nt-1]:(W[nt-2]+W[nt-1])/2,T.curve=ht,I.curve=j}X=W,N&&(u(X)&&G===null?G=g(v,M):G!==null&&(G(),G=null))},get inputs(){return[M]},get numberOfInputs(){return T.numberOfInputs},get numberOfOutputs(){return T.numberOfOutputs},get oversample(){return T.oversample},set oversample(W){T.oversample=W,I.oversample=W},addEventListener:(...W)=>M.addEventListener(W[0],W[1],W[2]),dispatchEvent:(...W)=>M.dispatchEvent(W[0]),removeEventListener:(...W)=>M.removeEventListener(W[0],W[1],W[2])};return C!==null&&($.curve=C instanceof Float32Array?C:new Float32Array(C)),_!==$.oversample&&($.oversample=_),p(to($,k),(()=>{M.connect(T).connect(k),M.connect(L).connect(I).connect(q).connect(k),N=!0,u(X)&&(G=g(v,M))}),(()=>{M.disconnect(T),T.disconnect(k),M.disconnect(L),L.disconnect(I),I.disconnect(q),q.disconnect(k),N=!1,G!==null&&(G(),G=null)}))})(Cw,bn,ps,nw,Mr),xc=((g,s,o,u,p,v,C)=>(_,E)=>{const T=_.createWaveShaper();if(v!==null&&v.name==="webkitAudioContext"&&_.createGain().gain.automationRate===void 0)return o(_,E);gn(T,E);const I=E.curve===null||E.curve instanceof Float32Array?E.curve:new Float32Array(E.curve);if(I!==null&&I.length<2)throw s();$e(T,{curve:I},"curve"),$e(T,E,"oversample");let M=null,L=!1;return C(T,"curve",(k=>()=>k.call(T)),(k=>q=>(k.call(T,q),L&&(u(q)&&M===null?M=g(_,T):u(q)||M===null||(M(),M=null)),q))),p(T,(()=>{L=!0,u(T.curve)&&(M=g(_,T))}),(()=>{L=!1,M!==null&&(M(),M=null)}))})(Cw,bn,FS,nw,Mr,Ir,Ca),IS=((g,s,o,u,p,v,C,_,E,T)=>(I,{coneInnerAngle:M,coneOuterAngle:L,coneOuterGain:k,distanceModel:q,maxDistance:G,orientationX:N,orientationY:X,orientationZ:$,panningModel:W,positionX:At,positionY:ht,positionZ:j,refDistance:nt,rolloffFactor:Y,...dt})=>{const tt=I.createPanner();if(dt.channelCount>2||dt.channelCountMode==="max")throw C();gn(tt,dt);const ct={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},bt=o(I,{...ct,channelInterpretation:"speakers",numberOfInputs:6}),_t=u(I,{...dt,gain:1}),Jt=u(I,{...ct,gain:1}),Ot=u(I,{...ct,gain:0}),Rt=u(I,{...ct,gain:0}),ee=u(I,{...ct,gain:0}),Pt=u(I,{...ct,gain:0}),se=u(I,{...ct,gain:0}),he=p(I,256,6,1),we=v(I,{...ct,curve:new Float32Array([1,1]),oversample:"none"});let We=[N,X,$],sn=[At,ht,j];const gs=new Float32Array(1);he.onaudioprocess=({inputBuffer:Qt})=>{const He=[E(Qt,gs,0),E(Qt,gs,1),E(Qt,gs,2)];He.some(((Ln,Or)=>Ln!==We[Or]))&&(tt.setOrientation(...He),We=He);const Ee=[E(Qt,gs,3),E(Qt,gs,4),E(Qt,gs,5)];Ee.some(((Ln,Or)=>Ln!==sn[Or]))&&(tt.setPosition(...Ee),sn=Ee)},Object.defineProperty(Ot.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Rt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ee.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Pt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(se.gain,"defaultValue",{get:()=>0});const ue={get bufferSize(){},get channelCount(){return tt.channelCount},set channelCount(Qt){if(Qt>2)throw C();_t.channelCount=Qt,tt.channelCount=Qt},get channelCountMode(){return tt.channelCountMode},set channelCountMode(Qt){if(Qt==="max")throw C();_t.channelCountMode=Qt,tt.channelCountMode=Qt},get channelInterpretation(){return tt.channelInterpretation},set channelInterpretation(Qt){_t.channelInterpretation=Qt,tt.channelInterpretation=Qt},get coneInnerAngle(){return tt.coneInnerAngle},set coneInnerAngle(Qt){tt.coneInnerAngle=Qt},get coneOuterAngle(){return tt.coneOuterAngle},set coneOuterAngle(Qt){tt.coneOuterAngle=Qt},get coneOuterGain(){return tt.coneOuterGain},set coneOuterGain(Qt){if(Qt<0||Qt>1)throw s();tt.coneOuterGain=Qt},get context(){return tt.context},get distanceModel(){return tt.distanceModel},set distanceModel(Qt){tt.distanceModel=Qt},get inputs(){return[_t]},get maxDistance(){return tt.maxDistance},set maxDistance(Qt){if(Qt<0)throw new RangeError;tt.maxDistance=Qt},get numberOfInputs(){return tt.numberOfInputs},get numberOfOutputs(){return tt.numberOfOutputs},get orientationX(){return Jt.gain},get orientationY(){return Ot.gain},get orientationZ(){return Rt.gain},get panningModel(){return tt.panningModel},set panningModel(Qt){tt.panningModel=Qt},get positionX(){return ee.gain},get positionY(){return Pt.gain},get positionZ(){return se.gain},get refDistance(){return tt.refDistance},set refDistance(Qt){if(Qt<0)throw new RangeError;tt.refDistance=Qt},get rolloffFactor(){return tt.rolloffFactor},set rolloffFactor(Qt){if(Qt<0)throw new RangeError;tt.rolloffFactor=Qt},addEventListener:(...Qt)=>_t.addEventListener(Qt[0],Qt[1],Qt[2]),dispatchEvent:(...Qt)=>_t.dispatchEvent(Qt[0]),removeEventListener:(...Qt)=>_t.removeEventListener(Qt[0],Qt[1],Qt[2])};return M!==ue.coneInnerAngle&&(ue.coneInnerAngle=M),L!==ue.coneOuterAngle&&(ue.coneOuterAngle=L),k!==ue.coneOuterGain&&(ue.coneOuterGain=k),q!==ue.distanceModel&&(ue.distanceModel=q),G!==ue.maxDistance&&(ue.maxDistance=G),N!==ue.orientationX.value&&(ue.orientationX.value=N),X!==ue.orientationY.value&&(ue.orientationY.value=X),$!==ue.orientationZ.value&&(ue.orientationZ.value=$),W!==ue.panningModel&&(ue.panningModel=W),At!==ue.positionX.value&&(ue.positionX.value=At),ht!==ue.positionY.value&&(ue.positionY.value=ht),j!==ue.positionZ.value&&(ue.positionZ.value=j),nt!==ue.refDistance&&(ue.refDistance=nt),Y!==ue.rolloffFactor&&(ue.rolloffFactor=Y),We[0]===1&&We[1]===0&&We[2]===0||tt.setOrientation(...We),sn[0]===0&&sn[1]===0&&sn[2]===0||tt.setPosition(...sn),T(to(ue,tt),(()=>{_t.connect(tt),g(_t,we,0,0),we.connect(Jt).connect(bt,0,0),we.connect(Ot).connect(bt,0,1),we.connect(Rt).connect(bt,0,2),we.connect(ee).connect(bt,0,3),we.connect(Pt).connect(bt,0,4),we.connect(se).connect(bt,0,5),bt.connect(he).connect(I.destination)}),(()=>{_t.disconnect(tt),_(_t,we,0,0),we.disconnect(Jt),Jt.disconnect(bt),we.disconnect(Ot),Ot.disconnect(bt),we.disconnect(Rt),Rt.disconnect(bt),we.disconnect(ee),ee.disconnect(bt),we.disconnect(Pt),Pt.disconnect(bt),we.disconnect(se),se.disconnect(bt),bt.disconnect(he),he.disconnect(I.destination)}))})(Ht,bn,Qr,ps,ya,xc,ts,Ce,ew,Mr),bw=(g=>(s,o)=>{const u=s.createPanner();return u.orientationX===void 0?g(s,o):(gn(u,o),en(u,o,"orientationX"),en(u,o,"orientationY"),en(u,o,"orientationZ"),en(u,o,"positionX"),en(u,o,"positionY"),en(u,o,"positionZ"),$e(u,o,"coneInnerAngle"),$e(u,o,"coneOuterAngle"),$e(u,o,"coneOuterGain"),$e(u,o,"distanceModel"),$e(u,o,"maxDistance"),$e(u,o,"panningModel"),$e(u,o,"refDistance"),$e(u,o,"rolloffFactor"),u)})(IS),MS=((g,s,o,u,p,v,C,_,E,T)=>()=>{const I=new WeakMap;let M=null;return{render(L,k){const q=I.get(k);return q!==void 0?Promise.resolve(q):(async(G,N)=>{let X=null,$=v(G);const W={channelCount:$.channelCount,channelCountMode:$.channelCountMode,channelInterpretation:$.channelInterpretation},At={...W,coneInnerAngle:$.coneInnerAngle,coneOuterAngle:$.coneOuterAngle,coneOuterGain:$.coneOuterGain,distanceModel:$.distanceModel,maxDistance:$.maxDistance,panningModel:$.panningModel,refDistance:$.refDistance,rolloffFactor:$.rolloffFactor},ht=st($,N);if("bufferSize"in $)X=u(N,{...W,gain:1});else if(!ht){const j={...At,orientationX:$.orientationX.value,orientationY:$.orientationY.value,orientationZ:$.orientationZ.value,positionX:$.positionX.value,positionY:$.positionY.value,positionZ:$.positionZ.value};$=p(N,j)}if(I.set(N,X===null?$:X),X!==null){if(M===null){if(C===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _t=new C(6,G.context.length,N.sampleRate),Jt=s(_t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});Jt.connect(_t.destination),M=(async()=>{const Ot=await Promise.all([G.orientationX,G.orientationY,G.orientationZ,G.positionX,G.positionY,G.positionZ].map((async(Rt,ee)=>{const Pt=o(_t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ee===0?1:0});return await _(_t,Rt,Pt.offset),Pt})));for(let Rt=0;Rt<6;Rt+=1)Ot[Rt].connect(Jt,0,Rt),Ot[Rt].start(0);return T(_t)})()}const j=await M,nt=u(N,{...W,gain:1});await E(G,N,nt);const Y=[];for(let _t=0;_t<j.numberOfChannels;_t+=1)Y.push(j.getChannelData(_t));let dt=[Y[0][0],Y[1][0],Y[2][0]],tt=[Y[3][0],Y[4][0],Y[5][0]],ct=u(N,{...W,gain:1}),bt=p(N,{...At,orientationX:dt[0],orientationY:dt[1],orientationZ:dt[2],positionX:tt[0],positionY:tt[1],positionZ:tt[2]});nt.connect(ct).connect(bt.inputs[0]),bt.connect(X);for(let _t=128;_t<j.length;_t+=128){const Jt=[Y[0][_t],Y[1][_t],Y[2][_t]],Ot=[Y[3][_t],Y[4][_t],Y[5][_t]];if(Jt.some(((Rt,ee)=>Rt!==dt[ee]))||Ot.some(((Rt,ee)=>Rt!==tt[ee]))){dt=Jt,tt=Ot;const Rt=_t/N.sampleRate;ct.gain.setValueAtTime(0,Rt),ct=u(N,{...W,gain:0}),bt=p(N,{...At,orientationX:dt[0],orientationY:dt[1],orientationZ:dt[2],positionX:tt[0],positionY:tt[1],positionZ:tt[2]}),ct.gain.setValueAtTime(1,Rt),nt.connect(ct).connect(bt.inputs[0]),bt.connect(X)}}return X}return ht?(await g(N,G.orientationX,$.orientationX),await g(N,G.orientationY,$.orientationY),await g(N,G.orientationZ,$.orientationZ),await g(N,G.positionX,$.positionX),await g(N,G.positionY,$.positionY),await g(N,G.positionZ,$.positionZ)):(await _(N,G.orientationX,$.orientationX),await _(N,G.orientationY,$.orientationY),await _(N,G.orientationZ,$.orientationZ),await _(N,G.positionX,$.positionX),await _(N,G.positionY,$.positionY),await _(N,G.positionZ,$.positionZ)),Bt($)?await E(G,N,$.inputs[0]):await E(G,N,$),$})(L,k)}}})(xi,Qr,io,ps,bw,Zt,_n,Ei,Qn,Sc),QS=((g,s,o,u,p,v,C)=>class extends g{constructor(_,E){const T=p(_),I={...O_,...E},M=o(T,I),L=v(T);super(_,!1,M,L?u():null),this._nativePannerNode=M,this._orientationX=s(this,L,M.orientationX,Vt,$t),this._orientationY=s(this,L,M.orientationY,Vt,$t),this._orientationZ=s(this,L,M.orientationZ,Vt,$t),this._positionX=s(this,L,M.positionX,Vt,$t),this._positionY=s(this,L,M.positionY,Vt,$t),this._positionZ=s(this,L,M.positionZ,Vt,$t),C(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(_){this._nativePannerNode.coneInnerAngle=_}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(_){this._nativePannerNode.coneOuterAngle=_}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(_){this._nativePannerNode.coneOuterGain=_}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(_){this._nativePannerNode.distanceModel=_}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(_){this._nativePannerNode.maxDistance=_}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(_){this._nativePannerNode.panningModel=_}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(_){this._nativePannerNode.refDistance=_}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(_){this._nativePannerNode.rolloffFactor=_}})(on,ri,bw,MS,Ne,Me,pA),US=(g=>(s,{disableNormalization:o,imag:u,real:p})=>{const v=u instanceof Float32Array?u:new Float32Array(u),C=p instanceof Float32Array?p:new Float32Array(p),_=s.createPeriodicWave(C,v,{disableNormalization:o});if(Array.from(u).length<2)throw g();return _})(vt),PS=((g,s,o)=>class Vy{constructor(p,v){const C=s(p),_=(T=>{const{imag:I,real:M}=T;return I===void 0?M===void 0?{...T,imag:[0,0],real:[0,0]}:{...T,imag:Array.from(M,(()=>0)),real:M}:M===void 0?{...T,imag:I,real:Array.from(I,(()=>0))}:{...T,imag:I,real:M}})({...V_,...v}),E=g(C,_);return o.add(E),E}static[Symbol.hasInstance](p){return p!==null&&typeof p=="object"&&Object.getPrototypeOf(p)===Vy.prototype||o.has(p)}})(US,Ne,new WeakSet),DS=((g,s,o,u,p,v)=>{const _=new Float32Array([1,1]),E=Math.PI/2,T={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},I={...T,oversample:"none"},M=(L,k,q,G,N)=>{if(k===1)return((X,$,W,At)=>{const ht=new Float32Array(16385),j=new Float32Array(16385);for(let bt=0;bt<16385;bt+=1){const _t=bt/16384*E;ht[bt]=Math.cos(_t),j[bt]=Math.sin(_t)}const nt=o(X,{...T,gain:0}),Y=u(X,{...I,curve:ht}),dt=u(X,{...I,curve:_}),tt=o(X,{...T,gain:0}),ct=u(X,{...I,curve:j});return{connectGraph(){$.connect(nt),$.connect(dt.inputs===void 0?dt:dt.inputs[0]),$.connect(tt),dt.connect(W),W.connect(Y.inputs===void 0?Y:Y.inputs[0]),W.connect(ct.inputs===void 0?ct:ct.inputs[0]),Y.connect(nt.gain),ct.connect(tt.gain),nt.connect(At,0,0),tt.connect(At,0,1)},disconnectGraph(){$.disconnect(nt),$.disconnect(dt.inputs===void 0?dt:dt.inputs[0]),$.disconnect(tt),dt.disconnect(W),W.disconnect(Y.inputs===void 0?Y:Y.inputs[0]),W.disconnect(ct.inputs===void 0?ct:ct.inputs[0]),Y.disconnect(nt.gain),ct.disconnect(tt.gain),nt.disconnect(At,0,0),tt.disconnect(At,0,1)}}})(L,q,G,N);if(k===2)return((X,$,W,At)=>{const ht=new Float32Array(16385),j=new Float32Array(16385),nt=new Float32Array(16385),Y=new Float32Array(16385),dt=Math.floor(8192.5);for(let he=0;he<16385;he+=1)if(he>dt){const we=(he-dt)/(16384-dt)*E;ht[he]=Math.cos(we),j[he]=Math.sin(we),nt[he]=0,Y[he]=1}else{const we=he/(16384-dt)*E;ht[he]=1,j[he]=0,nt[he]=Math.cos(we),Y[he]=Math.sin(we)}const tt=s(X,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),ct=o(X,{...T,gain:0}),bt=u(X,{...I,curve:ht}),_t=o(X,{...T,gain:0}),Jt=u(X,{...I,curve:j}),Ot=u(X,{...I,curve:_}),Rt=o(X,{...T,gain:0}),ee=u(X,{...I,curve:nt}),Pt=o(X,{...T,gain:0}),se=u(X,{...I,curve:Y});return{connectGraph(){$.connect(tt),$.connect(Ot.inputs===void 0?Ot:Ot.inputs[0]),tt.connect(ct,0),tt.connect(_t,0),tt.connect(Rt,1),tt.connect(Pt,1),Ot.connect(W),W.connect(bt.inputs===void 0?bt:bt.inputs[0]),W.connect(Jt.inputs===void 0?Jt:Jt.inputs[0]),W.connect(ee.inputs===void 0?ee:ee.inputs[0]),W.connect(se.inputs===void 0?se:se.inputs[0]),bt.connect(ct.gain),Jt.connect(_t.gain),ee.connect(Rt.gain),se.connect(Pt.gain),ct.connect(At,0,0),Rt.connect(At,0,0),_t.connect(At,0,1),Pt.connect(At,0,1)},disconnectGraph(){$.disconnect(tt),$.disconnect(Ot.inputs===void 0?Ot:Ot.inputs[0]),tt.disconnect(ct,0),tt.disconnect(_t,0),tt.disconnect(Rt,1),tt.disconnect(Pt,1),Ot.disconnect(W),W.disconnect(bt.inputs===void 0?bt:bt.inputs[0]),W.disconnect(Jt.inputs===void 0?Jt:Jt.inputs[0]),W.disconnect(ee.inputs===void 0?ee:ee.inputs[0]),W.disconnect(se.inputs===void 0?se:se.inputs[0]),bt.disconnect(ct.gain),Jt.disconnect(_t.gain),ee.disconnect(Rt.gain),se.disconnect(Pt.gain),ct.disconnect(At,0,0),Rt.disconnect(At,0,0),_t.disconnect(At,0,1),Pt.disconnect(At,0,1)}}})(L,q,G,N);throw p()};return(L,{channelCount:k,channelCountMode:q,pan:G,...N})=>{if(q==="max")throw p();const X=g(L,{...N,channelCount:1,channelCountMode:q,numberOfInputs:2}),$=o(L,{...N,channelCount:k,channelCountMode:q,gain:1}),W=o(L,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:G});let{connectGraph:At,disconnectGraph:ht}=M(L,k,$,W,X);Object.defineProperty(W.gain,"defaultValue",{get:()=>0}),Object.defineProperty(W.gain,"maxValue",{get:()=>1}),Object.defineProperty(W.gain,"minValue",{get:()=>-1});const j={get bufferSize(){},get channelCount(){return $.channelCount},set channelCount(Y){$.channelCount!==Y&&(nt&&ht(),{connectGraph:At,disconnectGraph:ht}=M(L,Y,$,W,X),nt&&At()),$.channelCount=Y},get channelCountMode(){return $.channelCountMode},set channelCountMode(Y){if(Y==="clamped-max"||Y==="max")throw p();$.channelCountMode=Y},get channelInterpretation(){return $.channelInterpretation},set channelInterpretation(Y){$.channelInterpretation=Y},get context(){return $.context},get inputs(){return[$]},get numberOfInputs(){return $.numberOfInputs},get numberOfOutputs(){return $.numberOfOutputs},get pan(){return W.gain},addEventListener:(...Y)=>$.addEventListener(Y[0],Y[1],Y[2]),dispatchEvent:(...Y)=>$.dispatchEvent(Y[0]),removeEventListener:(...Y)=>$.removeEventListener(Y[0],Y[1],Y[2])};let nt=!1;return v(to(j,X),(()=>{At(),nt=!0}),(()=>{ht(),nt=!1}))}})(Qr,Ba,ps,xc,ts,Mr),_w=((g,s)=>(o,u)=>{const p=u.channelCountMode;if(p==="clamped-max")throw s();if(o.createStereoPanner===void 0)return g(o,u);const v=o.createStereoPanner();return gn(v,u),en(v,u,"pan"),Object.defineProperty(v,"channelCountMode",{get:()=>p,set:C=>{if(C!==p)throw s()}}),v})(DS,ts),kS=((g,s,o,u,p)=>()=>{const v=new WeakMap;return{render(C,_){const E=v.get(_);return E!==void 0?Promise.resolve(E):(async(T,I)=>{let M=o(T);const L=st(M,I);if(!L){const k={channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation,pan:M.pan.value};M=s(I,k)}return v.set(I,M),L?await g(I,T.pan,M.pan):await u(I,T.pan,M.pan),Bt(M)?await p(T,I,M.inputs[0]):await p(T,I,M),M})(C,_)}}})(xi,_w,Zt,Ei,Qn),LS=((g,s,o,u,p,v)=>class extends g{constructor(C,_){const E=p(C),T={...W_,..._},I=o(E,T),M=v(E);super(C,!1,I,M?u():null),this._pan=s(this,M,I.pan)}get pan(){return this._pan}})(on,ri,_w,kS,Ne,Me),RS=((g,s,o)=>()=>{const u=new WeakMap;return{render(p,v){const C=u.get(v);return C!==void 0?Promise.resolve(C):(async(_,E)=>{let T=s(_);if(!st(T,E)){const I={channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,curve:T.curve,oversample:T.oversample};T=g(E,I)}return u.set(E,T),Bt(T)?await o(_,E,T.inputs[0]):await o(_,E,T),T})(p,v)}}})(xc,Zt,Qn),HS=((g,s,o,u,p,v,C)=>class extends g{constructor(_,E){const T=p(_),I={...K_,...E},M=o(T,I);super(_,!0,M,v(T)?u():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=M,C(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(_){if(_===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(_.length<2)throw s();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=_}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(_){this._nativeWaveShaperNode.oversample=_}})(on,bn,xc,RS,Ne,Me,pA),Sw=(g=>g!==null&&g.isSecureContext)(ii),hd=(g=>(s,o,u)=>{Object.defineProperties(g,{currentFrame:{configurable:!0,get:()=>Math.round(s*o)},currentTime:{configurable:!0,get:()=>s}});try{return u()}finally{g!==null&&(delete g.currentFrame,delete g.currentTime)}})(ii),xw=new WeakMap,NS=((g,s)=>o=>{let u=g.get(o);if(u!==void 0)return u;if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");return u=new s(1,1,44100),g.set(o,u),u})(xw,_n),OS=Sw?((g,s,o,u,p,v,C,_,E,T,I,M,L)=>{let k=0;return(q,G,N={credentials:"omit"})=>{const X=I.get(q);if(X!==void 0&&X.has(G))return Promise.resolve();const $=T.get(q);if($!==void 0){const ht=$.get(G);if(ht!==void 0)return ht}const W=v(q),At=W.audioWorklet===void 0?p(G).then((([ht,j])=>{const[nt,Y]=R(ht,j);return o(`${nt};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${Y}
})})(window,'_AWGS')`)})).then((()=>{const ht=L._AWGS.pop();if(ht===void 0)throw new SyntaxError;u(W.currentTime,W.sampleRate,(()=>ht(class{},void 0,((j,nt)=>{if(j.trim()==="")throw s();const Y=U.get(W);if(Y!==void 0){if(Y.has(j))throw s();O(nt),V(nt.parameterDescriptors),Y.set(j,nt)}else O(nt),V(nt.parameterDescriptors),U.set(W,new Map([[j,nt]]))}),W.sampleRate,void 0,void 0)))})):Promise.all([p(G),Promise.resolve(g(M,M))]).then((([[ht,j],nt])=>{const Y=k+1;k=Y;const[dt,tt]=R(ht,j),ct=new Blob([`${dt};((AudioWorkletProcessor,registerProcessor)=>{${tt}
})(${nt?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${nt?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${nt?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${Y}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),bt=URL.createObjectURL(ct);return W.audioWorklet.addModule(bt,N).then((()=>{if(_(W))return W;const _t=C(W);return _t.audioWorklet.addModule(bt,N).then((()=>_t))})).then((_t=>{if(E===null)throw new SyntaxError;try{new E(_t,`__sac${Y}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(bt)))}));return $===void 0?T.set(q,new Map([[G,At]])):$.set(G,At),At.then((()=>{const ht=I.get(q);ht===void 0?I.set(q,new Set([G])):ht.add(G)})).finally((()=>{const ht=T.get(q);ht!==void 0&&ht.delete(G)})),At}})(Vs,ts,(g=>s=>new Promise(((o,u)=>{if(g===null)return void u(new SyntaxError);const p=g.document.head;if(p===null)u(new SyntaxError);else{const v=g.document.createElement("script"),C=new Blob([s],{type:"application/javascript"}),_=URL.createObjectURL(C),E=g.onerror,T=()=>{g.onerror=E,URL.revokeObjectURL(_)};g.onerror=(I,M,L,k,q)=>M===_||M===g.location.href&&L===1&&k===1?(T(),u(q),!1):E!==null?E(I,M,L,k,q):void 0,v.onerror=()=>{T(),u(new SyntaxError)},v.onload=()=>{T(),o()},v.src=_,v.type="module",p.appendChild(v)}})))(ii),hd,(async g=>{try{const s=await fetch(g);if(s.ok)return[await s.text(),s.url]}catch{}throw new DOMException("","AbortError")}),Ne,NS,Me,no,new WeakMap,new WeakMap,((g,s)=>async()=>{if(g===null)return!0;if(s===null)return!1;const o=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),u=new s(1,128,44100),p=URL.createObjectURL(o);let v=!1,C=!1;try{await u.audioWorklet.addModule(p);const _=new g(u,"a",{numberOfOutputs:0}),E=u.createOscillator();_.port.onmessage=()=>v=!0,_.onprocessorerror=()=>C=!0,E.connect(_),E.start(0),await u.startRendering(),await new Promise((T=>setTimeout(T)))}catch{}finally{URL.revokeObjectURL(p)}return v&&!C})(no,_n),ii):void 0,VS=((g,s)=>o=>g(o)||s(o))(Ad,Me),WS=((g,s,o,u,p,v,C,_,E,T,I)=>(M,L)=>{const k=C(M)?M:v(M);if(p.has(L)){const q=new DOMException("","DataCloneError");return Promise.reject(q)}try{p.add(L)}catch{}return s(E,(()=>E(k)))?k.decodeAudioData(L).then((q=>(zg(L).catch((()=>{})),s(_,(()=>_(q)))||I(q),g.add(q),q))):new Promise(((q,G)=>{const N=async()=>{try{await zg(L)}catch{}},X=$=>{G($),N()};try{k.decodeAudioData(L,($=>{typeof $.copyFromChannel!="function"&&(T($),ut($)),g.add($),N().then((()=>q($)))}),($=>{X($===null?new DOMException("","EncodingError"):$)}))}catch($){X($)}}))})(ad,Vs,0,0,new WeakSet,Ne,VS,ot,va,cd,ud),Ew=((g,s,o,u,p,v,C,_,E,T,I,M,L,k,q,G,N,X,$,W)=>class extends q{constructor(At,ht){super(At,ht),this._nativeContext=At,this._audioWorklet=g===void 0?void 0:{addModule:(j,nt)=>g(this,j,nt)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new s(this)}createBiquadFilter(){return new p(this)}createBuffer(At,ht,j){return new o({length:ht,numberOfChannels:At,sampleRate:j})}createBufferSource(){return new u(this)}createChannelMerger(At=6){return new v(this,{numberOfInputs:At})}createChannelSplitter(At=6){return new C(this,{numberOfOutputs:At})}createConstantSource(){return new _(this)}createConvolver(){return new E(this)}createDelay(At=1){return new I(this,{maxDelayTime:At})}createDynamicsCompressor(){return new M(this)}createGain(){return new L(this)}createIIRFilter(At,ht){return new k(this,{feedback:ht,feedforward:At})}createOscillator(){return new G(this)}createPanner(){return new N(this)}createPeriodicWave(At,ht,j={disableNormalization:!1}){return new X(this,{...j,imag:ht,real:At})}createStereoPanner(){return new $(this)}createWaveShaper(){return new W(this)}decodeAudioData(At,ht,j){return T(this._nativeContext,At).then((nt=>(typeof ht=="function"&&ht(nt),nt)),(nt=>{throw typeof j=="function"&&j(nt),nt}))}})(OS,Z_,pw,eS,iS,oS,lS,hS,fS,WS,mS,wS,BS,_S,xS,TS,QS,PS,LS,HS),GS=((g,s,o,u)=>class extends g{constructor(p,v){const C=o(p),_=((E,T)=>E.createMediaElementSource(T.mediaElement))(C,v);if(u(C))throw TypeError();super(p,!0,_,null),this._nativeMediaElementAudioSourceNode=_}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(on,0,Ne,Me),KS=((g,s,o,u)=>class extends g{constructor(p,v){const C=o(p);if(u(C))throw new TypeError;const _=((E,T)=>{const I=E.createMediaStreamDestination();return gn(I,T),I.numberOfOutputs===1&&Object.defineProperty(I,"numberOfOutputs",{get:()=>0}),I})(C,{...L_,...v});super(p,!1,_,null),this._nativeMediaStreamAudioDestinationNode=_}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(on,0,Ne,Me),qS=((g,s,o,u)=>class extends g{constructor(p,v){const C=o(p),_=((E,{mediaStream:T})=>{const I=T.getAudioTracks();I.sort(((k,q)=>k.id<q.id?-1:k.id>q.id?1:0));const M=I.slice(0,1),L=E.createMediaStreamSource(new MediaStream(M));return Object.defineProperty(L,"mediaStream",{value:T}),L})(C,v);if(u(C))throw new TypeError;super(p,!0,_,null),this._nativeMediaStreamAudioSourceNode=_}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(on,0,Ne,Me),$S=((g,s)=>(o,{mediaStreamTrack:u})=>{if(typeof o.createMediaStreamTrackSource=="function")return o.createMediaStreamTrackSource(u);const p=new MediaStream([u]),v=o.createMediaStreamSource(p);if(u.kind!=="audio")throw g();if(s(o))throw new TypeError;return v})(bn,Me),zS=((g,s,o)=>class extends g{constructor(u,p){const v=o(u);super(u,!0,s(v,p),null)}})(on,$S,Ne),XS=((g,s,o,u,p,v,C,_,E)=>class extends g{constructor(T={}){if(E===null)throw new Error("Missing the native AudioContext constructor.");let I;try{I=new E(T)}catch(k){throw k.code===12&&k.message==="sampleRate is not in range"?o():k}if(I===null)throw u();if(!(k=>k===void 0||typeof k=="number"||typeof k=="string"&&(k==="balanced"||k==="interactive"||k==="playback"))(T.latencyHint))throw new TypeError(`The provided value '${T.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(T.sampleRate!==void 0&&I.sampleRate!==T.sampleRate)throw o();super(I,2);const{latencyHint:M}=T,{sampleRate:L}=I;if(this._baseLatency=typeof I.baseLatency=="number"?I.baseLatency:M==="balanced"?512/L:M==="interactive"||M===void 0?256/L:M==="playback"?1024/L:128*Math.max(2,Math.min(128,Math.round(M*L/128)))/L,this._nativeAudioContext=I,E.name==="webkitAudioContext"?(this._nativeGainNode=I.createGain(),this._nativeOscillatorNode=I.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(I.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,I.state==="running"){this._state="suspended";const k=()=>{this._state==="suspended"&&(this._state=null),I.removeEventListener("statechange",k)};I.addEventListener("statechange",k)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then((()=>{throw s()})):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then((()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),rt(this)})))}createMediaElementSource(T){return new p(this,{mediaElement:T})}createMediaStreamDestination(){return new v(this)}createMediaStreamSource(T){return new C(this,{mediaStream:T})}createMediaStreamTrackSource(T){return new _(this,{mediaStreamTrack:T})}resume(){return this._state==="suspended"?new Promise(((T,I)=>{const M=()=>{this._nativeAudioContext.removeEventListener("statechange",M),this._nativeAudioContext.state==="running"?T():this.resume().then(T,I)};this._nativeAudioContext.addEventListener("statechange",M)})):this._nativeAudioContext.resume().catch((T=>{throw T===void 0||T.code===15?s():T}))}suspend(){return this._nativeAudioContext.suspend().catch((T=>{throw T===void 0?s():T}))}})(Ew,bn,ts,G_,GS,KS,qS,zS,Ir),dd=(g=>s=>{const o=g.get(s);if(o===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return o})(Bw),YS=(g=>(s,o)=>{g(s).add(o)})(dd),Tw=(g=>(s,o,u=0,p=0)=>{const v=s[u];if(v===void 0)throw g();return ne(o)?v.connect(o,0,p):v.connect(o,0)})(vt),jS=(g=>(s,o)=>{g(s).delete(o)})(dd),Fw=(g=>(s,o=void 0,u=void 0,p=0)=>o===void 0?s.forEach((v=>v.disconnect())):typeof o=="number"?yc(g,s,o).disconnect():ne(o)?u===void 0?s.forEach((v=>v.disconnect(o))):p===void 0?yc(g,s,u).disconnect(o,0):yc(g,s,u).disconnect(o,0,p):u===void 0?s.forEach((v=>v.disconnect(o))):yc(g,s,u).disconnect(o,0))(vt),Iw=new WeakMap,JS=((g,s)=>o=>s(g,o))(Iw,K),ZS=((g,s,o,u,p,v,C,_,E,T,I,M,L)=>(k,q,G,N)=>{if(N.numberOfInputs===0&&N.numberOfOutputs===0)throw E();const X=Array.isArray(N.outputChannelCount)?N.outputChannelCount:Array.from(N.outputChannelCount);if(X.some((yt=>yt<1)))throw E();if(X.length!==N.numberOfOutputs)throw s();if(N.channelCountMode!=="explicit")throw E();const $=N.channelCount*N.numberOfInputs,W=X.reduce(((yt,ve)=>yt+ve),0),At=G.parameterDescriptors===void 0?0:G.parameterDescriptors.length;if($+At>6||W>6)throw E();const ht=new MessageChannel,j=[],nt=[];for(let yt=0;yt<N.numberOfInputs;yt+=1)j.push(C(k,{channelCount:N.channelCount,channelCountMode:N.channelCountMode,channelInterpretation:N.channelInterpretation,gain:1})),nt.push(p(k,{channelCount:N.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:N.channelCount}));const Y=[];if(G.parameterDescriptors!==void 0)for(const{defaultValue:yt,maxValue:ve,minValue:Rn,name:je}of G.parameterDescriptors){const pe=v(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:N.parameterData[je]!==void 0?N.parameterData[je]:yt===void 0?0:yt});Object.defineProperties(pe.offset,{defaultValue:{get:()=>yt===void 0?0:yt},maxValue:{get:()=>ve===void 0?Vt:ve},minValue:{get:()=>Rn===void 0?$t:Rn}}),Y.push(pe)}const dt=u(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,$+At)}),tt=jg(q,k.sampleRate),ct=_(k,tt,$+At,Math.max(1,W)),bt=p(k,{channelCount:Math.max(1,W),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,W)}),_t=[];for(let yt=0;yt<N.numberOfOutputs;yt+=1)_t.push(u(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:X[yt]}));for(let yt=0;yt<N.numberOfInputs;yt+=1){j[yt].connect(nt[yt]);for(let ve=0;ve<N.channelCount;ve+=1)nt[yt].connect(dt,ve,yt*N.channelCount+ve)}const Jt=new fs(G.parameterDescriptors===void 0?[]:G.parameterDescriptors.map((({name:yt},ve)=>{const Rn=Y[ve];return Rn.connect(dt,0,$+ve),Rn.start(0),[yt,Rn.offset]})));dt.connect(ct);let Ot=N.channelInterpretation,Rt=null;const ee=N.numberOfOutputs===0?[ct]:_t,Pt={get bufferSize(){return tt},get channelCount(){return N.channelCount},set channelCount(yt){throw o()},get channelCountMode(){return N.channelCountMode},set channelCountMode(yt){throw o()},get channelInterpretation(){return Ot},set channelInterpretation(yt){for(const ve of j)ve.channelInterpretation=yt;Ot=yt},get context(){return ct.context},get inputs(){return j},get numberOfInputs(){return N.numberOfInputs},get numberOfOutputs(){return N.numberOfOutputs},get onprocessorerror(){return Rt},set onprocessorerror(yt){typeof Rt=="function"&&Pt.removeEventListener("processorerror",Rt),Rt=typeof yt=="function"?yt:null,typeof Rt=="function"&&Pt.addEventListener("processorerror",Rt)},get parameters(){return Jt},get port(){return ht.port2},addEventListener:(...yt)=>ct.addEventListener(yt[0],yt[1],yt[2]),connect:g.bind(null,ee),disconnect:T.bind(null,ee),dispatchEvent:(...yt)=>ct.dispatchEvent(yt[0]),removeEventListener:(...yt)=>ct.removeEventListener(yt[0],yt[1],yt[2])},se=new Map;var he,we;ht.port1.addEventListener=(he=ht.port1.addEventListener,(...yt)=>{if(yt[0]==="message"){const ve=typeof yt[1]=="function"?yt[1]:typeof yt[1]=="object"&&yt[1]!==null&&typeof yt[1].handleEvent=="function"?yt[1].handleEvent:null;if(ve!==null){const Rn=se.get(yt[1]);Rn!==void 0?yt[1]=Rn:(yt[1]=je=>{I(k.currentTime,k.sampleRate,(()=>ve(je)))},se.set(ve,yt[1]))}}return he.call(ht.port1,yt[0],yt[1],yt[2])}),ht.port1.removeEventListener=(we=ht.port1.removeEventListener,(...yt)=>{if(yt[0]==="message"){const ve=se.get(yt[1]);ve!==void 0&&(se.delete(yt[1]),yt[1]=ve)}return we.call(ht.port1,yt[0],yt[1],yt[2])});let We=null;Object.defineProperty(ht.port1,"onmessage",{get:()=>We,set:yt=>{typeof We=="function"&&ht.port1.removeEventListener("message",We),We=typeof yt=="function"?yt:null,typeof We=="function"&&(ht.port1.addEventListener("message",We),ht.port1.start())}}),G.prototype.port=ht.port1;let sn=null;((yt,ve,Rn,je)=>{let pe=D.get(yt);pe===void 0&&(pe=new WeakMap,D.set(yt,pe));const Ge=(async(ws,Ii)=>{const Mi=await(Sf=>new Promise(((xf,eE)=>{const{port1:Kc,port2:Ef}=new MessageChannel;Kc.onmessage=({data:Tf})=>{Kc.close(),Ef.close(),xf(Tf)},Kc.onmessageerror=({data:Tf})=>{Kc.close(),Ef.close(),eE(Tf)},Ef.postMessage(Sf)})))(Ii);return new ws(Mi)})(Rn,je);return pe.set(ve,Ge),Ge})(k,Pt,G,N).then((yt=>sn=yt));const ue=Bc(N.numberOfInputs,N.channelCount),Qt=Bc(N.numberOfOutputs,X),He=G.parameterDescriptors===void 0?[]:G.parameterDescriptors.reduce(((yt,{name:ve})=>({...yt,[ve]:new Float32Array(128)})),{});let Ee=!0;const Ln=()=>{N.numberOfOutputs>0&&ct.disconnect(bt);for(let yt=0,ve=0;yt<N.numberOfOutputs;yt+=1){const Rn=_t[yt];for(let je=0;je<X[yt];je+=1)bt.disconnect(Rn,ve+je,je);ve+=X[yt]}},Or=new Map;ct.onaudioprocess=({inputBuffer:yt,outputBuffer:ve})=>{if(sn!==null){const Rn=M(Pt);for(let je=0;je<tt;je+=128){for(let pe=0;pe<N.numberOfInputs;pe+=1)for(let Ge=0;Ge<N.channelCount;Ge+=1)Fr(yt,ue[pe],Ge,Ge,je);G.parameterDescriptors!==void 0&&G.parameterDescriptors.forEach((({name:pe},Ge)=>{Fr(yt,He,pe,$+Ge,je)}));for(let pe=0;pe<N.numberOfInputs;pe+=1)for(let Ge=0;Ge<X[pe];Ge+=1)Qt[pe][Ge].byteLength===0&&(Qt[pe][Ge]=new Float32Array(128));try{const pe=ue.map(((ws,Ii)=>{if(Rn[Ii].size>0)return Or.set(Ii,tt/128),ws;const Mi=Or.get(Ii);return Mi===void 0?[]:(ws.every((Sf=>Sf.every((xf=>xf===0))))&&(Mi===1?Or.delete(Ii):Or.set(Ii,Mi-1)),ws)}));Ee=I(k.currentTime+je/k.sampleRate,k.sampleRate,(()=>sn.process(pe,Qt,He)));for(let ws=0,Ii=0;ws<N.numberOfOutputs;ws+=1){for(let Mi=0;Mi<X[ws];Mi+=1)vc(ve,Qt[ws],Mi,Ii+Mi,je);Ii+=X[ws]}}catch(pe){Ee=!1,Pt.dispatchEvent(new ErrorEvent("processorerror",{colno:pe.colno,filename:pe.filename,lineno:pe.lineno,message:pe.message}))}if(!Ee){for(let pe=0;pe<N.numberOfInputs;pe+=1){j[pe].disconnect(nt[pe]);for(let Ge=0;Ge<N.channelCount;Ge+=1)nt[je].disconnect(dt,Ge,pe*N.channelCount+Ge)}if(G.parameterDescriptors!==void 0){const pe=G.parameterDescriptors.length;for(let Ge=0;Ge<pe;Ge+=1){const ws=Y[Ge];ws.disconnect(dt,0,$+Ge),ws.stop()}}dt.disconnect(ct),ct.onaudioprocess=null,bf?Ln():rv();break}}}};let bf=!1;const _f=C(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),iv=()=>ct.connect(_f).connect(k.destination),rv=()=>{ct.disconnect(_f),_f.disconnect()};return iv(),L(Pt,(()=>{if(Ee){rv(),N.numberOfOutputs>0&&ct.connect(bt);for(let yt=0,ve=0;yt<N.numberOfOutputs;yt+=1){const Rn=_t[yt];for(let je=0;je<X[yt];je+=1)bt.connect(Rn,ve+je,je);ve+=X[yt]}}bf=!0}),(()=>{Ee&&(iv(),Ln()),bf=!1}))})(Tw,vt,bn,Qr,Ba,io,ps,ya,ts,Fw,hd,JS,Mr),tx=((g,s,o,u,p)=>(v,C,_,E,T,I)=>{if(_!==null)try{const k=new _(v,E,I),q=new Map;let G=null;if(Object.defineProperties(k,{channelCount:{get:()=>I.channelCount,set:()=>{throw g()}},channelCountMode:{get:()=>"explicit",set:()=>{throw g()}},onprocessorerror:{get:()=>G,set:N=>{typeof G=="function"&&k.removeEventListener("processorerror",G),G=typeof N=="function"?N:null,typeof G=="function"&&k.addEventListener("processorerror",G)}}}),k.addEventListener=(L=k.addEventListener,(...N)=>{if(N[0]==="processorerror"){const X=typeof N[1]=="function"?N[1]:typeof N[1]=="object"&&N[1]!==null&&typeof N[1].handleEvent=="function"?N[1].handleEvent:null;if(X!==null){const $=q.get(N[1]);$!==void 0?N[1]=$:(N[1]=W=>{W.type==="error"?(Object.defineProperties(W,{type:{value:"processorerror"}}),X(W)):X(new ErrorEvent(N[0],{...W}))},q.set(X,N[1]))}}return L.call(k,"error",N[1],N[2]),L.call(k,...N)}),k.removeEventListener=(M=k.removeEventListener,(...N)=>{if(N[0]==="processorerror"){const X=q.get(N[1]);X!==void 0&&(q.delete(N[1]),N[1]=X)}return M.call(k,"error",N[1],N[2]),M.call(k,N[0],N[1],N[2])}),I.numberOfOutputs!==0){const N=o(v,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return k.connect(N).connect(v.destination),p(k,(()=>N.disconnect()),(()=>N.connect(v.destination)))}return k}catch(k){throw k.code===11?u():k}var M,L;if(T===void 0)throw u();return(k=>{const{port1:q}=new MessageChannel;try{q.postMessage(k)}finally{q.close()}})(I),s(v,C,T,I)})(bn,ZS,ps,ts,Mr),ex=((g,s,o,u,p,v,C,_,E,T,I,M,L,k,q,G)=>(N,X,$)=>{const W=new WeakMap;let At=null;return{render(ht,j){_(j,ht);const nt=W.get(j);return nt!==void 0?Promise.resolve(nt):(async(Y,dt)=>{let tt=I(Y),ct=null;const bt=st(tt,dt),_t=Array.isArray(X.outputChannelCount)?X.outputChannelCount:Array.from(X.outputChannelCount);if(M===null){const Jt=_t.reduce(((Pt,se)=>Pt+se),0),Ot=p(dt,{channelCount:Math.max(1,Jt),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,Jt)}),Rt=[];for(let Pt=0;Pt<Y.numberOfOutputs;Pt+=1)Rt.push(u(dt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_t[Pt]}));const ee=C(dt,{channelCount:X.channelCount,channelCountMode:X.channelCountMode,channelInterpretation:X.channelInterpretation,gain:1});ee.connect=s.bind(null,Rt),ee.disconnect=E.bind(null,Rt),ct=[Ot,Rt,ee]}else bt||(tt=new M(dt,N));if(W.set(dt,ct===null?tt:ct[2]),ct!==null){if(At===null){if($===void 0)throw new Error("Missing the processor constructor.");if(L===null)throw new Error("Missing the native OfflineAudioContext constructor.");const se=Y.channelCount*Y.numberOfInputs,he=$.parameterDescriptors===void 0?0:$.parameterDescriptors.length,we=se+he;At=E_(Y,we===0?null:await(async()=>{const sn=new L(we,128*Math.ceil(Y.context.length/128),dt.sampleRate),gs=[],ue=[];for(let Ee=0;Ee<X.numberOfInputs;Ee+=1)gs.push(C(sn,{channelCount:X.channelCount,channelCountMode:X.channelCountMode,channelInterpretation:X.channelInterpretation,gain:1})),ue.push(p(sn,{channelCount:X.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:X.channelCount}));const Qt=await Promise.all(Array.from(Y.parameters.values()).map((async Ee=>{const Ln=v(sn,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Ee.value});return await k(sn,Ee,Ln.offset),Ln}))),He=u(sn,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,se+he)});for(let Ee=0;Ee<X.numberOfInputs;Ee+=1){gs[Ee].connect(ue[Ee]);for(let Ln=0;Ln<X.channelCount;Ln+=1)ue[Ee].connect(He,Ln,Ee*X.channelCount+Ln)}for(const[Ee,Ln]of Qt.entries())Ln.connect(He,0,se+Ee),Ln.start(0);return He.connect(sn.destination),await Promise.all(gs.map((Ee=>q(Y,sn,Ee)))),G(sn)})(),dt,X,_t,$,T)}const Jt=await At,Ot=o(dt,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[Rt,ee,Pt]=ct;Jt!==null&&(Ot.buffer=Jt,Ot.start(0)),Ot.connect(Rt);for(let se=0,he=0;se<Y.numberOfOutputs;se+=1){const we=ee[se];for(let We=0;We<_t[se];We+=1)Rt.connect(we,he+We,We);he+=_t[se]}return Pt}if(bt)for(const[Jt,Ot]of Y.parameters.entries())await g(dt,Ot,tt.parameters.get(Jt));else for(const[Jt,Ot]of Y.parameters.entries())await k(dt,Ot,tt.parameters.get(Jt));return await q(Y,dt,tt),tt})(ht,j)}}})(xi,Tw,so,Qr,Ba,io,ps,jS,Fw,hd,Zt,no,_n,Ei,Qn,Sc),nx=(g=>s=>g.get(s))(xw),sx=(g=>(s,o)=>{g.set(s,o)})(Iw),Mw=Sw?((g,s,o,u,p,v,C,_,E,T,I,M,L,k)=>class extends s{constructor(q,G,N){var X;const $=_(q),W=E($),At=(ct=>({...ct,outputChannelCount:ct.outputChannelCount!==void 0?ct.outputChannelCount:ct.numberOfInputs===1&&ct.numberOfOutputs===1?[ct.channelCount]:Array.from({length:ct.numberOfOutputs},(()=>1))}))({...wa,...N});(ct=>{const{port1:bt,port2:_t}=new MessageChannel;try{bt.postMessage(ct)}finally{bt.close(),_t.close()}})(At);const ht=U.get($),j=ht==null?void 0:ht.get(G),nt=W||$.state!=="closed"?$:(X=C($))!==null&&X!==void 0?X:$,Y=p(nt,W?null:q.baseLatency,T,G,j,At);super(q,!0,Y,W?u(G,At,j):null);const dt=[];Y.parameters.forEach(((ct,bt)=>{const _t=o(this,W,ct);dt.push([bt,_t])})),this._nativeAudioWorkletNode=Y,this._onprocessorerror=null,this._parameters=new fs(dt),W&&g($,this);const{activeInputs:tt}=v(this);M(Y,tt)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(q){const G=typeof q=="function"?k(this,q):null;this._nativeAudioWorkletNode.onprocessorerror=G;const N=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=N!==null&&N===G?q:N}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(YS,on,ri,ex,tx,Et,nx,Ne,Me,no,0,sx,0,eo):void 0,ix=((g,s)=>(o,u,p)=>{if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new s(o,u,p)}catch(v){throw v.name==="SyntaxError"?g():v}})(ts,_n),rx=((g,s,o,u,p,v,C,_)=>(E,T)=>o(E).render(E,T).then((()=>Promise.all(Array.from(u(T)).map((I=>o(I).render(I,T)))))).then((()=>p(T))).then((I=>(typeof I.copyFromChannel!="function"?(C(I),ut(I)):s(v,(()=>v(I)))||_(I),g.add(I),I))))(ad,Vs,rd,dd,Sc,ot,cd,ud),Ax=((g,s,o,u,p)=>class extends g{constructor(v,C,_){let E;if(typeof v=="number"&&C!==void 0&&_!==void 0)E={length:C,numberOfChannels:v,sampleRate:_};else{if(typeof v!="object")throw new Error("The given parameters are not valid.");E=v}const{length:T,numberOfChannels:I,sampleRate:M}={...H_,...E},L=u(I,T,M);s(va,(()=>va(L)))||L.addEventListener("statechange",(()=>{let k=0;const q=G=>{this._state==="running"&&(k>0?(L.removeEventListener("statechange",q),G.stopImmediatePropagation(),this._waitForThePromiseToSettle(G)):k+=1)};return q})()),super(L,I),this._length=T,this._nativeOfflineAudioContext=L,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(o()):(this._state="running",p(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,rt(this)})))}_waitForThePromiseToSettle(v){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(v):setTimeout((()=>this._waitForThePromiseToSettle(v)))}})(Ew,Vs,bn,ix,rx),ox=((g,s)=>o=>{const u=g.get(o);return s(u)||s(o)})(b,Ad),ax=((g,s)=>o=>g.has(o)||s(o))(w,od),lx=((g,s)=>o=>g.has(o)||s(o))(y,uw),cx=((g,s)=>o=>{const u=g.get(o);return s(u)||s(o)})(b,Me),ux=()=>(async(g,s,o,u,p,v,C,_,E,T,I,M,L,k,q,G)=>!!(g(s,s)&&g(o,o)&&g(p,p)&&g(v,v)&&g(_,_)&&g(E,E)&&g(T,T)&&g(I,I)&&g(M,M)&&g(L,L)&&g(k,k))&&(await Promise.all([g(u,u),g(C,C),g(q,q),g(G,G)])).every((N=>N)))(Vs,(g=>()=>{if(g===null)return!1;const s=new g(1,1,44100).createBuffer(1,1,44100);if(s.copyToChannel===void 0)return!0;const o=new Float32Array(2);try{s.copyFromChannel(o,0,0)}catch{return!1}return!0})(_n),(g=>()=>{if(g===null)return!1;if(g.prototype!==void 0&&g.prototype.close!==void 0)return!0;const s=new g,o=s.close!==void 0;try{s.close()}catch{}return o})(Ir),(g=>()=>{if(g===null)return Promise.resolve(!1);const s=new g(1,1,44100);return new Promise((o=>{let u=!0;const p=C=>{u&&(u=!1,s.startRendering(),o(C instanceof TypeError))};let v;try{v=s.decodeAudioData(null,(()=>{}),p)}catch(C){p(C)}v!==void 0&&v.catch(p)}))})(_n),(g=>()=>{if(g===null)return!1;let s;try{s=new g({latencyHint:"balanced"})}catch{return!1}return s.close(),!0})(Ir),(g=>()=>{if(g===null)return!1;const s=new g(1,1,44100).createGain(),o=s.connect(s)===s;return s.disconnect(s),o})(_n),((g,s)=>async()=>{if(g===null)return!0;if(s===null)return!1;const o=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),u=new MessageChannel,p=new s(1,128,44100),v=URL.createObjectURL(o);let C=!1;try{await p.audioWorklet.addModule(v);const _=new g(p,"a",{numberOfOutputs:0}),E=p.createOscillator();await new Promise((T=>{_.port.onmessage=()=>T(),_.port.postMessage(u.port2,[u.port2])})),_.port.onmessage=()=>C=!0,E.connect(_),E.start(0),await p.startRendering(),C=await new Promise((T=>{u.port1.onmessage=({data:I})=>T(I===1),u.port1.postMessage(0)}))}catch{}finally{u.port1.close(),URL.revokeObjectURL(v)}return C})(no,_n),(g=>()=>{if(g===null)return!1;const s=new g(1,1,44100).createChannelMerger();if(s.channelCountMode==="max")return!0;try{s.channelCount=2}catch{return!0}return!1})(_n),(g=>()=>{if(g===null)return!1;const s=new g(1,1,44100);return s.createConstantSource===void 0||s.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(_n),(g=>()=>{if(g===null)return!1;const s=new g(1,1,44100),o=s.createConvolver();o.buffer=s.createBuffer(1,1,s.sampleRate);try{o.buffer=s.createBuffer(1,1,s.sampleRate)}catch{return!1}return!0})(_n),(g=>()=>{if(g===null)return!1;const s=new g(1,1,44100).createConvolver();try{s.channelCount=1}catch{return!1}return!0})(_n),q_,(g=>()=>g!==null&&g.hasOwnProperty("isSecureContext"))(ii),(g=>()=>{if(g===null)return!1;const s=new g;try{return s.createMediaStreamSource(new MediaStream),!1}catch{return!0}finally{s.close()}})(Ir),(g=>()=>{if(g===null)return Promise.resolve(!1);const s=new g(1,1,44100);if(s.createStereoPanner===void 0||s.createConstantSource===void 0)return Promise.resolve(!0);const o=s.createConstantSource(),u=s.createStereoPanner();return o.channelCount=1,o.offset.value=1,u.channelCount=1,o.start(),o.connect(u).connect(s.destination),s.startRendering().then((p=>p.getChannelData(0)[0]!==1))})(_n),$_);function ms(g){return g===void 0}function Ae(g){return g!==void 0}function Qw(g){return typeof g=="function"}function Fs(g){return typeof g=="number"}function tr(g){return Object.prototype.toString.call(g)==="[object Object]"&&g.constructor===Object}function fd(g){return typeof g=="boolean"}function Un(g){return Array.isArray(g)}function Ai(g){return typeof g=="string"}function _a(g){return Ai(g)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(g)}function Gt(g,s){if(!g)throw new Error(s)}function wn(g,s,o=1/0){if(!(s<=g&&g<=o))throw new RangeError(`Value must be within [${s}, ${o}], got: ${g}`)}function pd(g){g.isOffline||g.state==="running"||ro('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Uw=!1,Pw=!1;function md(g){Uw=g}function Dw(g){ms(g)&&Uw&&!Pw&&(Pw=!0,ro("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let gd=console;function hx(g){gd=g}function kw(...g){gd.log(...g)}function ro(...g){gd.warn(...g)}const Is=typeof self=="object"?self:null,dx=Is&&(Is.hasOwnProperty("AudioContext")||Is.hasOwnProperty("webkitAudioContext"));function oi(g,s,o,u){var p,v=arguments.length,C=v<3?s:u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(g,s,o,u);else for(var _=g.length-1;_>=0;_--)(p=g[_])&&(C=(v<3?p(C):v>3?p(s,o,C):p(s,o))||C);return v>3&&C&&Object.defineProperty(s,o,C),C}function Re(g,s,o,u){return new(o||(o=Promise))((function(p,v){function C(T){try{E(u.next(T))}catch(I){v(I)}}function _(T){try{E(u.throw(T))}catch(I){v(I)}}function E(T){var I;T.done?p(T.value):(I=T.value,I instanceof o?I:new o((function(M){M(I)}))).then(C,_)}E((u=u.apply(g,s||[])).next())}))}typeof SuppressedError=="function"&&SuppressedError;class fx{constructor(s,o,u,p){this._callback=s,this._type=o,this._minimumUpdateInterval=Math.max(128/(p||44100),.001),this.updateInterval=u,this._createClock()}_createWorker(){const s=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),o=URL.createObjectURL(s),u=new Worker(o);u.onmessage=this._callback.bind(this),this._worker=u}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(s){var o;this._updateInterval=Math.max(s,this._minimumUpdateInterval),this._type==="worker"&&((o=this._worker)===null||o===void 0||o.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(s){this._disposeClock(),this._type=s,this._createClock()}dispose(){this._disposeClock()}}function mA(g){return lx(g)}function Ur(g){return ax(g)}function Ec(g){return cx(g)}function Ao(g){return ox(g)}function px(g,s){return g==="value"||mA(s)||Ur(s)||(function(o){return o instanceof pw})(s)}function Ws(g,...s){if(!s.length)return g;const o=s.shift();if(tr(g)&&tr(o))for(const u in o)px(u,o[u])?g[u]=o[u]:tr(o[u])?(g[u]||Object.assign(g,{[u]:{}}),Ws(g[u],o[u])):Object.assign(g,{[u]:o[u]});return Ws(g,...s)}function at(g,s,o=[],u){const p={},v=Array.from(s);if(tr(v[0])&&u&&!Reflect.has(v[0],u)&&(Object.keys(v[0]).some((C=>Reflect.has(g,C)))||(Ws(p,{[u]:v[0]}),o.splice(o.indexOf(u),1),v.shift())),v.length===1&&tr(v[0]))Ws(p,v[0]);else for(let C=0;C<o.length;C++)Ae(v[C])&&(p[o[C]]=v[C]);return Ws(g,p)}function Gs(g,s){return ms(g)?s:g}function Pn(g,s){return s.forEach((o=>{Reflect.has(g,o)&&delete g[o]})),g}class er{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...s){(this.debug||Is&&this.toString()===Is.TONE_DEBUG_CLASS)&&kw(this,...s)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}er.version=c;const wd=1e-6;function oo(g,s){return g>s+wd}function vd(g,s){return oo(g,s)||ai(g,s)}function Tc(g,s){return g+wd<s}function ai(g,s){return Math.abs(g-s)<wd}function gA(g,s,o){return Math.max(Math.min(g,o),s)}class Ms extends er{constructor(){super(),this.name="Timeline",this._timeline=[];const s=at(Ms.getDefaults(),arguments,["memory"]);this.memory=s.memory,this.increasing=s.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(s){if(Gt(Reflect.has(s,"time"),"Timeline: events must have a time attribute"),s.time=s.time.valueOf(),this.increasing&&this.length){const o=this._timeline[this.length-1];Gt(vd(s.time,o.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(s)}else{const o=this._search(s.time);this._timeline.splice(o+1,0,s)}if(this.length>this.memory){const o=this.length-this.memory;this._timeline.splice(0,o)}return this}remove(s){const o=this._timeline.indexOf(s);return o!==-1&&this._timeline.splice(o,1),this}get(s,o="time"){const u=this._search(s,o);return u!==-1?this._timeline[u]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(s,o="time"){const u=this._search(s,o);return u+1<this._timeline.length?this._timeline[u+1]:null}getBefore(s){const o=this._timeline.length;if(o>0&&this._timeline[o-1].time<s)return this._timeline[o-1];const u=this._search(s);return u-1>=0?this._timeline[u-1]:null}cancel(s){if(this._timeline.length>1){let o=this._search(s);if(o>=0)if(ai(this._timeline[o].time,s)){for(let u=o;u>=0&&ai(this._timeline[u].time,s);u--)o=u;this._timeline=this._timeline.slice(0,o)}else this._timeline=this._timeline.slice(0,o+1);else this._timeline=[]}else this._timeline.length===1&&vd(this._timeline[0].time,s)&&(this._timeline=[]);return this}cancelBefore(s){const o=this._search(s);return o>=0&&(this._timeline=this._timeline.slice(o+1)),this}previousEvent(s){const o=this._timeline.indexOf(s);return o>0?this._timeline[o-1]:null}_search(s,o="time"){if(this._timeline.length===0)return-1;let u=0;const p=this._timeline.length;let v=p;if(p>0&&this._timeline[p-1][o]<=s)return p-1;for(;u<v;){let C=Math.floor(u+(v-u)/2);const _=this._timeline[C],E=this._timeline[C+1];if(ai(_[o],s)){for(let T=C;T<this._timeline.length&&ai(this._timeline[T][o],s);T++)C=T;return C}if(Tc(_[o],s)&&oo(E[o],s))return C;oo(_[o],s)?v=C:u=C+1}return-1}_iterate(s,o=0,u=this._timeline.length-1){this._timeline.slice(o,u+1).forEach(s)}forEach(s){return this._iterate(s),this}forEachBefore(s,o){const u=this._search(s);return u!==-1&&this._iterate(o,0,u),this}forEachAfter(s,o){const u=this._search(s);return this._iterate(o,u+1),this}forEachBetween(s,o,u){let p=this._search(s),v=this._search(o);return p!==-1&&v!==-1?(this._timeline[p].time!==s&&(p+=1),this._timeline[v].time===o&&(v-=1),this._iterate(u,p,v)):p===-1&&this._iterate(u,0,v),this}forEachFrom(s,o){let u=this._search(s);for(;u>=0&&this._timeline[u].time>=s;)u--;return this._iterate(o,u+1),this}forEachAtTime(s,o){const u=this._search(s);if(u!==-1&&ai(this._timeline[u].time,s)){let p=u;for(let v=u;v>=0&&ai(this._timeline[v].time,s);v--)p=v;this._iterate((v=>{o(v)}),p,u)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Lw=[];function Fc(g){Lw.push(g)}const Rw=[];function Ic(g){Rw.push(g)}class ao extends er{constructor(){super(...arguments),this.name="Emitter"}on(s,o){return s.split(/\W+/).forEach((u=>{ms(this._events)&&(this._events={}),this._events.hasOwnProperty(u)||(this._events[u]=[]),this._events[u].push(o)})),this}once(s,o){const u=(...p)=>{o(...p),this.off(s,u)};return this.on(s,u),this}off(s,o){return s.split(/\W+/).forEach((u=>{if(ms(this._events)&&(this._events={}),this._events.hasOwnProperty(u))if(ms(o))this._events[u]=[];else{const p=this._events[u];for(let v=p.length-1;v>=0;v--)p[v]===o&&p.splice(v,1)}})),this}emit(s,...o){if(this._events&&this._events.hasOwnProperty(s)){const u=this._events[s].slice(0);for(let p=0,v=u.length;p<v;p++)u[p].apply(this,o)}return this}static mixin(s){["on","once","off","emit"].forEach((o=>{const u=Object.getOwnPropertyDescriptor(ao.prototype,o);Object.defineProperty(s.prototype,o,u)}))}dispose(){return super.dispose(),this._events=void 0,this}}class Bd extends ao{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class lo extends Bd{constructor(){var s,o;super(),this.name="Context",this._constants=new Map,this._timeouts=new Ms,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const u=at(lo.getDefaults(),arguments,["context"]);u.context?(this._context=u.context,this._latencyHint=((s=arguments[0])===null||s===void 0?void 0:s.latencyHint)||""):(this._context=(function(p){return new XS(p)})({latencyHint:u.latencyHint}),this._latencyHint=u.latencyHint),this._ticker=new fx(this.emit.bind(this,"tick"),u.clockSource,u.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((o=arguments[0])===null||o===void 0)&&o.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=u.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var s;return this._initialized||(s=this,Lw.forEach((o=>o(s))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(s,o,u){return this._context.createBuffer(s,o,u)}createChannelMerger(s){return this._context.createChannelMerger(s)}createChannelSplitter(s){return this._context.createChannelSplitter(s)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(s){return this._context.createDelay(s)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(s,o){return this._context.createIIRFilter(s,o)}createPanner(){return this._context.createPanner()}createPeriodicWave(s,o,u){return this._context.createPeriodicWave(s,o,u)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(s){return Gt(Ao(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(s)}createMediaElementSource(s){return Gt(Ao(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(s)}createMediaStreamDestination(){return Gt(Ao(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(s){return this._context.decodeAudioData(s)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(s){Gt(!this._initialized,"The listener cannot be set after initialization."),this._listener=s}get transport(){return this.initialize(),this._transport}set transport(s){Gt(!this._initialized,"The transport cannot be set after initialization."),this._transport=s}get draw(){return this.initialize(),this._draw}set draw(s){Gt(!this._initialized,"Draw cannot be set after initialization."),this._draw=s}get destination(){return this.initialize(),this._destination}set destination(s){Gt(!this._initialized,"The destination cannot be set after initialization."),this._destination=s}createAudioWorkletNode(s,o){return(function(u,p,v){return Gt(Ae(Mw),"AudioWorkletNode only works in a secure context (https or localhost)"),new(u instanceof(Is==null?void 0:Is.BaseAudioContext)?Is==null?void 0:Is.AudioWorkletNode:Mw)(u,p,v)})(this.rawContext,s,o)}addAudioWorkletModule(s){return Re(this,void 0,void 0,(function*(){Gt(Ae(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(s)),yield this._workletPromise}))}workletsAreReady(){return Re(this,void 0,void 0,(function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(s){this._ticker.updateInterval=s}get clockSource(){return this._ticker.type}set clockSource(s){this._ticker.type=s}get lookAhead(){return this._lookAhead}set lookAhead(s){this._lookAhead=s,this.updateInterval=s?s/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Ao(this._context)?this._context.resume():Promise.resolve()}close(){return Re(this,void 0,void 0,(function*(){var s;Ao(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(s=this,Rw.forEach((o=>o(s))))}))}getConstant(s){if(this._constants.has(s))return this._constants.get(s);{const o=this._context.createBuffer(1,128,this._context.sampleRate),u=o.getChannelData(0);for(let v=0;v<u.length;v++)u[v]=s;const p=this._context.createBufferSource();return p.channelCount=1,p.channelCountMode="explicit",p.buffer=o,p.loop=!0,p.start(0),this._constants.set(s,p),p}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((s=>this._constants[s].disconnect())),this.close(),this}_timeoutLoop(){const s=this.now();this._timeouts.forEachBefore(s,(o=>{o.callback(),this._timeouts.remove(o)}))}setTimeout(s,o){this._timeoutIds++;const u=this.now();return this._timeouts.add({callback:s,id:this._timeoutIds,time:u+o}),this._timeoutIds}clearTimeout(s){return this._timeouts.forEach((o=>{o.id===s&&this._timeouts.remove(o)})),this}clearInterval(s){return this.clearTimeout(s)}setInterval(s,o){const u=++this._timeoutIds,p=()=>{const v=this.now();this._timeouts.add({callback:()=>{s(),p()},id:u,time:v+o})};return p(),u}}function zt(g,s){Un(s)?s.forEach((o=>zt(g,o))):Object.defineProperty(g,s,{enumerable:!0,writable:!1})}function Sa(g,s){Un(s)?s.forEach((o=>Sa(g,o))):Object.defineProperty(g,s,{writable:!0})}const ce=()=>{};class ge extends er{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ce;const s=at(ge.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=s.reverse,this.onload=s.onload,Ai(s.url)?this.load(s.url).catch(s.onerror):s.url&&this.set(s.url)}static getDefaults(){return{onerror:ce,onload:ce,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ve().sampleRate}set(s){return s instanceof ge?s.loaded?this._buffer=s.get():s.onload=()=>{this.set(s),this.onload(this)}:this._buffer=s,this._reversed&&this._reverse(),this}get(){return this._buffer}load(s){return Re(this,void 0,void 0,(function*(){const o=ge.load(s).then((u=>{this.set(u),this.onload(this)}));ge.downloads.push(o);try{yield o}finally{const u=ge.downloads.indexOf(o);ge.downloads.splice(u,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(s){const o=Un(s)&&s[0].length>0,u=o?s.length:1,p=o?s[0].length:s.length,v=Ve(),C=v.createBuffer(u,p,v.sampleRate),_=o||u!==1?s:[s];for(let E=0;E<u;E++)C.copyToChannel(_[E],E);return this._buffer=C,this}toMono(s){if(Fs(s))this.fromArray(this.toArray(s));else{let o=new Float32Array(this.length);const u=this.numberOfChannels;for(let p=0;p<u;p++){const v=this.toArray(p);for(let C=0;C<v.length;C++)o[C]+=v[C]}o=o.map((p=>p/u)),this.fromArray(o)}return this}toArray(s){if(Fs(s))return this.getChannelData(s);if(this.numberOfChannels===1)return this.toArray(0);{const o=[];for(let u=0;u<this.numberOfChannels;u++)o[u]=this.getChannelData(u);return o}}getChannelData(s){return this._buffer?this._buffer.getChannelData(s):new Float32Array(0)}slice(s,o=this.duration){Gt(this.loaded,"Buffer is not loaded");const u=Math.floor(s*this.sampleRate),p=Math.floor(o*this.sampleRate);Gt(u<p,"The start time must be less than the end time");const v=p-u,C=Ve().createBuffer(this.numberOfChannels,v,this.sampleRate);for(let _=0;_<this.numberOfChannels;_++)C.copyToChannel(this.getChannelData(_).subarray(u,p),_);return new ge(C)}_reverse(){if(this.loaded)for(let s=0;s<this.numberOfChannels;s++)this.getChannelData(s).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(s){this._reversed!==s&&(this._reversed=s,this._reverse())}static fromArray(s){return new ge().fromArray(s)}static fromUrl(s){return Re(this,void 0,void 0,(function*(){return yield new ge().load(s)}))}static load(s){return Re(this,void 0,void 0,(function*(){const o=ge.baseUrl===""||ge.baseUrl.endsWith("/")?ge.baseUrl:ge.baseUrl+"/",u=yield fetch(o+s);if(!u.ok)throw new Error(`could not load url: ${s}`);const p=yield u.arrayBuffer();return yield Ve().decodeAudioData(p)}))}static supportsType(s){const o=s.split("."),u=o[o.length-1];return document.createElement("audio").canPlayType("audio/"+u)!==""}static loaded(){return Re(this,void 0,void 0,(function*(){for(yield Promise.resolve();ge.downloads.length;)yield ge.downloads[0]}))}}ge.baseUrl="",ge.downloads=[];class co extends lo{constructor(){var s,o,u;super({clockSource:"offline",context:Ec(arguments[0])?arguments[0]:(s=arguments[0],o=arguments[1]*arguments[2],u=arguments[2],new Ax(s,o,u)),lookAhead:0,updateInterval:Ec(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Ec(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(s){return Re(this,void 0,void 0,(function*(){let o=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,o++;const u=Math.floor(this.sampleRate/128);s&&o%u==0&&(yield new Promise((p=>setTimeout(p,1))))}}))}render(){return Re(this,arguments,void 0,(function*(s=!0){yield this.workletsAreReady(),yield this._renderClock(s);const o=yield this._context.startRendering();return new ge(o)}))}close(){return Promise.resolve()}}const Hw=new class extends Bd{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(g,s,o){return{}}createChannelMerger(g){return{}}createChannelSplitter(g){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(g){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(g,s){return{}}createPanner(){return{}}createPeriodicWave(g,s,o){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(g){return{}}createMediaElementSource(g){return{}}createMediaStreamDestination(){return{}}decodeAudioData(g){return Promise.resolve({})}createAudioWorkletNode(g,s){return{}}get rawContext(){return{}}addAudioWorkletModule(g){return Re(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(g,s){return 0}clearTimeout(g){return this}setInterval(g,s){return 0}clearInterval(g){return this}getConstant(g){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(g){}get destination(){return{}}set destination(g){}now(){return 0}immediate(){return 0}};let xa=Hw;function Ve(){return xa===Hw&&dx&&Mc(new lo),xa}function Mc(g,s=!1){s&&xa.dispose(),xa=Ao(g)?new lo(g):Ec(g)?new co(g):g}function mx(){return xa.resume()}if(Is&&!Is.TONE_SILENCE_LOGGING){const s=` * Tone.js v${c} * `;console.log(`%c${s}`,"background: #000; color: #fff")}function uo(g){return Math.pow(10,g/20)}function Ea(g){return Math.log(g)/Math.LN10*20}function ho(g){return Math.pow(2,g/12)}let Qc=440;function Pr(g){return Math.round(Nw(g))}function Nw(g){return 69+12*Math.log2(g/Qc)}function yd(g){return Qc*Math.pow(2,(g-69)/12)}class Cd extends er{constructor(s,o,u){super(),this.defaultUnits="s",this._val=o,this._units=u,this.context=s,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:s=>this._frequencyToUnits(parseFloat(s)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:s=>this._ticksToUnits(parseInt(s,10)),regexp:/^(\d+)i$/i},m:{method:s=>this._beatsToUnits(parseInt(s,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(s,o)=>{const u=parseInt(s,10),p=o==="."?1.5:1;return u===1?this._beatsToUnits(this._getTimeSignature())*p:this._beatsToUnits(4/u)*p},regexp:/^(\d+)n(\.?)$/i},number:{method:s=>this._expressions[this.defaultUnits].method.call(this,s),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:s=>this._secondsToUnits(parseFloat(s)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:s=>parseInt(s,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:s=>{const o=parseInt(s,10);return this._beatsToUnits(8/(3*Math.floor(o)))},regexp:/^(\d+)t$/i},tr:{method:(s,o,u)=>{let p=0;return s&&s!=="0"&&(p+=this._beatsToUnits(this._getTimeSignature()*parseFloat(s))),o&&o!=="0"&&(p+=this._beatsToUnits(parseFloat(o))),u&&u!=="0"&&(p+=this._beatsToUnits(parseFloat(u)/4)),p},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Cd&&this.fromType(this._val),ms(this._val))return this._noArg();if(Ai(this._val)&&ms(this._units)){for(const s in this._expressions)if(this._expressions[s].regexp.test(this._val.trim())){this._units=s;break}}else if(tr(this._val)){let s=0;for(const o in this._val)if(Ae(this._val[o])){const u=this._val[o];s+=new this.constructor(this.context,o).valueOf()*u}return s}if(Ae(this._units)){const s=this._expressions[this._units],o=this._val.toString().trim().match(s.regexp);return o?s.method.apply(this,o.slice(1)):s.method.call(this,this._val)}return Ai(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(s){return 1/s}_beatsToUnits(s){return 60/this._getBpm()*s}_secondsToUnits(s){return s}_ticksToUnits(s){return s*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(s){switch(this._units=void 0,this.defaultUnits){case"s":this._val=s.toSeconds();break;case"i":this._val=s.toTicks();break;case"hz":this._val=s.toFrequency();break;case"midi":this._val=s.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Qs extends Cd{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:s=>this._now()+new this.constructor(this.context,s).valueOf(),regexp:/^\+(.+)/},quantize:{method:s=>{const o=new Qs(this.context,s).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(o))},regexp:/^@(.+)/}})}quantize(s,o=1){const u=new this.constructor(this.context,s).valueOf(),p=this.valueOf();return p+(Math.round(p/u)*u-p)*o}toNotation(){const s=this.toSeconds(),o=["1m"];for(let v=1;v<9;v++){const C=Math.pow(2,v);o.push(C+"n."),o.push(C+"n"),o.push(C+"t")}o.push("0");let u=o[0],p=new Qs(this.context,o[0]).toSeconds();return o.forEach((v=>{const C=new Qs(this.context,v).toSeconds();Math.abs(C-s)<Math.abs(p-s)&&(u=v,p=C)})),u}toBarsBeatsSixteenths(){const s=this._beatsToUnits(1);let o=this.valueOf()/s;o=parseFloat(o.toFixed(4));const u=Math.floor(o/this._getTimeSignature());let p=o%1*4;o=Math.floor(o)%this._getTimeSignature();const v=p.toString();return v.length>3&&(p=parseFloat(parseFloat(v).toFixed(3))),[u,o,p].join(":")}toTicks(){const s=this._beatsToUnits(1);return this.valueOf()/s*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Pr(this.toFrequency())}_now(){return this.context.now()}}function gx(g,s){return new Qs(Ve(),g,s)}class es extends Qs{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Qc}static set A4(s){(function(o){Qc=o})(s)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(s){return this.defaultUnits==="midi"?s:es.mtof(s)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(s,o){const u=wx[s.toLowerCase()]+12*(parseInt(o,10)+1);return this.defaultUnits==="midi"?u:es.mtof(u)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(s,o,u){let p=1;return s&&s!=="0"&&(p*=this._beatsToUnits(this._getTimeSignature()*parseFloat(s))),o&&o!=="0"&&(p*=this._beatsToUnits(parseFloat(o))),u&&u!=="0"&&(p*=this._beatsToUnits(parseFloat(u)/4)),p}}})}transpose(s){return new es(this.context,this.valueOf()*ho(s))}harmonize(s){return s.map((o=>this.transpose(o)))}toMidi(){return Pr(this.valueOf())}toNote(){const s=this.toFrequency(),o=Math.log2(s/es.A4);let u=Math.round(12*o)+57;const p=Math.floor(u/12);return p<0&&(u+=-12*p),vx[u%12]+p.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const s=this._beatsToUnits(1),o=this.valueOf()/s;return Math.floor(o*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(s){return s}_ticksToUnits(s){return 1/(60*s/(this._getBpm()*this._getPPQ()))}_beatsToUnits(s){return 1/super._beatsToUnits(s)}_secondsToUnits(s){return 1/s}static mtof(s){return yd(s)}static ftom(s){return Pr(s)}}const wx={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},vx=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Bx(g,s){return new es(Ve(),g,s)}class dn extends Qs{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function yx(g,s){return new dn(Ve(),g,s)}class Sn extends er{constructor(){super();const s=at(Sn.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=s.context}static getDefaults(){return{context:Ve()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(s){return Dw(s),new Qs(this.context,s).toSeconds()}toFrequency(s){return new es(this.context,s).toFrequency()}toTicks(s){return new dn(this.context,s).toTicks()}_getPartialProperties(s){const o=this.get();return Object.keys(o).forEach((u=>{ms(s[u])&&delete o[u]})),o}get(){const s=this.constructor.getDefaults();return Object.keys(s).forEach((o=>{if(Reflect.has(this,o)){const u=this[o];Ae(u)&&Ae(u.value)&&Ae(u.setValueAtTime)?s[o]=u.value:u instanceof Sn?s[o]=u._getPartialProperties(s[o]):Un(u)||Fs(u)||Ai(u)||fd(u)?s[o]=u:delete s[o]}})),s}set(s){return Object.keys(s).forEach((o=>{Reflect.has(this,o)&&Ae(this[o])&&(this[o]&&Ae(this[o].value)&&Ae(this[o].setValueAtTime)?this[o].value!==s[o]&&(this[o].value=s[o]):this[o]instanceof Sn?this[o].set(s[o]):this[o]=s[o])})),this}}class fo extends Ms{constructor(s="stopped"){super(),this.name="StateTimeline",this._initial=s,this.setStateAtTime(this._initial,0)}getValueAtTime(s){const o=this.get(s);return o!==null?o.state:this._initial}setStateAtTime(s,o,u){return wn(o,0),this.add(Object.assign({},u,{state:s,time:o})),this}getLastState(s,o){for(let u=this._search(o);u>=0;u--){const p=this._timeline[u];if(p.state===s)return p}}getNextState(s,o){const u=this._search(o);if(u!==-1)for(let p=u;p<this._timeline.length;p++){const v=this._timeline[p];if(v.state===s)return v}}}class te extends Sn{constructor(){const s=at(te.getDefaults(),arguments,["param","units","convert"]);for(super(s),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Gt(Ae(s.param)&&(mA(s.param)||s.param instanceof te),"param must be an AudioParam");!mA(s.param);)s.param=s.param._param;this._swappable=!!Ae(s.swappable)&&s.swappable,this._swappable?(this.input=this.context.createGain(),this._param=s.param,this.input.connect(this._param)):this._param=this.input=s.param,this._events=new Ms(1e3),this._initialValue=this._param.defaultValue,this.units=s.units,this.convert=s.convert,this._minValue=s.minValue,this._maxValue=s.maxValue,Ae(s.value)&&s.value!==this._toType(this._initialValue)&&this.setValueAtTime(s.value,0)}static getDefaults(){return Object.assign(Sn.getDefaults(),{convert:!0,units:"number"})}get value(){const s=this.now();return this.getValueAtTime(s)}set value(s){this.cancelScheduledValues(this.now()),this.setValueAtTime(s,this.now())}get minValue(){return Ae(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Ae(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(s,o){return this.units===o}_assertRange(s){return Ae(this.maxValue)&&Ae(this.minValue)&&wn(s,this._fromType(this.minValue),this._fromType(this.maxValue)),s}_fromType(s){return this.convert&&!this.overridden?this._is(s,"time")?this.toSeconds(s):this._is(s,"decibels")?uo(s):this._is(s,"frequency")?this.toFrequency(s):s:this.overridden?0:s}_toType(s){return this.convert&&this.units==="decibels"?Ea(s):s}setValueAtTime(s,o){const u=this.toSeconds(o),p=this._fromType(s);return Gt(isFinite(p)&&isFinite(u),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(s)}, ${JSON.stringify(o)}`),this._assertRange(p),this.log(this.units,"setValueAtTime",s,u),this._events.add({time:u,type:"setValueAtTime",value:p}),this._param.setValueAtTime(p,u),this}getValueAtTime(s){const o=Math.max(this.toSeconds(s),0),u=this._events.getAfter(o),p=this._events.get(o);let v=this._initialValue;if(p===null)v=this._initialValue;else if(p.type!=="setTargetAtTime"||u!==null&&u.type!=="setValueAtTime")if(u===null)v=p.value;else if(u.type==="linearRampToValueAtTime"||u.type==="exponentialRampToValueAtTime"){let C=p.value;if(p.type==="setTargetAtTime"){const _=this._events.getBefore(p.time);C=_===null?this._initialValue:_.value}v=u.type==="linearRampToValueAtTime"?this._linearInterpolate(p.time,C,u.time,u.value,o):this._exponentialInterpolate(p.time,C,u.time,u.value,o)}else v=p.value;else{const C=this._events.getBefore(p.time);let _;_=C===null?this._initialValue:C.value,p.type==="setTargetAtTime"&&(v=this._exponentialApproach(p.time,_,p.value,p.constant,o))}return this._toType(v)}setRampPoint(s){s=this.toSeconds(s);let o=this.getValueAtTime(s);return this.cancelAndHoldAtTime(s),this._fromType(o)===0&&(o=this._toType(this._minOutput)),this.setValueAtTime(o,s),this}linearRampToValueAtTime(s,o){const u=this._fromType(s),p=this.toSeconds(o);return Gt(isFinite(u)&&isFinite(p),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(s)}, ${JSON.stringify(o)}`),this._assertRange(u),this._events.add({time:p,type:"linearRampToValueAtTime",value:u}),this.log(this.units,"linearRampToValueAtTime",s,p),this._param.linearRampToValueAtTime(u,p),this}exponentialRampToValueAtTime(s,o){let u=this._fromType(s);u=ai(u,0)?this._minOutput:u,this._assertRange(u);const p=this.toSeconds(o);return Gt(isFinite(u)&&isFinite(p),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(s)}, ${JSON.stringify(o)}`),this._events.add({time:p,type:"exponentialRampToValueAtTime",value:u}),this.log(this.units,"exponentialRampToValueAtTime",s,p),this._param.exponentialRampToValueAtTime(u,p),this}exponentialRampTo(s,o,u){return u=this.toSeconds(u),this.setRampPoint(u),this.exponentialRampToValueAtTime(s,u+this.toSeconds(o)),this}linearRampTo(s,o,u){return u=this.toSeconds(u),this.setRampPoint(u),this.linearRampToValueAtTime(s,u+this.toSeconds(o)),this}targetRampTo(s,o,u){return u=this.toSeconds(u),this.setRampPoint(u),this.exponentialApproachValueAtTime(s,u,o),this}exponentialApproachValueAtTime(s,o,u){o=this.toSeconds(o),u=this.toSeconds(u);const p=Math.log(u+1)/Math.log(200);return this.setTargetAtTime(s,o,p),this.cancelAndHoldAtTime(o+.9*u),this.linearRampToValueAtTime(s,o+u),this}setTargetAtTime(s,o,u){const p=this._fromType(s);Gt(isFinite(u)&&u>0,"timeConstant must be a number greater than 0");const v=this.toSeconds(o);return this._assertRange(p),Gt(isFinite(p)&&isFinite(v),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(s)}, ${JSON.stringify(o)}`),this._events.add({constant:u,time:v,type:"setTargetAtTime",value:p}),this.log(this.units,"setTargetAtTime",s,v,u),this._param.setTargetAtTime(p,v,u),this}setValueCurveAtTime(s,o,u,p=1){u=this.toSeconds(u),o=this.toSeconds(o);const v=this._fromType(s[0])*p;this.setValueAtTime(this._toType(v),o);const C=u/(s.length-1);for(let _=1;_<s.length;_++){const E=this._fromType(s[_])*p;this.linearRampToValueAtTime(this._toType(E),o+_*C)}return this}cancelScheduledValues(s){const o=this.toSeconds(s);return Gt(isFinite(o),`Invalid argument to cancelScheduledValues: ${JSON.stringify(s)}`),this._events.cancel(o),this._param.cancelScheduledValues(o),this.log(this.units,"cancelScheduledValues",o),this}cancelAndHoldAtTime(s){const o=this.toSeconds(s),u=this._fromType(this.getValueAtTime(o));Gt(isFinite(o),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(s)}`),this.log(this.units,"cancelAndHoldAtTime",o,"value="+u);const p=this._events.get(o),v=this._events.getAfter(o);return p&&ai(p.time,o)?v?(this._param.cancelScheduledValues(v.time),this._events.cancel(v.time)):(this._param.cancelAndHoldAtTime(o),this._events.cancel(o+this.sampleTime)):v&&(this._param.cancelScheduledValues(v.time),this._events.cancel(v.time),v.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(u),o):v.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(u),o)),this._events.add({time:o,type:"setValueAtTime",value:u}),this._param.setValueAtTime(u,o),this}rampTo(s,o=.1,u){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(s,o,u):this.linearRampTo(s,o,u),this}apply(s){const o=this.context.currentTime;s.setValueAtTime(this.getValueAtTime(o),o);const u=this._events.get(o);if(u&&u.type==="setTargetAtTime"){const p=this._events.getAfter(u.time),v=p?p.time:o+2,C=(v-o)/10;for(let _=o;_<v;_+=C)s.linearRampToValueAtTime(this.getValueAtTime(_),_)}return this._events.forEachAfter(this.context.currentTime,(p=>{p.type==="cancelScheduledValues"?s.cancelScheduledValues(p.time):p.type==="setTargetAtTime"?s.setTargetAtTime(p.value,p.time,p.constant):s[p.type](p.value,p.time)})),this}setParam(s){Gt(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const o=this.input;return o.disconnect(this._param),this.apply(s),this._param=s,o.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(s,o,u,p,v){return u+(o-u)*Math.exp(-(v-s)/p)}_linearInterpolate(s,o,u,p,v){return o+(v-s)/(u-s)*(p-o)}_exponentialInterpolate(s,o,u,p,v){return o*Math.pow(p/o,(v-s)/(u-s))}}class ft extends Sn{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Ae(this.input)?mA(this.input)||this.input instanceof te?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ae(this.output)?this.output.numberOfOutputs:0}_isAudioNode(s){return Ae(s)&&(s instanceof ft||Ur(s))}_getInternalNodes(){const s=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&s.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&s.push(this.output),s}_setChannelProperties(s){this._getInternalNodes().forEach((o=>{o.channelCount=s.channelCount,o.channelCountMode=s.channelCountMode,o.channelInterpretation=s.channelInterpretation}))}_getChannelProperties(){const s=this._getInternalNodes();Gt(s.length>0,"ToneAudioNode does not have any internal nodes");const o=s[0];return{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(s){const o=this._getChannelProperties();this._setChannelProperties(Object.assign(o,{channelCount:s}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(s){const o=this._getChannelProperties();this._setChannelProperties(Object.assign(o,{channelCountMode:s}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(s){const o=this._getChannelProperties();this._setChannelProperties(Object.assign(o,{channelInterpretation:s}))}connect(s,o=0,u=0){return ns(this,s,o,u),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return ro("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(s,o=0,u=0){return bd(this,s,o,u),this}chain(...s){return Us(this,...s),this}fan(...s){return s.forEach((o=>this.connect(o))),this}dispose(){return super.dispose(),Ae(this.input)&&(this.input instanceof ft?this.input.dispose():Ur(this.input)&&this.input.disconnect()),Ae(this.output)&&(this.output instanceof ft?this.output.dispose():Ur(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Us(...g){const s=g.shift();g.reduce(((o,u)=>(o instanceof ft?o.connect(u):Ur(o)&&ns(o,u),u)),s)}function ns(g,s,o=0,u=0){for(Gt(Ae(g),"Cannot connect from undefined node"),Gt(Ae(s),"Cannot connect to undefined node"),(s instanceof ft||Ur(s))&&Gt(s.numberOfInputs>0,"Cannot connect to node with no inputs"),Gt(g.numberOfOutputs>0,"Cannot connect from node with no outputs");s instanceof ft||s instanceof te;)Ae(s.input)&&(s=s.input);for(;g instanceof ft;)Ae(g.output)&&(g=g.output);mA(s)?g.connect(s,o):g.connect(s,o,u)}function bd(g,s,o=0,u=0){if(Ae(s))for(;s instanceof ft;)s=s.input;for(;!Ur(g);)Ae(g.output)&&(g=g.output);mA(s)?g.disconnect(s,o):Ur(s)?g.disconnect(s,o,u):g.disconnect()}function Cx(...g){const s=g.pop();Ae(s)&&g.forEach((o=>ns(o,s)))}class Wt extends ft{constructor(){const s=at(Wt.getDefaults(),arguments,["gain","units"]);super(s),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new te({context:this.context,convert:s.convert,param:this._gainNode.gain,units:s.units,value:s.gain,minValue:s.minValue,maxValue:s.maxValue}),zt(this,"gain")}static getDefaults(){return Object.assign(ft.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class po extends ft{constructor(s){super(s),this.onended=ce,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Wt({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(o){const u=this.toSeconds(o);return this._startTime!==-1&&u>=this._startTime&&(this._stopTime===-1||u<=this._stopTime)?"started":"stopped"},this._fadeIn=s.fadeIn,this._fadeOut=s.fadeOut,this._curve=s.curve,this.onended=s.onended}static getDefaults(){return Object.assign(ft.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ce})}_startGain(s,o=1){Gt(this._startTime===-1,"Source cannot be started more than once");const u=this.toSeconds(this._fadeIn);return this._startTime=s+u,this._startTime=Math.max(this._startTime,this.context.currentTime),u>0?(this._gainNode.gain.setValueAtTime(0,s),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(o,s+u):this._gainNode.gain.exponentialApproachValueAtTime(o,s,u)):this._gainNode.gain.setValueAtTime(o,s),this}stop(s){return this.log("stop",s),this._stopGain(this.toSeconds(s)),this}_stopGain(s){Gt(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const o=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(s)+o,this._stopTime=Math.max(this._stopTime,this.now()),o>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,o,s):this._gainNode.gain.targetRampTo(0,o,s):(this._gainNode.gain.cancelAndHoldAtTime(s),this._gainNode.gain.setValueAtTime(0,s)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const u=this._curve==="exponential"?2*o:0;this._stopSource(this.now()+u),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ce&&(this.onended(this),this.onended=ce,!this.context.isOffline)){const s=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(s):setTimeout(s,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Gt(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=ce,this}}class Uc extends po{constructor(){const s=at(Uc.getDefaults(),arguments,["offset"]);super(s),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),ns(this._source,this._gainNode),this.offset=new te({context:this.context,convert:s.convert,param:this._source.offset,units:s.units,value:s.offset,minValue:s.minValue,maxValue:s.maxValue})}static getDefaults(){return Object.assign(po.getDefaults(),{convert:!0,offset:1,units:"number"})}start(s){const o=this.toSeconds(s);return this.log("start",o),this._startGain(o),this._source.start(o),this}_stopSource(s){this._source.stop(s)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Yt extends ft{constructor(){const s=at(Yt.getDefaults(),arguments,["value","units"]);super(s),this.name="Signal",this.override=!0,this.output=this._constantSource=new Uc({context:this.context,convert:s.convert,offset:s.value,units:s.units,minValue:s.minValue,maxValue:s.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ft.getDefaults(),{convert:!0,units:"number",value:0})}connect(s,o=0,u=0){return Ta(this,s,o,u),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(s,o){return this._param.setValueAtTime(s,o),this}getValueAtTime(s){return this._param.getValueAtTime(s)}setRampPoint(s){return this._param.setRampPoint(s),this}linearRampToValueAtTime(s,o){return this._param.linearRampToValueAtTime(s,o),this}exponentialRampToValueAtTime(s,o){return this._param.exponentialRampToValueAtTime(s,o),this}exponentialRampTo(s,o,u){return this._param.exponentialRampTo(s,o,u),this}linearRampTo(s,o,u){return this._param.linearRampTo(s,o,u),this}targetRampTo(s,o,u){return this._param.targetRampTo(s,o,u),this}exponentialApproachValueAtTime(s,o,u){return this._param.exponentialApproachValueAtTime(s,o,u),this}setTargetAtTime(s,o,u){return this._param.setTargetAtTime(s,o,u),this}setValueCurveAtTime(s,o,u,p){return this._param.setValueCurveAtTime(s,o,u,p),this}cancelScheduledValues(s){return this._param.cancelScheduledValues(s),this}cancelAndHoldAtTime(s){return this._param.cancelAndHoldAtTime(s),this}rampTo(s,o,u){return this._param.rampTo(s,o,u),this}get value(){return this._param.value}set value(s){this._param.value=s}get convert(){return this._param.convert}set convert(s){this._param.convert=s}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(s){this._param.overridden=s}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(s){return this._param.apply(s),this}}function Ta(g,s,o,u){(s instanceof te||mA(s)||s instanceof Yt&&s.override)&&(s.cancelScheduledValues(0),s.setValueAtTime(0,0),s instanceof Yt&&(s.overridden=!0)),ns(g,s,o,u)}class _d extends te{constructor(){const s=at(_d.getDefaults(),arguments,["value"]);super(s),this.name="TickParam",this._events=new Ms(1/0),this._multiplier=1,this._multiplier=s.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(s.value)}),this.setValueAtTime(s.value,0)}static getDefaults(){return Object.assign(te.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(s,o,u){o=this.toSeconds(o),this.setRampPoint(o);const p=this._fromType(s),v=this._events.get(o),C=Math.round(Math.max(1/u,1));for(let _=0;_<=C;_++){const E=u*_+o,T=this._exponentialApproach(v.time,v.value,p,u,E);this.linearRampToValueAtTime(this._toType(T),E)}return this}setValueAtTime(s,o){const u=this.toSeconds(o);super.setValueAtTime(s,o);const p=this._events.get(u),v=this._events.previousEvent(p),C=this._getTicksUntilEvent(v,u);return p.ticks=Math.max(C,0),this}linearRampToValueAtTime(s,o){const u=this.toSeconds(o);super.linearRampToValueAtTime(s,o);const p=this._events.get(u),v=this._events.previousEvent(p),C=this._getTicksUntilEvent(v,u);return p.ticks=Math.max(C,0),this}exponentialRampToValueAtTime(s,o){o=this.toSeconds(o);const u=this._fromType(s),p=this._events.get(o),v=Math.round(Math.max(10*(o-p.time),1)),C=(o-p.time)/v;for(let _=0;_<=v;_++){const E=C*_+p.time,T=this._exponentialInterpolate(p.time,p.value,o,u,E);this.linearRampToValueAtTime(this._toType(T),E)}return this}_getTicksUntilEvent(s,o){if(s===null)s={ticks:0,time:0,type:"setValueAtTime",value:0};else if(ms(s.ticks)){const C=this._events.previousEvent(s);s.ticks=this._getTicksUntilEvent(C,s.time)}const u=this._fromType(this.getValueAtTime(s.time));let p=this._fromType(this.getValueAtTime(o));const v=this._events.get(o);return v&&v.time===o&&v.type==="setValueAtTime"&&(p=this._fromType(this.getValueAtTime(o-this.sampleTime))),.5*(o-s.time)*(u+p)+s.ticks}getTicksAtTime(s){const o=this.toSeconds(s),u=this._events.get(o);return Math.max(this._getTicksUntilEvent(u,o),0)}getDurationOfTicks(s,o){const u=this.toSeconds(o),p=this.getTicksAtTime(o);return this.getTimeOfTick(p+s)-u}getTimeOfTick(s){const o=this._events.get(s,"ticks"),u=this._events.getAfter(s,"ticks");if(o&&o.ticks===s)return o.time;if(o&&u&&u.type==="linearRampToValueAtTime"&&o.value!==u.value){const p=this._fromType(this.getValueAtTime(o.time)),v=(this._fromType(this.getValueAtTime(u.time))-p)/(u.time-o.time),C=Math.sqrt(Math.pow(p,2)-2*v*(o.ticks-s)),_=(-p+C)/v;return(_>0?_:(-p-C)/v)+o.time}return o?o.value===0?1/0:o.time+(s-o.ticks)/o.value:s/this._initialValue}ticksToTime(s,o){return this.getDurationOfTicks(s,o)}timeToTicks(s,o){const u=this.toSeconds(o),p=this.toSeconds(s),v=this.getTicksAtTime(u);return this.getTicksAtTime(u+p)-v}_fromType(s){return this.units==="bpm"&&this.multiplier?1/(60/s/this.multiplier):super._fromType(s)}_toType(s){return this.units==="bpm"&&this.multiplier?s/this.multiplier*60:super._toType(s)}get multiplier(){return this._multiplier}set multiplier(s){const o=this.value;this._multiplier=s,this.cancelScheduledValues(0),this.setValueAtTime(o,0)}}class Sd extends Yt{constructor(){const s=at(Sd.getDefaults(),arguments,["value"]);super(s),this.name="TickSignal",this.input=this._param=new _d({context:this.context,convert:s.convert,multiplier:s.multiplier,param:this._constantSource.offset,units:s.units,value:s.value})}static getDefaults(){return Object.assign(Yt.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(s,o){return this._param.ticksToTime(s,o)}timeToTicks(s,o){return this._param.timeToTicks(s,o)}getTimeOfTick(s){return this._param.getTimeOfTick(s)}getDurationOfTicks(s,o){return this._param.getDurationOfTicks(s,o)}getTicksAtTime(s){return this._param.getTicksAtTime(s)}get multiplier(){return this._param.multiplier}set multiplier(s){this._param.multiplier=s}dispose(){return super.dispose(),this._param.dispose(),this}}class xd extends Sn{constructor(){const s=at(xd.getDefaults(),arguments,["frequency"]);super(s),this.name="TickSource",this._state=new fo,this._tickOffset=new Ms,this._ticksAtTime=new Ms,this._secondsAtTime=new Ms,this.frequency=new Sd({context:this.context,units:s.units,value:s.frequency}),zt(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Sn.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(s,o){const u=this.toSeconds(s);return this._state.getValueAtTime(u)!=="started"&&(this._state.setStateAtTime("started",u),Ae(o)&&this.setTicksAtTime(o,u),this._ticksAtTime.cancel(u),this._secondsAtTime.cancel(u)),this}stop(s){const o=this.toSeconds(s);if(this._state.getValueAtTime(o)==="stopped"){const u=this._state.get(o);u&&u.time>0&&(this._tickOffset.cancel(u.time),this._state.cancel(u.time))}return this._state.cancel(o),this._state.setStateAtTime("stopped",o),this.setTicksAtTime(0,o),this._ticksAtTime.cancel(o),this._secondsAtTime.cancel(o),this}pause(s){const o=this.toSeconds(s);return this._state.getValueAtTime(o)==="started"&&(this._state.setStateAtTime("paused",o),this._ticksAtTime.cancel(o),this._secondsAtTime.cancel(o)),this}cancel(s){return s=this.toSeconds(s),this._state.cancel(s),this._tickOffset.cancel(s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s),this}getTicksAtTime(s){const o=this.toSeconds(s),u=this._state.getLastState("stopped",o),p=this._ticksAtTime.get(o),v={state:"paused",time:o};this._state.add(v);let C=p||u,_=p?p.ticks:0,E=null;return this._state.forEachBetween(C.time,o+this.sampleTime,(T=>{let I=C.time;const M=this._tickOffset.get(T.time);M&&M.time>=C.time&&(_=M.ticks,I=M.time),C.state==="started"&&T.state!=="started"&&(_+=this.frequency.getTicksAtTime(T.time)-this.frequency.getTicksAtTime(I),T.time!==v.time&&(E={state:T.state,time:T.time,ticks:_})),C=T})),this._state.remove(v),E&&this._ticksAtTime.add(E),_}get ticks(){return this.getTicksAtTime(this.now())}set ticks(s){this.setTicksAtTime(s,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(s){const o=this.now(),u=this.frequency.timeToTicks(s,o);this.setTicksAtTime(u,o)}getSecondsAtTime(s){s=this.toSeconds(s);const o=this._state.getLastState("stopped",s),u={state:"paused",time:s};this._state.add(u);const p=this._secondsAtTime.get(s);let v=p||o,C=p?p.seconds:0,_=null;return this._state.forEachBetween(v.time,s+this.sampleTime,(E=>{let T=v.time;const I=this._tickOffset.get(E.time);I&&I.time>=v.time&&(C=I.seconds,T=I.time),v.state==="started"&&E.state!=="started"&&(C+=E.time-T,E.time!==u.time&&(_={state:E.state,time:E.time,seconds:C})),v=E})),this._state.remove(u),_&&this._secondsAtTime.add(_),C}setTicksAtTime(s,o){return o=this.toSeconds(o),this._tickOffset.cancel(o),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(s,o),ticks:s,time:o}),this._ticksAtTime.cancel(o),this._secondsAtTime.cancel(o),this}getStateAtTime(s){return s=this.toSeconds(s),this._state.getValueAtTime(s)}getTimeOfTick(s,o=this.now()){const u=this._tickOffset.get(o),p=this._state.get(o),v=Math.max(u.time,p.time),C=this.frequency.getTicksAtTime(v)+s-u.ticks;return this.frequency.getTimeOfTick(C)}forEachTickBetween(s,o,u){let p=this._state.get(s);this._state.forEachBetween(s,o,(C=>{p&&p.state==="started"&&C.state!=="started"&&this.forEachTickBetween(Math.max(p.time,s),C.time-this.sampleTime,u),p=C}));let v=null;if(p&&p.state==="started"){const C=Math.max(p.time,s),_=this.frequency.getTicksAtTime(C),E=_-this.frequency.getTicksAtTime(p.time);let T=Math.ceil(E)-E;T=ai(T,1)?0:T;let I=this.frequency.getTimeOfTick(_+T);for(;I<o;){try{u(I,Math.round(this.getTicksAtTime(I)))}catch(M){v=M;break}I+=this.frequency.getDurationOfTicks(1,I)}}if(v)throw v;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class mo extends Sn{constructor(){const s=at(mo.getDefaults(),arguments,["callback","frequency"]);super(s),this.name="Clock",this.callback=ce,this._lastUpdate=0,this._state=new fo("stopped"),this._boundLoop=this._loop.bind(this),this.callback=s.callback,this._tickSource=new xd({context:this.context,frequency:s.frequency,units:s.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,zt(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Sn.getDefaults(),{callback:ce,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(s,o){pd(this.context);const u=this.toSeconds(s);return this.log("start",u),this._state.getValueAtTime(u)!=="started"&&(this._state.setStateAtTime("started",u),this._tickSource.start(u,o),u<this._lastUpdate&&this.emit("start",u,o)),this}stop(s){const o=this.toSeconds(s);return this.log("stop",o),this._state.cancel(o),this._state.setStateAtTime("stopped",o),this._tickSource.stop(o),o<this._lastUpdate&&this.emit("stop",o),this}pause(s){const o=this.toSeconds(s);return this._state.getValueAtTime(o)==="started"&&(this._state.setStateAtTime("paused",o),this._tickSource.pause(o),o<this._lastUpdate&&this.emit("pause",o)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(s){this._tickSource.ticks=s}get seconds(){return this._tickSource.seconds}set seconds(s){this._tickSource.seconds=s}getSecondsAtTime(s){return this._tickSource.getSecondsAtTime(s)}setTicksAtTime(s,o){return this._tickSource.setTicksAtTime(s,o),this}getTimeOfTick(s,o=this.now()){return this._tickSource.getTimeOfTick(s,o)}getTicksAtTime(s){return this._tickSource.getTicksAtTime(s)}nextTickTime(s,o){const u=this.toSeconds(o),p=this.getTicksAtTime(u);return this._tickSource.getTimeOfTick(p+s,u)}_loop(){const s=this._lastUpdate,o=this.now();this._lastUpdate=o,this.log("loop",s,o),s!==o&&(this._state.forEachBetween(s,o,(u=>{switch(u.state){case"started":const p=this._tickSource.getTicksAtTime(u.time);this.emit("start",u.time,p);break;case"stopped":u.time!==0&&this.emit("stop",u.time);break;case"paused":this.emit("pause",u.time)}})),this._tickSource.forEachTickBetween(s,o,((u,p)=>{this.callback(u,p)})))}getStateAtTime(s){const o=this.toSeconds(s);return this._state.getValueAtTime(o)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}ao.mixin(mo);class Ps extends ft{constructor(){const s=at(Ps.getDefaults(),arguments,["delayTime","maxDelay"]);super(s),this.name="Delay";const o=this.toSeconds(s.maxDelay);this._maxDelay=Math.max(o,this.toSeconds(s.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(o),this.delayTime=new te({context:this.context,param:this._delayNode.delayTime,units:"time",value:s.delayTime,minValue:0,maxValue:this.maxDelay}),zt(this,"delayTime")}static getDefaults(){return Object.assign(ft.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class nr extends ft{constructor(){const s=at(nr.getDefaults(),arguments,["volume"]);super(s),this.name="Volume",this.input=this.output=new Wt({context:this.context,gain:s.volume,units:"decibels"}),this.volume=this.output.gain,zt(this,"volume"),this._unmutedVolume=s.volume,this.mute=s.mute}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(s){!this.mute&&s?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!s&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Ed extends ft{constructor(){const s=at(Ed.getDefaults(),arguments);super(s),this.name="Destination",this.input=new nr({context:this.context}),this.output=new Wt({context:this.context}),this.volume=this.input.volume,Us(this.input,this.output,this.context.rawContext.destination),this.mute=s.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(s){this.input.mute=s}chain(...s){return this.input.disconnect(),s.unshift(this.input),s.push(this.output),Us(...s),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Fc((g=>{g.destination=new Ed({context:g})})),Ic((g=>{g.destination.dispose()}));class bx extends ft{constructor(){super(...arguments),this.name="Listener",this.positionX=new te({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new te({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new te({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new te({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new te({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new te({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new te({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new te({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new te({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ft.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}function _x(g,s){return Re(this,arguments,void 0,(function*(o,u,p=2,v=Ve().sampleRate){const C=Ve(),_=new co(p,u,v);Mc(_),yield o(_);const E=_.render();Mc(C);const T=yield E;return new ge(T)}))}Fc((g=>{g.listener=new bx({context:g})})),Ic((g=>{g.listener.dispose()}));class go extends er{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const s=at(go.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=s.baseUrl,Object.keys(s.urls).forEach((o=>{this._loadingCount++;const u=s.urls[o];this.add(o,u,this._bufferLoaded.bind(this,s.onload),s.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:ce,onload:ce,urls:{}}}has(s){return this._buffers.has(s.toString())}get(s){return Gt(this.has(s),`ToneAudioBuffers has no buffer named: ${s}`),this._buffers.get(s.toString())}_bufferLoaded(s){this._loadingCount--,this._loadingCount===0&&s&&s()}get loaded(){return Array.from(this._buffers).every((([s,o])=>o.loaded))}add(s,o,u=ce,p=ce){return Ai(o)?(this.baseUrl&&o.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(s.toString(),new ge(this.baseUrl+o,u,p))):this._buffers.set(s.toString(),new ge(o,u,p)),this}dispose(){return super.dispose(),this._buffers.forEach((s=>s.dispose())),this._buffers.clear(),this}}class wo extends es{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(s){return Pr(super._frequencyToUnits(s))}_ticksToUnits(s){return Pr(super._ticksToUnits(s))}_beatsToUnits(s){return Pr(super._beatsToUnits(s))}_secondsToUnits(s){return Pr(super._secondsToUnits(s))}toMidi(){return this.valueOf()}toFrequency(){return yd(this.toMidi())}transpose(s){return new wo(this.context,this.toMidi()+s)}}function Sx(g,s){return new wo(Ve(),g,s)}class ze extends dn{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(s){return this._getPPQ()*s}_secondsToUnits(s){return Math.floor(s/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(s){return s}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function xx(g,s){return new ze(Ve(),g,s)}class Ex extends Sn{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Ms,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(s,o){return this._events.add({callback:s,time:this.toSeconds(o)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(s){return this._events.cancel(this.toSeconds(s)),this}_drawLoop(){const s=this.context.currentTime;this._events.forEachBefore(s+this.anticipation,(o=>{s-o.time<=this.expiration&&o.callback(),this._events.remove(o)})),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Fc((g=>{g.draw=new Ex({context:g})})),Ic((g=>{g.draw.dispose()}));class Ow extends er{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(s){Gt(Ae(s.time),"Events must have a time property"),Gt(Ae(s.duration),"Events must have a duration parameter"),s.time=s.time.valueOf();let o=new Tx(s.time,s.time+s.duration,s);for(this._root===null?this._root=o:this._root.insert(o),this._length++;o!==null;)o.updateHeight(),o.updateMax(),this._rebalance(o),o=o.parent;return this}remove(s){if(this._root!==null){const o=[];this._root.search(s.time,o);for(const u of o)if(u.event===s){this._removeNode(u),this._length--;break}}return this}get length(){return this._length}cancel(s){return this.forEachFrom(s,(o=>this.remove(o))),this}_setRoot(s){this._root=s,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(s,o){s.parent!==null?(s.isLeftChild()?s.parent.left=o:s.parent.right=o,this._rebalance(s.parent)):this._setRoot(o)}_removeNode(s){if(s.left===null&&s.right===null)this._replaceNodeInParent(s,null);else if(s.right===null)this._replaceNodeInParent(s,s.left);else if(s.left===null)this._replaceNodeInParent(s,s.right);else{let o,u=null;if(s.getBalance()>0)if(s.left.right===null)o=s.left,o.right=s.right,u=o;else{for(o=s.left.right;o.right!==null;)o=o.right;o.parent&&(o.parent.right=o.left,u=o.parent,o.left=s.left,o.right=s.right)}else if(s.right.left===null)o=s.right,o.left=s.left,u=o;else{for(o=s.right.left;o.left!==null;)o=o.left;o.parent&&(o.parent.left=o.right,u=o.parent,o.left=s.left,o.right=s.right)}s.parent!==null?s.isLeftChild()?s.parent.left=o:s.parent.right=o:this._setRoot(o),u&&this._rebalance(u)}s.dispose()}_rotateLeft(s){const o=s.parent,u=s.isLeftChild(),p=s.right;p&&(s.right=p.left,p.left=s),o!==null?u?o.left=p:o.right=p:this._setRoot(p)}_rotateRight(s){const o=s.parent,u=s.isLeftChild(),p=s.left;p&&(s.left=p.right,p.right=s),o!==null?u?o.left=p:o.right=p:this._setRoot(p)}_rebalance(s){const o=s.getBalance();o>1&&s.left?s.left.getBalance()<0?this._rotateLeft(s.left):this._rotateRight(s):o<-1&&s.right&&(s.right.getBalance()>0?this._rotateRight(s.right):this._rotateLeft(s))}get(s){if(this._root!==null){const o=[];if(this._root.search(s,o),o.length>0){let u=o[0];for(let p=1;p<o.length;p++)o[p].low>u.low&&(u=o[p]);return u.event}}return null}forEach(s){if(this._root!==null){const o=[];this._root.traverse((u=>o.push(u))),o.forEach((u=>{u.event&&s(u.event)}))}return this}forEachAtTime(s,o){if(this._root!==null){const u=[];this._root.search(s,u),u.forEach((p=>{p.event&&o(p.event)}))}return this}forEachFrom(s,o){if(this._root!==null){const u=[];this._root.searchAfter(s,u),u.forEach((p=>{p.event&&o(p.event)}))}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse((s=>s.dispose())),this._root=null,this}}class Tx{constructor(s,o,u){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=u,this.low=s,this.high=o,this.max=this.high}insert(s){s.low<=this.low?this.left===null?this.left=s:this.left.insert(s):this.right===null?this.right=s:this.right.insert(s)}search(s,o){s>this.max||(this.left!==null&&this.left.search(s,o),this.low<=s&&this.high>s&&o.push(this),this.low>s||this.right!==null&&this.right.search(s,o))}searchAfter(s,o){this.low>=s&&(o.push(this),this.left!==null&&this.left.searchAfter(s,o)),this.right!==null&&this.right.searchAfter(s,o)}traverse(s){s(this),this.left!==null&&this.left.traverse(s),this.right!==null&&this.right.traverse(s)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let s=0;return this.left!==null&&this.right!==null?s=this.left.height-this.right.height:this.left!==null?s=this.left.height+1:this.right!==null&&(s=-(this.right.height+1)),s}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(s){this._left=s,s!==null&&(s.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(s){this._right=s,s!==null&&(s.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Fx extends er{constructor(s){super(),this.name="TimelineValue",this._timeline=new Ms({memory:10}),this._initialValue=s}set(s,o){return this._timeline.add({value:s,time:o}),this}get(s){const o=this._timeline.get(s);return o?o.value:this._initialValue}}class Ds extends ft{constructor(){super(at(Ds.getDefaults(),arguments,["context"]))}connect(s,o=0,u=0){return Ta(this,s,o,u),this}}class li extends Ds{constructor(){const s=at(li.getDefaults(),arguments,["mapping","length"]);super(s),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Un(s.mapping)||s.mapping instanceof Float32Array?this.curve=Float32Array.from(s.mapping):Qw(s.mapping)&&this.setMap(s.mapping,s.length)}static getDefaults(){return Object.assign(Yt.getDefaults(),{length:1024})}setMap(s,o=1024){const u=new Float32Array(o);for(let p=0,v=o;p<v;p++){const C=p/(v-1)*2-1;u[p]=s(C,p)}return this.curve=u,this}get curve(){return this._shaper.curve}set curve(s){this._shaper.curve=s}get oversample(){return this._shaper.oversample}set oversample(s){Gt(["none","2x","4x"].some((o=>o.includes(s))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=s}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class vo extends Ds{constructor(){const s=at(vo.getDefaults(),arguments,["value"]);super(s),this.name="Pow",this._exponentScaler=this.input=this.output=new li({context:this.context,mapping:this._expFunc(s.value),length:8192}),this._exponent=s.value}static getDefaults(){return Object.assign(Ds.getDefaults(),{value:1})}_expFunc(s){return o=>Math.pow(Math.abs(o),s)}get value(){return this._exponent}set value(s){this._exponent=s,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Dr{constructor(s,o){this.id=Dr._eventId++,this._remainderTime=0;const u=Object.assign(Dr.getDefaults(),o);this.transport=s,this.callback=u.callback,this._once=u.once,this.time=Math.floor(u.time),this._remainderTime=u.time-this.time}static getDefaults(){return{callback:ce,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(s){if(this.callback){const o=this.transport.bpm.getDurationOfTicks(1,s);this.callback(s+this._remainderTime*o),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Dr._eventId=0;class Td extends Dr{constructor(s,o){super(s,o),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const u=Object.assign(Td.getDefaults(),o);this.duration=u.duration,this._interval=u.interval,this._nextTick=u.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Dr.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(s){this._createEvents(s),super.invoke(s)}_createEvent(){return Tc(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new ze(this.context,this._nextTick).toSeconds()):-1}_createEvents(s){Tc(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ze(this.context,this._nextTick).toSeconds()))}_restart(s){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const o=this.transport.getTicksAtTime(s);oo(o,this.time)&&(this._nextTick=this.floatTime+Math.ceil((o-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Pc extends Sn{constructor(){const s=at(Pc.getDefaults(),arguments);super(s),this.name="Transport",this._loop=new Fx(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Ms,this._repeatedEvents=new Ow,this._syncedSignals=[],this._swingAmount=0,this._ppq=s.ppq,this._clock=new mo({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=s.ppq,this.bpm.setValueAtTime(s.bpm,0),zt(this,"bpm"),this._timeSignature=s.timeSignature,this._swingTicks=s.ppq/2}static getDefaults(){return Object.assign(Sn.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(s,o){if(this._loop.get(s)&&o>=this._loopEnd&&(this.emit("loopEnd",s),this._clock.setTicksAtTime(this._loopStart,s),o=this._loopStart,this.emit("loopStart",s,this._clock.getSecondsAtTime(s)),this.emit("loop",s)),this._swingAmount>0&&o%this._ppq!=0&&o%(2*this._swingTicks)!=0){const u=o%(2*this._swingTicks)/(2*this._swingTicks),p=Math.sin(u*Math.PI)*this._swingAmount;s+=new ze(this.context,2*this._swingTicks/3).toSeconds()*p}md(!0),this._timeline.forEachAtTime(o,(u=>u.invoke(s))),md(!1)}schedule(s,o){const u=new Dr(this,{callback:s,time:new dn(this.context,o).toTicks()});return this._addEvent(u,this._timeline)}scheduleRepeat(s,o,u,p=1/0){const v=new Td(this,{callback:s,duration:new Qs(this.context,p).toTicks(),interval:new Qs(this.context,o).toTicks(),time:new dn(this.context,u).toTicks()});return this._addEvent(v,this._repeatedEvents)}scheduleOnce(s,o){const u=new Dr(this,{callback:s,once:!0,time:new dn(this.context,o).toTicks()});return this._addEvent(u,this._timeline)}clear(s){if(this._scheduledEvents.hasOwnProperty(s)){const o=this._scheduledEvents[s.toString()];o.timeline.remove(o.event),o.event.dispose(),delete this._scheduledEvents[s.toString()]}return this}_addEvent(s,o){return this._scheduledEvents[s.id.toString()]={event:s,timeline:o},o.add(s),s.id}cancel(s=0){const o=this.toTicks(s);return this._timeline.forEachFrom(o,(u=>this.clear(u.id))),this._repeatedEvents.forEachFrom(o,(u=>this.clear(u.id))),this}_bindClockEvents(){this._clock.on("start",((s,o)=>{o=new ze(this.context,o).toSeconds(),this.emit("start",s,o)})),this._clock.on("stop",(s=>{this.emit("stop",s)})),this._clock.on("pause",(s=>{this.emit("pause",s)}))}get state(){return this._clock.getStateAtTime(this.now())}start(s,o){let u;return this.context.resume(),Ae(o)&&(u=this.toTicks(o)),this._clock.start(s,u),this}stop(s){return this._clock.stop(s),this}pause(s){return this._clock.pause(s),this}toggle(s){return s=this.toSeconds(s),this._clock.getStateAtTime(s)!=="started"?this.start(s):this.stop(s),this}get timeSignature(){return this._timeSignature}set timeSignature(s){Un(s)&&(s=s[0]/s[1]*4),this._timeSignature=s}get loopStart(){return new Qs(this.context,this._loopStart,"i").toSeconds()}set loopStart(s){this._loopStart=this.toTicks(s)}get loopEnd(){return new Qs(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(s){this._loopEnd=this.toTicks(s)}get loop(){return this._loop.get(this.now())}set loop(s){this._loop.set(s,this.now())}setLoopPoints(s,o){return this.loopStart=s,this.loopEnd=o,this}get swing(){return this._swingAmount}set swing(s){this._swingAmount=s}get swingSubdivision(){return new ze(this.context,this._swingTicks).toNotation()}set swingSubdivision(s){this._swingTicks=this.toTicks(s)}get position(){const s=this.now(),o=this._clock.getTicksAtTime(s);return new ze(this.context,o).toBarsBeatsSixteenths()}set position(s){const o=this.toTicks(s);this.ticks=o}get seconds(){return this._clock.seconds}set seconds(s){const o=this.now(),u=this._clock.frequency.timeToTicks(s,o);this.ticks=u}get progress(){if(this.loop){const s=this.now();return(this._clock.getTicksAtTime(s)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(s){if(this._clock.ticks!==s){const o=this.now();if(this.state==="started"){const u=this._clock.getTicksAtTime(o),p=o+this._clock.frequency.getDurationOfTicks(Math.ceil(u)-u,o);this.emit("stop",p),this._clock.setTicksAtTime(s,p),this.emit("start",p,this._clock.getSecondsAtTime(p))}else this.emit("ticks",o),this._clock.setTicksAtTime(s,o)}}getTicksAtTime(s){return this._clock.getTicksAtTime(s)}getSecondsAtTime(s){return this._clock.getSecondsAtTime(s)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(s){this._clock.frequency.multiplier=s}nextSubdivision(s){if(s=this.toTicks(s),this.state!=="started")return 0;{const o=this.now(),u=s-this.getTicksAtTime(o)%s;return this._clock.nextTickTime(u,o)}}syncSignal(s,o){const u=this.now();let p=this.bpm,v=1/(60/p.getValueAtTime(u)/this.PPQ),C=[];if(s.units==="time"){const E=.015625/v,T=new Wt(E),I=new vo(-1),M=new Wt(E);p.chain(T,I,M),p=M,v=1/v,C=[T,I,M]}o||(o=s.getValueAtTime(u)!==0?s.getValueAtTime(u)/v:0);const _=new Wt(o);return p.connect(_),_.connect(s._param),C.push(_),this._syncedSignals.push({initial:s.value,nodes:C,signal:s}),s.value=0,this}unsyncSignal(s){for(let o=this._syncedSignals.length-1;o>=0;o--){const u=this._syncedSignals[o];u.signal===s&&(u.nodes.forEach((p=>p.dispose())),u.signal.value=u.initial,this._syncedSignals.splice(o,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Sa(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}ao.mixin(Pc),Fc((g=>{g.transport=new Pc({context:g})})),Ic((g=>{g.transport.dispose()}));class nn extends ft{constructor(s){super(s),this.input=void 0,this._state=new fo("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ce,this._syncedStop=ce,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new nr({context:this.context,mute:s.mute,volume:s.volume}),this.volume=this._volume.volume,zt(this,"volume"),this.onstop=s.onstop}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,onstop:ce,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(s){this._volume.mute=s}_clampToCurrentTime(s){return this._synced?s:Math.max(s,this.context.currentTime)}start(s,o,u){let p=ms(s)&&this._synced?this.context.transport.seconds:this.toSeconds(s);if(p=this._clampToCurrentTime(p),this._synced||this._state.getValueAtTime(p)!=="started")if(this.log("start",p),this._state.setStateAtTime("started",p),this._synced){const v=this._state.get(p);v&&(v.offset=this.toSeconds(Gs(o,0)),v.duration=u?this.toSeconds(u):void 0);const C=this.context.transport.schedule((_=>{this._start(_,o,u)}),p);this._scheduled.push(C),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>p&&this._syncedStart(this.now(),this.context.transport.seconds)}else pd(this.context),this._start(p,o,u);else Gt(oo(p,this._state.get(p).time),"Start time must be strictly greater than previous start time"),this._state.cancel(p),this._state.setStateAtTime("started",p),this.log("restart",p),this.restart(p,o,u);return this}stop(s){let o=ms(s)&&this._synced?this.context.transport.seconds:this.toSeconds(s);if(o=this._clampToCurrentTime(o),this._state.getValueAtTime(o)==="started"||Ae(this._state.getNextState("started",o))){if(this.log("stop",o),this._synced){const u=this.context.transport.schedule(this._stop.bind(this),o);this._scheduled.push(u)}else this._stop(o);this._state.cancel(o),this._state.setStateAtTime("stopped",o)}return this}restart(s,o,u){return s=this.toSeconds(s),this._state.getValueAtTime(s)==="started"&&(this._state.cancel(s),this._restart(s,o,u)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(s,o)=>{if(oo(o,0)){const u=this._state.get(o);if(u&&u.state==="started"&&u.time!==o){const p=o-this.toSeconds(u.time);let v;u.duration&&(v=this.toSeconds(u.duration)-p),this._start(s,this.toSeconds(u.offset)+p,v)}}},this._syncedStop=s=>{const o=this.context.transport.getSecondsAtTime(Math.max(s-this.sampleTime,0));this._state.getValueAtTime(o)==="started"&&this._stop(s)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((s=>this.context.transport.clear(s))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ce,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class kr extends po{constructor(){const s=at(kr.getDefaults(),arguments,["url","onload"]);super(s),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,ns(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new te({context:this.context,param:this._source.playbackRate,units:"positive",value:s.playbackRate}),this.loop=s.loop,this.loopStart=s.loopStart,this.loopEnd=s.loopEnd,this._buffer=new ge(s.url,s.onload,s.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(po.getDefaults(),{url:new ge,loop:!1,loopEnd:0,loopStart:0,onload:ce,onerror:ce,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(s){this._fadeIn=s}get fadeOut(){return this._fadeOut}set fadeOut(s){this._fadeOut=s}get curve(){return this._curve}set curve(s){this._curve=s}start(s,o,u,p=1){Gt(this.buffer.loaded,"buffer is either not set or not loaded");const v=this.toSeconds(s);this._startGain(v,p),o=this.loop?Gs(o,this.loopStart):Gs(o,0);let C=Math.max(this.toSeconds(o),0);if(this.loop){const _=this.toSeconds(this.loopEnd)||this.buffer.duration,E=this.toSeconds(this.loopStart),T=_-E;vd(C,_)&&(C=(C-E)%T+E),ai(C,this.buffer.duration)&&(C=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Tc(C,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(v,C)),Ae(u)){let _=this.toSeconds(u);_=Math.max(_,0),this.stop(v+_)}return this}_stopSource(s){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(s)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(s){this._source.loopStart=this.toSeconds(s)}get loopEnd(){return this._source.loopEnd}set loopEnd(s){this._source.loopEnd=this.toSeconds(s)}get buffer(){return this._buffer}set buffer(s){this._buffer.set(s)}get loop(){return this._source.loop}set loop(s){this._source.loop=s,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Lr extends nn{constructor(){const s=at(Lr.getDefaults(),arguments,["type"]);super(s),this.name="Noise",this._source=null,this._playbackRate=s.playbackRate,this.type=s.type,this._fadeIn=s.fadeIn,this._fadeOut=s.fadeOut}static getDefaults(){return Object.assign(nn.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(s){if(Gt(s in Vw,"Noise: invalid type: "+s),this._type!==s&&(this._type=s,this.state==="started")){const o=this.now();this._stop(o),this._start(o)}}get playbackRate(){return this._playbackRate}set playbackRate(s){this._playbackRate=s,this._source&&(this._source.playbackRate.value=s)}_start(s){const o=Vw[this._type];this._source=new kr({url:o,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(s),Math.random()*(o.duration-.001))}_stop(s){this._source&&(this._source.stop(this.toSeconds(s)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(s){this._fadeIn=s,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(s){this._fadeOut=s,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(s){this._stop(s),this._start(s)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Bo=220500,sr={brown:null,pink:null,white:null},Vw={get brown(){if(!sr.brown){const g=[];for(let s=0;s<2;s++){const o=new Float32Array(Bo);g[s]=o;let u=0;for(let p=0;p<Bo;p++){const v=2*Math.random()-1;o[p]=(u+.02*v)/1.02,u=o[p],o[p]*=3.5}}sr.brown=new ge().fromArray(g)}return sr.brown},get pink(){if(!sr.pink){const g=[];for(let s=0;s<2;s++){const o=new Float32Array(Bo);let u,p,v,C,_,E,T;g[s]=o,u=p=v=C=_=E=T=0;for(let I=0;I<Bo;I++){const M=2*Math.random()-1;u=.99886*u+.0555179*M,p=.99332*p+.0750759*M,v=.969*v+.153852*M,C=.8665*C+.3104856*M,_=.55*_+.5329522*M,E=-.7616*E-.016898*M,o[I]=u+p+v+C+_+E+T+.5362*M,o[I]*=.11,T=.115926*M}}sr.pink=new ge().fromArray(g)}return sr.pink},get white(){if(!sr.white){const g=[];for(let s=0;s<2;s++){const o=new Float32Array(Bo);g[s]=o;for(let u=0;u<Bo;u++)o[u]=2*Math.random()-1}sr.white=new ge().fromArray(g)}return sr.white}};class Fa extends ft{constructor(){const s=at(Fa.getDefaults(),arguments,["volume"]);super(s),this.name="UserMedia",this._volume=this.output=new nr({context:this.context,volume:s.volume}),this.volume=this._volume.volume,zt(this,"volume"),this.mute=s.mute}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,volume:0})}open(s){return Re(this,void 0,void 0,(function*(){Gt(Fa.supported,"UserMedia is not supported"),this.state==="started"&&this.close();const o=yield Fa.enumerateDevices();Fs(s)?this._device=o[s]:(this._device=o.find((v=>v.label===s||v.deviceId===s)),!this._device&&o.length>0&&(this._device=o[0]),Gt(Ae(this._device),`No matching device ${s}`));const u={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(u.audio.deviceId=this._device.deviceId);const p=yield navigator.mediaDevices.getUserMedia(u);if(!this._stream){this._stream=p;const v=this.context.createMediaStreamSource(p);ns(v,this.output),this._mediaStream=v}return this}))}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((s=>{s.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return Re(this,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((s=>s.kind==="audioinput"))}))}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(s){this._volume.mute=s}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return Ae(navigator.mediaDevices)&&Ae(navigator.mediaDevices.getUserMedia)}}function wA(g,s){return Re(this,void 0,void 0,(function*(){const o=s/g.context.sampleRate,u=new co(1,o,g.context.sampleRate);return new g.constructor(Object.assign(g.get(),{frequency:2/o,detune:0,context:u})).toDestination().start(0),(yield u.render()).getChannelData(0)}))}class Ia extends po{constructor(){const s=at(Ia.getDefaults(),arguments,["frequency","type"]);super(s),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],ns(this._oscillator,this._gainNode),this.type=s.type,this.frequency=new te({context:this.context,param:this._oscillator.frequency,units:"frequency",value:s.frequency}),this.detune=new te({context:this.context,param:this._oscillator.detune,units:"cents",value:s.detune}),zt(this,["frequency","detune"])}static getDefaults(){return Object.assign(po.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(s){const o=this.toSeconds(s);return this.log("start",o),this._startGain(o),this._oscillator.start(o),this}_stopSource(s){this._oscillator.stop(s)}setPeriodicWave(s){return this._oscillator.setPeriodicWave(s),this}get type(){return this._oscillator.type}set type(s){this._oscillator.type=s}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Xe extends nn{constructor(){const s=at(Xe.getDefaults(),arguments,["frequency","type"]);super(s),this.name="Oscillator",this._oscillator=null,this.frequency=new Yt({context:this.context,units:"frequency",value:s.frequency}),zt(this,"frequency"),this.detune=new Yt({context:this.context,units:"cents",value:s.detune}),zt(this,"detune"),this._partials=s.partials,this._partialCount=s.partialCount,this._type=s.type,s.partialCount&&s.type!=="custom"&&(this._type=this.baseType+s.partialCount.toString()),this.phase=s.phase}static getDefaults(){return Object.assign(nn.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(s){const o=this.toSeconds(s),u=new Ia({context:this.context,onended:()=>this.onstop(this)});this._oscillator=u,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(o)}_stop(s){const o=this.toSeconds(s);this._oscillator&&this._oscillator.stop(o)}_restart(s){const o=this.toSeconds(s);return this.log("restart",o),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(o),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Xe._periodicWaveCache.find((s=>{return s.phase===this._phase&&(o=s.partials,u=this._partials,o.length===u.length&&o.every(((p,v)=>u[v]===p)));var o,u}));{const s=Xe._periodicWaveCache.find((o=>o.type===this._type&&o.phase===this._phase));return this._partialCount=s?s.partialCount:this._partialCount,s}}get type(){return this._type}set type(s){this._type=s;const o=["sine","square","sawtooth","triangle"].indexOf(s)!==-1;if(this._phase===0&&o)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=s);else{const u=this._getCachedPeriodicWave();if(Ae(u)){const{partials:p,wave:v}=u;this._wave=v,this._partials=p,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[p,v]=this._getRealImaginary(s,this._phase),C=this.context.createPeriodicWave(p,v);this._wave=C,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Xe._periodicWaveCache.push({imag:v,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:p,type:this._type,wave:this._wave}),Xe._periodicWaveCache.length>100&&Xe._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(s){this.partialCount&&this._type!=="custom"&&s!=="custom"?this.type=s+this.partialCount:this.type=s}get partialCount(){return this._partialCount}set partialCount(s){wn(s,0);let o=this._type;const u=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(u&&(o=u[1]),this._type!=="custom")this.type=s===0?o:o+s.toString();else{const p=new Float32Array(s);this._partials.forEach(((v,C)=>p[C]=v)),this._partials=Array.from(p),this.type=this._type}}_getRealImaginary(s,o){let u=2048;const p=new Float32Array(u),v=new Float32Array(u);let C=1;if(s==="custom"){if(C=this._partials.length+1,this._partialCount=this._partials.length,u=C,this._partials.length===0)return[p,v]}else{const _=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(s);_?(C=parseInt(_[2],10)+1,this._partialCount=parseInt(_[2],10),s=_[1],C=Math.max(C,2),u=C):this._partialCount=0,this._partials=[]}for(let _=1;_<u;++_){const E=2/(_*Math.PI);let T;switch(s){case"sine":T=_<=C?1:0,this._partials[_-1]=T;break;case"square":T=1&_?2*E:0,this._partials[_-1]=T;break;case"sawtooth":T=E*(1&_?1:-1),this._partials[_-1]=T;break;case"triangle":T=1&_?E*E*2*(_-1>>1&1?-1:1):0,this._partials[_-1]=T;break;case"custom":T=this._partials[_-1];break;default:throw new TypeError("Oscillator: invalid type: "+s)}T!==0?(p[_]=-T*Math.sin(o*_),v[_]=T*Math.cos(o*_)):(p[_]=0,v[_]=0)}return[p,v]}_inverseFFT(s,o,u){let p=0;const v=s.length;for(let C=0;C<v;C++)p+=s[C]*Math.cos(C*u)+o[C]*Math.sin(C*u);return p}getInitialValue(){const[s,o]=this._getRealImaginary(this._type,0);let u=0;const p=2*Math.PI;for(let v=0;v<32;v++)u=Math.max(this._inverseFFT(s,o,v/32*p),u);return gA(-this._inverseFFT(s,o,this._phase)/u,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(s){this._partials=s,this._partialCount=this._partials.length,s.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(s){this._phase=s*Math.PI/180,this.type=this._type}asArray(){return Re(this,arguments,void 0,(function*(s=1024){return wA(this,s)}))}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Xe._periodicWaveCache=[];class Dc extends Ds{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new li({context:this.context,mapping:s=>(s+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ye extends Yt{constructor(){const s=at(Ye.getDefaults(),arguments,["value"]);super(s),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Wt({context:this.context,minValue:s.minValue,maxValue:s.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(s.value,0)}static getDefaults(){return Object.assign(Yt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Ma extends nn{constructor(){const s=at(Ma.getDefaults(),arguments,["frequency","type","modulationType"]);super(s),this.name="AMOscillator",this._modulationScale=new Dc({context:this.context}),this._modulationNode=new Wt({context:this.context}),this._carrier=new Xe({context:this.context,detune:s.detune,frequency:s.frequency,onstop:()=>this.onstop(this),phase:s.phase,type:s.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Xe({context:this.context,phase:s.phase,type:s.modulationType}),this.harmonicity=new Ye({context:this.context,units:"positive",value:s.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),zt(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Xe.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(s){this._modulator.start(s),this._carrier.start(s)}_stop(s){this._modulator.stop(s),this._carrier.stop(s)}_restart(s){this._modulator.restart(s),this._carrier.restart(s)}get type(){return this._carrier.type}set type(s){this._carrier.type=s}get baseType(){return this._carrier.baseType}set baseType(s){this._carrier.baseType=s}get partialCount(){return this._carrier.partialCount}set partialCount(s){this._carrier.partialCount=s}get modulationType(){return this._modulator.type}set modulationType(s){this._modulator.type=s}get phase(){return this._carrier.phase}set phase(s){this._carrier.phase=s,this._modulator.phase=s}get partials(){return this._carrier.partials}set partials(s){this._carrier.partials=s}asArray(){return Re(this,arguments,void 0,(function*(s=1024){return wA(this,s)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class yo extends nn{constructor(){const s=at(yo.getDefaults(),arguments,["frequency","type","modulationType"]);super(s),this.name="FMOscillator",this._modulationNode=new Wt({context:this.context,gain:0}),this._carrier=new Xe({context:this.context,detune:s.detune,frequency:0,onstop:()=>this.onstop(this),phase:s.phase,type:s.type}),this.detune=this._carrier.detune,this.frequency=new Yt({context:this.context,units:"frequency",value:s.frequency}),this._modulator=new Xe({context:this.context,phase:s.phase,type:s.modulationType}),this.harmonicity=new Ye({context:this.context,units:"positive",value:s.harmonicity}),this.modulationIndex=new Ye({context:this.context,units:"positive",value:s.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),zt(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Xe.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(s){this._modulator.start(s),this._carrier.start(s)}_stop(s){this._modulator.stop(s),this._carrier.stop(s)}_restart(s){return this._modulator.restart(s),this._carrier.restart(s),this}get type(){return this._carrier.type}set type(s){this._carrier.type=s}get baseType(){return this._carrier.baseType}set baseType(s){this._carrier.baseType=s}get partialCount(){return this._carrier.partialCount}set partialCount(s){this._carrier.partialCount=s}get modulationType(){return this._modulator.type}set modulationType(s){this._modulator.type=s}get phase(){return this._carrier.phase}set phase(s){this._carrier.phase=s,this._modulator.phase=s}get partials(){return this._carrier.partials}set partials(s){this._carrier.partials=s}asArray(){return Re(this,arguments,void 0,(function*(s=1024){return wA(this,s)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Co extends nn{constructor(){const s=at(Co.getDefaults(),arguments,["frequency","width"]);super(s),this.name="PulseOscillator",this._widthGate=new Wt({context:this.context,gain:0}),this._thresh=new li({context:this.context,mapping:o=>o<=0?-1:1}),this.width=new Yt({context:this.context,units:"audioRange",value:s.width}),this._triangle=new Xe({context:this.context,detune:s.detune,frequency:s.frequency,onstop:()=>this.onstop(this),phase:s.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),zt(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(nn.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(s){s=this.toSeconds(s),this._triangle.start(s),this._widthGate.gain.setValueAtTime(1,s)}_stop(s){s=this.toSeconds(s),this._triangle.stop(s),this._widthGate.gain.cancelScheduledValues(s),this._widthGate.gain.setValueAtTime(0,s)}_restart(s){this._triangle.restart(s),this._widthGate.gain.cancelScheduledValues(s),this._widthGate.gain.setValueAtTime(1,s)}get phase(){return this._triangle.phase}set phase(s){this._triangle.phase=s}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(s){this._triangle.type=s}asArray(){return Re(this,arguments,void 0,(function*(s=1024){return wA(this,s)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Qa extends nn{constructor(){const s=at(Qa.getDefaults(),arguments,["frequency","type","spread"]);super(s),this.name="FatOscillator",this._oscillators=[],this.frequency=new Yt({context:this.context,units:"frequency",value:s.frequency}),this.detune=new Yt({context:this.context,units:"cents",value:s.detune}),this._spread=s.spread,this._type=s.type,this._phase=s.phase,this._partials=s.partials,this._partialCount=s.partialCount,this.count=s.count,zt(this,["frequency","detune"])}static getDefaults(){return Object.assign(Xe.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(s){s=this.toSeconds(s),this._forEach((o=>o.start(s)))}_stop(s){s=this.toSeconds(s),this._forEach((o=>o.stop(s)))}_restart(s){this._forEach((o=>o.restart(s)))}_forEach(s){for(let o=0;o<this._oscillators.length;o++)s(this._oscillators[o],o)}get type(){return this._type}set type(s){this._type=s,this._forEach((o=>o.type=s))}get spread(){return this._spread}set spread(s){if(this._spread=s,this._oscillators.length>1){const o=-s/2,u=s/(this._oscillators.length-1);this._forEach(((p,v)=>p.detune.value=o+u*v))}}get count(){return this._oscillators.length}set count(s){if(wn(s,1),this._oscillators.length!==s){this._forEach((o=>o.dispose())),this._oscillators=[];for(let o=0;o<s;o++){const u=new Xe({context:this.context,volume:-6-1.1*s,type:this._type,phase:this._phase+o/s*360,partialCount:this._partialCount,onstop:o===0?()=>this.onstop(this):ce});this.type==="custom"&&(u.partials=this._partials),this.frequency.connect(u.frequency),this.detune.connect(u.detune),u.detune.overridden=!1,u.connect(this.output),this._oscillators[o]=u}this.spread=this._spread,this.state==="started"&&this._forEach((o=>o.start()))}}get phase(){return this._phase}set phase(s){this._phase=s,this._forEach(((o,u)=>o.phase=this._phase+u/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(s){this._forEach((o=>o.baseType=s)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(s){this._partials=s,this._partialCount=this._partials.length,s.length&&(this._type="custom",this._forEach((o=>o.partials=s)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(s){this._partialCount=s,this._forEach((o=>o.partialCount=s)),this._type=this._oscillators[0].type}asArray(){return Re(this,arguments,void 0,(function*(s=1024){return wA(this,s)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((s=>s.dispose())),this}}class Ua extends nn{constructor(){const s=at(Ua.getDefaults(),arguments,["frequency","modulationFrequency"]);super(s),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Ye({context:this.context,value:2}),this._pulse=new Co({context:this.context,frequency:s.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Xe({context:this.context,detune:s.detune,frequency:s.frequency,onstop:()=>this.onstop(this),phase:s.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),zt(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(nn.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(s){s=this.toSeconds(s),this._modulator.start(s),this._pulse.start(s)}_stop(s){s=this.toSeconds(s),this._modulator.stop(s),this._pulse.stop(s)}_restart(s){this._modulator.restart(s),this._pulse.restart(s)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(s){this._modulator.phase=s}asArray(){return Re(this,arguments,void 0,(function*(s=1024){return wA(this,s)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Ww={am:Ma,fat:Qa,fm:yo,oscillator:Xe,pulse:Co,pwm:Ua};class ir extends nn{constructor(){const s=at(ir.getDefaults(),arguments,["frequency","type"]);super(s),this.name="OmniOscillator",this.frequency=new Yt({context:this.context,units:"frequency",value:s.frequency}),this.detune=new Yt({context:this.context,units:"cents",value:s.detune}),zt(this,["frequency","detune"]),this.set(s)}static getDefaults(){return Object.assign(Xe.getDefaults(),yo.getDefaults(),Ma.getDefaults(),Qa.getDefaults(),Co.getDefaults(),Ua.getDefaults())}_start(s){this._oscillator.start(s)}_stop(s){this._oscillator.stop(s)}_restart(s){return this._oscillator.restart(s),this}get type(){let s="";return["am","fm","fat"].some((o=>this._sourceType===o))&&(s=this._sourceType),s+this._oscillator.type}set type(s){s.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=s.substr(2)):s.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=s.substr(2)):s.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=s.substr(3)):s==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):s==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=s)}get partials(){return this._oscillator.partials}set partials(s){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=s)}get partialCount(){return this._oscillator.partialCount}set partialCount(s){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=s)}set(s){return Reflect.has(s,"type")&&s.type&&(this.type=s.type),super.set(s),this}_createNewOscillator(s){if(s!==this._sourceType){this._sourceType=s;const o=Ww[s],u=this.now();if(this._oscillator){const p=this._oscillator;p.stop(u),this.context.setTimeout((()=>p.dispose()),this.blockTime)}this._oscillator=new o({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(u)}}get phase(){return this._oscillator.phase}set phase(s){this._oscillator.phase=s}get sourceType(){return this._sourceType}set sourceType(s){let o="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(o=this._oscillator.type),s==="fm"?this.type="fm"+o:s==="am"?this.type="am"+o:s==="fat"?this.type="fat"+o:s==="oscillator"?this.type=o:s==="pulse"?this.type="pulse":s==="pwm"&&(this.type="pwm")}_getOscType(s,o){return s instanceof Ww[o]}get baseType(){return this._oscillator.baseType}set baseType(s){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||s==="pulse"||s==="pwm"||(this._oscillator.baseType=s)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(s){this._getOscType(this._oscillator,"fat")&&Fs(s)&&(this._oscillator.count=s)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(s){this._getOscType(this._oscillator,"fat")&&Fs(s)&&(this._oscillator.spread=s)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(s){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Ai(s)&&(this._oscillator.modulationType=s)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(){return Re(this,arguments,void 0,(function*(s=1024){return wA(this,s)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class vA extends Yt{constructor(){super(at(vA.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new Wt({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Us(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Yt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class rr extends Ds{constructor(){const s=at(rr.getDefaults(),arguments,["min","max"]);super(s),this.name="Scale",this._mult=this.input=new Ye({context:this.context,value:s.max-s.min}),this._add=this.output=new vA({context:this.context,value:s.min}),this._min=s.min,this._max=s.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Ds.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(s){this._min=s,this._setRange()}get max(){return this._max}set max(s){this._max=s,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class kc extends Ds{constructor(){super(at(kc.getDefaults(),arguments)),this.name="Zero",this._gain=new Wt({context:this.context}),this.output=this._gain,this.input=void 0,ns(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),bd(this.context.getConstant(0),this._gain),this}}class ss extends ft{constructor(){const s=at(ss.getDefaults(),arguments,["frequency","min","max"]);super(s),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=te.prototype._fromType,this._toType=te.prototype._toType,this._is=te.prototype._is,this._clampValue=te.prototype._clampValue,this._oscillator=new Xe(s),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Wt({context:this.context,gain:s.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Yt({context:this.context,units:"audioRange",value:0}),this._zeros=new kc({context:this.context}),this._a2g=new Dc({context:this.context}),this._scaler=this.output=new rr({context:this.context,max:s.max,min:s.min}),this.units=s.units,this.min=s.min,this.max=s.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),zt(this,["amplitude","frequency"]),this.phase=s.phase}static getDefaults(){return Object.assign(Xe.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(s){return s=this.toSeconds(s),this._stoppedSignal.setValueAtTime(0,s),this._oscillator.start(s),this}stop(s){return s=this.toSeconds(s),this._stoppedSignal.setValueAtTime(this._stoppedValue,s),this._oscillator.stop(s),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(s){s=this._fromType(s),this._scaler.min=s}get max(){return this._toType(this._scaler.max)}set max(s){s=this._fromType(s),this._scaler.max=s}get type(){return this._oscillator.type}set type(s){this._oscillator.type=s,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(s){this._oscillator.partials=s,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(s){this._oscillator.phase=s,this._setStoppedValue()}get units(){return this._units}set units(s){const o=this.min,u=this.max;this._units=s,this.min=o,this.max=u}get state(){return this._oscillator.state}connect(s,o,u){return(s instanceof te||s instanceof Yt)&&(this.convert=s.convert,this.units=s.units),Ta(this,s,o,u),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Gw(g,s=1/0){const o=new WeakMap;return function(u,p){Reflect.defineProperty(u,p,{configurable:!0,enumerable:!0,get:function(){return o.get(this)},set:function(v){wn(v,g,s),o.set(this,v)}})}}function Ar(g,s=1/0){const o=new WeakMap;return function(u,p){Reflect.defineProperty(u,p,{configurable:!0,enumerable:!0,get:function(){return o.get(this)},set:function(v){wn(this.toSeconds(v),g,s),o.set(this,v)}})}}class bo extends nn{constructor(){const s=at(bo.getDefaults(),arguments,["url","onload"]);super(s),this.name="Player",this._activeSources=new Set,this._buffer=new ge({onload:this._onload.bind(this,s.onload),onerror:s.onerror,reverse:s.reverse,url:s.url}),this.autostart=s.autostart,this._loop=s.loop,this._loopStart=s.loopStart,this._loopEnd=s.loopEnd,this._playbackRate=s.playbackRate,this.fadeIn=s.fadeIn,this.fadeOut=s.fadeOut}static getDefaults(){return Object.assign(nn.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ce,onerror:ce,playbackRate:1,reverse:!1})}load(s){return Re(this,void 0,void 0,(function*(){return yield this._buffer.load(s),this._onload(),this}))}_onload(s=ce){s(),this.autostart&&this.start()}_onSourceEnd(s){this.onstop(this),this._activeSources.delete(s),this._activeSources.size!==0||this._synced||this._state.getValueAtTime(this.now())!=="started"||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(s,o,u){return super.start(s,o,u),this}_start(s,o,u){o=this._loop?Gs(o,this._loopStart):Gs(o,0);const p=this.toSeconds(o),v=u;u=Gs(u,Math.max(this._buffer.duration-p,0));let C=this.toSeconds(u);C/=this._playbackRate,s=this.toSeconds(s);const _=new kr({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(s+C),this._state.setStateAtTime("stopped",s+C,{implicitEnd:!0})),this._activeSources.add(_),this._loop&&ms(v)?_.start(s,p):_.start(s,p,C-this.toSeconds(this.fadeOut))}_stop(s){const o=this.toSeconds(s);this._activeSources.forEach((u=>u.stop(o)))}restart(s,o,u){return super.restart(s,o,u),this}_restart(s,o,u){var p;(p=[...this._activeSources].pop())===null||p===void 0||p.stop(s),this._start(s,o,u)}seek(s,o){const u=this.toSeconds(o);if(this._state.getValueAtTime(u)==="started"){const p=this.toSeconds(s);this._stop(u),this._start(u,p)}return this}setLoopPoints(s,o){return this.loopStart=s,this.loopEnd=o,this}get loopStart(){return this._loopStart}set loopStart(s){this._loopStart=s,this.buffer.loaded&&wn(this.toSeconds(s),0,this.buffer.duration),this._activeSources.forEach((o=>{o.loopStart=s}))}get loopEnd(){return this._loopEnd}set loopEnd(s){this._loopEnd=s,this.buffer.loaded&&wn(this.toSeconds(s),0,this.buffer.duration),this._activeSources.forEach((o=>{o.loopEnd=s}))}get buffer(){return this._buffer}set buffer(s){this._buffer.set(s)}get loop(){return this._loop}set loop(s){if(this._loop!==s&&(this._loop=s,this._activeSources.forEach((o=>{o.loop=s})),s)){const o=this._state.getNextState("stopped",this.now());o&&this._state.cancel(o.time)}}get playbackRate(){return this._playbackRate}set playbackRate(s){this._playbackRate=s;const o=this.now(),u=this._state.getNextState("stopped",o);u&&u.implicitEnd&&(this._state.cancel(u.time),this._activeSources.forEach((p=>p.cancelStop()))),this._activeSources.forEach((p=>{p.playbackRate.setValueAtTime(s,o)}))}get reverse(){return this._buffer.reverse}set reverse(s){this._buffer.reverse=s}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((s=>s.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}oi([Ar(0)],bo.prototype,"fadeIn",void 0),oi([Ar(0)],bo.prototype,"fadeOut",void 0);class Fd extends ft{constructor(){const s=at(Fd.getDefaults(),arguments,["urls","onload"],"urls");super(s),this.name="Players",this.input=void 0,this._players=new Map,this._volume=this.output=new nr({context:this.context,volume:s.volume}),this.volume=this._volume.volume,zt(this,"volume"),this._buffers=new go({urls:s.urls,onload:s.onload,baseUrl:s.baseUrl,onerror:s.onerror}),this.mute=s.mute,this._fadeIn=s.fadeIn,this._fadeOut=s.fadeOut}static getDefaults(){return Object.assign(nn.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:ce,onerror:ce,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(s){this._volume.mute=s}get fadeIn(){return this._fadeIn}set fadeIn(s){this._fadeIn=s,this._players.forEach((o=>{o.fadeIn=s}))}get fadeOut(){return this._fadeOut}set fadeOut(s){this._fadeOut=s,this._players.forEach((o=>{o.fadeOut=s}))}get state(){return Array.from(this._players).some((([s,o])=>o.state==="started"))?"started":"stopped"}has(s){return this._buffers.has(s)}player(s){if(Gt(this.has(s),`No Player with the name ${s} exists on this object`),!this._players.has(s)){const o=new bo({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(s)}).connect(this.output);this._players.set(s,o)}return this._players.get(s)}get loaded(){return this._buffers.loaded}add(s,o,u){return Gt(!this._buffers.has(s),"A buffer with that name already exists on this object"),this._buffers.add(s,o,u),this}stopAll(s){return this._players.forEach((o=>o.stop(s))),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach((s=>s.dispose())),this._buffers.dispose(),this}}class Id extends nn{constructor(){const s=at(Id.getDefaults(),arguments,["url","onload"]);super(s),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[],this.buffer=new ge({onload:s.onload,onerror:s.onerror,reverse:s.reverse,url:s.url}),this._clock=new mo({context:this.context,callback:this._tick.bind(this),frequency:1/s.grainSize}),this._playbackRate=s.playbackRate,this._grainSize=s.grainSize,this._overlap=s.overlap,this.detune=s.detune,this.overlap=s.overlap,this.loop=s.loop,this.playbackRate=s.playbackRate,this.grainSize=s.grainSize,this.loopStart=s.loopStart,this.loopEnd=s.loopEnd,this.reverse=s.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(nn.getDefaults(),{onload:ce,onerror:ce,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(s,o,u){o=Gs(o,0),o=this.toSeconds(o),s=this.toSeconds(s);const p=1/this._clock.frequency.getValueAtTime(s);this._clock.start(s,o/p),u&&this.stop(s+this.toSeconds(u))}restart(s,o,u){return super.restart(s,o,u),this}_restart(s,o,u){this._stop(s),this._start(s,o,u)}_stop(s){this._clock.stop(s)}_onstop(s){this._activeSources.forEach((o=>{o.fadeOut=0,o.stop(s)})),this.onstop(this)}_tick(s){const o=this._clock.getTicksAtTime(s),u=o*this._grainSize;if(this.log("offset",u),!this.loop&&u>this.buffer.duration)return void this.stop(s);const p=u<this._overlap?0:this._overlap,v=new kr({context:this.context,url:this.buffer,fadeIn:p,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:ho(this.detune/100)}).connect(this.output);v.start(s,this._grainSize*o),v.stop(s+this._grainSize/this.playbackRate),this._activeSources.push(v),v.onended=()=>{const C=this._activeSources.indexOf(v);C!==-1&&this._activeSources.splice(C,1)}}get playbackRate(){return this._playbackRate}set playbackRate(s){wn(s,.001),this._playbackRate=s,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(s){this.buffer.loaded&&wn(this.toSeconds(s),0,this.buffer.duration),this._loopStart=this.toSeconds(s)}get loopEnd(){return this._loopEnd}set loopEnd(s){this.buffer.loaded&&wn(this.toSeconds(s),0,this.buffer.duration),this._loopEnd=this.toSeconds(s)}get reverse(){return this.buffer.reverse}set reverse(s){this.buffer.reverse=s}get grainSize(){return this._grainSize}set grainSize(s){this._grainSize=this.toSeconds(s),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(s){const o=this.toSeconds(s);wn(o,0),this._overlap=o}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((s=>s.dispose())),this}}class Kw extends Ds{constructor(){super(...arguments),this.name="Abs",this._abs=new li({context:this.context,mapping:s=>Math.abs(s)<.001?0:Math.abs(s)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class qw extends Ds{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new li({context:this.context,mapping:s=>2*Math.abs(s)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Md extends Ds{constructor(){super(...arguments),this.name="Negate",this._multiply=new Ye({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class BA extends Yt{constructor(){super(at(BA.getDefaults(),arguments,["value"])),this.override=!1,this.name="Subtract",this._sum=new Wt({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new Md({context:this.context}),this.subtrahend=this._param,Us(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(Yt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class Lc extends Ds{constructor(){super(at(Lc.getDefaults(),arguments)),this.name="GreaterThanZero",this._thresh=this.output=new li({context:this.context,length:127,mapping:s=>s<=0?0:1}),this._scale=this.input=new Ye({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class Rc extends Yt{constructor(){const s=at(Rc.getDefaults(),arguments,["value"]);super(s),this.name="GreaterThan",this.override=!1,this._subtract=this.input=new BA({context:this.context,value:s.value}),this._gtz=this.output=new Lc({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,zt(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(Yt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class Hc extends rr{constructor(){const s=at(Hc.getDefaults(),arguments,["min","max","exponent"]);super(s),this.name="ScaleExp",this.input=this._exp=new vo({context:this.context,value:s.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(rr.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(s){this._exp.value=s}dispose(){return super.dispose(),this._exp.dispose(),this}}class Ix extends Yt{constructor(){const s=at(Yt.getDefaults(),arguments,["value","units"]);super(s),this.name="SyncedSignal",this.override=!1,this._lastVal=s.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new Uc({context:this.context,offset:s.value,units:s.units}).start(0),this.setValueAtTime(s.value,0)}_onTick(s){const o=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==o&&(this._lastVal=o,this._constantSource.offset.setValueAtTime(o,s))}_anchorValue(s){const o=super.getValueAtTime(this.context.transport.seconds);this._lastVal=o,this._constantSource.offset.cancelAndHoldAtTime(s),this._constantSource.offset.setValueAtTime(o,s)}getValueAtTime(s){const o=new dn(this.context,s).toSeconds();return super.getValueAtTime(o)}setValueAtTime(s,o){const u=new dn(this.context,o).toSeconds();return super.setValueAtTime(s,u),this}linearRampToValueAtTime(s,o){const u=new dn(this.context,o).toSeconds();return super.linearRampToValueAtTime(s,u),this}exponentialRampToValueAtTime(s,o){const u=new dn(this.context,o).toSeconds();return super.exponentialRampToValueAtTime(s,u),this}setTargetAtTime(s,o,u){const p=new dn(this.context,o).toSeconds();return super.setTargetAtTime(s,p,u),this}cancelScheduledValues(s){const o=new dn(this.context,s).toSeconds();return super.cancelScheduledValues(o),this}setValueCurveAtTime(s,o,u,p){const v=new dn(this.context,o).toSeconds();return u=this.toSeconds(u),super.setValueCurveAtTime(s,v,u,p),this}cancelAndHoldAtTime(s){const o=new dn(this.context,s).toSeconds();return super.cancelAndHoldAtTime(o),this}setRampPoint(s){const o=new dn(this.context,s).toSeconds();return super.setRampPoint(o),this}exponentialRampTo(s,o,u){const p=new dn(this.context,u).toSeconds();return super.exponentialRampTo(s,o,p),this}linearRampTo(s,o,u){const p=new dn(this.context,u).toSeconds();return super.linearRampTo(s,o,p),this}targetRampTo(s,o,u){const p=new dn(this.context,u).toSeconds();return super.targetRampTo(s,o,p),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class Dn extends ft{constructor(){const s=at(Dn.getDefaults(),arguments,["attack","decay","sustain","release"]);super(s),this.name="Envelope",this._sig=new Yt({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=s.attack,this.decay=s.decay,this.sustain=s.sustain,this.release=s.release,this.attackCurve=s.attackCurve,this.releaseCurve=s.releaseCurve,this.decayCurve=s.decayCurve}static getDefaults(){return Object.assign(ft.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(s,o){if(Ai(s))return s;{let u;for(u in Nc)if(Nc[u][o]===s)return u;return s}}_setCurve(s,o,u){if(Ai(u)&&Reflect.has(Nc,u)){const p=Nc[u];tr(p)?s!=="_decayCurve"&&(this[s]=p[o]):this[s]=p}else{if(!Un(u)||s==="_decayCurve")throw new Error("Envelope: invalid curve: "+u);this[s]=u}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(s){this._setCurve("_attackCurve","In",s)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(s){this._setCurve("_releaseCurve","Out",s)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(s){this._setCurve("_decayCurve","Out",s)}triggerAttack(s,o=1){this.log("triggerAttack",s,o),s=this.toSeconds(s);let u=this.toSeconds(this.attack);const p=this.toSeconds(this.decay),v=this.getValueAtTime(s);if(v>0&&(u=(1-v)/(1/u)),u<this.sampleTime)this._sig.cancelScheduledValues(s),this._sig.setValueAtTime(o,s);else if(this._attackCurve==="linear")this._sig.linearRampTo(o,u,s);else if(this._attackCurve==="exponential")this._sig.targetRampTo(o,u,s);else{this._sig.cancelAndHoldAtTime(s);let C=this._attackCurve;for(let _=1;_<C.length;_++)if(C[_-1]<=v&&v<=C[_]){C=this._attackCurve.slice(_),C[0]=v;break}this._sig.setValueCurveAtTime(C,s,u,o)}if(p&&this.sustain<1){const C=o*this.sustain,_=s+u;this.log("decay",_),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(C,p+_):this._sig.exponentialApproachValueAtTime(C,_,p)}return this}triggerRelease(s){this.log("triggerRelease",s),s=this.toSeconds(s);const o=this.getValueAtTime(s);if(o>0){const u=this.toSeconds(this.release);u<this.sampleTime?this._sig.setValueAtTime(0,s):this._releaseCurve==="linear"?this._sig.linearRampTo(0,u,s):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,u,s):(Gt(Un(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(s),this._sig.setValueCurveAtTime(this._releaseCurve,s,u,o))}return this}getValueAtTime(s){return this._sig.getValueAtTime(s)}triggerAttackRelease(s,o,u=1){return o=this.toSeconds(o),this.triggerAttack(o,u),this.triggerRelease(o+this.toSeconds(s)),this}cancel(s){return this._sig.cancelScheduledValues(this.toSeconds(s)),this}connect(s,o=0,u=0){return Ta(this,s,o,u),this}asArray(){return Re(this,arguments,void 0,(function*(s=1024){const o=s/this.context.sampleRate,u=new co(1,o,this.context.sampleRate),p=this.toSeconds(this.attack)+this.toSeconds(this.decay),v=p+this.toSeconds(this.release),C=.1*v,_=v+C,E=new this.constructor(Object.assign(this.get(),{attack:o*this.toSeconds(this.attack)/_,decay:o*this.toSeconds(this.decay)/_,release:o*this.toSeconds(this.release)/_,context:u}));return E._sig.toDestination(),E.triggerAttackRelease(o*(p+C)/_,0),(yield u.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}oi([Ar(0)],Dn.prototype,"attack",void 0),oi([Ar(0)],Dn.prototype,"decay",void 0),oi([Gw(0,1)],Dn.prototype,"sustain",void 0),oi([Ar(0)],Dn.prototype,"release",void 0);const Nc=(()=>{let s,o;const u=[];for(s=0;s<128;s++)u[s]=Math.sin(s/127*(Math.PI/2));const p=[];for(s=0;s<127;s++){o=s/127;const I=Math.sin(o*(2*Math.PI)*6.4-Math.PI/2)+1;p[s]=I/10+.83*o}p[127]=1;const v=[];for(s=0;s<128;s++)v[s]=Math.ceil(s/127*5)/5;const C=[];for(s=0;s<128;s++)o=s/127,C[s]=.5*(1-Math.cos(Math.PI*o));const _=[];for(s=0;s<128;s++){o=s/127;const I=4*Math.pow(o,3)+.2,M=Math.cos(I*Math.PI*2*o);_[s]=Math.abs(M*(1-o))}function E(I){const M=new Array(I.length);for(let L=0;L<I.length;L++)M[L]=1-I[L];return M}return{bounce:{In:E(_),Out:_},cosine:{In:u,Out:(T=u,T.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:p,Out:E(p)},sine:{In:C,Out:E(C)},step:{In:v,Out:E(v)}};var T})();class Ks extends ft{constructor(){const s=at(Ks.getDefaults(),arguments);super(s),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=o=>this._original_triggerRelease(o),this._volume=this.output=new nr({context:this.context,volume:s.volume}),this.volume=this._volume.volume,zt(this,"volume")}static getDefaults(){return Object.assign(ft.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let s=!1;return this._synced||(this._synced=!0,s=!0),s}_syncMethod(s,o){const u=this["_original_"+s]=this[s];this[s]=(...p)=>{const v=p[o],C=this.context.transport.schedule((_=>{p[o]=_,u.apply(this,p)}),v);this._scheduledEvents.push(C)}}unsync(){return this._scheduledEvents.forEach((s=>this.context.transport.clear(s))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(s,o,u,p){const v=this.toSeconds(u),C=this.toSeconds(o);return this.triggerAttack(s,v,p),this.triggerRelease(v+C),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class kn extends Ks{constructor(){const s=at(kn.getDefaults(),arguments);super(s),this.portamento=s.portamento,this.onsilence=s.onsilence}static getDefaults(){return Object.assign(Ks.getDefaults(),{detune:0,onsilence:ce,portamento:0})}triggerAttack(s,o,u=1){this.log("triggerAttack",s,o,u);const p=this.toSeconds(o);return this._triggerEnvelopeAttack(p,u),this.setNote(s,p),this}triggerRelease(s){this.log("triggerRelease",s);const o=this.toSeconds(s);return this._triggerEnvelopeRelease(o),this}setNote(s,o){const u=this.toSeconds(o),p=s instanceof es?s.toFrequency():s;if(this.portamento>0&&this.getLevelAtTime(u)>.05){const v=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(p,v,u)}else this.frequency.setValueAtTime(p,u);return this}}oi([Ar(0)],kn.prototype,"portamento",void 0);class _o extends Dn{constructor(){super(at(_o.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Wt({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Rr extends kn{constructor(){const s=at(Rr.getDefaults(),arguments);super(s),this.name="Synth",this.oscillator=new ir(Object.assign({context:this.context,detune:s.detune,onstop:()=>this.onsilence(this)},s.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new _o(Object.assign({context:this.context},s.envelope)),this.oscillator.chain(this.envelope,this.output),zt(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(kn.getDefaults(),{envelope:Object.assign(Pn(Dn.getDefaults(),Object.keys(ft.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Pn(ir.getDefaults(),[...Object.keys(nn.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(s,o){if(this.envelope.triggerAttack(s,o),this.oscillator.start(s),this.envelope.sustain===0){const u=this.toSeconds(this.envelope.attack),p=this.toSeconds(this.envelope.decay);this.oscillator.stop(s+u+p)}}_triggerEnvelopeRelease(s){this.envelope.triggerRelease(s),this.oscillator.stop(s+this.toSeconds(this.envelope.release))}getLevelAtTime(s){return s=this.toSeconds(s),this.envelope.getValueAtTime(s)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Pa extends kn{constructor(){const s=at(Pa.getDefaults(),arguments);super(s),this.name="ModulationSynth",this._carrier=new Rr({context:this.context,oscillator:s.oscillator,envelope:s.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Rr({context:this.context,oscillator:s.modulation,envelope:s.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Yt({context:this.context,units:"frequency"}),this.detune=new Yt({context:this.context,value:s.detune,units:"cents"}),this.harmonicity=new Ye({context:this.context,value:s.harmonicity,minValue:0}),this._modulationNode=new Wt({context:this.context,gain:0}),zt(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(kn.getDefaults(),{harmonicity:3,oscillator:Object.assign(Pn(ir.getDefaults(),[...Object.keys(nn.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(Pn(Dn.getDefaults(),Object.keys(ft.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(Pn(ir.getDefaults(),[...Object.keys(nn.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(Pn(Dn.getDefaults(),Object.keys(ft.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(s,o){this._carrier._triggerEnvelopeAttack(s,o),this._modulator._triggerEnvelopeAttack(s,o)}_triggerEnvelopeRelease(s){return this._carrier._triggerEnvelopeRelease(s),this._modulator._triggerEnvelopeRelease(s),this}getLevelAtTime(s){return s=this.toSeconds(s),this.envelope.getValueAtTime(s)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Qd extends Pa{constructor(){super(at(Qd.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Dc({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class Da extends ft{constructor(){const s=at(Da.getDefaults(),arguments,["frequency","type"]);super(s),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new te({context:this.context,units:"number",value:s.Q,param:this._filter.Q}),this.frequency=new te({context:this.context,units:"frequency",value:s.frequency,param:this._filter.frequency}),this.detune=new te({context:this.context,units:"cents",value:s.detune,param:this._filter.detune}),this.gain=new te({context:this.context,units:"decibels",convert:!1,value:s.gain,param:this._filter.gain}),this.type=s.type}static getDefaults(){return Object.assign(ft.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(s){Gt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(s)!==-1,`Invalid filter type: ${s}`),this._filter.type=s}getFrequencyResponse(s=128){const o=new Float32Array(s);for(let C=0;C<s;C++){const _=19980*Math.pow(C/s,2)+20;o[C]=_}const u=new Float32Array(s),p=new Float32Array(s),v=this.context.createBiquadFilter();return v.type=this.type,v.Q.value=this.Q.value,v.frequency.value=this.frequency.value,v.gain.value=this.gain.value,v.getFrequencyResponse(o,u,p),u}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class ks extends ft{constructor(){const s=at(ks.getDefaults(),arguments,["frequency","type","rolloff"]);super(s),this.name="Filter",this.input=new Wt({context:this.context}),this.output=new Wt({context:this.context}),this._filters=[],this._filters=[],this.Q=new Yt({context:this.context,units:"positive",value:s.Q}),this.frequency=new Yt({context:this.context,units:"frequency",value:s.frequency}),this.detune=new Yt({context:this.context,units:"cents",value:s.detune}),this.gain=new Yt({context:this.context,units:"decibels",convert:!1,value:s.gain}),this._type=s.type,this.rolloff=s.rolloff,zt(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(ft.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(s){Gt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(s)!==-1,`Invalid filter type: ${s}`),this._type=s,this._filters.forEach((o=>o.type=s))}get rolloff(){return this._rolloff}set rolloff(s){const o=Fs(s)?s:parseInt(s,10),u=[-12,-24,-48,-96];let p=u.indexOf(o);Gt(p!==-1,`rolloff can only be ${u.join(", ")}`),p+=1,this._rolloff=o,this.input.disconnect(),this._filters.forEach((v=>v.disconnect())),this._filters=new Array(p);for(let v=0;v<p;v++){const C=new Da({context:this.context});C.type=this._type,this.frequency.connect(C.frequency),this.detune.connect(C.detune),this.Q.connect(C.Q),this.gain.connect(C.gain),this._filters[v]=C}this._internalChannels=this._filters,Us(this.input,...this._internalChannels,this.output)}getFrequencyResponse(s=128){const o=new Da({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),u=new Float32Array(s).map((()=>1));return this._filters.forEach((()=>{o.getFrequencyResponse(s).forEach(((p,v)=>u[v]*=p))})),o.dispose(),u}dispose(){return super.dispose(),this._filters.forEach((s=>{s.dispose()})),Sa(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class ka extends Dn{constructor(){const s=at(ka.getDefaults(),arguments,["attack","decay","sustain","release"]);super(s),this.name="FrequencyEnvelope",this._octaves=s.octaves,this._baseFrequency=this.toFrequency(s.baseFrequency),this._exponent=this.input=new vo({context:this.context,value:s.exponent}),this._scale=this.output=new rr({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Dn.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(s){const o=this.toFrequency(s);wn(o,0),this._baseFrequency=o,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(s){this._octaves=s,this._scale.max=this._baseFrequency*Math.pow(2,s)}get exponent(){return this._exponent.value}set exponent(s){this._exponent.value=s}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class yA extends kn{constructor(){const s=at(yA.getDefaults(),arguments);super(s),this.name="MonoSynth",this.oscillator=new ir(Object.assign(s.oscillator,{context:this.context,detune:s.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new ks(Object.assign(s.filter,{context:this.context})),this.filterEnvelope=new ka(Object.assign(s.filterEnvelope,{context:this.context})),this.envelope=new _o(Object.assign(s.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),zt(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(kn.getDefaults(),{envelope:Object.assign(Pn(Dn.getDefaults(),Object.keys(ft.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(Pn(ks.getDefaults(),Object.keys(ft.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(Pn(ka.getDefaults(),Object.keys(ft.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(Pn(ir.getDefaults(),Object.keys(nn.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(s,o=1){if(this.envelope.triggerAttack(s,o),this.filterEnvelope.triggerAttack(s),this.oscillator.start(s),this.envelope.sustain===0){const u=this.toSeconds(this.envelope.attack),p=this.toSeconds(this.envelope.decay);this.oscillator.stop(s+u+p)}}_triggerEnvelopeRelease(s){this.envelope.triggerRelease(s),this.filterEnvelope.triggerRelease(s),this.oscillator.stop(s+this.toSeconds(this.envelope.release))}getLevelAtTime(s){return s=this.toSeconds(s),this.envelope.getValueAtTime(s)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Ud extends kn{constructor(){const s=at(Ud.getDefaults(),arguments);super(s),this.name="DuoSynth",this.voice0=new yA(Object.assign(s.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new yA(Object.assign(s.voice1,{context:this.context})),this.harmonicity=new Ye({context:this.context,units:"positive",value:s.harmonicity}),this._vibrato=new ss({frequency:s.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new Wt({context:this.context,units:"normalRange",gain:s.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new Yt({context:this.context,units:"frequency",value:440}),this.detune=new Yt({context:this.context,units:"cents",value:s.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),zt(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(s){return s=this.toSeconds(s),this.voice0.envelope.getValueAtTime(s)+this.voice1.envelope.getValueAtTime(s)}static getDefaults(){return Ws(kn.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:Ws(Pn(yA.getDefaults(),Object.keys(kn.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:Ws(Pn(yA.getDefaults(),Object.keys(kn.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(s,o){this.voice0._triggerEnvelopeAttack(s,o),this.voice1._triggerEnvelopeAttack(s,o)}_triggerEnvelopeRelease(s){return this.voice0._triggerEnvelopeRelease(s),this.voice1._triggerEnvelopeRelease(s),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Pd extends Pa{constructor(){const s=at(Pd.getDefaults(),arguments);super(s),this.name="FMSynth",this.modulationIndex=new Ye({context:this.context,value:s.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Pa.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const $w=[1,1.483,1.932,2.546,2.63,3.897];class Dd extends kn{constructor(){const s=at(Dd.getDefaults(),arguments);super(s),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[],this.detune=new Yt({context:this.context,units:"cents",value:s.detune}),this.frequency=new Yt({context:this.context,units:"frequency"}),this._amplitude=new Wt({context:this.context,gain:0}).connect(this.output),this._highpass=new ks({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let o=0;o<$w.length;o++){const u=new yo({context:this.context,harmonicity:s.harmonicity,modulationIndex:s.modulationIndex,modulationType:"square",onstop:o===0?()=>this.onsilence(this):ce,type:"square"});u.connect(this._highpass),this._oscillators[o]=u;const p=new Ye({context:this.context,value:$w[o]});this._freqMultipliers[o]=p,this.frequency.chain(p,u.frequency),this.detune.connect(u.detune)}this._filterFreqScaler=new rr({context:this.context,max:7e3,min:this.toFrequency(s.resonance)}),this.envelope=new Dn({attack:s.envelope.attack,attackCurve:"linear",context:this.context,decay:s.envelope.decay,release:s.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=s.octaves,this.octaves=s.octaves}static getDefaults(){return Ws(kn.getDefaults(),{envelope:Object.assign(Pn(Dn.getDefaults(),Object.keys(ft.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(s,o=1){return this.envelope.triggerAttack(s,o),this._oscillators.forEach((u=>u.start(s))),this.envelope.sustain===0&&this._oscillators.forEach((u=>{u.stop(s+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))})),this}_triggerEnvelopeRelease(s){return this.envelope.triggerRelease(s),this._oscillators.forEach((o=>o.stop(s+this.toSeconds(this.envelope.release)))),this}getLevelAtTime(s){return s=this.toSeconds(s),this.envelope.getValueAtTime(s)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(s){this._oscillators.forEach((o=>o.modulationIndex.value=s))}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(s){this._oscillators.forEach((o=>o.harmonicity.value=s))}get resonance(){return this._filterFreqScaler.min}set resonance(s){this._filterFreqScaler.min=this.toFrequency(s),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(s){this._octaves=s,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,s)}dispose(){return super.dispose(),this._oscillators.forEach((s=>s.dispose())),this._freqMultipliers.forEach((s=>s.dispose())),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class La extends Rr{constructor(){const s=at(La.getDefaults(),arguments);super(s),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=s.pitchDecay,this.octaves=s.octaves,zt(this,["oscillator","envelope"])}static getDefaults(){return Ws(kn.getDefaults(),Rr.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(s,o){const u=this.toSeconds(o),p=this.toFrequency(s instanceof es?s.toFrequency():s),v=p*this.octaves;return this.oscillator.frequency.setValueAtTime(v,u),this.oscillator.frequency.exponentialRampToValueAtTime(p,u+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}oi([Gw(0)],La.prototype,"octaves",void 0),oi([Ar(0)],La.prototype,"pitchDecay",void 0);class kd extends Ks{constructor(){const s=at(kd.getDefaults(),arguments);super(s),this.name="NoiseSynth",this.noise=new Lr(Object.assign({context:this.context},s.noise)),this.envelope=new _o(Object.assign({context:this.context},s.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Ks.getDefaults(),{envelope:Object.assign(Pn(Dn.getDefaults(),Object.keys(ft.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(Pn(Lr.getDefaults(),Object.keys(nn.getDefaults())),{type:"white"})})}triggerAttack(s,o=1){return s=this.toSeconds(s),this.envelope.triggerAttack(s,o),this.noise.start(s),this.envelope.sustain===0&&this.noise.stop(s+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(s){return s=this.toSeconds(s),this.envelope.triggerRelease(s),this.noise.stop(s+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(s,o,u=1){return o=this.toSeconds(o),s=this.toSeconds(s),this.triggerAttack(o,u),this.triggerRelease(o+s),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Ld=new Set;function Rd(g){Ld.add(g)}function zw(g,s){const o=`registerProcessor("${g}", ${s})`;Ld.add(o)}class Hd extends ft{constructor(s){super(s),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=ce;const o=URL.createObjectURL(new Blob([Array.from(Ld).join(`
`)],{type:"text/javascript"})),u=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(o).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(u,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}Rd(`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`),Rd(`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`),Rd(`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`);const Xw="feedback-comb-filter";zw(Xw,`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`);class Ra extends Hd{constructor(){const s=at(Ra.getDefaults(),arguments,["delayTime","resonance"]);super(s),this.name="FeedbackCombFilter",this.input=new Wt({context:this.context}),this.output=new Wt({context:this.context}),this.delayTime=new te({context:this.context,value:s.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new te({context:this.context,value:s.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),zt(this,["resonance","delayTime"])}_audioWorkletName(){return Xw}static getDefaults(){return Object.assign(ft.getDefaults(),{delayTime:.1,resonance:.5})}onReady(s){Us(this.input,s,this.output);const o=s.parameters.get("delayTime");this.delayTime.setParam(o);const u=s.parameters.get("feedback");this.resonance.setParam(u)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Ha extends ft{constructor(){const s=at(Ha.getDefaults(),arguments,["frequency","type"]);super(s),this.name="OnePoleFilter",this._frequency=s.frequency,this._type=s.type,this.input=new Wt({context:this.context}),this.output=new Wt({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(ft.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const s=this._filter,o=this.toFrequency(this._frequency),u=1/(2*Math.PI*o);if(this._type==="lowpass"){const p=1/(u*this.context.sampleRate),v=p-1;this._filter=this.context.createIIRFilter([p,0],[1,v])}else{const p=1/(u*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,p])}this.input.chain(this._filter,this.output),s&&this.context.setTimeout((()=>{this.disposed||(this.input.disconnect(s),s.disconnect())}),this.blockTime)}get frequency(){return this._frequency}set frequency(s){this._frequency=s,this._createFilter()}get type(){return this._type}set type(s){this._type=s,this._createFilter()}getFrequencyResponse(s=128){const o=new Float32Array(s);for(let v=0;v<s;v++){const C=19980*Math.pow(v/s,2)+20;o[v]=C}const u=new Float32Array(s),p=new Float32Array(s);return this._filter.getFrequencyResponse(o,u,p),u}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class Na extends ft{constructor(){const s=at(Na.getDefaults(),arguments,["delayTime","resonance","dampening"]);super(s),this.name="LowpassCombFilter",this._combFilter=this.output=new Ra({context:this.context,delayTime:s.delayTime,resonance:s.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Ha({context:this.context,frequency:s.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(ft.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(s){this._lowpass.frequency=s}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Nd extends Ks{constructor(){const s=at(Nd.getDefaults(),arguments);super(s),this.name="PluckSynth",this._noise=new Lr({context:this.context,type:"pink"}),this.attackNoise=s.attackNoise,this._lfcf=new Na({context:this.context,dampening:s.dampening,resonance:s.resonance}),this.resonance=s.resonance,this.release=s.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return Ws(Ks.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(s){this._lfcf.dampening=s}triggerAttack(s,o){const u=this.toFrequency(s);o=this.toSeconds(o);const p=1/u;return this._lfcf.delayTime.setValueAtTime(p,o),this._noise.start(o),this._noise.stop(o+p*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(o),this._lfcf.resonance.setValueAtTime(this.resonance,o),this}triggerRelease(s){return this._lfcf.resonance.linearRampTo(0,this.release,s),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Od extends Ks{constructor(){const s=at(Od.getDefaults(),arguments,["voice","options"]);super(s),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=p=>this.releaseAll(p),Gt(!Fs(s.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const o=s.voice.getDefaults();this.options=Object.assign(o,s.options),this.voice=s.voice,this.maxPolyphony=s.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const u=this._voices.indexOf(this._dummyVoice);this._voices.splice(u,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Ks.getDefaults(),{maxPolyphony:32,options:{},voice:Rr})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(s){this._availableVoices.push(s);const o=this._activeVoices.findIndex((u=>u.voice===s));this._activeVoices.splice(o,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const s=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Gt(s instanceof kn,"Voice must extend Monophonic class"),s.connect(this.output),this._voices.push(s),s}ro("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const s=this._availableVoices.shift(),o=this._voices.indexOf(s);this._voices.splice(o,1),this.context.isOffline||s.dispose()}}_triggerAttack(s,o,u){s.forEach((p=>{const v=new wo(this.context,p).toMidi(),C=this._getNextAvailableVoice();C&&(C.triggerAttack(p,o,u),this._activeVoices.push({midi:v,voice:C,released:!1}),this.log("triggerAttack",p,o))}))}_triggerRelease(s,o){s.forEach((u=>{const p=new wo(this.context,u).toMidi(),v=this._activeVoices.find((({midi:C,released:_})=>C===p&&!_));v&&(v.voice.triggerRelease(o),v.released=!0,this.log("triggerRelease",u,o))}))}_scheduleEvent(s,o,u,p){Gt(!this.disposed,"Synth was already disposed"),u<=this.now()?s==="attack"?this._triggerAttack(o,u,p):this._triggerRelease(o,u):this.context.setTimeout((()=>{this.disposed||this._scheduleEvent(s,o,u,p)}),u-this.now())}triggerAttack(s,o,u){Array.isArray(s)||(s=[s]);const p=this.toSeconds(o);return this._scheduleEvent("attack",s,p,u),this}triggerRelease(s,o){Array.isArray(s)||(s=[s]);const u=this.toSeconds(o);return this._scheduleEvent("release",s,u),this}triggerAttackRelease(s,o,u,p){const v=this.toSeconds(u);if(this.triggerAttack(s,v,p),Un(o)){Gt(Un(s),"If the duration is an array, the notes must also be an array");for(let C=0;C<s.length;C++){const _=o[Math.min(C,o.length-1)],E=this.toSeconds(_);Gt(E>0,"The duration must be greater than 0"),this.triggerRelease(s[C],v+E)}}else{const C=this.toSeconds(o);Gt(C>0,"The duration must be greater than 0"),this.triggerRelease(s,v+C)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(s){const o=Pn(s,["onsilence","context"]);return this.options=Ws(this.options,o),this._voices.forEach((u=>u.set(o))),this._dummyVoice.set(o),this}get(){return this._dummyVoice.get()}releaseAll(s){const o=this.toSeconds(s);return this._activeVoices.forEach((({voice:u})=>{u.triggerRelease(o)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((s=>s.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Oa extends Ks{constructor(){const s=at(Oa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(s),this.name="Sampler",this._activeSources=new Map;const o={};Object.keys(s.urls).forEach((u=>{const p=parseInt(u,10);if(Gt(_a(u)||Fs(p)&&isFinite(p),`url key is neither a note or midi pitch: ${u}`),_a(u)){const v=new es(this.context,u).toMidi();o[v]=s.urls[u]}else Fs(p)&&isFinite(p)&&(o[p]=s.urls[p])})),this._buffers=new go({urls:o,onload:s.onload,baseUrl:s.baseUrl,onerror:s.onerror}),this.attack=s.attack,this.release=s.release,this.curve=s.curve,this._buffers.loaded&&Promise.resolve().then(s.onload)}static getDefaults(){return Object.assign(Ks.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ce,onerror:ce,release:.1,urls:{}})}_findClosest(s){let o=0;for(;o<96;){if(this._buffers.has(s+o))return-o;if(this._buffers.has(s-o))return o;o++}throw new Error(`No available buffers for note: ${s}`)}triggerAttack(s,o,u=1){return this.log("triggerAttack",s,o,u),Array.isArray(s)||(s=[s]),s.forEach((p=>{const v=Nw(new es(this.context,p).toFrequency()),C=Math.round(v),_=v-C,E=this._findClosest(C),T=C-E,I=this._buffers.get(T),M=ho(E+_),L=new kr({url:I,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:M}).connect(this.output);L.start(o,0,I.duration/M,u),Un(this._activeSources.get(C))||this._activeSources.set(C,[]),this._activeSources.get(C).push(L),L.onended=()=>{if(this._activeSources&&this._activeSources.has(C)){const k=this._activeSources.get(C),q=k.indexOf(L);q!==-1&&k.splice(q,1)}}})),this}triggerRelease(s,o){return this.log("triggerRelease",s,o),Array.isArray(s)||(s=[s]),s.forEach((u=>{const p=new es(this.context,u).toMidi();if(this._activeSources.has(p)&&this._activeSources.get(p).length){const v=this._activeSources.get(p);o=this.toSeconds(o),v.forEach((C=>{C.stop(o)})),this._activeSources.set(p,[])}})),this}releaseAll(s){const o=this.toSeconds(s);return this._activeSources.forEach((u=>{for(;u.length;)u.shift().stop(o)})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(s,o,u,p=1){const v=this.toSeconds(u);return this.triggerAttack(s,v,p),Un(o)?(Gt(Un(s),"notes must be an array when duration is array"),s.forEach(((C,_)=>{const E=o[Math.min(_,o.length-1)];this.triggerRelease(C,v+this.toSeconds(E))}))):this.triggerRelease(s,v+this.toSeconds(o)),this}add(s,o,u){if(Gt(_a(s)||isFinite(s),`note must be a pitch or midi: ${s}`),_a(s)){const p=new es(this.context,s).toMidi();this._buffers.add(p,o,u)}else this._buffers.add(s,o,u);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((s=>{s.forEach((o=>o.dispose()))})),this._activeSources.clear(),this}}oi([Ar(0)],Oa.prototype,"attack",void 0),oi([Ar(0)],Oa.prototype,"release",void 0);class Ti extends Sn{constructor(){const s=at(Ti.getDefaults(),arguments,["callback","value"]);super(s),this.name="ToneEvent",this._state=new fo("stopped"),this._startOffset=0,this._loop=s.loop,this.callback=s.callback,this.value=s.value,this._loopStart=this.toTicks(s.loopStart),this._loopEnd=this.toTicks(s.loopEnd),this._playbackRate=s.playbackRate,this._probability=s.probability,this._humanize=s.humanize,this.mute=s.mute,this._playbackRate=s.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(Sn.getDefaults(),{callback:ce,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(s=-1){this._state.forEachFrom(s,(o=>{let u;if(o.state==="started"){o.id!==-1&&this.context.transport.clear(o.id);const p=o.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||Fs(this._loop)&&this._loop>1){u=1/0,Fs(this._loop)&&(u=this._loop*this._getLoopDuration());const v=this._state.getAfter(p);v!==null&&(u=Math.min(u,v.time-p)),u!==1/0&&(u=new ze(this.context,u));const C=new ze(this.context,this._getLoopDuration());o.id=this.context.transport.scheduleRepeat(this._tick.bind(this),C,new ze(this.context,p),u)}else o.id=this.context.transport.schedule(this._tick.bind(this),new ze(this.context,p))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(s){this._startOffset=s}get probability(){return this._probability}set probability(s){this._probability=s}get humanize(){return this._humanize}set humanize(s){this._humanize=s}start(s){const o=this.toTicks(s);return this._state.getValueAtTime(o)==="stopped"&&(this._state.add({id:-1,state:"started",time:o}),this._rescheduleEvents(o)),this}stop(s){this.cancel(s);const o=this.toTicks(s);if(this._state.getValueAtTime(o)==="started"){this._state.setStateAtTime("stopped",o,{id:-1});const u=this._state.getBefore(o);let p=o;u!==null&&(p=u.time),this._rescheduleEvents(p)}return this}cancel(s){s=Gs(s,-1/0);const o=this.toTicks(s);return this._state.forEachFrom(o,(u=>{this.context.transport.clear(u.id)})),this._state.cancel(o),this}_tick(s){const o=this.context.transport.getTicksAtTime(s);if(!this.mute&&this._state.getValueAtTime(o)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let u=.02;fd(this.humanize)||(u=this.toSeconds(this.humanize)),s+=(2*Math.random()-1)*u}this.callback(s,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(s){this._loop=s,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(s){this._playbackRate=s,this._rescheduleEvents()}get loopEnd(){return new ze(this.context,this._loopEnd).toSeconds()}set loopEnd(s){this._loopEnd=this.toTicks(s),this._loop&&this._rescheduleEvents()}get loopStart(){return new ze(this.context,this._loopStart).toSeconds()}set loopStart(s){this._loopStart=this.toTicks(s),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const s=this.context.transport.ticks,o=this._state.get(s);if(o!==null&&o.state==="started"){const u=this._getLoopDuration();return(s-o.time)%u/u}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class Va extends Sn{constructor(){const s=at(Va.getDefaults(),arguments,["callback","interval"]);super(s),this.name="Loop",this._event=new Ti({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:s.interval,playbackRate:s.playbackRate,probability:s.probability,humanize:s.humanize}),this.callback=s.callback,this.iterations=s.iterations}static getDefaults(){return Object.assign(Sn.getDefaults(),{interval:"4n",callback:ce,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(s){return this._event.start(s),this}stop(s){return this._event.stop(s),this}cancel(s){return this._event.cancel(s),this}_tick(s){this.callback(s)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(s){this._event.loopEnd=s}get playbackRate(){return this._event.playbackRate}set playbackRate(s){this._event.playbackRate=s}get humanize(){return this._event.humanize}set humanize(s){this._event.humanize=s}get probability(){return this._event.probability}set probability(s){this._event.probability=s}get mute(){return this._event.mute}set mute(s){this._event.mute=s}get iterations(){return this._event.loop===!0?1/0:this._event.loop}set iterations(s){this._event.loop=s===1/0||s}dispose(){return super.dispose(),this._event.dispose(),this}}class Wa extends Ti{constructor(){const s=at(Wa.getDefaults(),arguments,["callback","events"]);super(s),this.name="Part",this._state=new fo("stopped"),this._events=new Set,this._state.increasing=!0,s.events.forEach((o=>{Un(o)?this.add(o[0],o[1]):this.add(o)}))}static getDefaults(){return Object.assign(Ti.getDefaults(),{events:[]})}start(s,o){const u=this.toTicks(s);if(this._state.getValueAtTime(u)!=="started"){o=Gs(o,this._loop?this._loopStart:0),o=this._loop?Gs(o,this._loopStart):Gs(o,0);const p=this.toTicks(o);this._state.add({id:-1,offset:p,state:"started",time:u}),this._forEach((v=>{this._startNote(v,u,p)}))}return this}_startNote(s,o,u){o-=u,this._loop?s.startOffset>=this._loopStart&&s.startOffset<this._loopEnd?(s.startOffset<u&&(o+=this._getLoopDuration()),s.start(new ze(this.context,o))):s.startOffset<this._loopStart&&s.startOffset>=u&&(s.loop=!1,s.start(new ze(this.context,o))):s.startOffset>=u&&s.start(new ze(this.context,o))}get startOffset(){return this._startOffset}set startOffset(s){this._startOffset=s,this._forEach((o=>{o.startOffset+=this._startOffset}))}stop(s){const o=this.toTicks(s);return this._state.cancel(o),this._state.setStateAtTime("stopped",o),this._forEach((u=>{u.stop(s)})),this}at(s,o){const u=new dn(this.context,s).toTicks(),p=new ze(this.context,1).toSeconds(),v=this._events.values();let C=v.next();for(;!C.done;){const _=C.value;if(Math.abs(u-_.startOffset)<p)return Ae(o)&&(_.value=o),_;C=v.next()}return Ae(o)?(this.add(s,o),this.at(s)):null}add(s,o){s instanceof Object&&Reflect.has(s,"time")&&(s=(o=s).time);const u=this.toTicks(s);let p;return o instanceof Ti?(p=o,p.callback=this._tick.bind(this)):p=new Ti({callback:this._tick.bind(this),context:this.context,value:o}),p.startOffset=u,p.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(p),this._restartEvent(p),this}_restartEvent(s){this._state.forEach((o=>{o.state==="started"?this._startNote(s,o.time,o.offset):s.stop(new ze(this.context,o.time))}))}remove(s,o){return tr(s)&&s.hasOwnProperty("time")&&(s=(o=s).time),s=this.toTicks(s),this._events.forEach((u=>{u.startOffset===s&&(ms(o)||Ae(o)&&u.value===o)&&(this._events.delete(u),u.dispose())})),this}clear(){return this._forEach((s=>s.dispose())),this._events.clear(),this}cancel(s){return this._forEach((o=>o.cancel(s))),this._state.cancel(this.toTicks(s)),this}_forEach(s){return this._events&&this._events.forEach((o=>{o instanceof Wa?o._forEach(s):s(o)})),this}_setAll(s,o){this._forEach((u=>{u[s]=o}))}_tick(s,o){this.mute||this.callback(s,o)}_testLoopBoundries(s){this._loop&&(s.startOffset<this._loopStart||s.startOffset>=this._loopEnd)?s.cancel(0):s.state==="stopped"&&this._restartEvent(s)}get probability(){return this._probability}set probability(s){this._probability=s,this._setAll("probability",s)}get humanize(){return this._humanize}set humanize(s){this._humanize=s,this._setAll("humanize",s)}get loop(){return this._loop}set loop(s){this._loop=s,this._forEach((o=>{o.loopStart=this.loopStart,o.loopEnd=this.loopEnd,o.loop=s,this._testLoopBoundries(o)}))}get loopEnd(){return new ze(this.context,this._loopEnd).toSeconds()}set loopEnd(s){this._loopEnd=this.toTicks(s),this._loop&&this._forEach((o=>{o.loopEnd=s,this._testLoopBoundries(o)}))}get loopStart(){return new ze(this.context,this._loopStart).toSeconds()}set loopStart(s){this._loopStart=this.toTicks(s),this._loop&&this._forEach((o=>{o.loopStart=this.loopStart,this._testLoopBoundries(o)}))}get playbackRate(){return this._playbackRate}set playbackRate(s){this._playbackRate=s,this._setAll("playbackRate",s)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*Mx(g){let s=0;for(;s<g;)s=gA(s,0,g-1),yield s,s++}function*Qx(g){let s=g-1;for(;s>=0;)s=gA(s,0,g-1),yield s,s--}function*Ga(g,s){for(;;)yield*s(g)}function*Yw(g,s){let o=s?0:g-1;for(;;)o=gA(o,0,g-1),yield o,s?(o++,o>=g-1&&(s=!1)):(o--,o<=0&&(s=!0))}function*Ux(g){let s=0,o=0;for(;s<g;)s=gA(s,0,g-1),yield s,o++,s+=o%2?2:-1}function*Px(g){let s=g-1,o=0;for(;s>=0;)s=gA(s,0,g-1),yield s,o++,s+=o%2?-2:1}function*Dx(g){const s=[];for(let o=0;o<g;o++)s.push(o);for(;s.length>0;)yield gA(s.splice(Math.floor(s.length*Math.random()),1)[0],0,g-1)}function*jw(g,s="up",o=0){switch(Gt(g>=1,"The number of values must be at least one"),s){case"up":yield*Ga(g,Mx);case"down":yield*Ga(g,Qx);case"upDown":yield*Yw(g,!0);case"downUp":yield*Yw(g,!1);case"alternateUp":yield*Ga(g,Ux);case"alternateDown":yield*Ga(g,Px);case"random":yield*(function*(u){for(;;)yield Math.floor(Math.random()*u)})(g);case"randomOnce":yield*Ga(g,Dx);case"randomWalk":yield*(function*(u){let p=Math.floor(Math.random()*u);for(;;)p===0?p++:p===u-1||Math.random()<.5?p--:p++,yield p})(g)}}class Vd extends Va{constructor(){const s=at(Vd.getDefaults(),arguments,["callback","values","pattern"]);super(s),this.name="Pattern",this.callback=s.callback,this._values=s.values,this._pattern=jw(s.values.length,s.pattern),this._type=s.pattern}static getDefaults(){return Object.assign(Va.getDefaults(),{pattern:"up",values:[],callback:ce})}_tick(s){const o=this._pattern.next();this._index=o.value,this._value=this._values[o.value],this.callback(s,this._value)}get values(){return this._values}set values(s){this._values=s,this.pattern=this._type}get value(){return this._value}get index(){return this._index}get pattern(){return this._type}set pattern(s){this._type=s,this._pattern=jw(this._values.length,this._type)}}class Wd extends Ti{constructor(){const s=at(Wd.getDefaults(),arguments,["callback","events","subdivision"]);super(s),this.name="Sequence",this._part=new Wa({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[],this._subdivision=this.toTicks(s.subdivision),this.events=s.events,this.loop=s.loop,this.loopStart=s.loopStart,this.loopEnd=s.loopEnd,this.playbackRate=s.playbackRate,this.probability=s.probability,this.humanize=s.humanize,this.mute=s.mute,this.playbackRate=s.playbackRate}static getDefaults(){return Object.assign(Pn(Ti.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(s,o){o===null||this.mute||this.callback(s,o)}get events(){return this._events}set events(s){this.clear(),this._eventsArray=s,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(s,o){return this._part.start(s,o&&this._indexTime(o)),this}stop(s){return this._part.stop(s),this}get subdivision(){return new ze(this.context,this._subdivision).toSeconds()}_createSequence(s){return new Proxy(s,{get:(o,u)=>o[u],set:(o,u,p)=>(Ai(u)&&isFinite(parseInt(u,10))&&Un(p)?o[u]=this._createSequence(p):o[u]=p,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(s,o,u){s.forEach(((p,v)=>{const C=v*o+u;if(Un(p))this._rescheduleSequence(p,o/p.length,C);else{const _=new ze(this.context,C,"i").toSeconds();this._part.add(_,p)}}))}_indexTime(s){return new ze(this.context,s*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(s){this._part.loop=s}get loopStart(){return this._loopStart}set loopStart(s){this._loopStart=s,this._part.loopStart=this._indexTime(s)}get loopEnd(){return this._loopEnd}set loopEnd(s){this._loopEnd=s,this._part.loopEnd=s===0?this._indexTime(this._eventsArray.length):this._indexTime(s)}get startOffset(){return this._part.startOffset}set startOffset(s){this._part.startOffset=s}get playbackRate(){return this._part.playbackRate}set playbackRate(s){this._part.playbackRate=s}get probability(){return this._part.probability}set probability(s){this._part.probability=s}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(s){this._part.humanize=s}get length(){return this._part.length}}class So extends ft{constructor(){const s=at(So.getDefaults(),arguments,["fade"]);super(s),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new qw({context:this.context}),this.a=new Wt({context:this.context,gain:0}),this.b=new Wt({context:this.context,gain:0}),this.output=new Wt({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new Yt({context:this.context,units:"normalRange",value:s.fade}),zt(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",ns(this._split,this.a.gain,0),ns(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(ft.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class vn extends ft{constructor(s){super(s),this.name="Effect",this._dryWet=new So({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Wt({context:this.context}),this.effectReturn=new Wt({context:this.context}),this.input=new Wt({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(s.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],zt(this,"wet")}static getDefaults(){return Object.assign(ft.getDefaults(),{wet:1})}connectEffect(s){return this._internalChannels.push(s),this.effectSend.chain(s,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Oc extends vn{constructor(s){super(s),this.name="LFOEffect",this._lfo=new ss({context:this.context,frequency:s.frequency,amplitude:s.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=s.type,zt(this,["frequency","depth"])}static getDefaults(){return Object.assign(vn.getDefaults(),{frequency:1,type:"sine",depth:1})}start(s){return this._lfo.start(s),this}stop(s){return this._lfo.stop(s),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(s){this._lfo.type=s}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Gd extends Oc{constructor(){const s=at(Gd.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(s),this.name="AutoFilter",this.filter=new ks(Object.assign(s.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=s.octaves,this.baseFrequency=s.baseFrequency}static getDefaults(){return Object.assign(Oc.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(s){this._lfo.min=this.toFrequency(s),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(s){this._octaves=s,this._lfo.max=this._lfo.min*Math.pow(2,s)}dispose(){return super.dispose(),this.filter.dispose(),this}}class Ka extends ft{constructor(){const s=at(Ka.getDefaults(),arguments,["pan"]);super(s),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new te({context:this.context,param:this._panner.pan,value:s.pan,minValue:-1,maxValue:1}),this._panner.channelCount=s.channelCount,this._panner.channelCountMode="explicit",zt(this,"pan")}static getDefaults(){return Object.assign(ft.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class Kd extends Oc{constructor(){const s=at(Kd.getDefaults(),arguments,["frequency"]);super(s),this.name="AutoPanner",this._panner=new Ka({context:this.context,channelCount:s.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(Oc.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class qa extends ft{constructor(){const s=at(qa.getDefaults(),arguments,["smoothing"]);super(s),this.name="Follower",this._abs=this.input=new Kw({context:this.context}),this._lowpass=this.output=new Ha({context:this.context,frequency:1/this.toSeconds(s.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=s.smoothing}static getDefaults(){return Object.assign(ft.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(s){this._smoothing=s,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class qd extends vn{constructor(){const s=at(qd.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);super(s),this.name="AutoWah",this._follower=new qa({context:this.context,smoothing:s.follower}),this._sweepRange=new Hc({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(s.baseFrequency),this._octaves=s.octaves,this._inputBoost=new Wt({context:this.context}),this._bandpass=new ks({context:this.context,rolloff:-48,frequency:0,Q:s.Q}),this._peaking=new ks({context:this.context,type:"peaking"}),this._peaking.gain.value=s.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=s.sensitivity,zt(this,["gain","Q"])}static getDefaults(){return Object.assign(vn.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(s){this._octaves=s,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(s){this._follower.smoothing=s}get baseFrequency(){return this._baseFrequency}set baseFrequency(s){this._baseFrequency=this.toFrequency(s),this._setSweepRange()}get sensitivity(){return Ea(1/this._inputBoost.gain.value)}set sensitivity(s){this._inputBoost.gain.value=1/uo(s)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const Jw="bit-crusher";zw(Jw,`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`);class $d extends vn{constructor(){const s=at($d.getDefaults(),arguments,["bits"]);super(s),this.name="BitCrusher",this._bitCrusherWorklet=new zd({context:this.context,bits:s.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(vn.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class zd extends Hd{constructor(){const s=at(zd.getDefaults(),arguments);super(s),this.name="BitCrusherWorklet",this.input=new Wt({context:this.context}),this.output=new Wt({context:this.context}),this.bits=new te({context:this.context,value:s.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(Hd.getDefaults(),{bits:12})}_audioWorkletName(){return Jw}onReady(s){Us(this.input,s,this.output);const o=s.parameters.get("bits");this.bits.setParam(o)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class Xd extends vn{constructor(){const s=at(Xd.getDefaults(),arguments,["order"]);super(s),this.name="Chebyshev",this._shaper=new li({context:this.context,length:4096}),this._order=s.order,this.connectEffect(this._shaper),this.order=s.order,this.oversample=s.oversample}static getDefaults(){return Object.assign(vn.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(s,o,u){return u.has(o)||(o===0?u.set(o,0):o===1?u.set(o,s):u.set(o,2*s*this._getCoefficient(s,o-1,u)-this._getCoefficient(s,o-2,u))),u.get(o)}get order(){return this._order}set order(s){Gt(Number.isInteger(s),"'order' must be an integer"),this._order=s,this._shaper.setMap((o=>this._getCoefficient(o,s,new Map)))}get oversample(){return this._shaper.oversample}set oversample(s){this._shaper.oversample=s}dispose(){return super.dispose(),this._shaper.dispose(),this}}class CA extends ft{constructor(){const s=at(CA.getDefaults(),arguments,["channels"]);super(s),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(s.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(ft.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Hr extends ft{constructor(){const s=at(Hr.getDefaults(),arguments,["channels"]);super(s),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(s.channels)}static getDefaults(){return Object.assign(ft.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Fi extends ft{constructor(s){super(s),this.name="StereoEffect",this.input=new Wt({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new So({context:this.context,fade:s.wet}),this.wet=this._dryWet.fade,this._split=new CA({context:this.context,channels:2}),this._merge=new Hr({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),zt(this,["wet"])}connectEffectLeft(...s){this._split.connect(s[0],0,0),Us(...s),ns(s[s.length-1],this._merge,0,0)}connectEffectRight(...s){this._split.connect(s[0],1,0),Us(...s),ns(s[s.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(ft.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Yd extends Fi{constructor(s){super(s),this.feedback=new Yt({context:this.context,value:s.feedback,units:"normalRange"}),this._feedbackL=new Wt({context:this.context}),this._feedbackR=new Wt({context:this.context}),this._feedbackSplit=new CA({context:this.context,channels:2}),this._feedbackMerge=new Hr({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),zt(this,["feedback"])}static getDefaults(){return Object.assign(Fi.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class jd extends Yd{constructor(){const s=at(jd.getDefaults(),arguments,["frequency","delayTime","depth"]);super(s),this.name="Chorus",this._depth=s.depth,this._delayTime=s.delayTime/1e3,this._lfoL=new ss({context:this.context,frequency:s.frequency,min:0,max:1}),this._lfoR=new ss({context:this.context,frequency:s.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Ps({context:this.context}),this._delayNodeR=new Ps({context:this.context}),this.frequency=this._lfoL.frequency,zt(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=s.type,this.spread=s.spread}static getDefaults(){return Object.assign(Yd.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(s){this._depth=s;const o=this._delayTime*s;this._lfoL.min=Math.max(this._delayTime-o,0),this._lfoL.max=this._delayTime+o,this._lfoR.min=Math.max(this._delayTime-o,0),this._lfoR.max=this._delayTime+o}get delayTime(){return 1e3*this._delayTime}set delayTime(s){this._delayTime=s/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(s){this._lfoL.type=s,this._lfoR.type=s}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(s){this._lfoL.phase=90-s/2,this._lfoR.phase=s/2+90}start(s){return this._lfoL.start(s),this._lfoR.start(s),this}stop(s){return this._lfoL.stop(s),this._lfoR.stop(s),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class Jd extends vn{constructor(){const s=at(Jd.getDefaults(),arguments,["distortion"]);super(s),this.name="Distortion",this._shaper=new li({context:this.context,length:4096}),this._distortion=s.distortion,this.connectEffect(this._shaper),this.distortion=s.distortion,this.oversample=s.oversample}static getDefaults(){return Object.assign(vn.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(s){this._distortion=s;const o=100*s,u=Math.PI/180;this._shaper.setMap((p=>Math.abs(p)<.001?0:(3+o)*p*20*u/(Math.PI+o*Math.abs(p))))}get oversample(){return this._shaper.oversample}set oversample(s){this._shaper.oversample=s}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Vc extends vn{constructor(s){super(s),this.name="FeedbackEffect",this._feedbackGain=new Wt({context:this.context,gain:s.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,zt(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(vn.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Zd extends Vc{constructor(){const s=at(Zd.getDefaults(),arguments,["delayTime","feedback"]);super(s),this.name="FeedbackDelay",this._delayNode=new Ps({context:this.context,delayTime:s.delayTime,maxDelay:s.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),zt(this,"delayTime")}static getDefaults(){return Object.assign(Vc.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class kx extends ft{constructor(s){super(s),this.name="PhaseShiftAllpass",this.input=new Wt({context:this.context}),this.output=new Wt({context:this.context}),this.offset90=new Wt({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),Us(this.input,...this._bank0,this._oneSampleDelay,this.output),Us(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(s){return s.map((o=>{const u=[[o*o,0,-1],[1,0,-o*o]];return this.context.createIIRFilter(u[0],u[1])}))}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((s=>s.disconnect())),this._bank1.forEach((s=>s.disconnect())),this._oneSampleDelay.disconnect(),this}}class tf extends vn{constructor(){const s=at(tf.getDefaults(),arguments,["frequency"]);super(s),this.name="FrequencyShifter",this.frequency=new Yt({context:this.context,units:"frequency",value:s.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Ia({context:this.context,type:"sine"}),this._cosine=new Xe({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new Ye({context:this.context}),this._cosineMultiply=new Ye({context:this.context}),this._negate=new Md({context:this.context}),this._add=new vA({context:this.context}),this._phaseShifter=new kx({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const o=this.immediate();this._sine.start(o),this._cosine.start(o)}static getDefaults(){return Object.assign(vn.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}const Zw=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],tv=[225,556,441,341];class ef extends Fi{constructor(){const s=at(ef.getDefaults(),arguments,["roomSize","dampening"]);super(s),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[],this.roomSize=new Yt({context:this.context,value:s.roomSize,units:"normalRange"}),this._allpassFiltersL=tv.map((o=>{const u=this.context.createBiquadFilter();return u.type="allpass",u.frequency.value=o,u})),this._allpassFiltersR=tv.map((o=>{const u=this.context.createBiquadFilter();return u.type="allpass",u.frequency.value=o,u})),this._combFilters=Zw.map(((o,u)=>{const p=new Na({context:this.context,dampening:s.dampening,delayTime:o});return u<Zw.length/2?this.connectEffectLeft(p,...this._allpassFiltersL):this.connectEffectRight(p,...this._allpassFiltersR),this.roomSize.connect(p.resonance),p})),zt(this,["roomSize"])}static getDefaults(){return Object.assign(Fi.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(s){this._combFilters.forEach((o=>o.dampening=s))}dispose(){return super.dispose(),this._allpassFiltersL.forEach((s=>s.disconnect())),this._allpassFiltersR.forEach((s=>s.disconnect())),this._combFilters.forEach((s=>s.dispose())),this.roomSize.dispose(),this}}const ev=[.06748,.06404,.08212,.09004],Lx=[.773,.802,.753,.733],Rx=[347,113,37];class nf extends Fi{constructor(){const s=at(nf.getDefaults(),arguments,["roomSize"]);super(s),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[],this.roomSize=new Yt({context:this.context,value:s.roomSize,units:"normalRange"}),this._scaleRoomSize=new rr({context:this.context,min:-.733,max:.197}),this._allpassFilters=Rx.map((o=>{const u=this.context.createBiquadFilter();return u.type="allpass",u.frequency.value=o,u})),this._feedbackCombFilters=ev.map(((o,u)=>{const p=new Ra({context:this.context,delayTime:o});return this._scaleRoomSize.connect(p.resonance),p.resonance.value=Lx[u],u<ev.length/2?this.connectEffectLeft(...this._allpassFilters,p):this.connectEffectRight(...this._allpassFilters,p),p})),this.roomSize.connect(this._scaleRoomSize),zt(this,["roomSize"])}static getDefaults(){return Object.assign(Fi.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach((s=>s.disconnect())),this._feedbackCombFilters.forEach((s=>s.dispose())),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class nv extends Yd{constructor(s){super(s),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),zt(this,["feedback"])}}class sf extends nv{constructor(){const s=at(sf.getDefaults(),arguments,["delayTime","feedback"]);super(s),this.name="PingPongDelay",this._leftDelay=new Ps({context:this.context,maxDelay:s.maxDelay}),this._rightDelay=new Ps({context:this.context,maxDelay:s.maxDelay}),this._rightPreDelay=new Ps({context:this.context,maxDelay:s.maxDelay}),this.delayTime=new Yt({context:this.context,units:"time",value:s.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),zt(this,["delayTime"])}static getDefaults(){return Object.assign(nv.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class rf extends Vc{constructor(){const s=at(rf.getDefaults(),arguments,["pitch"]);super(s),this.name="PitchShift",this._frequency=new Yt({context:this.context}),this._delayA=new Ps({maxDelay:1,context:this.context}),this._lfoA=new ss({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Ps({maxDelay:1,context:this.context}),this._lfoB=new ss({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new So({context:this.context}),this._crossFadeLFO=new ss({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Ps({delayTime:s.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,zt(this,"delayTime"),this._pitch=s.pitch,this._windowSize=s.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const o=this.now();this._lfoA.start(o),this._lfoB.start(o),this._crossFadeLFO.start(o),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Vc.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(s){this._pitch=s;let o=0;s<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,o=ho(s-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,o=ho(s)-1),this._frequency.value=o*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(s){this._windowSize=this.toSeconds(s),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class Af extends Fi{constructor(){const s=at(Af.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(s),this.name="Phaser",this._lfoL=new ss({context:this.context,frequency:s.frequency,min:0,max:1}),this._lfoR=new ss({context:this.context,frequency:s.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(s.baseFrequency),this._octaves=s.octaves,this.Q=new Yt({context:this.context,value:s.Q,units:"positive"}),this._filtersL=this._makeFilters(s.stages,this._lfoL),this._filtersR=this._makeFilters(s.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=s.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=s.baseFrequency,this.octaves=s.octaves,this._lfoL.start(),this._lfoR.start(),zt(this,["frequency","Q"])}static getDefaults(){return Object.assign(Fi.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(s,o){const u=[];for(let p=0;p<s;p++){const v=this.context.createBiquadFilter();v.type="allpass",this.Q.connect(v.Q),o.connect(v.frequency),u.push(v)}return u}get octaves(){return this._octaves}set octaves(s){this._octaves=s;const o=this._baseFrequency*Math.pow(2,s);this._lfoL.max=o,this._lfoR.max=o}get baseFrequency(){return this._baseFrequency}set baseFrequency(s){this._baseFrequency=this.toFrequency(s),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((s=>s.disconnect())),this._filtersR.forEach((s=>s.disconnect())),this.frequency.dispose(),this}}class of extends vn{constructor(){const s=at(of.getDefaults(),arguments,["decay"]);super(s),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const o=this.toSeconds(s.decay);wn(o,.001),this._decay=o;const u=this.toSeconds(s.preDelay);wn(u,0),this._preDelay=u,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(vn.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(s){wn(s=this.toSeconds(s),.001),this._decay=s,this.generate()}get preDelay(){return this._preDelay}set preDelay(s){wn(s=this.toSeconds(s),0),this._preDelay=s,this.generate()}generate(){return Re(this,void 0,void 0,(function*(){const s=this.ready,o=new co(2,this._decay+this._preDelay,this.context.sampleRate),u=new Lr({context:o}),p=new Lr({context:o}),v=new Hr({context:o});u.connect(v,0,0),p.connect(v,0,1);const C=new Wt({context:o}).toDestination();v.connect(C),u.start(0),p.start(0),C.gain.setValueAtTime(0,0),C.gain.setValueAtTime(1,this._preDelay),C.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const _=o.render();return this.ready=_.then(ce),yield s,this._convolver.buffer=(yield _).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class $a extends ft{constructor(){super(at($a.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new CA({channels:2,context:this.context}),this._midAdd=new vA({context:this.context}),this.mid=new Ye({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new BA({context:this.context}),this.side=new Ye({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class za extends ft{constructor(){super(at(za.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new Wt({context:this.context}),this.side=new Wt({context:this.context}),this._left=new vA({context:this.context}),this._leftMult=new Ye({context:this.context,value:Math.SQRT1_2}),this._right=new BA({context:this.context}),this._rightMult=new Ye({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new Hr({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class sv extends vn{constructor(s){super(s),this.name="MidSideEffect",this._midSideMerge=new za({context:this.context}),this._midSideSplit=new $a({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...s){this._midSend.chain(...s,this._midReturn)}connectEffectSide(...s){this._sideSend.chain(...s,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class af extends sv{constructor(){const s=at(af.getDefaults(),arguments,["width"]);super(s),this.name="StereoWidener",this.width=new Yt({context:this.context,value:s.width,units:"normalRange"}),zt(this,["width"]),this._twoTimesWidthMid=new Ye({context:this.context,value:2}),this._twoTimesWidthSide=new Ye({context:this.context,value:2}),this._midMult=new Ye({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new BA({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),ns(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new Ye({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(sv.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class lf extends Fi{constructor(){const s=at(lf.getDefaults(),arguments,["frequency","depth"]);super(s),this.name="Tremolo",this._lfoL=new ss({context:this.context,type:s.type,min:1,max:0}),this._lfoR=new ss({context:this.context,type:s.type,min:1,max:0}),this._amplitudeL=new Wt({context:this.context}),this._amplitudeR=new Wt({context:this.context}),this.frequency=new Yt({context:this.context,value:s.frequency,units:"frequency"}),this.depth=new Yt({context:this.context,value:s.depth,units:"normalRange"}),zt(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=s.spread}static getDefaults(){return Object.assign(Fi.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(s){return this._lfoL.start(s),this._lfoR.start(s),this}stop(s){return this._lfoL.stop(s),this._lfoR.stop(s),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(s){this._lfoL.type=s,this._lfoR.type=s}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(s){this._lfoL.phase=90-s/2,this._lfoR.phase=s/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class cf extends vn{constructor(){const s=at(cf.getDefaults(),arguments,["frequency","depth"]);super(s),this.name="Vibrato",this._delayNode=new Ps({context:this.context,delayTime:0,maxDelay:s.maxDelay}),this._lfo=new ss({context:this.context,type:s.type,min:0,max:s.maxDelay,frequency:s.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=s.depth,zt(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(vn.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(s){this._lfo.type=s}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Xa extends ft{constructor(){const s=at(Xa.getDefaults(),arguments,["type","size"]);super(s),this.name="Analyser",this._analysers=[],this._buffers=[],this.input=this.output=this._gain=new Wt({context:this.context}),this._split=new CA({context:this.context,channels:s.channels}),this.input.connect(this._split),wn(s.channels,1);for(let o=0;o<s.channels;o++)this._analysers[o]=this.context.createAnalyser(),this._split.connect(this._analysers[o],o,0);this.size=s.size,this.type=s.type,this.smoothing=s.smoothing}static getDefaults(){return Object.assign(ft.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach(((s,o)=>{const u=this._buffers[o];this._type==="fft"?s.getFloatFrequencyData(u):this._type==="waveform"&&s.getFloatTimeDomainData(u)})),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(s){this._analysers.forEach(((o,u)=>{o.fftSize=2*s,this._buffers[u]=new Float32Array(s)}))}get channels(){return this._analysers.length}get type(){return this._type}set type(s){Gt(s==="waveform"||s==="fft",`Analyser: invalid type: ${s}`),this._type=s}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(s){this._analysers.forEach((o=>o.smoothingTimeConstant=s))}dispose(){return super.dispose(),this._analysers.forEach((s=>s.disconnect())),this._split.dispose(),this._gain.dispose(),this}}class Nr extends ft{constructor(){super(at(Nr.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Xa({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class uf extends Nr{constructor(){const s=at(uf.getDefaults(),arguments,["smoothing"]);super(s),this.name="Meter",this.input=this.output=this._analyser=new Xa({context:this.context,size:256,type:"waveform",channels:s.channelCount}),this.smoothing=s.smoothing,this.normalRange=s.normalRange,this._rms=new Array(s.channelCount),this._rms.fill(0)}static getDefaults(){return Object.assign(Nr.getDefaults(),{smoothing:.8,normalRange:!1,channelCount:1})}getLevel(){return ro("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const s=this._analyser.getValue(),o=(this.channels===1?[s]:s).map(((u,p)=>{const v=u.reduce(((_,E)=>_+E*E),0),C=Math.sqrt(v/u.length);return this._rms[p]=Math.max(C,this._rms[p]*this.smoothing),this.normalRange?this._rms[p]:Ea(this._rms[p])}));return this.channels===1?o[0]:o}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class hf extends Nr{constructor(){const s=at(hf.getDefaults(),arguments,["size"]);super(s),this.name="FFT",this.normalRange=s.normalRange,this._analyser.type="fft",this.size=s.size}static getDefaults(){return Object.assign(ft.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map((s=>this.normalRange?uo(s):s))}get size(){return this._analyser.size}set size(s){this._analyser.size=s}get smoothing(){return this._analyser.smoothing}set smoothing(s){this._analyser.smoothing=s}getFrequencyOfIndex(s){return Gt(0<=s&&s<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),s*this.context.sampleRate/(2*this.size)}}class df extends Nr{constructor(){super(at(df.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class ff extends Nr{constructor(){const s=at(ff.getDefaults(),arguments,["size"]);super(s),this.name="Waveform",this._analyser.type="waveform",this.size=s.size}static getDefaults(){return Object.assign(Nr.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(s){this._analyser.size=s}}class an extends ft{constructor(){const s=at(an.getDefaults(),arguments,["solo"]);super(s),this.name="Solo",this.input=this.output=new Wt({context:this.context}),an._allSolos.has(this.context)||an._allSolos.set(this.context,new Set),an._allSolos.get(this.context).add(this),this.solo=s.solo}static getDefaults(){return Object.assign(ft.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(s){s?this._addSolo():this._removeSolo(),an._allSolos.get(this.context).forEach((o=>o._updateSolo()))}get muted(){return this.input.gain.value===0}_addSolo(){an._soloed.has(this.context)||an._soloed.set(this.context,new Set),an._soloed.get(this.context).add(this)}_removeSolo(){an._soloed.has(this.context)&&an._soloed.get(this.context).delete(this)}_isSoloed(){return an._soloed.has(this.context)&&an._soloed.get(this.context).has(this)}_noSolos(){return!an._soloed.has(this.context)||an._soloed.has(this.context)&&an._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),an._allSolos.get(this.context).delete(this),this._removeSolo(),this}}an._allSolos=new Map,an._soloed=new Map;class Wc extends ft{constructor(){const s=at(Wc.getDefaults(),arguments,["pan","volume"]);super(s),this.name="PanVol",this._panner=this.input=new Ka({context:this.context,pan:s.pan,channelCount:s.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new nr({context:this.context,volume:s.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=s.mute,zt(this,["pan","volume"])}static getDefaults(){return Object.assign(ft.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(s){this._volume.mute=s}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class bA extends ft{constructor(){const s=at(bA.getDefaults(),arguments,["volume","pan"]);super(s),this.name="Channel",this._solo=this.input=new an({solo:s.solo,context:this.context}),this._panVol=this.output=new Wc({context:this.context,pan:s.pan,volume:s.volume,mute:s.mute,channelCount:s.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),zt(this,["pan","volume"])}static getDefaults(){return Object.assign(ft.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(s){this._solo.solo=s}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(s){this._panVol.mute=s}_getBus(s){return bA.buses.has(s)||bA.buses.set(s,new Wt({context:this.context})),bA.buses.get(s)}send(s,o=0){const u=this._getBus(s),p=new Wt({context:this.context,units:"decibels",gain:o});return this.connect(p),p.connect(u),p}receive(s){return this._getBus(s).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}bA.buses=new Map;class pf extends ft{constructor(){super(at(pf.getDefaults(),arguments)),this.name="Mono",this.input=new Wt({context:this.context}),this._merge=this.output=new Hr({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class Ya extends ft{constructor(){const s=at(Ya.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(s),this.name="MultibandSplit",this.input=new Wt({context:this.context}),this.output=void 0,this.low=new ks({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new ks({context:this.context,frequency:0,type:"highpass"}),this.mid=new ks({context:this.context,frequency:0,type:"lowpass"}),this.high=new ks({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new Yt({context:this.context,units:"frequency",value:s.lowFrequency}),this.highFrequency=new Yt({context:this.context,units:"frequency",value:s.highFrequency}),this.Q=new Yt({context:this.context,units:"positive",value:s.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),zt(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(ft.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Sa(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class mf extends ft{constructor(){const s=at(mf.getDefaults(),arguments,["positionX","positionY","positionZ"]);super(s),this.name="Panner3D",this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=s.panningModel,this.maxDistance=s.maxDistance,this.distanceModel=s.distanceModel,this.coneOuterGain=s.coneOuterGain,this.coneOuterAngle=s.coneOuterAngle,this.coneInnerAngle=s.coneInnerAngle,this.refDistance=s.refDistance,this.rolloffFactor=s.rolloffFactor,this.positionX=new te({context:this.context,param:this._panner.positionX,value:s.positionX}),this.positionY=new te({context:this.context,param:this._panner.positionY,value:s.positionY}),this.positionZ=new te({context:this.context,param:this._panner.positionZ,value:s.positionZ}),this.orientationX=new te({context:this.context,param:this._panner.orientationX,value:s.orientationX}),this.orientationY=new te({context:this.context,param:this._panner.orientationY,value:s.orientationY}),this.orientationZ=new te({context:this.context,param:this._panner.orientationZ,value:s.orientationZ})}static getDefaults(){return Object.assign(ft.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(s,o,u){return this.positionX.value=s,this.positionY.value=o,this.positionZ.value=u,this}setOrientation(s,o,u){return this.orientationX.value=s,this.orientationY.value=o,this.orientationZ.value=u,this}get panningModel(){return this._panner.panningModel}set panningModel(s){this._panner.panningModel=s}get refDistance(){return this._panner.refDistance}set refDistance(s){this._panner.refDistance=s}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(s){this._panner.rolloffFactor=s}get distanceModel(){return this._panner.distanceModel}set distanceModel(s){this._panner.distanceModel=s}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(s){this._panner.coneInnerAngle=s}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(s){this._panner.coneOuterAngle=s}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(s){this._panner.coneOuterGain=s}get maxDistance(){return this._panner.maxDistance}set maxDistance(s){this._panner.maxDistance=s}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class Gc extends ft{constructor(){const s=at(Gc.getDefaults(),arguments);super(s),this.name="Recorder",this.input=new Wt({context:this.context}),Gt(Gc.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:s.mimeType})}static getDefaults(){return ft.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return Is!==null&&Reflect.has(Is,"MediaRecorder")}get state(){return this._recorder.state==="inactive"?"stopped":this._recorder.state==="paused"?"paused":"started"}start(){return Re(this,void 0,void 0,(function*(){Gt(this.state!=="started","Recorder is already started");const s=new Promise((o=>{const u=()=>{this._recorder.removeEventListener("start",u,!1),o()};this._recorder.addEventListener("start",u,!1)}));return this.state==="stopped"?this._recorder.start():this._recorder.resume(),yield s}))}stop(){return Re(this,void 0,void 0,(function*(){Gt(this.state!=="stopped","Recorder is not started");const s=new Promise((o=>{const u=p=>{this._recorder.removeEventListener("dataavailable",u,!1),o(p.data)};this._recorder.addEventListener("dataavailable",u,!1)}));return this._recorder.stop(),yield s}))}pause(){return Gt(this.state==="started","Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class or extends ft{constructor(){const s=at(or.getDefaults(),arguments,["threshold","ratio"]);super(s),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new te({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:s.threshold}),this.attack=new te({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:s.attack}),this.release=new te({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:s.release}),this.knee=new te({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:s.knee}),this.ratio=new te({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:s.ratio}),zt(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(ft.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class gf extends ft{constructor(){const s=at(gf.getDefaults(),arguments,["threshold","smoothing"]);super(s),this.name="Gate",this._follower=new qa({context:this.context,smoothing:s.smoothing}),this._gt=new Rc({context:this.context,value:uo(s.threshold)}),this.input=new Wt({context:this.context}),this._gate=this.output=new Wt({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(ft.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return Ea(this._gt.value)}set threshold(s){this._gt.value=uo(s)}get smoothing(){return this._follower.smoothing}set smoothing(s){this._follower.smoothing=s}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class wf extends ft{constructor(){const s=at(wf.getDefaults(),arguments,["threshold"]);super(s),this.name="Limiter",this._compressor=this.input=this.output=new or({context:this.context,ratio:20,attack:.003,release:.01,threshold:s.threshold}),this.threshold=this._compressor.threshold,zt(this,"threshold")}static getDefaults(){return Object.assign(ft.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class vf extends ft{constructor(){const s=at(vf.getDefaults(),arguments);super(s),this.name="MidSideCompressor",this._midSideSplit=this.input=new $a({context:this.context}),this._midSideMerge=this.output=new za({context:this.context}),this.mid=new or(Object.assign(s.mid,{context:this.context})),this.side=new or(Object.assign(s.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),zt(this,["mid","side"])}static getDefaults(){return Object.assign(ft.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class Bf extends ft{constructor(){const s=at(Bf.getDefaults(),arguments);super(s),this.name="MultibandCompressor",this._splitter=this.input=new Ya({context:this.context,lowFrequency:s.lowFrequency,highFrequency:s.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new Wt({context:this.context}),this.low=new or(Object.assign(s.low,{context:this.context})),this.mid=new or(Object.assign(s.mid,{context:this.context})),this.high=new or(Object.assign(s.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),zt(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(ft.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class yf extends ft{constructor(){const s=at(yf.getDefaults(),arguments,["low","mid","high"]);super(s),this.name="EQ3",this.output=new Wt({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new Ya({context:this.context,highFrequency:s.highFrequency,lowFrequency:s.lowFrequency}),this._lowGain=new Wt({context:this.context,gain:s.low,units:"decibels"}),this._midGain=new Wt({context:this.context,gain:s.mid,units:"decibels"}),this._highGain=new Wt({context:this.context,gain:s.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),zt(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(ft.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Sa(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class Cf extends ft{constructor(){const s=at(Cf.getDefaults(),arguments,["url","onload"]);super(s),this.name="Convolver",this._convolver=this.context.createConvolver(),this._buffer=new ge(s.url,(o=>{this.buffer=o,s.onload()})),this.input=new Wt({context:this.context}),this.output=new Wt({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=s.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(ft.getDefaults(),{normalize:!0,onload:ce})}load(s){return Re(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(s)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(s){s&&this._buffer.set(s),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const o=this._buffer.get();this._convolver.buffer=o||null}get normalize(){return this._convolver.normalize}set normalize(s){this._convolver.normalize=s}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function Hx(){return Ve().now()}function Nx(){return Ve().immediate()}const Ox=Ve().transport;function Vx(){return Ve().transport}const Wx=Ve().destination,Gx=Ve().destination;function Kx(){return Ve().destination}const qx=Ve().listener;function $x(){return Ve().listener}const zx=Ve().draw;function Xx(){return Ve().draw}const Yx=Ve();function jx(){return ge.loaded()}const Jx=ge,Zx=go,tE=kr})(),A})()))})(Uu)),Uu.exports}var et=rE();const av=new Array(19).fill(2),AE=["anacrusis","anacrusis","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid"],Mp=new Array(16).fill(2),Wy=["dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed"];function oE(){return{hasAnacrusis:!1,macrobeatGroupings:[...Mp],macrobeatBoundaryStyles:[...Wy],baseMicrobeatPx:40,modulationMarkers:[]}}const rA=12,aE=50,lE=.5,gi=3,qc=1,yl=30,Wl=30,Gl=.5,lv=3,cE=.7,uE=.9,hE=4,dE=1.5,fE=.15,pE=.2,mE=1,Kl=1.5,gE="#CCCCCC",Gy=1,cv=3,uv=5,wE=7,Pu=16,vE=0,BE=255,Ky=()=>({enabled:!0,blend:1,cutoff:16,resonance:0,type:"lowpass",mix:0}),yE=()=>({speed:0,span:0}),CE=()=>({speed:0,span:0}),bE={"#4a90e2":{primary:"#4a90e2",light:"#63a9fd"},"#68a03f":{primary:"#68a03f",light:"#80b958"},"#d66573":{primary:"#d66573",light:"#f27e8b"},"#2d2d2d":{primary:"#2d2d2d",light:"#424242"}};function hv(){const e=t=>{const n=new Float32Array(rA).fill(0),i=new Float32Array(rA).fill(0);return n[0]=1,{name:t,adsr:{attack:.1,decay:.2,sustain:.8,release:.3},coeffs:n,phases:i,activePresetName:"sine",gain:1,filter:Ky(),vibrato:yE(),tremelo:CE()}};return{timbres:{"#4a90e2":e("Blue"),"#2d2d2d":e("Black"),"#d66573":e("Red"),"#68a03f":e("Green")},colorPalette:bE}}const Fe=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fcfcfc",isAccidental:!1},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fcf7fc",isAccidental:!1},{pitch:"B/A7",flatName:"B7",sharpName:"A7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f7f5fd",isAccidental:!0},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f0f4ff",isAccidental:!1},{pitch:"A/G7",flatName:"A7",sharpName:"G7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#e6f3fd",isAccidental:!0},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#def3f7",isAccidental:!1},{pitch:"G/F7",flatName:"G7",sharpName:"F7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#daf2ec",isAccidental:!0},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#dcefdf",isAccidental:!1},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#e3ebd1",isAccidental:!1},{pitch:"E/D7",flatName:"E7",sharpName:"D7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#eee4c8",isAccidental:!0},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#f8dcc6",isAccidental:!1},{pitch:"D/C7",flatName:"D7",sharpName:"C7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fcd4cd",isAccidental:!0},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#facfdb",isAccidental:!1},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#efcdeb",isAccidental:!1},{pitch:"B/A6",flatName:"B6",sharpName:"A6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#ddcff9",isAccidental:!0},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#c4d3ff",isAccidental:!1},{pitch:"A/G6",flatName:"A6",sharpName:"G6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#abd9fa",isAccidental:!0},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#98dde9",isAccidental:!1},{pitch:"G/F6",flatName:"G6",sharpName:"F6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#96ddcf",isAccidental:!0},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#a6d9b0",isAccidental:!1},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#c0d093",isAccidental:!1},{pitch:"E/D6",flatName:"E6",sharpName:"D6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#dbc383",isAccidental:!0},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#efb586",isAccidental:!1},{pitch:"D/C6",flatName:"D6",sharpName:"C6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#f8a99c",isAccidental:!0},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#f3a2bb",isAccidental:!1},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e1a3db",isAccidental:!1},{pitch:"B/A5",flatName:"B5",sharpName:"A5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#c3a9f4",isAccidental:!0},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#9ab2ff",isAccidental:!1},{pitch:"A/G5",flatName:"A5",sharpName:"G5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#67bdf7",isAccidental:!0},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#30c6dc",isAccidental:!1},{pitch:"G/F5",flatName:"G5",sharpName:"F5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#32c8b2",isAccidental:!0},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#6dc281",isAccidental:!1},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#a0b556",isAccidental:!1},{pitch:"E/D5",flatName:"E5",sharpName:"D5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#c5a33f",isAccidental:!0},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#dc9150",isAccidental:!1},{pitch:"D/C5",flatName:"D5",sharpName:"C5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#e38475",isAccidental:!0},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#dc7f9d",isAccidental:!1},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#c781c0",isAccidental:!1},{pitch:"B/A4",flatName:"B4",sharpName:"A4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#a68ad8",isAccidental:!0},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#7d94e0",isAccidental:!1},{pitch:"A/G4",flatName:"A4",sharpName:"G4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#4c9fd5",isAccidental:!0},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#0fa6ba",isAccidental:!1},{pitch:"G/F4",flatName:"G4",sharpName:"F4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#24a794",isAccidental:!0},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#5aa26a",isAccidental:!1},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#849646",isAccidental:!1},{pitch:"E/D4",flatName:"E4",sharpName:"D4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#a38733",isAccidental:!0},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#b67740",isAccidental:!1},{pitch:"D/C4",flatName:"D4",sharpName:"C4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#bc6c5f",isAccidental:!0},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#b56880",isAccidental:!1},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#a3699e",isAccidental:!1},{pitch:"B/A3",flatName:"B3",sharpName:"A3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#8870b1",isAccidental:!0},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#6578b7",isAccidental:!1},{pitch:"A/G3",flatName:"A3",sharpName:"G3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#3c81ad",isAccidental:!0},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#0e8696",isAccidental:!1},{pitch:"G/F3",flatName:"G3",sharpName:"F3",toneNote:"Gb3",frequency:185,column:"A",hex:"#1b8777",isAccidental:!0},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#478255",isAccidental:!1},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#697836",isAccidental:!1},{pitch:"E/D3",flatName:"E3",sharpName:"D3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#836b27",isAccidental:!0},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#925e32",isAccidental:!1},{pitch:"D/C3",flatName:"D3",sharpName:"C3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#96554b",isAccidental:!0},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#905165",isAccidental:!1},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#80527c",isAccidental:!1},{pitch:"B/A2",flatName:"B2",sharpName:"A2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#6a578c",isAccidental:!0},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#4e5e90",isAccidental:!1},{pitch:"A/G2",flatName:"A2",sharpName:"G2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#2d6488",isAccidental:!0},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#096875",isAccidental:!1},{pitch:"G/F2",flatName:"G2",sharpName:"F2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#13685b",isAccidental:!0},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#356440",isAccidental:!1},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#505c28",isAccidental:!1},{pitch:"E/D2",flatName:"E2",sharpName:"D2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#63511c",isAccidental:!0},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#6e4724",isAccidental:!1},{pitch:"D/C2",flatName:"D2",sharpName:"C2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#713f37",isAccidental:!0},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#6c3c4b",isAccidental:!1},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#603c5d",isAccidental:!1},{pitch:"B/A1",flatName:"B1",sharpName:"A1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#4e4068",isAccidental:!0},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#38446b",isAccidental:!1},{pitch:"A/G1",flatName:"A1",sharpName:"G1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#1f4964",isAccidental:!0},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#044b55",isAccidental:!1},{pitch:"G/F1",flatName:"G1",sharpName:"F1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#0c4b41",isAccidental:!0},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#24472c",isAccidental:!1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#38401a",isAccidental:!1},{pitch:"E/D1",flatName:"E1",sharpName:"D1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#463811",isAccidental:!0},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#4d3017",isAccidental:!1},{pitch:"D/C1",flatName:"D1",sharpName:"C1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#4f2a24",isAccidental:!0},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#4a2733",isAccidental:!1},{pitch:"B0",flatName:"B0",sharpName:"B0",toneNote:"B0",frequency:30.87,column:"B",hex:"#41273f",isAccidental:!1},{pitch:"B/A0",flatName:"B0",sharpName:"A0",toneNote:"Bb0",frequency:29.14,column:"A",hex:"#342a46",isAccidental:!0},{pitch:"A0",flatName:"A0",sharpName:"A0",toneNote:"A0",frequency:27.5,column:"B",hex:"#242c48",isAccidental:!1}];function _E(e,t){const n=Fe.findIndex(r=>r.toneNote===e),i=Fe.findIndex(r=>r.toneNote===t);return n===-1||i===-1?null:{topIndex:Math.min(n,i),bottomIndex:Math.max(n,i)}}const SE=_E("G5","C4")??{topIndex:0,bottomIndex:Math.max(0,((Fe==null?void 0:Fe.length)||1)-1)},qy={placedNotes:[],placedChords:[],tonicSignGroups:{},sixteenthStampPlacements:[],tripletStampPlacements:[],annotations:[],lassoSelection:{selectedItems:[],convexHull:null,isActive:!1},history:[{notes:[],tonicSignGroups:{},timbres:hv().timbres,placedChords:[],sixteenthStampPlacements:[],tripletStampPlacements:[],annotations:[],lassoSelection:{selectedItems:[],convexHull:null,isActive:!1}}],historyIndex:0,fullRowData:[...Fe],pitchRange:SE,...oE(),selectedModulationRatio:null,...hv(),selectedTool:"note",previousTool:"note",selectedToolTonicNumber:1,selectedNote:{shape:"circle",color:"#4a90e2"},deviceProfile:{isMobile:!1,isTouch:!1,isCoarsePointer:!1,orientation:"landscape",width:0,height:0},activeChordId:null,activeChordIntervals:["1P"],isIntervalsInverted:!1,chordPositionState:0,gridPosition:0,viewportRows:0,logicRows:0,cellWidth:0,cellHeight:0,columnWidths:[],musicalColumnWidths:[],degreeDisplayMode:"off",accidentalMode:{sharp:!0,flat:!0},showFrequencyLabels:!1,showOctaveLabels:!0,focusColours:!1,isPlaying:!1,isPaused:!1,isLooping:!1,tempo:90,playheadMode:"cursor",waveformExtendedView:!1,adsrTimeAxisScale:1,isPrintPreviewActive:!1,printOptions:{pageSize:"letter",includeButtonGrid:!0,includeDrums:!0,includeLeftLegend:!0,includeRightLegend:!0,orientation:"landscape",colorMode:"color",cropTop:0,cropBottom:1,cropLeft:0,cropRight:1},longNoteStyle:"style1"};function dv(e){const t=JSON.parse(JSON.stringify(e));for(const n in t){const i=t[n];i.coeffs&&typeof i.coeffs=="object"&&!Array.isArray(i.coeffs)?i.coeffs=new Float32Array(Object.values(i.coeffs)):Array.isArray(i.coeffs)&&(i.coeffs=new Float32Array(i.coeffs))}return t}const xE={recordState(){this.state.history=this.state.history.slice(0,this.state.historyIndex+1);const e=JSON.parse(JSON.stringify(this.state.timbres)),t={notes:JSON.parse(JSON.stringify(this.state.placedNotes)),tonicSignGroups:JSON.parse(JSON.stringify(this.state.tonicSignGroups)),placedChords:JSON.parse(JSON.stringify(this.state.placedChords)),sixteenthStampPlacements:JSON.parse(JSON.stringify(this.state.sixteenthStampPlacements)),tripletStampPlacements:JSON.parse(JSON.stringify(this.state.tripletStampPlacements||[])),timbres:e,annotations:this.state.annotations?JSON.parse(JSON.stringify(this.state.annotations)):[],lassoSelection:JSON.parse(JSON.stringify(this.state.lassoSelection))};this.state.history.push(t),this.state.historyIndex++,this.emit("historyChanged")},undo(){var e;if(this.state.historyIndex>0){this.state.historyIndex--;const t=this.state.history[this.state.historyIndex];if(!t)return;this.state.placedNotes=JSON.parse(JSON.stringify(t.notes)),this.state.tonicSignGroups=JSON.parse(JSON.stringify(t.tonicSignGroups)),this.state.sixteenthStampPlacements=JSON.parse(JSON.stringify(t.sixteenthStampPlacements||[])),this.state.tripletStampPlacements=JSON.parse(JSON.stringify(t.tripletStampPlacements||[])),this.state.timbres=dv(t.timbres),this.state.annotations=t.annotations?JSON.parse(JSON.stringify(t.annotations)):[],this.emit("notesChanged"),this.emit("sixteenthStampPlacementsChanged"),this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),(e=this.state.selectedNote)!=null&&e.color&&this.emit("timbreChanged",this.state.selectedNote.color),this.emit("annotationsChanged"),this.emit("historyChanged")}},redo(){var e;if(this.state.historyIndex<this.state.history.length-1){this.state.historyIndex++;const t=this.state.history[this.state.historyIndex];if(!t)return;this.state.placedNotes=JSON.parse(JSON.stringify(t.notes)),this.state.tonicSignGroups=JSON.parse(JSON.stringify(t.tonicSignGroups)),this.state.sixteenthStampPlacements=JSON.parse(JSON.stringify(t.sixteenthStampPlacements||[])),this.state.tripletStampPlacements=JSON.parse(JSON.stringify(t.tripletStampPlacements||[])),this.state.timbres=dv(t.timbres),this.state.annotations=t.annotations?JSON.parse(JSON.stringify(t.annotations)):[],this.emit("notesChanged"),this.emit("sixteenthStampPlacementsChanged"),this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),(e=this.state.selectedNote)!=null&&e.color&&this.emit("timbreChanged",this.state.selectedNote.color),this.emit("annotationsChanged"),this.emit("historyChanged")}}};function Jm(e){return e!==null&&typeof e=="object"&&"name"in e&&typeof e.name=="string"}function Zm(e){return e!==null&&typeof e=="object"&&"step"in e&&typeof e.step=="number"&&"alt"in e&&typeof e.alt=="number"&&!isNaN(e.step)&&!isNaN(e.alt)}var $y=[0,2,4,-1,1,3,5],zy=$y.map(e=>Math.floor(e*7/12));function Xy(e){const{step:t,alt:n,oct:i,dir:r=1}=e,A=$y[t]+7*n;if(i===void 0)return[r*A];const a=i-zy[t]-4*n;return[r*A,r*a]}var EE=[3,0,4,1,5,2,6];function Yy(e){const[t,n,i]=e,r=EE[TE(t)],A=Math.floor((t+1)/7);if(n===void 0)return{step:r,alt:A,dir:i};const a=n+4*A+zy[r];return{step:r,alt:A,oct:a,dir:i}}function TE(e){const t=(e+1)%7;return t<0?7+t:t}var fv=(e,t)=>Array(Math.abs(t)+1).join(e),Qp=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),FE="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",IE="(AA|A|P|M|m|d|dd)([-+]?\\d+)",ME=new RegExp("^"+FE+"|"+IE+"$");function QE(e){const t=ME.exec(`${e}`);return t===null?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}var pv={};function si(e){return typeof e=="string"?pv[e]||(pv[e]=UE(e)):Zm(e)?si(DE(e)):Jm(e)?si(e.name):Qp}var mv=[0,2,4,5,7,9,11],jy="PMMPPMM";function UE(e){const t=QE(e);if(t[0]==="")return Qp;const n=+t[0],i=t[1],r=(Math.abs(n)-1)%7,A=jy[r];if(A==="M"&&i==="P")return Qp;const a=A==="M"?"majorable":"perfectable",l=""+n+i,c=n<0?-1:1,h=n===8||n===-8?n:c*(r+1),f=PE(a,i),m=Math.floor((Math.abs(n)-1)/7),w=c*(mv[r]+f+12*m),B=(c*(mv[r]+f)%12+12)%12,y=Xy({step:r,alt:f,oct:m,dir:c});return{empty:!1,name:l,num:n,q:i,step:r,alt:f,dir:c,type:a,simple:h,semitones:w,chroma:B,coord:y,oct:m}}function Jy(e,t){const[n,i=0]=e,r=n*7+i*12<0,A=t||r?[-n,-i,-1]:[n,i,1];return si(Yy(A))}function PE(e,t){return t==="M"&&e==="majorable"||t==="P"&&e==="perfectable"?0:t==="m"&&e==="majorable"?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*(e==="perfectable"?t.length:t.length+1):0}function DE(e){const{step:t,alt:n,oct:i=0,dir:r}=e;if(!r)return"";const A=t+1+7*i,a=A===0?t+1:A,l=r<0?"-":"",c=jy[t]==="M"?"majorable":"perfectable";return l+a+kE(c,n)}function kE(e,t){return t===0?e==="majorable"?"M":"P":t===-1&&e==="majorable"?"m":t>0?fv("A",t):fv("d",e==="perfectable"?t:t+1)}var gv=(e,t)=>Array(Math.abs(t)+1).join(e),Zy=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),wv=new Map,LE=e=>"CDEFGAB".charAt(e),t0=e=>e<0?gv("b",-e):gv("#",e),e0=e=>e[0]==="b"?-e.length:e.length;function Cn(e){const t=JSON.stringify(e),n=wv.get(t);if(n)return n;const i=typeof e=="string"?OE(e):Zm(e)?Cn(VE(e)):Jm(e)?Cn(e.name):Zy;return wv.set(t,i),i}var RE=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function tg(e){const t=RE.exec(e);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:["","","",""]}function HE(e){return Cn(Yy(e))}var NE=(e,t)=>(e%t+t)%t,If=[0,2,4,5,7,9,11];function OE(e){const t=tg(e);if(t[0]===""||t[3]!=="")return Zy;const n=t[0],i=t[1],r=t[2],A=(n.charCodeAt(0)+3)%7,a=e0(i),l=r.length?+r:void 0,c=Xy({step:A,alt:a,oct:l}),h=n+i+r,f=n+i,m=(If[A]+a+120)%12,w=l===void 0?NE(If[A]+a,12)-1188:If[A]+a+12*(l+1),B=w>=0&&w<=127?w:null,y=l===void 0?null:Math.pow(2,(w-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:m,coord:c,freq:y,height:w,letter:n,midi:B,name:h,oct:l,pc:f,step:A}}function VE(e){const{step:t,alt:n,oct:i}=e,r=LE(t);if(!r)return"";const A=r+t0(n);return i||i===0?A+i:A}function Dh(e,t){const n=Cn(e),i=Array.isArray(t)?t:si(t).coord;if(n.empty||!i||i.length<2)return"";const r=n.coord,A=r.length===1?[r[0]+i[0]]:[r[0]+i[0],r[1]+i[1]];return HE(A).name}function eh(e,t){const n=Cn(e),i=Cn(t);if(n.empty||i.empty)return"";const r=n.coord,A=i.coord,a=A[0]-r[0],l=r.length===2&&A.length===2?A[1]-r[1]:-Math.floor(a*7/12),c=i.height===n.height&&i.midi!==null&&n.oct===i.oct&&n.step>i.step;return Jy([a,l],c).name}function eg(e,t){const n=t.length,i=(e%n+n)%n;return t.slice(i,n).concat(t.slice(0,i))}function WE(e){return e.filter(t=>t===0||t)}var zA={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},n0=e=>Number(e).toString(2).padStart(12,"0"),vv=e=>parseInt(e,2),GE=/^[01]{12}$/;function s0(e){return GE.test(e)}var KE=e=>typeof e=="number"&&e>=0&&e<=4095,qE=e=>e&&s0(e.chroma),Bv={[zA.chroma]:zA};function ng(e){const t=s0(e)?e:KE(e)?n0(e):Array.isArray(e)?JE(e):qE(e)?e.chroma:zA.chroma;return Bv[t]=Bv[t]||jE(t)}var $E=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function zE(e){const t=[];for(let n=0;n<12;n++)e.charAt(n)==="1"&&t.push($E[n]);return t}function XE(e,t=!0){const i=ng(e).chroma.split("");return WE(i.map((r,A)=>{const a=eg(A,i);return t&&a[0]==="0"?null:a.join("")}))}function YE(e){const t=e.split("");return t.map((n,i)=>eg(i,t).join(""))}function jE(e){const t=vv(e),n=YE(e).map(vv).filter(A=>A>=2048).sort()[0],i=n0(n),r=zE(e);return{empty:!1,name:"",setNum:t,chroma:e,normalized:i,intervals:r}}function JE(e){if(e.length===0)return zA.chroma;let t;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let i=0;i<e.length;i++)t=Cn(e[i]),t.empty&&(t=si(e[i])),t.empty||(n[t.chroma]=1);return n.join("")}var ZE=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],t1=ZE,e1={...zA,name:"",quality:"Unknown",intervals:[],aliases:[]},sg=[],Cl={};function n1(e){return Cl[e]||e1}function s1(){return sg.slice()}function i1(e,t,n){const i=A1(e),r={...ng(e),name:n||"",quality:i,intervals:e,aliases:t};sg.push(r),r.name&&(Cl[r.name]=r),Cl[r.setNum]=r,Cl[r.chroma]=r,r.aliases.forEach(A=>r1(r,A))}function r1(e,t){Cl[t]=e}function A1(e){const t=n=>e.indexOf(n)!==-1;return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}t1.forEach(([e,t,n])=>i1(e.split(" "),n.split(" "),t));sg.sort((e,t)=>e.setNum-t.setNum);var o1=e=>{const t=e.reduce((n,i)=>{const r=Cn(i).chroma;return r!==void 0&&(n[r]=n[r]||Cn(i).name),n},{});return n=>t[n]};function a1(e,t={}){const n=e.map(r=>Cn(r).pc).filter(r=>r);return Cn.length===0?[]:p1(n,1,t).filter(r=>r.weight).sort((r,A)=>A.weight-r.weight).map(r=>r.name)}var kh={anyThirds:384,perfectFifth:16,nonPerfectFifths:40,anySeventh:3},Lh=e=>t=>!!(t&e),l1=Lh(kh.anyThirds),c1=Lh(kh.perfectFifth),u1=Lh(kh.anySeventh),h1=Lh(kh.nonPerfectFifths);function d1(e){const t=parseInt(e.chroma,2);return l1(t)&&c1(t)&&u1(t)}function f1(e){const t=parseInt(e,2);return h1(t)?e:(t|16).toString(2)}function p1(e,t,n){const i=e[0],r=Cn(i).chroma,A=o1(e),a=XE(e,!1),l=[];return a.forEach((c,h)=>{const f=n.assumePerfectFifth&&f1(c);s1().filter(w=>n.assumePerfectFifth&&d1(w)?w.chroma===f:w.chroma===c).forEach(w=>{const B=w.aliases[0],y=A(h);h!==r?l.push({weight:.5*t,name:`${y}${B}/${i}`}):l.push({weight:1*t,name:`${y}${B}`})})}),l}var m1=si;function g1(e){const t=si(e);if(t.empty)return"";const n=(7-t.step)%7,i=t.type==="perfectable"?-t.alt:-(t.alt+1);return si({step:n,alt:i,oct:t.oct,dir:t.dir}).name}var yv=eh,w1=v1((e,t)=>[e[0]-t[0],e[1]-t[1]]);function v1(e){return(t,n)=>{const i=si(t).coord,r=si(n).coord;if(i&&r){const A=e(i,r);return Jy(A).name}}}var B1=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],y1=B1,C1={...zA,intervals:[],aliases:[]},bl={};function i0(e){return bl[e]||C1}function b1(e,t,n=[]){const i={...ng(e),name:t,intervals:e,aliases:n};return bl[i.name]=i,bl[i.setNum]=i,bl[i.chroma]=i,i.aliases.forEach(r=>_1(i,r)),i}function _1(e,t){bl[t]=e}y1.forEach(([e,t,...n])=>b1(e.split(" "),t,n));var r0={empty:!0,name:"",symbol:"",root:"",bass:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function A0(e){const[t,n,i,r]=tg(e);return t===""?Mf("",e):t==="A"&&r==="ug"?Mf("","aug"):Mf(t+n,i+r)}function Mf(e,t){const n=t.split("/");if(n.length===1)return[e,n[0],""];const[i,r,A,a]=tg(n[1]);return i!==""&&A===""&&a===""?[e,n[0],i+r]:[e,t,""]}function S1(e){if(Array.isArray(e))return Qf(e[1]||"",e[0],e[2]);if(e==="")return r0;{const[t,n,i]=A0(e),r=Qf(n,t,i);return r.empty?Qf(e):r}}function Qf(e,t,n){const i=n1(e),r=Cn(t||""),A=Cn(n||"");if(i.empty||t&&r.empty||n&&A.empty)return r0;const a=eh(r.pc,A.pc),l=i.intervals.indexOf(a),c=l>=0,h=c?A:Cn(""),f=l===-1?NaN:l+1,m=A.pc&&A.pc!==r.pc,w=Array.from(i.intervals);if(c)for(let S=1;S<f;S++){const F=w[0][0],U=w[0][1],D=parseInt(F,10)+7;w.push(`${D}${U}`),w.shift()}else if(m){const S=w1(eh(r.pc,A.pc),"8P");S&&w.unshift(S)}const B=r.empty?[]:w.map(S=>Dh(r.pc,S));e=i.aliases.indexOf(e)!==-1?e:i.aliases[0];const y=`${r.empty?"":r.pc}${e}${c&&f>1?"/"+h.pc:m?"/"+A.pc:""}`,b=`${t?r.pc+" ":""}${i.name}${c&&f>1?" over "+h.pc:m?" over "+A.pc:""}`;return{...i,name:b,symbol:y,tonic:r.pc,type:i.name,root:h.pc,bass:m?A.pc:"",intervals:w,rootDegree:f,notes:B}}var x1=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],E1=x1;E1.forEach(([e,t,n])=>void 0);var T1="C C# D D# E F F# G G# A A# B".split(" "),F1="C Db D Eb E F Gb G Ab A Bb B".split(" ");function ig(e,t={}){if(isNaN(e)||e===-1/0||e===1/0)return"";e=Math.round(e);const i=(t.sharps===!0?T1:F1)[e%12];if(t.pitchClass)return i;const r=Math.floor(e/12)-1;return i+r}var ql=Cn,Up=e=>ql(e).pc,Uf=e=>ql(e).midi;function I1(e){return ig(e)}var zo=Dh,_l=e=>{const t=ql(e);return t.empty?"":ig(t.midi||t.chroma,{sharps:t.alt>0,pitchClass:t.midi===null})};function Sl(e,t){const n=ql(e);if(n.empty)return"";const i=ql(t||ig(n.midi||n.chroma,{sharps:n.alt<0,pitchClass:!0}));if(i.empty||i.chroma!==n.chroma)return"";if(n.oct===void 0)return i.pc;const r=n.chroma-n.alt,A=i.chroma-i.alt,a=r>11||A<0?-1:r<0||A>11?1:0,l=n.oct+a;return i.pc+l}var o0={empty:!0,name:"",chordType:""},Cv={};function $l(e){return typeof e=="string"?Cv[e]||(Cv[e]=D1(e)):typeof e=="number"?$l(rg[e]||""):Zm(e)?M1(e):Jm(e)?$l(e.name):o0}function M1(e){return $l(t0(e.alt)+rg[e.step])}var Q1=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function U1(e){return Q1.exec(e)||["","","",""]}var P1="I II III IV V VI VII",rg=P1.split(" ");function D1(e){const[t,n,i,r]=U1(e);if(!i)return o0;const A=i.toUpperCase(),a=rg.indexOf(A),l=e0(n),c=1;return{empty:!1,name:t,roman:i,interval:si({step:a,alt:l,dir:c}).name,acc:n,chordType:r,alt:l,step:a,major:i===A,oct:0,dir:c}}var Ag=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],bv={...zA,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},k1=Ag.map(L1),Pp={};k1.forEach(e=>{Pp[e.name]=e,e.aliases.forEach(t=>{Pp[t]=e})});function a0(e){return typeof e=="string"?Pp[e.toLowerCase()]||bv:e&&e.name?a0(e.name):bv}function L1(e){const[t,n,i,r,A,a,l]=e,c=l?[l]:[],h=Number(n).toString(2);return{empty:!1,intervals:i0(r).intervals,modeNum:t,chroma:h,normalized:h,name:r,setNum:n,alt:i,triad:A,seventh:a,aliases:c}}function l0(e){return(t,n)=>{const i=a0(t);if(i.empty)return[];const r=eg(i.modeNum,e),A=i.intervals.map(a=>Dh(n,a));return r.map((a,l)=>A[l]+a)}}l0(Ag.map(e=>e[4]));l0(Ag.map(e=>e[5]));function R1(e,t){return t.map(n=>{const[i,r]=A0(n),A=eh(e,i);return $l(si(A)).name+r})}var H1={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function N1(e){if(typeof e!="string")return["",""];const t=e.indexOf(" "),n=Cn(e.substring(0,t));if(n.empty){const r=Cn(e);return r.empty?["",e.toLowerCase()]:[r.name,""]}const i=e.substring(n.name.length+1).toLowerCase();return[n.name,i.length?i:""]}function O1(e){const t=Array.isArray(e)?e:N1(e),n=Cn(t[0]).name,i=i0(t[1]);if(i.empty)return H1;const r=i.name,A=n?i.intervals.map(l=>Dh(n,l)):[],a=n?n+" "+r:r;return{...i,name:a,type:r,tonic:n,notes:A}}class V1{constructor(){P(this,"cachedMap",null);P(this,"cacheKey",null)}getColumnMap(t){const n=this.buildCacheKey(t);return this.cachedMap&&this.isCacheValid(n)?this.cachedMap:(this.cachedMap=this.buildColumnMap(t),this.cacheKey=n,this.cachedMap)}invalidate(){this.cachedMap=null,this.cacheKey=null}buildCacheKey(t){const i=In(t).map(r=>`${r.columnIndex}:${r.preMacrobeatIndex}:${r.uuid||""}`).sort().join("|");return{macrobeatGroupings:[...t.macrobeatGroupings],tonicSignsHash:i,macrobeatBoundaryStyles:[...t.macrobeatBoundaryStyles]}}isCacheValid(t){return this.cacheKey?this.cacheKey.tonicSignsHash===t.tonicSignsHash&&JSON.stringify(this.cacheKey.macrobeatGroupings)===JSON.stringify(t.macrobeatGroupings)&&JSON.stringify(this.cacheKey.macrobeatBoundaryStyles)===JSON.stringify(t.macrobeatBoundaryStyles):!1}buildColumnMap(t){const{macrobeatGroupings:n,macrobeatBoundaryStyles:i}=t,A=[...In(t)].sort((Q,R)=>Q.preMacrobeatIndex-R.preMacrobeatIndex),a=[],l=[];let c=0,h=0,f=0,m=0,w=0;const B=Q=>{var R;for(;w<A.length;){const V=A[w];if(!V||V.preMacrobeatIndex!==Q)break;const O=V.uuid||"";for(let z=0;z<2;z++)a.push({visualIndex:c,canvasIndex:h,timeIndex:null,type:"tonic",widthMultiplier:qc,xOffsetUnmodulated:m,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:z===0?O:null}),c++,h++,m+=qc;const K=O;do w++;while(w<A.length&&(((R=A[w])==null?void 0:R.uuid)||"")===K)}};for(let Q=0;Q<2;Q++)a.push({visualIndex:c,canvasIndex:null,timeIndex:null,type:"legend-left",widthMultiplier:gi,xOffsetUnmodulated:m,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:null}),c++,m+=gi;B(-1),n.forEach((Q,R)=>{for(let O=0;O<Q;O++)a.push({visualIndex:c,canvasIndex:h,timeIndex:f,type:"beat",widthMultiplier:qc,xOffsetUnmodulated:m,macrobeatIndex:R,beatInMacrobeat:O,isMacrobeatStart:O===0,isMacrobeatEnd:O===Q-1,isPlayable:!0,tonicSignUuid:null}),c++,h++,f++,m+=qc;const V=i[R]||"dashed";l.push({macrobeatIndex:R,visualColumn:c-1,canvasColumn:h-1,timeColumn:f-1,boundaryType:V,isMeasureStart:V==="solid"}),B(R)});for(let Q=0;Q<2;Q++)a.push({visualIndex:c,canvasIndex:null,timeIndex:null,type:"legend-right",widthMultiplier:gi,xOffsetUnmodulated:m,macrobeatIndex:null,beatInMacrobeat:null,isMacrobeatStart:!1,isMacrobeatEnd:!1,isPlayable:!1,tonicSignUuid:null}),c++,m+=gi;const y=new Map,b=new Map,S=new Map,F=new Map,U=new Map,D=new Map;return a.forEach(Q=>{y.set(Q.visualIndex,Q.canvasIndex),b.set(Q.visualIndex,Q.timeIndex),Q.canvasIndex!==null&&(S.set(Q.canvasIndex,Q.visualIndex),F.set(Q.canvasIndex,Q.timeIndex)),Q.timeIndex!==null&&(Q.canvasIndex!==null&&U.set(Q.timeIndex,Q.canvasIndex),D.set(Q.timeIndex,Q.visualIndex))}),{entries:a,visualToCanvas:y,visualToTime:b,canvasToVisual:S,canvasToTime:F,timeToCanvas:U,timeToVisual:D,macrobeatBoundaries:l,totalVisualColumns:c,totalCanvasColumns:h,totalTimeColumns:f,totalWidthUnmodulated:m}}}const xs=new V1;function W1(e){e.on("rhythmStructureChanged",()=>{xs.invalidate()})}function G1(e,t){return xs.getColumnMap(t).visualToTime.get(e)??null}function br(e,t){return xs.getColumnMap(t).canvasToTime.get(e)??null}function ds(e,t){const i=xs.getColumnMap(t).timeToCanvas.get(e);return i!==void 0?i:e}function K1(e,t){const i=xs.getColumnMap(t).timeToVisual.get(e);return i!==void 0?i:e+2}function q1(e,t){const n=xs.getColumnMap(t),i=n.canvasToVisual.get(e);return i!==void 0&&n.entries[i]||null}function $1(e,t){const n=q1(e,t);return(n==null?void 0:n.isPlayable)??!1}function z1(e){const t=xs.getColumnMap(e),n=[];for(const i of t.entries)i.canvasIndex!==null&&(n[i.canvasIndex]=i.widthMultiplier);return n}const X1=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"],In=e=>e.tonicSignGroups?Object.values(e.tonicSignGroups).flat():[],Tn=(e,t)=>{const n=xs.getColumnMap(e),{macrobeatGroupings:i}=e,r=i[t]??0;let A=null,a=null;for(const l of n.entries)l.macrobeatIndex===t&&l.type==="beat"&&((A===null||l.canvasIndex!==null&&l.canvasIndex<A)&&(A=l.canvasIndex),(a===null||l.canvasIndex!==null&&l.canvasIndex>a)&&(a=l.canvasIndex));if(A===null||a===null){let l=0;const c=In(e);c.some(h=>h.preMacrobeatIndex===-1)&&(l+=2);for(let h=0;h<t;h++)l+=i[h]??0,c.some(f=>f.preMacrobeatIndex===h)&&(l+=2);A=l,a=A+r-1}return{startColumn:A,endColumn:a,grouping:r}},Y1=e=>e.placedNotes.filter(t=>!t.isDrum),j1=e=>e.placedNotes.filter(t=>t.isDrum),J1=(e,t)=>{const i=In(e).filter(h=>h.columnIndex<=t);if(i.length===0)return{keyTonic:"C",keyMode:"major"};const r=i.reduce((h,f)=>f.columnIndex>h.columnIndex?f:h),A=typeof r.globalRow=="number"?r.globalRow:r.row,a=Fe[A]??e.fullRowData[r.row];if(!a)return{keyTonic:"C",keyMode:"major"};const l=Up(a.toneNote),c=X1[r.tonicNumber-1]||"major";return{keyTonic:l,keyMode:c}};let Z1=class{constructor(){P(this,"logLevel");P(this,"enabledLevels");P(this,"categories");this.logLevel="ERROR",this.enabledLevels={DEBUG:!1,INFO:!1,WARN:!1,ERROR:!0},this.categories={general:!1,state:!1,canvas:!1,audio:!1,ui:!1,layout:!1,harmony:!1,performance:!1,initialization:!1,transport:!1,grid:!1,toolbar:!1,zoom:!1,scroll:!1,keyboard:!1,mouse:!1,adsr:!1,filter:!1,waveform:!1,debug:!1}}enable(...t){t.forEach(n=>{Object.prototype.hasOwnProperty.call(this.categories,n)&&(this.categories[n]=!0)})}disable(...t){t.forEach(n=>{Object.prototype.hasOwnProperty.call(this.categories,n)&&(this.categories[n]=!1)})}enableAll(){Object.keys(this.categories).forEach(t=>{this.categories[t]=!0}),this.setLevel("DEBUG")}disableAll(){Object.keys(this.categories).forEach(t=>{this.categories[t]=!1}),this.setLevel("ERROR")}isCategoryEnabled(t){return this.categories[t]===!0}setLevel(t){const i=["DEBUG","INFO","WARN","ERROR"].indexOf(t);i!==-1&&(this.logLevel=t,this.enabledLevels={DEBUG:i<=0,INFO:i<=1,WARN:i<=2,ERROR:i<=3})}logWithConsole(t,n,i,r=null){if(typeof console<"u"&&console[t]){const A=r!==null?[n,i,r]:[n,i];console[t](...A)}}event(t,n,i="",r="ui"){!this.enabledLevels.INFO||this.isCategoryEnabled(r)}state(t,n,i=null,r="state"){!this.enabledLevels.INFO||this.isCategoryEnabled(r)}debug(t,n,i=null,r="debug"){!this.enabledLevels.DEBUG||!this.isCategoryEnabled(r)||this.logWithConsole("debug",t,n,i)}timing(t,n,i,r="performance"){!this.enabledLevels.DEBUG||!this.isCategoryEnabled(r)||this.logWithConsole("debug",t,n,i)}warn(t,n,i=null,r="general"){!this.enabledLevels.WARN||!this.isCategoryEnabled(r)||this.logWithConsole("warn",t,n,i)}error(t,n,i=null,r="general"){this.enabledLevels.ERROR&&this.logWithConsole("error",t,n,i)}info(t,n,i=null,r="general"){!this.enabledLevels.INFO||!this.isCategoryEnabled(r)||this.logWithConsole("info",t,n,i)}getConfig(){return{logLevel:this.logLevel,enabledLevels:{...this.enabledLevels},enabledCategories:Object.entries(this.categories).filter(([,t])=>t).map(([t])=>t)}}getAvailableCategories(){return Object.keys(this.categories)}section(t){this.enabledLevels.INFO&&this.info("Logger",`===== ${t} =====`,null,"general")}initStart(t){this.enabledLevels.INFO&&this.info(t,"init start",null,"initialization")}initSuccess(t){this.enabledLevels.INFO&&this.info(t,"init success",null,"initialization")}initFailed(t,n){if(this.enabledLevels.ERROR){const i=n?`init failed: ${n}`:"init failed";this.error(t,i,null,"initialization")}}moduleLoaded(t,n="initialization"){this.isCategoryEnabled(n)&&this.enabledLevels.INFO&&this.info(t,"loaded",null,n)}log(t,n,i=null){this.info(t,n,i,"general")}};const x=new Z1;typeof window<"u"&&(window.logger=x);const c0={0:{degree:1,alt:0},1:{degree:2,alt:-1},2:{degree:2,alt:0},3:{degree:3,alt:-1},4:{degree:3,alt:0},5:{degree:4,alt:0},6:{degree:5,alt:-1},7:{degree:5,alt:0},8:{degree:6,alt:-1},9:{degree:6,alt:0},10:{degree:7,alt:-1},11:{degree:7,alt:0}};function tT(e){if(Math.abs(e.num)!==8||e.alt>=0)return null;const n=(e.semitones%12+12)%12;return c0[n]||null}function _v(e){if(!e)return null;const t=m1(e);if((t==null?void 0:t.num)===void 0)return null;const n=tT(t);if(n){const c=n.degree,h=n.alt;let f="";return h<0?f="".repeat(Math.abs(h)):h>0&&(f="".repeat(h)),`${f}${c}`}const i=(t.semitones%12+12)%12,r=c0[i];if(!r){const c=Math.abs(t.num),h=t.alt;let f="";return h<0?f="".repeat(Math.abs(h)):h>0&&(f="".repeat(h)),`${f}${c}`}const A=r.degree,a=r.alt;let l="";return a<0?l="".repeat(Math.abs(a)):a>0&&(l="".repeat(a)),`${l}${A}`}function Sv(e){return e&&{"1":"2","2":"1","2":"3","3":"2","4":"5","5":"4","5":"6","6":"5","6":"7","7":"6"}[e]||null}function xv(e){return!!(e&&(e.includes("")||e.includes("")))}const xl={getEnharmonicDegree:Sv,hasAccidental:xv,getDegreeForNote(e,t){var m;if(!e||!t)return null;const{keyTonic:n,keyMode:i}=J1(t,e.startColumnIndex);if(!n)return null;const r=e.globalRow??e.row,A=(m=t.fullRowData[r])==null?void 0:m.toneNote;if(!A)return null;const a=Up(A)||A;let l=n;if(t.degreeDisplayMode!=="modal"&&i!=="major"){const B=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"].indexOf(i);if(B>0){const b=["1P","2M","3M","4P","5P","6M","7M"][B];if(b){const S=g1(b);l=zo(n,S)||l}}}const h=yv(l,a),f=_v(h);if(e.enharmonicPreference&&f&&xv(f)){const w=Sv(f);if(w)return w}return f},getDegreesForNotes(e,t){return!e||e.length===0?[]:e.map(n=>{const i=Up(n)||n,r=yv(t,i);return _v(r)}).filter(n=>n!==null)},getRomanNumeralForNotes(e,t){if(!e||e.length<2)return null;const[n]=a1(e);if(!n)return null;const i=S1(n),r=i==null?void 0:i.symbol;if(!r)return null;const[A]=R1(t,[r]);if(!A)return null;const a=$l(A),l=a==null?void 0:a.roman;if(!l)return null;let c=a.name.replace(l,"");const h=(i==null?void 0:i.tonic)||t;return c==="6"&&(c="add6"),{roman:l,ext:c,root:h}}};function Dp(e){if(!(!e||e.isDrum)&&e.shape==="circle"&&typeof e.startColumnIndex=="number"){const t=e.startColumnIndex+1;(typeof e.endColumnIndex!="number"||e.endColumnIndex<t)&&(e.endColumnIndex=t)}}function Pf(e,t){var A;if(typeof e.row!="number")return;const n=(((A=t.fullRowData)==null?void 0:A.length)??0)>0?t.fullRowData.length-1:-1;if(n<0)return;const i=typeof e.globalRow=="number"?e.globalRow:e.row,r=Math.max(0,Math.min(n,Math.round(i)));e.globalRow=r,e.row=r}function $c(){return`uuid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const eT={addNote(e){const t=this.state.placedNotes.find(i=>!i.isDrum&&i.row===e.row&&i.startColumnIndex===e.startColumnIndex&&i.color===e.color);if(t){if(this.state.degreeDisplayMode!=="off"){const i=xl.getDegreeForNote(t,this.state);if(i&&xl.hasAccidental(i))return t.enharmonicPreference=!t.enharmonicPreference,x.debug("NoteActions","[ENHARMONIC] Toggled enharmonic preference for note",{noteUuid:t.uuid,currentDegree:i,enharmonicPreference:t.enharmonicPreference},"notes"),this.emit("notesChanged"),t}return null}const n={...e,uuid:$c()};return Dp(n),Pf(n,this.state),this.state.placedNotes.push(n),this.emit("notesChanged"),n},updateNoteTail(e,t){let n=t;e.shape==="circle"&&(n=Math.max(e.startColumnIndex+1,t)),e.endColumnIndex=n,this.emit("notesChanged")},updateMultipleNoteTails(e,t){e.forEach(n=>{let i=t;n.shape==="circle"&&(i=Math.max(n.startColumnIndex+1,t)),n.endColumnIndex=i}),this.emit("notesChanged")},updateNoteRow(e,t){e.row=t,e.globalRow=t,this.emit("notesChanged")},updateMultipleNoteRows(e,t){e.forEach((n,i)=>{const r=t[i];r!==void 0&&(n.row=r,Pf(n,this.state))}),this.emit("notesChanged")},updateNotePosition(e,t){e.startColumnIndex=t,e.endColumnIndex=e.shape==="circle"?t+1:t,this.emit("notesChanged")},updateMultipleNotePositions(e,t){e.forEach(n=>{n.startColumnIndex=t,n.endColumnIndex=n.shape==="circle"?t+1:t}),this.emit("notesChanged")},eraseInPitchArea(e,t,n=1,i=!0){const r=e+n-1,A=t-1,a=t+1;let l=!1;const c=this.state.placedNotes.length;return this.state.placedNotes=this.state.placedNotes.filter(h=>{if(h.isDrum)return!0;if(h.shape==="circle"){const f=h.startColumnIndex+1,m=typeof h.endColumnIndex=="number"?Math.max(f,h.endColumnIndex):f,w=h.startColumnIndex<=r&&m>=e,B=h.row>=A&&h.row<=a;if(w&&B)return!1}else if(h.row>=A&&h.row<=a&&h.startColumnIndex<=r&&h.endColumnIndex>=e)return!1;return!0}),this.state.placedNotes.length<c&&(l=!0),l&&(this.emit("notesChanged"),i&&this.recordState()),l},eraseDrumNoteAt(e,t,n=!0){const i=this.state.placedNotes.length;this.state.placedNotes=this.state.placedNotes.filter(A=>!(A.isDrum&&A.drumTrack===t&&A.startColumnIndex===e));const r=this.state.placedNotes.length<i;return r&&(this.emit("notesChanged"),n&&this.recordState()),r},addTonicSignGroup(e){x.debug("TonicPlacement","Starting addTonicSignGroup",{tonicSignGroup:e},"state");const t=e[0];if(!t)return;const{preMacrobeatIndex:n}=t;if(x.debug("TonicPlacement","preMacrobeatIndex",{preMacrobeatIndex:n},"state"),Object.entries(this.state.tonicSignGroups).find(([,c])=>c.some(h=>h.preMacrobeatIndex===n))){x.debug("TonicPlacement","Existing tonic already present for measure, skipping",{preMacrobeatIndex:n},"state");return}const r=Tn(this.state,n+1).startColumn;x.debug("TonicPlacement","Boundary column (canvas-space) for shifting notes",{boundaryColumn:r},"state");const A=this.state.placedNotes.filter(c=>c.startColumnIndex>=r);x.debug("TonicPlacement","Notes that will be shifted",{noteRanges:A.map(c=>`${c.startColumnIndex}-${c.endColumnIndex}`)},"state"),this.state.placedNotes.forEach(c=>{if(c.startColumnIndex>=r){const h=c.startColumnIndex,f=c.endColumnIndex;c.startColumnIndex=c.startColumnIndex+2,c.endColumnIndex=c.endColumnIndex+2,x.debug("TonicPlacement",`Shifted note from ${h}-${f} to ${c.startColumnIndex}-${c.endColumnIndex}`,null,"state")}});const a=$c(),l=e.map(c=>({...c,uuid:a,globalRow:typeof c.globalRow=="number"?c.globalRow:c.row}));this.state.tonicSignGroups[a]=l,x.debug("TonicPlacement","Added tonic group",{uuid:a,columns:l.map(c=>c.columnIndex)},"state"),x.debug("TonicPlacement","Emitting events: notesChanged, rhythmStructureChanged",null,"state"),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},eraseTonicSignAt(e,t=!0){const n=Object.entries(this.state.tonicSignGroups).find(([,c])=>c.some(h=>h.columnIndex===e));if(!n)return!1;const[i,r]=n,A=r[0];if(!A)return!1;const a=A.preMacrobeatIndex,l=Tn(this.state,a+1).startColumn;return delete this.state.tonicSignGroups[i],this.state.placedNotes.forEach(c=>{c.startColumnIndex>=l&&(c.startColumnIndex=c.startColumnIndex-2,c.endColumnIndex=c.endColumnIndex-2)}),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),t&&this.recordState(),!0},toggleDrumNote(e){const t=this.state.placedNotes.findIndex(n=>n.isDrum&&n.drumTrack===e.drumTrack&&n.startColumnIndex===e.startColumnIndex);if(t>=0)this.state.placedNotes.splice(t,1);else{const n={...e,uuid:$c()};this.state.placedNotes.push(n)}this.emit("notesChanged"),this.recordState()},clearAllNotes(){this.state.placedNotes=[],this.state.tonicSignGroups={},this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},loadNotes(e){const t=(e||[]).map(n=>{const i={...n,uuid:(n==null?void 0:n.uuid)??$c()};return Dp(i),Pf(i,this.state),i});this.state.placedNotes=t,this.emit("notesChanged"),this.recordState()}},nT={setADSR(e,t){this.state.timbres[e]&&(this.state.timbres[e].adsr=t,this.state.timbres[e].activePresetName=null,this.emit("timbreChanged",e))},setFilterSettings(e,t){if(this.state.timbres[e]){x.debug("TimbreActions","setFilterSettings called",{color:e,newSettings:t,activePresetName:this.state.timbres[e].activePresetName},"timbre"),x.debug("TimbreActions","setFilterSettings call stack",{stack:new Error().stack},"timbre"),Object.assign(this.state.timbres[e].filter,t);const n=this.state.timbres[e].filter.blend;n<=0?this.state.timbres[e].filter.type="highpass":n>=2?this.state.timbres[e].filter.type="lowpass":this.state.timbres[e].filter.type="bandpass",t.enabled===void 0&&(x.debug("TimbreActions","Clearing activePresetName because enabled is undefined",{color:e},"timbre"),this.state.timbres[e].activePresetName=null),this.emit("timbreChanged",e)}},setHarmonicCoefficients(e,t){this.state.timbres[e]&&(this.state.timbres[e].coeffs=t,this.state.timbres[e].activePresetName=null,this.emit("timbreChanged",e))},setHarmonicPhases(e,t){this.state.timbres[e]&&(x.debug("TimbreActions",`setHarmonicPhases called for ${e}`,null,"state"),x.debug("TimbreActions","Old phases",{phases:this.state.timbres[e].phases},"state"),x.debug("TimbreActions","New phases",{phases:t},"state"),x.debug("TimbreActions","Coefficients before phase change",{coeffs:this.state.timbres[e].coeffs},"state"),this.state.timbres[e].phases=t,this.state.timbres[e].activePresetName=null,x.debug("TimbreActions","Coefficients after phase change",{coeffs:this.state.timbres[e].coeffs},"state"),x.debug("TimbreActions","Emitting timbreChanged for phase change",null,"state"),this.emit("timbreChanged",e))},applyPreset(e,t){!t||!this.state.timbres[e]||(x.debug("TimbreActions",`applyPreset called for ${e}`,null,"state"),x.debug("TimbreActions","Preset name",{name:t.name},"state"),x.debug("TimbreActions","Preset coeffs",{coeffs:t.coeffs},"state"),x.debug("TimbreActions","Old timbre coeffs",{coeffs:this.state.timbres[e].coeffs},"state"),this.state.timbres[e].adsr=t.adsr,this.state.timbres[e].coeffs=new Float32Array(t.coeffs),t.phases?this.state.timbres[e].phases=new Float32Array(t.phases):this.state.timbres[e].phases=new Float32Array(this.state.timbres[e].coeffs.length).fill(0),this.state.timbres[e].activePresetName=t.name,this.state.timbres[e].gain=t.gain||1,t.filter?this.state.timbres[e].filter=JSON.parse(JSON.stringify(t.filter)):this.state.timbres[e].filter=Ky(),x.debug("TimbreActions","Applied preset - new coeffs",{coeffs:this.state.timbres[e].coeffs},"state"),this.emit("timbreChanged",e),this.recordState())}};function kp(e,...t){}const ls={COMPRESSION_2_3:2/3,EXPANSION_3_2:3/2};function sT(e,t){if(!t||!t.macrobeatGroupings)return e*4;if(e===0)return 0;const n=e-1,i=Tn(t,n);if(i){const A=i.endColumn+1;return kp("log","[MODULATION] Found measure info, canvas-space endColumn:",i.endColumn,"first column after:",A),A}return e*4}function iT(e,t,n=null,i=null,r=null){return{id:`mod_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,measureIndex:e,ratio:t,active:!0,xPosition:n,columnIndex:i,macrobeatIndex:r}}function u0(e){return Math.abs(e-ls.COMPRESSION_2_3)<.001?"2:3":Math.abs(e-ls.EXPANSION_3_2)<.001?"3:2":`${e}`}function h0(e){const t="#ffc107";return Math.abs(e-ls.COMPRESSION_2_3)<.001||Math.abs(e-ls.EXPANSION_3_2)<.001,t}function Ev(){const e=[{startColumn:0,endColumn:1/0,scale:1}];return{segments:e,getScaleForColumn(t){return 1},microbeatToCanvasX(){return 0},canvasXToMicrobeat(){return 0},getSegmentAtX(){return e[0]||null},getGhostGridPositions(){return[]}}}function rT(e,t,n=null){if(!e||e.length===0)return Ev();const i=[...e.filter(h=>h.active)].sort((h,f)=>h.measureIndex-f.measureIndex);if(i.length===0)return Ev();const r=i.map(h=>{const f=sT(h.measureIndex,n);return kp("log",`[MODULATION] Marker at measure ${h.measureIndex} calculated column=${f}`),kp("log","[MODULATION] Final marker position:",{id:h.id,measureIndex:h.measureIndex,columnIndex:f}),{...h,columnIndex:f}}),A=[];let a=1;const l=r[0];if(r.length===0||l&&l.columnIndex>0){const h=l?l.columnIndex:1/0;A.push({startColumn:0,endColumn:h,scale:1})}for(let h=0;h<r.length;h++){const f=r[h],m=r[h+1],w=m?m.columnIndex:1/0;a*=f.ratio,A.push({startColumn:f.columnIndex,endColumn:w,scale:a,marker:f})}return{segments:A,getScaleForColumn(h){for(const f of A)if(h>=f.startColumn&&h<f.endColumn)return f.scale;return 1},microbeatToCanvasX(h){return 0},canvasXToMicrobeat(h){return 0},getSegmentAtX(h){return A[0]||null},getGhostGridPositions(h,f){return[]}}}function Tv(e){if(e)return e.uuid}function d0(e,t=null){const n=Array.isArray(t)?t:e.macrobeatGroupings||[],r=[...In(e)].sort((f,m)=>f.preMacrobeatIndex-m.preMacrobeatIndex);let A=0;const a=[];let l=0;const c=f=>{a.push({visualIndex:a.length,type:`legend-${f}`,timeIndex:null})},h=f=>{for(;A<r.length;){const m=r[A];if((m==null?void 0:m.preMacrobeatIndex)!==f)break;a.push({visualIndex:a.length,type:"tonic",timeIndex:null}),a.push({visualIndex:a.length,type:"tonic",timeIndex:null});const w=Tv(m);if(w)do A++;while(A<r.length&&Tv(r[A])===w);else A++}};return c("left"),c("left"),h(-1),n.forEach((f,m)=>{for(let w=0;w<f;w++)a.push({visualIndex:a.length,type:"time",timeIndex:l++});h(m)}),c("right"),c("right"),{entries:a,totalTimeColumns:l}}function ui(e,t,n=null){if(n!==null){const{entries:i}=d0(e,n),r=i[t];return r?r.timeIndex:null}return G1(t,e)}function dr(e,t,n=null){if(t==null)return null;if(n!==null){const{entries:i,totalTimeColumns:r}=d0(e,n);if(t<0||t>=r)return null;const A=i.find(a=>a.timeIndex===t);return A?A.visualIndex:null}return K1(t,e)}function Df(e,t,n=null){const i=Array.isArray(n)?n:e.macrobeatGroupings||[];if(t==null)return 0;let r=0;for(let A=0;A<=t&&A<i.length;A++){const a=i[A];typeof a=="number"&&(r+=a)}return r}function Fv(e){const t=xs.getColumnMap(e),n=new Map;t.entries.forEach(i=>{i.type==="tonic"&&i.tonicSignUuid&&typeof i.canvasIndex=="number"&&n.set(i.tonicSignUuid,i.canvasIndex)}),Object.entries(e.tonicSignGroups||{}).forEach(([i,r])=>{const A=n.get(i);A!==void 0&&r.forEach(a=>{a.columnIndex=A})})}const AT={setAnacrusis(e){var c,h,f;if(this.state.hasAnacrusis===e)return;const t=[...this.state.macrobeatGroupings],n=[...this.state.macrobeatBoundaryStyles],i=t.reduce((m,w)=>m+w,0);let r,A;if(e){const m=this._anacrusisCache,w=av.length-Mp.length,B=av.slice(0,w),y=AE.slice(0,w),b=(c=m==null?void 0:m.groupings)!=null&&c.length?[...m.groupings]:[...B],S=(h=m==null?void 0:m.boundaryStyles)!=null&&h.length?[...m.boundaryStyles]:[...y];if(r=[...b,...t],A=[...S,...n],!((f=m==null?void 0:m.boundaryStyles)!=null&&f.length))for(let F=0;F<S.length;F++)A[F]=F<S.length-1?"anacrusis":"solid";this._anacrusisCache=null,x.debug("rhythmActions","Enabled anacrusis",{insertedCount:b.length,insertedColumns:b.reduce((F,U)=>F+U,0)},"state")}else{const m=n.findIndex(b=>b==="solid");let w=0;if(m!==-1)w=m+1;else for(;w<n.length&&n[w]==="anacrusis";)w++;w=Math.min(w,t.length);const B=t.slice(0,w),y=n.slice(0,w);w>0?this._anacrusisCache={groupings:B,boundaryStyles:y}:this._anacrusisCache=null,r=t.slice(w),A=n.slice(w).map(b=>b==="anacrusis"?"dashed":b),r.length===0&&(r=[...Mp],A=[...Wy]),x.debug("rhythmActions","Disabled anacrusis",{removalCount:w,removedColumns:B.reduce((b,S)=>b+S,0)},"state")}const l=r.reduce((m,w)=>m+w,0)-i;if(this.state.hasAnacrusis=e,this.state.macrobeatGroupings=[...r],this.state.macrobeatBoundaryStyles=[...A],Fv(this.state),l!==0){const m=[];this.state.placedNotes.forEach(S=>{const F=ui(this.state,S.startColumnIndex,t),U=ui(this.state,S.endColumnIndex,t);if(F===null||U===null)return;const D=F+l,H=U+l;if(D<0){m.push(S);return}const Q=dr(this.state,D,r),R=dr(this.state,H,r);if(Q===null||R===null){m.push(S);return}S.startColumnIndex=Q,S.endColumnIndex=R}),m.forEach(S=>{const F=this.state.placedNotes.indexOf(S);F>-1&&this.state.placedNotes.splice(F,1)});const w=[];this.state.sixteenthStampPlacements.forEach(S=>{const F=ui(this.state,S.startColumn,t),U=ui(this.state,S.endColumn,t);if(F===null||U===null)return;const D=F+l,H=U+l;if(D<0){w.push(S);return}const Q=dr(this.state,D,r),R=dr(this.state,H,r);if(Q===null||R===null){w.push(S);return}S.startColumn=Q,S.endColumn=R}),w.forEach(S=>{const F=this.state.sixteenthStampPlacements.indexOf(S);F>-1&&this.state.sixteenthStampPlacements.splice(F,1)});const B=[];this.state.tripletStampPlacements&&(this.state.tripletStampPlacements.forEach(S=>{const F=S.startTimeIndex+l;F<0?B.push(S):S.startTimeIndex=F}),B.forEach(S=>{const F=this.state.tripletStampPlacements.indexOf(S);F>-1&&this.state.tripletStampPlacements.splice(F,1)})),Object.values(this.state.tonicSignGroups).flat().forEach(S=>{S.preMacrobeatIndex>=0});const y=[],b=e?r.length-t.length:-(t.length-r.length);this.state.modulationMarkers.forEach(S=>{const F=S.measureIndex+b;if(F<0){y.push(S);return}S.measureIndex=F,S.columnIndex=null,S.xPosition=null,S.macrobeatIndex=null}),y.forEach(S=>{const F=this.state.modulationMarkers.indexOf(S);F>-1&&this.state.modulationMarkers.splice(F,1)})}this.emit("anacrusisChanged",e),this.emit("notesChanged"),this.emit("sixteenthStampPlacementsChanged"),this.emit("tripletStampPlacementsChanged"),this.emit("modulationMarkersChanged"),this.emit("rhythmStructureChanged"),this.recordState()},toggleMacrobeatGrouping(e){if(e===void 0||e<0||e>=this.state.macrobeatGroupings.length){x.error("rhythmActions",`Invalid index for toggleMacrobeatGrouping: ${e}`,null,"state");return}const t=[...this.state.macrobeatGroupings],n=t[e],i=n===2?3:2,r=i-n,A=[...t];A[e]=i;const a=Df(this.state,e,t),l=[];this.state.placedNotes.forEach(c=>{const h=ui(this.state,c.startColumnIndex,t),f=ui(this.state,c.endColumnIndex,t);if(!(h===null||f===null)&&h>=a){const m=h+r,w=f+r,B=dr(this.state,m,A),y=dr(this.state,w,A);B!==null&&y!==null?(c.startColumnIndex=B,c.endColumnIndex=y):l.push(c)}}),l.length&&l.forEach(c=>{const h=this.state.placedNotes.indexOf(c);h>-1&&this.state.placedNotes.splice(h,1)}),this.state.macrobeatGroupings=A,Fv(this.state),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},cycleMacrobeatBoundaryStyle(e){if(e===void 0||e<0||e>=this.state.macrobeatBoundaryStyles.length){x.error("rhythmActions",`Invalid index for cycleMacrobeatBoundaryStyle: ${e}`,null,"state");return}const t=this._isBoundaryInAnacrusis(e);let n;t?n=["dashed","solid","anacrusis"]:n=["dashed","solid"];const i=this.state.macrobeatBoundaryStyles[e]??"dashed",r=n.indexOf(i),A=r===-1?0:(r+1)%n.length,a=n[A]??"dashed";this.state.macrobeatBoundaryStyles[e]=a,this.emit("rhythmStructureChanged"),this.recordState()},_isBoundaryInAnacrusis(e){if(!this.state.hasAnacrusis)return!1;for(let t=0;t<=e;t++)if(this.state.macrobeatBoundaryStyles[t]==="solid")return t===e;return!0},increaseMacrobeatCount(){this.state.macrobeatGroupings.push(2),this.state.macrobeatBoundaryStyles.push("dashed"),this.emit("rhythmStructureChanged"),this.recordState()},decreaseMacrobeatCount(){if(this.state.macrobeatGroupings.length>1){const e=this.state.macrobeatGroupings.length-1,t=Df(this.state,e-1,this.state.macrobeatGroupings),n=[];this.state.placedNotes.forEach(A=>{const a=ui(this.state,A.startColumnIndex,this.state.macrobeatGroupings);a!==null&&a>=t&&n.push(A)}),n.forEach(A=>{const a=this.state.placedNotes.indexOf(A);a>-1&&this.state.placedNotes.splice(a,1)});const i=[];this.state.sixteenthStampPlacements.forEach(A=>{const a=ui(this.state,A.startColumn,this.state.macrobeatGroupings);a!==null&&a>=t&&i.push(A)}),i.forEach(A=>{const a=this.state.sixteenthStampPlacements.indexOf(A);a>-1&&this.state.sixteenthStampPlacements.splice(a,1)});const r=[];this.state.tripletStampPlacements&&(this.state.tripletStampPlacements.forEach(A=>{A.startTimeIndex>=t&&r.push(A)}),r.forEach(A=>{const a=this.state.tripletStampPlacements.indexOf(A);a>-1&&this.state.tripletStampPlacements.splice(a,1)})),this.state.macrobeatGroupings.pop(),this.state.macrobeatBoundaryStyles.pop(),n.length>0&&this.emit("notesChanged"),i.length>0&&this.emit("sixteenthStampPlacementsChanged"),r.length>0&&this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),this.recordState()}},updateTimeSignature(e,t){if(!Array.isArray(t)||t.length===0){x.error("rhythmActions","Invalid groupings provided to updateTimeSignature",null,"state");return}let n=0,i=0,r=0;for(let B=0;B<this.state.macrobeatGroupings.length;B++){if(r===e){n=B;break}const y=B===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[B]==="solid"||y)&&r++}r=0;for(let B=0;B<this.state.macrobeatGroupings.length;B++)if(r===e){const y=B===this.state.macrobeatGroupings.length-1;if(this.state.macrobeatBoundaryStyles[B]==="solid"||y){i=B;break}}else if(r<e){const y=B===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[B]==="solid"||y)&&r++}const A=i-n+1,a=t.length,l=this.state.macrobeatGroupings.slice(n,i+1).reduce((B,y)=>B+y,0),h=t.reduce((B,y)=>B+y,0)-l,f=Df(this.state,i,this.state.macrobeatGroupings);if(h!==0){const B=(()=>{const b=[...this.state.macrobeatGroupings];return b.splice(n,A,...t),b})(),y=[];this.state.placedNotes.forEach(b=>{const S=ui(this.state,b.startColumnIndex,this.state.macrobeatGroupings),F=ui(this.state,b.endColumnIndex,this.state.macrobeatGroupings);if(!(S===null||F===null)&&S>=f){const U=S+h,D=F+h,H=dr(this.state,U,B),Q=dr(this.state,D,B);H!==null&&Q!==null?(b.startColumnIndex=H,b.endColumnIndex=Q):y.push(b)}}),y.length&&y.forEach(b=>{const S=this.state.placedNotes.indexOf(b);S>-1&&this.state.placedNotes.splice(S,1)})}const m=[...t],w=new Array(Math.max(a-1,0)).fill("dashed");if(i<this.state.macrobeatBoundaryStyles.length){const B=this.state.macrobeatBoundaryStyles[i]??"dashed";w.push(B)}this.state.macrobeatGroupings.splice(n,A,...m),this.state.macrobeatBoundaryStyles.splice(n,A-1,...w),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},addModulationMarker(e,t,n=null,i=null,r=null){if(!Object.values(ls).includes(t))return x.error("rhythmActions",`Invalid modulation ratio: ${t}`,null,"state"),null;const A=this.state.modulationMarkers.findIndex(l=>l.measureIndex===e||r!==null&&l.macrobeatIndex===r||i!==null&&l.columnIndex===i);if(A!==-1){const l=this.state.modulationMarkers[A];return x.info("rhythmActions",`Replacing existing modulation marker ${l.id} at measure ${e} (old ratio: ${l.ratio}, new ratio: ${t})`,null,"state"),l.ratio=t,l.xPosition=n,i!==null&&(l.columnIndex=i),r!==null&&(l.macrobeatIndex=r),this.emit("modulationMarkersChanged"),this.recordState(),l.id}const a=iT(e,t,n,i,r);return this.state.modulationMarkers.push(a),this.state.modulationMarkers.sort((l,c)=>l.measureIndex-c.measureIndex),this.emit("modulationMarkersChanged"),this.recordState(),x.info("rhythmActions",`Added modulation marker ${a.id} at measure ${e} with ratio=${t}, columnIndex=${i}`,null,"state"),a.id},removeModulationMarker(e){const t=this.state.modulationMarkers.findIndex(n=>n.id===e);if(t===-1){x.warn("rhythmActions",`Modulation marker not found: ${e}`,null,"state");return}this.state.modulationMarkers.splice(t,1),this.emit("modulationMarkersChanged"),this.recordState(),x.info("rhythmActions",`Removed modulation marker ${e}`,null,"state")},setModulationRatio(e,t){if(!Object.values(ls).includes(t)){x.error("rhythmActions",`Invalid modulation ratio: ${t}`,null,"state");return}const n=this.state.modulationMarkers.find(i=>i.id===e);if(!n){x.warn("rhythmActions",`Modulation marker not found: ${e}`,null,"state");return}n.ratio=t,this.emit("modulationMarkersChanged"),this.recordState(),x.info("rhythmActions",`Updated modulation marker ${e} ratio to ${t}`,null,"state")},moveModulationMarker(e,t){const n=this.state.modulationMarkers.find(i=>i.id===e);if(!n){x.warn("rhythmActions",`Modulation marker not found: ${e}`,null,"state");return}n.measureIndex=t,this.state.modulationMarkers.sort((i,r)=>i.measureIndex-r.measureIndex),this.emit("modulationMarkersChanged"),this.recordState(),x.info("rhythmActions",`Moved modulation marker ${e} to measure ${t}`,null,"state")},toggleModulationMarker(e){const t=this.state.modulationMarkers.find(n=>n.id===e);if(!t){x.warn("rhythmActions",`Modulation marker not found: ${e}`,null,"state");return}t.active=!t.active,this.emit("modulationMarkersChanged"),this.recordState(),x.info("rhythmActions",`Toggled modulation marker ${e} active state to ${t.active}`,null,"state")},clearModulationMarkers(){const e=this.state.modulationMarkers.length;this.state.modulationMarkers=[],this.emit("modulationMarkersChanged"),this.recordState(),x.info("rhythmActions",`Cleared ${e} modulation markers`,null,"state")}},Lp={toggleAccidentalMode(e){if(!Object.prototype.hasOwnProperty.call(this.state.accidentalMode||{},e))return;const t={...this.state.accidentalMode},n=t[e],i=e==="flat"?"sharp":"flat",r=t[i];x.debug("ViewActions",`toggleAccidentalMode(${e})`,{previousState:t,requestedType:e,requestedValue:!n,pairedType:i,pairedValue:r},"state"),n&&!r?(this.state.accidentalMode[i]=!0,this.state.accidentalMode[e]=!1,x.warn("ViewActions",`Prevented both accidentals from being disabled (enabling ${i})`,{enforcedType:i,toggledType:e},"state")):this.state.accidentalMode[e]=!n,x.debug("ViewActions",`toggleAccidentalMode(${e}) result`,{newState:{...this.state.accidentalMode}},"state"),this.emit("accidentalModeChanged",this.state.accidentalMode),this.emit("layoutConfigChanged")},toggleFrequencyLabels(){const e=this.state.showFrequencyLabels;this.state.showFrequencyLabels=!this.state.showFrequencyLabels,x.debug("ViewActions","toggleFrequencyLabels",{previous:e,next:this.state.showFrequencyLabels,accidentalMode:{...this.state.accidentalMode}},"state"),this.emit("frequencyLabelsChanged",this.state.showFrequencyLabels),this.emit("layoutConfigChanged")},toggleOctaveLabels(){const e=this.state.showOctaveLabels;this.state.showOctaveLabels=!e,x.debug("ViewActions","toggleOctaveLabels",{previous:e,next:this.state.showOctaveLabels},"state"),this.emit("octaveLabelsChanged",this.state.showOctaveLabels),this.emit("layoutConfigChanged")},toggleFocusColours(){this.state.focusColours=!this.state.focusColours;const e=this.state.focusColours;this.emit("focusColoursChanged",e),this.emit("layoutConfigChanged")},setDegreeDisplayMode(e){const t=this.state.degreeDisplayMode;this.state.degreeDisplayMode=this.state.degreeDisplayMode===e?"off":e;const n=this.state.degreeDisplayMode;x.debug("ViewActions","setDegreeDisplayMode",{oldMode:t,newMode:n},"state"),this.emit("layoutConfigChanged"),this.emit("degreeDisplayModeChanged",n)},setSelectedTool(e,t){if(this.state.selectedTool!==e||e==="tonicization"&&this.state.selectedToolTonicNumber!==t){const i=this.state.selectedTool;this.state.previousTool=i,this.state.selectedTool=e,e==="tonicization"&&t&&(this.state.selectedToolTonicNumber=parseInt(String(t),10)),this.emit("toolChanged",{newTool:e,oldTool:i})}},setSelectedNote(e,t){const n={...this.state.selectedNote};this.state.selectedNote={shape:e,color:t},this.emit("noteChanged",{newNote:this.state.selectedNote,oldNote:n})},setKeySignature(e){this.state.keySignature!==e&&(this.state.keySignature=e,this.emit("keySignatureChanged",e))},setTempo(e){this.state.tempo=e,this.emit("tempoChanged",e)},setLooping(e){this.state.isLooping=e,this.emit("loopingChanged",e)},setPlaybackState(e,t=!1){this.state.isPlaying=e,this.state.isPaused=t,this.emit("playbackStateChanged",{isPlaying:e,isPaused:t})},setPlayheadMode(e){e!=="cursor"&&e!=="microbeat"&&e!=="macrobeat"||this.state.playheadMode!==e&&(this.state.playheadMode=e,this.emit("playheadModeChanged",e))},toggleWaveformExtendedView(){this.state.waveformExtendedView=!this.state.waveformExtendedView,this.emit("waveformExtendedViewChanged",this.state.waveformExtendedView)},setAdsrTimeAxisScale(e){const t=Math.max(.1,Math.min(5,e));this.state.adsrTimeAxisScale=t,this.emit("adsrTimeAxisScaleChanged",t)},setLayoutConfig(e){const t={cellWidth:this.state.cellWidth,cellHeight:this.state.cellHeight,columnWidths:[...this.state.columnWidths||[]]};let n=!1;if(e.cellWidth!==void 0&&this.state.cellWidth!==e.cellWidth&&(this.state.cellWidth=e.cellWidth,n=!0),e.cellHeight!==void 0&&this.state.cellHeight!==e.cellHeight&&(this.state.cellHeight=e.cellHeight,n=!0),e.columnWidths!==void 0){const i=JSON.stringify(this.state.columnWidths||[]),r=JSON.stringify(e.columnWidths);i!==r&&(this.state.columnWidths=[...e.columnWidths],n=!0)}n&&this.emit("layoutConfigChanged",{oldConfig:t,newConfig:{cellWidth:this.state.cellWidth,cellHeight:this.state.cellHeight,columnWidths:[...this.state.columnWidths||[]]}})},setGridPosition(e){const t=this.state.fullRowData.length-this.state.viewportRows*2,n=Math.max(0,Math.min(e,t));this.state.gridPosition!==n&&(this.state.gridPosition=n,this.emit("layoutConfigChanged"))},shiftGridUp(){Lp.setGridPosition.call(this,this.state.gridPosition-1)},shiftGridDown(){Lp.setGridPosition.call(this,this.state.gridPosition+1)},setPrintOptions(e){this.state.printOptions={...this.state.printOptions,...e},this.emit("printOptionsChanged",this.state.printOptions)},setPrintPreviewActive(e){this.state.isPrintPreviewActive=e,this.emit("printPreviewStateChanged",e)},setPitchRange(e){const t=Fe.length;if(!e||t===0)return;const n=this.state.pitchRange||{topIndex:0,bottomIndex:t-1},i=Math.max(0,t-1),r=e.topIndex??n.topIndex,A=e.bottomIndex??n.bottomIndex,a=Math.max(0,Math.min(i,r)),l=Math.max(a,Math.min(i,A));n.topIndex===a&&n.bottomIndex===l||(this.state.pitchRange={topIndex:a,bottomIndex:l},this.emit("pitchRangeChanged",{topIndex:a,bottomIndex:l}),this.emit("layoutConfigChanged"))},setDeviceProfile(e={}){const t=this.state.deviceProfile||{},n={isMobile:e.isMobile??t.isMobile??!1,isTouch:e.isTouch??t.isTouch??!1,isCoarsePointer:e.isCoarsePointer??t.isCoarsePointer??!1,orientation:e.orientation??t.orientation??"landscape",width:e.width??t.width??0,height:e.height??t.height??0},i=Object.keys(n).some(r=>n[r]!==t[r]);this.state.deviceProfile=n,i&&this.emit("deviceProfileChanged",n)},setLongNoteStyle(e){this.state.longNoteStyle!==e&&(this.state.longNoteStyle=e,this.emit("longNoteStyleChanged",e))}},oT={setActiveChordIntervals(e){this.state.activeChordIntervals=e,this.emit("activeChordIntervalsChanged",e)},setIntervalsInversion(e){this.state.isIntervalsInverted=e,this.emit("intervalsInversionChanged",e)},setChordPosition(e){this.state.chordPositionState=e,this.emit("chordPositionChanged",e)}};function f0(e,t){return t.some(n=>n.columnIndex===e)}function zl(e,t){return t.some(n=>e===n.columnIndex||e===n.columnIndex+1)}function Xl(e,t){const n=In(t);return!zl(e,n)}function p0(e,t){for(const n of t)if(e===n.columnIndex+1)return!1;return t.some(n=>e===n.columnIndex+2),!0}function m0(e){const t=new Set;return e.forEach(n=>{t.add(n.columnIndex),t.add(n.columnIndex+1)}),t}x.moduleLoaded("SixteenthStampActions","stamps");function aT(){return`sixteenth-stamp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const Rp={addSixteenthStampPlacement(e,t,n,i="#4a90e2"){const r=t+2,A=In(this.state);if(zl(t,A)||zl(t+1,A))return x.debug("SixteenthStampActions","Cannot place sixteenth stamp - overlaps tonic column",{sixteenthStampId:e,startColumn:t,row:n},"stamps"),null;const a=this.state.sixteenthStampPlacements.find(h=>h.row===n&&h.startColumn<r&&h.endColumn>t);a&&Rp.removeSixteenthStampPlacement.call(this,a.id);const l=n,c={id:aT(),sixteenthStampId:e,startColumn:t,endColumn:r,row:n,globalRow:l,color:i,timestamp:Date.now()};return this.state.sixteenthStampPlacements.push(c),this.emit("sixteenthStampPlacementsChanged"),x.debug("SixteenthStampActions",`Added sixteenth stamp ${e} at canvas-space ${t}-${r},${n}`,{sixteenthStampId:e,startColumn:t,endColumn:r,row:n,placementId:c.id},"stamps"),c},removeSixteenthStampPlacement(e){const t=this.state.sixteenthStampPlacements.findIndex(i=>i.id===e);if(t===-1)return!1;const n=this.state.sixteenthStampPlacements.splice(t,1)[0];return n?(this.emit("sixteenthStampPlacementsChanged"),x.debug("SixteenthStampActions",`Removed sixteenth stamp ${n.sixteenthStampId} at ${n.startColumn}-${n.endColumn},${n.row}`,{placementId:e,sixteenthStampId:n.sixteenthStampId,startColumn:n.startColumn,endColumn:n.endColumn,row:n.row},"stamps"),!0):!1},eraseSixteenthStampsInArea(e,t,n,i){const r=[];for(const a of this.state.sixteenthStampPlacements){const l=a.startColumn<=t&&a.endColumn>=e,c=a.row>=n&&a.row<=i;l&&c&&r.push(a.id)}let A=!1;return r.forEach(a=>{Rp.removeSixteenthStampPlacement.call(this,a)&&(A=!0)}),A},getAllSixteenthStampPlacements(){return[...this.state.sixteenthStampPlacements]},getSixteenthStampAt(e,t){return this.state.sixteenthStampPlacements.find(n=>n.row===t&&e>=n.startColumn&&e<n.endColumn)||null},clearAllSixteenthStamps(){const e=this.state.sixteenthStampPlacements.length>0;this.state.sixteenthStampPlacements=[],e&&(this.emit("sixteenthStampPlacementsChanged"),x.info("SixteenthStampActions","Cleared all sixteenth stamp placements",null,"stamps"))},getSixteenthStampPlaybackData(){return this.state.sixteenthStampPlacements.map(e=>{const t=this.state.fullRowData[e.row];return{sixteenthStampId:e.sixteenthStampId,column:e.startColumn,startColumn:e.startColumn,endColumn:e.endColumn,row:e.row,pitch:t==null?void 0:t.toneNote,color:e.color,placement:e}}).filter(e=>e.pitch)},updateSixteenthStampShapeOffset(e,t,n){const i=this.state.sixteenthStampPlacements.find(r=>r.id===e);if(!i){x.warn("SixteenthStampActions","[SIXTEENTH STAMP SHAPE OFFSET] Placement not found",{placementId:e},"stamps");return}i.shapeOffsets||(i.shapeOffsets={}),x.debug("SixteenthStampActions","[SIXTEENTH STAMP SHAPE OFFSET] Updating shape offset",{placementId:e,shapeKey:t,oldOffset:i.shapeOffsets[t]||0,newOffset:n,baseRow:i.row,targetRow:i.row+n},"stamps"),i.shapeOffsets[t]=n,this.emit("sixteenthStampPlacementsChanged")},getSixteenthStampShapeRow(e,t){var i;const n=((i=e.shapeOffsets)==null?void 0:i[t])||0;return e.row+n}};x.moduleLoaded("TripletStampActions","triplets");function lT(){return`triplet-stamp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const Hp={addTripletStampPlacement(e){this.state.tripletStampPlacements||(this.state.tripletStampPlacements=[]);const t=e.startTimeIndex+e.span*2,n=this.state.tripletStampPlacements.find(r=>r.row!==e.row?!1:!(r.startTimeIndex+r.span*2<=e.startTimeIndex||t<=r.startTimeIndex));n&&Hp.removeTripletStampPlacement.call(this,n.id),this.state.sixteenthStampPlacements&&this.state.sixteenthStampPlacements.filter(A=>{if(A.row!==e.row)return!1;const a=br(A.startColumn,this.state);return a===null?!0:!(a+2<=e.startTimeIndex||a>=t)}).forEach(A=>this.removeSixteenthStampPlacement(A.id));const i={id:lT(),...e};return this.state.tripletStampPlacements.push(i),this.emit("tripletStampPlacementsChanged"),this.emit("rhythmStructureChanged"),x.debug("TripletStampActions",`Added triplet stamp ${e.tripletStampId} at time ${e.startTimeIndex}, row ${e.row}`,{tripletStampId:e.tripletStampId,startTimeIndex:e.startTimeIndex,span:e.span,row:e.row,placementId:i.id},"triplets"),i},removeTripletStampPlacement(e){if(!this.state.tripletStampPlacements)return!1;const t=this.state.tripletStampPlacements.findIndex(i=>i.id===e);if(t===-1)return!1;const n=this.state.tripletStampPlacements.splice(t,1)[0];return n?(this.emit("tripletStampPlacementsChanged"),x.debug("TripletStampActions",`Removed triplet stamp ${n.tripletStampId} at time ${n.startTimeIndex}, row ${n.row}`,{placementId:e,tripletStampId:n.tripletStampId,startTimeIndex:n.startTimeIndex,span:n.span,row:n.row},"triplets"),!0):!1},eraseTripletStampsInArea(e,t,n,i){if(!this.state.tripletStampPlacements)return!1;const r=[];for(const a of this.state.tripletStampPlacements)if(a.row>=n&&a.row<=i){const l=a.span*2,c=ds(a.startTimeIndex,this.state);c+l-1<e||c>t||r.push(a.id)}let A=!1;return r.forEach(a=>{Hp.removeTripletStampPlacement.call(this,a)&&(A=!0)}),A},getAllTripletStampPlacements(){return[...this.state.tripletStampPlacements||[]]},getTripletStampAt(e,t){return this.state.tripletStampPlacements&&this.state.tripletStampPlacements.find(n=>n.row===t&&e>=n.startTimeIndex&&e<n.startTimeIndex+n.span*2)||null},clearAllTripletStamps(){if(!this.state.tripletStampPlacements)return;const e=this.state.tripletStampPlacements.length>0;this.state.tripletStampPlacements=[],e&&(this.emit("tripletStampPlacementsChanged"),x.info("TripletStampActions","Cleared all triplet stamp placements",null,"triplets"))},getTripletStampPlaybackData(){return this.state.tripletStampPlacements?this.state.tripletStampPlacements.map(e=>{const t=this.state.fullRowData[e.row];return{startTimeIndex:e.startTimeIndex,tripletStampId:e.tripletStampId,row:e.row,pitch:(t==null?void 0:t.toneNote)??"",color:e.color,span:e.span,placement:e}}).filter(e=>e.pitch):[]},updateTripletStampShapeOffset(e,t,n){var r;const i=(r=this.state.tripletStampPlacements)==null?void 0:r.find(A=>A.id===e);if(!i){x.warn("TripletStampActions","[TRIPLET STAMP SHAPE OFFSET] Placement not found",{placementId:e},"triplets");return}i.shapeOffsets||(i.shapeOffsets={}),x.debug("TripletStampActions","[TRIPLET STAMP SHAPE OFFSET] Updating shape offset",{placementId:e,shapeKey:t,oldOffset:i.shapeOffsets[t]||0,newOffset:n,baseRow:i.row,targetRow:i.row+n},"triplets"),i.shapeOffsets[t]=n,this.emit("tripletStampPlacementsChanged")},getTripletStampShapeRow(e,t){var i;const n=((i=e.shapeOffsets)==null?void 0:i[t])||0;return e.row+n}};x.moduleLoaded("Store","general");const og="studentNotationState";function cT(){var e,t;try{const n=localStorage.getItem(og);if(n===null)return;const i=JSON.parse(n);if(i.timbres)for(const r in i.timbres){const A=i.timbres[r];if(A.coeffs&&typeof A.coeffs=="object"){const a=Array.isArray(A.coeffs)?A.coeffs:Object.values(A.coeffs);A.coeffs=new Float32Array(a)}if(A.phases&&typeof A.phases=="object"){const a=Array.isArray(A.phases)?A.phases:Object.values(A.phases);A.phases=new Float32Array(a)}}if(i.printOptions&&(i.printOptions={...qy.printOptions,...i.printOptions}),i.pitchRange){const r=(Fe==null?void 0:Fe.length)||((e=i.fullRowData)==null?void 0:e.length)||0,A=Math.max(0,r-1),a=Math.max(0,Math.min(A,i.pitchRange.topIndex??0)),l=Math.max(a,Math.min(A,i.pitchRange.bottomIndex??A));i.pitchRange={topIndex:a,bottomIndex:l}}if("playheadMode"in i){const r=i.playheadMode;r!=="cursor"&&r!=="microbeat"&&r!=="macrobeat"&&delete i.playheadMode}return(t=i.placedNotes)!=null&&t.length&&i.placedNotes.forEach(Dp),Fe&&Fe.length>0&&(i.fullRowData=[...Fe]),i}catch(n){x.error("Store","Could not load state from localStorage",n,"general");return}}function fa(e){var t;try{const n=JSON.parse(JSON.stringify({placedNotes:e.placedNotes,placedChords:e.placedChords,tonicSignGroups:e.tonicSignGroups,sixteenthStampPlacements:e.sixteenthStampPlacements,tripletStampPlacements:e.tripletStampPlacements,timbres:e.timbres,macrobeatGroupings:e.macrobeatGroupings,macrobeatBoundaryStyles:e.macrobeatBoundaryStyles,hasAnacrusis:e.hasAnacrusis,baseMicrobeatPx:e.baseMicrobeatPx,modulationMarkers:e.modulationMarkers,tempo:e.tempo,activeChordIntervals:e.activeChordIntervals,selectedNote:e.selectedNote,annotations:e.annotations,pitchRange:e.pitchRange,degreeDisplayMode:e.degreeDisplayMode,showOctaveLabels:e.showOctaveLabels,longNoteStyle:e.longNoteStyle,playheadMode:e.playheadMode}));if(e.timbres)for(const r in e.timbres){const A=e.timbres[r],a=(t=n.timbres)==null?void 0:t[r];A!=null&&A.coeffs&&a&&(a.coeffs=Array.from(A.coeffs)),A!=null&&A.phases&&a&&(a.phases=Array.from(A.phases))}const i=JSON.stringify(n);localStorage.setItem(og,i)}catch(n){x.error("Store","Could not save state to localStorage",n,"general")}}const Iv={...xE,...eT,...nT,...AT,...Lp,...oT,...Rp,...Hp,clearSavedState(){try{localStorage.removeItem(og),localStorage.removeItem("effectDialValues"),window.location.reload()}catch(e){x.error("Store","Could not clear state from localStorage",e,"general")}}},ja={},ag=cT(),uT=!ag,hT={...qy,...ag},d={state:hT,on(e,t){ja[e]||(ja[e]=[]),ja[e].push(t)},emit(e,t){ja[e]&&ja[e].forEach(n=>{try{n(t)}catch(i){x.error("Store",`Error in listener for event "${e}"`,i,"general")}})},_isBoundaryInAnacrusis:()=>!1,addNote:()=>null,updateNoteTail:()=>{},updateMultipleNoteTails:()=>{},updateNoteRow:()=>{},updateMultipleNoteRows:()=>{},updateNotePosition:()=>{},updateMultipleNotePositions:()=>{},removeNote:()=>{},removeMultipleNotes:()=>{},clearAllNotes:()=>{},loadNotes:()=>{},eraseInPitchArea:()=>!1,eraseTonicSignAt:()=>!1,addTonicSignGroup:()=>{},recordState:()=>{},undo:()=>{},redo:()=>{},clearSavedState:()=>{},setPlaybackState:()=>{},setLooping:()=>{},setADSR:()=>{},setHarmonicCoefficients:()=>{},setHarmonicPhases:()=>{},setAdsrTimeAxisScale:()=>{},setAdsrComponentWidth:()=>{},increaseMacrobeatCount:()=>{},decreaseMacrobeatCount:()=>{},updateTimeSignature:()=>{},setAnacrusis:()=>{},addModulationMarker:()=>null,removeModulationMarker:()=>{},moveModulationMarker:()=>{},setModulationRatio:()=>{},toggleModulationMarker:()=>{},clearModulationMarkers:()=>{},addSixteenthStampPlacement:()=>({}),removeSixteenthStampPlacement:()=>!1,eraseSixteenthStampsInArea:()=>!1,getAllSixteenthStampPlacements:()=>[],getSixteenthStampAt:()=>null,clearAllSixteenthStamps:()=>{},getSixteenthStampPlaybackData:()=>[],updateSixteenthStampShapeOffset:()=>{},getSixteenthStampShapeRow:()=>0,addTripletStampPlacement:()=>({}),removeTripletStampPlacement:()=>!1,eraseTripletStampsInArea:()=>!1,getAllTripletStampPlacements:()=>[],getTripletStampAt:()=>null,clearAllTripletStamps:()=>{},getTripletStampPlaybackData:()=>[],updateTripletStampShapeOffset:()=>{},getTripletStampShapeRow:()=>0,setSelectedTool:()=>{},setSelectedNote:()=>{},setTempo:()=>{},applyPreset:()=>{},setPitchRange:()=>{},setLayoutConfig:()=>{},setActiveChordIntervals:()=>{},setIntervalsInversion:()=>{},setChordPosition:()=>{},toggleAccidentalMode:()=>{},toggleFrequencyLabels:()=>{},toggleOctaveLabels:()=>{},toggleFocusColours:()=>{},setDegreeDisplayMode:()=>{},toggleWaveformExtendedView:()=>{},shiftGridUp:()=>{},shiftGridDown:()=>{},toggleMacrobeatGrouping:()=>{},cycleMacrobeatBoundaryStyle:()=>{},setFilterSettings:()=>{},setDeviceProfile:()=>{},setPrintPreviewActive:()=>{},setPrintOptions:()=>{},setLongNoteStyle:()=>{},setPlayheadMode:()=>{}};d.isColdStart=uT;for(const e in Iv)d[e]=Iv[e];d.on("tempoChanged",()=>{fa(d.state)});d.on("degreeDisplayModeChanged",()=>{fa(d.state)});d.on("longNoteStyleChanged",()=>{fa(d.state)});d.on("playheadModeChanged",()=>{fa(d.state)});const dT=d.recordState;d.recordState=function(){dT.call(this),fa(this.state)};ag||fa(d.state);class fT{constructor(){P(this,"cachedPixelMap",null);P(this,"lastPixelMapHash",null)}getColumnPixelPosition(t,n,i){const r=this.getOrBuildPixelMap(n,i),A=r.columnPositions.get(Math.floor(t));if(A)return A;const a=r.columnPositions.size;return t===a&&r.columnPositions.get(a-1)?{canvasIndex:t,xStart:r.totalPixelWidth,xEnd:r.totalPixelWidth,width:0,modulationScale:1}:this.calculateFallbackPosition(t,n)}columnToPixelX(t,n,i){const r=Math.floor(t),A=t-r,a=this.getColumnPixelPosition(r,n,i);return a.xStart+A*a.width}pixelXToColumn(t,n,i){const r=this.getOrBuildPixelMap(n,i),A=Array.from(r.columnPositions.values()).sort((c,h)=>c.canvasIndex-h.canvasIndex);for(const c of A)if(t>=c.xStart&&t<c.xEnd){const h=(t-c.xStart)/c.width;return c.canvasIndex+h}if(A.length===0)return 0;const a=A[0];if(!a||t<a.xStart)return 0;const l=A[A.length-1];return(l==null?void 0:l.canvasIndex)??0}invalidate(){this.cachedPixelMap=null,this.lastPixelMapHash=null}getOrBuildPixelMap(t,n){const i=this.buildPixelMapHash(t,n);return this.cachedPixelMap&&this.lastPixelMapHash===i?this.cachedPixelMap:(this.cachedPixelMap=this.buildPixelMap(t,n),this.lastPixelMapHash=i,this.cachedPixelMap)}buildPixelMapHash(t,n){const i=t.modulationMarkers?JSON.stringify(t.modulationMarkers.map(r=>({id:r.id,col:r.columnIndex,ratio:r.ratio}))):"none";return JSON.stringify({cellWidth:t.cellWidth,modulation:i,columnCount:n?xs.getColumnMap(n).totalCanvasColumns:0})}buildPixelMap(t,n){const{cellWidth:i,modulationMarkers:r}=t,A=xs.getColumnMap(n),a=new Map,l=t.baseMicrobeatPx??i,c=r&&r.length>0?rT(r,l,n):null;let h=0;for(const f of A.entries){if(f.canvasIndex===null)continue;const m=f.widthMultiplier*i,w=c?c.getScaleForColumn(f.canvasIndex):1,B=m*w;a.set(f.canvasIndex,{canvasIndex:f.canvasIndex,xStart:h,xEnd:h+B,width:B,modulationScale:w}),h+=B}return{columnPositions:a,totalPixelWidth:h}}calculateFallbackPosition(t,n){const{cellWidth:i}=n,r=i;return{canvasIndex:t,xStart:t*r,xEnd:(t+1)*r,width:r,modulationScale:1}}}const dA=new fT;function pT(e){e.on("rhythmStructureChanged",()=>{dA.invalidate()})}function mT(e,t){const n=t.state||t;return dA.columnToPixelX(e,t,n)}function g0(e){const t=e.state||e;return dA.getOrBuildPixelMap(e,t).totalPixelWidth}function gT(e){return z1(e)}function wT(e,t){return e.reduce((n,i)=>n+i,0)*t}const rn=9,vT=2,BT=5;function hs(e,t,n){return Number.isFinite(e)?Math.max(t,Math.min(n,Math.round(e))):t}function Mv(e,t,{maxStep:n=BT}={}){const i=Math.max(1,Math.round(t)),A=Math.max(1,Math.round(e))/i;let a=1;A>=.85?a=5:A>=.65?a=4:A>=.45?a=3:A>=.25?a=2:a=1;const l=Math.max(1,Math.round(n));return Math.max(1,Math.min(l,a))}function w0(e,t,n){const i=Math.max(0,n-1),r=Math.max(1,Math.round(t)),A=(r-1)/2;let a=Math.round(e-A),l=a+r-1;if(a<0&&(l+=-a,a=0),l>i){const c=l-i;a-=c,l=i}return a=hs(a,0,i),l=hs(l,a,i),{topIndex:a,bottomIndex:l}}function wi(e){return e.bottomIndex-e.topIndex+1}function v0(e,t){const n=Math.max(0,t-1),i=hs(e.topIndex??0,0,n),r=hs(e.bottomIndex??n,0,n);return r<i?{topIndex:r,bottomIndex:i}:{topIndex:i,bottomIndex:r}}function Zs(e,t,n=rn){const i=v0(e,t),r=Math.max(1,Math.round(n));if(wi(i)>=r)return i;const a=(i.topIndex+i.bottomIndex)/2;return w0(a,r,t)}function yT(e,t,n,i=rn){const r=Math.max(0,n-1),A=hs(e.bottomIndex,0,r),a=Math.max(1,Math.round(i)),l=Math.max(0,A-(a-1));return{topIndex:hs(t,0,l),bottomIndex:A}}function CT(e,t,n,i=rn){const r=Math.max(0,n-1),A=hs(e.topIndex,0,r),a=Math.max(1,Math.round(i)),l=Math.min(r,A+(a-1)),c=hs(t,l,r);return{topIndex:A,bottomIndex:c}}function bT(e,t,n,i=rn){const r=Math.max(0,n-1),A=hs(e,0,r),a=Math.max(1,Math.round(i)),l=Math.max(0,A-(a-1));return hs(t,0,l)}function _T(e,t,n,i=rn){const r=Math.max(0,n-1),A=hs(e,0,r),a=Math.max(1,Math.round(i)),l=Math.min(r,A+(a-1));return hs(t,l,r)}function ST(e,t,n){const i=Math.max(0,n-1),r=Math.max(1,wi(e)),A=Math.max(0,i+1-r),a=hs(e.topIndex+t,0,A),l=Math.min(i,a+r-1);return{topIndex:a,bottomIndex:l}}function Qv(e,t,{totalRanks:n,minSpan:i=rn,zoomStep:r=vT}){const A=Math.max(0,n-1),a=Math.max(1,Math.round(i)),l=Math.max(0,Math.round(r)),c=v0(e,n);if(l===0)return Zs(c,n,a);const h=wi(c);if(t==="in"){if(h<=a)return Zs(c,n,a);const y=Math.max(a,h-2*l),b=(c.topIndex+c.bottomIndex)/2;return w0(b,y,n)}const f=c.topIndex-l,m=c.bottomIndex+l,w=hs(f,0,A),B=hs(m,0,A);return Zs({topIndex:w,bottomIndex:B},n,a)}let Ro=1,Xo=0,FA,Oi,Np,wr,vr,fr,cl,Op,B0,y0,C0,b0,hi,MA,Vp,kf=null,Du=!1,El=!1,Lf=!1,Rf=!1,Wp=!1,Uv=0,zc=null,Yo=null,Gp=0,ku=null;const xT=new Promise(e=>{ku=()=>e()});let Hf=0,Nf=0;function _0(){const e=document.getElementById("pitch-grid-container"),t=Xo||window.innerHeight||0;return(e==null?void 0:e.clientHeight)||(t?t*.7:0)}function Pv(e,t){if(!e||e<=0||!t||t<=0)return 1;const n=Math.max(1,Math.round(t)+1);return 2*e/(n*yl)}function jo(){const e=d.state.fullRowData.length,t=Math.max(0,e-1),n=d.state.pitchRange||{topIndex:0,bottomIndex:t};return Zs(n,e,rn)}function Lu(){Yo!==null&&(cancelAnimationFrame(Yo),Yo=null),Gp+=1,El=!1}function Xc(e,t){const n=d.state.fullRowData.length,i=jo(),r=Zs(e,n,rn);if(r.topIndex===i.topIndex&&r.bottomIndex===i.bottomIndex)return;const A=i.topIndex,a=wi(i);d.setPitchRange(r),d.emit("scrollChanged");const l=r.topIndex-A;if(l!==0&&d.emit("scrollByUnits",l),wi(r)!==a){mr(),d.emit("zoomChanged");return}document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:t}}))}function Yc(e,t,n){Lu(),El=!0;const i=d.state.fullRowData.length,r=jo(),A=Zs(e,i,rn);if(A.topIndex===r.topIndex&&A.bottomIndex===r.bottomIndex){El=!1;return}const a=Gp,l=performance.now(),c=Math.max(0,Math.round(t));let h=r.topIndex;const f=w=>w<.5?4*w*w*w:1-Math.pow(-2*w+2,3)/2,m=()=>{if(a!==Gp)return;const w=performance.now(),B=c>0?(w-l)/c:1,y=Math.max(0,Math.min(1,B)),b=f(y),S=Math.round(r.topIndex+(A.topIndex-r.topIndex)*b),F=Math.round(r.bottomIndex+(A.bottomIndex-r.bottomIndex)*b),U=Zs({topIndex:S,bottomIndex:F},i,rn);d.setPitchRange(U),d.emit("scrollChanged");const D=U.topIndex-h;if(D!==0&&(d.emit("scrollByUnits",D),h=U.topIndex),mr(),d.emit("zoomChanged"),y<1){Yo=requestAnimationFrame(m);return}Yo=null,El=!1};Yo=requestAnimationFrame(m)}function ET(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let TT=!1;function S0(e,t){var n;if(ET())try{const i=((n=performance==null?void 0:performance.now)==null?void 0:n.call(performance))??Date.now();if(i-Uv<500)return;Uv=i,TT=!0}catch{}}function FT(){const e=(window==null?void 0:window.devicePixelRatio)??1;return!Number.isFinite(e)||e<=0?1:e}function _A(e,t,n,i,r){if(!e)return!1;const A=Number.isFinite(i)&&i>0?i:1;e.dataset.pixelRatio=`${A}`;let a=!1;if(typeof t=="number"){const l=Math.max(1,Math.round(t*A));Math.abs(e.width-l)>.5&&(e.width=l,a=!0),e.style.width=`${t}px`,e.dataset.logicalWidth=`${t}`}if(typeof n=="number"){const l=Math.max(1,Math.round(n*A));Math.abs(e.height-l)>.5&&(e.height=l,a=!0),e.style.height=`${n}px`,e.dataset.logicalHeight=`${n}`}if(a){const l=r||e.getContext("2d");l&&l.setTransform(A,0,0,A,0,0)}return a}function IT(){FA=document.getElementById("pitch-grid-wrapper"),Oi=document.getElementById("notation-grid"),wr=document.getElementById("legend-left-canvas"),vr=document.getElementById("legend-right-canvas"),fr=document.getElementById("drum-grid-wrapper"),cl=document.getElementById("drum-grid"),B0=document.getElementById("drum-playhead-canvas"),y0=document.getElementById("playhead-canvas"),C0=document.getElementById("hover-canvas"),b0=document.getElementById("drum-hover-canvas"),hi=document.getElementById("button-grid"),MA=document.getElementById("grid-scrollbar-proxy"),Vp=(MA==null?void 0:MA.querySelector(".grid-scrollbar-inner"))||null;const e=document.getElementById("canvas-container");if(!FA||!Oi||!e)return{};Np=Oi.getContext("2d"),Op=(cl==null?void 0:cl.getContext("2d"))||null;const t=(wr==null?void 0:wr.getContext("2d"))||null,n=(vr==null?void 0:vr.getContext("2d"))||null;return{ctx:Np,drumCtx:Op,legendLeftCtx:t,legendRightCtx:n,canvasContainer:e}}function MT(){var n;if(Wp)return;const e=(((n=d.state.columnWidths)==null?void 0:n.length)||0)>0,t=!!(d.state.cellWidth&&d.state.cellWidth>0);!e||!t||(Wp=!0,ku==null||ku())}function mr(){var Vt,Nt;if(!FA||FA.clientHeight===0){Lf||(x.warn("LayoutService","Pitch grid wrapper not ready for layout (height=0). Retrying on next frame.",null,"layout"),Lf=!0),requestAnimationFrame(mr);return}if(Lf=!1,Du)return;Du=!0;const e=document.getElementById("pitch-grid-container");FA.clientWidth;const t=window.innerHeight;(Math.abs(t-Xo)>3||Xo===0)&&(Xo=t);const i=yl,r=i*lE,A=jo(),a=_0(),l=Math.max(1,wi(A));Ro=Pv(a,l);const c=Math.round(i*Ro),h=Math.round(r*Ro);d.setLayoutConfig({cellHeight:c,cellWidth:h});const f=gT(d.state);d.setLayoutConfig({columnWidths:f}),MT(),(!d.state.cellWidth||!f.length)&&x.warn("LayoutService","Unexpected layout configuration",{cellWidth:d.state.cellWidth,columnCount:f.length},"layout");const w=f.reduce((Dt,Et)=>Dt+Et,0)*d.state.cellWidth,B=fn.getModulatedCanvasWidth(),y=d.state.modulationMarkers&&d.state.modulationMarkers.length>0,b=y?B:w,S=gi*2*d.state.cellWidth,F=gi*2*d.state.cellWidth,U=Math.round(b+S+F),D=FT();document.getElementById("drum-grid-wrapper");const H=document.getElementById("grids-wrapper"),Q=U+"px";if(e&&(e.style.width=Q),FA&&(FA.style.width=Q),fr&&(fr.style.width=Q),Vp&&MA){Vp.style.width=Q;const Dt=(H==null?void 0:H.getBoundingClientRect().width)||0;U>Dt?MA.style.display="":MA.style.display="none"}const R=Math.max(Wl,Gl*d.state.cellHeight),V=lv*R,O=`${V}px`,K=((Vt=d.state.columnWidths)==null?void 0:Vt.length)??0;let z=0;if(y){const Dt={cellWidth:d.state.cellWidth,columnWidths:d.state.columnWidths,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.cellWidth,cellHeight:d.state.cellHeight,state:d.state};z=g0(Dt)}else for(let Dt=0;Dt<K;Dt++)z+=(d.state.columnWidths[Dt]||0)*d.state.cellWidth;if(K===0&&x.warn("LayoutService","Column widths array is empty.",{columnWidthsCount:K,columnWidths:d.state.columnWidths},"layout"),z<50&&K>0&&x.warn("LayoutService","Computed button-grid middle cell width is unexpectedly small.",{middleCellWidth:z,columnWidthsSample:(Nt=d.state.columnWidths)==null?void 0:Nt.slice(0,10),cellWidth:d.state.cellWidth,macrobeatGroupings:d.state.macrobeatGroupings},"layout"),hi){const Dt=hi.querySelector(".button-grid-left-cell"),Et=hi.querySelector(".button-grid-middle-cell"),Ft=hi.querySelector(".button-grid-right-cell"),jt=gi*2*d.state.cellWidth,rt=gi*2*d.state.cellWidth;(Math.abs(Nf-V)>5||Nf===0)&&(hi.style.height=O,Nf=V);const Z=(Bt,Ht)=>{if(!Bt)return;const oe=`${Math.max(0,Ht)}px`;Bt.style.width=oe,Bt.style.flex=`0 0 ${oe}`,Bt.style.maxWidth=oe,Bt.style.minWidth=oe,Bt.style.height=O};if(Dt){Z(Dt,jt);const Bt=Dt.getBoundingClientRect();jt>0&&Bt.width===0&&x.warn("LayoutService","Left button-grid cell measured width is 0 after assignment.",{assignedWidth:jt,measuredWidth:Bt.width,computedDisplay:window.getComputedStyle(Dt).display},"layout")}if(Et){z===0&&x.warn("LayoutService","Calculated middle button-grid width is 0. Check column width data.",{columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth},"layout"),Z(Et,z);const Bt=Et.getBoundingClientRect();if(z>0&&Bt.width===0&&x.warn("LayoutService","Middle button-grid cell assigned width but still measures 0.",{assignedWidth:z,measuredWidth:Bt.width,computedStyles:window.getComputedStyle(Et)},"layout"),Math.abs(Bt.width-z)>5&&(x.warn("LayoutService","Middle cell measured width does not match assigned width.",{assignedWidth:z,measuredWidth:Bt.width,styleWidth:Et.style.width,cellWidth:d.state.cellWidth},"layout"),requestAnimationFrame(()=>{const Ht=Et.getBoundingClientRect();Math.abs(Ht.width-z)>5&&x.warn("LayoutService","Middle cell still mismatched after RAF.",{assignedWidth:z,measuredWidth:Ht.width,delta:Ht.width-z,computedStyles:window.getComputedStyle(Et)},"layout")})),!Rf){const Ht=Et.querySelector("#beat-line-button-layer");if(Ht){const oe=Ht.getBoundingClientRect();if(oe.width===0){const Xt=window.getComputedStyle(Ht);x.warn("LayoutService","#beat-line-button-layer width is 0 despite middle cell sizing.",{beatLineRect:oe,beatLineStyles:{display:Xt.display,position:Xt.position,flex:{direction:Xt.flexDirection,grow:Xt.flexGrow,shrink:Xt.flexShrink,basis:Xt.flexBasis},width:Xt.width,minWidth:Xt.minWidth,maxWidth:Xt.maxWidth},middleRect:Bt,middleCellComputedWidth:Xt.width},"layout"),Rf=!0}}else x.warn("LayoutService","Could not find #beat-line-button-layer inside middle cell to measure.",null,"layout"),Rf=!0}}if(Ft){Z(Ft,rt);const Bt=Ft.getBoundingClientRect();rt>0&&Bt.width===0&&x.warn("LayoutService","Right button-grid cell measured width is 0 after assignment.",{assignedWidth:rt,measuredWidth:Bt.width,computedDisplay:window.getComputedStyle(Ft).display},"layout")}const mt=jt+z+rt;Number.isFinite(mt)&&mt>0&&(hi.style.width=Q,hi.style.maxWidth=Q,hi.style.minWidth=Q),hi.getBoundingClientRect().width===0&&x.warn("LayoutService","Entire button grid wrapper width is 0 after layout pass.",{leftCellWidth:jt,middleCellWidth:z,rightCellWidth:rt,wrapperStyles:window.getComputedStyle(hi)},"layout")}const gt=Math.max(Wl,Gl*d.state.cellHeight),St=lv*gt,wt=`${St}px`,Ct=(e==null?void 0:e.clientHeight)||0;if(Ct>0){const Dt=Math.max(1,wi(A)),Et=Pv(Ct,Dt),Ft=Math.round(i*Et),jt=Math.round(r*Et);d.setLayoutConfig({cellHeight:Ft,cellWidth:jt}),Ro=Et}const Mt=Math.round(gi*2*d.state.cellWidth),Tt=Math.round(gi*2*d.state.cellWidth),J=Math.round(b),st=[{element:Oi,context:Np},{element:y0},{element:C0}];if(st.forEach(({element:Dt,context:Et})=>{_A(Dt,J,Ct,D,Et),Dt&&(Dt.style.left=`${Mt}px`)}),_A(wr,Mt,Ct,D,null),_A(vr,Tt,Ct,D,null),[{element:cl,context:Op},{element:B0},{element:b0}].forEach(({element:Dt,context:Et})=>{_A(Dt,J,St,D,Et)}),fr){const Dt=fr.querySelector(".drum-grid-left-cell"),Et=fr.querySelector(".drum-grid-middle-cell"),Ft=fr.querySelector(".drum-grid-right-cell"),jt=(pt,it)=>{if(!pt)return;const Z=`${Math.max(0,Math.round(it))}px`;pt.style.width=Z,pt.style.flex=`0 0 ${Z}`,pt.style.maxWidth=Z,pt.style.minWidth=Z,pt.style.height=wt};jt(Dt,Mt),jt(Et,J),jt(Ft,Tt);const rt=Et==null?void 0:Et.querySelector("#drum-canvas-wrapper");rt&&(rt.style.width="100%",rt.style.height=wt)}const ut=Math.abs(Hf-St)>5||Hf===0;fr&&ut&&(fr.style.height=wt,Hf=St);const Lt=D,$t=J;zc&&clearTimeout(zc),zc=setTimeout(()=>{var Ft,jt,rt;zc=null;const Dt=document.getElementById("pitch-grid-container"),Et=(Dt==null?void 0:Dt.clientHeight)||0;st.forEach(({element:pt,context:it})=>{_A(pt,$t,Et,Lt,it),pt&&(pt.style.left=`${Mt}px`)}),_A(wr,Mt,Et,Lt,null),_A(vr,Tt,Et,Lt,null),S0("deferredResize",{finalContainerHeight:Et,pitchCanvasLogicalHeight:(Ft=Oi==null?void 0:Oi.dataset)==null?void 0:Ft.logicalHeight,legendLeftLogicalHeight:(jt=wr==null?void 0:wr.dataset)==null?void 0:jt.logicalHeight,legendRightLogicalHeight:(rt=vr==null?void 0:vr.dataset)==null?void 0:rt.logicalHeight}),document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:"layoutService-deferred"}}))});try{const Dt=d.state.fullRowData.length,Et=Math.max(0,Dt-1),Ft=d.state.pitchRange||{topIndex:0,bottomIndex:Et},jt=Zs(Ft,Dt,rn);(Ft.topIndex!==jt.topIndex||Ft.bottomIndex!==jt.bottomIndex)&&d.setPitchRange(jt)}catch{}d.emit("layoutConfigChanged"),Du=!1}const fn={init(){const{ctx:e,drumCtx:t,legendLeftCtx:n,legendRightCtx:i}=IT();requestAnimationFrame(mr),this.initScrollHandler();const r=()=>{Du||(kf!==null&&clearTimeout(kf),kf=setTimeout(()=>{mr()},aE))};return window.addEventListener("resize",r),d.on("zoomIn",A=>{this.zoomIn(A)}),d.on("zoomOut",A=>{this.zoomOut(A)}),{ctx:e,drumCtx:t,legendLeftCtx:n,legendRightCtx:i}},waitForInitialLayout(){return Wp?Promise.resolve():xT},getCurrentZoomLevel(){return Ro},setZoomLevel(e){const t=Number.isFinite(e)&&e>0?e:1,n=_0(),i=d.state.fullRowData.length,r=Math.max(0,i-1);if(!i||i<=0)return;const A=2*n/(t*yl),a=Math.max(rn,Math.min(i,Math.round(A)-1)),l=jo(),c=(l.topIndex+l.bottomIndex)/2,h=(a-1)/2;let f=Math.round(c-h),m=f+a-1;if(f<0&&(m+=-f,f=0),m>r){const w=m-r;f-=w,m=r}Xc({topIndex:f,bottomIndex:m},"setZoomLevel")},setPitchViewportRange(e,t={}){const n=t.source??"setPitchViewportRange",i=Math.max(0,Math.round(t.animateMs??0));if(i>0){Yc(e,i);return}Xc(e,n)},_canScrollRange(e){const t=d.state.pitchRange;if(!t||!Fe||Fe.length===0)return!1;const n=Fe.length-1,i=typeof e=="string"?e==="up"?-1:1:e,r=i<0&&t.topIndex>0,A=i>0&&t.bottomIndex<n;return r||A},initScrollHandler(){const e=document.getElementById("pitch-grid-wrapper");e&&e.addEventListener("wheel",t=>{if(t.preventDefault(),t.ctrlKey||t.metaKey)t.deltaY<0?this.zoomIn({source:"wheel"}):this.zoomOut({source:"wheel"});else{const n=t.deltaY>0?1:-1;this._canScrollRange(n)&&this.scrollByUnits(n)}},{passive:!1})},zoomIn(e){const t=d.state.fullRowData.length;if(!t)return;const n=jo(),i=wi(n),r=Mv(i,t),A=Qv(n,"in",{totalRanks:t,minSpan:rn,zoomStep:r}),a=wi(A),l=(e==null?void 0:e.source)??"unknown",c=l==="wheel"?0:280;x.debug("LayoutService",`[Zoom] Range zoom in (span ${i} -> ${a})`,{source:l},"layout"),c>0?Yc(A,c):(Xc(A,`zoomIn:${l}`),d.emit("zoomChanged"))},zoomOut(e){const t=d.state.fullRowData.length;if(!t)return;const n=jo(),i=wi(n),r=Mv(i,t),A=Qv(n,"out",{totalRanks:t,minSpan:rn,zoomStep:r}),a=wi(A),l=(e==null?void 0:e.source)??"unknown",c=l==="wheel"?0:280;x.debug("LayoutService",`[Zoom] Range zoom out (span ${i} -> ${a})`,{source:l},"layout"),c>0?Yc(A,c):(Xc(A,`zoomOut:${l}`),d.emit("zoomChanged"))},resetZoom(e){const t=d.state.fullRowData.length;if(!t)return;const n=Math.max(0,t-1);e==null||e.source,Yc({topIndex:0,bottomIndex:n},320)},scroll(e){const n=this.getViewportInfo().startRank;d.emit("scrollChanged");const A=this.getViewportInfo().startRank-n;A!==0&&d.emit("scrollByUnits",A),d.emit("layoutConfigChanged")},scrollByUnits(e){Lu();const t=d.state.pitchRange;if(!t||!Fe||Fe.length===0)return;const n=Math.sign(e||0);if(n===0)return;const i=Fe.length,r=Zs(t,i,rn),A=ST(r,n,i);A.topIndex===r.topIndex&&A.bottomIndex===r.bottomIndex||(d.setPitchRange(A),d.emit("scrollChanged"),d.emit("scrollByUnits",n),document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:"viewportScroll"}})))},setViewportTopIndex(e){Lu();const t=d.state.pitchRange||{topIndex:0,bottomIndex:Math.max(0,d.state.fullRowData.length-1)},n=d.state.fullRowData.length,i=Zs(t,n,rn),r=yT(i,e,n,rn),A=r.topIndex-(i.topIndex??0);r.topIndex===i.topIndex&&r.bottomIndex===i.bottomIndex||(d.setPitchRange(r),d.emit("scrollChanged"),A!==0&&d.emit("scrollByUnits",A),mr(),d.emit("zoomChanged"))},setViewportBottomIndex(e){Lu();const t=d.state.pitchRange||{topIndex:0,bottomIndex:Math.max(0,d.state.fullRowData.length-1)},n=d.state.fullRowData.length,i=Zs(t,n,rn),r=CT(i,e,n,rn),A=r.topIndex-(i.topIndex??0);r.topIndex===i.topIndex&&r.bottomIndex===i.bottomIndex||(d.setPitchRange(r),d.emit("scrollChanged"),A!==0&&d.emit("scrollByUnits",A),mr(),d.emit("zoomChanged"))},scrollByPixels(e,t=0){const i=this.getViewportInfo().startRank;d.state.fullRowData.length,d.state.cellHeight,d.emit("scrollChanged");const a=this.getViewportInfo().startRank-i;a!==0&&d.emit("scrollByUnits",a),d.emit("layoutConfigChanged")},getViewportInfo(){var H,Q,R,V,O,K;const e=d.state.fullRowData.length,t=Math.max(0,e-1),n=document.getElementById("pitch-grid-container"),i=(n==null?void 0:n.clientHeight)||Xo*.7,r=d.state.cellHeight||yl,A=r/2,a=Zs(d.state.pitchRange||{topIndex:0,bottomIndex:t},e,rn),l=Math.max(0,Math.min(t,a.topIndex??0)),c=Math.max(l,Math.min(t,a.bottomIndex??t)),h=Math.min(e,c+1),f=l*A,m=document.getElementById("legend-left-canvas"),w=document.getElementById("legend-right-canvas"),B=A?i/A:0,y=Math.max(1,c-l+1),b=y*A,S=d.state.fullRowData[l],F=d.state.fullRowData[c],U=l<=0,D=c>=t;return S0("getViewportInfo",{containerHeight:i,containerRectHeight:(H=n==null?void 0:n.getBoundingClientRect)==null?void 0:H.call(n).height,cellHeight:r,halfUnit:A,ratio:B,rowCount:y,coveragePx:b,coverageGapPx:i-b,totalRanks:e,pitchRange:a,startRank:l,endRank:h,atTopGamutEdge:U,atBottomGamutEdge:D,scrollOffset:f,startRowSummary:S?{pitch:S.pitch,column:S.column,isBoundary:!!S.isBoundary}:null,endRowSummary:F?{pitch:F.pitch,column:F.column,isBoundary:!!F.isBoundary}:null,pitchCanvasLogicalHeight:(Q=Oi==null?void 0:Oi.dataset)==null?void 0:Q.logicalHeight,legendLeftLogicalHeight:(R=m==null?void 0:m.dataset)==null?void 0:R.logicalHeight,legendRightLogicalHeight:(V=w==null?void 0:w.dataset)==null?void 0:V.logicalHeight,legendLeftCssHeight:(O=m==null?void 0:m.getBoundingClientRect)==null?void 0:O.call(m).height,legendRightCssHeight:(K=w==null?void 0:w.getBoundingClientRect)==null?void 0:K.call(w).height}),{zoomLevel:Ro,viewportHeight:Xo,containerHeight:i,cellHeight:r,halfUnit:A,startRank:l,endRank:h,scrollOffset:f}},getMacrobeatWidthPx(e,t){return t*e.cellWidth},getColumnX(e){const t=d.state.cellWidth||40,n=d.state.columnWidths||[];return mT(e,{cellWidth:t,columnWidths:n,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:t,state:d.state})},getCanvasWidth(){return wT(d.state.columnWidths,d.state.cellWidth)},getModulatedCanvasWidth(){const e=this.getCanvasWidth();if(!d.state.modulationMarkers||d.state.modulationMarkers.length===0)return e;try{const t=d.state.cellWidth||40,n=d.state.columnWidths||[],i={cellWidth:t,columnWidths:n,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:t,cellHeight:d.state.cellHeight||40,state:d.state};return g0(i)}catch{return e}},recalculateLayout(){mr()},reflow(){mr()},get isZooming(){return El}};let Of=null,Vf=null,Wf=null,Gf=null;const Yl={setContexts({ctx:e,drumCtx:t,legendLeftCtx:n,legendRightCtx:i}){Of=e??null,Vf=t??null,Wf=n??null,Gf=i??null},getPitchContext(){return Of||x.error("CanvasContextService","Pitch context requested before it was set.",null,"canvas"),Of},getDrumContext(){return Vf||x.error("CanvasContextService","Drum context requested before it was set.",null,"canvas"),Vf},getLegendLeftContext(){return Wf||x.error("CanvasContextService","Legend left context requested before it was set.",null,"canvas"),Wf},getLegendRightContext(){return Gf||x.error("CanvasContextService","Legend right context requested before it was set.",null,"canvas"),Gf}},cs={getViewportInfo:()=>fn.getViewportInfo(),setViewportTopIndex(e){var t;(t=fn.setViewportTopIndex)==null||t.call(fn,e)},setViewportBottomIndex(e){var t;(t=fn.setViewportBottomIndex)==null||t.call(fn,e)},setPitchViewportRange(e,t={}){var n;(n=fn.setPitchViewportRange)==null||n.call(fn,e,t)}};let Jo=null,Zo=null;d.on("modulationMarkersChanged",()=>{});d.on("scrollChanged",()=>{Jo=null,Zo=null});d.on("zoomChanged",()=>{Jo=null,Zo=null});d.on("pitchRangeChanged",()=>{Jo=null,Zo=null});function lg(){const e=performance.now();return(!Jo||!Zo||e-Zo>1)&&(Jo=cs.getViewportInfo(),Zo=e),Jo}function It(e,t){const n=d.state,i={cellWidth:t.cellWidth,modulationMarkers:t.modulationMarkers,baseMicrobeatPx:t.baseMicrobeatPx,columnWidths:t.columnWidths,state:n};return dA.columnToPixelX(e,i,n)}function ie(e,t){const n=lg(),i=e-n.startRank,r=t.cellHeight/2;return(i+1)*r}function QT(e){let t=(e||"").replace(/\d/g,"").trim();return t=t.replace(/b/g,"b-").replace(/#/g,"b_"),t}function UT(e){switch(e){case"C":return{lineWidth:3.33,dash:[],color:"#adb5bd"};case"E":return{lineWidth:1,dash:[5,5],color:"#adb5bd"};case"G":return{lineWidth:1,dash:[],color:"#dee2e6"};case"B":case"A":case"F":case"Eb/Db":case"Db/C#":return{lineWidth:1,dash:[],color:"#ced4da"};default:return{lineWidth:1,dash:[],color:"#ced4da"}}}function PT(){const e=lg(),{startRank:t,endRank:n}=e,i=Math.max(t,n-1);return{startRow:t,endRow:i}}function Kp(e,t){const n=d.state,i={cellWidth:t.cellWidth,modulationMarkers:t.modulationMarkers,baseMicrobeatPx:t.baseMicrobeatPx,columnWidths:t.columnWidths,state:n};return dA.pixelXToColumn(e,i,n)}function DT(e,t){const n=lg(),i=t.cellHeight/2;return e/i-1+n.startRank}function Vn(e){var i;if(!e)return 0;const t=(i=e.dataset)==null?void 0:i.logicalWidth,n=t!==void 0?Number(t):NaN;return Number.isFinite(n)?n:e.width||0}function tn(e){var i;if(!e)return 0;const t=(i=e.dataset)==null?void 0:i.logicalHeight,n=t!==void 0?Number(t):NaN;return Number.isFinite(n)?n:e.height||0}const Kf={stroke:"#c7cfd8",background:"rgba(207, 214, 222, 0.32)"};let jc=null;function x0(){if(jc)return jc;if(typeof window>"u")return Kf;const e=window.getComputedStyle(document.documentElement);return jc={stroke:e.getPropertyValue("--c-anacrusis-border").trim()||Kf.stroke,background:e.getPropertyValue("--c-anacrusis-bg").trim()||Kf.background},jc}function kT(e){if(e.length===0)return[];const t=[...e].sort((i,r)=>i.start-r.start),n=[];for(const i of t){if(n.length===0){n.push({...i});continue}const r=n[n.length-1];i.start<=r.end?r.end=Math.max(r.end,i.end):n.push({...i})}return n}function LT(e){const t=[],n=HT();return n!==null&&n>0&&t.push({start:It(0,e),end:It(n,e)}),In(d.state).forEach(r=>{const A=It(r.columnIndex,e),a=It(r.columnIndex+2,e);t.push({start:A,end:a})}),kT(t)}function RT(e,t,n){const i=new Set([e,t]);n.forEach(a=>{const l=Math.max(e,Math.min(t,a.start)),c=Math.max(e,Math.min(t,a.end));c>l&&(i.add(l),i.add(c))});const r=Array.from(i).sort((a,l)=>a-l),A=[];for(let a=0;a<r.length-1;a++){const l=r[a],c=r[a+1],h=(l+c)/2,f=n.some(m=>h>=m.start&&h<m.end);c>l&&A.push({from:l,to:c,light:f})}return A}function HT(){const e=d.state;if(!(e!=null&&e.hasAnacrusis)||!Array.isArray(e.macrobeatBoundaryStyles))return null;const t=e.macrobeatBoundaryStyles.findIndex(i=>i==="solid");if(t<0)return null;const n=Tn(e,t);return n?n.endColumn+1:null}function NT(e,t,n,i){const r=LT(t),{stroke:A}=x0();for(let a=n;a<=i;a++){const l=t.fullRowData[a];if(!l||l.isBoundary)continue;const c=ie(a,t);if(c<-10||c>t.viewportHeight+10)continue;const h=QT(l.pitch);if(["B","A","F","E/D","D/C"].includes(h))continue;const m=UT(h),w=t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:t.columnWidths||[],B=It(0,t),y=It(w.length,t),b=RT(B,y,r);h==="G"?b.forEach(S=>{const F=S.to-S.from;F<=0||(e.save(),e.fillStyle=S.light?A:m.color,e.globalAlpha=S.light?.5:1,e.fillRect(S.from,c-t.cellHeight/2,F,t.cellHeight),e.restore())}):b.forEach(S=>{S.to-S.from<=0||(e.beginPath(),e.moveTo(S.from,c),e.lineTo(S.to,c),e.lineWidth=m.lineWidth,e.strokeStyle=S.light?A:m.color,e.setLineDash(m.dash),e.globalAlpha=S.light?.6:1,e.stroke(),e.setLineDash([]),e.globalAlpha=1)})}}function OT(e,t,n,i){NT(e,t,n,i)}function VT(e,t){WT(e,t)}function WT(e,t){const{columnWidths:n,macrobeatGroupings:i,macrobeatBoundaryStyles:r,placedTonicSigns:A}=t,l=(t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:n).length,c=i.map((h,f)=>{const{endColumn:m}=Tn(d.state,f);return m+1});for(let h=0;h<=l;h++){const f=h===0||h===l,m=f0(h,A),w=A.some(F=>h===F.columnIndex+2),B=c.includes(h);if(!p0(h,A))continue;let b=null;if(f||m||w)b={lineWidth:2,strokeStyle:"#adb5bd",dash:[]};else if(B){const F=c.indexOf(h),U=r[F]??"dashed";if(U==="anacrusis"){const{stroke:D}=x0();b={lineWidth:1,strokeStyle:D,dash:[4,4]}}else b={lineWidth:1,strokeStyle:"#adb5bd",dash:U==="solid"?[]:[5,5]}}if(!b)continue;const S=It(h,t);e.beginPath(),e.moveTo(S,0),e.lineTo(S,tn(e.canvas)),e.lineWidth=b.lineWidth,e.strokeStyle=b.strokeStyle,e.setLineDash(b.dash),e.stroke()}e.setLineDash([])}let Dv=0;function E0(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let GT=!1;function KT(e,t){var n;if(E0())try{const i=((n=performance==null?void 0:performance.now)==null?void 0:n.call(performance))??Date.now();if(i-Dv<500)return;Dv=i,GT=!0}catch{}}const kv=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"];function qT(e){const t=e.replace(/\d+$/,"");return t.length>0?t:e}function $T(e,t){const n=t[e];if(!n)return null;const r=n.pitch.replace(/\d+$/,"");return(r.includes("/")?r.split("/")[0]??r:r).replace(//g,"b").replace(//g,"#")}function zT(e,t){if(!e||!t)return[];const n=t-1;if(n<0||n>=kv.length)return x.warn("LegendRenderer",`Invalid tonic number: ${t}`,null,"grid"),[];const i=kv[n];try{const r=`${e} ${i}`;return O1(r).notes||[]}catch(r){return x.warn("LegendRenderer",`Could not generate ${i} scale`,{tonic:e,error:r},"grid"),[]}}function nh(e){return e?e.replace(/\d+$/,"").replace(/T-/g,"b").replace(/T_/g,"#").replace(/-/g,"b").replace(/_/g,"#").replace(//g,"b").replace(//g,"#"):""}function XT(e){const t=new Set;return e.forEach(n=>{const i=nh(n);if(i){t.add(i);try{const r=nh(Sl(i));r&&t.add(r)}catch{}}}),t}function Lv(e,t){if(!t.size)return!0;const n=nh(e.toneNote||e.pitch);if(!n)return!1;if(t.has(n))return!0;try{const i=nh(Sl(n));if(i&&t.has(i))return!0}catch{}return n.includes("/")?n.split("/").some(i=>t.has(i)):!1}function YT(e,t,n,i,r){const{fullRowData:A,columnWidths:a,cellWidth:l,cellHeight:c,colorMode:h}=n,f=h??"color",{sharp:m,flat:w}=d.state.accidentalMode,{focusColours:B,showFrequencyLabels:y}=d.state,b=n.showOctaveLabels??!0,S=O=>b?O:qT(O),F=(O,K)=>{var $t;if(!E0())return;const z=c/2,gt=tn(O.canvas),St=ie(r,n),wt=St+z,Ct=(($t=document.getElementById("pitch-grid-container"))==null?void 0:$t.clientHeight)??null,Mt=A.length,Tt=i<=0,J=r>=Mt-1,st=Vt=>{if(Vt===null)return null;const Nt=A[Vt];return Nt?{rowIndex:Vt,pitch:Nt.pitch,column:Nt.column,isBoundary:!!Nt.isBoundary}:{rowIndex:Vt,exists:!1}},ot=Vt=>{let Nt=null,Dt=null;for(let Et=i;Et<=r;Et++){const Ft=A[Et];!Ft||Ft.isDummy||Ft.column===Vt&&(Nt===null&&(Nt=Et),Dt=Et)}return{first:Nt,last:Dt}},vt=ot("A"),ut=ot("B"),Lt=Vt=>{if(Vt===null)return null;const Nt=ie(Vt,n);return{rowIndex:Vt,y:Nt,topEdge:Nt-z,bottomEdge:Nt+z,gapCanvasMinusBottomEdge:gt-(Nt+z)}};KT("legendCoverage",{side:K,startRow:i,endRow:r,atTopGamutEdge:Tt,atBottomGamutEdge:J,cellHeight:c,halfUnit:z,yEnd:St,bottomEdge:wt,canvasHeight:gt,gapCanvasMinusBottomEdge:gt-wt,containerHeight:Ct,gapCanvasMinusContainer:typeof Ct=="number"?gt-Ct:null,startRowSummary:st(i),endRowSummary:st(r),firstLastA:{...vt,firstSummary:st(vt.first),lastSummary:st(vt.last)},firstLastB:{...ut,firstSummary:st(ut.first),lastSummary:st(ut.last)},aLastCoverage:Lt(vt.last),bLastCoverage:Lt(ut.last)})};let U=[],D=new Set;if(B){const O=In(d.state),K=new Set;O.length||x.info("LegendRenderer","Focus Colours ON but no tonic placements found",null,"grid"),O.forEach(z=>{const gt=$T(z.row,A),St=zT(gt,z.tonicNumber);x.debug("LegendRenderer","Focus Colours tonic scale",{tonicNote:gt,tonicNumber:z.tonicNumber,scaleNotes:St},"grid"),St.forEach(wt=>K.add(wt))}),U=Array.from(K),x.debug("LegendRenderer","Focus Colours combined scale",{focusScale:U},"grid"),D=XT(U)}const H=(O,K=[],z=null)=>{if(y){const Mt=B&&D.size>0,Tt=z?Lv(z,D):!1;return Mt&&z&&!Tt?null:z&&z.frequency?String(z.frequency):O}if(!z){if(!O.includes("/"))return S(O);const Mt=O.slice(-1),Tt=O.substring(0,O.length-1),[J,st]=Tt.split("/");return S(m&&w?`${J}/${st}${Mt}`:m?`${st}${Mt}`:w?`${J}${Mt}`:`${st}${Mt}`)}const{flatName:gt,sharpName:St,isAccidental:wt}=z;if(!wt)return S(gt);let Ct;return m&&w?Ct=z.pitch:m&&!w?Ct=St:w&&!m?Ct=gt:Ct=St,S(Ct)},Q=()=>!m&&!w,R=O=>{O.clearRect(0,0,Vn(O.canvas),tn(O.canvas))};function V(O,K,z,gt){const St=gi*2*l,wt=[St/2,St/2];let Ct=0,Mt=0,Tt=0;z.forEach((J,st)=>{const ot=wt[st]??0;for(let vt=i;vt<=r;vt++){const ut=A[vt];if(!(!ut||ut.isDummy)&&ut.column===J){const Lt=ie(vt,n),$t=ut.isAccidental??ut.pitch.includes("/"),Vt=!y&&$t&&Q(),Nt=Lv(ut,D),Dt=H(ut.pitch,gt,ut);if(Dt===null)continue;const Et=!!ut.isBoundary;let Ft=f==="bw"?"#ffffff":ut.hex||"#ffffff";B&&!Nt&&!y&&(Ft="#ffffff");const jt=Vt||Et?"00":B&&!Nt?"55":"FF";B&&D.size>0&&(Tt+=1,Nt||(Mt+=1)),O.fillStyle=Vt?"rgba(255,255,255,0)":Ft,O.fillRect(Ct,Lt-c/2,ot,c);const rt=Dt.length<=3,pt=Math.max(10,Math.min(l*1.2,c*1.2)),it=rt?pt:pt*.7;O.font=`bold ${it}px 'Atkinson Hyperlegible', sans-serif`,O.textAlign="center",O.textBaseline="middle";const Z=Ct+ot/2,mt=Lt;O.strokeStyle=`#212529${jt}`,O.lineWidth=2.5,O.lineJoin="round",O.strokeText(Dt,Z,mt),O.fillStyle=`#ffffff${jt}`,O.fillText(Dt,Z,mt)}}Ct+=ot}),B&&D.size>0&&x.debug("LegendRenderer","Focus filter summary (separate)",{side:K===0?"left":"right",startCol:K,relevantScale:gt,totalLabels:Tt,filteredLabels:Mt},"grid")}e&&(R(e),F(e,"left"),V(e,0,["B","A"],U)),t&&(R(t),F(t,"right"),V(t,a.length,["A","B"],U))}const qp="",$p="",sh="/",fc=()=>window.animationEffectsManager,zp=()=>d.state.placedNotes,ih=e=>{const t=e==null?void 0:e.split("-")[1];return Number.parseInt(t??"0",10)};function T0(e){if(!e||typeof e.startColumnIndex!="number"||typeof e.endColumnIndex!="number")return!1;const t=e.shape==="circle"?e.startColumnIndex+1:e.startColumnIndex;return e.endColumnIndex>t}function F0(e,t,n){const{cellWidth:i}=n,r=i*.25,A=e.uuid;if(!A)return 0;const a=t.filter(h=>!h.isDrum&&h.row===e.row&&h.startColumnIndex===e.startColumnIndex&&h.uuid&&h.uuid!==A);if(a.length===0)return 0;const l=[e,...a];return l.sort((h,f)=>ih(h.uuid)-ih(f.uuid)),l.findIndex(h=>h.uuid===A)*r}function I0(e,t){var A,a;const{cellHeight:n}=t,i=fc();return(A=i==null?void 0:i.shouldAnimateNote)!=null&&A.call(i,e)?(((a=i.getVibratoYOffset)==null?void 0:a.call(i,e.color))??0)*n:0}function M0(e,t,n){const i=fc(),r=i==null?void 0:i.hasReverbEffect;if(!(typeof r=="function"?r(t.color):!!r))return{shouldApply:!1,blur:0,spread:0};const{cellWidth:a}=n,l=i==null?void 0:i.getReverbEffect,c=typeof l=="function"?l(t.color):void 0;if(!c)return{shouldApply:!1,blur:0,spread:0};const h=c.blur*(a/2),f=c.spread*(a/3);return{shouldApply:h>0||f>0,blur:h,spread:f}}function Q0(e,t,n,i,r,A,a){var f,m;const l=fc();if(!((f=l==null?void 0:l.hasDelayEffect)!=null&&f.call(l,t.color)))return;const{cellWidth:c}=n,h=(m=l.getDelayEffects)==null?void 0:m.call(l,t.color);!h||h.length===0||h.forEach((w,B)=>{const y=w.delay/500*c*2,b=i+y,S=A*w.scale,F=a*w.scale;e.save(),e.globalAlpha=w.opacity*.6,e.beginPath(),e.ellipse(b,r,S,F,0,0,2*Math.PI),e.strokeStyle=t.color,e.lineWidth=Math.max(.5,S*.1),e.setLineDash([2,2]),e.stroke(),e.restore()})}function U0(e,t,n,i,r,A){var f,m;const a=fc();if(!((f=a==null?void 0:a.shouldFillNote)!=null&&f.call(a,t)))return;const l=((m=a.getFillLevel)==null?void 0:m.call(a,t))??0;if(l<=0)return;e.save();const c=1-l,h=e.createRadialGradient(n,i,0,n,i,Math.max(r,A));h.addColorStop(0,"transparent"),h.addColorStop(Math.max(0,c-.05),"transparent"),h.addColorStop(c,`${t.color}1F`),h.addColorStop(1,`${t.color}BF`),e.beginPath(),e.ellipse(n,i,r,A,0,0,2*Math.PI),e.clip(),e.fillStyle=h,e.fillRect(n-r-10,i-A-10,(r+10)*2,(A+10)*2),e.restore()}function jT(e,t,n,i,r,A){var B,y;const a=fc();if(!((B=a==null?void 0:a.shouldFillNote)!=null&&B.call(a,t)))return;const l=((y=a.getFillLevel)==null?void 0:y.call(a,t))??0;if(l<=0)return;e.save(),e.beginPath(),e.arc(n,r,A,Math.PI/2,-Math.PI/2,!1),e.lineTo(i,r-A),e.arc(i,r,A,-Math.PI/2,Math.PI/2,!1),e.lineTo(n,r+A),e.closePath(),e.clip();const c=(n+i)/2,h=i-n,f=Math.max(h/2+A,A),m=1-l,w=e.createRadialGradient(c,r,0,c,r,f);w.addColorStop(0,"transparent"),w.addColorStop(Math.max(0,m-.05),"transparent"),w.addColorStop(m,`${t.color}1F`),w.addColorStop(1,`${t.color}BF`),e.fillStyle=w,e.fillRect(n-A-10,r-A-10,h+(A+10)*2,(A+10)*2),e.restore()}function JT(e,t,n,i,r,A,a,l){if(jT(e,t,i,r,A,a),e.save(),e.beginPath(),e.arc(i,A,a,Math.PI/2,-Math.PI/2,!1),e.lineTo(r,A-a),e.arc(r,A,a,-Math.PI/2,Math.PI/2,!1),e.lineTo(i,A+a),e.closePath(),e.strokeStyle=t.color,e.lineWidth=l,e.shadowColor=t.color,e.shadowBlur=Kl,e.stroke(),e.shadowBlur=0,e.shadowColor="transparent",e.restore(),n.degreeDisplayMode!=="off"){const c=(i+r)/2;cg(e,t,n,c,A,a)}}function ZT(e,t,n){const{cellHeight:i}=n,r=i/2*.12,A=e.uuid;if(!A)return 0;const a=t.filter(h=>!h.isDrum&&h.row===e.row&&h.startColumnIndex===e.startColumnIndex&&h.uuid&&h.uuid!==A&&T0(h));if(a.length===0)return 0;const l=[e,...a];return l.sort((h,f)=>ih(h.uuid)-ih(f.uuid)),l.findIndex(h=>h.uuid===A)*r}function tF(e,t){const n=xl.getDegreeForNote(e,t);if(!n)return{label:null,isAccidental:!1};if(!xl.hasAccidental(n))return{label:n,isAccidental:!1};const r=d.state.accidentalMode||{},A=r.sharp??!0,a=r.flat??!0;if(!A&&!a)return{label:null,isAccidental:!0};let l=n.includes(qp)?n:null,c=n.includes($p)?n:null;const h=xl.getEnharmonicDegree(n);h&&(h.includes(qp)&&!l&&(l=h),h.includes($p)&&!c&&(c=h));let f=null;if(A&&a){const m=[];l&&m.push(l),c&&(!l||c!==l)&&m.push(c),f=m.join(sh),f||(f=n)}else A?f=l||n:a&&(f=c||n);return{label:f,isAccidental:!0}}function eF(e){if(!e)return{multiplier:1,category:"natural"};const t=e.includes($p),n=e.includes(qp),i=e.includes(sh);return!t&&!n?{multiplier:1,category:"natural"}:i?{multiplier:.75,category:"both-accidentals"}:{multiplier:.88,category:"single-accidental"}}function cg(e,t,n,i,r,A,a){const{label:l}=tF(t,n);if(!l)return;const{multiplier:c,category:h}=eF(l);let f;if(t.shape==="circle"){const w=A*2*uE;switch(h){case"natural":f=w;break;case"single-accidental":f=w*.8;break;case"both-accidentals":f=w*.4;break;default:f=w*c}}else{const w=A*2*cE;switch(h){case"natural":f=w*1.5;break;case"single-accidental":f=w*1.2;break;case"both-accidentals":f=w;break;default:f=w*c}}const m=f;if(!(m<hE))if(e.fillStyle="#212529",e.font=`bold ${m}px 'Atkinson Hyperlegible', sans-serif`,e.textAlign="center",e.textBaseline="middle",t.shape==="oval"&&h==="both-accidentals"&&l.includes(sh)){const w=l.split(sh),B=m*1.1,y=B*(w.length-1),b=r-y/2;w.forEach((S,F)=>{const U=b+F*B,D=m*.08;e.fillText(S.trim(),i,U+D)})}else{const w=m*.08;e.fillText(l,i,r+w)}}function Tl(e,t){return Number.isFinite(e)&&e>0&&Number.isFinite(t)&&t>0}function ug(e,t,n,i){const{cellWidth:r,cellHeight:A,modulationMarkers:a}=t,l=ie(i,t),c=I0(n,t),h=l+c,f=It(n.startColumnIndex,t);let m;if(a&&a.length>0?m=It(n.startColumnIndex+1,t)-f:m=r,!Tl(m,A))return;const w=F0(n,zp(),t),B=f+m+w,y=Math.max(dE,m*fE),b=A/2-y/2,S=T0(n),F=d.state.longNoteStyle||"style1";if(S&&F==="style2"){const H=B,Q=It(n.endColumnIndex,t);if(!Tl(Q-H,b))return;JT(e,n,t,H,Q,h,b,y);return}if(S){const H=It(n.endColumnIndex+1,t),Q=ZT(n,zp(),t),R=h+Q;e.beginPath(),e.moveTo(B,R),e.lineTo(H,R),e.strokeStyle=n.color,e.lineWidth=Math.max(mE,m*pE),e.stroke()}const U=m-y/2;if(!Tl(U,b))return;Q0(e,n,t,B,h,U,b),e.save(),U0(e,n,B,h,U,b);const D=M0(e,n,t);D.shouldApply&&(e.shadowColor=n.color,e.shadowBlur=Kl+D.blur,e.shadowOffsetX=D.spread),e.beginPath(),e.ellipse(B,h,U,b,0,0,2*Math.PI),e.strokeStyle=n.color,e.lineWidth=y,D.shouldApply||(e.shadowColor=n.color,e.shadowBlur=Kl),e.stroke(),e.shadowBlur=0,e.shadowColor="transparent",e.shadowOffsetX=0,e.restore(),t.degreeDisplayMode!=="off"&&cg(e,n,t,B,h,U)}function hg(e,t,n,i){const{columnWidths:r,cellWidth:A,cellHeight:a,modulationMarkers:l}=t,c=ie(i,t),h=I0(n,t),f=c+h,m=It(n.startColumnIndex,t);let w;if(l&&l.length>0?w=It(n.startColumnIndex+1,t)-m:w=((t.musicalColumnWidths&&t.musicalColumnWidths.length>0?t.musicalColumnWidths:r)[n.startColumnIndex]??0)*A,!Tl(w,a))return;const B=F0(n,zp(),t),y=Math.max(.5,w*.15),b=m+w/2+B,S=w/2-y/2,F=a/2-y/2;if(!Tl(S,F))return;Q0(e,n,t,b,f,S,F),e.save(),U0(e,n,b,f,S,F);const U=M0(e,n,t);U.shouldApply&&(e.shadowColor=n.color,e.shadowBlur=Kl+U.blur,e.shadowOffsetX=U.spread),e.beginPath(),e.ellipse(b,f,S,F,0,0,2*Math.PI),e.strokeStyle=n.color,e.lineWidth=y,U.shouldApply||(e.shadowColor=n.color,e.shadowBlur=Kl),e.stroke(),e.shadowBlur=0,e.shadowColor="transparent",e.shadowOffsetX=0,e.restore(),t.degreeDisplayMode!=="off"&&cg(e,n,t,b,f,S)}function P0(e,t,n){const{cellWidth:i,cellHeight:r,modulationMarkers:A}=t,a=ie(n.globalRow??n.row,t);let l=n.columnIndex;if(n.uuid){const S=xs.getColumnMap(d.state).entries.find(F=>F.type==="tonic"&&F.tonicSignUuid===n.uuid&&typeof F.canvasIndex=="number");S&&typeof S.canvasIndex=="number"&&(l=S.canvasIndex)}const c=It(l,t);let h;A&&A.length>0?h=It(l+1,t)-c:h=i;const f=h*2,m=c+f/2,w=Math.min(f,r)/2*.9;if(w<2||(e.beginPath(),e.arc(m,a,w,0,2*Math.PI),e.strokeStyle="#212529",e.lineWidth=Math.max(.5,h*.05),e.stroke(),n.tonicNumber==null))return;const B=n.tonicNumber.toString(),y=w*1.5;y<6||(e.fillStyle="#212529",e.font=`bold ${y}px 'Atkinson Hyperlegible', sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(B,m,a))}const Xp=[{id:1,diamonds:[0],ovals:[],label:"left 8th"},{id:2,diamonds:[1],ovals:[],label:"e"},{id:3,diamonds:[2],ovals:[],label:"right 8th"},{id:4,diamonds:[3],ovals:[],label:"a"},{id:5,diamonds:[0,1],ovals:[],label:"1 e"},{id:6,diamonds:[1,2],ovals:[],label:"e &"},{id:7,diamonds:[2,3],ovals:[],label:"& a"},{id:8,diamonds:[0,2],ovals:[],label:"two 8ths"},{id:9,diamonds:[1,3],ovals:[],label:"e a"},{id:10,diamonds:[0,1,2],ovals:[],label:"1 e + right 8th"},{id:11,diamonds:[1,2,3],ovals:[],label:"e & a"},{id:12,diamonds:[0,1,3],ovals:[],label:"1 e a"},{id:13,diamonds:[0,2,3],ovals:[],label:"left 8th + & a"},{id:14,diamonds:[0,3],ovals:[],label:"left 8th + a"},{id:15,diamonds:[0,1,2,3],ovals:[],label:"1 e & a"}];function Rh(e){return Xp.find(t=>t.id===e)}function Rv(e,t,n,i){const r=Math.sqrt(3)/2*n,A=Math.max(1,i-2*r),a=t-(A/2+r),l=a+r,c=l+A,h=c+r,f=e-n/2,m=e+n/2;return`M ${[`${e},${a}`,`${f},${l}`,`${f},${c}`,`${e},${h}`,`${m},${c}`,`${m},${l}`].join(" ")} Z`.replace(/,/g," ")}class nF{constructor(t={}){P(this,"options");this.options={diamondW:30,diamondH:120,ovalRx:30,ovalRy:60,strokeWidth:2,...t}}renderToCanvas(t,n,i,r,A,a,l="#000",c=null,h=null){const f=A/100*.8,m=a/100*.8,w=this.options.diamondW*f,B=this.options.diamondH*m,y=this.options.ovalRx*f,b=this.options.ovalRy*m,S=[.125,.375,.625,.875].map(U=>i+U*A),F=r+a/2;t.save(),t.strokeStyle=l,t.fillStyle=l,t.lineWidth=this.options.strokeWidth,t.lineCap="round",t.lineJoin="round",n.ovals.forEach(U=>{var Q;const D=U===0?i+.25*A:i+.75*A;let H=F;if(c&&h){const R=`oval_${U}`,V=((Q=c.shapeOffsets)==null?void 0:Q[R])||0,O=c.row+V;H=h(O)}t.beginPath(),t.ellipse(D,H,y,b,0,0,Math.PI*2),t.stroke()}),n.diamonds.forEach(U=>{var V;const D=S[U];if(D===void 0)return;let H=F;if(c&&h){const O=`diamond_${U}`,K=((V=c.shapeOffsets)==null?void 0:V[O])||0,z=c.row+K;H=h(z)}const Q=Rv(D,H,w,B),R=new Path2D(Q);t.stroke(R)}),t.restore()}renderToSVG(t,n=100,i=100){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox",`0 0 ${n} ${i}`),r.style.color="#000000";const A=Math.min(n/100,i/100)*.8,a=this.options.diamondW*A,l=this.options.diamondH*A,c=this.options.ovalRx*A,h=this.options.ovalRy*A,f=[12.5,37.5,62.5,87.5],m=i/2;return t.ovals.forEach(w=>{const B=w===0?25:75,y=document.createElementNS("http://www.w3.org/2000/svg","ellipse");y.setAttribute("cx",String(B)),y.setAttribute("cy",String(m)),y.setAttribute("rx",String(c)),y.setAttribute("ry",String(h)),y.setAttribute("fill","none"),y.setAttribute("stroke","currentColor"),y.setAttribute("stroke-width",String(this.options.strokeWidth*2)),y.setAttribute("stroke-linecap","round"),r.appendChild(y)}),t.diamonds.forEach(w=>{const B=f[w];if(B===void 0)return;const y=Rv(B,m,a,l),b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",y),b.setAttribute("fill","none"),b.setAttribute("stroke","currentColor"),b.setAttribute("stroke-width",String(this.options.strokeWidth*2)),b.setAttribute("stroke-linejoin","round"),b.setAttribute("stroke-linecap","round"),r.appendChild(b)}),r}}const dg=new nF;x.moduleLoaded("SixteenthStampRenderer","stamps");function sF(e,t){var i,r;const n=((i=d.getAllSixteenthStampPlacements)==null?void 0:i.call(d))??((r=d.state)==null?void 0:r.sixteenthStampPlacements)??[];n.length!==0&&(x.debug("SixteenthStampRenderer",`Rendering ${n.length} stamps`,{count:n.length},"stamps"),n.forEach(A=>{iF(e,A,t)}))}function iF(e,t,n){const i=Rh(t.sixteenthStampId);if(!i)return;const{startColumn:r,row:A,color:a}=t,l=d.state,c=It(r,n),f=ie(A,n)-n.cellHeight/2,m=br(r,l);let w;if(m!==null){const U=m+2;w=ds(U,l)}else w=r+2;const y=It(w,n)-c,b=n.cellHeight,S=Vn(e.canvas);if(c+y<0||c>S)return;const F=U=>ie(U,n);dg.renderToCanvas(e,i,c,f,y,b,a,t,F),e.save(),e.globalAlpha=.1,e.fillStyle=a,e.fillRect(c+1,f+1,y-2,b-2),e.restore(),x.debug("SixteenthStampRenderer",`Rendered stamp ${t.sixteenthStampId} at ${r}-${w},${A}`,{sixteenthStampId:t.sixteenthStampId,startColumn:r,effectiveEndColumn:w,row:A,stampX:c,stampY:f,hasOffsets:!!t.shapeOffsets},"stamps")}function rF(e,t,n,i,r){if(!i)return;const A=d.state,a=It(t,r),c=ie(n,r)-r.cellHeight/2,h=br(t,A);let f;if(h!==null){const y=h+2;f=ds(y,A)}else f=t+2;const w=It(f,r)-a,B=r.cellHeight;e.save(),e.globalAlpha=.6,dg.renderToCanvas(e,i,a,c,w,B,r.previewColor||"#4a90e2"),e.restore()}function Hv(e,t,n){return[{id:t+0,span:e,hits:[0],label:`${n} [1]`},{id:t+1,span:e,hits:[1],label:`${n} [2]`},{id:t+2,span:e,hits:[2],label:`${n} [3]`},{id:t+3,span:e,hits:[0,1],label:`${n} [1 2]`},{id:t+4,span:e,hits:[1,2],label:`${n} [2 3]`},{id:t+5,span:e,hits:[0,2],label:`${n} [1 3]`},{id:t+6,span:e,hits:[0,1,2],label:`${n} [1 2 3]`}]}const Ru=[...Hv("eighth",1,"8th triplet"),...Hv("quarter",8,"Quarter triplet")],D0={eighth:1,quarter:2},k0=[16.6667,50,83.3333];function Hh(e){return Ru.find(t=>t.id===e)}x.moduleLoaded("TripletStampRenderer","triplets");function AF(e,t){var i,r;const n=((i=d.getAllTripletStampPlacements)==null?void 0:i.call(d))??((r=d.state)==null?void 0:r.tripletStampPlacements)??[];n.length!==0&&(x.debug("TripletStampRenderer",`Rendering ${n.length} triplet groups`,{count:n.length},"triplets"),n.forEach(A=>{oF(e,A,t)}))}function oF(e,t,n){const i=Hh(t.tripletStampId);if(!i)return;const{startTimeIndex:r,span:A,row:a,color:l}=t,c=A*2,h=ds(r,d.state),f=h+c,m=It(h,n),w=ie(a,n),B=w-n.cellHeight/2,b=It(f,n)-m,S=n.cellHeight,F=Vn(e.canvas);if(m+b<0||m>F)return;L0(e,i,m,w,b,S,l,t,D=>ie(D,n)),e.save(),e.globalAlpha=.1,e.fillStyle=l,e.fillRect(m+1,B+1,b-2,S-2),e.restore()}function L0(e,t,n,i,r,A,a,l=null,c=null){const h=r/100*.8,f=A/100*.8,m=Math.max(1,3*f);t.hits.forEach(w=>{var S;const B=k0[w]??50,y=n+r*B/100;let b=i;if(l&&c){const F=`triplet_${w}`,U=((S=l.shapeOffsets)==null?void 0:S[F])||0,D=l.row+U;b=c(D),U!==0&&x.debug("TripletStampRenderer","Drawing notehead with offset",{slot:w,shapeKey:F,rowOffset:U,baseRow:l.row,shapeRow:D,y:b},"triplets")}aF(e,y,b,a,m,h,f)})}function aF(e,t,n,i="currentColor",r=4,A=1,a=1){const l=20*A,c=60*a;e.strokeStyle=i,e.lineWidth=r,e.fillStyle="none",e.beginPath(),e.ellipse(t,n,l,c,0,0,2*Math.PI),e.stroke()}function lF(e,t,n,i,r){if(!i)return;const a=(i.span==="eighth"?1:2)*2,l=ds(t,d.state),c=It(l,r),h=ie(n,r),f=l+a,w=It(f,r)-c,B=r.cellHeight;e.save(),e.globalAlpha=.6;const y=r.previewColor||"#4a90e2";L0(e,i,c,h,w,B,y),e.restore()}function cF(e,t){if(e===0)return It(0,t);const n=e-1,i=Tn(d.state,n);return i?It(i.endColumn+1,t):(x.warn("ModulationRenderer","Could not find measure info for index",{measureIndex:e},"grid"),e*200)}function R0(e,t){const{modulationMarkers:n}=t;if(!n||n.length===0)return;const i=n.filter(r=>r.active).map(r=>{let A;if(r.columnIndex!==null&&r.columnIndex!==void 0)A=It(r.columnIndex+1,t);else if(r.macrobeatIndex!==null&&r.macrobeatIndex!==void 0&&r.macrobeatIndex>=0){const a=Tn(d.state,r.macrobeatIndex);a?A=It(a.endColumn+1,t):(x.warn("ModulationRenderer","Could not find macrobeat info for index",{macrobeatIndex:r.macrobeatIndex},"grid"),A=r.xPosition??0)}else r.measureIndex!==null&&r.measureIndex!==void 0?A=cF(r.measureIndex,t):A=r.xPosition??0;return{...r,xCanvas:A}});e.save(),i.forEach(r=>{uF(e,r)}),e.restore()}function uF(e,t){const n=t.xCanvas,i=t.ratio,r=h0(i),A=u0(i);hF(e,n,r),dF(e,n,A,r)}function hF(e,t,n){const r=tn(e.canvas);e.beginPath(),e.moveTo(t,0),e.lineTo(t,r),e.lineWidth=3,e.strokeStyle=n,e.setLineDash([]),e.stroke()}function dF(e,t,n,i){const A="Arial, sans-serif";e.font=`14px ${A}`,e.textAlign="center",e.textBaseline="middle";const f=e.measureText(n).width,m=14,w=f+12,B=m+12,y=t-w/2,b=20;fF(e,y,b,w,B,8,i),e.fillStyle="#212529",e.fillText(n,t,b+B/2)}function fF(e,t,n,i,r,A,a){e.beginPath(),e.moveTo(t+A,n),e.lineTo(t+i-A,n),e.quadraticCurveTo(t+i,n,t+i,n+A),e.lineTo(t+i,n+r-A),e.quadraticCurveTo(t+i,n+r,t+i-A,n+r),e.lineTo(t+A,n+r),e.quadraticCurveTo(t,n+r,t,n+r-A),e.lineTo(t,n+A),e.quadraticCurveTo(t,n,t+A,n),e.closePath(),e.fillStyle=a,e.fill(),e.strokeStyle="rgba(0, 0, 0, 0.2)",e.lineWidth=1,e.stroke()}function Nv(e,t,n){const{xCanvas:i}=n,r=6,A=40;return Math.abs(e-i)<=r/2?t<=A?{marker:n,type:"label",canDrag:!1}:{marker:n,type:"barline",canDrag:!0}:null}function Ov(e){if(!e)return"default";switch(e.type){case"label":return"pointer";case"barline":return e.canDrag?"ew-resize":"pointer";default:return"default"}}function Bi(e){return e.x??e.col??0}function yi(e){return e.y??e.row??0}function jl(e,t){if(!t||t.length<3)return!1;const n=Bi(e),i=yi(e);let r=!1;for(let A=0,a=t.length-1;A<t.length;a=A++){const l=Bi(t[A]),c=yi(t[A]),h=Bi(t[a]),f=yi(t[a]);c>i!=f>i&&n<(h-l)*(i-c)/(f-c)+l&&(r=!r)}return r}function pF(e){if(!e||e.length<3)return e;const t=e.map(A=>({x:Bi(A),y:yi(A)}));if(t.length===0)return[];let n=t[0];for(let A=1;A<t.length;A++){const a=t[A];(a.y<n.y||a.y===n.y&&a.x<n.x)&&(n=a)}const i=t.filter(A=>A!==n);if(i.sort((A,a)=>{const l=Math.atan2(A.y-n.y,A.x-n.x),c=Math.atan2(a.y-n.y,a.x-n.x);if(l!==c)return l-c;const h=Math.hypot(A.x-n.x,A.y-n.y),f=Math.hypot(a.x-n.x,a.y-n.y);return h-f}),i.length===0)return[n];const r=[n,i[0]];for(let A=1;A<i.length;A++){const a=i[A];for(;r.length>1&&!mF(r[r.length-2],r[r.length-1],a);)r.pop();r.push(a)}return r}function mF(e,t,n){const i=Bi(e),r=yi(e),A=Bi(t),a=yi(t),l=Bi(n),c=yi(n);return(A-i)*(c-r)-(a-r)*(l-i)>0}function gF(e,t,n,i=10){const r=Bi(e),A=yi(e),a=Bi(t),l=yi(t),c=Bi(n),h=yi(n),f=c-a,m=h-l,w=f*f+m*m;if(w===0)return Math.hypot(r-a,A-l)<=i;let B=((r-a)*f+(A-l)*m)/w;B=Math.max(0,Math.min(1,B));const y=a+B*f,b=l+B*m;return Math.hypot(r-y,A-b)<=i}function Vv(e,t,n=10){if(!t||t.length<2)return!1;for(let i=0;i<t.length;i++){const r=t[i],A=t[(i+1)%t.length];if(gF(e,r,A,n))return!0}return!1}function wF(e,t){const{centerX:n,centerY:i,rx:r,ry:A}=t,a=16;for(let l=0;l<a;l++){const c=l/a*2*Math.PI,h=n+r*Math.cos(c),f=i+A*Math.sin(c);if(jl({x:h,y:f},e))return!0}return!!jl({x:n,y:i},e)}function Wv(e,t){const{x:n,y:i,width:r,height:A}=t,a=[{x:n,y:i},{x:n+r,y:i},{x:n+r,y:i+A},{x:n,y:i+A}];for(const l of a)if(jl(l,e))return!0;for(const l of e){const c=Bi(l),h=yi(l);if(c>=n&&c<=n+r&&h>=i&&h<=i+A)return!0}return!1}function H0(e,t,n,i,r,A){const a=r-n,l=A-i,c=a*a+l*l;if(c===0){const y=e-n,b=t-i;return Math.sqrt(y*y+b*b)}let h=((e-n)*a+(t-i)*l)/c;h=Math.max(0,Math.min(1,h));const f=n+h*a,m=i+h*l,w=e-f,B=t-m;return Math.sqrt(w*w+B*B)}function vF(e){const{x:t,y:n,annotations:i,getRenderOptions:r}=e,A=10;let a=!1;const l=r();return{nextAnnotations:i.filter(h=>{let f=!0;if(h.type==="arrow"){const m=It(h.startCol,l),w=ie(h.startRow,l),B=It(h.endCol,l),y=ie(h.endRow,l);H0(t,n,m,w,B,y)<A&&(f=!1,a=!0)}else if(h.type==="text"){const m=It(h.col,l),w=ie(h.row,l),B=It(h.col+h.widthCols,l),y=ie(h.row+h.heightRows,l);t>=m&&t<=B&&n>=w&&n<=y&&(f=!1,a=!0)}else if(h.type==="marker"||h.type==="highlighter")for(let m=0;m<h.path.length;m++){const w=It(h.path[m].col,l),B=ie(h.path[m].row,l),y=t-w,b=n-B;if(Math.sqrt(y*y+b*b)<A){f=!1,a=!0;break}}return f}),changed:a}}function BF(e){const{lassoPath:t,state:n,renderOptions:i,isAdditive:r,existingSelectedItems:A}=e,a=[];r&&Array.isArray(A)&&a.push(...A),n.placedNotes.forEach((c,h)=>{if(c.isDrum)return;const f=c.startColumnIndex,m=It(f,i),w=ie(c.row,i),{cellWidth:B,cellHeight:y}=i;let b=B;i.modulationMarkers&&i.modulationMarkers.length>0&&(b=It(f+1,i)-m);const S=c.shape==="oval"?m+b:m+b/2,F=w,U=c.shape==="oval"?b:b/2,D=y/2;if(wF(t,{centerX:S,centerY:F,rx:U,ry:D})){const H=`note-${c.row}-${f}-${c.color}-${c.shape}`;a.find(Q=>Q.id===H)||a.push({type:"note",id:H,data:c,index:h})}}),n.sixteenthStampPlacements.forEach((c,h)=>{const{cellWidth:f,cellHeight:m}=i,w=It(c.startColumn,i),B=ie(c.row,i)-m/2,y=f*2;if(Wv(t,{x:w,y:B,width:y,height:m})){const S=`sixteenth-stamp-${c.row}-${c.startColumn}-${c.sixteenthStampId}`;a.find(F=>F.id===S)||a.push({type:"sixteenthStamp",id:S,data:c,index:h})}}),n.tripletStampPlacements.forEach((c,h)=>{const{cellHeight:f}=i,m=ds(c.startTimeIndex,n),w=m+c.span*2,B=It(m,i),y=It(w,i)-B,b=ie(c.row,i)-f/2;if(Wv(t,{x:B,y:b,width:y,height:f})){const F=`triplet-stamp-${c.row}-${m}-${c.tripletStampId}`;a.find(U=>U.id===F)||a.push({type:"tripletStamp",id:F,data:c,index:h})}});const l=Jl({selectedItems:a,renderOptions:i,state:n});return{selectedItems:a,convexHull:l,isActive:a.length>0}}function Jl(e){const{selectedItems:t,renderOptions:n,state:i}=e;if(!t.length)return null;const r=i??d.state,A=t.map(a=>{const l=a.type==="note"?a.data.startColumnIndex:a.type==="sixteenthStamp"?a.data.startColumn:ds(a.data.startTimeIndex,r),c=It(l,n),h=ie(a.data.row,n);return{x:c,y:h}});return pF(A)}function yF(e){const{canvasX:t,canvasY:n,state:i,renderOptions:r,selection:A}=e;if(!(A!=null&&A.isActive))return null;const a=e.thresholdPx??15;let l=null;if(i.placedNotes.forEach(f=>{const m=f.startColumnIndex,w=It(m,r),B=ie(f.row,r);Math.hypot(t-w,n-B)<=a&&(l=`note-${f.row}-${m}-${f.color}-${f.shape}`)}),l||i.sixteenthStampPlacements.forEach(f=>{const m=f.startColumn+1,w=It(m,r),B=ie(f.row,r);Math.hypot(t-w,n-B)<=a&&(l=`sixteenth-stamp-${f.row}-${f.startColumn}-${f.sixteenthStampId}`)}),l||i.tripletStampPlacements.forEach(f=>{const m=ds(f.startTimeIndex,i),w=m+f.span,B=It(w,r),y=ie(f.row,r);Math.hypot(t-B,n-y)<=a&&(l=`triplet-stamp-${f.row}-${m}-${f.tripletStampId}`)}),!l)return null;const c=A.selectedItems.filter(f=>f.id!==l),h=Jl({selectedItems:c,renderOptions:r});return{nextSelection:{selectedItems:c,convexHull:h,isActive:c.length>0},changed:!0}}function CF(e){const{selection:t,selectionDragStart:n,selectionDragTotal:i,currentPointerGrid:r,initialDragStartRank:A,currentStartRank:a,renderOptions:l}=e,c=A!==null?a-A:0,h=r.row-c,f=Math.round(r.col-n.col),m=Math.round(h-n.row),w={col:f-i.col,row:m-i.row};if(w.col===0&&w.row===0)return{moved:!1,nextSelectionDragTotal:i,nextConvexHull:t.convexHull};const B=(F,U)=>typeof U=="number"?U:F,y=(F,U)=>{var Q;const D=((Q=d.state.columnWidths)==null?void 0:Q.length)??0;let H=F;for(;H>=0&&H<D;){const R=br(H,d.state);if(R!==null)return R;H+=U}return null};t.selectedItems.forEach(F=>{if(F.type==="note"){const D=B(F.data.row,F.data.globalRow)+w.row;F.data.globalRow=D,F.data.row=D,F.data.startColumnIndex=F.data.startColumnIndex+w.col,F.data.endColumnIndex=F.data.endColumnIndex+w.col}else if(F.type==="sixteenthStamp"){const D=B(F.data.row,F.data.globalRow)+w.row;F.data.globalRow=D,F.data.row=D,F.data.startColumn=F.data.startColumn+w.col,F.data.endColumn=F.data.endColumn+w.col}else if(F.type==="tripletStamp"){const D=B(F.data.row,F.data.globalRow)+w.row;if(F.data.globalRow=D,F.data.row=D,w.col!==0){const Q=ds(F.data.startTimeIndex,d.state)+w.col,R=Math.sign(w.col)||1,V=y(Q,R);V!==null&&(F.data.startTimeIndex=V)}}});const b={col:f,row:m},S=Jl({selectedItems:t.selectedItems,renderOptions:l,state:d.state});return t.convexHull=S,{moved:!0,nextSelectionDragTotal:b,nextConvexHull:S}}function bF(e){const{ctx:t,annotation:n,isTemp:i=!1,isSelected:r=!1,isHovered:A=!1,getStrokeWidth:a,getLineDash:l}=e,{startX:c,startY:h,endX:f,endY:m,settings:w}=n;t.save(),r&&(t.strokeStyle="#4a90e2",t.lineWidth=a(w.strokeWeight)+4,t.globalAlpha=.3,t.setLineDash([]),t.beginPath(),t.moveTo(c,h),t.lineTo(f,m),t.stroke(),t.globalAlpha=1),A&&!r&&(t.strokeStyle="#4a90e2",t.lineWidth=a(w.strokeWeight)+4,t.globalAlpha=.15,t.setLineDash([]),t.beginPath(),t.moveTo(c,h),t.lineTo(f,m),t.stroke(),t.globalAlpha=1),t.strokeStyle=i?"rgba(0, 0, 0, 0.5)":"#000000",t.lineWidth=a(w.strokeWeight),t.setLineDash(l(w.lineStyle));const B=Math.atan2(m-h,f-c),y=w.arrowheadSize||12;let b=c,S=h,F=f,U=m;w.startArrowhead!=="none"&&(b=c+Math.cos(B)*y,S=h+Math.sin(B)*y),w.endArrowhead!=="none"&&(F=f-Math.cos(B)*y,U=m-Math.sin(B)*y),t.beginPath(),t.moveTo(b,S),t.lineTo(F,U),t.stroke(),w.startArrowhead!=="none"&&Gv({ctx:t,x:c,y:h,angle:B+Math.PI,type:w.startArrowhead,size:y}),w.endArrowhead!=="none"&&Gv({ctx:t,x:f,y:m,angle:B,type:w.endArrowhead,size:y}),t.restore()}function Gv(e){const{ctx:t,x:n,y:i,angle:r,type:A,size:a}=e;switch(t.save(),t.translate(n,i),t.rotate(r),t.setLineDash([]),A){case"filled":case"filled-arrow":t.beginPath(),t.moveTo(0,0),t.lineTo(-a,-a/2),t.lineTo(-a,a/2),t.closePath(),t.fillStyle=t.strokeStyle,t.fill();break;case"unfilled":case"unfilled-arrow":t.beginPath(),t.moveTo(0,0),t.lineTo(-a,-a/2),t.lineTo(-a,a/2),t.closePath(),t.stroke();break;case"circle":t.beginPath(),t.arc(0,0,a/3,0,Math.PI*2),t.fillStyle=t.strokeStyle,t.fill();break}t.restore()}x.moduleLoaded("AnnotationService","annotation");class _F{constructor(){P(this,"canvas");P(this,"ctx");P(this,"currentTool");P(this,"toolSettings");P(this,"tempEraserMode");P(this,"isDrawing");P(this,"currentPath");P(this,"startPoint");P(this,"tempAnnotation");P(this,"selectedAnnotation");P(this,"hoverAnnotation");P(this,"eraserCursor");P(this,"isDragging");P(this,"dragOffset");P(this,"isResizing");P(this,"resizeHandle");P(this,"resizeStartBounds");P(this,"isDraggingSelection");P(this,"selectionDragStart");P(this,"selectionDragTotal");P(this,"lastPointerPosition");P(this,"initialDragStartRank");this.toolSettings=null,this.tempEraserMode=!1,this.currentTool=null,this.isDrawing=!1,this.currentPath=[],this.startPoint=null,this.tempAnnotation=null,this.selectedAnnotation=null,this.hoverAnnotation=null,this.eraserCursor=null,this.isDragging=!1,this.dragOffset=null,this.isResizing=!1,this.resizeHandle=null,this.resizeStartBounds=null,this.isDraggingSelection=!1,this.selectionDragStart=null,this.selectionDragTotal=null,this.lastPointerPosition=null,this.initialDragStartRank=null}initialize(){const t=document.getElementById("notation-grid");if(!(t instanceof HTMLCanvasElement)){x.error("AnnotationService","Pitch grid canvas not found",null,"annotation");return}const n=t.getContext("2d");if(!n){x.error("AnnotationService","Pitch grid context not available",null,"annotation");return}this.canvas=t,this.ctx=n,this.setupEventListeners(),d.on("annotationsChanged",()=>{this.selectedAnnotation=null,this.render()}),d.on("scrollByUnits",i=>{this.handleSelectionScroll(i)}),x.initSuccess("AnnotationService")}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("dblclick",this.handleDoubleClick.bind(this)),this.canvas.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),this.canvas.addEventListener("contextmenu",t=>t.preventDefault()),this.registerScrollSyncTarget(document.getElementById("pitch-grid-wrapper")),this.registerScrollSyncTarget(document.getElementById("canvas-container")),window.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}),window.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),document.addEventListener("keydown",this.handleKeyDown.bind(this))}handleKeyDown(t){if(!this.selectedAnnotation)return;const n=document.activeElement;if(n instanceof HTMLElement){const i=n.isContentEditable,r=n.tagName.toLowerCase();if(["input","textarea"].includes(r)||i)return}(t.key==="Delete"||t.key==="Backspace")&&(t.preventDefault(),this.deleteSelectedAnnotation())}deleteSelectedAnnotation(){if(!this.selectedAnnotation)return;const t=d.state.annotations.indexOf(this.selectedAnnotation);t>-1&&(d.state.annotations.splice(t,1),this.selectedAnnotation=null,d.recordState(),this.render(),x.log("AnnotationService","Deleted annotation","annotation"))}resize(){const t=document.getElementById("notation-grid");t instanceof HTMLCanvasElement&&(this.canvas.width=t.width,this.canvas.height=t.height,this.render())}getRenderOptions(){return{columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.cellWidth}}canvasToGrid(t,n){const i=this.getRenderOptions();return{col:Kp(t,i),row:DT(n,i)}}canvasToGridFresh(t,n){const i=this.getRenderOptions(),r=cs.getViewportInfo(),A=i.cellHeight/2;return{col:Kp(t,i),row:n/A+r.startRank-1}}gridToCanvas(t,n){const i=this.getRenderOptions();return{x:It(t,i),y:ie(n,i)}}setTool(t,n){if(this.currentTool=t,this.toolSettings=n,this.canvas)switch(t){case"arrow":case"text":this.canvas.style.cursor="crosshair";break;case"marker":case"highlighter":this.canvas.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><circle cx='8' cy='8' r='4' fill='rgba(0,0,0,0.5)'/></svg>") 8 8, crosshair`;break;case"lasso":this.canvas.style.cursor="crosshair";break;default:this.canvas.style.cursor="default"}}handleMouseDown(t){var l,c,h;if(!this.currentTool||!this.toolSettings)return;const n=this.canvas.getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top;this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY};const A=this.canvasToGridFresh(i,r);if(t.button===2){if(this.currentTool==="lasso"&&((l=d.state.lassoSelection)!=null&&l.isActive)){this.removeFromLassoSelection(i,r);return}this.tempEraserMode=!0,this.isDrawing=!0,this.eraseAtPoint(i,r),this.showEraserCursor(i,r);return}if(((c=this.selectedAnnotation)==null?void 0:c.type)==="text"){const f=this.getResizeHandleAt(i,r,this.selectedAnnotation);if(f){this.isResizing=!0,this.resizeHandle=f,this.resizeStartBounds={col:this.selectedAnnotation.col,row:this.selectedAnnotation.row,widthCols:this.selectedAnnotation.widthCols,heightRows:this.selectedAnnotation.heightRows,mouseCol:A.col,mouseRow:A.row};return}}if((h=d.state.lassoSelection)!=null&&h.isActive&&d.state.lassoSelection.convexHull){const f=Vv({x:i,y:r},d.state.lassoSelection.convexHull,10),m=jl({x:i,y:r},d.state.lassoSelection.convexHull);if(f||m){this.isDraggingSelection=!0,this.selectionDragStart={col:A.col,row:A.row},this.selectionDragTotal={col:0,row:0},this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY},this.initialDragStartRank=cs.getViewportInfo().startRank;return}}const a=this.getAnnotationAt(i,r);if(a&&(a.type==="arrow"||a.type==="text")){if(this.selectedAnnotation===a){this.isDragging=!0,a.type==="arrow"?this.dragOffset={startCol:A.col-a.startCol,startRow:A.row-a.startRow,endCol:A.col-a.endCol,endRow:A.row-a.endRow}:a.type==="text"&&(this.dragOffset={col:A.col-a.col,row:A.row-a.row});return}if(this.currentTool==="text"&&a.type==="text"){this.editTextAnnotation(a);return}this.selectedAnnotation=a,this.loadAnnotationSettings(a),this.render();return}else this.selectedAnnotation=null;switch(this.isDrawing=!0,this.startPoint=A,this.currentPath=[A],this.currentTool){case"arrow":this.tempAnnotation={type:"arrow",startCol:A.col,startRow:A.row,endCol:A.col,endRow:A.row,settings:{...this.toolSettings.arrow}};break;case"text":this.tempAnnotation={type:"text",startCol:A.col,startRow:A.row,endCol:A.col,endRow:A.row};break;case"marker":case"highlighter":this.tempAnnotation={type:this.currentTool,path:[A],settings:{...this.toolSettings[this.currentTool]}};break;case"lasso":this.tempAnnotation={type:"lasso",path:[{x:i,y:r}]};break}}handleMouseMove(t){var a;const n=this.canvas.getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top;this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY};const A=this.canvasToGridFresh(i,r);if(this.tempEraserMode){this.eraseAtPoint(i,r),this.showEraserCursor(i,r);return}if(this.isResizing&&((a=this.selectedAnnotation)==null?void 0:a.type)==="text"){if(!this.resizeHandle||!this.resizeStartBounds)return;const l=A.col-this.resizeStartBounds.mouseCol,c=A.row-this.resizeStartBounds.mouseRow;let h=this.resizeStartBounds.col,f=this.resizeStartBounds.row,m=this.resizeStartBounds.widthCols,w=this.resizeStartBounds.heightRows;this.resizeHandle.includes("n")&&(f=this.resizeStartBounds.row+c,w=this.resizeStartBounds.heightRows-c),this.resizeHandle.includes("s")&&(w=this.resizeStartBounds.heightRows+c),this.resizeHandle.includes("w")&&(h=this.resizeStartBounds.col+l,m=this.resizeStartBounds.widthCols-l),this.resizeHandle.includes("e")&&(m=this.resizeStartBounds.widthCols+l);const B=2,y=1;m<B&&(this.resizeHandle.includes("w")&&(h=this.resizeStartBounds.col+this.resizeStartBounds.widthCols-B),m=B),w<y&&(this.resizeHandle.includes("n")&&(f=this.resizeStartBounds.row+this.resizeStartBounds.heightRows-y),w=y),this.selectedAnnotation.col=h,this.selectedAnnotation.row=f,this.selectedAnnotation.widthCols=m,this.selectedAnnotation.heightRows=w,this.render();return}if(this.isDraggingSelection&&this.selectionDragStart&&this.selectionDragTotal){this.applySelectionDrag(i,r);return}if(this.isDragging&&this.selectedAnnotation){this.selectedAnnotation.type==="arrow"?(this.selectedAnnotation.startCol=A.col-this.dragOffset.startCol,this.selectedAnnotation.startRow=A.row-this.dragOffset.startRow,this.selectedAnnotation.endCol=A.col-this.dragOffset.endCol,this.selectedAnnotation.endRow=A.row-this.dragOffset.endRow):this.selectedAnnotation.type==="text"&&(this.selectedAnnotation.col=A.col-this.dragOffset.col,this.selectedAnnotation.row=A.row-this.dragOffset.row),this.render();return}if(!this.isDrawing){this.updateHover(i,r);return}if(this.tempAnnotation)switch(this.currentTool){case"arrow":this.tempAnnotation.endCol=A.col,this.tempAnnotation.endRow=A.row,this.render();break;case"text":this.tempAnnotation.endCol=A.col,this.tempAnnotation.endRow=A.row,this.render();break;case"marker":case"highlighter":if(this.tempAnnotation.path.length>0){const l=this.tempAnnotation.path[this.tempAnnotation.path.length-1],c=this.interpolatePoints(l,A);this.tempAnnotation.path.push(...c)}else this.tempAnnotation.path.push(A);this.render();break;case"lasso":this.tempAnnotation.path.push({x:i,y:r}),this.render();break}}handleMouseUp(t){if(this.isResizing){this.isResizing=!1,this.resizeHandle=null,this.resizeStartBounds=null,d.recordState();return}if(this.isDraggingSelection){this.isDraggingSelection=!1,this.selectionDragStart=null,this.selectionDragTotal=null,this.lastPointerPosition=null,this.initialDragStartRank=null,d.recordState();return}if(this.isDragging){this.isDragging=!1,this.dragOffset=null,d.recordState();return}if(this.isDrawing){if(this.isDrawing=!1,this.tempEraserMode){this.tempEraserMode=!1,this.render();return}if(this.tempAnnotation){if(this.currentTool==="text"){const{startCol:n,startRow:i,endCol:r,endRow:A}=this.tempAnnotation,a=Math.abs(r-n),l=Math.abs(A-i),c=Math.min(n,r),h=Math.min(i,A);a>.5&&l>.2?this.createTextAnnotation(c,h,a,l):this.createTextAnnotation(n,i,8,2),this.tempAnnotation=null,this.render();return}this.currentTool==="lasso"?this.handleLassoSelection(t.shiftKey):(d.state.annotations.push(this.tempAnnotation),this.currentTool==="arrow"&&(this.selectedAnnotation=this.tempAnnotation),d.recordState()),this.tempAnnotation=null,this.render()}}}handleWheel(t){!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal||((t.clientX!==0||t.clientY!==0)&&(this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY}),requestAnimationFrame(()=>this.applySelectionDragFromLastPointer()))}handleScroll(){!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal||requestAnimationFrame(()=>this.applySelectionDragFromLastPointer())}applySelectionDragFromLastPointer(){if(!this.canvas||!this.lastPointerPosition)return;const t=this.canvas.getBoundingClientRect(),n=this.lastPointerPosition.clientX-t.left,i=this.lastPointerPosition.clientY-t.top;this.applySelectionDrag(n,i)}registerScrollSyncTarget(t){t&&(t.addEventListener("wheel",this.handleWheel.bind(this),{passive:!0}),t.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}))}applySelectionDrag(t,n){if(!this.isDraggingSelection||!this.selectionDragStart||!this.selectionDragTotal)return;const i=this.getRenderOptions(),A=cs.getViewportInfo().startRank,a=this.canvasToGridFresh(t,n),{moved:l,nextSelectionDragTotal:c}=CF({selection:d.state.lassoSelection,selectionDragStart:this.selectionDragStart,selectionDragTotal:this.selectionDragTotal,currentPointerGrid:a,initialDragStartRank:this.initialDragStartRank,currentStartRank:A,renderOptions:i});l&&(this.selectionDragTotal.col=c.col,this.selectionDragTotal.row=c.row,this.render())}handleSelectionScroll(t){var i;if(!((i=d.state.lassoSelection)!=null&&i.isActive)||this.isDraggingSelection)return;const n=this.getRenderOptions();d.state.lassoSelection.convexHull=Jl({selectedItems:d.state.lassoSelection.selectedItems,renderOptions:n}),this.render()}handleMouseLeave(t){this.isDrawing&&this.handleMouseUp(t)}handleDoubleClick(t){const n=this.canvas.getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top,A=this.getAnnotationAt(i,r);(A==null?void 0:A.type)==="text"&&this.editTextAnnotation(A)}editTextAnnotation(t){const{col:n,row:i,widthCols:r,heightRows:A,text:a,settings:l}=t,c=d.state.annotations.indexOf(t);c>-1&&(d.state.annotations.splice(c,1),this.selectedAnnotation=null,this.render()),this.createTextAnnotation(n,i,r,A,a,l)}createTextAnnotation(t,n,i,r,A=null,a=null){this.isDrawing=!1;const l=this.gridToCanvas(t,n),c=this.gridToCanvas(t+i,n+r),h=l.x,f=l.y,m=c.x-h,w=c.y-f,y=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',b=a||this.toolSettings.text,S=document.createElement("div");S.contentEditable="true",S.className="annotation-text-input",S.textContent=A||"Type here...";const F=b.size,U=F*1.2;S.style.width=`${m}px`,S.style.height=`${w}px`,S.style.padding=b.background?"4px 8px":"4px",S.style.border="2px dashed rgba(74, 144, 226, 0.5)",S.style.backgroundColor=b.background?"#ffffff":"transparent",S.style.color=b.color,S.style.fontSize=`${F}px`,S.style.lineHeight=`${U}px`,S.style.fontWeight=b.bold?"bold":"normal",S.style.fontStyle=b.italic?"italic":"normal",S.style.textDecoration=b.underline?"underline":"none",b.superscript?(S.style.fontSize=`${F*.6}px`,S.style.verticalAlign="super"):b.subscript&&(S.style.fontSize=`${F*.6}px`,S.style.verticalAlign="sub"),S.style.outline="none",S.style.zIndex="10000",S.style.position="fixed",S.style.cursor="text",S.style.pointerEvents="auto",S.style.fontFamily=y,S.style.whiteSpace="pre-wrap",S.style.wordWrap="break-word",S.style.overflow="hidden",S.style.boxSizing="border-box";const D=this.canvas.getBoundingClientRect();S.style.left=`${D.left+h}px`,S.style.top=`${D.top+f}px`,document.body.appendChild(S),S.focus();const H=document.createRange();H.selectNodeContents(S);const Q=window.getSelection();Q&&(Q.removeAllRanges(),Q.addRange(H));let R=!1;const V=()=>{if(R)return;R=!0;const K=S.textContent.trim();if(K&&K!=="Type here..."){const z={type:"text",col:t,row:n,widthCols:i,heightRows:r,text:K,settings:{...b}};d.state.annotations.push(z),this.selectedAnnotation=d.state.annotations[d.state.annotations.length-1],d.recordState(),this.render()}document.body.contains(S)&&document.body.removeChild(S)};let O=!1;S.addEventListener("input",()=>{!O&&S.textContent==="Type here..."&&(S.textContent="",O=!0)}),setTimeout(()=>{S.addEventListener("blur",V)},100),S.addEventListener("keydown",K=>{K.key==="Enter"&&!K.shiftKey&&(K.preventDefault(),V()),K.key==="Escape"&&(R=!0,document.body.contains(S)&&document.body.removeChild(S))})}handleLassoSelection(t=!1){var i,r;if(!((i=this.tempAnnotation)!=null&&i.path))return;const n=this.getRenderOptions();d.state.lassoSelection=BF({lassoPath:this.tempAnnotation.path,state:d.state,renderOptions:n,isAdditive:t,existingSelectedItems:(r=d.state.lassoSelection)==null?void 0:r.selectedItems}),d.recordState(),x.log("AnnotationService",`Lasso selection completed: ${d.state.lassoSelection.selectedItems.length} items selected`,"annotation"),this.render()}updateLassoConvexHull(){var n,i;if(!((n=d.state.lassoSelection)!=null&&n.isActive)||!((i=d.state.lassoSelection.selectedItems)!=null&&i.length))return;const t=this.getRenderOptions();d.state.lassoSelection.convexHull=Jl({selectedItems:d.state.lassoSelection.selectedItems,renderOptions:t})}removeFromLassoSelection(t,n){var A;if(!((A=d.state.lassoSelection)!=null&&A.isActive))return;const i=this.getRenderOptions(),r=yF({canvasX:t,canvasY:n,state:d.state,renderOptions:i,selection:d.state.lassoSelection});r!=null&&r.changed&&(d.state.lassoSelection=r.nextSelection,d.recordState(),this.render(),x.log("AnnotationService",`Removed item from lasso selection. ${r.nextSelection.selectedItems.length} items remain.`,"annotation"))}drawTempAnnotation(){if(this.tempAnnotation)switch(this.tempAnnotation.type){case"arrow":this.drawArrow(this.tempAnnotation,!0);break;case"text":this.drawTextBoxPreview(this.tempAnnotation);break;case"marker":this.drawPath(this.tempAnnotation,!1);break;case"highlighter":this.drawPath(this.tempAnnotation,!0);break;case"lasso":this.drawLassoPath(this.tempAnnotation);break}}drawTextBoxPreview(t){const{startX:n,startY:i,endX:r,endY:A}=t,a=this.ctx,l=Math.min(n,r),c=Math.min(i,A),h=Math.abs(r-n),f=Math.abs(A-i);a.save(),a.strokeStyle="rgba(74, 144, 226, 0.6)",a.lineWidth=2,a.setLineDash([5,5]),a.strokeRect(l,c,h,f),this.toolSettings.text.background&&(a.fillStyle="rgba(255, 255, 255, 0.8)",a.fillRect(l,c,h,f)),a.restore()}render(){Zl.render()}drawArrow(t,n=!1,i=!1,r=!1){bF({ctx:this.ctx,annotation:t,isTemp:n,isSelected:i,isHovered:r,getStrokeWidth:this.getStrokeWidth.bind(this),getLineDash:this.getLineDash.bind(this)})}wrapText(t,n,i){const r=n.split(`
`),A=[];return r.forEach(a=>{if(!a.trim()){A.push("");return}const l=a.split(" ");let c="";l.forEach((h,f)=>{const m=c?c+" "+h:h;t.measureText(m).width>i&&c?(A.push(c),c=h):c=m}),c&&A.push(c)}),A}drawText(t,n=!1,i=!1){const{x:r,y:A,text:a,settings:l}=t,c=this.ctx;c.save();const f=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',m=this.getSizeValue(l.size);c.font=`${l.italic?"italic ":""}${l.bold?"bold ":""}${m} ${f}`,c.textBaseline="top";const w=parseInt(m)*1.2,B=t.width||0,y=t.height||0,b=l.background?16:8,S=B-b,F=this.wrapText(c,a,S);if(l.background){c.fillStyle="#ffffff";const D=8;c.fillRect(r-D/2,A-D/2,B+D,y+D/2)}if(i&&!n){c.fillStyle="rgba(74, 144, 226, 0.1)";const D=l.background?8:2;c.fillRect(r-D/2,A-D/2,B+D,y+D/2)}if(n){c.fillStyle="rgba(74, 144, 226, 0.2)";const D=l.background?8:2;c.fillRect(r-D/2,A-D/2,B+D,y+D/2)}c.fillStyle=l.color;const U=parseInt(m);F.forEach((D,H)=>{const Q=A+H*w;this.drawTextWithSuperscripts(c,D,r,Q,U,l,f)}),n&&this.drawResizeHandles(r,A,B,y),c.restore()}drawTextWithSuperscripts(t,n,i,r,A,a,l){if(a.superscript||a.subscript){t.save();const m=A*.6,w=a.superscript?-A*.4:A*.3;if(t.font=`${a.italic?"italic ":""}${a.bold?"bold ":""}${m}px ${l}`,t.fillText(n,i,r+w),a.underline){const B=t.measureText(n);t.beginPath(),t.strokeStyle=a.color,t.lineWidth=1,t.moveTo(i,r+w+m*1.2-2),t.lineTo(i+B.width,r+w+m*1.2-2),t.stroke()}t.restore();return}let c=i;const h=this.parseFormattedText(n),f=(m,w)=>{const B=m;if(B){if(t.save(),w==="superscript"){const y=A*.6,b=-A*.4;t.font=`${a.italic?"italic ":""}${a.bold?"bold ":""}${y}px ${l}`,t.fillText(B,c,r+b),c+=t.measureText(B).width}else if(w==="subscript"){const y=A*.6,b=A*.3;t.font=`${a.italic?"italic ":""}${a.bold?"bold ":""}${y}px ${l}`,t.fillText(B,c,r+b),c+=t.measureText(B).width}else{if(t.font=`${a.italic?"italic ":""}${a.bold?"bold ":""}${A}px ${l}`,t.fillText(B,c,r),a.underline){const y=t.measureText(B);t.beginPath(),t.strokeStyle=a.color,t.lineWidth=1,t.moveTo(c,r+A*1.2-2),t.lineTo(c+y.width,r+A*1.2-2),t.stroke()}c+=t.measureText(B).width}t.restore()}};h.forEach(m=>{f(m.text,m.format)})}parseFormattedText(t){const n=[];let i=0,r="",A=!1;for(;i<t.length;){if(t.substr(i,5)==="<sup>"){r&&(n.push({text:r,format:"normal"}),r="");const a=t.indexOf("</sup>",i);if(a!==-1){const l=t.substring(i+5,a);n.push({text:l,format:"superscript"}),i=a+6;continue}}if(t.substr(i,5)==="<sub>"){r&&(n.push({text:r,format:"normal"}),r="");const a=t.indexOf("</sub>",i);if(a!==-1){const l=t.substring(i+5,a);n.push({text:l,format:"subscript"}),i=a+6;continue}}if(t[i]==="^"&&!A){r&&(n.push({text:r,format:"normal"}),r=""),A=!0,i++;continue}if(A&&t[i]===" "){r&&(n.push({text:r,format:"superscript"}),r=""),A=!1,n.push({text:" ",format:"normal"}),i++;continue}r+=t[i],i++}return r&&n.push({text:r,format:A?"superscript":"normal"}),n}drawResizeHandles(t,n,i,r){const A=this.ctx,a=8,l=[{pos:"nw",x:t,y:n},{pos:"n",x:t+i/2,y:n},{pos:"ne",x:t+i,y:n},{pos:"e",x:t+i,y:n+r/2},{pos:"se",x:t+i,y:n+r},{pos:"s",x:t+i/2,y:n+r},{pos:"sw",x:t,y:n+r},{pos:"w",x:t,y:n+r/2}];A.save(),l.forEach(c=>{A.fillStyle="#4a90e2",A.strokeStyle="#ffffff",A.lineWidth=2,A.fillRect(c.x-a/2,c.y-a/2,a,a),A.strokeRect(c.x-a/2,c.y-a/2,a,a)}),A.restore()}drawPath(t,n){const{path:i,settings:r}=t,A=this.ctx;if(!(i.length<2)){A.save(),n&&(A.globalAlpha=.3),A.strokeStyle=r.color,A.lineWidth=this.getStrokeWidth(r.size),A.lineCap="round",A.lineJoin="round",A.beginPath(),A.moveTo(i[0].x,i[0].y);for(let a=1;a<i.length;a++)A.lineTo(i[a].x,i[a].y);A.stroke(),A.restore()}}drawLassoPath(t){const{path:n}=t,i=this.ctx;if(!(n.length<2)){i.save(),i.strokeStyle="rgba(0, 100, 255, 0.8)",i.lineWidth=2,i.setLineDash([5,5]),i.beginPath(),i.moveTo(n[0].x,n[0].y);for(let r=1;r<n.length;r++)i.lineTo(n[r].x,n[r].y);i.lineTo(n[0].x,n[0].y),i.stroke(),i.restore()}}getStrokeWidth(t){if(typeof t=="number")return t;switch(t){case"small":return 2;case"medium":return 4;case"large":return 6;default:return 2}}getLineDash(t){switch(t){case"solid":return[];case"dashed-big":return[10,5];case"dashed-small":return[5,3];case"dotted":return[2,3];default:return[]}}getSizeValue(t){if(typeof t=="number")return`${t}px`;switch(t){case"small":return"14px";case"medium":return"18px";case"large":return"24px";default:return"16px"}}updateHover(t,n){var a,l,c,h;const i=this.hoverAnnotation,r=typeof document<"u"&&((l=(a=document.body)==null?void 0:a.dataset)==null?void 0:l.cursorOverride)==="stamp";if(((c=this.selectedAnnotation)==null?void 0:c.type)==="text"){const f=this.getResizeHandleAt(t,n,this.selectedAnnotation);if(f){const m={nw:"nwse-resize",n:"ns-resize",ne:"nesw-resize",e:"ew-resize",se:"nwse-resize",s:"ns-resize",sw:"nesw-resize",w:"ew-resize"};this.canvas.style.cursor=m[f]??"default";return}}if((h=d.state.lassoSelection)!=null&&h.isActive&&d.state.lassoSelection.convexHull){const f=Vv({x:t,y:n},d.state.lassoSelection.convexHull,10),m=jl({x:t,y:n},d.state.lassoSelection.convexHull);if(f||m){this.canvas.style.cursor="move";return}}const A=this.getAnnotationAt(t,n);A&&(A.type==="arrow"||A.type==="text")?(r||(this.currentTool==="text"&&A.type==="text"?this.selectedAnnotation===A?this.canvas.style.cursor="move":this.canvas.style.cursor="pointer":this.canvas.style.cursor="move"),this.hoverAnnotation=A):(r||(this.currentTool?this.setTool(this.currentTool,this.toolSettings):i&&(this.canvas.style.cursor="default")),this.hoverAnnotation=null),i!==this.hoverAnnotation&&this.render()}getResizeHandleAt(t,n,i){if((i==null?void 0:i.type)!=="text")return null;const A=8/2+2,a=this.getRenderOptions(),l=It(i.col,a),c=ie(i.row,a),h=It(i.col+i.widthCols,a),f=ie(i.row+i.heightRows,a),m=h-l,w=f-c,B=[{pos:"nw",x:l,y:c},{pos:"n",x:l+m/2,y:c},{pos:"ne",x:l+m,y:c},{pos:"e",x:l+m,y:c+w/2},{pos:"se",x:l+m,y:c+w},{pos:"s",x:l+m/2,y:c+w},{pos:"sw",x:l,y:c+w},{pos:"w",x:l,y:c+w/2}];for(const y of B)if(Math.sqrt(Math.pow(t-y.x,2)+Math.pow(n-y.y,2))<=A)return y.pos;return null}getAnnotationAt(t,n){for(let r=d.state.annotations.length-1;r>=0;r--){const A=d.state.annotations[r];if(A.type==="arrow"){if(H0(t,n,A.startX,A.startY,A.endX,A.endY)<10)return A}else if(A.type==="text"){const a=this.getRenderOptions(),l=It(A.col,a),c=ie(A.row,a),h=It(A.col+A.widthCols,a),f=ie(A.row+A.heightRows,a),m=h-l,w=f-c;if(t>=l&&t<=l+m&&n>=c&&n<=c+w)return A}}return null}showEraserCursor(t,n){this.render();const r=(d.state.cellWidth||40)*2;this.ctx.save(),this.ctx.fillStyle="rgba(220, 53, 69, 0.3)",this.ctx.fillRect(t-r/2,n-r/2,r,r),this.ctx.restore()}loadAnnotationSettings(t){if(t.type==="arrow"&&window.drawToolsController){const n=t.settings;window.drawToolsController.settings.arrow={...n},window.drawToolsController.renderArrowOptions()}else if(t.type==="text"&&window.drawToolsController){const n=t.settings;window.drawToolsController.settings.text={...n},window.drawToolsController.renderTextOptions()}}applyCurrentSettingsToSelected(){this.selectedAnnotation&&(this.selectedAnnotation.type==="arrow"&&this.toolSettings.arrow?(this.selectedAnnotation.settings={...this.toolSettings.arrow},this.render()):this.selectedAnnotation.type==="text"&&this.toolSettings.text&&(this.selectedAnnotation.settings={...this.toolSettings.text},this.render()))}clearAnnotations(){d.state.annotations=[],this.render()}eraseAtPoint(t,n){const{nextAnnotations:i,changed:r}=vF({x:t,y:n,annotations:d.state.annotations,getRenderOptions:()=>this.getRenderOptions()});return d.state.annotations=i,r&&this.render(),r}interpolatePoints(t,n){const i=[],r=n.col-t.col,A=n.row-t.row,a=Math.sqrt(r*r+A*A),l=Math.max(1,Math.floor(a/.1));for(let c=1;c<=l;c++){const h=c/l;i.push({col:t.col+h*r,row:t.row+h*A})}return i}deleteAnnotationAt(t,n){this.eraseAtPoint(t,n)}getAnnotations(){return d.state.annotations}loadAnnotations(t){d.state.annotations=t||[],this.render()}applyInlineFormatting(t){const n=document.querySelector(".annotation-text-input");if(!n)return;const i=window.getSelection();if(!i||!i.rangeCount)return;const r=i.getRangeAt(0),A=r.toString();if(!A)return;let a;if(t==="superscript")a=`<sup>${A}</sup>`;else if(t==="subscript")a=`<sub>${A}</sub>`;else return;r.deleteContents();const l=document.createTextNode(a);r.insertNode(l),r.setStartAfter(l),r.setEndAfter(l),i.removeAllRanges(),i.addRange(r),n instanceof HTMLElement&&n.focus()}}const qe=new _F;function Kv(e){if((e==null?void 0:e.type)!=="arrow")return!1;const t=e,n=t.settings;return typeof t.startCol=="number"&&typeof t.startRow=="number"&&typeof t.endCol=="number"&&typeof t.endRow=="number"&&!!n&&typeof n.strokeWeight=="number"&&typeof n.lineStyle=="string"}function qv(e){if((e==null?void 0:e.type)!=="text")return!1;const t=e,n=t.settings;return typeof t.col=="number"&&typeof t.row=="number"&&typeof t.widthCols=="number"&&typeof t.heightRows=="number"&&typeof t.text=="string"&&!!n&&typeof n.size=="number"&&typeof n.color=="string"}function SF(e){if((e==null?void 0:e.type)!=="text")return!1;const t=e,n=typeof e.col=="number";return typeof t.startCol=="number"&&typeof t.startRow=="number"&&typeof t.endCol=="number"&&typeof t.endRow=="number"&&!n}function $v(e){if(!e||e.type!=="marker"&&e.type!=="highlighter")return!1;const t=e,n=t.settings;return Array.isArray(t.path)&&!!n&&typeof n.color=="string"&&(typeof n.size=="number"||n.size==="small"||n.size==="medium"||n.size==="large")}function xF(e){return(e==null?void 0:e.type)==="lasso"&&Array.isArray(e.path)}function EF(e,t){const n=d.state.annotations,i=qe.tempAnnotation,r=qe.selectedAnnotation,A=qe.hoverAnnotation;if(n&&n.length>0&&n.forEach(l=>{const c=l===r,h=l===A;switch(l.type){case"arrow":Kv(l)&&zv(e,l,c,h,t);break;case"text":qv(l)&&Yv(e,l,c,h,t);break;case"marker":case"highlighter":$v(l)&&jv(e,l,t);break}}),i)switch(i.type){case"arrow":Kv(i)&&zv(e,i,!1,!1,t);break;case"text":SF(i)?QF(e,i,t):qv(i)&&Yv(e,i,!1,!1,t);break;case"marker":case"highlighter":$v(i)&&jv(e,i,t);break;case"lasso":xF(i)&&PF(e,i);break}const a=d.state.lassoSelection;a!=null&&a.isActive&&Array.isArray(a.convexHull)&&(qe.updateLassoConvexHull(),DF(e,a.convexHull))}function zv(e,t,n=!1,i=!1,r){const{startCol:A,startRow:a,endCol:l,endRow:c,settings:h}=t,f=It(A,r),m=ie(a,r),w=It(l,r),B=ie(c,r);e.save(),e.strokeStyle=t.color||"#000000",e.lineWidth=Yp(h.strokeWeight),e.setLineDash(UF(h.lineStyle));const y=Math.atan2(B-m,w-f),b=h.arrowheadSize||12;let S=f,F=m,U=w,D=B;h.startArrowhead&&h.startArrowhead!=="none"&&(S=f+Math.cos(y)*b,F=m+Math.sin(y)*b),h.endArrowhead&&h.endArrowhead!=="none"&&(U=w-Math.cos(y)*b,D=B-Math.sin(y)*b),e.beginPath(),e.moveTo(S,F),e.lineTo(U,D),e.stroke(),e.setLineDash([]),h.startArrowhead&&h.startArrowhead!=="none"&&Xv(e,f,m,y+Math.PI,h.startArrowhead,b),h.endArrowhead&&h.endArrowhead!=="none"&&Xv(e,w,B,y,h.endArrowhead,b),(n||i)&&(e.strokeStyle=n?"rgba(74, 144, 226, 0.6)":"rgba(74, 144, 226, 0.3)",e.lineWidth=Yp(h.strokeWeight)+4,e.setLineDash([]),e.beginPath(),e.moveTo(f,m),e.lineTo(w,B),e.stroke()),e.restore()}function Xv(e,t,n,i,r,A){switch(e.save(),e.translate(t,n),e.rotate(i),r){case"filled":case"filled-arrow":e.beginPath(),e.moveTo(0,0),e.lineTo(-A,-A/2),e.lineTo(-A,A/2),e.closePath(),e.fillStyle=e.strokeStyle,e.fill();break;case"unfilled":case"unfilled-arrow":e.beginPath(),e.moveTo(0,0),e.lineTo(-A,-A/2),e.lineTo(-A,A/2),e.closePath(),e.stroke();break;case"circle":e.beginPath(),e.arc(0,0,A/3,0,Math.PI*2),e.fillStyle=e.strokeStyle,e.fill();break}e.restore()}function Yv(e,t,n=!1,i=!1,r){const{col:A,row:a,text:l,widthCols:c,heightRows:h,settings:f}=t,m=It(A,r),w=ie(a,r),B=It(A+(typeof c=="number"?c:2),r)-m,y=ie(a+(typeof h=="number"?h:1),r)-w;e.save(),e.textBaseline="top";const S=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',F=f.size,U=F*1.2,D=f.background?8:4,H=4,Q=B-D*2,R=TF(e,l,Q,F,f,S);f.background&&(e.fillStyle="#ffffff",e.fillRect(m,w,B,y)),i&&!n&&(e.fillStyle="rgba(74, 144, 226, 0.1)",e.fillRect(m,w,B,y)),n&&(e.fillStyle="rgba(74, 144, 226, 0.2)",e.fillRect(m,w,B,y)),e.fillStyle=f.color,R.forEach((V,O)=>{const K=w+H+O*U;FF(e,V,m+D,K,F,f,S)}),n&&MF(e,m,w,B,y),e.restore()}function TF(e,t,n,i,r,A){e.font=`${r.italic?"italic ":""}${r.bold?"bold ":""}${i}px ${A}`;const a=t.split(`
`),l=[];return a.forEach(c=>{if(!c.trim()){l.push("");return}const h=c.split(" ");let f="";h.forEach(m=>{const w=f?f+" "+m:m;e.measureText(w).width>n&&f?(l.push(f),f=m):f=w}),f&&l.push(f)}),l}function FF(e,t,n,i,r,A,a){if(A.superscript||A.subscript){e.save();const h=r*.6,f=A.superscript?-r*.4:r*.3;if(e.font=`${A.italic?"italic ":""}${A.bold?"bold ":""}${h}px ${a}`,e.fillText(t,n,i+f),A.underline){const m=e.measureText(t);e.beginPath(),e.strokeStyle=A.color,e.lineWidth=1,e.moveTo(n,i+f+h*1.2-2),e.lineTo(n+m.width,i+f+h*1.2-2),e.stroke()}e.restore();return}const l=IF(t);let c=n;l.forEach(h=>{if(e.save(),h.format==="superscript"){const f=r*.6,m=-r*.4;e.font=`${A.italic?"italic ":""}${A.bold?"bold ":""}${f}px ${a}`,e.fillText(h.text,c,i+m),c+=e.measureText(h.text).width}else if(h.format==="subscript"){const f=r*.6,m=r*.3;e.font=`${A.italic?"italic ":""}${A.bold?"bold ":""}${f}px ${a}`,e.fillText(h.text,c,i+m),c+=e.measureText(h.text).width}else{if(e.font=`${A.italic?"italic ":""}${A.bold?"bold ":""}${r}px ${a}`,e.fillText(h.text,c,i),A.underline){const f=e.measureText(h.text);e.beginPath(),e.strokeStyle=A.color,e.lineWidth=1,e.moveTo(c,i+r*1.2-2),e.lineTo(c+f.width,i+r*1.2-2),e.stroke()}c+=e.measureText(h.text).width}e.restore()})}function IF(e){const t=[];let n=0,i="",r=!1;for(;n<e.length;){if(e.substr(n,5)==="<sup>"){i&&(t.push({text:i,format:"normal"}),i="");const A=e.indexOf("</sup>",n);if(A!==-1){const a=e.substring(n+5,A);t.push({text:a,format:"superscript"}),n=A+6;continue}}if(e.substr(n,5)==="<sub>"){i&&(t.push({text:i,format:"normal"}),i="");const A=e.indexOf("</sub>",n);if(A!==-1){const a=e.substring(n+5,A);t.push({text:a,format:"subscript"}),n=A+6;continue}}if(e[n]==="^"&&!r){i&&(t.push({text:i,format:"normal"}),i=""),r=!0,n++;continue}if(r&&e[n]===" "){i&&(t.push({text:i,format:"superscript"}),i=""),r=!1,t.push({text:" ",format:"normal"}),n++;continue}i+=e[n],n++}return i&&t.push({text:i,format:r?"superscript":"normal"}),t}function MF(e,t,n,i,r){const a=[{x:t,y:n},{x:t+i/2,y:n},{x:t+i,y:n},{x:t+i,y:n+r/2},{x:t+i,y:n+r},{x:t+i/2,y:n+r},{x:t,y:n+r},{x:t,y:n+r/2}];e.save(),a.forEach(l=>{e.fillStyle="#4a90e2",e.strokeStyle="#ffffff",e.lineWidth=2,e.fillRect(l.x-8/2,l.y-8/2,8,8),e.strokeRect(l.x-8/2,l.y-8/2,8,8)}),e.restore()}function QF(e,t,n){const{startCol:i,startRow:r,endCol:A,endRow:a}=t,l=It(i,n),c=ie(r,n),h=It(A,n),f=ie(a,n),m=Math.min(l,h),w=Math.min(c,f),B=Math.abs(h-l),y=Math.abs(f-c);e.save(),e.strokeStyle="rgba(74, 144, 226, 0.6)",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(m,w,B,y),e.restore()}function jv(e,t,n){const{path:i,settings:r,type:A}=t;if(!i||i.length<2)return;const a=i.map(c=>({x:It(c.col,n),y:ie(c.row,n)}));e.save(),A==="highlighter"&&(e.globalAlpha=.3),e.strokeStyle=r.color,e.lineWidth=typeof r.size=="number"?r.size:Yp(r.size),e.lineCap="round",e.lineJoin="round",e.beginPath();const l=a[0];if(!l){e.restore();return}e.moveTo(l.x,l.y);for(let c=1;c<a.length;c++){const h=a[c];h&&e.lineTo(h.x,h.y)}e.stroke(),e.restore()}function Yp(e){if(typeof e=="number")return e;switch(e){case"small":return 2;case"medium":return 4;case"large":return 6;default:return 4}}function UF(e){switch(e){case"solid":return[];case"dashed-big":return[10,5];case"dashed-small":return[5,3];case"dotted":return[2,3];default:return[]}}function PF(e,t){const n=t.path;if(!n||n.length<2)return;const i=n[0];if(i){e.save(),e.strokeStyle="#4a90e2",e.lineWidth=2,e.setLineDash([5,5]),e.globalAlpha=.7,e.beginPath(),e.moveTo(i.x,i.y);for(let r=1;r<n.length;r++){const A=n[r];A&&e.lineTo(A.x,A.y)}n.length>2&&e.lineTo(i.x,i.y),e.stroke(),e.restore()}}function DF(e,t){if(!t||t.length<3)return;const n=t[0];if(n){e.save(),e.strokeStyle="#4a90e2",e.lineWidth=2,e.setLineDash([8,4]),e.globalAlpha=.8,e.beginPath(),e.moveTo(n.x,n.y);for(let i=1;i<t.length;i++){const r=t[i];r&&e.lineTo(r.x,r.y)}e.closePath(),e.stroke(),e.fillStyle="rgba(74, 144, 226, 0.1)",e.fill(),e.restore()}}let Jv=0;function N0(){try{if(globalThis.__SN_DEBUG_VIEWPORT)return!0}catch{}try{if(new URLSearchParams(window.location.search).get("debugViewport")==="1")return!0}catch{}try{return localStorage.getItem("sn:debugViewport")==="1"}catch{return!1}}let kF=!1;function LF(e,t){var n;if(N0())try{const i=((n=performance==null?void 0:performance.now)==null?void 0:n.call(performance))??Date.now();if(i-Jv<500)return;Jv=i,kF=!0}catch{}}function RF(e,t){var b,S,F,U,D,H;const n={...d.state,...t};if(!((b=n.columnWidths)!=null&&b.length)||!((S=n.fullRowData)!=null&&S.length))return;e.clearRect(0,0,Vn(e.canvas),tn(e.canvas));const{startRow:i,endRow:r}=PT(),A=Math.max(0,i-1),a=Math.max(0,(((F=n.fullRowData)==null?void 0:F.length)??1)-1),l=Math.min(a,r+1);if(N0()){const Q=tn(e.canvas),R=n.cellHeight/2,V=ie(r,n),O=V+R,K=((U=n.fullRowData)==null?void 0:U.length)??0,z=i<=0,gt=K>0?r>=K-1:!1,St=(D=n.fullRowData)==null?void 0:D[i],wt=(H=n.fullRowData)==null?void 0:H[r];LF("pitchCanvasCoverage",{startRow:i,endRow:r,paddedStartRow:A,paddedEndRow:l,atTopGamutEdge:z,atBottomGamutEdge:gt,canvasHeight:Q,containerHeight:n.viewportHeight,halfUnit:R,yEnd:V,bottomEdge:O,gapCanvasMinusBottomEdge:Q-O,gapCanvasMinusContainer:Q-n.viewportHeight,startRowSummary:St?{pitch:St.pitch,column:St.column,isBoundary:!!St.isBoundary}:null,endRowSummary:wt?{pitch:wt.pitch,column:wt.column,isBoundary:!!wt.isBoundary}:null})}const c=n.cellHeight,h=Q=>{const R=ie(Q,n);return R>=-c&&R<=n.viewportHeight+c},f=n.placedTonicSigns.filter(Q=>Q.globalRow===void 0?!1:h(Q.globalRow)),m=Yl.getLegendLeftContext(),w=Yl.getLegendRightContext();YT(m,w,n,A,l),OT(e,n,A,l),VT(e,n);const B=t.placedNotes.filter(Q=>Q.isDrum||Q.globalRow===void 0?!1:h(Q.globalRow)),y=f;B.forEach(Q=>{Q.shape==="oval"?hg(e,n,Q,Q.globalRow):Q.shape==="circle"&&ug(e,n,Q,Q.globalRow)}),y.forEach(Q=>{P0(e,n,Q)}),sF(e,n),AF(e,n),R0(e,n),EF(e,n)}const O0={getTimeSignatureSegments(){const e=d.state,t=e.macrobeatGroupings??[],n=e.macrobeatBoundaryStyles??[],i=[];let r=!!e.hasAnacrusis,A=Tn(e,0).startColumn,a=0,l=!1;return t.forEach((c,h)=>{a+=c,c===3&&(l=!0);const f=h===t.length-1,w=n[h]==="solid";if(w||f){const y=Tn(e,h).endColumn+1,b=Array.isArray(e.modulationMarkers)&&e.modulationMarkers.length>0,S={...e,modulationMarkers:b?e.modulationMarkers:[],cellWidth:e.cellWidth,columnWidths:e.columnWidths,musicalColumnWidths:e.musicalColumnWidths,baseMicrobeatPx:e.cellWidth},F=It(A,S),U=It(y,S),D=l?`${a}/8`:`${a/2}/4`;i.push({label:D,centerX:(F+U)/2,startX:F,endX:U,isAnacrusis:r}),f||(A=y,a=0,l=!1,w&&(r=!1))}}),i},getRhythmUIButtons(){const e=d.state,t=e.macrobeatGroupings??[],n=e.macrobeatBoundaryStyles??[],i=[],r=In(e),A=new Set(r.map(a=>a.columnIndex+2));return t.forEach((a,l)=>{const c=Tn(e,l),{startColumn:h,endColumn:f}=c,m={...e,modulationMarkers:e.modulationMarkers||[],cellWidth:e.cellWidth,columnWidths:e.columnWidths,musicalColumnWidths:e.columnWidths,baseMicrobeatPx:e.cellWidth},w=It(h,m),B=It(f+1,m),y=(w+B)/2,b=n[l]??null,S=l>0?n[l-1]??null:null,F=S!==null&&A.has(h);i.push({type:"grouping",content:a,x:y,startX:w,endX:B,index:l,nextBoundaryStyle:b,prevBoundaryStyle:S,hasLeftDivider:F}),l<t.length-1&&i.push({type:"boundary",boundaryStyle:b,x:B,index:l})}),i}},HF="data-rhythm-ui-element",jp=e=>`${Math.round(e*100)/100}px`,NF=e=>{e.querySelectorAll(`[${HF}]`).forEach(t=>t.remove())},OF=e=>{const t=document.getElementById("notation-grid");if(!t)return null;const n=t.getBoundingClientRect(),i=e.getBoundingClientRect();return n.width===0?null:n.left-i.left},VF=(e,t)=>{const n=document.createElement("button");return n.type="button",n.className="grouping-segment",n.dataset.rhythmUiElement="grouping",n.dataset.index=`${e.index}`,n.textContent=`${e.content}`,n.style.left=jp(t+e.startX),n.style.width=jp(Math.max(0,e.endX-e.startX)),n.dataset.nextBoundaryStyle=`${e.nextBoundaryStyle??""}`,n.dataset.prevBoundaryStyle=`${e.prevBoundaryStyle??""}`,n.dataset.hasLeftDivider=e.hasLeftDivider?"true":"false",n.setAttribute("aria-label",`Toggle macrobeat grouping (${e.content}) at position ${e.index+1}`),n.addEventListener("click",i=>{i.stopPropagation(),d.toggleMacrobeatGrouping(e.index)}),n},WF=(e,t)=>{const n=document.createElement("button");n.type="button",n.className="buttonGrid-ui-button buttonGrid-ui-button--boundary",n.dataset.rhythmUiElement="boundary",n.dataset.index=`${e.index}`,n.style.left=jp(t+e.x),n.setAttribute("aria-label","Cycle boundary style");const i=document.createElement("span");return i.className="boundary-diamond",i.dataset.style=e.boundaryStyle||"dashed",n.appendChild(i),n.addEventListener("click",r=>{r.stopPropagation(),d.cycleMacrobeatBoundaryStyle(e.index)}),n};function V0(){const e=document.getElementById("beat-line-button-layer");if(!e){x.warn("rhythmUI","Cannot render rhythm UI without beat-line container",null,"ui");return}const t=OF(e);if(t===null)return;const n=e.querySelector("#grouping-buttons-row"),i=e.querySelector("#boundary-buttons-row");NF(e);const r=O0.getRhythmUIButtons();if(!Array.isArray(r)||r.length===0)return;const A=document.createDocumentFragment(),a=document.createDocumentFragment();r.forEach(l=>{l.type==="grouping"?A.appendChild(VF(l,t)):l.type==="boundary"&&a.appendChild(WF(l,t))}),n?n.appendChild(A):e.appendChild(A),i?i.appendChild(a):e.appendChild(a)}const GF={init:KF};function KF(){V0()}const qF={getTimeSignatureOptions(){return{"Single Macrobeat":[{label:"1/4",groupings:[2],description:"one 2-beat"},{label:"2/8",groupings:[2],description:"one 2-beat"},{label:"3/8",groupings:[3],description:"one 3-beat"}],"Two Macrobeats":[{label:"2/4",groupings:[2,2],description:"two 2-beats"},{label:"4/8",groupings:[2,2],description:"two 2-beats"},{label:"5/8",groupings:[2,3],description:"2+3"},{label:"5/8",groupings:[3,2],description:"3+2"},{label:"6/8",groupings:[3,3],description:"two 3-beats"}],"Three Macrobeats":[{label:"3/4",groupings:[2,2,2],description:"three 2-beats"},{label:"7/8",groupings:[2,2,3],description:"2+2+3"},{label:"7/8",groupings:[3,2,2],description:"3+2+2"},{label:"7/8",groupings:[2,3,2],description:"2+3+2"},{label:"8/8",groupings:[3,3,2],description:"3+3+2"},{label:"8/8",groupings:[3,2,3],description:"3+2+3"},{label:"8/8",groupings:[2,3,3],description:"2+3+3"},{label:"9/8",groupings:[3,3,3],description:"three 3-beats"}],"Four Macrobeats":[{label:"4/4",groupings:[2,2,2,2],description:"four 2-beats"},{label:"10/8",groupings:[2,2,3,3],description:"2+2+3+3"},{label:"10/8",groupings:[2,3,2,3],description:"2+3+2+3"},{label:"10/8",groupings:[2,3,3,2],description:"2+3+3+2"},{label:"10/8",groupings:[3,2,3,2],description:"3+2+3+2"},{label:"10/8",groupings:[3,3,2,2],description:"3+3+2+2"},{label:"10/8",groupings:[3,2,2,3],description:"3+2+2+3"},{label:"11/8",groupings:[3,3,3,2],description:"3+3+3+2"},{label:"11/8",groupings:[3,3,2,3],description:"3+3+2+3"},{label:"11/8",groupings:[3,2,3,3],description:"3+2+3+3"},{label:"11/8",groupings:[2,3,3,3],description:"2+3+3+3"},{label:"12/8",groupings:[3,3,3,3],description:"four 3-beats"}],"Five Macrobeats":[{label:"5/4",groupings:[2,2,2,2,2],description:"five 2-beats"},{label:"11/8",groupings:[2,2,2,2,3],description:"2+2+2+2+3"},{label:"11/8",groupings:[2,2,2,3,2],description:"2+2+2+3+2"},{label:"11/8",groupings:[2,2,3,2,2],description:"2+2+3+2+2"},{label:"11/8",groupings:[2,3,2,2,2],description:"2+3+2+2+2"},{label:"11/8",groupings:[3,2,2,2,2],description:"3+2+2+2+2"},{label:"12/8",groupings:[2,2,2,3,3],description:"2+2+2+3+3"},{label:"12/8",groupings:[2,2,3,2,3],description:"2+2+3+2+3"},{label:"12/8",groupings:[2,2,3,3,2],description:"2+2+3+3+2"},{label:"12/8",groupings:[2,3,2,2,3],description:"2+3+2+2+3"},{label:"12/8",groupings:[2,3,2,3,2],description:"2+3+2+3+2"},{label:"12/8",groupings:[2,3,3,2,2],description:"2+3+3+2+2"},{label:"12/8",groupings:[3,2,2,2,3],description:"3+2+2+2+3"},{label:"12/8",groupings:[3,2,2,3,2],description:"3+2+2+3+2"},{label:"12/8",groupings:[3,2,3,2,2],description:"3+2+3+2+2"},{label:"12/8",groupings:[3,3,2,2,2],description:"3+3+2+2+2"},{label:"13/8",groupings:[3,2,2,3,3],description:"3+2+2+3+3"},{label:"13/8",groupings:[3,3,2,3,2],description:"3+3+2+3+2"},{label:"13/8",groupings:[3,3,3,2,2],description:"3+3+3+2+2"},{label:"15/8",groupings:[3,3,3,3,3],description:"five 3-beats"}]}},generateDropdownHTML(){const e=this.getTimeSignatureOptions();let t='<div id="time-signature-dropdown" class="time-signature-dropdown hidden">';return Object.entries(e).forEach(([n,i])=>{t+='<div class="dropdown-category">',t+=`<div class="dropdown-category-header">${n}</div>`,i.forEach((r,A)=>{const a=`${n}-${A}`;t+=`<div class="dropdown-option" data-groupings="${JSON.stringify(r.groupings)}" data-key="${a}">`,t+=`<span class="dropdown-label">${r.label}</span>`,t+=`<span class="dropdown-description">${r.description}</span>`,t+="</div>"}),t+="</div>"}),t+="</div>",t},getTimeSignatureLabel(e){const t=e.reduce((i,r)=>i+r,0);return e.includes(3)?`${t}/8`:`${t/2}/4`}};let Ho=null;function $F(){const e=document.getElementById("beat-line-button-layer");if(!e)return;const t=e.querySelector("#time-signature-row")||e;e.querySelectorAll(".time-signature-label").forEach(c=>c.remove());const i=document.getElementById("notation-grid");if(!i)return;const r=i.getBoundingClientRect(),A=e.getBoundingClientRect(),a=r.left-A.left;O0.getTimeSignatureSegments().forEach((c,h)=>{const f=document.createElement("div");f.className="time-signature-label",c.isAnacrusis&&f.classList.add("anacrusis-label"),f.textContent=c.label,f.style.position="absolute",f.style.left=`${a+c.startX}px`,f.style.width=`${Math.max(0,c.endX-c.startX)}px`,f.style.transform="none",f.style.pointerEvents="auto",f.addEventListener("click",m=>{m.stopPropagation(),XF(f,h)}),t.appendChild(f)}),zF()}function zF(){if(!document.getElementById("time-signature-dropdown")){const e=qF.generateDropdownHTML();document.body.insertAdjacentHTML("beforeend",e);const t=document.getElementById("time-signature-dropdown");t==null||t.addEventListener("click",jF)}}function XF(e,t){const n=document.getElementById("time-signature-dropdown");if(!n)return;n.dataset.measureIndex=String(t);const i=e.getBoundingClientRect();n.style.left=`${i.left}px`,n.style.top=`${i.bottom+5}px`;const r=n.getBoundingClientRect(),A=window.innerWidth,a=window.innerHeight;i.left+r.width>A&&(n.style.left=`${A-r.width-10}px`),i.bottom+r.height>a&&(n.style.top=`${i.top-r.height-5}px`),n.classList.remove("hidden"),Ho={dropdown:n,measureIndex:t},setTimeout(()=>{document.addEventListener("click",YF,{once:!0})},0)}function YF(e){const t=document.getElementById("time-signature-dropdown"),n=e.target;t&&n&&!t.contains(n)&&(t.classList.add("hidden"),Ho=null)}function jF(e){const t=e.target,n=t==null?void 0:t.closest(".dropdown-option");if(!n)return;const i=n.dataset.groupings,r=(Ho==null?void 0:Ho.measureIndex)??NaN;if(!(!i||Number.isNaN(r)))try{const A=JSON.parse(i);d.updateTimeSignature(r,A);const a=document.getElementById("time-signature-dropdown");a==null||a.classList.add("hidden"),Ho=null}catch{}}x.moduleLoaded("PitchGridController","grid");function JF(){var i,r;const e=Yl.getPitchContext();if(!(e!=null&&e.canvas)){x.error("PitchGridController","Pitch grid context not available for rendering",null,"grid");return}const t=cs.getViewportInfo(),n={placedNotes:Y1(d.state),placedTonicSigns:In(d.state),fullRowData:d.state.fullRowData,columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,rowHeight:d.state.cellHeight*.5,macrobeatGroupings:d.state.macrobeatGroupings,macrobeatBoundaryStyles:d.state.macrobeatBoundaryStyles,accidentalMode:d.state.accidentalMode,showFrequencyLabels:d.state.showFrequencyLabels,showOctaveLabels:d.state.showOctaveLabels,colorMode:"color",degreeDisplayMode:d.state.degreeDisplayMode,zoomLevel:t.zoomLevel,viewportHeight:t.containerHeight,modulationMarkers:d.state.modulationMarkers};x.debug("PitchGridController","renderPitchGrid options",{columns:(i=n.columnWidths)==null?void 0:i.length,rows:(r=n.fullRowData)==null?void 0:r.length,placedNotes:n.placedNotes.length,tonicSigns:n.placedTonicSigns.length,zoomLevel:n.zoomLevel,viewportHeight:n.viewportHeight},"grid"),RF(e,n)}const Zl={render(){JF()},renderMacrobeatTools(){V0(),$F()}};/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Jp=function(e,t){return Jp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},Jp(e,t)};function bi(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Jp(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Zp=function(){return Zp=Object.assign||function(t){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var A in n)Object.prototype.hasOwnProperty.call(n,A)&&(t[A]=n[A])}return t},Zp.apply(this,arguments)};function As(e,t,n,i){function r(A){return A instanceof n?A:new n(function(a){a(A)})}return new(n||(n=Promise))(function(A,a){function l(f){try{h(i.next(f))}catch(m){a(m)}}function c(f){try{h(i.throw(f))}catch(m){a(m)}}function h(f){f.done?A(f.value):r(f.value).then(l,c)}h((i=i.apply(e,[])).next())})}function $n(e,t){var n={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},i,r,A,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(f){return c([h,f])}}function c(h){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(A=h[0]&2?r.return:h[0]?r.throw||((A=r.return)&&A.call(r),0):r.next)&&!(A=A.call(r,h[1])).done)return A;switch(r=0,A&&(h=[h[0]&2,A.value]),h[0]){case 0:case 1:A=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,r=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(A=n.trys,!(A=A.length>0&&A[A.length-1])&&(h[0]===6||h[0]===2)){n=0;continue}if(h[0]===3&&(!A||h[1]>A[0]&&h[1]<A[3])){n.label=h[1];break}if(h[0]===6&&n.label<A[1]){n.label=A[1],A=h;break}if(A&&n.label<A[2]){n.label=A[2],n.ops.push(h);break}A[2]&&n.ops.pop(),n.trys.pop();continue}h=t.call(e,n)}catch(f){h=[6,f],r=0}finally{i=A=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Jc(e,t,n){if(arguments.length===2)for(var i=0,r=t.length,A;i<r;i++)(A||!(i in t))&&(A||(A=Array.prototype.slice.call(t,0,i)),A[i]=t[i]);return e.concat(A||t)}var _r=(function(){function e(t,n,i,r){this.left=t,this.top=n,this.width=i,this.height=r}return e.prototype.add=function(t,n,i,r){return new e(this.left+t,this.top+n,this.width+i,this.height+r)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var i=Array.from(n).find(function(r){return r.width!==0});return i?new e(i.left+t.windowBounds.left,i.top+t.windowBounds.top,i.width,i.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e})(),Nh=function(e,t){return _r.fromClientRect(e,t.getBoundingClientRect())},ZF=function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var i=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),r=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new _r(0,0,i,r)},Oh=function(e){for(var t=[],n=0,i=e.length;n<i;){var r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){var A=e.charCodeAt(n++);(A&64512)===56320?t.push(((r&1023)<<10)+(A&1023)+65536):(t.push(r),n--)}else t.push(r)}return t},un=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var i=[],r=-1,A="";++r<n;){var a=e[r];a<=65535?i.push(a):(a-=65536,i.push((a>>10)+55296,a%1024+56320)),(r+1===n||i.length>16384)&&(A+=String.fromCharCode.apply(String,i),i.length=0)}return A},Zv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tI=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Zc=0;Zc<Zv.length;Zc++)tI[Zv.charCodeAt(Zc)]=Zc;var tB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ul=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var tu=0;tu<tB.length;tu++)ul[tB.charCodeAt(tu)]=tu;var eI=function(e){var t=e.length*.75,n=e.length,i,r=0,A,a,l,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var h=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),f=Array.isArray(h)?h:new Uint8Array(h);for(i=0;i<n;i+=4)A=ul[e.charCodeAt(i)],a=ul[e.charCodeAt(i+1)],l=ul[e.charCodeAt(i+2)],c=ul[e.charCodeAt(i+3)],f[r++]=A<<2|a>>4,f[r++]=(a&15)<<4|l>>2,f[r++]=(l&3)<<6|c&63;return h},nI=function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n.push(e[i+1]<<8|e[i]);return n},sI=function(e){for(var t=e.length,n=[],i=0;i<t;i+=4)n.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return n},OA=5,fg=11,qf=2,iI=fg-OA,W0=65536>>OA,rI=1<<OA,$f=rI-1,AI=1024>>OA,oI=W0+AI,aI=oI,lI=32,cI=aI+lI,uI=65536>>fg,hI=1<<iI,dI=hI-1,eB=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},fI=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},pI=function(e,t){var n=eI(e),i=Array.isArray(n)?sI(n):new Uint32Array(n),r=Array.isArray(n)?nI(n):new Uint16Array(n),A=24,a=eB(r,A/2,i[4]/2),l=i[5]===2?eB(r,(A+i[4])/2):fI(i,Math.ceil((A+i[4])/4));return new mI(i[0],i[1],i[2],i[3],a,l)},mI=(function(){function e(t,n,i,r,A,a){this.initialValue=t,this.errorValue=n,this.highStart=i,this.highValueIndex=r,this.index=A,this.data=a}return e.prototype.get=function(t){var n;if(t>=0){if(t<55296||t>56319&&t<=65535)return n=this.index[t>>OA],n=(n<<qf)+(t&$f),this.data[n];if(t<=65535)return n=this.index[W0+(t-55296>>OA)],n=(n<<qf)+(t&$f),this.data[n];if(t<this.highStart)return n=cI-uI+(t>>fg),n=this.index[n],n+=t>>OA&dI,n=this.index[n],n=(n<<qf)+(t&$f),this.data[n];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e})(),nB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",gI=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var eu=0;eu<nB.length;eu++)gI[nB.charCodeAt(eu)]=eu;var wI="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",sB=50,vI=1,G0=2,K0=3,BI=4,yI=5,iB=7,q0=8,rB=9,Zr=10,tm=11,AB=12,em=13,CI=14,hl=15,nm=16,nu=17,Ja=18,bI=19,oB=20,sm=21,Za=22,zf=23,xo=24,Ls=25,dl=26,fl=27,Eo=28,_I=29,IA=30,SI=31,su=32,iu=33,im=34,rm=35,Am=36,tc=37,om=38,Hu=39,Nu=40,Xf=41,$0=42,xI=43,EI=[9001,65288],z0="!",de="",ru="",am=pI(wI),ar=[IA,Am],lm=[vI,G0,K0,yI],X0=[Zr,q0],aB=[fl,dl],TI=lm.concat(X0),lB=[om,Hu,Nu,im,rm],FI=[hl,em],II=function(e,t){t===void 0&&(t="strict");var n=[],i=[],r=[];return e.forEach(function(A,a){var l=am.get(A);if(l>sB?(r.push(!0),l-=sB):r.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(A)!==-1)return i.push(a),n.push(nm);if(l===BI||l===tm){if(a===0)return i.push(a),n.push(IA);var c=n[a-1];return TI.indexOf(c)===-1?(i.push(i[a-1]),n.push(c)):(i.push(a),n.push(IA))}if(i.push(a),l===SI)return n.push(t==="strict"?sm:tc);if(l===$0||l===_I)return n.push(IA);if(l===xI)return A>=131072&&A<=196605||A>=196608&&A<=262141?n.push(tc):n.push(IA);n.push(l)}),[i,n,r]},Yf=function(e,t,n,i){var r=i[n];if(Array.isArray(e)?e.indexOf(r)!==-1:e===r)for(var A=n;A<=i.length;){A++;var a=i[A];if(a===t)return!0;if(a!==Zr)break}if(r===Zr)for(var A=n;A>0;){A--;var l=i[A];if(Array.isArray(e)?e.indexOf(l)!==-1:e===l)for(var c=n;c<=i.length;){c++;var a=i[c];if(a===t)return!0;if(a!==Zr)break}if(l!==Zr)break}return!1},cB=function(e,t){for(var n=e;n>=0;){var i=t[n];if(i===Zr)n--;else return i}return 0},MI=function(e,t,n,i,r){if(n[i]===0)return de;var A=i-1;if(Array.isArray(r)&&r[A]===!0)return de;var a=A-1,l=A+1,c=t[A],h=a>=0?t[a]:0,f=t[l];if(c===G0&&f===K0)return de;if(lm.indexOf(c)!==-1)return z0;if(lm.indexOf(f)!==-1||X0.indexOf(f)!==-1)return de;if(cB(A,t)===q0)return ru;if(am.get(e[A])===tm||(c===su||c===iu)&&am.get(e[l])===tm||c===iB||f===iB||c===rB||[Zr,em,hl].indexOf(c)===-1&&f===rB||[nu,Ja,bI,xo,Eo].indexOf(f)!==-1||cB(A,t)===Za||Yf(zf,Za,A,t)||Yf([nu,Ja],sm,A,t)||Yf(AB,AB,A,t))return de;if(c===Zr)return ru;if(c===zf||f===zf)return de;if(f===nm||c===nm)return ru;if([em,hl,sm].indexOf(f)!==-1||c===CI||h===Am&&FI.indexOf(c)!==-1||c===Eo&&f===Am||f===oB||ar.indexOf(f)!==-1&&c===Ls||ar.indexOf(c)!==-1&&f===Ls||c===fl&&[tc,su,iu].indexOf(f)!==-1||[tc,su,iu].indexOf(c)!==-1&&f===dl||ar.indexOf(c)!==-1&&aB.indexOf(f)!==-1||aB.indexOf(c)!==-1&&ar.indexOf(f)!==-1||[fl,dl].indexOf(c)!==-1&&(f===Ls||[Za,hl].indexOf(f)!==-1&&t[l+1]===Ls)||[Za,hl].indexOf(c)!==-1&&f===Ls||c===Ls&&[Ls,Eo,xo].indexOf(f)!==-1)return de;if([Ls,Eo,xo,nu,Ja].indexOf(f)!==-1)for(var m=A;m>=0;){var w=t[m];if(w===Ls)return de;if([Eo,xo].indexOf(w)!==-1)m--;else break}if([fl,dl].indexOf(f)!==-1)for(var m=[nu,Ja].indexOf(c)!==-1?a:A;m>=0;){var w=t[m];if(w===Ls)return de;if([Eo,xo].indexOf(w)!==-1)m--;else break}if(om===c&&[om,Hu,im,rm].indexOf(f)!==-1||[Hu,im].indexOf(c)!==-1&&[Hu,Nu].indexOf(f)!==-1||[Nu,rm].indexOf(c)!==-1&&f===Nu||lB.indexOf(c)!==-1&&[oB,dl].indexOf(f)!==-1||lB.indexOf(f)!==-1&&c===fl||ar.indexOf(c)!==-1&&ar.indexOf(f)!==-1||c===xo&&ar.indexOf(f)!==-1||ar.concat(Ls).indexOf(c)!==-1&&f===Za&&EI.indexOf(e[l])===-1||ar.concat(Ls).indexOf(f)!==-1&&c===Ja)return de;if(c===Xf&&f===Xf){for(var B=n[A],y=1;B>0&&(B--,t[B]===Xf);)y++;if(y%2!==0)return de}return c===su&&f===iu?de:ru},QI=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=II(e,t.lineBreak),i=n[0],r=n[1],A=n[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(r=r.map(function(l){return[Ls,IA,$0].indexOf(l)!==-1?tc:l}));var a=t.wordBreak==="keep-all"?A.map(function(l,c){return l&&e[c]>=19968&&e[c]<=40959}):void 0;return[i,r,a]},UI=(function(){function e(t,n,i,r){this.codePoints=t,this.required=n===z0,this.start=i,this.end=r}return e.prototype.slice=function(){return un.apply(void 0,this.codePoints.slice(this.start,this.end))},e})(),PI=function(e,t){var n=Oh(e),i=QI(n,t),r=i[0],A=i[1],a=i[2],l=n.length,c=0,h=0;return{next:function(){if(h>=l)return{done:!0,value:null};for(var f=de;h<l&&(f=MI(n,A,r,++h,a))===de;);if(f!==de||h===l){var m=new UI(n,f,c,h);return c=h,{value:m,done:!1}}return{done:!0,value:null}}}},DI=1,kI=2,pc=4,uB=8,rh=10,hB=47,Fl=92,LI=9,RI=32,Au=34,tl=61,HI=35,NI=36,OI=37,ou=39,au=40,el=41,VI=95,Bs=45,WI=33,GI=60,KI=62,qI=64,$I=91,zI=93,XI=61,YI=123,lu=63,jI=125,dB=124,JI=126,ZI=128,fB=65533,jf=42,QA=43,tM=44,eM=58,nM=59,ec=46,sM=0,iM=8,rM=11,AM=14,oM=31,aM=127,Qi=-1,Y0=48,j0=97,J0=101,lM=102,cM=117,uM=122,Z0=65,tC=69,eC=70,hM=85,dM=90,Xn=function(e){return e>=Y0&&e<=57},fM=function(e){return e>=55296&&e<=57343},To=function(e){return Xn(e)||e>=Z0&&e<=eC||e>=j0&&e<=lM},pM=function(e){return e>=j0&&e<=uM},mM=function(e){return e>=Z0&&e<=dM},gM=function(e){return pM(e)||mM(e)},wM=function(e){return e>=ZI},cu=function(e){return e===rh||e===LI||e===RI},Ah=function(e){return gM(e)||wM(e)||e===VI},pB=function(e){return Ah(e)||Xn(e)||e===Bs},vM=function(e){return e>=sM&&e<=iM||e===rM||e>=AM&&e<=oM||e===aM},Gr=function(e,t){return e!==Fl?!1:t!==rh},uu=function(e,t,n){return e===Bs?Ah(t)||Gr(t,n):Ah(e)?!0:!!(e===Fl&&Gr(e,t))},Jf=function(e,t,n){return e===QA||e===Bs?Xn(t)?!0:t===ec&&Xn(n):Xn(e===ec?t:e)},BM=function(e){var t=0,n=1;(e[t]===QA||e[t]===Bs)&&(e[t]===Bs&&(n=-1),t++);for(var i=[];Xn(e[t]);)i.push(e[t++]);var r=i.length?parseInt(un.apply(void 0,i),10):0;e[t]===ec&&t++;for(var A=[];Xn(e[t]);)A.push(e[t++]);var a=A.length,l=a?parseInt(un.apply(void 0,A),10):0;(e[t]===tC||e[t]===J0)&&t++;var c=1;(e[t]===QA||e[t]===Bs)&&(e[t]===Bs&&(c=-1),t++);for(var h=[];Xn(e[t]);)h.push(e[t++]);var f=h.length?parseInt(un.apply(void 0,h),10):0;return n*(r+l*Math.pow(10,-a))*Math.pow(10,c*f)},yM={type:2},CM={type:3},bM={type:4},_M={type:13},SM={type:8},xM={type:21},EM={type:9},TM={type:10},FM={type:11},IM={type:12},MM={type:14},hu={type:23},QM={type:1},UM={type:25},PM={type:24},DM={type:26},kM={type:27},LM={type:28},RM={type:29},HM={type:31},cm={type:32},nC=(function(){function e(){this._value=[]}return e.prototype.write=function(t){this._value=this._value.concat(Oh(t))},e.prototype.read=function(){for(var t=[],n=this.consumeToken();n!==cm;)t.push(n),n=this.consumeToken();return t},e.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case Au:return this.consumeStringToken(Au);case HI:var n=this.peekCodePoint(0),i=this.peekCodePoint(1),r=this.peekCodePoint(2);if(pB(n)||Gr(i,r)){var A=uu(n,i,r)?kI:DI,a=this.consumeName();return{type:5,value:a,flags:A}}break;case NI:if(this.peekCodePoint(0)===tl)return this.consumeCodePoint(),_M;break;case ou:return this.consumeStringToken(ou);case au:return yM;case el:return CM;case jf:if(this.peekCodePoint(0)===tl)return this.consumeCodePoint(),MM;break;case QA:if(Jf(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case tM:return bM;case Bs:var l=t,c=this.peekCodePoint(0),h=this.peekCodePoint(1);if(Jf(l,c,h))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(uu(l,c,h))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(c===Bs&&h===KI)return this.consumeCodePoint(),this.consumeCodePoint(),PM;break;case ec:if(Jf(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case hB:if(this.peekCodePoint(0)===jf)for(this.consumeCodePoint();;){var f=this.consumeCodePoint();if(f===jf&&(f=this.consumeCodePoint(),f===hB))return this.consumeToken();if(f===Qi)return this.consumeToken()}break;case eM:return DM;case nM:return kM;case GI:if(this.peekCodePoint(0)===WI&&this.peekCodePoint(1)===Bs&&this.peekCodePoint(2)===Bs)return this.consumeCodePoint(),this.consumeCodePoint(),UM;break;case qI:var m=this.peekCodePoint(0),w=this.peekCodePoint(1),B=this.peekCodePoint(2);if(uu(m,w,B)){var a=this.consumeName();return{type:7,value:a}}break;case $I:return LM;case Fl:if(Gr(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case zI:return RM;case XI:if(this.peekCodePoint(0)===tl)return this.consumeCodePoint(),SM;break;case YI:return FM;case jI:return IM;case cM:case hM:var y=this.peekCodePoint(0),b=this.peekCodePoint(1);return y===QA&&(To(b)||b===lu)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case dB:if(this.peekCodePoint(0)===tl)return this.consumeCodePoint(),EM;if(this.peekCodePoint(0)===dB)return this.consumeCodePoint(),xM;break;case JI:if(this.peekCodePoint(0)===tl)return this.consumeCodePoint(),TM;break;case Qi:return cm}return cu(t)?(this.consumeWhiteSpace(),HM):Xn(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):Ah(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:un(t)}},e.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},e.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},e.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},e.prototype.consumeUnicodeRangeToken=function(){for(var t=[],n=this.consumeCodePoint();To(n)&&t.length<6;)t.push(n),n=this.consumeCodePoint();for(var i=!1;n===lu&&t.length<6;)t.push(n),n=this.consumeCodePoint(),i=!0;if(i){var r=parseInt(un.apply(void 0,t.map(function(c){return c===lu?Y0:c})),16),A=parseInt(un.apply(void 0,t.map(function(c){return c===lu?eC:c})),16);return{type:30,start:r,end:A}}var a=parseInt(un.apply(void 0,t),16);if(this.peekCodePoint(0)===Bs&&To(this.peekCodePoint(1))){this.consumeCodePoint(),n=this.consumeCodePoint();for(var l=[];To(n)&&l.length<6;)l.push(n),n=this.consumeCodePoint();var A=parseInt(un.apply(void 0,l),16);return{type:30,start:a,end:A}}else return{type:30,start:a,end:a}},e.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===au?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===au?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},e.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Qi)return{type:22,value:""};var n=this.peekCodePoint(0);if(n===ou||n===Au){var i=this.consumeStringToken(this.consumeCodePoint());return i.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Qi||this.peekCodePoint(0)===el)?(this.consumeCodePoint(),{type:22,value:i.value}):(this.consumeBadUrlRemnants(),hu)}for(;;){var r=this.consumeCodePoint();if(r===Qi||r===el)return{type:22,value:un.apply(void 0,t)};if(cu(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Qi||this.peekCodePoint(0)===el?(this.consumeCodePoint(),{type:22,value:un.apply(void 0,t)}):(this.consumeBadUrlRemnants(),hu);if(r===Au||r===ou||r===au||vM(r))return this.consumeBadUrlRemnants(),hu;if(r===Fl)if(Gr(r,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),hu;else t.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;cu(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===el||t===Qi)return;Gr(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(t){for(var n=5e4,i="";t>0;){var r=Math.min(n,t);i+=un.apply(void 0,this._value.splice(0,r)),t-=r}return this._value.shift(),i},e.prototype.consumeStringToken=function(t){var n="",i=0;do{var r=this._value[i];if(r===Qi||r===void 0||r===t)return n+=this.consumeStringSlice(i),{type:0,value:n};if(r===rh)return this._value.splice(0,i),QM;if(r===Fl){var A=this._value[i+1];A!==Qi&&A!==void 0&&(A===rh?(n+=this.consumeStringSlice(i),i=-1,this._value.shift()):Gr(r,A)&&(n+=this.consumeStringSlice(i),n+=un(this.consumeEscapedCodePoint()),i=-1))}i++}while(!0)},e.prototype.consumeNumber=function(){var t=[],n=pc,i=this.peekCodePoint(0);for((i===QA||i===Bs)&&t.push(this.consumeCodePoint());Xn(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(i===ec&&Xn(r))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),n=uB;Xn(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0),r=this.peekCodePoint(1);var A=this.peekCodePoint(2);if((i===tC||i===J0)&&((r===QA||r===Bs)&&Xn(A)||Xn(r)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),n=uB;Xn(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[BM(t),n]},e.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),n=t[0],i=t[1],r=this.peekCodePoint(0),A=this.peekCodePoint(1),a=this.peekCodePoint(2);if(uu(r,A,a)){var l=this.consumeName();return{type:15,number:n,flags:i,unit:l}}return r===OI?(this.consumeCodePoint(),{type:16,number:n,flags:i}):{type:17,number:n,flags:i}},e.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(To(t)){for(var n=un(t);To(this.peekCodePoint(0))&&n.length<6;)n+=un(this.consumeCodePoint());cu(this.peekCodePoint(0))&&this.consumeCodePoint();var i=parseInt(n,16);return i===0||fM(i)||i>1114111?fB:i}return t===Qi?fB:t},e.prototype.consumeName=function(){for(var t="";;){var n=this.consumeCodePoint();if(pB(n))t+=un(n);else if(Gr(n,this.peekCodePoint(0)))t+=un(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(n),t}},e})(),sC=(function(){function e(t){this._tokens=t}return e.create=function(t){var n=new nC;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var n=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return n;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var t=[];;){var n=this.consumeComponentValue();if(n.type===32)return t;t.push(n),t.push()}},e.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},e.prototype.consumeSimpleBlock=function(t){for(var n={type:t,values:[]},i=this.consumeToken();;){if(i.type===32||OM(i,t))return n;this.reconsumeToken(i),n.values.push(this.consumeComponentValue()),i=this.consumeToken()}},e.prototype.consumeFunction=function(t){for(var n={name:t.value,values:[],type:18};;){var i=this.consumeToken();if(i.type===32||i.type===3)return n;this.reconsumeToken(i),n.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?cm:t},e.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},e})(),mc=function(e){return e.type===15},pa=function(e){return e.type===17},De=function(e){return e.type===20},NM=function(e){return e.type===0},um=function(e,t){return De(e)&&e.value===t},iC=function(e){return e.type!==31},oa=function(e){return e.type!==31&&e.type!==4},ji=function(e){var t=[],n=[];return e.forEach(function(i){if(i.type===4){if(n.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(n),n=[];return}i.type!==31&&n.push(i)}),n.length&&t.push(n),t},OM=function(e,t){return t===11&&e.type===12||t===28&&e.type===29?!0:t===2&&e.type===3},hA=function(e){return e.type===17||e.type===15},mn=function(e){return e.type===16||hA(e)},rC=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},Nn={type:17,number:0,flags:pc},pg={type:16,number:50,flags:pc},tA={type:16,number:100,flags:pc},pl=function(e,t,n){var i=e[0],r=e[1];return[Oe(i,t),Oe(typeof r<"u"?r:i,n)]},Oe=function(e,t){if(e.type===16)return e.number/100*t;if(mc(e))switch(e.unit){case"rem":case"em":return 16*e.number;case"px":default:return e.number}return e.number},AC="deg",oC="grad",aC="rad",lC="turn",Vh={name:"angle",parse:function(e,t){if(t.type===15)switch(t.unit){case AC:return Math.PI*t.number/180;case oC:return Math.PI/200*t.number;case aC:return t.number;case lC:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},cC=function(e){return e.type===15&&(e.unit===AC||e.unit===oC||e.unit===aC||e.unit===lC)},uC=function(e){var t=e.filter(De).map(function(n){return n.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Nn,Nn];case"to top":case"bottom":return ti(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Nn,tA];case"to right":case"left":return ti(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[tA,tA];case"to bottom":case"top":return ti(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[tA,Nn];case"to left":case"right":return ti(270)}return 0},ti=function(e){return Math.PI*e/180},AA={name:"color",parse:function(e,t){if(t.type===18){var n=VM[t.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(t.type===5){if(t.value.length===3){var i=t.value.substring(0,1),r=t.value.substring(1,2),A=t.value.substring(2,3);return eA(parseInt(i+i,16),parseInt(r+r,16),parseInt(A+A,16),1)}if(t.value.length===4){var i=t.value.substring(0,1),r=t.value.substring(1,2),A=t.value.substring(2,3),a=t.value.substring(3,4);return eA(parseInt(i+i,16),parseInt(r+r,16),parseInt(A+A,16),parseInt(a+a,16)/255)}if(t.value.length===6){var i=t.value.substring(0,2),r=t.value.substring(2,4),A=t.value.substring(4,6);return eA(parseInt(i,16),parseInt(r,16),parseInt(A,16),1)}if(t.value.length===8){var i=t.value.substring(0,2),r=t.value.substring(2,4),A=t.value.substring(4,6),a=t.value.substring(6,8);return eA(parseInt(i,16),parseInt(r,16),parseInt(A,16),parseInt(a,16)/255)}}if(t.type===20){var l=Cr[t.value.toUpperCase()];if(typeof l<"u")return l}return Cr.TRANSPARENT}},oA=function(e){return(255&e)===0},xn=function(e){var t=255&e,n=255&e>>8,i=255&e>>16,r=255&e>>24;return t<255?"rgba("+r+","+i+","+n+","+t/255+")":"rgb("+r+","+i+","+n+")"},eA=function(e,t,n,i){return(e<<24|t<<16|n<<8|Math.round(i*255)<<0)>>>0},mB=function(e,t){if(e.type===17)return e.number;if(e.type===16){var n=t===3?1:255;return t===3?e.number/100*n:Math.round(e.number/100*n)}return 0},gB=function(e,t){var n=t.filter(oa);if(n.length===3){var i=n.map(mB),r=i[0],A=i[1],a=i[2];return eA(r,A,a,1)}if(n.length===4){var l=n.map(mB),r=l[0],A=l[1],a=l[2],c=l[3];return eA(r,A,a,c)}return 0};function Zf(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<1/2?t:n<2/3?(t-e)*6*(2/3-n)+e:e}var wB=function(e,t){var n=t.filter(oa),i=n[0],r=n[1],A=n[2],a=n[3],l=(i.type===17?ti(i.number):Vh.parse(e,i))/(Math.PI*2),c=mn(r)?r.number/100:0,h=mn(A)?A.number/100:0,f=typeof a<"u"&&mn(a)?Oe(a,1):1;if(c===0)return eA(h*255,h*255,h*255,1);var m=h<=.5?h*(c+1):h+c-h*c,w=h*2-m,B=Zf(w,m,l+1/3),y=Zf(w,m,l),b=Zf(w,m,l-1/3);return eA(B*255,y*255,b*255,f)},VM={hsl:wB,hsla:wB,rgb:gB,rgba:gB},Il=function(e,t){return AA.parse(e,sC.create(t).parseComponentValue())},Cr={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},WM={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(n){if(De(n))switch(n.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},GM={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Wh=function(e,t){var n=AA.parse(e,t[0]),i=t[1];return i&&mn(i)?{color:n,stop:i}:{color:n,stop:null}},vB=function(e,t){var n=e[0],i=e[e.length-1];n.stop===null&&(n.stop=Nn),i.stop===null&&(i.stop=tA);for(var r=[],A=0,a=0;a<e.length;a++){var l=e[a].stop;if(l!==null){var c=Oe(l,t);c>A?r.push(c):r.push(A),A=c}else r.push(null)}for(var h=null,a=0;a<r.length;a++){var f=r[a];if(f===null)h===null&&(h=a);else if(h!==null){for(var m=a-h,w=r[h-1],B=(f-w)/(m+1),y=1;y<=m;y++)r[h+y-1]=B*y;h=null}}return e.map(function(b,S){var F=b.color;return{color:F,stop:Math.max(Math.min(1,r[S]/t),0)}})},KM=function(e,t,n){var i=t/2,r=n/2,A=Oe(e[0],t)-i,a=r-Oe(e[1],n);return(Math.atan2(a,A)+Math.PI*2)%(Math.PI*2)},qM=function(e,t,n){var i=typeof e=="number"?e:KM(e,t,n),r=Math.abs(t*Math.sin(i))+Math.abs(n*Math.cos(i)),A=t/2,a=n/2,l=r/2,c=Math.sin(i-Math.PI/2)*l,h=Math.cos(i-Math.PI/2)*l;return[r,A-h,A+h,a-c,a+c]},di=function(e,t){return Math.sqrt(e*e+t*t)},BB=function(e,t,n,i,r){var A=[[0,0],[0,t],[e,0],[e,t]];return A.reduce(function(a,l){var c=l[0],h=l[1],f=di(n-c,i-h);return(r?f<a.optimumDistance:f>a.optimumDistance)?{optimumCorner:l,optimumDistance:f}:a},{optimumDistance:r?1/0:-1/0,optimumCorner:null}).optimumCorner},$M=function(e,t,n,i,r){var A=0,a=0;switch(e.size){case 0:e.shape===0?A=a=Math.min(Math.abs(t),Math.abs(t-i),Math.abs(n),Math.abs(n-r)):e.shape===1&&(A=Math.min(Math.abs(t),Math.abs(t-i)),a=Math.min(Math.abs(n),Math.abs(n-r)));break;case 2:if(e.shape===0)A=a=Math.min(di(t,n),di(t,n-r),di(t-i,n),di(t-i,n-r));else if(e.shape===1){var l=Math.min(Math.abs(n),Math.abs(n-r))/Math.min(Math.abs(t),Math.abs(t-i)),c=BB(i,r,t,n,!0),h=c[0],f=c[1];A=di(h-t,(f-n)/l),a=l*A}break;case 1:e.shape===0?A=a=Math.max(Math.abs(t),Math.abs(t-i),Math.abs(n),Math.abs(n-r)):e.shape===1&&(A=Math.max(Math.abs(t),Math.abs(t-i)),a=Math.max(Math.abs(n),Math.abs(n-r)));break;case 3:if(e.shape===0)A=a=Math.max(di(t,n),di(t,n-r),di(t-i,n),di(t-i,n-r));else if(e.shape===1){var l=Math.max(Math.abs(n),Math.abs(n-r))/Math.max(Math.abs(t),Math.abs(t-i)),m=BB(i,r,t,n,!1),h=m[0],f=m[1];A=di(h-t,(f-n)/l),a=l*A}break}return Array.isArray(e.size)&&(A=Oe(e.size[0],i),a=e.size.length===2?Oe(e.size[1],r):A),[A,a]},zM=function(e,t){var n=ti(180),i=[];return ji(t).forEach(function(r,A){if(A===0){var a=r[0];if(a.type===20&&a.value==="to"){n=uC(r);return}else if(cC(a)){n=Vh.parse(e,a);return}}var l=Wh(e,r);i.push(l)}),{angle:n,stops:i,type:1}},du=function(e,t){var n=ti(180),i=[];return ji(t).forEach(function(r,A){if(A===0){var a=r[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){n=uC(r);return}else if(cC(a)){n=(Vh.parse(e,a)+ti(270))%ti(360);return}}var l=Wh(e,r);i.push(l)}),{angle:n,stops:i,type:1}},XM=function(e,t){var n=ti(180),i=[],r=1,A=0,a=3,l=[];return ji(t).forEach(function(c,h){var f=c[0];if(h===0){if(De(f)&&f.value==="linear"){r=1;return}else if(De(f)&&f.value==="radial"){r=2;return}}if(f.type===18){if(f.name==="from"){var m=AA.parse(e,f.values[0]);i.push({stop:Nn,color:m})}else if(f.name==="to"){var m=AA.parse(e,f.values[0]);i.push({stop:tA,color:m})}else if(f.name==="color-stop"){var w=f.values.filter(oa);if(w.length===2){var m=AA.parse(e,w[1]),B=w[0];pa(B)&&i.push({stop:{type:16,number:B.number*100,flags:B.flags},color:m})}}}}),r===1?{angle:(n+ti(180))%ti(360),stops:i,type:r}:{size:a,shape:A,stops:i,position:l,type:r}},hC="closest-side",dC="farthest-side",fC="closest-corner",pC="farthest-corner",mC="circle",gC="ellipse",wC="cover",vC="contain",YM=function(e,t){var n=0,i=3,r=[],A=[];return ji(t).forEach(function(a,l){var c=!0;if(l===0){var h=!1;c=a.reduce(function(m,w){if(h)if(De(w))switch(w.value){case"center":return A.push(pg),m;case"top":case"left":return A.push(Nn),m;case"right":case"bottom":return A.push(tA),m}else(mn(w)||hA(w))&&A.push(w);else if(De(w))switch(w.value){case mC:return n=0,!1;case gC:return n=1,!1;case"at":return h=!0,!1;case hC:return i=0,!1;case wC:case dC:return i=1,!1;case vC:case fC:return i=2,!1;case pC:return i=3,!1}else if(hA(w)||mn(w))return Array.isArray(i)||(i=[]),i.push(w),!1;return m},c)}if(c){var f=Wh(e,a);r.push(f)}}),{size:i,shape:n,stops:r,position:A,type:2}},fu=function(e,t){var n=0,i=3,r=[],A=[];return ji(t).forEach(function(a,l){var c=!0;if(l===0?c=a.reduce(function(f,m){if(De(m))switch(m.value){case"center":return A.push(pg),!1;case"top":case"left":return A.push(Nn),!1;case"right":case"bottom":return A.push(tA),!1}else if(mn(m)||hA(m))return A.push(m),!1;return f},c):l===1&&(c=a.reduce(function(f,m){if(De(m))switch(m.value){case mC:return n=0,!1;case gC:return n=1,!1;case vC:case hC:return i=0,!1;case dC:return i=1,!1;case fC:return i=2,!1;case wC:case pC:return i=3,!1}else if(hA(m)||mn(m))return Array.isArray(i)||(i=[]),i.push(m),!1;return f},c)),c){var h=Wh(e,a);r.push(h)}}),{size:i,shape:n,stops:r,position:A,type:2}},jM=function(e){return e.type===1},JM=function(e){return e.type===2},mg={name:"image",parse:function(e,t){if(t.type===22){var n={url:t.value,type:0};return e.cache.addImage(t.value),n}if(t.type===18){var i=BC[t.name];if(typeof i>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return i(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function ZM(e){return!(e.type===20&&e.value==="none")&&(e.type!==18||!!BC[e.name])}var BC={"linear-gradient":zM,"-moz-linear-gradient":du,"-ms-linear-gradient":du,"-o-linear-gradient":du,"-webkit-linear-gradient":du,"radial-gradient":YM,"-moz-radial-gradient":fu,"-ms-radial-gradient":fu,"-o-radial-gradient":fu,"-webkit-radial-gradient":fu,"-webkit-gradient":XM},tQ={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(t.length===0)return[];var n=t[0];return n.type===20&&n.value==="none"?[]:t.filter(function(i){return oa(i)&&ZM(i)}).map(function(i){return mg.parse(e,i)})}},eQ={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(n){if(De(n))switch(n.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},nQ={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return ji(t).map(function(n){return n.filter(mn)}).map(rC)}},sQ={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return ji(t).map(function(n){return n.filter(De).map(function(i){return i.value}).join(" ")}).map(iQ)}},iQ=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},ta;(function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"})(ta||(ta={}));var rQ={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return ji(t).map(function(n){return n.filter(AQ)})}},AQ=function(e){return De(e)||mn(e)},Gh=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},oQ=Gh("top"),aQ=Gh("right"),lQ=Gh("bottom"),cQ=Gh("left"),Kh=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(t,n){return rC(n.filter(mn))}}},uQ=Kh("top-left"),hQ=Kh("top-right"),dQ=Kh("bottom-right"),fQ=Kh("bottom-left"),qh=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,n){switch(n){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},pQ=qh("top"),mQ=qh("right"),gQ=qh("bottom"),wQ=qh("left"),$h=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,n){return mc(n)?n.number:0}}},vQ=$h("top"),BQ=$h("right"),yQ=$h("bottom"),CQ=$h("left"),bQ={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},_Q={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},SQ={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(De).reduce(function(n,i){return n|xQ(i.value)},0)}},xQ=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},EQ={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},TQ={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},oh;(function(e){e.NORMAL="normal",e.STRICT="strict"})(oh||(oh={}));var FQ={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"strict":return oh.STRICT;case"normal":default:return oh.NORMAL}}},IQ={name:"line-height",initialValue:"normal",prefix:!1,type:4},yB=function(e,t){return De(e)&&e.value==="normal"?1.2*t:e.type===17?t*e.number:mn(e)?Oe(e,t):t},MQ={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return t.type===20&&t.value==="none"?null:mg.parse(e,t)}},QQ={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},hm={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},zh=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},UQ=zh("top"),PQ=zh("right"),DQ=zh("bottom"),kQ=zh("left"),LQ={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(De).map(function(n){switch(n.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},RQ={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},Xh=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},HQ=Xh("top"),NQ=Xh("right"),OQ=Xh("bottom"),VQ=Xh("left"),WQ={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},GQ={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},KQ={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.length===1&&um(t[0],"none")?[]:ji(t).map(function(n){for(var i={color:Cr.TRANSPARENT,offsetX:Nn,offsetY:Nn,blur:Nn},r=0,A=0;A<n.length;A++){var a=n[A];hA(a)?(r===0?i.offsetX=a:r===1?i.offsetY=a:i.blur=a,r++):i.color=AA.parse(e,a)}return i})}},qQ={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},$Q={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var n=YQ[t.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},zQ=function(e){var t=e.filter(function(n){return n.type===17}).map(function(n){return n.number});return t.length===6?t:null},XQ=function(e){var t=e.filter(function(c){return c.type===17}).map(function(c){return c.number}),n=t[0],i=t[1];t[2],t[3];var r=t[4],A=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],l=t[13];return t[14],t[15],t.length===16?[n,i,r,A,a,l]:null},YQ={matrix:zQ,matrix3d:XQ},CB={type:16,number:50,flags:pc},jQ=[CB,CB],JQ={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var n=t.filter(mn);return n.length!==2?jQ:[n[0],n[1]]}},ZQ={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Ml;(function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"})(Ml||(Ml={}));var tU={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return Ml.BREAK_ALL;case"keep-all":return Ml.KEEP_ALL;case"normal":default:return Ml.NORMAL}}},eU={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(t.type===20)return{auto:!0,order:0};if(pa(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},yC={name:"time",parse:function(e,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},nU={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return pa(t)?t.number:1}},sU={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},iU={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(De).map(function(n){switch(n.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(n){return n!==0})}},rU={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var n=[],i=[];return t.forEach(function(r){switch(r.type){case 20:case 0:n.push(r.value);break;case 17:n.push(r.number.toString());break;case 4:i.push(n.join(" ")),n.length=0;break}}),n.length&&i.push(n.join(" ")),i.map(function(r){return r.indexOf(" ")===-1?r:"'"+r+"'"})}},AU={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},oU={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){if(pa(t))return t.number;if(De(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},aU={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(De).map(function(n){return n.value})}},lU={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},yn=function(e,t){return(e&t)!==0},cU={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(t.length===0)return[];var n=t[0];return n.type===20&&n.value==="none"?[]:t}},uU={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(t.length===0)return null;var n=t[0];if(n.type===20&&n.value==="none")return null;for(var i=[],r=t.filter(iC),A=0;A<r.length;A++){var a=r[A],l=r[A+1];if(a.type===20){var c=l&&pa(l)?l.number:1;i.push({counter:a.value,increment:c})}}return i}},hU={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(t.length===0)return[];for(var n=[],i=t.filter(iC),r=0;r<i.length;r++){var A=i[r],a=i[r+1];if(De(A)&&A.value!=="none"){var l=a&&pa(a)?a.number:0;n.push({counter:A.value,reset:l})}}return n}},dU={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(mc).map(function(n){return yC.parse(e,n)})}},fU={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(t.length===0)return null;var n=t[0];if(n.type===20&&n.value==="none")return null;var i=[],r=t.filter(NM);if(r.length%2!==0)return null;for(var A=0;A<r.length;A+=2){var a=r[A].value,l=r[A+1].value;i.push({open:a,close:l})}return i}},bB=function(e,t,n){if(!e)return"";var i=e[Math.min(t,e.length-1)];return i?n?i.open:i.close:""},pU={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.length===1&&um(t[0],"none")?[]:ji(t).map(function(n){for(var i={color:255,offsetX:Nn,offsetY:Nn,blur:Nn,spread:Nn,inset:!1},r=0,A=0;A<n.length;A++){var a=n[A];um(a,"inset")?i.inset=!0:hA(a)?(r===0?i.offsetX=a:r===1?i.offsetY=a:r===2?i.blur=a:i.spread=a,r++):i.color=AA.parse(e,a)}return i})}},mU={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var n=[0,1,2],i=[];return t.filter(De).forEach(function(r){switch(r.value){case"stroke":i.push(1);break;case"fill":i.push(0);break;case"markers":i.push(2);break}}),n.forEach(function(r){i.indexOf(r)===-1&&i.push(r)}),i}},gU={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},wU={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return mc(t)?t.number:0}},vU=(function(){function e(t,n){var i,r;this.animationDuration=kt(t,dU,n.animationDuration),this.backgroundClip=kt(t,WM,n.backgroundClip),this.backgroundColor=kt(t,GM,n.backgroundColor),this.backgroundImage=kt(t,tQ,n.backgroundImage),this.backgroundOrigin=kt(t,eQ,n.backgroundOrigin),this.backgroundPosition=kt(t,nQ,n.backgroundPosition),this.backgroundRepeat=kt(t,sQ,n.backgroundRepeat),this.backgroundSize=kt(t,rQ,n.backgroundSize),this.borderTopColor=kt(t,oQ,n.borderTopColor),this.borderRightColor=kt(t,aQ,n.borderRightColor),this.borderBottomColor=kt(t,lQ,n.borderBottomColor),this.borderLeftColor=kt(t,cQ,n.borderLeftColor),this.borderTopLeftRadius=kt(t,uQ,n.borderTopLeftRadius),this.borderTopRightRadius=kt(t,hQ,n.borderTopRightRadius),this.borderBottomRightRadius=kt(t,dQ,n.borderBottomRightRadius),this.borderBottomLeftRadius=kt(t,fQ,n.borderBottomLeftRadius),this.borderTopStyle=kt(t,pQ,n.borderTopStyle),this.borderRightStyle=kt(t,mQ,n.borderRightStyle),this.borderBottomStyle=kt(t,gQ,n.borderBottomStyle),this.borderLeftStyle=kt(t,wQ,n.borderLeftStyle),this.borderTopWidth=kt(t,vQ,n.borderTopWidth),this.borderRightWidth=kt(t,BQ,n.borderRightWidth),this.borderBottomWidth=kt(t,yQ,n.borderBottomWidth),this.borderLeftWidth=kt(t,CQ,n.borderLeftWidth),this.boxShadow=kt(t,pU,n.boxShadow),this.color=kt(t,bQ,n.color),this.direction=kt(t,_Q,n.direction),this.display=kt(t,SQ,n.display),this.float=kt(t,EQ,n.cssFloat),this.fontFamily=kt(t,rU,n.fontFamily),this.fontSize=kt(t,AU,n.fontSize),this.fontStyle=kt(t,lU,n.fontStyle),this.fontVariant=kt(t,aU,n.fontVariant),this.fontWeight=kt(t,oU,n.fontWeight),this.letterSpacing=kt(t,TQ,n.letterSpacing),this.lineBreak=kt(t,FQ,n.lineBreak),this.lineHeight=kt(t,IQ,n.lineHeight),this.listStyleImage=kt(t,MQ,n.listStyleImage),this.listStylePosition=kt(t,QQ,n.listStylePosition),this.listStyleType=kt(t,hm,n.listStyleType),this.marginTop=kt(t,UQ,n.marginTop),this.marginRight=kt(t,PQ,n.marginRight),this.marginBottom=kt(t,DQ,n.marginBottom),this.marginLeft=kt(t,kQ,n.marginLeft),this.opacity=kt(t,nU,n.opacity);var A=kt(t,LQ,n.overflow);this.overflowX=A[0],this.overflowY=A[A.length>1?1:0],this.overflowWrap=kt(t,RQ,n.overflowWrap),this.paddingTop=kt(t,HQ,n.paddingTop),this.paddingRight=kt(t,NQ,n.paddingRight),this.paddingBottom=kt(t,OQ,n.paddingBottom),this.paddingLeft=kt(t,VQ,n.paddingLeft),this.paintOrder=kt(t,mU,n.paintOrder),this.position=kt(t,GQ,n.position),this.textAlign=kt(t,WQ,n.textAlign),this.textDecorationColor=kt(t,sU,(i=n.textDecorationColor)!==null&&i!==void 0?i:n.color),this.textDecorationLine=kt(t,iU,(r=n.textDecorationLine)!==null&&r!==void 0?r:n.textDecoration),this.textShadow=kt(t,KQ,n.textShadow),this.textTransform=kt(t,qQ,n.textTransform),this.transform=kt(t,$Q,n.transform),this.transformOrigin=kt(t,JQ,n.transformOrigin),this.visibility=kt(t,ZQ,n.visibility),this.webkitTextStrokeColor=kt(t,gU,n.webkitTextStrokeColor),this.webkitTextStrokeWidth=kt(t,wU,n.webkitTextStrokeWidth),this.wordBreak=kt(t,tU,n.wordBreak),this.zIndex=kt(t,eU,n.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},e.prototype.isTransparent=function(){return oA(this.backgroundColor)},e.prototype.isTransformed=function(){return this.transform!==null},e.prototype.isPositioned=function(){return this.position!==0},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return this.float!==0},e.prototype.isInlineLevel=function(){return yn(this.display,4)||yn(this.display,33554432)||yn(this.display,268435456)||yn(this.display,536870912)||yn(this.display,67108864)||yn(this.display,134217728)},e})(),BU=(function(){function e(t,n){this.content=kt(t,cU,n.content),this.quotes=kt(t,fU,n.quotes)}return e})(),_B=(function(){function e(t,n){this.counterIncrement=kt(t,uU,n.counterIncrement),this.counterReset=kt(t,hU,n.counterReset)}return e})(),kt=function(e,t,n){var i=new nC,r=n!==null&&typeof n<"u"?n.toString():t.initialValue;i.write(r);var A=new sC(i.read());switch(t.type){case 2:var a=A.parseComponentValue();return t.parse(e,De(a)?a.value:t.initialValue);case 0:return t.parse(e,A.parseComponentValue());case 1:return t.parse(e,A.parseComponentValues());case 4:return A.parseComponentValue();case 3:switch(t.format){case"angle":return Vh.parse(e,A.parseComponentValue());case"color":return AA.parse(e,A.parseComponentValue());case"image":return mg.parse(e,A.parseComponentValue());case"length":var l=A.parseComponentValue();return hA(l)?l:Nn;case"length-percentage":var c=A.parseComponentValue();return mn(c)?c:Nn;case"time":return yC.parse(e,A.parseComponentValue())}break}},yU="data-html2canvas-debug",CU=function(e){var t=e.getAttribute(yU);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},dm=function(e,t){var n=CU(e);return n===1||t===n},Ji=(function(){function e(t,n){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,dm(n,3))debugger;this.styles=new vU(t,window.getComputedStyle(n,null)),mm(n)&&(this.styles.animationDuration.some(function(i){return i>0})&&(n.style.animationDuration="0s"),this.styles.transform!==null&&(n.style.transform="none")),this.bounds=Nh(this.context,n),dm(n,4)&&(this.flags|=16)}return e})(),bU="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",SB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ml=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var pu=0;pu<SB.length;pu++)ml[SB.charCodeAt(pu)]=pu;var _U=function(e){var t=e.length*.75,n=e.length,i,r=0,A,a,l,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var h=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),f=Array.isArray(h)?h:new Uint8Array(h);for(i=0;i<n;i+=4)A=ml[e.charCodeAt(i)],a=ml[e.charCodeAt(i+1)],l=ml[e.charCodeAt(i+2)],c=ml[e.charCodeAt(i+3)],f[r++]=A<<2|a>>4,f[r++]=(a&15)<<4|l>>2,f[r++]=(l&3)<<6|c&63;return h},SU=function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n.push(e[i+1]<<8|e[i]);return n},xU=function(e){for(var t=e.length,n=[],i=0;i<t;i+=4)n.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return n},VA=5,gg=11,tp=2,EU=gg-VA,CC=65536>>VA,TU=1<<VA,ep=TU-1,FU=1024>>VA,IU=CC+FU,MU=IU,QU=32,UU=MU+QU,PU=65536>>gg,DU=1<<EU,kU=DU-1,xB=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},LU=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},RU=function(e,t){var n=_U(e),i=Array.isArray(n)?xU(n):new Uint32Array(n),r=Array.isArray(n)?SU(n):new Uint16Array(n),A=24,a=xB(r,A/2,i[4]/2),l=i[5]===2?xB(r,(A+i[4])/2):LU(i,Math.ceil((A+i[4])/4));return new HU(i[0],i[1],i[2],i[3],a,l)},HU=(function(){function e(t,n,i,r,A,a){this.initialValue=t,this.errorValue=n,this.highStart=i,this.highValueIndex=r,this.index=A,this.data=a}return e.prototype.get=function(t){var n;if(t>=0){if(t<55296||t>56319&&t<=65535)return n=this.index[t>>VA],n=(n<<tp)+(t&ep),this.data[n];if(t<=65535)return n=this.index[CC+(t-55296>>VA)],n=(n<<tp)+(t&ep),this.data[n];if(t<this.highStart)return n=UU-PU+(t>>gg),n=this.index[n],n+=t>>VA&kU,n=this.index[n],n=(n<<tp)+(t&ep),this.data[n];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e})(),EB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",NU=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var mu=0;mu<EB.length;mu++)NU[EB.charCodeAt(mu)]=mu;var OU=1,np=2,sp=3,TB=4,FB=5,VU=7,IB=8,ip=9,rp=10,MB=11,QB=12,UB=13,PB=14,Ap=15,WU=function(e){for(var t=[],n=0,i=e.length;n<i;){var r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){var A=e.charCodeAt(n++);(A&64512)===56320?t.push(((r&1023)<<10)+(A&1023)+65536):(t.push(r),n--)}else t.push(r)}return t},GU=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var i=[],r=-1,A="";++r<n;){var a=e[r];a<=65535?i.push(a):(a-=65536,i.push((a>>10)+55296,a%1024+56320)),(r+1===n||i.length>16384)&&(A+=String.fromCharCode.apply(String,i),i.length=0)}return A},KU=RU(bU),qs="",op="",qU=function(e){return KU.get(e)},$U=function(e,t,n){var i=n-2,r=t[i],A=t[n-1],a=t[n];if(A===np&&a===sp)return qs;if(A===np||A===sp||A===TB||a===np||a===sp||a===TB)return op;if(A===IB&&[IB,ip,MB,QB].indexOf(a)!==-1||(A===MB||A===ip)&&(a===ip||a===rp)||(A===QB||A===rp)&&a===rp||a===UB||a===FB||a===VU||A===OU)return qs;if(A===UB&&a===PB){for(;r===FB;)r=t[--i];if(r===PB)return qs}if(A===Ap&&a===Ap){for(var l=0;r===Ap;)l++,r=t[--i];if(l%2===0)return qs}return op},zU=function(e){var t=WU(e),n=t.length,i=0,r=0,A=t.map(qU);return{next:function(){if(i>=n)return{done:!0,value:null};for(var a=qs;i<n&&(a=$U(t,A,++i))===qs;);if(a!==qs||i===n){var l=GU.apply(null,t.slice(r,i));return r=i,{value:l,done:!1}}return{done:!0,value:null}}}},XU=function(e){for(var t=zU(e),n=[],i;!(i=t.next()).done;)i.value&&n.push(i.value.slice());return n},YU=function(e){var t=123;if(e.createRange){var n=e.createRange();if(n.getBoundingClientRect){var i=e.createElement("boundtest");i.style.height=t+"px",i.style.display="block",e.body.appendChild(i),n.selectNode(i);var r=n.getBoundingClientRect(),A=Math.round(r.height);if(e.body.removeChild(i),A===t)return!0}}return!1},jU=function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var i=t.firstChild,r=Oh(i.data).map(function(c){return un(c)}),A=0,a={},l=r.every(function(c,h){n.setStart(i,A),n.setEnd(i,A+c.length);var f=n.getBoundingClientRect();A+=c.length;var m=f.x>a.x||f.y>a.y;return a=f,h===0?!0:m});return e.body.removeChild(t),l},JU=function(){return typeof new Image().crossOrigin<"u"},ZU=function(){return typeof new XMLHttpRequest().responseType=="string"},tP=function(e){var t=new Image,n=e.createElement("canvas"),i=n.getContext("2d");if(!i)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(t,0,0),n.toDataURL()}catch{return!1}return!0},DB=function(e){return e[0]===0&&e[1]===255&&e[2]===0&&e[3]===255},eP=function(e){var t=e.createElement("canvas"),n=100;t.width=n,t.height=n;var i=t.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,n,n);var r=new Image,A=t.toDataURL();r.src=A;var a=fm(n,n,0,0,r);return i.fillStyle="red",i.fillRect(0,0,n,n),kB(a).then(function(l){i.drawImage(l,0,0);var c=i.getImageData(0,0,n,n).data;i.fillStyle="red",i.fillRect(0,0,n,n);var h=e.createElement("div");return h.style.backgroundImage="url("+A+")",h.style.height=n+"px",DB(c)?kB(fm(n,n,0,0,h)):Promise.reject(!1)}).then(function(l){return i.drawImage(l,0,0),DB(i.getImageData(0,0,n,n).data)}).catch(function(){return!1})},fm=function(e,t,n,i,r){var A="http://www.w3.org/2000/svg",a=document.createElementNS(A,"svg"),l=document.createElementNS(A,"foreignObject");return a.setAttributeNS(null,"width",e.toString()),a.setAttributeNS(null,"height",t.toString()),l.setAttributeNS(null,"width","100%"),l.setAttributeNS(null,"height","100%"),l.setAttributeNS(null,"x",n.toString()),l.setAttributeNS(null,"y",i.toString()),l.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(l),l.appendChild(r),a},kB=function(e){return new Promise(function(t,n){var i=new Image;i.onload=function(){return t(i)},i.onerror=n,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(e))})},Hn={get SUPPORT_RANGE_BOUNDS(){var e=YU(document);return Object.defineProperty(Hn,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Hn.SUPPORT_RANGE_BOUNDS&&jU(document);return Object.defineProperty(Hn,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=tP(document);return Object.defineProperty(Hn,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e=typeof Array.from=="function"&&typeof window.fetch=="function"?eP(document):Promise.resolve(!1);return Object.defineProperty(Hn,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=JU();return Object.defineProperty(Hn,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=ZU();return Object.defineProperty(Hn,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Hn,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Hn,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Ql=(function(){function e(t,n){this.text=t,this.bounds=n}return e})(),nP=function(e,t,n,i){var r=rP(t,n),A=[],a=0;return r.forEach(function(l){if(n.textDecorationLine.length||l.trim().length>0)if(Hn.SUPPORT_RANGE_BOUNDS){var c=LB(i,a,l.length).getClientRects();if(c.length>1){var h=wg(l),f=0;h.forEach(function(w){A.push(new Ql(w,_r.fromDOMRectList(e,LB(i,f+a,w.length).getClientRects()))),f+=w.length})}else A.push(new Ql(l,_r.fromDOMRectList(e,c)))}else{var m=i.splitText(l.length);A.push(new Ql(l,sP(e,i))),i=m}else Hn.SUPPORT_RANGE_BOUNDS||(i=i.splitText(l.length));a+=l.length}),A},sP=function(e,t){var n=t.ownerDocument;if(n){var i=n.createElement("html2canvaswrapper");i.appendChild(t.cloneNode(!0));var r=t.parentNode;if(r){r.replaceChild(i,t);var A=Nh(e,i);return i.firstChild&&r.replaceChild(i.firstChild,i),A}}return _r.EMPTY},LB=function(e,t,n){var i=e.ownerDocument;if(!i)throw new Error("Node has no owner document");var r=i.createRange();return r.setStart(e,t),r.setEnd(e,t+n),r},wg=function(e){if(Hn.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map(function(n){return n.segment})}return XU(e)},iP=function(e,t){if(Hn.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(e)).map(function(i){return i.segment})}return oP(e,t)},rP=function(e,t){return t.letterSpacing!==0?wg(e):iP(e,t)},AP=[32,160,4961,65792,65793,4153,4241],oP=function(e,t){for(var n=PI(e,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),i=[],r,A=function(){if(r.value){var a=r.value.slice(),l=Oh(a),c="";l.forEach(function(h){AP.indexOf(h)===-1?c+=un(h):(c.length&&i.push(c),i.push(un(h)),c="")}),c.length&&i.push(c)}};!(r=n.next()).done;)A();return i},aP=(function(){function e(t,n,i){this.text=lP(n.data,i.textTransform),this.textBounds=nP(t,this.text,i,n)}return e})(),lP=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(cP,uP);case 2:return e.toUpperCase();default:return e}},cP=/(^|\s|:|-|\(|\))([a-z])/g,uP=function(e,t,n){return e.length>0?t+n.toUpperCase():e},bC=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;return r.src=i.currentSrc||i.src,r.intrinsicWidth=i.naturalWidth,r.intrinsicHeight=i.naturalHeight,r.context.cache.addImage(r.src),r}return t})(Ji),_C=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;return r.canvas=i,r.intrinsicWidth=i.width,r.intrinsicHeight=i.height,r}return t})(Ji),SC=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this,A=new XMLSerializer,a=Nh(n,i);return i.setAttribute("width",a.width+"px"),i.setAttribute("height",a.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(A.serializeToString(i)),r.intrinsicWidth=i.width.baseVal.value,r.intrinsicHeight=i.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t})(Ji),xC=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;return r.value=i.value,r}return t})(Ji),pm=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;return r.start=i.start,r.reversed=typeof i.reversed=="boolean"&&i.reversed===!0,r}return t})(Ji),hP=[{type:15,flags:0,unit:"px",number:3}],dP=[{type:16,flags:0,number:50}],fP=function(e){return e.width>e.height?new _r(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new _r(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},pP=function(e){var t=e.type===mP?new Array(e.value.length+1).join(""):e.value;return t.length===0?e.placeholder||"":t},ah="checkbox",lh="radio",mP="password",RB=707406591,vg=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;switch(r.type=i.type.toLowerCase(),r.checked=i.checked,r.value=pP(i),(r.type===ah||r.type===lh)&&(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=fP(r.bounds)),r.type){case ah:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=hP;break;case lh:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=dP;break}return r}return t})(Ji),EC=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this,A=i.options[i.selectedIndex||0];return r.value=A&&A.text||"",r}return t})(Ji),TC=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;return r.value=i.value,r}return t})(Ji),FC=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;r.src=i.src,r.width=parseInt(i.width,10)||0,r.height=parseInt(i.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(i.contentWindow&&i.contentWindow.document&&i.contentWindow.document.documentElement){r.tree=MC(n,i.contentWindow.document.documentElement);var A=i.contentWindow.document.documentElement?Il(n,getComputedStyle(i.contentWindow.document.documentElement).backgroundColor):Cr.TRANSPARENT,a=i.contentWindow.document.body?Il(n,getComputedStyle(i.contentWindow.document.body).backgroundColor):Cr.TRANSPARENT;r.backgroundColor=oA(A)?oA(a)?r.styles.backgroundColor:a:A}}catch{}return r}return t})(Ji),gP=["OL","UL","MENU"],Ou=function(e,t,n,i){for(var r=t.firstChild,A=void 0;r;r=A)if(A=r.nextSibling,QC(r)&&r.data.trim().length>0)n.textNodes.push(new aP(e,r,n.styles));else if(No(r))if(kC(r)&&r.assignedNodes)r.assignedNodes().forEach(function(l){return Ou(e,l,n,i)});else{var a=IC(e,r);a.styles.isVisible()&&(wP(r,a,i)?a.flags|=4:vP(a.styles)&&(a.flags|=2),gP.indexOf(r.tagName)!==-1&&(a.flags|=8),n.elements.push(a),r.slot,r.shadowRoot?Ou(e,r.shadowRoot,a,i):!ch(r)&&!UC(r)&&!uh(r)&&Ou(e,r,a,i))}},IC=function(e,t){return gm(t)?new bC(e,t):PC(t)?new _C(e,t):UC(t)?new SC(e,t):BP(t)?new xC(e,t):yP(t)?new pm(e,t):CP(t)?new vg(e,t):uh(t)?new EC(e,t):ch(t)?new TC(e,t):DC(t)?new FC(e,t):new Ji(e,t)},MC=function(e,t){var n=IC(e,t);return n.flags|=4,Ou(e,t,n,n),n},wP=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Bg(e)&&n.styles.isTransparent()},vP=function(e){return e.isPositioned()||e.isFloating()},QC=function(e){return e.nodeType===Node.TEXT_NODE},No=function(e){return e.nodeType===Node.ELEMENT_NODE},mm=function(e){return No(e)&&typeof e.style<"u"&&!Vu(e)},Vu=function(e){return typeof e.className=="object"},BP=function(e){return e.tagName==="LI"},yP=function(e){return e.tagName==="OL"},CP=function(e){return e.tagName==="INPUT"},bP=function(e){return e.tagName==="HTML"},UC=function(e){return e.tagName==="svg"},Bg=function(e){return e.tagName==="BODY"},PC=function(e){return e.tagName==="CANVAS"},HB=function(e){return e.tagName==="VIDEO"},gm=function(e){return e.tagName==="IMG"},DC=function(e){return e.tagName==="IFRAME"},NB=function(e){return e.tagName==="STYLE"},_P=function(e){return e.tagName==="SCRIPT"},ch=function(e){return e.tagName==="TEXTAREA"},uh=function(e){return e.tagName==="SELECT"},kC=function(e){return e.tagName==="SLOT"},OB=function(e){return e.tagName.indexOf("-")>0},SP=(function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(t){var n=this.counters[t];return n&&n.length?n[n.length-1]:1},e.prototype.getCounterValues=function(t){var n=this.counters[t];return n||[]},e.prototype.pop=function(t){var n=this;t.forEach(function(i){return n.counters[i].pop()})},e.prototype.parse=function(t){var n=this,i=t.counterIncrement,r=t.counterReset,A=!0;i!==null&&i.forEach(function(l){var c=n.counters[l.counter];c&&l.increment!==0&&(A=!1,c.length||c.push(1),c[Math.max(0,c.length-1)]+=l.increment)});var a=[];return A&&r.forEach(function(l){var c=n.counters[l.counter];a.push(l.counter),c||(c=n.counters[l.counter]=[]),c.push(l.reset)}),a},e})(),VB={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},WB={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},xP={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},EP={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Fo=function(e,t,n,i,r,A){return e<t||e>n?nc(e,r,A.length>0):i.integers.reduce(function(a,l,c){for(;e>=l;)e-=l,a+=i.values[c];return a},"")+A},LC=function(e,t,n,i){var r="";do n||e--,r=i(e)+r,e/=t;while(e*t>=t);return r},cn=function(e,t,n,i,r){var A=n-t+1;return(e<0?"-":"")+(LC(Math.abs(e),A,i,function(a){return un(Math.floor(a%A)+t)})+r)},SA=function(e,t,n){n===void 0&&(n=". ");var i=t.length;return LC(Math.abs(e),i,!1,function(r){return t[Math.floor(r%i)]})+n},Do=1,Vr=2,Wr=4,gl=8,lr=function(e,t,n,i,r,A){if(e<-9999||e>9999)return nc(e,4,r.length>0);var a=Math.abs(e),l=r;if(a===0)return t[0]+l;for(var c=0;a>0&&c<=4;c++){var h=a%10;h===0&&yn(A,Do)&&l!==""?l=t[h]+l:h>1||h===1&&c===0||h===1&&c===1&&yn(A,Vr)||h===1&&c===1&&yn(A,Wr)&&e>100||h===1&&c>1&&yn(A,gl)?l=t[h]+(c>0?n[c-1]:"")+l:h===1&&c>0&&(l=n[c-1]+l),a=Math.floor(a/10)}return(e<0?i:"")+l},GB="",KB="",qB="",ap="",nc=function(e,t,n){var i=n?". ":"",r=n?"":"",A=n?", ":"",a=n?" ":"";switch(t){case 0:return""+a;case 1:return""+a;case 2:return""+a;case 5:var l=cn(e,48,57,!0,i);return l.length<4?"0"+l:l;case 4:return SA(e,"",r);case 6:return Fo(e,1,3999,VB,3,i).toLowerCase();case 7:return Fo(e,1,3999,VB,3,i);case 8:return cn(e,945,969,!1,i);case 9:return cn(e,97,122,!1,i);case 10:return cn(e,65,90,!1,i);case 11:return cn(e,1632,1641,!0,i);case 12:case 49:return Fo(e,1,9999,WB,3,i);case 35:return Fo(e,1,9999,WB,3,i).toLowerCase();case 13:return cn(e,2534,2543,!0,i);case 14:case 30:return cn(e,6112,6121,!0,i);case 15:return SA(e,"",r);case 16:return SA(e,"",r);case 17:case 48:return lr(e,"",GB,"",r,Vr|Wr|gl);case 47:return lr(e,"",KB,"",r,Do|Vr|Wr|gl);case 42:return lr(e,"",GB,"",r,Vr|Wr|gl);case 41:return lr(e,"",KB,"",r,Do|Vr|Wr|gl);case 26:return lr(e,"","",qB,r,0);case 25:return lr(e,"","",qB,r,Do|Vr|Wr);case 31:return lr(e,"","",ap,A,Do|Vr|Wr);case 33:return lr(e,"","",ap,A,0);case 32:return lr(e,"","",ap,A,Do|Vr|Wr);case 18:return cn(e,2406,2415,!0,i);case 20:return Fo(e,1,19999,EP,3,i);case 21:return cn(e,2790,2799,!0,i);case 22:return cn(e,2662,2671,!0,i);case 22:return Fo(e,1,10999,xP,3,i);case 23:return SA(e,"");case 24:return SA(e,"");case 27:return cn(e,3302,3311,!0,i);case 28:return SA(e,"",r);case 29:return SA(e,"",r);case 34:return cn(e,3792,3801,!0,i);case 37:return cn(e,6160,6169,!0,i);case 38:return cn(e,4160,4169,!0,i);case 39:return cn(e,2918,2927,!0,i);case 40:return cn(e,1776,1785,!0,i);case 43:return cn(e,3046,3055,!0,i);case 44:return cn(e,3174,3183,!0,i);case 45:return cn(e,3664,3673,!0,i);case 46:return cn(e,3872,3881,!0,i);case 3:default:return cn(e,48,57,!0,i)}},RC="data-html2canvas-ignore",$B=(function(){function e(t,n,i){if(this.context=t,this.options=i,this.scrolledElements=[],this.referenceElement=n,this.counters=new SP,this.quoteDepth=0,!n.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(n.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(t,n){var i=this,r=TP(t,n);if(!r.contentWindow)return Promise.reject("Unable to find iframe window");var A=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,l=r.contentWindow,c=l.document,h=MP(r).then(function(){return As(i,void 0,void 0,function(){var f,m;return $n(this,function(w){switch(w.label){case 0:return this.scrolledElements.forEach(DP),l&&(l.scrollTo(n.left,n.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(l.scrollY!==n.top||l.scrollX!==n.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-n.left,l.scrollY-n.top,0,0))),f=this.options.onclone,m=this.clonedReferenceElement,typeof m>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:c.fonts&&c.fonts.ready?[4,c.fonts.ready]:[3,2];case 1:w.sent(),w.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,IP(c)]:[3,4];case 3:w.sent(),w.label=4;case 4:return typeof f=="function"?[2,Promise.resolve().then(function(){return f(c,m)}).then(function(){return r})]:[2,r]}})})});return c.open(),c.write(UP(document.doctype)+"<html></html>"),PP(this.referenceElement.ownerDocument,A,a),c.replaceChild(c.adoptNode(this.documentElement),c.documentElement),c.close(),h},e.prototype.createElementClone=function(t){if(dm(t,2))debugger;if(PC(t))return this.createCanvasClone(t);if(HB(t))return this.createVideoClone(t);if(NB(t))return this.createStyleClone(t);var n=t.cloneNode(!1);return gm(n)&&(gm(t)&&t.currentSrc&&t.currentSrc!==t.src&&(n.src=t.currentSrc,n.srcset=""),n.loading==="lazy"&&(n.loading="eager")),OB(n)?this.createCustomElementClone(n):n},e.prototype.createCustomElementClone=function(t){var n=document.createElement("html2canvascustomelement");return lp(t.style,n),n},e.prototype.createStyleClone=function(t){try{var n=t.sheet;if(n&&n.cssRules){var i=[].slice.call(n.cssRules,0).reduce(function(A,a){return a&&typeof a.cssText=="string"?A+a.cssText:A},""),r=t.cloneNode(!1);return r.textContent=i,r}}catch(A){if(this.context.logger.error("Unable to access cssRules property",A),A.name!=="SecurityError")throw A}return t.cloneNode(!1)},e.prototype.createCanvasClone=function(t){var n;if(this.options.inlineImages&&t.ownerDocument){var i=t.ownerDocument.createElement("img");try{return i.src=t.toDataURL(),i}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var r=t.cloneNode(!1);try{r.width=t.width,r.height=t.height;var A=t.getContext("2d"),a=r.getContext("2d");if(a)if(!this.options.allowTaint&&A)a.putImageData(A.getImageData(0,0,t.width,t.height),0,0);else{var l=(n=t.getContext("webgl2"))!==null&&n!==void 0?n:t.getContext("webgl");if(l){var c=l.getContextAttributes();(c==null?void 0:c.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}a.drawImage(t,0,0)}return r}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return r},e.prototype.createVideoClone=function(t){var n=t.ownerDocument.createElement("canvas");n.width=t.offsetWidth,n.height=t.offsetHeight;var i=n.getContext("2d");try{return i&&(i.drawImage(t,0,0,n.width,n.height),this.options.allowTaint||i.getImageData(0,0,n.width,n.height)),n}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var r=t.ownerDocument.createElement("canvas");return r.width=t.offsetWidth,r.height=t.offsetHeight,r},e.prototype.appendChildNode=function(t,n,i){(!No(n)||!_P(n)&&!n.hasAttribute(RC)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(n)))&&(!this.options.copyStyles||!No(n)||!NB(n))&&t.appendChild(this.cloneNode(n,i))},e.prototype.cloneChildNodes=function(t,n,i){for(var r=this,A=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;A;A=A.nextSibling)if(No(A)&&kC(A)&&typeof A.assignedNodes=="function"){var a=A.assignedNodes();a.length&&a.forEach(function(l){return r.appendChildNode(n,l,i)})}else this.appendChildNode(n,A,i)},e.prototype.cloneNode=function(t,n){if(QC(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var i=t.ownerDocument.defaultView;if(i&&No(t)&&(mm(t)||Vu(t))){var r=this.createElementClone(t);r.style.transitionProperty="none";var A=i.getComputedStyle(t),a=i.getComputedStyle(t,":before"),l=i.getComputedStyle(t,":after");this.referenceElement===t&&mm(r)&&(this.clonedReferenceElement=r),Bg(r)&&RP(r);var c=this.counters.parse(new _B(this.context,A)),h=this.resolvePseudoContent(t,r,a,Ul.BEFORE);OB(t)&&(n=!0),HB(t)||this.cloneChildNodes(t,r,n),h&&r.insertBefore(h,r.firstChild);var f=this.resolvePseudoContent(t,r,l,Ul.AFTER);return f&&r.appendChild(f),this.counters.pop(c),(A&&(this.options.copyStyles||Vu(t))&&!DC(t)||n)&&lp(A,r),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([r,t.scrollLeft,t.scrollTop]),(ch(t)||uh(t))&&(ch(r)||uh(r))&&(r.value=t.value),r}return t.cloneNode(!1)},e.prototype.resolvePseudoContent=function(t,n,i,r){var A=this;if(i){var a=i.content,l=n.ownerDocument;if(!(!l||!a||a==="none"||a==="-moz-alt-content"||i.display==="none")){this.counters.parse(new _B(this.context,i));var c=new BU(this.context,i),h=l.createElement("html2canvaspseudoelement");lp(i,h),c.content.forEach(function(m){if(m.type===0)h.appendChild(l.createTextNode(m.value));else if(m.type===22){var w=l.createElement("img");w.src=m.value,w.style.opacity="1",h.appendChild(w)}else if(m.type===18){if(m.name==="attr"){var B=m.values.filter(De);B.length&&h.appendChild(l.createTextNode(t.getAttribute(B[0].value)||""))}else if(m.name==="counter"){var y=m.values.filter(oa),b=y[0],S=y[1];if(b&&De(b)){var F=A.counters.getCounterValue(b.value),U=S&&De(S)?hm.parse(A.context,S.value):3;h.appendChild(l.createTextNode(nc(F,U,!1)))}}else if(m.name==="counters"){var D=m.values.filter(oa),b=D[0],H=D[1],S=D[2];if(b&&De(b)){var Q=A.counters.getCounterValues(b.value),R=S&&De(S)?hm.parse(A.context,S.value):3,V=H&&H.type===0?H.value:"",O=Q.map(function(gt){return nc(gt,R,!1)}).join(V);h.appendChild(l.createTextNode(O))}}}else if(m.type===20)switch(m.value){case"open-quote":h.appendChild(l.createTextNode(bB(c.quotes,A.quoteDepth++,!0)));break;case"close-quote":h.appendChild(l.createTextNode(bB(c.quotes,--A.quoteDepth,!1)));break;default:h.appendChild(l.createTextNode(m.value))}}),h.className=wm+" "+vm;var f=r===Ul.BEFORE?" "+wm:" "+vm;return Vu(n)?n.className.baseValue+=f:n.className+=f,h}}},e.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},e})(),Ul;(function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"})(Ul||(Ul={}));var TP=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute(RC,"true"),e.body.appendChild(n),n},FP=function(e){return new Promise(function(t){if(e.complete){t();return}if(!e.src){t();return}e.onload=t,e.onerror=t})},IP=function(e){return Promise.all([].slice.call(e.images,0).map(FP))},MP=function(e){return new Promise(function(t,n){var i=e.contentWindow;if(!i)return n("No window assigned for iframe");var r=i.document;i.onload=e.onload=function(){i.onload=e.onload=null;var A=setInterval(function(){r.body.childNodes.length>0&&r.readyState==="complete"&&(clearInterval(A),t(e))},50)}})},QP=["all","d","content"],lp=function(e,t){for(var n=e.length-1;n>=0;n--){var i=e.item(n);QP.indexOf(i)===-1&&t.style.setProperty(i,e.getPropertyValue(i))}return t},UP=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},PP=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},DP=function(e){var t=e[0],n=e[1],i=e[2];t.scrollLeft=n,t.scrollTop=i},kP=":before",LP=":after",wm="___html2canvas___pseudoelement_before",vm="___html2canvas___pseudoelement_after",zB=`{
    content: "" !important;
    display: none !important;
}`,RP=function(e){HP(e,"."+wm+kP+zB+`
         .`+vm+LP+zB)},HP=function(e,t){var n=e.ownerDocument;if(n){var i=n.createElement("style");i.textContent=t,e.appendChild(i)}},HC=(function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e})(),NP=(function(){function e(t,n){this.context=t,this._options=n,this._cache={}}return e.prototype.addImage=function(t){var n=Promise.resolve();return this.has(t)||(up(t)||GP(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),n},e.prototype.match=function(t){return this._cache[t]},e.prototype.loadImage=function(t){return As(this,void 0,void 0,function(){var n,i,r,A,a=this;return $n(this,function(l){switch(l.label){case 0:return n=HC.isSameOrigin(t),i=!cp(t)&&this._options.useCORS===!0&&Hn.SUPPORT_CORS_IMAGES&&!n,r=!cp(t)&&!n&&!up(t)&&typeof this._options.proxy=="string"&&Hn.SUPPORT_CORS_XHR&&!i,!n&&this._options.allowTaint===!1&&!cp(t)&&!up(t)&&!r&&!i?[2]:(A=t,r?[4,this.proxy(A)]:[3,2]);case 1:A=l.sent(),l.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(c,h){var f=new Image;f.onload=function(){return c(f)},f.onerror=h,(KP(A)||i)&&(f.crossOrigin="anonymous"),f.src=A,f.complete===!0&&setTimeout(function(){return c(f)},500),a._options.imageTimeout>0&&setTimeout(function(){return h("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,l.sent()]}})})},e.prototype.has=function(t){return typeof this._cache[t]<"u"},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(t){var n=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var r=t.substring(0,256);return new Promise(function(A,a){var l=Hn.SUPPORT_RESPONSE_TYPE?"blob":"text",c=new XMLHttpRequest;c.onload=function(){if(c.status===200)if(l==="text")A(c.response);else{var m=new FileReader;m.addEventListener("load",function(){return A(m.result)},!1),m.addEventListener("error",function(w){return a(w)},!1),m.readAsDataURL(c.response)}else a("Failed to proxy resource "+r+" with status code "+c.status)},c.onerror=a;var h=i.indexOf("?")>-1?"&":"?";if(c.open("GET",""+i+h+"url="+encodeURIComponent(t)+"&responseType="+l),l!=="text"&&c instanceof XMLHttpRequest&&(c.responseType=l),n._options.imageTimeout){var f=n._options.imageTimeout;c.timeout=f,c.ontimeout=function(){return a("Timed out ("+f+"ms) proxying "+r)}}c.send()})},e})(),OP=/^data:image\/svg\+xml/i,VP=/^data:image\/.*;base64,/i,WP=/^data:image\/.*/i,GP=function(e){return Hn.SUPPORT_SVG_DRAWING||!qP(e)},cp=function(e){return WP.test(e)},KP=function(e){return VP.test(e)},up=function(e){return e.substr(0,4)==="blob"},qP=function(e){return e.substr(-3).toLowerCase()==="svg"||OP.test(e)},Ut=(function(){function e(t,n){this.type=0,this.x=t,this.y=n}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e})(),Io=function(e,t,n){return new Ut(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},gu=(function(){function e(t,n,i,r){this.type=1,this.start=t,this.startControl=n,this.endControl=i,this.end=r}return e.prototype.subdivide=function(t,n){var i=Io(this.start,this.startControl,t),r=Io(this.startControl,this.endControl,t),A=Io(this.endControl,this.end,t),a=Io(i,r,t),l=Io(r,A,t),c=Io(a,l,t);return n?new e(this.start,i,a,c):new e(c,l,A,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e})(),Js=function(e){return e.type===1},$P=(function(){function e(t){var n=t.styles,i=t.bounds,r=pl(n.borderTopLeftRadius,i.width,i.height),A=r[0],a=r[1],l=pl(n.borderTopRightRadius,i.width,i.height),c=l[0],h=l[1],f=pl(n.borderBottomRightRadius,i.width,i.height),m=f[0],w=f[1],B=pl(n.borderBottomLeftRadius,i.width,i.height),y=B[0],b=B[1],S=[];S.push((A+c)/i.width),S.push((y+m)/i.width),S.push((a+b)/i.height),S.push((h+w)/i.height);var F=Math.max.apply(Math,S);F>1&&(A/=F,a/=F,c/=F,h/=F,m/=F,w/=F,y/=F,b/=F);var U=i.width-c,D=i.height-w,H=i.width-m,Q=i.height-b,R=n.borderTopWidth,V=n.borderRightWidth,O=n.borderBottomWidth,K=n.borderLeftWidth,z=Oe(n.paddingTop,t.bounds.width),gt=Oe(n.paddingRight,t.bounds.width),St=Oe(n.paddingBottom,t.bounds.width),wt=Oe(n.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=A>0||a>0?Je(i.left+K/3,i.top+R/3,A-K/3,a-R/3,_e.TOP_LEFT):new Ut(i.left+K/3,i.top+R/3),this.topRightBorderDoubleOuterBox=A>0||a>0?Je(i.left+U,i.top+R/3,c-V/3,h-R/3,_e.TOP_RIGHT):new Ut(i.left+i.width-V/3,i.top+R/3),this.bottomRightBorderDoubleOuterBox=m>0||w>0?Je(i.left+H,i.top+D,m-V/3,w-O/3,_e.BOTTOM_RIGHT):new Ut(i.left+i.width-V/3,i.top+i.height-O/3),this.bottomLeftBorderDoubleOuterBox=y>0||b>0?Je(i.left+K/3,i.top+Q,y-K/3,b-O/3,_e.BOTTOM_LEFT):new Ut(i.left+K/3,i.top+i.height-O/3),this.topLeftBorderDoubleInnerBox=A>0||a>0?Je(i.left+K*2/3,i.top+R*2/3,A-K*2/3,a-R*2/3,_e.TOP_LEFT):new Ut(i.left+K*2/3,i.top+R*2/3),this.topRightBorderDoubleInnerBox=A>0||a>0?Je(i.left+U,i.top+R*2/3,c-V*2/3,h-R*2/3,_e.TOP_RIGHT):new Ut(i.left+i.width-V*2/3,i.top+R*2/3),this.bottomRightBorderDoubleInnerBox=m>0||w>0?Je(i.left+H,i.top+D,m-V*2/3,w-O*2/3,_e.BOTTOM_RIGHT):new Ut(i.left+i.width-V*2/3,i.top+i.height-O*2/3),this.bottomLeftBorderDoubleInnerBox=y>0||b>0?Je(i.left+K*2/3,i.top+Q,y-K*2/3,b-O*2/3,_e.BOTTOM_LEFT):new Ut(i.left+K*2/3,i.top+i.height-O*2/3),this.topLeftBorderStroke=A>0||a>0?Je(i.left+K/2,i.top+R/2,A-K/2,a-R/2,_e.TOP_LEFT):new Ut(i.left+K/2,i.top+R/2),this.topRightBorderStroke=A>0||a>0?Je(i.left+U,i.top+R/2,c-V/2,h-R/2,_e.TOP_RIGHT):new Ut(i.left+i.width-V/2,i.top+R/2),this.bottomRightBorderStroke=m>0||w>0?Je(i.left+H,i.top+D,m-V/2,w-O/2,_e.BOTTOM_RIGHT):new Ut(i.left+i.width-V/2,i.top+i.height-O/2),this.bottomLeftBorderStroke=y>0||b>0?Je(i.left+K/2,i.top+Q,y-K/2,b-O/2,_e.BOTTOM_LEFT):new Ut(i.left+K/2,i.top+i.height-O/2),this.topLeftBorderBox=A>0||a>0?Je(i.left,i.top,A,a,_e.TOP_LEFT):new Ut(i.left,i.top),this.topRightBorderBox=c>0||h>0?Je(i.left+U,i.top,c,h,_e.TOP_RIGHT):new Ut(i.left+i.width,i.top),this.bottomRightBorderBox=m>0||w>0?Je(i.left+H,i.top+D,m,w,_e.BOTTOM_RIGHT):new Ut(i.left+i.width,i.top+i.height),this.bottomLeftBorderBox=y>0||b>0?Je(i.left,i.top+Q,y,b,_e.BOTTOM_LEFT):new Ut(i.left,i.top+i.height),this.topLeftPaddingBox=A>0||a>0?Je(i.left+K,i.top+R,Math.max(0,A-K),Math.max(0,a-R),_e.TOP_LEFT):new Ut(i.left+K,i.top+R),this.topRightPaddingBox=c>0||h>0?Je(i.left+Math.min(U,i.width-V),i.top+R,U>i.width+V?0:Math.max(0,c-V),Math.max(0,h-R),_e.TOP_RIGHT):new Ut(i.left+i.width-V,i.top+R),this.bottomRightPaddingBox=m>0||w>0?Je(i.left+Math.min(H,i.width-K),i.top+Math.min(D,i.height-O),Math.max(0,m-V),Math.max(0,w-O),_e.BOTTOM_RIGHT):new Ut(i.left+i.width-V,i.top+i.height-O),this.bottomLeftPaddingBox=y>0||b>0?Je(i.left+K,i.top+Math.min(Q,i.height-O),Math.max(0,y-K),Math.max(0,b-O),_e.BOTTOM_LEFT):new Ut(i.left+K,i.top+i.height-O),this.topLeftContentBox=A>0||a>0?Je(i.left+K+wt,i.top+R+z,Math.max(0,A-(K+wt)),Math.max(0,a-(R+z)),_e.TOP_LEFT):new Ut(i.left+K+wt,i.top+R+z),this.topRightContentBox=c>0||h>0?Je(i.left+Math.min(U,i.width+K+wt),i.top+R+z,U>i.width+K+wt?0:c-K+wt,h-(R+z),_e.TOP_RIGHT):new Ut(i.left+i.width-(V+gt),i.top+R+z),this.bottomRightContentBox=m>0||w>0?Je(i.left+Math.min(H,i.width-(K+wt)),i.top+Math.min(D,i.height+R+z),Math.max(0,m-(V+gt)),w-(O+St),_e.BOTTOM_RIGHT):new Ut(i.left+i.width-(V+gt),i.top+i.height-(O+St)),this.bottomLeftContentBox=y>0||b>0?Je(i.left+K+wt,i.top+Q,Math.max(0,y-(K+wt)),b-(O+St),_e.BOTTOM_LEFT):new Ut(i.left+K+wt,i.top+i.height-(O+St))}return e})(),_e;(function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(_e||(_e={}));var Je=function(e,t,n,i,r){var A=4*((Math.sqrt(2)-1)/3),a=n*A,l=i*A,c=e+n,h=t+i;switch(r){case _e.TOP_LEFT:return new gu(new Ut(e,h),new Ut(e,h-l),new Ut(c-a,t),new Ut(c,t));case _e.TOP_RIGHT:return new gu(new Ut(e,t),new Ut(e+a,t),new Ut(c,h-l),new Ut(c,h));case _e.BOTTOM_RIGHT:return new gu(new Ut(c,t),new Ut(c,t+l),new Ut(e+a,h),new Ut(e,h));case _e.BOTTOM_LEFT:default:return new gu(new Ut(c,h),new Ut(c-a,h),new Ut(e,t+l),new Ut(e,t))}},hh=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},zP=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},dh=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},XP=(function(){function e(t,n,i){this.offsetX=t,this.offsetY=n,this.matrix=i,this.type=0,this.target=6}return e})(),wu=(function(){function e(t,n){this.path=t,this.target=n,this.type=1}return e})(),YP=(function(){function e(t){this.opacity=t,this.type=2,this.target=6}return e})(),jP=function(e){return e.type===0},NC=function(e){return e.type===1},JP=function(e){return e.type===2},XB=function(e,t){return e.length===t.length?e.some(function(n,i){return n===t[i]}):!1},ZP=function(e,t,n,i,r){return e.map(function(A,a){switch(a){case 0:return A.add(t,n);case 1:return A.add(t+i,n);case 2:return A.add(t+i,n+r);case 3:return A.add(t,n+r)}return A})},OC=(function(){function e(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return e})(),VC=(function(){function e(t,n){if(this.container=t,this.parent=n,this.effects=[],this.curves=new $P(this.container),this.container.styles.opacity<1&&this.effects.push(new YP(this.container.styles.opacity)),this.container.styles.transform!==null){var i=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,A=this.container.styles.transform;this.effects.push(new XP(i,r,A))}if(this.container.styles.overflowX!==0){var a=hh(this.curves),l=dh(this.curves);XB(a,l)?this.effects.push(new wu(a,6)):(this.effects.push(new wu(a,2)),this.effects.push(new wu(l,4)))}}return e.prototype.getEffects=function(t){for(var n=[2,3].indexOf(this.container.styles.position)===-1,i=this.parent,r=this.effects.slice(0);i;){var A=i.effects.filter(function(c){return!NC(c)});if(n||i.container.styles.position!==0||!i.parent){if(r.unshift.apply(r,A),n=[2,3].indexOf(i.container.styles.position)===-1,i.container.styles.overflowX!==0){var a=hh(i.curves),l=dh(i.curves);XB(a,l)||r.unshift(new wu(l,6))}}else r.unshift.apply(r,A);i=i.parent}return r.filter(function(c){return yn(c.target,t)})},e})(),Bm=function(e,t,n,i){e.container.elements.forEach(function(r){var A=yn(r.flags,4),a=yn(r.flags,2),l=new VC(r,e);yn(r.styles.display,2048)&&i.push(l);var c=yn(r.flags,8)?[]:i;if(A||a){var h=A||r.styles.isPositioned()?n:t,f=new OC(l);if(r.styles.isPositioned()||r.styles.opacity<1||r.styles.isTransformed()){var m=r.styles.zIndex.order;if(m<0){var w=0;h.negativeZIndex.some(function(y,b){return m>y.element.container.styles.zIndex.order?(w=b,!1):w>0}),h.negativeZIndex.splice(w,0,f)}else if(m>0){var B=0;h.positiveZIndex.some(function(y,b){return m>=y.element.container.styles.zIndex.order?(B=b+1,!1):B>0}),h.positiveZIndex.splice(B,0,f)}else h.zeroOrAutoZIndexOrTransformedOrOpacity.push(f)}else r.styles.isFloating()?h.nonPositionedFloats.push(f):h.nonPositionedInlineLevel.push(f);Bm(l,f,A?f:n,c)}else r.styles.isInlineLevel()?t.inlineLevel.push(l):t.nonInlineLevel.push(l),Bm(l,t,n,c);yn(r.flags,8)&&WC(r,c)})},WC=function(e,t){for(var n=e instanceof pm?e.start:1,i=e instanceof pm?e.reversed:!1,r=0;r<t.length;r++){var A=t[r];A.container instanceof xC&&typeof A.container.value=="number"&&A.container.value!==0&&(n=A.container.value),A.listValue=nc(n,A.container.styles.listStyleType,!0),n+=i?-1:1}},tD=function(e){var t=new VC(e,null),n=new OC(t),i=[];return Bm(t,n,n,i),WC(t.container,i),n},YB=function(e,t){switch(t){case 0:return ei(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return ei(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return ei(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);case 3:default:return ei(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},eD=function(e,t){switch(t){case 0:return ei(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return ei(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return ei(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);case 3:default:return ei(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},nD=function(e,t){switch(t){case 0:return ei(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return ei(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return ei(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);case 3:default:return ei(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},sD=function(e,t){switch(t){case 0:return vu(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return vu(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return vu(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);case 3:default:return vu(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},vu=function(e,t){var n=[];return Js(e)?n.push(e.subdivide(.5,!1)):n.push(e),Js(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},ei=function(e,t,n,i){var r=[];return Js(e)?r.push(e.subdivide(.5,!1)):r.push(e),Js(n)?r.push(n.subdivide(.5,!0)):r.push(n),Js(i)?r.push(i.subdivide(.5,!0).reverse()):r.push(i),Js(t)?r.push(t.subdivide(.5,!1).reverse()):r.push(t),r},GC=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},fh=function(e){var t=e.styles,n=e.bounds,i=Oe(t.paddingLeft,n.width),r=Oe(t.paddingRight,n.width),A=Oe(t.paddingTop,n.width),a=Oe(t.paddingBottom,n.width);return n.add(i+t.borderLeftWidth,A+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+i+r),-(t.borderTopWidth+t.borderBottomWidth+A+a))},iD=function(e,t){return e===0?t.bounds:e===2?fh(t):GC(t)},rD=function(e,t){return e===0?t.bounds:e===2?fh(t):GC(t)},hp=function(e,t,n){var i=iD(ko(e.styles.backgroundOrigin,t),e),r=rD(ko(e.styles.backgroundClip,t),e),A=AD(ko(e.styles.backgroundSize,t),n,i),a=A[0],l=A[1],c=pl(ko(e.styles.backgroundPosition,t),i.width-a,i.height-l),h=oD(ko(e.styles.backgroundRepeat,t),c,A,i,r),f=Math.round(i.left+c[0]),m=Math.round(i.top+c[1]);return[h,f,m,a,l]},Mo=function(e){return De(e)&&e.value===ta.AUTO},Bu=function(e){return typeof e=="number"},AD=function(e,t,n){var i=t[0],r=t[1],A=t[2],a=e[0],l=e[1];if(!a)return[0,0];if(mn(a)&&l&&mn(l))return[Oe(a,n.width),Oe(l,n.height)];var c=Bu(A);if(De(a)&&(a.value===ta.CONTAIN||a.value===ta.COVER)){if(Bu(A)){var h=n.width/n.height;return h<A!=(a.value===ta.COVER)?[n.width,n.width/A]:[n.height*A,n.height]}return[n.width,n.height]}var f=Bu(i),m=Bu(r),w=f||m;if(Mo(a)&&(!l||Mo(l))){if(f&&m)return[i,r];if(!c&&!w)return[n.width,n.height];if(w&&c){var B=f?i:r*A,y=m?r:i/A;return[B,y]}var b=f?i:n.width,S=m?r:n.height;return[b,S]}if(c){var F=0,U=0;return mn(a)?F=Oe(a,n.width):mn(l)&&(U=Oe(l,n.height)),Mo(a)?F=U*A:(!l||Mo(l))&&(U=F/A),[F,U]}var D=null,H=null;if(mn(a)?D=Oe(a,n.width):l&&mn(l)&&(H=Oe(l,n.height)),D!==null&&(!l||Mo(l))&&(H=f&&m?D/i*r:n.height),H!==null&&Mo(a)&&(D=f&&m?H/r*i:n.width),D!==null&&H!==null)return[D,H];throw new Error("Unable to calculate background-size for element")},ko=function(e,t){var n=e[t];return typeof n>"u"?e[0]:n},oD=function(e,t,n,i,r){var A=t[0],a=t[1],l=n[0],c=n[1];switch(e){case 2:return[new Ut(Math.round(i.left),Math.round(i.top+a)),new Ut(Math.round(i.left+i.width),Math.round(i.top+a)),new Ut(Math.round(i.left+i.width),Math.round(c+i.top+a)),new Ut(Math.round(i.left),Math.round(c+i.top+a))];case 3:return[new Ut(Math.round(i.left+A),Math.round(i.top)),new Ut(Math.round(i.left+A+l),Math.round(i.top)),new Ut(Math.round(i.left+A+l),Math.round(i.height+i.top)),new Ut(Math.round(i.left+A),Math.round(i.height+i.top))];case 1:return[new Ut(Math.round(i.left+A),Math.round(i.top+a)),new Ut(Math.round(i.left+A+l),Math.round(i.top+a)),new Ut(Math.round(i.left+A+l),Math.round(i.top+a+c)),new Ut(Math.round(i.left+A),Math.round(i.top+a+c))];default:return[new Ut(Math.round(r.left),Math.round(r.top)),new Ut(Math.round(r.left+r.width),Math.round(r.top)),new Ut(Math.round(r.left+r.width),Math.round(r.height+r.top)),new Ut(Math.round(r.left),Math.round(r.height+r.top))]}},aD="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",jB="Hidden Text",lD=(function(){function e(t){this._data={},this._document=t}return e.prototype.parseMetrics=function(t,n){var i=this._document.createElement("div"),r=this._document.createElement("img"),A=this._document.createElement("span"),a=this._document.body;i.style.visibility="hidden",i.style.fontFamily=t,i.style.fontSize=n,i.style.margin="0",i.style.padding="0",i.style.whiteSpace="nowrap",a.appendChild(i),r.src=aD,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",A.style.fontFamily=t,A.style.fontSize=n,A.style.margin="0",A.style.padding="0",A.appendChild(this._document.createTextNode(jB)),i.appendChild(A),i.appendChild(r);var l=r.offsetTop-A.offsetTop+2;i.removeChild(A),i.appendChild(this._document.createTextNode(jB)),i.style.lineHeight="normal",r.style.verticalAlign="super";var c=r.offsetTop-i.offsetTop+2;return a.removeChild(i),{baseline:l,middle:c}},e.prototype.getMetrics=function(t,n){var i=t+" "+n;return typeof this._data[i]>"u"&&(this._data[i]=this.parseMetrics(t,n)),this._data[i]},e})(),KC=(function(){function e(t,n){this.context=t,this.options=n}return e})(),cD=1e4,uD=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;return r._activeEffects=[],r.canvas=i.canvas?i.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),i.canvas||(r.canvas.width=Math.floor(i.width*i.scale),r.canvas.height=Math.floor(i.height*i.scale),r.canvas.style.width=i.width+"px",r.canvas.style.height=i.height+"px"),r.fontMetrics=new lD(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-i.x,-i.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+i.width+"x"+i.height+") with scale "+i.scale),r}return t.prototype.applyEffects=function(n){for(var i=this;this._activeEffects.length;)this.popEffect();n.forEach(function(r){return i.applyEffect(r)})},t.prototype.applyEffect=function(n){this.ctx.save(),JP(n)&&(this.ctx.globalAlpha=n.opacity),jP(n)&&(this.ctx.translate(n.offsetX,n.offsetY),this.ctx.transform(n.matrix[0],n.matrix[1],n.matrix[2],n.matrix[3],n.matrix[4],n.matrix[5]),this.ctx.translate(-n.offsetX,-n.offsetY)),NC(n)&&(this.path(n.path),this.ctx.clip()),this._activeEffects.push(n)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(n){return As(this,void 0,void 0,function(){var i;return $n(this,function(r){switch(r.label){case 0:return i=n.element.container.styles,i.isVisible()?[4,this.renderStackContent(n)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(n){return As(this,void 0,void 0,function(){return $n(this,function(i){switch(i.label){case 0:if(yn(n.container.flags,16))debugger;return n.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(n)]:[3,3];case 1:return i.sent(),[4,this.renderNodeContent(n)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(n,i,r){var A=this;if(i===0)this.ctx.fillText(n.text,n.bounds.left,n.bounds.top+r);else{var a=wg(n.text);a.reduce(function(l,c){return A.ctx.fillText(c,l,n.bounds.top+r),l+A.ctx.measureText(c).width},n.bounds.left)}},t.prototype.createFontStyle=function(n){var i=n.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),r=mD(n.fontFamily).join(", "),A=mc(n.fontSize)?""+n.fontSize.number+n.fontSize.unit:n.fontSize.number+"px";return[[n.fontStyle,i,n.fontWeight,A,r].join(" "),r,A]},t.prototype.renderTextNode=function(n,i){return As(this,void 0,void 0,function(){var r,A,a,l,c,h,f,m,w=this;return $n(this,function(B){return r=this.createFontStyle(i),A=r[0],a=r[1],l=r[2],this.ctx.font=A,this.ctx.direction=i.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",c=this.fontMetrics.getMetrics(a,l),h=c.baseline,f=c.middle,m=i.paintOrder,n.textBounds.forEach(function(y){m.forEach(function(b){switch(b){case 0:w.ctx.fillStyle=xn(i.color),w.renderTextWithLetterSpacing(y,i.letterSpacing,h);var S=i.textShadow;S.length&&y.text.trim().length&&(S.slice(0).reverse().forEach(function(F){w.ctx.shadowColor=xn(F.color),w.ctx.shadowOffsetX=F.offsetX.number*w.options.scale,w.ctx.shadowOffsetY=F.offsetY.number*w.options.scale,w.ctx.shadowBlur=F.blur.number,w.renderTextWithLetterSpacing(y,i.letterSpacing,h)}),w.ctx.shadowColor="",w.ctx.shadowOffsetX=0,w.ctx.shadowOffsetY=0,w.ctx.shadowBlur=0),i.textDecorationLine.length&&(w.ctx.fillStyle=xn(i.textDecorationColor||i.color),i.textDecorationLine.forEach(function(F){switch(F){case 1:w.ctx.fillRect(y.bounds.left,Math.round(y.bounds.top+h),y.bounds.width,1);break;case 2:w.ctx.fillRect(y.bounds.left,Math.round(y.bounds.top),y.bounds.width,1);break;case 3:w.ctx.fillRect(y.bounds.left,Math.ceil(y.bounds.top+f),y.bounds.width,1);break}}));break;case 1:i.webkitTextStrokeWidth&&y.text.trim().length&&(w.ctx.strokeStyle=xn(i.webkitTextStrokeColor),w.ctx.lineWidth=i.webkitTextStrokeWidth,w.ctx.lineJoin=window.chrome?"miter":"round",w.ctx.strokeText(y.text,y.bounds.left,y.bounds.top+h)),w.ctx.strokeStyle="",w.ctx.lineWidth=0,w.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(n,i,r){if(r&&n.intrinsicWidth>0&&n.intrinsicHeight>0){var A=fh(n),a=dh(i);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,n.intrinsicWidth,n.intrinsicHeight,A.left,A.top,A.width,A.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(n){return As(this,void 0,void 0,function(){var i,r,A,a,l,c,U,U,h,f,m,w,H,B,y,Q,b,S,F,U,D,H,Q;return $n(this,function(R){switch(R.label){case 0:this.applyEffects(n.getEffects(4)),i=n.container,r=n.curves,A=i.styles,a=0,l=i.textNodes,R.label=1;case 1:return a<l.length?(c=l[a],[4,this.renderTextNode(c,A)]):[3,4];case 2:R.sent(),R.label=3;case 3:return a++,[3,1];case 4:if(!(i instanceof bC))return[3,8];R.label=5;case 5:return R.trys.push([5,7,,8]),[4,this.context.cache.match(i.src)];case 6:return U=R.sent(),this.renderReplacedElement(i,r,U),[3,8];case 7:return R.sent(),this.context.logger.error("Error loading image "+i.src),[3,8];case 8:if(i instanceof _C&&this.renderReplacedElement(i,r,i.canvas),!(i instanceof SC))return[3,12];R.label=9;case 9:return R.trys.push([9,11,,12]),[4,this.context.cache.match(i.svg)];case 10:return U=R.sent(),this.renderReplacedElement(i,r,U),[3,12];case 11:return R.sent(),this.context.logger.error("Error loading svg "+i.svg.substring(0,255)),[3,12];case 12:return i instanceof FC&&i.tree?(h=new t(this.context,{scale:this.options.scale,backgroundColor:i.backgroundColor,x:0,y:0,width:i.width,height:i.height}),[4,h.render(i.tree)]):[3,14];case 13:f=R.sent(),i.width&&i.height&&this.ctx.drawImage(f,0,0,i.width,i.height,i.bounds.left,i.bounds.top,i.bounds.width,i.bounds.height),R.label=14;case 14:if(i instanceof vg&&(m=Math.min(i.bounds.width,i.bounds.height),i.type===ah?i.checked&&(this.ctx.save(),this.path([new Ut(i.bounds.left+m*.39363,i.bounds.top+m*.79),new Ut(i.bounds.left+m*.16,i.bounds.top+m*.5549),new Ut(i.bounds.left+m*.27347,i.bounds.top+m*.44071),new Ut(i.bounds.left+m*.39694,i.bounds.top+m*.5649),new Ut(i.bounds.left+m*.72983,i.bounds.top+m*.23),new Ut(i.bounds.left+m*.84,i.bounds.top+m*.34085),new Ut(i.bounds.left+m*.39363,i.bounds.top+m*.79)]),this.ctx.fillStyle=xn(RB),this.ctx.fill(),this.ctx.restore()):i.type===lh&&i.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i.bounds.left+m/2,i.bounds.top+m/2,m/4,0,Math.PI*2,!0),this.ctx.fillStyle=xn(RB),this.ctx.fill(),this.ctx.restore())),hD(i)&&i.value.length){switch(w=this.createFontStyle(A),H=w[0],B=w[1],y=this.fontMetrics.getMetrics(H,B).baseline,this.ctx.font=H,this.ctx.fillStyle=xn(A.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=fD(i.styles.textAlign),Q=fh(i),b=0,i.styles.textAlign){case 1:b+=Q.width/2;break;case 2:b+=Q.width;break}S=Q.add(b,0,0,-Q.height/2+1),this.ctx.save(),this.path([new Ut(Q.left,Q.top),new Ut(Q.left+Q.width,Q.top),new Ut(Q.left+Q.width,Q.top+Q.height),new Ut(Q.left,Q.top+Q.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Ql(i.value,S),A.letterSpacing,y),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!yn(i.styles.display,2048))return[3,20];if(i.styles.listStyleImage===null)return[3,19];if(F=i.styles.listStyleImage,F.type!==0)return[3,18];U=void 0,D=F.url,R.label=15;case 15:return R.trys.push([15,17,,18]),[4,this.context.cache.match(D)];case 16:return U=R.sent(),this.ctx.drawImage(U,i.bounds.left-(U.width+10),i.bounds.top),[3,18];case 17:return R.sent(),this.context.logger.error("Error loading list-style-image "+D),[3,18];case 18:return[3,20];case 19:n.listValue&&i.styles.listStyleType!==-1&&(H=this.createFontStyle(A)[0],this.ctx.font=H,this.ctx.fillStyle=xn(A.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",Q=new _r(i.bounds.left,i.bounds.top+Oe(i.styles.paddingTop,i.bounds.width),i.bounds.width,yB(A.lineHeight,A.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Ql(n.listValue,Q),A.letterSpacing,yB(A.lineHeight,A.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),R.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(n){return As(this,void 0,void 0,function(){var i,r,F,A,a,F,l,c,F,h,f,F,m,w,F,B,y,F,b,S,F;return $n(this,function(U){switch(U.label){case 0:if(yn(n.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(n.element)];case 1:U.sent(),i=0,r=n.negativeZIndex,U.label=2;case 2:return i<r.length?(F=r[i],[4,this.renderStack(F)]):[3,5];case 3:U.sent(),U.label=4;case 4:return i++,[3,2];case 5:return[4,this.renderNodeContent(n.element)];case 6:U.sent(),A=0,a=n.nonInlineLevel,U.label=7;case 7:return A<a.length?(F=a[A],[4,this.renderNode(F)]):[3,10];case 8:U.sent(),U.label=9;case 9:return A++,[3,7];case 10:l=0,c=n.nonPositionedFloats,U.label=11;case 11:return l<c.length?(F=c[l],[4,this.renderStack(F)]):[3,14];case 12:U.sent(),U.label=13;case 13:return l++,[3,11];case 14:h=0,f=n.nonPositionedInlineLevel,U.label=15;case 15:return h<f.length?(F=f[h],[4,this.renderStack(F)]):[3,18];case 16:U.sent(),U.label=17;case 17:return h++,[3,15];case 18:m=0,w=n.inlineLevel,U.label=19;case 19:return m<w.length?(F=w[m],[4,this.renderNode(F)]):[3,22];case 20:U.sent(),U.label=21;case 21:return m++,[3,19];case 22:B=0,y=n.zeroOrAutoZIndexOrTransformedOrOpacity,U.label=23;case 23:return B<y.length?(F=y[B],[4,this.renderStack(F)]):[3,26];case 24:U.sent(),U.label=25;case 25:return B++,[3,23];case 26:b=0,S=n.positiveZIndex,U.label=27;case 27:return b<S.length?(F=S[b],[4,this.renderStack(F)]):[3,30];case 28:U.sent(),U.label=29;case 29:return b++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(n){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(n.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(n){this.ctx.beginPath(),this.formatPath(n),this.ctx.closePath()},t.prototype.formatPath=function(n){var i=this;n.forEach(function(r,A){var a=Js(r)?r.start:r;A===0?i.ctx.moveTo(a.x,a.y):i.ctx.lineTo(a.x,a.y),Js(r)&&i.ctx.bezierCurveTo(r.startControl.x,r.startControl.y,r.endControl.x,r.endControl.y,r.end.x,r.end.y)})},t.prototype.renderRepeat=function(n,i,r,A){this.path(n),this.ctx.fillStyle=i,this.ctx.translate(r,A),this.ctx.fill(),this.ctx.translate(-r,-A)},t.prototype.resizeImage=function(n,i,r){var A;if(n.width===i&&n.height===r)return n;var a=(A=this.canvas.ownerDocument)!==null&&A!==void 0?A:document,l=a.createElement("canvas");l.width=Math.max(1,i),l.height=Math.max(1,r);var c=l.getContext("2d");return c.drawImage(n,0,0,n.width,n.height,0,0,i,r),l},t.prototype.renderBackgroundImage=function(n){return As(this,void 0,void 0,function(){var i,r,A,a,l,c;return $n(this,function(h){switch(h.label){case 0:i=n.styles.backgroundImage.length-1,r=function(f){var m,w,B,z,Tt,J,wt,Ct,O,y,z,Tt,J,wt,Ct,b,S,F,U,D,H,Q,R,V,O,K,z,gt,St,wt,Ct,Mt,Tt,J,st,ot,vt,ut,Lt,$t,Vt,Nt;return $n(this,function(Dt){switch(Dt.label){case 0:if(f.type!==0)return[3,5];m=void 0,w=f.url,Dt.label=1;case 1:return Dt.trys.push([1,3,,4]),[4,A.context.cache.match(w)];case 2:return m=Dt.sent(),[3,4];case 3:return Dt.sent(),A.context.logger.error("Error loading background-image "+w),[3,4];case 4:return m&&(B=hp(n,i,[m.width,m.height,m.width/m.height]),z=B[0],Tt=B[1],J=B[2],wt=B[3],Ct=B[4],O=A.ctx.createPattern(A.resizeImage(m,wt,Ct),"repeat"),A.renderRepeat(z,O,Tt,J)),[3,6];case 5:jM(f)?(y=hp(n,i,[null,null,null]),z=y[0],Tt=y[1],J=y[2],wt=y[3],Ct=y[4],b=qM(f.angle,wt,Ct),S=b[0],F=b[1],U=b[2],D=b[3],H=b[4],Q=document.createElement("canvas"),Q.width=wt,Q.height=Ct,R=Q.getContext("2d"),V=R.createLinearGradient(F,D,U,H),vB(f.stops,S).forEach(function(Et){return V.addColorStop(Et.stop,xn(Et.color))}),R.fillStyle=V,R.fillRect(0,0,wt,Ct),wt>0&&Ct>0&&(O=A.ctx.createPattern(Q,"repeat"),A.renderRepeat(z,O,Tt,J))):JM(f)&&(K=hp(n,i,[null,null,null]),z=K[0],gt=K[1],St=K[2],wt=K[3],Ct=K[4],Mt=f.position.length===0?[pg]:f.position,Tt=Oe(Mt[0],wt),J=Oe(Mt[Mt.length-1],Ct),st=$M(f,Tt,J,wt,Ct),ot=st[0],vt=st[1],ot>0&&vt>0&&(ut=A.ctx.createRadialGradient(gt+Tt,St+J,0,gt+Tt,St+J,ot),vB(f.stops,ot*2).forEach(function(Et){return ut.addColorStop(Et.stop,xn(Et.color))}),A.path(z),A.ctx.fillStyle=ut,ot!==vt?(Lt=n.bounds.left+.5*n.bounds.width,$t=n.bounds.top+.5*n.bounds.height,Vt=vt/ot,Nt=1/Vt,A.ctx.save(),A.ctx.translate(Lt,$t),A.ctx.transform(1,0,0,Vt,0,0),A.ctx.translate(-Lt,-$t),A.ctx.fillRect(gt,Nt*(St-$t)+$t,wt,Ct*Nt),A.ctx.restore()):A.ctx.fill())),Dt.label=6;case 6:return i--,[2]}})},A=this,a=0,l=n.styles.backgroundImage.slice(0).reverse(),h.label=1;case 1:return a<l.length?(c=l[a],[5,r(c)]):[3,4];case 2:h.sent(),h.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(n,i,r){return As(this,void 0,void 0,function(){return $n(this,function(A){return this.path(YB(r,i)),this.ctx.fillStyle=xn(n),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(n,i,r,A){return As(this,void 0,void 0,function(){var a,l;return $n(this,function(c){switch(c.label){case 0:return i<3?[4,this.renderSolidBorder(n,r,A)]:[3,2];case 1:return c.sent(),[2];case 2:return a=eD(A,r),this.path(a),this.ctx.fillStyle=xn(n),this.ctx.fill(),l=nD(A,r),this.path(l),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(n){return As(this,void 0,void 0,function(){var i,r,A,a,l,c,h,f,m=this;return $n(this,function(w){switch(w.label){case 0:return this.applyEffects(n.getEffects(2)),i=n.container.styles,r=!oA(i.backgroundColor)||i.backgroundImage.length,A=[{style:i.borderTopStyle,color:i.borderTopColor,width:i.borderTopWidth},{style:i.borderRightStyle,color:i.borderRightColor,width:i.borderRightWidth},{style:i.borderBottomStyle,color:i.borderBottomColor,width:i.borderBottomWidth},{style:i.borderLeftStyle,color:i.borderLeftColor,width:i.borderLeftWidth}],a=dD(ko(i.backgroundClip,0),n.curves),r||i.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),oA(i.backgroundColor)||(this.ctx.fillStyle=xn(i.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(n.container)]):[3,2];case 1:w.sent(),this.ctx.restore(),i.boxShadow.slice(0).reverse().forEach(function(B){m.ctx.save();var y=hh(n.curves),b=B.inset?0:cD,S=ZP(y,-b+(B.inset?1:-1)*B.spread.number,(B.inset?1:-1)*B.spread.number,B.spread.number*(B.inset?-2:2),B.spread.number*(B.inset?-2:2));B.inset?(m.path(y),m.ctx.clip(),m.mask(S)):(m.mask(y),m.ctx.clip(),m.path(S)),m.ctx.shadowOffsetX=B.offsetX.number+b,m.ctx.shadowOffsetY=B.offsetY.number,m.ctx.shadowColor=xn(B.color),m.ctx.shadowBlur=B.blur.number,m.ctx.fillStyle=B.inset?xn(B.color):"rgba(0,0,0,1)",m.ctx.fill(),m.ctx.restore()}),w.label=2;case 2:l=0,c=0,h=A,w.label=3;case 3:return c<h.length?(f=h[c],f.style!==0&&!oA(f.color)&&f.width>0?f.style!==2?[3,5]:[4,this.renderDashedDottedBorder(f.color,f.width,l,n.curves,2)]:[3,11]):[3,13];case 4:return w.sent(),[3,11];case 5:return f.style!==3?[3,7]:[4,this.renderDashedDottedBorder(f.color,f.width,l,n.curves,3)];case 6:return w.sent(),[3,11];case 7:return f.style!==4?[3,9]:[4,this.renderDoubleBorder(f.color,f.width,l,n.curves)];case 8:return w.sent(),[3,11];case 9:return[4,this.renderSolidBorder(f.color,l,n.curves)];case 10:w.sent(),w.label=11;case 11:l++,w.label=12;case 12:return c++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(n,i,r,A,a){return As(this,void 0,void 0,function(){var l,c,h,f,m,w,B,y,b,S,F,U,D,H,Q,R,Q,R;return $n(this,function(V){return this.ctx.save(),l=sD(A,r),c=YB(A,r),a===2&&(this.path(c),this.ctx.clip()),Js(c[0])?(h=c[0].start.x,f=c[0].start.y):(h=c[0].x,f=c[0].y),Js(c[1])?(m=c[1].end.x,w=c[1].end.y):(m=c[1].x,w=c[1].y),r===0||r===2?B=Math.abs(h-m):B=Math.abs(f-w),this.ctx.beginPath(),a===3?this.formatPath(l):this.formatPath(c.slice(0,2)),y=i<3?i*3:i*2,b=i<3?i*2:i,a===3&&(y=i,b=i),S=!0,B<=y*2?S=!1:B<=y*2+b?(F=B/(2*y+b),y*=F,b*=F):(U=Math.floor((B+b)/(y+b)),D=(B-U*y)/(U-1),H=(B-(U+1)*y)/U,b=H<=0||Math.abs(b-D)<Math.abs(b-H)?D:H),S&&(a===3?this.ctx.setLineDash([0,y+b]):this.ctx.setLineDash([y,b])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=i):this.ctx.lineWidth=i*2+1.1,this.ctx.strokeStyle=xn(n),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(Js(c[0])&&(Q=c[3],R=c[0],this.ctx.beginPath(),this.formatPath([new Ut(Q.end.x,Q.end.y),new Ut(R.start.x,R.start.y)]),this.ctx.stroke()),Js(c[1])&&(Q=c[1],R=c[2],this.ctx.beginPath(),this.formatPath([new Ut(Q.end.x,Q.end.y),new Ut(R.start.x,R.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(n){return As(this,void 0,void 0,function(){var i;return $n(this,function(r){switch(r.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=xn(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),i=tD(n),[4,this.renderStack(i)];case 1:return r.sent(),this.applyEffects([]),[2,this.canvas]}})})},t})(KC),hD=function(e){return e instanceof TC||e instanceof EC?!0:e instanceof vg&&e.type!==lh&&e.type!==ah},dD=function(e,t){switch(e){case 0:return hh(t);case 2:return zP(t);case 1:default:return dh(t)}},fD=function(e){switch(e){case 1:return"center";case 2:return"right";case 0:default:return"left"}},pD=["-apple-system","system-ui"],mD=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter(function(t){return pD.indexOf(t)===-1}):e},gD=(function(e){bi(t,e);function t(n,i){var r=e.call(this,n,i)||this;return r.canvas=i.canvas?i.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=i,r.canvas.width=Math.floor(i.width*i.scale),r.canvas.height=Math.floor(i.height*i.scale),r.canvas.style.width=i.width+"px",r.canvas.style.height=i.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-i.x,-i.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+i.width+"x"+i.height+" at "+i.x+","+i.y+") with scale "+i.scale),r}return t.prototype.render=function(n){return As(this,void 0,void 0,function(){var i,r;return $n(this,function(A){switch(A.label){case 0:return i=fm(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,n),[4,wD(i)];case 1:return r=A.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=xn(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(r,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t})(KC),wD=function(e){return new Promise(function(t,n){var i=new Image;i.onload=function(){t(i)},i.onerror=n,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(e))})},vD=(function(){function e(t){var n=t.id,i=t.enabled;this.id=n,this.enabled=i,this.start=Date.now()}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Jc([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Jc([this.id,this.getTime()+"ms"],t))},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Jc([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Jc([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},e.instances={},e})(),BD=(function(){function e(t,n){var i;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new vD({id:this.instanceName,enabled:t.logging}),this.cache=(i=t.cache)!==null&&i!==void 0?i:new NP(this,t)}return e.instanceCount=1,e})(),yD=function(e,t){return t===void 0&&(t={}),CD(e,t)};typeof window<"u"&&HC.setContext(window);var CD=function(e,t){return As(void 0,void 0,void 0,function(){var n,i,r,A,a,l,c,h,f,m,w,B,y,b,S,F,U,D,H,Q,V,R,V,O,K,z,gt,St,wt,Ct,Mt,Tt,J,st,ot,vt,ut,Lt,$t,Vt;return $n(this,function(Nt){switch(Nt.label){case 0:if(!e||typeof e!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(n=e.ownerDocument,!n)throw new Error("Element is not attached to a Document");if(i=n.defaultView,!i)throw new Error("Document is not attached to a Window");return r={allowTaint:(O=t.allowTaint)!==null&&O!==void 0?O:!1,imageTimeout:(K=t.imageTimeout)!==null&&K!==void 0?K:15e3,proxy:t.proxy,useCORS:(z=t.useCORS)!==null&&z!==void 0?z:!1},A=Zp({logging:(gt=t.logging)!==null&&gt!==void 0?gt:!0,cache:t.cache},r),a={windowWidth:(St=t.windowWidth)!==null&&St!==void 0?St:i.innerWidth,windowHeight:(wt=t.windowHeight)!==null&&wt!==void 0?wt:i.innerHeight,scrollX:(Ct=t.scrollX)!==null&&Ct!==void 0?Ct:i.pageXOffset,scrollY:(Mt=t.scrollY)!==null&&Mt!==void 0?Mt:i.pageYOffset},l=new _r(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),c=new BD(A,l),h=(Tt=t.foreignObjectRendering)!==null&&Tt!==void 0?Tt:!1,f={allowTaint:(J=t.allowTaint)!==null&&J!==void 0?J:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:h,copyStyles:h},c.logger.debug("Starting document clone with size "+l.width+"x"+l.height+" scrolled to "+-l.left+","+-l.top),m=new $B(c,e,f),w=m.clonedReferenceElement,w?[4,m.toIFrame(n,l)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return B=Nt.sent(),y=Bg(w)||bP(w)?ZF(w.ownerDocument):Nh(c,w),b=y.width,S=y.height,F=y.left,U=y.top,D=bD(c,w,t.backgroundColor),H={canvas:t.canvas,backgroundColor:D,scale:(ot=(st=t.scale)!==null&&st!==void 0?st:i.devicePixelRatio)!==null&&ot!==void 0?ot:1,x:((vt=t.x)!==null&&vt!==void 0?vt:0)+F,y:((ut=t.y)!==null&&ut!==void 0?ut:0)+U,width:(Lt=t.width)!==null&&Lt!==void 0?Lt:Math.ceil(b),height:($t=t.height)!==null&&$t!==void 0?$t:Math.ceil(S)},h?(c.logger.debug("Document cloned, using foreign object rendering"),V=new gD(c,H),[4,V.render(w)]):[3,3];case 2:return Q=Nt.sent(),[3,5];case 3:return c.logger.debug("Document cloned, element located at "+F+","+U+" with size "+b+"x"+S+" using computed rendering"),c.logger.debug("Starting DOM parsing"),R=MC(c,w),D===R.styles.backgroundColor&&(R.styles.backgroundColor=Cr.TRANSPARENT),c.logger.debug("Starting renderer for element at "+H.x+","+H.y+" with size "+H.width+"x"+H.height),V=new uD(c,H),[4,V.render(R)];case 4:Q=Nt.sent(),Nt.label=5;case 5:return(!((Vt=t.removeContainer)!==null&&Vt!==void 0)||Vt)&&($B.destroy(B)||c.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),c.logger.debug("Finished rendering"),[2,Q]}})})},bD=function(e,t,n){var i=t.ownerDocument,r=i.documentElement?Il(e,getComputedStyle(i.documentElement).backgroundColor):Cr.TRANSPARENT,A=i.body?Il(e,getComputedStyle(i.body).backgroundColor):Cr.TRANSPARENT,a=typeof n=="string"?Il(e,n):n===null?Cr.TRANSPARENT:4294967295;return t===i.documentElement?oA(r)?oA(A)?a:A:r:a};const Pl={},Kr={},_D=600,dp=.25,JB={letter:{width:8.5,height:11},"11x14":{width:11,height:14},"11x17":{width:11,height:17}};async function SD(e,t){const n=document.getElementById("button-grid");if(!n)return x.warn("PrintService","Button grid element not found",null,"print"),null;const i=n.querySelector(".button-grid-left-cell"),r=n.querySelector(".button-grid-right-cell");try{const A=n.getBoundingClientRect(),a=(i==null?void 0:i.getBoundingClientRect().width)??0,l=(r==null?void 0:r.getBoundingClientRect().width)??0,c=Math.min(window.devicePixelRatio||1,2),h=await yD(n,{scale:c,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),f=A.width>0?h.width/A.width:1,m=e?0:Math.round(a*f),w=t?0:Math.round(l*f),B=Math.max(0,Math.min(h.width-1,m)),y=Math.max(B+1,Math.min(h.width,h.width-w)),b=Math.max(1,y-B),S=document.createElement("canvas");S.width=b,S.height=h.height,(S.getContext("2d",{willReadFrequently:!0})||S.getContext("2d")).drawImage(h,B,0,b,h.height,0,0,b,h.height);const U=ID(S,e,t);return x.debug("PrintService",`Captured button grid: ${U.width}x${U.height}`,null,"print"),U}catch(A){return x.error("PrintService","Failed to capture button grid",A,"print"),null}}function xD(e,t){const n=document.getElementById("notation-grid"),i=document.getElementById("legend-left-canvas"),r=document.getElementById("legend-right-canvas");if(!n)return x.warn("PrintService","Notation grid canvas not found",null,"print"),null;const A=e&&i?i.width:0,a=t&&r?r.width:0,l=A+n.width+a,c=A,h=document.createElement("canvas");h.width=l,h.height=n.height;const f=h.getContext("2d");return e&&i&&A>0&&f.drawImage(i,0,0),f.drawImage(n,c,0),t&&r&&a>0&&f.drawImage(r,c+n.width,0),x.debug("PrintService",`Captured pitch grid: ${h.width}x${h.height}`,null,"print"),h}function ED(e,t){const n=document.getElementById("drum-grid"),i=document.querySelector(".drum-grid-left-cell"),r=document.querySelector(".drum-grid-right-cell");if(!n||n.width===0)return x.debug("PrintService","Drum grid not found or empty",null,"print"),null;const A=n.offsetWidth?n.width/n.offsetWidth:1,a=e?Math.max(0,Math.round(((i==null?void 0:i.offsetWidth)||0)*A)):0,l=t?Math.max(0,Math.round(((r==null?void 0:r.offsetWidth)||0)*A)):0,c=a+n.width+l,h=getComputedStyle(document.documentElement).getPropertyValue("--c-surface")||"#ffffff",f=document.createElement("canvas");f.width=c,f.height=n.height;const m=f.getContext("2d");return m.fillStyle=h.trim()||"#ffffff",m.fillRect(0,0,c,n.height),m.drawImage(n,a,0),x.debug("PrintService",`Captured drum grid: ${f.width}x${f.height}`,null,"print"),f}function TD(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let A=0;A<r.length;A+=4){const a=r[A]*.299+r[A+1]*.587+r[A+2]*.114;r[A]=a,r[A+1]=a,r[A+2]=a}return n.putImageData(i,0,0),t}async function FD(e,t){x.debug("PrintService","Generating score canvas...",{printOptions:e,targetDimensions:t},"print");const n=[];if(e.includeButtonGrid){const H=await qC(e.includeLeftLegend,e.includeRightLegend);H&&n.push({canvas:H,name:"buttons"})}const i=xD(e.includeLeftLegend,e.includeRightLegend);if(i&&n.push({canvas:i,name:"pitch"}),e.includeDrums){const H=ED(e.includeLeftLegend,e.includeRightLegend);H&&n.push({canvas:H,name:"drums"})}if(n.length===0)return x.warn("PrintService","No content captured for printing",null,"print"),null;e.colorMode==="bw"&&(n.forEach(H=>{H.canvas=TD(H.canvas)}),x.debug("PrintService","Applied black & white filter",null,"print"));const r=Math.max(...n.map(H=>H.canvas.width)),A=n.reduce((H,Q)=>H+Q.canvas.height,0),a=e.cropTop||0,l=e.cropBottom||1,c=e.cropLeft||0,h=e.cropRight||1,f=A*(l-a),m=r*(h-c),w=A*a,B=r*c;x.debug("PrintService",`Applying crop: top=${a.toFixed(2)}, bottom=${l.toFixed(2)}, left=${c.toFixed(2)}, right=${h.toFixed(2)}`,null,"print");const y=Math.min(t.width/m,t.height/f),b=document.createElement("canvas");b.width=m*y,b.height=f*y;const S=b.getContext("2d");S.fillStyle="#FFFFFF",S.fillRect(0,0,b.width,b.height);const F=document.createElement("canvas");F.width=r,F.height=A;const U=F.getContext("2d");let D=0;return n.forEach(({canvas:H,name:Q})=>{U.drawImage(H,0,D),x.debug("PrintService",`Drew ${Q} at y=${D}, height=${H.height}`,null,"print"),D+=H.height}),S.drawImage(F,B,w,m,f,0,0,b.width,b.height),x.debug("PrintService",`Generated composite canvas: ${b.width}x${b.height}`,null,"print"),b}const Wu={generateScoreCanvas:FD,async generateAndPrint(){const e=d.state.printOptions,t=300,n=e.pageSize,i=n&&n in JB?n:"letter",r=JB[i],A=e.orientation==="landscape"?r.height:r.width,a=e.orientation==="landscape"?r.width:r.height,l=Math.max(1,A-2*dp),c=Math.max(1,a-2*dp),h=l*t,f=c*t;x.info("PrintService","Generating print canvas at high resolution",{width:h,height:f,options:e},"print");const m=await this.generateScoreCanvas(e,{width:h,height:f});if(!m){x.error("PrintService","Failed to generate print canvas",null,"print");return}const w=document.getElementById("print-staging-area");w.innerHTML="";const B=document.getElementById("print-style-rules");B.textContent=`@page { size: ${A}in ${a}in; margin: ${dp}in; }`;const y=document.createElement("img");y.src=m.toDataURL("image/png"),y.style.width="100%",y.style.height="auto",w.appendChild(y),x.info("PrintService","Opening print dialog",null,"print"),setTimeout(()=>window.print(),100)},async prefetchButtonGridSnapshot(e=!0,t=!0){try{await qC(e,t)}catch(n){x.warn("PrintService","Button grid prefetch failed",n,"print")}},invalidateButtonGridSnapshot(){$C()}};function ID(e,t,n){if(!e)return e;const i=document.getElementById("notation-grid"),r=document.getElementById("legend-left-canvas"),A=document.getElementById("legend-right-canvas"),a=t&&r?r.width:0,l=n&&A?A.width:0,c=((i==null?void 0:i.width)??0)+a+l||e.width;if(!c||c===e.width)return e;const h=c/e.width,f=Math.max(1,Math.round(e.height*h)),m=document.createElement("canvas");return m.width=c,m.height=f,(m.getContext("2d",{willReadFrequently:!0})||m.getContext("2d")).drawImage(e,0,0,m.width,m.height),m}async function qC(e,t){const n=`${e}-${t}`;return Pl[n]!==void 0?Pl[n]??null:(Kr[n]||(Kr[n]=(async()=>{await MD();const i=await SD(e,t);return Pl[n]=i,Kr[n]=null,i})().catch(i=>{throw Kr[n]=null,i})),Kr[n])}function MD(){return new Promise(e=>{typeof window.requestIdleCallback=="function"?requestIdleCallback(()=>e(),{timeout:_D}):requestAnimationFrame(()=>e())})}function $C(){Object.keys(Pl).forEach(e=>{delete Pl[e]}),Object.keys(Kr).forEach(e=>{delete Kr[e]})}typeof window<"u"&&window.addEventListener("resize",()=>$C());function Vi(e,t){if(!e)return`rgba(204, 204, 204, ${t})`;const n=parseInt(e.slice(Gy,cv),Pu),i=parseInt(e.slice(cv,uv),Pu),r=parseInt(e.slice(uv,wE),Pu);return`rgba(${n}, ${i}, ${r}, ${t})`}function Yh(e,t){if(!e||typeof e!="string")return gE;const n=parseInt(e.slice(Gy),Pu),i=t<0?vE:BE,r=t<0?t*-1:t,A=n>>16,a=n>>8&255,l=n&255;return"#"+(16777216+(Math.round((i-A)*r)+A)*65536+(Math.round((i-a)*r)+a)*256+(Math.round((i-l)*r)+l)).toString(16).slice(1)}const QD=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor"/>\r
</svg>`,UD=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(90, 12, 12)"/>\r
</svg>`,PD=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(180, 12, 12)"/>\r
</svg>`,DD=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(270, 12, 12)"/>\r
</svg>`,zC=rA;function wl(e,t){const{blend:n,cutoff:i,resonance:r}=t,A=(i-1)/30,a=20,l=e-A,c=A-e;let h=1/(1+Math.pow(Math.max(0,l*a),2)),f=1/(1+Math.pow(Math.max(0,c*a),2));const m=.01;h<m&&(h=0),f<m&&(f=0);const w=h*f;let B;n<=1?B=f*(1-n)+w*n:B=w*(2-n)+h*(n-1);const y=1-(r||0)/105,b=Math.max(.01,.2*y*y),S=Math.exp(-Math.pow((e-A)/b,2)),F=(r||0)/100*.6,U=B+S*F,D=Math.max(0,Math.min(1,U));return D<m?0:D}function kD(e,t){const n=t/100;return 1-n+n*e}function sc(e,t){const n=t.mix||0;if(n===0)return new Float32Array(e);const i=new Float32Array(e.length),r=n/100;for(let A=0;A<e.length;A++){const a=e[A]??0,l=(A+.5)/zC,c=wl(l,t);if(c<a){const m=(a-c)*r;i[A]=a-m}else i[A]=a;const h=i[A]??0;i[A]=Math.max(0,h)}return i}function ph(e){const t=d.state.timbres[e];if(!t)return new Float32Array(zC);const n=t.filter;return n&&n.enabled!==!1&&(n.mix||0)>0?sc(t.coeffs,n):new Float32Array(t.coeffs)}x.moduleLoaded("HarmonicBins with Columnar Structure");function ym(e,...t){}const Gu={0:QD,90:UD,180:PD,270:DD},$i=rA;let En=null,Bn=null,zn=new Float32Array($i).fill(0),Ue=null,Ns=new Float32Array($i).fill(0);const yg=[],Cm=[];let Oo=!1,js=null;const yu=new Array($i).fill(null);let Cu=!1;const bu=new Float32Array($i).fill(1);new Float32Array($i).fill(0);function bm(){var l;if(!Ue||((!En||!Bn||!js)&&(En=document.getElementById("filter-overlay-canvas"),js=document.querySelector(".harmonic-bins-grid"),En&&(Bn=En.getContext("2d"))),!En||!Bn||!js))return;const{width:e,height:t}=En;Bn.clearRect(0,0,e,t);const i=t*.95,r=t,A=(l=d.state.timbres[Ue])==null?void 0:l.filter,a=A&&A.enabled!==!1;if(A&&a){const c=A.mix||0;if(c===0){bu.fill(1);return}const h=[];for(let y=0;y<$i;y++){const b=(y+.5)/$i,S=wl(b,A);bu[y]=kD(S,c),h.push({bin:y+1,rawFilterAmp:S.toFixed(3),afterMix:(bu[y]??0).toFixed(3)})}Bn.beginPath();const f=2;for(let y=0;y<=e;y+=f){const b=y/e,S=wl(b,A),F=r-S*i;y===0?Bn.moveTo(y,F):Bn.lineTo(y,F)}const w=.4+c/100*.6;Bn.strokeStyle=Vi(Yh(Ue,-.3),w),Bn.lineWidth=2.5,Bn.stroke();const B=c/100;if(B>0){Bn.beginPath(),Bn.moveTo(0,0),Bn.lineTo(e,0);const y=wl(1,A),b=r-y*i;Bn.lineTo(e,b);for(let S=e;S>=0;S-=2){const F=S/e,U=wl(F,A),D=r-U*i;Bn.lineTo(S,D)}Bn.closePath(),Bn.fillStyle=`rgba(255, 255, 255, ${B})`,Bn.fill()}}else bu.fill(1)}function Dl(){if(!Ue)return;const e=Ue;yg.forEach((t,n)=>{const i=t.sliderTrack.querySelector(".slider-fill"),r=t.sliderTrack.querySelector(".harmonic-label-internal");if(!i||!r)return;const A=zn[n]??0;if(i.style.height=`${A*100}%`,A>0){const l=Yh(e,-.1);i.style.backgroundColor=Vi(l,1)}else i.style.backgroundColor="transparent";const a=i.querySelector("canvas");a&&a.remove(),A>.1?(r.style.color="rgba(255, 255, 255, 0.35)",r.style.textShadow="0 0 2px rgba(0,0,0,0.3)"):(r.style.color="rgba(51, 51, 51, 0.5)",r.style.textShadow="0 0 1px rgba(255,255,255,0.3)")}),bm()}function ZB(e,t=null){var m,w,B,y;if(!Ue||!js)return;const n=e.target instanceof Element?e.target:null;if(ym("log","[BINS DRAG] handleBinPointerEvent called",{clientX:e.clientX,clientY:e.clientY}),x.debug("HarmonicBins","handleBinPointerEvent called",{target:n==null?void 0:n.className},"filter"),n!=null&&n.classList.contains("phase-button")||n!=null&&n.closest(".phase-button")||(n==null?void 0:n.tagName)==="path"||(n==null?void 0:n.tagName)==="svg"){x.debug("HarmonicBins","Blocking phase button interaction in handleBinPointerEvent",null,"filter");return}if(t===null){const b=js.getBoundingClientRect(),S=e.clientX-b.left,F=b.width/$i,U=Math.floor(S/F);t=Math.max(0,Math.min($i-1,U))}if(x.debug("HarmonicBins","handleBinPointerEvent - binIndex",{binIndex:t},"filter"),t===null)return;const i=d.state.timbres[Ue];if(!i)return;const r=yg[t];if(!r)return;const a=r.sliderTrack.getBoundingClientRect(),l=e.clientY-a.top,c=a.height,h=(c-l)/c,f=Math.max(0,Math.min(1,h));if(ym("log","[BINS DRAG] Setting bin",t+1,"value:",f.toFixed(3)),f===0){x.debug("HarmonicBins","Setting coefficient to zero immediately for bin",{binIndex:t},"filter");const b=new Float32Array(i.coeffs);b[t]=0,zn[t]=0,d.setHarmonicCoefficients(Ue,b);const S=yu[t];typeof S=="number"&&(clearTimeout(S),yu[t]=null),Oo||(ye.triggerAttack("C4",Ue),d.emit("spacebarPlayback",{color:Ue,isPlaying:!0}),Oo=!0);const F=(m=d.state.timbres[Ue])==null?void 0:m.filter;F&&F.enabled!==!1&&(F.mix||0)>0&&sc(b,F),(w=window.waveformVisualizer)!=null&&w.generateWaveform&&window.waveformVisualizer.generateWaveform(),x.debug("HarmonicBins",`Set coefficient H${t+1} to 0 for color ${Ue}`,null,"filter")}else{const b=yu[t];typeof b=="number"&&(clearTimeout(b),yu[t]=null),Oo||(ye.triggerAttack("C4",Ue),d.emit("spacebarPlayback",{color:Ue,isPlaying:!0}),Oo=!0),x.debug("HarmonicBins","BEFORE creating newCoeffs - store coeffs",{coeffs:i.coeffs},"filter");const S=new Float32Array(i.coeffs);x.debug("HarmonicBins","AFTER copying to newCoeffs",{newCoeffs:S},"filter"),S[t]=f,zn[t]=f,x.debug("HarmonicBins",`AFTER setting newCoeffs[${t}] = ${f}`,{newCoeffs:S},"filter"),d.setHarmonicCoefficients(Ue,S);const F=(B=d.state.timbres[Ue])==null?void 0:B.filter;F&&F.enabled!==!1&&(F.mix||0)>0&&sc(S,F),(y=window.waveformVisualizer)!=null&&y.generateWaveform&&window.waveformVisualizer.generateWaveform(),x.debug("HarmonicBins",`Updated coefficient H${t+1} to ${f} for color ${Ue}`,null,"filter"),x.debug("HarmonicBins","All coefficients",{newCoeffs:S},"filter")}Dl()}function _m(e,t,n,i){const r=n.coeffs,A=n.phases||new Float32Array(r.length).fill(0);let a=!0,l=!0;if(e.length!==r.length)a=!1;else for(let h=0;h<e.length;h++){const f=e[h]??0,m=r[h]??0;if(Math.abs(f-m)>.001){a=!1;break}}if(t.length!==A.length)l=!1;else for(let h=0;h<t.length;h++){const f=t[h]??0,m=A[h]??0;if(Math.abs(f-m)>.001){l=!1;break}}return a&&l}function ty(e){if(!e)return;Ue=e;const t=d.state.timbres[e];t&&(t.filter?t.filter.enabled===void 0&&(t.filter.enabled=!0):t.filter={enabled:!0,blend:1,cutoff:16,resonance:0,type:"lowpass",mix:0},x.debug("HarmonicBins","updateForNewColor - timbre.coeffs",{coeffs:t.coeffs},"filter"),x.debug("HarmonicBins","updateForNewColor - timbre.phases",{phases:t.phases},"filter"),zn=new Float32Array(t.coeffs),t.phases?Ns=new Float32Array(t.phases):Ns=new Float32Array(zn.length).fill(0),_m(zn,Ns,t),x.debug("HarmonicBins","updateForNewColor - final coeffs",{coeffs:zn},"filter"),x.debug("HarmonicBins","updateForNewColor - final phases",{phases:Ns},"filter"),Cm.forEach(({phaseBtn:n},i)=>{if(!n)return;let A=(Ns[i]||0)%(2*Math.PI);A<0&&(A+=2*Math.PI);const a=.1;let l=0;Math.abs(A-Math.PI/2)<a?l=90:Math.abs(A-Math.PI)<a?l=180:Math.abs(A-3*Math.PI/2)<a&&(l=270),n.innerHTML=Gu[l]}),Dl())}function LD(){var l;const e=document.querySelector(".filter-container"),t=e==null?void 0:e.querySelector(".filter-bins-wrapper"),n=e==null?void 0:e.querySelector(".filter-vertical-blend-wrapper");if(!e||!t||!n){x.error("HarmonicBins","Missing required elements - aborting init",null,"audio");return}js=document.createElement("div"),js.className="harmonic-bins-grid";for(let c=0;c<$i;c++){const h=document.createElement("div");h.className="slider-column";const f=document.createElement("div");f.className="slider-track";const m=document.createElement("div");m.className="slider-fill",f.appendChild(m);const w=document.createElement("div");w.className="harmonic-label-internal",w.textContent=`${c+1}`,f.appendChild(w),h.appendChild(f);const B=document.createElement("button");B.className="phase-button",B.innerHTML=Gu[0],B.dataset.binIndex=String(c),B.addEventListener("pointerenter",()=>{var y,b,S;if(Cu){const U=et.now(),D=ye.synths,H=Ue;if(H&&((b=(y=D==null?void 0:D[H])==null?void 0:y.activeNotes)!=null&&b.C4)){const Q=D[H].activeNotes.C4;(S=Q.oscillators)!=null&&S[c]&&Q.oscillators[c].volume.linearRampTo(-1/0,.015,U)}setTimeout(()=>{var K;const Q=Ue,R=Q?d.state.timbres[Q]:void 0;if(!Q||!R)return;const V=new Float32Array(R.coeffs);V[c]=0,zn[c]=0,d.setHarmonicCoefficients(Q,V);const O=(K=d.state.timbres[Q])==null?void 0:K.filter;O&&O.enabled!==!1&&(O.mix||0)>0&&sc(V,O),Dl()},.015*1e3)}}),B.addEventListener("click",y=>{var V;if(Cu){y.preventDefault();return}const b=Ue;if(!b)return;x.debug("HarmonicBins","Phase button click handler started",null,"filter"),x.debug("HarmonicBins","Current coeffs before phase change",{coeffs:zn},"filter"),y.preventDefault();const S=new Float32Array(Ns),F=new Float32Array(Ns);let D=(F[c]||0)%(2*Math.PI);D<0&&(D+=2*Math.PI);const H=.1;let Q=0;Math.abs(D)<H?Q=Math.PI/2:Math.abs(D-Math.PI/2)<H?Q=Math.PI:Math.abs(D-Math.PI)<H?Q=3*Math.PI/2:Q=0,F[c]=Q,Ns=F,(V=window.waveformVisualizer)!=null&&V.startPhaseTransition&&window.waveformVisualizer.startPhaseTransition(S,F,c),d.setHarmonicPhases(b,F);const R=Q===0?0:Math.abs(Q-Math.PI/2)<H?90:Math.abs(Q-Math.PI)<H?180:270;B.innerHTML=Gu[R],x.debug("HarmonicBins",`Phase button clicked for H${c+1}, new phase: ${R}`,null,"filter")}),h.appendChild(B),js.appendChild(h),yg.push({column:h,label:w,sliderTrack:f,sliderFill:m,phaseBtn:B}),Cm.push({phaseBtn:B})}js.addEventListener("pointerdown",c=>{const h=c.target instanceof Element?c.target:null;if(ym("log","[BINS DRAG] Pointerdown event fired",{target:h,className:h==null?void 0:h.className}),h!=null&&h.classList.contains("phase-button")||h!=null&&h.closest(".phase-button")){x.debug("HarmonicBins","Pointerdown blocked - phase button clicked",null,"filter");return}if(x.debug("HarmonicBins","Pointerdown - handling bin interaction",null,"filter"),c.preventDefault(),Cu=!0,!Ue)return;const f=Ue;ye.triggerAttack("C4",f),d.emit("spacebarPlayback",{color:f,isPlaying:!0}),Oo=!0,ZB(c);const m=B=>ZB(B),w=()=>{var y;window.removeEventListener("pointermove",m),window.removeEventListener("pointerup",w),Cu=!1;const B=!!((y=window.waveformVisualizer)!=null&&y.generateWaveform);d.recordState(),ye.triggerRelease("C4",f),d.emit("spacebarPlayback",{color:f,isPlaying:!1}),Oo=!1,B?setTimeout(()=>{var b,S;(S=(b=window.waveformVisualizer)==null?void 0:b.generateWaveform)==null||S.call(b)},0):x.warn("HarmonicBins","Static waveform visualizer not ready when drag ended",null,"audio")};window.addEventListener("pointermove",m),window.addEventListener("pointerup",w)}),En=document.createElement("canvas"),En.id="filter-overlay-canvas",En.className="filter-overlay-canvas",En.style.pointerEvents="none",Bn=En.getContext("2d"),js.appendChild(En);const i=document.createElement("div");i.className="vertical-blend-wrapper";const r=document.createElement("div");r.id="vertical-blend-track";const A=document.createElement("div");A.id="vertical-blend-thumb",A.textContent="M",r.appendChild(A),i.appendChild(r),t.appendChild(js),n.appendChild(i);const a=()=>{if(!En)return;const c=En.getBoundingClientRect();(En.width!==c.width||En.height!==c.height)&&(En.width=c.width,En.height=c.height,bm())};Ue=((l=d.state.selectedNote)==null?void 0:l.color)||"#4a90e2",ty(Ue),d.on("timbreChanged",c=>{if(c===Ue){x.debug("HarmonicBins","timbreChanged event - checking what changed",null,"filter");const h=d.state.timbres[c];if(!h)return;const f=h.coeffs,m=h.phases;let w=!1;if(x.debug("HarmonicBins","Comparing coefficients...",null,"filter"),x.debug("HarmonicBins","Local coeffs",{coeffs:zn},"filter"),x.debug("HarmonicBins","Store coeffs",{newCoeffs:f},"filter"),zn.length!==f.length)x.debug("HarmonicBins","Array length mismatch - coeffsChanged = true",null,"filter"),w=!0;else for(let B=0;B<f.length;B++){const y=zn[B]??0,b=f[B]??0,S=Math.abs(y-b);if(S>.001){x.debug("HarmonicBins",`Coefficient ${B} changed: ${y} -> ${b} (diff: ${S})`,null,"filter"),w=!0;break}}x.debug("HarmonicBins","Force syncing local coeffs with store",null,"filter"),_m(zn,Ns,h),zn=new Float32Array(f),m?Ns=new Float32Array(m):Ns=new Float32Array(zn.length).fill(0),_m(zn,Ns,h),w?(x.debug("HarmonicBins","Coefficients changed - updating visuals",null,"filter"),Dl()):(x.debug("HarmonicBins","No coefficient changes detected - but local coeffs synced",null,"filter"),bm()),Cm.forEach(({phaseBtn:B},y)=>{if(!B)return;let S=(Ns[y]||0)%(2*Math.PI);S<0&&(S+=2*Math.PI);const F=.1;let U=0;Math.abs(S-Math.PI/2)<F?U=90:Math.abs(S-Math.PI)<F?U=180:Math.abs(S-3*Math.PI/2)<F&&(U=270),B.innerHTML=Gu[U]})}}),d.on("noteChanged",({newNote:c})=>{c.color&&c.color!==Ue&&ty(c.color)}),d.on("filterChanged",c=>{const h=Ue;if(h&&c===h){Dl();const f=d.state.timbres[h],m=f==null?void 0:f.filter;if(!f)return;m&&m.enabled!==!1&&(m.mix||0)>0?sc(f.coeffs,m):new Float32Array(f.coeffs)}}),new ResizeObserver(a).observe(js),a(),x.info("HarmonicBins","Initialized with columnar div structure and perfect alignment",null,"filter")}class RD extends et.Synth{constructor(n){super(n);P(this,"presetGain");P(this,"vibratoLFO");P(this,"vibratoDepth");P(this,"vibratoGain");P(this,"tremoloLFO");P(this,"tremoloDepth");P(this,"tremoloGain");P(this,"hpFilter");P(this,"lpFilterForBP");P(this,"lpFilterSolo");P(this,"hpOutput");P(this,"bpOutput");P(this,"lpOutput");P(this,"hp_bp_fade");P(this,"main_fade");P(this,"wetDryFade");this.presetGain=new et.Gain(n.gain||1),this.vibratoLFO=new et.LFO(0,0),this.vibratoDepth=new et.Scale(-1,1),this.vibratoGain=new et.Gain(0),this.vibratoLFO.connect(this.vibratoDepth),this.vibratoDepth.connect(this.vibratoGain),this.vibratoGain.connect(this.oscillator.frequency),this.tremoloLFO=new et.LFO(0,0),this.tremoloDepth=new et.Scale(0,1),this.tremoloGain=new et.Gain(1),this.tremoloLFO.connect(this.tremoloDepth),this.tremoloDepth.connect(this.tremoloGain.gain),this.hpFilter=new et.Filter({type:"highpass"}),this.lpFilterForBP=new et.Filter({type:"lowpass"}),this.lpFilterSolo=new et.Filter({type:"lowpass"}),this.hpOutput=new et.Gain,this.bpOutput=new et.Gain,this.lpOutput=new et.Gain,this.hp_bp_fade=new et.CrossFade(0),this.main_fade=new et.CrossFade(0),this.wetDryFade=new et.CrossFade(0),this.oscillator.connect(this.presetGain),this.presetGain.connect(this.wetDryFade.a),this.presetGain.connect(this.hpFilter),this.hpFilter.connect(this.hpOutput),this.hpFilter.connect(this.lpFilterForBP),this.lpFilterForBP.connect(this.bpOutput),this.presetGain.connect(this.lpFilterSolo),this.lpFilterSolo.connect(this.lpOutput),this.hpOutput.connect(this.hp_bp_fade.a),this.bpOutput.connect(this.hp_bp_fade.b),this.lpOutput.connect(this.main_fade.b),this.hp_bp_fade.connect(this.main_fade.a),this.main_fade.connect(this.wetDryFade.b),this.wetDryFade.connect(this.tremoloGain),this.tremoloGain.connect(this.envelope),n.filter&&this._setFilter(n.filter),n.vibrato?this._setVibrato(n.vibrato):this._setVibrato({speed:0,span:0}),n.tremelo?this._setTremolo(n.tremelo):this._setTremolo({speed:0,span:0})}_setPresetGain(n){this.presetGain&&(this.presetGain.gain.value=n)}_setVibrato(n,i=et.now()){var r,A;if(this.vibratoLFO&&this.vibratoGain){const a=n.speed/100*16,c=(((A=(r=et.getContext())==null?void 0:r.rawContext)==null?void 0:A.state)??et.context.state)==="running";if(n.speed===0||n.span===0){c&&this.vibratoLFO.state==="started"&&this.vibratoLFO.stop(i),this.vibratoLFO.frequency.value=0,this.vibratoGain.gain.value=0;return}c&&this.vibratoLFO.state!=="started"&&this.vibratoLFO.start(i),this.vibratoLFO.frequency.value=a;const f=n.span/100*50,m=f/1200,y=440*(Math.pow(2,m)-1);this.vibratoGain.gain.value=y,x.debug("SynthEngine","Audio vibrato gain set",{hzDeviation:y,centsAmplitude:f},"audio")}}_setTremolo(n,i=et.now()){var r,A;if(this.tremoloLFO&&this.tremoloGain){const a=n.speed/100*16,c=(((A=(r=et.getContext())==null?void 0:r.rawContext)==null?void 0:A.state)??et.context.state)==="running";if(n.speed===0||n.span===0){c&&this.tremoloLFO.state==="started"&&this.tremoloLFO.stop(i),this.tremoloLFO.frequency.value=0,this.tremoloGain.gain.cancelScheduledValues(i),this.tremoloGain.gain.value=1;return}c&&this.tremoloLFO.state!=="started"&&this.tremoloLFO.start(i),this.tremoloLFO.frequency.value=a;const h=n.span/100,f=Math.max(0,1-h),m=1;this.tremoloDepth.min=f,this.tremoloDepth.max=m}}_setFilter(n){this.wetDryFade.fade.value=n.enabled?1:0;const i=et.Midi(n.cutoff+35).toFrequency(),r=n.resonance/100*12+.1;this.hpFilter.set({frequency:i,Q:r}),this.lpFilterForBP.set({frequency:i,Q:r}),this.lpFilterSolo.set({frequency:i,Q:r});const A=n.blend;A<=1?(this.main_fade.fade.value=0,this.hp_bp_fade.fade.value=A):(this.main_fade.fade.value=A-1,this.hp_bp_fade.fade.value=1)}}const XC={polyphonyReference:32,smoothingTauMs:200,masterGainRampMs:50,gainUpdateIntervalMs:16};function YC(e=XC.polyphonyReference){return 1/Math.sqrt(e)}class HD{constructor(t,n={}){P(this,"masterGain");P(this,"options");P(this,"perVoiceBaselineGain");P(this,"activeVoiceCount",0);P(this,"smoothedVoiceCount");P(this,"gainUpdateLoopId",null);this.masterGain=t,this.options={...XC,...n},this.perVoiceBaselineGain=YC(this.options.polyphonyReference),this.smoothedVoiceCount=this.options.polyphonyReference}start(){this.stop(),this.gainUpdateLoopId=setInterval(()=>this.updateMasterGain(),this.options.gainUpdateIntervalMs)}stop(){this.gainUpdateLoopId!==null&&(clearInterval(this.gainUpdateLoopId),this.gainUpdateLoopId=null)}noteOn(t=1){t<=0||(this.activeVoiceCount+=t)}noteOff(t=1){t<=0||(this.activeVoiceCount=Math.max(0,this.activeVoiceCount-t))}clampActiveVoiceCountToAtMost(t){Number.isFinite(t)&&(this.activeVoiceCount=Math.max(0,Math.min(this.activeVoiceCount,Math.floor(t))))}resetActiveVoiceCount(){this.activeVoiceCount=0}getActiveVoiceCount(){return this.activeVoiceCount}updateMasterGain(){const{polyphonyReference:t,smoothingTauMs:n,masterGainRampMs:i,gainUpdateIntervalMs:r}=this.options,A=et.now();if(this.activeVoiceCount===0){this.smoothedVoiceCount=.01*t+(1-.01)*this.smoothedVoiceCount;return}const a=r/1e3,l=1-Math.exp(-a/(n/1e3)),c=Math.max(1,this.activeVoiceCount);this.smoothedVoiceCount=l*c+(1-l)*this.smoothedVoiceCount;const h=Math.sqrt(t/this.smoothedVoiceCount),f=this.perVoiceBaselineGain*h;this.masterGain.gain.rampTo(f,i/1e3,A)}}const ND={clippingWarningThresholdDb:-3,clippingMonitorIntervalMs:500,clippingWarningCooldownMs:2e3};class OD{constructor(t,n={}){P(this,"meter");P(this,"options");P(this,"clippingMonitorId",null);P(this,"lastClippingWarningAt",0);this.meter=t,this.options={...ND,...n}}start(){this.stop(),this.lastClippingWarningAt=0,this.clippingMonitorId=setInterval(()=>{var r,A;const t=this.meter.getValue(),n=Array.isArray(t)?t[0]:t;if(n===void 0||n<=this.options.clippingWarningThresholdDb)return;const i=Date.now();i-this.lastClippingWarningAt<this.options.clippingWarningCooldownMs||(this.lastClippingWarningAt=i,(A=(r=this.options).onWarning)==null||A.call(r,n))},this.options.clippingMonitorIntervalMs)}stop(){this.clippingMonitorId!==null&&(clearInterval(this.clippingMonitorId),this.clippingMonitorId=null)}}x.moduleLoaded("SynthEngine");const ci={};let xA=null,Qo=null,fp=null,_u=null,Su=null,is={},Te=null,nl=null;function sl(e,t,n){var i,r;n&&(((i=n._activeVoices)==null?void 0:i.size)??((r=n._voices)==null||r.length))}const ye={init(){typeof this.stopBackgroundMonitors=="function"&&this.stopBackgroundMonitors(),xA=new et.Gain(YC()),Te=new HD(xA),Te.start(),Qo=new et.Volume(0),fp=new et.Compressor({threshold:-12,ratio:3,attack:.01,release:.1,knee:6}),_u=new et.Limiter(-3),Su=new et.Meter,xA.connect(Qo),Qo.connect(fp),fp.connect(_u),_u.toDestination(),_u.connect(Su),Su&&(nl=new OD(Su,{onWarning:e=>{x.warn("SynthEngine","Limiter input approaching clipping threshold",{level:e},"audio")}}),nl.start());for(const e in d.state.timbres){const t=d.state.timbres[e];if(!t)continue;const n=ph(e),i=n.reduce((c,h)=>c+Math.abs(h),0),r=i>1?n.map(c=>c/i):n,A=t.gain||1,a=new et.PolySynth({voice:RD,options:{oscillator:{type:"custom",partials:Array.from(r)},envelope:t.adsr,filter:t.filter,vibrato:t.vibrato,tremelo:t.tremelo,gain:A}}).connect(xA);window.audioEffectsManager&&window.audioEffectsManager.applySynthEffects(a,e,xA);const l=a.triggerAttack;a.triggerAttack=function(...c){const h=l.apply(this,c);return setTimeout(()=>{const f=this._activeVoices;window.audioEffectsManager?f&&f.size>0?f.forEach(m=>{m.effectsApplied||(window.audioEffectsManager.applyEffectsToVoice(m,e),m.effectsApplied=!0)}):this._voices&&Array.isArray(this._voices)&&this._voices.forEach(m=>{m&&!m.effectsApplied&&(window.audioEffectsManager.applyEffectsToVoice(m,e),m.effectsApplied=!0)}):f&&f.size>0?f.forEach(m=>{m._setVibrato&&m.vibratoApplied!==!0&&(m._setVibrato(this._currentVibrato),m.vibratoApplied=!0),m._setTremolo&&m.tremoloApplied!==!0&&(m._setTremolo(this._currentTremolo),m.tremoloApplied=!0)}):this._voices&&Array.isArray(this._voices)&&this._voices.forEach(m=>{m!=null&&m._setVibrato&&m.vibratoApplied!==!0&&(m._setVibrato(this._currentVibrato),m.vibratoApplied=!0),m!=null&&m._setTremolo&&m.tremoloApplied!==!0&&(m._setTremolo(this._currentTremolo),m.tremoloApplied=!0)})},10),h},a._currentVibrato=t.vibrato,a._currentTremolo=t.tremelo,a._currentFilter=t.filter,ci[e]=a,x.debug("SynthEngine",`Created filtered synth for color: ${e}`,null,"audio")}d.on("timbreChanged",e=>{this.updateSynthForColor(e)}),d.on("filterChanged",e=>{this.updateSynthForColor(e)}),d.on("audioEffectChanged",e=>{if(!e||!e.color||!e.effectType)return;const{effectType:t,color:n}=e;(t==="vibrato"||t==="tremolo")&&this.updateSynthForColor(n)}),d.on("volumeChanged",e=>this.setVolume(e)),Te==null||Te.start(),x.info("SynthEngine","Initialized with multi-timbral support",null,"audio"),window.synthEngine=this},updateSynthForColor(e){const t=d.state.timbres[e],n=ci[e];if(!n||!t)return;t.vibrato||(t.vibrato={speed:0,span:0},x.debug("SynthEngine",`Initialized vibrato for color ${e}`,t.vibrato,"audio")),t.tremelo||(t.tremelo={speed:0,span:0},x.debug("SynthEngine",`Initialized tremolo for color ${e}`,t.tremelo,"audio")),x.debug("SynthEngine",`Updating timbre for color ${e}`,null,"audio");const i=ph(e),r=i.reduce((l,c)=>l+Math.abs(c),0),A=r>1?i.map(l=>l/r):i;n.set({oscillator:{partials:Array.from(A)},envelope:t.adsr}),window.audioEffectsManager&&window.audioEffectsManager.applySynthEffects(n,e,xA),n._currentVibrato=t.vibrato,n._currentTremolo=t.tremelo,n._currentFilter=t.filter;const a=n._activeVoices;a&&a.size>0?a.forEach(l=>{if(l._setFilter&&l._setFilter(t.filter),l._setVibrato&&(l._setVibrato(t.vibrato),l.vibratoApplied=!0),l._setTremolo&&(l._setTremolo(t.tremelo),l.tremoloApplied=!0),l._setPresetGain){const c=t.gain||1;l._setPresetGain(c)}}):n._voices&&Array.isArray(n._voices)&&n._voices.forEach(l=>{if(l!=null&&l._setVibrato&&(l._setVibrato(t.vibrato),l.vibratoApplied=!0),l!=null&&l._setTremolo&&(l._setTremolo(t.tremelo),l.tremoloApplied=!0),l!=null&&l._setFilter&&l._setFilter(t.filter),l!=null&&l._setPresetGain){const c=t.gain||1;l._setPresetGain(c)}})},setBpm(e){var t;try{(t=et.Transport)!=null&&t.bpm&&(et.Transport.bpm.value=e,x.debug("SynthEngine",`Tone.Transport BPM updated to ${e}`,null,"audio"))}catch(n){x.warn("SynthEngine","Unable to update BPM on Tone.Transport",{tempo:e,error:n},"audio")}},setVolume(e){Qo&&(Qo.volume.value=e)},async playNote(e,t,n=et.now()){var a;await(window.initAudio||(()=>et.start()))();const r=(a=d.state.selectedNote)==null?void 0:a.color,A=r?ci[r]:null;A&&A.triggerAttackRelease(e,t,n)},triggerAttack(e,t,n=et.now(),i=!1){const r=ci[t];if(r)if(Te==null||Te.noteOn(1),sl("attack++",t,r),i&&window.getDrumVolume){const A=window.getDrumVolume(),a=r.volume.value,l=a+20*Math.log10(A);r.volume.value=l,r.triggerAttack(e,n),setTimeout(()=>{r!=null&&r.volume&&(r.volume.value=a)},100)}else r.triggerAttack(e,n)},quickReleasePitches(e,t){var r,A,a;const n=ci[t];if(!n||!e||e.length===0)return;let i;try{const l=typeof n.get=="function"?n.get():null;i=(r=l==null?void 0:l.envelope)==null?void 0:r.release,n.set({envelope:{release:.01}}),sl("quickRelease:before",t,n),e.forEach(h=>{n.triggerRelease(h,et.now())}),sl("quickRelease:after",t,n);const c=((A=n._activeVoices)==null?void 0:A.size)??((a=n._voices)==null?void 0:a.length)??(Te==null?void 0:Te.getActiveVoiceCount())??0;Te==null||Te.clampActiveVoiceCountToAtMost(c),sl("quickRelease:clamped",t,n)}catch(l){x.warn("SynthEngine","quickReleasePitches failed",{err:l,color:t,pitches:e},"audio")}finally{if(i!==void 0)try{n.set({envelope:{release:i}})}catch{}}},triggerRelease(e,t,n=et.now()){var r,A;const i=ci[t];if(i){i.triggerRelease(e,n),Te==null||Te.noteOff(1);const a=((r=i._activeVoices)==null?void 0:r.size)??((A=i._voices)==null?void 0:A.length)??(Te==null?void 0:Te.getActiveVoiceCount())??0;Te==null||Te.clampActiveVoiceCountToAtMost(a),sl("release--",t,i)}},releaseAll(){var e;for(const t in ci)(e=ci[t])==null||e.releaseAll();Te==null||Te.resetActiveVoiceCount()},createWaveformAnalyzer(e){const t=ci[e];return t?(is[e]||(is[e]=new et.Analyser("waveform",1024),t.connect(is[e]),x.debug("SynthEngine",`Created waveform analyzer for color: ${e}`,null,"waveform")),is[e]):(x.warn("SynthEngine",`No synth found for color: ${e}`,null,"audio"),null)},getWaveformAnalyzer(e){return is[e]||null},getAllWaveformAnalyzers(){const e=new Map;for(const t in is)is[t]&&e.set(t,is[t]);return e},removeWaveformAnalyzer(e){is[e]&&(is[e].dispose(),delete is[e],x.debug("SynthEngine",`Removed waveform analyzer for color: ${e}`,null,"waveform"))},disposeAllWaveformAnalyzers(){for(const e in is)is[e]&&is[e].dispose();is={},x.debug("SynthEngine","Disposed all waveform analyzers",null,"waveform")},getSynth(e){return ci[e]||null},getAllSynths(){return{...ci}},getMainVolumeNode(){return Qo||null},getMasterGainNode(){return xA||null},stopBackgroundMonitors(){nl==null||nl.stop(),Te==null||Te.stop()},teardown(){this.stopBackgroundMonitors(),this.disposeAllWaveformAnalyzers(),x.debug("SynthEngine","Stopped SynthEngine background monitors",null,"audio")}},jn={adsrComponent:null};class VD{constructor(){P(this,"elements",new Map);P(this,"initialized",!1)}init(){this.initialized||(this.cacheElement("notationGrid","notation-grid"),this.cacheElement("playheadCanvas","playhead-canvas"),this.cacheElement("hoverCanvas","hover-canvas"),this.cacheElement("drumGrid","drum-grid"),this.cacheElement("drumPlayheadCanvas","drum-playhead-canvas"),this.cacheElement("drumHoverCanvas","drum-hover-canvas"),this.cacheElement("appContainer","app-container"),this.cacheElement("pitchGridWrapper","pitch-grid-wrapper"),this.cacheElement("drumGridWrapper","drum-grid-wrapper"),this.cacheElement("eraserButton","eraser-tool-button"),this.cacheElement("playButton","play-button"),this.cacheElement("stopButton","stop-button"),this.cacheElement("clearButton","clear-button"),this.cacheElement("loopButton","loop-button"),this.cacheElement("undoButton","undo-button"),this.cacheElement("redoButton","redo-button"),this.cacheElement("noteBankContainer","note-bank-container"),this.cacheElement("tonicModeGrid","tonic-mode-grid"),this.cacheElement("degreeVisibilityToggle","degree-visibility-toggle"),this.cacheElement("degreeModeToggle","degree-mode-toggle"),this.cacheElement("flatBtn","flat-toggle-btn"),this.cacheElement("sharpBtn","sharp-toggle-btn"),this.cacheElement("frequencyBtn","hz-toggle-btn"),this.cacheElement("octaveLabelBtn","spn-octave-toggle-btn"),this.cacheElement("focusColoursToggle","focus-colours-toggle"),this.cacheElement("harmonyContainerMain","chordShape-container"),this.cacheElement("tempoSlider","tempo-slider"),this.cacheElement("volumeSlider","vertical-volume-slider"),this.initialized=!0)}cacheElement(t,n){const i=document.getElementById(n);i&&this.elements.set(t,i)}get(t){return this.initialized?this.elements.get(t)??null:null}getMultiple(...t){const n={};return t.forEach(i=>{n[i]=this.get(i)}),n}has(t){return this.elements.has(t)}refresh(){this.elements.clear(),this.initialized=!1,this.init()}getStats(){const t=this.elements.size,n=Array.from(this.elements.values()).filter(i=>i!==null).length;return{totalCached:t,foundElements:n,missingElements:t-n}}}const Sr=new VD;let jC=[],JC=0,ey=null,Ku=[];function WD(){const e=d.state,t=xs.getColumnMap(e);if(ey!==t){ey=t,Ku=[];for(const n of t.entries){if(n.type!=="beat"||n.canvasIndex===null||n.macrobeatIndex===null)continue;const i=n.macrobeatIndex,r=Ku[i];if(!r){Ku[i]={start:n.canvasIndex,end:n.canvasIndex};continue}r.start=Math.min(r.start,n.canvasIndex),r.end=Math.max(r.end,n.canvasIndex)}}}function Cg(){return{cellWidth:d.state.cellWidth,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.baseMicrobeatPx}}function GD({timeMap:e=[],musicalEndTime:t=0,columnWidths:n=[],cellWidth:i=0}={}){jC=Array.isArray(e)?[...e]:[],JC=Number(t)||0}function ny(){return jC}function KD(){return JC}function mh(e){const t=Cg(),n=Math.max(0,Math.floor(e)),i=dA.getColumnPixelPosition(n,t,d.state);return(i==null?void 0:i.xStart)??0}function ZC(e){const t=Cg(),n=Math.max(0,Math.floor(e)),i=dA.getColumnPixelPosition(n,t,d.state);return(i==null?void 0:i.width)??0}function qD(){return Array.isArray(d.state.columnWidths)?d.state.columnWidths.length:0}function $D(){const e=Cg(),t=qD(),n=dA.getColumnPixelPosition(t,e,d.state);return(n==null?void 0:n.xStart)??0}function Sm(e){const t=d.state;WD();const n=xs.getColumnMap(t),i=n.canvasToVisual.get(Math.floor(e));if(i===void 0)return null;const r=n.entries[i],A=r==null?void 0:r.macrobeatIndex;if(A==null)return null;const a=Ku[A];if(!a)return null;const l=mh(a.start),c=mh(a.end+1);return{x:l,width:Math.max(0,c-l)}}const zD={hz:0,minAlpha:.2,maxAlpha:.2,maxExpandPx:0,colorRgb:"rgb(255, 235, 0)"};function kl(e,t,n,i,r,A,a=zD){if(!Number.isFinite(t)||!Number.isFinite(n)||!Number.isFinite(i)||!Number.isFinite(r)||i<=0||r<=0)return;const l=A/1e3,c=a.hz>0?.5+.5*Math.sin(l*(2*Math.PI)*a.hz):1,h=a.minAlpha+(a.maxAlpha-a.minAlpha)*c,f=Math.min(a.maxExpandPx,Math.max(0,i*.1))*c;e.save(),e.globalAlpha=h,e.fillStyle=a.colorRgb,e.fillRect(t-f/2,n,i+f,r),e.restore()}class XD{constructor(){P(this,"canvas",null);P(this,"ctx",null);P(this,"animationFrameId",null);P(this,"_lastColumnIndex",null);P(this,"_lastColumnProgress",0);P(this,"_lastColumnStartX",0);P(this,"_lastColumnWidth",0);P(this,"_lastDebugLogTime",0);P(this,"activeAnimations",new Map);P(this,"popDuration",{scaleUp:100,scaleDown:300});P(this,"popScale",1.5)}initialize(){this.canvas=document.getElementById("drum-playhead-canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),d.on("playbackStateChanged",()=>this.handlePlaybackStateChange()),d.on("tempoChanged",()=>this.invalidateTimeMap()))}handlePlaybackStateChange(){d.state.isPlaying&&!d.state.isPaused?this.startRendering():this.stopRendering({clear:!d.state.isPaused})}invalidateTimeMap(){}startRendering(){this.animationFrameId||this.render()}stopRendering({clear:t}={clear:!0}){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),t&&this.ctx&&this.canvas&&this.ctx.clearRect(0,0,Vn(this.canvas),tn(this.canvas))}render(){if(!d.state.isPlaying||d.state.isPaused||!this.ctx||!this.canvas){this.animationFrameId=null;return}this.ctx.clearRect(0,0,Vn(this.canvas),tn(this.canvas));const t=Number(et.Transport.seconds||0),n=this.calculateXFromTime(t);if(n===null){this.animationFrameId=requestAnimationFrame(()=>this.render());return}const i=tn(this.canvas);if(d.state.playheadMode==="macrobeat"){const r=this._lastColumnIndex,A=(r!==null?Sm(r):null)??(r!==null?Sm(r+1):null);A?kl(this.ctx,A.x,0,A.width,i,performance.now()):kl(this.ctx,this._lastColumnStartX,0,this._lastColumnWidth,i,performance.now())}else d.state.playheadMode==="microbeat"?kl(this.ctx,this._lastColumnStartX,0,this._lastColumnWidth,i,performance.now()):(this.ctx.strokeStyle="#FF6B35",this.ctx.lineWidth=3,this.ctx.shadowColor="#FF6B35",this.ctx.shadowBlur=6,this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,i),this.ctx.stroke(),this.ctx.shadowBlur=0);this.debugPlayhead(et.Transport.seconds,n),this.animationFrameId=requestAnimationFrame(()=>this.render())}calculateXFromTime(t){this._lastColumnIndex=null,this._lastColumnProgress=0,this._lastColumnStartX=0,this._lastColumnWidth=0;const n=ny();if(!Array.isArray(n)||n.length<2)return null;for(let i=0;i<n.length-1;i++){const r=n[i],A=n[i+1];if(!(typeof r!="number"||typeof A!="number")&&t>=r&&t<A){const a=A-r,l=t-r,c=mh(i)??0,h=ZC(i)??0;return this._lastColumnIndex=i,this._lastColumnProgress=a>0?l/a:0,this._lastColumnStartX=c,this._lastColumnWidth=h,c+(a>0?l/a*h:0)}}return null}debugPlayhead(t,n){if(!window.__DEBUG_PLAYHEAD_SYNC__)return;const i=performance.now();if(i-this._lastDebugLogTime<250)return;this._lastDebugLogTime=i;const r=ny(),A=this._lastColumnIndex,a=Array.isArray(r)&&A!==null&&A>=0?r[A]:void 0,l=Array.isArray(r)&&A!==null&&A+1<r.length?r[A+1]:void 0,c=Array.isArray(r)?r[r.length-1]??0:0,h=KD(),f={transportSeconds:Number(t.toFixed(3)),drumX:Number((n??0).toFixed(2)),columnIndex:A,columnProgress:Number(this._lastColumnProgress.toFixed(3)),drumStartTime:Number((a==null?void 0:a.toFixed(3))??NaN),transportStartTime:Number((a==null?void 0:a.toFixed(3))??NaN),startDelta:0,drumEndTime:Number((l==null?void 0:l.toFixed(3))??NaN),transportEndTime:Number((l==null?void 0:l.toFixed(3))??NaN),endDelta:0,drumTimelineEnd:Number(c.toFixed(3)),transportTimelineEnd:Number((h??0).toFixed(3)),timelineDelta:Number((c-(h??0)).toFixed(3)),toneLoopStart:Number(Number(et.Transport.loopStart??0).toFixed(3)),toneLoopEnd:Number(Number(et.Transport.loopEnd??0).toFixed(3)),storeLooping:d.state.isLooping};x.debug("DrumPlayheadRenderer","Playhead diagnostics",f,"canvas")}triggerNotePop(t,n){const i=`${t}-${n}`;this.activeAnimations.set(i,{startTime:performance.now(),phase:"scaleUp"}),window.drumGridRenderer&&window.drumGridRenderer.render()}getAnimationScale(t,n){const i=`${t}-${n}`,r=this.activeAnimations.get(i);if(!r)return 1;const A=performance.now(),a=A-r.startTime;if(r.phase==="scaleUp"){if(a>=this.popDuration.scaleUp)return r.phase="scaleDown",r.startTime=A,this.popScale;{const l=a/this.popDuration.scaleUp;return 1+(this.popScale-1)*l}}else if(r.phase==="scaleDown"){if(a>=this.popDuration.scaleDown)return this.activeAnimations.delete(i),1;{const l=a/this.popDuration.scaleDown;return this.popScale-(this.popScale-1)*l}}return 1}hasActiveAnimations(){return this.activeAnimations.size>0}cleanupAnimations(){const t=performance.now();for(const[n,i]of this.activeAnimations.entries()){const r=t-i.startTime,A=i.phase==="scaleUp"?this.popDuration.scaleUp:this.popDuration.scaleUp+this.popDuration.scaleDown;r>A&&this.activeAnimations.delete(n)}}}const WA=new XD;x.moduleLoaded("SixteenthStampPlacements","stamps");function YD(e,t,n,i="#4a90e2"){return Rh(e)?d.addSixteenthStampPlacement(e,t,n,i):(x.warn("SixteenthStampPlacements",`Invalid sixteenth stamp ID: ${e}`,{sixteenthStampId:e},"stamps"),null)}function jD(e,t,n,i){return d.eraseSixteenthStampsInArea(e,t,n,i)}function tb(){d.clearAllSixteenthStamps()}function eb(){return d.getSixteenthStampPlaybackData()}x.moduleLoaded("SixteenthStampScheduler","stamps");const sy=["0","16n","8n",{"8n":1,"16n":1}];function nb(e,t=null){const n=Rh(e);if(!n)return x.warn("SixteenthStampScheduler",`Unknown sixteenth stamp ID: ${e}`,{sixteenthStampId:e},"stamps"),[];const i=[];return n.ovals.forEach(r=>{var l;const A=`oval_${r}`,a=((l=t==null?void 0:t.shapeOffsets)==null?void 0:l[A])||0;i.push({offset:sy[r],duration:"8n",type:"oval",slot:r,shapeKey:A,rowOffset:a})}),n.diamonds.forEach(r=>{var l;const A=`diamond_${r}`,a=((l=t==null?void 0:t.shapeOffsets)==null?void 0:l[A])||0;i.push({offset:sy[r],duration:"16n",type:"diamond",slot:r,shapeKey:A,rowOffset:a})}),i}x.moduleLoaded("TripletStampPlacements","triplets");function JD(e,t,n,i="#4a90e2"){const r=Hh(e);if(!r)return x.warn("TripletStampPlacements",`Invalid triplet stamp ID: ${e}`,{tripletStampId:e},"triplets"),null;const A=D0[r.span]??1;if(!ZD(t,A,n))return x.debug("TripletStampPlacements",`Cannot place triplet at time ${t}, row ${n} - collision detected`,{tripletStampId:e,startTimeIndex:t,row:n,span:A},"triplets"),null;const a=n,l={id:`triplet_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,tripletStampId:e,startTimeIndex:t,span:A,row:n,globalRow:a,color:i,timestamp:Date.now()};return d.addTripletStampPlacement(l)}function ZD(e,t,n){const i=d.state,r=In(i),A=t*2,a=ds(e,i);for(const l of r){const c=l.columnIndex,h=l.columnIndex+1;if(c>=a&&c<a+A||a>=c&&a<=h)return!1}if(i.sixteenthStampPlacements){for(const l of i.sixteenthStampPlacements)if(l.row===n){const c=br(l.startColumn,i);if(c===null)return!1;const h=c+2,f=e+A;if(!(h<=e||c>=f))return!1}}if(i.tripletStampPlacements){for(const l of i.tripletStampPlacements)if(l.row===n){const c=l.startTimeIndex+l.span*2;if(!(e+A<=l.startTimeIndex||e>=c))return!1}}return!0}function t2(e,t,n,i){const r=d.state;if(!r.tripletStampPlacements)return!1;const A=[];for(const a of r.tripletStampPlacements)if(a.row>=n&&a.row<=i){const l=a.span*2,c=ds(a.startTimeIndex,r);c+l-1<e||c>t||A.push(a.id)}return A.length>0?(A.forEach(a=>d.removeTripletStampPlacement(a)),x.debug("TripletStampPlacements",`Erased ${A.length} triplet groups`,{removedIds:A,eraseArea:{eraseStartCol:e,eraseEndCol:t,eraseStartRow:n,eraseEndRow:i}},"triplets"),!0):!1}function sb(){return d.getTripletStampPlaybackData()}function ib(){d.clearAllTripletStamps(),x.info("TripletStampPlacements","Cleared all triplet stamp placements",null,"triplets")}x.moduleLoaded("TripletScheduler","triplets");function rb(e,t=null){const n=Hh(e);if(!n)return x.warn("TripletScheduler",`Unknown triplet stamp ID: ${e}`,{tripletStampId:e},"triplets"),[];const i=[],r=n.span==="eighth"?"8t":"4t",A=r;return n.hits.forEach(a=>{var f;const l=`triplet_${a}`,c=((f=t==null?void 0:t.shapeOffsets)==null?void 0:f[l])||0;let h;if(a===0)h="0";else if(a===1)h=r;else if(a===2){const m=et.Time(r).toSeconds();h=et.Time(m*2).toNotation()}else{const m=et.Time(r).toSeconds();h=et.Time(m*a).toNotation()}i.push({offset:h,duration:A,type:n.span==="eighth"?"triplet-eighth":"triplet-quarter",slot:a,shapeKey:l,rowOffset:c}),x.debug("TripletScheduler",`Triplet stamp ${e} ${n.span} at slot ${a} with offset "${h}", rowOffset: ${c}`,"triplets")}),x.debug("TripletScheduler",`Total events for triplet stamp ${e}:`,i.length,"triplets"),i}let Yn=[],qu=0,GA=0,KA=0;const iy=1e-4;function bg(){return 60/(d.state.tempo*2)}function Ab(){if(!d.state.hasAnacrusis)return x.debug("TransportService","[ANACRUSIS] No anacrusis, starting from time 0"),0;for(let e=0;e<d.state.macrobeatBoundaryStyles.length;e++)if(d.state.macrobeatBoundaryStyles[e]==="solid"){const t=Tn(d.state,e+1);if(t){const n=Yn[t.startColumn]||0;return x.debug("TransportService",`[ANACRUSIS] Found solid boundary at macrobeat ${e}, non-anacrusis starts at column ${t.startColumn}, time ${n.toFixed(3)}s`),n}}return x.debug("TransportService","[ANACRUSIS] No solid boundary found, starting from time 0"),0}function ea(){if(KA>GA){const e=et.Time(et.Transport.loopStart).toSeconds(),t=et.Time(et.Transport.loopEnd).toSeconds(),n=Math.abs(e-GA),i=Math.abs(t-KA);(n>iy||i>iy)&&(et.Transport.loopStart=GA,et.Transport.loopEnd=KA),et.Transport.loop!==d.state.isLooping&&(et.Transport.loop=d.state.isLooping)}}function e2(e,t){const n=Math.max(bg(),.001),i=Number.isFinite(e)?e:0;let r=Number.isFinite(t)?t:i+n;r<=i&&(r=i+n),GA=i,KA=r,et.Transport&&(et.Transport.loopStart=i,et.Transport.loopEnd=r),ea()}function n2(){return{loopStart:GA,loopEnd:KA}}function s2(e,t){GA=e,KA=t}function i2(){GA=0,KA=0}function r2(e,t,n){let i=0;x.debug("TransportService","[TIMEMAP] Building timeMap",{columnCount:t.length,tonicSignCount:n.length,microbeatDuration:e});const r=t.length,A=m0(n);for(let a=0;a<r;a++){Yn[a]=i;const l=A.has(a);if(l?x.debug("TransportService",`[TIMEMAP] Column ${a} is tonic, not advancing time`):i+=(t[a]||0)*e,a<5){const c=Yn[a];c!==void 0&&x.debug("TransportService",`[TIMEMAP] timeMap[${a}] = ${c.toFixed(3)}s (isTonic: ${l})`)}}r>0&&(Yn[r]=i),x.debug("TransportService",`[TIMEMAP] Complete. Total columns: ${r}, Final time: ${i.toFixed(3)}s`)}function ob(){var r;const e=Yn.length>0?Yn[Yn.length-1]??0:0;if(!Number.isFinite(e)||e===0){qu=0;return}const t=((r=d.state.modulationMarkers)==null?void 0:r.filter(A=>A.active))||[];if(t.length===0){qu=e;return}const n=[...t].sort((A,a)=>A.measureIndex-a.measureIndex);let i=e;for(const A of n){const a=Tn(d.state,A.measureIndex);if(a){const l=a.endColumn-1,c=Yn[l]??e,h=e-c,f=h*A.ratio;i=i-h+f}}qu=i}function _g(){return qu}function gh(){return Yn}function ry(e,t){var A;const n=((A=d.state.modulationMarkers)==null?void 0:A.filter(a=>a.active))||[];if(n.length===0)return e;const i=[...n].sort((a,l)=>a.measureIndex-l.measureIndex);let r=e;t<5&&x.debug("TransportService",`[MODULATION] Column ${t}: baseTime ${e.toFixed(3)}s, ${i.length} active markers`);for(const a of i){const l=Tn(d.state,a.measureIndex);if(l){const c=l.endColumn;if(t>c){const h=Yn[c]!==void 0?Yn[c]:0,f=e-h,m=f*a.ratio;r=r-f+m,t<5&&x.debug("TransportService",`[MODULATION] Column ${t}: Applied marker at measure ${a.measureIndex} (col ${c}), ratio ${a.ratio}, adjustedTime ${r.toFixed(3)}s`)}}}return r}function $u(){var A;x.debug("transportService","calculateTimeMap",{tempo:`${d.state.tempo} BPM`}),Yn=[];const e=bg(),{columnWidths:t}=d.state,n=In(d.state);r2(e,t,n),x.timing("transportService","calculateTimeMap",{totalDuration:`${(A=Yn[Yn.length-1])==null?void 0:A.toFixed(2)}s`}),ob();const r=_g();GD({timeMap:Yn,musicalEndTime:r,columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth}),typeof window<"u"&&(window.__transportTimeMap=[...Yn],window.__transportMusicalEnd=r.toString())}let xm=null;const Em=new Map,A2=1e-4;function ab(){Em.clear()}function o2(e,t){let n=Number.isFinite(t)?t:et.now();const i=Em.get(e)??-1/0;return n>i||(n=i+A2),Em.set(e,n),n}function a2(){return xm}function l2(){var t,n;const e=new et.Volume(0);if(xm=new et.Players({H:"https://tonejs.github.io/audio/drum-samples/CR78/hihat.mp3",M:"https://tonejs.github.io/audio/drum-samples/CR78/snare.mp3",L:"https://tonejs.github.io/audio/drum-samples/CR78/kick.mp3"}).connect(e),window.synthEngine){const i=(n=(t=window.synthEngine).getMainVolumeNode)==null?void 0:n.call(t);i?e.connect(i):e.toDestination()}else e.toDestination();return window.drumVolumeNode=e,xm}const lb="",cb="";function pp(e){const t=d.state.fullRowData[e];return t?t.toneNote.replace(lb,"b").replace(cb,"#"):"C4"}x.moduleLoaded("TransportService");let rs=null,Tm=!1;function Xr(...e){}function c2(e){const t=d.state.fullRowData,n=e.globalRow??e.row;return t!=null&&t[n]?t[n].toneNote.replace(lb,"b").replace(cb,"#"):"C4"}function mp(){var a,l;x.debug("transportService","scheduleNotes","Clearing previous transport events and rescheduling all notes"),et.Transport.cancel(),ab(),$u(),(a=jn.adsrComponent)==null||a.playheadManager.clearAll();const e=gh(),{loopEnd:t}=n2(),n=Ab(),i=d.state.modulationMarkers&&d.state.modulationMarkers.length>0;x.debug("TransportService",`[ANACRUSIS] hasAnacrusis: ${d.state.hasAnacrusis}, anacrusisOffset: ${n.toFixed(3)}s`),Xr("scheduleNotes:start",{anacrusisOffset:n,noteCount:d.state.placedNotes.length,hasModulation:i,lassoSelectionActive:!!((l=d.state.lassoSelection)!=null&&l.isActive),hasAnacrusis:d.state.hasAnacrusis}),d.state.placedNotes.forEach((c,h)=>{var U;const f=c.startColumnIndex,m=c.endColumnIndex,w=e[f];if(w===void 0){x.warn("TransportService",`[NOTE SCHEDULE] Note ${h}: timeMap[${f}] undefined, skipping`);return}const B=ry(w,f);h<3&&x.debug("TransportService",`[NOTE SCHEDULE] Note ${h}: canvas cols [${f}-${m}], startTime ${w.toFixed(3)}s, scheduleTime ${B.toFixed(3)}s`);let y;const b=e[m+1];if(b===void 0){x.warn("TransportService",`Skipping note with invalid endColumnIndex: ${c.endColumnIndex+1} (note ends at ${c.endColumnIndex})`,{noteId:c.uuid,startColumnIndex:c.startColumnIndex,endColumnIndex:c.endColumnIndex,lookupIndex:c.endColumnIndex+1,timeMapLength:e.length,maxValidIndex:e.length-1,noteShape:c.shape},"audio");return}const F=ry(b,m+1)-B;if(c.shape,y=F,c.isDrum)et.Transport.schedule(D=>{var V,O;if(d.state.isPaused)return;const H=c.drumTrack;if(H==null)return;const Q=String(H),R=o2(Q,D);(O=(V=a2())==null?void 0:V.player(Q))==null||O.start(R),WA.triggerNotePop(c.startColumnIndex,H)},B);else{const D=c2(c),H=c.color,Q=c.globalRow??c.row,R=((U=d.state.fullRowData[Q])==null?void 0:U.hex)||"#888888",V=c.uuid,O=d.state.timbres[H];if(!O){x.warn("TransportService",`Timbre not found for color ${H}. Skipping note ${V}`,null,"audio");return}let K=B+y;const gt=t-.001;K>=t&&(K=Math.max(B+.001,gt)),et.Transport.schedule(wt=>{var Ct;d.state.isPaused||(ye.triggerAttack(D,H,wt),(Ct=jn.adsrComponent)==null||Ct.playheadManager.trigger(V,"attack",R,O.adsr),d.emit("noteAttack",{noteId:V,color:H}))},B),et.Transport.schedule(wt=>{var Ct;ye.triggerRelease(D,H,wt),(Ct=jn.adsrComponent)==null||Ct.playheadManager.trigger(V,"release",R,O.adsr),d.emit("noteRelease",{noteId:V,color:H})},K)}});const r=eb();r.forEach(c=>{var w;const h=c.column,f=e[h];if(f===void 0)return;h<5&&x.debug("TransportService",`[STAMP SCHEDULE] Stamp at column ${h}: cellStartTime ${f.toFixed(3)}s, anacrusisOffset ${n.toFixed(3)}s`);const m=nb(c.sixteenthStampId,c.placement);m.forEach(B=>{const y=et.Time(B.offset).toSeconds(),b=et.Time(B.duration).toSeconds(),S=f+y,F=S+b,U=c.row+B.rowOffset,D=pp(U);et.Transport.schedule(H=>{d.state.isPaused||ye.triggerAttack(D,c.color,H)},S),et.Transport.schedule(H=>{d.state.isPaused||ye.triggerRelease(D,c.color,H)},F)}),x.debug("TransportService",`Scheduled stamp ${c.sixteenthStampId} with ${m.length} events at column ${c.column}`,{sixteenthStampId:c.sixteenthStampId,column:c.column,basePitch:c.pitch,baseRow:c.row,startTime:f,events:m.length,hasShapeOffsets:!!((w=c.placement)!=null&&w.shapeOffsets)},"audio")});const A=sb();A.forEach(c=>{var w,B,y;const h=ds(c.startTimeIndex,d.state),f=e[h];if(f===void 0)return;x.debug("TransportService","[TRANSPORT DEBUG] Scheduling triplet",{tripletStampId:c.tripletStampId,baseRow:c.row,hasPlacement:!!c.placement,hasShapeOffsets:!!((w=c.placement)!=null&&w.shapeOffsets),shapeOffsets:(B=c.placement)==null?void 0:B.shapeOffsets});const m=rb(c.tripletStampId,c.placement);m.forEach(b=>{const S=et.Time(b.offset).toSeconds(),F=et.Time(b.duration).toSeconds(),U=f+S,D=U+F,H=c.row+b.rowOffset,Q=pp(H);x.debug("TransportService","[TRANSPORT DEBUG] Scheduling shape",{slot:b.slot,rowOffset:b.rowOffset,baseRow:c.row,shapeRow:H,shapePitch:Q}),et.Transport.schedule(R=>{d.state.isPaused||ye.triggerAttack(Q,c.color,R)},U),et.Transport.schedule(R=>{d.state.isPaused||ye.triggerRelease(Q,c.color,R)},D)}),x.debug("TransportService",`Scheduled triplet ${c.tripletStampId} with ${m.length} events at time ${c.startTimeIndex}`,{tripletStampId:c.tripletStampId,startTimeIndex:c.startTimeIndex,basePitch:pp(c.row),baseRow:c.row,startTime:f,events:m.length,hasShapeOffsets:!!((y=c.placement)!=null&&y.shapeOffsets)},"audio")}),x.debug("TransportService","scheduleNotes",`Finished scheduling ${d.state.placedNotes.length} notes, ${r.length} stamps, and ${A.length} triplets`,"audio"),Xr("scheduleNotes:complete",{noteCount:d.state.placedNotes.length,stampCount:r.length,tripletCount:A.length,hasModulation:i})}function gp(){var b,S;const e=Sr.get("playheadCanvas");if(!e)return;const t=e.getContext("2d");if(!t)return;const n=t,i=Sr.get("drumPlayheadCanvas"),r=(i==null?void 0:i.getContext("2d"))??null,A=F=>{const U=document.getElementById(F);if(!U)return null;const D=U.querySelector(":scope > .playhead-column-highlight");if(D)return D;const H=document.createElement("div");return H.className="playhead-column-highlight",H.setAttribute("aria-hidden","true"),H.style.position="absolute",H.style.top="0",H.style.bottom="0",H.style.left="0",H.style.width="0",H.style.pointerEvents="none",H.style.background="rgb(255, 235, 0)",H.style.opacity="0.2",U.prepend(H),H},a=A("grouping-buttons-row"),l=A("boundary-buttons-row"),c=d.state.tempo,h=1e-4,f=.5,m=F=>(F==null?void 0:F.xPosition)??477.5,w=typeof((S=(b=et.Transport)==null?void 0:b.bpm)==null?void 0:S.value)=="number"?et.Transport.bpm.value:c;let B=c!==0?w/c:1;Tm=!0;function y(){if(!Tm||!e)return;if(et.Transport.state==="stopped"){rs=requestAnimationFrame(y);return}const F=et.Time(et.Transport.loopEnd).toSeconds(),U=d.state.isLooping,D=_g(),H=U&&F>0?F:D,Q=et.Transport.seconds,R=Q>=H-.001;if(!U&&R){x.info("TransportService","Playback reached end. Stopping playhead.",{currentTime:Q,playbackEnd:H,isLooping:U},"transport"),Xr("animate:stop-guard",{currentTime:Q,playbackEnd:H,isLooping:U,loopStart:et.Transport.loopStart,loopEnd:et.Transport.loopEnd}),Wi.stop();return}if(d.state.isPaused){rs=requestAnimationFrame(y);return}const V=gh(),O=Vn(e),K=tn(e);n.clearRect(0,0,O,K),i&&r&&r.clearRect(0,0,Vn(i),tn(i));let z=Q;if(U){const Ft=et.Time(et.Transport.loopStart).toSeconds(),rt=et.Time(et.Transport.loopEnd).toSeconds()-Ft;rt>0&&(z=(Q-Ft)%rt+Ft)}const gt=$D(),St=In(d.state),wt=m0(St);let Ct=0,Mt=0,Tt=0,J=-1;for(let Ft=0;Ft<V.length-1;Ft++){const jt=V[Ft],rt=V[Ft+1];if(!(jt===void 0||rt===void 0)&&z>=jt&&z<rt){let pt=Ft;for(;wt.has(pt)&&pt<V.length-1;)pt++;const it=mh(pt),Z=ZC(pt);if(Mt=it,Tt=Z,J=pt,wt.has(Ft))Ct=it;else{const mt=rt-jt,xt=z-jt,Bt=mt>0?xt/mt:0;Ct=it+Bt*Z}break}}const st=Math.min(Ct,gt),vt=(Array.isArray(d.state.modulationMarkers)?d.state.modulationMarkers:[]).filter(Ft=>(Ft==null?void 0:Ft.active)&&typeof Ft.ratio=="number"&&Ft.ratio!==0).sort((Ft,jt)=>m(Ft)-m(jt));if(vt.length>0){let Ft=1;for(const jt of vt){const rt=m(jt);if(st+f>=rt)Ft*=1/jt.ratio;else break}if((!Number.isFinite(Ft)||Ft<=0)&&(Ft=1),Math.abs(Ft-B)>h){const jt=c*Ft;et.Transport.bpm.value=jt,ea(),B=Ft;const rt={targetMultiplier:Number(Ft.toFixed(6)),newTempo:Number(jt.toFixed(3)),markerCount:vt.length,finalXPos:Number(st.toFixed(2))};x.debug("TransportService",`Tempo multiplier updated to ${Ft.toFixed(3)} (${jt.toFixed(2)} BPM)`,rt,"transport")}}else if(Math.abs(B-1)>h){et.Transport.bpm.value=c,ea(),B=1;const Ft={targetMultiplier:1,newTempo:Number(c.toFixed(3)),markerCount:vt.length,finalXPos:Number(st.toFixed(2))};x.debug("TransportService",`Tempo reset to base ${c} BPM`,Ft,"transport")}const ut=tn(e),Lt=d.state.playheadMode==="macrobeat"&&J>=0?Sm(J):null,$t=(Lt==null?void 0:Lt.x)??Mt,Vt=(Lt==null?void 0:Lt.width)??Tt;if(st>=0&&(d.state.playheadMode==="macrobeat"||d.state.playheadMode==="microbeat"?kl(n,$t,0,Vt,ut,performance.now()):(n.strokeStyle="rgba(255,0,0,0.8)",n.lineWidth=2,n.beginPath(),n.moveTo(st,0),n.lineTo(st,ut),n.stroke())),i&&r&&st>=0){const Ft=tn(i);d.state.playheadMode==="macrobeat"||d.state.playheadMode==="microbeat"?kl(r,$t,0,Vt,Ft,performance.now()):(r.strokeStyle="#FF6B35",r.lineWidth=3,r.beginPath(),r.moveTo(st,0),r.lineTo(st,Ft),r.stroke())}const Nt=d.state.playheadMode==="macrobeat"||d.state.playheadMode==="microbeat",Dt=$t,Et=Vt;a&&(a.style.display=Nt?"block":"none",Nt&&(a.style.left=`${Dt}px`,a.style.width=`${Et}px`)),l&&(l.style.display=Nt?"block":"none",Nt&&(l.style.left=`${Dt}px`,l.style.width=`${Et}px`)),rs=requestAnimationFrame(y)}y()}const Wi={init(){const e=l2();window.transportService={drumPlayers:e},et.Transport.bpm.value=d.state.tempo,d.on("rhythmStructureChanged",()=>this.handleStateChange()),d.on("notesChanged",()=>this.handleStateChange()),d.on("sixteenthStampPlacementsChanged",()=>this.handleStateChange()),d.on("modulationMarkersChanged",()=>{gh().length>0&&ob(),this.handleStateChange()}),d.on("layoutConfigChanged",t=>{var A,a;const n=((A=t==null?void 0:t.oldConfig)==null?void 0:A.columnWidths)||[],i=((a=t==null?void 0:t.newConfig)==null?void 0:a.columnWidths)||[];n.length!==i.length&&$u()}),d.on("tempoChanged",t=>{if(x.event("TransportService",`tempoChanged triggered with new value: ${t} BPM`,void 0,"transport"),et.Transport.state==="started"){x.info("TransportService","Tempo changed WHILE PLAYING. Resynchronizing transport...",null,"transport");const n=et.Transport.position;x.debug("TransportService",`Saved musical position: ${n}`,null,"transport"),et.Transport.pause(),x.debug("TransportService","Transport paused",null,"transport"),rs&&(cancelAnimationFrame(rs),rs=null),et.Transport.bpm.value=t,ea(),x.debug("TransportService",`New BPM set to ${et.Transport.bpm.value}`,null,"transport"),mp(),et.Transport.start(void 0,n),x.debug("TransportService",`Transport restarted at musical position ${n}`,null,"transport"),gp()}else x.debug("TransportService","Tempo changed while stopped/paused. Updating BPM for next run",null,"transport"),et.Transport.bpm.value=t,ea(),$u()}),d.on("loopingChanged",t=>{et.Transport.loop=t;const n=et.Time(et.Transport.loopStart).toSeconds(),i=et.Time(et.Transport.loopEnd).toSeconds();t&&i<=n&&(et.Transport.loopEnd=n+Math.max(bg(),.001)),t?s2(et.Time(et.Transport.loopStart).toSeconds(),et.Time(et.Transport.loopEnd).toSeconds()):i2(),Xr("loopingChanged:event",{isLooping:t,loopStart:et.Transport.loopStart,loopEnd:et.Transport.loopEnd})}),et.Transport.on("stop",()=>{var t;x.event("TransportService","Tone.Transport 'stop' fired. Resetting playback state",void 0,"transport"),d.setPlaybackState(!1,!1),(t=jn.adsrComponent)==null||t.playheadManager.clearAll(),rs&&(cancelAnimationFrame(rs),rs=null)}),x.info("TransportService","Initialized",null,"transport")},handleStateChange(){if(et.Transport.state==="started"){x.debug("TransportService","handleStateChange: Notes or rhythm changed during playback. Rescheduling",null,"transport");const t=et.Transport.position;et.Transport.pause(),mp(),et.Transport.start(void 0,t)}else $u()},start(){x.info("TransportService","Starting playback",null,"transport"),Xr("start:requested",{requestedTempo:d.state.tempo,isLooping:d.state.isLooping,placedNotes:d.state.placedNotes.length}),(window.initAudio||(()=>et.start()))().then(()=>{mp(),Xr("start:after-schedule",{scheduledNotes:d.state.placedNotes.length,scheduledStamps:eb().length,scheduledTriplets:sb().length});const t=gh(),n=t.length>0?t[t.length-1]??0:0,i=_g(),r=Ab();e2(r,i),et.Transport.bpm.value=d.state.tempo,x.debug("TransportService",`Transport configured. Loop: ${et.Transport.loop}, BPM: ${et.Transport.bpm.value}`,null,"transport"),Xr("start:configured",{loopStart:et.Transport.loopStart,loopEnd:et.Transport.loopEnd,timelineEnd:n,musicalDuration:i});const A=et.now()+.1;et.Transport.start(A,0),gp(),d.emit("playbackStarted")})},resume(){x.info("TransportService","Resuming playback",null,"transport"),(window.initAudio||(()=>et.start()))().then(()=>{et.Transport.start(),gp(),d.emit("playbackResumed")})},pause(){x.info("TransportService","Pausing playback",null,"transport"),et.Transport.pause(),rs&&(cancelAnimationFrame(rs),rs=null),d.emit("playbackPaused")},stop(){x.info("TransportService","Stopping playback and clearing visuals",null,"transport"),Tm=!1,rs&&(cancelAnimationFrame(rs),rs=null),et.Transport.stop(),et.Transport.cancel(),ab(),et.Transport.bpm.value=d.state.tempo,ea(),Xr("stop:transport-reset",{tempoResetTo:d.state.tempo}),ye.releaseAll();const e=Sr.get("playheadCanvas");if(e){const r=e.getContext("2d");r&&r.clearRect(0,0,Vn(e),tn(e))}const t=Sr.get("drumPlayheadCanvas");if(t){const r=t.getContext("2d");r&&r.clearRect(0,0,Vn(t),tn(t))}const n=document.querySelector("#grouping-buttons-row > .playhead-column-highlight");n&&(n.style.display="none");const i=document.querySelector("#boundary-buttons-row > .playhead-column-highlight");i&&(i.style.display="none"),d.emit("playbackStopped")}},u2=/(Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini)/i,ub=900;let Ay=!1,zu=ub,wp=!1;const h2=Object.freeze({isMobile:!1,isTouch:!1,isCoarsePointer:!1,orientation:"landscape",width:0,height:0});function Sg(){return typeof window<"u"?window:null}function d2(){const e=Sg();if(!e)return{...h2};const{innerWidth:t=0,innerHeight:n=0}=e,i=e.matchMedia?e.matchMedia("(orientation: portrait)"):null,r=i?i.matches?"portrait":"landscape":n>=t?"portrait":"landscape",A=!!(e.matchMedia&&e.matchMedia("(pointer: coarse)").matches),a=!!(e.matchMedia&&e.matchMedia("(hover: none)").matches),l=typeof navigator<"u"?navigator:null,c=(l==null?void 0:l.maxTouchPoints)??(l==null?void 0:l.msMaxTouchPoints)??0,h="ontouchstart"in e||c>0,f=l!=null&&l.userAgent?u2.test(l.userAgent):!1,m=t>0?t<=zu:!1;return{isMobile:!!(f||h&&(A||a||m)),isTouch:h,isCoarsePointer:A,orientation:r,width:t,height:n}}function f2(e){if(typeof document>"u")return;[document.documentElement,document.body].filter(Boolean).forEach(n=>{n.classList.toggle("is-mobile",!!e.isMobile),n.classList.toggle("is-touch",!!e.isTouch),n.classList.toggle("orientation-portrait",e.orientation==="portrait"),n.classList.toggle("orientation-landscape",e.orientation==="landscape")})}function xu(){if(wp)return;const e=Sg();e&&(wp=!0,e.requestAnimationFrame(()=>{wp=!1;const t=d2();d.setDeviceProfile(t),f2(t)}))}function p2(e,t){return e?typeof e.addEventListener=="function"?(e.addEventListener("change",t),()=>e.removeEventListener("change",t)):typeof e.addListener=="function"?(e.addListener(t),()=>e.removeListener(t)):()=>{}:()=>{}}function m2(e={}){const t=Sg();if(!t||Ay)return;zu=e.maxMobileWidth??ub,Ay=!0;const n=()=>xu(),i=()=>xu();t.addEventListener("resize",n),t.addEventListener("orientationchange",i),[t.matchMedia&&t.matchMedia("(pointer: coarse)"),t.matchMedia&&t.matchMedia("(hover: none)"),t.matchMedia&&t.matchMedia(`(max-width: ${zu}px)`),t.matchMedia&&t.matchMedia("(orientation: portrait)")].filter(Boolean).forEach(A=>{p2(A,xu)}),xu(),x.debug("DeviceProfileService",`Initialized (breakpoint <= ${zu}px)`,null,"ui")}const g2=()=>{const e="/student-notation/";return e.endsWith("/")?e:`${e}/`},w2=`${g2()}assets/`;function v2(e=""){const t=e.replace(/^\/+/,"");return`${w2}${t}`}function Di(e){return v2(`icons/${e}`)}class B2{constructor(){P(this,"tasks",[]);P(this,"completedTasks",0);P(this,"totalTasks",0);P(this,"startTime",null);P(this,"loadingScreen",null);P(this,"progressBar",null);P(this,"progressText",null);P(this,"statusText",null);P(this,"initialized",!1);P(this,"cache",{fonts:new Map,icons:new Map,modules:new Map});P(this,"diagnostics",[])}createLoadingScreen(){this.loadingScreen||(this.loadingScreen=document.createElement("div"),this.loadingScreen.id="app-loading-screen",this.loadingScreen.innerHTML=`
            <div class="loading-container">
                <div class="loading-logo">
                    <svg viewBox="0 0 100 100" class="logo-svg">
                        <circle cx="50" cy="50" r="45" class="logo-circle" />
                        <path d="M 30 50 Q 50 30, 70 50 T 70 70" class="logo-path" />
                    </svg>
                </div>
                <h1 class="loading-title">Student Notation</h1>
                <div class="loading-progress-container">
                    <div class="loading-progress-bar">
                        <div class="loading-progress-fill" id="loading-progress-fill"></div>
                    </div>
                    <div class="loading-progress-text" id="loading-progress-text">0%</div>
                </div>
                <div class="loading-status" id="loading-status">Initializing...</div>
            </div>
        `,document.body.appendChild(this.loadingScreen),this.progressBar=document.getElementById("loading-progress-fill"),this.progressText=document.getElementById("loading-progress-text"),this.statusText=document.getElementById("loading-status"))}registerTask(t,n=1){this.tasks.push({name:t,weight:n,completed:!1}),this.totalTasks+=n}completeTask(t){const n=this.tasks.find(i=>i.name===t&&!i.completed);n&&(n.completed=!0,this.completedTasks+=n.weight,this.updateProgress())}updateProgress(){if(!this.progressBar||!this.progressText)return;const t=this.totalTasks>0?this.completedTasks/this.totalTasks*100:0;this.progressBar.style.width=`${t}%`,this.progressText.textContent=`${Math.floor(t)}%`,t>=100&&this.completeLoading()}setStatus(t){this.statusText&&(this.statusText.textContent=t)}start(){this.initialized||(this.initialized=!0,this.startTime=performance.now())}completeLoading(){this.loadingScreen&&(this.loadingScreen.classList.add("fade-out"),setTimeout(()=>{var t;(t=this.loadingScreen)==null||t.remove(),this.loadingScreen=null},400))}showError(t){if(this.statusText){const n=t instanceof Error?t.message:String(t);this.statusText.textContent=`Error: ${n}`,this.statusText.style.color="#ff4444"}}init(){this.createLoadingScreen(),this.start()}updateStatus(t){this.setStatus(t)}async complete(){this.completeLoading()}async preloadIcon(t){if(this.cache.icons.has(t))return this.cache.icons.get(t);const n=Di(t);return this.cache.icons.set(t,n),n}getDiagnostics(){return[...this.diagnostics]}}const Kn=new B2;let xg=!1,Eg=[],Xu=null;function hb(){xg=!0}function y2(){xg=!1}function db(e){try{return JSON.parse(JSON.stringify(e,(t,n)=>n instanceof Float32Array?{__type:"Float32Array",data:Array.from(n)}:n))}catch{return null}}function Fm(e,t,n="root"){const i=[];if(!e||!t)return i;if(typeof e!=typeof t)return i.push({path:n,type:"type_change",oldValue:typeof e,newValue:typeof t,timestamp:Date.now()}),i;if(typeof e!="object")return e!==t&&i.push({path:n,type:"value_change",oldValue:e,newValue:t,timestamp:Date.now()}),i;if(Array.isArray(e)){if(!Array.isArray(t))return i.push({path:n,type:"array_to_non_array",oldLength:e.length,newType:typeof t,timestamp:Date.now()}),i;e.length!==t.length&&i.push({path:n,type:"array_length_change",oldLength:e.length,newLength:t.length,timestamp:Date.now()});const A=Math.max(e.length,t.length);for(let a=0;a<A;a++){const l=Fm(e[a],t[a],`${n}[${a}]`);i.push(...l)}return i}const r=new Set([...Object.keys(e),...Object.keys(t)]);for(const A of r)if(!(A in e))i.push({path:`${n}.${String(A)}`,type:"property_added",newValue:t[A],timestamp:Date.now()});else if(!(A in t))i.push({path:`${n}.${String(A)}`,type:"property_removed",oldValue:e[A],timestamp:Date.now()});else{const a=Fm(e[A],t[A],`${n}.${String(A)}`);i.push(...a)}return i}function C2(e){Xu=db(e)}function b2(e,t="unknown"){if(!xg||!Xu)return;const n=db(e),i=Fm(Xu,n);if(i.length>0){const r=i.filter(A=>!A.path.includes("tempo")&&!A.path.includes("isPlaying")&&!A.path.includes("fullRowData")&&!A.path.includes("columnWidths"));r.length>0&&Eg.push({action:t,mutations:r,timestamp:Date.now()})}Xu=n}function _2(){return[...Eg]}function S2(){Eg=[]}typeof window<"u"&&(window.stateGuard={enable:hb,disable:y2,getLog:_2,clearLog:S2});x.moduleLoaded("RhythmPlaybackService");class x2{constructor(){P(this,"scheduledEvents",[]);P(this,"isInitialized",!1);this.scheduledEvents=[],this.isInitialized=!1}init(){return this.initialize()}refresh(){this.stopCurrentPattern()}async initialize(){this.isInitialized||(this.isInitialized=!0,x.info("RhythmPlaybackService","Initialized"),window.rhythmPlaybackService=this)}playRhythmPattern(t,n,i,r="oval",A=null){if(!this.isInitialized){x.warn("RhythmPlaybackService","Not initialized, call initialize() first");return}this.stopCurrentPattern();const a=nb(t,A);if(!a||a.length===0){x.warn("RhythmPlaybackService",`No events found for sixteenth stamp ${t}`);return}x.debug("RhythmPlaybackService",`Playing pattern for sixteenth stamp ${t}: ${a.length} notes`,{sixteenthStampId:t,basePitch:n,color:i,events:a,hasShapeOffsets:!!(A!=null&&A.shapeOffsets)});const l=et.now(),c=(A==null?void 0:A.globalRow)??(A==null?void 0:A.row);a.forEach((h,f)=>{try{const m=et.Time(String(h.offset)).toSeconds(),w=l+m,B=et.Time(String(h.duration)).toSeconds(),y=r==="circle"?B*2:B,b=w+y;let S=n;if(c!==void 0&&h.rowOffset!==0){const F=c+h.rowOffset,U=d.state.fullRowData[F];U&&(S=U.toneNote.replace("","b").replace("","#"))}ye.triggerAttack(S,i,w),ye.triggerRelease(S,i,b),this.scheduledEvents.push({pitch:S,color:i,attackTime:w,releaseTime:b})}catch(m){x.warn("RhythmPlaybackService",`Error scheduling note ${f+1}`,m)}}),x.info("RhythmPlaybackService",`Scheduled ${a.length} notes for rhythm pattern ${t}`)}stopCurrentPattern(){this.scheduledEvents.length!==0&&(x.debug("RhythmPlaybackService",`Clearing ${this.scheduledEvents.length} scheduled events`),ye.releaseAll(),this.scheduledEvents=[])}getSixteenthStampAtPosition(t,n){return d.state.sixteenthStampPlacements&&d.state.sixteenthStampPlacements.find(r=>{const A=r.row===n,a=t>=r.startColumn&&t<r.endColumn;return A&&a})||null}playTripletPattern(t,n,i,r=null){if(!this.isInitialized){x.warn("RhythmPlaybackService","Not initialized, call initialize() first");return}this.stopCurrentPattern();const A=rb(t,r);if(!A||A.length===0){x.warn("RhythmPlaybackService",`No events found for triplet ${t}`);return}x.debug("RhythmPlaybackService",`Playing triplet pattern ${t}: ${A.length} notes`,{tripletStampId:t,basePitch:n,color:i,events:A,hasShapeOffsets:!!(r!=null&&r.shapeOffsets)});const a=et.now(),l=(r==null?void 0:r.globalRow)??(r==null?void 0:r.row);A.forEach((c,h)=>{try{const f=et.Time(c.offset).toSeconds(),m=a+f,w=et.Time(c.duration).toSeconds(),B=m+w;let y=n;if(l!==void 0&&c.rowOffset!==0){const b=l+c.rowOffset,S=d.state.fullRowData[b];S&&(y=S.toneNote.replace("?T-","b").replace("?T_","#"))}ye.triggerAttack(y,i,m),ye.triggerRelease(y,i,B),this.scheduledEvents.push({pitch:y,color:i,attackTime:m,releaseTime:B})}catch(f){x.warn("RhythmPlaybackService",`Error scheduling triplet note ${h+1}`,f)}}),x.info("RhythmPlaybackService",`Scheduled ${A.length} notes for triplet pattern ${t}`)}getTripletStampAtPosition(t,n){return d.state.tripletStampPlacements&&d.state.tripletStampPlacements.find(i=>i.row===n&&t>=i.startTimeIndex&&t<i.startTimeIndex+i.span*2)||null}dispose(){this.stopCurrentPattern(),this.isInitialized=!1,x.info("RhythmPlaybackService","Disposed")}}const An=new x2,fb=[];function Ze(...e){fb.push(e)}const pb={enableModulationTool(){d.setSelectedTool("modulation"),Ze("[MODULATION TEST] Modulation tool enabled. Click on the grid to place markers."),Ze("[MODULATION TEST] Click marker labels to toggle 2:3  3:2"),Ze("[MODULATION TEST] Drag marker barlines to move them")},addTestMarker(){const t=this.findNearestGridLine(200),n=this.findMeasureIndexForX(t.x),i=d.addModulationMarker(n,ls.COMPRESSION_2_3,t.x,t.columnIndex);return Ze("[MODULATION TEST] Added test marker at measure",n,"columnIndex=",t.columnIndex,"x=",t.x,"(snapped from",200,")"),i},addTestMarker2(){const t=this.findNearestGridLine(400),n=this.findMeasureIndexForX(t.x),i=d.addModulationMarker(n,ls.EXPANSION_3_2,t.x,t.columnIndex);return Ze("[MODULATION TEST] Added test marker 2 at measure",n,"columnIndex=",t.columnIndex,"x=",t.x,"(snapped from",400,")"),i},findNearestGridLine(e){const t=d.state;let n=0,i=0,r=1/0,A=0;for(let a=0;a<t.columnWidths.length;a++){const l=Math.abs(A-e);l<r&&(r=l,i=A,n=a);const c=t.columnWidths[a]||0;A+=c*t.cellWidth}return Ze("[MODULATION TEST] findNearestGridLine:",{targetX:e,closestColumnIndex:n,closestX:i,minDistance:r}),{columnIndex:n,x:i}},findMeasureIndexForX(e){const t=d.state.cellWidth||40,n=5,i=Math.round(e/t);return Math.max(1,Math.round(i/n))},clearAllMarkers(){[...d.state.modulationMarkers||[]].forEach(t=>{d.removeModulationMarker(t.id)}),Ze("[MODULATION TEST] Cleared all markers")},testMapping(){var n;const e=d.state.baseMicrobeatPx||d.state.cellWidth||40;Ze("[MODULATION TEST] Base microbeat pixels:",e),Ze("[MODULATION TEST] Modulation markers:",d.state.modulationMarkers);const t=typeof window<"u"?(n=window.getModulationMapping)==null?void 0:n.call(window):void 0;t&&(Ze("[MODULATION TEST] Coordinate mapping:",t),[0,100,200,300,400,500].forEach(r=>{const A=t.canvasXToMicrobeat(r),a=t.microbeatToCanvasX(A);Ze(`[MODULATION TEST] x=${r}  microbeat=${A.toFixed(3)}  x=${a.toFixed(1)}`)}))},testVisualExpansion(){var t;Ze("[MODULATION TEST] Testing visual grid expansion..."),this.clearAllMarkers();const e=this.addTestMarker2();Ze("[MODULATION TEST] Added 3:2 expansion marker:",e),typeof window<"u"&&((t=window.LayoutService)!=null&&t.recalculateLayout)&&(Ze("[MODULATION TEST] Manually triggering layout recalculation..."),window.LayoutService.recalculateLayout()),setTimeout(()=>{Ze("[MODULATION TEST] Grid should now show expansion after x=400"),Ze("[MODULATION TEST] Container should be wider to accommodate expansion"),Ze("[MODULATION TEST] Check console for [LAYOUT], [GETCOLX], [GRIDLINES], and [NOTES] logs")},100)},testVisualCompression(){var t;Ze("[MODULATION TEST] Testing visual grid compression..."),this.clearAllMarkers();const e=this.addTestMarker();Ze("[MODULATION TEST] Added 2:3 compression marker:",e),typeof window<"u"&&((t=window.LayoutService)!=null&&t.recalculateLayout)&&(Ze("[MODULATION TEST] Manually triggering layout recalculation..."),window.LayoutService.recalculateLayout()),setTimeout(()=>{Ze("[MODULATION TEST] Grid should now show compression after x=200"),Ze("[MODULATION TEST] Container should adjust to accommodate compression"),Ze("[MODULATION TEST] Check console for [LAYOUT], [GETCOLX], [GRIDLINES], and [NOTES] logs")},100)},logState(){Ze("[MODULATION TEST] Current state:",{selectedTool:d.state.selectedTool,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.baseMicrobeatPx,cellWidth:d.state.cellWidth})}};typeof window<"u"&&(window.ModulationTest=pb,window.ModulationTestLogs=fb);x.moduleLoaded("ToolbarComponent","toolbar");const E2={init(){x.info("ToolbarComponent","Toolbar init called (all controls managed by Svelte)",null,"toolbar")}},Im=!1;var T2=Array.isArray,F2=Array.prototype.indexOf,I2=Array.from,M2=Object.defineProperty,Ll=Object.getOwnPropertyDescriptor,Q2=Object.getOwnPropertyDescriptors,U2=Object.prototype,P2=Array.prototype,mb=Object.getPrototypeOf,oy=Object.isExtensible;function D2(e){for(var t=0;t<e.length;t++)e[t]()}function gb(){var e,t,n=new Promise((i,r)=>{e=i,t=r});return{promise:n,resolve:e,reject:t}}const Wn=2,wb=4,Tg=8,k2=1<<24,xr=16,Er=32,JA=64,jh=128,Ci=512,Jn=1024,Es=2048,zi=4096,qi=8192,aA=16384,Fg=32768,aa=65536,ay=1<<17,vb=1<<18,ma=1<<19,L2=1<<20,XA=32768,Mm=1<<21,Ig=1<<22,lA=1<<23,vp=Symbol("$state"),R2=Symbol(""),Vo=new class extends Error{constructor(){super(...arguments);P(this,"name","StaleReactionError");P(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Bb(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function H2(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function N2(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function O2(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function V2(e){throw new Error("https://svelte.dev/e/effect_orphan")}function W2(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function G2(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function K2(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function q2(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function $2(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const z2=2,qn=Symbol(),X2="http://www.w3.org/1999/xhtml";function Y2(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function yb(e){return e===this.v}let j2=!1,Ts=null;function la(e){Ts=e}function _i(e,t=!1,n){Ts={p:Ts,i:!1,c:null,e:null,s:e,x:null,l:null}}function Si(e){var t=Ts,n=t.e;if(n!==null){t.e=null;for(var i of n)Hb(i)}return t.i=!0,Ts=t.p,{}}function Cb(){return!0}let Wo=[];function J2(){var e=Wo;Wo=[],D2(e)}function Mg(e){if(Wo.length===0){var t=Wo;queueMicrotask(()=>{t===Wo&&J2()})}Wo.push(e)}function bb(e){var t=ke;if(t===null)return fe.f|=lA,e;if((t.f&Fg)===0){if((t.f&jh)===0)throw e;t.b.error(e)}else ca(e,t)}function ca(e,t){for(;t!==null;){if((t.f&jh)!==0)try{t.b.error(e);return}catch(n){e=n}t=t.parent}throw e}const Eu=new Set;let Qe=null,pn=null,ki=[],Qg=null,Qm=!1;var sa,ia,DA,kA,uc,ra,Aa,On,Um,vl,Pm,_b,Sb;const Qh=class Qh{constructor(){Be(this,On);P(this,"committed",!1);P(this,"current",new Map);P(this,"previous",new Map);Be(this,sa,new Set);Be(this,ia,new Set);Be(this,DA,0);Be(this,kA,0);Be(this,uc,null);Be(this,ra,new Set);Be(this,Aa,new Set);P(this,"skipped_effects",new Set);P(this,"is_fork",!1)}is_deferred(){return this.is_fork||lt(this,kA)>0}process(t){var i;ki=[],this.apply();var n={parent:null,effect:null,effects:[],render_effects:[]};for(const r of t)ln(this,On,Um).call(this,r,n);this.is_fork||ln(this,On,_b).call(this),this.is_deferred()?(ln(this,On,vl).call(this,n.effects),ln(this,On,vl).call(this,n.render_effects)):(Qe=null,ly(n.render_effects),ly(n.effects),(i=lt(this,uc))==null||i.resolve()),pn=null}capture(t,n){this.previous.has(t)||this.previous.set(t,n),(t.f&lA)===0&&(this.current.set(t,t.v),pn==null||pn.set(t,t.v))}activate(){Qe=this,this.apply()}deactivate(){Qe===this&&(Qe=null,pn=null)}flush(){if(this.activate(),ki.length>0){if(Z2(),Qe!==null&&Qe!==this)return}else lt(this,DA)===0&&this.process([]);this.deactivate()}discard(){for(const t of lt(this,ia))t(this);lt(this,ia).clear()}increment(t){le(this,DA,lt(this,DA)+1),t&&le(this,kA,lt(this,kA)+1)}decrement(t){le(this,DA,lt(this,DA)-1),t&&le(this,kA,lt(this,kA)-1),this.revive()}revive(){for(const t of lt(this,ra))lt(this,Aa).delete(t),Zn(t,Es),YA(t);for(const t of lt(this,Aa))Zn(t,zi),YA(t);this.flush()}oncommit(t){lt(this,sa).add(t)}ondiscard(t){lt(this,ia).add(t)}settled(){return(lt(this,uc)??le(this,uc,gb())).promise}static ensure(){if(Qe===null){const t=Qe=new Qh;Eu.add(Qe),Qh.enqueue(()=>{Qe===t&&t.flush()})}return Qe}static enqueue(t){Mg(t)}apply(){}};sa=new WeakMap,ia=new WeakMap,DA=new WeakMap,kA=new WeakMap,uc=new WeakMap,ra=new WeakMap,Aa=new WeakMap,On=new WeakSet,Um=function(t,n){var f;t.f^=Jn;for(var i=t.first;i!==null;){var r=i.f,A=(r&(Er|JA))!==0,a=A&&(r&Jn)!==0,l=a||(r&qi)!==0||this.skipped_effects.has(i);if((i.f&jh)!==0&&((f=i.b)!=null&&f.is_pending())&&(n={parent:n,effect:i,effects:[],render_effects:[]}),!l&&i.fn!==null){A?i.f^=Jn:(r&wb)!==0?n.effects.push(i):gc(i)&&((i.f&xr)!==0&&lt(this,ra).add(i),Ac(i));var c=i.first;if(c!==null){i=c;continue}}var h=i.parent;for(i=i.next;i===null&&h!==null;)h===n.effect&&(ln(this,On,vl).call(this,n.effects),ln(this,On,vl).call(this,n.render_effects),n=n.parent),i=h.next,h=h.parent}},vl=function(t){for(const n of t)(n.f&Es)!==0?lt(this,ra).add(n):(n.f&zi)!==0&&lt(this,Aa).add(n),ln(this,On,Pm).call(this,n.deps),Zn(n,Jn)},Pm=function(t){if(t!==null)for(const n of t)(n.f&Wn)===0||(n.f&XA)===0||(n.f^=XA,ln(this,On,Pm).call(this,n.deps))},_b=function(){if(lt(this,kA)===0){for(const t of lt(this,sa))t();lt(this,sa).clear()}lt(this,DA)===0&&ln(this,On,Sb).call(this)},Sb=function(){var A;if(Eu.size>1){this.previous.clear();var t=pn,n=!0,i={parent:null,effect:null,effects:[],render_effects:[]};for(const a of Eu){if(a===this){n=!1;continue}const l=[];for(const[h,f]of this.current){if(a.current.has(h))if(n&&f!==a.current.get(h))a.current.set(h,f);else continue;l.push(h)}if(l.length===0)continue;const c=[...a.current.keys()].filter(h=>!this.current.has(h));if(c.length>0){var r=ki;ki=[];const h=new Set,f=new Map;for(const m of l)xb(m,c,h,f);if(ki.length>0){Qe=a,a.apply();for(const m of ki)ln(A=a,On,Um).call(A,m,i);a.deactivate()}ki=r}}Qe=null,pn=t}this.committed=!0,Eu.delete(this)};let Br=Qh;function Z2(){var e=qA;Qm=!0;var t=null;try{var n=0;for(yh(!0);ki.length>0;){var i=Br.ensure();if(n++>1e3){var r,A;tk()}i.process(ki),cA.clear()}}finally{Qm=!1,yh(e),Qg=null}}function tk(){try{W2()}catch(e){ca(e,Qg)}}let pi=null;function ly(e){var t=e.length;if(t!==0){for(var n=0;n<t;){var i=e[n++];if((i.f&(aA|qi))===0&&gc(i)&&(pi=new Set,Ac(i),i.deps===null&&i.first===null&&i.nodes===null&&(i.teardown===null&&i.ac===null?Wb(i):i.fn=null),(pi==null?void 0:pi.size)>0)){cA.clear();for(const r of pi){if((r.f&(aA|qi))!==0)continue;const A=[r];let a=r.parent;for(;a!==null;)pi.has(a)&&(pi.delete(a),A.push(a)),a=a.parent;for(let l=A.length-1;l>=0;l--){const c=A[l];(c.f&(aA|qi))===0&&Ac(c)}}pi.clear()}}pi=null}}function xb(e,t,n,i){if(!n.has(e)&&(n.add(e),e.reactions!==null))for(const r of e.reactions){const A=r.f;(A&Wn)!==0?xb(r,t,n,i):(A&(Ig|xr))!==0&&(A&Es)===0&&Eb(r,t,i)&&(Zn(r,Es),YA(r))}}function Eb(e,t,n){const i=n.get(e);if(i!==void 0)return i;if(e.deps!==null)for(const r of e.deps){if(t.includes(r))return!0;if((r.f&Wn)!==0&&Eb(r,t,n))return n.set(r,!0),!0}return n.set(e,!1),!1}function YA(e){for(var t=Qg=e;t.parent!==null;){t=t.parent;var n=t.f;if(Qm&&t===ke&&(n&xr)!==0&&(n&vb)===0)return;if((n&(JA|Er))!==0){if((n&Jn)===0)return;t.f^=Jn}}ki.push(t)}function ek(e){let t=0,n=Jh(0),i;return()=>{ic()&&(qt(n),vk(()=>(t===0&&(i=Dg(()=>e(()=>Rl(n)))),t+=1,()=>{Mg(()=>{t-=1,t===0&&(i==null||i(),i=void 0,Rl(n))})})))}}var nk=aa|ma|jh;function sk(e,t,n){new ik(e,t,n)}var zs,Xs,jm,Li,LA,Ri,Ys,vs,Hi,gr,Yr,RA,jr,HA,Jr,Uh,Fn,rk,Ak,Dm,Yu,ju,km;class ik{constructor(t,n,i){Be(this,Fn);P(this,"parent");Be(this,zs,!1);Be(this,Xs);Be(this,jm,null);Be(this,Li);Be(this,LA);Be(this,Ri);Be(this,Ys,null);Be(this,vs,null);Be(this,Hi,null);Be(this,gr,null);Be(this,Yr,null);Be(this,RA,0);Be(this,jr,0);Be(this,HA,!1);Be(this,Jr,null);Be(this,Uh,ek(()=>(le(this,Jr,Jh(lt(this,RA))),()=>{le(this,Jr,null)})));le(this,Xs,t),le(this,Li,n),le(this,LA,i),this.parent=ke.b,le(this,zs,!!lt(this,Li).pending),le(this,Ri,Nb(()=>{ke.b=this;{var r=ln(this,Fn,Dm).call(this);try{le(this,Ys,pr(()=>i(r)))}catch(A){this.error(A)}lt(this,jr)>0?ln(this,Fn,ju).call(this):le(this,zs,!1)}return()=>{var A;(A=lt(this,Yr))==null||A.remove()}},nk))}is_pending(){return lt(this,zs)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!lt(this,Li).pending}update_pending_count(t){ln(this,Fn,km).call(this,t),le(this,RA,lt(this,RA)+t),lt(this,Jr)&&vh(lt(this,Jr),lt(this,RA))}get_effect_pending(){return lt(this,Uh).call(this),qt(lt(this,Jr))}error(t){var n=lt(this,Li).onerror;let i=lt(this,Li).failed;if(lt(this,HA)||!n&&!i)throw t;lt(this,Ys)&&(Os(lt(this,Ys)),le(this,Ys,null)),lt(this,vs)&&(Os(lt(this,vs)),le(this,vs,null)),lt(this,Hi)&&(Os(lt(this,Hi)),le(this,Hi,null));var r=!1,A=!1;const a=()=>{if(r){Y2();return}r=!0,A&&$2(),Br.ensure(),le(this,RA,0),lt(this,Hi)!==null&&Hl(lt(this,Hi),()=>{le(this,Hi,null)}),le(this,zs,this.has_pending_snippet()),le(this,Ys,ln(this,Fn,Yu).call(this,()=>(le(this,HA,!1),pr(()=>lt(this,LA).call(this,lt(this,Xs)))))),lt(this,jr)>0?ln(this,Fn,ju).call(this):le(this,zs,!1)};var l=fe;try{_s(null),A=!0,n==null||n(t,a),A=!1}catch(c){ca(c,lt(this,Ri)&&lt(this,Ri).parent)}finally{_s(l)}i&&Mg(()=>{le(this,Hi,ln(this,Fn,Yu).call(this,()=>{Br.ensure(),le(this,HA,!0);try{return pr(()=>{i(lt(this,Xs),()=>t,()=>a)})}catch(c){return ca(c,lt(this,Ri).parent),null}finally{le(this,HA,!1)}}))})}}zs=new WeakMap,Xs=new WeakMap,jm=new WeakMap,Li=new WeakMap,LA=new WeakMap,Ri=new WeakMap,Ys=new WeakMap,vs=new WeakMap,Hi=new WeakMap,gr=new WeakMap,Yr=new WeakMap,RA=new WeakMap,jr=new WeakMap,HA=new WeakMap,Jr=new WeakMap,Uh=new WeakMap,Fn=new WeakSet,rk=function(){try{le(this,Ys,pr(()=>lt(this,LA).call(this,lt(this,Xs))))}catch(t){this.error(t)}le(this,zs,!1)},Ak=function(){const t=lt(this,Li).pending;t&&(le(this,vs,pr(()=>t(lt(this,Xs)))),Br.enqueue(()=>{var n=ln(this,Fn,Dm).call(this);le(this,Ys,ln(this,Fn,Yu).call(this,()=>(Br.ensure(),pr(()=>lt(this,LA).call(this,n))))),lt(this,jr)>0?ln(this,Fn,ju).call(this):(Hl(lt(this,vs),()=>{le(this,vs,null)}),le(this,zs,!1))}))},Dm=function(){var t=lt(this,Xs);return lt(this,zs)&&(le(this,Yr,Bh()),lt(this,Xs).before(lt(this,Yr)),t=lt(this,Yr)),t},Yu=function(t){var n=ke,i=fe,r=Ts;Xi(lt(this,Ri)),_s(lt(this,Ri)),la(lt(this,Ri).ctx);try{return t()}catch(A){return bb(A),null}finally{Xi(n),_s(i),la(r)}},ju=function(){const t=lt(this,Li).pending;lt(this,Ys)!==null&&(le(this,gr,document.createDocumentFragment()),lt(this,gr).append(lt(this,Yr)),qb(lt(this,Ys),lt(this,gr))),lt(this,vs)===null&&le(this,vs,pr(()=>t(lt(this,Xs))))},km=function(t){var n;if(!this.has_pending_snippet()){this.parent&&ln(n=this.parent,Fn,km).call(n,t);return}le(this,jr,lt(this,jr)+t),lt(this,jr)===0&&(le(this,zs,!1),lt(this,vs)&&Hl(lt(this,vs),()=>{le(this,vs,null)}),lt(this,gr)&&(lt(this,Xs).before(lt(this,gr)),le(this,gr,null)))};function ok(e,t,n,i){const r=Tb;if(n.length===0&&e.length===0){i(t.map(r));return}var A=Qe,a=ke,l=ak();function c(){Promise.all(n.map(h=>lk(h))).then(h=>{l();try{i([...t.map(r),...h])}catch(f){(a.f&aA)===0&&ca(f,a)}A==null||A.deactivate(),wh()}).catch(h=>{ca(h,a)})}e.length>0?Promise.all(e).then(()=>{l();try{return c()}finally{A==null||A.deactivate(),wh()}}):c()}function ak(){var e=ke,t=fe,n=Ts,i=Qe;return function(A=!0){Xi(e),_s(t),la(n),A&&(i==null||i.activate())}}function wh(){Xi(null),_s(null),la(null)}function Tb(e){var t=Wn|Es,n=fe!==null&&(fe.f&Wn)!==0?fe:null;return ke!==null&&(ke.f|=ma),{ctx:Ts,deps:null,effects:null,equals:yb,f:t,fn:e,reactions:null,rv:0,v:qn,wv:0,parent:n??ke,ac:null}}function lk(e,t){let n=ke;n===null&&H2();var i=n.b,r=void 0,A=Jh(qn),a=!fe,l=new Map;return wk(()=>{var w;var c=gb();r=c.promise;try{Promise.resolve(e()).then(c.resolve,c.reject).then(()=>{h===Qe&&h.committed&&h.deactivate(),wh()})}catch(B){c.reject(B),wh()}var h=Qe;if(a){var f=!i.is_pending();i.update_pending_count(1),h.increment(f),(w=l.get(h))==null||w.reject(Vo),l.delete(h),l.set(h,c)}const m=(B,y=void 0)=>{if(h.activate(),y)y!==Vo&&(A.f|=lA,vh(A,y));else{(A.f&lA)!==0&&(A.f^=lA),vh(A,B);for(const[b,S]of l){if(l.delete(b),b===h)break;S.reject(Vo)}}a&&(i.update_pending_count(-1),h.decrement(f))};c.promise.then(m,B=>m(null,B||"unknown"))}),mk(()=>{for(const c of l.values())c.reject(Vo)}),new Promise(c=>{function h(f){function m(){f===r?c(A):h(r)}f.then(m,m)}h(r)})}function Bp(e){const t=Tb(e);return $b(t),t}function Fb(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)Os(t[n])}}function ck(e){for(var t=e.parent;t!==null;){if((t.f&Wn)===0)return(t.f&aA)===0?t:null;t=t.parent}return null}function Ug(e){var t,n=ke;Xi(ck(e));try{e.f&=~XA,Fb(e),t=jb(e)}finally{Xi(n)}return t}function Ib(e){var t=Ug(e);if(e.equals(t)||(Qe!=null&&Qe.is_fork||(e.v=t),e.wv=Xb()),!ga)if(pn!==null)(ic()||Qe!=null&&Qe.is_fork)&&pn.set(e,t);else{var n=(e.f&Ci)===0?zi:Jn;Zn(e,n)}}let Lm=new Set;const cA=new Map;let Mb=!1;function Jh(e,t){var n={f:0,v:e,reactions:null,equals:yb,rv:0,wv:0};return n}function Pe(e,t){const n=Jh(e);return $b(n),n}function ae(e,t,n=!1){fe!==null&&(!Gi||(fe.f&ay)!==0)&&Cb()&&(fe.f&(Wn|xr|Ig|ay))!==0&&!(us!=null&&us.includes(e))&&q2();let i=n?vi(t):t;return vh(e,i)}function vh(e,t){if(!e.equals(t)){var n=e.v;ga?cA.set(e,t):cA.set(e,n),e.v=t;var i=Br.ensure();i.capture(e,n),(e.f&Wn)!==0&&((e.f&Es)!==0&&Ug(e),Zn(e,(e.f&Ci)!==0?Jn:zi)),e.wv=Xb(),Qb(e,Es),ke!==null&&(ke.f&Jn)!==0&&(ke.f&(Er|JA))===0&&($s===null?bk([e]):$s.push(e)),!i.is_fork&&Lm.size>0&&!Mb&&uk()}return t}function uk(){Mb=!1;var e=qA;yh(!0);const t=Array.from(Lm);try{for(const n of t)(n.f&Jn)!==0&&Zn(n,zi),gc(n)&&Ac(n)}finally{yh(e)}Lm.clear()}function Rl(e){ae(e,e.v+1)}function Qb(e,t){var n=e.reactions;if(n!==null)for(var i=n.length,r=0;r<i;r++){var A=n[r],a=A.f,l=(a&Es)===0;if(l&&Zn(A,t),(a&Wn)!==0){var c=A;pn==null||pn.delete(c),(a&XA)===0&&(a&Ci&&(A.f|=XA),Qb(c,zi))}else l&&((a&xr)!==0&&pi!==null&&pi.add(A),YA(A))}}function vi(e){if(typeof e!="object"||e===null||vp in e)return e;const t=mb(e);if(t!==U2&&t!==P2)return e;var n=new Map,i=T2(e),r=Pe(0),A=$A,a=l=>{if($A===A)return l();var c=fe,h=$A;_s(null),hy(A);var f=l();return _s(c),hy(h),f};return i&&n.set("length",Pe(e.length)),new Proxy(e,{defineProperty(l,c,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&G2();var f=n.get(c);return f===void 0?f=a(()=>{var m=Pe(h.value);return n.set(c,m),m}):ae(f,h.value,!0),!0},deleteProperty(l,c){var h=n.get(c);if(h===void 0){if(c in l){const f=a(()=>Pe(qn));n.set(c,f),Rl(r)}}else ae(h,qn),Rl(r);return!0},get(l,c,h){var B;if(c===vp)return e;var f=n.get(c),m=c in l;if(f===void 0&&(!m||(B=Ll(l,c))!=null&&B.writable)&&(f=a(()=>{var y=vi(m?l[c]:qn),b=Pe(y);return b}),n.set(c,f)),f!==void 0){var w=qt(f);return w===qn?void 0:w}return Reflect.get(l,c,h)},getOwnPropertyDescriptor(l,c){var h=Reflect.getOwnPropertyDescriptor(l,c);if(h&&"value"in h){var f=n.get(c);f&&(h.value=qt(f))}else if(h===void 0){var m=n.get(c),w=m==null?void 0:m.v;if(m!==void 0&&w!==qn)return{enumerable:!0,configurable:!0,value:w,writable:!0}}return h},has(l,c){var w;if(c===vp)return!0;var h=n.get(c),f=h!==void 0&&h.v!==qn||Reflect.has(l,c);if(h!==void 0||ke!==null&&(!f||(w=Ll(l,c))!=null&&w.writable)){h===void 0&&(h=a(()=>{var B=f?vi(l[c]):qn,y=Pe(B);return y}),n.set(c,h));var m=qt(h);if(m===qn)return!1}return f},set(l,c,h,f){var D;var m=n.get(c),w=c in l;if(i&&c==="length")for(var B=h;B<m.v;B+=1){var y=n.get(B+"");y!==void 0?ae(y,qn):B in l&&(y=a(()=>Pe(qn)),n.set(B+"",y))}if(m===void 0)(!w||(D=Ll(l,c))!=null&&D.writable)&&(m=a(()=>Pe(void 0)),ae(m,vi(h)),n.set(c,m));else{w=m.v!==qn;var b=a(()=>vi(h));ae(m,b)}var S=Reflect.getOwnPropertyDescriptor(l,c);if(S!=null&&S.set&&S.set.call(f,h),!w){if(i&&typeof c=="string"){var F=n.get("length"),U=Number(c);Number.isInteger(U)&&U>=F.v&&ae(F,U+1)}Rl(r)}return!0},ownKeys(l){qt(r);var c=Reflect.ownKeys(l).filter(m=>{var w=n.get(m);return w===void 0||w.v!==qn});for(var[h,f]of n)f.v!==qn&&!(h in l)&&c.push(h);return c},setPrototypeOf(){K2()}})}var cy,Ub,Pb,Db;function hk(){if(cy===void 0){cy=window,Ub=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;Pb=Ll(t,"firstChild").get,Db=Ll(t,"nextSibling").get,oy(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),oy(n)&&(n.__t=void 0)}}function Bh(e=""){return document.createTextNode(e)}function kb(e){return Pb.call(e)}function Pg(e){return Db.call(e)}function EA(e,t){return kb(e)}function il(e,t=1,n=!1){let i=e;for(;t--;)i=Pg(i);return i}function dk(){return!1}function Lb(e){var t=fe,n=ke;_s(null),Xi(null);try{return e()}finally{_s(t),Xi(n)}}function fk(e){ke===null&&(fe===null&&V2(),O2()),ga&&N2()}function pk(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function fA(e,t,n){var i=ke;i!==null&&(i.f&qi)!==0&&(e|=qi);var r={ctx:Ts,deps:null,nodes:null,f:e|Es|Ci,first:null,fn:t,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Ac(r),r.f|=Fg}catch(l){throw Os(r),l}else t!==null&&YA(r);var A=r;if(n&&A.deps===null&&A.teardown===null&&A.nodes===null&&A.first===A.last&&(A.f&ma)===0&&(A=A.first,(e&xr)!==0&&(e&aa)!==0&&A!==null&&(A.f|=aa)),A!==null&&(A.parent=i,i!==null&&pk(A,i),fe!==null&&(fe.f&Wn)!==0&&(e&JA)===0)){var a=fe;(a.effects??(a.effects=[])).push(A)}return r}function ic(){return fe!==null&&!Gi}function mk(e){const t=fA(Tg,null,!1);return Zn(t,Jn),t.teardown=e,t}function Rb(e){fk();var t=ke.f,n=!fe&&(t&Er)!==0&&(t&Fg)===0;if(n){var i=Ts;(i.e??(i.e=[])).push(e)}else return Hb(e)}function Hb(e){return fA(wb|L2,e,!1)}function gk(e){Br.ensure();const t=fA(JA|ma,e,!0);return(n={})=>new Promise(i=>{n.outro?Hl(t,()=>{Os(t),i(void 0)}):(Os(t),i(void 0))})}function wk(e){return fA(Ig|ma,e,!0)}function vk(e,t=0){return fA(Tg|t,e,!0)}function yp(e,t=[],n=[],i=[]){ok(i,t,n,r=>{fA(Tg,()=>e(...r.map(qt)),!0)})}function Nb(e,t=0){var n=fA(xr|t,e,!0);return n}function pr(e){return fA(Er|ma,e,!0)}function Ob(e){var t=e.teardown;if(t!==null){const n=ga,i=fe;uy(!0),_s(null);try{t.call(null)}finally{uy(n),_s(i)}}}function Vb(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){const r=n.ac;r!==null&&Lb(()=>{r.abort(Vo)});var i=n.next;(n.f&JA)!==0?n.parent=null:Os(n,t),n=i}}function Bk(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Er)===0&&Os(t),t=n}}function Os(e,t=!0){var n=!1;(t||(e.f&vb)!==0)&&e.nodes!==null&&e.nodes.end!==null&&(yk(e.nodes.start,e.nodes.end),n=!0),Vb(e,t&&!n),Ch(e,0),Zn(e,aA);var i=e.nodes&&e.nodes.t;if(i!==null)for(const A of i)A.stop();Ob(e);var r=e.parent;r!==null&&r.first!==null&&Wb(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes=e.ac=null}function yk(e,t){for(;e!==null;){var n=e===t?null:Pg(e);e.remove(),e=n}}function Wb(e){var t=e.parent,n=e.prev,i=e.next;n!==null&&(n.next=i),i!==null&&(i.prev=n),t!==null&&(t.first===e&&(t.first=i),t.last===e&&(t.last=n))}function Hl(e,t,n=!0){var i=[];Gb(e,i,!0);var r=()=>{n&&Os(e),t&&t()},A=i.length;if(A>0){var a=()=>--A||r();for(var l of i)l.out(a)}else r()}function Gb(e,t,n){if((e.f&qi)===0){e.f^=qi;var i=e.nodes&&e.nodes.t;if(i!==null)for(const l of i)(l.is_global||n)&&t.push(l);for(var r=e.first;r!==null;){var A=r.next,a=(r.f&aa)!==0||(r.f&Er)!==0&&(e.f&xr)!==0;Gb(r,t,a?n:!1),r=A}}}function Ck(e){Kb(e,!0)}function Kb(e,t){if((e.f&qi)!==0){e.f^=qi,(e.f&Jn)===0&&(Zn(e,Es),YA(e));for(var n=e.first;n!==null;){var i=n.next,r=(n.f&aa)!==0||(n.f&Er)!==0;Kb(n,r?t:!1),n=i}var A=e.nodes&&e.nodes.t;if(A!==null)for(const a of A)(a.is_global||t)&&a.in()}}function qb(e,t){if(e.nodes)for(var n=e.nodes.start,i=e.nodes.end;n!==null;){var r=n===i?null:Pg(n);t.append(n),n=r}}let qA=!1;function yh(e){qA=e}let ga=!1;function uy(e){ga=e}let fe=null,Gi=!1;function _s(e){fe=e}let ke=null;function Xi(e){ke=e}let us=null;function $b(e){fe!==null&&(us===null?us=[e]:us.push(e))}let as=null,Rs=0,$s=null;function bk(e){$s=e}let zb=1,rc=0,$A=rc;function hy(e){$A=e}function Xb(){return++zb}function gc(e){var t=e.f;if((t&Es)!==0)return!0;if(t&Wn&&(e.f&=~XA),(t&zi)!==0){var n=e.deps;if(n!==null)for(var i=n.length,r=0;r<i;r++){var A=n[r];if(gc(A)&&Ib(A),A.wv>e.wv)return!0}(t&Ci)!==0&&pn===null&&Zn(e,Jn)}return!1}function Yb(e,t,n=!0){var i=e.reactions;if(i!==null&&!(us!=null&&us.includes(e)))for(var r=0;r<i.length;r++){var A=i[r];(A.f&Wn)!==0?Yb(A,t,!1):t===A&&(n?Zn(A,Es):(A.f&Jn)!==0&&Zn(A,zi),YA(A))}}function jb(e){var y;var t=as,n=Rs,i=$s,r=fe,A=us,a=Ts,l=Gi,c=$A,h=e.f;as=null,Rs=0,$s=null,fe=(h&(Er|JA))===0?e:null,us=null,la(e.ctx),Gi=!1,$A=++rc,e.ac!==null&&(Lb(()=>{e.ac.abort(Vo)}),e.ac=null);try{e.f|=Mm;var f=e.fn,m=f(),w=e.deps;if(as!==null){var B;if(Ch(e,Rs),w!==null&&Rs>0)for(w.length=Rs+as.length,B=0;B<as.length;B++)w[Rs+B]=as[B];else e.deps=w=as;if(ic()&&(e.f&Ci)!==0)for(B=Rs;B<w.length;B++)((y=w[B]).reactions??(y.reactions=[])).push(e)}else w!==null&&Rs<w.length&&(Ch(e,Rs),w.length=Rs);if(Cb()&&$s!==null&&!Gi&&w!==null&&(e.f&(Wn|zi|Es))===0)for(B=0;B<$s.length;B++)Yb($s[B],e);return r!==null&&r!==e&&(rc++,$s!==null&&(i===null?i=$s:i.push(...$s))),(e.f&lA)!==0&&(e.f^=lA),m}catch(b){return bb(b)}finally{e.f^=Mm,as=t,Rs=n,$s=i,fe=r,us=A,la(a),Gi=l,$A=c}}function _k(e,t){let n=t.reactions;if(n!==null){var i=F2.call(n,e);if(i!==-1){var r=n.length-1;r===0?n=t.reactions=null:(n[i]=n[r],n.pop())}}n===null&&(t.f&Wn)!==0&&(as===null||!as.includes(t))&&(Zn(t,zi),(t.f&Ci)!==0&&(t.f^=Ci,t.f&=~XA),Fb(t),Ch(t,0))}function Ch(e,t){var n=e.deps;if(n!==null)for(var i=t;i<n.length;i++)_k(e,n[i])}function Ac(e){var t=e.f;if((t&aA)===0){Zn(e,Jn);var n=ke,i=qA;ke=e,qA=!0;try{(t&(xr|k2))!==0?Bk(e):Vb(e),Ob(e);var r=jb(e);e.teardown=typeof r=="function"?r:null,e.wv=zb;var A;Im&&j2&&(e.f&Es)!==0&&e.deps}finally{qA=i,ke=n}}}function qt(e){var t=e.f,n=(t&Wn)!==0;if(fe!==null&&!Gi){var i=ke!==null&&(ke.f&aA)!==0;if(!i&&!(us!=null&&us.includes(e))){var r=fe.deps;if((fe.f&Mm)!==0)e.rv<rc&&(e.rv=rc,as===null&&r!==null&&r[Rs]===e?Rs++:as===null?as=[e]:as.includes(e)||as.push(e));else{(fe.deps??(fe.deps=[])).push(e);var A=e.reactions;A===null?e.reactions=[fe]:A.includes(fe)||A.push(fe)}}}if(ga){if(cA.has(e))return cA.get(e);if(n){var a=e,l=a.v;return((a.f&Jn)===0&&a.reactions!==null||Zb(a))&&(l=Ug(a)),cA.set(a,l),l}}else n&&(!(pn!=null&&pn.has(e))||Qe!=null&&Qe.is_fork&&!ic())&&(a=e,gc(a)&&Ib(a),qA&&ic()&&(a.f&Ci)===0&&Jb(a));if(pn!=null&&pn.has(e))return pn.get(e);if((e.f&lA)!==0)throw e.v;return e.v}function Jb(e){if(e.deps!==null){e.f^=Ci;for(const t of e.deps)(t.reactions??(t.reactions=[])).push(e),(t.f&Wn)!==0&&(t.f&Ci)===0&&Jb(t)}}function Zb(e){if(e.v===qn)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(cA.has(t)||(t.f&Wn)!==0&&Zb(t))return!0;return!1}function Dg(e){var t=Gi;try{return Gi=!0,e()}finally{Gi=t}}const Sk=-7169;function Zn(e,t){e.f=e.f&Sk|t}const xk=["touchstart","touchmove"];function Ek(e){return xk.includes(e)}const t_=new Set,Rm=new Set;function Tk(e){for(var t=0;t<e.length;t++)t_.add(e[t]);for(var n of Rm)n(e)}let dy=null;function Tu(e){var S;var t=this,n=t.ownerDocument,i=e.type,r=((S=e.composedPath)==null?void 0:S.call(e))||[],A=r[0]||e.target;dy=e;var a=0,l=dy===e&&e.__root;if(l){var c=r.indexOf(l);if(c!==-1&&(t===document||t===window)){e.__root=t;return}var h=r.indexOf(t);if(h===-1)return;c<=h&&(a=c)}if(A=r[a]||e.target,A!==t){M2(e,"currentTarget",{configurable:!0,get(){return A||n}});var f=fe,m=ke;_s(null),Xi(null);try{for(var w,B=[];A!==null;){var y=A.assignedSlot||A.parentNode||A.host||null;try{var b=A["__"+i];b!=null&&(!A.disabled||e.target===A)&&b.call(A,e)}catch(F){w?B.push(F):w=F}if(e.cancelBubble||y===t||y===null)break;A=y}if(w){for(let F of B)queueMicrotask(()=>{throw F});throw w}}finally{e.__root=t,delete e.currentTarget,_s(f),Xi(m)}}}function Fk(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function Ik(e,t){var n=ke;n.nodes===null&&(n.nodes={start:e,end:t,a:null,t:null})}function kg(e,t){var n=(t&z2)!==0,i,r=!e.startsWith("<!>");return()=>{i===void 0&&(i=Fk(r?e:"<!>"+e),i=kb(i));var A=n||Ub?document.importNode(i,!0):i.cloneNode(!0);return Ik(A,A),A}}function Cp(e,t){e!==null&&e.before(t)}function Mk(e,t){return Qk(e,t)}const Uo=new Map;function Qk(e,{target:t,anchor:n,props:i={},events:r,context:A,intro:a=!0}){hk();var l=new Set,c=m=>{for(var w=0;w<m.length;w++){var B=m[w];if(!l.has(B)){l.add(B);var y=Ek(B);t.addEventListener(B,Tu,{passive:y});var b=Uo.get(B);b===void 0?(document.addEventListener(B,Tu,{passive:y}),Uo.set(B,1)):Uo.set(B,b+1)}}};c(I2(t_)),Rm.add(c);var h=void 0,f=gk(()=>{var m=n??t.appendChild(Bh());return sk(m,{pending:()=>{}},w=>{if(A){_i({});var B=Ts;B.c=A}r&&(i.$$events=r),h=e(w,i)||{},A&&Si()}),()=>{var y;for(var w of l){t.removeEventListener(w,Tu);var B=Uo.get(w);--B===0?(document.removeEventListener(w,Tu),Uo.delete(w)):Uo.set(w,B)}Rm.delete(c),m!==n&&((y=m.parentNode)==null||y.removeChild(m))}});return Uk.set(h,f),h}let Uk=new WeakMap;var mi,Ni,Hs,NA,hc,dc,Ph;class Pk{constructor(t,n=!0){P(this,"anchor");Be(this,mi,new Map);Be(this,Ni,new Map);Be(this,Hs,new Map);Be(this,NA,new Set);Be(this,hc,!0);Be(this,dc,()=>{var t=Qe;if(lt(this,mi).has(t)){var n=lt(this,mi).get(t),i=lt(this,Ni).get(n);if(i)Ck(i),lt(this,NA).delete(n);else{var r=lt(this,Hs).get(n);r&&(lt(this,Ni).set(n,r.effect),lt(this,Hs).delete(n),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),i=r.effect)}for(const[A,a]of lt(this,mi)){if(lt(this,mi).delete(A),A===t)break;const l=lt(this,Hs).get(a);l&&(Os(l.effect),lt(this,Hs).delete(a))}for(const[A,a]of lt(this,Ni)){if(A===n||lt(this,NA).has(A))continue;const l=()=>{if(Array.from(lt(this,mi).values()).includes(A)){var h=document.createDocumentFragment();qb(a,h),h.append(Bh()),lt(this,Hs).set(A,{effect:a,fragment:h})}else Os(a);lt(this,NA).delete(A),lt(this,Ni).delete(A)};lt(this,hc)||!i?(lt(this,NA).add(A),Hl(a,l,!1)):l()}}});Be(this,Ph,t=>{lt(this,mi).delete(t);const n=Array.from(lt(this,mi).values());for(const[i,r]of lt(this,Hs))n.includes(i)||(Os(r.effect),lt(this,Hs).delete(i))});this.anchor=t,le(this,hc,n)}ensure(t,n){var i=Qe,r=dk();if(n&&!lt(this,Ni).has(t)&&!lt(this,Hs).has(t))if(r){var A=document.createDocumentFragment(),a=Bh();A.append(a),lt(this,Hs).set(t,{effect:pr(()=>n(a)),fragment:A})}else lt(this,Ni).set(t,pr(()=>n(this.anchor)));if(lt(this,mi).set(i,t),r){for(const[l,c]of lt(this,Ni))l===t?i.skipped_effects.delete(c):i.skipped_effects.add(c);for(const[l,c]of lt(this,Hs))l===t?i.skipped_effects.delete(c.effect):i.skipped_effects.add(c.effect);i.oncommit(lt(this,dc)),i.ondiscard(lt(this,Ph))}else lt(this,dc).call(this)}}mi=new WeakMap,Ni=new WeakMap,Hs=new WeakMap,NA=new WeakMap,hc=new WeakMap,dc=new WeakMap,Ph=new WeakMap;function Dk(e,t,n=!1){var i=new Pk(e),r=n?aa:0;function A(a,l){i.ensure(a,l)}Nb(()=>{var a=!1;t((l,c=!0)=>{a=!0,A(c,l)}),a||A(!1,null)},r)}const fy=[...` 	
\r\f\v\uFEFF`];function kk(e,t,n){var i=""+e;if(n){for(var r in n)if(n[r])i=i?i+" "+r:r;else if(i.length)for(var A=r.length,a=0;(a=i.indexOf(r,a))>=0;){var l=a+A;(a===0||fy.includes(i[a-1]))&&(l===i.length||fy.includes(i[l]))?i=(a===0?"":i.substring(0,a))+i.substring(l+1):a=l}}return i===""?null:i}function Lk(e,t,n,i,r,A){var a=e.__className;if(a!==n||a===void 0){var l=kk(n,i,A);l==null?e.removeAttribute("class"):e.className=l,e.__className=n}else if(A&&r!==A)for(var c in A){var h=!!A[c];(r==null||h!==!!r[c])&&e.classList.toggle(c,h)}return A}const Rk=Symbol("is custom element"),Hk=Symbol("is html");function cr(e,t,n,i){var r=Nk(e);r[t]!==(r[t]=n)&&(t==="loading"&&(e[R2]=n),n==null?e.removeAttribute(t):typeof n!="string"&&Ok(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function Nk(e){return e.__attributes??(e.__attributes={[Rk]:e.nodeName.includes("-"),[Hk]:e.namespaceURI===X2})}var py=new Map;function Ok(e){var t=e.getAttribute("is")||e.nodeName,n=py.get(t);if(n)return n;py.set(t,n=[]);for(var i,r=e,A=Element.prototype;A!==r;){i=Q2(r);for(var a in i)i[a].set&&n.push(a);r=mb(r)}return n}function Zi(e){Ts===null&&Bb(),Rb(()=>{const t=Dg(e);if(typeof t=="function")return t})}function Tr(e){Ts===null&&Bb(),Zi(()=>()=>Dg(e))}const Vk="5";var Ny;typeof window<"u"&&((Ny=window.__svelte??(window.__svelte={})).v??(Ny.v=new Set)).add(Vk);var Wk=kg('<img alt="Pause" class="svelte-1quu0sl"/>'),Gk=kg('<img alt="Play" class="svelte-1quu0sl"/>'),Kk=kg('<div class="playback-controls svelte-1quu0sl"><button class="toolbar-button svelte-1quu0sl"><!></button> <button class="toolbar-button svelte-1quu0sl" title="Stop"><img alt="Stop" class="svelte-1quu0sl"/></button> <button><img alt="Loop" class="svelte-1quu0sl"/></button> <div class="separator svelte-1quu0sl"></div> <button class="toolbar-button svelte-1quu0sl" title="Clear All Notes"><img alt="Clear" class="svelte-1quu0sl"/></button> <div class="separator svelte-1quu0sl"></div> <button class="toolbar-button svelte-1quu0sl" title="Undo"><img alt="Undo" class="svelte-1quu0sl"/></button> <button class="toolbar-button svelte-1quu0sl" title="Redo"><img alt="Redo" class="svelte-1quu0sl"/></button></div>');function qk(e,t){_i(t,!0);let n=Pe(vi(d.state.isPlaying)),i=Pe(vi(d.state.isPaused)),r=Pe(vi(d.state.isLooping)),A=Pe(d.state.historyIndex>0),a=Pe(d.state.historyIndex<d.state.history.length-1);Rb(()=>{const Tt=ot=>{ae(n,ot.isPlaying,!0),ae(i,ot.isPaused,!0)},J=ot=>{ae(r,ot,!0)},st=()=>{ae(A,d.state.historyIndex>0),ae(a,d.state.historyIndex<d.state.history.length-1)};return d.on("playbackStateChanged",Tt),d.on("loopingChanged",J),d.on("historyChanged",st),st(),()=>{}});const l=Bp(()=>Di("play.svg")),c=Bp(()=>Di("pause.svg")),h=Bp(()=>qt(n)&&!qt(i));function f(){qt(n)&&qt(i)?(d.setPlaybackState(!0,!1),Wi.resume()):qt(n)&&!qt(i)?(d.setPlaybackState(!0,!0),Wi.pause()):(d.setPlaybackState(!0,!1),Wi.start())}function m(){d.setPlaybackState(!1,!1),Wi.stop()}function w(){d.clearAllNotes(),tb(),ib()}function B(){d.setLooping(!qt(r))}function y(){d.undo()}function b(){d.redo()}var S=Kk(),F=EA(S);F.__click=f;var U=EA(F);{var D=Tt=>{var J=Wk();yp(()=>cr(J,"src",qt(c))),Cp(Tt,J)},H=Tt=>{var J=Gk();yp(()=>cr(J,"src",qt(l))),Cp(Tt,J)};Dk(U,Tt=>{qt(h)?Tt(D):Tt(H,!1)})}var Q=il(F,2);Q.__click=m;var R=EA(Q),V=il(Q,2);let O;V.__click=B;var K=EA(V),z=il(V,4);z.__click=w;var gt=EA(z),St=il(z,4);St.__click=y;var wt=EA(St),Ct=il(St,2);Ct.__click=b;var Mt=EA(Ct);yp((Tt,J,st,ot,vt)=>{cr(F,"title",qt(h)?"Pause":"Play"),cr(R,"src",Tt),O=Lk(V,1,"toolbar-button svelte-1quu0sl",null,O,{active:qt(r)}),cr(V,"title",qt(r)?"Disable Loop":"Enable Loop"),cr(K,"src",J),cr(gt,"src",st),St.disabled=!qt(A),cr(wt,"src",ot),Ct.disabled=!qt(a),cr(Mt,"src",vt)},[()=>Di("stop.svg"),()=>Di("loop.svg"),()=>Di("clear.svg"),()=>Di("undo.svg"),()=>Di("redo.svg")]),Cp(e,S),Si()}Tk(["click"]);function $k(e,t){_i(t,!0);let n=Pe(vi(d.state.isPlaying)),i=Pe(vi(d.state.isPaused)),r=Pe(vi(d.state.isLooping)),A=Pe(d.state.historyIndex>0),a=Pe(d.state.historyIndex<d.state.history.length-1),l=null,c=null,h=null,f=null,m=null,w=null;function B(){qt(n)&&qt(i)?(d.setPlaybackState(!0,!1),Wi.resume()):qt(n)&&!qt(i)?(d.setPlaybackState(!0,!0),Wi.pause()):(d.setPlaybackState(!0,!1),Wi.start())}function y(){d.setPlaybackState(!1,!1),Wi.stop(),c==null||c.blur()}function b(){f==null||f.classList.add("flash"),setTimeout(()=>f==null?void 0:f.classList.remove("flash"),300),d.clearAllNotes(),tb(),ib(),f==null||f.blur()}function S(){d.setLooping(!qt(r))}function F(){d.undo(),m==null||m.blur()}function U(){d.redo(),w==null||w.blur()}function D(){if(!l)return;const R=`<img src="${Di("play.svg")}" alt="Play">`,V=`<img src="${Di("pause.svg")}" alt="Pause">`;l.innerHTML=qt(n)&&!qt(i)?V:R}function H(){h&&h.classList.toggle("active",qt(r))}function Q(){m&&(m.disabled=!qt(A)),w&&(w.disabled=!qt(a))}Zi(()=>{l=document.getElementById("play-button"),c=document.getElementById("stop-button"),h=document.getElementById("loop-button"),f=document.getElementById("clear-button"),m=document.getElementById("undo-button"),w=document.getElementById("redo-button"),l==null||l.addEventListener("click",B),c==null||c.addEventListener("click",y),h==null||h.addEventListener("click",S),f==null||f.addEventListener("click",b),m==null||m.addEventListener("click",F),w==null||w.addEventListener("click",U);const R=K=>{ae(n,K.isPlaying,!0),ae(i,K.isPaused,!0),D()},V=K=>{ae(r,K,!0),H()},O=()=>{ae(A,d.state.historyIndex>0),ae(a,d.state.historyIndex<d.state.history.length-1),Q()};d.on("playbackStateChanged",R),d.on("loopingChanged",V),d.on("historyChanged",O),D(),H(),Q(),console.log("[Svelte] PlaybackControlsBridge mounted")}),Tr(()=>{l==null||l.removeEventListener("click",B),c==null||c.removeEventListener("click",y),h==null||h.removeEventListener("click",S),f==null||f.removeEventListener("click",b),m==null||m.removeEventListener("click",F),w==null||w.removeEventListener("click",U),console.log("[Svelte] PlaybackControlsBridge unmounted")}),Si()}function zk(e,t){_i(t,!0);let n=null,i=null,r=null,A=null;function a(){const y=new Date,b=y.toLocaleDateString("en-US",{month:"long"}),S=y.getDate();return`SN-score-${b}${S}.csv`}async function l(y){try{const b={suggestedName:a(),types:[{description:"Student Notation CSV File",accept:{"text/csv":[".csv"]}}]},F=await(await window.showSaveFilePicker(b)).createWritable();await F.write(y),await F.close()}catch(b){b.name!=="AbortError"&&x.error("FileActionsBridge","Error saving file with picker",b,"toolbar")}}function c(y){const b=document.createElement("a"),S=URL.createObjectURL(y);b.setAttribute("href",S),b.setAttribute("download",a()),document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(S)}function h(){return d.state.placedNotes.map(y=>[y.row,y.startColumnIndex,y.endColumnIndex,y.color,y.shape,y.tonicNumber||"",y.isDrum,y.drumTrack||""].join(",")).join(`
`)}async function f(){const y=h(),b=new Blob([y],{type:"text/csv;charset=utf-8;"});window.showSaveFilePicker?await l(b):c(b)}function m(){const y=document.createElement("input");y.type="file",y.accept=".csv,.txt",y.onchange=b=>{var D;const F=(D=b.target.files)==null?void 0:D[0];if(!F)return;const U=new FileReader;U.onload=H=>{var O;const Q=(O=H.target)==null?void 0:O.result;if(!Q){x.warn("FileActionsBridge","Imported file was empty",null,"toolbar");return}const R=new Set(["circle","oval","diamond"]),V=[];if(Q.split(`
`).map(K=>K.trim()).filter(K=>K.length>0).forEach(K=>{const z=K.split(",");if(z.length<7){x.warn("FileActionsBridge","Skipping invalid note row",{line:K},"toolbar");return}const gt=Number.parseInt(z[0]??"",10),St=Number.parseInt(z[1]??"",10),wt=Number.parseInt(z[2]??"",10),Ct=(z[3]??"").trim(),Mt=(z[4]??"").trim().toLowerCase(),Tt=z[5]?Number.parseInt(z[5],10):null,J=(z[6]??"").trim().toLowerCase()==="true",st=z[7]?Number.parseInt(z[7],10):null,ot=typeof st=="number"&&Number.isFinite(st)?st:void 0;if(!Ct){x.warn("FileActionsBridge","Skipping note with missing color",{line:K},"toolbar");return}if(!Number.isFinite(gt)||!Number.isFinite(St)||!Number.isFinite(wt)){x.warn("FileActionsBridge","Skipping note with invalid coordinates",{line:K},"toolbar");return}const vt=R.has(Mt)?Mt:"circle";R.has(Mt)||x.warn("FileActionsBridge",`Unknown shape "${Mt}", defaulting to circle`,null,"toolbar"),V.push({row:gt,startColumnIndex:St,endColumnIndex:wt,color:Ct,shape:vt,tonicNumber:Tt,isDrum:J,drumTrack:ot})}),V.length===0){x.warn("FileActionsBridge","No valid notes found in imported file",null,"toolbar");return}d.loadNotes(V)},U.readAsText(F)},y.click()}function w(){document.body.classList.remove("sidebar-open"),d.emit("printPreviewStateChanged",!0)}function B(){window.confirm("Are you sure you want to reset the canvas? This will clear all your work and cannot be undone.")&&d.clearSavedState()}Zi(()=>{n=document.getElementById("save-as-button"),i=document.getElementById("import-button"),r=document.getElementById("print-button"),A=document.getElementById("reset-canvas-button"),n==null||n.addEventListener("click",()=>void f()),i==null||i.addEventListener("click",m),r==null||r.addEventListener("click",w),A==null||A.addEventListener("click",B),console.log("[Svelte] FileActionsBridge mounted")}),Tr(()=>{n==null||n.removeEventListener("click",()=>void f()),i==null||i.removeEventListener("click",m),r==null||r.removeEventListener("click",w),A==null||A.removeEventListener("click",B),console.log("[Svelte] FileActionsBridge unmounted")}),Si()}function Xk(e,t){_i(t,!0);let n=null,i=null,r=null,A=null;function a(){const m=document.querySelector('.tab-button[data-tab="pitch"]'),w=document.querySelector('.pitch-tab-button[data-pitch-tab="range"]');m==null||m.click(),w==null||w.click()}function l(){a(),d.emit("zoomIn",{source:"button"}),n==null||n.blur()}function c(){a(),d.emit("zoomOut",{source:"button"}),i==null||i.blur()}function h(){d.increaseMacrobeatCount()}function f(){d.decreaseMacrobeatCount()}Zi(()=>{n=document.getElementById("grid-zoom-in"),i=document.getElementById("grid-zoom-out"),r=document.getElementById("macrobeat-increase"),A=document.getElementById("macrobeat-decrease"),n==null||n.addEventListener("click",l),i==null||i.addEventListener("click",c),r==null||r.addEventListener("click",h),A==null||A.addEventListener("click",f),console.log("[Svelte] GridControlsBridge mounted")}),Tr(()=>{n==null||n.removeEventListener("click",l),i==null||i.removeEventListener("click",c),r==null||r.removeEventListener("click",h),A==null||A.removeEventListener("click",f),console.log("[Svelte] GridControlsBridge unmounted")}),Si()}function Yk(e,t){_i(t,!0);let n=null,i=null,r=null,A=Pe(null);function a(){qt(A)===ls.COMPRESSION_2_3?(ae(A,null),n==null||n.classList.remove("active"),d.setSelectedTool("note"),x.info("ModulationBridge","2:3 modulation tool deactivated",null,"ui")):(ae(A,ls.COMPRESSION_2_3,!0),n==null||n.classList.add("active"),i==null||i.classList.remove("active"),d.setSelectedTool("modulation"),d.state.selectedModulationRatio=qt(A),x.info("ModulationBridge","2:3 modulation tool activated",null,"ui"))}function l(){qt(A)===ls.EXPANSION_3_2?(ae(A,null),i==null||i.classList.remove("active"),d.setSelectedTool("note"),x.info("ModulationBridge","3:2 modulation tool deactivated",null,"ui")):(ae(A,ls.EXPANSION_3_2,!0),i==null||i.classList.add("active"),n==null||n.classList.remove("active"),d.setSelectedTool("modulation"),d.state.selectedModulationRatio=qt(A),x.info("ModulationBridge","3:2 modulation tool activated",null,"ui"))}function c(){const w=(d.state.modulationMarkers||[]).length;if(w===0){x.info("ModulationBridge","No modulation markers to clear",null,"ui");return}d.clearModulationMarkers(),x.info("ModulationBridge",`Cleared ${w} modulation markers`,null,"ui")}function h(){if(!r)return;const w=(d.state.modulationMarkers||[]).length;w===0?(r.disabled=!0,r.style.opacity="0.5"):(r.disabled=!1,r.style.opacity="1"),r.textContent=w>0?`Clear (${w})`:"Clear"}function f(w){const B=w;(typeof B=="string"?B:B.newTool||B)!=="modulation"&&(ae(A,null),n==null||n.classList.remove("active"),i==null||i.classList.remove("active"))}function m(){h()}Zi(()=>{if(n=document.getElementById("modulation-2-3-btn"),i=document.getElementById("modulation-3-2-btn"),r=document.getElementById("modulation-clear-btn"),!n||!i||!r){x.warn("ModulationBridge","Modulation control buttons not found in DOM",null,"ui");return}n.addEventListener("click",a),i.addEventListener("click",l),r.addEventListener("click",c),d.on("toolChanged",f),d.on("modulationMarkersChanged",m),h(),x.info("ModulationBridge","Modulation controls initialized",null,"ui"),console.log("[Svelte] ModulationBridge mounted")}),Tr(()=>{n==null||n.removeEventListener("click",a),i==null||i.removeEventListener("click",l),r==null||r.removeEventListener("click",c),console.log("[Svelte] ModulationBridge unmounted")}),Si()}function jk(e,t){_i(t,!0);let n=null,i=null,r=null,A=null,a=null,l=null,c=null,h=null,f=null,m=null,w=null,B=null,y=null,b=null,S=null,F=null,U=null,D=null,H=null,Q=null,R=null,V=Pe(!0),O=Pe(!0),K=Pe(!0),z=Pe(!0);const gt="app.volumeSliderValue";function St(Z){return Math.min(100,Math.max(0,Z))}function wt(){try{const Z=window.localStorage.getItem(gt);if(Z!==null){const mt=Number(Z);if(!Number.isNaN(mt))return St(mt)}}catch{}return 70}function Ct(Z){try{window.localStorage.setItem(gt,String(St(Z)))}catch{}}function Mt(){document.body.classList.toggle("sidebar-open")}function Tt(Z){if(Z.stopPropagation(),!a||!A)return;const mt=a.classList.toggle("visible");A.classList.toggle("active",mt)}function J(){const Z=parseInt(this.value,10),mt=Z===0?-1/0:Z/100*37.5-50;d.emit("volumeChanged",mt),Ct(Z)}function st(Z){!a||!A||!a.contains(Z.target)&&Z.target!==A&&(a.classList.remove("visible"),A.classList.remove("active"))}function ot(){d.setAnacrusis(!0)}function vt(){d.setAnacrusis(!1)}function ut(Z){const mt=Z;c==null||c.classList.toggle("active",mt),h==null||h.classList.toggle("active",!mt)}function Lt(){d.setLongNoteStyle("style1")}function $t(){d.setLongNoteStyle("style2")}function Vt(Z){const mt=Z;f==null||f.classList.toggle("active",mt==="style1"),m==null||m.classList.toggle("active",mt==="style2")}function Nt(){d.setPlayheadMode("cursor")}function Dt(){d.setPlayheadMode("microbeat")}function Et(){d.setPlayheadMode("macrobeat")}function Ft(Z){const mt=Z==="macrobeat"?"macrobeat":Z==="microbeat"?"microbeat":"cursor";w==null||w.classList.toggle("active",mt==="cursor"),B==null||B.classList.toggle("active",mt==="microbeat"),y==null||y.classList.toggle("active",mt==="macrobeat")}function jt(){ae(V,!qt(V)),S&&(S.style.display=qt(V)?"flex":"none");const Z=b==null?void 0:b.querySelector(".sidebar-button-text");Z&&(Z.textContent=qt(V)?"Hide Drum Grid":"Show Drum Grid"),setTimeout(()=>fn.recalculateLayout(),10)}function rt(){ae(O,!qt(O)),U&&(U.style.display=qt(O)?"flex":"none");const Z=F==null?void 0:F.querySelector(".sidebar-button-text");Z&&(Z.textContent=qt(O)?"Hide Button Grid":"Show Button Grid"),setTimeout(()=>fn.recalculateLayout(),10)}function pt(){ae(K,!qt(K)),H&&(H.style.display=qt(K)?"block":"none"),D&&(D.textContent=qt(K)?"Hide Left Legend":"Show Left Legend"),setTimeout(()=>fn.recalculateLayout(),10)}function it(){ae(z,!qt(z)),R&&(R.style.display=qt(z)?"block":"none"),Q&&(Q.textContent=qt(z)?"Hide Right Legend":"Show Right Legend"),setTimeout(()=>fn.recalculateLayout(),10)}Zi(()=>{if(n=document.getElementById("settings-button"),i=document.getElementById("sidebar"),r=document.getElementById("sidebar-overlay"),A=document.getElementById("volume-icon-button"),a=document.getElementById("volume-popup"),l=document.getElementById("vertical-volume-slider"),c=document.getElementById("anacrusis-on-btn"),h=document.getElementById("anacrusis-off-btn"),f=document.getElementById("long-note-style1-btn"),m=document.getElementById("long-note-style2-btn"),w=document.getElementById("playhead-mode-cursor-btn"),B=document.getElementById("playhead-mode-microbeat-btn"),y=document.getElementById("playhead-mode-macrobeat-btn"),b=document.getElementById("hide-drumgrid-toggle"),S=document.getElementById("drum-grid-wrapper"),F=document.getElementById("hide-buttongrid-toggle"),U=document.getElementById("button-grid"),D=document.getElementById("hide-leftlegend-toggle"),H=document.getElementById("legend-left-canvas"),Q=document.getElementById("hide-rightlegend-toggle"),R=document.getElementById("legend-right-canvas"),n&&i&&r&&(n.addEventListener("click",Mt),r.addEventListener("click",Mt)),A&&a&&l){const Z=wt();l.value=String(Z),A.addEventListener("click",Tt),l.addEventListener("input",J),document.addEventListener("click",st),l.dispatchEvent(new Event("input"))}if(c&&h&&(c.addEventListener("click",ot),h.addEventListener("click",vt),d.on("anacrusisChanged",ut),c.classList.toggle("active",d.state.hasAnacrusis),h.classList.toggle("active",!d.state.hasAnacrusis)),f&&m){f.addEventListener("click",Lt),m.addEventListener("click",$t),d.on("longNoteStyleChanged",Vt);const Z=d.state.longNoteStyle||"style1";f.classList.toggle("active",Z==="style1"),m.classList.toggle("active",Z==="style2")}if(w&&B&&y){w.addEventListener("click",Nt),B.addEventListener("click",Dt),y.addEventListener("click",Et),d.on("playheadModeChanged",Ft);const Z=d.state.playheadMode||"cursor";w.classList.toggle("active",Z==="cursor"),B.classList.toggle("active",Z==="microbeat"),y.classList.toggle("active",Z==="macrobeat")}b&&S&&b.addEventListener("click",jt),F&&U&&F.addEventListener("click",rt),D&&H&&D.addEventListener("click",pt),Q&&R&&Q.addEventListener("click",it),console.log("[Svelte] SidebarBridge mounted")}),Tr(()=>{n==null||n.removeEventListener("click",Mt),r==null||r.removeEventListener("click",Mt),A==null||A.removeEventListener("click",Tt),l==null||l.removeEventListener("input",J),document.removeEventListener("click",st),c==null||c.removeEventListener("click",ot),h==null||h.removeEventListener("click",vt),f==null||f.removeEventListener("click",Lt),m==null||m.removeEventListener("click",$t),w==null||w.removeEventListener("click",Nt),B==null||B.removeEventListener("click",Dt),y==null||y.removeEventListener("click",Et),b==null||b.removeEventListener("click",jt),F==null||F.removeEventListener("click",rt),D==null||D.removeEventListener("click",pt),Q==null||Q.removeEventListener("click",it),console.log("[Svelte] SidebarBridge unmounted")}),Si()}const Zh={selectedSixteenthStampId:1,updateSixteenthStampColors:e=>{},init(){this.render(),this.bindEvents(),x.info("SixteenthStampsToolbar","Sixteenth stamps toolbar initialized",null,"stamps")},render(){const e=document.getElementById("sixteenth-stamps-toolbar-container");if(!e){x.warn("SixteenthStampsToolbar","Container not found",null,"stamps");return}e.innerHTML="";const t=document.createElement("div");t.className="sixteenth-stamps-grid",[[1,2,3,4],[5,8,14,6,9,7],[10,13,12,11,15]].forEach((i,r)=>{const A=document.createElement("div");A.className=`sixteenth-stamps-row sixteenth-stamps-row-${r+1}`,i.forEach(a=>{const l=Xp.find(c=>c.id===a);if(l){const c=this.createSixteenthStampButton(l);A.appendChild(c)}}),t.appendChild(A)}),e.appendChild(t),this.setInitialSelection(this.selectedSixteenthStampId)},createSixteenthStampButton(e){const t=document.createElement("button");t.className="sixteenth-stamp-button",t.dataset.sixteenthStampId=`${e.id}`,t.setAttribute("title",`${e.id}: ${e.label}`);const n=this.createSixteenthStampPreview(e);return t.appendChild(n),t},createSixteenthStampPreview(e){const t=dg.renderToSVG(e,100,100);return t.setAttribute("width","40"),t.setAttribute("height","40"),t},bindEvents(){const e=document.getElementById("sixteenth-stamps-toolbar-container");if(!e)return;e.addEventListener("click",n=>{var r;const i=(r=n.target)==null?void 0:r.closest(".sixteenth-stamp-button");if(i){const A=parseInt(i.dataset.sixteenthStampId||"",10);Number.isNaN(A)||this.selectSixteenthStamp(A)}}),this.updateSixteenthStampColors=n=>{if(!n||!e)return;const i=(h,f=50)=>{const m=parseInt(h.slice(1,3),16),w=parseInt(h.slice(3,5),16),B=parseInt(h.slice(5,7),16),y=Math.min(255,Math.floor(m+(255-m)*(f/100))),b=Math.min(255,Math.floor(w+(255-w)*(f/100))),S=Math.min(255,Math.floor(B+(255-B)*(f/100)));return`#${y.toString(16).padStart(2,"0")}${b.toString(16).padStart(2,"0")}${S.toString(16).padStart(2,"0")}`},r=(h,f=20)=>{const m=parseInt(h.slice(1,3),16),w=parseInt(h.slice(3,5),16),B=parseInt(h.slice(5,7),16),y=Math.max(0,Math.floor(m*(1-f/100))),b=Math.max(0,Math.floor(w*(1-f/100))),S=Math.max(0,Math.floor(B*(1-f/100)));return`#${y.toString(16).padStart(2,"0")}${b.toString(16).padStart(2,"0")}${S.toString(16).padStart(2,"0")}`},A=d.state.colorPalette[n]||{primary:n,light:n},a=i(A.light,60),l=A.primary,c=r(l,20);e.style.setProperty("--c-accent",l),e.style.setProperty("--c-accent-light",a),e.style.setProperty("--c-accent-hover",c)},d.on("noteChanged",({newNote:n})=>{n.color&&this.updateSixteenthStampColors(n.color)});const t=d.state.selectedNote;t!=null&&t.color&&this.updateSixteenthStampColors(t.color),d.on("toolChanged",({newTool:n})=>{n!=="sixteenthStamp"&&this.clearSelection()}),d.on("tripletStampToolSelected",()=>{this.clearSelection()})},setInitialSelection(e){this.selectedSixteenthStampId=e;const t=document.getElementById("sixteenth-stamps-toolbar-container");t&&t.querySelectorAll(".sixteenth-stamp-button").forEach(n=>{const i=n;i.classList.toggle("active",parseInt(i.dataset.sixteenthStampId||"",10)===e)})},selectSixteenthStamp(e){this.selectedSixteenthStampId=e;const t=document.getElementById("sixteenth-stamps-toolbar-container");t&&t.querySelectorAll(".sixteenth-stamp-button").forEach(n=>{const i=n;i.classList.toggle("active",parseInt(i.dataset.sixteenthStampId||"",10)===e)}),d.setSelectedTool("sixteenthStamp"),d.emit("sixteenthStampSelected",e),d.emit("sixteenthStampToolSelected")},clearSelection(){const e=document.getElementById("sixteenth-stamps-toolbar-container");e&&e.querySelectorAll(".sixteenth-stamp-button").forEach(t=>{t.classList.remove("active")})},getSelectedSixteenthStamp(){return Xp.find(t=>t.id===this.selectedSixteenthStampId)}};class Jk{constructor(){P(this,"overlay");P(this,"modal");P(this,"title");P(this,"message");P(this,"actionsContainer");P(this,"closeButton");var t,n,i,r,A;this.overlay=document.getElementById("notification-overlay"),this.modal=(t=this.overlay)==null?void 0:t.querySelector(".notification-modal"),this.title=(n=this.overlay)==null?void 0:n.querySelector(".notification-title"),this.message=(i=this.overlay)==null?void 0:i.querySelector(".notification-message"),this.actionsContainer=(r=this.overlay)==null?void 0:r.querySelector(".notification-actions"),this.closeButton=(A=this.overlay)==null?void 0:A.querySelector(".notification-close"),this.setupEventListeners()}setupEventListeners(){var t;this.overlay&&((t=this.closeButton)==null||t.addEventListener("click",()=>this.hide()),this.overlay.addEventListener("click",n=>{n.target===this.overlay&&this.hide()}),document.addEventListener("keydown",n=>{var i;n.key==="Escape"&&((i=this.overlay)!=null&&i.classList.contains("visible"))&&this.hide()}))}show(t={}){const n=this.overlay;if(!n)return;const{title:i="Notice",message:r="",buttons:A=[{text:"OK",primary:!0,action:()=>this.hide()}]}=t;this.title&&(this.title.textContent=i),this.message&&(this.message.textContent=r);const a=this.actionsContainer;a&&(a.innerHTML="",A.forEach(l=>{const c=document.createElement("button");c.className=`notification-button ${l.primary?"":"secondary"}`,c.textContent=l.text,c.addEventListener("click",()=>{l.action?l.action():this.hide()}),a.appendChild(c)})),n.classList.add("visible"),setTimeout(()=>{var c;const l=(c=this.actionsContainer)==null?void 0:c.querySelector(".notification-button");l==null||l.focus()},100)}hide(){this.overlay&&this.overlay.classList.remove("visible")}alert(t,n="Notice"){this.show({title:n,message:t,buttons:[{text:"OK",primary:!0,action:()=>this.hide()}]})}confirm(t,n="Confirm"){return new Promise(i=>{this.show({title:n,message:t,buttons:[{text:"Cancel",primary:!1,action:()=>{this.hide(),i(!1)}},{text:"OK",primary:!0,action:()=>{this.hide(),i(!0)}}]})})}}const my=new Jk,Hm=40,Zk=Hm;class gy{constructor(t,n,i,r,A){P(this,"element");P(this,"viewportEl");P(this,"optionsEl");P(this,"onChange");P(this,"onBeforeChange");P(this,"options");P(this,"optionNodes",[]);P(this,"selectedIndex",0);P(this,"pointerActive",!1);P(this,"pointerId",null);P(this,"lastPointerY",0);P(this,"deltaBuffer",0);P(this,"optionHeight",Hm);P(this,"resizeObserver",null);this.element=t,this.viewportEl=t==null?void 0:t.querySelector(".clef-wheel-viewport"),this.optionsEl=t==null?void 0:t.querySelector(".clef-wheel-options"),this.onChange=r,this.onBeforeChange=A||null,this.options=n,!(!t||!this.viewportEl||!this.optionsEl)&&(this.renderOptions(),this.setIndex(i,{silent:!0}),this.attachEvents(),this.observeSize())}renderOptions(){const t=this.optionsEl;t&&(t.innerHTML="",this.optionNodes=this.options.map((n,i)=>{const r=document.createElement("div");return r.className="clef-wheel-option",r.dataset.index=i.toString(),r.textContent=n.label,t.appendChild(r),r}))}attachEvents(){if(!this.element)return;this.element.addEventListener("wheel",n=>{n.preventDefault(),n.stopPropagation();const i=Math.sign(n.deltaY);i!==0&&this.increment(i)},{passive:!1}),this.element.addEventListener("keydown",n=>{n.key==="ArrowUp"?(n.preventDefault(),this.increment(-1)):n.key==="ArrowDown"?(n.preventDefault(),this.increment(1)):n.key==="Home"?(n.preventDefault(),this.setIndex(0)):n.key==="End"&&(n.preventDefault(),this.setIndex(this.options.length-1))}),this.element.addEventListener("pointerdown",n=>{var i;if(this.pointerActive=!0,this.pointerId=n.pointerId,this.lastPointerY=n.clientY,this.deltaBuffer=0,typeof((i=this.element)==null?void 0:i.setPointerCapture)=="function")try{this.element.setPointerCapture(this.pointerId)}catch{}}),this.element.addEventListener("pointermove",n=>{if(!this.pointerActive||n.pointerId!==this.pointerId)return;const i=n.clientY-this.lastPointerY;if(this.lastPointerY=n.clientY,i===0)return;this.deltaBuffer+=i;const r=this.optionHeight||Zk;for(;Math.abs(this.deltaBuffer)>=r;){const A=-Math.sign(this.deltaBuffer);this.increment(A),this.deltaBuffer-=Math.sign(this.deltaBuffer)*r}});const t=n=>{var i,r;this.pointerActive&&n.pointerId===this.pointerId&&(this.pointerActive=!1,this.pointerId=null,this.deltaBuffer=0,(r=(i=this.element)==null?void 0:i.hasPointerCapture)!=null&&r.call(i,n.pointerId)&&this.element.releasePointerCapture(n.pointerId))};this.element.addEventListener("pointerup",t),this.element.addEventListener("pointercancel",t),this.element.addEventListener("pointerleave",t)}observeSize(){this.element&&(typeof ResizeObserver=="function"?(this.resizeObserver=new ResizeObserver(t=>{for(const n of t)n.target===this.element&&n.contentRect.height>0&&this.updateVisuals()}),this.resizeObserver.observe(this.element)):window.addEventListener("resize",()=>this.updateVisuals()))}getIndex(){return this.selectedIndex}increment(t){t===0||!this.options||this.options.length===0||this.setIndex(this.selectedIndex+t)}setIndex(t,{silent:n=!1}={}){if(!this.optionsEl)return;let i=t;!n&&typeof this.onBeforeChange=="function"&&(i=this.onBeforeChange(t));const r=Math.max(0,Math.min(this.options.length-1,i));if(r===this.selectedIndex){this.updateVisuals();return}if(this.selectedIndex=r,this.updateVisuals(),!n&&typeof this.onChange=="function"){const A=this.options[r];A&&this.onChange(r,A)}}updateVisuals(){var c,h,f;if(!this.optionsEl||!this.viewportEl)return;const t=this.viewportEl.clientHeight||0,n=(c=this.optionNodes)==null?void 0:c[this.selectedIndex],i=(h=this.optionNodes)==null?void 0:h[0],r=(n==null?void 0:n.offsetHeight)||(i==null?void 0:i.offsetHeight)||Hm;if(this.optionHeight=r,(f=this.optionNodes)==null||f.forEach((m,w)=>{const B=Math.abs(w-this.selectedIndex);m.dataset.distance=String(Math.min(B,3))}),t===0||r===0)return;const A=Math.max(0,(t-r)/2);this.optionsEl.style.paddingTop=`${A}px`,this.optionsEl.style.paddingBottom=`${A}px`;const a=n?n.offsetTop+r/2:A+r/2,l=t/2-a;this.optionsEl.style.transform=`translateY(${l}px)`}}class tL{constructor(){P(this,"initialized",!1);P(this,"topPicker",null);P(this,"bottomPicker",null);P(this,"topWheel",null);P(this,"bottomWheel",null);P(this,"rangeLabel",null);P(this,"rangeCount",null);P(this,"fullRangeButton",null);P(this,"trebleButton",null);P(this,"altoButton",null);P(this,"bassButton",null);P(this,"presetContainer",null);P(this,"presetButtons",[]);P(this,"activePresetId",null);P(this,"masterOptions",[]);P(this,"presetRanges",{});P(this,"constrainTopIndex",t=>{if(!this.bottomPicker)return t;const n=this.bottomPicker.getIndex(),i=this.masterOptions.length;return bT(n,t,i,rn)});P(this,"constrainBottomIndex",t=>{if(!this.topPicker)return t;const n=this.topPicker.getIndex(),i=this.masterOptions.length;return _T(n,t,i,rn)})}init(){if(this.initialized)return;if(this.topWheel=document.getElementById("clef-top-wheel"),this.bottomWheel=document.getElementById("clef-bottom-wheel"),this.rangeLabel=document.getElementById("clef-range-label"),this.rangeCount=document.getElementById("clef-range-count"),this.fullRangeButton=document.getElementById("clef-full-range-button"),this.trebleButton=document.getElementById("clef-treble-button"),this.altoButton=document.getElementById("clef-alto-button"),this.bassButton=document.getElementById("clef-bass-button"),this.presetContainer=document.querySelector(".clef-preset-buttons"),this.presetButtons=Array.from(document.querySelectorAll(".clef-preset-button")),!this.topWheel||!this.bottomWheel){x.warn("ClefViewportController","Clef tab elements not found; skipping initialization",null,"ui");return}this.masterOptions=Fe.map((n,i)=>({index:i,label:n.pitch,toneNote:n.toneNote,frequency:n.frequency}));const t=this.getViewportRange();this.topPicker=new gy(this.topWheel,this.masterOptions,t.topIndex,n=>this.handleTopSelection(n),n=>this.constrainTopIndex(n)),this.bottomPicker=new gy(this.bottomWheel,this.masterOptions,t.bottomIndex,n=>this.handleBottomSelection(n),n=>this.constrainBottomIndex(n)),this.computePresetRanges(),this.fullRangeButton&&this.fullRangeButton.addEventListener("click",()=>this.applyPresetView("full")),this.trebleButton&&this.trebleButton.addEventListener("click",()=>this.applyPresetView("treble")),this.altoButton&&this.altoButton.addEventListener("click",()=>this.applyPresetView("alto")),this.bassButton&&this.bassButton.addEventListener("click",()=>this.applyPresetView("bass")),d.on("pitchRangeChanged",()=>{this.syncFromViewport()}),d.on("zoomChanged",()=>{this.syncFromViewport()}),this.calculateAndSetWheelHeight(),window.addEventListener("resize",()=>this.calculateAndSetWheelHeight()),this.syncFromViewport(),this.initialized=!0,x.moduleLoaded("ClefViewportController","ui")}refreshWheelVisuals(){var t,n;(t=this.topPicker)==null||t.updateVisuals(),(n=this.bottomPicker)==null||n.updateVisuals()}getViewportRange(){var l;const t=Math.max(0,this.masterOptions.length-1),n=cs.getViewportInfo(),i=(n==null?void 0:n.startRank)??((l=d.state.pitchRange)==null?void 0:l.topIndex)??0,r=(n==null?void 0:n.endRank)??i+1,A=Math.max(0,Math.min(t,i)),a=Math.max(A,Math.min(t,r-1));return{topIndex:A,bottomIndex:a}}syncFromViewport(){if(!this.topPicker||!this.bottomPicker)return;const{topIndex:t,bottomIndex:n}=this.getViewportRange();this.topPicker.setIndex(t,{silent:!0}),this.bottomPicker.setIndex(n,{silent:!0}),this.updateSummary(t,n),this.updatePresetHighlight(t,n)}handleTopSelection(t){cs.setViewportTopIndex(t)}handleBottomSelection(t){cs.setViewportBottomIndex(t)}updateSummary(t,n){const i=this.masterOptions[t],r=this.masterOptions[n],A=n-t+1;this.rangeLabel&&i&&r&&(this.rangeLabel.textContent=`${i.label}  ${r.label}`),this.rangeCount&&(this.rangeCount.textContent=`${A} ${A===1?"pitch":"pitches"}`)}computePresetRanges(){const t=(n,i)=>{const r=this.findToneNoteIndex(n),A=this.findToneNoteIndex(i);return r===-1||A===-1?null:{topIndex:Math.min(r,A),bottomIndex:Math.max(r,A)}};this.presetRanges={full:{topIndex:0,bottomIndex:Math.max(0,this.masterOptions.length-1)},treble:t("G5","C4"),alto:t("A4","D3"),bass:t("C4","E2")}}updatePresetHighlight(t,n){var r;let i=null;Object.entries(this.presetRanges).forEach(([A,a])=>{a&&a.topIndex===t&&a.bottomIndex===n&&(i=A)}),this.activePresetId=i,(r=this.presetButtons)!=null&&r.length&&(this.presetButtons.forEach(A=>{var c;const a=(c=A.dataset)!=null&&c.preset?A.dataset.preset??"":(A.id||"").replace(/^clef-/,"").replace(/-button$/,"").replace(/-range$/,"").replace(/-/g,""),l=this.activePresetId&&a===this.activePresetId;A.classList.toggle("active",!!l)}),this.presetContainer&&this.presetContainer.classList.toggle("locked",!1))}applyPresetView(t){const n=this.presetRanges[t];if(!n){x.warn("ClefViewportController","Preset range could not be resolved",{preset:t},"ui");return}const i=t==="full"?420:280;cs.setPitchViewportRange(n,{animateMs:i,source:`preset:${t}`})}findNoteIndex(t){return this.masterOptions.findIndex(n=>n.label===t)}findToneNoteIndex(t){return this.masterOptions.findIndex(n=>n.toneNote===t)}calculateAndSetWheelHeight(){const t=document.querySelector(".range-panel-section.wheels-section"),n=t==null?void 0:t.querySelector(".panel-section-title");if(!t||!this.topWheel||!this.bottomWheel)return;const i=t.clientHeight,r=(n==null?void 0:n.offsetHeight)||0,a=i-r-15,l=Math.max(120,Math.min(a,300));this.topWheel.style.setProperty("--clef-wheel-height",`${l}px`),this.bottomWheel.style.setProperty("--clef-wheel-height",`${l}px`),setTimeout(()=>{var c,h;(c=this.topPicker)==null||c.updateVisuals(),(h=this.bottomPicker)==null||h.updateVisuals()},0)}}const wy=new tL,eL={X:["1P","3M","5P"],x:["1P","3m","5P"],"x":["1P","3m","5d"],"X+":["1P","3M","5A"],"X":["1P","3M","5P","7m"],"x":["1P","3m","5P","7m"],"Xmaj":["1P","3M","5P","7M"],"":["1P","3m","5d","7m"],"x":["1P","3m","5d","6M"],"X":["1P","3M","5P","6M"],Xsus2:["1P","2M","5P"],Xsus4:["1P","4P","5P"]},nL={"xmaj":["1P","3m","5P","7M"],Xadd9:["1P","3M","5P","9M"],xadd9:["1P","3m","5P","9M"],"X6/9":["1P","3M","5P","6M","9M"],X9:["1P","3M","5P","7m","9M"],X11:["1P","3M","5P","7m","9M","11P"],X13:["1P","3M","5P","7m","9M","13M"],Xmaj9:["1P","3M","5P","7M","9M"],"x":["1P","3m","5P","7m","9M"],"x":["1P","3m","5P","6M"],"x":["1P","3m","5P","7m","9M","11P"],"Xmaj711":["1P","3M","5P","7M","11A"]},vy={...eL,...nL},By={M6:["6M"],A6:["6A"],m7:["7m"],M7:["7M"],d5:["5d"],P5:["5P"],A5:["5A"],m6:["6m"],m3:["3m"],M3:["3M"],P4:["4P"],A4:["4A"],U:["1P"],m2:["2m"],M2:["2M"],A2:["2A"]},sL={"9m":"2m","9M":"2M","9A":"2A","11P":"4P","11A":"4A","13m":"6m","13M":"6M","13A":"6A"};function bp(e){return sL[e]??e}function iL(e,t){_i(t,!0);const n=15;let i=Pe("diatonic"),r=Pe("position"),A=null,a=null,l=null,c=null,h=null,f=null,m=null,w=null,B=null,y=null,b=null,S=null,F=null,U=null,D=[];function H(){return Object.keys(d.state.tonicSignGroups).length>0}function Q(rt=d.state.degreeDisplayMode){const pt=l==null?void 0:l.querySelector('[data-mode="diatonic"]'),it=l==null?void 0:l.querySelector('[data-mode="modal"]');if(!pt||!it)return;rt!=="off"&&ae(i,rt,!0);const Z=rt==="off"?qt(i):rt,mt=rt==="off";[pt,it].forEach(xt=>{xt.disabled=mt,xt.classList.toggle("disabled",mt)}),l&&l.classList.toggle("disabled",mt),pt.classList.toggle("active",Z==="diatonic"),pt.setAttribute("aria-pressed",Z==="diatonic"?"true":"false"),it.classList.toggle("active",Z==="modal"),it.setAttribute("aria-pressed",Z==="modal"?"true":"false")}function R(rt,pt){if(!pt)return;const it=rt!=="off";pt.classList.toggle("active",it),pt.setAttribute("aria-pressed",it?"true":"false")}function V(){var rt;if(F&&(F.querySelectorAll(".harmony-preset-button").forEach(pt=>{pt.classList.remove("selected","partial-match")}),d.state.activeChordIntervals)){const pt=d.state.activeChordIntervals,it=pt.toString(),Z=pt.map(bp),mt=F.querySelectorAll(".harmony-preset-button");for(const xt of mt){const Bt=((rt=xt.textContent)==null?void 0:rt.trim())??"",Ht=vy[Bt];if(!Ht)continue;const oe=Ht.toString(),Xt=Ht.map(bp);if(oe===it){xt.classList.add("selected");continue}Z.every(Ce=>Xt.includes(Ce))&&xt.classList.add("partial-match")}}}function O(){if(U&&(U.querySelectorAll(".harmony-preset-button").forEach(rt=>rt.classList.remove("selected")),d.state.activeChordIntervals)){const pt=d.state.activeChordIntervals.map(bp);U.querySelectorAll(".harmony-preset-button").forEach(it=>{var Bt;const Z=((Bt=it.textContent)==null?void 0:Bt.trim())??"",mt=By[Z],xt=mt==null?void 0:mt[0];xt&&pt.includes(xt)&&it.classList.add("selected")})}}const K=(rt,pt=50)=>{const it=parseInt(rt.slice(1,3),16),Z=parseInt(rt.slice(3,5),16),mt=parseInt(rt.slice(5,7),16),xt=Math.min(255,Math.floor(it+(255-it)*(pt/100))),Bt=Math.min(255,Math.floor(Z+(255-Z)*(pt/100))),Ht=Math.min(255,Math.floor(mt+(255-mt)*(pt/100)));return`#${xt.toString(16).padStart(2,"0")}${Bt.toString(16).padStart(2,"0")}${Ht.toString(16).padStart(2,"0")}`},z=(rt,pt=1)=>{const it=rt.startsWith("#")?rt.slice(1):rt;if(it.length!==6)return rt;const Z=parseInt(it.slice(0,2),16),mt=parseInt(it.slice(2,4),16),xt=parseInt(it.slice(4,6),16);return`rgba(${Z}, ${mt}, ${xt}, ${pt})`},gt=(rt,pt)=>{if(!rt)return;const it=K(pt,50),Z=K(it,60);rt.style.setProperty("--c-accent",pt),rt.style.setProperty("--c-accent-light",Z),rt.style.setProperty("--harmony-partial-bg",z(Z,.25)),rt.style.setProperty("--harmony-partial-border",z(pt,.4)),rt.style.setProperty("--harmony-partial-bg-hover",z(Z,.4)),rt.style.setProperty("--harmony-partial-border-hover",z(pt,.6))};function St(){var pt;return(((pt=d.state.activeChordIntervals)==null?void 0:pt.length)??0)===2?"inversion":"position"}function wt(){var pt;const rt=((pt=d.state.activeChordIntervals)==null?void 0:pt.length)??1;return rt===2?2:Math.max(1,rt)}function Ct(){return St()==="inversion"?d.state.isIntervalsInverted?1:0:d.state.chordPositionState}function Mt(rt){St()==="inversion"?d.setIntervalsInversion(rt===1):d.setChordPosition(rt)}function Tt(){var Z;if(!S)return;const rt=St(),pt=Ct(),it=((Z=d.state.activeChordIntervals)==null?void 0:Z.length)??1;S.classList.toggle("inversion-mode",rt==="inversion"),S.classList.toggle("position-mode",rt==="position"),S.classList.remove("state-1","state-2","state-3","state-4","state-5"),pt>=1&&pt<=5&&S.classList.add(`state-${pt}`);for(let mt=1;mt<=5;mt++)S.classList.remove(`disabled-state-${mt}`);rt==="position"&&(it<=1?S.classList.add("disabled-state-1"):it===2?S.classList.add("disabled-state-2"):it===3?S.classList.add("disabled-state-3"):it===4?S.classList.add("disabled-state-4"):it===5&&S.classList.add("disabled-state-5"))}function J(){var it;const rt=St(),pt=((it=d.state.activeChordIntervals)==null?void 0:it.length)??1;if(qt(r)!==rt){if(rt==="inversion"){const Z=d.state.chordPositionState===0;d.setIntervalsInversion(!Z)}else d.setChordPosition(0);ae(r,rt,!0)}else if(rt==="position"){const Z=Math.max(0,pt-1);d.state.chordPositionState>Z&&d.setChordPosition(0)}Tt()}function st(){J()}function ot(rt=d.state.selectedToolTonicNumber){if(!D.length)return;const pt=D[0]?parseInt(D[0].dataset.tonic??"1",10):1,it=typeof rt=="number"?rt:parseInt(String(rt??""),10),Z=Number.isNaN(it)?pt:it;D.forEach(mt=>{const xt=mt.dataset.tonic,Ht=(xt?parseInt(xt,10):NaN)===Z;mt.classList.toggle("selected",Ht),mt.setAttribute("aria-pressed",Ht?"true":"false")})}function vt(){return h!=null&&h.classList.contains("active")?"modal":c!=null&&c.classList.contains("active")?"diatonic":qt(i)}function ut(){const rt=document.querySelector('[data-tab="rhythm"]');rt&&!rt.classList.contains("active")&&rt.click();const pt=document.querySelector('[data-rhythm-stamp-tab="sixteenth"]');pt&&!pt.classList.contains("active")&&pt.click()}const Lt=rt=>{[f,m].forEach(pt=>{pt&&(pt.classList.toggle("accidental-btn--disabled",rt),pt.setAttribute("aria-disabled",rt?"true":"false"))})},$t=rt=>{w&&(w.classList.toggle("active",rt),w.setAttribute("aria-pressed",rt?"true":"false")),Lt(rt)},Vt=rt=>{B&&(B.classList.toggle("active",rt),B.setAttribute("aria-pressed",rt?"true":"false"))};function Nt({newTool:rt}={}){var pt;if(A==null||A.classList.remove("selected"),b&&b.classList.remove("active-tool"),rt==="eraser")A==null||A.classList.add("selected");else if(rt==="chord")b==null||b.classList.add("active-tool");else if(rt==="note"){const it=d.state.selectedNote;if(it){const Z=document.querySelector(`.note-pair[data-color='${it.color}']`);Z==null||Z.classList.add("selected"),(pt=Z==null?void 0:Z.querySelector(`.note[data-type='${it.shape}']`))==null||pt.classList.add("selected")}}ot()}function Dt(){V(),O(),st()}function Et({newNote:rt}={}){var xt;if(!(rt!=null&&rt.color)||!rt.shape)return;const{color:pt,shape:it}=rt;document.querySelectorAll(".note, .note-pair").forEach(Bt=>Bt.classList.remove("selected"));const Z=document.querySelector(`.note[data-color='${pt}'][data-type='${it}']`);if(Z)Z.classList.add("selected");else{const Bt=document.querySelector(`.note-pair[data-color='${pt}']`);Bt==null||Bt.classList.add("selected"),(xt=Bt==null?void 0:Bt.querySelector(`.note[data-type='${it}']`))==null||xt.classList.add("selected")}gt(b,pt);const mt=document.querySelector(".tab-sidebar");mt&&mt.style.setProperty("--c-accent",pt)}function Ft(rt){R(rt,a),Q(rt)}function jt(rt){m==null||m.classList.toggle("active",rt.sharp),f==null||f.classList.toggle("active",rt.flat)}Zi(()=>{var xe,Mn;const rt=Sr.getMultiple("noteBankContainer","eraserButton","degreeVisibilityToggle","degreeModeToggle","flatBtn","sharpBtn","frequencyBtn","octaveLabelBtn","focusColoursToggle");A=rt.eraserButton,a=rt.degreeVisibilityToggle??null,l=rt.degreeModeToggle,c=(l==null?void 0:l.querySelector('[data-mode="diatonic"]'))??null,h=(l==null?void 0:l.querySelector('[data-mode="modal"]'))??null,f=rt.flatBtn,m=rt.sharpBtn,w=rt.frequencyBtn,B=rt.octaveLabelBtn,y=rt.focusColoursToggle,b=document.querySelector(".pitch-tabs-container"),S=document.getElementById("unified-position-toggle"),F=document.querySelector("#chords-panel .chords-grid"),U=document.querySelector("#chords-panel .intervals-4x4-grid"),D=Array.from(document.querySelectorAll(".tonic-mode-button")),wy.init(),document.querySelectorAll(".note").forEach(Kt=>{Kt.addEventListener("click",()=>{var Le;const ne=Kt.dataset.type,re=Kt.dataset.color||((Le=Kt.closest(".note-pair"))==null?void 0:Le.dataset.color);if(!(!ne||!re)){if(ne==="diamond"){d.setSelectedNote("diamond",re);const Gn=document.querySelector(".sixteenth-stamp-button.active"),fs=Gn?parseInt(Gn.dataset.sixteenthStampId??"",10):NaN;if(d.state.selectedTool==="sixteenthStamp"&&Gn&&!Number.isNaN(fs)&&fs!==n)return;ut(),Zh.selectSixteenthStamp(n);return}d.setSelectedNote(ne,re),d.setSelectedTool("note")}})}),A&&A.addEventListener("click",()=>{if(d.state.selectedTool==="eraser"){d.setSelectedTool(d.state.previousTool||"note");return}d.setSelectedTool("eraser")});const it=document.getElementById("lasso-shortcut-button");it&&it.addEventListener("click",()=>{var Kt,ne,re;(Kt=document.querySelector('[data-tab="pitch"]'))==null||Kt.click(),(ne=document.querySelector('[data-pitch-tab="draw"]'))==null||ne.click(),(re=document.querySelector('button.draw-tool-button[data-draw-tool="lasso"]'))==null||re.click()});const Z=document.getElementById("marker-shortcut-button");Z&&Z.addEventListener("click",()=>{var Kt,ne,re;(Kt=document.querySelector('[data-tab="pitch"]'))==null||Kt.click(),(ne=document.querySelector('[data-pitch-tab="draw"]'))==null||ne.click(),(re=document.querySelector('button.draw-tool-button[data-draw-tool="marker"]'))==null||re.click()}),D.length&&(D.forEach(Kt=>{Kt.addEventListener("click",()=>{const ne=Kt.getAttribute("data-tonic");if(!ne)return;const re=parseInt(ne,10);d.setSelectedTool("tonicization",re),ot(re)})}),ot()),F&&F.querySelectorAll(".harmony-preset-button").forEach(Kt=>{Kt.addEventListener("click",()=>{var Le;const ne=((Le=Kt.textContent)==null?void 0:Le.trim())??"",re=vy[ne];re&&re.length>0&&(d.setActiveChordIntervals(re),d.setSelectedTool("chord")),Kt.blur()}),Kt.addEventListener("dblclick",()=>{Kt.classList.contains("selected")&&d.setSelectedTool("note"),Kt.blur()})}),U&&U.querySelectorAll(".harmony-preset-button").forEach(Kt=>{Kt.addEventListener("click",()=>{var Le;const ne=((Le=Kt.textContent)==null?void 0:Le.trim())??"",re=By[ne];if(re&&re.length>0){const Gn=re[0];if(!Gn)return;let fs=d.state.selectedTool==="chord"&&d.state.activeChordIntervals?[...d.state.activeChordIntervals]:["1P"];fs.includes(Gn)?Gn!=="1P"&&(fs=fs.filter(Fr=>Fr!==Gn)):fs.push(Gn),fs.includes("1P")||fs.unshift("1P");const wa=["1P","2m","2M","2A","3m","3M","4P","4A","5d","5P","5A","6m","6M","6A","7m","7M","9M","11P","11A","13M"];fs.sort((Fr,vc)=>wa.indexOf(Fr)-wa.indexOf(vc)),d.setActiveChordIntervals(fs),d.setSelectedTool("chord")}Kt.blur()}),Kt.addEventListener("dblclick",()=>{d.setActiveChordIntervals(["1P"]),d.setSelectedTool("chord"),Kt.blur()})});const mt=document.querySelectorAll(".pitch-tab-button"),xt=document.querySelectorAll(".pitch-tab-panel");mt.forEach(Kt=>{Kt.addEventListener("click",()=>{var re;const ne=Kt.dataset.pitchTab;ne&&(mt.forEach(Le=>Le.classList.remove("active")),Kt.classList.add("active"),xt.forEach(Le=>Le.classList.remove("active")),(re=document.getElementById(`${ne}-panel`))==null||re.classList.add("active"),localStorage.setItem("selectedPitchTab",ne),ne==="chords"&&st(),ne==="range"&&setTimeout(()=>wy.refreshWheelVisuals(),0))})});const Bt=localStorage.getItem("selectedPitchTab")||"chords",Ht=document.querySelector(`[data-pitch-tab="${Bt}"]`);Ht&&(mt.forEach(Kt=>Kt.classList.remove("active")),xt.forEach(Kt=>Kt.classList.remove("active")),Ht.classList.add("active"),(xe=document.getElementById(`${Bt}-panel`))==null||xe.classList.add("active"));const oe=document.querySelectorAll(".rhythm-stamp-tab-button"),Xt=document.querySelectorAll(".rhythm-stamp-tab-panel");oe.forEach(Kt=>{Kt.addEventListener("click",()=>{var re;const ne=Kt.dataset.rhythmStampTab;ne&&(oe.forEach(Le=>Le.classList.remove("active")),Kt.classList.add("active"),Xt.forEach(Le=>Le.classList.remove("active")),(re=document.getElementById(`${ne}-stamps-panel`))==null||re.classList.add("active"),localStorage.setItem("selectedRhythmStampTab",ne))})});const be=localStorage.getItem("selectedRhythmStampTab")||localStorage.getItem("selectedRhythmTab"),Ce=be==="stamps"?"sixteenth":be==="triplets"?"triplet":be||"sixteenth",Zt=document.querySelector(`[data-rhythm-stamp-tab="${Ce}"]`);if(Zt&&(oe.forEach(Kt=>Kt.classList.remove("active")),Xt.forEach(Kt=>Kt.classList.remove("active")),Zt.classList.add("active"),(Mn=document.getElementById(`${Ce}-stamps-panel`))==null||Mn.classList.add("active")),S){const Kt=S.querySelector(".toggle-track");Kt==null||Kt.addEventListener("click",()=>{const ne=Ct(),re=wt();Mt((ne+1)%re),S.blur()}),S.querySelectorAll(".left-labels .state-label").forEach(ne=>{ne.addEventListener("click",()=>{St()==="inversion"&&Mt(parseInt(ne.dataset.step??"0",10))})}),S.querySelectorAll(".right-labels .state-label").forEach(ne=>{ne.addEventListener("click",()=>{if(St()!=="position")return;const re=parseInt(ne.dataset.step??"0",10);re<wt()&&Mt(re)})}),d.on("chordPositionChanged",Tt),d.on("intervalsInversionChanged",Tt),Tt()}a&&a.addEventListener("click",()=>{if(d.state.degreeDisplayMode==="off"){if(!H()){my.alert("Please place a tonal center on the canvas before showing degrees.","Tonal Center Required");return}d.setDegreeDisplayMode(vt())}else d.setDegreeDisplayMode("off");a.blur()}),c&&c.addEventListener("click",()=>{d.state.degreeDisplayMode!=="off"&&d.state.degreeDisplayMode!=="diatonic"&&d.setDegreeDisplayMode("diatonic"),c.blur()}),h&&h.addEventListener("click",()=>{d.state.degreeDisplayMode!=="off"&&d.state.degreeDisplayMode!=="modal"&&d.setDegreeDisplayMode("modal"),h.blur()}),f&&f.addEventListener("click",()=>{d.state.showFrequencyLabels&&d.toggleFrequencyLabels(),d.toggleAccidentalMode("flat"),f.blur()}),m&&m.addEventListener("click",()=>{d.state.showFrequencyLabels&&d.toggleFrequencyLabels(),d.toggleAccidentalMode("sharp"),m.blur()}),w&&w.addEventListener("click",()=>{d.toggleFrequencyLabels(),w.blur()}),B&&B.addEventListener("click",()=>{d.toggleOctaveLabels(),B.blur()}),y&&y.addEventListener("change",()=>{if(!d.state.focusColours&&!H()){my.alert("Please place a tonal center on the canvas before enabling focus colours.","Tonal Center Required"),y.checked=!1;return}d.toggleFocusColours()}),d.on("toolChanged",Nt),d.on("activeChordIntervalsChanged",Dt),d.on("noteChanged",Et),d.on("degreeDisplayModeChanged",Ft),d.on("accidentalModeChanged",jt),d.on("frequencyLabelsChanged",$t),d.on("octaveLabelsChanged",Vt),$t(d.state.showFrequencyLabels),Vt(d.state.showOctaveLabels),b&&d.state.selectedNote&&gt(b,d.state.selectedNote.color);const Ie=document.querySelector(".tab-sidebar");Ie&&d.state.selectedNote&&Ie.style.setProperty("--c-accent",d.state.selectedNote.color),setTimeout(()=>st(),50);const me=d.state.degreeDisplayMode;R(me,a),Q(me),V(),O(),st(),console.log("[Svelte] ToolSelectorBridge mounted")}),Tr(()=>{console.log("[Svelte] ToolSelectorBridge unmounted")}),Si()}class _p{constructor(t,n={}){P(this,"parent");P(this,"settings");P(this,"_em");P(this,"_value");P(this,"decimalPlaces");P(this,"colors");P(this,"element");P(this,"_minDimension");P(this,"actual",0);P(this,"hasMoved",!1);P(this,"clicked",!1);P(this,"_start",{y:0});P(this,"_changeFactor",1);var c,h,f,m;const i=typeof t=="string"?document.querySelector(t):t;if(this.parent=i,!this.parent)throw new Error("DraggableNumber: parent element not found");const r={size:[60,30],value:0,min:0,max:2e4,step:1,decimalPlaces:2,colors:{fill:"#e7e7e7",dark:"#333",light:"#fff",accent:"#b35"},useAppStyling:!1},A={fill:((c=n.colors)==null?void 0:c.fill)??r.colors.fill,dark:((h=n.colors)==null?void 0:h.dark)??r.colors.dark,light:((f=n.colors)==null?void 0:f.light)??r.colors.light,accent:((m=n.colors)==null?void 0:m.accent)??r.colors.accent};this.settings={...r,...n,colors:A},this._em=new AL,this._value=new rL(this.settings.min,this.settings.max,this.settings.step,this.settings.value),this.decimalPlaces=this.settings.decimalPlaces,this.colors=this.settings.colors,this.element=document.createElement("input"),this.element.type="text",this.parent.appendChild(this.element);const[a,l]=this.settings.size;this._minDimension=Math.min(a,l),this.settings.useAppStyling?(this.element.className="draggable-number-input",this.element.style.cssText=[`width:${a}px`,`height:${l}px`,"background-color: var(--c-surface)","color: var(--c-text)","border: 1px solid var(--c-border)","border-radius: var(--border-radius-sm)","font-family: var(--main-font)","font-weight: 400","font-size: 14px","text-align: center","outline: none","padding: 0","box-sizing: border-box","user-select: text"].join(";")):this.element.style.cssText=[`width:${a}px`,`height:${l}px`,`background-color:${this.colors.fill}`,`color:${this.colors.dark}`,"font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif","font-weight:500",`font-size:${this._minDimension/2}px`,"border: none","outline: none",`padding:${this._minDimension/4}px ${this._minDimension/4}px`,"box-sizing:border-box","user-select:text"].join(";"),aL(this.element,w=>/^-?\d*\.?\d*$/.test(w)),this.actual=0,this.hasMoved=!1,this.clicked=!1,this.element.value=yy(this._value.value,this.decimalPlaces),this._bind()}on(t,n){return this._em.on(t,n),()=>this._em.off(t,n)}emit(t,n){this._em.emit(t,n)}get value(){return this._value.value}set value(t){this._value.update(t),this.emit("change",this._value.value),this._render()}get min(){return this._value.min}set min(t){this._value.min=t,this._render()}get max(){return this._value.max}set max(t){this._value.max=t,this._render()}get step(){return this._value.step}set step(t){this._value.step=t,this._render()}passiveUpdate(t){this._value.update(t),this._render()}link(t){this.min=t.min,this.max=t.max,this.step=t.step,typeof t.on=="function"&&t.on("change",n=>this.passiveUpdate(n)),this.on("change",n=>{"value"in t&&(t.value=n)}),this.value=t.value}_bind(){this.element.addEventListener("blur",()=>{this.settings.useAppStyling?(this.element.style.backgroundColor="var(--c-surface)",this.element.style.color="var(--c-text)"):(this.element.style.backgroundColor=this.colors.fill,this.element.style.color=this.colors.dark);const t=parseFloat(this.element.value);!Number.isNaN(t)&&t!==this.value?this.value=t:this._render()}),this.element.addEventListener("keydown",t=>{if(t.key==="Enter"){this.element.blur();const n=parseFloat(this.element.value);Number.isNaN(n)||(this.value=n)}},!0),this.element.addEventListener("mousedown",t=>this._onMouseDown(t)),this.element.addEventListener("dragstart",t=>t.preventDefault())}_onMouseDown(t){this.hasMoved=!1,this.clicked=!0,this.element.readOnly=!0,this.actual=this.value,this._start={y:t.clientY};const n=this.element.getBoundingClientRect(),i=(t.clientX-n.left)/n.width;this._changeFactor=oL(i);const r=a=>this._onMouseMove(a),A=()=>this._onMouseUp(r,A);window.addEventListener("mousemove",r),window.addEventListener("mouseup",A)}_onMouseMove(t){if(!this.clicked)return;this.hasMoved=!0;const n=t.clientY-this._start.y,r=Lg(this.max-this.min,0,1e3)/200*Math.pow(this._changeFactor,2),A=this.actual-n*r;this._value.update(A),this._render(),this._value.changed&&this.emit("change",this._value.value)}_onMouseUp(t,n){this.clicked=!1,window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n),this.hasMoved?document.body.focus():(this.element.readOnly=!1,this.element.focus(),this.element.setSelectionRange(0,this.element.value.length),this.settings.useAppStyling?(this.element.style.backgroundColor="var(--c-accent)",this.element.style.color="var(--c-surface)"):(this.element.style.backgroundColor=this.colors.accent,this.element.style.color=this.colors.light))}_render(){this.element.value=yy(this._value.value,this.decimalPlaces)}}class rL{constructor(t,n,i,r){P(this,"min");P(this,"max");P(this,"step");P(this,"_value");P(this,"changed");this.min=Number(t),this.max=Number(n),this.step=Number(i)||1,this._value=0,this.changed=!1,this.update(r)}get value(){return this._value}update(t){const n=Lg(Number(t),this.min,this.max),i=this._stepTo(n),r=this._value;this._value=i,this.changed=i!==r}_stepTo(t){if(!isFinite(this.step)||this.step<=0)return t;const n=Math.round((t-this.min)/this.step);return this.min+n*this.step}}class AL{constructor(){P(this,"_m");this._m=new Map}on(t,n){const i=this._m.get(t)||[];i.push(n),this._m.set(t,i)}off(t,n){const i=this._m.get(t);if(!i)return;const r=i.indexOf(n);r>=0&&i.splice(r,1)}emit(t,n){const i=this._m.get(t);if(i)for(const r of i.slice())r(n)}}function Lg(e,t,n){return Math.max(t,Math.min(n,e))}function oL(e){return 1-Lg(e,0,1)}function yy(e,t=2){return isFinite(e)?Number(e).toFixed(Math.max(0,t)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):""}function aL(e,t){let n=e.value;e.addEventListener("input",()=>{t(e.value)?n=e.value:e.value=n})}class lL{constructor(){P(this,"isActive",!1);P(this,"pulseIntervals",new Map);P(this,"tempoElements",new Map);P(this,"popDuration",{scaleUp:40,scaleDown:80});P(this,"popScale",1.4);P(this,"activeAnimations",new Map);this.initElements()}initElements(){[{type:"eighth",containerId:"eighth-note-tempo",bpmMultiplier:2},{type:"quarter",containerId:"quarter-note-tempo",bpmMultiplier:1},{type:"dottedQuarter",containerId:"dotted-quarter-tempo",bpmMultiplier:.666}].forEach(({type:n,containerId:i,bpmMultiplier:r})=>{const A=document.getElementById(i),a=A==null?void 0:A.parentElement,l=a==null?void 0:a.querySelector(".tempo-label-icon");A&&l?this.tempoElements.set(n,{container:A,icon:l,bpmMultiplier:r,originalTransform:A.style.transform||"",originalIconTransform:l.style.transform||""}):x.warn("TempoVisualizer",`Could not find elements for ${n} tempo`,{container:!!A,icon:!!l,tempoGroup:!!a},"toolbar")})}start(){this.isActive||(this.isActive=!0,this.tempoElements.size===0&&this.initElements(),this.tempoElements.forEach((t,n)=>{this.startPulseForType(n)}))}stop(){this.isActive&&(this.isActive=!1,this.pulseIntervals.forEach(t=>{clearInterval(t)}),this.pulseIntervals.clear(),this.activeAnimations.clear(),this.tempoElements.forEach(t=>{t.container.style.transform=t.originalTransform,t.icon.style.transform=t.originalIconTransform}))}startPulseForType(t){const n=this.tempoElements.get(t);if(!n)return;const A=60/(d.state.tempo*n.bpmMultiplier)*1e3;this.triggerPulse(t);const a=setInterval(()=>{this.isActive&&this.triggerPulse(t)},A);this.pulseIntervals.set(t,a)}triggerPulse(t){const i={startTime:performance.now(),phase:"scaleUp"};this.activeAnimations.set(t,i);const r=this.isActive;this.isActive=!0,this.activeAnimations.size===1&&this.animationLoop(),r||setTimeout(()=>{this.activeAnimations.size===0&&(this.isActive=!1)},this.popDuration.scaleUp+this.popDuration.scaleDown+50)}animationLoop(){if(this.activeAnimations.size===0||!this.isActive)return;const t=performance.now();this.activeAnimations.forEach((n,i)=>{const r=this.calculateScale(n,t);this.applyScale(i,r),r===1&&n.phase==="complete"&&this.activeAnimations.delete(i)}),this.activeAnimations.size>0&&requestAnimationFrame(()=>this.animationLoop())}calculateScale(t,n){const i=n-t.startTime;if(t.phase==="scaleUp"){if(i>=this.popDuration.scaleUp)return t.phase="scaleDown",t.startTime=n,this.popScale;{const r=Math.min(i/this.popDuration.scaleUp,1);return 1+(this.popScale-1)*r}}else if(t.phase==="scaleDown"){if(i>=this.popDuration.scaleDown)return t.phase="complete",1;{const r=Math.min(i/this.popDuration.scaleDown,1);return this.popScale-(this.popScale-1)*r}}return 1}applyScale(t,n){const i=this.tempoElements.get(t);if(!i)return;const r=`scale(${n})`;i.container.style.transform=i.originalTransform+" "+r,i.icon.style.transform=i.originalIconTransform+" "+r;const A=n<this.popScale?"transform 0.08s ease-out":"none";i.container.style.transition=A,i.icon.style.transition=A}updateTempo(){this.isActive&&(this.stop(),this.start())}}const Po=new lL,jA=rA,Ui={blend:2,cutoff:31,resonance:0,type:"lowpass"};function wc(){return{coeffs:new Float32Array(jA).fill(0),phases:new Float32Array(jA).fill(0)}}function cL(){const e=wc();return e.coeffs[0]=1,e}function uL(){const e=wc();for(let t=1;t<=jA;t+=2){const n=t-1;e.coeffs[n]=1/t,e.phases[n]=0}return e}function hL(){const e=wc();for(let t=1;t<=jA;t+=2){const n=t-1;e.coeffs[n]=1/(t*t),e.phases[n]=Math.PI/2}return e}function dL(){const e=wc();for(let t=1;t<=jA;t++){const n=t-1;e.coeffs[n]=1/t,e.phases[n]=t&1?0:Math.PI}return e}const fL={strings:{amps:[.995,.94,.425,.48,0,.365,.04,.085,0,.09,0,0],phases:[0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,0]},piano:{amps:[1,.7,.6,.5,.4,.32,.25,.2,.17,.14,.12,.1],phases:Array(12).fill(0)},marimba:{amps:[1,.2,.15,.7,.05,.18,.03,.05,.02,.01,0,0],phases:Array(12).fill(0)},woodwind:{amps:[1,.05,.5,.05,.3,.05,.2,.05,.12,.05,.08,.05],phases:Array(12).fill(0)}};function Fu(e){const t=wc(),n=fL[e];if(!n)return t;const i=Math.min(jA,n.amps.length);for(let r=0;r<i;r++)t.coeffs[r]=n.amps[r]||0,t.phases[r]=n.phases[r]||0;return t}const rl={attack:.1,decay:.2,sustain:.8,release:.3},pL={sine:{name:"sine",gain:1,adsr:rl,...cL(),filter:{...Ui}},triangle:{name:"triangle",gain:.81,adsr:rl,...hL(),filter:{...Ui}},square:{name:"square",gain:4/Math.PI,adsr:rl,...uL(),filter:{...Ui}},sawtooth:{name:"sawtooth",gain:2/Math.PI,adsr:rl,...dL(),filter:{...Ui}},trapezium:{name:"trapezium",gain:4/Math.PI,adsr:rl,coeffs:new Float32Array([.993,0,.314,0,.168,0,.101,0,.06,0,.033,0]),phases:new Float32Array(jA).fill(0),filter:{...Ui}},impulse:{name:"impulse",gain:.18,adsr:{attack:.01,decay:.3,sustain:0,release:.2},coeffs:new Float32Array([1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0,0]),phases:new Float32Array([0,Math.PI*1.5,Math.PI,Math.PI/2,0,Math.PI*1.5,Math.PI,Math.PI/2,0,Math.PI*1.5,Math.PI,0]),filter:{...Ui}},strings:{name:"strings",gain:.49,adsr:{attack:.08,decay:.4,sustain:.7,release:.5},...Fu("strings"),filter:{...Ui,cutoff:28}},piano:{name:"piano",gain:.8,adsr:{attack:.01,decay:1.5,sustain:0,release:.4},...Fu("piano"),filter:{...Ui,cutoff:28}},marimba:{name:"marimba",gain:.9,adsr:{attack:.01,decay:.8,sustain:0,release:.4},...Fu("marimba"),filter:{...Ui,cutoff:25}},woodwind:{name:"woodwind",gain:.6,adsr:{attack:.1,decay:.2,sustain:.8,release:.3},...Fu("woodwind"),filter:{...Ui}}};function mL(e,t){_i(t,!0);let n=null,i=null,r=null,A=null,a=null,l=Pe(!1);const c=(V,O=20)=>{const K=parseInt(V.slice(1,3),16),z=parseInt(V.slice(3,5),16),gt=parseInt(V.slice(5,7),16),St=Math.max(0,Math.floor(K*(1-O/100))),wt=Math.max(0,Math.floor(z*(1-O/100))),Ct=Math.max(0,Math.floor(gt*(1-O/100)));return`#${St.toString(16).padStart(2,"0")}${wt.toString(16).padStart(2,"0")}${Ct.toString(16).padStart(2,"0")}`},h=(V,O=50)=>{const K=parseInt(V.slice(1,3),16),z=parseInt(V.slice(3,5),16),gt=parseInt(V.slice(5,7),16),St=Math.min(255,Math.floor(K+(255-K)*(O/100))),wt=Math.min(255,Math.floor(z+(255-z)*(O/100))),Ct=Math.min(255,Math.floor(gt+(255-gt)*(O/100)));return`#${St.toString(16).padStart(2,"0")}${wt.toString(16).padStart(2,"0")}${Ct.toString(16).padStart(2,"0")}`};function f(V){const O=Math.round(V),K=n||document.getElementById("tempo-slider");K&&parseInt(K.value,10)!==O&&(K.value=`${O}`);const z=O*2,gt=Math.round(O/1.5);i&&i.value!==z&&i.passiveUpdate(z),r&&r.value!==O&&r.passiveUpdate(O),A&&A.value!==gt&&A.passiveUpdate(gt),d.state.tempo!==O&&(d.setTempo(O),Po.updateTempo())}function m(V){if(!V)return;const O=V.closest(".tempo-slider-container");if(!O||O.querySelector(".tempo-slider-marks"))return;const K=[60,90,120,160,200],z=document.createElement("div");z.className="tempo-slider-marks",O.appendChild(z);const gt=Number(V.min)||0,St=Number(V.max)||1,wt=Math.max(St-gt,1),Ct=[],Mt=()=>{const st=V.getBoundingClientRect().height||V.clientHeight,ot=getComputedStyle(V),vt=parseFloat(ot.getPropertyValue("--slider-thumb-size"))||0,ut=parseFloat(ot.getPropertyValue("--slider-thumb-border"))||0,Lt=vt+ut*2,$t=Math.max(st-Lt,1),Vt=Lt/2;Ct.forEach(({el:Nt,bpm:Dt})=>{if(Dt<gt||Dt>St){Nt.style.display="none";return}Nt.style.display="";const Et=(Dt-gt)/wt,Ft=Vt+$t*Et;Nt.style.bottom=`${Ft}px`})};K.forEach(J=>{const st=document.createElement("span");st.className="tempo-slider-mark",st.setAttribute("aria-hidden","true"),z.appendChild(st),Ct.push({el:st,bpm:J})}),Mt(),new ResizeObserver(Mt).observe(V)}function w(V){if(!V||!a)return;const O=d.state.timbres[V],K=d.state.colorPalette[V]||{primary:V,light:V},z=K.light,gt=K.primary;document.querySelectorAll(".preset-button").forEach(wt=>{const Ct=wt,Mt=Ct.id.replace("preset-",""),Tt=(O==null?void 0:O.activePresetName)===Mt;Ct.classList.toggle("selected",Tt)});const St=h(z,60);a.style.setProperty("--c-accent",gt),a.style.setProperty("--c-accent-light",St),a.style.setProperty("--c-accent-hover",c(gt,20))}function B(){ae(l,!0),Po.start()}function y(){ae(l,!0),Po.start()}function b(V){const O=V.target,K=O?parseInt(O.value,10):NaN;f(K)}function S(){n==null||n.blur()}function F(){qt(l)&&(ae(l,!1),Po.stop())}function U(){qt(l)&&(ae(l,!1),Po.stop())}function D(){qt(l)&&(ae(l,!1),Po.stop())}function H({newNote:V}){V!=null&&V.color?w(V.color):(document.querySelectorAll(".preset-button").forEach(O=>O.classList.remove("selected")),a&&(a.style.setProperty("--c-accent","#4A90E2"),a.style.setProperty("--c-accent-hover","#357ABD")))}function Q(V){var O;V===((O=d.state.selectedNote)==null?void 0:O.color)&&w(V)}function R(V){f(V)}Zi(()=>{var K;n=document.getElementById("tempo-slider"),a=document.querySelector(".preset-effects-container");const V={size:[45,24],step:1,decimalPlaces:0,useAppStyling:!0};i=new _p("#eighth-note-tempo",{...V,value:180,min:60,max:480}),r=new _p("#quarter-note-tempo",{...V,value:90,min:30,max:240}),A=new _p("#dotted-quarter-tempo",{...V,value:60,min:20,max:160}),i.on("change",z=>{!isNaN(z)&&z>0&&f(z/2)}),r.on("change",z=>{!isNaN(z)&&z>0&&f(z)}),A.on("change",z=>{!isNaN(z)&&z>0&&f(z*1.5)}),f(d.state.tempo),n?(m(n),n.addEventListener("mousedown",B),n.addEventListener("touchstart",y),n.addEventListener("input",b),n.addEventListener("mouseup",S),f(d.state.tempo)):x.warn("AudioControlsBridge","Tempo slider not found - will initialize when rhythm tab is opened",null,"toolbar"),document.addEventListener("mouseup",F),document.addEventListener("touchend",U),document.addEventListener("touchcancel",D),document.querySelectorAll(".preset-button").forEach(z=>{const gt=z,St=gt.id.replace("preset-",""),wt=pL[St];wt&&gt.addEventListener("click",()=>{var Mt;const Ct=(Mt=d.state.selectedNote)==null?void 0:Mt.color;Ct&&(d.applyPreset(Ct,wt),setTimeout(()=>w(Ct),10)),gt.blur()})}),d.on("noteChanged",H),d.on("timbreChanged",Q),d.on("tempoChanged",R);const O=(K=d.state.selectedNote)==null?void 0:K.color;O&&w(O),console.log("[Svelte] AudioControlsBridge mounted")}),Tr(()=>{n==null||n.removeEventListener("mousedown",B),n==null||n.removeEventListener("touchstart",y),n==null||n.removeEventListener("input",b),n==null||n.removeEventListener("mouseup",S),document.removeEventListener("mouseup",F),document.removeEventListener("touchend",U),document.removeEventListener("touchcancel",D),console.log("[Svelte] AudioControlsBridge unmounted")}),Si()}function gL(e,t){_i(t,!0);const n="selectedTab",i="selectedPresetTab",r="timbre",A="presets";function a(Q){try{localStorage.setItem(n,Q),x.debug("TabManagement",`Saved tab to localStorage: ${Q}`,void 0,"ui")}catch(R){x.warn("TabManagement","Failed to save tab to localStorage",R,"ui")}}function l(){try{return localStorage.getItem(n)||r}catch(Q){return x.warn("TabManagement","Failed to read tab from localStorage",Q,"ui"),r}}function c(Q){try{localStorage.setItem(i,Q),x.debug("TabManagement",`Saved preset tab to localStorage: ${Q}`,void 0,"ui")}catch(R){x.warn("TabManagement","Failed to save preset tab to localStorage",R,"ui")}}function h(){try{return localStorage.getItem(i)||A}catch(Q){return x.warn("TabManagement","Failed to read preset tab from localStorage",Q,"ui"),A}}let f=null,m=null,w=null;const B=new Map,y=new Map,b=new Map;function S(){const Q=l();document.querySelectorAll(".tab-button").forEach(O=>O.classList.remove("active")),document.querySelectorAll(".tab-panel").forEach(O=>O.classList.remove("active"));const R=document.querySelector(`[data-tab="${Q}"]`),V=document.getElementById(`${Q}-panel`);R&&V?(R.classList.add("active"),V.classList.add("active"),Q==="rhythm"&&setTimeout(()=>{const O=window.initTempoSliderIfNeeded;typeof O=="function"&&O()},200)):x.warn("TabManagement",`Could not restore tab: ${Q}. Tab button or panel not found.`)}function F(){const Q=h();document.querySelectorAll(".preset-tab-button:not([disabled])").forEach(O=>O.classList.remove("active")),document.querySelectorAll(".preset-tab-panel").forEach(O=>O.classList.remove("active"));const R=document.querySelector(`[data-preset-tab="${Q}"]`),V=document.getElementById(`${Q}-panel`);if(R&&V&&!R.hasAttribute("disabled")){R.classList.add("active"),V.classList.add("active");const O=document.querySelector(".harmonic-bins-container");O&&(Q==="effects"?O.style.display="none":O.style.display="flex")}else x.warn("TabManagement",`Could not restore preset tab: ${Q}. Tab button or panel not found.`)}function U(){S(),f=document.querySelectorAll(".tab-button"),f.forEach(Q=>{const R=()=>{const V=Q.dataset.tab;if(!V)return;document.querySelectorAll(".tab-button").forEach(K=>K.classList.remove("active")),Q.classList.add("active"),document.querySelectorAll(".tab-panel").forEach(K=>K.classList.remove("active"));const O=document.getElementById(`${V}-panel`);O&&O.classList.add("active"),a(V),V==="rhythm"&&setTimeout(()=>{const K=window.initTempoSliderIfNeeded;typeof K=="function"&&K()},50)};Q.addEventListener("click",R),B.set(Q,R)}),x.info("TabManagementBridge","Main tabs initialized",null,"ui")}function D(){F(),m=document.querySelectorAll(".preset-tab-button"),m.forEach(Q=>{const R=()=>{const V=Q.dataset.presetTab;if(!V)return;document.querySelectorAll(".preset-tab-button:not([disabled])").forEach(z=>z.classList.remove("active")),Q.classList.add("active"),document.querySelectorAll(".preset-tab-panel").forEach(z=>z.classList.remove("active"));const O=document.getElementById(`${V}-panel`);O&&O.classList.add("active"),c(V);const K=document.querySelector(".harmonic-bins-container");K&&(V==="effects"?K.style.display="none":K.style.display="flex")};Q.addEventListener("click",R),y.set(Q,R)}),x.info("TabManagementBridge","Preset tabs initialized",null,"ui")}function H(){w=document.querySelectorAll(".pitch-tab-button"),w.forEach(Q=>{const R=()=>{const V=Q.dataset.pitchTab;if(!V)return;document.querySelectorAll(".pitch-tab-button").forEach(K=>K.classList.remove("active")),Q.classList.add("active"),document.querySelectorAll(".pitch-tab-panel").forEach(K=>K.classList.remove("active"));const O=document.getElementById(`${V}-panel`);O&&O.classList.add("active")};Q.addEventListener("click",R),b.set(Q,R)}),x.info("TabManagementBridge","Pitch tabs initialized",null,"ui")}Zi(()=>{U(),D(),H(),console.log("[Svelte] TabManagementBridge mounted")}),Tr(()=>{B.forEach((Q,R)=>{R.removeEventListener("click",Q)}),B.clear(),y.forEach((Q,R)=>{R.removeEventListener("click",Q)}),y.clear(),b.forEach((Q,R)=>{R.removeEventListener("click",Q)}),b.clear(),console.log("[Svelte] TabManagementBridge unmounted")}),Si()}function wL(e,t){_i(t,!0);const n=16,i={letter:{width:8.5,height:11},"11x14":{width:11,height:14},"11x17":{width:11,height:17}};let r=null,A=null,a=null,l=null,c=null,h=null,f=null,m=null,w=null,B=null,y=null,b=null,S=null,F=Pe(!1),U=Pe(null);const D=20,H=5;let Q=null,R=null;function V(){d.state.isPrintPreviewActive||d.setPrintPreviewActive(!0),r==null||r.classList.remove("hidden");const it=Xt=>Xt?getComputedStyle(Xt).display!=="none":!1,Z=d.state.printOptions.pageSize,mt=Z&&Z in i?Z:"letter",xt=it(document.getElementById("button-grid")),Bt=it(document.getElementById("drum-grid-wrapper")),Ht=it(document.getElementById("legend-left-canvas")),oe=it(document.getElementById("legend-right-canvas"));d.setPrintOptions({pageSize:mt,cropTop:0,cropBottom:1,cropLeft:0,cropRight:1,includeButtonGrid:xt,includeDrums:Bt,includeLeftLegend:Ht,includeRightLegend:oe}),xt&&Wu.prefetchButtonGridSnapshot(Ht,oe),gt()}function O(){d.state.isPrintPreviewActive&&d.setPrintPreviewActive(!1),r==null||r.classList.add("hidden")}function K(it,Z){const xt=d.state.printOptions[it]===Z[0]?Z[1]:Z[0];d.setPrintOptions({[it]:xt})}function z(){if([m,w,B,y,b,S].some(Ce=>Ce===null))return;const Z=d.state.printOptions.pageSize,mt=Z&&Z in i?Z:"letter",{orientation:xt,colorMode:Bt,includeButtonGrid:Ht,includeDrums:oe,includeLeftLegend:Xt,includeRightLegend:be}=d.state.printOptions;f&&(f.value=mt),m&&(m.textContent=xt.charAt(0).toUpperCase()+xt.slice(1)),w&&(w.textContent=Bt==="color"?"Color":"B&W",w.classList.toggle("active",Bt==="color")),B&&(B.textContent=Ht?"Include":"Exclude",B.classList.toggle("active",Ht)),y&&(y.textContent=oe?"Include":"Exclude",y.classList.toggle("active",oe)),b&&(b.textContent=Xt?"Include":"Exclude",b.classList.toggle("active",Xt)),S&&(S.textContent=be?"Include":"Exclude",S.classList.toggle("active",be))}async function gt(){if(!d.state.isPrintPreviewActive||!A||!a)return;z();const it=(h==null?void 0:h.clientWidth)??0,Z=(h==null?void 0:h.clientHeight)??0;if(it===0||Z===0)return;const{orientation:mt}=d.state.printOptions,xt=d.state.printOptions.pageSize,Bt=xt&&xt in i?xt:"letter",Ht=i[Bt],oe=mt==="landscape"?Ht.height:Ht.width,Xt=mt==="landscape"?Ht.width:Ht.height,be=.25,Ce=oe/Xt,Zt=n*2;let Ie=Math.max(it-Zt,100),me=Math.max(Z-Zt,100);Ie/me>Ce?Ie=me*Ce:me=Ie/Ce;const xe=be/oe*Ie,Mn=Ie-2*xe,Kt=me-2*xe,ne={...d.state.printOptions,cropTop:0,cropBottom:1,cropLeft:0,cropRight:1},re=await Wu.generateScoreCanvas(ne,{width:Mn,height:Kt});if(!re)return;A.width=Ie,A.height=me,a.fillStyle="#FFFFFF",a.fillRect(0,0,Ie,me),a.strokeStyle="#E0E0E0",a.lineWidth=1,a.strokeRect(xe,xe,Mn,Kt);const Le=xe+Math.max(0,(Mn-re.width)/2),Gn=xe+Math.max(0,(Kt-re.height)/2);a.drawImage(re,Le,Gn),St(xe,Mn,Kt),wt(Ie,me,{contentTop:Gn,contentLeft:Le,contentWidth:re.width,contentHeight:re.height})}function St(it,Z,mt){if(!a)return;a.strokeStyle="#CCCCCC",a.lineWidth=1;const xt=10,Bt=it+Z,Ht=it+mt;a.beginPath(),a.moveTo(it,it-xt),a.lineTo(it,it+xt),a.moveTo(it-xt,it),a.lineTo(it+xt,it),a.moveTo(Bt,it-xt),a.lineTo(Bt,it+xt),a.moveTo(Bt-xt,it),a.lineTo(Bt+xt,it),a.moveTo(it,Ht-xt),a.lineTo(it,Ht+xt),a.moveTo(it-xt,Ht),a.lineTo(it+xt,Ht),a.moveTo(Bt,Ht-xt),a.lineTo(Bt,Ht+xt),a.moveTo(Bt-xt,Ht),a.lineTo(Bt+xt,Ht),a.stroke()}function wt(it,Z,mt){const xt=A==null?void 0:A.getBoundingClientRect(),Bt=h==null?void 0:h.getBoundingClientRect();if(!xt||!Bt||!l||!c)return;l.width=it,l.height=Z,l.style.left=`${xt.left-Bt.left}px`,l.style.top=`${xt.top-Bt.top}px`,l.style.width=`${it}px`,l.style.height=`${Z}px`;const{cropTop:Ht,cropBottom:oe,cropLeft:Xt,cropRight:be}=d.state.printOptions,{contentTop:Ce,contentLeft:Zt,contentHeight:Ie,contentWidth:me}=mt,xe=Ce+Ht*Ie,Mn=Ce+oe*Ie,Kt=Zt+Xt*me,ne=Zt+be*me,re=Ce+Ie,Le=Zt+me;c.clearRect(0,0,it,Z),c.fillStyle="rgba(0, 0, 0, 0.5)",Ht>0&&c.fillRect(Zt,Ce,me,xe-Ce),oe<1&&c.fillRect(Zt,Mn,me,re-Mn),Xt>0&&c.fillRect(Zt,xe,Kt-Zt,Mn-xe),be<1&&c.fillRect(ne,xe,Le-ne,Mn-xe),Ct(xe,Zt,Le,"top"),Ct(Mn,Zt,Le,"bottom"),Mt(Kt,Ce,re,"left"),Mt(ne,Ce,re,"right"),Q={pageWidth:it,pageHeight:Z,contentTop:Ce,contentLeft:Zt,contentHeight:Ie,contentWidth:me,cropTopY:xe,cropBottomY:Mn,cropLeftX:Kt,cropRightX:ne}}function Ct(it,Z,mt,xt){if(!c)return;const Bt=60,Ht=mt-Z,oe=Z+(Ht-Bt)/2,Xt=xt==="top"?it-D-4:it+4;c.fillStyle="#4a90e2",c.fillRect(Z,it-1,Ht,2),c.fillRect(oe,Xt,Bt,D),c.strokeStyle="#FFFFFF",c.lineWidth=2,c.strokeRect(oe,Xt,Bt,D),c.strokeStyle="#FFFFFF",c.lineWidth=1;const be=3,Ce=6,Zt=30,Ie=Z+(Ht-Zt)/2;for(let me=0;me<be;me++){const xe=Xt+D/2+(me-1)*Ce;c.beginPath(),c.moveTo(Ie,xe),c.lineTo(Ie+Zt,xe),c.stroke()}}function Mt(it,Z,mt,xt){if(!c)return;const Bt=60,Ht=mt-Z,oe=Z+(Ht-Bt)/2,Xt=xt==="left"?it-D-4:it+4;c.fillStyle="#4a90e2",c.fillRect(it-1,Z,2,Ht),c.fillRect(Xt,oe,D,Bt),c.strokeStyle="#FFFFFF",c.lineWidth=2,c.strokeRect(Xt,oe,D,Bt),c.strokeStyle="#FFFFFF",c.lineWidth=1;const be=3,Ce=6,Zt=30,Ie=Z+(Ht-Zt)/2;for(let me=0;me<be;me++){const xe=Xt+D/2+(me-1)*Ce;c.beginPath(),c.moveTo(xe,Ie),c.lineTo(xe,Ie+Zt),c.stroke()}}function Tt(it){if(!Q||!l)return;const Z=l.getBoundingClientRect(),mt=it.clientX-Z.left,xt=it.clientY-Z.top,Bt=mt>=Q.contentLeft&&mt<=Q.contentLeft+Q.contentWidth,Ht=xt>=Q.contentTop&&xt<=Q.contentTop+Q.contentHeight,oe=Bt&&Math.abs(xt-Q.cropTopY)<D+H,Xt=Bt&&Math.abs(xt-Q.cropBottomY)<D+H,be=Ht&&Math.abs(mt-Q.cropLeftX)<D+H,Ce=Ht&&Math.abs(mt-Q.cropRightX)<D+H;oe?(ae(F,!0),ae(U,"top"),l.style.cursor="ns-resize"):Xt?(ae(F,!0),ae(U,"bottom"),l.style.cursor="ns-resize"):be?(ae(F,!0),ae(U,"left"),l.style.cursor="ew-resize"):Ce&&(ae(F,!0),ae(U,"right"),l.style.cursor="ew-resize")}function J(it){if(!Q||!l)return;const Z=l.getBoundingClientRect(),mt=it.clientX-Z.left,xt=it.clientY-Z.top;if(qt(F)&&qt(U)){st(mt,xt);return}const Bt=mt>=Q.contentLeft&&mt<=Q.contentLeft+Q.contentWidth,Ht=xt>=Q.contentTop&&xt<=Q.contentTop+Q.contentHeight,oe=Bt&&Math.abs(xt-Q.cropTopY)<D+H,Xt=Bt&&Math.abs(xt-Q.cropBottomY)<D+H,be=Ht&&Math.abs(mt-Q.cropLeftX)<D+H,Ce=Ht&&Math.abs(mt-Q.cropRightX)<D+H;oe||Xt?l.style.cursor="ns-resize":be||Ce?l.style.cursor="ew-resize":l.style.cursor="default"}function st(it,Z){if(!Q)return;const{contentTop:mt,contentLeft:xt,contentHeight:Bt,contentWidth:Ht}=Q,oe=.05;if(qt(U)==="top"){const Xt=Math.max(0,Math.min(1,(Z-mt)/Bt)),be=d.state.printOptions.cropBottom;Xt<be-oe&&d.setPrintOptions({cropTop:Xt})}else if(qt(U)==="bottom"){const Xt=Math.max(0,Math.min(1,(Z-mt)/Bt)),be=d.state.printOptions.cropTop;Xt>be+oe&&d.setPrintOptions({cropBottom:Xt})}else if(qt(U)==="left"){const Xt=Math.max(0,Math.min(1,(it-xt)/Ht)),be=d.state.printOptions.cropRight;Xt<be-oe&&d.setPrintOptions({cropLeft:Xt})}else if(qt(U)==="right"){const Xt=Math.max(0,Math.min(1,(it-xt)/Ht)),be=d.state.printOptions.cropLeft;Xt>be+oe&&d.setPrintOptions({cropRight:Xt})}}function ot(){ae(F,!1),ae(U,null),l&&(l.style.cursor="default")}function vt(){O()}function ut(){Wu.generateAndPrint(),O()}function Lt(){K("orientation",["landscape","portrait"])}function $t(){K("colorMode",["color","bw"])}function Vt(){K("includeButtonGrid",[!0,!1])}function Nt(){K("includeDrums",[!0,!1])}function Dt(){K("includeLeftLegend",[!0,!1])}function Et(){K("includeRightLegend",[!0,!1])}function Ft(){if(!f)return;const it=f.value;it in i&&d.setPrintOptions({pageSize:it})}function jt(it){it?V():O()}function rt(){gt()}function pt(){d.state.isPrintPreviewActive&&gt()}Zi(()=>{var it,Z;r=document.getElementById("print-preview-overlay"),A=document.getElementById("print-preview-canvas"),a=(A==null?void 0:A.getContext("2d"))??null,l=document.getElementById("print-crop-overlay"),c=(l==null?void 0:l.getContext("2d"))??null,h=(A==null?void 0:A.parentElement)??null,f=document.getElementById("print-page-size"),m=document.getElementById("print-orientation-toggle"),w=document.getElementById("print-color-mode-toggle"),B=document.getElementById("print-button-grid-toggle"),y=document.getElementById("print-drum-grid-toggle"),b=document.getElementById("print-left-legend-toggle"),S=document.getElementById("print-right-legend-toggle"),(it=document.getElementById("print-close-button"))==null||it.addEventListener("click",vt),(Z=document.getElementById("print-confirm-button"))==null||Z.addEventListener("click",ut),m==null||m.addEventListener("click",Lt),w==null||w.addEventListener("click",$t),B==null||B.addEventListener("click",Vt),y==null||y.addEventListener("click",Nt),b==null||b.addEventListener("click",Dt),S==null||S.addEventListener("click",Et),f==null||f.addEventListener("change",Ft),l==null||l.addEventListener("mousedown",Tt),l==null||l.addEventListener("mousemove",J),l==null||l.addEventListener("mouseup",ot),l==null||l.addEventListener("mouseleave",ot),d.on("printPreviewStateChanged",jt),d.on("printOptionsChanged",rt),d.on("notesChanged",pt),h&&(R=new ResizeObserver(()=>{d.state.isPrintPreviewActive&&gt()}),R.observe(h)),console.log("[Svelte] PrintPreviewBridge mounted")}),Tr(()=>{var it,Z;(it=document.getElementById("print-close-button"))==null||it.removeEventListener("click",vt),(Z=document.getElementById("print-confirm-button"))==null||Z.removeEventListener("click",ut),m==null||m.removeEventListener("click",Lt),w==null||w.removeEventListener("click",$t),B==null||B.removeEventListener("click",Vt),y==null||y.removeEventListener("click",Nt),b==null||b.removeEventListener("click",Dt),S==null||S.removeEventListener("click",Et),f==null||f.removeEventListener("change",Ft),l==null||l.removeEventListener("mousedown",Tt),l==null||l.removeEventListener("mousemove",J),l==null||l.removeEventListener("mouseup",ot),l==null||l.removeEventListener("mouseleave",ot),R==null||R.disconnect(),console.log("[Svelte] PrintPreviewBridge unmounted")}),Si()}const vL={"playback-controls":qk,"playback-controls-bridge":$k,"file-actions-bridge":zk,"grid-controls-bridge":Xk,"modulation-bridge":Yk,"sidebar-bridge":jk,"tool-selector-bridge":iL,"audio-controls-bridge":mL,"tab-management-bridge":gL,"print-preview-bridge":wL},BL=[];function yL(){document.querySelectorAll("[data-svelte-component]").forEach(t=>{const n=t.getAttribute("data-svelte-component");if(!n)return;const i=vL[n];if(!i){console.warn(`[Svelte] Unknown component: ${n}`);return}try{t.innerHTML="";const r=Mk(i,{target:t});BL.push({target:t,component:r}),console.log(`[Svelte] Mounted: ${n}`)}catch(r){console.error(`[Svelte] Failed to mount ${n}:`,r)}})}function CL(){E2.init(),yL(),x.initSuccess("UiComponents")}const fi={container:null,parentContainer:null,sustainTrack:null,sustainThumb:null,multiSliderContainer:null,thumbA:null,thumbD:null,thumbR:null};function bL(){var e;return fi.container=document.querySelector("#adsr-envelope"),fi.parentContainer=((e=fi.container)==null?void 0:e.closest(".adsr-container"))||null,fi.sustainTrack=document.getElementById("sustain-slider-track"),fi.sustainThumb=document.getElementById("sustain-slider-thumb"),fi.multiSliderContainer=document.getElementById("multi-thumb-slider-container"),fi.thumbA=document.getElementById("thumb-a"),fi.thumbD=document.getElementById("thumb-d"),fi.thumbR=document.getElementById("thumb-r"),fi}const _L={init:bL,get elements(){return fi}};function e_(){return s_*d.state.adsrTimeAxisScale}function n_(e,t){const n=d.state.timbres[t.currentColor];if(!n)return;const{sustain:i}=n.adsr,r=.01;e.d=Math.max(e.a+r,e.d),e.r=Math.max(e.d+r,e.r);const A=e.a,a=e.d-e.a,l=e.r-e.d;if(isNaN(A)||isNaN(a)||isNaN(l)){x.error("AdsrInteractions","NaN value detected before setting ADSR. Aborting update.",{newAttack:A,newDecay:a,newRelease:l},"audio");return}d.setADSR(t.currentColor,{attack:A,decay:a,release:l,sustain:i})}function SL(e,t){var a;let n=!1;const i=l=>{var y;if(!n||!e.sustainTrack)return;const c=e.sustainTrack.getBoundingClientRect();let f=100-(l.clientY-c.top)/c.height*100;f=Math.max(0,Math.min(100,f));const w=(((y=window.waveformVisualizer)==null?void 0:y.getNormalizedAmplitude())||1)*100;f=Math.min(f,w);const B=d.state.timbres[t.currentColor];B&&d.setADSR(t.currentColor,{...B.adsr,sustain:f/100})},r=l=>{n=!0,i(l)},A=()=>{n=!1};(a=e.sustainTrack)==null||a.addEventListener("pointerdown",r),document.addEventListener("pointermove",i),document.addEventListener("pointerup",A)}function xL(e,t){var a;let n=null;const i=l=>{if(!n||!e.multiSliderContainer)return;const c=e.multiSliderContainer.getBoundingClientRect();let f=(l.clientX-c.left)/c.width*100;f=Math.max(0,Math.min(100,f));const m=f/100*e_(),w=d.state.timbres[t.currentColor];if(!w)return;const{attack:B,decay:y,release:b}=w.adsr,S={a:B,d:B+y,r:B+y+b};n.id==="thumb-a"&&(S.a=m),n.id==="thumb-d"&&(S.d=m),n.id==="thumb-r"&&(S.r=m),n_(S,t)},r=l=>{const c=l.target;c.classList.contains("time-slider-thumb")&&(n=c,i(l))},A=()=>{n=null};(a=e.multiSliderContainer)==null||a.addEventListener("pointerdown",r),document.addEventListener("pointermove",i),document.addEventListener("pointerup",A)}function EL(e,t){let n=null;const i=a=>{var R;if(!n)return;const l=t.svgContainer,c=l.createSVGPoint();c.x=a.clientX,c.y=a.clientY;const h=l.getScreenCTM();if(!h)return;const f=c.matrixTransform(h.inverse());let m=f.x/t.width*100,w=1-f.y/t.height;m=Math.max(0,Math.min(100,m)),w=Math.max(0,Math.min(1,w));const B=m/100*e_(),y=d.state.timbres[t.currentColor];if(!y)return;const{attack:b,decay:S,release:F}=y.adsr;let U=y.adsr.sustain;const D={a:b,d:b+S,r:b+S+F};switch(n.id){case"attack-node":D.a=B;break;case"decay-sustain-node":{D.d=B;const V=((R=window.waveformVisualizer)==null?void 0:R.getNormalizedAmplitude())||1;U=Math.min(w,V);break}case"release-node":D.r=B;break}const H=d.state.timbres[t.currentColor];if(!H)return;const Q=H.adsr.sustain;U!==Q&&d.setADSR(t.currentColor,{attack:b,decay:S,release:F,sustain:U}),n_(D,t)},r=a=>{const l=a.target;l.classList.contains("adsr-node")&&(n=l,n.style.cursor="grabbing",i(a))},A=()=>{n&&(n.style.cursor="grab",n=null)};t.nodeLayer.addEventListener("pointerdown",r),document.addEventListener("pointermove",i),document.addEventListener("pointerup",A)}function TL(e){const t=e.ui;SL(t,e),xL(t,e),EL(t,e)}function FL(e,{width:t,height:n},i){for(;e.firstChild;)e.removeChild(e.firstChild);if(i>0){for(let l=1;l<=5;l++)if(l<=i){const c=l/i*t,h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",String(c)),h.setAttribute("y",String(n-5)),h.setAttribute("fill","#d0d0d0"),h.setAttribute("font-size","24"),h.setAttribute("font-weight","bold"),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","auto"),h.setAttribute("opacity","0.3"),h.textContent=`${l}s`,e.appendChild(h)}}const r=d.state.tempo;if(r<=0||i<=0)return;const A=30/r;let a=0;for(let l=A;l<i;l+=A){const c=l/i*t,h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",String(c)),h.setAttribute("y1","0"),h.setAttribute("x2",String(c)),h.setAttribute("y2",String(n));const f=(a+1)%2===0;h.setAttribute("stroke",f?"#adb5bd":"#ced4da"),h.setAttribute("stroke-width",f?"1":"0.5"),h.setAttribute("stroke-dasharray","3,3"),e.appendChild(h),a++}}function IL(e,t,n,{height:i,width:r},A,a,l){for(;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)t.removeChild(t.firstChild);if(n.length<4)return;const c=n[0],h=n[1],f=n[2],m=n[3];if(!c||!h||!f||!m)return;const w=d.state.colorPalette[A]||{primary:A,light:A},B=w.primary,y=w.light;let b={time:0,feedback:0};if(window.effectsCoordinator&&(b=window.effectsCoordinator.getEffectParameters(A,"delay")),l&&l.clearRect(0,0,r,i),(b.time||0)>0&&(b.feedback||0)>0&&a){const O=Math.max(.01,(b.time||0)/100*.5),K=Math.min(.95,(b.feedback||0)/100),z=.05;let gt=K,St=0;for(;gt>z&&St<10;){St++;const wt=O*St/a*r,Ct=n.map(J=>({x:J.x+wt,y:J.y})),Mt=Ct[0],Tt=Ct[3];if(!(!Mt||!Tt)){if(Mt.x<r){const J=document.createElementNS("http://www.w3.org/2000/svg","polygon"),st=`${Mt.x},${i} `+Ct.map(vt=>`${vt.x},${vt.y}`).join(" ")+` ${Math.min(Tt.x,r)},${i}`;J.setAttribute("points",st),J.setAttribute("fill",Vi(y,.7*gt)),J.setAttribute("class","delay-echo"),e.appendChild(J);const ot=document.createElementNS("http://www.w3.org/2000/svg","polyline");ot.setAttribute("points",Ct.map(vt=>`${vt.x},${vt.y}`).join(" ")),ot.setAttribute("stroke-width","2"),ot.setAttribute("fill","none"),ot.setAttribute("stroke",Vi(B,gt)),ot.setAttribute("class","delay-echo"),e.appendChild(ot)}gt*=K}}}const S=document.createElementNS("http://www.w3.org/2000/svg","polygon"),F=`0,${i} `+n.map(O=>`${O.x},${O.y}`).join(" ")+` ${r},${i}`;S.setAttribute("points",F),S.setAttribute("fill",Vi(y,.7)),e.appendChild(S);const U=document.createElementNS("http://www.w3.org/2000/svg","line");U.setAttribute("x1",String(c.x)),U.setAttribute("y1",String(c.y)),U.setAttribute("x2",String(h.x)),U.setAttribute("y2",String(h.y)),U.setAttribute("stroke",B),U.setAttribute("stroke-width","2"),e.appendChild(U);const D=document.createElementNS("http://www.w3.org/2000/svg","line");D.setAttribute("x1",String(h.x)),D.setAttribute("y1",String(h.y)),D.setAttribute("x2",String(f.x)),D.setAttribute("y2",String(f.y)),D.setAttribute("stroke",B),D.setAttribute("stroke-width","2"),e.appendChild(D);const H=1,Q=document.createElementNS("http://www.w3.org/2000/svg","line");Q.setAttribute("x1",String(f.x)),Q.setAttribute("y1",String(f.y)),Q.setAttribute("x2",String(m.x)),Q.setAttribute("y2",String(m.y)),Q.setAttribute("stroke",Vi(B,H)),Q.setAttribute("stroke-width","2"),e.appendChild(Q);const R=["attack-node","decay-sustain-node","release-node"];[h,f,m].forEach((O,K)=>{const z=document.createElementNS("http://www.w3.org/2000/svg","circle");z.setAttribute("id",R[K]),z.setAttribute("class","adsr-node"),z.setAttribute("cx",String(O.x)),z.setAttribute("cy",String(O.y)),z.setAttribute("r","8"),z.setAttribute("fill",B),z.setAttribute("stroke",Yh(B,-.3)),z.setAttribute("stroke-width","2"),z.style.cursor="grab";const gt=document.createElementNS("http://www.w3.org/2000/svg","title");z.appendChild(gt),t.appendChild(z)})}function ML(e,t){if(!e)return;const n=Yh(t,-.2);e.style.setProperty("--c-accent",t),e.style.setProperty("--c-accent-hover",n)}const hn={};let ni=null,ZA=!1;function QL(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("data-playhead-id",e);const i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("stroke",t),i.setAttribute("stroke-width","2"),i.setAttribute("stroke-dasharray","3,3"),n.appendChild(i);const r=document.createElementNS("http://www.w3.org/2000/svg","circle");return r.setAttribute("r","5"),r.setAttribute("fill",t),n.appendChild(r),n}function UL(e,t,n,i=null){if(!(!ni||!i)){if(t==="attack"){hn[e]&&(hn[e].requestId!==null&&cancelAnimationFrame(hn[e].requestId),hn[e].group.remove());const r=QL(e,n);ni.playheadLayer.appendChild(r),hn[e]={group:r,phase:t,color:n,adsr:i,requestId:null,startTimestamp:et.now(),elapsed:0},Rg(e)}else if(t==="release"){if(ZA)return;const r=hn[e];if(!r)return;r.requestId!==null&&cancelAnimationFrame(r.requestId),r.phase="release",r.adsr=i,r.startTimestamp=et.now(),r.elapsed=0,Ng(e)}}}function Rg(e){if(!hn[e]||ZA||!ni)return;const t=hn[e];if(!t.adsr)return;const{attack:n,decay:i}=t.adsr,r=ni.calculateEnvelopePoints(t.adsr);if(r.length<4)return;const A=r[0],a=r[1],l=r[2],c=et.now()-t.startTimestamp;t.elapsed=c;const h=n+i,f=Math.min(c,h);let m,w;if(f<=n){const b=n>0?f/n:1;m=A.x+b*(a.x-A.x),w=A.y+b*(a.y-A.y)}else{const b=f-n,S=i>0?b/i:1;m=a.x+S*(l.x-a.x),w=a.y+S*(l.y-a.y)}const[B,y]=t.group.children;B.setAttribute("x1",String(m)),B.setAttribute("y1","0"),B.setAttribute("x2",String(m)),B.setAttribute("y2",String(ni.height)),y.setAttribute("cx",String(m)),y.setAttribute("cy",String(w)),f<h?t.requestId=requestAnimationFrame(()=>Rg(e)):(t.phase="sustain",Hg(e))}function Hg(e){if(!hn[e]||ZA||!ni)return;const t=hn[e];if(!t.adsr)return;const n=ni.calculateEnvelopePoints(t.adsr);if(n.length<4)return;const i=n[2],[r,A]=t.group.children;r.setAttribute("x1",String(i.x)),r.setAttribute("y1","0"),r.setAttribute("x2",String(i.x)),r.setAttribute("y2",String(ni.height)),A.setAttribute("cx",String(i.x)),A.setAttribute("cy",String(i.y)),t.requestId=requestAnimationFrame(()=>Hg(e))}function Ng(e){if(!hn[e]||ZA||!ni)return;const t=hn[e];if(!t.adsr)return;const{release:n}=t.adsr,i=ni.calculateEnvelopePoints(t.adsr);if(i.length<4)return;const r=i[2],A=i[3],a=et.now()-t.startTimestamp;t.elapsed=a;const l=Math.min(a,n),c=n>0?l/n:1,h=r.x+c*(A.x-r.x),f=r.y+c*(A.y-r.y),[m,w]=t.group.children;m.setAttribute("x1",String(h)),m.setAttribute("y1","0"),m.setAttribute("x2",String(h)),m.setAttribute("y2",String(ni.height)),w.setAttribute("cx",String(h)),w.setAttribute("cy",String(f)),l<n?t.requestId=requestAnimationFrame(()=>Ng(e)):(t.group.remove(),delete hn[e])}function PL(){ZA=!0;for(const e in hn){const t=hn[e];t&&t.requestId!==null&&(cancelAnimationFrame(t.requestId),t.requestId=null)}}function DL(){ZA=!1;for(const e in hn){const t=hn[e];t&&(t.startTimestamp=et.now()-t.elapsed,t.phase==="attack"?Rg(e):t.phase==="sustain"?Hg(e):t.phase==="release"&&Ng(e))}}function kL(){ZA=!1;for(const e in hn){const t=hn[e];t&&(t.requestId!==null&&cancelAnimationFrame(t.requestId),t.group.remove())}for(const e in hn)delete hn[e]}function LL(e){return ni=e,{trigger:UL,pause:PL,resume:DL,clearAll:kL}}const s_=2.5;class RL{constructor(){P(this,"ui");P(this,"currentColor");P(this,"attack");P(this,"decay");P(this,"sustain");P(this,"release");P(this,"width");P(this,"height");P(this,"reverbCanvas",null);P(this,"reverbCtx",null);P(this,"svgContainer");P(this,"gridLayer");P(this,"envelopeLayer");P(this,"nodeLayer");P(this,"playheadLayer");P(this,"playheadManager");var n;if(this.ui=_L.init(),!this.ui.container)throw x.error("AdsrComponent","ADSR container element not found",null,"adsr"),new Error("ADSR container element not found");this.currentColor=((n=d.state.selectedNote)==null?void 0:n.color)||"#4a90e2",this.attack=0,this.decay=0,this.sustain=0,this.release=0,this.width=0,this.height=0,this.createSVGLayers(),this.resize(),this.playheadManager=LL(this),jn.adsrComponent=this,TL(this),this.listenForStoreChanges(),this.initControls();const t=this.ui.container;t&&new ResizeObserver(()=>this.resize()).observe(t),this.updateFromStore(),x.info("ADSR Component","Initialized",null,"adsr")}resize(){if(this.ui.container){if(this.width=this.ui.container.clientWidth,this.height=this.ui.container.clientHeight,this.reverbCanvas){const t=window.devicePixelRatio||1;this.reverbCanvas.width=this.width*t,this.reverbCanvas.height=this.height*t,this.reverbCtx&&(this.reverbCtx.setTransform(1,0,0,1,0,0),this.reverbCtx.scale(t,t))}this.svgContainer&&this.svgContainer.setAttribute("viewBox",`0 0 ${this.width} ${this.height}`),this.render()}}updateFromStore(){const t=d.state.timbres[this.currentColor];if(!t)return;const{attack:n,decay:i,sustain:r,release:A}=t.adsr;this.attack=n,this.decay=i,this.sustain=r,this.release=A,this.render(),this.updateControls()}getCurrentMaxTime(){return s_*d.state.adsrTimeAxisScale}initControls(){const t=document.getElementById("adsr-time-scale"),n=document.getElementById("adsr-time-scale-value");t&&n&&(t.value=String(d.state.adsrTimeAxisScale),n.textContent=`${d.state.adsrTimeAxisScale}x`,t.addEventListener("input",i=>{const r=i.currentTarget;if(!r)return;const A=parseFloat(r.value);Number.isFinite(A)&&(d.setAdsrTimeAxisScale(A),n.textContent=`${A}x`)}))}listenForStoreChanges(){d.on("noteChanged",t=>{var i;const n=(i=t==null?void 0:t.newNote)==null?void 0:i.color;n&&n!==this.currentColor&&(this.currentColor=n,this.updateFromStore())}),d.on("timbreChanged",t=>{t===this.currentColor&&this.updateFromStore()}),d.on("tempoChanged",()=>this.render()),d.on("adsrTimeAxisScaleChanged",()=>{this.render(),this.updateControls()}),d.on("tremoloAmplitudeUpdate",t=>{const n=t==null?void 0:t.activeColors;n!=null&&n.includes(this.currentColor)&&this.render()}),d.on("playbackStateChanged",t=>{if(!t)return;const{isPlaying:n,isPaused:i}=t;n?i?this.playheadManager.pause():this.playheadManager.resume():this.playheadManager.clearAll()}),d.on("audioEffectChanged",t=>{if(!t)return;const{effectType:n,color:i}=t;i===this.currentColor&&(n==="delay"||n==="reverb")&&this.render()})}createSVGLayers(){this.ui.container&&(this.reverbCanvas=document.createElement("canvas"),this.reverbCanvas.className="adsr-reverb-canvas",this.reverbCanvas.style.position="absolute",this.reverbCanvas.style.top="0",this.reverbCanvas.style.left="0",this.reverbCanvas.style.width="100%",this.reverbCanvas.style.height="100%",this.reverbCanvas.style.pointerEvents="none",this.ui.container.appendChild(this.reverbCanvas),this.reverbCtx=this.reverbCanvas.getContext("2d"),this.svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgContainer.setAttribute("width","100%"),this.svgContainer.setAttribute("height","100%"),this.ui.container.appendChild(this.svgContainer),this.gridLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.gridLayer),this.envelopeLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.envelopeLayer),this.nodeLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.nodeLayer),this.playheadLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.playheadLayer))}calculateEnvelopePoints(t){var b,S;const{attack:n,decay:i,sustain:r,release:A}=t??{attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release};if(!this.width||!this.height)return[];const a=F=>F/this.getCurrentMaxTime()*this.width;let l=1;const c=window.animationEffectsManager;(b=c==null?void 0:c.shouldTremoloBeRunning)!=null&&b.call(c)&&(l=c.getADSRTremoloAmplitudeMultiplier(this.currentColor));const h=((S=window.waveformVisualizer)==null?void 0:S.calculatedAmplitude)??1,f=h*l;x.debug("AdsrComponent","[ADSR] Amplitude calculation",{originalAmplitude:h,tremoloMultiplier:l,normalizedAmplitude:f});const m={x:0,y:this.height},w={x:a(n),y:this.height*(1-f)},B={x:a(n+i),y:this.height*(1-Math.min(r*f,f))},y={x:a(n+i+A),y:this.height};return[m,w,B,y]}render(){if(!this.width||!this.height||!this.gridLayer||!this.envelopeLayer||!this.nodeLayer)return;const t={width:this.width,height:this.height},n=this.calculateEnvelopePoints(),i=this.getCurrentMaxTime();FL(this.gridLayer,t,i),IL(this.envelopeLayer,this.nodeLayer,n,t,this.currentColor,i,this.reverbCtx),ML(this.ui.parentContainer,this.currentColor)}updateControls(){var O,K;const{sustainThumb:t,sustainTrack:n,thumbA:i,thumbD:r,thumbR:A,multiSliderContainer:a}=this.ui;if(!t||!n||!i||!r||!A||!a)return;const l=d.state.timbres[this.currentColor];if(!l)return;let c=1;const h=window.animationEffectsManager;(O=h==null?void 0:h.shouldTremoloBeRunning)!=null&&O.call(h)&&(c=h.getADSRTremoloAmplitudeMultiplier(this.currentColor));const m=(((K=window.waveformVisualizer)==null?void 0:K.calculatedAmplitude)||1)*c,w=m*100;this.sustain>m&&(d.setADSR(this.currentColor,{...l.adsr,sustain:m}),this.sustain=m);const B=this.sustain*100;t.style.bottom=`${B}%`,n.style.setProperty("--sustain-progress",`${B}%`);const y=100-w;n.style.setProperty("--ineligible-height",`${y}%`);const b=this.getCurrentMaxTime(),S=this.attack/b*100,F=(this.attack+this.decay)/b*100,U=(this.attack+this.decay+this.release)/b*100;i.style.left=`${S}%`,r.style.left=`${F}%`,A.style.left=`${U}%`,a.style.setProperty("--adr-progress",`${U}%`);const D=z=>`${z.toFixed(3)}s`,H=z=>`${(z*100).toFixed(0)}%`;i.title=`Attack: ${D(this.attack)}`,r.title=`Decay: ${D(this.decay)}`,A.title=`Release: ${D(this.release)}`,t.title=`Sustain: ${H(this.sustain)}`;const Q=this.nodeLayer.querySelector("#attack-node > title");Q&&(Q.textContent=`Attack: ${D(this.attack)}`);const R=this.nodeLayer.querySelector("#decay-sustain-node > title");R&&(R.textContent=`Decay: ${D(this.decay)}
Sustain: ${H(this.sustain)}`);const V=this.nodeLayer.querySelector("#release-node > title");V&&(V.textContent=`Release: ${D(this.release)}`)}}function HL(){return document.getElementById("adsr-envelope")?new RL:null}function Nm(e,...t){}let Go,oc,nA,ac,Nl,Ol,ua,Om=!1,Vm=!1,Wm=!1,Ss;const bh=1,i_=31,r_=0,_h=2;function NL(){if(!Ss)return null;const e=d.state.timbres[Ss];return e?(e.filter?e.filter.enabled===void 0&&(e.filter.enabled=!0):e.filter={enabled:!0,blend:1,cutoff:16,resonance:0,type:"lowpass",mix:0},e.filter):null}function Sp(){const e=NL();if(!e)return;const{cutoff:t=16,blend:n=0,mix:i=0}=e;if(Go&&oc){const r=(_h-n)/(_h-r_);Go.style.left=`${r*100}%`,oc.style.setProperty("--progress",`${r*100}%`)}if(Ol&&ua){const r=(i||0)/100;Ol.style.bottom=`${r*100}%`,ua.style.setProperty("--blend-progress",`${r*100}%`)}if(nA&&ac){const r=(t-bh)/(i_-bh);nA.style.left=`${r*100}%`,nA.style.top="50%",nA.style.transform="translate(-50%, -50%)",ac.style.setProperty("--progress",`${r*100}%`)}Nl&&Ss&&Nl.style.setProperty("--c-accent",Ss)}function OL(e){if(!Om||!Ss||!ac)return;const t=ac.getBoundingClientRect(),n=e.clientX-t.left,i=t.width;let r=n/i;r=Math.max(0,Math.min(1,r));const A=r*(i_-bh)+bh;d.setFilterSettings(Ss,{cutoff:A})}function VL(e){if(!Vm||!Ss||!oc)return;const t=oc.getBoundingClientRect(),n=e.clientX-t.left,i=t.width;let r=n/i;r=Math.max(0,Math.min(1,r));const A=_h-r*(_h-r_);d.setFilterSettings(Ss,{blend:A})}function WL(e){if(!Wm||!Ss||!ua)return;const t=ua.getBoundingClientRect(),n=e.clientY-t.top,i=t.height;let r=1-n/i;r=Math.max(0,Math.min(1,r));const A=r*100;d.setFilterSettings(Ss,{mix:A})}function GL(){var e;if(Nl=document.querySelector(".filter-container"),Go=document.getElementById("thumb-b"),oc=document.getElementById("blend-slider-container"),nA=document.getElementById("thumb-c"),ac=document.getElementById("cutoff-slider-container"),!Nl||!Go||!nA){x.error("FilterControls","Missing required elements",{container:Nl,blendThumb:Go,cutoffThumb:nA},"filter");return}KL(),Go.addEventListener("pointerdown",t=>{t.preventDefault(),Vm=!0,document.body.style.cursor="ew-resize";const n=r=>{Nm("log","[BLEND SLIDER] Moving",{clientX:r.clientX}),VL(r)},i=()=>{Vm=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",i),d.recordState()};window.addEventListener("pointermove",n),window.addEventListener("pointerup",i)}),nA.addEventListener("pointerdown",t=>{t.preventDefault(),Om=!0,document.body.style.cursor="ew-resize";const n=r=>{Nm("log","[CUTOFF SLIDER] Moving",{clientX:r.clientX}),OL(r)},i=()=>{Om=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",i),d.recordState()};window.addEventListener("pointermove",n),window.addEventListener("pointerup",i)}),d.on("noteChanged",({newNote:t})=>{t.color&&t.color!==Ss&&(Ss=t.color,Sp())}),d.on("timbreChanged",t=>{t===Ss&&Sp()}),Ss=((e=d.state.selectedNote)==null?void 0:e.color)||"#4a90e2",Sp()}function KL(){if(ua=document.getElementById("vertical-blend-track"),Ol=document.getElementById("vertical-blend-thumb"),!ua||!Ol){x.error("FilterControls","Vertical blend slider elements not found",null,"filter");return}Ol.addEventListener("pointerdown",e=>{e.preventDefault(),Wm=!0,document.body.style.cursor="ns-resize";const t=i=>{Nm("log","[VERTICAL BLEND] Moving",{clientY:i.clientY}),WL(i)},n=()=>{Wm=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",n),d.recordState()};window.addEventListener("pointermove",t),window.addEventListener("pointerup",n)})}const xp=()=>window.synthEngine??null,Cy=()=>window.animationEffectsManager??null;x.moduleLoaded("DynamicWaveformVisualizer");class qL{constructor(){P(this,"canvas",null);P(this,"ctx",null);P(this,"currentColor",null);P(this,"isPlaybackActive",!1);P(this,"liveAnalysers",new Map);P(this,"liveWaveforms",new Map);P(this,"playbackAnimationId",null);P(this,"animationSpeed",100);P(this,"frameSkipCounter",0);P(this,"onWaveformUpdate")}initialize(t,n){var i;return this.canvas=t,this.ctx=n,this.currentColor=((i=d.state.selectedNote)==null?void 0:i.color)||"#4a90e2",this.setupEventListeners(),x.info("DynamicWaveformVisualizer","Initialized with canvas context",null,"waveform"),!0}setupEventListeners(){d.on("noteChanged",({newNote:t})=>{t!=null&&t.color&&t.color!==this.currentColor&&(this.currentColor=t.color)}),d.on("playbackStateChanged",({isPlaying:t,isPaused:n})=>{t&&!n?this.startLiveVisualization():this.stopLiveVisualization()}),d.on("spacebarPlayback",({color:t,isPlaying:n})=>{n&&t?this.startSingleNoteVisualization(t):this.stopLiveVisualization()}),d.on("tremoloAmplitudeUpdate",({activeColors:t})=>{this.isPlaybackActive&&(t!=null&&t.some(n=>this.liveWaveforms.has(n)))&&x.debug("DynamicWaveformVisualizer","Tremolo update received for active colors",t,"waveform")}),x.info("DynamicWaveformVisualizer","Event subscriptions established",null,"waveform")}setAnimationSpeed(t){this.animationSpeed=t,this.frameSkipCounter=0}startLiveVisualization(){this.isPlaybackActive||(this.isPlaybackActive=!0,this.setupLiveAnalysers(),this.updateContainerState(!0),this.animateLiveWaveforms(),x.debug("DynamicWaveformVisualizer","Started live visualization",null,"waveform"))}startSingleNoteVisualization(t){this.isPlaybackActive||(this.isPlaybackActive=!0,this.setupSingleAnalyser(t),this.updateContainerState(!0),this.animateLiveWaveforms(),x.debug("DynamicWaveformVisualizer",`Started single note visualization for ${t}`,null,"waveform"))}stopLiveVisualization(){this.isPlaybackActive=!1;const t=xp();this.liveAnalysers.forEach((n,i)=>{var r;(r=t==null?void 0:t.removeWaveformAnalyzer)==null||r.call(t,i)}),this.liveAnalysers.clear(),this.liveWaveforms.clear(),this.playbackAnimationId&&(cancelAnimationFrame(this.playbackAnimationId),this.playbackAnimationId=null),this.updateContainerState(!1),x.debug("DynamicWaveformVisualizer","Stopped live visualization",null,"waveform")}updateContainerState(t){var i;const n=(i=this.canvas)==null?void 0:i.parentElement;n&&(t?(n.classList.add("live-mode"),d.state.isPlaying&&!d.state.isPaused&&n.classList.add("pulsing")):n.classList.remove("live-mode","pulsing"))}setupLiveAnalysers(){const t=xp();if(!t){x.warn("DynamicWaveformVisualizer","SynthEngine not available for live analysis",null,"waveform");return}this.getActivePlayingColors().forEach(i=>{var A;const r=(A=t.createWaveformAnalyzer)==null?void 0:A.call(t,i);r&&(this.liveAnalysers.set(i,r),this.liveWaveforms.set(i,new Float32Array(1024)),x.debug("DynamicWaveformVisualizer",`Created analyser for ${i}`,null,"waveform"))})}setupSingleAnalyser(t){var r;const n=xp();if(!n)return;const i=(r=n.createWaveformAnalyzer)==null?void 0:r.call(n,t);i&&(this.liveAnalysers.set(t,i),this.liveWaveforms.set(t,new Float32Array(1024)),x.debug("DynamicWaveformVisualizer",`Created single analyser for ${t}`,null,"waveform"))}getActivePlayingColors(){const t=new Set,n=d.state.placedNotes;d.state.isPlaying&&n.forEach(r=>{!r.isDrum&&r.color&&t.add(r.color)}),t.size===0&&this.currentColor&&t.add(this.currentColor);const i=Array.from(t);return x.debug("DynamicWaveformVisualizer","Active playing colors detected",i,"waveform"),i}animateLiveWaveforms(){var n;if(!this.isPlaybackActive)return;this.frameSkipCounter++;const t=Math.max(1,Math.floor(100/Math.max(this.animationSpeed,1)));if(this.frameSkipCounter%t!==0){this.playbackAnimationId=requestAnimationFrame(()=>this.animateLiveWaveforms());return}this.liveAnalysers.forEach((i,r)=>{const A=i.getValue();this.liveWaveforms.set(r,A)}),(n=this.onWaveformUpdate)==null||n.call(this),this.playbackAnimationId=requestAnimationFrame(()=>this.animateLiveWaveforms())}drawLiveWaveforms(t,n,i){if(!this.ctx)return;const A=Array.from(this.liveWaveforms.keys());if(A.length===1){const a=A[0];if(!a)return;const l=this.liveWaveforms.get(a);this.drawSingleLiveWaveform(l,a,t,n,i)}else A.length>1&&A.forEach(a=>{if(!a)return;const l=this.liveWaveforms.get(a);this.drawLayeredLiveWaveform(l,a,t,n,i,A.length)})}drawSingleLiveWaveform(t,n,i,r,A){const a=this.ctx;if(!a||!t||t.length===0)return;const l=Cy();let c=A;if(l){const S=l.getTremoloAmplitudeMultiplier(n);c*=S}let h=0;const f=l==null?void 0:l.vibratoCanvasEffect,m=f==null?void 0:f.animations.get(n);f&&m&&f.shouldBeRunning()&&(h=Math.sin(m.phase)*m.amplitude*.4);let w=0;for(let S=0;S<t.length;S++){const F=t[S]??0;w=Math.max(w,Math.abs(F))}const B=w>1?1/w:1;a.strokeStyle=n,a.lineWidth=2,a.beginPath();const b=t.length/i*(1+h);for(let S=0;S<i;S++){const F=h*i*.3,U=S+F,D=Math.floor(U*b),H=Math.max(0,Math.min(t.length-1,D)),Q=(t[H]??0)*B,R=r-Q*c;S===0?a.moveTo(S,R):a.lineTo(S,R)}a.stroke(),x.debug("DynamicWaveformVisualizer",`Drew single live waveform for ${n} with tremolo and vibrato stretch`,{amplitudeRatio:c/A,vibratoStretch:h},"waveform")}drawLayeredLiveWaveform(t,n,i,r,A,a){const l=this.ctx;if(!l||!t||t.length===0)return;const c=Cy();let h=A;c&&(h*=c.getTremoloAmplitudeMultiplier(n));let f=0;const m=c==null?void 0:c.vibratoCanvasEffect,w=m==null?void 0:m.animations.get(n);m&&w&&m.shouldBeRunning()&&(f=Math.sin(w.phase)*w.amplitude*.4);let B=0;for(let U=0;U<t.length;U++){const D=t[U]??0;B=Math.max(B,Math.abs(D))}const y=B>1?1/B:1,b=Math.max(.4,1/a);l.strokeStyle=Vi(n,b*2),l.lineWidth=1.5,l.beginPath();const F=t.length/i*(1+f);for(let U=0;U<i;U++){const D=f*i*.3,H=U+D,Q=Math.floor(H*F),R=Math.max(0,Math.min(t.length-1,Q)),V=(t[R]??0)*y,O=r-V*h*.7;U===0?l.moveTo(U,O):l.lineTo(U,O)}l.stroke()}isLiveMode(){return this.isPlaybackActive}getLiveColors(){return Array.from(this.liveWaveforms.keys())}dispose(){this.stopLiveVisualization(),x.info("DynamicWaveformVisualizer","Disposed",null,"waveform")}}const $L=512,TA=360,Al=480,zL=()=>window.animationEffectsManager;x.moduleLoaded("StaticWaveformVisualizer");class XL{constructor(){P(this,"canvas",null);P(this,"ctx",null);P(this,"currentColor",null);P(this,"animationFrameId",null);P(this,"waveformData",new Float32Array($L));P(this,"isInitialized",!1);P(this,"isTransitioning",!1);P(this,"transitionStartTime",0);P(this,"transitionDuration",300);P(this,"fromWaveform",null);P(this,"toWaveform",null);P(this,"transitionAnimationId",null);P(this,"dynamicVisualizer",new qL);P(this,"animationSpeed",100);P(this,"frameSkipCounter",0);P(this,"resizeObserver",null);P(this,"calculatedAmplitude",0);x.info("StaticWaveformVisualizer","Initialized with dynamic visualizer integration",null,"waveform")}initialize(){var i,r;if(this.canvas=document.getElementById("static-waveform-canvas"),!this.canvas)return!1;const t=this.canvas.getContext("2d");if(!t)return!1;this.ctx=t,this.currentColor=((i=d.state.selectedNote)==null?void 0:i.color)||"#4a90e2";const n=this.canvas.parentElement;return n&&typeof ResizeObserver<"u"&&((r=this.resizeObserver)==null||r.disconnect(),this.resizeObserver=new ResizeObserver(()=>this.resize()),this.resizeObserver.observe(n)),this.resize(),this.setupEventListeners(),this.dynamicVisualizer.initialize(this.canvas,this.ctx),this.dynamicVisualizer.onWaveformUpdate=()=>this.draw(),this.generateWaveform(),this.isInitialized=!0,!0}resize(){if(!this.canvas||!this.ctx)return;const t=this.canvas.parentElement;if(!t)return;const{clientWidth:n,clientHeight:i}=t,r=this.canvas.width,A=this.canvas.height;if((n===0||i===0)&&this.canvas.width>0&&this.canvas.height>0)return;const l=Math.abs(n-r),c=Math.abs(i-A);(l>2||c>2)&&(this.canvas.width=n,this.canvas.height=i,this.draw())}setupEventListeners(){d.on("noteChanged",(n={})=>{var r;const i=(r=n.newNote)==null?void 0:r.color;i&&i!==this.currentColor&&(this.currentColor=i,this.generateWaveform())}),d.on("timbreChanged",n=>{n&&n===this.currentColor&&this.generateWaveform()}),d.on("waveformExtendedViewChanged",()=>{this.generateWaveform(),this.updateToggleButton()}),document.querySelectorAll(".tab-button").forEach(n=>{n.addEventListener("click",()=>{n.dataset.tab==="timbre"&&setTimeout(()=>this.resize(),100)})}),this.setupSpeedControls(),this.setupExtendToggle()}setupSpeedControls(){const t=Array.from(document.querySelectorAll(".waveform-speed-btn"));t.length!==0&&t.forEach(n=>{n.addEventListener("click",()=>{const i=n.dataset.speed,r=i?parseInt(i,10):NaN;Number.isFinite(r)&&(n.classList.contains("active")?(n.classList.remove("active"),this.setAnimationSpeed(100)):(t.forEach(A=>A.classList.remove("active")),n.classList.add("active"),this.setAnimationSpeed(r)))})})}setAnimationSpeed(t){Number.isFinite(t)&&(this.animationSpeed=t,this.frameSkipCounter=0,this.dynamicVisualizer.setAnimationSpeed(t))}setupExtendToggle(){const t=document.getElementById("waveform-extend-toggle");t instanceof HTMLElement&&(t.addEventListener("click",()=>{d.toggleWaveformExtendedView()}),this.updateToggleButton())}updateToggleButton(){const t=document.getElementById("waveform-extend-toggle");if(!(t instanceof HTMLElement))return;const n=d.state.waveformExtendedView;t.classList.toggle("extended",n),t.textContent=n?"480 View":"360 View",t.title=n?"Switch to 360 waveform view":"Switch to 480 waveform view (shows extra 120)"}generateWaveform(){if(this.isTransitioning||!this.currentColor)return;const t=d.state.timbres[this.currentColor];if(!(t!=null&&t.coeffs))return;const n=ph(this.currentColor),i=t.phases??new Float32Array(rA),r=this.waveformData.length;this.waveformData.fill(0);let A=0;for(let a=0;a<r;a++){const c=(d.state.waveformExtendedView?Al:TA)/TA,h=a/r*c*2*Math.PI;let f=0;for(let m=0;m<rA;m++){const w=n[m]??0;if(w<=.001)continue;const B=i[m]??0,y=m+1;f+=w*Math.sin(y*h+B)}this.waveformData[a]=f,A=Math.max(A,Math.abs(f))}if(this.calculatedAmplitude=Math.min(1,A),A>1){const a=1/A;for(let l=0;l<this.waveformData.length;l++){const c=this.waveformData[l]??0;this.waveformData[l]=c*a}}this.draw()}startPhaseTransition(t,n,i){!this.isInitialized||!this.currentColor||(this.isTransitioning&&this.transitionAnimationId&&cancelAnimationFrame(this.transitionAnimationId),this.fromWaveform=new Float32Array(this.waveformData),this.generateTargetWaveform(n),this.toWaveform=new Float32Array(this.waveformData),this.waveformData=this.fromWaveform,this.isTransitioning=!0,this.transitionStartTime=performance.now(),this.animateTransition())}generateTargetWaveform(t){if(!this.currentColor||!t)return;const n=d.state.timbres[this.currentColor];if(!(n!=null&&n.coeffs))return;const i=ph(this.currentColor),r=t instanceof Float32Array?t:new Float32Array(t),A=this.waveformData.length;this.waveformData.fill(0);let a=0;for(let l=0;l<A;l++){const h=(d.state.waveformExtendedView?Al:TA)/TA,f=l/A*h*2*Math.PI;let m=0;for(let w=0;w<rA;w++){const B=i[w]??0;if(B<=.001)continue;const y=r[w]??0,b=w+1;m+=B*Math.sin(b*f+y)}this.waveformData[l]=m,a=Math.max(a,Math.abs(m))}if(this.calculatedAmplitude=Math.min(1,a),a>1){const l=1/a;for(let c=0;c<this.waveformData.length;c++){const h=this.waveformData[c]??0;this.waveformData[c]=h*l}}}animateTransition(){const t=this.fromWaveform,n=this.toWaveform;if(!this.isTransitioning||!t||!n)return;const i=performance.now()-this.transitionStartTime,r=Math.min(i/this.transitionDuration,1),A=1-Math.pow(1-r,3);for(let a=0;a<this.waveformData.length;a++){const l=t[a]??0,c=n[a]??0;this.waveformData[a]=l+(c-l)*A}this.draw(),r>=1?(this.isTransitioning=!1,this.fromWaveform=null,this.toWaveform=null,this.transitionAnimationId=null):this.transitionAnimationId=requestAnimationFrame(()=>this.animateTransition())}normalizeWaveform(){let t=0;for(let n=0;n<this.waveformData.length;n++){const i=this.waveformData[n]??0;t=Math.max(t,Math.abs(i))}if(t>0){const n=.9/t;for(let i=0;i<this.waveformData.length;i++){const r=this.waveformData[i]??0;this.waveformData[i]=r*n}}}draw(){const t=this.ctx,n=this.canvas;if(!t||!n)return;const{width:i,height:r}=n,A=r/2,a=r/2;t.fillStyle="#ffffff",t.fillRect(0,0,i,r),this.drawGrid(i,r,A,a),this.dynamicVisualizer.isLiveMode()?this.dynamicVisualizer.drawLiveWaveforms(i,A,a):this.drawWaveform(i,A,a),i>200&&r>100&&this.drawLabels(i,r)}drawGrid(t,n,i,r){const A=this.ctx;if(!A)return;A.strokeStyle="#ced4da",A.lineWidth=1,A.setLineDash([2,2]),A.beginPath(),A.moveTo(0,i),A.lineTo(t,i),A.stroke();const a=d.state.waveformExtendedView?Al:TA;if((d.state.waveformExtendedView?[90,180,270,360,450]:[90,180,270]).forEach(m=>{const w=t/a*m;A.beginPath(),A.moveTo(w,0),A.lineTo(w,n),A.stroke()}),d.state.waveformExtendedView){const m=t/Al*TA;A.fillStyle="rgba(128, 128, 128, 0.15)",A.fillRect(m,0,t-m,n)}[.5].forEach(m=>{const w=i-r*m,B=i+r*m;A.beginPath(),A.moveTo(0,w),A.lineTo(t,w),A.moveTo(0,B),A.lineTo(t,B),A.stroke()}),A.setLineDash([]),A.strokeStyle="#999999",A.lineWidth=1;const h=i-r,f=i+r;A.beginPath(),A.moveTo(0,h),A.lineTo(t,h),A.stroke(),A.beginPath(),A.moveTo(0,f),A.lineTo(t,f),A.stroke()}drawWaveform(t,n,i){const r=this.ctx;if(!r||this.waveformData.length===0)return;const A=this.currentColor||"#4a90e2";r.strokeStyle=A,r.lineWidth=2,r.beginPath();const a=this.waveformData.length/t;for(let c=0;c<t;c++){const h=Math.floor(c*a),f=this.waveformData[h]||0,m=n-f*i;c===0?r.moveTo(c,m):r.lineTo(c,m)}r.stroke(),r.lineTo(t,n),r.lineTo(0,n),r.closePath();const l=r.createLinearGradient(0,n-i,0,n+i);l.addColorStop(0,Vi(A,.3)),l.addColorStop(.5,Vi(A,.1)),l.addColorStop(1,Vi(A,.3)),r.fillStyle=l,r.fill()}drawLabels(t,n){const i=this.ctx;if(!i)return;const r=d.state.waveformExtendedView,A=r?Al:TA,a=r?["0","90","180","270","360","450"]:["0","90","180","270","360"],l=r?[0,90,180,270,360,450]:[0,90,180,270,360];i.fillStyle="#666666",i.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',i.textAlign="center",a.forEach((c,h)=>{const f=l[h]??0,m=t/A*f+10;i.fillText(c,m,n/2+4)}),i.textAlign="left",i.fillText("+1.0",5,15),i.fillText("-1.0",5,n-8)}getNormalizedAmplitude(){return this.calculatedAmplitude||0}getADSRTremoloAmplitude(){const t=this.calculatedAmplitude||0,n=zL();if(this.currentColor&&(n!=null&&n.getADSRTremoloAmplitudeMultiplier)){const i=n.getADSRTremoloAmplitudeMultiplier(this.currentColor);return t*i}return t}startSingleNoteVisualization(t){this.dynamicVisualizer.startSingleNoteVisualization(t)}stopLiveVisualization(){this.dynamicVisualizer.stopLiveVisualization()}startLiveVisualization(){this.dynamicVisualizer.startLiveVisualization()}dispose(){var t;this.dynamicVisualizer.dispose(),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.transitionAnimationId&&(cancelAnimationFrame(this.transitionAnimationId),this.transitionAnimationId=null),(t=this.resizeObserver)==null||t.disconnect(),this.resizeObserver=null,this.isTransitioning=!1,this.fromWaveform=null,this.toWaveform=null,this.isInitialized=!1}}const A_=new XL;window.waveformVisualizer=A_;function YL(){return A_.initialize()}class Og{constructor(t){P(this,"effectName");P(this,"animations");P(this,"activeNoteAnimations");P(this,"ghostNoteAnimation");P(this,"activeSoundingNotes");P(this,"isPlaybackActive");P(this,"hasActiveInteraction");P(this,"hasDialInteraction");this.effectName=t,this.animations=new Map,this.activeNoteAnimations=new Map,this.ghostNoteAnimation=null,this.activeSoundingNotes=new Map,this.isPlaybackActive=!1,this.hasActiveInteraction=!1,this.hasDialInteraction=!1,x.info(`${t}AnimationEffect`,"Base initialized",null,"animation")}initBase(){d.on("visualEffectChanged",t=>{if(!t)return;const{effectType:n,color:i,effectParams:r}=t;n===this.effectName.toLowerCase()&&this.updateAnimationParameters(i,r)}),d.on("playbackStarted",()=>{this.isPlaybackActive=!0,this.requestAnimationStateUpdate()}),d.on("playbackStopped",()=>{this.isPlaybackActive=!1,this.activeNoteAnimations.clear(),this.activeSoundingNotes.clear(),this.requestAnimationStateUpdate()}),d.on("noteInteractionStart",t=>{t&&this.onNoteInteractionStart(t.noteId,t.color)}),d.on("noteInteractionEnd",t=>{const n=t==null?void 0:t.noteId;n&&this.onNoteInteractionEnd(n)}),d.on("ghostNoteUpdated",t=>{t&&this.onGhostNoteUpdated(t.color)}),d.on("ghostNoteCleared",()=>this.onGhostNoteCleared()),d.on("spacebarPlayback",t=>{t&&(this.isPlaybackActive=t.isPlaying,this.requestAnimationStateUpdate())}),d.on("noteAttack",t=>{t&&this.onNoteAttack(t.noteId,t.color)}),d.on("noteRelease",t=>{t&&this.onNoteRelease(t.noteId,t.color)}),d.on("effectDialInteractionStart",t=>{t&&t.effectType===this.effectName.toLowerCase()&&this.onDialInteractionStart(t.color)}),d.on("effectDialInteractionEnd",t=>{t&&t.effectType===this.effectName.toLowerCase()&&this.onDialInteractionEnd(t.color)}),x.info(`${this.effectName}AnimationEffect`,"Base event subscriptions established",null,"animation")}shouldAnimateColor(t){return this.animations.has(t)}shouldAnimateNote(t){if(!(t!=null&&t.color)||!this.shouldAnimateColor(t.color))return!1;if(this.hasDialInteraction&&this.activeNoteAnimations.has("dial-preview")){const n=this.activeNoteAnimations.get("dial-preview");if(n&&t.color===n)return!0}return!!(this.isPlaybackActive&&t.uuid&&this.activeSoundingNotes.has(t.uuid)||this.hasActiveInteraction&&t.uuid&&this.activeNoteAnimations.has(t.uuid)||!t.uuid&&this.ghostNoteAnimation&&this.ghostNoteAnimation.color===t.color&&this.isPlaybackActive)}shouldBeRunning(){const t=this.animations.size>0;return t?!!(this.isPlaybackActive||this.hasActiveInteraction||this.hasDialInteraction||this.ghostNoteAnimation!==null||t):!1}onNoteInteractionStart(t,n){this.shouldAnimateColor(n)&&(this.activeNoteAnimations.set(t,n),this.hasActiveInteraction=!0,x.debug(`${this.effectName}AnimationEffect`,`Started interaction animation for note ${t} (${n})`,null,"animation"),this.requestAnimationStateUpdate())}onNoteInteractionEnd(t){this.activeNoteAnimations.delete(t),this.hasActiveInteraction=this.activeNoteAnimations.size>0,x.debug(`${this.effectName}AnimationEffect`,`Ended interaction animation for note ${t}`,null,"animation"),this.requestAnimationStateUpdate()}onGhostNoteUpdated(t){this.shouldAnimateColor(t)?(this.ghostNoteAnimation={color:t,active:!0},x.debug(`${this.effectName}AnimationEffect`,`Ghost note animation updated for color ${t}`,null,"animation")):this.ghostNoteAnimation=null}onGhostNoteCleared(){this.ghostNoteAnimation=null,x.debug(`${this.effectName}AnimationEffect`,"Ghost note animation cleared",null,"animation")}onNoteAttack(t,n){this.shouldAnimateColor(n)&&(this.activeSoundingNotes.set(t,n),x.debug(`${this.effectName}AnimationEffect`,`Note attack: ${t} (${n}) added to active sounding notes`,null,"animation"),this.requestAnimationStateUpdate())}onNoteRelease(t,n){this.activeSoundingNotes.delete(t),x.debug(`${this.effectName}AnimationEffect`,`Note release: ${t} (${n}) removed from active sounding notes`,null,"animation"),this.requestAnimationStateUpdate()}onDialInteractionStart(t){this.shouldAnimateColor(t)&&(this.hasDialInteraction=!0,this.activeNoteAnimations.set("dial-preview",t),x.debug(`${this.effectName}AnimationEffect`,`Dial interaction started for ${t}`,null,"animation"),this.requestAnimationStateUpdate())}onDialInteractionEnd(t){this.hasDialInteraction=!1,this.activeNoteAnimations.delete("dial-preview"),x.debug(`${this.effectName}AnimationEffect`,`Dial interaction ended for ${t}`,null,"animation"),this.requestAnimationStateUpdate()}getActiveColors(){const t=new Set;for(const[,n]of this.activeSoundingNotes.entries())this.shouldAnimateColor(n)&&t.add(n);for(const[,n]of this.activeNoteAnimations.entries())this.shouldAnimateColor(n)&&t.add(n);return this.ghostNoteAnimation&&this.shouldAnimateColor(this.ghostNoteAnimation.color)&&t.add(this.ghostNoteAnimation.color),Array.from(t)}disposeBase(){this.animations.clear(),this.activeNoteAnimations.clear(),this.activeSoundingNotes.clear(),this.ghostNoteAnimation=null,x.info(`${this.effectName}AnimationEffect`,"Base disposed",null,"animation")}requestAnimationStateUpdate(){var t;(t=window.animationEffectsManager)==null||t.updateAnimationState()}}x.moduleLoaded("VibratoCanvasEffect");class jL extends Og{constructor(){super("Vibrato"),x.info("VibratoCanvasEffect","Initialized for canvas note positions",null,"animation")}init(){return this.initBase(),x.info("VibratoCanvasEffect","Ready for canvas animation",null,"animation"),!0}updateAnimationParameters(t,n){const{speed:i,span:r}=n;if(i===0||r===0)this.animations.delete(t),x.debug("VibratoCanvasEffect",`Disabled vibrato animation for ${t}`,null,"animation");else{const A=this.animations.get(t),a=i/100*16,l=r/100*.5,c={frequency:a,amplitude:l,phase:(A==null?void 0:A.phase)||0,lastUpdate:performance.now()};this.animations.set(t,c),x.debug("VibratoCanvasEffect",`Updated vibrato animation for ${t}`,{frequency:a,amplitude:l,preservedPhase:!!A},"animation")}}updateAnimationPhases(t){this.animations.forEach(n=>{const i=(t-n.lastUpdate)/1e3;n.phase+=n.frequency*i*2*Math.PI,n.lastUpdate=t,n.phase>4*Math.PI&&(n.phase-=4*Math.PI)})}getVibratoYOffset(t){if(!t)return 0;const n=this.animations.get(t);if(!n||window.animationEffectsManager&&!window.animationEffectsManager.shouldVibratoBeRunning())return 0;const i=Math.sin(n.phase),r=-i*n.amplitude;return x.debug("VibratoCanvasEffect","Visual vibrato",{sine:i.toFixed(3),offset:r.toFixed(3),phase:n.phase.toFixed(3)},"effects"),r}shouldBeRunning(){return this.animations.size>0?this.isPlaybackActive||this.hasActiveInteraction||this.hasDialInteraction||this.ghostNoteAnimation!==null&&this.isPlaybackActive:!1}shouldAnimateColor(t){const n=this.animations.get(t);return n?n.frequency>0&&n.amplitude>0:!1}dispose(){this.disposeBase(),x.info("VibratoCanvasEffect","Disposed",null,"animation")}}x.moduleLoaded("TremoloWaveformEffect");class JL extends Og{constructor(){super("Tremolo"),x.info("TremoloWaveformEffect","Initialized for waveform/ADSR amplitude",null,"animation")}init(){return this.initBase(),x.info("TremoloWaveformEffect","Ready for waveform/ADSR animation",null,"animation"),!0}updateAnimationParameters(t,n){var A,a;const{speed:i,span:r}=n;if(i===0||r===0)this.animations.delete(t),x.debug("TremoloWaveformEffect",`Disabled tremolo animation for ${t}`,null,"animation");else{const l=this.animations.get(t),c=i/100*16,h=r/100,f=(a=(A=window.Tone)==null?void 0:A.now)==null?void 0:a.call(A),m=typeof f=="number"?f*1e3:performance.now(),w={frequency:c,span:h,phase:(l==null?void 0:l.phase)||0,lastUpdate:m};this.animations.set(t,w),x.debug("TremoloWaveformEffect",`Updated tremolo animation for ${t}`,{frequency:c,span:h,preservedPhase:!!l},"animation")}}updateAnimationPhases(t){var A,a,l,c;let n=0;const i=(a=(A=window.Tone)==null?void 0:A.now)==null?void 0:a.call(A),r=typeof i=="number"?i*1e3:t;if(this.animations.forEach((h,f)=>{const m=(r-h.lastUpdate)/1e3,w=h.phase;h.phase+=h.frequency*m*2*Math.PI,h.lastUpdate=r,n++,Math.abs(h.phase-w)<.001&&x.warn("TremoloWaveformEffect",`Phase not advancing for ${f}`,{deltaSeconds:Number(m.toFixed(4)),frequency:h.frequency},"animation"),h.phase>4*Math.PI&&(h.phase-=4*Math.PI)}),n>0&&Math.random()<.05){const h=(l=window.Tone)!=null&&l.now?"Tone.js":"performance";x.debug("TremoloWaveformEffect","Timing sample",{hasTone:!!window.Tone,hasToneNow:!!((c=window.Tone)!=null&&c.now),toneTime:r,currentTime:t,timingSource:h},"animation")}}getTremoloAmplitudeMultiplier(t){var b,S,F;const n=this.animations.get(t);if(!n||window.animationEffectsManager&&!window.animationEffectsManager.shouldTremoloBeRunning())return 1;const i=((b=window.waveformVisualizer)==null?void 0:b.calculatedAmplitude)??1,r=Math.sin(n.phase),A=n.span,a=i,l=i*(1-A),c=(a+l)/2,h=(a-l)/2,m=(c+r*h)/i,w=(F=(S=window.Tone)==null?void 0:S.now)==null?void 0:F.call(S),y=(typeof w=="number"?w*1e3:performance.now())-n.lastUpdate;if(y>100&&n.span>0){const U=n.frequency*(y/1e3)*2*Math.PI;U>.1&&x.warn("TremoloWaveformEffect",`Phase stagnation detected for ${t}`,{phase:Number(n.phase.toFixed(3)),millisecondsSinceUpdate:Number(y.toFixed(1)),expectedAdvancement:Number(U.toFixed(3))},"animation")}return Math.max(0,Math.min(1,m))}getADSRTremoloAmplitudeMultiplier(t){return this.getTremoloAmplitudeMultiplier(t)}shouldAnimateColor(t){const n=this.animations.get(t);return n?n.frequency>0&&n.span>0:!1}dispose(){this.disposeBase(),x.info("TremoloWaveformEffect","Disposed",null,"animation")}}x.moduleLoaded("EnvelopeFillEffect");class ZL{constructor(){P(this,"activeFills");P(this,"instanceId");this.activeFills=new Map,this.instanceId=Math.random().toString(36).substring(7),x.info("EnvelopeFillEffect","Initialized",null,"animation")}init(){d.on("noteAttack",t=>{var A,a;const n=t==null?void 0:t.noteId,i=t==null?void 0:t.color;if(!n||!i)return;const r=(A=d.state.timbres)==null?void 0:A[i];if(!r){x.warn("EnvelopeFillEffect","No timbre found for color",{color:i},"effects");return}this.activeFills.set(n,{fillLevel:0,color:i,startTime:et.now(),adsr:r.adsr,phase:"attack"}),x.debug("EnvelopeFillEffect",`Started fill animation for note ${n}`,null,"animation"),(a=window.animationEffectsManager)==null||a.updateAnimationState()}),d.on("noteRelease",t=>{const n=t==null?void 0:t.noteId;if(!n)return;const i=this.activeFills.get(n);i?(i.phase="release",i.releaseStartTime=et.now(),i.releaseStartLevel=i.fillLevel,x.debug("EnvelopeFillEffect",`Started release phase for note ${n}`,null,"animation")):x.warn("EnvelopeFillEffect","No fill data found for release",{noteId:n},"effects")}),d.on("playbackStopped",()=>{var t;this.activeFills.clear(),(t=window.animationEffectsManager)==null||t.updateAnimationState(),d.emit("animationUpdate",{type:"envelopeFill",activeColors:[],hasEnvelopeFills:!1})}),x.info("EnvelopeFillEffect","Event subscriptions established",null,"animation")}updateAnimationPhases(t){var i;const n=et.now();for(const[r,A]of this.activeFills.entries()){const{adsr:a,startTime:l,phase:c,releaseStartTime:h,releaseStartLevel:f}=A,m=n-l;if(c==="attack"){const w=a.attack||.01;m<w?A.fillLevel=m/w:(A.phase="decay",A.decayStartTime=n)}else if(c==="decay"){const w=a.decay||.1,B=n-(A.decayStartTime??n),y=a.sustain??.5;if(B<w){const b=B/w;A.fillLevel=1-b*(1-y)}else A.phase="sustain",A.fillLevel=y}else if(c==="sustain"){const w=a.sustain??.5;A.fillLevel=w}else if(c==="release"){const w=a.release||.5,B=h?n-h:0,y=f??A.fillLevel;if(B<w){const b=B/w;A.fillLevel=y*(1-b)}else this.activeFills.delete(r),x.debug("EnvelopeFillEffect",`Completed fill animation for note ${r}`,null,"animation"),this.activeFills.size===0&&((i=window.animationEffectsManager)==null||i.updateAnimationState())}}}getFillLevel(t){if(!t.uuid)return 0;const n=this.activeFills.get(t.uuid);return n?n.fillLevel:0}shouldFillNote(t){return t.uuid?this.activeFills.has(t.uuid):!1}shouldBeRunning(){return this.activeFills.size>0}dispose(){this.activeFills.clear(),x.info("EnvelopeFillEffect","Disposed",null,"animation")}}x.moduleLoaded("DelayADSREffect");class tR extends Og{constructor(){super("Delay"),x.info("DelayADSREffect","Initialized for delay visualization (PLACEHOLDER)",null,"animation")}init(){return this.initBase(),x.info("DelayADSREffect","Ready for delay animation (PLACEHOLDER)",null,"animation"),!0}updateAnimationParameters(t,n){const{time:i,feedback:r}=n;if(i===0&&r===0)this.animations.delete(t),x.debug("DelayADSREffect",`Disabled delay animation for ${t}`,null,"animation");else{const A=i/100*500,a=r/100,l={delayTime:A,feedback:a,echoCount:Math.floor(a*5),lastTrigger:0,echoPhases:[],lastUpdate:performance.now()};this.animations.set(t,l),x.debug("DelayADSREffect",`Updated delay animation for ${t} (PLACEHOLDER)`,{delayTime:A,feedback:a},"animation")}}updateAnimationPhases(t){this.animations.forEach(n=>{n.lastUpdate=t})}getDelayEffects(t){const n=this.animations.get(t);if(!n)return[];const i=[];for(let r=0;r<n.echoCount;r++)i.push({delay:n.delayTime*(r+1),opacity:1-r*.3,scale:1-r*.1,active:!1});return i}triggerDelay(t,n){const i=this.animations.get(t);i&&(i.lastTrigger=n,x.debug("DelayADSREffect",`Triggered delay for ${t} (PLACEHOLDER)`,null,"animation"))}shouldBeRunning(){return this.animations.size>0?this.isPlaybackActive||this.hasActiveInteraction||this.ghostNoteAnimation!==null:!1}shouldAnimateColor(t){const n=this.animations.get(t);return n?n.delayTime>0||n.feedback>0:!1}dispose(){this.disposeBase(),x.info("DelayADSREffect","Disposed",null,"animation")}}x.moduleLoaded("AnimationEffectsManager");class eR{constructor(){P(this,"vibratoEffect");P(this,"tremoloEffect");P(this,"envelopeFillEffect");P(this,"delayEffect");P(this,"isRunning");P(this,"animationFrameId");P(this,"lastTime");P(this,"lastRenderTrigger");this.vibratoEffect=new jL,this.tremoloEffect=new JL,this.envelopeFillEffect=new ZL,this.delayEffect=new tR,this.isRunning=!1,this.animationFrameId=null,this.lastTime=0,this.lastRenderTrigger=0,x.info("AnimationEffectsManager","Initialized with single animation loop",null,"animation")}init(){return this.vibratoEffect.init(),this.tremoloEffect.init(),this.envelopeFillEffect.init(),this.delayEffect.init(),d.on("visualEffectChanged",t=>{const n=t==null?void 0:t.effectType;(n==="vibrato"||n==="tremolo")&&(setTimeout(()=>this.updateAnimationState(),0),n==="tremolo"&&setTimeout(()=>this.triggerTremoloAmplitudeUpdate(),0))}),d.on("audioEffectChanged",t=>{if(!t)return;const{effectType:n,color:i,effectParams:r}=t;!i||!r||n==="delay"&&this.delayEffect.updateAnimationParameters(i,r)}),x.info("AnimationEffectsManager","Event subscriptions established",null,"animation"),!0}animate(t){this.isRunning&&(this.lastTime=t,this.vibratoEffect.updateAnimationPhases(t),this.tremoloEffect.updateAnimationPhases(t),this.envelopeFillEffect.updateAnimationPhases(t),this.triggerVisualUpdates(t),this.animationFrameId=requestAnimationFrame(n=>this.animate(n)))}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationFrameId=requestAnimationFrame(t=>this.animate(t)),x.debug("AnimationEffectsManager","Single animation loop started",null,"animation"))}stop(){this.isRunning&&(this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.triggerFinalUpdates(),x.debug("AnimationEffectsManager","Animation loop stopped",null,"animation"))}shouldTremoloBeRunning(){if(!(this.tremoloEffect.animations.size>0))return!1;const n=this.tremoloEffect.activeSoundingNotes.size>0,i=this.tremoloEffect.hasDialInteraction;return n||i}shouldVibratoBeRunning(){return this.vibratoEffect.animations.size>0?this.vibratoEffect.isPlaybackActive||this.vibratoEffect.hasActiveInteraction||this.vibratoEffect.hasDialInteraction||this.vibratoEffect.ghostNoteAnimation!==null:!1}shouldEnvelopeFillBeRunning(){return this.envelopeFillEffect.shouldBeRunning()}updateAnimationState(){const t=this.shouldVibratoBeRunning(),n=this.shouldTremoloBeRunning(),i=this.shouldEnvelopeFillBeRunning(),r=t||n||i;r&&!this.isRunning?this.start():!r&&this.isRunning&&this.stop()}triggerVisualUpdates(t){if(!this.lastRenderTrigger||t-this.lastRenderTrigger>=16.67){this.lastRenderTrigger=t;const n=this.vibratoEffect.getActiveColors(),i=this.tremoloEffect.getActiveColors(),r=this.envelopeFillEffect.activeFills.size>0;(n.length>0||r)&&d.emit("animationUpdate",{type:n.length>0?"vibrato":"envelopeFill",activeColors:n,hasEnvelopeFills:r}),i.length>0&&d.emit("tremoloAmplitudeUpdate",{activeColors:i})}}triggerFinalUpdates(){const t=Array.from(this.vibratoEffect.animations.keys());t.length>0&&d.emit("animationUpdate",{type:"vibrato",activeColors:t});const n=Array.from(this.tremoloEffect.animations.keys());n.length>0&&d.emit("tremoloAmplitudeUpdate",{activeColors:n})}shouldAnimateNote(t){return this.vibratoEffect.shouldAnimateNote(t)}getVibratoYOffset(t){return this.vibratoEffect.getVibratoYOffset(t)}getTremoloAmplitudeMultiplier(t){return this.tremoloEffect.getTremoloAmplitudeMultiplier(t)}getADSRTremoloAmplitudeMultiplier(t){return this.tremoloEffect.getADSRTremoloAmplitudeMultiplier(t)}getFillLevel(t){return this.envelopeFillEffect.getFillLevel(t)}shouldFillNote(t){return this.envelopeFillEffect.shouldFillNote(t)}getDelayEffects(t){return this.delayEffect.getDelayEffects(t)}hasDelayEffect(t){return this.delayEffect.shouldAnimateColor(t)}triggerTremoloAmplitudeUpdate(){const t=this.tremoloEffect.getActiveColors();t.length>0&&d.emit("tremoloAmplitudeUpdate",{activeColors:t})}getAllActiveColors(){const t=this.vibratoEffect.getActiveColors(),n=this.tremoloEffect.getActiveColors();return[...new Set([...t,...n])]}dispose(){this.stop(),this.vibratoEffect.dispose(),this.tremoloEffect.dispose(),this.envelopeFillEffect.dispose(),this.delayEffect.dispose(),x.info("AnimationEffectsManager","Disposed",null,"animation")}}const by=new eR;x.moduleLoaded("VibratoAudioEffect");class nR{constructor(){P(this,"currentSettings",new Map);x.info("VibratoAudioEffect","Initialized",null,"audio")}init(){return x.info("VibratoAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,n){const{speed:i,span:r}=t;this.currentSettings.set(n,{speed:i,span:r}),x.debug("VibratoAudioEffect",`Updated parameters for ${n}`,{speed:i,span:r},"audio")}applyToVoice(t,n){if(!t||typeof t._setVibrato!="function")return;const i=this.currentSettings.get(n);if(!i){x.debug("VibratoAudioEffect",`No vibrato settings found for color ${n}`,null,"audio");return}try{t._setVibrato(i),t.vibratoApplied=!0,x.debug("VibratoAudioEffect",`Applied vibrato to voice for ${n}`,i,"audio")}catch(r){x.warn("VibratoAudioEffect",`Failed to apply vibrato to voice for ${n}`,r,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{speed:0,span:0}}getEffectInstance(){return null}createVibratoSettings(t,n){if(t===0||n===0)return null;const i=t/100*16,r=n/100*50;return{frequency:i,depth:r}}disableForColor(t){this.updateParameters({speed:0,span:0},t)}dispose(){this.currentSettings.clear(),x.info("VibratoAudioEffect","Disposed",null,"audio")}}x.moduleLoaded("TremoloAudioEffect");class sR{constructor(){P(this,"currentSettings",new Map);x.info("TremoloAudioEffect","Initialized",null,"audio")}init(){return x.info("TremoloAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,n){const{speed:i,span:r}=t;this.currentSettings.set(n,{speed:i,span:r}),x.debug("TremoloAudioEffect",`Updated parameters for ${n}`,{speed:i,span:r},"audio")}applyToVoice(t,n){if(!t||typeof t._setTremolo!="function")return;const i=this.currentSettings.get(n);if(!i){x.debug("TremoloAudioEffect",`No tremolo settings found for color ${n}`,null,"audio");return}try{t._setTremolo(i),t.tremoloApplied=!0,x.debug("TremoloAudioEffect",`Applied tremolo to voice for ${n}`,i,"audio")}catch(r){x.warn("TremoloAudioEffect",`Failed to apply tremolo to voice for ${n}`,r,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{speed:0,span:0}}getEffectInstance(){return null}createTremoloSettings(t,n){if(t===0||n===0)return null;const i=t/100*16,r=n/100;return{frequency:i,depth:r}}disableForColor(t){this.updateParameters({speed:0,span:0},t)}dispose(){this.currentSettings.clear(),x.info("TremoloAudioEffect","Disposed",null,"audio")}}x.moduleLoaded("DelayAudioEffect");const iR=()=>window.synthEngine;class rR{constructor(){P(this,"currentSettings",new Map);P(this,"delayInstances",new Map)}init(){return x.info("DelayAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,n){var l,c;const{time:i,feedback:r,wet:A}=t;this.currentSettings.set(n,{time:i,feedback:r,wet:A}),x.debug("DelayAudioEffect",`Updated parameters for ${n}`,{time:i,feedback:r,wet:A},"audio");let a=this.delayInstances.get(n);a?this.updateDelayInstance(a,i,r,A):(i>0||r>0)&&(a=this.createDelayInstance(i,r,A),a&&(this.delayInstances.set(n,a),x.debug("DelayAudioEffect",`Created new delay instance for ${n}`,{time:i,feedback:r,wet:A},"audio"),(c=(l=iR())==null?void 0:l.updateSynthForColor)==null||c.call(l,n)))}applyToVoice(t,n){var r,A,a;if(!t)return;const i=this.currentSettings.get(n);if(!(!i||i.time===0&&i.feedback===0))try{let l=this.delayInstances.get(n);if(!l){if(l=this.createDelayInstance(i.time,i.feedback,i.wet),!l)return;this.delayInstances.set(n,l)}if(typeof t.isDisposed=="function"&&t.isDisposed())return;try{(r=t.connect)==null||r.call(t,l)}catch{(a=(A=t.output)==null?void 0:A.connect)==null||a.call(A,l)}x.debug("DelayAudioEffect",`Applied delay to voice for ${n}`,i,"audio")}catch(l){x.warn("DelayAudioEffect",`Failed to apply delay to voice for ${n}`,l,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)??{time:0,feedback:0,wet:0}}getEffectInstance(t){const n=this.getCurrentSettings(t);return n.time>0&&n.wet>0?this.delayInstances.get(t)??null:null}createDelayInstance(t,n,i=30){if(t===0&&n===0)return null;const r=Math.max(.01,t/100*.5),A=Math.min(.95,n/100),a=i/100,l=new et.FeedbackDelay({delayTime:r,feedback:A,wet:a});return l._wetAmount=a,x.debug("DelayAudioEffect","Created delay instance",{delayTime:r,feedbackAmount:A,wetAmount:a},"audio"),l}updateDelayInstance(t,n,i,r=15){const A=Math.max(.01,n/100*.5),a=Math.min(.95,i/100),l=r/100;try{t.delayTime.value=A,t.feedback.value=a,t._crossFade&&(t._crossFade.fade.value=l),t._wetAmount=l,x.debug("DelayAudioEffect","Updated delay instance",{delayTime:A,feedbackAmount:a,wetAmount:l},"audio")}catch(c){x.warn("DelayAudioEffect","Failed to update delay instance",c,"audio")}}createDelaySettings(t,n,i=30){if(t===0&&n===0)return null;const r=Math.max(.01,t/100*.5),A=Math.min(.95,n/100),a=i/100;return{time:r,feedback:A,wet:a}}disableForColor(t){var i;this.updateParameters({time:0,feedback:0,wet:0},t);const n=this.delayInstances.get(t);if(n)try{(i=n._crossFade)==null||i.dispose(),n.dispose()}finally{this.delayInstances.delete(t)}}dispose(){this.delayInstances.forEach((t,n)=>{var i;try{(i=t._crossFade)==null||i.dispose(),t.dispose()}catch(r){x.warn("DelayAudioEffect",`Failed to dispose delay for ${n}`,r,"audio")}}),this.currentSettings.clear(),this.delayInstances.clear(),x.info("DelayAudioEffect","Disposed",null,"audio")}}x.moduleLoaded("AudioEffectsManager");const AR=()=>window.synthEngine;class oR{constructor(){P(this,"vibratoEffect",new nR);P(this,"tremoloEffect",new sR);P(this,"delayEffect",new rR)}init(){return this.vibratoEffect.init(),this.tremoloEffect.init(),this.delayEffect.init(),d.on("audioEffectChanged",t=>{if(!t)return;const{effectType:n,parameter:i,value:r,color:A,effectParams:a}=t;this.handleAudioEffectChange(n,i,r,A,a)}),x.info("AudioEffectsManager","Event subscriptions established",null,"audio"),!0}handleAudioEffectChange(t,n,i,r,A){switch(x.debug("AudioEffectsManager",`Processing audio effect: ${t}.${n} = ${i} for ${r}`,null,"audio"),t){case"vibrato":this.vibratoEffect.updateParameters(A,r);break;case"tremolo":this.tremoloEffect.updateParameters(A,r);break;case"delay":this.delayEffect.updateParameters(A,r);break;default:x.debug("AudioEffectsManager",`Effect type ${t} not handled by audio system`,null,"audio")}}getEffectHandler(t){switch(t){case"vibrato":return this.vibratoEffect;case"tremolo":return this.tremoloEffect;case"delay":return this.delayEffect;default:return null}}applySynthEffects(t,n,i){var a,l;const r=this.delayEffect.getEffectInstance(n);try{t.disconnect()}catch{}let A=t;if(r)try{A.connect(r),A=r}catch(c){x.error("AudioEffectsManager","Delay connection error",c,"audio")}try{A.connect(i);const c=(l=(a=AR())==null?void 0:a.getWaveformAnalyzer)==null?void 0:l.call(a,n);c&&t.connect(c)}catch(c){x.error("AudioEffectsManager","masterGain connection error",c,"audio")}}applyEffectsToVoice(t,n){this.vibratoEffect.applyToVoice(t,n),this.tremoloEffect.applyToVoice(t,n)}dispose(){this.vibratoEffect.dispose(),this.tremoloEffect.dispose(),this.delayEffect.dispose(),x.info("AudioEffectsManager","Disposed",null,"audio")}}const _y=new oR;x.moduleLoaded("EffectsCoordinator");class aR{constructor(){this.effectParameters=new Map,this.defaultEffects={vibrato:{speed:0,span:0,wet:100},tremolo:{speed:0,span:0,wet:100},delay:{time:0,feedback:0,wet:20}},x.info("EffectsCoordinator","Initialized as main coordinator",null,"effects")}init(){return Object.keys(d.state.timbres).forEach(t=>{this.initializeColorEffects(t)}),d.on("timbreCreated",({color:t})=>{this.initializeColorEffects(t)}),this.loadSavedValues(),x.info("EffectsCoordinator","Event subscriptions established",null,"effects"),!0}initializeColorEffects(t){if(!this.effectParameters.has(t)){const n={};Object.entries(this.defaultEffects).forEach(([r,A])=>{n[r]={...A}}),this.effectParameters.set(t,n);const i=d.state.timbres[t];i&&(i.vibrato&&(n.vibrato={...i.vibrato}),i.tremelo&&(n.tremolo={...i.tremelo})),x.debug("EffectsCoordinator",`Initialized effects for color ${t}`,n,"effects")}}updateParameter(t,n,i,r){if(!r){x.warn("EffectsCoordinator","Cannot update parameter: no color provided",{effectType:t,parameter:n,value:i},"effects");return}this.initializeColorEffects(r);const A=this.effectParameters.get(r);A[t]||(A[t]={...this.defaultEffects[t]}),A[t][n]=i,this.notifyAudioSystem(t,n,i,r,A[t]),this.notifyAnimationSystem(t,n,i,r,A[t]),this.updateTimbreState(t,A[t],r),this.saveValues()}notifyAudioSystem(t,n,i,r,A){d.emit("audioEffectChanged",{effectType:t,parameter:n,value:i,color:r,effectParams:{...A}}),x.debug("EffectsCoordinator",`Notified audio system: ${t}.${n} = ${i} for ${r}`,null,"effects")}notifyAnimationSystem(t,n,i,r,A){(t==="vibrato"||t==="tremolo")&&(d.emit("visualEffectChanged",{effectType:t,parameter:n,value:i,color:r,effectParams:{...A}}),x.debug("EffectsCoordinator",`Notified animation system: ${t}.${n} = ${i} for ${r}`,null,"effects"))}updateTimbreState(t,n,i){const r=d.state.timbres[i];if(!r)return;const a={vibrato:"vibrato",tremolo:"tremelo"}[t];a&&(r[a]||(r[a]={}),Object.assign(r[a],n),d.recordState())}getEffectParameters(t,n){const i=this.effectParameters.get(t);return i!=null&&i[n]?{...i[n]}:{...this.defaultEffects[n]}}getAllEffectParameters(t){const n=this.effectParameters.get(t);return n?{...n}:{...this.defaultEffects}}resetColorEffects(t){const n={};Object.entries(this.defaultEffects).forEach(([i,r])=>{n[i]={...r}}),this.effectParameters.set(t,n),Object.keys(n).forEach(i=>{Object.keys(n[i]).forEach(r=>{this.notifyAudioSystem(i,r,n[i][r],t,n[i]),this.notifyAnimationSystem(i,r,n[i][r],t,n[i])})}),x.info("EffectsCoordinator",`Reset all effects for color ${t}`,n,"effects")}saveValues(){const t={};Object.keys(d.state.timbres).forEach(n=>{const i=this.effectParameters.get(n);i&&(t[n]={vibrato:i.vibrato||{speed:0,span:0,wet:100},tremelo:i.tremolo||{speed:0,span:0,wet:100},delay:i.delay||{time:0,feedback:0,wet:20}})});try{localStorage.setItem("effectDialValues",JSON.stringify(t)),x.debug("EffectsCoordinator","Saved effect values to localStorage",null,"effects")}catch(n){x.warn("EffectsCoordinator","Failed to save effect values to localStorage",n,"effects")}}loadSavedValues(){try{const t=localStorage.getItem("effectDialValues");if(!t){x.debug("EffectsCoordinator","No saved effect values found",null,"effects");return}const n=JSON.parse(t);x.debug("EffectsCoordinator","Loading saved effect values",null,"effects"),Object.keys(n).forEach(i=>{const r=d.state.timbres[i],A=n[i];r&&A&&(A.vibrato&&Object.entries(A.vibrato).forEach(([a,l])=>{typeof l=="number"&&this.updateParameter("vibrato",a,l,i)}),A.tremelo&&Object.entries(A.tremelo).forEach(([a,l])=>{typeof l=="number"&&this.updateParameter("tremolo",a,l,i)}),A.delay&&Object.entries(A.delay).forEach(([a,l])=>{typeof l=="number"&&this.updateParameter("delay",a,l,i)}))}),x.info("EffectsCoordinator","Applied saved effect values",null,"effects"),window.synthEngine&&Object.keys(n).forEach(i=>{const r=n[i];r.delay&&(r.delay.time>0||r.delay.feedback>0)&&(window.synthEngine.updateSynthForColor(i),x.debug("EffectsCoordinator",`Re-applied effects to synth for ${i}`,null,"effects"))})}catch(t){x.warn("EffectsCoordinator","Failed to load saved effect values",t,"effects")}}dispose(){this.effectParameters.clear(),x.info("EffectsCoordinator","Disposed",null,"effects")}}const qr=new aR;class lR{constructor(){P(this,"currentEffect",null);P(this,"effectControlsContainer",null);P(this,"effectButtons",[]);P(this,"dials",[]);P(this,"currentColor",null);P(this,"isDialInteractionActive",!1);P(this,"lastPreviewAt",{});P(this,"previewThrottleMs",180);P(this,"previewDurationMs",220);P(this,"previewPitch","C4");P(this,"holdPreviews",{});P(this,"effectConfigs",{delay:{name:"Delay",controls:{time:{label:"Time",min:0,max:100,default:0,unit:"%"},feedback:{label:"Echoes",min:0,max:95,default:0,unit:"%"},wet:{label:"Mix",min:0,max:100,default:15,unit:"%"}}},vibrato:{name:"Vibrato",controls:{speed:{label:"Speed",min:0,max:100,default:0,unit:"%"},span:{label:"Span",min:0,max:100,default:0,unit:"%"}}},tremolo:{name:"Tremolo",controls:{speed:{label:"Speed",min:0,max:100,default:0,unit:"%"},span:{label:"Span",min:0,max:100,default:0,unit:"%"}}}})}init(){return x.initStart("Effects Controller"),this.effectControlsContainer=document.getElementById("effect-controls"),this.effectButtons=document.querySelectorAll(".effect-button[data-effect]"),this.effectButtons.length>0&&this.setupEventListeners(),this.initializeSelectedColorTracking(),this.setupGlobalMouseUpHandler(),x.initSuccess("Effects Controller"),!0}setupGlobalMouseUpHandler(){document.addEventListener("mouseup",()=>{this.isDialInteractionActive&&this.onDialInteractionEnd(this.currentEffect)})}setupEventListeners(){this.effectButtons.forEach(t=>{t.addEventListener("click",n=>{const r=n.currentTarget.dataset.effect;r&&this.selectEffect(r)})})}selectEffect(t){if(x.debug("Effects",`Selecting effect: ${t}`,null,"ui"),!this.effectConfigs[t]){x.info("Effects",`Effect ${t} not configured`,null,"ui");return}if(this.effectButtons.forEach(n=>{n.classList.remove("active"),n.dataset.effect===t&&n.classList.add("active")}),this.currentEffect===t){this.currentEffect=null,this.hideEffectControls();return}this.currentEffect=t,this.showEffectControls(t)}showEffectControls(t){const n=this.effectConfigs[t];if(!n||!this.effectControlsContainer){x.warn("Effects",`No configuration found for effect: ${t}`,null,"ui");return}this.clearControls(),this.effectControlsContainer.innerHTML='<div class="effect-controls"></div>';const i=this.effectControlsContainer.querySelector(".effect-controls");i&&Object.entries(n.controls).forEach(([r,A])=>{var y;const a=this.currentColor?(y=qr.getEffectParameters)==null?void 0:y.call(qr,this.currentColor,t):null,l=(a==null?void 0:a[r])??A.default??0,c=document.createElement("div");c.className="effect-slider-group",c.style.cssText="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;",i.appendChild(c);const h=document.createElement("label");h.className="effect-slider-label",h.textContent=A.label,h.style.cssText="display: block; margin-bottom: 5px; font-weight: bold; color: #333;",c.appendChild(h);const f=document.createElement("input");f.type="range",f.min=`${A.min}`,f.max=`${A.max}`,f.value=`${l}`,f.className="effect-slider",f.style.cssText="width: 100%; margin: 5px 0;",c.appendChild(f);const m=document.createElement("div");m.className="effect-slider-value";const w=A.unit?`${Math.round(l)}${A.unit}`:Math.round(l);m.textContent=`${w}`,m.style.cssText="text-align: center; font-size: 12px; color: #666;",c.appendChild(m),this.dials.push({dial:{element:f,value:l,destroy:()=>{}},control:r,effectType:t,valueDisplay:m,controlConfig:A});const B=b=>{const S=b.target;if(!S)return;const F=parseFloat(S.value),U=A.unit?`${Math.round(F)}${A.unit}`:Math.round(F);m.textContent=`${U}`,x.debug("Effects",`${t} ${r}: ${F}`,null,"audio"),this.onEffectParameterChange(t,r,F)};f.addEventListener("input",B),f.addEventListener("change",B),f.addEventListener("mousedown",()=>this.onDialInteractionStart(t)),f.addEventListener("mouseup",()=>this.onDialInteractionEnd(t)),f.addEventListener("mouseleave",b=>{(b.buttons&1)===1&&this.onDialInteractionEnd(t)})})}hideEffectControls(){this.clearControls(),this.currentEffect=null}clearControls(){this.dials.forEach(t=>t.dial.destroy()),this.dials=[],this.effectControlsContainer&&(this.effectControlsContainer.innerHTML="")}onEffectParameterChange(t,n,i){var A;const r=this.currentColor||((A=d.state.selectedNote)==null?void 0:A.color);r&&qr.updateParameter(t,n,i,r)}updateEffect(t,n){var r;const i=this.currentColor||((r=d.state.selectedNote)==null?void 0:r.color);i&&Object.entries(n).forEach(([A,a])=>{typeof a=="number"&&qr.updateParameter(t,A,a,i)})}getEffectState(t){var i;const n=this.currentColor||((i=d.state.selectedNote)==null?void 0:i.color);return n?qr.getEffectParameters(n,t)||{}:{}}getActiveColor(){var t;return this.currentColor||((t=d.state.selectedNote)==null?void 0:t.color)||null}getPreviewNotes(){var a;const t=this.getActiveColor();if(!t)return null;const n=d.state.placedNotes.slice().reverse().find(l=>!l.isDrum),i=n?((a=d.state.fullRowData[n.row])==null?void 0:a.toneNote)||this.previewPitch:this.previewPitch,r=d.state.selectedTool;let A=[i];return r==="chord"&&Array.isArray(d.state.activeChordIntervals)&&(A=d.state.activeChordIntervals.map(c=>_l(zo(i,c)))),{pitches:A,root:i,color:t}}previewEffect(t){var c;const n=this.getActiveColor();if(!n)return;const i=Date.now(),r=this.lastPreviewAt[t]??0;if(i-r<this.previewThrottleMs)return;this.lastPreviewAt[t]=i;const{isPlaying:A,isPaused:a}=d.state;if(A&&!a)return;const l=`effect-preview-${t}`;(c=d.emit)==null||c.call(d,"noteAttack",{noteId:l,color:n});try{ye.triggerAttack(this.previewPitch,n),setTimeout(()=>ye.triggerRelease(this.previewPitch,n),this.previewDurationMs)}catch(h){x.warn("Effects","Preview trigger failed",{err:h},"audio")}finally{setTimeout(()=>{var h;return(h=d.emit)==null?void 0:h.call(d,"noteRelease",{noteId:l,color:n})},this.previewDurationMs)}}startHoldPreview(t){var w;if(this.holdPreviews[t])return;const n=this.getPreviewNotes();if(!n)return;const{pitches:i,root:r,color:A}=n,a=`effect-hold-${t}-${Date.now()}`;this.holdPreviews[t]={pitches:i,root:r,color:A,noteId:a};const{isPlaying:l,isPaused:c}=d.state;if(l&&!c)return;i.forEach(B=>ye.triggerAttack(B,A));const h=d.state.fullRowData.find(B=>B.toneNote===r),f=h?h.hex:"#888888",m=d.state.timbres[A];m&&((w=jn.adsrComponent)==null||w.playheadManager.trigger(a,"attack",f,m.adsr)),d.emit("spacebarPlayback",{note:r,color:A,isPlaying:!0}),d.emit("noteAttack",{noteId:a,color:A})}stopHoldPreview(t){var f;const n=this.holdPreviews[t];if(!n)return;delete this.holdPreviews[t];const{pitches:i,root:r,color:A,noteId:a}=n;i.forEach(m=>ye.triggerRelease(m,A));const l=d.state.fullRowData.find(m=>m.toneNote===r),c=l?l.hex:"#888888",h=d.state.timbres[A];h&&((f=jn.adsrComponent)==null||f.playheadManager.trigger(a,"release",c,h.adsr)),d.emit("spacebarPlayback",{note:r,color:A,isPlaying:!1}),d.emit("noteRelease",{noteId:a,color:A})}initializeSelectedColorTracking(){var t;d.on("noteChanged",({newNote:n})=>{this.currentColor=n.color||null,this.currentColor&&this.currentEffect&&this.showEffectControls(this.currentEffect)}),this.currentColor=((t=d.state.selectedNote)==null?void 0:t.color)||null}onDialInteractionStart(t){if(this.isDialInteractionActive=!0,t){x.debug("Effects",`Dial interaction start for ${t}`,null,"ui");const n=this.getActiveColor();n&&d.emit("effectDialInteractionStart",{effectType:t,color:n}),this.startHoldPreview(t)}}onDialInteractionEnd(t){if(this.isDialInteractionActive=!1,t){x.debug("Effects",`Dial interaction end for ${t}`,null,"ui");const n=this.getActiveColor();n&&d.emit("effectDialInteractionEnd",{effectType:t,color:n}),this.stopHoldPreview(t)}}}const $r=new lR;class cR{constructor(){P(this,"listeners",new Map)}on(t,n){const i=this.listeners.get(t)||[];i.push(n),this.listeners.set(t,i)}off(t,n){const i=this.listeners.get(t);if(!i)return;const r=i.indexOf(n);r>=0&&i.splice(r,1)}emit(t,n){const i=this.listeners.get(t);i&&i.slice().forEach(r=>r(n))}}class o_{constructor(t,n={}){P(this,"_root");P(this,"_svgWrapper");P(this,"_bg");P(this,"_gridFill");P(this,"_gridPatternRect");P(this,"_dial");P(this,"_crosshairV");P(this,"_crosshairH");P(this,"_label");P(this,"_em",new cR);P(this,"_patternId");P(this,"_size");P(this,"_mode");P(this,"_minX");P(this,"_maxX");P(this,"_stepX");P(this,"_minY");P(this,"_maxY");P(this,"_stepY");P(this,"_reverseX");P(this,"_x");P(this,"_y");P(this,"_normX");P(this,"_normY");P(this,"_dragging",!1);P(this,"colors",{accent:"#4a90e2",fill:"#1f1f1f",stroke:"#555",grid:"#333",text:"#fff"});if(this._root=typeof t=="string"?document.querySelector(t):t,!this._root)throw new Error("Position: target not found");const{size:i=[200,200],mode:r="absolute",x:A=.5,minX:a=0,maxX:l=1,stepX:c=0,y:h=.5,minY:f=0,maxY:m=1,stepY:w=0,reverseX:B=!1,colors:y}=n;this._patternId=`pos-grid-${Math.random().toString(36).slice(2,8)}`;try{const F=getComputedStyle(document.documentElement),U=F.getPropertyValue("--c-surface").trim(),D=F.getPropertyValue("--c-border").trim(),H=F.getPropertyValue("--c-border-strong").trim(),Q=F.getPropertyValue("--c-text").trim();this.colors={...this.colors,fill:U||this.colors.fill,stroke:D||this.colors.stroke,grid:H||this.colors.grid,text:Q||this.colors.text}}catch{}this._size=i,this._mode=r,this._minX=a,this._maxX=l,this._stepX=c,this._minY=f,this._maxY=m,this._stepY=w,this._reverseX=B,y&&(this.colors={...this.colors,...y}),this._x=A,this._y=h,this._normX=0,this._normY=0,this._svgWrapper=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svgWrapper.setAttribute("width",`${i[0]}`),this._svgWrapper.setAttribute("height",`${i[1]}`),this._svgWrapper.setAttribute("viewBox",`0 0 ${i[0]} ${i[1]}`),this._svgWrapper.style.touchAction="none";const b=document.createElementNS("http://www.w3.org/2000/svg","defs"),S=document.createElementNS("http://www.w3.org/2000/svg","pattern");S.setAttribute("id",this._patternId),S.setAttribute("width","20"),S.setAttribute("height","20"),S.setAttribute("patternUnits","userSpaceOnUse"),this._gridPatternRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this._gridPatternRect.setAttribute("width","20"),this._gridPatternRect.setAttribute("height","20"),this._gridPatternRect.setAttribute("fill","none"),this._gridPatternRect.setAttribute("stroke",this.colors.grid),this._gridPatternRect.setAttribute("stroke-width","1"),S.appendChild(this._gridPatternRect),b.appendChild(S),this._svgWrapper.appendChild(b),this._bg=document.createElementNS("http://www.w3.org/2000/svg","rect"),this._bg.setAttribute("x","0"),this._bg.setAttribute("y","0"),this._bg.setAttribute("width",`${i[0]}`),this._bg.setAttribute("height",`${i[1]}`),this._bg.setAttribute("fill",this.colors.fill),this._bg.setAttribute("stroke",this.colors.stroke),this._svgWrapper.appendChild(this._bg),this._gridFill=document.createElementNS("http://www.w3.org/2000/svg","rect"),this._gridFill.setAttribute("x","0"),this._gridFill.setAttribute("y","0"),this._gridFill.setAttribute("width",`${i[0]}`),this._gridFill.setAttribute("height",`${i[1]}`),this._gridFill.setAttribute("fill",`url(#${this._patternId})`),this._gridFill.setAttribute("opacity","0.2"),this._svgWrapper.appendChild(this._gridFill),this._crosshairV=document.createElementNS("http://www.w3.org/2000/svg","line"),this._crosshairH=document.createElementNS("http://www.w3.org/2000/svg","line"),[this._crosshairV,this._crosshairH].forEach(F=>{F.setAttribute("stroke",this.colors.grid),F.setAttribute("stroke-width","1"),F.setAttribute("opacity","0.6"),this._svgWrapper.appendChild(F)}),this._dial=document.createElementNS("http://www.w3.org/2000/svg","circle"),this._dial.setAttribute("r","10"),this._dial.setAttribute("fill",this.colors.accent),this._dial.setAttribute("stroke","#fff"),this._dial.setAttribute("stroke-width","2"),this._svgWrapper.appendChild(this._dial),this._label=document.createElementNS("http://www.w3.org/2000/svg","text"),this._label.setAttribute("x","8"),this._label.setAttribute("y",`${i[1]-8}`),this._label.setAttribute("fill",this.colors.text),this._label.setAttribute("font-size","12"),this._label.setAttribute("font-family","monospace"),this._label.setAttribute("opacity","0"),this._label.textContent="",this._svgWrapper.appendChild(this._label),this._root.innerHTML="",this._root.appendChild(this._svgWrapper),this._bind(),this.setColors(),this._updateFromValues()}debugLog(...t){}on(t,n){return this._em.on(t,n),()=>this._em.off(t,n)}get value(){return{x:this._x,y:this._y}}get normalized(){return{x:this._normX,y:this._normY}}set x(t){this._x=this._clamp(this._maybeStep(t,this._minX,this._maxX,this._stepX),this._minX,this._maxX),this._updateFromValues()}get x(){return this._x}set y(t){this._y=this._clamp(this._maybeStep(t,this._minY,this._maxY,this._stepY),this._minY,this._maxY),this._updateFromValues()}get y(){return this._y}set minX(t){this._minX=t,this._updateFromValues()}set maxX(t){this._maxX=t,this._updateFromValues()}set minY(t){this._minY=t,this._updateFromValues()}set maxY(t){this._maxY=t,this._updateFromValues()}set stepX(t){this._stepX=t}set stepY(t){this._stepY=t}resize(t,n){this._size=[t,n],this._svgWrapper.setAttribute("width",`${t}`),this._svgWrapper.setAttribute("height",`${n}`),this._svgWrapper.setAttribute("viewBox",`0 0 ${t} ${n}`),this._label.setAttribute("y",`${n-8}`),this._updateFromValues()}destroy(){this._root.innerHTML=""}setColors(t={}){this.colors={...this.colors,...t},this._bg.setAttribute("fill",this.colors.fill),this._bg.setAttribute("stroke",this.colors.stroke),this._gridPatternRect.setAttribute("stroke",this.colors.grid),this._gridFill.setAttribute("fill",`url(#${this._patternId})`),this._crosshairV.setAttribute("stroke",this.colors.grid),this._crosshairH.setAttribute("stroke",this.colors.grid),this._dial.setAttribute("fill",this.colors.accent),this._label.setAttribute("fill",this.colors.text)}_updateFromValues(){if(this._x===this._minX&&this._y===this._minY)this.debugLog("At origin (off state)",{x:this._x,y:this._y});else{const i=this._x,r=this._y;if(this._x===this._minX){const A=this._stepX>0?this._stepX:Math.max((this._maxX-this._minX)/100,.01);this._x=this._minX+A}if(this._y===this._minY){const A=this._stepY>0?this._stepY:Math.max((this._maxY-this._minY)/100,.01);this._y=this._minY+A}this.debugLog("Adjusted single-axis zero",{from:{x:i,y:r},to:{x:this._x,y:this._y}})}const t=(this._x-this._minX)/(this._maxX-this._minX||1),n=(this._y-this._minY)/(this._maxY-this._minY||1);this._normX=this._clamp(t,0,1),this._normY=this._clamp(n,0,1),this._updateGraphics(),this._em.emit("change",{x:this._x,y:this._y})}_updateGraphics(){const[t,n]=this._size,i=this._reverseX?(1-this._normX)*t:this._normX*t,r=this._mode==="absolute"?this._normY*n:(1-this._normY)*n;this._dial.setAttribute("cx",`${i}`),this._dial.setAttribute("cy",`${r}`),this._crosshairV.setAttribute("x1",`${i}`),this._crosshairV.setAttribute("x2",`${i}`),this._crosshairV.setAttribute("y1","0"),this._crosshairV.setAttribute("y2",`${n}`),this._crosshairH.setAttribute("x1","0"),this._crosshairH.setAttribute("x2",`${t}`),this._crosshairH.setAttribute("y1",`${r}`),this._crosshairH.setAttribute("y2",`${r}`),this._label.textContent=`x:${this._x.toFixed(3)} y:${this._y.toFixed(3)}`}_bind(){const t=r=>{var A,a;this._dragging=!0,this._handlePointer(r),(a=(A=r.target).setPointerCapture)==null||a.call(A,r.pointerId)},n=r=>{this._dragging&&this._handlePointer(r)},i=r=>{var A,a;this._dragging=!1,(a=(A=r.target).releasePointerCapture)==null||a.call(A,r.pointerId)};this._svgWrapper.addEventListener("pointerdown",t),this._svgWrapper.addEventListener("pointermove",n),this._svgWrapper.addEventListener("pointerup",i),this._svgWrapper.addEventListener("pointercancel",i)}_handlePointer(t){const n=this._svgWrapper.getBoundingClientRect(),i=(t.clientX-n.left)/n.width,r=this._reverseX?1-i:i,A=(t.clientY-n.top)/n.height;this._normX=this._clamp(r,0,1);const a=this._mode==="relative"?1-A:A;if(this._normY=this._clamp(a,0,1),this._x=this._minX+this._normX*(this._maxX-this._minX),this._y=this._minY+this._normY*(this._maxY-this._minY),this.debugLog("Pointer move",{raw:{nx:r,ny:A},norm:{x:this._normX,y:this._normY},value:{x:this._x,y:this._y},mode:this._mode}),this._stepX>0){const l=this._maybeStep(this._x,this._minX,this._maxX,this._stepX);this._x=l}if(this._stepY>0){const l=this._maybeStep(this._y,this._minY,this._maxY,this._stepY);this._y=l}if(!(this._x===this._minX&&this._y===this._minY)){if(this._x===this._minX){const l=this._stepX>0?this._stepX:Math.max((this._maxX-this._minX)/100,.01);this._x=this._minX+l}if(this._y===this._minY){const l=this._stepY>0?this._stepY:Math.max((this._maxY-this._minY)/100,.01);this._y=this._minY+l}}this._normX=this._clamp((this._x-this._minX)/(this._maxX-this._minX||1),0,1),this._normY=this._clamp((this._y-this._minY)/(this._maxY-this._minY||1),0,1),this._updateGraphics(),this._em.emit("change",{x:this._x,y:this._y})}_maybeStep(t,n,i,r){if(r<=0)return t;const A=t-n,a=Math.round(A/r),l=n+a*r;return this._clamp(l,n,i)}_clamp(t,n,i){return Math.max(n,Math.min(i,t))}}P(o_,"DEBUG",!1);x.moduleLoaded("CartesianSliderController");class uR{constructor(){P(this,"sliders",{});P(this,"resizeObservers",[]);P(this,"effectConfigs");P(this,"isDragging",{});this.effectConfigs={delay:{containerId:"delay-position",xParam:"time",yParam:"feedback",xRange:{min:0,max:100,step:1},yRange:{min:0,max:95,step:1},backgroundOpacity:.2},vibrato:{containerId:"vibrato-position",xParam:"speed",yParam:"span",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1},backgroundOpacity:.5},tremolo:{containerId:"tremolo-position",xParam:"speed",yParam:"span",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1},backgroundOpacity:.5}},x.info("CartesianSliderController","Initialized",null,"ui")}init(){return x.initStart("Cartesian Slider Controller"),Object.entries(this.effectConfigs).forEach(([t,n])=>{this.createSliderComponent(t,n)}),this.initializeColorTracking(),x.initSuccess("Cartesian Slider Controller"),!0}createSliderComponent(t,n){const i=document.getElementById(n.containerId);if(!i){x.warn("CartesianSliderController",`Container not found for ${t}`,{containerId:n.containerId},"ui");return}try{const[r,A]=this.getSliderComponentSize(i),a=new o_(i,{size:[r,A],mode:"relative",x:n.xRange.min,minX:n.xRange.min,maxX:n.xRange.max,stepX:n.xRange.step,y:n.yRange.min,minY:n.yRange.min,maxY:n.yRange.max,stepY:n.yRange.step});this.sliders[t]=a,this.observeSliderResize(i,a,r,A),a.on("change",({x:h,y:f})=>{this.onSliderChange(t,n.xParam,h,n.yParam,f)});const l=()=>{this.isDragging[t]=!0,this.onSliderInteractionStart(t),$r.startHoldPreview(t)},c=()=>{this.isDragging[t]&&(this.isDragging[t]=!1,this.onSliderInteractionEnd(t),$r.stopHoldPreview(t))};i.addEventListener("pointerdown",l),["pointerup","pointerleave","pointercancel"].forEach(h=>{i.addEventListener(h,c)}),this.loadInitialValues(t,n,a),x.debug("CartesianSliderController",`Created slider component for ${t}`,null,"ui")}catch(r){x.error("CartesianSliderController",`Failed to create slider component for ${t}`,r,"ui")}}getSliderComponentSize(t){const i=t.getBoundingClientRect();let r=(i==null?void 0:i.width)||t.clientWidth||t.offsetWidth||120,A=(i==null?void 0:i.height)||t.clientHeight||t.offsetHeight||r;return(!r||r<10)&&(r=120),(!A||A<10)&&(A=r),[Math.round(r),Math.round(A)]}observeSliderResize(t,n,i,r){if(typeof ResizeObserver>"u")return;const A={currentWidth:Math.round(i)||0,currentHeight:Math.round(r)||0},a=new ResizeObserver(l=>{for(const c of l){const{width:h,height:f}=c.contentRect,m=Math.round(h),w=Math.round(f||h);!m||!w||m===A.currentWidth&&w===A.currentHeight||(A.currentWidth=m,A.currentHeight=w,n.resize(m,w))}});a.observe(t),this.resizeObservers.push(a)}onSliderChange(t,n,i,r,A){$r.updateEffect(t,{[n]:i,[r]:A})}onSliderInteractionStart(t){const n=$r.getActiveColor();x.debug("CartesianSliderController",`Interaction start for ${t}`,null,"ui"),d.emit("effectDialInteractionStart",{effectType:t,color:n})}onSliderInteractionEnd(t){const n=$r.getActiveColor();x.debug("CartesianSliderController",`Interaction end for ${t}`,null,"ui"),d.emit("effectDialInteractionEnd",{effectType:t,color:n})}loadInitialValues(t,n,i){const r=$r.getEffectState(t)||{},A=r[n.xParam],a=r[n.yParam],l=typeof A=="number"?A:n.xRange.min,c=typeof a=="number"?a:n.yRange.min;i.x=l,i.y=c}initializeColorTracking(){var t;d.on("noteChanged",({newNote:n})=>{n.color&&this.applyColorPalette(n.color)}),(t=d.state.selectedNote)!=null&&t.color&&this.applyColorPalette(d.state.selectedNote.color)}applyColorPalette(t){const n=d.state.colorPalette[t]||{primary:t,light:t},i=(l,c)=>{const h=y=>Math.max(0,Math.min(255,y)),f=l.replace("#",""),m=h(parseInt(f.slice(0,2),16)+c),w=h(parseInt(f.slice(2,4),16)+c),B=h(parseInt(f.slice(4,6),16)+c);return`#${m.toString(16).padStart(2,"0")}${w.toString(16).padStart(2,"0")}${B.toString(16).padStart(2,"0")}`},r=n.primary,A=n.light||i(r,80),a=(l,c)=>{const h=l.replace("#",""),f=parseInt(h.slice(0,2),16),m=parseInt(h.slice(2,4),16),w=parseInt(h.slice(4,6),16);return`rgba(${f}, ${m}, ${w}, ${c})`};Object.entries(this.sliders).forEach(([l,c])=>{const h=this.effectConfigs[l],f=(h==null?void 0:h.backgroundOpacity)??.5;c.setColors({accent:n.primary,fill:a(A,f),stroke:"#c3c9d0",grid:"#d7dce4",text:"#3c4048"})})}}const Sy=new uR;function hR(){HL(),LD(),GL(),x.initStart("Waveform Visualizer"),YL()?x.initSuccess("Waveform Visualizer"):x.initFailed("Waveform Visualizer"),x.initStart("Effects Managers"),by.init(),_y.init(),qr.init(),$r.init(),Sy.init();const e=window;e.effectsCoordinator=qr,e.animationEffectsManager=by,e.audioEffectsManager=_y,e.effectsController=$r,e.cartesianSliderController=Sy,x.initSuccess("Effects Managers")}function dR({cx:e,cy:t,rx:n,ry:i,stroke:r="currentColor",strokeWidth:A=3}){const a=document.createElementNS("http://www.w3.org/2000/svg","ellipse");return a.setAttribute("cx",`${e}`),a.setAttribute("cy",`${t}`),a.setAttribute("rx",`${n}`),a.setAttribute("ry",`${i}`),a.setAttribute("fill","none"),a.setAttribute("stroke",r),a.setAttribute("stroke-width",`${A}`),a.setAttribute("stroke-linecap","round"),a}function fR(e,t=48,n=48){const i=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=e.span==="quarter",A=r?200:100;i.setAttribute("viewBox",`0 0 ${A} 100`),i.setAttribute("width",`${t}`),i.setAttribute("height",`${n}`),i.setAttribute("aria-label",e.label),i.style.color="#000000";const l=50,c=r?32:16,h=40,f=r?[33.33,100,166.67]:[16.67,50,83.33];return e.hits.forEach(m=>{const w=dR({cx:f[m]??0,cy:l,rx:c,ry:h,stroke:"currentColor",strokeWidth:3});i.appendChild(w)}),i}const lc={selectedTripletStampId:1,init(){this.render(),this.bindEvents(),x.info("TripletStampsToolbar","Triplet stamps toolbar initialized",null,"triplets")},render(){const e=document.getElementById("triplet-stamps-toolbar-container");if(!e){x.warn("TripletStampsToolbar","Container not found",null,"triplets");return}e.innerHTML="";const t=Ru.filter(r=>r.span==="eighth"),n=Ru.filter(r=>r.span==="quarter"),i=document.createElement("div");if(i.className="triplet-stamps-grid",t.length>0){const r=document.createElement("div");r.className="triplet-stamps-row triplet-stamps-eighth-row",t.forEach(A=>{const a=this.createTripletStampButton(A);r.appendChild(a)}),i.appendChild(r)}if(n.length>0){const r=document.createElement("div");if(r.className="triplet-stamps-row triplet-stamps-quarter-row",n.slice(0,3).forEach(A=>{const a=this.createTripletStampButton(A);a.classList.add("triplet-stamp-button-wide"),r.appendChild(a)}),i.appendChild(r),n.length>3){const A=document.createElement("div");A.className="triplet-stamps-row triplet-stamps-quarter-row",n.slice(3).forEach(a=>{const l=this.createTripletStampButton(a);l.classList.add("triplet-stamp-button-wide"),A.appendChild(l)}),i.appendChild(A)}}e.appendChild(i),this.setInitialSelection(this.selectedTripletStampId)},createTripletStampButton(e){const t=document.createElement("button");t.className="triplet-stamp-button",t.dataset.tripletStampId=`${e.id}`,t.setAttribute("title",e.label||`Triplet ${e.id}`);const i=e.span==="quarter"?80:40,A=fR(e,i,40);return A.style.width="100%",A.style.height="100%",A.style.maxWidth="100%",A.style.maxHeight="100%",t.appendChild(A),t},bindEvents(){const e=document.getElementById("triplet-stamps-toolbar-container");e&&(e.addEventListener("click",t=>{var r;const n=(r=t.target)==null?void 0:r.closest(".triplet-stamp-button");if(!n)return;const i=parseInt(n.dataset.tripletStampId||"",10);Number.isNaN(i)||this.selectTripletStamp(i)}),d.on("toolChanged",({newTool:t})=>{t!=="tripletStamp"&&this.clearSelection()}),d.on("sixteenthStampToolSelected",()=>{this.clearSelection()}))},setInitialSelection(e){this.selectedTripletStampId=e;const t=document.getElementById("triplet-stamps-toolbar-container");t&&t.querySelectorAll(".triplet-stamp-button").forEach(n=>{const i=n;i.classList.toggle("active",parseInt(i.dataset.tripletStampId||"",10)===e)})},selectTripletStamp(e){this.selectedTripletStampId=e;const t=document.getElementById("triplet-stamps-toolbar-container");t&&t.querySelectorAll(".triplet-stamp-button").forEach(n=>{const i=n;i.classList.toggle("active",parseInt(i.dataset.tripletStampId||"",10)===e)}),d.setSelectedTool("tripletStamp"),d.emit("tripletStampSelected",e),d.emit("tripletStampToolSelected")},clearSelection(){const e=document.getElementById("triplet-stamps-toolbar-container");e&&e.querySelectorAll(".triplet-stamp-button").forEach(t=>{t.classList.remove("active")})},getSelectedTripletStamp(){return Ru.find(t=>t.id===this.selectedTripletStampId)}};function pR(){var e,t;GF.init(),((e=An.initialize)==null?void 0:e.call(An))??((t=An.init)==null||t.call(An)),Zh.init(),lc.init(),x.initSuccess("RhythmUi")}class mR{constructor(){P(this,"gridsWrapper",null);P(this,"pitchGridWrapper",null);P(this,"drumGridWrapper",null);P(this,"gridScrollbarProxy",null);P(this,"isInitialized",!1);P(this,"lastScrollTime",0);P(this,"isSyncingFromProxy",!1);P(this,"isSyncingFromWrapper",!1);P(this,"handleWrapperScroll");P(this,"handleProxyScroll")}init(){if(this.gridsWrapper=document.getElementById("grids-wrapper"),this.pitchGridWrapper=document.getElementById("pitch-grid-wrapper"),this.drumGridWrapper=document.getElementById("drum-grid-wrapper"),this.gridScrollbarProxy=document.getElementById("grid-scrollbar-proxy"),!this.gridsWrapper||!this.pitchGridWrapper||!this.drumGridWrapper){x.error("ScrollSyncService","Required elements not found for scroll sync",null,"scroll");return}this.setupScrollSynchronization(),this.isInitialized=!0,x.info("ScrollSyncService","Initialized with unified grids-wrapper structure",null,"scroll")}setupScrollSynchronization(){this.handleWrapperScroll=this.handleWrapperScrollInternal.bind(this),this.handleProxyScroll=this.handleProxyScrollInternal.bind(this),this.gridsWrapper.addEventListener("scroll",this.handleWrapperScroll,{passive:!0}),this.gridScrollbarProxy?this.gridScrollbarProxy.addEventListener("scroll",this.handleProxyScroll,{passive:!0}):x.warn("ScrollSyncService","Grid scrollbar proxy not found; falling back to native scrollbars.",null,"scroll")}handleWrapperScrollInternal(t){if(this.isSyncingFromProxy||!this.gridsWrapper)return;const n=Date.now();if(this.lastScrollTime=n,this.gridScrollbarProxy){const r=this.gridsWrapper.scrollLeft;Math.abs(this.gridScrollbarProxy.scrollLeft-r)>.5&&(this.isSyncingFromWrapper=!0,this.gridScrollbarProxy.scrollLeft=r,this.isSyncingFromWrapper=!1)}const i=t.target;x.debug("ScrollSyncService",`Unified scroll: ${(i==null?void 0:i.scrollLeft)??0}px`,null,"scroll")}handleProxyScrollInternal(){if(this.isSyncingFromWrapper||!this.gridScrollbarProxy)return;const t=this.gridScrollbarProxy.scrollLeft;this.gridsWrapper&&Math.abs(this.gridsWrapper.scrollLeft-t)>.5&&(this.isSyncingFromProxy=!0,this.gridsWrapper.scrollLeft=t,this.isSyncingFromProxy=!1)}syncScrollTo(t){!this.isInitialized||!this.gridsWrapper||(this.isSyncingFromProxy=!0,this.isSyncingFromWrapper=!0,this.gridsWrapper.scrollLeft=t,this.gridScrollbarProxy&&(this.gridScrollbarProxy.scrollLeft=t),this.isSyncingFromProxy=!1,this.isSyncingFromWrapper=!1)}}const gR=new mR,Ep={stroke:"#c7cfd8",background:"rgba(207, 214, 222, 0.32)"};let Iu=null;function a_(){if(Iu)return Iu;if(typeof window>"u")return Ep;const e=window.getComputedStyle(document.documentElement);return Iu={stroke:e.getPropertyValue("--c-anacrusis-border").trim()||Ep.stroke,background:e.getPropertyValue("--c-anacrusis-bg").trim()||Ep.background},Iu}function wR(e){if(e.length===0)return[];const t=[...e].sort((i,r)=>i.start-r.start),n=[];for(const i of t){if(n.length===0){n.push({...i});continue}const r=n[n.length-1];i.start<=r.end?r.end=Math.max(r.end,i.end):n.push({...i})}return n}function vR(e){const t=[],n=yR(d.state);return n!==null&&n>0&&t.push({start:UA(0,e),end:UA(n,e)}),e.placedTonicSigns.forEach(i=>{const r=UA(i.columnIndex,e),A=UA(i.columnIndex+2,e);t.push({start:r,end:A})}),wR(t)}function BR(e,t,n){const i=new Set([e,t]);n.forEach(a=>{const l=Math.max(e,Math.min(t,a.start)),c=Math.max(e,Math.min(t,a.end));c>l&&(i.add(l),i.add(c))});const r=Array.from(i).sort((a,l)=>a-l),A=[];for(let a=0;a<r.length-1;a++){const l=r[a],c=r[a+1],h=(l+c)/2,f=n.some(m=>h>=m.start&&h<m.end);c>l&&A.push({from:l,to:c,light:f})}return A}function yR(e){if(!e.hasAnacrusis||!Array.isArray(e.macrobeatBoundaryStyles))return null;const t=e.macrobeatBoundaryStyles.findIndex(i=>i==="solid");if(t<0)return null;const n=Tn(e,t);return n?n.endColumn+1:null}function UA(e,t){return It(e,t)}function l_(e,t,n,i,r,A,a=1){const l=n+r/2,c=i+A/2,h=Math.min(r,A)*.4*a;if(e.beginPath(),t===0)e.moveTo(l,c-h),e.lineTo(l-h,c+h),e.lineTo(l+h,c+h),e.closePath();else if(t===1)e.moveTo(l,c-h),e.lineTo(l+h,c),e.lineTo(l,c+h),e.lineTo(l-h,c),e.closePath();else{for(let m=0;m<5;m++){const w=2*Math.PI/5*m-Math.PI/2,B=l+h*Math.cos(w),y=c+h*Math.sin(w);m===0?e.moveTo(B,y):e.lineTo(B,y)}e.closePath()}e.fill()}function CR(e,t){const{columnWidths:n,musicalColumnWidths:i,macrobeatGroupings:r,macrobeatBoundaryStyles:A,placedTonicSigns:a}=t,c=(i&&i.length>0?i:n).length,h=r.map((f,m)=>{const{endColumn:w}=Tn(d.state,m);return w+1});for(let f=0;f<=c;f++){const m=f===0||f===c,w=f0(f,a),B=a.some(U=>f===U.columnIndex+2),y=h.includes(f);if(!p0(f,a))continue;let S=null;if(m||w||B)S={lineWidth:2,strokeStyle:"#adb5bd",dash:[]};else if(y){const U=h.indexOf(f),D=A[U];if(D==="anacrusis"){const{stroke:H}=a_();S={lineWidth:1,strokeStyle:H,dash:[4,4]}}else S={lineWidth:1,strokeStyle:"#adb5bd",dash:D==="solid"?[]:[5,5]}}if(!S)continue;const F=UA(f,t);e.beginPath(),e.moveTo(F,0),e.lineTo(F,tn(e.canvas)),e.lineWidth=S.lineWidth,e.strokeStyle=S.strokeStyle,e.setLineDash(S.dash),e.stroke()}e.setLineDash([])}function bR(e,t){const{placedNotes:n,columnWidths:i,cellWidth:r,cellHeight:A,placedTonicSigns:a}=t;e.clearRect(0,0,Vn(e.canvas),tn(e.canvas));const l=Math.max(Wl,Gl*A),c=i.length+4,h=["H","M","L"],f=vR(t),m=BR(0,Vn(e.canvas),f),{stroke:w}=a_();for(let B=0;B<4;B++){const y=B*l;m.forEach(b=>{b.to<=b.from||(e.beginPath(),e.moveTo(b.from,y),e.lineTo(b.to,y),e.strokeStyle=b.light?w:"#ced4da",e.lineWidth=1,e.globalAlpha=b.light?.6:1,e.stroke(),e.globalAlpha=1)})}CR(e,t);for(let B=0;B<c;B++){if(a.some(S=>B===S.columnIndex||B===S.columnIndex+1))continue;const y=UA(B,t);let b;t.modulationMarkers&&t.modulationMarkers.length>0?b=UA(B+1,t)-y:b=(i[B]??0)*r;for(let S=0;S<3;S++){const F=S*l,U=h[S],D=n.find(H=>H.isDrum&&(typeof H.drumTrack=="number"?String(H.drumTrack):H.drumTrack)===U&&H.startColumnIndex===B);if(D){e.fillStyle=D.color;const H=WA.getAnimationScale(B,U);l_(e,S,y,F,b,l,H)}else e.fillStyle="#ced4da",e.beginPath(),e.arc(y+b/2,F+l/2,2,0,Math.PI*2),e.fill()}}t.modulationMarkers&&t.modulationMarkers.length>0&&R0(e,t)}const Yi={getColumnIndex(e){const{cellWidth:t,modulationMarkers:n,cellHeight:i,musicalColumnWidths:r}=d.state,A=d.state.columnWidths||[];if(t===0)return 0;const a={...d.state,modulationMarkers:n,cellWidth:t,columnWidths:A,baseMicrobeatPx:d.state.baseMicrobeatPx||t},l=Kp(e,a),c=Math.floor(l);return c},getPitchRowIndex(e){const t=cs.getViewportInfo();if(!(t!=null&&t.halfUnit)||t.halfUnit===0)return-1;const n=t.halfUnit,i=Math.round(e/n-1),r=t.startRank+i,A=t.startRank,a=Math.max(A,(t.endRank??A+1)-1);return Math.max(A,Math.min(a,r))},getDrumRowIndex(e){const t=Math.max(Wl,Gl*d.state.cellHeight);return t===0?-1:Math.floor(e/t)}},Vg=["H","M","L"],_R="canvas-container",SR="drum-grid-wrapper",c_="eraser-tool-button",xR="drum-grid",ER="drum-hover-canvas";let Cs=null,Sh=!1,cc=!1,Ju=1,ur=null,xy=0;const TR=500,xh=e=>{d.state.musicalColumnWidths&&d.state.musicalColumnWidths.length>0?d.state.musicalColumnWidths:d.state.columnWidths;const t={modulationMarkers:d.state.modulationMarkers||[],columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,baseMicrobeatPx:d.state.baseMicrobeatPx||d.state.cellWidth||40};return It(e,t)},u_=e=>{if(d.state.modulationMarkers&&d.state.modulationMarkers.length>0){const r=xh(e);return xh(e+1)-r}return((d.state.musicalColumnWidths&&d.state.musicalColumnWidths.length>0?d.state.musicalColumnWidths:d.state.columnWidths)[e]??1)*d.state.cellWidth},Eh=()=>Math.max(Wl,Gl*d.state.cellHeight),Wg=()=>{Cs&&Cs.clearRect(0,0,Vn(Cs.canvas),tn(Cs.canvas))};function Gm(e,t,n){if(!Cs)return;const i=xh(e),r=t*Eh(),A=u_(e);Cs.fillStyle=n,Cs.fillRect(i,r,A,Eh())}function FR(e,t){var c;if(!Cs)return;const n=xh(e),i=t*Eh(),r=u_(e),A=Vg[t];if(!A)return;const a=WA.getAnimationScale(e,A),l=((c=d.state.selectedTool)==null?void 0:c.color)??"#212529";Cs.globalAlpha=.4,Cs.fillStyle=l,l_(Cs,t,n,i,r,Eh(),a),Cs.globalAlpha=1}const h_=()=>{const e=document.getElementById(_R);return(e==null?void 0:e.scrollLeft)??0};function IR(e){var h;const t=e.currentTarget;if(!t)return;const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,A=Yi.getColumnIndex(i+h_()),a=Yi.getDrumRowIndex(r),l=d.state.musicalColumnWidths&&d.state.musicalColumnWidths.length>0?d.state.musicalColumnWidths.length:d.state.columnWidths.length;if(!Cs||A<0||A>=l||a<0||a>2){Gg();return}Wg();const c=Vg[a];c&&(Sh?((h=d.eraseDrumNoteAt)!=null&&h.call(d,A,c,!1)&&(cc=!0),Gm(A,a,"rgba(220, 53, 69, 0.3)")):(Gm(A,a,"rgba(74, 144, 226, 0.2)"),FR(A,a)))}function Gg(){Wg()}function MR(e){var h,f,m,w;e.preventDefault();const t=e.currentTarget;if(!t)return;const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,A=Yi.getColumnIndex(i+h_()),a=d.state.musicalColumnWidths&&d.state.musicalColumnWidths.length>0?d.state.musicalColumnWidths.length:d.state.columnWidths.length;if(A<0||A>=a||!$1(A,d.state))return;const l=Yi.getDrumRowIndex(r);if(l<0||l>2)return;const c=Vg[l];if(c){if(e.button===2){Sh=!0,cc=!1,(h=document.getElementById(c_))==null||h.classList.add("erasing-active"),(f=d.eraseDrumNoteAt)!=null&&f.call(d,A,c,!1)&&(cc=!0),Wg(),Gm(A,l,"rgba(220, 53, 69, 0.3)");return}if(e.button===0){const B=((m=d.state.selectedTool)==null?void 0:m.color)??"#000000",y={isDrum:!0,drumTrack:c,startColumnIndex:A,endColumnIndex:A,color:B,shape:c==="H"?"triangle":c==="M"?"square":"pentagon"};(w=d.toggleDrumNote)==null||w.call(d,y);const b=window.transportService,S=b==null?void 0:b.drumPlayers;S!=null&&S.player&&(S.player(c).start(),WA.triggerNotePop(A,c))}}}function QR(){var e,t;Sh&&(cc&&((e=d.recordState)==null||e.call(d)),Sh=!1,cc=!1,(t=document.getElementById(c_))==null||t.classList.remove("erasing-active")),Gg()}function UR(){const e=document.getElementById(SR),t=e==null?void 0:e.querySelector(".drum-grid-left-cell");if(!e||!t)return;let n=t.querySelector(".drum-left-content");if(!n){n=document.createElement("div"),n.className="drum-left-content";const a=n,l=document.createElement("button");l.className="drum-volume-button",l.type="button",l.setAttribute("aria-label","Drum volume"),l.innerHTML=`
      <span class="drum-volume-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false" role="img">
          <path d="M3 10v4h4l5 5V5L7 10H3z" fill="currentColor"></path>
          <path d="M16 8.82v6.36c1.18-.85 2-2.22 2-3.64s-.82-2.79-2-3.64z" fill="currentColor"></path>
          <path d="M16 4v2c2.9 1.06 5 3.86 5 7s-2.1 5.94-5 7v2c4.01-1.15 7-4.97 7-9s-2.99-7.85-7-9z" fill="currentColor"></path>
        </svg>
      </span>
    `,l.style.gridRow="1 / span 3",l.style.gridColumn="1",["H","M","L"].forEach((c,h)=>{const f=document.createElement("span");f.className="drum-track-label",f.textContent=c,f.style.gridColumn="2",f.style.gridRow=`${h+1}`,a.appendChild(f)}),a.appendChild(l),t.appendChild(a)}const i=document.createElement("div");i.className="drum-volume-control",ur=document.createElement("input"),ur.type="range",ur.min="0",ur.max="100",ur.value="100",ur.className="drum-volume-slider",ur.style.cssText="width: 80px; margin: 0;",ur.addEventListener("input",a=>{const l=a.currentTarget;Ju=Number(l.value)/100;const c=window.drumVolumeNode;if(c!=null&&c.volume){const h=Ju===0?-60:20*Math.log10(Ju);c.volume.value=h;const f=window.transportService,m=f==null?void 0:f.drumPlayers,w=Date.now();m!=null&&m.player&&w-xy>=TR&&(m.player("M").start("+0.1"),xy=w)}}),i.appendChild(ur),t.appendChild(i);const r=()=>{if(!i)return;i.classList.contains("visible")?i.classList.remove("visible"):i.classList.add("visible")},A=t.querySelector(".drum-volume-button");A&&A.addEventListener("click",a=>{a.stopPropagation(),r()}),document.addEventListener("click",a=>{const l=a.target,c=l==null?void 0:l.closest(".drum-volume-control"),h=l==null?void 0:l.closest(".drum-volume-button");!c&&!h&&i.classList.remove("visible")})}function PR(){return Ju}window.getDrumVolume=PR;function DR(){const e=document.getElementById(xR),t=document.getElementById(ER);!e||!t||(Cs=t.getContext("2d"),e.addEventListener("mousedown",MR),e.addEventListener("mousemove",IR),e.addEventListener("mouseleave",Gg),e.addEventListener("contextmenu",n=>n.preventDefault()),window.addEventListener("mouseup",QR),UR())}function Ey(){const e=Yl.getDrumContext();if(!(e!=null&&e.canvas))return;const t={placedNotes:j1(d.state),placedTonicSigns:In(d.state),columnWidths:d.state.columnWidths,musicalColumnWidths:d.state.musicalColumnWidths,cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,macrobeatGroupings:d.state.macrobeatGroupings,macrobeatBoundaryStyles:d.state.macrobeatBoundaryStyles,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.cellWidth};bR(e,t)}const os={animationFrameId:null,render(){Ey(),WA.hasActiveAnimations()?os.animationFrameId||os.startAnimationLoop():os.stopAnimationLoop()},startAnimationLoop(){if(os.animationFrameId)return;const e=()=>{WA.cleanupAnimations(),Ey(),WA.hasActiveAnimations()?os.animationFrameId=requestAnimationFrame(e):os.animationFrameId=null};os.animationFrameId=requestAnimationFrame(e)},stopAnimationLoop(){os.animationFrameId&&(cancelAnimationFrame(os.animationFrameId),os.animationFrameId=null)}};window.drumGridRenderer=os;let Mu=!1,zr="C4",Th=null;function Zu(){var e;return{pitches:[],rootNote:zr,color:((e=d.state.selectedNote)==null?void 0:e.color)||"#000000"}}let Pi=Zu();function kR(){const e=document.activeElement;if(!(e instanceof HTMLElement))return!0;const t=e.tagName.toLowerCase();return!(["input","textarea","select"].includes(t)||e.isContentEditable)}function LR(e){const t=e.globalRow??e.row,n=d.state.fullRowData[t];return n?n.toneNote:"C4"}function Ty(){const e=d.state.placedNotes.slice().reverse().find(t=>!t.isDrum);zr=e?LR(e):"C4"}function Fy(e){const{activeChordIntervals:t}=d.state;return!e||!(t!=null&&t.length)?[]:t.map(n=>{const i=zo(e,n);return _l(i)})}function RR(){Ty(),d.on("notesChanged",Ty),document.addEventListener("keydown",e=>{var r,A;if(e.code!=="Enter"||Mu||e.repeat||!kR())return;e.preventDefault(),Mu=!0;const t=(r=d.state.selectedNote)==null?void 0:r.color;let n,i=[];if(Th&&t){const a=d.state.fullRowData[Th.row];n=a?a.toneNote:zr,d.state.selectedTool==="chord"?i=Fy(n):i=[n]}else t&&zr&&(n=zr,d.state.selectedTool==="chord"?i=Fy(zr):i=[zr]);if(i.length>0&&t&&n){Pi={pitches:[...i],rootNote:n,color:t},i.forEach(m=>{ye.triggerAttack(m,t)});const a=d.state.fullRowData.find(m=>m.toneNote===n),l=a?a.hex:"#888888",c=d.state.timbres[t];if(!c)return;const h=c.adsr;(A=jn.adsrComponent)==null||A.playheadManager.trigger("spacebar","attack",l,h),d.emit("spacebarPlayback",{note:n,color:t,isPlaying:!0});const f=`spacebar-${Date.now()}`;d.emit("noteAttack",{noteId:f,color:t}),Pi.noteId=f}}),document.addEventListener("keyup",e=>{var i;if(e.code!=="Enter"||!Mu)return;e.preventDefault(),Mu=!1;const t=Pi.pitches;if(!Array.isArray(t)||t.length===0){Pi=Zu();return}const n=Pi.color;if(n){t.forEach(h=>{ye.triggerRelease(h,n)});const r=Pi.rootNote??zr,A=d.state.fullRowData.find(h=>h.toneNote===r),a=A?A.hex:"#888888",l=d.state.timbres[n];if(!l){Pi=Zu();return}const c=l.adsr;(i=jn.adsrComponent)==null||i.playheadManager.trigger("spacebar","release",a,c),d.emit("spacebarPlayback",{note:r,color:n,isPlaying:!1}),Pi.noteId&&d.emit("noteRelease",{noteId:Pi.noteId,color:n})}Pi=Zu()})}function d_(e,t){var i;Th={col:e,row:t};const n=(i=d.state.selectedNote)==null?void 0:i.color;n&&d.emit("ghostNoteUpdated",{color:n})}function f_(){Th=null,d.emit("ghostNoteCleared")}const HR={single:40,chord:20,transient:30};function p_(e){return String(e)}function NR(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}const Iy={single:0,chord:0,transient:0},sA=new Map;function My(e,t){const n=p_(t),i=sA.get(e)??new Set;i.add(n),sA.set(e,i)}function Qy(e,t){const n=sA.get(e);n&&(n.delete(p_(t)),n.size===0&&sA.delete(e))}const ys={shouldPlayPreview(e){const t=NR(),n=HR[e],i=Iy[e];return t-i<n?!1:(Iy[e]=t,!0)},triggerAttack(e,t,n={}){const i=n.kind??"single";return!n.bypassThrottle&&!this.shouldPlayPreview(i)?!1:(ye.triggerAttack(e,t),My(t,e),!0)},triggerAttacks(e,t,n={}){const i=n.kind??"chord";return!n.bypassThrottle&&!this.shouldPlayPreview(i)?!1:(e.forEach(r=>{ye.triggerAttack(r,t),My(t,r)}),!0)},triggerRelease(e,t){ye.triggerRelease(e,t),Qy(t,e)},releasePitches(e,t){e.forEach(n=>{this.triggerRelease(n,t)})},quickReleasePitches(e,t){!e||e.length===0||(ye.quickReleasePitches(e,t),e.forEach(n=>Qy(t,n)))},playTransient(e,t,n=100){this.triggerAttack(e,t,{kind:"transient"})&&setTimeout(()=>this.triggerRelease(e,t),n)},releaseAll(e){if(typeof e=="string"){const t=sA.get(e);if(!t)return;Array.from(t.values()).forEach(n=>{ye.triggerRelease(n,e)}),sA.delete(e);return}for(const[t,n]of sA.entries())Array.from(n.values()).forEach(i=>{ye.triggerRelease(i,t)});sA.clear()}};class OR{constructor(){P(this,"isDragging",!1);P(this,"draggedModulationMarker",null);P(this,"lastModulationHoverResult",null)}handleMouseDown(t,n){for(const i of d.state.modulationMarkers||[]){const r=i.xCanvas??i.xPosition??0,A=Nv(t,n,{...i,xCanvas:r});if(A){if(A.type==="label"){const a=i.ratio===ls.COMPRESSION_2_3?ls.EXPANSION_3_2:ls.COMPRESSION_2_3;return d.setModulationRatio(i.id,a),!0}if(A.type==="barline"&&A.canDrag)return this.isDragging=!0,this.draggedModulationMarker=i,document.body.style.cursor=Ov(A),!0}}return!1}handlePlacementClick(t,n){if(d.state.selectedTool!=="modulation")return!1;const i=d.state.selectedModulationRatio;if(typeof i!="number")return x.warn("PitchGridModulationToolInteractor","No modulation ratio selected before placement",null,"grid"),!0;const r=n(t);if(!r)return x.warn("PitchGridModulationToolInteractor","Modulation placement must be near a measure boundary",{clickX:t},"grid"),!0;x.debug("PitchGridModulationToolInteractor","Placing modulation marker at boundary",{measureIndex:r.measureIndex,ratio:i,clickX:t,boundaryX:r.xPosition},"grid");const A=d.addModulationMarker(r.measureIndex,i,r.xPosition,null,r.macrobeatIndex);return x.debug("PitchGridModulationToolInteractor","Modulation marker placed",{markerId:A,measureIndex:r.measureIndex,ratio:i},"grid"),!0}handleMouseMove(t){if(!this.isDragging||!this.draggedModulationMarker)return!1;const n=d.state.baseMicrobeatPx||d.state.cellWidth||40,i=Math.round(t/n)*n;return d.moveModulationMarker(this.draggedModulationMarker.id,i),!0}getHoveredMarker(t,n){for(const i of d.state.modulationMarkers||[]){const r=i.xCanvas??i.xPosition??0,A=Nv(t,n,{...i,xCanvas:r});if(A)return A}return null}updateCursor(t,n){if(n){t.style.cursor=Ov(n),this.lastModulationHoverResult=n;return}this.lastModulationHoverResult&&(t.style.cursor="default",this.lastModulationHoverResult=null)}handleMouseUp(){return this.isDragging?(this.isDragging=!1,this.draggedModulationMarker=null,!0):!1}}class VR{handleExistingNoteMouseDown(t,n,i,r){var m,w,B;if(d.state.selectedTool!=="note")return{handled:!1,state:i};const A=d.state.placedNotes.find(y=>!y.isDrum&&y.row===n&&t>=y.startColumnIndex&&t<=y.endColumnIndex);if(!A)return{handled:!1,state:i};const a=r.getPitchForRow(n);if(!a)return{handled:!0,state:i};const l=window.waveformVisualizer;l&&(l.currentColor=A.color,l.generateWaveform(),l.startSingleNoteVisualization(A.color));const c=An.getSixteenthStampAtPosition(t,n);if(c)return An.playRhythmPattern(c.sixteenthStampId,a,A.color,A.shape,c),{handled:!0,state:{...i,activePreviewPitches:[a],activeNote:A}};ys.triggerAttack(a,A.color,{kind:"single",bypassThrottle:!0});const h=((m=d.state.fullRowData[n])==null?void 0:m.hex)||"#888888",f=(w=d.state.timbres[A.color])==null?void 0:w.adsr;return f&&((B=jn.adsrComponent)==null||B.playheadManager.trigger(A.uuid,"attack",h,f)),{handled:!0,state:{...i,activePreviewPitches:[a],activeNote:A}}}attemptPlaceNoteAt(t,n,i,r,A){var y,b,S;if(d.state.selectedTool!=="note")return{placed:!1,state:i,shouldStartDragging:!1};if(!Xl(t,d.state))return{placed:!1,state:i,shouldStartDragging:!1};const a=d.state.selectedNote;if(!a)return{placed:!1,state:i,shouldStartDragging:!1};const{shape:l,color:c}=a;if(l==="circle"&&!Xl(t+1,d.state))return{placed:!1,state:i,shouldStartDragging:!1};const h=l==="circle"?t+1:t,f={row:n,startColumnIndex:t,endColumnIndex:h,color:c,shape:l,isDrum:!1},m=d.addNote(f);if(!m)return{placed:!1,state:i,shouldStartDragging:!1};const w={...i,activeNote:m,lastDragRow:n};m.uuid&&d.emit("noteInteractionStart",{noteId:m.uuid,color:m.color});const B=A.getPitchForRow(n);if(B){m.uuid&&(r.add(m.uuid),d.emit("noteAttack",{noteId:m.uuid,color:m.color})),w.activePreviewPitches=[B],ys.triggerAttack(B,m.color,{kind:"single",bypassThrottle:!0});const F=((y=d.state.fullRowData[n])==null?void 0:y.hex)||"#888888",U=(b=d.state.timbres[m.color])==null?void 0:b.adsr;U&&((S=jn.adsrComponent)==null||S.playheadManager.trigger(m.uuid,"attack",F,U));const D=window.waveformVisualizer;D&&(D.currentColor=m.color,D.generateWaveform(),D.startSingleNoteVisualization(m.color))}return{placed:!0,state:w,shouldStartDragging:!0}}handleActiveNoteDrag(t,n,i,r){var h,f,m,w,B,y;const A=i.activeNote;if(!A)return i;const a=t,l=n,c=A.uuid;if(A.shape==="circle"){if(a!==A.endColumnIndex&&d.updateNoteTail(A,a),l!==i.lastDragRow){const b=r.getPitchForRow(l);if(!b)return i;i.activePreviewPitches.length>0&&ys.quickReleasePitches(i.activePreviewPitches,A.color);const S=d.state.placedNotes.find(R=>R.uuid===c);S&&d.updateNoteRow(S,l);const U=d.state.placedNotes.find(R=>R.uuid===c)||S||A;let D=i.activePreviewPitches;ys.triggerAttack(b,U.color,{kind:"single"})&&(D=[b]);const H=((h=d.state.fullRowData[l])==null?void 0:h.hex)||"#888888",Q=(f=d.state.timbres[U.color])==null?void 0:f.adsr;return Q&&U.uuid&&((m=jn.adsrComponent)==null||m.playheadManager.trigger(U.uuid,"attack",H,Q)),{...i,activeNote:U,lastDragRow:l,activePreviewPitches:D}}return i}if(A.shape==="oval"){const b=t;if(b!==A.startColumnIndex&&d.updateNotePosition(A,b),l!==i.lastDragRow){const S=r.getPitchForRow(l);if(!S)return i;i.activePreviewPitches.length>0&&ys.quickReleasePitches(i.activePreviewPitches,A.color);const F=d.state.placedNotes.find(V=>V.uuid===c);F&&d.updateNoteRow(F,l);const D=d.state.placedNotes.find(V=>V.uuid===c)||F||A;let H=i.activePreviewPitches;ys.triggerAttack(S,D.color,{kind:"single"})&&(H=[S]);const Q=((w=d.state.fullRowData[l])==null?void 0:w.hex)||"#888888",R=(B=d.state.timbres[D.color])==null?void 0:B.adsr;return R&&D.uuid&&((y=jn.adsrComponent)==null||y.playheadManager.trigger(D.uuid,"attack",Q,R)),{...i,activeNote:D,lastDragRow:l,activePreviewPitches:H}}}return i}}class WR{handleMouseDown(t,n){if(d.state.selectedTool!=="eraser")return{handled:!1,shouldStartDrag:!1};d.eraseInPitchArea(t,n,2,!1);const i=t+2-1,r=n-1,A=n+1;return jD(t,i,r,A),t2(t,i,r,A),{handled:!0,shouldStartDrag:!0}}handleMouseMove(t,n,i){if(!i)return!1;d.eraseInPitchArea(t,n,2,!1);const r=t+2-1,A=n-1,a=n+1;return d.eraseSixteenthStampsInArea(t,r,A,a),d.eraseTripletStampsInArea(t,r,A,a),!0}}class GR{handleMouseDown(t,n,i,r,A){var y,b,S;if(d.state.selectedTool!=="chord")return{handled:!1,state:i,shouldStartDragging:!1};if(!Xl(t,d.state))return{handled:!0,state:i,shouldStartDragging:!1};const a=A.getPitchForRow(n);if(!a)return{handled:!0,state:i,shouldStartDragging:!1};const l=A.getChordPitchesForRootPitch(a),c=d.state.selectedNote;if(!c)return{handled:!0,state:i,shouldStartDragging:!1};const{shape:h,color:f}=c;ys.triggerAttacks(l,f,{kind:"chord",bypassThrottle:!0});const m=((y=d.state.fullRowData[n])==null?void 0:y.hex)||"#888888",w=(b=d.state.timbres[f])==null?void 0:b.adsr;w&&((S=jn.adsrComponent)==null||S.playheadManager.trigger("chord_preview","attack",m,w));const B=[];return l.forEach(F=>{const U=d.state.fullRowData.findIndex(R=>R.toneNote===F);if(U===-1)return;const D=h==="circle"?t+1:t,H={row:U,startColumnIndex:t,endColumnIndex:D,color:f,shape:h,isDrum:!1},Q=d.addNote(H);Q&&(B.push(Q),Q.uuid&&(r.add(Q.uuid),d.emit("noteAttack",{noteId:Q.uuid,color:Q.color}),d.emit("noteInteractionStart",{noteId:Q.uuid,color:Q.color})))}),{handled:!0,shouldStartDragging:!0,state:{...i,activeChordNotes:B,activePreviewPitches:[...l],lastDragRow:n}}}handleActiveChordDrag(t,n,i,r){if(!i.activeChordNotes||i.activeChordNotes.length===0)return i;const A=i.activeChordNotes[0];if(!A)return i;const a=A.color,l=n;if(A.shape==="circle"){const c=t,h=i.activeChordNotes.filter(f=>c!==f.endColumnIndex);if(h.length>0&&d.updateMultipleNoteTails(h,c),l!==i.lastDragRow){const f=i.lastDragRow??A.row,m=l-f;if(m===0)return i;ys.quickReleasePitches(i.activePreviewPitches,a);const w=i.activeChordNotes.map(b=>b.row+m);if(!w.every(b=>r.getPitchForRow(b)!==null))return i;d.updateMultipleNoteRows(i.activeChordNotes,w);const y=w.map(b=>r.getPitchForRow(b)).filter(b=>typeof b=="string");return ys.triggerAttacks(y,a,{kind:"chord"}),{...i,activePreviewPitches:y,lastDragRow:l}}return i}if(A.shape==="oval"){const c=t,h=i.activeChordNotes.filter(b=>c!==b.startColumnIndex);h.length>0&&d.updateMultipleNotePositions(h,c);const f=i.lastDragRow!==null?i.lastDragRow:A.row,m=l-f;if(m===0)return i;ys.quickReleasePitches(i.activePreviewPitches,a);const w=i.activeChordNotes.map(b=>b.row+m);if(!w.every(b=>r.getPitchForRow(b)!==null))return i;d.updateMultipleNoteRows(i.activeChordNotes,w);const y=w.map(b=>r.getPitchForRow(b)).filter(b=>typeof b=="string");return ys.triggerAttacks(y,a,{kind:"chord"}),{...i,activePreviewPitches:y,lastDragRow:l}}return i}}function KR(e,t,n,i){var h,f;const r=Rh(n.sixteenthStampId);if(!r)return null;const A=It(n.startColumn,i),a=i.cellWidth*2,l=i.cellHeight,c=[.125,.375,.625,.875].map(m=>A+m*a);for(const m of r.diamonds){const w=`diamond_${m}`,B=((h=n.shapeOffsets)==null?void 0:h[w])||0,y=n.row+B,b=ie(y,i),S=c[m];if(S===void 0)continue;const F=Math.sqrt(Math.pow(e-S,2)+Math.pow(t-b,2)),U=Math.min(a*.2,l*1);if(F<U)return{type:"diamond",slot:m??0,shapeKey:w,cx:S,cy:b,placement:n}}for(const m of r.ovals){const w=`oval_${m}`,B=((f=n.shapeOffsets)==null?void 0:f[w])||0,y=n.row+B,b=ie(y,i),S=m===0?A+.25*a:A+.75*a,F=Math.sqrt(Math.pow(e-S,2)+Math.pow(t-b,2)),U=Math.min(a*.25,l*1);if(F<U)return{type:"oval",slot:m,shapeKey:w,cx:S,cy:b,placement:n}}return null}function Uy(e,t,n,i){for(const r of n){const A=KR(e,t,r,i);if(A)return A}return null}class qR{constructor(){P(this,"draggedStampShape",null)}isDraggingShape(){return this.draggedStampShape!==null}tryStartShapeDrag(t){const n=d.getAllSixteenthStampPlacements(),i={...d.state},r=Uy(t.actualX,t.canvasY,n,i);return r?(this.draggedStampShape={...r,startRow:d.getSixteenthStampShapeRow(r.placement,r.shapeKey),startMouseY:t.canvasY},!0):!1}handleMouseDown(t){if(this.tryStartShapeDrag({actualX:t.actualX,canvasY:t.canvasY}))return{handled:!0};if(d.state.selectedTool!=="sixteenthStamp")return{handled:!1};const n=An.getSixteenthStampAtPosition(t.colIndex,t.rowIndex);if(n){const h=t.getPitchForRow(t.rowIndex);if(!h)return{handled:!0};const f=d.state.placedNotes.find(w=>!w.isDrum&&w.row===t.rowIndex&&t.colIndex>=w.startColumnIndex&&t.colIndex<=w.endColumnIndex),m=f?f.shape:"oval";return An.playRhythmPattern(n.sixteenthStampId,h,n.color,m,n),{handled:!0,activePreviewPitches:[h]}}const i=Zh.getSelectedSixteenthStamp();if(!i)return{handled:!0};const r=t.getTimeAlignedCanvasColumn(t.colIndex);if(r===null)return{handled:!0};const A=d.state.selectedNote;if(!A)return{handled:!0};const{color:a,shape:l}=A;YD(i.id,r,t.rowIndex,a);const c=t.getPitchForRow(t.rowIndex);return c?(An.playRhythmPattern(i.id,c,a,l),d.recordState(),{handled:!0,activePreviewPitches:[c]}):(d.recordState(),{handled:!0})}handleMouseMove(t){var i;if(!this.draggedStampShape)return!1;const n=t.rowIndex-this.draggedStampShape.placement.row;if(d.updateSixteenthStampShapeOffset(this.draggedStampShape.placement.id,this.draggedStampShape.shapeKey,n),t.rowIndex!==this.draggedStampShape.startRow){const r=t.getPitchForRow(t.rowIndex);if(r){const A=this.draggedStampShape.placement.color||((i=d.state.selectedNote)==null?void 0:i.color);A&&ys.playTransient(r,A,100)}this.draggedStampShape.startRow=t.rowIndex}return t.canvasEl&&(t.canvasEl.style.cursor="ns-resize"),!0}updateHoverCursor(t){if(d.state.selectedTool!=="sixteenthStamp"||this.draggedStampShape)return;const n=t.canvasEl;if(!n)return;const i=d.getAllSixteenthStampPlacements(),r={...d.state};Uy(t.actualX,t.canvasY,i,r)||$R(t.actualX,t.canvasY,i,r)?n.style.cursor="grab":n.style.cursor="default"}handleMouseUp(){if(!this.draggedStampShape)return!1;this.draggedStampShape=null,d.recordState();const t=document.getElementById("notation-grid");return t&&(t.style.cursor="default"),!0}}function $R(e,t,n,i){const r=i.columnWidths||[];for(const A of n){const a=A.startColumn,l=Math.min(A.endColumn,r.length),c=It(a,i),h=It(l,i),m=ie(A.row,i)-i.cellHeight/2;if(e>=c&&e<=h&&t>=m&&t<=m+i.cellHeight)return!0}return!1}function zR(e,t,n,i){var w;const r=Hh(n.tripletStampId);if(!r)return null;const A=n.span*2,a=ds(n.startTimeIndex,d.state),l=a+A,c=It(a,i),f=It(l,i)-c,m=i.cellHeight;for(const B of r.hits){const y=`triplet_${B}`,b=((w=n.shapeOffsets)==null?void 0:w[y])||0,S=n.row+b,F=ie(S,i),U=k0[B];if(U===void 0)continue;const D=c+f*U/100,H=Math.sqrt(Math.pow(e-D,2)+Math.pow(t-F,2)),Q=Math.min(f*.15,m*1);if(H<Q)return{type:"tripletStamp",slot:B,shapeKey:y,cx:D,cy:F,placement:n}}return null}function Py(e,t,n,i){for(const r of n){const A=zR(e,t,r,i);if(A)return A}return null}class XR{constructor(){P(this,"draggedTripletShape",null)}isDraggingShape(){return this.draggedTripletShape!==null}tryStartShapeDrag(t){const n=d.getAllTripletStampPlacements(),i={...d.state},r=Py(t.actualX,t.canvasY,n,i);return r?(this.draggedTripletShape={...r,startRow:d.getTripletStampShapeRow(r.placement,r.shapeKey),startMouseY:t.canvasY},!0):!1}handleMouseDown(t){if(this.tryStartShapeDrag({actualX:t.actualX,canvasY:t.canvasY}))return{handled:!0};if(d.state.selectedTool!=="tripletStamp")return{handled:!1};const n=br(t.colIndex,d.state);if(n===null)return{handled:!0};const i=n,r=An.getTripletStampAtPosition(i,t.rowIndex);if(r){const c=t.getPitchForRow(t.rowIndex);return c?(An.playTripletPattern(r.tripletStampId,c,r.color,r),{handled:!0,activePreviewPitches:[c]}):{handled:!0}}const A=lc.getSelectedTripletStamp();if(!A||!d.state.selectedNote)return{handled:!0};const a=JD(A.id,i,t.rowIndex,d.state.selectedNote.color),l=t.getPitchForRow(t.rowIndex);return l&&a?(An.playTripletPattern(A.id,l,d.state.selectedNote.color,a),d.recordState(),{handled:!0,activePreviewPitches:[l]}):(d.recordState(),{handled:!0})}handleMouseMove(t){var i;if(!this.draggedTripletShape)return!1;const n=t.rowIndex-this.draggedTripletShape.placement.row;if(d.updateTripletStampShapeOffset(this.draggedTripletShape.placement.id,this.draggedTripletShape.shapeKey,n),t.rowIndex!==this.draggedTripletShape.startRow){const r=t.getPitchForRow(t.rowIndex);if(r){const A=this.draggedTripletShape.placement.color||((i=d.state.selectedNote)==null?void 0:i.color);A&&ys.playTransient(r,A,100)}this.draggedTripletShape.startRow=t.rowIndex}return t.canvasEl&&(t.canvasEl.style.cursor="ns-resize"),!0}updateHoverCursor(t){if(d.state.selectedTool!=="tripletStamp"||this.draggedTripletShape)return;const n=t.canvasEl;if(!n)return;const i=d.getAllTripletStampPlacements(),r={...d.state};Py(t.actualX,t.canvasY,i,r)||YR(t.actualX,t.canvasY,i,r)?n.style.cursor="grab":n.style.cursor="default"}handleMouseUp(){if(!this.draggedTripletShape)return!1;this.draggedTripletShape=null,d.recordState();const t=document.getElementById("notation-grid");return t&&(t.style.cursor="default"),!0}}function YR(e,t,n,i){for(const r of n){const A=r.span*2,a=ds(r.startTimeIndex,d.state),l=a+A,c=It(a,i),h=It(l,i),m=ie(r.row,i)-i.cellHeight/2;if(e>=c&&e<=h&&t>=m&&t<=m+i.cellHeight)return!0}return!1}function jR(e){const{macrobeatGroupings:t,macrobeatBoundaryStyles:n,columnWidths:i}=d.state,r=i.length;if(e<0||e>=r)return null;let A=-1;for(let m=0;m<t.length;m++){const{startColumn:w,endColumn:B}=Tn(d.state,m);if(e>=w&&e<=B){A=m;break}}if(A===-1)return null;let a=0;for(let m=A-1;m>=0;m--)if(n[m]==="solid"){a=m+1;break}const l=a-1;return(m=>m<=0?!0:n[m-1]==="solid")(a)?{drawColumn:Tn(d.state,a).startColumn,preMacrobeatIndex:l}:null}function Dy(e){return e.replace(/\d+$/,"")}class JR{constructor(){P(this,"lastHoveredTonicPoint",null);P(this,"lastHoveredOctaveRows",[])}resetHoverState(){this.lastHoveredTonicPoint=null,this.lastHoveredOctaveRows=[]}handleMouseMove(t){if(d.state.selectedTool!=="tonicization")return(this.lastHoveredTonicPoint||this.lastHoveredOctaveRows.length>0)&&this.resetHoverState(),!1;const n=jR(t.colIndex);if(!n)return this.resetHoverState(),!0;if(In(d.state).some(f=>f.preMacrobeatIndex===n.preMacrobeatIndex))return this.resetHoverState(),!0;const A=t.getPitchForRow(t.rowIndex);if(!A)return this.resetHoverState(),!0;const a=Dy(A),l=Fe.map((f,m)=>({rowData:f,masterIndex:m})).filter(({rowData:f})=>f.toneNote&&Dy(f.toneNote)===a).map(({masterIndex:f})=>f);this.lastHoveredTonicPoint=n,this.lastHoveredOctaveRows=l;const c=l.filter(f=>f>=0&&f<d.state.fullRowData.length);t.hoverCtx.globalAlpha=.5;const h={...d.state,zoomLevel:cs.getViewportInfo().zoomLevel};return c.forEach(f=>{const m={row:f,globalRow:f,columnIndex:n.drawColumn,tonicNumber:d.state.selectedToolTonicNumber,preMacrobeatIndex:n.preMacrobeatIndex};P0(t.hoverCtx,h,m)}),t.hoverCtx.globalAlpha=1,!0}handleMouseDown(){if(d.state.selectedTool!=="tonicization")return!1;if(!this.lastHoveredTonicPoint||this.lastHoveredOctaveRows.length===0)return!0;const t=this.lastHoveredTonicPoint;if(In(d.state).some(A=>A.preMacrobeatIndex===t.preMacrobeatIndex))return this.resetHoverState(),!0;const r=this.lastHoveredOctaveRows.map(A=>({row:A,tonicNumber:d.state.selectedToolTonicNumber,preMacrobeatIndex:t.preMacrobeatIndex,columnIndex:t.drawColumn}));return d.addTonicSignGroup(r),this.resetHoverState(),!0}}class ZR{constructor(t){this.deps=t}handleToolMouseDown(t){const{toolType:n,colIndex:i,rowIndex:r,actualX:A,canvasY:a}=t,l=t.state;if(n==="chord"){const c=this.deps.chordToolInteractor.handleMouseDown(i,r,{activeChordNotes:l.activeChordNotes,lastDragRow:l.lastDragRow,activePreviewPitches:l.activePreviewPitches},this.deps.placementFillNoteIds,{getPitchForRow:this.deps.getPitchForRow,getChordPitchesForRootPitch:this.deps.getChordPitchesForRootPitch});return{handled:c.handled,state:{...l,isDragging:c.shouldStartDragging?!0:l.isDragging,activeChordNotes:c.state.activeChordNotes,lastDragRow:c.state.lastDragRow,activePreviewPitches:c.state.activePreviewPitches}}}if(n==="tonicization")return this.deps.tonicizationToolInteractor.handleMouseDown(),{handled:!0,state:l};if(n==="eraser"){const c=this.deps.eraserToolInteractor.handleMouseDown(i,r);return{handled:c.handled,state:{...l,isEraserDragActive:c.handled?c.shouldStartDrag:l.isEraserDragActive}}}if(n==="sixteenthStamp"){const c=this.deps.stampToolInteractor.handleMouseDown({colIndex:i,rowIndex:r,actualX:A,canvasY:a,getPitchForRow:this.deps.getPitchForRow,getTimeAlignedCanvasColumn:this.deps.getTimeAlignedCanvasColumn});return{handled:c.handled,state:{...l,activePreviewPitches:c.activePreviewPitches??l.activePreviewPitches}}}if(n==="tripletStamp"){const c=this.deps.tripletToolInteractor.handleMouseDown({colIndex:i,rowIndex:r,actualX:A,canvasY:a,getPitchForRow:this.deps.getPitchForRow});return{handled:c.handled,state:{...l,activePreviewPitches:c.activePreviewPitches??l.activePreviewPitches}}}if(n==="modulation")return this.deps.modulationToolInteractor.handlePlacementClick(A,this.deps.findNearestMeasureBoundary),{handled:!0,state:l};if(n==="note"){const c=this.deps.noteToolInteractor.attemptPlaceNoteAt(i,r,{activeNote:l.activeNote,lastDragRow:l.lastDragRow,activePreviewPitches:l.activePreviewPitches},this.deps.placementFillNoteIds,{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...l,isDragging:c.placed&&c.shouldStartDragging?!0:l.isDragging,activeNote:c.state.activeNote,lastDragRow:c.state.lastDragRow,activePreviewPitches:c.state.activePreviewPitches}}}return{handled:!1,state:l}}handleToolMouseMoveBeforeBoundsCheck(t){const{actualX:n,rowIndex:i,canvasEl:r,state:A}=t;return this.deps.modulationToolInteractor.handleMouseMove(n)?{handled:!0,state:A}:this.deps.stampToolInteractor.handleMouseMove({rowIndex:i,canvasEl:r,getPitchForRow:this.deps.getPitchForRow})?{handled:!0,state:A}:this.deps.tripletToolInteractor.handleMouseMove({rowIndex:i,canvasEl:r,getPitchForRow:this.deps.getPitchForRow})?{handled:!0,state:A}:{handled:!1,state:A}}handleNoteOrChordDragMouseMove(t){const{colIndex:n,rowIndex:i}=t,r=t.state;if(!r.isDragging||!r.activeNote&&r.activeChordNotes.length===0)return{handled:!1,state:r};if(r.activeNote){const a=this.deps.noteToolInteractor.handleActiveNoteDrag(n,i,{activeNote:r.activeNote,lastDragRow:r.lastDragRow,activePreviewPitches:r.activePreviewPitches},{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...r,activeNote:a.activeNote,lastDragRow:a.lastDragRow,activePreviewPitches:a.activePreviewPitches}}}const A=this.deps.chordToolInteractor.handleActiveChordDrag(n,i,{activeChordNotes:r.activeChordNotes,lastDragRow:r.lastDragRow,activePreviewPitches:r.activePreviewPitches},{getPitchForRow:this.deps.getPitchForRow});return{handled:!0,state:{...r,activeChordNotes:A.activeChordNotes,lastDragRow:A.lastDragRow,activePreviewPitches:A.activePreviewPitches}}}handleToolHoverVisuals(t){const{toolType:n,actualX:i,canvasY:r,pitchHoverCtx:A,canvasEl:a}=t;n==="sixteenthStamp"?this.deps.stampToolInteractor.updateHoverCursor({actualX:i,canvasY:r,canvasEl:a}):n==="tripletStamp"&&this.deps.tripletToolInteractor.updateHoverCursor({actualX:i,canvasY:r,canvasEl:a});const l=this.deps.modulationToolInteractor.getHoveredMarker(i,r);if(n==="modulation"&&!l&&A){const c=t.findNearestMeasureBoundary(i),h=t.selectedModulationRatio;c&&typeof h=="number"&&t.drawModulationPreview(A,c.xPosition,h)}a&&this.deps.modulationToolInteractor.updateCursor(a,l)}handleToolMouseUp(){return!!(this.deps.stampToolInteractor.handleMouseUp()||this.deps.tripletToolInteractor.handleMouseUp()||this.deps.modulationToolInteractor.handleMouseUp())}handleChordToolHover(t){if(d.state.selectedTool!=="chord")return!1;const n=this.deps.getPitchForRow(t.rowIndex);if(!n)return!0;const i=this.deps.getChordPitchesForRootPitch(n),r=d.state.selectedNote;if(!r)return!0;const{shape:A,color:a}=r;return t.pitchHoverCtx.globalAlpha=.4,i.forEach(l=>{const c=d.state.fullRowData.findIndex(w=>w.toneNote===l);if(c<=-1)return;const h=A==="circle"?t.colIndex+1:t.colIndex,f={row:c,startColumnIndex:t.colIndex,endColumnIndex:h,color:a,shape:A,isDrum:!1},m={...d.state,zoomLevel:t.zoomLevel};A==="oval"?t.drawSingleColumnOvalNote(t.pitchHoverCtx,m,f,c):t.drawTwoColumnOvalNote(t.pitchHoverCtx,m,f,c)}),t.pitchHoverCtx.globalAlpha=1,!0}}class tH{constructor(){P(this,"isActive",!1);P(this,"actionTaken",!1);P(this,"previousTool",null)}getIsActive(){return this.isActive}handleMouseDown(t){var f;const{event:n,colIndex:i,rowIndex:r,annotationService:A}=t;if(n.button!==2)return!1;n.preventDefault(),this.isActive=!0,this.actionTaken=!1,d.state.selectedTool!=="eraser"&&(this.previousTool=d.state.selectedTool,d.setSelectedTool("eraser")),(f=Sr.get("eraserButton"))==null||f.classList.add("erasing-active"),this.actionTaken||(this.actionTaken=!!d.eraseInPitchArea(i,r,2,!1)),this.actionTaken||(this.actionTaken=!!d.eraseTonicSignAt(i,!1));const a=i+2-1,l=r-1,c=r+1;this.actionTaken||(this.actionTaken=!!d.eraseSixteenthStampsInArea(i,a,l,c)),this.actionTaken||(this.actionTaken=!!d.eraseTripletStampsInArea(i,a,l,c));const h=n.target instanceof Element?n.target:null;if(h){const m=h.getBoundingClientRect(),w=n.clientX-m.left,B=n.clientY-m.top;this.actionTaken||(this.actionTaken=!!A.eraseAtPoint(w,B))}return!0}handleMouseMove(t){if(!this.isActive)return!1;const{event:n,colIndex:i,rowIndex:r,annotationService:A}=t;this.actionTaken||(this.actionTaken=!!d.eraseInPitchArea(i,r,2,!1)),this.actionTaken||(this.actionTaken=!!d.eraseTonicSignAt(i,!1));const a=i+2-1,l=r-1,c=r+1;this.actionTaken||(this.actionTaken=!!d.eraseSixteenthStampsInArea(i,a,l,c)),this.actionTaken||(this.actionTaken=!!d.eraseTripletStampsInArea(i,a,l,c));const h=n.target instanceof Element?n.target:null;if(h){const f=h.getBoundingClientRect(),m=n.clientX-f.left,w=n.clientY-f.top;this.actionTaken||(this.actionTaken=!!A.eraseAtPoint(m,w))}return!0}handleGlobalMouseUp(){var t;return this.isActive?(this.actionTaken&&d.recordState(),this.isActive=!1,this.actionTaken=!1,this.previousTool&&(d.setSelectedTool(this.previousTool),this.previousTool=null),(t=Sr.get("eraserButton"))==null||t.classList.remove("erasing-active"),!0):!1}}class eH{constructor(t,n){P(this,"pitchCanvasElement",null);P(this,"mobileLongPressTimer",null);P(this,"mobileTouchState",null);P(this,"mobileGhostActive",!1);this.deps=t,this.options=n}setPitchCanvasElement(t){this.pitchCanvasElement=t}handleTouchStart(t){var r;if(!this.deps.shouldUseMobileLongPress()||this.mobileTouchState)return;const n=(r=t.changedTouches)==null?void 0:r[0];if(!n)return;const i=this.getTouchGridPosition(n);!i||!this.deps.isPositionWithinPitchGrid(i.colIndex,i.rowIndex)||(t.preventDefault(),this.mobileTouchState={identifier:n.identifier,colIndex:i.colIndex,rowIndex:i.rowIndex},this.mobileLongPressTimer=window.setTimeout(()=>{this.activateMobileGhostPreview()},this.options.longPressDelayMs))}handleTouchMove(t){if(!this.mobileTouchState)return;const n=this.findTouchById(t.changedTouches,this.mobileTouchState.identifier)||this.findTouchById(t.touches,this.mobileTouchState.identifier);if(!n)return;const i=this.getTouchGridPosition(n);if(!i){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive});return}if(!this.deps.isPositionWithinPitchGrid(i.colIndex,i.rowIndex)){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive});return}t.preventDefault(),this.mobileTouchState.colIndex=i.colIndex,this.mobileTouchState.rowIndex=i.rowIndex,this.mobileGhostActive&&this.renderMobileGhostPreview()}handleTouchEnd(t){if(!this.mobileTouchState||!this.findTouchById(t.changedTouches,this.mobileTouchState.identifier))return;t.preventDefault();const i=this.mobileGhostActive,r=this.mobileTouchState.colIndex,A=this.mobileTouchState.rowIndex;if(this.resetMobileTouchState(),!i||this.deps.getSelectedTool()!=="note")return;this.deps.attemptPlaceNoteAt(r,A)?this.deps.onNotePlaced():this.deps.onNoteNotPlaced()}handleTouchCancel(){this.resetMobileTouchState({clearOverlay:this.mobileGhostActive})}getTouchGridPosition(t){var c;if(!this.pitchCanvasElement)return null;const n=this.pitchCanvasElement.getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top,A=((c=document.getElementById("canvas-container"))==null?void 0:c.scrollLeft)??0,a=Yi.getColumnIndex(i+A),l=Yi.getPitchRowIndex(r);return{colIndex:a,rowIndex:l}}findTouchById(t,n){if(!t)return null;for(let i=0;i<t.length;i++){const r=t.item(i);if(r&&r.identifier===n)return r}return null}renderMobileGhostPreview(){const t=this.deps.getPitchHoverCtx();!t||!this.mobileTouchState||(t.clearRect(0,0,Vn(t.canvas),tn(t.canvas)),this.deps.drawHoverHighlight(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex,this.deps.getNoteHoverColor(this.options.ghostAlpha)),this.deps.drawGhostNote(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex),this.deps.setGhostNotePosition(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex))}activateMobileGhostPreview(){if(this.mobileTouchState){if(!this.deps.isPositionWithinPitchGrid(this.mobileTouchState.colIndex,this.mobileTouchState.rowIndex)){this.resetMobileTouchState({clearOverlay:!1});return}this.mobileGhostActive=!0,this.renderMobileGhostPreview()}}resetMobileTouchState({clearOverlay:t=!1}={}){this.mobileLongPressTimer&&(clearTimeout(this.mobileLongPressTimer),this.mobileLongPressTimer=null),t&&this.mobileGhostActive&&this.deps.clearOverlay(),this.mobileTouchState=null,this.mobileGhostActive=!1}}function nH(e,t){const{activeChordIntervals:n,isIntervalsInverted:i,chordPositionState:r}=t;if(!e||!n||n.length===0)return[];if(i&&n.length===2&&n[0]==="1P"){const l="-"+n[1],c=zo(e,l),h=_l(c),f=h.includes("#")&&Sl(h).includes("b")?Sl(h):h;return[e,f]}const A=n.map(a=>{const l=zo(e,a),c=_l(l);if(c.includes("#")){const h=Sl(c);if(h.includes("b"))return h}return c});if(n.length>=3&&r>0){const a=[...A];for(let B=0;B<r;B++){const y=a.shift();if(!y)break;const b=zo(y,"8P");a.push(_l(b)??y)}const l=a[0],c=e;if(!l)return A;const h=Uf(l),f=Uf(c);if(h===null||f===null)return A;let m=0,w=h;for(;w>f;)w-=12,m-=12;for(;w+12<=f;)w+=12,m+=12;return a.map(B=>{const y=Uf(B);if(y===null)return B;const b=y+m;return I1(b)??B})}return A}let Fh=!1,Km=null,qm=null,$m=null,Bl=null;const PA="grab";function sH(e){if(Fh){e&&(e.style.cursor=PA);return}Km=document.body.style.cursor||null,qm=document.documentElement.style.cursor||null,$m=(e==null?void 0:e.style.cursor)??null,Bl=e??null,e&&(e.style.cursor=PA),document.body.style.cursor=PA,document.documentElement.style.cursor=PA,document.body.dataset.cursorOverride="stamp",Fh=!0}function m_(){Fh&&(Bl&&Bl.style.cursor===PA&&(Bl.style.cursor=$m??""),document.body.style.cursor===PA&&(document.body.style.cursor=Km??""),document.documentElement.style.cursor===PA&&(document.documentElement.style.cursor=qm??""),document.body.dataset.cursorOverride==="stamp"&&delete document.body.dataset.cursorOverride,Fh=!1,Km=null,qm=null,$m=null,Bl=null)}let Se=null,uA=!1,Ke=null,yr=[],bs=[];const Ko=new Set;let iA=!1,Ki=null;const g_=new OR,Kg=new VR,w_=new WR,iH=new GR,qg=new qR,$g=new XR,Ih=new JR,td=new tH,qo=new ZR({noteToolInteractor:Kg,chordToolInteractor:iH,eraserToolInteractor:w_,stampToolInteractor:qg,tripletToolInteractor:$g,modulationToolInteractor:g_,tonicizationToolInteractor:Ih,placementFillNoteIds:Ko,getPitchForRow:ha,getTimeAlignedCanvasColumn:zm,getChordPitchesForRootPitch:e=>nH(e,d.state),findNearestMeasureBoundary:S_}),rH=275,AH=.25,ol=new eH({shouldUseMobileLongPress:lH,isPositionWithinPitchGrid:C_,getSelectedTool:()=>d.state.selectedTool,getPitchHoverCtx:()=>Se,clearOverlay:da,drawHoverHighlight:Vl,getNoteHoverColor:B_,drawGhostNote:b_,setGhostNotePosition:d_,attemptPlaceNoteAt:aH,onNotePlaced:__,onNoteNotPlaced:da},{longPressDelayMs:rH,ghostAlpha:AH}),v_="#4a90e2";function oH(e,t=1){const n=e.startsWith("#")?e.slice(1):e;if(n.length!==6)return e;const i=parseInt(n.slice(0,2),16),r=parseInt(n.slice(2,4),16),A=parseInt(n.slice(4,6),16);return`rgba(${i}, ${r}, ${A}, ${t})`}function B_(e=.2){var n;const t=((n=d.state.selectedNote)==null?void 0:n.color)||v_;return oH(t,e)}function ky(){var e;return((e=d.state.selectedNote)==null?void 0:e.color)||v_}function y_(){return!!qe.currentTool}function ha(e){const t=d.state.fullRowData[e];return!t||t.isBoundary?null:t.toneNote}function zm(e){const t=e+2,n=ui(d.state,t);if(n===null)return null;const i=dr(d.state,n);return i===null?null:Math.max(0,i-2)}function C_(e,t){var a;const n=(d.state.selectedTool==="note"||d.state.selectedTool==="chord")&&((a=d.state.selectedNote)==null?void 0:a.shape)==="circle",r=(d.state.musicalColumnWidths&&d.state.musicalColumnWidths.length>0?d.state.musicalColumnWidths:d.state.columnWidths||[]).length,A=n?r-1:r;return e<0||e>=A?!1:ha(t)!==null}function Vl(e,t,n){var h;if(!Se)return;const i={...d.state,zoomLevel:cs.getViewportInfo().zoomLevel},r=It(e,i),a=ie(t,d.state)-d.state.cellHeight/2,l=d.state.selectedTool;let c;if(d.state.modulationMarkers&&d.state.modulationMarkers.length>0?c=It(e+1,i)-r:c=(d.state.columnWidths[e]??1)*d.state.cellWidth,l==="eraser"||td.getIsActive())d.state.modulationMarkers&&d.state.modulationMarkers.length>0?c=It(e+2,i)-r:c=d.state.cellWidth*2;else if(l==="note"&&((h=d.state.selectedNote)==null?void 0:h.shape)==="circle")d.state.modulationMarkers&&d.state.modulationMarkers.length>0?c=It(e+2,i)-r:c=d.state.cellWidth*2;else if(l==="sixteenthStamp")d.state.modulationMarkers&&d.state.modulationMarkers.length>0?c=It(e+2,i)-r:c=d.state.cellWidth*2;else if(l==="tripletStamp"){const f=lc.getSelectedTripletStamp();if(f){const w=2*(f.span==="eighth"?1:2);d.state.modulationMarkers&&d.state.modulationMarkers.length>0?c=It(e+w,i)-r:c=d.state.cellWidth*w}else c=d.state.cellWidth*2}else l==="tonicization"&&(d.state.modulationMarkers&&d.state.modulationMarkers.length>0?c=It(e+2,i)-r:c=d.state.cellWidth*2);Se.fillStyle=n,Se.fillRect(r,a,c,d.state.cellHeight)}function b_(e,t,n=!1){if(!Se||!d.state.selectedNote)return;const i=d.state.selectedTool,{shape:r,color:A}=d.state.selectedNote;if(Se.globalAlpha=n?.2:.4,i==="note"){const a=r==="circle"?e+1:e,l={uuid:"ghost-note",globalRow:t,row:t,startColumnIndex:e,endColumnIndex:a,color:A,shape:r,isDrum:!1},c={...d.state,zoomLevel:cs.getViewportInfo().zoomLevel};r==="oval"?hg(Se,c,l,t):ug(Se,c,l,t)}Se.globalAlpha=1}function aH(e,t){const n=Kg.attemptPlaceNoteAt(e,t,{activeNote:Ke,lastDragRow:Ki,activePreviewPitches:bs},Ko,{getPitchForRow:ha});return Ke=n.state.activeNote,Ki=n.state.lastDragRow,bs=n.state.activePreviewPitches,n.placed&&n.shouldStartDragging&&(uA=!0),n.placed}function lH(){if(d.state.selectedTool!=="note")return!1;const e=d.state.deviceProfile;if(e&&typeof e.isMobile=="boolean")return e.isMobile;if(typeof window<"u"&&typeof window.matchMedia=="function")try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}return!1}function cH(e){var c;if(y_()){da();return}if(!Se)return;const t=e.target instanceof Element?e.target:null;if(!t)return;const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,A=((c=document.getElementById("canvas-container"))==null?void 0:c.scrollLeft)??0,a=Yi.getColumnIndex(i+A),l=Yi.getPitchRowIndex(r);if(!C_(a,l)){d.state.selectedTool;return}if(e.button===2&&td.handleMouseDown({event:e,colIndex:a,rowIndex:l,annotationService:qe})){Se.clearRect(0,0,Vn(Se.canvas),tn(Se.canvas)),Vl(a,l,"rgba(220, 53, 69, 0.3)");return}if(e.button===0){const h=i+A;if(g_.handleMouseDown(h,r))return;const f=Kg.handleExistingNoteMouseDown(a,l,{activeNote:Ke,lastDragRow:Ki,activePreviewPitches:bs},{getPitchForRow:ha});if(f.handled){Ke=f.state.activeNote,Ki=f.state.lastDragRow,bs=f.state.activePreviewPitches;return}const m=d.state.selectedTool;if(m==="note"||m==="chord"){const B=qg.tryStartShapeDrag({actualX:i+A,canvasY:r}),y=!B&&$g.tryStartShapeDrag({actualX:i+A,canvasY:r});if(B||y)return;const b=An.getSixteenthStampAtPosition(a,l),S=br(a,d.state),F=S===null?null:An.getTripletStampAtPosition(S,l);if(b||F)return}const w=qo.handleToolMouseDown({toolType:m,colIndex:a,rowIndex:l,actualX:i+A,canvasY:r,state:{isDragging:uA,isEraserDragActive:iA,activeNote:Ke,activeChordNotes:yr,activePreviewPitches:bs,lastDragRow:Ki}});if(w.handled){uA=w.state.isDragging,iA=w.state.isEraserDragActive,Ke=w.state.activeNote,yr=w.state.activeChordNotes,bs=w.state.activePreviewPitches,Ki=w.state.lastDragRow;return}}}function uH(e){var wt,Ct,Mt;if(y_()){da();return}if(!Se)return;const t=e.target instanceof Element?e.target:null;if(!t)return;const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,A=((wt=document.getElementById("canvas-container"))==null?void 0:wt.scrollLeft)??0,a=Yi.getColumnIndex(i+A),l=Yi.getPitchRowIndex(r);if(!Se)return;Se.clearRect(0,0,Vn(Se.canvas),tn(Se.canvas));const c=e.target instanceof HTMLElement?e.target:null,h=d.state.selectedTool,f=i+A,m=br(a,d.state);if(qo.handleToolMouseMoveBeforeBoundsCheck({actualX:f,rowIndex:l,canvasEl:c,state:{isDragging:uA,isEraserDragActive:iA,activeNote:Ke,activeChordNotes:yr,activePreviewPitches:bs,lastDragRow:Ki}}).handled)return;qo.handleToolHoverVisuals({toolType:h,actualX:f,canvasY:r,pitchHoverCtx:Se,canvasEl:c,selectedModulationRatio:d.state.selectedModulationRatio,findNearestMeasureBoundary:S_,drawModulationPreview:hH});const B=(d.state.selectedTool==="note"||d.state.selectedTool==="chord")&&((Ct=d.state.selectedNote)==null?void 0:Ct.shape)==="circle",y=d.state.columnWidths.length,b=B?y-1:y;if(a<0||a>=b||ha(l)===null){Ih.resetHoverState(),f_();return}d_(a,l);const S=An.getSixteenthStampAtPosition(a,l),F=m===null?null:An.getTripletStampAtPosition(m,l),U=!!(S||F),D=U&&(h==="note"||h==="chord");if(U&&h!=="eraser"&&!qg.isDraggingShape()&&!$g.isDraggingShape()?sH(c):m_(),(h==="sixteenthStamp"||h==="tripletStamp")&&U)return;const R=qo.handleNoteOrChordDragMouseMove({colIndex:a,rowIndex:l,state:{isDragging:uA,isEraserDragActive:iA,activeNote:Ke,activeChordNotes:yr,activePreviewPitches:bs,lastDragRow:Ki}});if(R.handled){uA=R.state.isDragging,iA=R.state.isEraserDragActive,Ke=R.state.activeNote,yr=R.state.activeChordNotes,bs=R.state.activePreviewPitches,Ki=R.state.lastDragRow;return}if(!D&&qo.handleChordToolHover({colIndex:a,rowIndex:l,pitchHoverCtx:Se,zoomLevel:cs.getViewportInfo().zoomLevel,drawSingleColumnOvalNote:hg,drawTwoColumnOvalNote:ug}))return;if(td.handleMouseMove({event:e,colIndex:a,rowIndex:l,annotationService:qe})){Vl(a,l,"rgba(220, 53, 69, 0.3)");return}if(w_.handleMouseMove(a,l,iA)){Vl(a,l,"rgba(220, 53, 69, 0.3)");return}if(Se&&Ih.handleMouseMove({colIndex:a,rowIndex:l,hoverCtx:Se,getPitchForRow:ha})||D)return;const V=In(d.state),O=((Mt=d.state.selectedNote)==null?void 0:Mt.shape)==="circle";let K=null,z=!0;if(d.state.selectedTool==="note"||d.state.selectedTool==="chord")z=Xl(a,d.state)&&(!O||Xl(a+1,d.state));else if(d.state.selectedTool==="sixteenthStamp"){const Tt=zm(a);z=Tt!==null&&!zl(Tt,V)&&!zl(Tt+1,V)}else if(d.state.selectedTool==="tripletStamp"){const Tt=lc.getSelectedTripletStamp();if(Tt){const J=br(a,d.state);if(J===null)z=!1;else{K=J;const ot=(D0[Tt.span]??1)*2,vt=ds(K,d.state);z=!0;for(const ut of V){const Lt=ut.columnIndex,$t=ut.columnIndex+1;if(Lt>=vt&&Lt<vt+ot){z=!1;break}if(vt>=Lt&&vt<=$t){z=!1;break}}}}}const gt=d.state.selectedTool==="eraser"?"rgba(220, 53, 69, 0.3)":z?B_(.2):"rgba(220, 53, 69, 0.15)";if(Vl(a,l,gt),d.state.selectedTool==="sixteenthStamp"){const Tt=Zh.getSelectedSixteenthStamp();if(Tt&&z){const J=zm(a);if(J===null)return;const st={cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,columnWidths:d.state.columnWidths,musicalColumnWidths:d.state.columnWidths,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.cellWidth,macrobeatGroupings:d.state.macrobeatGroupings,previewColor:ky()};rF(Se,J,l,Tt,st)}}else if(d.state.selectedTool==="tripletStamp"){const Tt=lc.getSelectedTripletStamp();if(Tt&&z&&K!==null){const J={cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,columnWidths:d.state.columnWidths,musicalColumnWidths:d.state.columnWidths,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.cellWidth,macrobeatGroupings:d.state.macrobeatGroupings,previewColor:ky()};lF(Se,K,l,Tt,J)}}else z&&b_(a,l)}function da(){Se&&Se.clearRect(0,0,Vn(Se.canvas),tn(Se.canvas)),m_(),Ih.resetHoverState(),f_()}function __(){var e,t,n,i,r,A,a;if(!qo.handleToolMouseUp()){if(bs.length>0){An.stopCurrentPattern();const l=(Ke==null?void 0:Ke.color)??((e=yr[0])==null?void 0:e.color)??((t=d.state.selectedNote)==null?void 0:t.color);l&&ys.releasePitches(bs,l);const c=Ke;if(c&&l){const f=(n=d.state.timbres[l])==null?void 0:n.adsr;if(f){const m=((i=d.state.fullRowData[c.row])==null?void 0:i.hex)||"#888888";(r=jn.adsrComponent)==null||r.playheadManager.trigger(c.uuid,"release",m,f)}}else if(l){const f=bs[0];if(!f){bs=[];return}const m=d.state.fullRowData.find(w=>w.toneNote===f);if(m){const w=(A=d.state.timbres[l])==null?void 0:A.adsr;if(w){const B=m.hex;(a=jn.adsrComponent)==null||a.playheadManager.trigger("chord_preview","release",B,w)}}}bs=[];const h=window.waveformVisualizer;h&&h.stopLiveVisualization()}Ke!=null&&Ke.uuid&&Ko.has(Ke.uuid)&&(d.emit("noteRelease",{noteId:Ke.uuid,color:Ke.color}),Ko.delete(Ke.uuid)),yr.forEach(l=>{l!=null&&l.uuid&&Ko.has(l.uuid)&&(d.emit("noteRelease",{noteId:l.uuid,color:l.color}),Ko.delete(l.uuid))}),uA&&d.recordState(),uA=!1,Ki=null,Ke!=null&&Ke.uuid&&d.emit("noteInteractionEnd",{noteId:Ke.uuid}),yr.forEach(l=>{l.uuid&&d.emit("noteInteractionEnd",{noteId:l.uuid})}),Ke=null,yr=[],iA&&(d.recordState(),iA=!1),td.handleGlobalMouseUp(),da()}}function S_(e){const{macrobeatBoundaryStyles:t}=d.state,n=100,i=[],r=d.state.modulationMarkers&&d.state.modulationMarkers.length>0;x.debug("PitchGridInteractor","Boundary calculation modulation state",{hasModulation:r},"grid");for(let c=0;c<t.length;c++)if(t[c]==="solid"){const h=Tn(d.state,c);if(h){const f=h.endColumn+1,m=It(f,{...d.state,modulationMarkers:d.state.modulationMarkers||[],cellWidth:d.state.cellWidth,columnWidths:d.state.columnWidths,musicalColumnWidths:d.state.columnWidths,baseMicrobeatPx:d.state.cellWidth});x.debug("PitchGridInteractor","Computed measure boundary",{boundaryIndex:c,endColumn:h.endColumn,calculatedX:m,method:"canvas-space"},"grid"),i.push({measureIndex:c+1,xPosition:m,macrobeatIndex:c})}}const A=It(0,{...d.state,modulationMarkers:d.state.modulationMarkers||[],cellWidth:d.state.cellWidth,columnWidths:d.state.columnWidths,musicalColumnWidths:d.state.columnWidths,baseMicrobeatPx:d.state.cellWidth});x.debug("PitchGridInteractor","Start boundary position",{startBoundaryX:A,method:"canvas-space"},"grid"),i.unshift({measureIndex:0,xPosition:A,macrobeatIndex:-1}),x.debug("PitchGridInteractor","Available measure boundaries",{boundaries:i},"grid"),x.debug("PitchGridInteractor","Modulation click context",{clickX:e,tolerance:n},"grid");let a=null,l=1/0;return i.forEach(c=>{const h=Math.abs(e-c.xPosition);x.debug("PitchGridInteractor","Boundary distance check",{boundaryX:c.xPosition,distance:h},"grid"),h<=n&&h<l&&(l=h,a=c)}),a?x.debug("PitchGridInteractor","Found closest boundary",{boundary:a,distance:l},"grid"):x.debug("PitchGridInteractor","No boundary found within tolerance",{tolerance:n},"grid"),a}function hH(e,t,n){if(!n)return;const i=h0(n),r=u0(n);e.save();const A=3,a=2,l=tn(e.canvas);e.strokeStyle=i,e.lineWidth=a,e.globalAlpha=.7,e.setLineDash([]);for(let c=-1;c<=1;c++){const h=t+c*A;e.beginPath(),e.moveTo(h,0),e.lineTo(h,l),e.stroke()}e.globalAlpha=.8,e.font="12px Arial, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillStyle=i,e.fillText(`Preview: ${r}`,t,10),e.restore()}function dH(){const e=document.getElementById("notation-grid"),t=document.getElementById("hover-canvas");if(!e||!t){x.error("PitchGridInteractor","Could not find required canvas elements.",{hasPitchCanvas:!!e,hasHoverCanvas:!!t},"grid");return}if(Se=t.getContext("2d"),!Se){x.error("PitchGridInteractor","Could not get hover canvas context.",null,"grid");return}ol.setPitchCanvasElement(e),e.addEventListener("mousedown",cH),e.addEventListener("mousemove",uH),e.addEventListener("mouseleave",da),e.addEventListener("contextmenu",n=>n.preventDefault()),e.addEventListener("touchstart",n=>ol.handleTouchStart(n),{passive:!1}),e.addEventListener("touchmove",n=>ol.handleTouchMove(n),{passive:!1}),e.addEventListener("touchend",n=>ol.handleTouchEnd(n),{passive:!1}),e.addEventListener("touchcancel",()=>ol.handleTouchCancel(),{passive:!1}),window.addEventListener("mouseup",__)}const fH={init(){dH(),DR(),document.addEventListener("canvasResized",()=>{this.renderPitchGrid(),this.renderDrumGrid()}),d.on("animationUpdate",e=>{e.type==="vibrato"&&e.activeColors&&e.activeColors.length>0?this.renderPitchGrid():e.type==="envelopeFill"||e.hasEnvelopeFills?this.renderPitchGrid():e.type==="combined"&&e.vibratoColors&&e.vibratoColors.length>0&&this.renderPitchGrid()}),x.debug("GridManager","Initialized pitch and drum grid interactions",null,"grid")},renderPitchGrid:Zl.render,renderDrumGrid:os.render};function pH(){const e=fn.init();return Yl.setContexts(e),gR.init(),fH.init(),e}class mH{constructor(){P(this,"currentTool",null);P(this,"toolButtons",[]);P(this,"toolPanels",[]);P(this,"lastSelectedNote",null);P(this,"optionsContainers",{arrow:null,text:null,marker:null,highlighter:null,lasso:null});P(this,"settings",{arrow:{lineStyle:"solid",strokeWeight:4,startArrowhead:"none",endArrowhead:"filled-arrow",arrowheadSize:12},text:{color:"#000000",size:16,bold:!1,italic:!1,underline:!1,background:!1,superscript:!1,subscript:!1},marker:{color:"#4a90e2",size:6},highlighter:{color:"#4a90e2",size:10},lasso:{}})}initialize(){if(this.toolButtons=document.querySelectorAll(".draw-tool-button"),this.toolPanels=document.querySelectorAll(".draw-tool-panel"),this.optionsContainers={arrow:document.getElementById("arrow-tool-options"),text:document.getElementById("text-tool-options"),marker:document.getElementById("marker-tool-options"),highlighter:document.getElementById("highlighter-tool-options"),lasso:document.getElementById("lasso-tool-options")},!this.toolButtons.length||!this.optionsContainers.arrow){x.warn("DrawToolsController","Could not find draw tool elements",null,"draw");return}this.attachEventListeners(),this.setupChordTabListeners(),this.setupMainTabListeners(),this.populateAllPanels(),this.initializePanelWidthSync(),this.logPanelMetrics(),window.addEventListener("resize",()=>this.logPanelMetrics(),{passive:!0}),d.on("noteChanged",({newNote:t})=>{this.lastSelectedNote=t,this.currentTool&&this.deselectAllTools()})}attachEventListeners(){this.toolButtons.forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.drawTool;this.selectTool(n)})})}setupMainTabListeners(){document.querySelectorAll(".tab-button").forEach(n=>{n.addEventListener("click",()=>{n.dataset.tab!=="pitch"&&this.currentTool&&(this.deselectAllTools(),this.restoreLastSelectedNote())})})}setupChordTabListeners(){document.querySelectorAll(".pitch-tab-button").forEach(n=>{n.addEventListener("click",()=>{n.dataset.pitchTab!=="draw"&&this.currentTool&&(this.deselectAllTools(),this.restoreLastSelectedNote())})})}restoreLastSelectedNote(){this.lastSelectedNote?(d.setSelectedNote(this.lastSelectedNote.shape,this.lastSelectedNote.color),d.setSelectedTool("note")):d.state.selectedNote&&(d.setSelectedNote(d.state.selectedNote.shape,d.state.selectedNote.color),d.setSelectedTool("note"))}deselectAllTools(){this.toolButtons.forEach(t=>t.classList.remove("active")),this.toolPanels.forEach(t=>t.classList.remove("active")),this.currentTool=null,qe.setTool(null,null),d.state.selectedTool==="draw"&&d.setSelectedTool("note")}selectTool(t){var i;this.toolButtons.forEach(r=>r.classList.remove("active")),this.toolPanels.forEach(r=>r.classList.remove("active"));const n=Array.from(this.toolButtons).find(r=>r.dataset.drawTool===t);if(n){n.classList.add("active");const r=n.closest(".draw-tool-panel");r==null||r.classList.add("active")}this.currentTool=t,qe.setTool(t,this.settings),d.setSelectedTool("draw"),d.state.selectedNote={shape:"circle",color:((i=d.state.selectedNote)==null?void 0:i.color)||"#4a90e2"}}populateAllPanels(){this.populateArrowOptions(),this.populateTextOptions(),this.populateMarkerOptions(),this.populateHighlighterOptions()}initializePanelWidthSync(){const t=Array.from(this.toolPanels);t.length&&t.forEach(n=>{n.style.minWidth="",n.style.width="fit-content",n.style.maxWidth="100%",n.style.flex="0 0 auto"})}logPanelMetrics(){try{const t=document.querySelector(".draw-layout-grid");Array.from(this.toolPanels??[]).forEach(i=>{i.getBoundingClientRect()}),t==null||t.getBoundingClientRect()}catch{}}populateArrowOptions(){const t=this.optionsContainers.arrow;if(!t)return;const n=t.querySelector("#arrow-start-head-trigger"),i=t.querySelector("#arrow-end-head-trigger"),r=(w,B)=>B!=="filled-arrow"?`
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="4" y1="12" x2="20" y2="12"/>
          </svg>
        `:w==="start"?`
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9,5 3,12 9,19"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
          </svg>
        `:`
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,5 21,12 15,19"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
        </svg>
      `,A=(w,B,y)=>{w&&(w.innerHTML=r(B,y))},a=t.querySelector("#arrow-stroke-weight");a&&(a.value=`${this.settings.arrow.strokeWeight}`,a.addEventListener("input",()=>{this.settings.arrow.strokeWeight=parseInt(a.value,10),qe.setTool("arrow",this.settings)}));const l=t.querySelector("#arrow-head-size");l&&(l.value=`${this.settings.arrow.arrowheadSize}`,l.addEventListener("input",()=>{this.settings.arrow.arrowheadSize=parseInt(l.value,10),qe.setTool("arrow",this.settings)}));const c=Array.from(t.querySelectorAll("[data-line-style]"));if(c.length){const w=B=>{c.forEach(y=>y.classList.toggle("active",y.dataset.lineStyle===B))};w(this.settings.arrow.lineStyle),c.forEach(B=>{B.addEventListener("click",()=>{const y=B.dataset.lineStyle;y&&(this.settings.arrow.lineStyle=y,w(y),qe.setTool("arrow",this.settings))})})}const h=Array.from(t.querySelectorAll("[data-arrow-start]"));if(h.length){const w=B=>{h.forEach(y=>y.classList.toggle("active",y.dataset.arrowStart===B)),A(n,"start",B)};w(this.settings.arrow.startArrowhead),h.forEach(B=>{B.addEventListener("click",()=>{const y=B.dataset.arrowStart;y&&(this.settings.arrow.startArrowhead=y,w(y),qe.setTool("arrow",this.settings))})})}const f=Array.from(t.querySelectorAll("[data-arrow-end]"));if(f.length){const w=B=>{f.forEach(y=>y.classList.toggle("active",y.dataset.arrowEnd===B)),A(i,"end",B)};w(this.settings.arrow.endArrowhead),f.forEach(B=>{B.addEventListener("click",()=>{const y=B.dataset.arrowEnd;y&&(this.settings.arrow.endArrowhead=y,w(y),qe.setTool("arrow",this.settings))})})}const m=t.querySelector("#arrow-swap-heads");m&&m.addEventListener("click",()=>{const w=this.settings.arrow.startArrowhead;if(this.settings.arrow.startArrowhead=this.settings.arrow.endArrowhead,this.settings.arrow.endArrowhead=w,h.length){const B=this.settings.arrow.startArrowhead;h.forEach(y=>y.classList.toggle("active",y.dataset.arrowStart===B)),A(n,"start",B)}if(f.length){const B=this.settings.arrow.endArrowhead;f.forEach(y=>y.classList.toggle("active",y.dataset.arrowEnd===B)),A(i,"end",B)}qe.setTool("arrow",this.settings)})}populateTextOptions(){const t=this.optionsContainers.text;if(!t)return;const n=t.querySelector("#text-size-input");n&&(n.value=`${this.settings.text.size}`,n.addEventListener("input",()=>{this.settings.text.size=parseInt(n.value,10),qe.setTool("text",this.settings)}));const i=Array.from(t.querySelectorAll(".draw-color-button"));if(i.length){const A=a=>{i.forEach(l=>{const c=l.dataset.color||"";l.classList.toggle("active",c.toLowerCase()===a.toLowerCase())})};A(this.settings.text.color),i.forEach(a=>{a.addEventListener("click",()=>{const l=a.dataset.color;l&&(this.settings.text.color=l,A(l),qe.setTool("text",this.settings))})})}const r=Array.from(t.querySelectorAll("[data-text-style]"));if(r.length){const A=["bold","italic","underline","background","superscript","subscript"],a=l=>{this.settings.text[l]=!this.settings.text[l],qe.setTool("text",this.settings)};r.forEach(l=>{const c=l.dataset.textStyle;c&&A.includes(c)&&l.classList.toggle("active",!!this.settings.text[c])}),r.forEach(l=>{l.addEventListener("click",()=>{const c=l.dataset.textStyle;!c||!A.includes(c)||(a(c),l.classList.toggle("active",!!this.settings.text[c]))})})}}populateMarkerOptions(){const t=this.optionsContainers.marker;if(!t)return;const n=t.querySelector("#marker-size-input");n&&(n.value=`${this.settings.marker.size}`,n.addEventListener("input",()=>{this.settings.marker.size=parseInt(n.value,10),qe.setTool("marker",this.settings)}));const i=Array.from(t.querySelectorAll(".draw-color-button"));if(i.length){const r=A=>{i.forEach(a=>{const l=a.dataset.color||"";a.classList.toggle("active",l.toLowerCase()===A.toLowerCase())})};r(this.settings.marker.color),i.forEach(A=>{A.addEventListener("click",()=>{const a=A.dataset.color;a&&(this.settings.marker.color=a,r(a),qe.setTool("marker",this.settings))})})}}populateHighlighterOptions(){const t=this.optionsContainers.highlighter;if(!t)return;const n=t.querySelector("#highlighter-size-input");n&&(n.value=`${this.settings.highlighter.size}`,n.addEventListener("input",()=>{this.settings.highlighter.size=parseInt(n.value,10),qe.setTool("highlighter",this.settings)}));const i=Array.from(t.querySelectorAll(".draw-color-button"));if(i.length){const r=A=>{i.forEach(a=>{const l=a.dataset.color||"";a.classList.toggle("active",l.toLowerCase()===A.toLowerCase())})};r(this.settings.highlighter.color),i.forEach(A=>{A.addEventListener("click",()=>{const a=A.dataset.color;a&&(this.settings.highlighter.color=a,r(a),qe.setTool("highlighter",this.settings))})})}}}const Tp=new mH;function gH(){var e;return qe.initialize(),(e=Tp.initialize)==null||e.call(Tp),x.initSuccess("DrawSystem"),typeof window<"u"&&(window.annotationService=qe),{annotationService:qe}}x.moduleLoaded("KeyboardHandler","keyboard");function wH(){document.addEventListener("keydown",e=>{var A;const t=document.activeElement;if(!t)return;const n=t.tagName.toLowerCase(),i=t.contentEditable==="true";if(["input","textarea"].includes(n)||i)return;if(e.ctrlKey&&e.key.toLowerCase()==="p"){e.preventDefault(),x.info("KeyboardHandler","Ctrl+P pressed. Opening print preview",null,"keyboard"),d.emit("printPreviewStateChanged",!0);return}if(e.ctrlKey&&e.key.toLowerCase()==="z"){e.preventDefault(),d.undo();return}if(e.ctrlKey&&e.key.toLowerCase()==="y"){e.preventDefault(),d.redo();return}let r=!1;switch(e.key){case"Backspace":case"Delete":if((A=d.state.lassoSelection)!=null&&A.isActive){const a=d.state.lassoSelection.selectedItems;a.forEach(l=>{if(l.type==="note"){const c=l.data,h=d.state.placedNotes.findIndex(f=>f.uuid===c.uuid);h!==-1&&d.state.placedNotes.splice(h,1)}else if(l.type==="sixteenthStamp"){const c=l.data,h=d.state.sixteenthStampPlacements.findIndex(f=>f.id===c.id);h!==-1&&d.state.sixteenthStampPlacements.splice(h,1)}else if(l.type==="tripletStamp"){const c=l.data,h=d.state.tripletStampPlacements.findIndex(f=>f.id===c.id);h!==-1&&d.state.tripletStampPlacements.splice(h,1)}}),d.state.lassoSelection={selectedItems:[],convexHull:null,isActive:!1},d.recordState(),d.emit("render"),r=!0,x.info("KeyboardHandler",`Deleted ${a.length} items from lasso selection`,null,"keyboard")}break}r&&e.preventDefault()}),x.info("KeyboardHandler","Initialized",null,"keyboard")}x.moduleLoaded("TransportKeyboardShortcuts","keyboard");function vH(){const e=document.activeElement;if(!(e instanceof HTMLElement))return!0;const t=e.tagName.toLowerCase();return!(["input","textarea","select"].includes(t)||e.isContentEditable)}function BH(){let e=!1;document.addEventListener("keydown",t=>{if(t.code!=="Space"||e||t.repeat||!vH())return;const n=document.getElementById("play-button");n&&(t.preventDefault(),e=!0,n.click())}),document.addEventListener("keyup",t=>{t.code==="Space"&&(e=!1)}),x.info("TransportKeyboardShortcuts","Initialized",null,"keyboard")}const yH=[{label:"Toolbar",selector:"#toolbar"},{label:"Toolbar Primary",selector:"#toolbar-primary"},{label:"Primary Actions Grid",selector:"#toolbar-primary .primary-toolbar-actions"},{label:"Primary Playback Row",selector:"#toolbar-primary .primary-toolbar-playback"},{label:"Toolbar Secondary",selector:"#toolbar-secondary"},{label:"Toolbar Preset Controls",selector:"#toolbar-secondary .preset-effects-controls"},{label:"Toolbar Tab Sidebar",selector:"#toolbar-secondary .tab-sidebar"},{label:"Sidebar",selector:"#sidebar"},{label:"Timbre Tab Panel",selector:"#timbre-panel"},{label:"Pitch Tab Panel",selector:"#pitch-panel"},{label:"Rhythm Tab Panel",selector:"#rhythm-panel"},{label:"Macrobeat Tools",selector:"#canvas-macrobeat-tools, #macrobeat-tools"},{label:"Waveform Card",selector:"#timbre-panel .waveform-content-box"},{label:"Preset Card",selector:"#timbre-panel .preset-content-box"},{label:"Effects Card",selector:"#timbre-panel #effects-panel .effects-content-box"},{label:"Envelope Card",selector:"#adsr-envelope"},{label:"Harmonics Card",selector:".harmonic-bins-container"},{label:"Canvas Container",selector:"#canvas-container"},{label:"Pitch Grid Wrapper",selector:"#pitch-grid-wrapper"},{label:"Pitch Grid Container",selector:"#pitch-grid-container"},{label:"Drum Grid Wrapper",selector:"#drum-grid-wrapper"},{label:"Drum Grid",selector:"#drum-grid"}],Xm=new Map;let Ym,Fp,Ip=null,al="",$o=!1;function Qu(e){return Number.isFinite(e)?Number(e.toFixed(1)):e}function CH(e){const t=e.getBoundingClientRect(),n=window.getComputedStyle(e);return{tag:e.tagName.toLowerCase(),id:e.id||null,class:e.className||null,top:Qu(t.top),left:Qu(t.left),width:Qu(t.width),height:Qu(t.height),offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,clientWidth:e.clientWidth,clientHeight:e.clientHeight,display:n.display,position:n.position,overflowX:n.overflowX,overflowY:n.overflowY,transform:n.transform!=="none"?n.transform:void 0}}function x_(e="manual"){const t=window.__uiDiagnosticsTrackedElements;if(!t)return[];if(!$o&&e!=="manual")return[];th();const n=[];return t.forEach(i=>{const r=Array.from(document.querySelectorAll(i.selector));if(!r.length){n.push({label:i.label,selector:i.selector,missing:!0});return}r.forEach((A,a)=>{const l=r.length>1?`${i.label} [${a}]`:i.label,c=CH(A);n.push({label:l,selector:i.selector,info:c})})}),window.__uiDiagnosticsLastSnapshot=n,n}function Lo(e){$o&&(al=al?`${al}; ${e}`:e,Ip===null&&(Ip=requestAnimationFrame(()=>{const t=al||"auto";Ip=null,al="",x_(t)})))}function th(){const e=window.__uiDiagnosticsTrackedElements;!e||!Ym||e.forEach(t=>{document.querySelectorAll(t.selector).forEach(i=>{Xm.has(i)||(Xm.set(i,t.label),Ym.observe(i),i.addEventListener("scroll",()=>Lo(`${t.label} scroll`),{passive:!0}))})})}function bH(e={}){if(window.__uiDiagnosticsInitialized)return;window.__uiDiagnosticsInitialized=!0;const{elements:t,autoLog:n=!1}=e;$o=!!n,window.__uiDiagnosticsAutoLog=$o;const i=t||yH;window.__uiDiagnosticsTrackedElements=i,Ym=new ResizeObserver(r=>{const A=r.map(a=>Xm.get(a.target)||a.target.id||a.target.tagName.toLowerCase()).filter(Boolean);A.length&&Lo(`Resize: ${A.join(", ")}`)}),Fp=new MutationObserver(()=>th()),document.body?Fp.observe(document.body,{childList:!0,subtree:!0}):document.addEventListener("DOMContentLoaded",()=>{Fp.observe(document.body,{childList:!0,subtree:!0}),th(),Lo("init")},{once:!0}),window.addEventListener("resize",()=>Lo("window resize")),th(),Lo("init"),window.logUIState=(r="manual")=>x_(r),window.enableUIDiagnosticsAutoLog=()=>{$o=!0,window.__uiDiagnosticsAutoLog=!0,Lo("auto-log enabled")},window.disableUIDiagnosticsAutoLog=()=>{$o=!1,window.__uiDiagnosticsAutoLog=!1}}function _H(){x.section("SETTING UP INPUT HANDLERS"),wH(),BH(),RR(),window.enableUIDiagnostics&&bH()}function SH(){d.on("tempoChanged",()=>{ye.setBpm(d.state.tempo)}),d.on("layoutChanged",()=>{fn.reflow()}),d.on("rhythmPatternChanged",()=>{An.refresh&&An.refresh()});const e=()=>{var t;try{Zl.render(),(t=os.render)==null||t.call(os),x.debug("StateSubscriptions","renderAll invoked",null,"grid")}catch(n){x.error("StateSubscriptions","renderAll failed",n,"grid")}};return d.on("notesChanged",e),d.on("sixteenthStampPlacementsChanged",e),d.on("tripletStampPlacementsChanged",e),d.on("accidentalModeChanged",e),d.on("frequencyLabelsChanged",e),d.on("focusColoursChanged",e),d.on("octaveLabelsChanged",e),d.on("degreeDisplayModeChanged",e),d.on("longNoteStyleChanged",e),d.on("layoutConfigChanged",()=>{Zl.renderMacrobeatTools()}),d.on("rhythmStructureChanged",()=>{fn.reflow()}),d.on("modulationMarkersChanged",()=>{fn.reflow(),e()}),x.initSuccess("StateSubscriptions"),{renderAll:e}}let Ly=!1,ll=null;window.initAudio=async()=>{if(!Ly)return ll||(ll=(async()=>{try{et.context.state!=="running"&&(await et.start(),x.info("Main.js","AudioContext started successfully")),Ly=!0}catch(e){throw x.error("Main.js","Could not start AudioContext",e),ll=null,e}})(),ll)};let Ry=!1;const na=()=>{var e;Ry||(Ry=!0,(e=window.initAudio)==null||e.call(window).catch(t=>x.warn("Main.js","Failed to initialize audio after user interaction",t,"initialization")),document.removeEventListener("click",na,!0),document.removeEventListener("keydown",na,!0),document.removeEventListener("touchstart",na,!0))};document.addEventListener("click",na,!0);document.addEventListener("keydown",na,!0);document.addEventListener("touchstart",na,!0);window.addEventListener("beforeunload",()=>{typeof ye.teardown=="function"&&ye.teardown()});const Mh={domCache:!1,layoutService:!1,canvasContextService:!1,synthEngine:!1,transportService:!1,scrollSync:!1,uiComponents:!1,audioComponents:!1,rhythmPlaybackService:!1,initialized:!1},xH={top:"G5",bottom:"C4"};function EH(e){if(!(e!=null&&e.top)||!(e!=null&&e.bottom))return null;const t=Fe.findIndex(i=>i.toneNote===e.top),n=Fe.findIndex(i=>i.toneNote===e.bottom);return t===-1||n===-1?(x.warn("Main.js","Failed to resolve preset range from tone notes",e),null):{topIndex:Math.min(t,n),bottomIndex:Math.max(t,n)}}function TH(){return EH(xH)}function hr(e){Mh[e]=!0}function Hy(e,t=5e3){return new Promise((n,i)=>{if(Mh[e]){n();return}const r=Date.now(),A=()=>{Mh[e]?n():Date.now()-r>t?i(new Error(`Component ${e} not ready within ${t}ms`)):setTimeout(A,50)};A()})}document.addEventListener("DOMContentLoaded",()=>void(async()=>{window.initStartTime=Date.now(),x.info("Main.js","DOMContentLoaded event fired"),x.section("STARTING INITIALIZATION");const e=["dom-cache","core-services","ui-components","audio-components","initial-render","finalize"];try{Kn.init(),e.forEach(a=>Kn.registerTask(a)),m2(),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&hb(),Kn.updateStatus("Initializing interface..."),Sr.init(),hr("domCache"),Kn.completeTask("dom-cache"),(()=>{const a=Sr.get("appContainer")||document.getElementById("app-container");if(a){const l=["click","keydown","touchstart"],c=()=>{var h;(h=window.initAudio)==null||h.call(window)};l.forEach(h=>{a.addEventListener(h,c,{once:!0})})}})(),Kn.updateStatus("Preparing core systems..."),C2(d.state);const n=d.state.pitchRange||{topIndex:0,bottomIndex:Fe.length-1},i=Math.max(0,Math.min(Fe.length-1,n.topIndex??0)),r=Math.max(i,Math.min(Fe.length-1,n.bottomIndex??Fe.length-1));d.state.pitchRange={topIndex:i,bottomIndex:r},d.state.fullRowData=[...Fe],pH(),hr("layoutService"),hr("canvasContextService"),await fn.waitForInitialLayout(),ye.init(),hr("synthEngine"),An.initialize().catch(a=>{x.warn("Main.js","RhythmPlaybackService initialization deferred (needs user interaction)",a,"initialization")}),hr("rhythmPlaybackService"),Wi.init(),hr("transportService"),_H(),W1(d),pT(d),Kn.completeTask("core-services"),Kn.updateStatus("Loading interface components..."),CL(),hr("uiComponents"),Kn.completeTask("ui-components"),await Hy("uiComponents"),Kn.updateStatus("Preparing audio components..."),hR(),hr("audioComponents"),Kn.completeTask("audio-components"),b2(d.state,"audio-components-initialization"),pR(),gH(),await Hy("audioComponents"),x.section("SETTING UP STATE SUBSCRIPTIONS");const{renderAll:A}=SH();if(x.section("PERFORMING INITIAL RENDER"),d.setSelectedTool("note"),d.setSelectedNote("circle","#4a90e2"),Kn.updateStatus("Rendering workspace..."),A(),Zl.renderMacrobeatTools(),Kn.completeTask("initial-render"),Wu.prefetchButtonGridSnapshot(),hr("initialized"),x.section("INITIALIZATION COMPLETE"),Kn.updateStatus("Finalizing..."),Kn.completeTask("finalize"),d.isColdStart){const a=TH();a?cs.setPitchViewportRange(a,{animateMs:0,source:"coldStart:treble"}):x.warn("Main.js","Treble Clef preset range could not be resolved during cold start")}await Kn.complete(),window.ModulationTest=pb}catch(t){x.error("Main.js","Initialization failed",t,"initialization"),x.error("Main.js","Component readiness snapshot at failure",{...Mh},"initialization");const n=t instanceof Error?t:new Error(String(t));Kn.showError(n);const i=document.createElement("div");i.style.cssText=`
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #ff4444; color: white; padding: 20px; border-radius: 8px;
            z-index: 10000; font-family: monospace; max-width: 80vw;
        `,i.innerHTML=`
            <h3>Initialization Error</h3>
            <p>The application failed to initialize properly.</p>
            <details>
                <summary>Technical Details</summary>
                <pre>${n.message}</pre>
                <pre>Stack: ${n.stack}</pre>
            </details>
            <button onclick="location.reload()">Reload Page</button>
        `,document.body.appendChild(i)}})());
