<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Interactive Diatonic Compass - A visual music theory tool for exploring keys, modes, and scales with keyboard navigation and screen reader support." />
<meta name="keywords" content="music theory, diatonic compass, scales, modes, accessibility, keyboard navigation" />
<meta name="author" content="Quinn Fleming" />

<!-- Accessibility meta tags -->
<meta name="theme-color" content="#33c6dc" />
<meta name="color-scheme" content="light dark" />

<!-- Favicons -->
<link rel="icon" type="image/x-icon" href="/diatonic-compass/assets/favicon-EiJHQ7f4.ico"/>
<link rel="icon" type="image/svg+xml" href="/diatonic-compass/assets/favicon-oxmeNcL9.svg" />
<link rel="icon" type="image/png" sizes="96x96" href="/diatonic-compass/assets/favicon-96x96-BFjbGiHf.png" />
<link rel="icon" type="image/png" sizes="192x192" href="/diatonic-compass/assets/web-app-manifest-192x192-CQUvWY5p.png" />
<link rel="icon" type="image/png" sizes="512x512" href="/diatonic-compass/assets/web-app-manifest-512x512-DMiNyMET.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/diatonic-compass/assets/apple-touch-icon-BWxcdW_v.png" />
<link rel="manifest" href="/diatonic-compass/assets/site-CKlQVrJF.webmanifest" />

<title>Diatonic Compass - Interactive Music Theory Tool</title>

<!-- Main stylesheets -->

<!-- Prevent flash of light content in dark mode -->
<script>
  (function() {
    try {
      const savedTheme = localStorage.getItem('diatonic-compass-theme');
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const shouldUseDark = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
      
      if (shouldUseDark) {
        // Add to documentElement so it's available before body exists
        document.documentElement.classList.add('dark-mode-pending');
      }
    } catch (e) {
      // Gracefully handle localStorage errors
      console.warn('Could not load theme preference:', e);
    }
  })();
</script>

<!-- Accessibility enhancements -->
<style>
  /* Critical accessibility styles loaded inline to prevent FOUC */
  .sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }
  
  *:focus {
    outline: 2px solid #33c6dc;
    outline-offset: 2px;
  }
  
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
  <script type="module" crossorigin src="/diatonic-compass/assets/index-C261EOi0.js"></script>
  <link rel="stylesheet" crossorigin href="/diatonic-compass/assets/index-C1PKDEHm.css">
</head>
<body>

<!-- Apply dark mode immediately to prevent FOUC -->
<script>
  if (document.documentElement.classList.contains('dark-mode-pending')) {
    document.body.classList.add('dark-mode');
    document.documentElement.classList.remove('dark-mode-pending');
  }
</script>

<!-- Settings button with enhanced accessibility -->
<button id="settings-btn"
        aria-label="Open settings sidebar"
        aria-controls="sidebar"
        aria-expanded="false"
        aria-describedby="settings-btn-help">
  <img src="/diatonic-compass/assets/Settings_optimized-TJsqx0gz.svg" alt="" width="48" height="48">
</button>
<div id="settings-btn-help" class="sr-only">
  Opens a panel with display options, theme settings, and keyboard shortcuts
</div>

<!-- Enhanced sidebar with better structure -->
<nav id="sidebar" 
     role="complementary" 
     aria-hidden="true"
     aria-labelledby="sidebar-title">
  <div class="sidebar-content">
    <h2 id="sidebar-title">Diatonic Compass</h2>
    
    <!-- Tutorial button at top -->
    <button id="start-tutorial-btn" 
            class="sidebar-btn tutorial-btn"
            aria-describedby="tutorial-help">Start Tutorial</button>
    <div id="tutorial-help" class="sr-only">
      Begin an interactive tutorial explaining how to use the Diatonic Compass
    </div>
    
    <!-- Layout Orientation setting -->
    <div class="sidebar-section">
      <h3 class="sidebar-subheader">Orientation</h3>
      <div class="toggle-switch-container">
        <div class="toggle-switch" id="orientation-toggle">
          <input type="radio" name="orientation" id="orientation-horizontal" value="horizontal" checked>
          <label for="orientation-horizontal">Horizontal</label>
          <input type="radio" name="orientation" id="orientation-vertical" value="vertical">
          <label for="orientation-vertical">Vertical</label>
          <div class="toggle-slider"></div>
        </div>
      </div>
    </div>
    
    <!-- Accidentals setting -->
    <div class="sidebar-section">
      <h3 class="sidebar-subheader">Accidentals</h3>
      <div class="accidentals-controls">
        <button id="flat-btn" 
                class="accidental-toggle" 
                aria-pressed="true" 
                aria-label="Show flat note names">♭</button>
        <button id="sharp-btn" 
                class="accidental-toggle" 
                aria-pressed="true" 
                aria-label="Show sharp note names">♯</button>
      </div>
    </div>
    
    <!-- Theme setting -->
    <div class="sidebar-section">
      <h3 class="sidebar-subheader">Colour Theme</h3>
      <div class="toggle-switch-container">
        <div class="toggle-switch" id="theme-toggle">
          <input type="radio" name="theme" id="theme-light" value="light" checked>
          <label for="theme-light">Light</label>
          <input type="radio" name="theme" id="theme-dark" value="dark">
          <label for="theme-dark">Dark</label>
          <div class="toggle-slider"></div>
        </div>
      </div>
    </div>

    <!-- Cursor Color setting -->
    <div class="sidebar-section">
      <h3 class="sidebar-subheader">Cursor Colour</h3>
      <div class="cursor-color-picker" role="radiogroup" aria-label="Select cursor color">
        <button class="cursor-color-btn active"
                data-color="red"
                data-fill="false"
                aria-label="Red outline"
                role="radio"
                aria-checked="true">
          <div class="color-square red-outline"></div>
        </button>
        <button class="cursor-color-btn"
                data-color="red"
                data-fill="true"
                aria-label="Red with fill"
                role="radio"
                aria-checked="false">
          <div class="color-square red-fill"></div>
        </button>
        <button class="cursor-color-btn"
                data-color="blue"
                data-fill="true"
                aria-label="Blue with fill"
                role="radio"
                aria-checked="false">
          <div class="color-square blue-fill"></div>
        </button>
        <button class="cursor-color-btn"
                data-color="green"
                data-fill="true"
                aria-label="Green with fill"
                role="radio"
                aria-checked="false">
          <div class="color-square green-fill"></div>
        </button>
        <button class="cursor-color-btn"
                data-color="yellow"
                data-fill="true"
                aria-label="Yellow with fill"
                role="radio"
                aria-checked="false">
          <div class="color-square yellow-fill"></div>
        </button>
      </div>
    </div>

    <!-- Component Order setting -->
    <div class="sidebar-section">
      <h3 class="sidebar-subheader">Component Order</h3>
      <div id="order-container" aria-describedby="order-help">
        <div id="order-help" class="sr-only">
          Drag the components to reorder how they appear in the interface
        </div>
        <div id="belt-order-list" role="listbox" aria-label="Component ordering controls">
          <!-- Components will be populated by OrderManager -->
        </div>
      </div>
    </div>
    
    <!-- Keyboard Shortcuts info -->
    <div class="sidebar-section">
      <h3 class="sidebar-subheader">Keyboard Shortcuts</h3>
      <div class="accessibility-text">
        <p> <span class="key">Tab</span> Navigate between controls</p>
        <p> <span class="key">Arrow keys</span> Rotate ring / belt</p>
        <p> <span class="key">Space</span>/<span class="key">Enter</span>: Play scale</p>
        <p> <span class="key">F</span> Toggle flat note names</p>
        <p> <span class="key">S</span> Toggle sharp note names</p>
        <p> <span class="key">V</span> Toggle vertical/horizontal layout</p>
        <p> <span class="key">F1</span> Open/close settings</p>
      </div>
    </div>
    
    <!-- Credit -->
    <div class="sidebar-credit">
      <small>Created by Quinn Fleming</small>
    </div>
  </div>
</nav>

<!-- Sidebar overlay for mobile -->
<div id="sidebar-overlay" aria-hidden="true"></div>

<!-- Main application content -->
<main class="main-container" 
      id="main-content"
      role="application" 
      aria-label="Diatonic Compass interactive music theory tool">
  
  <!-- Wheel container with enhanced accessibility -->
  <section class="wheel-container" aria-labelledby="wheel-title">
    <h2 id="wheel-title" class="sr-only">Interactive Compass Wheel</h2>
    <canvas id="chromaWheel" 
            aria-label="Three-ring musical compass: outer ring for pitch classes, middle ring for scale degrees, inner ring for chromatic positions"
            aria-describedby="wheel-instructions"
            tabindex="0"
            role="img"></canvas>
    <div id="wheel-instructions" class="sr-only">
      Use arrow keys to rotate the rings and explore different musical keys and modes. 
      Left and right arrows control the outer pitch ring, 
      up and down arrows control the middle degree ring, 
      shift plus arrows control the inner chromatic ring.
    </div>
  </section>
  
  <!-- Belts container with enhanced structure -->
  <section class="belts-container" aria-labelledby="belts-title">
    <h2 id="belts-title" class="sr-only">Musical Information Belts</h2>
    
    <!-- Visual cursor and flash overlay -->
    <div id="belt-cursor" aria-hidden="true"></div>
    <div id="belt-flash-overlay" aria-hidden="true"></div>
    
    <!-- Pitch belt -->
    <div class="belt pitch-belt" 
         id="pitchBelt" 
         role="listbox" 
         aria-label="Pitch names belt"
         aria-describedby="pitch-belt-desc"
         tabindex="0">
      <div id="pitch-belt-desc" class="sr-only">
        Shows pitch class names like C, D, E. Drag or use left/right arrow keys to change.
      </div>
    </div>
    
    <!-- Degree belt -->
    <div class="belt degree-belt" 
         id="degreeBelt" 
         role="listbox" 
         aria-label="Scale degrees belt"
         aria-describedby="degree-belt-desc"
         tabindex="0">
      <div id="degree-belt-desc" class="sr-only">
        Shows scale degree numbers like 1, 2, 3. Drag or use up/down arrow keys to change mode.
      </div>
    </div>

    <!-- Interval brackets (decorative) -->
    <div class="interval-brackets-wrapper" 
         aria-hidden="true" 
         role="presentation">
      <div class="interval-brackets-container" 
           id="intervalBracketsContainer" 
           role="presentation"></div>
    </div>

    <!-- Chromatic belt -->
    <div class="belt chromatic-belt" 
         id="chromaticBelt" 
         role="listbox" 
         aria-label="Chromatic positions belt"
         aria-describedby="chromatic-belt-desc"
         tabindex="0">
      <div id="chromatic-belt-desc" class="sr-only">
        Shows chromatic position numbers 0 through 11. Drag or use shift+arrow keys to change perspective.
      </div>
      <!-- Color track (moves with degree ring) -->
      <div id="chromatic-colors-track" 
           class="belt-track" 
           aria-hidden="true"></div>
      <!-- Numbers track (moves with chromatic ring) -->
      <div id="chromatic-numbers-track" 
           class="belt-track"
           aria-hidden="true"></div>
    </div>
  </section>
  
  <!-- Result display with enhanced accessibility -->
  <section id="result-container"
           role="region"
           aria-label="Current musical key and mode"
           aria-describedby="result-instructions"
           tabindex="0">
    <div id="result-text"
         role="status"
         aria-live="polite"
         aria-atomic="true"></div>
    <div id="result-instructions" class="sr-only">
      Shows the current key and mode. Click or press space to play the scale.
    </div>
  </section>
</main>

<!-- Tutorial elements with enhanced accessibility -->
<div id="tutorial-mask" 
     aria-hidden="true" 
     role="presentation"></div>
<dialog id="tutorial-bubble" 
        role="dialog" 
        aria-labelledby="tutorial-text" 
        aria-modal="true"
        aria-describedby="tutorial-instructions">
  <div id="tutorial-text" aria-live="assertive"></div>
  <div id="tutorial-instructions" class="sr-only">
    Tutorial dialog. Follow the spoken instructions and interact with the highlighted elements.
  </div>
</dialog>

<!-- Status messages for screen readers -->
<div id="status-messages" aria-live="polite" aria-atomic="false" class="sr-only"></div>
<div id="urgent-messages" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>

<!-- Feature detection and graceful degradation -->
<script>
  // Feature detection for graceful degradation
  if (!window.AudioContext && !window.webkitAudioContext) {
    console.warn('Web Audio API not supported - audio features will be disabled');
  }
  
  if (!window.PointerEvent) {
    console.warn('Pointer events not supported - using fallback interaction');
  }
  
  // Accessibility preference detection
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    document.body.classList.add('reduced-motion');
  }
  
  if (window.matchMedia('(prefers-contrast: high)').matches) {
    document.body.classList.add('high-contrast');
  }
  
  // Error boundary for the main application
  window.addEventListener('error', function(e) {
    console.error('Application error:', e.error);
    // Could show user-friendly error message here
  });
  
  window.addEventListener('unhandledrejection', function(e) {
    console.error('Unhandled promise rejection:', e.reason);
    e.preventDefault();
  });
</script>


<!-- Structured data for search engines -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Diatonic Compass",
  "description": "Interactive music theory tool for exploring keys, modes, and scales",
  "url": "https://iambored456.github.io/Diatonic-Compass/",
  "author": {
    "@type": "Person",
    "name": "Quinn Fleming"
  },
  "applicationCategory": "EducationApplication",
  "operatingSystem": "Web Browser",
  "accessibilityFeature": [
    "alternativeText",
    "keyboardNavigation",
    "screenReaderSupport",
    "highContrastDisplay",
    "reducedMotionSupport"
  ],
  "accessibilityControl": [
    "keyboardControl",
    "mouseControl",
    "touchControl"
  ]
}
</script>

</body>
</html>