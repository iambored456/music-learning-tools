var Sn=Object.defineProperty;var kn=(a,e,t)=>e in a?Sn(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var Vr=(a,e,t)=>kn(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const En="modulepreload",On=function(a){return"/diatonic-compass/"+a},Wr={},Je=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let s=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=s(t.map(c=>{if(c=On(c),c in Wr)return;Wr[c]=!0;const h=c.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":En,h||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((g,m)=>{f.addEventListener("load",g),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})},Lt=["C","C♯/D♭","D","D♯/E♭","E","F","F♯/G♭","G","G♯/A♭","A","A♯/B♭","B"],Bt=["1","♯1/♭2","2","♯2/♭3","3","4","♯4/♭5","5","♯5/♭6","6","♯6/♭7","7"],An=[...Array(12).keys()],Se=12,Nt=[0,2,4,5,7,9,11],mt={C:!0,"C♯/D♭":!1,D:!0,"D♯/E♭":!1,E:!0,F:!0,"F♯/G♭":!1,G:!0,"G♯/A♭":!1,A:!0,"A♯/B♭":!1,B:!0},ar={0:"#f090ae",2:"#ea9e5e",4:"#a8bd61",5:"#76c788",7:"#33c6dc",9:"#94adff",11:"#dd95d6",1:"#a46055",3:"#8a722f",6:"#258677",8:"#3d7ca5",10:"#7d68a3"},Pn={1:[0,2,4,5,7,9,11],2:[0,2,3,5,7,9,10],3:[0,1,3,5,7,8,10],4:[0,2,4,6,7,9,11],5:[0,2,4,5,7,9,10],6:[0,2,3,5,7,8,10],7:[0,1,3,5,6,8,10]},fi={1:"1","♯1/♭2":"2",2:"2","♯2/♭3":"3",3:"3",4:"4","♯4/♭5":"5",5:"5","♯5/♭6":"6",6:"6","♯6/♭7":"7",7:"7"},In={1:"Major",2:"Dorian",3:"Phrygian",4:"Lydian",5:"Mixolydian",6:"Minor",7:"Locrian"},Dn=[2,2,1,2,2,2,1],Ye=Math.PI*2,Y=Ye/12,Q={ANIMATION:{DURATION_MS:300},WHEEL:{FONTS:{OUTER_FACTOR:.057,MIDDLE_FACTOR:.052,INNER_FACTOR:.042}},AUDIO:{BASE_FREQUENCY:261.63,NOTE_DURATION_MS:250,PAUSE_BETWEEN_NOTES_MS:50},ERROR_HANDLING:{CONTEXTS:{AUDIO:"AudioContext",ANIMATION:"Animation",UI:"UI",APP:"App"}}},Mn=Q.WHEEL.FONTS.OUTER_FACTOR,Rn=Q.WHEEL.FONTS.MIDDLE_FACTOR,Ln=Q.WHEEL.FONTS.INNER_FACTOR,Bn=Q.ANIMATION.DURATION_MS,Gr=Q.AUDIO.NOTE_DURATION_MS,Nn=Q.AUDIO.PAUSE_BETWEEN_NOTES_MS,Fn=Q.AUDIO.BASE_FREQUENCY,_={rings:{pitchClass:0,degree:0,chromatic:0,highlightPosition:0},drag:{active:null,startX:0,startY:0,startPitchClass:0,startDegree:0,startChrom:0,startHighlight:0},animation:null,belts:{itemSize:{},tracks:{},init:!1,orientation:"horizontal",order:["pitch","degree","intervals","chromatic"],layoutOrder:{horizontal:["compass","pitch","degree","intervals","chromatic","result"],vertical:["compass","result"]}},dimensions:{size:0,cx:0,cy:0,dpr:1},playback:{isPlaying:!1,currentNoteIndex:null,sequence:[],timeoutId:null,audioContext:null,rootNoteIndexForPlayback:null},display:{sharp:!0,flat:!0},ui:{sidebarOpen:!1,darkMode:!1,cursorColor:"red",cursorFill:!1,display:{get sharp(){return _.display.sharp},get flat(){return _.display.flat},set sharp(a){_.display.sharp=a},set flat(a){_.display.flat=a}}},performance:{needsRedraw:!0,lastRenderState:null,frameSkipCounter:0,isLowPowerMode:!1}},Yr=Object.freeze(Object.defineProperty({__proto__:null,appState:_},Symbol.toStringTag,{value:"Module"}));function zn(a){function e(t){a(t),requestAnimationFrame(e)}requestAnimationFrame(e)}class E{static handle(e,t,r=null){const i={message:e.message,stack:e.stack,context:t,timestamp:Date.now(),userAgent:navigator.userAgent};if(console.error(`[${t}] Error:`,e),this.logError(i),r)try{r()}catch(n){console.error(`[${t}] Fallback failed:`,n)}this.attemptRecovery(t,e)}static logError(e){try{const t=JSON.parse(sessionStorage.getItem("diatonic-errors")||"[]");t.push(e);const r=t.slice(-20);sessionStorage.setItem("diatonic-errors",JSON.stringify(r))}catch(t){this.isDebugMode&&console.warn("Could not log error to sessionStorage:",t)}}static attemptRecovery(e,t){switch(e){case"AudioContext":this.recoverAudioContext();break;case"Canvas":this.recoverCanvas();break;case"Animation":this.recoverAnimation();break;case"LocalStorage":this.recoverLocalStorage();break;case"Resize":console.warn("Resize error detected - may self-resolve");break;default:this.isDebugMode&&console.warn(`No specific recovery strategy for context: ${e}`)}}static recoverAudioContext(){Je(async()=>{const{appState:e}=await Promise.resolve().then(()=>Yr);return{appState:e}},void 0).then(({appState:e})=>{if(e.playback.audioContext){try{e.playback.audioContext.close()}catch{}e.playback.audioContext=null}e.playback.isPlaying&&(e.playback.isPlaying=!1,e.playback.currentNoteIndex=null,e.playback.sequence=[],e.playback.timeoutId&&(clearTimeout(e.playback.timeoutId),e.playback.timeoutId=null))})}static recoverCanvas(){requestAnimationFrame(()=>{console.log("Attempting canvas recovery via redraw")})}static recoverAnimation(){Je(async()=>{const{appState:e}=await Promise.resolve().then(()=>Yr);return{appState:e}},void 0).then(({appState:e})=>{e.animation=null,e.drag.active=null})}static recoverLocalStorage(){console.warn("LocalStorage unavailable - preferences will not persist")}static getErrorLog(){try{return JSON.parse(sessionStorage.getItem("diatonic-errors")||"[]")}catch{return[]}}static clearErrorLog(){try{sessionStorage.removeItem("diatonic-errors")}catch{}}static enableDebugMode(){this.isDebugMode=!0,console.log("ErrorHandler debug mode enabled")}static isFeatureSupported(e){switch(e){case"AudioContext":return!!(window.AudioContext||window.webkitAudioContext);case"localStorage":try{const t="__localStorage_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}case"requestIdleCallback":return typeof window.requestIdleCallback=="function";case"OffscreenCanvas":return typeof OffscreenCanvas<"u";default:return!0}}static wrap(e,t,r=null){return(...i)=>{try{return e(...i)}catch(n){return this.handle(n,t,r),r?r(...i):void 0}}}}Vr(E,"isDebugMode",!1);function Hn(a,e){try{if(!a)return console.warn("No canvas element provided"),!1;if(!e)return console.warn("No dimensions object provided"),!1;if(!a.parentElement)return!1;const t=a.closest(".main-container"),r=t&&t.classList.contains("vertical-layout"),i=a.parentElement.offsetWidth,n=a.parentElement.offsetHeight,s=window.innerWidth,o=window.innerHeight,l=t?t.offsetWidth:0,c=t?t.offsetHeight:0;let h=a;const u=[];for(;h&&h!==document.body;)u.push({tagName:h.tagName,className:h.className,id:h.id,width:h.offsetWidth,height:h.offsetHeight,style:{width:h.style.width,height:h.style.height,display:getComputedStyle(h).display,position:getComputedStyle(h).position}}),h=h.parentElement;const f=$n();let g;if(r){const C=Math.max(i,s*.8),b=Math.max(n,o*.8);g=Math.min(C,b)}else{const C=Math.min(i,n);g=Math.min(C,window.innerHeight*.8)}const m=e.size||0,d=Math.abs(g-m),p=m===0||d>=2,y=e.dpr!==f;if(d>50&&(console.log("=== CANVAS CONTAINER DEBUG ==="),console.log("Vertical mode:",r),console.log("Canvas size:",{width:a.width,height:a.height}),console.log("Container dimensions:",{containerWidth:i,containerHeight:n}),console.log("Viewport dimensions:",{viewportWidth:s,viewportHeight:o}),console.log("Calculated size:",g),console.log("DOM Hierarchy (from canvas to body):"),u.forEach((C,b)=>{console.log(`  ${b}: ${C.tagName}${C.id?"#"+C.id:""}${C.className?"."+C.className.replace(/\s+/g,"."):""}`,{dimensions:`${C.width}x${C.height}`,styles:C.style})})),g===0||!p&&!y)return!1;console.log("Canvas resize proceeding:",{oldSize:e.size,newSize:g,sizeChanged:p,dprChanged:y,difference:d}),e.size=g,e.cx=g/2,e.cy=g/2,e.dpr=f;const v=g*f,T=g*f;return console.log("Setting canvas dimensions:",{cssSize:`${g}px`,bufferSize:`${v}x${T}`,dpr:f,beforeCSS:{width:a.style.width,height:a.style.height},beforeBuffer:{width:a.width,height:a.height}}),a.width=v,a.height=T,a.style.width=`${g}px`,a.style.height=`${g}px`,console.log("Canvas dimensions after setting:",{cssSize:{width:a.style.width,height:a.style.height},bufferSize:{width:a.width,height:a.height},offsetSize:{width:a.offsetWidth,height:a.offsetHeight}}),!0}catch(t){return E.handle(t,"Canvas",()=>{try{if(a&&a.parentElement&&e){const r=Math.min(a.parentElement.offsetWidth,a.parentElement.offsetHeight);r>0&&r!==e.size&&(e.size=r,e.cx=r/2,e.cy=r/2,e.dpr=e.dpr||1,a.width=r*e.dpr,a.height=r*e.dpr)}}catch{console.error("Canvas resize fallback failed")}}),!1}}function $n(){try{return Math.min(window.devicePixelRatio||1,3)}catch(a){return E.handle(a,"Canvas"),1}}const qn=1/Y,F=a=>(a%Ye+Ye)%Ye;function gi(a,e){const t=F(e)-F(a);return t>Math.PI?t-Ye:t<-Math.PI?t+Ye:t}const Un=a=>a<.5?2*a*a:-1+(4-2*a)*a,Ft=a=>(Math.round(-F(a)*qn)%12+12)%12;class rt{static debounce(e,t){let r;const i=(...n)=>{clearTimeout(r),r=setTimeout(()=>e.apply(this,n),t)};return i.cancel=()=>{clearTimeout(r),r=null},i}static throttle(e,t){let r,i,n;return(...s)=>{r?(clearTimeout(i),i=setTimeout(()=>{Date.now()-n>=t&&(e.apply(this,s),n=Date.now())},t-(Date.now()-n))):(e.apply(this,s),n=Date.now(),r=!0)}}static memoize(e,t=JSON.stringify,r=100){const i=new Map,n=(...s)=>{const o=t(s);if(i.has(o))return i.get(o);const l=e(...s);if(i.size>=r){const c=i.keys().next().value;i.delete(c)}return i.set(o,l),l};return n.clearCache=()=>i.clear(),n.getCacheSize=()=>i.size,n.getCacheStats=()=>({size:i.size,maxSize:r,keys:Array.from(i.keys())}),n}static startMeasure(e){const t=performance.now();return()=>{const i=performance.now()-t;return console.log(`[Performance] ${e}: ${i.toFixed(2)}ms`),i}}static monitor(e,t){return(...r)=>{const i=this.startMeasure(t);try{const n=e(...r);return i(),n}catch(n){throw i(),n}}}static requestOptimizedFrame(e,t={}){return typeof window.requestIdleCallback=="function"?window.requestIdleCallback(e,{timeout:16,...t}):requestAnimationFrame(e)}static cancelOptimizedFrame(e){typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(e):cancelAnimationFrame(e)}static batchDOMUpdates(e){return new Promise(t=>{requestAnimationFrame(()=>{e(),t()})})}static createFPSMonitor(e,t=60){let r=0,i=performance.now(),n;const s=o=>{if(r++,r%t===0){const l=Math.round(t*1e3/(o-i));e(l),i=o}n=requestAnimationFrame(s)};return n=requestAnimationFrame(s),()=>{n&&(cancelAnimationFrame(n),n=null)}}static prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}static getViewportSize(){return{width:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)}}static isElementVisible(e,t=0){const r=e.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return r.bottom>=t*i&&r.top<=(1-t)*i&&r.right>=t*n&&r.left<=(1-t)*n}static getMemoryInfo(){return performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1048576),total:Math.round(performance.memory.totalJSHeapSize/1048576),limit:Math.round(performance.memory.jsHeapSizeLimit/1048576)}:null}}function Vn([a]){const{sharp:e,flat:t}=a.display;return`${e}-${t}`}function Wn([a]){const{sharp:e,flat:t}=a.display,{pitchClass:r,degree:i,chromatic:n}=a.rings,s=Math.round(r*1e3)/1e3,o=Math.round(i*1e3)/1e3,l=Math.round(n*1e3)/1e3;return`${e}-${t}-${s}-${o}-${l}`}function Xr(a,e,t){try{if(!a||!a.includes("/"))return a||"";const[r,i]=a.split("/");return!r||!i?(console.warn(`Invalid label format: ${a}`),a):e&&t?`${r}/${i}`:e?r:t?i:`${r}/${i}`}catch(r){return E.handle(r,"Logic",()=>{console.warn(`Label processing failed for: ${a}`)}),a||""}}function Gn(a){try{const{sharp:e,flat:t}=a.display;if(typeof e!="boolean"||typeof t!="boolean")throw new Error("Invalid display state - sharp/flat must be booleans");const r=Lt.map(n=>Xr(n,e,t)),i=Bt.map(n=>Xr(n,e,t));if(r.length!==12||i.length!==12)throw new Error("Invalid label array lengths");return{chromaticLabels:r,diatonicLabels:i}}catch(e){return E.handle(e,"Logic",()=>{console.warn("Falling back to default labels")}),{chromaticLabels:Lt.slice(),diatonicLabels:Bt.slice()}}}const pi=rt.memoize(Gn,Vn,50);function Yn(a){try{const{sharp:e,flat:t}=a.display,{pitchClass:r,degree:i,chromatic:n}=a.rings;if(typeof r!="number"||typeof i!="number"||typeof n!="number")throw new Error("Invalid ring state - angles must be numbers");const s=y=>{if(!y.includes("/"))return y;const[v,T]=y.split("/");return e&&t?y:e?v:t?T:v},o=Lt.map(s),l=F(r-n),c=F(i-n),h=Ft(l),u=Ft(c);if(h<0||h>=12||u<0||u>=12)throw new Error(`Invalid note indices: root=${h}, mode=${u}`);const f=o[h],g=Bt[u],m=fi[g]||null,d=m?In[m]:"...";if(!f||!d)throw new Error("Could not determine pitch or mode name");const p=`${f} ${d}`;return{pitch:f,modeName:d,result:p,rootNoteIndex:h,modeDegreeIndex:u,modeKey:m}}catch(e){return E.handle(e,"Logic",()=>{console.warn("Musical result calculation failed")}),{pitch:"C",modeName:"Major",result:"C Major",rootNoteIndex:0,modeDegreeIndex:0,modeKey:"1"}}}const mi=rt.memoize(Yn,Wn,100);function Xn(a,e){try{if(!a||!e)throw new Error("Invalid state or result element");const t=mi(a);e.textContent!==t.result&&(e.textContent=t.result)}catch(t){E.handle(t,"Logic",()=>{e&&(e.textContent="C Major")})}}function Ro(a){try{const e=mi(a),t=pi(a);return{...e,labels:t,angles:{pitchClass:a.rings.pitchClass,degree:a.rings.degree,chromatic:a.rings.chromatic,effectivePitch:F(a.rings.pitchClass-a.rings.chromatic),effectiveDegree:F(a.rings.degree-a.rings.chromatic)},display:{sharp:a.display.sharp,flat:a.display.flat}}}catch(e){return E.handle(e,"Logic"),null}}function Yt(a,e=null){const t=performance.now(),r=_.animation,i={fromPitchClass:_.rings.pitchClass,fromDegree:_.rings.degree,fromChrom:_.rings.chromatic,fromHighlight:_.rings.highlightPosition},n={toPitchClass:a.pitchClass??(r==null?void 0:r.to.toPitchClass)??i.fromPitchClass,toDegree:a.degree??(r==null?void 0:r.to.toDegree)??i.fromDegree,toChrom:a.chromatic??(r==null?void 0:r.to.toChrom)??i.fromChrom,toHighlight:a.highlightPosition??(r==null?void 0:r.to.toHighlight)??i.fromHighlight};_.animation={t0:t,from:i,to:n,onComplete:e}}function jn(a){const e=_.animation;if(!e)return!1;const t=(a-e.t0)/Bn,r=t>=1?1:Un(t),i=(n,s)=>F(n+gi(n,s)*r);return _.rings.pitchClass=i(e.from.fromPitchClass,e.to.toPitchClass),_.rings.degree=i(e.from.fromDegree,e.to.toDegree),_.rings.chromatic=i(e.from.fromChrom,e.to.toChrom),_.rings.highlightPosition=i(e.from.fromHighlight,e.to.toHighlight),r===1&&(e.onComplete&&e.onComplete(),_.animation=null),!0}function _i(a,e){const t=_.rings[a],r=Math.round(-t/Y),i=F(-r*Y);Yt({[a]:i},e)}function lr(a){const{degree:e,chromatic:t}=_.rings,r=F(e-t),i=F(-r)/Y;let n=Nt[0],s=1/0;Nt.forEach(c=>{const h=Math.abs(i-c),u=Math.min(h,12-h);u<s&&(s=u,n=c)});const o=F(-n*Y),l=F(o+t);Yt({degree:l,highlightPosition:l},a)}function yi(a){const e=Math.round(-_.rings.chromatic/Y),t=F(-e*Y),r=gi(_.rings.chromatic,t),i=F(_.rings.pitchClass+r),n=F(_.rings.degree-_.rings.chromatic),s=F(n+t);Yt({pitchClass:i,degree:s,chromatic:t,highlightPosition:s},a)}function bi(){try{if(_.playback.audioContext)return _.playback.audioContext.state==="suspended"?_.playback.audioContext.resume().catch(e=>{E.handle(e,"AudioContext",()=>{_.playback.audioContext=null,bi()})}):Promise.resolve();if(!E.isFeatureSupported("AudioContext"))return console.warn("Web Audio API not supported - audio playback disabled"),Promise.resolve();const a=window.AudioContext||window.webkitAudioContext;return _.playback.audioContext=new a,_.playback.audioContext.addEventListener("statechange",()=>{if(!_.playback.audioContext)return;const e=_.playback.audioContext.state;console.log(`Audio context state changed to: ${e}`),(e==="interrupted"||e==="suspended")&&setTimeout(()=>{var t;((t=_.playback.audioContext)==null?void 0:t.state)==="suspended"&&_.playback.audioContext.resume().catch(r=>{E.handle(r,"AudioContext")})},100)}),_.playback.audioContext.state==="suspended"?_.playback.audioContext.resume().catch(e=>{E.handle(e,"AudioContext",()=>{console.warn("Could not resume audio context - user interaction may be required")})}):Promise.resolve()}catch(a){return E.handle(a,"AudioContext",()=>{console.warn("Audio initialization failed - continuing without audio"),_.playback.audioContext=null}),Promise.resolve()}}function Kn(a,e){try{const t=_.playback.audioContext;if(!t){console.warn("No audio context available");return}if(t.state==="closed"){console.warn("Audio context is closed");return}if(typeof a!="number"||a<0)throw new Error(`Invalid chromatic index: ${a}`);typeof e!="number"||e<=0;const r=t.createOscillator(),i=t.createGain(),n=a%12,s=Math.floor(a/12),o=Fn*Math.pow(2,n/12+s);if(o<20||o>2e4)throw new Error(`Frequency out of audible range: ${o}Hz`);r.frequency.setValueAtTime(o,t.currentTime),r.type="sine",r.connect(i),i.connect(t.destination);const l=t.currentTime,c=.01,h=Math.min(.1,e*.3);i.gain.setValueAtTime(0,l),i.gain.linearRampToValueAtTime(.3,l+c),i.gain.setValueAtTime(.3,l+e-h),i.gain.linearRampToValueAtTime(0,l+e),r.start(l),r.stop(l+e),r.addEventListener("ended",()=>{try{r.disconnect(),i.disconnect()}catch{}}),r.addEventListener("error",u=>{E.handle(new Error("Oscillator error"),"AudioContext")})}catch(t){E.handle(t,"AudioContext",()=>{console.warn(`Failed to play note ${a} - continuing silently`)})}}function Qn(){const{pitchClass:a,degree:e,chromatic:t}=_.rings,r=Ft(F(a-t)),i=Ft(F(e-t)),n=Bt[i],s=fi[n];if(!s)return[];const l=Pn[s].map(c=>r+c);return l.push(l[0]+12),l}function vi(){if(!_.playback.isPlaying){cr();return}const a=_.playback.sequence;if(a.length===0){cr();return}const e=a.shift();_.playback.currentNoteIndex=e,Kn(e,Gr/1e3);const t=setTimeout(vi,Gr+Nn);_.playback.timeoutId=t}function Jn(){if(_.playback.isPlaying)return;bi();const a=Qn();a.length!==0&&(_.playback.rootNoteIndexForPlayback=a[0],_.playback.isPlaying=!0,_.playback.sequence=a,vi())}function cr(){_.playback.isPlaying&&(clearTimeout(_.playback.timeoutId),_.playback.isPlaying=!1,_.playback.currentNoteIndex=null,_.playback.sequence=[],_.playback.timeoutId=null,_.playback.rootNoteIndexForPlayback=null)}const hr="diatonicCompassPreferences",Ci="diatonicCompassPreferencesBackup";function Xt(a){try{if(!a||typeof a!="object")throw new Error("Invalid preferences object");if(!E.isFeatureSupported("localStorage"))return console.warn("localStorage not available - preferences will not persist"),!1;const t={...wt()||{},...a},r=Sr(t),i=JSON.stringify(r);try{localStorage.setItem(Ci,localStorage.getItem(hr)||"{}")}catch{console.warn("Could not create preferences backup")}return localStorage.setItem(hr,i),!0}catch(e){return E.handle(e,"LocalStorage",()=>{console.warn("Preferences could not be saved - will use session defaults")}),!1}}function wt(){try{if(!E.isFeatureSupported("localStorage"))return zt();const a=localStorage.getItem(hr);if(!a)return null;const e=JSON.parse(a),t=Sr(e);return JSON.stringify(t)!==a&&(console.log("Preferences were corrected during load - saving updated version"),Xt(t)),t}catch(a){return E.handle(a,"LocalStorage",()=>{const e=Zn();if(e)return console.log("Loaded preferences from backup"),e}),zt()}}function Zn(){try{const a=localStorage.getItem(Ci);if(a){const e=JSON.parse(a);return Sr(e)}}catch{console.warn("Could not load backup preferences")}return null}function Sr(a){if(!a||typeof a!="object")return zt();const e=zt(),t={};for(const[r,i]of Object.entries(e))if(r in a){const n=a[r],s=typeof i;if(typeof n===s)switch(r){case"darkMode":t[r]=!!n;break;case"orientation":t[r]=["horizontal","vertical"].includes(n)?n:i;break;case"volume":t[r]=Math.max(0,Math.min(1,Number(n)))||i;break;case"tutorialCompleted":t[r]=!!n;break;case"beltOrder":if(Array.isArray(n)){const o=["pitch","degree","intervals","chromatic"];o.every(c=>n.includes(c))&&n.length===o.length?t[r]=[...n]:t[r]=i}else t[r]=i;break;case"cursorColor":t[r]=["red","blue","green","yellow"].includes(n)?n:i;break;case"cursorFill":t[r]=!!n;break;default:t[r]=n}else console.warn(`Invalid type for preference ${r}: expected ${s}, got ${typeof n}`),t[r]=i}else t[r]=i;return t}function zt(){return{darkMode:!1,orientation:"horizontal",volume:.5,tutorialCompleted:!1,showAdvancedControls:!1,beltOrder:["pitch","degree","intervals","chromatic"],cursorColor:"red",cursorFill:!1}}const wi=Object.freeze(Object.defineProperty({__proto__:null,loadPreferences:wt,savePreferences:Xt},Symbol.toStringTag,{value:"Module"})),K={toggleAccidental(a){try{if(!["sharp","flat"].includes(a))throw new Error(`Invalid accidental type: ${a}`);const t=!_.display[a],r=a==="sharp"?"flat":"sharp",i=_.display[r];!t&&!i&&(_.display[r]=!0),_.display[a]=t}catch(e){E.handle(e,Q.ERROR_HANDLING.CONTEXTS.UI)}},toggleDarkMode(){try{const a=!_.ui.darkMode;_.ui.darkMode=a,document.body.classList.toggle("dark-mode",a),Xt({darkMode:a})}catch(a){E.handle(a,Q.ERROR_HANDLING.CONTEXTS.UI,()=>{document.body.classList.toggle("dark-mode")})}},togglePlayback(){try{_.playback.isPlaying?cr():!_.drag.active&&!_.animation&&Jn()}catch(a){E.handle(a,Q.ERROR_HANDLING.CONTEXTS.AUDIO)}},toggleSidebar(a){try{const e=typeof a=="boolean"?a:!_.ui.sidebarOpen;_.ui.sidebarOpen=e,_.performance&&(_.performance.needsRedraw=!0)}catch(e){E.handle(e,Q.ERROR_HANDLING.CONTEXTS.UI)}},setOrientation(a){try{if(!["horizontal","vertical"].includes(a))throw new Error(`Invalid orientation: ${a}`);if(_.belts.orientation===a)return;_.belts.orientation=a,_.rings.pitchClass=0,_.rings.degree=0,_.rings.chromatic=0,_.rings.highlightPosition=0,_.belts.init=!1;const e=document.querySelector(".main-container");e&&e.classList.toggle("vertical-layout",a==="vertical")}catch(e){E.handle(e,Q.ERROR_HANDLING.CONTEXTS.UI)}},snapTo(a,e){try{Yt(a,e)}catch(t){E.handle(t,Q.ERROR_HANDLING.CONTEXTS.ANIMATION)}},setRingAngle(a,e){try{if(!["pitchClass","degree","chromatic","highlightPosition"].includes(a))throw new Error(`Invalid ring name: ${a}`);if(typeof e!="number"||!isFinite(e))throw new Error(`Invalid angle value: ${e}`);_.rings[a]=e}catch(t){E.handle(t,Q.ERROR_HANDLING.CONTEXTS.UI)}},setCursorColor(a,e){try{if(!["red","blue","green","yellow"].includes(a))throw new Error(`Invalid cursor color: ${a}`);_.ui.cursorColor=a,_.ui.cursorFill=e,Je(async()=>{const{savePreferences:r}=await Promise.resolve().then(()=>wi);return{savePreferences:r}},void 0).then(({savePreferences:r})=>{r({cursorColor:a,cursorFill:e})}),_.performance&&(_.performance.needsRedraw=!0)}catch(t){E.handle(t,Q.ERROR_HANDLING.CONTEXTS.UI)}},resetRings(){try{_.rings.pitchClass=0,_.rings.degree=0,_.rings.chromatic=0,_.rings.highlightPosition=0}catch(a){E.handle(a,Q.ERROR_HANDLING.CONTEXTS.UI)}},getStateSummary(){try{return{rings:{..._.rings},ui:{sidebarOpen:_.ui.sidebarOpen,darkMode:_.ui.darkMode,display:{sharp:_.display.sharp,flat:_.display.flat}},belts:{orientation:_.belts.orientation,init:_.belts.init},playback:{isPlaying:_.playback.isPlaying},interaction:{isDragging:!!_.drag.active,isAnimating:!!_.animation}}}catch(a){return E.handle(a,Q.ERROR_HANDLING.CONTEXTS.APP),null}}};function ke(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Ti(a,e){a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.__proto__=e}/*!
 * GSAP 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var ue={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},lt={duration:.5,overwrite:!1,delay:0},kr,J,H,pe=1e8,N=1/pe,ur=Math.PI*2,es=ur/4,ts=0,xi=Math.sqrt,rs=Math.cos,is=Math.sin,j=function(e){return typeof e=="string"},V=function(e){return typeof e=="function"},Oe=function(e){return typeof e=="number"},Er=function(e){return typeof e>"u"},Te=function(e){return typeof e=="object"},re=function(e){return e!==!1},Or=function(){return typeof window<"u"},It=function(e){return V(e)||j(e)},Si=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ee=Array.isArray,ns=/random\([^)]+\)/g,ss=/,\s*/g,jr=/(?:-?\.?\d|\.)+/gi,ki=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,it=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Jt=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Ei=/[+-]=-?[.\d]+/,os=/[^,'"\[\]\s]+/gi,as=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,q,ve,dr,Ar,de={},Ht={},Oi,Ai=function(e){return(Ht=ct(e,de))&&oe},Pr=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Tt=function(e,t){return!t&&console.warn(e)},Pi=function(e,t){return e&&(de[e]=t)&&Ht&&(Ht[e]=t)||de},xt=function(){return 0},ls={suppressEvents:!0,isStart:!0,kill:!1},Dt={suppressEvents:!0,kill:!1},cs={suppressEvents:!0},Ir={},Be=[],fr={},Ii,ae={},Zt={},Kr=30,Mt=[],Dr="",Mr=function(e){var t=e[0],r,i;if(Te(t)||V(t)||(e=[e]),!(r=(t._gsap||{}).harness)){for(i=Mt.length;i--&&!Mt[i].targetTest(t););r=Mt[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new tn(e[i],r)))||e.splice(i,1);return e},Xe=function(e){return e._gsap||Mr(me(e))[0]._gsap},Di=function(e,t,r){return(r=e[t])&&V(r)?e[t]():Er(r)&&e.getAttribute&&e.getAttribute(t)||r},ie=function(e,t){return(e=e.split(",")).forEach(t)||e},W=function(e){return Math.round(e*1e5)/1e5||0},$=function(e){return Math.round(e*1e7)/1e7||0},st=function(e,t){var r=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),r==="+"?e+i:r==="-"?e-i:r==="*"?e*i:e/i},hs=function(e,t){for(var r=t.length,i=0;e.indexOf(t[i])<0&&++i<r;);return i<r},$t=function(){var e=Be.length,t=Be.slice(0),r,i;for(fr={},Be.length=0,r=0;r<e;r++)i=t[r],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Rr=function(e){return!!(e._initted||e._startAt||e.add)},Mi=function(e,t,r,i){Be.length&&!J&&$t(),e.render(t,r,!!(J&&t<0&&Rr(e))),Be.length&&!J&&$t()},Ri=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(os).length<2?t:j(e)?e.trim():e},Li=function(e){return e},fe=function(e,t){for(var r in t)r in e||(e[r]=t[r]);return e},us=function(e){return function(t,r){for(var i in r)i in t||i==="duration"&&e||i==="ease"||(t[i]=r[i])}},ct=function(e,t){for(var r in t)e[r]=t[r];return e},Qr=function a(e,t){for(var r in t)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(e[r]=Te(t[r])?a(e[r]||(e[r]={}),t[r]):t[r]);return e},qt=function(e,t){var r={},i;for(i in e)i in t||(r[i]=e[i]);return r},bt=function(e){var t=e.parent||q,r=e.keyframes?us(ee(e.keyframes)):fe;if(re(e.inherit))for(;t;)r(e,t.vars.defaults),t=t.parent||t._dp;return e},ds=function(e,t){for(var r=e.length,i=r===t.length;i&&r--&&e[r]===t[r];);return r<0},Bi=function(e,t,r,i,n){var s=e[i],o;if(n)for(o=t[n];s&&s[n]>o;)s=s._prev;return s?(t._next=s._next,s._next=t):(t._next=e[r],e[r]=t),t._next?t._next._prev=t:e[i]=t,t._prev=s,t.parent=t._dp=e,t},jt=function(e,t,r,i){r===void 0&&(r="_first"),i===void 0&&(i="_last");var n=t._prev,s=t._next;n?n._next=s:e[r]===t&&(e[r]=s),s?s._prev=n:e[i]===t&&(e[i]=n),t._next=t._prev=t.parent=null},Fe=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},je=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var r=e;r;)r._dirty=1,r=r.parent;return e},fs=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},gr=function(e,t,r,i){return e._startAt&&(J?e._startAt.revert(Dt):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},gs=function a(e){return!e||e._ts&&a(e.parent)},Jr=function(e){return e._repeat?ht(e._tTime,e=e.duration()+e._rDelay)*e:0},ht=function(e,t){var r=Math.floor(e=$(e/t));return e&&r===e?r-1:r},Ut=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Kt=function(e){return e._end=$(e._start+(e._tDur/Math.abs(e._ts||e._rts||N)||0))},Qt=function(e,t){var r=e._dp;return r&&r.smoothChildTiming&&e._ts&&(e._start=$(r._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Kt(e),r._dirty||je(r,e)),e},Ni=function(e,t){var r;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(r=Ut(e.rawTime(),t),(!t._dur||Pt(0,t.totalDuration(),r)-t._tTime>N)&&t.render(r,!0)),je(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(r=e;r._dp;)r.rawTime()>=0&&r.totalTime(r._tTime),r=r._dp;e._zTime=-N}},Ce=function(e,t,r,i){return t.parent&&Fe(t),t._start=$((Oe(r)?r:r||e!==q?ge(e,r,t):e._time)+t._delay),t._end=$(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Bi(e,t,"_first","_last",e._sort?"_start":0),pr(t)||(e._recent=t),i||Ni(e,t),e._ts<0&&Qt(e,e._tTime),e},Fi=function(e,t){return(de.ScrollTrigger||Pr("scrollTrigger",t))&&de.ScrollTrigger.create(t,e)},zi=function(e,t,r,i,n){if(Br(e,t,n),!e._initted)return 1;if(!r&&e._pt&&!J&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Ii!==le.frame)return Be.push(e),e._lazy=[n,i],1},ps=function a(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||a(t))},pr=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},ms=function(e,t,r,i){var n=e.ratio,s=t<0||!t&&(!e._start&&ps(e)&&!(!e._initted&&pr(e))||(e._ts<0||e._dp._ts<0)&&!pr(e))?0:1,o=e._rDelay,l=0,c,h,u;if(o&&e._repeat&&(l=Pt(0,e._tDur,t),h=ht(l,o),e._yoyo&&h&1&&(s=1-s),h!==ht(e._tTime,o)&&(n=1-s,e.vars.repeatRefresh&&e._initted&&e.invalidate())),s!==n||J||i||e._zTime===N||!t&&e._zTime){if(!e._initted&&zi(e,t,i,r,l))return;for(u=e._zTime,e._zTime=t||(r?N:0),r||(r=t&&!u),e.ratio=s,e._from&&(s=1-s),e._time=0,e._tTime=l,c=e._pt;c;)c.r(s,c.d),c=c._next;t<0&&gr(e,t,r,!0),e._onUpdate&&!r&&ce(e,"onUpdate"),l&&e._repeat&&!r&&e.parent&&ce(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===s&&(s&&Fe(e,1),!r&&!J&&(ce(e,s?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},_s=function(e,t,r){var i;if(r>t)for(i=e._first;i&&i._start<=r;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=r;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},ut=function(e,t,r,i){var n=e._repeat,s=$(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=s/e._dur),e._dur=s,e._tDur=n?n<0?1e10:$(s*(n+1)+e._rDelay*n):s,o>0&&!i&&Qt(e,e._tTime=e._tDur*o),e.parent&&Kt(e),r||je(e.parent,e),e},Zr=function(e){return e instanceof te?je(e):ut(e,e._dur)},ys={_start:0,endTime:xt,totalDuration:xt},ge=function a(e,t,r){var i=e.labels,n=e._recent||ys,s=e.duration()>=pe?n.endTime(!1):e._dur,o,l,c;return j(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),c=t.substr(-1)==="%",o=t.indexOf("="),l==="<"||l===">"?(o>=0&&(t=t.replace(/=/,"")),(l==="<"?n._start:n.endTime(n._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(o<0?n:r).totalDuration()/100:1)):o<0?(t in i||(i[t]=s),i[t]):(l=parseFloat(t.charAt(o-1)+t.substr(o+1)),c&&r&&(l=l/100*(ee(r)?r[0]:r).totalDuration()),o>1?a(e,t.substr(0,o-1),r)+l:s+l)):t==null?s:+t},vt=function(e,t,r){var i=Oe(t[1]),n=(i?2:1)+(e<2?0:1),s=t[n],o,l;if(i&&(s.duration=t[1]),s.parent=r,e){for(o=s,l=r;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=re(l.vars.inherit)&&l.parent;s.immediateRender=re(o.immediateRender),e<2?s.runBackwards=1:s.startAt=t[n-1]}return new G(t[0],s,t[n+1])},$e=function(e,t){return e||e===0?t(e):t},Pt=function(e,t,r){return r<e?e:r>t?t:r},Z=function(e,t){return!j(e)||!(t=as.exec(e))?"":t[1]},bs=function(e,t,r){return $e(r,function(i){return Pt(e,t,i)})},mr=[].slice,Hi=function(e,t){return e&&Te(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Te(e[0]))&&!e.nodeType&&e!==ve},vs=function(e,t,r){return r===void 0&&(r=[]),e.forEach(function(i){var n;return j(i)&&!t||Hi(i,1)?(n=r).push.apply(n,me(i)):r.push(i)})||r},me=function(e,t,r){return H&&!t&&H.selector?H.selector(e):j(e)&&!r&&(dr||!dt())?mr.call((t||Ar).querySelectorAll(e),0):ee(e)?vs(e,r):Hi(e)?mr.call(e,0):e?[e]:[]},_r=function(e){return e=me(e)[0]||Tt("Invalid scope")||{},function(t){var r=e.current||e.nativeElement||e;return me(t,r.querySelectorAll?r:r===e?Tt("Invalid scope")||Ar.createElement("div"):e)}},$i=function(e){return e.sort(function(){return .5-Math.random()})},qi=function(e){if(V(e))return e;var t=Te(e)?e:{each:e},r=Ke(t.ease),i=t.from||0,n=parseFloat(t.base)||0,s={},o=i>0&&i<1,l=isNaN(i)||o,c=t.axis,h=i,u=i;return j(i)?h=u={center:.5,edges:.5,end:1}[i]||0:!o&&l&&(h=i[0],u=i[1]),function(f,g,m){var d=(m||t).length,p=s[d],y,v,T,C,b,k,x,S,w;if(!p){if(w=t.grid==="auto"?0:(t.grid||[1,pe])[1],!w){for(x=-pe;x<(x=m[w++].getBoundingClientRect().left)&&w<d;);w<d&&w--}for(p=s[d]=[],y=l?Math.min(w,d)*h-.5:i%w,v=w===pe?0:l?d*u/w-.5:i/w|0,x=0,S=pe,k=0;k<d;k++)T=k%w-y,C=v-(k/w|0),p[k]=b=c?Math.abs(c==="y"?C:T):xi(T*T+C*C),b>x&&(x=b),b<S&&(S=b);i==="random"&&$i(p),p.max=x-S,p.min=S,p.v=d=(parseFloat(t.amount)||parseFloat(t.each)*(w>d?d-1:c?c==="y"?d/w:w:Math.max(w,d/w))||0)*(i==="edges"?-1:1),p.b=d<0?n-d:n,p.u=Z(t.amount||t.each)||0,r=r&&d<0?Ji(r):r}return d=(p[f]-p.min)/p.max||0,$(p.b+(r?r(d):d)*p.v)+p.u}},yr=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(r){var i=$(Math.round(parseFloat(r)/e)*e*t);return(i-i%1)/t+(Oe(r)?0:Z(r))}},Ui=function(e,t){var r=ee(e),i,n;return!r&&Te(e)&&(i=r=e.radius||pe,e.values?(e=me(e.values),(n=!Oe(e[0]))&&(i*=i)):e=yr(e.increment)),$e(t,r?V(e)?function(s){return n=e(s),Math.abs(n-s)<=i?n:s}:function(s){for(var o=parseFloat(n?s.x:s),l=parseFloat(n?s.y:0),c=pe,h=0,u=e.length,f,g;u--;)n?(f=e[u].x-o,g=e[u].y-l,f=f*f+g*g):f=Math.abs(e[u]-o),f<c&&(c=f,h=u);return h=!i||c<=i?e[h]:s,n||h===s||Oe(s)?h:h+Z(s)}:yr(e))},Vi=function(e,t,r,i){return $e(ee(e)?!t:r===!0?!!(r=0):!i,function(){return ee(e)?e[~~(Math.random()*e.length)]:(r=r||1e-5)&&(i=r<1?Math.pow(10,(r+"").length-2):1)&&Math.floor(Math.round((e-r/2+Math.random()*(t-e+r*.99))/r)*r*i)/i})},Cs=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(i){return t.reduce(function(n,s){return s(n)},i)}},ws=function(e,t){return function(r){return e(parseFloat(r))+(t||Z(r))}},Ts=function(e,t,r){return Gi(e,t,0,1,r)},Wi=function(e,t,r){return $e(r,function(i){return e[~~t(i)]})},xs=function a(e,t,r){var i=t-e;return ee(e)?Wi(e,a(0,e.length),t):$e(r,function(n){return(i+(n-e)%i)%i+e})},Ss=function a(e,t,r){var i=t-e,n=i*2;return ee(e)?Wi(e,a(0,e.length-1),t):$e(r,function(s){return s=(n+(s-e)%n)%n||0,e+(s>i?n-s:s)})},St=function(e){return e.replace(ns,function(t){var r=t.indexOf("[")+1,i=t.substring(r||7,r?t.indexOf("]"):t.length-1).split(ss);return Vi(r?i:+i[0],r?0:+i[1],+i[2]||1e-5)})},Gi=function(e,t,r,i,n){var s=t-e,o=i-r;return $e(n,function(l){return r+((l-e)/s*o||0)})},ks=function a(e,t,r,i){var n=isNaN(e+t)?0:function(g){return(1-g)*e+g*t};if(!n){var s=j(e),o={},l,c,h,u,f;if(r===!0&&(i=1)&&(r=null),s)e={p:e},t={p:t};else if(ee(e)&&!ee(t)){for(h=[],u=e.length,f=u-2,c=1;c<u;c++)h.push(a(e[c-1],e[c]));u--,n=function(m){m*=u;var d=Math.min(f,~~m);return h[d](m-d)},r=t}else i||(e=ct(ee(e)?[]:{},e));if(!h){for(l in t)Lr.call(o,e,l,"get",t[l]);n=function(m){return zr(m,o)||(s?e.p:e)}}}return $e(r,n)},ei=function(e,t,r){var i=e.labels,n=pe,s,o,l;for(s in i)o=i[s]-t,o<0==!!r&&o&&n>(o=Math.abs(o))&&(l=s,n=o);return l},ce=function(e,t,r){var i=e.vars,n=i[t],s=H,o=e._ctx,l,c,h;if(n)return l=i[t+"Params"],c=i.callbackScope||e,r&&Be.length&&$t(),o&&(H=o),h=l?n.apply(c,l):n.call(c),H=s,h},_t=function(e){return Fe(e),e.scrollTrigger&&e.scrollTrigger.kill(!!J),e.progress()<1&&ce(e,"onInterrupt"),e},nt,Yi=[],Xi=function(e){if(e)if(e=!e.name&&e.default||e,Or()||e.headless){var t=e.name,r=V(e),i=t&&!r&&e.init?function(){this._props=[]}:e,n={init:xt,render:zr,add:Lr,kill:qs,modifier:$s,rawVars:0},s={targetTest:0,get:0,getSetter:Fr,aliases:{},register:0};if(dt(),e!==i){if(ae[t])return;fe(i,fe(qt(e,n),s)),ct(i.prototype,ct(n,qt(e,s))),ae[i.prop=t]=i,e.targetTest&&(Mt.push(i),Ir[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Pi(t,i),e.register&&e.register(oe,i,ne)}else Yi.push(e)},B=255,yt={aqua:[0,B,B],lime:[0,B,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,B],navy:[0,0,128],white:[B,B,B],olive:[128,128,0],yellow:[B,B,0],orange:[B,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[B,0,0],pink:[B,192,203],cyan:[0,B,B],transparent:[B,B,B,0]},er=function(e,t,r){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(r-t)*e*6:e<.5?r:e*3<2?t+(r-t)*(2/3-e)*6:t)*B+.5|0},ji=function(e,t,r){var i=e?Oe(e)?[e>>16,e>>8&B,e&B]:0:yt.black,n,s,o,l,c,h,u,f,g,m;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),yt[e])i=yt[e];else if(e.charAt(0)==="#"){if(e.length<6&&(n=e.charAt(1),s=e.charAt(2),o=e.charAt(3),e="#"+n+n+s+s+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&B,i&B,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&B,e&B]}else if(e.substr(0,3)==="hsl"){if(i=m=e.match(jr),!t)l=+i[0]%360/360,c=+i[1]/100,h=+i[2]/100,s=h<=.5?h*(c+1):h+c-h*c,n=h*2-s,i.length>3&&(i[3]*=1),i[0]=er(l+1/3,n,s),i[1]=er(l,n,s),i[2]=er(l-1/3,n,s);else if(~e.indexOf("="))return i=e.match(ki),r&&i.length<4&&(i[3]=1),i}else i=e.match(jr)||yt.transparent;i=i.map(Number)}return t&&!m&&(n=i[0]/B,s=i[1]/B,o=i[2]/B,u=Math.max(n,s,o),f=Math.min(n,s,o),h=(u+f)/2,u===f?l=c=0:(g=u-f,c=h>.5?g/(2-u-f):g/(u+f),l=u===n?(s-o)/g+(s<o?6:0):u===s?(o-n)/g+2:(n-s)/g+4,l*=60),i[0]=~~(l+.5),i[1]=~~(c*100+.5),i[2]=~~(h*100+.5)),r&&i.length<4&&(i[3]=1),i},Ki=function(e){var t=[],r=[],i=-1;return e.split(Ne).forEach(function(n){var s=n.match(it)||[];t.push.apply(t,s),r.push(i+=s.length+1)}),t.c=r,t},ti=function(e,t,r){var i="",n=(e+i).match(Ne),s=t?"hsla(":"rgba(",o=0,l,c,h,u;if(!n)return e;if(n=n.map(function(f){return(f=ji(f,t,1))&&s+(t?f[0]+","+f[1]+"%,"+f[2]+"%,"+f[3]:f.join(","))+")"}),r&&(h=Ki(e),l=r.c,l.join(i)!==h.c.join(i)))for(c=e.replace(Ne,"1").split(it),u=c.length-1;o<u;o++)i+=c[o]+(~l.indexOf(o)?n.shift()||s+"0,0,0,0)":(h.length?h:n.length?n:r).shift());if(!c)for(c=e.split(Ne),u=c.length-1;o<u;o++)i+=c[o]+n[o];return i+c[u]},Ne=(function(){var a="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in yt)a+="|"+e+"\\b";return new RegExp(a+")","gi")})(),Es=/hsl[a]?\(/,Qi=function(e){var t=e.join(" "),r;if(Ne.lastIndex=0,Ne.test(t))return r=Es.test(t),e[1]=ti(e[1],r),e[0]=ti(e[0],r,Ki(e[1])),!0},kt,le=(function(){var a=Date.now,e=500,t=33,r=a(),i=r,n=1e3/240,s=n,o=[],l,c,h,u,f,g,m=function d(p){var y=a()-i,v=p===!0,T,C,b,k;if((y>e||y<0)&&(r+=y-t),i+=y,b=i-r,T=b-s,(T>0||v)&&(k=++u.frame,f=b-u.time*1e3,u.time=b=b/1e3,s+=T+(T>=n?4:n-T),C=1),v||(l=c(d)),C)for(g=0;g<o.length;g++)o[g](b,f,k,p)};return u={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(p){return f/(1e3/(p||60))},wake:function(){Oi&&(!dr&&Or()&&(ve=dr=window,Ar=ve.document||{},de.gsap=oe,(ve.gsapVersions||(ve.gsapVersions=[])).push(oe.version),Ai(Ht||ve.GreenSockGlobals||!ve.gsap&&ve||{}),Yi.forEach(Xi)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&u.sleep(),c=h||function(p){return setTimeout(p,s-u.time*1e3+1|0)},kt=1,m(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(l),kt=0,c=xt},lagSmoothing:function(p,y){e=p||1/0,t=Math.min(y||33,e)},fps:function(p){n=1e3/(p||240),s=u.time*1e3+n},add:function(p,y,v){var T=y?function(C,b,k,x){p(C,b,k,x),u.remove(T)}:p;return u.remove(p),o[v?"unshift":"push"](T),dt(),T},remove:function(p,y){~(y=o.indexOf(p))&&o.splice(y,1)&&g>=y&&g--},_listeners:o},u})(),dt=function(){return!kt&&le.wake()},A={},Os=/^[\d.\-M][\d.\-,\s]/,As=/["']/g,Ps=function(e){for(var t={},r=e.substr(1,e.length-3).split(":"),i=r[0],n=1,s=r.length,o,l,c;n<s;n++)l=r[n],o=n!==s-1?l.lastIndexOf(","):l.length,c=l.substr(0,o),t[i]=isNaN(c)?c.replace(As,"").trim():+c,i=l.substr(o+1).trim();return t},Is=function(e){var t=e.indexOf("(")+1,r=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<r?e.indexOf(")",r+1):r)},Ds=function(e){var t=(e+"").split("("),r=A[t[0]];return r&&t.length>1&&r.config?r.config.apply(null,~e.indexOf("{")?[Ps(t[1])]:Is(e).split(",").map(Ri)):A._CE&&Os.test(e)?A._CE("",e):r},Ji=function(e){return function(t){return 1-e(1-t)}},Zi=function a(e,t){for(var r=e._first,i;r;)r instanceof te?a(r,t):r.vars.yoyoEase&&(!r._yoyo||!r._repeat)&&r._yoyo!==t&&(r.timeline?a(r.timeline,t):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=t)),r=r._next},Ke=function(e,t){return e&&(V(e)?e:A[e]||Ds(e))||t},et=function(e,t,r,i){r===void 0&&(r=function(l){return 1-t(1-l)}),i===void 0&&(i=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var n={easeIn:t,easeOut:r,easeInOut:i},s;return ie(e,function(o){A[o]=de[o]=n,A[s=o.toLowerCase()]=r;for(var l in n)A[s+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=A[o+"."+l]=n[l]}),n},en=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},tr=function a(e,t,r){var i=t>=1?t:1,n=(r||(e?.3:.45))/(t<1?t:1),s=n/ur*(Math.asin(1/i)||0),o=function(h){return h===1?1:i*Math.pow(2,-10*h)*is((h-s)*n)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:en(o);return n=ur/n,l.config=function(c,h){return a(e,c,h)},l},rr=function a(e,t){t===void 0&&(t=1.70158);var r=function(s){return s?--s*s*((t+1)*s+t)+1:0},i=e==="out"?r:e==="in"?function(n){return 1-r(1-n)}:en(r);return i.config=function(n){return a(e,n)},i};ie("Linear,Quad,Cubic,Quart,Quint,Strong",function(a,e){var t=e<5?e+1:e;et(a+",Power"+(t-1),e?function(r){return Math.pow(r,t)}:function(r){return r},function(r){return 1-Math.pow(1-r,t)},function(r){return r<.5?Math.pow(r*2,t)/2:1-Math.pow((1-r)*2,t)/2})});A.Linear.easeNone=A.none=A.Linear.easeIn;et("Elastic",tr("in"),tr("out"),tr());(function(a,e){var t=1/e,r=2*t,i=2.5*t,n=function(o){return o<t?a*o*o:o<r?a*Math.pow(o-1.5/e,2)+.75:o<i?a*(o-=2.25/e)*o+.9375:a*Math.pow(o-2.625/e,2)+.984375};et("Bounce",function(s){return 1-n(1-s)},n)})(7.5625,2.75);et("Expo",function(a){return Math.pow(2,10*(a-1))*a+a*a*a*a*a*a*(1-a)});et("Circ",function(a){return-(xi(1-a*a)-1)});et("Sine",function(a){return a===1?1:-rs(a*es)+1});et("Back",rr("in"),rr("out"),rr());A.SteppedEase=A.steps=de.SteppedEase={config:function(e,t){e===void 0&&(e=1);var r=1/e,i=e+(t?0:1),n=t?1:0,s=1-N;return function(o){return((i*Pt(0,s,o)|0)+n)*r}}};lt.ease=A["quad.out"];ie("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(a){return Dr+=a+","+a+"Params,"});var tn=function(e,t){this.id=ts++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Di,this.set=t?t.getSetter:Fr},Et=(function(){function a(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,ut(this,+t.duration,1,1),this.data=t.data,H&&(this._ctx=H,H.data.push(this)),kt||le.wake()}var e=a.prototype;return e.delay=function(r){return r||r===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+r-this._delay),this._delay=r,this):this._delay},e.duration=function(r){return arguments.length?this.totalDuration(this._repeat>0?r+(r+this._rDelay)*this._repeat:r):this.totalDuration()&&this._dur},e.totalDuration=function(r){return arguments.length?(this._dirty=0,ut(this,this._repeat<0?r:(r-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(r,i){if(dt(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Qt(this,r),!n._dp||n.parent||Ni(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&r<this._tDur||this._ts<0&&r>0||!this._tDur&&!r)&&Ce(this._dp,this,this._start-this._delay)}return(this._tTime!==r||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===N||!this._initted&&this._dur&&r||!r&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=r),Mi(this,r,i)),this},e.time=function(r,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),r+Jr(this))%(this._dur+this._rDelay)||(r?this._dur:0),i):this._time},e.totalProgress=function(r,i){return arguments.length?this.totalTime(this.totalDuration()*r,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(r,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-r:r)+Jr(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(r,i){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(r-1)*n,i):this._repeat?ht(this._tTime,n)+1:1},e.timeScale=function(r,i){if(!arguments.length)return this._rts===-N?0:this._rts;if(this._rts===r)return this;var n=this.parent&&this._ts?Ut(this.parent._time,this):this._tTime;return this._rts=+r||0,this._ts=this._ps||r===-N?0:this._rts,this.totalTime(Pt(-Math.abs(this._delay),this.totalDuration(),n),i!==!1),Kt(this),fs(this)},e.paused=function(r){return arguments.length?(this._ps!==r&&(this._ps=r,r?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(dt(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==N&&(this._tTime-=N)))),this):this._ps},e.startTime=function(r){if(arguments.length){this._start=$(r);var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Ce(i,this,this._start-this._delay),this}return this._start},e.endTime=function(r){return this._start+(re(r)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(r){var i=this.parent||this._dp;return i?r&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Ut(i.rawTime(r),this):this._tTime:this._tTime},e.revert=function(r){r===void 0&&(r=cs);var i=J;return J=r,Rr(this)&&(this.timeline&&this.timeline.revert(r),this.totalTime(-.01,r.suppressEvents)),this.data!=="nested"&&r.kill!==!1&&this.kill(),J=i,this},e.globalTime=function(r){for(var i=this,n=arguments.length?r:i.rawTime();i;)n=i._start+n/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(r):n},e.repeat=function(r){return arguments.length?(this._repeat=r===1/0?-2:r,Zr(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(r){if(arguments.length){var i=this._time;return this._rDelay=r,Zr(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(r){return arguments.length?(this._yoyo=r,this):this._yoyo},e.seek=function(r,i){return this.totalTime(ge(this,r),re(i))},e.restart=function(r,i){return this.play().totalTime(r?-this._delay:0,re(i)),this._dur||(this._zTime=-N),this},e.play=function(r,i){return r!=null&&this.seek(r,i),this.reversed(!1).paused(!1)},e.reverse=function(r,i){return r!=null&&this.seek(r||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(r,i){return r!=null&&this.seek(r,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(r){return arguments.length?(!!r!==this.reversed()&&this.timeScale(-this._rts||(r?-N:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-N,this},e.isActive=function(){var r=this.parent||this._dp,i=this._start,n;return!!(!r||this._ts&&this._initted&&r.isActive()&&(n=r.rawTime(!0))>=i&&n<this.endTime(!0)-N)},e.eventCallback=function(r,i,n){var s=this.vars;return arguments.length>1?(i?(s[r]=i,n&&(s[r+"Params"]=n),r==="onUpdate"&&(this._onUpdate=i)):delete s[r],this):s[r]},e.then=function(r){var i=this,n=i._prom;return new Promise(function(s){var o=V(r)?r:Li,l=function(){var h=i.then;i.then=null,n&&n(),V(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=h),s(o),i.then=h};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?l():i._prom=l})},e.kill=function(){_t(this)},a})();fe(Et.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-N,_prom:0,_ps:!1,_rts:1});var te=(function(a){Ti(e,a);function e(r,i){var n;return r===void 0&&(r={}),n=a.call(this,r)||this,n.labels={},n.smoothChildTiming=!!r.smoothChildTiming,n.autoRemoveChildren=!!r.autoRemoveChildren,n._sort=re(r.sortChildren),q&&Ce(r.parent||q,ke(n),i),r.reversed&&n.reverse(),r.paused&&n.paused(!0),r.scrollTrigger&&Fi(ke(n),r.scrollTrigger),n}var t=e.prototype;return t.to=function(i,n,s){return vt(0,arguments,this),this},t.from=function(i,n,s){return vt(1,arguments,this),this},t.fromTo=function(i,n,s,o){return vt(2,arguments,this),this},t.set=function(i,n,s){return n.duration=0,n.parent=this,bt(n).repeatDelay||(n.repeat=0),n.immediateRender=!!n.immediateRender,new G(i,n,ge(this,s),1),this},t.call=function(i,n,s){return Ce(this,G.delayedCall(0,i,n),s)},t.staggerTo=function(i,n,s,o,l,c,h){return s.duration=n,s.stagger=s.stagger||o,s.onComplete=c,s.onCompleteParams=h,s.parent=this,new G(i,s,ge(this,l)),this},t.staggerFrom=function(i,n,s,o,l,c,h){return s.runBackwards=1,bt(s).immediateRender=re(s.immediateRender),this.staggerTo(i,n,s,o,l,c,h)},t.staggerFromTo=function(i,n,s,o,l,c,h,u){return o.startAt=s,bt(o).immediateRender=re(o.immediateRender),this.staggerTo(i,n,o,l,c,h,u)},t.render=function(i,n,s){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,h=i<=0?0:$(i),u=this._zTime<0!=i<0&&(this._initted||!c),f,g,m,d,p,y,v,T,C,b,k,x;if(this!==q&&h>l&&i>=0&&(h=l),h!==this._tTime||s||u){if(o!==this._time&&c&&(h+=this._time-o,i+=this._time-o),f=h,C=this._start,T=this._ts,y=!T,u&&(c||(o=this._zTime),(i||!n)&&(this._zTime=i)),this._repeat){if(k=this._yoyo,p=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(p*100+i,n,s);if(f=$(h%p),h===l?(d=this._repeat,f=c):(b=$(h/p),d=~~b,d&&d===b&&(f=c,d--),f>c&&(f=c)),b=ht(this._tTime,p),!o&&this._tTime&&b!==d&&this._tTime-b*p-this._dur<=0&&(b=d),k&&d&1&&(f=c-f,x=1),d!==b&&!this._lock){var S=k&&b&1,w=S===(k&&d&1);if(d<b&&(S=!S),o=S?0:h%c?c:h,this._lock=1,this.render(o||(x?0:$(d*p)),n,!c)._lock=0,this._tTime=h,!n&&this.parent&&ce(this,"onRepeat"),this.vars.repeatRefresh&&!x&&(this.invalidate()._lock=1,b=d),o&&o!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,w&&(this._lock=2,o=S?c:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!x&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;Zi(this,x)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(v=_s(this,$(o),$(f)),v&&(h-=f-(f=v._start))),this._tTime=h,this._time=f,this._act=!T,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,o=0),!o&&h&&c&&!n&&!b&&(ce(this,"onStart"),this._tTime!==h))return this;if(f>=o&&i>=0)for(g=this._first;g;){if(m=g._next,(g._act||f>=g._start)&&g._ts&&v!==g){if(g.parent!==this)return this.render(i,n,s);if(g.render(g._ts>0?(f-g._start)*g._ts:(g._dirty?g.totalDuration():g._tDur)+(f-g._start)*g._ts,n,s),f!==this._time||!this._ts&&!y){v=0,m&&(h+=this._zTime=-N);break}}g=m}else{g=this._last;for(var O=i<0?i:f;g;){if(m=g._prev,(g._act||O<=g._end)&&g._ts&&v!==g){if(g.parent!==this)return this.render(i,n,s);if(g.render(g._ts>0?(O-g._start)*g._ts:(g._dirty?g.totalDuration():g._tDur)+(O-g._start)*g._ts,n,s||J&&Rr(g)),f!==this._time||!this._ts&&!y){v=0,m&&(h+=this._zTime=O?-N:N);break}}g=m}}if(v&&!n&&(this.pause(),v.render(f>=o?0:-N)._zTime=f>=o?1:-1,this._ts))return this._start=C,Kt(this),this.render(i,n,s);this._onUpdate&&!n&&ce(this,"onUpdate",!0),(h===l&&this._tTime>=this.totalDuration()||!h&&o)&&(C===this._start||Math.abs(T)!==Math.abs(this._ts))&&(this._lock||((i||!c)&&(h===l&&this._ts>0||!h&&this._ts<0)&&Fe(this,1),!n&&!(i<0&&!o)&&(h||o||!l)&&(ce(this,h===l&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,n){var s=this;if(Oe(n)||(n=ge(this,n,i)),!(i instanceof Et)){if(ee(i))return i.forEach(function(o){return s.add(o,n)}),this;if(j(i))return this.addLabel(i,n);if(V(i))i=G.delayedCall(0,i);else return this}return this!==i?Ce(this,i,n):this},t.getChildren=function(i,n,s,o){i===void 0&&(i=!0),n===void 0&&(n=!0),s===void 0&&(s=!0),o===void 0&&(o=-pe);for(var l=[],c=this._first;c;)c._start>=o&&(c instanceof G?n&&l.push(c):(s&&l.push(c),i&&l.push.apply(l,c.getChildren(!0,n,s)))),c=c._next;return l},t.getById=function(i){for(var n=this.getChildren(1,1,1),s=n.length;s--;)if(n[s].vars.id===i)return n[s]},t.remove=function(i){return j(i)?this.removeLabel(i):V(i)?this.killTweensOf(i):(i.parent===this&&jt(this,i),i===this._recent&&(this._recent=this._last),je(this))},t.totalTime=function(i,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=$(le.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),a.prototype.totalTime.call(this,i,n),this._forcing=0,this):this._tTime},t.addLabel=function(i,n){return this.labels[i]=ge(this,n),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,n,s){var o=G.delayedCall(0,n||xt,s);return o.data="isPause",this._hasPause=1,Ce(this,o,ge(this,i))},t.removePause=function(i){var n=this._first;for(i=ge(this,i);n;)n._start===i&&n.data==="isPause"&&Fe(n),n=n._next},t.killTweensOf=function(i,n,s){for(var o=this.getTweensOf(i,s),l=o.length;l--;)Me!==o[l]&&o[l].kill(i,n);return this},t.getTweensOf=function(i,n){for(var s=[],o=me(i),l=this._first,c=Oe(n),h;l;)l instanceof G?hs(l._targets,o)&&(c?(!Me||l._initted&&l._ts)&&l.globalTime(0)<=n&&l.globalTime(l.totalDuration())>n:!n||l.isActive())&&s.push(l):(h=l.getTweensOf(o,n)).length&&s.push.apply(s,h),l=l._next;return s},t.tweenTo=function(i,n){n=n||{};var s=this,o=ge(s,i),l=n,c=l.startAt,h=l.onStart,u=l.onStartParams,f=l.immediateRender,g,m=G.to(s,fe({ease:n.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:n.duration||Math.abs((o-(c&&"time"in c?c.time:s._time))/s.timeScale())||N,onStart:function(){if(s.pause(),!g){var p=n.duration||Math.abs((o-(c&&"time"in c?c.time:s._time))/s.timeScale());m._dur!==p&&ut(m,p,0,1).render(m._time,!0,!0),g=1}h&&h.apply(m,u||[])}},n));return f?m.render(0):m},t.tweenFromTo=function(i,n,s){return this.tweenTo(n,fe({startAt:{time:ge(this,i)}},s))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),ei(this,ge(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),ei(this,ge(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+N)},t.shiftChildren=function(i,n,s){s===void 0&&(s=0);var o=this._first,l=this.labels,c;for(i=$(i);o;)o._start>=s&&(o._start+=i,o._end+=i),o=o._next;if(n)for(c in l)l[c]>=s&&(l[c]+=i);return je(this)},t.invalidate=function(i){var n=this._first;for(this._lock=0;n;)n.invalidate(i),n=n._next;return a.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var n=this._first,s;n;)s=n._next,this.remove(n),n=s;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),je(this)},t.totalDuration=function(i){var n=0,s=this,o=s._last,l=pe,c,h,u;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-i:i));if(s._dirty){for(u=s.parent;o;)c=o._prev,o._dirty&&o.totalDuration(),h=o._start,h>l&&s._sort&&o._ts&&!s._lock?(s._lock=1,Ce(s,o,h-o._delay,1)._lock=0):l=h,h<0&&o._ts&&(n-=h,(!u&&!s._dp||u&&u.smoothChildTiming)&&(s._start+=$(h/s._ts),s._time-=h,s._tTime-=h),s.shiftChildren(-h,!1,-1/0),l=0),o._end>n&&o._ts&&(n=o._end),o=c;ut(s,s===q&&s._time>n?s._time:n,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(i){if(q._ts&&(Mi(q,Ut(i,q)),Ii=le.frame),le.frame>=Kr){Kr+=ue.autoSleep||120;var n=q._first;if((!n||!n._ts)&&ue.autoSleep&&le._listeners.length<2){for(;n&&!n._ts;)n=n._next;n||le.sleep()}}},e})(Et);fe(te.prototype,{_lock:0,_hasPause:0,_forcing:0});var Ms=function(e,t,r,i,n,s,o){var l=new ne(this._pt,e,t,0,1,ln,null,n),c=0,h=0,u,f,g,m,d,p,y,v;for(l.b=r,l.e=i,r+="",i+="",(y=~i.indexOf("random("))&&(i=St(i)),s&&(v=[r,i],s(v,e,t),r=v[0],i=v[1]),f=r.match(Jt)||[];u=Jt.exec(i);)m=u[0],d=i.substring(c,u.index),g?g=(g+1)%5:d.substr(-5)==="rgba("&&(g=1),m!==f[h++]&&(p=parseFloat(f[h-1])||0,l._pt={_next:l._pt,p:d||h===1?d:",",s:p,c:m.charAt(1)==="="?st(p,m)-p:parseFloat(m)-p,m:g&&g<4?Math.round:0},c=Jt.lastIndex);return l.c=c<i.length?i.substring(c,i.length):"",l.fp=o,(Ei.test(i)||y)&&(l.e=0),this._pt=l,l},Lr=function(e,t,r,i,n,s,o,l,c,h){V(i)&&(i=i(n||0,e,s));var u=e[t],f=r!=="get"?r:V(u)?c?e[t.indexOf("set")||!V(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():u,g=V(u)?c?Fs:on:Nr,m;if(j(i)&&(~i.indexOf("random(")&&(i=St(i)),i.charAt(1)==="="&&(m=st(f,i)+(Z(f)||0),(m||m===0)&&(i=m))),!h||f!==i||br)return!isNaN(f*i)&&i!==""?(m=new ne(this._pt,e,t,+f||0,i-(f||0),typeof u=="boolean"?Hs:an,0,g),c&&(m.fp=c),o&&m.modifier(o,this,e),this._pt=m):(!u&&!(t in e)&&Pr(t,i),Ms.call(this,e,t,f,i,g,l||ue.stringFilter,c))},Rs=function(e,t,r,i,n){if(V(e)&&(e=Ct(e,n,t,r,i)),!Te(e)||e.style&&e.nodeType||ee(e)||Si(e))return j(e)?Ct(e,n,t,r,i):e;var s={},o;for(o in e)s[o]=Ct(e[o],n,t,r,i);return s},rn=function(e,t,r,i,n,s){var o,l,c,h;if(ae[e]&&(o=new ae[e]).init(n,o.rawVars?t[e]:Rs(t[e],i,n,s,r),r,i,s)!==!1&&(r._pt=l=new ne(r._pt,n,e,0,1,o.render,o,0,o.priority),r!==nt))for(c=r._ptLookup[r._targets.indexOf(n)],h=o._props.length;h--;)c[o._props[h]]=l;return o},Me,br,Br=function a(e,t,r){var i=e.vars,n=i.ease,s=i.startAt,o=i.immediateRender,l=i.lazy,c=i.onUpdate,h=i.runBackwards,u=i.yoyoEase,f=i.keyframes,g=i.autoRevert,m=e._dur,d=e._startAt,p=e._targets,y=e.parent,v=y&&y.data==="nested"?y.vars.targets:p,T=e._overwrite==="auto"&&!kr,C=e.timeline,b,k,x,S,w,O,P,I,D,M,R,L,z;if(C&&(!f||!n)&&(n="none"),e._ease=Ke(n,lt.ease),e._yEase=u?Ji(Ke(u===!0?n:u,lt.ease)):0,u&&e._yoyo&&!e._repeat&&(u=e._yEase,e._yEase=e._ease,e._ease=u),e._from=!C&&!!i.runBackwards,!C||f&&!i.stagger){if(I=p[0]?Xe(p[0]).harness:0,L=I&&i[I.prop],b=qt(i,Ir),d&&(d._zTime<0&&d.progress(1),t<0&&h&&o&&!g?d.render(-1,!0):d.revert(h&&m?Dt:ls),d._lazy=0),s){if(Fe(e._startAt=G.set(p,fe({data:"isStart",overwrite:!1,parent:y,immediateRender:!0,lazy:!d&&re(l),startAt:null,delay:0,onUpdate:c&&function(){return ce(e,"onUpdate")},stagger:0},s))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(J||!o&&!g)&&e._startAt.revert(Dt),o&&m&&t<=0&&r<=0){t&&(e._zTime=t);return}}else if(h&&m&&!d){if(t&&(o=!1),x=fe({overwrite:!1,data:"isFromStart",lazy:o&&!d&&re(l),immediateRender:o,stagger:0,parent:y},b),L&&(x[I.prop]=L),Fe(e._startAt=G.set(p,x)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(J?e._startAt.revert(Dt):e._startAt.render(-1,!0)),e._zTime=t,!o)a(e._startAt,N,N);else if(!t)return}for(e._pt=e._ptCache=0,l=m&&re(l)||l&&!m,k=0;k<p.length;k++){if(w=p[k],P=w._gsap||Mr(p)[k]._gsap,e._ptLookup[k]=M={},fr[P.id]&&Be.length&&$t(),R=v===p?k:v.indexOf(w),I&&(D=new I).init(w,L||b,e,R,v)!==!1&&(e._pt=S=new ne(e._pt,w,D.name,0,1,D.render,D,0,D.priority),D._props.forEach(function(X){M[X]=S}),D.priority&&(O=1)),!I||L)for(x in b)ae[x]&&(D=rn(x,b,e,R,w,v))?D.priority&&(O=1):M[x]=S=Lr.call(e,w,x,"get",b[x],R,v,0,i.stringFilter);e._op&&e._op[k]&&e.kill(w,e._op[k]),T&&e._pt&&(Me=e,q.killTweensOf(w,M,e.globalTime(t)),z=!e.parent,Me=0),e._pt&&l&&(fr[P.id]=1)}O&&cn(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!z,f&&t<=0&&C.render(pe,!0,!0)},Ls=function(e,t,r,i,n,s,o,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],h,u,f,g;if(!c)for(c=e._ptCache[t]=[],f=e._ptLookup,g=e._targets.length;g--;){if(h=f[g][t],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==t&&h.fp!==t;)h=h._next;if(!h)return br=1,e.vars[t]="+=0",Br(e,o),br=0,l?Tt(t+" not eligible for reset"):1;c.push(h)}for(g=c.length;g--;)u=c[g],h=u._pt||u,h.s=(i||i===0)&&!n?i:h.s+(i||0)+s*h.c,h.c=r-h.s,u.e&&(u.e=W(r)+Z(u.e)),u.b&&(u.b=h.s+Z(u.b))},Bs=function(e,t){var r=e[0]?Xe(e[0]).harness:0,i=r&&r.aliases,n,s,o,l;if(!i)return t;n=ct({},t);for(s in i)if(s in n)for(l=i[s].split(","),o=l.length;o--;)n[l[o]]=n[s];return n},Ns=function(e,t,r,i){var n=t.ease||i||"power1.inOut",s,o;if(ee(t))o=r[e]||(r[e]=[]),t.forEach(function(l,c){return o.push({t:c/(t.length-1)*100,v:l,e:n})});else for(s in t)o=r[s]||(r[s]=[]),s==="ease"||o.push({t:parseFloat(e),v:t[s],e:n})},Ct=function(e,t,r,i,n){return V(e)?e.call(t,r,i,n):j(e)&&~e.indexOf("random(")?St(e):e},nn=Dr+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",sn={};ie(nn+",id,stagger,delay,duration,paused,scrollTrigger",function(a){return sn[a]=1});var G=(function(a){Ti(e,a);function e(r,i,n,s){var o;typeof i=="number"&&(n.duration=i,i=n,n=null),o=a.call(this,s?i:bt(i))||this;var l=o.vars,c=l.duration,h=l.delay,u=l.immediateRender,f=l.stagger,g=l.overwrite,m=l.keyframes,d=l.defaults,p=l.scrollTrigger,y=l.yoyoEase,v=i.parent||q,T=(ee(r)||Si(r)?Oe(r[0]):"length"in i)?[r]:me(r),C,b,k,x,S,w,O,P;if(o._targets=T.length?Mr(T):Tt("GSAP target "+r+" not found. https://gsap.com",!ue.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=g,m||f||It(c)||It(h)){if(i=o.vars,C=o.timeline=new te({data:"nested",defaults:d||{},targets:v&&v.data==="nested"?v.vars.targets:T}),C.kill(),C.parent=C._dp=ke(o),C._start=0,f||It(c)||It(h)){if(x=T.length,O=f&&qi(f),Te(f))for(S in f)~nn.indexOf(S)&&(P||(P={}),P[S]=f[S]);for(b=0;b<x;b++)k=qt(i,sn),k.stagger=0,y&&(k.yoyoEase=y),P&&ct(k,P),w=T[b],k.duration=+Ct(c,ke(o),b,w,T),k.delay=(+Ct(h,ke(o),b,w,T)||0)-o._delay,!f&&x===1&&k.delay&&(o._delay=h=k.delay,o._start+=h,k.delay=0),C.to(w,k,O?O(b,w,T):0),C._ease=A.none;C.duration()?c=h=0:o.timeline=0}else if(m){bt(fe(C.vars.defaults,{ease:"none"})),C._ease=Ke(m.ease||i.ease||"none");var I=0,D,M,R;if(ee(m))m.forEach(function(L){return C.to(T,L,">")}),C.duration();else{k={};for(S in m)S==="ease"||S==="easeEach"||Ns(S,m[S],k,m.easeEach);for(S in k)for(D=k[S].sort(function(L,z){return L.t-z.t}),I=0,b=0;b<D.length;b++)M=D[b],R={ease:M.e,duration:(M.t-(b?D[b-1].t:0))/100*c},R[S]=M.v,C.to(T,R,I),I+=R.duration;C.duration()<c&&C.to({},{duration:c-C.duration()})}}c||o.duration(c=C.duration())}else o.timeline=0;return g===!0&&!kr&&(Me=ke(o),q.killTweensOf(T),Me=0),Ce(v,ke(o),n),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(u||!c&&!m&&o._start===$(v._time)&&re(u)&&gs(ke(o))&&v.data!=="nested")&&(o._tTime=-N,o.render(Math.max(0,-h)||0)),p&&Fi(ke(o),p),o}var t=e.prototype;return t.render=function(i,n,s){var o=this._time,l=this._tDur,c=this._dur,h=i<0,u=i>l-N&&!h?l:i<N?0:i,f,g,m,d,p,y,v,T,C;if(!c)ms(this,i,n,s);else if(u!==this._tTime||!i||s||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(f=u,T=this.timeline,this._repeat){if(d=c+this._rDelay,this._repeat<-1&&h)return this.totalTime(d*100+i,n,s);if(f=$(u%d),u===l?(m=this._repeat,f=c):(p=$(u/d),m=~~p,m&&m===p?(f=c,m--):f>c&&(f=c)),y=this._yoyo&&m&1,y&&(C=this._yEase,f=c-f),p=ht(this._tTime,d),f===o&&!s&&this._initted&&m===p)return this._tTime=u,this;m!==p&&(T&&this._yEase&&Zi(T,y),this.vars.repeatRefresh&&!y&&!this._lock&&f!==d&&this._initted&&(this._lock=s=1,this.render($(d*m),!0).invalidate()._lock=0))}if(!this._initted){if(zi(this,h?i:f,s,n,u))return this._tTime=0,this;if(o!==this._time&&!(s&&this.vars.repeatRefresh&&m!==p))return this;if(c!==this._dur)return this.render(i,n,s)}if(this._tTime=u,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=v=(C||this._ease)(f/c),this._from&&(this.ratio=v=1-v),!o&&u&&!n&&!p&&(ce(this,"onStart"),this._tTime!==u))return this;for(g=this._pt;g;)g.r(v,g.d),g=g._next;T&&T.render(i<0?i:T._dur*T._ease(f/this._dur),n,s)||this._startAt&&(this._zTime=i),this._onUpdate&&!n&&(h&&gr(this,i,n,s),ce(this,"onUpdate")),this._repeat&&m!==p&&this.vars.onRepeat&&!n&&this.parent&&ce(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(h&&!this._onUpdate&&gr(this,i,!0,!0),(i||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&Fe(this,1),!n&&!(h&&!o)&&(u||o||y)&&(ce(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),a.prototype.invalidate.call(this,i)},t.resetTo=function(i,n,s,o,l){kt||le.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||Br(this,c),h=this._ease(c/this._dur),Ls(this,i,n,s,o,h,c,l)?this.resetTo(i,n,s,o,1):(Qt(this,0),this.parent||Bi(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,n){if(n===void 0&&(n="all"),!i&&(!n||n==="all"))return this._lazy=this._pt=0,this.parent?_t(this):this.scrollTrigger&&this.scrollTrigger.kill(!!J),this;if(this.timeline){var s=this.timeline.totalDuration();return this.timeline.killTweensOf(i,n,Me&&Me.vars.overwrite!==!0)._first||_t(this),this.parent&&s!==this.timeline.totalDuration()&&ut(this,this._dur*this.timeline._tDur/s,0,1),this}var o=this._targets,l=i?me(i):o,c=this._ptLookup,h=this._pt,u,f,g,m,d,p,y;if((!n||n==="all")&&ds(o,l))return n==="all"&&(this._pt=0),_t(this);for(u=this._op=this._op||[],n!=="all"&&(j(n)&&(d={},ie(n,function(v){return d[v]=1}),n=d),n=Bs(o,n)),y=o.length;y--;)if(~l.indexOf(o[y])){f=c[y],n==="all"?(u[y]=n,m=f,g={}):(g=u[y]=u[y]||{},m=n);for(d in m)p=f&&f[d],p&&((!("kill"in p.d)||p.d.kill(d)===!0)&&jt(this,p,"_pt"),delete f[d]),g!=="all"&&(g[d]=1)}return this._initted&&!this._pt&&h&&_t(this),this},e.to=function(i,n){return new e(i,n,arguments[2])},e.from=function(i,n){return vt(1,arguments)},e.delayedCall=function(i,n,s,o){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:n,onReverseComplete:n,onCompleteParams:s,onReverseCompleteParams:s,callbackScope:o})},e.fromTo=function(i,n,s){return vt(2,arguments)},e.set=function(i,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(i,n)},e.killTweensOf=function(i,n,s){return q.killTweensOf(i,n,s)},e})(Et);fe(G.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ie("staggerTo,staggerFrom,staggerFromTo",function(a){G[a]=function(){var e=new te,t=mr.call(arguments,0);return t.splice(a==="staggerFromTo"?5:4,0,0),e[a].apply(e,t)}});var Nr=function(e,t,r){return e[t]=r},on=function(e,t,r){return e[t](r)},Fs=function(e,t,r,i){return e[t](i.fp,r)},zs=function(e,t,r){return e.setAttribute(t,r)},Fr=function(e,t){return V(e[t])?on:Er(e[t])&&e.setAttribute?zs:Nr},an=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Hs=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},ln=function(e,t){var r=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;r;)i=r.p+(r.m?r.m(r.s+r.c*e):Math.round((r.s+r.c*e)*1e4)/1e4)+i,r=r._next;i+=t.c}t.set(t.t,t.p,i,t)},zr=function(e,t){for(var r=t._pt;r;)r.r(e,r.d),r=r._next},$s=function(e,t,r,i){for(var n=this._pt,s;n;)s=n._next,n.p===i&&n.modifier(e,t,r),n=s},qs=function(e){for(var t=this._pt,r,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?jt(this,t,"_pt"):t.dep||(r=1),t=i;return!r},Us=function(e,t,r,i){i.mSet(e,t,i.m.call(i.tween,r,i.mt),i)},cn=function(e){for(var t=e._pt,r,i,n,s;t;){for(r=t._next,i=n;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:s)?t._prev._next=t:n=t,(t._next=i)?i._prev=t:s=t,t=r}e._pt=n},ne=(function(){function a(t,r,i,n,s,o,l,c,h){this.t=r,this.s=n,this.c=s,this.p=i,this.r=o||an,this.d=l||this,this.set=c||Nr,this.pr=h||0,this._next=t,t&&(t._prev=this)}var e=a.prototype;return e.modifier=function(r,i,n){this.mSet=this.mSet||this.set,this.set=Us,this.m=r,this.mt=n,this.tween=i},a})();ie(Dr+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(a){return Ir[a]=1});de.TweenMax=de.TweenLite=G;de.TimelineLite=de.TimelineMax=te;q=new te({sortChildren:!1,defaults:lt,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});ue.stringFilter=Qi;var Qe=[],Rt={},Vs=[],ri=0,Ws=0,ir=function(e){return(Rt[e]||Vs).map(function(t){return t()})},vr=function(){var e=Date.now(),t=[];e-ri>2&&(ir("matchMediaInit"),Qe.forEach(function(r){var i=r.queries,n=r.conditions,s,o,l,c;for(o in i)s=ve.matchMedia(i[o]).matches,s&&(l=1),s!==n[o]&&(n[o]=s,c=1);c&&(r.revert(),l&&t.push(r))}),ir("matchMediaRevert"),t.forEach(function(r){return r.onMatch(r,function(i){return r.add(null,i)})}),ri=e,ir("matchMedia"))},hn=(function(){function a(t,r){this.selector=r&&_r(r),this.data=[],this._r=[],this.isReverted=!1,this.id=Ws++,t&&this.add(t)}var e=a.prototype;return e.add=function(r,i,n){V(r)&&(n=i,i=r,r=V);var s=this,o=function(){var c=H,h=s.selector,u;return c&&c!==s&&c.data.push(s),n&&(s.selector=_r(n)),H=s,u=i.apply(s,arguments),V(u)&&s._r.push(u),H=c,s.selector=h,s.isReverted=!1,u};return s.last=o,r===V?o(s,function(l){return s.add(null,l)}):r?s[r]=o:o},e.ignore=function(r){var i=H;H=null,r(this),H=i},e.getTweens=function(){var r=[];return this.data.forEach(function(i){return i instanceof a?r.push.apply(r,i.getTweens()):i instanceof G&&!(i.parent&&i.parent.data==="nested")&&r.push(i)}),r},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(r,i){var n=this;if(r?(function(){for(var o=n.getTweens(),l=n.data.length,c;l--;)c=n.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(h){return o.splice(o.indexOf(h),1)}));for(o.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,u){return u.g-h.g||-1/0}).forEach(function(h){return h.t.revert(r)}),l=n.data.length;l--;)c=n.data[l],c instanceof te?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof G)&&c.revert&&c.revert(r);n._r.forEach(function(h){return h(r,n)}),n.isReverted=!0})():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),i)for(var s=Qe.length;s--;)Qe[s].id===this.id&&Qe.splice(s,1)},e.revert=function(r){this.kill(r||{})},a})(),Gs=(function(){function a(t){this.contexts=[],this.scope=t,H&&H.data.push(this)}var e=a.prototype;return e.add=function(r,i,n){Te(r)||(r={matches:r});var s=new hn(0,n||this.scope),o=s.conditions={},l,c,h;H&&!s.selector&&(s.selector=H.selector),this.contexts.push(s),i=s.add("onMatch",i),s.queries=r;for(c in r)c==="all"?h=1:(l=ve.matchMedia(r[c]),l&&(Qe.indexOf(s)<0&&Qe.push(s),(o[c]=l.matches)&&(h=1),l.addListener?l.addListener(vr):l.addEventListener("change",vr)));return h&&i(s,function(u){return s.add(null,u)}),this},e.revert=function(r){this.kill(r||{})},e.kill=function(r){this.contexts.forEach(function(i){return i.kill(r,!0)})},a})(),Vt={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(function(i){return Xi(i)})},timeline:function(e){return new te(e)},getTweensOf:function(e,t){return q.getTweensOf(e,t)},getProperty:function(e,t,r,i){j(e)&&(e=me(e)[0]);var n=Xe(e||{}).get,s=r?Li:Ri;return r==="native"&&(r=""),e&&(t?s((ae[t]&&ae[t].get||n)(e,t,r,i)):function(o,l,c){return s((ae[o]&&ae[o].get||n)(e,o,l,c))})},quickSetter:function(e,t,r){if(e=me(e),e.length>1){var i=e.map(function(h){return oe.quickSetter(h,t,r)}),n=i.length;return function(h){for(var u=n;u--;)i[u](h)}}e=e[0]||{};var s=ae[t],o=Xe(e),l=o.harness&&(o.harness.aliases||{})[t]||t,c=s?function(h){var u=new s;nt._pt=0,u.init(e,r?h+r:h,nt,0,[e]),u.render(1,u),nt._pt&&zr(1,nt)}:o.set(e,l);return s?c:function(h){return c(e,l,r?h+r:h,o,1)}},quickTo:function(e,t,r){var i,n=oe.to(e,fe((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),r||{})),s=function(l,c,h){return n.resetTo(t,l,c,h)};return s.tween=n,s},isTweening:function(e){return q.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Ke(e.ease,lt.ease)),Qr(lt,e||{})},config:function(e){return Qr(ue,e||{})},registerEffect:function(e){var t=e.name,r=e.effect,i=e.plugins,n=e.defaults,s=e.extendTimeline;(i||"").split(",").forEach(function(o){return o&&!ae[o]&&!de[o]&&Tt(t+" effect requires "+o+" plugin.")}),Zt[t]=function(o,l,c){return r(me(o),fe(l||{},n),c)},s&&(te.prototype[t]=function(o,l,c){return this.add(Zt[t](o,Te(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){A[e]=Ke(t)},parseEase:function(e,t){return arguments.length?Ke(e,t):A},getById:function(e){return q.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var r=new te(e),i,n;for(r.smoothChildTiming=re(e.smoothChildTiming),q.remove(r),r._dp=0,r._time=r._tTime=q._time,i=q._first;i;)n=i._next,(t||!(!i._dur&&i instanceof G&&i.vars.onComplete===i._targets[0]))&&Ce(r,i,i._start-i._delay),i=n;return Ce(q,r,0),r},context:function(e,t){return e?new hn(e,t):H},matchMedia:function(e){return new Gs(e)},matchMediaRefresh:function(){return Qe.forEach(function(e){var t=e.conditions,r,i;for(i in t)t[i]&&(t[i]=!1,r=1);r&&e.revert()})||vr()},addEventListener:function(e,t){var r=Rt[e]||(Rt[e]=[]);~r.indexOf(t)||r.push(t)},removeEventListener:function(e,t){var r=Rt[e],i=r&&r.indexOf(t);i>=0&&r.splice(i,1)},utils:{wrap:xs,wrapYoyo:Ss,distribute:qi,random:Vi,snap:Ui,normalize:Ts,getUnit:Z,clamp:bs,splitColor:ji,toArray:me,selector:_r,mapRange:Gi,pipe:Cs,unitize:ws,interpolate:ks,shuffle:$i},install:Ai,effects:Zt,ticker:le,updateRoot:te.updateRoot,plugins:ae,globalTimeline:q,core:{PropTween:ne,globals:Pi,Tween:G,Timeline:te,Animation:Et,getCache:Xe,_removeLinkedListItem:jt,reverting:function(){return J},context:function(e){return e&&H&&(H.data.push(e),e._ctx=H),H},suppressOverwrites:function(e){return kr=e}}};ie("to,from,fromTo,delayedCall,set,killTweensOf",function(a){return Vt[a]=G[a]});le.add(te.updateRoot);nt=Vt.to({},{duration:0});var Ys=function(e,t){for(var r=e._pt;r&&r.p!==t&&r.op!==t&&r.fp!==t;)r=r._next;return r},Xs=function(e,t){var r=e._targets,i,n,s;for(i in t)for(n=r.length;n--;)s=e._ptLookup[n][i],s&&(s=s.d)&&(s._pt&&(s=Ys(s,i)),s&&s.modifier&&s.modifier(t[i],e,r[n],i))},nr=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,n,s){s._onInit=function(o){var l,c;if(j(n)&&(l={},ie(n,function(h){return l[h]=1}),n=l),t){l={};for(c in n)l[c]=t(n[c]);n=l}Xs(o,n)}}}},oe=Vt.registerPlugin({name:"attr",init:function(e,t,r,i,n){var s,o,l;this.tween=r;for(s in t)l=e.getAttribute(s)||"",o=this.add(e,"setAttribute",(l||0)+"",t[s],i,n,0,0,s),o.op=s,o.b=l,this._props.push(s)},render:function(e,t){for(var r=t._pt;r;)J?r.set(r.t,r.p,r.b,r):r.r(e,r.d),r=r._next}},{name:"endArray",headless:1,init:function(e,t){for(var r=t.length;r--;)this.add(e,r,e[r]||0,t[r],0,0,0,0,0,1)}},nr("roundProps",yr),nr("modifiers"),nr("snap",Ui))||Vt;G.version=te.version=oe.version="3.14.2";Oi=1;Or()&&dt();A.Power0;A.Power1;A.Power2;A.Power3;A.Power4;A.Linear;A.Quad;A.Cubic;A.Quart;A.Quint;A.Strong;A.Elastic;A.Back;A.SteppedEase;A.Bounce;A.Sine;A.Expo;A.Circ;/*!
 * CSSPlugin 3.14.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var ii,Re,ot,Hr,Ge,ni,$r,js=function(){return typeof window<"u"},Ae={},We=180/Math.PI,at=Math.PI/180,tt=Math.atan2,si=1e8,qr=/([A-Z])/g,Ks=/(left|right|width|margin|padding|x)/i,Qs=/[\s,\(]\S/,we={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Cr=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Js=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Zs=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},eo=function(e,t){return t.set(t.t,t.p,e===1?t.e:e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},to=function(e,t){var r=t.s+t.c*e;t.set(t.t,t.p,~~(r+(r<0?-.5:.5))+t.u,t)},un=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},dn=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},ro=function(e,t,r){return e.style[t]=r},io=function(e,t,r){return e.style.setProperty(t,r)},no=function(e,t,r){return e._gsap[t]=r},so=function(e,t,r){return e._gsap.scaleX=e._gsap.scaleY=r},oo=function(e,t,r,i,n){var s=e._gsap;s.scaleX=s.scaleY=r,s.renderTransform(n,s)},ao=function(e,t,r,i,n){var s=e._gsap;s[t]=r,s.renderTransform(n,s)},U="transform",se=U+"Origin",lo=function a(e,t){var r=this,i=this.target,n=i.style,s=i._gsap;if(e in Ae&&n){if(this.tfm=this.tfm||{},e!=="transform")e=we[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return r.tfm[o]=Ee(i,o)}):this.tfm[e]=s.x?s[e]:Ee(i,e),e===se&&(this.tfm.zOrigin=s.zOrigin);else return we.transform.split(",").forEach(function(o){return a.call(r,o,t)});if(this.props.indexOf(U)>=0)return;s.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(se,t,"")),e=U}(n||t)&&this.props.push(e,t,n[e])},fn=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},co=function(){var e=this.props,t=this.target,r=t.style,i=t._gsap,n,s;for(n=0;n<e.length;n+=3)e[n+1]?e[n+1]===2?t[e[n]](e[n+2]):t[e[n]]=e[n+2]:e[n+2]?r[e[n]]=e[n+2]:r.removeProperty(e[n].substr(0,2)==="--"?e[n]:e[n].replace(qr,"-$1").toLowerCase());if(this.tfm){for(s in this.tfm)i[s]=this.tfm[s];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),n=$r(),(!n||!n.isStart)&&!r[U]&&(fn(r),i.zOrigin&&r[se]&&(r[se]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},gn=function(e,t){var r={target:e,props:[],revert:co,save:lo};return e._gsap||oe.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return r.save(i)}),r},pn,wr=function(e,t){var r=Re.createElementNS?Re.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Re.createElement(e);return r&&r.style?r:Re.createElement(e)},he=function a(e,t,r){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(qr,"-$1").toLowerCase())||i.getPropertyValue(t)||!r&&a(e,ft(t)||t,1)||""},oi="O,Moz,ms,Ms,Webkit".split(","),ft=function(e,t,r){var i=t||Ge,n=i.style,s=5;if(e in n&&!r)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);s--&&!(oi[s]+e in n););return s<0?null:(s===3?"ms":s>=0?oi[s]:"")+e},Tr=function(){js()&&window.document&&(ii=window,Re=ii.document,ot=Re.documentElement,Ge=wr("div")||{style:{}},wr("div"),U=ft(U),se=U+"Origin",Ge.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",pn=!!ft("perspective"),$r=oe.core.reverting,Hr=1)},ai=function(e){var t=e.ownerSVGElement,r=wr("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),n;i.style.display="block",r.appendChild(i),ot.appendChild(r);try{n=i.getBBox()}catch{}return r.removeChild(i),ot.removeChild(r),n},li=function(e,t){for(var r=t.length;r--;)if(e.hasAttribute(t[r]))return e.getAttribute(t[r])},mn=function(e){var t,r;try{t=e.getBBox()}catch{t=ai(e),r=1}return t&&(t.width||t.height)||r||(t=ai(e)),t&&!t.width&&!t.x&&!t.y?{x:+li(e,["x","cx","x1"])||0,y:+li(e,["y","cy","y1"])||0,width:0,height:0}:t},_n=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&mn(e))},ze=function(e,t){if(t){var r=e.style,i;t in Ae&&t!==se&&(t=U),r.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),r.removeProperty(i==="--"?t:t.replace(qr,"-$1").toLowerCase())):r.removeAttribute(t)}},Le=function(e,t,r,i,n,s){var o=new ne(e._pt,t,r,0,1,s?dn:un);return e._pt=o,o.b=i,o.e=n,e._props.push(r),o},ci={deg:1,rad:1,turn:1},ho={grid:1,flex:1},He=function a(e,t,r,i){var n=parseFloat(r)||0,s=(r+"").trim().substr((n+"").length)||"px",o=Ge.style,l=Ks.test(t),c=e.tagName.toLowerCase()==="svg",h=(c?"client":"offset")+(l?"Width":"Height"),u=100,f=i==="px",g=i==="%",m,d,p,y;if(i===s||!n||ci[i]||ci[s])return n;if(s!=="px"&&!f&&(n=a(e,t,r,"px")),y=e.getCTM&&_n(e),(g||s==="%")&&(Ae[t]||~t.indexOf("adius")))return m=y?e.getBBox()[l?"width":"height"]:e[h],W(g?n/m*u:n/100*m);if(o[l?"width":"height"]=u+(f?s:i),d=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!c?e:e.parentNode,y&&(d=(e.ownerSVGElement||{}).parentNode),(!d||d===Re||!d.appendChild)&&(d=Re.body),p=d._gsap,p&&g&&p.width&&l&&p.time===le.time&&!p.uncache)return W(n/p.width*u);if(g&&(t==="height"||t==="width")){var v=e.style[t];e.style[t]=u+i,m=e[h],v?e.style[t]=v:ze(e,t)}else(g||s==="%")&&!ho[he(d,"display")]&&(o.position=he(e,"position")),d===e&&(o.position="static"),d.appendChild(Ge),m=Ge[h],d.removeChild(Ge),o.position="absolute";return l&&g&&(p=Xe(d),p.time=le.time,p.width=d[h]),W(f?m*n/u:m&&n?u/m*n:0)},Ee=function(e,t,r,i){var n;return Hr||Tr(),t in we&&t!=="transform"&&(t=we[t],~t.indexOf(",")&&(t=t.split(",")[0])),Ae[t]&&t!=="transform"?(n=At(e,i),n=t!=="transformOrigin"?n[t]:n.svg?n.origin:Gt(he(e,se))+" "+n.zOrigin+"px"):(n=e.style[t],(!n||n==="auto"||i||~(n+"").indexOf("calc("))&&(n=Wt[t]&&Wt[t](e,t,r)||he(e,t)||Di(e,t)||(t==="opacity"?1:0))),r&&!~(n+"").trim().indexOf(" ")?He(e,t,n,r)+r:n},uo=function(e,t,r,i){if(!r||r==="none"){var n=ft(t,e,1),s=n&&he(e,n,1);s&&s!==r?(t=n,r=s):t==="borderColor"&&(r=he(e,"borderTopColor"))}var o=new ne(this._pt,e.style,t,0,1,ln),l=0,c=0,h,u,f,g,m,d,p,y,v,T,C,b;if(o.b=r,o.e=i,r+="",i+="",i.substring(0,6)==="var(--"&&(i=he(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(d=e.style[t],e.style[t]=i,i=he(e,t)||i,d?e.style[t]=d:ze(e,t)),h=[r,i],Qi(h),r=h[0],i=h[1],f=r.match(it)||[],b=i.match(it)||[],b.length){for(;u=it.exec(i);)p=u[0],v=i.substring(l,u.index),m?m=(m+1)%5:(v.substr(-5)==="rgba("||v.substr(-5)==="hsla(")&&(m=1),p!==(d=f[c++]||"")&&(g=parseFloat(d)||0,C=d.substr((g+"").length),p.charAt(1)==="="&&(p=st(g,p)+C),y=parseFloat(p),T=p.substr((y+"").length),l=it.lastIndex-T.length,T||(T=T||ue.units[t]||C,l===i.length&&(i+=T,o.e+=T)),C!==T&&(g=He(e,t,d,T)||0),o._pt={_next:o._pt,p:v||c===1?v:",",s:g,c:y-g,m:m&&m<4||t==="zIndex"?Math.round:0});o.c=l<i.length?i.substring(l,i.length):""}else o.r=t==="display"&&i==="none"?dn:un;return Ei.test(i)&&(o.e=0),this._pt=o,o},hi={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},fo=function(e){var t=e.split(" "),r=t[0],i=t[1]||"50%";return(r==="top"||r==="bottom"||i==="left"||i==="right")&&(e=r,r=i,i=e),t[0]=hi[r]||r,t[1]=hi[i]||i,t.join(" ")},go=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var r=t.t,i=r.style,n=t.u,s=r._gsap,o,l,c;if(n==="all"||n===!0)i.cssText="",l=1;else for(n=n.split(","),c=n.length;--c>-1;)o=n[c],Ae[o]&&(l=1,o=o==="transformOrigin"?se:U),ze(r,o);l&&(ze(r,U),s&&(s.svg&&r.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",At(r,1),s.uncache=1,fn(i)))}},Wt={clearProps:function(e,t,r,i,n){if(n.data!=="isFromStart"){var s=e._pt=new ne(e._pt,t,r,0,0,go);return s.u=i,s.pr=-10,s.tween=n,e._props.push(r),1}}},Ot=[1,0,0,1,0,0],yn={},bn=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},ui=function(e){var t=he(e,U);return bn(t)?Ot:t.substr(7).match(ki).map(W)},Ur=function(e,t){var r=e._gsap||Xe(e),i=e.style,n=ui(e),s,o,l,c;return r.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,n=[l.a,l.b,l.c,l.d,l.e,l.f],n.join(",")==="1,0,0,1,0,0"?Ot:n):(n===Ot&&!e.offsetParent&&e!==ot&&!r.svg&&(l=i.display,i.display="block",s=e.parentNode,(!s||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,o=e.nextElementSibling,ot.appendChild(e)),n=ui(e),l?i.display=l:ze(e,"display"),c&&(o?s.insertBefore(e,o):s?s.appendChild(e):ot.removeChild(e))),t&&n.length>6?[n[0],n[1],n[4],n[5],n[12],n[13]]:n)},xr=function(e,t,r,i,n,s){var o=e._gsap,l=n||Ur(e,!0),c=o.xOrigin||0,h=o.yOrigin||0,u=o.xOffset||0,f=o.yOffset||0,g=l[0],m=l[1],d=l[2],p=l[3],y=l[4],v=l[5],T=t.split(" "),C=parseFloat(T[0])||0,b=parseFloat(T[1])||0,k,x,S,w;r?l!==Ot&&(x=g*p-m*d)&&(S=C*(p/x)+b*(-d/x)+(d*v-p*y)/x,w=C*(-m/x)+b*(g/x)-(g*v-m*y)/x,C=S,b=w):(k=mn(e),C=k.x+(~T[0].indexOf("%")?C/100*k.width:C),b=k.y+(~(T[1]||T[0]).indexOf("%")?b/100*k.height:b)),i||i!==!1&&o.smooth?(y=C-c,v=b-h,o.xOffset=u+(y*g+v*d)-y,o.yOffset=f+(y*m+v*p)-v):o.xOffset=o.yOffset=0,o.xOrigin=C,o.yOrigin=b,o.smooth=!!i,o.origin=t,o.originIsAbsolute=!!r,e.style[se]="0px 0px",s&&(Le(s,o,"xOrigin",c,C),Le(s,o,"yOrigin",h,b),Le(s,o,"xOffset",u,o.xOffset),Le(s,o,"yOffset",f,o.yOffset)),e.setAttribute("data-svg-origin",C+" "+b)},At=function(e,t){var r=e._gsap||new tn(e);if("x"in r&&!t&&!r.uncache)return r;var i=e.style,n=r.scaleX<0,s="px",o="deg",l=getComputedStyle(e),c=he(e,se)||"0",h,u,f,g,m,d,p,y,v,T,C,b,k,x,S,w,O,P,I,D,M,R,L,z,X,qe,Pe,_e,be,gt,ye,xe;return h=u=f=d=p=y=v=T=C=0,g=m=1,r.svg=!!(e.getCTM&&_n(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(i[U]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[U]!=="none"?l[U]:"")),i.scale=i.rotate=i.translate="none"),x=Ur(e,r.svg),r.svg&&(r.uncache?(X=e.getBBox(),c=r.xOrigin-X.x+"px "+(r.yOrigin-X.y)+"px",z=""):z=!t&&e.getAttribute("data-svg-origin"),xr(e,z||c,!!z||r.originIsAbsolute,r.smooth!==!1,x)),b=r.xOrigin||0,k=r.yOrigin||0,x!==Ot&&(P=x[0],I=x[1],D=x[2],M=x[3],h=R=x[4],u=L=x[5],x.length===6?(g=Math.sqrt(P*P+I*I),m=Math.sqrt(M*M+D*D),d=P||I?tt(I,P)*We:0,v=D||M?tt(D,M)*We+d:0,v&&(m*=Math.abs(Math.cos(v*at))),r.svg&&(h-=b-(b*P+k*D),u-=k-(b*I+k*M))):(xe=x[6],gt=x[7],Pe=x[8],_e=x[9],be=x[10],ye=x[11],h=x[12],u=x[13],f=x[14],S=tt(xe,be),p=S*We,S&&(w=Math.cos(-S),O=Math.sin(-S),z=R*w+Pe*O,X=L*w+_e*O,qe=xe*w+be*O,Pe=R*-O+Pe*w,_e=L*-O+_e*w,be=xe*-O+be*w,ye=gt*-O+ye*w,R=z,L=X,xe=qe),S=tt(-D,be),y=S*We,S&&(w=Math.cos(-S),O=Math.sin(-S),z=P*w-Pe*O,X=I*w-_e*O,qe=D*w-be*O,ye=M*O+ye*w,P=z,I=X,D=qe),S=tt(I,P),d=S*We,S&&(w=Math.cos(S),O=Math.sin(S),z=P*w+I*O,X=R*w+L*O,I=I*w-P*O,L=L*w-R*O,P=z,R=X),p&&Math.abs(p)+Math.abs(d)>359.9&&(p=d=0,y=180-y),g=W(Math.sqrt(P*P+I*I+D*D)),m=W(Math.sqrt(L*L+xe*xe)),S=tt(R,L),v=Math.abs(S)>2e-4?S*We:0,C=ye?1/(ye<0?-ye:ye):0),r.svg&&(z=e.getAttribute("transform"),r.forceCSS=e.setAttribute("transform","")||!bn(he(e,U)),z&&e.setAttribute("transform",z))),Math.abs(v)>90&&Math.abs(v)<270&&(n?(g*=-1,v+=d<=0?180:-180,d+=d<=0?180:-180):(m*=-1,v+=v<=0?180:-180)),t=t||r.uncache,r.x=h-((r.xPercent=h&&(!t&&r.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-h)?-50:0)))?e.offsetWidth*r.xPercent/100:0)+s,r.y=u-((r.yPercent=u&&(!t&&r.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-u)?-50:0)))?e.offsetHeight*r.yPercent/100:0)+s,r.z=f+s,r.scaleX=W(g),r.scaleY=W(m),r.rotation=W(d)+o,r.rotationX=W(p)+o,r.rotationY=W(y)+o,r.skewX=v+o,r.skewY=T+o,r.transformPerspective=C+s,(r.zOrigin=parseFloat(c.split(" ")[2])||!t&&r.zOrigin||0)&&(i[se]=Gt(c)),r.xOffset=r.yOffset=0,r.force3D=ue.force3D,r.renderTransform=r.svg?mo:pn?vn:po,r.uncache=0,r},Gt=function(e){return(e=e.split(" "))[0]+" "+e[1]},sr=function(e,t,r){var i=Z(t);return W(parseFloat(t)+parseFloat(He(e,"x",r+"px",i)))+i},po=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,vn(e,t)},Ue="0deg",pt="0px",Ve=") ",vn=function(e,t){var r=t||this,i=r.xPercent,n=r.yPercent,s=r.x,o=r.y,l=r.z,c=r.rotation,h=r.rotationY,u=r.rotationX,f=r.skewX,g=r.skewY,m=r.scaleX,d=r.scaleY,p=r.transformPerspective,y=r.force3D,v=r.target,T=r.zOrigin,C="",b=y==="auto"&&e&&e!==1||y===!0;if(T&&(u!==Ue||h!==Ue)){var k=parseFloat(h)*at,x=Math.sin(k),S=Math.cos(k),w;k=parseFloat(u)*at,w=Math.cos(k),s=sr(v,s,x*w*-T),o=sr(v,o,-Math.sin(k)*-T),l=sr(v,l,S*w*-T+T)}p!==pt&&(C+="perspective("+p+Ve),(i||n)&&(C+="translate("+i+"%, "+n+"%) "),(b||s!==pt||o!==pt||l!==pt)&&(C+=l!==pt||b?"translate3d("+s+", "+o+", "+l+") ":"translate("+s+", "+o+Ve),c!==Ue&&(C+="rotate("+c+Ve),h!==Ue&&(C+="rotateY("+h+Ve),u!==Ue&&(C+="rotateX("+u+Ve),(f!==Ue||g!==Ue)&&(C+="skew("+f+", "+g+Ve),(m!==1||d!==1)&&(C+="scale("+m+", "+d+Ve),v.style[U]=C||"translate(0, 0)"},mo=function(e,t){var r=t||this,i=r.xPercent,n=r.yPercent,s=r.x,o=r.y,l=r.rotation,c=r.skewX,h=r.skewY,u=r.scaleX,f=r.scaleY,g=r.target,m=r.xOrigin,d=r.yOrigin,p=r.xOffset,y=r.yOffset,v=r.forceCSS,T=parseFloat(s),C=parseFloat(o),b,k,x,S,w;l=parseFloat(l),c=parseFloat(c),h=parseFloat(h),h&&(h=parseFloat(h),c+=h,l+=h),l||c?(l*=at,c*=at,b=Math.cos(l)*u,k=Math.sin(l)*u,x=Math.sin(l-c)*-f,S=Math.cos(l-c)*f,c&&(h*=at,w=Math.tan(c-h),w=Math.sqrt(1+w*w),x*=w,S*=w,h&&(w=Math.tan(h),w=Math.sqrt(1+w*w),b*=w,k*=w)),b=W(b),k=W(k),x=W(x),S=W(S)):(b=u,S=f,k=x=0),(T&&!~(s+"").indexOf("px")||C&&!~(o+"").indexOf("px"))&&(T=He(g,"x",s,"px"),C=He(g,"y",o,"px")),(m||d||p||y)&&(T=W(T+m-(m*b+d*x)+p),C=W(C+d-(m*k+d*S)+y)),(i||n)&&(w=g.getBBox(),T=W(T+i/100*w.width),C=W(C+n/100*w.height)),w="matrix("+b+","+k+","+x+","+S+","+T+","+C+")",g.setAttribute("transform",w),v&&(g.style[U]=w)},_o=function(e,t,r,i,n){var s=360,o=j(n),l=parseFloat(n)*(o&&~n.indexOf("rad")?We:1),c=l-i,h=i+c+"deg",u,f;return o&&(u=n.split("_")[1],u==="short"&&(c%=s,c!==c%(s/2)&&(c+=c<0?s:-s)),u==="cw"&&c<0?c=(c+s*si)%s-~~(c/s)*s:u==="ccw"&&c>0&&(c=(c-s*si)%s-~~(c/s)*s)),e._pt=f=new ne(e._pt,t,r,i,c,Js),f.e=h,f.u="deg",e._props.push(r),f},di=function(e,t){for(var r in t)e[r]=t[r];return e},yo=function(e,t,r){var i=di({},r._gsap),n="perspective,force3D,transformOrigin,svgOrigin",s=r.style,o,l,c,h,u,f,g,m;i.svg?(c=r.getAttribute("transform"),r.setAttribute("transform",""),s[U]=t,o=At(r,1),ze(r,U),r.setAttribute("transform",c)):(c=getComputedStyle(r)[U],s[U]=t,o=At(r,1),s[U]=c);for(l in Ae)c=i[l],h=o[l],c!==h&&n.indexOf(l)<0&&(g=Z(c),m=Z(h),u=g!==m?He(r,l,c,m):parseFloat(c),f=parseFloat(h),e._pt=new ne(e._pt,o,l,u,f-u,Cr),e._pt.u=m||0,e._props.push(l));di(o,i)};ie("padding,margin,Width,Radius",function(a,e){var t="Top",r="Right",i="Bottom",n="Left",s=(e<3?[t,r,i,n]:[t+n,t+r,i+r,i+n]).map(function(o){return e<2?a+o:"border"+o+a});Wt[e>1?"border"+a:a]=function(o,l,c,h,u){var f,g;if(arguments.length<4)return f=s.map(function(m){return Ee(o,m,c)}),g=f.join(" "),g.split(f[0]).length===5?f[0]:g;f=(h+"").split(" "),g={},s.forEach(function(m,d){return g[m]=f[d]=f[d]||f[(d-1)/2|0]}),o.init(l,g,u)}});var Cn={name:"css",register:Tr,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,r,i,n){var s=this._props,o=e.style,l=r.vars.startAt,c,h,u,f,g,m,d,p,y,v,T,C,b,k,x,S,w;Hr||Tr(),this.styles=this.styles||gn(e),S=this.styles.props,this.tween=r;for(d in t)if(d!=="autoRound"&&(h=t[d],!(ae[d]&&rn(d,t,r,i,e,n)))){if(g=typeof h,m=Wt[d],g==="function"&&(h=h.call(r,i,e,n),g=typeof h),g==="string"&&~h.indexOf("random(")&&(h=St(h)),m)m(this,e,d,h,r)&&(x=1);else if(d.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(d)+"").trim(),h+="",Ne.lastIndex=0,Ne.test(c)||(p=Z(c),y=Z(h),y?p!==y&&(c=He(e,d,c,y)+y):p&&(h+=p)),this.add(o,"setProperty",c,h,i,n,0,0,d),s.push(d),S.push(d,0,o[d]);else if(g!=="undefined"){if(l&&d in l?(c=typeof l[d]=="function"?l[d].call(r,i,e,n):l[d],j(c)&&~c.indexOf("random(")&&(c=St(c)),Z(c+"")||c==="auto"||(c+=ue.units[d]||Z(Ee(e,d))||""),(c+"").charAt(1)==="="&&(c=Ee(e,d))):c=Ee(e,d),f=parseFloat(c),v=g==="string"&&h.charAt(1)==="="&&h.substr(0,2),v&&(h=h.substr(2)),u=parseFloat(h),d in we&&(d==="autoAlpha"&&(f===1&&Ee(e,"visibility")==="hidden"&&u&&(f=0),S.push("visibility",0,o.visibility),Le(this,o,"visibility",f?"inherit":"hidden",u?"inherit":"hidden",!u)),d!=="scale"&&d!=="transform"&&(d=we[d],~d.indexOf(",")&&(d=d.split(",")[0]))),T=d in Ae,T){if(this.styles.save(d),w=h,g==="string"&&h.substring(0,6)==="var(--"){if(h=he(e,h.substring(4,h.indexOf(")"))),h.substring(0,5)==="calc("){var O=e.style.perspective;e.style.perspective=h,h=he(e,"perspective"),O?e.style.perspective=O:ze(e,"perspective")}u=parseFloat(h)}if(C||(b=e._gsap,b.renderTransform&&!t.parseTransform||At(e,t.parseTransform),k=t.smoothOrigin!==!1&&b.smooth,C=this._pt=new ne(this._pt,o,U,0,1,b.renderTransform,b,0,-1),C.dep=1),d==="scale")this._pt=new ne(this._pt,b,"scaleY",b.scaleY,(v?st(b.scaleY,v+u):u)-b.scaleY||0,Cr),this._pt.u=0,s.push("scaleY",d),d+="X";else if(d==="transformOrigin"){S.push(se,0,o[se]),h=fo(h),b.svg?xr(e,h,0,k,0,this):(y=parseFloat(h.split(" ")[2])||0,y!==b.zOrigin&&Le(this,b,"zOrigin",b.zOrigin,y),Le(this,o,d,Gt(c),Gt(h)));continue}else if(d==="svgOrigin"){xr(e,h,1,k,0,this);continue}else if(d in yn){_o(this,b,d,f,v?st(f,v+h):h);continue}else if(d==="smoothOrigin"){Le(this,b,"smooth",b.smooth,h);continue}else if(d==="force3D"){b[d]=h;continue}else if(d==="transform"){yo(this,h,e);continue}}else d in o||(d=ft(d)||d);if(T||(u||u===0)&&(f||f===0)&&!Qs.test(h)&&d in o)p=(c+"").substr((f+"").length),u||(u=0),y=Z(h)||(d in ue.units?ue.units[d]:p),p!==y&&(f=He(e,d,c,y)),this._pt=new ne(this._pt,T?b:o,d,f,(v?st(f,v+u):u)-f,!T&&(y==="px"||d==="zIndex")&&t.autoRound!==!1?to:Cr),this._pt.u=y||0,T&&w!==h?(this._pt.b=c,this._pt.e=w,this._pt.r=eo):p!==y&&y!=="%"&&(this._pt.b=c,this._pt.r=Zs);else if(d in o)uo.call(this,e,d,c,v?v+h:h);else if(d in e)this.add(e,d,c||e[d],v?v+h:h,i,n);else if(d!=="parseTransform"){Pr(d,h);continue}T||(d in o?S.push(d,0,o[d]):typeof e[d]=="function"?S.push(d,2,e[d]()):S.push(d,1,c||e[d])),s.push(d)}}x&&cn(this)},render:function(e,t){if(t.tween._time||!$r())for(var r=t._pt;r;)r.r(e,r.d),r=r._next;else t.styles.revert()},get:Ee,aliases:we,getSetter:function(e,t,r){var i=we[t];return i&&i.indexOf(",")<0&&(t=i),t in Ae&&t!==se&&(e._gsap.x||Ee(e,"x"))?r&&ni===r?t==="scale"?so:no:(ni=r||{})&&(t==="scale"?oo:ao):e.style&&!Er(e.style[t])?ro:~t.indexOf("-")?io:Fr(e,t)},core:{_removeProperty:ze,_getMatrix:Ur}};oe.utils.checkPrefix=ft;oe.core.getStyleSaver=gn;(function(a,e,t,r){var i=ie(a+","+e+","+t,function(n){Ae[n]=1});ie(e,function(n){ue.units[n]="deg",yn[n]=1}),we[i[13]]=a+","+e,ie(r,function(n){var s=n.split(":");we[s[1]]=i[s[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ie("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(a){ue.units[a]="px"});oe.registerPlugin(Cn);var Ze=oe.registerPlugin(Cn)||oe;Ze.core.Tween;function bo(a){return new Promise((e,t)=>{console.log("Speech function called with text:",a),window.speechSynthesis.cancel();const r=document.createElement("div");r.innerHTML=a;const i=r.textContent||r.innerText||"";console.log("Clean text for speech:",i);const n=new SpeechSynthesisUtterance(i);n.onend=()=>{console.log("Speech utterance ended"),e()},n.onerror=s=>{console.error("Speech utterance error:",s),t(s)},console.log("Starting speech after 50ms delay"),setTimeout(()=>{window.speechSynthesis.speak(n),console.log("Speech synthesis.speak() called")},50)})}function vo(a){const e=document.querySelector(a);if(!e)return;const t=e.getBoundingClientRect(),r=10,i=(t.top-r)/window.innerHeight*100,n=(t.left-r)/window.innerWidth*100,s=(t.right+r)/window.innerWidth*100,o=(t.bottom+r)/window.innerHeight*100,l=`polygon(0% 0%, 0% 100%, ${n}% 100%, ${n}% ${i}%, ${s}% ${i}%, ${s}% ${o}%, ${n}% ${o}%, ${n}% 100%, 100% 100%, 100% 0%, 0% 0%)`;Ze.to("#tutorial-mask",{clipPath:l,duration:.4,ease:"power2.inOut"})}function Co(){Ze.to("#tutorial-mask",{clipPath:"polygon(0% 0%, 0% 100%, 50% 100%, 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 100%, 100% 100%, 100% 0%, 0% 0%)",duration:.4,ease:"power2.inOut"})}function wo(a){const e=document.querySelector(a);e&&Ze.to(e,{position:"relative",zIndex:2001,boxShadow:"0 0 20px 8px #33c6dc",duration:.4})}function To(a){const e=document.querySelector(a);e&&Ze.to(e,{boxShadow:"0 0 0px 0px rgba(51,198,220,0)",duration:.3,onComplete:()=>Ze.set(e,{clearProps:"all"})})}function or(a){return new Promise(e=>{const t=_.rings[a];let r=!1;const i=()=>{if(!r)_.rings[a]!==t&&(r=!0);else if(!_.drag.active&&!_.animation){cancelAnimationFrame(n),e();return}n=requestAnimationFrame(i)};let n=requestAnimationFrame(i)})}function xo(){console.log("=== TUTORIAL START ==="),K.toggleSidebar(!1);const a=document.getElementById("tutorial-bubble"),e=document.getElementById("tutorial-mask"),t=document.getElementById("tutorial-text");if(console.log("Tutorial elements check:",{tutorialBubble:!!a,tutorialMask:!!e,tutorialText:!!t,bubbleStyles:a?{opacity:a.style.opacity,visibility:a.style.visibility,display:getComputedStyle(a).display}:null,textStyles:t?{opacity:t.style.opacity,visibility:t.style.visibility,display:getComputedStyle(t).display,innerHTML:t.innerHTML}:null}),a&&e&&t)console.log("All tutorial elements found successfully");else{console.error("Tutorial elements missing!",{tutorialBubble:!!a,tutorialMask:!!e,tutorialText:!!t});return}window.diatonicCompassTutorial&&(console.log("Killing existing tutorial timeline"),window.diatonicCompassTutorial.kill()),console.log("Creating new GSAP timeline");const r=Ze.timeline({onComplete:()=>{console.log("Tutorial timeline completed"),window.diatonicCompassTutorial=null}});window.diatonicCompassTutorial=r;const i=n=>{console.log("=== ADDING STEP TO TIMELINE ===",n.text),r.call(async()=>{console.log("=== EXECUTING STEP ===",n.text),r.pause();const s=document.getElementById("tutorial-text"),o=document.getElementById("tutorial-bubble");console.log("Tutorial elements during step execution:",{textEl:!!s,bubbleEl:!!o,textElStyles:s?{opacity:s.style.opacity,visibility:s.style.visibility,display:getComputedStyle(s).display,currentHTML:s.innerHTML}:null,bubbleElStyles:o?{opacity:o.style.opacity,visibility:o.style.visibility,display:getComputedStyle(o).display}:null}),s?(console.log("BEFORE setting text - innerHTML:",s.innerHTML),s.innerHTML=n.text,s.style.opacity="1",s.style.visibility="visible",console.log("AFTER setting text - innerHTML:",s.innerHTML),console.log("Text element computed styles after update:",{opacity:getComputedStyle(s).opacity,visibility:getComputedStyle(s).visibility,display:getComputedStyle(s).display,fontSize:getComputedStyle(s).fontSize,color:getComputedStyle(s).color})):console.error("Tutorial text element not found during step execution!"),n.highlightTarget&&(console.log("Adding highlight to:",n.highlightTarget),vo(n.highlightTarget),wo(n.highlightTarget)),console.log("Starting speech synthesis for:",n.text),await bo(n.text),console.log("Speech synthesis completed"),n.waitFor&&(console.log("Waiting for user interaction..."),await n.waitFor(),console.log("User interaction completed")),n.highlightTarget&&(console.log("Removing highlight from:",n.highlightTarget),To(n.highlightTarget),Co()),await new Promise(l=>setTimeout(l,500)),console.log("Step completed, resuming timeline"),r.resume()})};console.log("Adding tutorial mask animation to timeline"),r.to("#tutorial-mask",{autoAlpha:1,duration:.3}),r.call(()=>{console.log("=== SHOWING TUTORIAL BUBBLE ===");const n=document.getElementById("tutorial-bubble"),s=document.getElementById("tutorial-text");console.log("Bubble show elements check:",{bubble:!!n,textEl:!!s,bubbleCurrentStyles:n?{opacity:n.style.opacity,visibility:n.style.visibility,display:getComputedStyle(n).display}:null,textCurrentStyles:s?{opacity:s.style.opacity,visibility:s.style.visibility,innerHTML:s.innerHTML}:null}),n?(console.log("Setting bubble visibility styles"),n.style.display="block",n.style.opacity="1",n.style.visibility="visible",n.setAttribute("aria-hidden","false"),console.log("Bubble styles after setting:",{opacity:n.style.opacity,visibility:n.style.visibility,computedOpacity:getComputedStyle(n).opacity,computedVisibility:getComputedStyle(n).visibility,computedDisplay:getComputedStyle(n).display}),console.log("Tutorial bubble shown successfully")):console.error("Tutorial bubble element not found during show!")}),i({text:"Welcome to the <strong>Diatonic Compass!</strong>"}),i({text:"Rotate the <strong>Pitch</strong> belt so we leave <strong>C Major.</strong>",highlightTarget:".pitch-belt",waitFor:()=>or("pitchClass")}),i({text:"Nice! <br>Change the <strong>mode</strong> by spinning the <strong>Degree belt.</strong>",highlightTarget:".degree-belt",waitFor:()=>or("degree")}),i({text:"Wonderful!<br>Now shift the perspective by spinning the <strong>Chromatic belt</strong>.",highlightTarget:".chromatic-belt",waitFor:()=>or("chromatic")}),r.to("#tutorial-bubble",{bottom:"110px",duration:.3,ease:"power2.out"}),i({text:"Almost there!<br> Tap the <strong>result bar</strong> to <strong>hear your scale.</strong>",highlightTarget:"#result-container",waitFor:async()=>{await new Promise(n=>{const s=()=>_.playback.isPlaying?n():requestAnimationFrame(s);s()}),await new Promise(n=>{const s=()=>_.playback.isPlaying?requestAnimationFrame(s):n();s()})}}),r.to("#tutorial-bubble",{bottom:"20px",duration:.3,ease:"power2.in"}),i({text:"You did it!<br><strong>Enjoy exploring.</strong>"}),r.to(["#tutorial-mask","#tutorial-bubble"],{autoAlpha:0,duration:.4,delay:1}),r.call(()=>{const n=document.getElementById("tutorial-bubble");n&&(n.style.display="none",console.log("Tutorial bubble hidden"))})}class Ie{static hasStateChanged(e,t){return!t||e.animation!==null||e.drag.active!==null||e.playback.isPlaying!==t.playback.isPlaying||e.playback.currentNoteIndex!==t.playback.currentNoteIndex||!this._ringsEqual(e.rings,t.rings)||e.display.sharp!==t.display.sharp||e.display.flat!==t.display.flat||e.ui.darkMode!==t.ui.darkMode||e.ui.sidebarOpen!==t.ui.sidebarOpen||e.belts.orientation!==t.belts.orientation||!this._dimensionsEqual(e.dimensions,t.dimensions)}static _ringsEqual(e,t){return Math.abs(e.pitchClass-t.pitchClass)<1e-4&&Math.abs(e.degree-t.degree)<1e-4&&Math.abs(e.chromatic-t.chromatic)<1e-4&&Math.abs(e.highlightPosition-t.highlightPosition)<1e-4}static _dimensionsEqual(e,t){return e.size===t.size&&e.dpr===t.dpr}static createSnapshot(e){return{rings:{...e.rings},playback:{isPlaying:e.playback.isPlaying,currentNoteIndex:e.playback.currentNoteIndex},display:{...e.display},ui:{darkMode:e.ui.darkMode,sidebarOpen:e.ui.sidebarOpen},belts:{orientation:e.belts.orientation},dimensions:{...e.dimensions},animation:e.animation,drag:{active:e.drag.active}}}static markDirty(e){e.performance&&(e.performance.needsRedraw=!0)}static markClean(e){e.performance&&(e.performance.needsRedraw=!1,e.performance.lastRenderState=this.createSnapshot(e))}static needsRedraw(e){var t,r;return(t=e.performance)!=null&&t.needsRedraw?!0:this.hasStateChanged(e,(r=e.performance)==null?void 0:r.lastRenderState)}}const So=Object.freeze(Object.defineProperty({__proto__:null,StateTracker:Ie},Symbol.toStringTag,{value:"Module"}));function De(a,e){if(_.rings.hasOwnProperty(a)){const t=F(e);_.rings[a]=t,Ie.markDirty(_)}}function wn(a,e,t){const r=e;_.rings.chromatic=F(a.startChrom+r),_.rings.pitchClass=F(a.startPitchClass+e),_.rings.degree=F(a.startDegree+e),_.rings.highlightPosition=F(a.startHighlight+e),Ie.markDirty(_)}function Tn(a){if(!a)return"#000000";const e=parseInt(a.slice(1,3),16),t=parseInt(a.slice(3,5),16),r=parseInt(a.slice(5,7),16);return .299*e+.587*t+.114*r>140?"#000000":"#FFFFFF"}const ko={red:{solid:"red",fill:"rgba(255, 0, 0, 0.2)"},blue:{solid:"blue",fill:"rgba(0, 0, 255, 0.2)"},green:{solid:"green",fill:"rgba(0, 255, 0, 0.2)"},yellow:{solid:"#FFD700",fill:"rgba(255, 215, 0, 0.2)"}};class Eo{constructor(e,t,r){this.canvas=e,this.ctx=e.getContext("2d"),this.state=t,this.onInteractionEnd=r,this.cachedLayers={outerRing:null,middleRing:null,innerRing:null,labels:null,lastSize:0},this._initInteraction()}_regenerateCachedLayers(e,t){}update(e,t,r){const{size:i,dpr:n}=this.state.dimensions;this._draw(i,n,e,t,r)}_initInteraction(){const e=r=>{const i=this.canvas.getBoundingClientRect(),{cx:n,cy:s,size:o}=this.state.dimensions,l=r.clientX-i.left-n,c=r.clientY-i.top-s,h=Math.hypot(l,c),u=o*.5,f=o*.35,g=o*.2;let m=null;return h>g&&h<f?m="degree":h>f&&h<u?m="pitchClass":h<=g&&(m="chromatic"),{x:l,y:c,ring:m}},t=()=>{if(!this.state.drag.active)return;const r=this.state.drag.active;this.state.drag.active=null,this.canvas.style.cursor="grab",r==="chromatic"?yi(this.onInteractionEnd):r==="pitchClass"?_i("pitchClass",this.onInteractionEnd):r==="degree"&&lr(this.onInteractionEnd)};this.canvas.addEventListener("pointerdown",r=>{const{x:i,y:n,ring:s}=e(r);if(!s)return;const{drag:o,rings:l}=this.state;o.active=s,o.startX=i,o.startY=n,o.startPitchClass=l.pitchClass,o.startDegree=l.degree,o.startChrom=l.chromatic,o.startHighlight=l.highlightPosition,this.canvas.setPointerCapture(r.pointerId),this.canvas.style.cursor="grabbing"}),this.canvas.addEventListener("pointermove",r=>{if(this.state.drag.active){const{x:i,y:n}=e(r),s=this.state.drag,o=Math.atan2(s.startY,s.startX),c=Math.atan2(n,i)-o;s.active==="pitchClass"?De("pitchClass",s.startPitchClass+c):s.active==="degree"?(De("degree",s.startDegree+c),De("highlightPosition",s.startHighlight+c)):s.active==="chromatic"&&wn({startPitchClass:s.startPitchClass,startDegree:s.startDegree,startChrom:s.startChrom,startHighlight:s.startHighlight},c)}else{const{ring:i}=e(r);this.canvas.style.cursor=i?"grab":"default"}}),this.canvas.addEventListener("pointerup",t),this.canvas.addEventListener("pointercancel",t),this.canvas.addEventListener("pointerleave",()=>{this.state.drag.active||(this.canvas.style.cursor="default")})}_draw(e,t,r,i,n){console.log("=== Wheel._draw CALLED ===",{size:e,dpr:t});const s=this.ctx;s.save(),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.scale(t,t);const o=e/2,l=e/2,{pitchClass:c,degree:h,chromatic:u}=r,{chromaticLabels:f,diatonicLabels:g}=i;this.cachedLayers.lastSize!==e&&(this._regenerateCachedLayers(e,t),this.cachedLayers.lastSize=e);const d=(k,x,S)=>{const w=S-Y/2,O=S+Y/2;s.beginPath(),s.arc(o,l,x,w,O),s.arc(o,l,k,O,w,!0),s.closePath()},p=()=>{const k=e*.5,x=e*.35;Object.keys(mt).forEach((w,O)=>{const P=O*Y+c-Math.PI/2;d(x,k,P),s.fillStyle=mt[w]?"#fff":"#000",s.fill(),s.lineWidth=e*.002,s.strokeStyle="#000",s.stroke()})},y=()=>{const k=e*.35,x=e*.2;for(let S=0;S<12;S++){const w=S*Y+h-Math.PI/2;d(x,k,w),s.fillStyle=ar[S]||"#e0e0e0",s.fill(),s.lineWidth=e*.002,s.strokeStyle="#000",s.stroke()}},v=()=>{s.beginPath(),s.arc(o,l,e*.2,0,Math.PI*2),s.fillStyle="#000",s.fill()},T=()=>{const k=e*.5*.85,x=e*.35*.8,S=e*.2*.8,w=Object.keys(mt),O=(M,R,L,z,X)=>{s.fillStyle=z,s.font=`${X}px 'Atkinson Hyperlegible Next'`,s.textAlign="center",s.textBaseline="middle";const qe=o+Math.cos(M)*R,Pe=l+Math.sin(M)*R,_e=String(L);if(_e.includes("/")||_e.includes("<br>")){const be=_e.includes("/")?_e.split("/"):_e.split("<br>"),gt=X*1.1,ye=Pe-gt*(be.length-1)/2;be.forEach((xe,xn)=>{s.fillText(xe,qe,ye+xn*gt)})}else s.fillText(L,qe,Pe)},P=e*Mn;f.forEach((M,R)=>{const L=w[R],z=M,X=mt[L]?"#000":"#fff";O(R*Y+c-Math.PI/2,k,z,X,P)});const I=e*Rn;g.forEach((M,R)=>{const L=ar[R],z=Tn(L),X=M;O(R*Y+h-Math.PI/2,x,X,z,I)});const D=e*Ln;An.forEach(M=>O(M*Y+u-Math.PI/2,S,M.toString(),"#fff",D))},C=()=>{if(!n||!n.isPlaying||n.currentNoteIndex===null)return;const x=n.currentNoteIndex%12*Y+c-Math.PI/2,S=e*.5,w=e*.2;d(w,S,x),s.fillStyle="rgba(255, 255, 0, 0.6)",s.fill()},b=()=>{const k=this.state.ui.cursorColor||"red",x=this.state.ui.cursorFill,S=ko[k],w=u-Math.PI/2,O=e*.5,P=e*.12;d(P,O,w),x&&(s.fillStyle=S.fill,s.fill()),s.strokeStyle=S.solid,s.lineWidth=e*.005,s.stroke()};console.log("Drawing outer ring..."),p(),console.log("Drawing middle ring..."),y(),console.log("Drawing inner circle..."),v(),console.log("Drawing labels..."),T(),console.log("Drawing playback highlight..."),C(),console.log("Drawing tonal center marker..."),b(),console.log("Wheel drawing complete"),s.restore()}}class Oo{constructor(e,t,r){this.container=e,this.state=t,this.onInteractionEnd=r,this.elements={pitchBelt:e.querySelector("#pitchBelt"),degreeBelt:e.querySelector("#degreeBelt"),chromaticBelt:e.querySelector("#chromaticBelt"),chromaticColorsTrack:e.querySelector("#chromatic-colors-track"),chromaticNumbersTrack:e.querySelector("#chromatic-numbers-track"),intervalBracketsTrackContainer:e.querySelector("#intervalBracketsContainer"),intervalBracketsWrapper:e.querySelector(".interval-brackets-wrapper"),intervalBrackets:null,cursor:e.querySelector("#belt-cursor"),flashOverlay:e.querySelector("#belt-flash-overlay")},this.state.belts.tracks={},this.cachedCells={pitch:null,degree:null,chromaticColors:null,chromaticNumbers:null},this.lastAppliedLabels={chromatic:null,diatonic:null},this._initInteraction()}_calculateRingAngleToBeltPixelsRatio(e){return!e||e<=0?(console.warn("Invalid beltCellWidth for ring-to-belt conversion:",e),0):Se*e/Ye}_formatLabelForCell(e,t){var n;if(!e||!e.includes("/"))return e;const r=this.state.belts.orientation,i=((n=t.closest(".belt"))==null?void 0:n.className)||"unknown";return t.dataset.originalIndex==="1"&&console.log(`🔍 Format check [${i}] (${r}):`,{label:e,orientation:r,decision:r==="vertical"?"SIDE-BY-SIDE (vertical mode)":"STACKED (horizontal mode)"}),r==="vertical"?e.replace("/"," "):e.replace("/","<br>")}update(e,t){const{orientation:r}=this.state.belts,{diatonicLabels:i,chromaticLabels:n}=e;if(console.log("=== Belts.update CALLED ===",{init:this.state.belts.init,orientation:r}),!this.state.belts.init){console.log("Belts not initialized - setting up..."),this.cachedCells={pitch:null,degree:null,chromaticColors:null,chromaticNumbers:null},this.lastAppliedLabels={chromatic:null,diatonic:null},this._chromaticColorsApplied=!1,this._setupAllBelts(i,n),requestAnimationFrame(()=>{this._calculateAllBeltCellWidths(r)&&(console.log("Belt sizes calculated, marking as initialized"),this.state.belts.init=!0,Je(async()=>{const{StateTracker:y}=await Promise.resolve().then(()=>So);return{StateTracker:y}},void 0).then(({StateTracker:y})=>{y.markDirty(this.state)}))});return}console.log("Belts initialized, applying styles...");const{pitchClass:s,degree:o,chromatic:l,highlightPosition:c}=this.state.rings,{tracks:h,itemSize:u}=this.state.belts;this._applyBeltStyles(t,i,n);let f=r==="vertical"?-s:s,g=r==="vertical"?-o:o,m=r==="vertical"?-l:l,d=r==="vertical"?-c:c;this._positionBeltFromRingAngle(h.pitchBelt,f,u.pitchBelt,r),this._positionBeltFromRingAngle(h.degreeBelt,g,u.degreeBelt,r),this._positionBeltFromRingAngle(h.chromaticColors,d,u.chromaticBelt,r),this._positionBeltFromRingAngle(h.chromaticNumbers,m,u.chromaticBelt,r),this._positionIntervalBeltFromDegreeRing(g,u.degreeBelt,r),this._positionBeltCursorFromRingAngle(m,u.chromaticBelt,r),this._updatePlaybackFlashOnBelt()}_initInteraction(){const{pitchBelt:e,degreeBelt:t,chromaticNumbersTrack:r}=this.elements;e&&this._addDragHandler(e,s=>{const o=this.state.drag.startPitchClass+(this.state.belts.orientation==="vertical"?-s:s);De("pitchClass",o)},()=>_i("pitchClass",this.onInteractionEnd));const i=s=>{const o=this.state.belts.orientation==="vertical"?-s:s;De("degree",this.state.drag.startDegree+o),De("highlightPosition",this.state.drag.startHighlight+o)},n=()=>{lr(this.onInteractionEnd)};t&&this._addDragHandler(t,i,n),r&&this._addDragHandler(r,s=>{const o=this.state.belts.orientation==="vertical"?-s:s,l={startPitchClass:this.state.drag.startPitchClass,startDegree:this.state.drag.startDegree,startChrom:this.state.drag.startChrom,startHighlight:this.state.drag.startHighlight};wn(l,o)},()=>yi(this.onInteractionEnd))}_addDragHandler(e,t,r){e.style.cursor="grab";let i=null,n=0,s=0;const o=h=>{i=h.pointerId,e.setPointerCapture(i),n=h.clientX,s=h.clientY;const{drag:u,rings:f}=this.state;u.active=e.id||"belt-drag",u.startPitchClass=f.pitchClass,u.startDegree=f.degree,u.startChrom=f.chromatic,u.startHighlight=f.highlightPosition,e.style.cursor="grabbing"},l=h=>{if(i!==h.pointerId)return;const{orientation:u,itemSize:f}=this.state.belts,g=u==="vertical"?h.clientY-s:h.clientX-n;let m;const d=e.id||e.className||"";d.includes("pitch")?m="pitchBelt":d.includes("degree")||d.includes("interval")?m="degreeBelt":d.includes("chromatic")&&(m="chromaticBelt");const p=f[m];if(!p||p===0)return;const y=g/p*Y;t(y)},c=()=>{i!==null&&(e.releasePointerCapture(i),i=null,this.state.drag.active=null,e.style.cursor="grab",r())};e.addEventListener("pointerdown",o),e.addEventListener("pointermove",l),e.addEventListener("pointerup",c),e.addEventListener("pointercancel",c)}_setupAllBelts(e,t){this.elements.pitchBelt.innerHTML="",this.elements.degreeBelt.innerHTML="",this.elements.intervalBracketsTrackContainer.innerHTML="";const r=3;this.state.belts.tracks.pitchBelt=this._createBeltTrack(this.elements.pitchBelt,t,r),this.state.belts.tracks.degreeBelt=this._createBeltTrack(this.elements.degreeBelt,e,r),this._populateBeltTrack(this.elements.chromaticColorsTrack,Array(12).fill(""),r),this._populateBeltTrack(this.elements.chromaticNumbersTrack,[...Array(12).keys()],r),this.state.belts.tracks.chromaticColors=this.elements.chromaticColorsTrack,this.state.belts.tracks.chromaticNumbers=this.elements.chromaticNumbersTrack,this._createIntervalBeltTrack(r)}_createBeltTrack(e,t,r){const i=document.createElement("div");return i.className="belt-track",this._populateBeltTrack(i,t,r),e.appendChild(i),i}_populateBeltTrack(e,t,r){e.innerHTML="";const i=3,n=t.length;for(let s=0;s<r*Se+i;s++){const o=s%n,l=t[o],c=document.createElement("div");c.className="belt-cell",c.innerHTML=String(l),c.dataset.originalIndex=String(o),e.appendChild(c)}}_createIntervalBeltTrack(e){const t=document.createElement("div");t.className="interval-brackets-track";const r=3;for(let s=0;s<Se*e+r;s++){const o=s%Se,l=Nt.indexOf(o),c=document.createElement("div");if(c.className="interval-bracket-cell",l!==-1){const h=Dn[l];c.dataset.steps=h,c.innerHTML=`<span>+${h}</span>`}t.appendChild(c)}this.elements.intervalBracketsTrackContainer.appendChild(t),this.elements.intervalBrackets=this.elements.intervalBracketsWrapper;const i=s=>{const o=this.state.belts.orientation==="vertical"?-s:s;De("degree",this.state.drag.startDegree+o),De("highlightPosition",this.state.drag.startHighlight+o)},n=()=>{lr(this.onInteractionEnd)};this._addDragHandler(this.elements.intervalBrackets,i,n)}_calculateAllBeltCellWidths(e){return this._calculateBeltCellWidth("pitchBelt",this.elements.pitchBelt,e)&&this._calculateBeltCellWidth("degreeBelt",this.elements.degreeBelt,e)&&this._calculateBeltCellWidth("chromaticBelt",this.elements.chromaticBelt,e)&&this._calculateBeltCellWidth("intervalBracketsContainer",this.elements.intervalBracketsWrapper,e)}_calculateBeltCellWidth(e,t,r){const i=r==="vertical"?t.offsetHeight:t.offsetWidth;return i>0?(this.state.belts.itemSize[e]=i/Se,!0):!1}_applyBeltStyles(e,t,r){var g,m,d;console.log("=== _applyBeltStyles CALLED ===");const i=r.join(","),n=t.join(","),s=this.lastAppliedLabels.chromatic!==i||this.lastAppliedLabels.diatonic!==n,o=this.lastAppliedLabels.chromatic===null;!this.cachedCells.pitch&&this.state.belts.tracks.pitchBelt&&(this.cachedCells.pitch=this.state.belts.tracks.pitchBelt.querySelectorAll(".belt-cell"),console.log("Cached pitch cells:",this.cachedCells.pitch.length)),!this.cachedCells.degree&&this.state.belts.tracks.degreeBelt&&(this.cachedCells.degree=this.state.belts.tracks.degreeBelt.querySelectorAll(".belt-cell"),console.log("Cached degree cells:",this.cachedCells.degree.length)),!this.cachedCells.chromaticColors&&this.elements.chromaticColorsTrack&&(this.cachedCells.chromaticColors=this.elements.chromaticColorsTrack.querySelectorAll(".belt-cell"),console.log("Cached chromatic color cells:",this.cachedCells.chromaticColors.length)),!this.cachedCells.chromaticNumbers&&this.elements.chromaticNumbersTrack&&(this.cachedCells.chromaticNumbers=this.elements.chromaticNumbersTrack.querySelectorAll(".belt-cell"),console.log("Cached chromatic number cells:",this.cachedCells.chromaticNumbers.length)),console.log("Belt styling state:",{isFirstRun:o,labelsChanged:s,hasPitchCells:!!this.cachedCells.pitch,pitchCellCount:((g=this.cachedCells.pitch)==null?void 0:g.length)||0,hasDegreeCells:!!this.cachedCells.degree,degreeCellCount:((m=this.cachedCells.degree)==null?void 0:m.length)||0,hasChromaticColors:!!this.cachedCells.chromaticColors,chromaticColorCount:((d=this.cachedCells.chromaticColors)==null?void 0:d.length)||0});const l=(s||o)&&this.cachedCells.pitch,c=this.cachedCells.pitch&&this.cachedCells.pitch.length>0&&!this.cachedCells.pitch[0].style.background;(l||c)&&this.cachedCells.pitch?(console.log("APPLYING PITCH BELT COLORS!",{shouldUpdatePitch:l,needsInitialColors:c,cellCount:this.cachedCells.pitch.length}),this.cachedCells.pitch.forEach(p=>{const y=+p.dataset.originalIndex,v=Lt[y],T=mt[v];p.style.background=T?"#fff":"#000",p.style.color=T?"#000":"#fff",p.innerHTML=this._formatLabelForCell(r[y],p)})):this.cachedCells.pitch&&s?(console.log("UPDATING PITCH LABELS ONLY"),this.cachedCells.pitch.forEach(p=>{const y=+p.dataset.originalIndex;p.innerHTML=this._formatLabelForCell(r[y],p)})):console.log("SKIPPED pitch belt colors:",{shouldUpdatePitch:l,needsInitialColors:c,hasCells:!!this.cachedCells.pitch});const h=(s||o)&&this.cachedCells.degree,u=this.cachedCells.degree&&this.cachedCells.degree.length>0&&!this.cachedCells.degree[0].style.background;(h||u)&&this.cachedCells.degree?(console.log("APPLYING DEGREE BELT COLORS!",{shouldUpdateDegree:h,needsInitialDegreeColors:u,cellCount:this.cachedCells.degree.length}),this.cachedCells.degree.forEach(p=>{const y=+p.dataset.originalIndex,v=ar[y]||"#f0f0f0";p.style.background=v,p.style.color=Tn(v),p.innerHTML=this._formatLabelForCell(t[y],p)})):this.cachedCells.degree&&s?(console.log("UPDATING DEGREE LABELS ONLY"),this.cachedCells.degree.forEach(p=>{const y=+p.dataset.originalIndex;p.innerHTML=this._formatLabelForCell(t[y],p)})):console.log("SKIPPED degree belt colors:",{shouldUpdateDegree:h,needsInitialDegreeColors:u,hasCells:!!this.cachedCells.degree});const f=this.cachedCells.chromaticColors&&this.cachedCells.chromaticColors.length>0&&!this.cachedCells.chromaticColors[0].style.background;if((!this._chromaticColorsApplied||o||f)&&this.cachedCells.chromaticColors?(console.log("APPLYING CHROMATIC COLORS!",{chromaticColorsApplied:this._chromaticColorsApplied,isFirstRun:o,needsInitialChromatic:f,cellCount:this.cachedCells.chromaticColors.length}),this.cachedCells.chromaticColors.forEach(p=>{const y=+p.dataset.originalIndex;p.style.background=e.includes(y)?"#e0e0e0":"#4a4a4a"}),this._chromaticColorsApplied=!0):console.log("SKIPPED chromatic colors:",{chromaticColorsApplied:this._chromaticColorsApplied,isFirstRun:o,needsInitialChromatic:f,hasCells:!!this.cachedCells.chromaticColors}),this.cachedCells.chromaticNumbers){const{chromatic:p,highlightPosition:y}=this.state.rings,T=F(y-p)/Y;this.cachedCells.chromaticNumbers.forEach(C=>{const b=+C.dataset.originalIndex,k=Math.round((b-T+1200)%12)%12,x=e.includes(k)?"black":"lightgray";C.style.color!==x&&(C.style.color=x)})}s&&(this.lastAppliedLabels.chromatic=i,this.lastAppliedLabels.diatonic=n)}_convertRingAngleToBeltDistance(e,t,r){const i=this._calculateRingAngleToBeltPixelsRatio(t);if(i===0)return 0;const n=e*i;let s,o=0;return r==="vertical"?(s=-(t*Se),o=3*t,s-o+n):(s=-(t*Se),s+n)}_positionBeltFromRingAngle(e,t,r,i){if(!e||!r)return;const n=this._convertRingAngleToBeltDistance(t,r,i),s=i==="vertical"?`translateY(${n}px)`:`translateX(${n}px)`;e.style.transform=s}_positionIntervalBeltFromDegreeRing(e,t,r){const i=this.elements.intervalBracketsTrackContainer.querySelector(".interval-brackets-track");if(!i||!t)return;let n=this._convertRingAngleToBeltDistance(e,t,r);r==="horizontal"&&(n+=.5*t);const s=r==="vertical"?`translateY(${n}px)`:`translateX(${n}px)`;i.style.transform=s}_positionBeltCursorFromRingAngle(e,t,r){const i=this.elements.cursor;if(console.log("=== Positioning belt cursor ===",{hasCursor:!!i,beltCellWidth:t,orientation:r,chromaticRingAngle:e}),!i||!t){console.warn("Cannot position cursor - missing element or cell width");return}this._updateBeltCursorColors(i);const n=this._calculateRingAngleToBeltPixelsRatio(t);if(n===0){console.warn("Cannot position cursor - invalid pixel ratio");return}const s=e*n;let o;if(r==="vertical"){const c=-Se*t;o=(s%c+c)%c}else o=s;const l=r==="vertical"?`translateY(${o}px)`:`translateX(${o}px)`;i.style.transform=l,console.log("Belt cursor positioned:",{transform:l,cursorBeltPosition:o})}_updateBeltCursorColors(e){const t=this.state.ui.cursorColor||"red",r=this.state.ui.cursorFill,n={red:{solid:"red",fill:"rgba(255, 0, 0, 0.2)"},blue:{solid:"blue",fill:"rgba(0, 0, 255, 0.2)"},green:{solid:"green",fill:"rgba(0, 255, 0, 0.2)"},yellow:{solid:"#FFD700",fill:"rgba(255, 215, 0, 0.2)"}}[t];e.style.borderColor=n.solid,e.style.background=r?n.fill:"transparent"}_updatePlaybackFlashOnBelt(){const{rings:e,playback:t,belts:r}=this.state,i=this.elements.flashOverlay,n=r.itemSize.chromaticBelt,s=r.orientation;if(!i||!n||!t.isPlaying||t.currentNoteIndex===null){i.style.display="none";return}const o=this._calculateRingAngleToBeltPixelsRatio(n);if(o===0){i.style.display="none";return}let l;if(s==="vertical"){const h=-e.chromatic,u=(t.currentNoteIndex-t.rootNoteIndexForPlayback)*Y,g=(h-u)*o,m=-Se*n;l=(g%m+m)%m}else l=(e.chromatic+(t.currentNoteIndex-t.rootNoteIndexForPlayback)*Y)*o;const c=s==="vertical"?`translateY(${l}px)`:`translateX(${l}px)`;i.style.transform=c,i.style.display="block"}}class Ao{constructor(){this.container=null,this.draggedItem=null,this.dragOverItem=null,this.onOrderChange=null,this.touchStartY=0,this.touchStartX=0,this.isDraggingTouch=!1,this.touchScrollThreshold=10,this.dragGhost=null,this.init()}init(){try{if(this.container=document.getElementById("belt-order-list"),!this.container)throw new Error("Order list container not found");this._setupEventListeners(),this._loadSavedOrder(),this._updateDisplay()}catch(e){E.handle(e,"OrderManager",()=>{console.error("Failed to initialize Order Manager")})}}_setupEventListeners(){this.container.addEventListener("dragstart",this._handleDragStart.bind(this)),this.container.addEventListener("dragover",this._handleDragOver.bind(this)),this.container.addEventListener("dragenter",this._handleDragEnter.bind(this)),this.container.addEventListener("dragleave",this._handleDragLeave.bind(this)),this.container.addEventListener("drop",this._handleDrop.bind(this)),this.container.addEventListener("dragend",this._handleDragEnd.bind(this)),this.container.addEventListener("touchstart",this._handleTouchStart.bind(this),{passive:!1}),this.container.addEventListener("touchmove",this._handleTouchMove.bind(this),{passive:!1}),this.container.addEventListener("touchend",this._handleTouchEnd.bind(this),{passive:!1}),this.container.addEventListener("touchcancel",this._handleTouchEnd.bind(this),{passive:!1})}_handleDragStart(e){if(console.log("Drag start event triggered",e.target),!e.target.classList.contains("drag-handle")){console.log("Not a drag-handle, ignoring");return}if(this.draggedItem=e.target.closest(".order-item"),!this.draggedItem){console.log("No parent order-item found, ignoring");return}this.draggedItem.classList.add("dragging"),console.log("Dragging item:",this.draggedItem.dataset.component),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.draggedItem.outerHTML),setTimeout(()=>{this.draggedItem&&(this.draggedItem.style.opacity="0")},1)}_handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}_handleDragEnter(e){e.target.classList.contains("order-item")&&e.target!==this.draggedItem&&(this.dragOverItem=e.target,e.target.classList.add("drag-over"),this._animateReorder(e.target))}_handleDragLeave(e){e.target.classList.contains("order-item")&&e.target.classList.remove("drag-over")}_handleDrop(e){if(e.preventDefault(),console.log("Drop event triggered"),!this.dragOverItem||this.dragOverItem===this.draggedItem){console.log("Drop cancelled - no valid target");return}const t=this.draggedItem.dataset.component,r=this.dragOverItem.dataset.component;console.log(`Dropping ${t} onto ${r}`),this._reorderComponents(t,r),this._saveOrder(),this._updateDisplay(),this._applyComponentOrder()}_handleDragEnd(e){this.draggedItem&&(this.draggedItem.classList.remove("dragging"),this.draggedItem.style.opacity=""),this.container.querySelectorAll(".drag-over").forEach(t=>{t.classList.remove("drag-over")}),this._resetAnimations(),this.draggedItem=null,this.dragOverItem=null}_reorderComponents(e,t){const r=_.belts.orientation,i=[..._.belts.layoutOrder[r]];r==="vertical"?this._reorderVerticalLayout(e,t,i):this._reorderHorizontalLayout(e,t,i)}_reorderHorizontalLayout(e,t,r){const i=r.indexOf(e),n=r.indexOf(t);if(console.log("=== HORIZONTAL REORDER DEBUG ===",{draggedId:e,targetId:t,currentOrder:[...r],draggedIndex:i,targetIndex:n}),i===-1||n===-1){console.log("Invalid indices - horizontal reorder cancelled");return}r.splice(i,1);const s=i<n?n-1:n;console.log("Horizontal reorder calculation:",{afterRemoval:[...r],adjustedTargetIndex:s,calculation:`${i} < ${n} ? ${n-1} : ${n}`,explanation:i<n?"Moving forward: target shifted down after removal":"Moving backward: target index unchanged"}),r.splice(s,0,e),console.log("Final horizontal order:",[...r]),_.belts.layoutOrder.horizontal=r}_reorderVerticalLayout(e,t,r){if(console.log("=== VERTICAL REORDER DEBUG ===",{draggedId:e,targetId:t,currentOrder:r,isCompassInvolved:e==="compass"||t==="compass"}),e==="compass"||t==="compass"){const i=["intervals","pitch","chromatic","degree"];let n=t,s=e;i.includes(t)&&(n="result",console.log(`Converting belt target '${t}' to 'result'`)),i.includes(e)&&(s="result",console.log(`Converting belt dragged '${e}' to 'result'`));const o=r.indexOf(s),l=r.indexOf(n);if(console.log("Compass reorder indices:",{draggedIndex:o,targetIndex:l,actualDraggedId:s,actualTargetId:n}),o!==-1&&l!==-1&&o!==l){r.splice(o,1);let c;s==="compass"&&i.includes(t)?(c=r.length,console.log("Placing compass after result group at index:",c)):(c=o<l?l-1:l,console.log("Normal reorder to index:",c)),r.splice(c,0,s),_.belts.layoutOrder.vertical=r,console.log("New vertical layout order:",r)}else console.log("Invalid indices or same position - reorder cancelled")}else console.log("Belt reorder within result group"),this._reorderBelts(e,t)}_reorderBelts(e,t){const r=[..._.belts.order],i=r.indexOf(e),n=r.indexOf(t);if(console.log("=== BELT REORDER DEBUG ===",{draggedBelt:e,targetBelt:t,currentOrder:[...r],draggedIndex:i,targetIndex:n}),i===-1||n===-1)return;r.splice(i,1);const s=i<n?n-1:n;console.log("Belt reorder calculation:",{afterRemoval:[...r],adjustedTargetIndex:s,calculation:`${i} < ${n} ? ${n-1} : ${n}`,explanation:i<n?"Moving forward: target shifted down after removal":"Moving backward: target index unchanged"}),r.splice(s,0,e),console.log("Final belt order:",[...r]),_.belts.order=r}_updateDisplay(){const e=_.belts.orientation;this.container.innerHTML="",e==="horizontal"?this._renderHorizontalLayout():this._renderVerticalLayout()}_renderHorizontalLayout(){_.belts.layoutOrder.horizontal.forEach(t=>{const r=this._createOrderItem(t,this._getComponentLabel(t));this.container.appendChild(r)})}_renderVerticalLayout(){const e=_.belts.layoutOrder.vertical;console.log("=== RENDERING VERTICAL LAYOUT ===",{order:e,beltOrder:_.belts.order}),e.forEach((t,r)=>{if(console.log(`Rendering component ${r}: ${t}`),t==="result"){const i=this._createOrderItem("result","Mode Name",!0);this.container.appendChild(i),console.log("Added result group item"),_.belts.order.forEach((n,s)=>{const o=this._createOrderItem(n,this._getComponentLabel(n),!1,!0);this.container.appendChild(o),console.log(`Added nested belt item ${s}: ${n}`)})}else{const i=this._createOrderItem(t,this._getComponentLabel(t));this.container.appendChild(i),console.log(`Added regular item: ${t}`)}}),console.log("Final sidebar structure:",Array.from(this.container.children).map(t=>({className:t.className,textContent:t.textContent.trim(),dataComponent:t.dataset.component})))}_createOrderItem(e,t,r=!1,i=!1){const n=document.createElement("div");n.className=`order-item${r?" group":""}${i?" nested":""}`,n.draggable=!1,n.dataset.component=e;const s=document.createElement("span");s.className="drag-handle",s.textContent="⋮⋮",s.draggable=!0;const o=document.createElement("span");if(o.className="component-label",o.textContent=t,i){const l=document.createElement("span");l.className="nested-indent",l.textContent="  ",n.appendChild(l)}return n.appendChild(s),n.appendChild(o),n}_getComponentLabel(e){return{compass:"Compass",result:"Mode Name",pitch:"Pitch",degree:"Degrees",intervals:"Intervals",chromatic:"Chromatic"}[e]||e}_saveOrder(){try{const e=wt();e.layoutOrder=_.belts.layoutOrder,e.beltOrder=_.belts.order,Xt(e)}catch(e){console.warn("Failed to save order preferences:",e)}}_loadSavedOrder(){try{const e=wt();e&&e.layoutOrder&&(_.belts.layoutOrder=e.layoutOrder),e&&e.beltOrder&&(_.belts.order=e.beltOrder)}catch(e){console.warn("Failed to load order preferences:",e)}}_applyComponentOrder(){this.onOrderChange&&this.onOrderChange(_.belts.layoutOrder,_.belts.order)}setOrderChangeCallback(e){this.onOrderChange=e}onOrientationChange(){this._updateDisplay()}_animateReorder(e){if(!this.draggedItem||!e)return;const t=Array.from(this.container.querySelectorAll(".order-item")),r=t.indexOf(this.draggedItem),i=t.indexOf(e);if(r===-1||i===-1)return;const n=r>i;t.forEach((s,o)=>{if(s===this.draggedItem)return;let l=0;n?o>=i&&o<r&&(l=this.draggedItem.offsetHeight+8):o>r&&o<=i&&(l=-(this.draggedItem.offsetHeight+8)),s.style.transform=`translateY(${l}px)`,s.style.transition="transform 0.2s ease"})}_resetAnimations(){this.container.querySelectorAll(".order-item").forEach(t=>{t.style.transform="",t.style.transition=""})}_createDragGhost(e,t,r){const i=e.cloneNode(!0);return i.classList.add("drag-ghost"),i.style.position="fixed",i.style.pointerEvents="none",i.style.zIndex="9999",i.style.opacity="0.8",i.style.width=e.offsetWidth+"px",i.style.left=t-e.offsetWidth/2+"px",i.style.top=r-e.offsetHeight/2+"px",i.style.transform="rotate(-2deg)",i.style.transition="none",document.body.appendChild(i),i}_updateDragGhost(e,t){this.dragGhost&&(this.dragGhost.style.left=e-this.dragGhost.offsetWidth/2+"px",this.dragGhost.style.top=t-this.dragGhost.offsetHeight/2+"px")}_removeDragGhost(){this.dragGhost&&(this.dragGhost.remove(),this.dragGhost=null)}_handleTouchStart(e){const t=e.target;if(!t.classList.contains("drag-handle"))return;const r=e.touches[0];this.touchStartY=r.clientY,this.touchStartX=r.clientX,this.isDraggingTouch=!1,this.draggedItem=t.closest(".order-item"),this.draggedItem&&console.log("Touch start on drag handle:",this.draggedItem.dataset.component)}_handleTouchMove(e){if(!this.draggedItem)return;const t=e.touches[0],r=Math.abs(t.clientY-this.touchStartY),i=Math.abs(t.clientX-this.touchStartX);if(!this.isDraggingTouch&&(r>this.touchScrollThreshold||i>this.touchScrollThreshold)&&(this.isDraggingTouch=!0,this.draggedItem.classList.add("dragging"),e.preventDefault(),this.dragGhost=this._createDragGhost(this.draggedItem,t.clientX,t.clientY),console.log("Started touch dragging")),this.isDraggingTouch){e.preventDefault(),this._updateDragGhost(t.clientX,t.clientY);const n=document.elementFromPoint(t.clientX,t.clientY),s=n==null?void 0:n.closest(".order-item");s&&s!==this.draggedItem&&(this.dragOverItem&&this.dragOverItem!==s&&this.dragOverItem.classList.remove("drag-over"),this.dragOverItem=s,s.classList.add("drag-over"),this._animateReorder(s))}}_handleTouchEnd(e){if(this.draggedItem){if(this.isDraggingTouch){if(e.preventDefault(),console.log("Touch drag ended"),this.dragOverItem&&this.dragOverItem!==this.draggedItem){const t=this.draggedItem.dataset.component,r=this.dragOverItem.dataset.component;console.log(`Touch dropping ${t} onto ${r}`),this._reorderComponents(t,r),this._saveOrder(),this._updateDisplay(),this._applyComponentOrder()}this._removeDragGhost()}this.draggedItem&&this.draggedItem.classList.remove("dragging"),this.dragOverItem&&this.dragOverItem.classList.remove("drag-over"),this._resetAnimations(),this.draggedItem=null,this.dragOverItem=null,this.isDraggingTouch=!1}}destroy(){this.container&&(this.container.removeEventListener("dragstart",this._handleDragStart.bind(this)),this.container.removeEventListener("dragover",this._handleDragOver.bind(this)),this.container.removeEventListener("dragenter",this._handleDragEnter.bind(this)),this.container.removeEventListener("dragleave",this._handleDragLeave.bind(this)),this.container.removeEventListener("drop",this._handleDrop.bind(this)),this.container.removeEventListener("dragend",this._handleDragEnd.bind(this)))}}class Po{constructor(e,t,r){this.state=t,this.callbacks=r,this.elements={resultContainer:e.querySelector("#result-container"),resultText:e.querySelector("#result-text"),flatBtn:document.getElementById("flat-btn"),sharpBtn:document.getElementById("sharp-btn"),settingsBtn:document.getElementById("settings-btn"),sidebar:document.getElementById("sidebar"),sidebarOverlay:document.getElementById("sidebar-overlay"),orientationHorizontal:document.getElementById("orientation-horizontal"),orientationVertical:document.getElementById("orientation-vertical"),themeLight:document.getElementById("theme-light"),themeDark:document.getElementById("theme-dark"),startTutorialBtn:document.getElementById("start-tutorial-btn")},this._initListeners(),this._initBeltOrderManager(),this._loadSavedPreferences()}_initListeners(){this.elements.flatBtn.addEventListener("click",this.callbacks.onToggleFlat),this.elements.sharpBtn.addEventListener("click",this.callbacks.onToggleSharp),this.elements.resultContainer.addEventListener("click",i=>{i.target.closest("button")||this.callbacks.onTogglePlayback()}),this.elements.settingsBtn.addEventListener("click",i=>{i.stopPropagation(),this.callbacks.onToggleSidebar()}),this.elements.sidebarOverlay.addEventListener("click",()=>{this.state.ui.sidebarOpen&&this.callbacks.onToggleSidebar(!1)}),this.elements.orientationHorizontal.addEventListener("change",()=>{this.elements.orientationHorizontal.checked&&this.callbacks.onToggleOrientation("horizontal")}),this.elements.orientationVertical.addEventListener("change",()=>{this.elements.orientationVertical.checked&&this.callbacks.onToggleOrientation("vertical")}),this.elements.themeLight.addEventListener("change",()=>{this.elements.themeLight.checked&&this.callbacks.onToggleDarkMode(!1)}),this.elements.themeDark.addEventListener("change",()=>{this.elements.themeDark.checked&&this.callbacks.onToggleDarkMode(!0)}),this.elements.startTutorialBtn.addEventListener("click",this.callbacks.onStartTutorial);const e=document.querySelectorAll(".cursor-color-btn");e.forEach(i=>{i.addEventListener("click",()=>{const n=i.dataset.color,s=i.dataset.fill==="true";e.forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-checked","false")}),i.classList.add("active"),i.setAttribute("aria-checked","true"),this.callbacks.onSetCursorColor&&this.callbacks.onSetCursorColor(n,s)})});const t=document.getElementById("orientation-toggle"),r=document.getElementById("theme-toggle");t.addEventListener("click",i=>{console.log("Orientation toggle clicked",i.target);const n=this.elements.orientationHorizontal.checked;console.log("Current orientation horizontal checked:",n),n?(console.log("Switching to vertical"),this.callbacks.onToggleOrientation("vertical")):(console.log("Switching to horizontal"),this.callbacks.onToggleOrientation("horizontal"))}),r.addEventListener("click",i=>{console.log("Theme toggle clicked",i.target);const n=this.elements.themeLight.checked;console.log("Current theme light checked:",n),n?(console.log("Switching to dark mode"),this.callbacks.onToggleDarkMode(!0)):(console.log("Switching to light mode"),this.callbacks.onToggleDarkMode(!1))})}_initBeltOrderManager(){try{this.orderManager=new Ao,this.orderManager.setOrderChangeCallback((e,t)=>{this.callbacks.onOrderChange&&this.callbacks.onOrderChange(e,t)})}catch(e){console.warn("Order Manager failed to initialize:",e)}}async _loadSavedPreferences(){try{const{loadPreferences:e}=await Je(async()=>{const{loadPreferences:r}=await Promise.resolve().then(()=>wi);return{loadPreferences:r}},void 0),t=e();t&&t.cursorColor&&t.cursorFill!==void 0&&(this.state.ui.cursorColor=t.cursorColor,this.state.ui.cursorFill=t.cursorFill,document.querySelectorAll(".cursor-color-btn").forEach(i=>{const n=i.dataset.color===t.cursorColor,s=i.dataset.fill===String(t.cursorFill),o=n&&s;i.classList.toggle("active",o),i.setAttribute("aria-checked",String(o))}))}catch(e){console.warn("Could not load saved cursor preferences:",e)}}update(){const{display:e,playback:t,ui:r,belts:i}=this.state,{resultContainer:n,flatBtn:s,sharpBtn:o,resultText:l,sidebar:c,sidebarOverlay:h,settingsBtn:u,orientationHorizontal:f,orientationVertical:g,themeLight:m,themeDark:d}=this.elements;s.classList.toggle("active",e.flat),o.classList.toggle("active",e.sharp),s.setAttribute("aria-pressed",String(e.flat)),o.setAttribute("aria-pressed",String(e.sharp)),n.classList.toggle("playback-active",t.isPlaying),Xn(this.state,l);const p=i.orientation==="horizontal";f.checked=p,g.checked=!p,m.checked=!r.darkMode,d.checked=r.darkMode;const y=r.sidebarOpen;c.classList.toggle("open",y),y?c.removeAttribute("aria-hidden"):c.setAttribute("aria-hidden","true"),h.classList.toggle("visible",y),u.setAttribute("aria-expanded",String(y)),this.orderManager&&this._lastOrientation!==i.orientation&&(this.orderManager.onOrientationChange(),this._lastOrientation=i.orientation)}destroy(){this.orderManager&&(this.orderManager.destroy(),this.orderManager=null)}}class Io{constructor(e){this.container=e,this.state=_,this.isInitialized=!1,this.cleanupFunctions=[],this.performanceMonitor=null,this.keyboardManager=null,this.screenReaderManager=null;try{this._initializeApp()}catch(t){E.handle(t,"App",()=>{console.error("Failed to initialize app")})}}_initializeApp(){if(this.elements={canvas:this.container.querySelector("#chromaWheel"),beltsContainer:this.container.querySelector(".belts-container")},!this.elements.canvas)throw new Error("Canvas element not found");if(!this.elements.beltsContainer)throw new Error("Belts container not found");const e={onToggleFlat:E.wrap(()=>{K.toggleAccidental("flat"),this._announceChange(`Flat names ${this.state.display.flat?"enabled":"disabled"}`)},"UI"),onToggleSharp:E.wrap(()=>{K.toggleAccidental("sharp"),this._announceChange(`Sharp names ${this.state.display.sharp?"enabled":"disabled"}`)},"UI"),onToggleDarkMode:E.wrap(t=>{typeof t=="boolean"?this.state.ui.darkMode!==t&&K.toggleDarkMode():K.toggleDarkMode(),this._announceChange(`${this.state.ui.darkMode?"Dark":"Light"} mode enabled`)},"UI"),onTogglePlayback:E.wrap(()=>{K.togglePlayback(),this._announceChange(this.state.playback.isPlaying?"Scale playing":"Playback stopped")},"UI"),onToggleSidebar:E.wrap(t=>{K.toggleSidebar(t),this._announceChange(`Settings ${this.state.ui.sidebarOpen?"opened":"closed"}`)},"UI"),onToggleOrientation:E.wrap(t=>{let r;typeof t=="string"?r=t:r=this.state.belts.orientation==="horizontal"?"vertical":"horizontal",this.state.belts.orientation!==r&&(K.setOrientation(r),this._announceChange(`Layout changed to ${r}`))},"UI"),onStartTutorial:E.wrap(()=>{this._announceChange("Tutorial started"),xo()},"Tutorial"),onShowKeyboardHelp:E.wrap(()=>{this._showKeyboardHelp()},"UI"),onOrderChange:E.wrap((t,r)=>{console.log("Order change triggered:",{layoutOrder:t,beltOrder:r}),this._applyComponentOrder(t,r)},"UI"),onSetCursorColor:E.wrap((t,r)=>{K.setCursorColor(t,r),this._announceChange(`Cursor color changed to ${t}${r?" with fill":""}`)},"UI")};try{this.wheel=new Eo(this.elements.canvas,this.state,this.onInteractionEnd.bind(this))}catch(t){E.handle(t,"Wheel",()=>{console.error("Wheel component failed to initialize")})}try{this.belts=new Oo(this.elements.beltsContainer,this.state,this.onInteractionEnd.bind(this))}catch(t){E.handle(t,"Belts",()=>{console.error("Belts component failed to initialize")})}try{this.uiControls=new Po(this.container,this.state,e)}catch(t){E.handle(t,"UIControls",()=>{console.error("UI Controls failed to initialize")})}this._initializeAccessibility(),this._setupResponsiveLogic();try{zn(E.wrap(this.redraw.bind(this),"RenderLoop"))}catch(t){E.handle(t,"RenderLoop",()=>{console.error("Render loop failed to start")})}this._setupPerformanceMonitoring(),this._setupAccessibilityMonitoring(),Ie.markDirty(this.state),this.isInitialized=!0}_initializeAccessibility(){try{this._loadAccessibilityModules().then(()=>{console.log("Accessibility features loaded")}).catch(()=>{console.log("Using basic accessibility features"),this._setupBasicAccessibility()})}catch(e){E.handle(e,"Accessibility",()=>{console.warn("Some accessibility features may not be available"),this._setupBasicAccessibility()})}}async _loadAccessibilityModules(){try{const{KeyboardManager:e}=await Je(async()=>{const{KeyboardManager:r}=await import("./KeyboardManager-C0NT1Vhp.js");return{KeyboardManager:r}},[]),{ScreenReaderManager:t}=await Je(async()=>{const{ScreenReaderManager:r}=await import("./ScreenReaderManager-HicNI_Nf.js");return{ScreenReaderManager:r}},[]);return e.init(),t.init(),this.keyboardManager=e,this.screenReaderManager=t,!0}catch{throw new Error("Accessibility modules not available")}}_setupBasicAccessibility(){this._setupBasicKeyboard(),this._setupBasicARIA(),this._setupBasicAnnouncements()}_setupBasicKeyboard(){const e=t=>{if(!this._isTextInputActive()&&!(t.ctrlKey||t.altKey||t.metaKey))switch(t.key){case"ArrowLeft":(t.target.id==="chromaWheel"||t.target.closest(".belt"))&&(t.preventDefault(),this._rotateRing("pitchClass",-1),this._announceChange("Pitch ring rotated left"));break;case"ArrowRight":(t.target.id==="chromaWheel"||t.target.closest(".belt"))&&(t.preventDefault(),this._rotateRing("pitchClass",1),this._announceChange("Pitch ring rotated right"));break;case"ArrowUp":(t.target.id==="chromaWheel"||t.target.closest(".belt"))&&(t.preventDefault(),this._rotateRing("pitchClass",1),this._announceChange("Pitch ring rotated up"));break;case"ArrowDown":(t.target.id==="chromaWheel"||t.target.closest(".belt"))&&(t.preventDefault(),this._rotateRing("pitchClass",-1),this._announceChange("Pitch ring rotated down"));break;case" ":case"Enter":!t.target.closest("button")&&!t.target.closest("input")&&!t.target.closest("select")&&(t.preventDefault(),K.togglePlayback());break;case"Escape":K.toggleSidebar(),this._announceChange(this.state.ui.sidebarOpen?"Settings opened":"Settings closed");break;case"f":case"F":t.preventDefault(),K.toggleAccidental("flat"),this._announceChange(`Flat names ${this.state.display.flat?"enabled":"disabled"}`);break;case"s":case"S":t.preventDefault(),K.toggleAccidental("sharp"),this._announceChange(`Sharp names ${this.state.display.sharp?"enabled":"disabled"}`);break;case"v":case"V":t.preventDefault();const r=this.state.belts.orientation==="horizontal"?"vertical":"horizontal";K.setOrientation(r),this._announceChange(`Layout changed to ${r}`);break}};document.addEventListener("keydown",e),this.cleanupFunctions.push(()=>{document.removeEventListener("keydown",e)})}_rotateRing(e,t){const r=t*(Math.PI*2/12),n=(this.state.rings[e]+r)%(Math.PI*2);K.setRingAngle(e,n)}_isTextInputActive(){const e=document.activeElement;return["INPUT","TEXTAREA","SELECT"].includes(e==null?void 0:e.tagName)||(e==null?void 0:e.contentEditable)==="true"}_applyComponentOrder(e,t){console.log("Applying component order:",{layoutOrder:e,beltOrder:t});const r=this.state.belts.orientation,i=e[r];console.log(`Current orientation: ${r}, order:`,i);let n=this.container.querySelector(".main-container");n||(n=document.querySelector(".main-container")),n&&this._restoreOriginalStructure(n),r==="horizontal"?(console.log("Calling _applyHorizontalOrder"),this._applyHorizontalOrder(i)):(console.log("Calling _applyVerticalOrder"),this._applyVerticalOrder(i)),t&&(console.log("Applying belt order:",t),this._applyBeltOrder(t))}_applyHorizontalOrder(e){console.log("_applyHorizontalOrder called with order:",e);let t=this.container.querySelector(".main-container");if(t||(t=document.querySelector(".main-container")),!t){console.log("ERROR: main-container not found anywhere"),console.log("this.container is:",this.container);return}console.log("Container element:",t),console.log("Container classes:",t.className),console.log("Container computed styles before:",{display:getComputedStyle(t).display,flexDirection:getComputedStyle(t).flexDirection,width:getComputedStyle(t).width,height:getComputedStyle(t).height});const r=t.querySelector(".belts-container"),i={compass:t.querySelector(".wheel-container"),result:t.querySelector("#result-container"),pitch:r==null?void 0:r.querySelector(".pitch-belt"),degree:r==null?void 0:r.querySelector(".degree-belt"),intervals:r==null?void 0:r.querySelector(".interval-brackets-wrapper"),chromatic:r==null?void 0:r.querySelector(".chromatic-belt")};console.log("Found components:",Object.keys(i).reduce((o,l)=>(o[l]=!!i[l],o),{})),console.log("Components dimensions before flattening:",{compass:i.compass?{width:i.compass.offsetWidth,height:i.compass.offsetHeight,display:getComputedStyle(i.compass).display}:null,beltsContainer:r?{width:r.offsetWidth,height:r.offsetHeight,display:getComputedStyle(r).display}:null});const n=["pitch","degree","intervals","chromatic"],s=[];n.forEach(o=>{const l=i[o];l&&(l._originalParent=l.parentNode,l._originalNextSibling=l.nextSibling,t.appendChild(l),s.push(l))}),r&&(r.style.display="none"),console.log("After flattening, container children:",Array.from(t.children).map(o=>({tagName:o.tagName,className:o.className,id:o.id,display:getComputedStyle(o).display,flex:getComputedStyle(o).flex,width:o.offsetWidth,height:o.offsetHeight}))),e.forEach((o,l)=>{const c=i[o];c&&(c.style.setProperty("order",l+1,"important"),console.log(`Set order ${l+1} for component:`,o),console.log("Element after order applied:",{width:c.offsetWidth,height:c.offsetHeight,display:getComputedStyle(c).display,flex:getComputedStyle(c).flex,order:getComputedStyle(c).order}))}),console.log("Container computed styles after:",{display:getComputedStyle(t).display,flexDirection:getComputedStyle(t).flexDirection,width:getComputedStyle(t).width,height:getComputedStyle(t).height}),t._isFlattened=!0,t._beltElements=s,t._beltsContainer=r}_applyVerticalOrder(e){let t=this.container.querySelector(".main-container");if(t||(t=document.querySelector(".main-container")),!t)return;this._restoreOriginalStructure(t);const r=e.indexOf("compass"),i=e.indexOf("result");console.log("Vertical layout indices:",{order:e,compassIndex:r,resultIndex:i,compassFirst:r<i}),r>i?(t.style.gridTemplateAreas=`
        "wheel belts"
        "wheel result"
      `,console.log("Applied vertical order: compass left, belts right (compass after result)")):(t.style.gridTemplateAreas=`
        "belts wheel"
        "result wheel"
      `,console.log("Applied vertical order: belts left, compass right (compass before result)"))}_restoreOriginalStructure(e){e._isFlattened&&(console.log("Restoring original DOM structure"),e._beltElements&&e._beltsContainer&&(e._beltElements.forEach(t=>{t.style.removeProperty("order"),t._originalNextSibling?t._originalParent.insertBefore(t,t._originalNextSibling):t._originalParent.appendChild(t),delete t._originalParent,delete t._originalNextSibling}),e._beltsContainer.style.display=""),delete e._isFlattened,delete e._beltElements,delete e._beltsContainer)}_applyBeltOrder(e){const t=this.elements.beltsContainer;if(!t)return;const r={pitch:t.querySelector(".pitch-belt"),degree:t.querySelector(".degree-belt"),intervals:t.querySelector(".interval-brackets-wrapper"),chromatic:t.querySelector(".chromatic-belt")};e.forEach((i,n)=>{const s=r[i];s&&(s.style.setProperty("order",n+1,"important"),console.log(`Set belt order ${n+1} for belt:`,i))})}_setupBasicARIA(){this.container.setAttribute("role","main"),this.container.setAttribute("aria-label","Diatonic Compass Music Theory Tool"),this.elements.canvas&&(this.elements.canvas.setAttribute("tabindex","0"),this.elements.canvas.setAttribute("role","application"),this.elements.canvas.setAttribute("aria-label","Interactive Diatonic Compass - use arrow keys to explore"));const e=document.querySelector("#result-container");e&&(e.setAttribute("tabindex","0"),e.setAttribute("aria-label","Current musical key and mode - click to play"))}_setupBasicAnnouncements(){const e=document.createElement("div");e.id="basic-announcements",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","false"),e.style.cssText=`
      position: absolute;
      left: -10000px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    `,document.body.appendChild(e),this.cleanupFunctions.push(()=>{e.parentNode&&e.parentNode.removeChild(e)})}_announceChange(e){const t=document.getElementById("basic-announcements");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},100)),this.screenReaderManager&&this.screenReaderManager.queueAnnouncement(e)}_showKeyboardHelp(){const e=`
Keyboard Shortcuts:
- Tab: Navigate between controls
- Arrow keys: Rotate pitch ring (when focused on wheel/belts)
- Ctrl + arrows: Large steps (when focused on wheel/belts)
- Space/Enter: Play scale (when focused on wheel/result)
- F: Toggle flat note names
- S: Toggle sharp note names  
- V: Toggle vertical/horizontal layout
- H: Show this help
- Escape: Open/close settings

Focus the wheel or belts first, then use arrow keys to rotate rings.
    `.trim();alert(e)}_setupAccessibilityMonitoring(){const e=window.matchMedia("(prefers-reduced-motion: reduce)"),t=n=>{document.body.classList.toggle("reduced-motion",n.matches)};e.addListener(t),t(e),this.cleanupFunctions.push(()=>{e.removeListener(t)});const r=window.matchMedia("(prefers-contrast: high)"),i=n=>{document.body.classList.toggle("high-contrast",n.matches)};r.addListener(i),i(r),this.cleanupFunctions.push(()=>{r.removeListener(i)})}onInteractionEnd(){setTimeout(()=>{const e=document.querySelector("#result-text");e&&this._announceChange(`Current key: ${e.textContent}`)},100)}_setupResponsiveLogic(){let e=!1;const t=()=>{e||(e=!0,this.elements.beltsContainer&&(this.elements.beltsContainer.style.opacity="0"))},r=rt.debounce(()=>{try{const s=window.innerWidth>window.innerHeight?"vertical":"horizontal";this.state.belts.orientation!==s&&(K.setOrientation(s),this._announceChange(`Layout changed to ${s}`)),this.state.belts.init=!1,Ie.markDirty(this.state),requestAnimationFrame(()=>{this.elements.beltsContainer&&(this.elements.beltsContainer.style.opacity="1"),e=!1})}catch(n){E.handle(n,"Resize",()=>{console.warn("Resize handling failed")}),this.elements.beltsContainer&&(this.elements.beltsContainer.style.opacity="1"),e=!1}},250),i=()=>{t(),r()};window.addEventListener("resize",i),this.cleanupFunctions.push(()=>{window.removeEventListener("resize",i),r.cancel()});try{const s=window.innerWidth>window.innerHeight?"vertical":"horizontal";K.setOrientation(s)}catch(n){E.handle(n,"Resize")}}_setupPerformanceMonitoring(){let e=0;const t=3;if(this.performanceMonitor=rt.createFPSMonitor(r=>{r<30?(e++,console.warn(`Low FPS detected: ${r} (count: ${e})`),e>=t&&!this.state.performance.isLowPowerMode&&(this.state.performance.isLowPowerMode=!0,document.body.classList.add("low-power-mode"),console.log("Low-power mode enabled due to poor performance"),this._announceChange("Performance mode adjusted for this device"))):r>=50&&(e=Math.max(0,e-1),e===0&&this.state.performance.isLowPowerMode&&(this.state.performance.isLowPowerMode=!1,document.body.classList.remove("low-power-mode"),console.log("Low-power mode disabled - performance improved")))},120),rt.getMemoryInfo()){const r=setInterval(()=>{const i=rt.getMemoryInfo();i&&i.used>100&&console.warn(`High memory usage: ${i.used}MB`)},3e4);this.cleanupFunctions.push(()=>clearInterval(r))}this.cleanupFunctions.push(()=>{this.performanceMonitor&&(this.performanceMonitor(),this.performanceMonitor=null)})}redraw(e){try{const t=jn(e);if(Hn(this.elements.canvas,this.state.dimensions)&&Ie.markDirty(this.state),!this.state.performance.isLowPowerMode&&!Ie.needsRedraw(this.state)||!this.state.dimensions.size||this.state.performance.isLowPowerMode&&t&&(this.state.performance.frameSkipCounter++,this.state.performance.frameSkipCounter%2===1))return;const i=pi(this.state),{rings:n,playback:s}=this.state,o=Nt;if(this.wheel)try{this.wheel.update(n,i,s)}catch(l){E.handle(l,"Wheel",()=>{console.warn("Wheel update failed - skipping frame")})}if(this.belts)try{this.belts.update(i,o)}catch(l){E.handle(l,"Belts",()=>{console.warn("Belts update failed - skipping frame")})}if(this.uiControls)try{this.uiControls.update()}catch(l){E.handle(l,"UIControls",()=>{console.warn("UI Controls update failed - skipping frame")})}Ie.markClean(this.state)}catch(t){E.handle(t,"RenderLoop",()=>{console.error("Critical render error - app may be unstable")})}}destroy(){try{this.keyboardManager,this.screenReaderManager&&this.screenReaderManager.cleanup(),this.cleanupFunctions.forEach(e=>{try{e()}catch(t){console.warn("Cleanup function failed:",t)}}),this.cleanupFunctions=[],this.wheel&&typeof this.wheel.destroy=="function"&&this.wheel.destroy(),this.belts&&typeof this.belts.destroy=="function"&&this.belts.destroy(),this.uiControls&&typeof this.uiControls.destroy=="function"&&this.uiControls.destroy(),this.performanceMonitor&&(this.performanceMonitor(),this.performanceMonitor=null),this.isInitialized=!1}catch(e){E.handle(e,"App",()=>{console.error("App cleanup failed")})}}_isDevelopment(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.protocol==="file:"}getStatus(){var e,t;return{initialized:this.isInitialized,components:{wheel:!!this.wheel,belts:!!this.belts,uiControls:!!this.uiControls},accessibility:{keyboardEnabled:(e=this.keyboardManager)==null?void 0:e.isEnabled,screenReaderEnabled:(t=this.screenReaderManager)==null?void 0:t.isEnabled},dimensions:this.state.dimensions,errors:E.getErrorLog()}}}function Do(){const a=wt();if(a&&(typeof a.darkMode=="boolean"&&(_.ui.darkMode=a.darkMode,document.body.classList.toggle("dark-mode",a.darkMode)),Array.isArray(a.beltOrder))){const e=["pitch","degree","intervals","chromatic"];if(e.every(r=>a.beltOrder.includes(r))&&a.beltOrder.length===e.length){_.belts.order=a.beltOrder;const r=document.querySelector(".belts-container");if(r){const i={pitch:".pitch-belt",degree:".degree-belt",intervals:".interval-brackets-wrapper",chromatic:".chromatic-belt"};a.beltOrder.forEach((n,s)=>{const o=i[n];if(o){const l=r.querySelector(o);l&&(l.style.order=s+1)}})}}}}document.addEventListener("DOMContentLoaded",()=>{Do();const a=document.querySelector(".main-container");a&&new Io(a)});export{K as A,Q as C,Nt as D,E,_ as a,Y as b,pi as c,Ro as g,F as n,Yt as s};
